000100200616     H        1
000200200616      *****************************************************************
000300200616/*STD *  RPGBASE                                                      *
000400200616/*EXI *  TEXT('Midas SE ER gen. a/c keys and rc pos.settlments')      *
000500200616     F*****************************************************************
000600200616     F*                                                               *
000700200616     F*  Midas - Securities Trading Module                            *
000800200616     F*                                                               *
000900200616     F*  SE6720 - SE ER Generates A/C Keys & Position Settlements     *
001000200616     F*                                                               *
001100200616      *  (c) Finastra International Limited 2001                      *
001200200616     F*                                                               *
001201200616      *  Last Amend No. AR324886           Date 01JUN20               *
001300200616      *  PREV Amend No. MD046248           Date 27Oct17               *
001400200616      *                 215959             Date 21Mar16               *
001500200616      *                 CGL165             Date 17Feb15               *
001600200616      *                 CSW210             Date 04May10               *
001700200616      *                 BUG26839           Date 05Jan10               *
001800200616      *                 CER054             Date 07Apr09               *
001900200616      *                 BUG23123           Date 09Mar09               *
002000200616      *                 BUG22911           Date 17Feb09               *
002100200616      *                 CER048             Date 19May08               *
002200200616      * Bank Fusion Midas 1.4 Base -----------------------------------*
002300200616      * Midas Plus 1.4 Base 04 ---------------------------------------*
002400200616      * Midas Plus 1.4 Base ------------------------------------------*
002500200616      *                 234054             Date 14Feb07               *
002600200616      *                 219566             Date 09Feb07               *
002700200616      * Midas Plus 1.3 ----------- Base ------------------------------*
002800200616      *                 150158             Date 13Oct06               *
002900200616      *                 219688             Date 11Oct06               *
003000200616      *                 CSD031             Date 10Apr06               *
003100200616      *                 CSD027A            Date 06May06               *
003200200616      *                 CSD027             Date 09Dec05               *
003300200616      *                 BUG11164           Date 06Apr06               *
003400200616      *                 236137             Date 20Sep05               *
003500200616      *                 235546             Date 26Jul05               *
003600200616      *                 234874             Date 08Aug05               *
003700200616      *                 234813             Date 14Jul05               *
003800200616      *                 234440             Date 27Jun05               *
003900200616      *                 234140             Date 17May05               *
004000200616      *                 233712             Date 09Jun05               *
004100200616      *                 233709             Date 25May05               *
004200200616      *                 CSE071             Date 19Jul05               *
004300200616      *                 CSW037A            Date 02May05               *
004400200616      *                 CSD025             Date 11Jan05               *
004500200616      *                 CSW037             Date 15Dec04               *
004600200616      *                 CSW036             Date 15Dec04               *
004700200616      *                 BUG3122            Date 17Jul04               *
004800200616      *                 CLE025             Date 20Oct03               *
004900200616      *                 CGL029             Date 01Sep03               *
005000200616      *                 CGL020             Date 12Dec02               *
005100200616      * Midas Release 4.01.02 ----------------------------------------*
005200200616      *                 160338             Date 23Apr02               *
005300200616      * Midas Release 4.01 -------------------------------------------*
005400200616      *                 CSE034             Date 24Apr02               *
005500200616      * Midas Release 4 --------------- Base -------------------------*
005600200616      *                 CSE028             Date 06Jun01               *
005700200616      * Midas DBA 3.05 -----------------------------------------------*
005800200616      *                 189109             Date 12Jan01               *
005900200616      * Midas DBA 3.04 -----------------------------------------------*
006000200616      *                 CSE023             Date 12Jul00               *
006100200616      * Midas DBA 3.02 -----------------------------------------------*
006200200616      *                 CPB001             DATE 26Aug99               *
006300200616      * Midas DBA 3.00 ---------------- Base -------------------------*
006400200616     F*                 CEU005             Date 04Feb98               *
006500200616     F*                 092665             DATE 24FEB98               *
006600200616     F*                 CAC003             Date 25Feb97               *
006700200616     F*                 101626             Date 18JUL96               *
006800200616     F*                 095236             DATE 30OCT95               *
006900200616     F*                 094693             DATE 18OCT95               *
007000200616     F*                 085862             DATE 16MAR95               *
007100200616     F*                 S01496             DATE 02NOV94               *
007200200616     F*                 64743              DATE 12JAN94               *
007300200616     F*                 CH0273             DATE 02AUG93               *
007400200616     F*                 S10978             DATE 03MAY93               *
007500200616     F*                                                               *
007600200616     F*---------------------------------------------------------------*
007700200616     F*                                                               *
007701200616      *  AR324886 - Implement 4-eyes processing in Position           *
007702200616      *             Settlement Maintenance.                           *
007800200616      *  MD046248 - Finastra Rebranding                               *
007900200616      *  215959 - Truncation error on event amount in SE2450P3.       *
008000200616      *           Recompiled due to changes in PF/SEKEYD.             *
008100200616      *         - Applied for MD-37439.                               *
008200200616      *  CGL165 - Dual Withholding Tax (Recompile)                    *
008300200616      *  CSW210 - SWIFT 2010 Changes                                  *
008400200616      *  CER054 - German Features - Church Tax (Recompile)            *
008500200616      *  BUG23123 - Report: Does not show Retail Account Number       *
008600200616      *                     Date is not Midas Standard Date           *
008700200616      *                     Period should be actual int. calc. period *
008800200616      *                     Secondary Tax amount is not printed       *
008900200616      *                     Added field TSSLID                        *
009000200616      *                     (Recompile)                               *
009100200616      *  BUG22911 - Changes for Correct Tax Calculation               *
009200200616      *  CER048 - German Features - Taxes                             *
009300200616     F*  234054 - Complete fix for for Depositary customer.           *
009400200616      *  219566 - Default the settlement account if no account for    *
009500200616      *           the specified portfolio. This is a LUX local fix    *
009600200616      *           so conditioned in core using new system value       *
009700200616      *           "UseDefaultSettAccnt" in SDSVALPD.                  *
009800200616     F*  150158 - Complete CAC003 : If profit center not found, use   *
009900200616     F*           the one by default.                                 *
010000200616      *  219688 - Settlement account not correctly retrieved          *
010100200616      *           If the customer is a portfolio one, access first    *
010200200616      *           with the account code defined as settlement in      *
010300200616      *           SDSECSPD. If not found use the PMACCNL0 account.    *
010400200616      *  CSD031 - Enhanced Centralised Static Data (Recompile)        *
010500200616      *  CSD027A - Conversion Of Customer Number to Alpha             *
010600200616      *  CSD027 - Conversion Of Customer Number to Alpha              *
010700200616      *  BUG11164 - A Serious Midas Error on SETRAD insert/amend      *
010800200616      *  236137 - Change Control for CGL031 Parts 4 & 5.              *
010900200616      *           Several changes in the Taxation of Savings Income   *
011000200616      *           functionality.                                      *
011100200616      *           - Choice of calculation method for fiscal price     *
011200200616      *           must take in account Tax Calculation Basis          *
011300200616      *           indicator from Country of Tax Codes file SDCTTXPD.  *
011400200616      *  235546 - Parameter to ZAINTPL2 has wrong length.             *
011500200616      *  234874 - Early redemption error in the EU tax calculation    *
011600200616      *           Parameters to call program SEETCPRTV                *
011700200616      *           Review calculation if country is 'CH'               *
011800200616      *  234813 - Do not calculate EU Tax if local tax is higher.     *
011900200616      *  234440 - Use new file ETCPOSND for average price, average    *
012000200616      *           fiscal price, purchased interest etc                *
012100200616      *         - Change Control 1 Part 4 - For Switzerland only,     *
012200200616      *           bonds at at a discount will have their fiscal price *
012300200616      *           calculated on a yield curve, and funds will not     *
012400200616      *           take into account the profit on a sale when deciding*
012500200616      *           the tax amount - THE LATTER PART HAS BEEN INSERTED  *
012600200616      *           AND THEN REMOVED AGAIN                              *
012700200616      *  234140 - EU witholding tax (recompile)                       *
012800200616      *  233712 - Changes for CGL031 (EU Taxation of Savings Income)  *
012900200616      *  233709 - Tax must be calculated prorata temporis to          *
013000200616      *           Effective Date.                                     *
013100200616      *  CSE071 - Multiple Holidays Re Securities (recompile)         *
013200200616      *  CSW037A- Additional Field extended to 40 chars (recompile)   *
013300200616      *  CSD025 - Customer De-Activation                              *
013400200616      *  CSW037 - Additional Field Data on MT300/MT320                *
013500200616      *  CSW036 - Dual SWIFT BIC held on Client Details               *
013600200616      *  BUG3122 - Recompiled due to changes in SDSECSPD.             *
013700200616      *  CLE025 - Credit Lines (Recompile)                            *
013800200616      *  CGL029 - Increase Account Code to 10 digits                  *
013900200616     F*  CGL020 - Midas Compliance Watch - Additional A/C Postings    *
014000200616     F*           Information                                         *
014100200616     F*  160338 - Although standard settlements instructions for the  *
014200200616     F*           customer was defined in Securities Standard         *
014300200616     F*           Settlement Maintenance, the settlement details for  *
014400200616     F*           the customer in Position Settlement for event type  *
014500200616     F*           'RC' is incorrect. Amend program in such a way that *
014600200616     F*           standard settlement instructions defined for the    *
014700200616     F*           customer is used in generating Position Settlement. *
014800200616      *  CSE034 - Standard Settlement Instruction improvements        *
014900200616      *  CSE028 - Standing Settlement Instructions Enhancement.       *
015000200616      *  189109 - Init field DAMT linked to CSE023                    *
015100200616      *  CSE023 - Treaty Withholding Tax (Recompiled)                 *
015200200616     F*  CPB001 - 'Private Banking' Module                            *
015300200616     F*  CEU005 - EMU SE Settlement Ccy Conversion                    *
015400200616     F*  092665 - CORRECT WEEKEND GENERATION                          *
015500200616      *  CAC003 - Profit Centre Accounting Development Phase 3.       *
015600200616     F*  101626 - If a security has a coupon and a redemption on the  *
015700200616     F*           same day, the redemption settlement is generated    *
015800200616     F*           one day after the coupon settlement. Fix is to use  *
015900200616     F*           'Type End of Day' parameter to set up Event Control *
016000200616     F*           Date to be the same as other SE settlement event    *
016100200616     F*           generation programs (e.g. SE2100)                   *
016200200616     F*  095236 - Value Date was zero                                 *
016300200616     F*  094693 - ACCNT's key is now split due to branch so use       *
016400200616     F*           external file description                           *
016500200616     F*  085862 - ZSETAC SHOULD INCLUDE BRANCH                        *
016600200616     F*  S01496 - Incorporation of Jyske Enhancements (S10978)        *
016700200616     F*  64743  - If there are CP/MT or CP/RC, both events should be  *
016800200616     F*           generated in the same EOD and not the day before    *
016900200616     F*           the last day before the redemption date (RC)        *
017000200616     F*                                                               *
017100200616     F*  CH0273 - INCORRECT CURRENCY FOR EARLY REDEMPTION.            *
017200200616     F*  S10978 - JYSZRH: EARLY REDEMPTIONS                           *
017300200616     F*                                                               *
017400200616     F*****************************************************************
017500200616     F*  C R E A T I O N     P A R A M E T E R S                      *
017600200616     F*                                                               *
017700200616     F*                                                               *
017800200616     F*****************************************************************
017900200616     F*
018000200616     F** Input files
018100200616     F*
018200200616     F********Bank*Details*********************************************   S01496
018300200616     F***SDBANKL1IF**E           K        DISK                            S01496
018400200616     F********Branch*Details*******************************************   S01496
018500200616     F***SDBRCHL0IF**E           K        DISK                            S01496
018600200616     F********General*Ledger*Details***********************************   S01496
018700200616     F***SDGELRL1IF**E           K        DISK                            S01496
018800200616     F********Retail*Details*******************************************   S01496
018900200616     F***SDRETLL1IF**E           K        DISK                            S01496
019000200616     F********Swiss*Taxes*ICD.*************************************CH0273 S01496
019100200616     F***SDSTAXPDIF**E           K        DISK                     CH0273 S01496
019200200616     F**      Portfolio
019300200616     F***PMPORTPPIF**E           K        DISK                            S01496
019400200616     FPMPORTPDIF  E           K        DISK                               S01496
019500200616     F*
019600200616     F**      Account Details by 15A Account Code. no prefix
019700200616     F***ACCNT***IF  F     416 15AI     2 DISK         KINFSR *PSSR       S01496
019800200616     F***ACCNT***IF**F     416 18AI     2 DISK         KINFSR *PSSR S01496094693
019900200616     FACCNT   IF  E           K        DISK         KINFSR *PSSR          094693
020000200616     F            ACCNTAAF                          KIGNORE               094693
020100200616     F            ACCNTABF                          KRENAMEACCNTB1F       094693
020200200616     F            ACCNTACF                          KIGNORE               094693
020300200616     F*
020400200616     F**      Account Details by 15N Account Number. no prefix
020500200616     F***ACNUM***IF**F      47 10AI     2 DISK         KINFSR *PSSR       094693
020600200616     FACNUM   IF  E           K        DISK         KINFSR *PSSR          094693
020700200616     F            ACCNTABF                          KRENAMEACCNTB2F       094693
020800200616     F********Client*Details*******************************************   S01496
020900200616     F***SDCUSTL0IF**E           K        DISK                            S01496
021000200616     F********Securities*Clients***************************************   S01496
021100200616     F***SDSECSL0IF**E           K        DISK                            S01496
021200200616     F********PM*special*Customer*Details******************************   S01496
021300200616     F***SDPLCSPDIF**E           K        DISK                            S01496
021400200616     F**      Security Details
021500200616     FSECTY   IF  E           K        DISK
021600200616     F********Securities*Trading***************************************   S01496
021700200616     F***SDSTRDL1IF**E           K        DISK                            S01496
021800200616     F********Currency*************************************************   S01496
021900200616     F***SDCURRL1IF**E           K        DISK                            S01496
022000200616     F*
022100200616     FSECGT   IF  E           K        DISK
022200200616     F*                                                                   CAC003
022300200616     F** Customer Position Profit Centre File                             CAC003
022400200616     FSEPCCD  IF  E           K        DISK                               CAC003
022500200616     F*
022600200616     F***SEDFTCL2IF**E           K        DISK                            S01496
022700200616     FSEDFTCL2IF  E           K        DISK                           UC  S01496
022800200616     F*                                                                   S01496
022900200616     FSEDFGRL0IF  E           K        DISK                           UC  S01496
023000200616     F            SEDFTCD0                          KRENAMESEDFGRD0       S01496
023100200616     F**
023200200616     F***FDTABJLLIF  E           K        DISK                         UC 64743
023300200616     F**      Standard Settlements Instructions
023400200616     FSTDSED  IF  E           K        DISK
023500200616     F**      Accounts by Portfolio
023600200616     F***ACCNTPS*IF**E           K        DISK                            S01496
023700200616     FPMACCNL0IF  E           K        DISK                               S01496
023800200616     F            ACCNTABF                          KRENAMEACCNTABI
023900200616     FPMACCNL1IF  E           K        DISK                               219688
024000200616     F            ACCNTABF                          KRENAMEACCNTL1F       219688
024100200616     F*                                                                   219688
024200200616     FTABSE   IF  E           K        DISK                               101626
024300200616     F            TABLETAF                          KIGNORE               101626
024400200616     F            TABTB10F                          KIGNORE               101626
024500200616     F            TABTB36F                          KIGNORE               101626
024600200616     F            TABTB40F                          KIGNORE               101626
024700200616     F            TABTE10F                          KIGNORE               101626
024800200616     F            TABTE20F                          KIGNORE               101626
024900200616     F            TABTG10F                          KIGNORE               101626
025000200616     F            TABTG20F                          KIGNORE               101626
025100200616     F            TABLETHF                          KIGNORE               101626
025200200616     F            TABLETKF                          KIGNORE               101626
025300200616     F            TABLETLF                          KIGNORE               101626
025400200616     F            TABLETNF                          KIGNORE               101626
025500200616     F            TABLETPF                          KIGNORE               101626
025600200616     F            TABLETRF                          KIGNORE               101626
025700200616     F            TABLETXF                          KIGNORE               101626
025800200616     F            TABLET2F                          KIGNORE               101626
025900200616     F            TABLET3F                          KIGNORE               101626
026000200616     F            TABLET5F                          KIGNORE               101626
026100200616      *                                                                                       234813
026200200616      ** Securities WHT details file                                                          234813
026300200616     FSESWHTL0IF  E           K        DISK         KINFSR *PSSR                              234813
026400200616      *                                                                                       233712
026500200616      ** Midas SD Tax Calculation Method                                                      233712
026600200616     FSDTXCML1IF  E           K        DISK         KINFSR *PSSR                              233712
026700200616      *                                                                                       233712
026800200616      ** Midas SD Joint Account Member                                                        233712
026900200616     FSDJACCLBIF  E           K        DISK         KINFSR *PSSR                              233712
027000200616      *                                                                                       233712
027100200616      ***Midas*SE*Customer*Position*File*******************************                233712 234440
027200200616     F***CPOSC** IF  E           K        DISK         KINFSR *PSSR                    233712 234440
027300200616      *                                                                                       233712
027400200616     F/COPY WNCPYSRC,SE6720F001
027500200616     F*****************************************************************
027600200616     F*
027700200616     F** Update files
027800200616     F*
027900200616     FSEERDPL0UF  E           K        DISK         KINFSR *PSSR
028000200616     FSEERALL0UF  E           K        DISK         KINFSR *PSSR
028100200616     FSEERRFL2UF  E           K        DISK         KINFSR *PSSR
028200200616     F*****************************************************************
028300200616     F*
028400200616     F** Output files
028500200616     F*
028600200616     FPOSETA  O   E                    DISK         KINFSR *PSSR
028700200616     FPOSETD  O   E           K        DISK         KINFSR *PSSR
028800200616     F***POSETDX0O***E           K        DISK         KINFSR *PSSR       S01496
028801200616     FPSAUTD  O   E           K        DISK                                                 AR324886
028802200616      ** SE Position Settlement Authorisation detail                                        AR324886
028803200616      *                                                                                     AR324886
028900200616     FSEKEYA  O   E                    DISK         KINFSR *PSSR
029000200616     FSEKEYD  O   E           K        DISK         KINFSR *PSSR
029100200616     FSE6720AUO   E                    PRINTER
029200200616     F**********************************************************************
029300200616     F*
029400200616     F*  FUNCTION OF INDICATORS
029500200616     F*
029600200616     F*    40  -  Analytical Accounting module and CAC003 is installed    CAC003
029700200616     F*    55  -  CHARGES BY CUSTOMER GROUP FEATURE IS ON                 S01496
029800200616     F*    60  -  Access to PF/SEPCCD                                     CAC003
029900200616      *    62  -  Access to PF/SESWHTPD                               *                       234813
030000200616     F*    89  -  FILE CHAIN/READ INDICATOR FOR FILES
030100200616     F*    90-99 - USED IN Z SUBROUTINES
030200200616     F*    U7  -  DATABASE ERROR
030300200616     F*    U8  -  DATABASE ERROR
030400200616     F*
030500200616     F*    I N D E X   T O   S U B R O U T I N E S
030600200616     F*
030700200616     F*  P001    - INITIAL PROCESSING
030800200616     F*  P002    - MAIN PROCESSING
030900200616     F*  P003    - TERMINATION PROCESSING
031000200616     F*  P005    - PROCESS ALL DEPOT RECORDS IN LF/SEERDPL0
031100200616     F*  P006    - PROCESS ALL ALLOCATION RECORDS IN LF/SEERALL0
031200200616     F*  P008    - DETERMINE IF EARLY REDEMPTION MUST BE PROCESSED
031300200616     F*  P801    - CALCULATE LAST WORKING DAY BEFORE REDEMPTION
031400200616     F*  P04     - SUBROUTINE TO CALCULATE CHARGE/COMMISSION AMOUNTS
031500200616     F*  P05     - SUBROUTINE TO CALCULATE DEFAULT AMOUNTS
031600200616     F*  P06     - SUBROUTINE TO CALCULATE SETTLEMENT AMOUNTS
031700200616     F*  CALAMT  - SUB ROUTINE TO DETERMINE IF AMOUNTS NEED TO BE
031800200616     F*            DEFAULTED FOR CHARGES
031900200616     F*  CALAM2  - SUB ROUTINE TO CALCULATE CHARGE AMOUNTS
032000200616     F*  CHKTAX  - Check if record is existing in SDCTTXPD for taxing                         233712
032100200616     F*  CSINSR  - Output Information on SDCSINPD                                             233712
032200200616     F*  ERTAX   - Calculate tax for descretionary and Safe                                   233712
032300200616     F*            Custody Customers for Mature                                               233712
032400200616     F*  MATXCL  - Calculate tax amount for the Maturity or Early                             233712
032500200616     F*            Redemption and to Output Information on SDCSINPD                           233712
032600200616     F*
032700200616     F*  W101    - WRITE ACCOUNT KEY (DEPOT)
032800200616     F*  W102    - WRITE POSITION SETTLEMENT  (DEPOT)
032900200616     F***P102****-*WRITE*POSITION*SETTLEMENT*EXTENSION*(DEPOT)*********   S01496
033000200616     F*  W201    - WRITE ACCOUNT KEY (CUSTOMER)
033100200616     F*  W202    - WRITE POSITION SETTLEMENT (CUSTOMER)
033200200616     F***P202****-*WRITE*POSITION*SETTLEMENT*EXTENSION*(CUSTOMER)******   S01496
033300200616     F*
033400200616     F*  AUDIT   - OUTPUTS AUDIT RECORD UDEPPA AND CONTROL REPORT
033500200616     F*  FIRST   - ACCESSES ICD INFORMATION
033600200616     F*  SECTIN  - GET SECURITY DETAIL RECORD IN
033700200616     F*  ZCONV   - CALLED BY ZCCAL1. IN THIS PROGRAM NOT STANDARD
033800200616     F*            SUBROUTINE; CALLS ZCCYCN TO GET AMOUNT IN ANOTHER
033900200616     F*            CURRENCY (SAME NAME AS STANDARD SUBROUTINE BECAUSE
034000200616     F*            NO CHANGE IN ZCCAL1)
034100200616     F*
034200200616     F*     STANDARD SUBROUTINE
034300200616     F*
034400200616     F*   ZA0830 - Check whether date is an holiday
034500200616     F*   ZAPNUM  - CALCULATE AP NUMERATOR
034600200616     F*       STANDARD SUBROUTINE DIRECTLY COPIED AND CHANGED |||||
034700200616     F*       CHANGE IS MARKED WITH S10978
034800200616     F*       ZNOML DEFINED 15,0 BECAUSE IN ZCCAL1 IS 15,0 TOO.
034900200616     F*   ZCCAL1  - TO CALCULATE CHARGES/COMMISSIONS
035000200616     F*   ZCCAL2  - TO CALCULATE CHARGES/COMMISSIONS
035100200616     F*   ZCCYCN  - CONVERT AMOUNT IN ONE CURRENCY TO ANOTHER CURRENCY
035200200616     F*   ZEVCD  - Calculate Event Control Date
035300200616     F*   ZHASH  - HASH TOTALLING STD SUBROUTINE
035400200616     F*   ZSETAC - SR. TO DETERMINE SETTLEMENT ACCOUNT
035500200616     F*   ZTNLU1  - TO LOCK THE TRANSACTION NUMBER DATA AREA,
035600200616     F**********************************************************************
035700200616      /EJECT
035800200616     E**********************************************************************
035900200616     E**    TABLES AND ARRAYS    **
036000200616     E*
036100200616     E/COPY ZSRSRC,ZPOWER8Z1
036200200616     E/COPY ZSRSRC,ZPOWERZ1
036300200616     E*
036400200616     E                    CPY@    1   1 80
036500200616     E/COPY ZSRSRC,ZHASHZ1
036600200616     E/COPY ZSRSRC,ZCCAL1Z1
036700200616     E*
036800200616     E**  USED BY SR. ZA0830 - CURRENCY RECORDS
036900200616     E***                 @CY        50  3                                64743
037000200616     E/COPY WNCPYSRC,SE6720E001
037100200616     E**********************************************************************
037200200616      /EJECT
037300200616     I**********************************************************************
037400200616     I***********                                                         094693
037500200616     I***ACCNT***NS**                                                     094693
037600200616     I***********                             2   70ZRCNUM                094693
037700200616     I***********                             8  10 ZRCCY                 094693
037800200616     I***********                            11  140ZRACOD                094693
037900200616     I***********                            15  160ZRACSQ                094693
038000200616     I***********                            27  29 ZRBRCA          S01496094693
038100200616     I***********                           401 404 ZRPTFR                094693
038200200616     I***ACNUM***NS*                                                      094693
038300200616     I***********                            12  170ZRCNUM                094693
038400200616     I***********                            18  20 ZRCCY                 094693
038500200616     I***********                            21  240ZRACOD                094693
038600200616     I***********                            25  260ZRACSQ                094693
038700200616     I***********                            29  31 ZRBRCA          S01496094693
038800200616     I***********                            41  44 ZRPTFR                094693
038900200616     IACCNTB1F                                                            094693
039000200616     I              CNUM                            ZRCNUM                094693
039100200616     I              CCY                             ZRCCY                 094693
039200200616     I              ACOD                            ZRACOD                094693
039300200616     I              ACSQ                            ZRACSQ                094693
039400200616     I              BRCA                            ZRBRCA                094693
039500200616     I              PTFR                            ZRPTFR                094693
039600200616     I*                                                                   094693
039700200616     IACCNTB2F                                                            094693
039800200616     I              CNUM                            ZRCNUM                094693
039900200616     I              CCY                             ZRCCY                 094693
040000200616     I              ACOD                            ZRACOD                094693
040100200616     I              ACSQ                            ZRACSQ                094693
040200200616     I              BRCA                            ZRBRCA                094693
040300200616     I              PTFR                            ZRPTFR                094693
040400200616     I*
040500200616     I**15*A*SETTLEMENT*ACCOUNT*RETURNED****************************      S01496
040600200616     I*                                                                   S01496
040700200616     I** 18 A Settlement Account Returned                                 S01496
040800200616     I            DS                            256
040900200616     I**********                              1   60ZWCNUM                                    CSD027
041000200616     I                                        1   6 ZWCNUM                                    CSD027
041100200616     I                                        7   9 ZWCCY
041200200616     I**********                             10  130ZWACOD                                    CGL029
041300200616     I**********                             14  150ZWACSQ                                    CGL029
041400200616     I                                       10  190ZWACOD                                    CGL029
041500200616     I                                       20  210ZWACSQ                                    CGL029
041600200616     I                                       22  24 ZWBRCA                                    CGL029
041700200616     I                                        1  24 ZKACCN                                    CGL029
041800200616     I****************************************1  15 ZWACCN                S01496
041900200616     I**********                             16  18 ZWBRCA                             S01496 CGL029
042000200616     I***********                             1  18 ZWACCN          S01496094693
042100200616     I**********                              1  18 ZKACCN                             S01496 CGL029
042200200616     I            DS                                                                          234874
042300200616     I                                        1   6 KCCNUM                                    234874
042400200616     I**********                              1   60VCCNUM                            234874 CSD027A
042500200616     I                                        1   6 VCCNUM                                   CSD027A
042600200616     I*
042700200616     I*  DATA STRUCTURE FOR COMPILATION  - COPYRIGHT INSERTION
042800200616     ICPYR@#      DS
042900200616     I                                        1  80 CPY@
043000200616     I                                        1  20 CPY@##
043100200616     I*
043200200616     ILDA         DS                            256
043300200616     I                                      132 183 WWLOT
043400200616     I                                      132 141 WWFILE
043500200616     I                                      142 170 WWKEY
043600200616     I                                      171 180 WWPGM
043700200616     I                                      181 1830WWASE
043800200616     I*
043900200616     I** Account Key Data Structure SR/W101
044000200616     IWACKEY      DS
044100200616     I                                        1   3 WACITY
044200200616     I                                        4   4 WACEVC
044300200616     I                                        5   5 WACTRT
044400200616     I                                        6   6 WACPFI
044500200616     I                                        7   8 WACBKC
044600200616     I                                        9  10 WACTST
044700200616     I                                        9  10 WACPSB
044800200616     I                                       11  12 WACCCC
044900200616     I                                       13  13 WACMKT
045000200616     I                                       14  14 WACCON
045100200616     I                                       15  15 WACNEG
045200200616     I                                       17  18 WARCTR                                    233712
045300200616     I                                       19  20 WACAMC
045400200616     I*
045500200616     I**  USED BY SR. ZA0830 - ARRAY DATA STRUCTURE
045600200616     I***                                     1 150 @CY                   64743
045700200616     I***                                     1  75 @@CY1                 64743
045800200616     I***                                    76 150 @@CY2                 64743
045900200616     I*
046000200616     I*  DS TO DEFINE A WORKING FIELD
046100200616     I*
046200200616     I            DS
046300200616     I**********                              1  12 PSEA1                                     CGL029
046400200616     I                                        1  18 PSEA1                                     CGL029
046500200616     I**********                              1   60CNUM                                      CSD027
046600200616     I                                        1   6 CNUM                                      CSD027
046700200616     I**********                              7  100ACOD                                      CGL029
046800200616     I**********                             11  120ACSQ                                      CGL029
046900200616     I                                        7  160ACOD                                      CGL029
047000200616     I                                       17  180ACSQ                                      CGL029
047100200616     I*
047200200616     I***LZSTAT      DS                            256                    S01496
047300200616     I***********                            24  24 COUR                  S01496
047400200616     I*
047500200616     I/COPY ZSRSRC,ZTNLU1Z1
047600200616     I/COPY ZSRSRC,ZHASHZ2
047700200616     I/COPY ZSRSRC,ZNCDZ2                                                                     234440
047800200616     I***/COPY*ZSRSRC,ZCCAL1Z3                                            S01496
047900200616     I/COPY WNCPYSRC,SE6720I001
048000200616     I*                                                                   CAC003
048100200616     I** External DS for Modules File                                     CAC003
048200200616     ISDMMOD    E DSSDMMODPD                                              CAC003
048300200616     I*
048400200616     ISDBANK    E DSSDBANKPD                                              S01496
048500200616     I**  Data structure for bank details                                 S01496
048600200616     I*                                                                   S01496
048700200616      *                                                                                       233712
048800200616     ISDLOCN    E DSSDLOCNPD                                                                  233712
048900200616      ** Midas SD Location Codes                                                              233712
049000200616      *                                                                                       233712
049100200616     ISDCUST    E DSSDCUSTPD                                                                  233712
049200200616      ** Midas SD Customer Details File                                                       233712
049300200616      *                                                                                       233712
049400200616     ISDBRCH    E DSSDBRCHPD                                                                  233712
049500200616     I              QQDFAC                          ZZDFAC                                    CGL035
049600200616     I** Branch Details                                                                       233712
049700200616     I*                                                                                       233712
049800200616     ISDCTTX    E DSSDCTTXPD                                                                  233712
049900200616      ** Midas SD Country of Tax Codes                                                        233712
050000200616      *                                                                                       233712
050100200616     ISECNTR    E DSSECNTRPD                                                                  234813
050200200616      ** Midas SE Country of Tax Rates                                                        234813
050300200616      *                                                                                       234813
050400200616     ISDSTRD    E DSSDSTRDPD                                              S01496
050500200616     I**  Data structure for securities trading details                   S01496
050600200616     I*                                                                   S01496
050700200616     ISDRETL    E DSSDRETLPD                                              S01496
050800200616     I**  Data structure for retail details                               S01496
050900200616     I*                                                                   S01496
051000200616     ISDGELR    E DSSDGELRPD                                              S01496
051100200616     I              QQACCD                          QQACC1                                    CGL029
051200200616     I**  Data structure for general ledger details                       S01496
051300200616     I*                                                                   S01496
051400200616     ISDSECS    E DSSDSECSPD                                              S01496
051500200616     I              QQACCD                          QQACC2                                    CGL029
051600200616     I**  Data structure for securities customer details                  S01496
051700200616     I*                                                                   S01496
051800200616     ISDPLCS    E DSSDPLCSPD                                              S01496
051900200616     I**  Data structure for portfolio management customer details        S01496
052000200616     I*                                                                   S01496
052100200616     ISCSARD    E DSSCSARDPD                                              S01496
052200200616     I**  Data structure for switchable features file                     S01496
052300200616     I              LCD                             WLLCD                 S01496
052400200616     I*                                                                   S01496
052500200616     ISDCURR    E DSSDCURRPD                                              S01496
052600200616     I**  Data structure for currency details                             S01496
052700200616     I*                                                                   S01496
052800200616     ISDTXPA    E DSSDTXPAPD                                                                BUG22911
052900200616      ** Data structure for Tax Parameter File                                              BUG22911
053000200616      *                                                                                     BUG22911
053100200616     IDSSDY     E DSDSSDY                                                 S01496
053200200616     I**  Long data structure for access objects                          S01496
053300200616     I*                                                                   S01496
053400200616     IDSFDY     E DSDSFDY                                                                     CGL020
053500200616      **  Short data structure for access objects                                             CGL020
053600200616      *                                                                                       CSE028
053700200616      ** DS for customer/book standard settlement instruction                                 CSE028
053800200616      **  to be passed to SESSIR0                                                             CSE028
053900200616      *                                                                                       CSE028
054000200616     IPCBSTD    E DSSTDSED                    2                                               CSE028
054100200616      *                                                                                       CSE028
054200200616      ** Data structure for standard additional settlement details                            CSE028
054300200616      ** for customer/book to be passed to SESSIR0                                            CSE028
054400200616      *                                                                                       CSE028
054500200616     IPCBSAD    E DSSTDADSED                  8                                               CSE028
054600200616      *                                                                                       234440
054700200616     IETCPOS    E DSETCPOSND                                                                  234440
054800200616     I              RECI                            ETRECI                                    234440
054900200616      ** Customer position for EU Savings tax                                                 234440
055000200616      *                                                                                       CSE028
055100200616     I              'ZAAMLSETSE'          C         ZAAMLP                                    CGL020
055200200616      *                                                                                       CGL020
055300200616     I**********                              1   60PCUSTN                             CGL020 CSD027
055400200616     I                                        1   6 PCUSTN                                    CSD027
055500200616      *                                                                                       CGL020
055600200616      * Data structure for AOSVALR0 string                                                    219566
055700200616     I            DS                                                                          219566
055800200616     I                                        1 200 SVAL1                                     219566
055900200616     I                                        1   1 DEF001                                    219566
056000200616      *                                                                                       219566
056100200616      * System Value                                                                          219566
056200200616     I            DS                                                                          219566
056300200616     I I            'UseDefaultSettAccnt '    1  20 SVALK1                                    219566
056400200616      *                                                                                       219566
056401200616     ISDSTAT    E DSSDSTAT                                                                  AR324886
056402200616      ** SD Data area                                                                       AR324886
056403200616      *                                                                                     AR324886
056500200616     I********************************************************************
056600200616      /EJECT
056700200616     C********************************************************************
056800200616     C*================================================================
056900200616     C*  P R O G R A M     S T A R T
057000200616     C*================================================================
057100200616     C********************************************************************
057200200616     C** MAIN PROCESSING
057300200616     C********************************************************************
057400200616     C*
057500200616     C***LZSTAT********************************************************   S01496
057600200616     C*
057700200616     C************NAMVAR   DEFN           LZSTAT                          S01496
057800200616     C***********          IN   LZSTAT                                    S01496
057900200616     C           *ENTRY    PLIST                                          101626
058000200616     C                     PARM           ACRLRN  1                       101626
058100200616     C*
058200200616     C                     EXSR P001
058300200616     C*
058400200616     C                     EXSR P002
058500200616     C*
058600200616     C                     EXSR P003
058700200616     C*
058800200616     ******************************************************************
058900200616      /EJECT
059000200616     ******************************************************************
059100200616     C* P001   : INITIAL PROCESSING                                   *
059200200616     ******************************************************************
059300200616     C*
059400200616     C           P001      BEGSR
059500200616     C*                                                                   S01496
059600200616     C**  Copyright statement                                             S01496
059700200616     C*                                                                   S01496
059800200616     C                     MOVEACPY@      ACT@   80                       S01496
059900200616     C                     MOVE PROT      PROT    1                       S01496
060000200616     C*
060100200616     C** 1. INITIALISE KEY AND WORKING FIELDS
060200200616     C*
060300200616     C                     MOVE *BLANKS   WWLOT
060400200616     C                     MOVEL'SE6720  'DBPGM  10
060500200616     C*
060600200616     C** Saved Security
060700200616     C           *LIKE     DEFN VASESN    #1SESN
060800200616     C** Security Nominal Currecny                                        CEU005
060900200616     C           *LIKE     DEFN NMCY      #1NMCY                          CEU005
061000200616     C           *LIKE     DEFN VLCY      #1VLCY                          160338
061100200616     C** Security Investment Type
061200200616     C           *LIKE     DEFN SITP      #1SITP
061300200616     C** Security Nominal CCY Spot,M/D Ind,Dec.places
061400200616     C           *LIKE     DEFN A6SPRT    WNSPRT
061500200616     C           *LIKE     DEFN A6MDIN    WNMDIN
061600200616     C           *LIKE     DEFN A6NBDP    WNNBDP
061700200616     C** EMU Currency fields                                              CEU005
061800200616     C           *LIKE     DEFN A6EUER    SVEUER                          CEU005
061900200616     C           *LIKE     DEFN A6EUMD    SVEUMD                          CEU005
062000200616     C** Fields for SR/ZEVCD (Event Control Date)
062100200616     C************LIKE     DEFN BKAPDT    APDA                            S01496
062200200616     C************LIKE     DEFN BJDNWD    DNWD                            S01496
062300200616     C*
062301200616     C           *NAMVAR   DEFN           SDSTAT                                            AR324886
062302200616     C                     IN   SDSTAT                                                      AR324886
062400200616     C** EXECUTE INITIAL PROCESSING
062500200616     C                     EXSR FIRST
062600200616     C*
062700200616     C** 4. CALCULATE 'EVENT CONTROL DATE' (ECD)
062800200616     C***********          MOVE BKAPDT    APDA                            S01496
062900200616     C***********          MOVE BJDNWD    DNWD                            S01496
063000200616     C                     MOVE BKAPDT    ZZAPDT                          S01496
063100200616     C                     MOVE BJDNWD    ZZDNWD                          S01496
063200200616     C                     EXSR ZEVCD
063300200616     C** ON ACCRUAL DATE FOLLOWED BY A NON WORKING DAY-                   101626
063400200616     C**     SE6720 IS RUN TWICE:                                         101626
063500200616     C**         - 1ST TIME PROCESSES EVENTS UP TO APDA                   101626
063600200616     C**           (ACRLRN SET ACCORDING TO RUN,IE 3)                     101626
063700200616     C**         - 2ND TIME PROCESSES EVENTS UP TO DNWD                   101626
063800200616     C**           (ACRLRN SET TO 4)                                      101626
063900200616     C** OTHERWISE -                                                      101626
064000200616     C**     SE6720 IS RUN ONCE.PROCESSES EVENTS UP TO DNWD               101626
064100200616     C**               (ACRLRN SET ACCORDING TO RUN,IE 1 OR 2)            101626
064200200616     C           ACRLRN    IFNE '3'                                       101626
064300200616     C                     Z-ADDDNWD      ECD     50                      101626
064400200616     C                     ELSE                                           101626
064500200616     C                     Z-ADDAPDA      ECD                             101626
064600200616     C                     END                                            101626
064700200616     C*
064800200616     C/COPY WNCPYSRC,SE6720C007
064900200616     C           EP001     ENDSR
065000200616     ******************************************************************
065100200616      /EJECT
065200200616     ******************************************************************
065300200616     C* P002   : MAIN PROCESSING                                      *
065400200616     ******************************************************************
065500200616     C*
065600200616     C           P002      BEGSR
065700200616     C*
065800200616     C** Access first record in ER References file
065900200616     C                     READ SEERRFL2                 89
066000200616     C*
066100200616     C** Do While end of file is not reached
066200200616     C           *IN89     DOWEQ'0'
066300200616     C*
066400200616     C** Determine if ER must be processed
066500200616     C                     EXSR P008
066600200616     C*
066700200616     C** If 'Position Settlement Required' and 'Account key Req.'
066800200616     C** Indicators are both equal to 'N', goto next ER
066900200616     C           PSRI      IFEQ 'N'
067000200616     C           AKRI      ANDEQ'N'
067100200616     C                     GOTO P002#1
067200200616     C                     ENDIF
067300200616     C*
067400200616     C** If New Security, access security details
067500200616     C           VASESN    IFNE #1SESN
067600200616     C                     MOVELVASESN    #1SESN
067700200616     C                     EXSR SECTIN
067800200616     C                     ENDIF
067900200616     C*
068000200616     C** Process all Depot Records
068100200616     C                     EXSR P005
068200200616     C*
068300200616     C** Process all Customer records
068400200616     C                     EXSR P006
068500200616     C*
068600200616     C** Update Early Redemption Reference Record
068700200616     C           PSRI      IFEQ 'Y'
068800200616     C                     MOVEL'Y'       VAPOSI
068900200616     C                     ENDIF
069000200616     C*
069100200616     C** If 'Account key Req.' Indicator equal to 'Y'
069200200616     C** and 'Status' is not 'Reverse'
069300200616     C           AKRI      IFEQ 'Y'
069400200616     C           VAERST    ANDNE'R'
069500200616     C           VAEVNI    ANDEQ'Y'                                       092665
069600200616     C                     MOVEL'C'       VAERST
069700200616     C                     ENDIF
069800200616     C*
069900200616     C** If 'Status' is not 'Reverse', Update the Early Redemp. Reference Record
070000200616     C           VAERST    IFNE 'R'
070100200616     C                     UPDATSEERRFD0
070200200616     C                     ENDIF
070300200616     C*
070400200616     C** Access next record
070500200616     C           P002#1    TAG
070600200616     C                     READ SEERRFL2                 89
070700200616     C*
070800200616     C                     ENDDO
070900200616     C*
071000200616     C           EP002     ENDSR
071100200616     ******************************************************************
071200200616      /EJECT
071300200616     ******************************************************************
071400200616     C* P003   : TERMINATION PROCESSING                               *
071500200616     ******************************************************************
071600200616     C*
071700200616     C           P003      BEGSR
071800200616     C*
071900200616     C** PROCESS AUDIT PROCESSING SR/AUDIT
072000200616     C                     EXSR AUDIT
072100200616     C*
072200200616     C** MOVE '1' TO *INLR
072300200616     C                     MOVE '1'       *INLR
072400200616     C*
072500200616     C** RETURN OUT OF THE PROGRAM
072600200616     C                     RETRN
072700200616     C*
072800200616     C           EP003     ENDSR
072900200616     ******************************************************************
073000200616      /EJECT
073100200616     C*****************************************************************
073200200616     C* FIRST - SUBROUTINE TO ACCESS ICD INFORMATION
073300200616     C*****************************************************************
073400200616     C*
073500200616     C           FIRST     BEGSR                           ** FIRST **
073600200616     C*
073700200616     C           *NAMVAR   DEFN           LDA
073800200616     C*
073900200616     C** Access to bank details
074000200616     C************LOVAL    SETLLSDBANKL1                                  S01496
074100200616     C***********          READ SDBANKL1                 89               S01496
074200200616     C*
074300200616     C                     CALL 'AOBANKR0'                                S01496
074400200616     C                     PARM *BLANKS   WLRTCD  7                       S01496
074500200616     C                     PARM '*FIRST'  WLOPTN  7                       S01496
074600200616     C           SDBANK    PARM SDBANK    DSSDY                           S01496
074700200616     C*                                                                   S01496
074800200616     C************IN89     IFEQ '1'                                       S01496
074900200616     C           WLRTCD    IFNE *BLANKS                                   S01496
075000200616     C                     Z-ADD1         DBASE            *****************
075100200616     C***********          MOVEL'SDBANKL1'DBFILE           ** DB ERROR 01 S01496
075200200616     C                     MOVE 'SDBANKPD'DBFILE           * DB ERROR 01 *S01496
075300200616     C                     MOVEL*BLANKS   DBKEY            *****************
075400200616     C                     MOVEL'*FIRST ' DBKEY                           S01496
075500200616     C                     EXSR *PSSR
075600200616     C                     ENDIF
075700200616     C*
075800200616     C** Parameter for ZA0830
075900200616     C***                  MOVE BJLCCY    @@CCY   3                       64743
076000200616     C*
076100200616     C** Access to General Ledger Details
076200200616     C************LOVAL    SETLLSDGELRL1                                  S01496
076300200616     C***********          READ SDGELRL1                 89               S01496
076400200616     C*                                                                   S01496
076500200616     C**********           CALL 'AOGELRR0'                                S01496              CGL029
076600200616     C                     CALL 'AOGELRR1'                                                    CGL029
076700200616     C                     PARM *BLANKS   WLRTCD                          S01496
076800200616     C                     PARM '*FIRST'  WLOPTN                          S01496
076900200616     C           SDGELR    PARM SDGELR    DSSDY                           S01496
077000200616     C*
077100200616     C************IN89     IFEQ '1'                                       S01496
077200200616     C           WLRTCD    IFNE *BLANKS                                   S01496
077300200616     C                     Z-ADD2         DBASE            *****************
077400200616     C***********          MOVEL'SDGELRL1'DBFILE           ** DB ERROR 02 S01496
077500200616     C                     MOVE 'SDGELRPD'DBFILE           * DB ERROR 02 *S01496
077600200616     C                     MOVEL*BLANKS   DBKEY            *****************
077700200616     C                     MOVEL'*FIRST ' DBKEY                           S01496
077800200616     C                     EXSR *PSSR
077900200616     C                     ENDIF
078000200616     C*
078100200616     C** Chain Securities Trading
078200200616     C*
078300200616     C************LOVAL    SETLLSDSTRDL1                                  S01496
078400200616     C***********          READ SDSTRDL1                 89               S01496
078500200616     C*                                                                   S01496
078600200616     C                     CALL 'AOSTRDR0'                                S01496
078700200616     C                     PARM *BLANKS   WLRTCD                          S01496
078800200616     C                     PARM '*FIRST'  WLOPTN                          S01496
078900200616     C           SDSTRD    PARM SDSTRD    DSSDY                           S01496
079000200616     C*
079100200616     C************IN89     IFEQ '1'                        ***************S01496
079200200616     C           WLRTCD    IFNE *BLANKS                    ***************S01496
079300200616     C                     Z-ADD3         DBASE            ** DB ERROR 03 **
079400200616     C***********          MOVEL'SDSTRDL1'DBFILE           ***************S01496
079500200616     C                     MOVE 'SDSTRDPD'DBFILE           ***************S01496
079600200616     C                     MOVEL*BLANK    DBKEY
079700200616     C                     MOVEL'*FIRST ' DBKEY                           S01496
079800200616     C                     EXSR *PSSR
079900200616     C                     ENDIF
080000200616     C*
080100200616     C** Retrieve account code
080200200616     C************LOVAL    SETLLSDRETLL1                                  S01496
080300200616     C***********          READ SDRETLL1                 89               S01496
080400200616     C*                                                                   S01496
080500200616     C                     CALL 'AORETLR0'                                S01496
080600200616     C                     PARM *BLANKS   WLRTCD                          S01496
080700200616     C                     PARM '*FIRST'  WLOPTN                          S01496
080800200616     C           SDRETL    PARM SDRETL    DSSDY                           S01496
080900200616     C*                                                                   S01496
081000200616     C************IN89     IFEQ '1'                        ***************S01496
081100200616     C           WLRTCD    IFNE *BLANKS                    ***************S01496
081200200616     C                     Z-ADD4         DBASE            ** DB ERROR 04 **
081300200616     C***********          MOVEL'SDRETLL1'DBFILE           ***************S01496
081400200616     C                     MOVE 'SDRETLPD'DBFILE           ***************S01496
081500200616     C                     MOVEL*BLANK    DBKEY
081600200616     C                     MOVEL'*FIRST ' DBKEY                           S01496
081700200616     C                     EXSR *PSSR                                     CH0273
081800200616     C                     ELSE
081900200616     C                     MOVE BMACCD    ACOD
082000200616     C                     ENDIF
082100200616     C***********                                                  CH0273 S01496
082200200616     C***RETRIEVE*SWISS*TAX*ICD************************************CH0273 S01496
082300200616     C***********                                                  CH0273 S01496
082400200616     C***********          READ SDSTAXPD                 89        CH0273 S01496
082500200616     C************IN89     IFEQ '1'                                CH0273 S01496
082600200616     C***********          Z-ADD100       DBASE            ********CH0273 S01496
082700200616     C***********          MOVEL'SDSTAXL1'DBFILE           ** DBER CH0273 S01496
082800200616     C***********          MOVEL*BLANKS   DBKEY            ********CH0273 S01496
082900200616     C***********          EXSR *PSSR                              CH0273 S01496
083000200616     C***********          ENDIF                                   CH0273 S01496
083100200616     C***********                                                  CH0273 S01496
083200200616     C***IF*RECORD*FOUND*AND*IF*'CHARGES*CURRENCY'*ISN'T*BLANK*****CH0273 S01496
083300200616     C***********                                                  CH0273 S01496
083400200616     C***********TXCHCY    IFNE *BLANKS                            CH0273 S01496
083500200616     C***********                                                  CH0273 S01496
083600200616     C***GET*SPOT*RATE*AND*MULTIPLY/DIVIDE*INDICATOR***************CH0273 S01496
083700200616     C***********                                                  CH0273 S01496
083800200616     C***********TXCHCY    CHAINSDCURRL1             89            CH0273 S01496
083900200616     C************IN89     IFEQ '1'                                CH0273 S01496
084000200616     C***********          Z-ADD101       DBASE            ********CH0273 S01496
084100200616     C***********          MOVEL'SDCURRL1'DBFILE           ** DBER CH0273 S01496
084200200616     C***********          MOVELTXCHCY    DBKEY            ********CH0273 S01496
084300200616     C***********          EXSR *PSSR                              CH0273 S01496
084400200616     C***********          ENDIF                                   CH0273 S01496
084500200616     C***********                                                  CH0273 S01496
084600200616     C***SAVE*BASE*CURRENCY*SPOT,*M/D*INDICATOR,*DEC.PLACES*FOR*LATCH0273 S01496
084700200616     C***********                                                  CH0273 S01496
084800200616     C***********          Z-ADDA6SPRT    TXSPOT 138               CH0273 S01496
084900200616     C***********          MOVE A6MDIN    TXMDI   10               CH0273 S01496
085000200616     C***********          MOVE A6NBDP    WNNBDP                   CH0273 S01496
085100200616     C***********          END                                     CH0273 S01496
085200200616     C*                                                                   CAC003
085300200616     C** Access MIDAS Modules.                                            CAC003
085400200616     C                     CALL 'AOMMODR0'                                CAC003
085500200616     C                     PARM '*MSG   ' WLRTCD                          CAC003
085600200616     C                     PARM '*FIRST'  WLOPTN                          CAC003
085700200616     C           SDMMOD    PARM SDMMOD    DSSDY                           CAC003
085800200616     C*                                                                   CAC003
085900200616     C           WLRTCD    IFNE *BLANKS                                   CAC003
086000200616     C                     Z-ADD20        DBASE            ***************CAC003
086100200616     C                     MOVEL'SDMMODPD'DBFILE           * DB ERROR 20 *CAC003
086200200616     C                     MOVEL'*FIRST  'DBKEY            ***************CAC003
086300200616     C                     EXSR *PSSR                                     CAC003
086400200616     C                     ENDIF                                          CAC003
086500200616     C*                                                                   CAC003
086600200616     C** Check if SAR CAC003 is installed                                 CAC003
086700200616     C*                                                                   CAC003
086800200616     C                     CALL 'AOSARDR0'                                CAC003
086900200616     C                     PARM *BLANKS   WLRTCD                          CAC003
087000200616     C                     PARM '*VERIFY' WLOPTN                          CAC003
087100200616     C                     PARM 'CAC003'  P@SARD  6                       CAC003
087200200616     C*                                                                   CAC003
087300200616     C** Set on *IN40 if Analytical Accounting Module and                 CAC003
087400200616     C** SAR CAC003 is installed                                          CAC003
087500200616     C           WLRTCD    IFEQ *BLANKS                                   CAC003
087600200616     C           BGN0ST    ANDEQ'Y'                                       CAC003
087700200616     C                     MOVE '1'       *IN40                           CAC003
087800200616     C                     ENDIF                                          CAC003
087900200616     C*
088000200616     C**  Check if feature "Customer Commissions/Courtage" is on          S01496
088100200616     C*                                                                   S01496
088200200616     C                     CALL 'AOSARDR0'                                S01496
088300200616     C                     PARM *BLANKS   WLRTCD                          S01496
088400200616     C                     PARM '*VERIFY' WLOPTN                          S01496
088500200616     C                     PARM 'S01446'  WLSARD  6                       S01496
088600200616     C           SCSARD    PARM SCSARD    DSSDY                           S01496
088700200616     C                     MOVE 'N'       S01446  1                       S01496
088800200616     C*                                                                   S01496
088900200616     C           WLRTCD    IFEQ *BLANKS                                   S01496
089000200616     C                     MOVE 'Y'       S01446                          S01496
089100200616     C                     ELSE                                           S01496
089200200616     C*                                                                   S01496
089300200616     C**  Return code other than *NRF                                     S01496
089400200616     C*                                                                   S01496
089500200616     C           WLRTCD    IFNE '*NRF'                                    S01496
089600200616     C                     Z-ADD15        DBASE            ***************S01496
089700200616     C                     MOVE 'SCSARDPD'DBFILE           * DB ERROR 15 *S01496
089800200616     C                     MOVELWLOPTN    DBKEY            ***************S01496
089900200616     C                     EXSR *PSSR                                     S01496
090000200616     C                     END                                            S01496
090100200616     C                     END                                            S01496
090200200616     C*                                                                   S01496
090300200616     C**  If feature "Customer Commissions/Courtage" is on and            S01496
090400200616     C**  securities charges currency is not blank, access currencies     S01496
090500200616     C**  file to get spot rate, mult/div ind. & no. of decimal places    S01496
090600200616     C*                                                                   S01496
090700200616     C           S01446    IFEQ 'Y'                                       S01496
090800200616     C           BVCHRC    ANDNE*BLANKS                                   S01496
090900200616     C*                                                                   S01496
091000200616     C                     CALL 'AOCURRR0'                                S01496
091100200616     C                     PARM *BLANKS   WLRTCD                          S01496
091200200616     C                     PARM '*KEY  '  WLOPTN                          S01496
091300200616     C                     PARM BVCHRC    WLCYCD                          S01496
091400200616     C           SDCURR    PARM SDCURR    DSSDY                           S01496
091500200616     C*                                                                   S01496
091600200616     C           WLRTCD    IFNE *BLANKS                                   S01496
091700200616     C                     Z-ADD16        DBASE            ***************S01496
091800200616     C                     MOVE 'SDCURRPD'DBFILE           * DB ERROR 16 *S01496
091900200616     C                     MOVELBVCHRC    DBKEY            ***************S01496
092000200616     C                     EXSR *PSSR                                     S01496
092100200616     C                     END                                            S01496
092200200616     C*                                                                   S01496
092300200616     C                     Z-ADDA6SPRT    WLSPRT 138                      S01496
092400200616     C                     Z-ADDA6NBDP    WLNBDP  10                      S01496
092500200616     C                     MOVE A6MDIN    WLMDIN  1                       S01496
092600200616     C*                                                                   S01496
092700200616     C                     END                                            S01496
092800200616     C*                                                                   S01496
092900200616     C**  Check if feature "Jyske Enhancements" is on                     S01496
093000200616     C*                                                                   S01496
093100200616     C                     CALL 'AOSARDR0'                                S01496
093200200616     C                     PARM *BLANKS   WLRTCD                          S01496
093300200616     C                     PARM '*VERIFY' WLOPTN                          S01496
093400200616     C                     PARM 'S01496'  WLSARD                          S01496
093500200616     C           SCSARD    PARM SCSARD    DSSDY                           S01496
093600200616     C                     MOVE 'N'       S01496  1                       S01496
093700200616     C*                                                                   S01496
093800200616     C           WLRTCD    IFEQ *BLANKS                                   S01496
093900200616     C                     MOVE 'Y'       S01496                          S01496
094000200616     C                     ELSE                                           S01496
094100200616     C*                                                                   S01496
094200200616     C**  Return code other than *NRF                                     S01496
094300200616     C*                                                                   S01496
094400200616     C           WLRTCD    IFNE '*NRF'                                    S01496
094500200616     C                     Z-ADD17        DBASE            ***************S01496
094600200616     C                     MOVE 'SCSARDPD'DBFILE           * DB ERROR 17 *S01496
094700200616     C                     MOVELWLOPTN    DBKEY            ***************S01496
094800200616     C                     EXSR *PSSR                                     S01496
094900200616     C                     END                                            S01496
095000200616     C                     END                                            S01496
095100200616     C*                                                                   S01496
095200200616     C**  If S01496 is on and autocharge option (BVACOP) is set to 'Y',   S01496
095300200616     C**  set on *IN55 to indicate that charges by customer group         S01496
095400200616     C**  feature is on                                                   S01496
095500200616     C*                                                                   S01496
095600200616     C           S01496    IFEQ 'Y'                                       S01496
095700200616     C           BVACOP    ANDEQ'Y'                                       S01496
095800200616     C                     MOVE '1'       *IN55                           S01496
095900200616     C                     END                                            S01496
096000200616     C*                                                                   S01496
096100200616     C**  Check if feature "Position Settlements Autocharges" is on       S01496
096200200616     C*                                                                   S01496
096300200616     C                     CALL 'AOSARDR0'                                S01496
096400200616     C                     PARM *BLANKS   WLRTCD                          S01496
096500200616     C                     PARM '*VERIFY' WLOPTN                          S01496
096600200616     C                     PARM 'S01519'  WLSARD                          S01496
096700200616     C           SCSARD    PARM SCSARD    DSSDY                           S01496
096800200616     C                     MOVE 'N'       S01519  1                       S01496
096900200616     C*                                                                   S01496
097000200616     C           WLRTCD    IFEQ *BLANKS                                   S01496
097100200616     C                     MOVE 'Y'       S01519                          S01496
097200200616     C                     ELSE                                           S01496
097300200616     C*                                                                   S01496
097400200616     C**  Return code other than *NRF                                     S01496
097500200616     C*                                                                   S01496
097600200616     C           WLRTCD    IFNE '*NRF'                                    S01496
097700200616     C                     Z-ADD18        DBASE            ***************S01496
097800200616     C                     MOVE 'SCSARDPD'DBFILE           * DB ERROR 18 *S01496
097900200616     C                     MOVELWLOPTN    DBKEY            ***************S01496
098000200616     C                     EXSR *PSSR                                     S01496
098100200616     C                     END                                            S01496
098200200616     C                     END                                            S01496
098300200616     C*                                                                   101626
098400200616     C                     EXSR ZICD2                                     101626
098500200616     C*  ERROR IN ZICD2                                                   101626
098600200616     C*                                                                   101626
098700200616     C           *INU8     IFEQ '1'                        ***************101626
098800200616     C                     Z-ADD12        DBASE            * DB ERROR 12 *101626
098900200616     C                     MOVEL'TABSE'   DBFILE           ***************101626
099000200616     C                     MOVELZTABKY    DBKEY                           101626
099100200616     C                     EXSR *PSSR                                     101626
099200200616     C                     END                                            101626
099300200616     C*                                                                   CEU005
099400200616     C**  Check if feature EMU Settlement Ccy Conversion is on.           CEU005
099500200616     C*                                                                   CEU005
099600200616     C                     CALL 'AOSARDR0'                                CEU005
099700200616     C                     PARM *BLANKS   WLRTCD                          CEU005
099800200616     C                     PARM '*VERIFY' WLOPTN                          CEU005
099900200616     C                     PARM 'CEU005'  WLSARD                          CEU005
100000200616     C           SCSARD    PARM SCSARD    DSSDY                           CEU005
100100200616     C                     MOVE 'N'       CEU005  1                       CEU005
100200200616     C*                                                                   CEU005
100300200616     C           WLRTCD    IFEQ *BLANKS                                   CEU005
100400200616     C                     MOVE 'Y'       CEU005                          CEU005
100500200616     C                     ELSE                                           CEU005
100600200616     C*                                                                   CEU005
100700200616     C**  Return code other than *NRF                                     CEU005
100800200616     C*                                                                   CEU005
100900200616     C           WLRTCD    IFNE '*NRF'                                    CEU005
101000200616     C                     Z-ADD21        DBASE            ***************CEU005
101100200616     C                     MOVE 'SCSARDPD'DBFILE           * DB ERROR 21 *CEU005
101200200616     C                     MOVELWLOPTN    DBKEY            ***************CEU005
101300200616     C                     EXSR *PSSR                                     CEU005
101400200616     C                     END                                            CEU005
101500200616     C                     END                                            CEU005
101600200616      *                                                                                       CSE028
101700200616      ** Check if CSE028 feature is installed                                                 CSE028
101800200616      *                                                                                       CSE028
101900200616     C                     MOVE 'N'       CSE028  1                                           CSE028
102000200616     C                     CALL 'AOSARDR0'                                                    CSE028
102100200616     C                     PARM '       ' WLRTCD                                              CSE028
102200200616     C                     PARM '*VERIFY' WLOPTN                                              CSE028
102300200616     C                     PARM 'CSE028'  WLSARD                                              CSE028
102400200616     C           SCSARD    PARM SCSARD    DSSDY                                               CSE028
102500200616      *                                                                                       CSE028
102600200616     C           WLRTCD    IFNE *BLANKS                                                       CSE028
102700200616     C           WLRTCD    ANDNE'*NRF   '                                                     CSE028
102800200616     C                     Z-ADD46        DBASE                                               CSE028
102900200616     C                     MOVEL'SE6720'  DBPGM                                               CSE028
103000200616     C                     MOVEL'SCSARDPD'DBFILE                                              CSE028
103100200616     C                     MOVELWLSARD    DBKEY                                               CSE028
103200200616     C                     EXSR *PSSR                                                         CSE028
103300200616     C                     ENDIF                                                              CSE028
103400200616      *                                                                                       CSE028
103500200616     C           WLRTCD    IFEQ *BLANK                                                        CSE028
103600200616     C                     MOVE 'Y'       CSE028                                              CSE028
103700200616     C                     ENDIF                                                              CSE028
103800200616      *                                                                                       233712
103900200616      ** Check if CGL031 - Taxation of Savings Income                                         233712
104000200616      **   is switched on.                                                                    233712
104100200616      *                                                                                       233712
104200200616     C                     CALL 'AOSARDR0'                                                    233712
104300200616     C                     PARM *BLANKS   P@RTCD  7                                           233712
104400200616     C                     PARM '*VERIFY' P@OPTN  7                                           233712
104500200616     C                     PARM 'CGL031'  P@SARD  6                                           233712
104600200616      *                                                                                       233712
104700200616     C           P@RTCD    IFEQ *BLANK                                                        233712
104800200616     C                     MOVE 'Y'       CGL031  1                                           233712
104900200616     C                     ELSE                                                               233712
105000200616     C                     MOVE 'N'       CGL031                                              233712
105100200616     C                     ENDIF                                                              233712
105200200616      * Set up the pgm name                                                                   234440
105300200616      *                                                                                       234440
105400200616     C                     MOVEL'SEETCPRT'WPGM    9                                           234440
105500200616     C                     MOVE 'V'       WPGM                                                234440
105600200616      *                                                                   094693
105700200616      ** Determine if Midas Compliance Watch is installed                                     CGL020
105800200616      *                                                                                       CGL020
105900200616     C                     MOVE 'N'       CGL020  1                                           CGL020
106000200616     C                     CALL 'AOSARDR0'                                                    CGL020
106100200616     C                     PARM '      '  WLRTCD                                              CGL020
106200200616     C                     PARM '*VERIFY' WLOPTN                                              CGL020
106300200616     C                     PARM 'CGL020'  WLSARD                                              CGL020
106400200616     C           SCSARD    PARM SCSARD    DSFDY                                               CGL020
106500200616      *                                                                                       CGL020
106600200616     C           WLRTCD    IFNE *BLANK                                                        CGL020
106700200616     C           WLRTCD    ANDNE'*NRF   '                                                     CGL020
106800200616     C           *LOCK     IN   LDA                                                           CGL020
106900200616     C                     MOVEL'SCSARDPD'DBFILE                                              CGL020
107000200616     C                     Z-ADD22        DBASE                                               CGL020
107100200616     C                     MOVELWLSARD    DBKEY                                               CGL020
107200200616     C                     EXSR *PSSR                                                         CGL020
107300200616      *                                                                                       CGL020
107400200616     C                     ELSE                                                               CGL020
107500200616     C                     MOVE 'Y'       CGL020                                              CGL020
107600200616     C                     ENDIF                                                              CGL020
107700200616      *                                                                                       CGL020
107800200616      *                                                                                       219566
107900200616      **  Access SDSAVLPD for Default settlement account to portfolio 001 indicator (Y/N)     219566
108000200616     C                     CALL 'AOSVALR0'                                                    219566
108100200616     C                     PARM *BLANKS   RTNCDE  7                                           219566
108200200616     C                     PARM           SVALK1 20                                           219566
108300200616     C                     PARM           SVAL1 200                                           219566
108400200616     C                     PARM           SVALK2 20                                           219566
108500200616     C                     PARM           SVAL2 200                                           219566
108600200616     C                     PARM           SVALK3 20                                           219566
108700200616     C                     PARM           SVAL3 200                                           219566
108800200616     C                     PARM           SVALK4 20                                           219566
108900200616     C                     PARM           SVAL4 200                                           219566
109000200616     C                     PARM           SVALK5 20                                           219566
109100200616     C                     PARM           SVAL5 200                                           219566
109200200616     C                     PARM           SVALK6 20                                           219566
109300200616     C                     PARM           SVAL6 200                                           219566
109400200616     C                     PARM           SVALK7 20                                           219566
109500200616     C                     PARM           SVAL7 200                                           219566
109600200616     C                     PARM           SVALK8 20                                           219566
109700200616     C                     PARM           SVAL8 200                                           219566
109800200616     C                     PARM           SVALK9 20                                           219566
109900200616     C                     PARM           SVAL9 200                                           219566
110000200616     C                     PARM           SVALK0 20                                           219566
110100200616     C                     PARM           SVAL10200                                           219566
110200200616      *                                                                                       219566
110300200616     C           RTNCDE    IFNE *BLANKS                                                       219566
110400200616     C                     MOVE SVALK1    DBKEY            * DB ERROR 50 *                    219566
110500200616     C                     Z-ADD50        DBASE                                               219566
110600200616     C                     MOVE 'SDSVALPD'DBFILE                                              219566
110700200616     C                     MOVEL'SE6720'  DBPGM                                               219566
110800200616     C                     EXSR *PSSR                                                         219566
110900200616     C                     ENDIF                                                              219566
111000200616      *                                                                                       219566
111100200616     C** Klist for ACCNT                                                  094693
111200200616     C*                                                                   094693
111300200616     C           ZWACCN    KLIST                                          094693
111400200616     C                     KFLD           ZWCNUM                          094693
111500200616     C                     KFLD           ZWCCY                           094693
111600200616     C                     KFLD           ZWACOD                          094693
111700200616     C                     KFLD           ZWACSQ                          094693
111800200616     C                     KFLD           ZWBRCA                          094693
111900200616     C*                                                                   S01496
112000200616      ** Get Tax Calculation Method - LF/SDTXCML1 (PF/SDTXCMPD)                               233712
112100200616      *                                                                                       233712
112200200616     C           KTXCM     KLIST                                                              233712
112300200616     C                     KFLD           KCSIS   2                                           233712
112400200616     C                     KFLD           KCTRT   2                                           233712
112500200616     C*                                                                                       233712
112600200616      ** Customer Current position                                                            233712
112700200616      *                                                                                       233712
112800200616     C           CPKEY     KLIST                                                              233712
112900200616     C                     KFLD           VCBRCD                                              233712
113000200616     C                     KFLD           VCCNUM                                              233712
113100200616     C                     KFLD           VCSESN                                              233712
113200200616      *                                                                                       233712
113300200616     C/COPY WNCPYSRC,SE6720C001
113400200616     C                     ENDSR
113500200616     C*
113600200616     C*****************************************************************
113700200616      /EJECT
113800200616     ******************************************************************
113900200616     C* P005   : PROCESS ALL DEPOT RECORDS IN LF/SEERDPL0             *
114000200616     ******************************************************************
114100200616     C*
114200200616     C           P005      BEGSR
114300200616     C*
114400200616     C** Access first depot record for current ER Reference
114500200616     C           VAERRF    SETLLSEERDPL0
114600200616     C                     READ SEERDPL0                 89
114700200616     C*
114800200616     C           *IN89     DOWEQ'0'
114900200616     C           VAERRF    ANDEQVBERRF
115000200616     C*
115100200616     C** If 'Record Identifier' is 'D' and
115200200616     C** if 'Nominal to be Redeemed' is not zero
115300200616     C           VBRECI    IFEQ 'D'
115400200616     C           VBNRDM    ANDNE0
115500200616     C*
115600200616     C** Calculate Nominal
115700200616     C                     Z-ADDVBNRDM    ZNOML
115800200616     C                     Z-ADDVAREDP    ZAVPR
115900200616     C                     EXSR ZAPNUM
116000200616     C                     Z-ADDZVALU     EVAM
116100200616     C*
116200200616     C** Retrieve Settlement instructions (Needed both in W102 and
116300200616     C** in W101)
116400200616     C                     EXSR P007
116500200616     C*
116600200616     C** If Position Settlement Required
116700200616     C           PSRI      IFEQ 'Y'
116800200616     C*
116900200616     C** 'Event Type' (PEVT)
117000200616     C                     MOVEL'RC'      PEVT
117100200616     C*
117200200616     C** 'Pay Receive' (PPRE)
117300200616     C                     MOVEL'R'       PPRE
117400200616     C*
117500200616     C** Write Position Settlement Record
117600200616     C                     EXSR W102
117700200616     C*
117800200616     C***Write*Position*Settlement*Extended*Record*********************   S01496
117900200616     C***********          EXSR P102                                      S01496
118000200616     C/COPY WNCPYSRC,SE6720C008
118100200616     C*
118200200616     C** Save 'TRANSACTION NUMBER OF THE LAST UPDATE' (TNL1)
118300200616     C** into 'POSITION SETTLEMENT TNL1' of LF/SEERDPL0
118400200616     C***********          Z-ADDTNL1      VBTNL1                          S01496
118500200616     C                     Z-ADDTNLU      VBTNL1                          S01496
118600200616     C*
118700200616     C** Update Early Redemption Depot record on LF/SEERDPL0
118800200616     C                     UPDATSEERDPD0
118900200616     C*
119000200616     C                     ENDIF
119100200616     C*
119200200616     C** If Account key Required
119300200616     C           AKRI      IFEQ 'Y'
119400200616     C*
119500200616     C** Write an Account Key Record
119600200616     C                     EXSR W101
119700200616     C*
119800200616     C                     ENDIF
119900200616     C*
120000200616     C                     ENDIF
120100200616     C*
120200200616     C** Access next Record
120300200616     C                     READ SEERDPL0                 89
120400200616     C*
120500200616     C                     ENDDO
120600200616     C*
120700200616     C           EP005     ENDSR
120800200616     C*
120900200616     ******************************************************************
121000200616      /EJECT
121100200616     ******************************************************************
121200200616     C* P006   : PROCESS ALL ALLOCATION RECORDS IN LF/SEERALL0        *
121300200616     ******************************************************************
121400200616     C*
121500200616     C           P006      BEGSR
121600200616     C*
121700200616     C** Access first Allocation record for current ER Reference
121800200616     C           VAERRF    SETLLSEERALL0
121900200616     C                     READ SEERALL0                 89
122000200616     C*
122100200616     C           *IN89     DOWEQ'0'
122200200616     C           VAERRF    ANDEQVCERRF
122300200616     C*
122400200616     C** If 'Record Identifier' is 'D', 'Er Type' is 'P' (Cust. Allocation Rec.)
122500200616     C** and if 'Nominal to be Redeemed' is not zero
122600200616     C** OR 'Status' is 'Reversed', 'Er Type' is 'P' (Cust. Allocation Rec.)
122700200616     C** and if 'Position Settlement TNL1' is not zero
122800200616     C           VCRECI    IFEQ 'D'
122900200616     C           VCERTP    ANDEQ'P'
123000200616     C           VCNOMA    ANDNE0
123100200616     C           VAERST    OREQ 'R'
123200200616     C           VCERTP    ANDEQ'P'
123300200616     C           VCTNL1    ANDNE*ZEROS
123400200616     C*
123500200616     C** Calculate Nominal
123600200616     C           VCNOMA    IFLT *ZEROS
123700200616     C           *ZERO     SUB  VCNOMA    ZNOML
123800200616     C                     ELSE
123900200616     C                     Z-ADDVCNOMA    ZNOML
124000200616     C                     ENDIF
124100200616     C                     Z-ADDVAREDP    ZAVPR
124200200616     C                     EXSR ZAPNUM
124300200616     C                     Z-ADDZVALU     EVAM
124400200616     C                     Z-ADDZVALU     WNOMAT 150                                          233712
124500200616     C*
124600200616     C** Retrieve Settlement instructions (Needed both for W202 and W201
124700200616     C                     EXSR P009
124800200616     C*                                                                   CAC003
124900200616     C** Declare KLIST for SEPCCD if Analytical Module and                CAC003
125000200616     C** SAR CAC003 is installed.                                         CAC003
125100200616     C           *IN40     IFEQ '1'                                       CAC003
125200200616     C*                                                                   CAC003
125300200616     C           KLPCCD    KLIST                                          CAC003
125400200616     C                     KFLD           VCCNUM                          CAC003
125500200616     C                     KFLD           VCBRCD                          CAC003
125600200616     C                     KFLD           VASESN                          CAC003
125700200616     C*                                                                   CAC003
125800200616     C** Access PF/SEPCCD using KLIST KLPCCD                              CAC003
125900200616     C                     MOVE 'N'       FIND    1                       CAC003
126000200616     C           KLPCCD    CHAINSEPCCD               60                   CAC003
126100200616     C           *IN60     IFEQ '0'                                       CAC003
126200200616     C                     MOVE 'Y'       FIND                            CAC003
126300200616     C                     ELSE                                           150158
126400200616     C                     MOVE BVSEPC    PCCU                            150158
126500200616     C                     MOVE 'Y'       FIND                            150158
126600200616     C                     ENDIF                                          CAC003
126700200616     C*                                                                   CAC003
126800200616     C                     ENDIF                                          CAC003
126900200616     C*
127000200616     C** Position Settlement required
127100200616     C           PSRI      IFEQ 'Y'
127200200616     C*
127300200616     C** Event Type
127400200616     C                     MOVEL'RC'      PEVT
127500200616     C*
127600200616     C** Pay Receive Indicator (depending on nominal sign)
127700200616     C           VCNOMA    IFGT 0
127800200616     C                     MOVEL'P'       PPRE
127900200616     C                     ELSE
128000200616     C                     MOVEL'R'       PPRE
128100200616     C                     ENDIF
128200200616     C*                                                                                       233712
128300200616     C** Check if tax needed to be calucated                                                  233712
128400200616     C*                                                                                       233712
128500200616     C           CGL031    IFEQ 'Y'                                                           233712
128600200616     C           SETX      ANDEQ'Y'                                                           233712
128700200616     C                     EXSR ERTAX                                                         233712
128800200616     C                     END                                                                233712
128900200616     C*
129000200616     C** Write Position Settlement Record
129100200616     C                     EXSR W202
129200200616     C*
129300200616     C***Write*Position*Settlement*Extended*Record*********************   S01496
129400200616     C***********          EXSR P202                                      S01496
129500200616     C/COPY WNCPYSRC,SE6720C009
129600200616     C*
129700200616     C** Transaction Number of Last Update into TNL1,SEERALL0
129800200616     C***********          Z-ADDTNL1      VCTNL1                          S01496
129900200616     C                     Z-ADDTNLU      VCTNL1                          S01496
130000200616     C*
130100200616     C** Update Early Redemption Record
130200200616     C                     UPDATSEERALD0
130300200616     C*
130400200616     C                     ENDIF
130500200616     C*
130600200616     C** Account Key required
130700200616     C           AKRI      IFEQ 'Y'
130800200616     C*
130900200616     C** Write an Account Key Record
131000200616     C                     EXSR W201
131100200616     C*
131200200616     C                     ENDIF
131300200616     C*
131400200616     C                     ENDIF
131500200616     C*
131600200616     C** Access next Record
131700200616     C                     READ SEERALL0                 89
131800200616     C*
131900200616     C                     ENDDO
132000200616     C*
132100200616     C           EP006     ENDSR
132200200616     C*
132300200616     ******************************************************************
132400200616      /EJECT
132500200616     ******************************************************************
132600200616     C* P007   : RETRIEVE SETTLEMENT INSTRUCTIONS FOR DEPOTS          *
132700200616     ******************************************************************
132800200616     C*
132900200616     C           P007      BEGSR
133000200616     C*
133100200616     C** Settlement Method
133200200616     C                     Z-ADD0         WPSMT   20
133300200616     C** Settlement Account
133400200616     C**********           MOVEL*BLANKS   WPSEA  12                                           CGL029
133500200616     C                     MOVE *BLANKS   WPSEA  18                                           CGL029
133600200616     C** Settlement Branch
133700200616     C                     MOVEL*BLANKS   WPSEB   3
133800200616     C** Counterparty Bank
133900200616     C                     MOVEL*BLANKS   WPCPN   8
134000200616     C** For Account Of
134100200616     C                     MOVEL*BLANKS   WPFAC   8
134200200616     C** Special Instructions
134300200616     C                     MOVEL*BLANKS   WPSPI  35
134400200616      *                                                                                       CSE028
134500200616      ** If CSE028 is on, call SESSIR0 for default of MT5xx information                       CSE028
134600200616      *                                                                                       CSE028
134700200616     C           CSE028    IFEQ 'Y'                                                           CSE028
134800200616      *                                                                                       CSE028
134900200616     C                     MOVE '0'       *IN89                                               CSE028
135000200616      *                                                                                       CSE028
135100200616     C                     CALL 'SESSIR0'                                                     CSE028
135200200616     C                     PARM 'D'       POTYP   1                                           CSE028
135300200616     C                     PARM           VBBRCD                                              CSE028
135400200616     C                     PARM           VBDDPT                                              CSE028
135500200616     C                     PARM *BLANKS   KBKCD                                               CSE028
135600200616     C                     PARM           NMCY                                                CSE028
135700200616     C                     PARM           SMCC                                                CSE034
135800200616     C                     PARM           SITP                                                CSE028
135900200616     C                     PARM *BLANKS   KPTFR                                               CSE028
136000200616     C                     PARM           PCBSTD                                              CSE028
136100200616     C                     PARM           PCBSAD                                              CSE028
136200200616     C                     PARM *BLANKS   PRTCD   5                                           CSE028
136300200616      *                                                                                       CSE028
136400200616     C           PRTCD     IFNE '*NCRF'                                                       CSE028
136500200616     C           PRTCD     ANDNE'*NRF '                                                       CSE028
136600200616     C           2         OCUR PCBSTD                                                        CSE028
136700200616     C                     ELSE                                                               CSE028
136800200616     C                     MOVE '1'       *IN89                                               CSE028
136900200616     C                     ENDIF                                                              CSE028
137000200616      *                                                                                       CSE028
137100200616     C                     ELSE                                                               CSE028
137200200616      *                                                                                       CSE028
137300200616     C                     MOVE *BLANKS   KBKCD   2                                           CSE028
137400200616     C                     MOVE *BLANKS   KPTFR   4                                           CSE028
137500200616     C*
137600200616     C** For Settlement Instruction access STDSED with key of
137700200616     C** Branch and Customer,SEERDPPD, Nominal CCY and Investment
137800200616     C** Type,SECTYD
137900200616     C           KEY102    KLIST
138000200616     C                     KFLD           VBBRCD
138100200616     C                     KFLD           VBDDPT
138200200616     C                     KFLD           KBKCD                                               CSE028
138300200616     C*********************KFLD           NMCY                            CEU005
138400200616     C                     KFLD           #1NMCY                          CEU005
138500200616     C                     KFLD           #1SITP
138600200616     C                     KFLD           KPTFR                                               CSE028
138700200616     C                     MOVELNMCY      #1NMCY                          CEU005
138800200616     C                     MOVELSITP      #1SITP
138900200616     C                     MOVELNMCY      PSCU                            160338
139000200616     C                     Z-ADD1         PSXR                            160338
139100200616     C                     MOVEL'M'       PMDI                            160338
139200200616     C           KEY102    CHAINSTDSED               89
139300200616     C           *IN89     IFEQ '1'
139400200616     C                     MOVEL*BLANKS   #1SITP
139500200616     C           KEY102    CHAINSTDSED               89
139600200616     C                     ENDIF
139700200616      *                                                                                       CSE028
139800200616     C                     ENDIF                                                              CSE028
139900200616      *                                                                                       CSE028
140000200616     C           *IN89     IFEQ '0'
140100200616      *                                                                   CEU005
140200200616      * CEU005 active and Settlement Ccy used on STDSED.                  CEU005
140300200616     C           CEU005    IFEQ 'Y'                                       CEU005
140400200616     C           SCCY      ANDNE*BLANKS                                   CEU005
140500200616     C***********          MOVE SCCY      SVSCCY  3                CEU005 160338
140600200616      *                                                                   CEU005
140700200616      * Access currencies file for EURO rate, EURO M/D indicator and      CEU005
140800200616      * Transition Date for 'In' Ccy.                                     CEU005
140900200616      *                                                                   CEU005
141000200616     C           NMCY      IFEQ BKEURO                                    CEU005
141100200616     C                     CALL 'AOCURRR0'                                CEU005
141200200616     C                     PARM           @RTCD   7                       CEU005
141300200616     C                     PARM '*KEY   ' @OPTN   7                       CEU005
141400200616     C                     PARM SCCY      @AJCD   3                       CEU005
141500200616     C           SDCURR    PARM SDCURR    DSSDY                           CEU005
141600200616     C           @RTCD     IFNE *BLANKS                                   CEU005
141700200616     C                     Z-ADD44        DBASE             ************  CEU005
141800200616     C                     MOVEL'SDCURRPD'DBFILE            * DATABASE *  CEU005
141900200616     C                     MOVELSCCY      DBKEY             * ERROR 44 *  CEU005
142000200616     C                     EXSR *PSSR                       ************  CEU005
142100200616     C                     ENDIF                                          CEU005
142200200616     C                     ELSE                                           CEU005
142300200616     C           SCCY      IFEQ BKEURO                                    CEU005
142400200616     C                     CALL 'AOCURRR0'                                CEU005
142500200616     C                     PARM           @RTCD   7                       CEU005
142600200616     C                     PARM '*KEY   ' @OPTN   7                       CEU005
142700200616     C                     PARM NMCY      @AJCD   3                       CEU005
142800200616     C           SDCURR    PARM SDCURR    DSSDY                           CEU005
142900200616     C           @RTCD     IFNE *BLANKS                                   CEU005
143000200616     C                     Z-ADD45        DBASE             ************  CEU005
143100200616     C                     MOVEL'SDCURRPD'DBFILE            * DATABASE *  CEU005
143200200616     C                     MOVELNMCY      DBKEY             * ERROR 45 *  CEU005
143300200616     C                     EXSR *PSSR                       ************  CEU005
143400200616     C                     ENDIF                                          CEU005
143500200616     C                     ENDIF                                          CEU005
143600200616     C                     ENDIF                                          CEU005
143700200616      *                                                                   CEU005
143800200616     C***********          MOVE A6EUMD    SVEUMD                   CEU005 160338
143900200616     C***********          MOVE A6EUER    SVEUER                   CEU005 160338
144000200616      *                                                                   CEU005
144100200616      * Value date is later than Transition Start Date.                   CEU005
144200200616     C           VAERPD    IFGE A6TPSD                                    CEU005
144300200616     C           A6INCY    ANDEQ'Y'                                       160338
144400200616     C                     Z-ADDA6EUER    PSXR                            160338
144500200616     C*                                                                   160338
144600200616     C** Nominal currency is Euro currency, reverse M/D indicator.        160338
144700200616     C*                                                                   160338
144800200616     C           NMCY      IFEQ BKEURO                                    160338
144900200616     C           A6EUMD    IFEQ 'M'                                       160338
145000200616     C                     MOVE 'D'       PMDI                            160338
145100200616     C                     ELSE                                           160338
145200200616     C                     MOVE 'M'       PMDI                            160338
145300200616     C                     ENDIF                                          160338
145400200616     C*                                                                   160338
145500200616     C** Settlement currency is Euro currency, use Euro M/D indicator.    160338
145600200616     C*                                                                   160338
145700200616     C                     ELSE                                           160338
145800200616     C                     MOVE A6EUMD    PMDI                            160338
145900200616     C                     ENDIF                                          160338
146000200616     C                     MOVE SCCY      PSCU                            160338
146100200616      *                                                                                       CSE028
146200200616      ** If CSE028 is on, call SESSIR0 for default of MT5xx information                       CSE028
146300200616      *                                                                                       CSE028
146400200616     C           CSE028    IFEQ 'Y'                                                           CSE028
146500200616      *                                                                                       CSE028
146600200616     C                     MOVE '0'       *IN78                                               CSE028
146700200616      *                                                                                       CSE028
146800200616     C                     CALL 'SESSIR0'                                                     CSE028
146900200616     C                     PARM 'D'       POTYP                                               CSE028
147000200616     C                     PARM           VBBRCD                                              CSE028
147100200616     C                     PARM           VBDDPT                                              CSE028
147200200616     C                     PARM *BLANKS   KBKCD                                               CSE028
147300200616     C                     PARM           SCCY                                                CSE028
147400200616     C                     PARM           SMCC                                                CSE034
147500200616     C                     PARM           SITP                                                CSE028
147600200616     C                     PARM *BLANKS   KPTFR                                               CSE028
147700200616     C                     PARM           PCBSTD                                              CSE028
147800200616     C                     PARM           PCBSAD                                              CSE028
147900200616     C                     PARM *BLANKS   PRTCD                                               CSE028
148000200616      *                                                                                       CSE028
148100200616     C           PRTCD     IFNE '*NCRF'                                                       CSE028
148200200616     C           PRTCD     ANDNE'*NRF '                                                       CSE028
148300200616     C           2         OCUR PCBSTD                                                        CSE028
148400200616     C                     ELSE                                                               CSE028
148500200616     C                     MOVE '1'       *IN78                                               CSE028
148600200616     C                     ENDIF                                                              CSE028
148700200616      *                                                                                       CSE028
148800200616     C                     ELSE                                                               CSE028
148900200616      * Chain STDSED again.                                               CEU005
149000200616     C                     MOVE SCCY      #1NMCY                          CEU005
149100200616     C           KEY102    CHAINSTDSED               78                   CEU005
149200200616      *                                                                                       CSE028
149300200616     C                     ENDIF                                                              CSE028
149400200616      *                                                                                       CSE028
149500200616     C***********          ENDIF                                   CEU005 160338
149600200616     C***********          ENDIF                                   CEU005 160338
149700200616      *                                                                   CEU005
149800200616      * If no record found ensure fields from last chain not loaded       CEU005
149900200616      * to output fields.                                                 CEU005
150000200616     C           *IN78     IFEQ '0'                                       CEU005
150100200616     C** Settlement Method
150200200616     C                     Z-ADDSRSM      WPSMT
150300200616     C** Settlement Account
150400200616     C                     MOVELSRAC      WPSEA
150500200616     C** Settlement Branch
150600200616     C***********          MOVELSRBR      WPSEB                           S01496
150700200616     C                     MOVELSRAB      WPSEB                           S01496
150800200616     C** Counterparty Bank
150900200616     C                     MOVELSRCB      WPCPN
151000200616     C** IF SRSM = 04 AND SRAC = BLANKS THE DETERMINE SETTLEMENT A/C
151100200616     C**    VIA SR/ZSETAC  AND OUTPUT TO FIELD PSEA
151200200616     C           SRSM      IFEQ 04
151300200616     C           SRAC      ANDEQ*BLANK
151400200616     C*
151500200616     C** PASS PARAMETERS TO SR/ZSETAC AND EXECUTE ROUTINE
151600200616     C                     MOVE SRSM      ZMETH
151700200616     C                     MOVE SRAC      ZSETI
151800200616     C                     MOVE VBDDPT    ZCNUM
151900200616     C                     MOVE NMCY      ZCCY
152000200616     C                     MOVE SRAB      ZBRCA                           085862
152100200616     C                     EXSR ZSETAC
152200200616     C                     MOVELZSETO     WPSEA
152300200616     C                     MOVELZWBRCA    WPSEB                           S01496
152400200616     C*
152500200616     C                     ENDIF
152600200616     C                     ENDIF
152700200616     C                     ENDIF                                          CEU005
152800200616     C                     ELSE                                           160338
152900200616     C*                                                                   160338
153000200616     C** Settlement method                                                160338
153100200616     C*                                                                   160338
153200200616     C                     Z-ADDSRSM      WPSMT                           160338
153300200616     C*                                                                   160338
153400200616     C** Settlement account                                               160338
153500200616     C*                                                                   160338
153600200616     C                     MOVELSRAC      WPSEA                           160338
153700200616     C*                                                                   160338
153800200616     C** Settlement branch                                                160338
153900200616     C*                                                                   160338
154000200616     C                     MOVELSRAB      WPSEB                           160338
154100200616     C*                                                                   160338
154200200616     C** Counterparty bank                                                160338
154300200616     C*                                                                   160338
154400200616     C                     MOVELSRCB      WPCPN                           160338
154500200616     C*                                                                   160338
154600200616     C** If SRSM = 04 and SRAC = Blanks then determine settlement a/c     160338
154700200616     C** via SR/ZSETAC and output to field PSEA                           160338
154800200616     C*                                                                   160338
154900200616     C           SRSM      IFEQ 04                                        160338
155000200616     C           SRAC      ANDEQ*BLANK                                    160338
155100200616     C*                                                                   160338
155200200616     C** Pass parameters to SR/ZSETAC and execute routine                 160338
155300200616     C*                                                                   160338
155400200616     C                     MOVE SRSM      ZMETH                           160338
155500200616     C                     MOVE SRAC      ZSETI                           160338
155600200616     C                     MOVE VBDDPT    ZCNUM                           160338
155700200616     C                     MOVE NMCY      ZCCY                            160338
155800200616     C                     MOVE SRAB      ZBRCA                           160338
155900200616     C                     EXSR ZSETAC                                    160338
156000200616     C                     MOVELZSETO     WPSEA                           160338
156100200616     C                     MOVELZWBRCA    WPSEB                           160338
156200200616     C                     ENDIF                                          160338
156300200616     C                     ENDIF                                          160338
156400200616     C                     ENDIF                                          160338
156500200616     C*
156600200616     C           EP007     ENDSR
156700200616     C*
156800200616     ******************************************************************
156900200616      /EJECT
157000200616     ******************************************************************
157100200616     C* P008   : DETERMINE IF EARLY REDEMPTION MUST BE PROCESSED      *
157200200616     ******************************************************************
157300200616     C*
157400200616     C           P008      BEGSR
157500200616     C*
157600200616     C                     MOVE 'N'       AKRI    1
157700200616     C                     MOVE 'N'       PSRI    1
157800200616     C*
157900200616     C** If 'Status' is not 'Reverse'
158000200616     C           VAERST    IFNE 'R'
158100200616     C*
158200200616     C** If Redemption Date *LE Events control date
158300200616     C           VAERRD    IFLE ECD
158400200616     C           VAPOSI    ANDEQ'N'                                      092665
158500200616     C                     MOVE 'Y'       AKRI
158600200616     C           VAPOSI    IFNE 'Y'
158700200616     C                     MOVE 'Y'       PSRI
158800200616     C                     ENDIF
158900200616     C                     ENDIF
159000200616     C*
159100200616     C***If*Position*Settlement*Required**NE*'Y',***                      64743
159200200616     C***and*if*there*are*not*yet*generated****                           64743
159300200616     C***        PSRI      IFNE 'Y'                                       64743
159400200616     C***        VAPOSI    ANDNE'Y'                                       64743
159500200616     C*                                                                   64743
159600200616     C***Calculate*last*Working*day*before*Redemption***                  64743
159700200616     C***                  EXSR P801                                      64743
159800200616     C*                                                                   64743
159900200616     C***If*'Last*Working*day*before*Redemption'*is*lower*than*or*equal*to64743
160000200616     C***'Date*of*next*Working*day'***                                    64743
160100200616     C***        WWERRD    IFLE BJDNWD                                    64743
160200200616     C***                  MOVEL'Y'       PSRI                            64743
160300200616     C***                  ENDIF                                          64743
160400200616     C***                  ENDIF                                          64743
160500200616     C*
160600200616     C** If 'Status' is 'Reverse'
160700200616     C                     ELSE
160800200616     C*
160900200616     C** If 'Last Change Date' is the 'Run Date' (= Reversed Today)
161000200616     C           VALCD     IFEQ BJRDNB
161100200616     C*
161200200616     C** If 'Trade/Depot Movmnt event Indicator' is equal to 'Y'
161300200616     C** (= was Completed before Reversing)
161400200616     C           VAEVNI    IFEQ 'Y'
161500200616     C                     MOVE 'Y'       AKRI
161600200616     C                     ENDIF
161700200616     C                     ENDIF
161800200616     C*
161900200616     C                     MOVEL'N'       PSRI
162000200616     C                     ENDIF
162100200616     C*
162200200616     C           EP008     ENDSR
162300200616     C*
162400200616     ******************************************************************
162500200616      /EJECT
162600200616     ******************************************************************
162700200616     C* P801   : CALCULATE LAST WORKING DAY BEFORE REDEMPTION         *
162800200616     ******************************************************************
162900200616     C*
163000200616     C***        P801      BEGSR                                          64743
163100200616     C*                                                                   64743
163200200616     C** POSITION SETTLEMENT MUST BE GENERATED ONE WORKING DAY BEFORE     64743
163300200616     C** REDEMPTION. IT IS TO ALLOW USER TO CHANGE/AMEND THEM BEFORE      64743
163400200616     C** A/C KEYS GENERATION.                                             64743
163500200616     C** THE NORMAL WAY IS TO GENERATE THEM WHEN REDEMPTION DATE IS       64743
163600200616     C** LOWER THAN NEXT WORKING DAY. BUT IF REDEMPTION DATE IS           64743
163700200616     C** (P.E. SUNDAY),THERE ARE GENERATED FRIDAY COB AND IT IS           64743
163800200616     C** TO LATE |                                                        64743
163900200616     C** SOLUTION IS TO COMPARE 'LAST WORKING DAY BEFORE REDEMPTION'      64743
164000200616     C** AND 'NEXT WORKING DAY'                                           64743
164100200616     C** 1 Z-ADD REDEMPTION DATE INTO A WORKING FIELD WWERRD (5,0)        64743
164200200616     C**   ('LAST WORKING DAY BEFORE REDEMPTION')                         64743
164300200616     C***                  Z-ADDVAERRD    WWERRD  50                      64743
164400200616     C** 2 MOVE 'H' IN @@HIND (HOLIDAY INDICATOR PARAMETER OF ZA0830)     64743
164500200616     C**   MOVE LOCAL CURRENCY CODE BJLCCY, FROM SDBANKL1 INTO @@CCY      64743
164600200616     C**   (CURRENCY PARAMETER).                                          64743
164700200616     C***                  MOVEL'H'       @@HIND                          64743
164800200616     C*                                                                   64743
164900200616     C** 3. DO WHILE DAY IS A HOLIDAY IN LOCAL CURRENCY                   64743
165000200616     C***        @@HIND    DOWEQ'H'                                       64743
165100200616     C*                                                                   64743
165200200616     C** 3.1 Z-ADD WWERRD INTO @@MNO (DATE PARAMETER)                     64743
165300200616     C***                  Z-ADDWWERRD    @@MNO   50                      64743
165400200616     C** 3.2 CHECK WHETHER THE DATE WWERRD IS A HOLIDAY                   64743
165500200616     C***                  EXSR ZA0830                                    64743
165600200616     C** 3.3 IF @@HIND IS 'H' (IT IS HOLIDAY).                            64743
165700200616     C***        @@HIND    IFEQ 'H'                                       64743
165800200616     C** 3.3.1 SUBTRACT 1 DAY FROM WWERRD                                 64743
165900200616     C***                  SUB  1         WWERRD                          64743
166000200616     C***                  ENDIF                                          64743
166100200616     C*                                                                   64743
166200200616     C***                  ENDDO                                          64743
166300200616     C*                                                                   64743
166400200616     C***                  ENDSR                                          64743
166500200616     C*                                                                   64743
166600200616     ******************************************************************
166700200616      /EJECT
166800200616     ******************************************************************
166900200616     C* P009   : Retrieve Settlement Instructions for Customers       *
167000200616     ******************************************************************
167100200616     C*
167200200616     C           P009      BEGSR
167300200616     C*
167400200616     C** DETERMINE SETTLEMENT CURRENCY  AND ACCOUNT AS FOLLOWS:
167500200616     C           *LIKE     DEFN VLCY      #1VCY0
167600200616     C           *LIKE     DEFN VLCY      #1VCY1
167700200616     C           *LIKE     DEFN VLCY      #1VCY2
167800200616     C           *LIKE     DEFN VLCY      #1VCY3
167900200616     C*
168000200616     C** Set Currency 1 to Value Currency
168100200616     C                     MOVELVLCY      #1VCY1
168200200616     C*
168300200616     C                     MOVE VCCNUM    #1CUST  6
168400200616     C*
168500200616     C** Access SDSECSL0 for Customer Settlement Currency
168600200616     C***********#1CUST    CHAINSDSECSL0             89                   S01496
168700200616     C*                                                                   S01496
168800200616     C                     MOVE *BLANKS   WZACOD 100                      219688
168900200616     C                     CALL 'AOSECSR0'                                S01496
169000200616     C                     PARM *BLANKS   WLRTCD                          S01496
169100200616     C                     PARM '*KEY  '  WLOPTN                          S01496
169200200616     C                     PARM #1CUST    WLCUSN  6                       S01496
169300200616     C           SDSECS    PARM SDSECS    DSSDY                           S01496
169400200616     C*                                                                   S01496
169500200616     C************IN89     IFEQ *ON                                       S01496
169600200616     C           WLRTCD    IFNE *BLANKS                                   S01496
169700200616     C                     Z-ADD5         DBASE            *****************
169800200616     C***********          MOVEL'SDSECSL0'DBFILE           ** DB ERROR 05 S01496
169900200616     C                     MOVE 'SDSECSPD'DBFILE           * DB ERROR 05 *S01496
170000200616     C                     MOVEL*BLANKS   DBKEY            *****************
170100200616     C                     MOVEL#1CUST    DBKEY                           S01496
170200200616     C                     EXSR *PSSR
170300200616     C                     ENDIF
170400200616     C*
170500200616      *                                                                   219688
170600200616     C                     MOVE BFACCD    WZACOD                          219688
170700200616      *                                                                   219688
170800200616     C** Portfolio Reference not blank and not '9997'
170900200616     C           VCPTFR    IFNE *BLANKS
171000200616     C           VCPTFR    ANDNE'9997'
171100200616     C***Access*PMPORTPP*for*Portfolio*Currency************************   S01496
171200200616     C** Access PMPORTPD for Portfolio Currency                           S01496
171300200616     C           W202K1    KLIST
171400200616     C                     KFLD           VCCNUM
171500200616     C                     KFLD           VCPTFR
171600200616     C***********W202K1    CHAINPMPORTPP             89                   S01496
171700200616     C           W202K1    CHAINPMPORTPD             89                   S01496
171800200616     C           *IN89     IFEQ *ON
171900200616     C                     Z-ADD6         DBASE            *****************
172000200616     C***********          MOVEL'PMPORTPP'DBFILE           ** DB ERROR 06 S01496
172100200616     C                     MOVE 'PMPORTPD'DBFILE           * DB ERROR 06 *S01496
172200200616     C                     MOVEL*BLANKS   DBKEY            *****************
172300200616     C                     EXSR *PSSR
172400200616     C                     ENDIF
172500200616     C** SET CCY2 TO PTFR CCY
172600200616     C                     MOVELPNPTCY    #1VCY2
172700200616     C                     ENDIF
172800200616     C*
172900200616     C** Portfolio reference not blank
173000200616     C           VCPTFR    IFNE *BLANKS
173100200616     C           BGPFMG    ANDEQ'Y'                                       CPB001
173200200616     C** Access SDPLCSPD for Customer Base Currency
173300200616     C***********#1CUST    CHAINSDPLCSPD             89                   S01496
173400200616     C*                                                                   S01496
173500200616     C                     CALL 'AOPLCSR0'                                S01496
173600200616     C                     PARM *BLANKS   WLRTCD                          S01496
173700200616     C                     PARM '*KEY  '  WLOPTN                          S01496
173800200616     C                     PARM #1CUST    WLCUST 10                       S01496
173900200616     C           SDPLCS    PARM SDPLCS    DSSDY                           S01496
174000200616     C*                                                                   S01496
174100200616     C************IN89     IFEQ *ON                                       S01496
174200200616     C           WLRTCD    IFNE *BLANKS                                   S01496
174300200616     C                     Z-ADD7         DBASE            *****************
174400200616     C***********          MOVEL'SDPLCSPD'DBFILE           ** DB ERROR 07 S01496
174500200616     C                     MOVE 'SDPLCSPD'DBFILE           * DB ERROR 07 *S01496
174600200616     C                     MOVEL*BLANKS   DBKEY            *****************
174700200616     C                     MOVEL#1CUST    DBKEY                           S01496
174800200616     C                     EXSR *PSSR
174900200616     C                     ENDIF
175000200616     C** Set Currency 3 to Customer Currency
175100200616     C                     MOVELQBCSBY    #1VCY3
175200200616     C** if PTFR = '9997', set Currency 2 to Customer Currency
175300200616     C           VCPTFR    IFEQ '9997'
175400200616     C           BGN4ST    ANDNE'Y'                                       CPB001
175500200616     C                     MOVELQBCSBY    #1VCY2
175600200616     C                     ENDIF
175700200616     C*
175800200616     C** else = Portfolio reference blank
175900200616     C                     ELSE
176000200616     C** Set Currency 2 and Currency 3 to Customer Settlement CCY
176100200616     C***********          MOVELBFPCYP    #1VCY2                          S01496
176200200616     C***********          MOVELBFPCYP    #1VCY3                          S01496
176300200616     C                     MOVELBFPCYC    #1VCY2                          S01496
176400200616     C                     MOVELBFPCYC    #1VCY3                          S01496
176500200616     C                     ENDIF
176600200616     C*
176700200616     C** Check for Customer Account in Currency 1 & same Portfolio.
176800200616     C** If found, use this account otherwise check for Account in
176900200616     C** Currency 2 and 3.
177000200616     C           *LIKE     DEFN ACSQ      #1ACSQ
177100200616     C           *LIKE     DEFN VCCNUM    #CCNUM
177200200616     C           *LIKE     DEFN VCPTFR    #CPTFR
177300200616     C           W202K2    KLIST
177400200616     C                     KFLD           #CCNUM
177500200616     C                     KFLD           #1VCY0
177600200616     C                     KFLD           #CPTFR
177700200616     C                     KFLD           #1ACSQ
177800200616     C*                                                                   219688
177900200616     C** ACCOUNT DETAILS PMACCNL1                                         219688
178000200616     C           ACCNTL    KLIST                                          219688
178100200616     C                     KFLD           #CCNUM                          219688
178200200616     C                     KFLD           #CPTFR                          219688
178300200616     C                     KFLD           #1VCY0                          219688
178400200616     C                     KFLD           WZACOD                          219688
178500200616     C                     KFLD           #1ACSQ                          219688
178600200616     C*                                                                   219688
178700200616     C           KEY103    KLIST                                          160338
178800200616     C                     KFLD           VCBRCD                          160338
178900200616     C                     KFLD           VCCNUM                          160338
179000200616     C                     KFLD           VCBOOK                          160338
179100200616     C                     KFLD           #1VLCY                          160338
179200200616     C                     KFLD           #1SITP                          160338
179300200616     C                     KFLD           VCPTFR                          160338
179400200616     C                     MOVELVLCY      #1VLCY                          160338
179500200616     C                     MOVELSITP      #1SITP                          160338
179600200616     C           KEY103    CHAINSTDSED               89                   160338
179700200616     C           *IN89     IFEQ '1'                                       160338
179800200616     C                     MOVE *BLANKS   #1SITP                          160338
179900200616     C           KEY103    CHAINSTDSED               89                   160338
180000200616     C                     ENDIF                                          160338
180100200616     C           *IN89     IFEQ '0'                                       160338
180200200616     C*                                                                   160338
180300200616     C** CEU005 active and Settlement Ccy used on STDSED.                 160338
180400200616     C*                                                                   160338
180500200616     C           CEU005    IFEQ 'Y'                                       160338
180600200616     C           SCCY      ANDNE*BLANKS                                   160338
180700200616     C                     MOVE SCCY      SVSCCY  3                       160338
180800200616     C*                                                                   160338
180900200616     C** Access currencies file for EURO rate, EURO M/D indicator and     160338
181000200616     C** Transition Date for 'In' Ccy.                                    160338
181100200616     C*                                                                   160338
181200200616     C           NMCY      IFEQ BKEURO                                    160338
181300200616     C                     CALL 'AOCURRR0'                                160338
181400200616     C                     PARM           @RTCD   7                       160338
181500200616     C                     PARM '*KEY   ' @OPTN   7                       160338
181600200616     C                     PARM SCCY      @AJCD   3                       160338
181700200616     C           SDCURR    PARM SDCURR    DSSDY                           160338
181800200616     C           @RTCD     IFNE *BLANKS                                   160338
181900200616     C                     Z-ADD46        DBASE             ************  160338
182000200616     C                     MOVEL'SDCURRPD'DBFILE            * DATABASE *  160338
182100200616     C                     MOVELSCCY      DBKEY             * ERROR 46 *  160338
182200200616     C                     EXSR *PSSR                       ************  160338
182300200616     C                     ENDIF                                          160338
182400200616     C                     ELSE                                           160338
182500200616     C           SCCY      IFEQ BKEURO                                    160338
182600200616     C                     CALL 'AOCURRR0'                                160338
182700200616     C                     PARM           @RTCD   7                       160338
182800200616     C                     PARM '*KEY   ' @OPTN   7                       160338
182900200616     C                     PARM NMCY      @AJCD   3                       160338
183000200616     C           SDCURR    PARM SDCURR    DSSDY                           160338
183100200616     C           @RTCD     IFNE *BLANKS                                   160338
183200200616     C                     Z-ADD47        DBASE             ************  160338
183300200616     C                     MOVEL'SDCURRPD'DBFILE            * DATABASE *  160338
183400200616     C                     MOVELNMCY      DBKEY             * ERROR 47 *  160338
183500200616     C                     EXSR *PSSR                       ************  160338
183600200616     C                     ENDIF                                          160338
183700200616     C                     ENDIF                                          160338
183800200616     C                     ENDIF                                          160338
183900200616     C                     MOVE A6EUMD    SVEUMD                          160338
184000200616     C                     MOVE A6EUER    SVEUER                          160338
184100200616     C*                                                                   160338
184200200616     C** Value date is later than Transition Start Date.                  160338
184300200616     C*                                                                   160338
184400200616     C           VAERPD    IFGE A6TPSD                                    160338
184500200616     C           A6INCY    ANDEQ'Y'                                       160338
184600200616     C                     Z-ADDA6EUER    PSXR                            160338
184700200616     C*                                                                   160338
184800200616     C** Nominal currency is Euro currency, reverse M/D indicator.        160338
184900200616     C*                                                                   160338
185000200616     C           NMCY      IFEQ BKEURO                                    160338
185100200616     C           A6EUMD    IFEQ 'M'                                       160338
185200200616     C                     MOVE 'D'       PMDI                            160338
185300200616     C                     ELSE                                           160338
185400200616     C                     MOVE 'M'       PMDI                            160338
185500200616     C                     ENDIF                                          160338
185600200616     C*                                                                   160338
185700200616     C** Settlement currency is Euro currency, use Euro M/D indicator.    160338
185800200616     C*                                                                   160338
185900200616     C                     ELSE                                           160338
186000200616     C                     MOVE A6EUMD    PMDI                            160338
186100200616     C                     ENDIF                                          160338
186200200616     C                     MOVE SCCY      WPSCU                           160338
186300200616      * Chain STDSED again.                                               160338
186400200616     C                     MOVE SCCY      #1VLCY                          160338
186500200616     C           KEY103    CHAINSTDSED               78                   160338
186600200616     C           *IN78     IFEQ '1'                                       160338
186700200616     C                     Z-ADD0         WPSMT                           160338
186800200616     C                     MOVEL*BLANKS   WPSEA                           160338
186900200616     C                     MOVEL*BLANKS   WPSEB                           160338
187000200616     C                     MOVEL*BLANKS   WPCPN                           160338
187100200616     C                     ELSE                                           160338
187200200616     C           VCNOMA    IFGT 0                                         160338
187300200616     C                     Z-ADDSPSM      WPSMT                           160338
187400200616     C                     MOVELSPAT      WPSEA                           160338
187500200616     C                     MOVELSPBA      WPSEB                           160338
187600200616     C                     MOVELSPCB      WPCPN                           160338
187700200616     C*                                                                   160338
187800200616     C** If SPSM = 04 and SPAT = blanks then determine a/c                160338
187900200616     C** via SR/ZSETAC and output to field PSEA                           160338
188000200616     C*                                                                   160338
188100200616     C           SPSM      IFEQ 04                                        160338
188200200616     C           SPAT      ANDEQ*BLANK                                    160338
188300200616     C*                                                                   160338
188400200616     C** Pass parameters to SR/ZSETAC and execute routine                 160338
188500200616     C*                                                                   160338
188600200616     C                     MOVE SPSM      ZMETH                           160338
188700200616     C                     MOVE SPAT      ZSETI                           160338
188800200616     C                     MOVE VCCNUM    ZCNUM                           160338
188900200616     C                     MOVE VLCY      ZCCY                            160338
189000200616     C                     MOVE SPBA      ZBRCA                           160338
189100200616     C                     EXSR ZSETAC                                    160338
189200200616     C                     MOVELZSETO     WPSEA                           160338
189300200616     C                     MOVELZWBRCA    WPSEB                           160338
189400200616     C                     ENDIF                                          160338
189500200616     C                     ELSE                                           160338
189600200616     C                     Z-ADDSRSM      WPSMT                           160338
189700200616     C                     MOVELSRAC      WPSEA                           160338
189800200616     C                     MOVELSRAB      WPSEB                           160338
189900200616     C                     MOVELSRCB      WPCPN                           160338
190000200616     C*                                                                   160338
190100200616     C** If SRSM = 04 and SRAC = blanks then determine a/c                160338
190200200616     C** via SR/ZSETAC and output to field PSEA                           160338
190300200616     C*                                                                   160338
190400200616     C           SRSM      IFEQ 04                                        160338
190500200616     C           SRAC      ANDEQ*BLANK                                    160338
190600200616     C*                                                                   160338
190700200616     C** Pass parameters to SR/ZSETAC and execute routine                 160338
190800200616     C*                                                                   160338
190900200616     C                     MOVE SRSM      ZMETH                           160338
191000200616     C                     MOVE SRAC      ZSETI                           160338
191100200616     C                     MOVE VCCNUM    ZCNUM                           160338
191200200616     C                     MOVE VLCY      ZCCY                            160338
191300200616     C                     MOVE SRAB      ZBRCA                           160338
191400200616     C                     EXSR ZSETAC                                    160338
191500200616     C                     MOVELZSETO     WPSEA                           160338
191600200616     C                     MOVELZWBRCA    WPSEB                           160338
191700200616     C                     ENDIF                                          160338
191800200616     C                     ENDIF                                          160338
191900200616     C                     ENDIF                                          160338
192000200616     C                     ENDIF                                          160338
192100200616     C                     ELSE                                           160338
192200200616     C                     MOVELVLCY      WPSCU                           160338
192300200616     C           VCNOMA    IFGT 0                                         160338
192400200616     C                     Z-ADDSPSM      WPSMT                           160338
192500200616     C                     MOVELSPAT      WPSEA                           160338
192600200616     C                     MOVELSPBA      WPSEB                           160338
192700200616     C                     MOVELSPCB      WPCPN                           160338
192800200616     C*                                                                   160338
192900200616     C** If SPSM = 04 and SPAT = blanks then determine a/c                160338
193000200616     C** via SR/ZSETAC and output to field PSEA                           160338
193100200616     C*                                                                   160338
193200200616     C           SPSM      IFEQ 04                                        160338
193300200616     C           SPAT      ANDEQ*BLANK                                    160338
193400200616     C*                                                                   160338
193500200616     C** Pass parameters to SR/ZSETAC and execute routine                 160338
193600200616     C*                                                                   160338
193700200616     C                     MOVE SPSM      ZMETH                           160338
193800200616     C                     MOVE SPAT      ZSETI                           160338
193900200616     C                     MOVE VCCNUM    ZCNUM                           160338
194000200616     C                     MOVE VLCY      ZCCY                            160338
194100200616     C                     MOVE SPBA      ZBRCA                           160338
194200200616     C                     EXSR ZSETAC                                    160338
194300200616     C                     MOVELZSETO     WPSEA                           160338
194400200616     C                     MOVELZWBRCA    WPSEB                           160338
194500200616     C                     ENDIF                                          160338
194600200616     C                     ELSE                                           160338
194700200616     C                     Z-ADDSRSM      WPSMT                           160338
194800200616     C                     MOVELSRAC      WPSEA                           160338
194900200616     C                     MOVELSRAB      WPSEB                           160338
195000200616     C                     MOVELSRCB      WPCPN                           160338
195100200616     C*                                                                   160338
195200200616     C** If SRSM = 04 and SRAC = blanks then determine a/c                160338
195300200616     C** via SR/ZSETAC and output to field PSEA                           160338
195400200616     C*                                                                   160338
195500200616     C           SRSM      IFEQ 04                                        160338
195600200616     C           SRAC      ANDEQ*BLANK                                    160338
195700200616     C*                                                                   160338
195800200616     C** Pass parameters to SR/ZSETAC and execute routine                 160338
195900200616     C*                                                                   160338
196000200616     C                     MOVE SRSM      ZMETH                           160338
196100200616     C                     MOVE SRAC      ZSETI                           160338
196200200616     C                     MOVE VCCNUM    ZCNUM                           160338
196300200616     C                     MOVE VLCY      ZCCY                            160338
196400200616     C                     MOVE SRAB      ZBRCA                           160338
196500200616     C                     EXSR ZSETAC                                    160338
196600200616     C                     MOVELZSETO     WPSEA                           160338
196700200616     C                     MOVELZWBRCA    WPSEB                           160338
196800200616     C                     ENDIF                                          160338
196900200616     C                     ENDIF                                          160338
197000200616     C                     ENDIF                                          160338
197100200616     C*                                                                   160338
197200200616     C** Record not found in file STDSED                                  160338
197300200616     C*                                                                   160338
197400200616     C                     ELSE                                           160338
197500200616     C*
197600200616     C** Preset Key W202K2
197700200616     C                     MOVELVCCNUM    #CCNUM
197800200616     C                     MOVEL#1VCY1    #1VCY0
197900200616     C                     MOVELVCPTFR    #CPTFR
198000200616     C                     Z-ADD0         #1ACSQ
198100200616     C*
198200200616     C** CURRENCY 1
198300200616     C***********W202K2    SETLLACCNTPS                                   S01496
198400200616     C***********          READ ACCNTPS                  89               S01496
198500200616     C** READ FIRST RECORD FOR ACCOUNT FOR THE SDSECSPD ACCOUNT CODE      219688
198600200616     C           ACCNTL    SETLLPMACCNL1                                  219688
198700200616     C                     READ PMACCNL1                 89               219688
198800200616      *                                                                   219688
198900200616     C                     MOVEL*IN89     W202F1                          219688
199000200616      *                                                                   219688
199100200616     C           *IN89     IFEQ '0'                                       219688
199200200616     C           CNUM      ANDEQ#CCNUM                                    219688
199300200616     C           CCY       ANDEQ#1VCY0                                    219688
199400200616     C           PTFR      ANDEQ#CPTFR                                    219688
199500200616     C           ACOD      ANDEQWZACOD                                    219688
199600200616     C                     ELSE                                           219688
199700200616     C*                                                                   219688
199800200616     C           W202K2    SETLLPMACCNL0                                  S01496
199900200616     C                     READ PMACCNL0                 89               S01496
200000200616     C                     MOVEL*IN89     W202F1  1
200100200616     C           *IN89     IFEQ *OFF
200200200616     C           CNUM      IFNE #CCNUM
200300200616     C           CCY       ORNE #1VCY0
200400200616     C           PTFR      ORNE #CPTFR
200500200616     C**                                                                  219566
200600200616     C** IF system value 'UseDefaultSettAccnt' is 'Y' then                219566
200700200616     C**    get first record of same account and currency                 219566
200800200616     C           DEF001    IFEQ 'Y'                                       219566
200900200616     C                     MOVE *BLANKS   #CPTFR                          219566
201000200616     C           W202K2    SETLLPMACCNL0                                  219566
201100200616     C                     READ PMACCNL0                 89               219566
201200200616     C*                                                                   219566
201300200616     C           *IN89     IFEQ *OFF                                      219566
201400200616     C           CNUM      IFNE #CCNUM                                    219566
201500200616     C           CCY       ORNE #1VCY0                                    219566
201600200616     C                     MOVEL*ON       W202F1                          219566
201700200616     C                     ENDIF                                          219566
201800200616     C                     ENDIF                                          219566
201900200616     C*                                                                   219566
202000200616     C                     ELSE                                           219566
202100200616     C                     MOVEL*ON       W202F1  1
202200200616     C                     ENDIF                           Endif DEF001=Y 219566
202300200616     C*                                                                   219566
202400200616     C                     ENDIF
202500200616     C                     ENDIF
202600200616     C*
202700200616     C                     END                                            219688
202800200616      *                                                                   219688
202900200616     C** CURRENCY 2
203000200616     C           W202F1    IFEQ *ON
203100200616     C                     MOVEL#1VCY2    #1VCY0
203200200616     C** READ FIRST RECORD FOR ACCOUNT FOR THE SDSECSPD ACCOUNT CODE      219688
203300200616     C           ACCNTL    SETLLPMACCNL1                                  219688
203400200616     C                     READ PMACCNL1                 89               219688
203500200616      *                                                                   219688
203600200616     C                     MOVEL*IN89     W202F1                          219688
203700200616      *                                                                   219688
203800200616     C           *IN89     IFEQ '0'                                       219688
203900200616     C           CNUM      ANDEQ#CCNUM                                    219688
204000200616     C           CCY       ANDEQ#1VCY0                                    219688
204100200616     C           PTFR      ANDEQ#CPTFR                                    219688
204200200616     C           ACOD      ANDEQWZACOD                                    219688
204300200616     C                     ELSE                                           219688
204400200616     C*                                                                   219688
204500200616     C***********W202K2    SETLLACCNTPS                                   S01496
204600200616     C***********          READ ACCNTPS                  89               S01496
204700200616     C           W202K2    SETLLPMACCNL0                                  S01496
204800200616     C                     READ PMACCNL0                 89               S01496
204900200616     C                     MOVEL*IN89     W202F1
205000200616     C           *IN89     IFEQ *OFF
205100200616     C           CNUM      IFNE #CCNUM
205200200616     C           CCY       ORNE #1VCY0
205300200616     C           PTFR      ORNE #CPTFR
205400200616     C**                                                                  219566
205500200616     C** IF system value 'UseDefaultSettAccnt' is 'Y' then                219566
205600200616     C**    get first record of same account and currency                 219566
205700200616     C           DEF001    IFEQ 'Y'                                       219566
205800200616     C                     MOVE *BLANKS   #CPTFR                          219566
205900200616     C           W202K2    SETLLPMACCNL0                                  219566
206000200616     C                     READ PMACCNL0                 89               219566
206100200616     C*                                                                   219566
206200200616     C           *IN89     IFEQ *OFF                                      219566
206300200616     C           CNUM      IFNE #CCNUM                                    219566
206400200616     C           CCY       ORNE #1VCY0                                    219566
206500200616     C                     MOVEL*ON       W202F1                          219566
206600200616     C                     ENDIF                                          219566
206700200616     C                     ENDIF                                          219566
206800200616     C*                                                                   219566
206900200616     C                     ELSE                                           219566
207000200616     C                     MOVEL*ON       W202F1
207100200616     C                     ENDIF                           Endif DEF001=Y 219566
207200200616     C*                                                                   219566
207300200616     C                     ENDIF
207400200616     C                     ENDIF
207500200616     C                     END                                            219688
207600200616     C                     ENDIF
207700200616     C*
207800200616     C** CURRENCY 3
207900200616     C           W202F1    IFEQ *ON
208000200616     C                     MOVEL#1VCY3    #1VCY0
208100200616     C***********W202K2    SETLLACCNTPS                                   S01496
208200200616     C***********          READ ACCNTPS                  89               S01496
208300200616     C** READ FIRST RECORD FOR ACCOUNT FOR THE SDSECSPD ACCOUNT CODE      219688
208400200616     C           ACCNTL    SETLLPMACCNL1                                  219688
208500200616     C                     READ PMACCNL1                 89               219688
208600200616      *                                                                   219688
208700200616     C                     MOVEL*IN89     W202F1                          219688
208800200616      *                                                                   219688
208900200616     C           *IN89     IFEQ '0'                                       219688
209000200616     C           CNUM      ANDEQ#CCNUM                                    219688
209100200616     C           CCY       ANDEQ#1VCY0                                    219688
209200200616     C           PTFR      ANDEQ#CPTFR                                    219688
209300200616     C           ACOD      ANDEQWZACOD                                    219688
209400200616     C                     ELSE                                           219688
209500200616     C*                                                                   219688
209600200616     C           W202K2    SETLLPMACCNL0                                  S01496
209700200616     C                     READ PMACCNL0                 89               S01496
209800200616     C                     MOVEL*IN89     W202F1
209900200616     C           *IN89     IFEQ *OFF
210000200616     C           CNUM      IFNE #CCNUM
210100200616     C           CCY       ORNE #1VCY0
210200200616     C           PTFR      ORNE #CPTFR
210300200616     C**                                                                  219566
210400200616     C** IF system value 'UseDefaultSettAccnt' is 'Y' then                219566
210500200616     C**    get first record of same account and currency                 219566
210600200616     C           DEF001    IFEQ 'Y'                                       219566
210700200616     C                     MOVE *BLANKS   #CPTFR                          219566
210800200616     C           W202K2    SETLLPMACCNL0                                  219566
210900200616     C                     READ PMACCNL0                 89               219566
211000200616     C*                                                                   219566
211100200616     C           *IN89     IFEQ *OFF                                      219566
211200200616     C           CNUM      IFNE #CCNUM                                    219566
211300200616     C           CCY       ORNE #1VCY0                                    219566
211400200616     C                     MOVEL*ON       W202F1                          219566
211500200616     C                     ENDIF                                          219566
211600200616     C                     ENDIF                                          219566
211700200616     C*                                                                   219566
211800200616     C                     ELSE                                           219566
211900200616     C                     MOVEL*ON       W202F1
212000200616     C                     ENDIF                           Endif DEF001=Y 219566
212100200616     C*                                                                   219566
212200200616     C                     ENDIF
212300200616     C                     ENDIF
212400200616     C                     END                                            219688
212500200616     C                     ENDIF
212600200616     C*
212700200616     C** IF ACCOUNT FOUND IN ANY OF CURRENCIES CHECKED
212800200616     C           W202F1    IFEQ *OFF
212900200616     C*
213000200616     C** SETTLEMENT CURRENCY = CCY OF SETTLEMENT A/C
213100200616     C                     MOVELCCY       WPSCU   3
213200200616     C** SETTLEMENT METHOD   = 05
213300200616     C                     MOVE 05        WPSMT
213400200616     C** SETTLEMENT ACCOUNT  = CUSTOMER NO., A/C, A/C SEQUENCE
213500200616     C                     MOVELPSEA1     WPSEA
213600200616     C** SETTLEMENT BRANCH   = BRANCH OF ACCOUNT, ACCNT
213700200616     C***********          MOVE BRCD      WPSEB                           S01496
213800200616     C                     MOVE BRCA      WPSEB                           S01496
213900200616     C*
214000200616     C** ELSE  IF ACCOUNT FOUND IN ANY OF CURRENCIES CHECKED
214100200616     C                     ELSE
214200200616     C*
214300200616     C** SETTLEMENT CURRENCY = CCY OF SETTLEMENT A/C
214400200616     C                     MOVELVLCY      WPSCU
214500200616     C** SETTLEMENT METHOD   = 00
214600200616     C                     MOVE 00        WPSMT
214700200616     C** SETTLEMENT ACCOUNT  = CUSTOMER NO., A/C, A/C SEQUENCE
214800200616     C                     MOVEL*BLANKS   WPSEA
214900200616     C** SETTLEMENT BRANCH   = BRANCH OF ACCOUNT, ACCNT
215000200616     C                     MOVE '000'     WPSEB
215100200616     C*
215200200616     C                     ENDIF
215300200616     C                     ENDIF                                          160338
215400200616     C*
215500200616     C                     ENDSR
215600200616     C*
215700200616     ******************************************************************
215800200616      /EJECT
215900200616      *****************************************************************
216000200616      *  P04     SUBROUTINE TO CALCULATE CHARGE/COMMISSION AMOUNTS    *
216100200616      *****************************************************************
216200200616      *
216300200616     C           P04       BEGSR
216400200616     C*
216500200616     C* DEFAULT CHARGES TABLE.  LF/SEDFTCL2
216600200616     C*
216700200616     C           DFTKY1    KLIST
216800200616     C***********          KFLD           DCCLGR                          S01496
216900200616     C                     KFLD           DCCLAS                          S01496
217000200616     C                     KFLD           DCINVT
217100200616     C                     KFLD           DCCUST
217200200616     C*                                                                   S01496
217300200616     C           DFTKY2    KLIST                                          S01496
217400200616     C                     KFLD           DCCLGR                          S01496
217500200616     C                     KFLD           DCINVT                          S01496
217600200616     C/COPY WNCPYSRC,SE6720C016
217700200616     C                     KFLD           DCCUST                          S01496
217800200616     C*                                                                   S01496
217900200616     C**  Open appropriate file                                           S01496
218000200616     C*                                                                   S01496
218100200616     C************IN55     IFEQ 'Y'                                S01496 160338
218200200616     C           *IN55     IFEQ '1'                                       160338
218300200616     C                     OPEN SEDFGRL0                                  S01496
218400200616     C                     ELSE                                           S01496
218500200616     C                     OPEN SEDFTCL2                                  S01496
218600200616     C                     END                                            S01496
218700200616     C*
218800200616     C***********          MOVE PNCY      ZCCYO                           CH0273
218900200616     C                     MOVE PSCU      ZCCYO                           CH0273
219000200616     C                     MOVE PNCY      ZCCYI
219100200616     C***********          MOVE 'M'       ZMD                             CH0273
219200200616     C***********          Z-ADD1         ZEXCH                           CH0273
219300200616     C                     MOVE PMDI      ZMD                             CH0273
219400200616     C                     Z-ADDPSXR      ZEXCH                           CH0273
219500200616     C                     MOVE 'N'       WWDFTF  1
219600200616     C*
219700200616     C**  SET UP KEY FOR CHAINING TO DEFAULT CHARGES TABLE (SEDFTCL2).
219800200616     C*
219900200616     C**  IF CHARGES BY CUSTOMER GROUP IS ON
220000200616     C***********BVCUGR    IFEQ 'Y'                        B*             S01496
220100200616     C************IN55     IFEQ 'Y'                        B*      S01496 160338
220200200616     C           *IN55     IFEQ '1'                                       160338
220300200616     C                     MOVELBFPSCG    DCCLGR
220400200616     C                     ELSE                            X*
220500200616     C                     MOVEL*BLANKS   DCCLGR
220600200616     C***********          MOVELBFCLAS    DCCLGR                          S01496
220700200616     C                     MOVELBFCLAS    DCCLAS                          S01496
220800200616     C                     END                             E*
220900200616     C*
221000200616     C                     MOVE SITP      DCINVT
221100200616     C                     MOVE VCCNUM    DCCUST
221200200616     C*
221300200616     C/COPY WNCPYSRC,SE6720C017
221400200616     C************IN55     IFEQ 'Y'                                S01496 160338
221500200616     C           *IN55     IFEQ '1'                                       160338
221600200616     C           DFTKY2    CHAINSEDFGRL0             89                   S01496
221700200616     C                     ELSE                                           S01496
221800200616     C           DFTKY1    CHAINSEDFTCL2             89
221900200616     C                     END                                            S01496
222000200616     C           *IN89     IFEQ '0'                        B3
222100200616     C                     EXSR P05
222200200616     C                     ELSE                            X3
222300200616     C*
222400200616     C                     MOVE *BLANKS   DCCUST
222500200616     C************IN55     IFEQ 'Y'                                S01496 160338
222600200616     C           *IN55     IFEQ '1'                                       160338
222700200616     C           DFTKY2    CHAINSEDFGRL0             89                   S01496
222800200616     C                     ELSE                                           S01496
222900200616     C           DFTKY1    CHAINSEDFTCL2             89
223000200616     C                     END                                            S01496
223100200616     C           *IN89     IFEQ '0'
223200200616     C                     EXSR P05
223300200616     C                     ELSE
223400200616     C*
223500200616     C                     MOVE *BLANKS   DCINVT
223600200616     C************IN55     IFEQ 'Y'                                S01496 160338
223700200616     C           *IN55     IFEQ '1'                                       160338
223800200616     C           DFTKY2    CHAINSEDFGRL0             89                   S01496
223900200616     C                     ELSE                                           S01496
224000200616     C           DFTKY1    CHAINSEDFTCL2             89
224100200616     C                     END                                            S01496
224200200616     C           *IN89     IFEQ '0'
224300200616     C                     EXSR P05
224400200616     C                     ELSE
224500200616     C*
224600200616     C* IF NO RECORDS FOUND ZEROIZE DEFAULT CHARGE/COMMISSION
224700200616     C* AMOUNT FIELDS.
224800200616     C                     MOVE *ZEROS    PCHA
224900200616     C                     MOVE *ZEROS    PCAM
225000200616     C/COPY WNCPYSRC,SE6720C010
225100200616     C*
225200200616     C                     END
225300200616     C                     END
225400200616     C                     END
225500200616     C/COPY WNCPYSRC,SE6720C018
225600200616     C*                                                                   S01496
225700200616     C**  Close file                                                      S01496
225800200616     C*                                                                   S01496
225900200616     C************IN55     IFEQ 'Y'                                S01496 160338
226000200616     C           *IN55     IFEQ '1'                                       160338
226100200616     C                     CLOSESEDFGRL0                                  S01496
226200200616     C                     ELSE                                           S01496
226300200616     C                     CLOSESEDFTCL2                                  S01496
226400200616     C                     END                                            S01496
226500200616     C*
226600200616     C                     ENDSR                           ** P04    **
226700200616     C*
226800200616     C*****************************************************************
226900200616      /EJECT
227000200616     C/COPY WNCPYSRC,SE6720C011
227100200616      *****************************************************************
227200200616      *  P05     SUBROUTINE TO CALCULATE DEFAULT AMOUNTS              *
227300200616      *****************************************************************
227400200616      *
227500200616     C           P05       BEGSR
227600200616     C*
227700200616     C           @CCOD     KLIST
227800200616     C                     KFLD           @CCY
227900200616     C                     KFLD           @CAM    2
228000200616     C*
228100200616     C* UPDATE COMMISSIONS AMOUNT.
228200200616     C*
228300200616     C           DCRDCM    IFEQ *BLANKS
228400200616     C                     Z-ADD*ZEROS    PCAM
228500200616     C                     ELSE
228600200616     C                     MOVE DCRDCM    @CAM
228700200616     C                     EXSR CALAMT
228800200616     C                     Z-ADDZCHGA     PCAM
228900200616     C                     END
229000200616     C                     MOVE DCRDCM    PCCD
229100200616     C*
229200200616     C* UPDATE CHARGE AMOUNT.
229300200616     C*
229400200616     C           DCRDCC    IFEQ *BLANKS
229500200616     C                     Z-ADD*ZEROS    PCHA
229600200616     C                     ELSE
229700200616     C                     MOVE DCRDCC    @CAM
229800200616     C                     EXSR CALAMT
229900200616     C                     Z-ADDZCHGA     PCHA
230000200616     C                     END
230100200616     C                     MOVE DCRDCC    PCHC
230200200616     C*
230300200616     C                     ENDSR                           ** P05    **
230400200616     C*
230500200616     C*****************************************************************
230600200616      /EJECT
230700200616      *****************************************************************
230800200616      *                                                               *
230900200616      *  P06     SUBROUTINE TO CALCULATE SETTLEMENT AMOUNTS           *
231000200616      *                                                               *
231100200616      *****************************************************************
231200200616      *
231300200616     C           P06       BEGSR
231400200616     C*
231500200616     C                     Z-ADD0         WKCALC
231600200616     C*
231700200616     C* CALCULATE AND UPDATE SETTLEMENT AMOUNT.
231800200616     C* WKCALC = AMOUNT DUE IN VALUECURRENCY
231900200616     C*
232000200616     C           PPRE      IFEQ 'P'
232100200616     C*
232200200616     C********** PAMD      SUB  PCHA      WKCALC                                           234874
232300200616     C           PAMD1     SUB  PCHA      WKCALC                                           234874
232400200616     C           WKCALC    SUB  PCAM      WKCALC
232500200616     C/COPY WNCPYSRC,SE6720C012
232600200616     C*
232700200616     C                     ELSE
232800200616     C*
232900200616     C********** PAMD      ADD  PCHA      WKCALC 140                                       234874
233000200616     C           PAMD1     ADD  PCHA      WKCALC 140                                       234874
233100200616     C           WKCALC    ADD  PCAM      WKCALC
233200200616     C/COPY WNCPYSRC,SE6720C013
233300200616     C*
233400200616     C                     ENDIF
233500200616     C*
233600200616     C           WKCALC    IFLT *ZEROS
233700200616     C*
233800200616     C           PAMD      DIV  2         PCHA
233900200616     C           PAMD      DIV  2         PCAM
234000200616     C/COPY WNCPYSRC,SE6720C014
234100200616     C                     Z-ADD0         PSAT
234200200616     C                     Z-ADD0         WKCALC
234300200616     C*
234400200616     C***********          ELSE                                           160338
234500200616     C***********PMDI      IFEQ 'M'                                       160338
234600200616     C***********WKCALC    MULT PSXR      PSAT                            160338
234700200616     C***********          ELSE                                           160338
234800200616     C***********WKCALC    DIV  PSXR      PSAT                            160338
234900200616     C***********          ENDIF                                          160338
235000200616     C                     ENDIF
235100200616     C*
235200200616     C                     Z-ADDWKCALC    PSAT                            160338
235300200616     C*
235400200616     C                     ENDSR                           ** P06    **
235500200616     C*****************************************************************
235600200616      /EJECT
235700200616      *****************************************************************
235800200616      *  CALAMT  SUB ROUTINE TO DETERMINE IF AMOUNTS NEED TO BE       *
235900200616      *          DEFAULTED FOR CHARGES                                *
236000200616      *****************************************************************
236100200616      *
236200200616     C           CALAMT    BEGSR
236300200616     C*
236400200616     C** CHARGES TO BE DISPLAYED IN NOMINAL CURRENCY WHETHER THE
236500200616     C** SECURITY IS SINGLE, DUAL OR MULTI CURRENCY (REF AMEND TO FS)
236600200616     C*
236700200616     C                     MOVE PNCY      @CCY    3
236800200616     C           @CCOD     CHAINSECGT                21
236900200616     C*
237000200616     C*  IF NO LIVE RECORD FOUND FIELD DEFAULTS TO BLANK
237100200616     C*
237200200616     C           *IN21     IFEQ '1'
237300200616     C           RECI      ORNE 'D'
237400200616     C                     Z-ADD*ZEROS    ZCHGA
237500200616     C                     END
237600200616     C*
237700200616     C           *IN21     IFEQ '0'
237800200616     C           RECI      ANDEQ'D'
237900200616     C*
238000200616     C*  IF TRADE TYPE IS PURCHASE AND LEVY ON SALE OR TRADE TYPE IS
238100200616     C*  SALE AND LEVY ON PURCHASE FIELD IS BLANK, OTHERWISE CALCULATE
238200200616     C*  AMOUNT
238300200616     C*
238400200616     C           LPSI      IFEQ 'S'
238500200616     C           LPSI      OREQ 'P'
238600200616     C                     Z-ADD*ZEROS    ZCHGA
238700200616     C                     ELSE
238800200616     C                     EXSR CALAM2
238900200616     C                     END
239000200616     C*
239100200616     C                     END
239200200616      *
239300200616     C                     ENDSR
239400200616      *
239500200616      *****************************************************************
239600200616      /EJECT
239700200616      *****************************************************************
239800200616      *                                                               *
239900200616      *  CALAM2  SUB ROUTINE TO CALCULATE CHARGE AMOUNTS              *
240000200616      *                                                               *
240100200616      *****************************************************************
240200200616      *
240300200616     C           CALAM2    BEGSR
240400200616     C*
240500200616     C*  CHARGE DETAILS
240600200616     C*
240700200616     C                     MOVE CHGB      ZCHGB
240800200616     C                     MOVE THRI      ZTHRI
240900200616     C                     Z-ADDMNCH      ZMNCH
241000200616     C                     Z-ADDMXCH      ZMXCH
241100200616     C*
241200200616     C*  SET UP ARRAY FOR UPPER RANGE LIMITS
241300200616     C*
241400200616     C                     Z-ADDSTU1      ZRA,1
241500200616     C                     Z-ADDSTU2      ZRA,2
241600200616     C                     Z-ADDSTU3      ZRA,3
241700200616     C                     Z-ADDSTU4      ZRA,4
241800200616     C                     Z-ADDSTU5      ZRA,5
241900200616     C                     Z-ADDSTU6      ZRA,6
242000200616     C                     Z-ADDSTU7      ZRA,7
242100200616     C                     Z-ADDSTU8      ZRA,8
242200200616     C                     Z-ADDSTU9      ZRA,9
242300200616     C                     Z-ADDST10      ZRA,10
242400200616     C                     Z-ADDST11      ZRA,11
242500200616     C                     Z-ADDST12      ZRA,12
242600200616     C                     Z-ADDST13      ZRA,13
242700200616     C                     Z-ADDST14      ZRA,14
242800200616     C*
242900200616     C*  SET UP ARRAY FOR PERCENTAGE LEVELS
243000200616     C*
243100200616     C                     Z-ADDPL01      ZPC,1
243200200616     C                     Z-ADDPL02      ZPC,2
243300200616     C                     Z-ADDPL03      ZPC,3
243400200616     C                     Z-ADDPL04      ZPC,4
243500200616     C                     Z-ADDPL05      ZPC,5
243600200616     C                     Z-ADDPL06      ZPC,6
243700200616     C                     Z-ADDPL07      ZPC,7
243800200616     C                     Z-ADDPL08      ZPC,8
243900200616     C                     Z-ADDPL09      ZPC,9
244000200616     C                     Z-ADDPL10      ZPC,10
244100200616     C                     Z-ADDPL11      ZPC,11
244200200616     C                     Z-ADDPL12      ZPC,12
244300200616     C                     Z-ADDPL13      ZPC,13
244400200616     C                     Z-ADDPL14      ZPC,14
244500200616     C                     Z-ADDPL15      ZPC,15
244600200616     C*
244700200616     C*  SET UP ARRAY FOR FLAT CHARGES
244800200616     C*
244900200616     C                     Z-ADDFC01      ZCG,1
245000200616     C                     Z-ADDFC02      ZCG,2
245100200616     C                     Z-ADDFC03      ZCG,3
245200200616     C                     Z-ADDFC04      ZCG,4
245300200616     C                     Z-ADDFC05      ZCG,5
245400200616     C                     Z-ADDFC06      ZCG,6
245500200616     C                     Z-ADDFC07      ZCG,7
245600200616     C                     Z-ADDFC08      ZCG,8
245700200616     C                     Z-ADDFC09      ZCG,9
245800200616     C                     Z-ADDFC10      ZCG,10
245900200616     C                     Z-ADDFC11      ZCG,11
246000200616     C                     Z-ADDFC12      ZCG,12
246100200616     C                     Z-ADDFC13      ZCG,13
246200200616     C                     Z-ADDFC14      ZCG,14
246300200616     C                     Z-ADDFC15      ZCG,15
246400200616     C*
246500200616     C***********PNCY      CHAINSDCURRL1             89                   S01496
246600200616     C*                                                                   S01496
246700200616     C                     CALL 'AOCURRR0'                                S01496
246800200616     C                     PARM *BLANKS   WLRTCD                          S01496
246900200616     C                     PARM '*KEY  '  WLOPTN                          S01496
247000200616     C                     PARM PNCY      WLCYCD  3                       S01496
247100200616     C           SDCURR    PARM SDCURR    DSSDY                           S01496
247200200616     C*                                                                   S01496
247300200616     C************IN89     IFEQ '1'                                       S01496
247400200616     C           WLRTCD    IFNE *BLANKS                                   S01496
247500200616     C***********          MOVEL'SDCURRL1'DBFILE 10        ***************S01496
247600200616     C                     MOVE 'SDCURRPD'DBFILE 10        ***************S01496
247700200616     C                     MOVELPNCY      DBKEY  29        ** DB ERROR 08 **
247800200616     C                     Z-ADD8         DBASE   30       *****************
247900200616     C                     EXSR *PSSR
248000200616     C                     ENDIF
248100200616     C*
248200200616     C                     MOVE A6NBDP    ZDECS
248300200616     C*
248400200616     C*  NOMINAL DECIMAL PLACES
248500200616     C*
248600200616     C                     Z-ADD0         ZNMDP
248700200616     C*
248800200616     C*  SECURITY DETAILS
248900200616     C                     Z-ADD1         ZPRICE
249000200616     C                     Z-ADDPAMD      ZNOML
249100200616     C                     Z-ADD0         ZTCFC
249200200616     C                     MOVE 'P'       ZPROT
249300200616     C                     MOVE *BLANKS   ZSPBS
249400200616     C*
249500200616     C***********COUR      IFEQ 'Y'                                       S01496
249600200616     C           S01446    IFEQ 'Y'                                       S01496
249700200616     C* PURCHASE INTEREST.
249800200616     C***********          Z-ADD*ZEROS    ZPIN0                           S01496
249900200616     C                     Z-ADD*ZEROS    ZTPI                            S01496
250000200616     C*                                                                   S01496
250100200616     C**  Access currencies file to get value currency decimal places     S01496
250200200616     C*                                                                   S01496
250300200616     C                     CALL 'AOCURRR0'                                S01496
250400200616     C                     PARM *BLANKS   WLRTCD                          S01496
250500200616     C                     PARM '*KEY  '  WLOPTN                          S01496
250600200616     C                     PARM VLCY      WLCYCD                          S01496
250700200616     C           SDCURR    PARM SDCURR    DSSDY                           S01496
250800200616     C*                                                                   S01496
250900200616     C           WLRTCD    IFNE *BLANKS                                   S01496
251000200616     C                     Z-ADD19        DBASE            ***************S01496
251100200616     C                     MOVE 'SDCURRPD'DBFILE           * DB ERROR 19 *S01496
251200200616     C                     MOVELVLCY      DBKEY            ***************S01496
251300200616     C                     EXSR *PSSR                                     S01496
251400200616     C                     END                                            S01496
251500200616     C*                                                                   S01496
251600200616     C                     Z-ADDA6NBDP    WLVDCP  10                      S01496
251700200616     C*                                                                   CH0273
251800200616     C***********TXCHCY    IFNE *BLANKS                            CH0273 S01496
251900200616     C***********          MOVE TXCHCY    ZCCYI                    CH0273 S01496
252000200616     C           BVCHRC    IFNE *BLANKS                                   S01496
252100200616     C                     MOVE BVCHRC    ZCCYI                           S01496
252200200616     C                     Z-ADDWLNBDP    ZCDPI   10                      S01496
252300200616     C                     MOVE VLCY      ZCCYO                           CH0273
252400200616     C                     Z-ADDWLVDCP    ZCDPO   10                      S01496
252500200616     C                     Z-ADDWWSPOT    ZRATE2 138                      CH0273
252600200616     C                     MOVE WWMDIN    ZMDI2   1                       CH0273
252700200616     C***********          Z-ADDTXSPOT    ZRATE1 138               CH0273 S01496
252800200616     C***********          MOVE TXMDI     ZMDI1   1                CH0273 S01496
252900200616     C                     Z-ADDWLSPRT    ZRATE1 138                      S01496
253000200616     C                     MOVE WLMDIN    ZMDI1   1                       S01496
253100200616     C                     EXSR ZXRATE                                    CH0273
253200200616     C                     MOVE ZRATEX    TRATEX 138                      CH0273
253300200616     C                     MOVE ZMDIX     TMDIX   1                       CH0273
253400200616     C                     MOVE TRATEX    ZEXCH                           CH0273
253500200616     C                     MOVE TMDIX     ZMD                             CH0273
253600200616     C*                                                                   CH0273
253700200616     C                     ELSE                                           CH0273
253800200616     C*
253900200616     C* TOTAL CONSIDERATION.
254000200616     C***********          Z-ADD*ZEROS    ZTCON0                          S01496
254100200616     C                     Z-ADD*ZEROS    ZTCON                           S01496
254200200616     C                     MOVE *BLANKS   ZCCYI
254300200616     C                     MOVE *BLANKS   ZCCYO
254400200616     C                     MOVE *BLANKS   ZEXCH
254500200616     C                     MOVE *BLANKS   ZMD
254600200616     C*                                                                   CH0273
254700200616     C                     END                                            CH0273
254800200616     C*                    END
254900200616     C                     END
255000200616     C*
255100200616     C* TOTAL NOMINAL.
255200200616     C                     Z-ADD*ZEROS    ZTNOM  150
255300200616     C*
255400200616     C                     EXSR ZCCAL1
255500200616     C*
255600200616     C                     ENDSR
255700200616      *
255701200616     C********************************************************************                  AR324886
255702200616     C/EJECT                                                                                AR324886
255703200616     C********************************************************************                  AR324886
255704200616     C           PSAUDT    BEGSR                                                            AR324886
255705200616      *                                                                                     AR324886
255706200616     C                     MOVE RECI      PARECI                                            AR324886
255707200616     C                     MOVE PBCA      PAPBCA                                            AR324886
255708200616     C                     MOVE PSSH      PAPSSH                                            AR324886
255709200616     C                     MOVE PCPY      PAPCPY                                            AR324886
255710200616     C                     MOVE PDUD      PAPDUD                                            AR324886
255711200616     C                     MOVE PEVT      PAPEVT                                            AR324886
255712200616     C                     MOVE PTFR      PAPTFR                                            AR324886
255713200616     C                     MOVE TNLU      PATNLU                                            AR324886
255714200616     C                     MOVE TXBS      PATXBS                                            AR324886
255715200616     C                     MOVE BNFO      PABNFO                                            AR324886
255716200616     C                     MOVE EXCD      PAEXCD                                            AR324886
255717200616     C           LIBR      CAT  'OWNER'   PALUSR                                            AR324886
255718200616     C                     MOVE LCD       PALCD                                             AR324886
255719200616     C                     MOVE CHTP      PALCTP                                            AR324886
255720200616     C                     WRITEPSAUTDF                                                     AR324886
255721200616      *                                                                                     AR324886
255722200616     C                     ENDSR                                                            AR324886
255800200616      *****************************************************************
255900200616     C/EJECT
256000200616     ******************************************************************
256100200616     C* *PSSR : DATABASE ERROR PROCESSING
256200200616     ******************************************************************
256300200616     C           *PSSR     BEGSR
256400200616     C*
256500200616     C** UPDATE LDA WITH ERROR INFORMATION
256600200616     C*
256700200616     C           *LOCK     IN   LDA
256800200616     C                     MOVELDBFILE    WWFILE
256900200616     C                     MOVELDBKEY     WWKEY
257000200616     C                     MOVELDBPGM     WWPGM
257100200616     C                     MOVELDBASE     WWASE
257200200616     C                     OUT  LDA
257300200616     C*
257400200616     C                     DUMP
257500200616     C*
257600200616     C           DBASE     IFNE *ZEROS
257700200616     C                     WRITEHEADAU
257800200616     C                     WRITEERROR
257900200616     C                     END
258000200616     C*
258100200616     C                     SETON                     U7U8LR
258200200616     C                     RETRN
258300200616     C*
258400200616     C                     ENDSR
258500200616     C**********************************************************************
258600200616      /EJECT
258700200616     C**********************************************************************
258800200616     C* SECTIN : GET SECURITY RECORD
258900200616     C**********************************************************************
259000200616     C*
259100200616     C           SECTIN    BEGSR                           ** SECTIN **
259200200616     C*
259300200616     C** Chain for Security Record
259400200616     C           VASESN    CHAINSECTY                89
259500200616     C           *IN89     IFEQ '1'
259600200616     C           RECI      OREQ '*'
259700200616     C***********          MOVEL'SECTY'   DBFILE           ***************S01496
259800200616     C                     MOVE 'SECTY'   DBFILE           ***************S01496
259900200616     C                     MOVELVASESN    DBKEY            ** DB ERROR 09 **
260000200616     C                     Z-ADD9         DBASE            *****************
260100200616     C                     EXSR *PSSR
260200200616     C                     ENDIF
260300200616     C*
260400200616     C** Security Nominal decimal places and Price Basis for SR/ZAPNUM
260500200616     C                     Z-ADDNMDP      ZNMDP
260600200616     C                     MOVE SPBS      ZPRCB
260700200616     C*
260800200616     C** Retrieve Nominal currency Spot, M/D ind. and Dec.places
260900200616     C***********NMCY      CHAINSDCURRL1             89                   S01496
261000200616     C*                                                                   S01496
261100200616     C                     CALL 'AOCURRR0'                                S01496
261200200616     C                     PARM *BLANKS   WLRTCD                          S01496
261300200616     C                     PARM '*KEY  '  WLOPTN                          S01496
261400200616     C                     PARM NMCY      WLCYCD  3                       S01496
261500200616     C           SDCURR    PARM SDCURR    DSSDY                           S01496
261600200616     C*                                                                   S01496
261700200616     C************IN89     IFEQ '1'                                       S01496
261800200616     C           WLRTCD    IFNE *BLANKS                                   S01496
261900200616     C***********          MOVEL'SDCURRL1'DBFILE           ***************S01496
262000200616     C                     MOVE 'SDCURRPD'DBFILE           ***************S01496
262100200616     C                     MOVELBJCYCD    DBKEY            ** DB ERROR 10 **
262200200616     C                     Z-ADD10        DBASE            *****************
262300200616     C                     EXSR *PSSR
262400200616     C                     ENDIF
262500200616      *                                                                                       234813
262600200616      ** Access security WHT details file                                                     234813
262700200616      *                                                                                       234813
262800200616     C           VASESN    CHAINSESWHTL0             62                                       234813
262900200616      *                                                                                       234813
263000200616     C           *IN62     IFEQ '1'                                                           234813
263100200616     C                     Z-ADD0         WLTAX   74                                          234813
263200200616     C                     ELSE                                                               234813
263300200616     C           S1TABD    IFEQ 0                                                             234813
263400200616     C                     Z-ADDS1RASO    WLTAX                                               234813
263500200616     C                     ELSE                                                               234813
263600200616      *                                                                                       234813
263700200616      ** If tax deducted at source is different from zero.                                    234813
263800200616      *                                                                                       234813
263900200616     C                     CALL 'AOSCTXR0'                                                    234813
264000200616     C                     PARM *BLANKS   WLRTCD                                              234813
264100200616     C                     PARM '*KEY   ' WLOPTN                                              234813
264200200616     C                     PARM S1CTTA    @PCTTA  2                                           234813
264300200616     C                     PARM S1TABD    @PTABD  10                                          234813
264400200616     C           SECNTR    PARM SECNTR    DSFDY                                               234813
264500200616      *                                                                                       234813
264600200616     C           WLRTCD    IFNE *BLANK                                                        234813
264700200616     C                     MOVEL@PCTTA    DBKEY                                               234813
264800200616     C                     MOVE @PTABD    DBKEY                                               234813
264900200616     C                     MOVEL'SECNTRL0'DBFILE                                              234813
265000200616     C                     Z-ADD22        DBASE                                               234813
265100200616     C                     EXSR *PSSR                                                         234813
265200200616     C                     ELSE                                                               234813
265300200616     C                     Z-ADDTXRASO    WLTAX                                               234813
265400200616     C                     ENDIF                                                              234813
265500200616     C                     ENDIF                                                              234813
265600200616     C                     ENDIF                                                              234813
265700200616     C*
265800200616     C** Save Base Currency Spot, M/D Indicator, Dec.places for later
265900200616     C                     MOVE A6SPRT    WNSPRT
266000200616     C                     MOVE A6MDIN    WNMDIN
266100200616     C                     MOVE A6NBDP    WNNBDP
266200200616     C*
266300200616     C** Nominal currency decimal places used in SR/ZAPNUM
266400200616     C                     Z-ADDA6NBDP    ZNMCD
266500200616     C*
266600200616     C                     ENDSR
266700200616     C*
266800200616     C**********************************************************************
266900200616      /EJECT
267000200616     C**********************************************************************
267100200616     C* W101     - WRITE ACCOUNT KEY
267200200616     C**********************************************************************
267300200616     C*
267400200616     C           W101      BEGSR                           **   W101 **
267500200616     C*
267600200616     C**  EXECUTE HASH TOTALLING SUBROUTINE ONCE (Z=1) FOR FIRST
267700200616     C*   ARRAY ELEMENTS (IND,S DEC,S) SO S=1 ,ACCUMULATING ZZAMT(15/3)
267800200616     C*
267900200616     C                     Z-ADD1         Z
268000200616     C                     Z-ADD1         S
268100200616     C                     Z-ADDEVAM      ZZAMT
268200200616     C                     EXSR ZHASH
268300200616     C*
268400200616     C**   Account Key           KEY IN FORMAT 'iiiM-X------Svn---CV'
268500200616     C**                         iii = Investment type, SECTYD
268600200616     C**                         v   = if convertible indic. in A/c key
268700200616     C**                               SDSTRPD *EQ 'Y' and
268800200616     C**                               convertible indic.SECTYD = 'Y'
268900200616     C**                                Output 'Y'
269000200616     C**                               Otherwise *BLANKS
269100200616     C**                         n   = If Split negative accrual ind,SDSTRDPD
269200200616     C**                               *EQ 'Y' and 'Nominal allocated' negative
269300200616     C**                               Set to 'N'
269400200616     C**                               Otherwise *BLANKS
269500200616     C                     MOVE SITP      WACITY
269600200616     C                     MOVE 'M'       WACEVC
269700200616     C                     MOVE ' '       WACTRT
269800200616     C                     MOVE 'X'       WACPFI
269900200616     C                     MOVE '  '      WACBKC
270000200616     C                     MOVE '  '      WACTST
270100200616     C                     MOVE '  '      WACCCC
270200200616     C                     MOVE 'S'       WACMKT
270300200616     C           BVCIAK    IFEQ 'Y'
270400200616     C           SCVI      ANDEQ'Y'
270500200616     C                     MOVE 'Y'       WACCON
270600200616     C                     ELSE
270700200616     C                     MOVE ' '       WACCON
270800200616     C                     ENDIF
270900200616     C                     MOVE *BLANKS   WACNEG
271000200616     C                     MOVE 'CV'      WACAMC
271100200616     C*
271200200616     C                     MOVELWACKEY    ACKY
271300200616     C*
271400200616     C**   Trade Reference       Zero
271500200616     C                     MOVE 0         TRFR
271600200616     C**   Customer Number       Customer, SEERDPPD
271700200616     C                     MOVE VBDDPT    CSTN
271800200616     C**   Branch                Branch,SEERDPPD
271900200616     C***********          MOVE VBBRCD    BRCH                            S01496
272000200616     C                     MOVE VBBRCD    BRHA                            S01496
272100200616     C**   Account Sequence Num. 0
272200200616     C***********          MOVE 0         ACSQ                            S01496
272300200616     C                     MOVE 0         ASQN                            S01496
272400200616     C**   Event Date            Redemption Date
272500200616     C                     MOVELVAERRD    EVDT
272600200616     C**   Event Amount          (EVAM filled before)
272700200616     C**   Event Currency        Nominal Currency, SECTYD
272800200616     C                     MOVELNMCY      EVCY
272900200616     C** Settlement Instructions from P007: (As for depot positions)
273000200616     C**   Settlement Type
273100200616     C                     Z-ADDWPSMT     STLT
273200200616     C**   Settlement Account
273300200616     C                     MOVELWPSEA     STLA
273400200616     C**   Settlement Branch                                              S01496
273500200616     C                     MOVELWPSEB     SEBR                            S01496
273600200616     C**   Reversal Indicator    If ER is being reversed Set to '1'
273700200616     C**                         Else Set to '0'
273800200616     C           VAERST    IFEQ 'R'
273900200616     C                     MOVE '1'       RVRS
274000200616     C                     ELSE
274100200616     C                     MOVE '0'       RVRS
274200200616     C                     ENDIF
274300200616     C**   Issuer                Issuer from Security
274400200616     C**   Our Depot Customer    Depot, SEERDPPD
274500200616     C                     MOVELVBDDPT    KCUST
274600200616     C**   Nominal Currency Amount
274700200616     C                     MOVE 0         KNCA
274800200616     C**   Nominal Currency      Nominal currency, SECTYD
274900200616     C                     MOVE NMCY      KCCY
275000200616     C**   Base Currency Amount  0
275100200616     C                     Z-ADD0         KBCA
275200200616     C**   Security Shortname    Security, SEERRFPD
275300200616     C                     MOVE VASESN    SESH
275400200616     C**   Profit Centre                                                  S01496
275500200616     C           *IN40     IFEQ '1'                                       CAC003
275600200616     C                     MOVE BVSEPC    PRFC                            CAC003
275700200616     C                     ELSE                                           CAC003
275800200616     C                     MOVE *BLANKS   PRFC                            S01496
275900200616     C                     ENDIF                                          CAC003
276000200616     C**   Portfolio Reference   BLANKS
276100200616     C                     MOVE *BLANKS   PTFR
276200200616     C**   Trans.no of last upd  0
276300200616     C                     Z-ADD0         TNLU
276400200616     C**   Record_ID
276500200616     C                     MOVE 'D'       RECI
276600200616      *                                                                                       CGL020
276700200616      ** If Midas Compliance Watch is installed                                               CGL020
276800200616      *                                                                                       CGL020
276900200616     C           CGL020    IFEQ 'Y'                                                           CGL020
277000200616     C                     EXSR SRAMPR                                                        CGL020
277100200616     C                     ENDIF                                                              CGL020
277200200616     C*
277300200616     C***COUNT*RECORDS*WRITTEN*****************************************                       234874
277400200616     C**********           ADD  1         W01CNT                                              234874
277500200616     C*
277600200616     C** WRITE GENERATED ACCOUNT KEY RECORD
277700200616     C           EVAM      IFNE 0                                                             234874
277800200616     C*  COUNT RECORDS WRITTEN only if write an account key                                   234874
277900200616     C                     ADD  1         W01CNT                                              234874
278000200616     C                     WRITESEKEYDF
278100200616     C                     ENDIF                                           234874
278200200616     C*
278300200616     C           W101E     ENDSR
278400200616     C*
278500200616     C**********************************************************************
278600200616      /EJECT
278700200616     C**********************************************************************
278800200616     C* W102     - WRITE POSITION SETTLEMENT
278900200616     C**********************************************************************
279000200616     C*
279100200616     C           W102      BEGSR                           **   W102  * *
279200200616     C*
279300200616     C** Branch Code                          Branch Code,SEERDPPD
279400200616     C***********          MOVE VBBRCD    PBCH                            S01496
279500200616     C                     MOVE VBBRCD    PBCA                            S01496
279600200616     C** Security short name                  Short name,SEERRFPD
279700200616     C                     MOVE VASESN    PSSH
279800200616     C** Counterparty                         Depot number,SEERDPPD
279900200616     C                     MOVELVBDDPT    PCPY
280000200616     C** Market                               Market,SECTYD
280100200616     C                     MOVELMKTI      PMAR
280200200616     C** Due Date                             Redemption Date,SEERRFPD
280300200616     C                     Z-ADDVAERRD    PDUD
280400200616     C** Event Type
280500200616     C                     MOVEL'RC'      PEVT
280600200616     C** Authorized Indicator                 Autopost Pos.Settlement
280700200616     C***********BVAPS     IFEQ 'Y'                                       S01496
280800200616     C           BVAPST    IFEQ 'Y'                                       S01496
280900200616     C                     MOVE 'Y'       PAUI
281000200616     C                     ELSE
281100200616     C                     MOVE *BLANKS   PAUI
281200200616     C                     END
281300200616     C** Nominal Position            Nominal to be redeemed, SEERDPPD
281400200616     C                     Z-ADDVBNRDM    PNMP
281500200616     C** Value Currency              Security Nominal Currency,SECTY
281600200616     C                     MOVELNMCY      PNCY
281700200616     C** Book Code                   Default Market Book,SDSTRDPD
281800200616     C                     MOVELBVDMBC    PBCD
281900200616     C** Amount Due           Nominal to be redeemed X Redemption Price
282000200616     C**                      Calculated via SR/ZAPNUM
282100200616     C                     Z-ADDZVALU     PAMD
282200200616     C** Pay/Receive Indicator
282300200616     C                     MOVEL'R'       PPRE
282400200616     C***Settlement*Currency*********Nominal*Currency,SECTYD***********   160338
282500200616     C***********          MOVELNMCY      PSCU                            160338
282600200616     C***Settlement*Exchange*Rate**************************************   160338
282700200616     C***********          Z-ADD1         PSXR                            160338
282800200616     C***Multiply/Divide*Indicator*************************************   160338
282900200616     C***********          MOVEL'M'       PMDI                            160338
283000200616     C** Base Currency Exchange Rate     Spot rate Nominal to Base CCY
283100200616     C                     Z-ADDWNSPRT    PBRX
283200200616     C** Settlement Instructions from P007:
283300200616     C** Settlement Method
283400200616     C                     Z-ADDWPSMT     PSMT
283500200616     C** Settlement Account
283600200616     C                     MOVELWPSEA     PSEA
283700200616     C** Settlement Branch
283800200616     C                     MOVELWPSEB     PSEB
283900200616     C*                                                                   234054
284000200616      ** If Settlement Branch is *blank - DB error in SE1540              234054
284100200616     C*                                                                   234054
284200200616     C           PEVT      IFEQ 'RC'                                      234054
284300200616     C           PSEB      ANDEQ'   '                                     234054
284400200616     C                     MOVE VBBRCD    PSEB                            234054
284500200616     C                     END                                            234054
284600200616     C*                                                                   234054
284700200616     C** Counterparty Bank
284800200616     C                     MOVELWPCPN     PCPN
284900200616     C** For Account Of
285000200616     C                     MOVELWPFAC     PFAC
285100200616     C** Special Instructions
285200200616     C                     MOVELWPSPI     PSPI
285300200616     C** Charge Code
285400200616     C                     MOVEL*BLANKS   PCHC
285500200616     C** Charge Amount
285600200616     C                     Z-ADD0         PCHA
285700200616     C** Commission Code
285800200616     C                     MOVEL*BLANKS   PCCD
285900200616     C** Commission Amount
286000200616     C                     Z-ADD0         PCAM
286100200616     C** Settlement Amount
286200200616     C                     Z-ADDPAMD      PSAT
286300200616     C*                                                                   160338
286400200616     C** Convert Settlement Amount from Nominal Currency                  160338
286500200616     C** to Settlement Currency                                           160338
286600200616     C*                                                                   160338
286700200616     C           PSCU      IFNE NMCY                                      160338
286800200616     C                     Z-ADDPSAT      ZAMTF                           160338
286900200616     C                     MOVE NMCY      ZCCYF                           160338
287000200616     C                     Z-ADDWNSPRT    ZRATEF                          160338
287100200616     C                     MOVE WNMDIN    ZMDINF                          160338
287200200616     C                     Z-ADDWNNBDP    ZCDPF                           160338
287300200616     C*                                                                   160338
287400200616     C** Settlement Currency (TO)                                         160338
287500200616     C*                                                                   160338
287600200616     C                     CALL 'AOCURRR0'                                160338
287700200616     C                     PARM *BLANKS   WLRTCD                          160338
287800200616     C                     PARM '*KEY  '  WLOPTN                          160338
287900200616     C                     PARM PSCU      WLCYCD                          160338
288000200616     C           SDCURR    PARM SDCURR    DSSDY                           160338
288100200616     C           WLRTCD    IFNE *BLANKS                                   160338
288200200616     C                     MOVE 'SDCURRPD'DBFILE           ***************160338
288300200616     C                     MOVELPSCU      DBKEY            * DB ERROR 14 *160338
288400200616     C                     Z-ADD14        DBASE            ***************160338
288500200616     C                     EXSR *PSSR                                     160338
288600200616     C                     ELSE                                           160338
288700200616     C                     MOVE PSCU      ZCCYT                           160338
288800200616     C                     MOVE A6SPRT    ZRATET                          160338
288900200616     C                     MOVE A6MDIN    ZMDINT                          160338
289000200616     C                     MOVE A6NBDP    ZCDPT                           160338
289100200616     C                     ENDIF                                          160338
289200200616     C*                                                                   160338
289300200616     C** Currency Conversion                                              160338
289400200616     C*                                                                   160338
289500200616     C                     EXSR ZCCYCN                                    160338
289600200616     C*                                                                   160338
289700200616     C** Settlement Amount                                                160338
289800200616     C*                                                                   160338
289900200616     C                     Z-ADDZAMTT     PSAT                            160338
290000200616     C                     ELSE                                           160338
290100200616     C                     Z-ADD1         PSXR                            160338
290200200616     C                     MOVEL'M'       PMDI                            160338
290300200616     C                     ENDIF                                          160338
290400200616     C** Message Indicator
290500200616     C                     MOVEL*BLANKS   PSMI
290600200616     C** Date Generated           Run Date
290700200616     C                     MOVE BJRDNB    PDTG
290800200616     C** Last Change Date         Run Date
290900200616     C                     MOVE BJRDNB    LCD
291000200616     C** Type of last change
291100200616     C                     MOVEL'I'       CHTP
291200200616     C** Transaction number of last update
291300200616     C                     EXSR ZTNLU1
291400200616     C***********          MOVELFNATN     TNL1                            S01496
291500200616     C                     MOVELFNATN     TNLU                            S01496
291600200616     C** Portfolio Reference
291700200616     C                     MOVEL*BLANKS   PTFR
291800200616     C** Position Settl. Value Date   PAYMENT DATE, SEERRFPD
291900200616     C***********          MOVE VAERPD    PSVL                            S01496
292000200616     C                     MOVE VAERPD    PSVL                      S01496095236
292100200616     C** Settlement Reversal Postings Gen
292200200616     C                     MOVEL*BLANKS   SRPG
292300200616     C** Record ID       'D'
292400200616     C                     MOVE 'D'       RECI
292500200616     C*
292600200616     C** COUNT RECORDS WRITTEN
292700200616     C                     ADD  1         W02CNT
292800200616     C*                                                                   CAC003
292900200616     C** Move SE Profit Centre to PPFC if *IN40 is on.                    CAC003
293000200616     C           *IN40     IFEQ '1'                                       CAC003
293100200616     C                     MOVE BVSEPC    PPFC                            CAC003
293200200616     C                     ENDIF                                          CAC003
293300200616     C*                                                                   CAC003
293400200616     C** Initialise FXMP, FXMR, and MAMT to zero                          CAC003
293500200616     C                     Z-ADD0         FXMP                            CAC003
293600200616     C                     Z-ADD0         FXMR                            CAC003
293700200616     C                     Z-ADD0         MAMT                            CAC003
293800200616     C*
293900200616     C** Initialise DAMT to zero                                          189109
294000200616     C                     Z-ADD0         DAMT                            189109
294100200616     C*                                                                   189109
294200200616     C** WRITE POSITION SETTLEMENT RECORD
294300200616     C                     WRITEPOSETDF
294301200616     C                     EXSR PSAUDT                                                      AR324886
294400200616     C*
294500200616     C           W102E     ENDSR
294600200616     C*
294700200616     C********************************************************************
294800200616      /EJECT
294900200616     C********************************************************************
295000200616     C**P102******-*WRITE*POSITION*SETTLEMENT*EXTENSION****************   S01496
295100200616     C********************************************************************
295200200616     C***********                                                         S01496
295300200616     C***********P102      BEGSR                           **  P102  **   S01496
295400200616     C***********                                                         S01496
295500200616     C**WRITE*A*RECORD*IN*THE*POSITION*SETTLEMENT*EXTENSION*FILE*******   S01496
295600200616     C***********                                                         S01496
295700200616     C***********          Z-ADDPBCH      POPBCH                          S01496
295800200616     C***********          MOVE PSSH      POPSSH                          S01496
295900200616     C***********          Z-ADDPCPY      POPCPY                          S01496
296000200616     C***********          Z-ADDPDUD      POPDUD                          S01496
296100200616     C***********          MOVE PEVT      POPEVT                          S01496
296200200616     C***********                                                         S01496
296300200616     C***********          WRITEPOSETDD0                                  S01496
296400200616     C***********                                                         S01496
296500200616     C***********          ENDSR                                          S01496
296600200616     C**********************************************************************
296700200616      /EJECT
296800200616     C**********************************************************************
296900200616     C* W201     - WRITE ACCOUNT KEY
297000200616     C**********************************************************************
297100200616     C*
297200200616     C           W201      BEGSR                           **   W01  **
297300200616     C*
297400200616     C**  EXECUTE HASH TOTALLING SUBROUTINE ONCE (Z=1) FOR FIRST
297500200616     C*   ARRAY ELEMENTS (IND,S DEC,S) SO S=1 ,ACCUMULATING ZZAMT(15/3)
297600200616     C*
297700200616     C                     Z-ADD1         Z
297800200616     C                     Z-ADD1         S
297900200616      *                                                                                       234874
298000200616     C           CGL031    IFNE 'Y'                                                           234874
298100200616     C           SETX      ORNE 'Y'                                                           234874
298200200616     C           CGL031    ANDEQ'Y'                                                           234874
298300200616     C                     Z-ADDEVAM      ZZAMT                                               234874
298400200616     C                     ELSE                                                               234874
298500200616     C                     Z-ADDPAMD      ZZAMT                                               234874
298600200616     C                     END                                                                234874
298700200616     C**********           Z-ADDEVAM      ZZAMT                                               234874
298800200616     C                     EXSR ZHASH
298900200616     C*
299000200616     C** DETAIL OUTPUT FOR DEPOT AS BELOW:
299100200616     C**   Account Key           KEY IN FORMAT 'iiiM-X------Svn---CV'
299200200616     C**                         iii = Investment type, SECTYD
299300200616     C**                         v   = if convertible indic. in A/c key
299400200616     C**                               SDSTRPD *EQ 'Y' and
299500200616     C**                               convertible indic.SECTYD = 'Y'
299600200616     C**                                Output 'Y'
299700200616     C**                               Otherwise *BLANKS
299800200616     C**                         n   = If Split negative accrual ind,SDSTRDPD
299900200616     C**                               *EQ 'Y' and 'Nominal allocated' negative
300000200616     C**                               Set to 'N'
300100200616     C**                               Otherwise *BLANKS
300200200616     C                     MOVE SITP      WACITY
300300200616     C                     MOVE 'M'       WACEVC
300400200616     C                     MOVE ' '       WACTRT
300500200616     C                     MOVE VCCNUM    WWCNUM  6
300600200616     C***********WWCNUM    CHAINSDSECSL0             89                   S01496
300700200616     C*                                                                   S01496
300800200616     C                     CALL 'AOSECSR0'                                S01496
300900200616     C                     PARM *BLANKS   WLRTCD                          S01496
301000200616     C                     PARM '*KEY  '  WLOPTN                          S01496
301100200616     C                     PARM WWCNUM    WLCUSN                          S01496
301200200616     C           SDSECS    PARM SDSECS    DSSDY                           S01496
301300200616     C*                                                                   S01496
301400200616     C************IN89     IFEQ '0'                                       S01496
301500200616     C           WLRTCD    IFEQ *BLANKS                                   S01496
301600200616     C                     MOVE BFCLAS    WACPFI
301700200616     C                     ENDIF
301800200616     C                     MOVE '  '      WACBKC
301900200616     C                     MOVE '  '      WACTST
302000200616     C                     MOVE '  '      WACCCC
302100200616     C                     MOVE 'S'       WACMKT
302200200616     C           BVCIAK    IFEQ 'Y'
302300200616     C           SCVI      ANDEQ'Y'
302400200616     C                     MOVE 'Y'       WACCON
302500200616     C                     ELSE
302600200616     C                     MOVE ' '       WACCON
302700200616     C                     ENDIF
302800200616     C           BVSNIN    IFEQ 'Y'
302900200616     C           VCNOMA    ANDLT*ZEROS
303000200616     C                     MOVE 'N'       WACNEG
303100200616     C                     ELSE
303200200616     C                     MOVE *BLANKS   WACNEG
303300200616     C                     ENDIF
303400200616     C                     MOVE 'CV'      WACAMC
303500200616     C                     MOVELWACKEY    ACKY
303600200616     C*
303700200616     C**   Trade Reference       Zero
303800200616     C                     MOVE 0         TRFR
303900200616     C**   Customer Number       Customer,SEERALPD
304000200616     C                     MOVE VCCNUM    CSTN
304100200616     C**   Branch                Branch,SEERALPD
304200200616     C***********          MOVE VCBRCD    BRCH                            S01496
304300200616     C                     MOVE VCBRCD    BRHA                            S01496
304400200616     C**   Account Sequence Number
304500200616     C***********          MOVE 0         ACSQ                            S01496
304600200616     C                     MOVE 0         ASQN                            S01496
304700200616     C**   Event Date            Redemption Date
304800200616     C                     MOVELVAERRD    EVDT
304900200616     C**   Event Amount          Nominal allocated X Redemption Price
305000200616     C           CGL031    IFNE 'Y'                                                           234874
305100200616     C           SETX      ORNE 'Y'                                                           234874
305200200616     C           CGL031    ANDEQ'Y'                                                           234874
305300200616     C                     Z-ADDZVALU     EVAM
305400200616     C                     ELSE                                                               234874
305500200616     C                     Z-ADDPAMD      EVAM                                                234874
305600200616     C                     END                                                                234874
305700200616     C**   Event Currency        Nominal Currency, SECTYD
305800200616     C                     MOVELNMCY      EVCY
305900200616     C**   Settlement Instructions as per P009
306000200616     C**   Settlement Type
306100200616     C                     Z-ADDWPSMT     STLT
306200200616     C**   Settlement Account
306300200616     C                     MOVE WPSEA     STLA
306400200616     C**   Settlement Branch                                              S01496
306500200616     C                     MOVE WPSEB     SEBR                            S01496
306600200616     C**   Reversal Indicator    If ER is being reversed Set to '1'
306700200616     C**                         Else Set to '0'
306800200616     C           VAERST    IFEQ 'R'
306900200616     C                     MOVE '1'       RVRS
307000200616     C                     ELSE
307100200616     C                     MOVE '0'       RVRS
307200200616     C                     ENDIF
307300200616     C**   Issuer                Issuer from Security
307400200616     C**   Our Depot Customer    Depot, SEERALPD
307500200616     C                     MOVELVBDDPT    KCUST            ?10A/6N
307600200616     C**   Nominal Currency Am   0
307700200616     C                     MOVE 0         KNCA
307800200616     C**   Nominal Currency      Nominal currency, SECTYD
307900200616     C                     MOVE NMCY      KCCY
308000200616     C**   Base Currency Amount  0
308100200616     C                     Z-ADD0         KBCA
308200200616     C**   Security Shortname    Security, SEERRFPD
308300200616     C                     MOVE VASESN    SESH
308400200616     C**   Profit Centre                                                  S01496
308500200616     C           *IN40     IFEQ '1'                                       CAC003
308600200616     C           FIND      ANDEQ'Y'                                       CAC003
308700200616     C                     MOVE PCCU      PRFC                            CAC003
308800200616     C                     ELSE                                           CAC003
308900200616     C                     MOVE *BLANKS   PRFC                            S01496
309000200616     C                     ENDIF                                          CAC003
309100200616     C**   Portfolio Reference   BLANKS
309200200616     C                     MOVE VCPTFR    PTFR
309300200616     C**   Trans.no of last upd  0
309400200616     C                     Z-ADD0         TNLU
309500200616     C**   Record_ID
309600200616     C                     MOVE 'D'       RECI
309700200616      *                                                                                       CGL020
309800200616      ** If Midas Compliance Watch is installed                                               CGL020
309900200616      *                                                                                       CGL020
310000200616     C           CGL020    IFEQ 'Y'                                                           CGL020
310100200616     C                     EXSR SRAMPR                                                        CGL020
310200200616     C                     ENDIF                                                              CGL020
310300200616     C*
310400200616     C***Count*of*record*written***************************************                       234874
310500200616     C**********           ADD  1         W01CNT                                              234874
310600200616     C*
310700200616     C** Write Generated Account Key Record
310800200616     C           EVAM      IFNE 0                                                             234874
310900200616     C*  COUNT RECORDS WRITTEN only if write an account key                                   234874
311000200616     C                     ADD  1         W01CNT                                              234874
311100200616     C                     WRITESEKEYDF
311200200616     C                     ENDIF                                           234874
311300200616     C*
311400200616     C           W201E     ENDSR                           ** ENDW01 **
311500200616     C*
311600200616     C**********************************************************************
311700200616      /EJECT
311800200616     C**********************************************************************
311900200616     C* W202      - WRITE POSITION SETTLEMENT
312000200616     C**********************************************************************
312100200616     C           W202      BEGSR                           **   W02  * *
312200200616     C*
312300200616     C** Branch Code                           Branch Code,SEERALPD
312400200616     C***********          MOVE VCBRCD    PBCH                            S01496
312500200616     C                     MOVE VCBRCD    PBCA                            S01496
312600200616     C** Security Short Name                   ,SEERRFPD
312700200616     C                     MOVE VASESN    PSSH
312800200616     C** Counterparty                          Customer Number,SEERALPD
312900200616     C                     MOVELVCCNUM    PCPY
313000200616     C** Market                                Market,SECTYD
313100200616     C                     MOVELMKTI      PMAR
313200200616     C** Due Date                              Redemption Date,SEERRFPD
313300200616     C                     MOVELVAERRD    PDUD
313400200616     C** Event Type
313500200616     C                     MOVEL'RC'      PEVT
313600200616     C** Authorized Indicator         Autopost position Settl.,SDSTRDPD
313700200616     C***********BVAPS     IFEQ 'Y'                                       S01496
313800200616     C           BVAPST    IFEQ 'Y'                                       S01496
313900200616     C                     MOVE 'Y'       PAUI
314000200616     C                     ELSE
314100200616     C                     MOVE *BLANKS   PAUI
314200200616     C                     END
314300200616     C** Nominal Position               Nominal to be redeemed,SEERDPPD
314400200616     C                     Z-ADDVCNOMA    PNMP
314500200616     C** Value Currency                          Nominal Currency,SECTY
314600200616     C                     MOVELNMCY      PNCY
314700200616     C** Book Code                        DEFAULT MARKET BOOK, SDSTRDPD
314800200616     C                     MOVELBVDMBC    PBCD
314900200616     C** Amount Due           ABS(Nominal Allocated) X REDEMPTION PRICE
315000200616     C**                      CALCULATE VIA SR/ZAPNUM
315100200616     C           CGL031    IFNE 'Y'                                                           233712
315200200616     C           SETX      ORNE 'Y'                                                           233712
315300200616     C           CGL031    ANDEQ'Y'                                                           233712
315400200616     C                     Z-ADDZVALU     PAMD
315500200616     C                     ELSE                                                               233712
315600200616     C********** WNOMAT    SUB  TXNM      PAMD                                         233712 234874
315700200616     C                     Z-ADDWNOMAT    PAMD                                                234874
315800200616     C           PAMD      SUB  TXNM      PAMD1  130                                          234874
315900200616     C                     ENDIF                                                              233712
316000200616     C** Pay/Receive Indicator
316100200616     C           VCNOMA    IFGT 0
316200200616     C                     MOVEL'P'       PPRE
316300200616     C                     ELSE
316400200616     C                     MOVEL'R'       PPRE
316500200616     C                     ENDIF
316600200616     C** Settlement instructions from P009
316700200616     C** Settlement Currency
316800200616     C                     MOVELWPSCU     PSCU
316900200616     C** Settlement Method
317000200616     C                     MOVE WPSMT     PSMT
317100200616     C** Settlement Account
317200200616     C                     MOVELWPSEA     PSEA
317300200616     C** Settlement Branch
317400200616     C                     MOVELWPSEB     PSEB
317500200616     C*                                                                   234054
317600200616      ** If Settlement Branch is *blank - DB error in SE1540              234054
317700200616     C*                                                                   234054
317800200616     C           PEVT      IFEQ 'RC'                                      234054
317900200616     C           PSEB      ANDEQ'   '                                     234054
318000200616     C                     MOVE VCBRCD    PSEB                            234054
318100200616     C                     END                                            234054
318200200616     C*                                                                   234054
318300200616     C*                                                                   160338
318400200616     C** Charge code, Charge amount, Commission code                      160338
318500200616     C** and Commission amount                                            160338
318600200616     C*                                                                   160338
318700200616     C                     MOVEL*BLANKS   PCHC                            160338
318800200616     C                     Z-ADD0         PCHA                            160338
318900200616     C                     MOVEL*BLANKS   PCCD                            160338
319000200616     C                     Z-ADD0         PCAM                            160338
319100200616     C*                                                                   160338
319200200616     C** Determine default charges from SEDFTCPD. (SEDFTCL2) only         160338
319300200616     C** if 'Position Settlements Auto-Charges' feature is on.            160338
319400200616     C*                                                                   160338
319500200616     C           S01519    IFEQ 'Y'                                       160338
319600200616     C                     EXSR P04                                       160338
319700200616     C/COPY WNCPYSRC,SE6720C015                                           160338
319800200616     C                     END                                            160338
319900200616     C*                                                                   160338
320000200616     C** Calculate Settlement Amount                                      160338
320100200616     C*                                                                   160338
320200200616     C                     EXSR P06                                       160338
320300200616     C** Base Currency Echange Rate       (Value CCY to Settlement CCY)
320400200616     C** Value Currency (FROM)=Security Nominal CCY - Saved values used
320500200616     C***********          Z-ADD1         ZAMTF                           160338
320600200616     C*                                                                   160338
320700200616     C** Convert Settlement Amount from Nominal Currency                  160338
320800200616     C** to Settlement Currency                                           160338
320900200616     C*                                                                   160338
321000200616     C           PSCU      IFNE NMCY                                      160338
321100200616     C                     Z-ADDPSAT      ZAMTF                           160338
321200200616     C                     MOVE NMCY      ZCCYF
321300200616     C                     Z-ADDWNSPRT    ZRATEF
321400200616     C                     MOVE WNMDIN    ZMDINF
321500200616     C                     Z-ADDWNNBDP    ZCDPF
321600200616     C*
321700200616     C** Settlement Currency (TO)
321800200616     C***********PSCU      CHAINSDCURRL1             89                   S01496
321900200616     C*                                                                   S01496
322000200616     C                     CALL 'AOCURRR0'                                S01496
322100200616     C                     PARM *BLANKS   WLRTCD                          S01496
322200200616     C                     PARM '*KEY  '  WLOPTN                          S01496
322300200616     C                     PARM PSCU      WLCYCD                          S01496
322400200616     C           SDCURR    PARM SDCURR    DSSDY                           S01496
322500200616     C*                                                                   S01496
322600200616     C************IN89     IFEQ '1'                                       S01496
322700200616     C           WLRTCD    IFNE *BLANKS                                   S01496
322800200616     C***********          MOVEL'SDCURRL1'DBFILE           ***************S01496
322900200616     C                     MOVE 'SDCURRPD'DBFILE           ***************S01496
323000200616     C                     MOVELPSCU      DBKEY            ** DB ERROR 11 **
323100200616     C                     Z-ADD11        DBASE            *****************
323200200616     C                     EXSR *PSSR
323300200616     C                     ELSE
323400200616     C                     MOVE PSCU      ZCCYT
323500200616     C                     MOVE A6SPRT    ZRATET
323600200616     C                     Z-ADDA6SPRT    WWSPOT 138                      CH0273
323700200616     C                     MOVE A6MDIN    WWMDIN  1                       CH0273
323800200616     C                     MOVE A6MDIN    ZMDINT
323900200616     C                     MOVE A6NBDP    ZCDPT
324000200616     C                     ENDIF
324100200616     C** Settlement Exchange Rate
324200200616     C/COPY WNCPYSRC,SE6720C002
324300200616     C                     EXSR ZCCYCN
324400200616     C/COPY WNCPYSRC,SE6720C003
324500200616     C                     Z-ADDZCRSRT    PSXR
324600200616     C                     Z-ADDZAMTT     PSAT                            160338
324700200616     C** Multiply/Divide Indicator
324800200616     C                     MOVE ZCRSMD    PMDI
324900200616     C                     ELSE                                           160338
325000200616     C                     Z-ADD1         PSXR                            160338
325100200616     C                     MOVEL'M'       PMDI                            160338
325200200616     C                     ENDIF                                          160338
325300200616     C** Base Currency Exchange Rate
325400200616     C***********          Z-ADDZRATET    PBRX                            160338
325500200616     C                     Z-ADDWNSPRT    PBRX                            160338
325600200616     C** Counterparty Bank
325700200616     C                     MOVEL*BLANKS   PCPN
325800200616     C** For Account of
325900200616     C                     MOVEL*BLANKS   PFAC
326000200616     C** Special Instructions
326100200616     C                     MOVEL*BLANKS   PSPI
326200200616     C***Charge*Code***************************************************   160338
326300200616     C***********          MOVEL*BLANKS   PCHC                            160338
326400200616     C***Charge*Amount*************************************************   160338
326500200616     C***********          Z-ADD0         PCHA                            160338
326600200616     C***Commission*Code***********************************************   160338
326700200616     C***********          MOVEL*BLANKS   PCCD                            160338
326800200616     C***Commission*Amount*********************************************   160338
326900200616     C***********          Z-ADD0         PCAM                            160338
327000200616     C*                                                                   S01496
327100200616     C***Determine*default*charges*from*SEDFTCPD.*(SEDFTCL2)***********   160338
327200200616     C****only*if*"Position*Settlements*Autocharges"*feature*is*on S01496 160338
327300200616     C*                                                                   S01496
327400200616     C***********S01519    IFEQ 'Y'                                S01496 160338
327500200616     C***********          EXSR P04                                       160338
327600200616     C*/C*PY*WNCPYSRC,SE6720C015***************************************   160338
327700200616     C***********          END                                     S01496 160338
327800200616     C*                                                                   S01496
327900200616     C***Calculate*Settlement*Amount***********************************   160338
328000200616     C***********          EXSR P06                                       160338
328100200616     C** Message Indicator
328200200616     C                     MOVEL*BLANKS   PSMI
328300200616     C** Date generated           RUN DATE
328400200616     C                     MOVE BJRDNB    PDTG
328500200616     C** Last change date         RUN DATE
328600200616     C                     MOVE BJRDNB    LCD
328700200616     C** Type of last change
328800200616     C                     MOVEL'I'       CHTP
328900200616     C** Transaction number of update
329000200616     C                     EXSR ZTNLU1
329100200616     C***********          MOVELFNATN     TNL1                            S01496
329200200616     C                     MOVELFNATN     TNLU                            S01496
329300200616     C** Portfolio reference
329400200616     C                     MOVELVCPTFR    PTFR
329500200616     C** Position settl. value date = PAYMENT DATE, SEERRFPD
329600200616     C***********          MOVE VAERPD    PSVL                            S01496
329700200616     C                     MOVE VAERPD    PSVL                      S01496095236
329800200616     C** Settlement reversal postings gen.
329900200616     C                     MOVEL*BLANKS   SRPG
330000200616     C** Record_ID       'D'
330100200616     C                     MOVE 'D'       RECI
330200200616     C*                                                                   CEU005
330300200616     C** If CEU005 active, use 'In' ccy values for settlement details     CEU005
330400200616     C*                                                                   CEU005
330500200616     C           CEU005    IFEQ 'Y'                                       CEU005
330600200616     C           SVSCCY    ANDNE*BLANKS                                   CEU005
330700200616     C                     MOVE SVEUER    PSXR                            CEU005
330800200616     C***********SVSCCY    IFEQ BKEURO                             CEU005 160338
330900200616     C           NMCY      IFEQ BKEURO                                    160338
331000200616     C           SVEUMD    IFEQ 'M'                                       CEU005
331100200616     C                     MOVE 'D'       PMDI                            CEU005
331200200616     C                     ELSE                                           CEU005
331300200616     C                     MOVE 'M'       PMDI                            CEU005
331400200616     C                     ENDIF                                          CEU005
331500200616      *                                                                   CEU005
331600200616      * Settlement ccy not Euro ccy, use Euro M/D indicator.              CEU005
331700200616     C                     ELSE                                           CEU005
331800200616     C                     MOVE SVEUMD    PMDI                            CEU005
331900200616     C                     ENDIF                                          CEU005
332000200616      * Use standard settlement ccy for position settlement ccy           CEU005
332100200616     C                     MOVE SVSCCY    PSCU                            CEU005
332200200616     C                     ENDIF                                          CEU005
332300200616     C*
332400200616     C** Count records written
332500200616     C                     ADD  1         W02CNT
332600200616     C*                                                                   CAC003
332700200616     C** Move PCCU to PPFC if *IN40 is on.                                CAC003
332800200616     C           *IN40     IFEQ '1'                                       CAC003
332900200616     C           FIND      ANDEQ'Y'                                       CAC003
333000200616     C                     MOVE PCCU      PPFC                            CAC003
333100200616     C                     ELSE                                           CAC003
333200200616     C                     MOVE *BLANKS   PPFC                            CAC003
333300200616     C                     ENDIF                                          CAC003
333400200616     C*                                                                   CAC003
333500200616     C** Initialise FXMP, FXMR, and MAMT to zero.                         CAC003
333600200616     C                     Z-ADD0         FXMP                            CAC003
333700200616     C                     Z-ADD0         FXMR                            CAC003
333800200616     C                     Z-ADD0         MAMT                            CAC003
333900200616     C*                                                                   189109
334000200616     C** Initialise DAMT to zero                                          189109
334100200616     C                     Z-ADD0         DAMT                            189109
334200200616     C*
334300200616     C** Write Position Settlement Record
334400200616     C                     WRITEPOSETDF
334401200616     C                     EXSR PSAUDT                                                      AR324886
334500200616     C*
334600200616     C           W202E     ENDSR                           ** ENDW02 **
334700200616     C*
334800200616     C********************************************************************
334900200616      /EJECT
335000200616     C********************************************************************
335100200616     C**P202******-*DEDUCE*IF*WITHHOLDING*TAX*IS*TO*BE*CALCULATED******   S01496
335200200616     C********************************************************************
335300200616     C***********                                                         S01496
335400200616     C***********P202      BEGSR                           **   P02  **   S01496
335500200616     C***********                                                         S01496
335600200616     C**WRITE*A*RECORD*IN*THE*POSITION*SETTLEMENT*EXTENSION*FILE*******   S01496
335700200616     C***********                                                         S01496
335800200616     C***********          MOVE PBCH      POPBCH                          S01496
335900200616     C***********          MOVE PSSH      POPSSH                          S01496
336000200616     C***********          MOVELPCPY      POPCPY                          S01496
336100200616     C***********          Z-ADDPDUD      POPDUD                          S01496
336200200616     C***********          MOVE PEVT      POPEVT                          S01496
336300200616     C***********          MOVE VCPTFR    POPTFR                          S01496
336400200616     C***********                                                         S01496
336500200616     C***********          WRITEPOSETDD0                                  S01496
336600200616     C***********                                                         S01496
336700200616     C***********ENP202    ENDSR                           ** ENDP02 **   S01496
336800200616     C***********                                                         S01496
336900200616     C**********************************************************************
337000200616     C/EJECT
337100200616     C**********************************************************************
337200200616     C           AUDIT     BEGSR                           ** AUDIT **
337300200616     C**********************************************************************
337400200616     C*
337500200616     C** UPDATE GEN A/C KEYS AUDIT AND POSN.SETT.AUDIT FIL             ES
337600200616     C*
337700200616     C                     Z-ADDW01CNT    NORE
337800200616     C                     Z-ADDINT,1     HRWN
337900200616     C                     Z-ADDDEC,1     HRDC
338000200616     C                     WRITESEKEYAF
338100200616     C                     Z-ADDW02CNT    NORE
338200200616     C                     Z-ADD*ZEROS    TNLU                            S01496
338300200616     C                     WRITEPOSETAF
338400200616     C*
338500200616     C* OUTPUT CONTROL REPORT
338600200616     C*
338700200616     C                     WRITEHEADAU
338800200616     C           *INU7     IFEQ '1'
338900200616     C                     WRITEERROR
339000200616     C                     ELSE
339100200616     C           W01CNT    IFEQ 0
339200200616     C           W02CNT    ANDEQ0
339300200616     C                     WRITENONE
339400200616     C                     ELSE
339500200616     C                     Z-ADDINT,1     WHASHT
339600200616     C                     Z-ADDDEC,1     WHASHD
339700200616     C                     WRITECONTROL
339800200616     C                     ENDIF
339900200616     C                     ENDIF
340000200616     C*
340100200616     C***********          WRITETRAILAU                                   S01496
340200200616     C*
340300200616     C                     ENDSR
340400200616      *****************************************************************                       233712
340500200616      /EJECT                                                                                  233712
340600200616      *****************************************************************                       233712
340700200616      *                                                               *                       233712
340800200616      *  ERTAX  - Subroutine to calculate tax for descretionary and   *                       233712
340900200616      *           safe custody customers.                             *                       233712
341000200616      *                                                               *                       233712
341100200616      *****************************************************************                       233712
341200200616      *                                                                                       233712
341300200616     C           ERTAX     BEGSR                                                              233712
341400200616      *                                                                                       233712
341500200616      ** Check if record needs to be taxed.                                                   233712
341600200616      *                                                                                       233712
341700200616     C                     EXSR CHKTAX                                                        233712
341800200616      *                                                                                       234440
341900200616      ** Calculate Tax Amount for the Redemption                                              234440
342000200616      *                                                                                       234440
342100200616     C           WNOTAX    IFEQ ' '                                                           234440
342200200616     C           ISSP      ANDNE100                                                           234440
342300200616      *                                                                                       234440
342400200616      ** Initialise work variables                                                            234874
342500200616      *                                                                                       234874
342600200616     C                     Z-ADD0         TXNM                                                234874
342700200616     C                     Z-ADD0         TXST                                                234874
342800200616     C                     Z-ADD0         TAXA                                                234874
342900200616     C                     MOVE *BLANKS   TXCY                                                234874
343000200616     C                     MOVE ' '       WTXPI   1                                           234874
343100200616     C                     MOVE ' '       WTXJA   1                                           234874
343200200616      *                                                                                       234874
343300200616      ** Get Fiscal Price at Event Date                                                       234440
343400200616      *                                                                                       234440
343500200616      ***If Country*of*Tax*is*not*Switzerland,*use*straight*line*basis                 234440 236137
343600200616      *****************************************************************                234440 236137
343700200616     C                     Z-ADDVAREDP    VARED2 158                                          235546
343800200616     C***********EWCTRT    IFNE 'CH'                                                   234440 236137
343900200616      *                                                                                       236137
344000200616      ** Choice of calculation method for fiscal price depends on Tax                         236137
344100200616      ** Calculation Basis indicator from Country of Tax Codes file.                          236137
344200200616      *                                                                                       236137
344300200616      ** Straight line basis:                                                                 236137
344400200616      *                                                                                       236137
344500200616     C           EWTXCB    IFEQ 'B'                                                           236137
344600200616     C                     CALL 'ZAINTPL2'                                                    234440
344700200616     C                     PARM           ISSD                                                234440
344800200616     C                     PARM           VAERRD                                              234440
344900200616     C                     PARM           MATY                                                234440
345000200616     C                     PARM           ISSP                                                234440
345100200616     C**********           PARM           VAREDP                                       234440 235546
345200200616     C                     PARM           VARED2                                              235546
345300200616     C                     PARM           WFSPR  158                                          234440
345400200616      *                                                                                       234440
345500200616      ***If*Country*of*Tax*is*Switzerland,*use*analytical*interpolation                234440 236137
345600200616      ** Actuarial interpolation:                                                             236137
345700200616      *                                                                                       234440
345800200616     C                     ELSE                                                               234440
345900200616     C                     CALL 'ZAACTUAR'                                                    234440
346000200616     C                     PARM           WRTCD  10                                           234440
346100200616     C                     PARM           ISSD                                                234440
346200200616     C                     PARM           ISSP                                                234440
346300200616     C                     PARM           MATY                                                234440
346400200616     C**********           PARM           VAREDP                                       234440 235546
346500200616     C                     PARM           VARED2                                              235546
346600200616     C                     PARM           DYBS                                                234440
346700200616     C                     PARM           DVBS                                                234440
346800200616     C                     PARM           CDDS                                                234440
346900200616     C                     PARM           CRDS                                                234440
347000200616     C                     PARM           LCPN                                              BUG11164
347100200616     C                     PARM           VAERRD                                              234440
347200200616     C                     PARM           WFSPR                                               234440
347300200616     C                     ENDIF                                                              234440
347400200616      *                                                                                       234440
347500200616      ** Always take the redemption price                                                     234874
347600200616      *                                                                                       234874
347700200616     C                     Z-ADDVARED2    WFSPR                                               234874
347800200616      *                                                                                       234440
347900200616      ** Get Average Fiscal Price of Position                                                 234440
348000200616      *                                                                                       234440
348100200616      *                                                                                       234440
348200200616      ** Access Customer Position                                                             234440
348300200616      *                                                                                       234440
348400200616     C                     CALL WPGM                                                          234440
348500200616     C                     PARM           WRTCD  10                                           234440
348600200616     C                     PARM           VCBRCD                                              234440
348700200616     C                     PARM           VCCNUM                                              234440
348800200616     C                     PARM           VCSESN                                              234440
348900200616     C                     PARM           VCPTFR                                              234440
349000200616     C                     PARM 'S'       WMKT    1                                           234440
349100200616     C                     PARM           VAEREX                                              234440
349200200616     C                     PARM           ETCPOS                                              234440
349300200616      *                                                                                       234440
349400200616     C                     Z-ADDAVFP      WAVFP  158                                          234440
349500200616      *                                                                                       234440
349600200616      ** Taxable amount is the difference between Fiscal Price and average                    234440
349700200616      ** Fiscal price x Nominal Amount                                                        234440
349800200616      *                                                                                       234440
349900200616     C           WFSPR     SUB  WAVFP     WFISC  158                                          234440
350000200616      *                                                                                       234440
350100200616      ********** SPBS      IFEQ 'P'                                                    234440 234874
350200200616      **********           DIV  100       WFISC     H                                  234440 234874
350300200616      **********           END                                                         234440 234874
350400200616      *                                                                                       233712
350500200616      ***FIND*THE*COST*OF*THE*HOLDING**********************************                233712 234440
350600200616      *                                                                                       233712
350700200616      ********** CPKEY     CHAINCPOSC                88                                233712 234440
350800200616      ********** *IN88     IFEQ '1'                                                    233712 234440
350900200616      **********           Z-ADD0         AVFP                                         233712 234440
351000200616      **********           ENDIF                                                       233712 234440
351100200616      *                                                                                       233712
351200200616     C           VCNOMA    IFLT *ZEROS                                                        233712
351300200616     C           *ZERO     SUB  VCNOMA    ZNOML                                               233712
351400200616     C                     ELSE                                                               233712
351500200616     C                     Z-ADDVCNOMA    ZNOML                                               233712
351600200616     C                     ENDIF                                                              233712
351700200616     C**********           Z-ADDAVFP      ZAVPR                                        233712 234440
351800200616     C                     Z-ADDWFISC     ZAVPR                                               234440
351900200616     C                     EXSR ZAPNUM                                                        233712
352000200616     C**********           Z-ADDZVALU     WCSAV  150                                   233712 234440
352100200616     C                     Z-ADDZVALU     WFSCA  150                                          234440
352200200616      *                                                                                       234440
352300200616      ** Now do comparison with profit on redemption, if country                              234440
352400200616      ** of tax is not Switzerland, and take the lower figure as the                          234440
352500200616      ** the taxable amount                                                                   234440
352600200616      *                                                                                       234440
352700200616      ** bit about CH is added and removed by this change control                             234440
352800200616      ** it is left in the code in case the situation changes again.                          234440
352900200616     C********** EWCTRT    IFNE 'CH'                                                          234440
353000200616     C           EWCTRT    IFNE 'CH'                                                          234874
353100200616      *                                                                                       234440
353200200616      ** If average price is greater than redemption price, there is no                       234440
353300200616      ** profit and so no tax.                                                                234440
353400200616     C           LAVP      IFGT VAREDP                                                        234440
353500200616     C                     Z-ADD0         WRESLT                                              234440
353600200616     C                     ELSE                                                               234440
353700200616     C           VCNOMA    IFLT *ZEROS                                                        234440
353800200616     C           *ZERO     SUB  VCNOMA    ZNOML                                               234440
353900200616     C                     ELSE                                                               234440
354000200616     C                     Z-ADDVCNOMA    ZNOML                                               234440
354100200616     C                     ENDIF                                                              234440
354200200616     C                     Z-ADDLAVP      ZAVPR                                               234440
354300200616     C                     EXSR ZAPNUM                                                        234440
354400200616     C**********           Z-ADDZVALU     WCSAV  150                                   233712 234440
354500200616     C           WNOMAT    SUB  ZVALU     WPRFA  150                                          234440
354600200616     C           WPRFA     IFLT WFSCA                                                         234440
354700200616     C                     Z-ADDWPRFA     WRESLT 150                                          234440
354800200616     C                     ELSE                                                               234440
354900200616     C                     Z-ADDWFSCA     WRESLT                                              234440
355000200616     C                     ENDIF                                                              234440
355100200616     C                     ENDIF                                                              234440
355200200616      *                                                                                       234440
355300200616      ** If Switzerland then just take "fiscal" amount                                        234440
355400200616      *                                                                                       234440
355500200616     C**********           ELSE                                                               234440
355600200616     C**********           Z-ADDWFSCA     WRESLT                                              234440
355700200616     C**********           ENDIF                                                              234440
355800200616     C                     ELSE                                                               234874
355900200616     C                     Z-ADDWFSCA     WRESLT                                              234874
356000200616     C                     ENDIF                                                              234874
356100200616      *                                                                                       233712
356200200616      ***If*no*record*found,*no*tax*is*calculated**********************                       233712
356300200616      *                                                                                       233712
356400200616      ***Calculate*Tax*Amount*for*the*Maturity*or*Early*Redemption*****                       233712
356500200616      ***and*to*Output*Information*on*SDCSINPD*************************                       233712
356600200616      *                                                                                       233712
356700200616     C********** WNOTAX    IFEQ ' '                                                           234440
356800200616      *                                                                                       233712
356900200616      ***Compute*the*difference*between*WNOMAT*and*WCSAV.**************                233712 234440
357000200616      ***If*WNOMAT*-*WCSAV*=*negative*or*0*nothing*must*be*calculated*or output        233712 234440
357100200616      ***in*SDCSINPD.**************************************************                233712 234440
357200200616      *                                                                                       233712
357300200616     C********** WNOMAT    SUB  WCSAV     WRESLT 150                                   233712 234440
357400200616      *                                                                                       233712
357500200616      ** Calculate tax from taxable amount and output it.                              233712 234440
357600200616      *                                                                                233712 234440
357700200616     C           WRESLT    IFGT 0                                                             233712
357800200616      *                                                                                       233709
357900200616     C********** EWTRT1    IFEQ '1'                                                    233709 234440
358000200616     C********** EWEDT1    ANDGTVAERRD                                                 233709 234440
358100200616     C********** VAERRD    SUB  CSDA      WDAY1   50                                   233709 234440
358200200616     C********** VAERRD    SUB  EWEDT1    WDAY2   50                                   233709 234440
358300200616     C********** WRESLT    MULT WDAY2     WRESLT                                       233709 234440
358400200616     C********** WRESLT    DIV  WDAY1     WRESLT                                       233709 234440
358500200616     C**********           ENDIF                                                       233709 234440
358600200616      *                                                                                       233709
358700200616     C                     EXSR MATXCL                                                        233712
358800200616      *                                                                                       233712
358900200616     C                     ENDIF                                                              233712
359000200616     C                     ENDIF                                                              233712
359100200616      *                                                                                       233712
359200200616     C                     ENDSR                                                              233712
359300200616      *****************************************************************                       233712
359400200616      /EJECT                                                                                  233712
359500200616      *****************************************************************                       233712
359600200616      *                                                               *                       233712
359700200616      *  CHKTAX - Subroutine to check if record is existing in        *                       233712
359800200616      *           SDCTTXPD for taxing.                                *                       233712
359900200616      *                                                               *                       233712
360000200616      *****************************************************************                       233712
360100200616      *                                                                                       233712
360200200616     C           CHKTAX    BEGSR                                                              233712
360300200616      *                                                                                       233712
360400200616      ** Retrieve Branch Location Code                                                        233712
360500200616      *                                                                                       233712
360600200616     C                     CALL 'AOBRCHR0'                                                    233712
360700200616     C                     PARM *BLANKS   P@RTCD                                              233712
360800200616     C                     PARM '*KEY   ' P@OPTN                                              233712
360900200616     C                     PARM VCBRCD    P@BRCD  3                                           233712
361000200616     C           SDBRCH    PARM SDBRCH    DSFDY                                               233712
361100200616      *                                                                                       233712
361200200616      ** Database Error                                                                       233712
361300200616      *                                                                                       233712
361400200616     C           P@RTCD    IFNE *BLANKS                                                       233712
361500200616     C           *LOCK     IN   LDA                                                           233712
361600200616     C                     MOVEL'SDBRCHL1'DBFILE                                              233712
361700200616     C                     MOVELVCBRCD    DBKEY                                               233712
361800200616     C                     Z-ADD53        DBASE                                               233712
361900200616     C                     MOVE *ON       *INU7                                               233712
362000200616     C                     MOVE *ON       *INU8                                               233712
362100200616     C                     EXSR *PSSR                                                         233712
362200200616     C                     ELSE                                                               233712
362300200616     C                     MOVELA8LCCD    P@LCCD  3                                           233712
362400200616      *                                                                                       233712
362500200616      ** Retrieve Country of Tax                                                              233712
362600200616      *                                                                                       233712
362700200616     C                     CALL 'AOLOCNR0'                                                    233712
362800200616     C                     PARM *BLANKS   P@RTCD                                              233712
362900200616     C                     PARM '*KEY   ' P@OPTN                                              233712
363000200616     C                     PARM           P@LCCD                                              233712
363100200616     C           SDLOCN    PARM SDLOCN    DSFDY                                               233712
363200200616      *                                                                                       233712
363300200616      ** Database Error                                                                       233712
363400200616      *                                                                                       233712
363500200616     C           P@RTCD    IFNE *BLANKS                                                       233712
363600200616     C           *LOCK     IN   LDA                                                           233712
363700200616     C                     MOVEL'SDLOCNL1'DBFILE                                              233712
363800200616     C                     MOVELA8LCCD    DBKEY                                               233712
363900200616     C                     Z-ADD54        DBASE                                               233712
364000200616     C                     MOVE *ON       *INU7                                               233712
364100200616     C                     MOVE *ON       *INU8                                               233712
364200200616     C                     EXSR *PSSR                                                         233712
364300200616     C                     ELSE                                                               233712
364400200616     C                     MOVE DVCNCD    WCTAX   2                                           233712
364500200616     C                     ENDIF                                                              233712
364600200616     C                     ENDIF                                                              233712
364700200616      *                                                                                       233712
364800200616      ** Retrieve Country of Residence                                                        233712
364900200616      *                                                                                       233712
365000200616     C                     MOVELVCCNUM    P@CSCN 10                                           233712
365100200616      *                                                                                       233712
365200200616     C                     CALL 'AOCUSTR0'                                                    233712
365300200616     C                     PARM *BLANKS   P@RTCD                                              233712
365400200616     C                     PARM '*KEY   ' P@OPTN                                              233712
365500200616     C                     PARM           P@CSCN                                              233712
365600200616     C                     PARM *BLANKS   P@KYST  7                                           233712
365700200616     C           SDCUST    PARM SDCUST    DSSDY                                               233712
365800200616      *                                                                                       233712
365900200616      ** Database Error                                                                       233712
366000200616      *                                                                                       233712
366100200616     C           P@RTCD    IFNE *BLANKS                                                       233712
366200200616     C           *LOCK     IN   LDA                                                           233712
366300200616     C                     MOVEL'SDCUSTL1'DBFILE                                              233712
366400200616     C                     MOVELVCCNUM    DBKEY                                               233712
366500200616     C                     Z-ADD55        DBASE                                               233712
366600200616     C                     MOVE *ON       *INU7                                               233712
366700200616     C                     MOVE *ON       *INU8                                               233712
366800200616     C                     EXSR *PSSR                                                         233712
366900200616     C                     ELSE                                                               233712
367000200616     C                     MOVE BBCOLC    WCOLC   2                                           233712
367100200616     C                     ENDIF                                                              233712
367200200616      *                                                                                       233712
367300200616      ** Retrieve Tax Basket                                                                  233712
367400200616      *                                                                                       233712
367500200616     C                     CALL 'AOCTTXR0'                                                    233712
367600200616     C                     PARM *BLANKS   P@RTCD                                              233712
367700200616     C                     PARM '*KEY   ' P@OPTN                                              233712
367800200616     C                     PARM WCTAX     P@CTRT  2                                           233712
367900200616     C                     PARM WCOLC     P@CTRR  2                                           233712
368000200616     C           SDCTTX    PARM SDCTTX    DSFDY                                               233712
368100200616      *                                                                                       233712
368200200616      ** If no record found, accessed with a country of tax and                               233712
368300200616      ** a blank country of residence.                                                        233712
368400200616      *                                                                                       233712
368500200616     C           P@RTCD    IFEQ 'NRF    '                                                     233712
368600200616     C                     CALL 'AOCTTXR0'                                                    233712
368700200616     C                     PARM *BLANKS   P@RTCD                                              233712
368800200616     C                     PARM '*KEY   ' P@OPTN                                              233712
368900200616     C                     PARM WCTAX     P@CTRT                                              233712
369000200616     C                     PARM *BLANKS   P@CTRR                                              233712
369100200616     C           SDCTTX    PARM SDCTTX    DSFDY                                               233712
369200200616     C                     ENDIF                                                              234440
369300200616      *                                                                                       233712
369400200616      ***Database*Error************************************************                233712 234440
369500200616      *                                                                                       233712
369600200616      ***No*tax*should*be*calculated*if*effective*date*is*in*the*future                       234440
369700200616      *                                                                                       234440
369800200616     C           P@RTCD    IFNE *BLANKS                                                       233712
369900200616     C           EWEDT1    ORGT VAERRD                                                        234440
370000200616     C********** *LOCK     IN   LDA                                                    233712 234440
370100200616     C**********           MOVEL'SDCTTXL1'DBFILE                                       233712 234440
370200200616     C**********           MOVELWCTAX     DBKEY                                        233712 234440
370300200616     C**********           Z-ADD56        DBASE                                        233712 234440
370400200616     C**********           MOVE *ON       *INU7                                        233712 234440
370500200616     C**********           MOVE *ON       *INU8                                        233712 234440
370600200616     C**********           EXSR *PSSR                                                  233712 234440
370700200616     C**********           ENDIF                                                       233712 234440
370800200616     C**********           ENDIF                                                       233712 234440
370900200616     C                     ELSE                                                               234440
371000200616      *                                                                                       233712
371100200616     C                     MOVE EWTXBS    WTAXBS  2                                           233712
371200200616      *                                                                                       233712
371300200616      ** Retrieve Tax Rate Applicable for Band                                                233712
371400200616      *                                                                                       233712
371500200616     C                     Z-ADDBJRDNB    P@DATE                                              233863
371600200616      *                                                                                       233863
371700200616     C                     CALL 'AOTXBSR0'                                                    233712
371800200616     C                     PARM *BLANKS   P@RTCD                                              233712
371900200616     C                     PARM '*KEY   ' P@OPTN                                              233712
372000200616     C                     PARM WCTAX     P@CTTT  2                                           233712
372100200616     C                     PARM WTAXBS    P@TXBS  2                                           233712
372200200616     C                     PARM           P@DATE  50                                          233863
372300200616     C                     PARM           P@NARR 15                                           233712
372400200616     C                     PARM           P@RATE  64                                          233712
372500200616      *                                                                                       233712
372600200616     C           P@RTCD    IFEQ *BLANKS                                                       233712
372700200616     C                     MOVE ' '       WNOTAX  1                                           233712
372800200616     C                     Z-ADDP@RATE    WTRAB   64                                          233712
372900200616     C                     ELSE                                                               233712
373000200616      *                                                                                       233712
373100200616      ** If no record found, no tax is calculated.                                            233712
373200200616      *                                                                                       233712
373300200616     C                     MOVE 'Y'       WNOTAX                                              233712
373400200616     C                     ENDIF                                                              233712
373500200616     C                     ENDIF                                                              234440
373600200616      *                                                                                       233712
373700200616     C                     ENDSR                                                              233712
373800200616      *****************************************************************                       233712
373900200616      /EJECT                                                                                  233712
374000200616      *****************************************************************                       233712
374100200616      *                                                               *                       233712
374200200616      *  MATXCL - Subroutine to calculate tax amount for the Maturity *                       233712
374300200616      *           or Early Redemption and to Output Information on    *                       233712
374400200616      *           SDCSINPD                                            *                       233712
374500200616      *                                                               *                       233712
374600200616      *****************************************************************                       233712
374700200616      *                                                                                       233712
374800200616     C           MATXCL    BEGSR                                                              233712
374900200616      *                                                                                       233712
375000200616      ** Initialise work variables                                                            233712
375100200616      *                                                                                       233712
375200200616     C                     Z-ADD0         TXNM                                                233709
375300200616     C                     Z-ADD0         TXST                                                233709
375400200616     C                     Z-ADD0         TAXA                                                233709
375500200616     C                     MOVE *BLANKS   TXCY                                                233709
375600200616     C                     MOVE ' '       WTXPI   1                                           233712
375700200616     C                     MOVE ' '       WTXJA   1                                           233712
375800200616      *                                                                                       233712
375900200616     C                     MOVE VCCNUM    @@CUST                                              233712
376000200616      *                                                                                       233712
376100200616     C                     CALL 'ZATXCLPI'                                                    233712
376200200616      ** Input                                                                                233712
376300200616     C                     PARM 'S'       @@MODI  1                                           233712
376400200616     C                     PARM VCSESN    @@TRRF 18                                           233712
376500200616     C                     PARM VCBRCD    @@BRCA  3                                           233712
376600200616     C                     PARM           @@CUST  6                                           233712
376700200616     C                     PARM *ZERO     @@STRD  50                                          233712
376800200616     C                     PARM *ZERO     @@ENDD  50                                          233712
376900200616     C                     PARM WRESLT    @@TOTI 150                                          233712
377000200616     C                     PARM WTRAB     @@TAXR  64                                          233712
377100200616     C                     PARM NMCY      @@OCCY  3                                           233568
377200200616     C                     PARM *BLANKS   PINTH   1                                           CER048
377300200616      ** Output                                                                               233712
377400200616     C                     PARM           @@IAED 150                                          233712
377500200616     C                     PARM           @@TAXA 150                                          233712
377600200616     C                     PARM           @@TOTO 150                                          233712
377700200616     C                     PARM           @@TXCY  3                                           233712
377800200616     C                     PARM           @@CTAX  2                                           233712
377900200616     C                     PARM           @@TXBS  2                                           233712
378000200616     C                     PARM           @@WTAC  40                                          233712
378100200616     C                     PARM           @@COLC  2                                           233712
378200200616     C                     PARM           @@STAT  5                                           233712
378300200616     C                     PARM           @@TRTE  1                                           233712
378400200616     C                     PARM           @@TXR1  64                                          233712
378500200616     C**********           PARM *ZEROS    PSTXB   20                                 CER048 BUG22911
378600200616     C**********           PARM *ZEROS    PSTAC  100                                 CER048 BUG22911
378700200616     C**********           PARM *ZEROS    PSTTR   64                                 CER048 BUG22911
378800200616     C**********           PARM *BLANKS   PSTTP   1                                  CER048 BUG22911
378900200616     C**********           PARM *ZEROS    PSTXA  150                                 CER048 BUG22911
379000200616     C                     PARM           @@KEY  10                                           233712
379100200616     C                     PARM           @@FILE 10                                           233712
379200200616     C                     PARM           @@RTRN  7                                           233712
379300200616     C           SDTXPA    PARM SDTXPA    DSSDY                                             BUG22911
379400200616      *                                                                                       233712
379500200616     C                     SELEC                                                              233712
379600200616      *                                                                                       233712
379700200616      ** If return code = Error.                                                              233712
379800200616      *                                                                                       233712
379900200616     C           @@RTRN    WHEQ 'ERROR'                                                       233712
380000200616     C                     MOVE @@FILE    DBFILE                                              233712
380100200616     C                     MOVE @@KEY     DBKEY                                               233712
380200200616     C                     Z-ADD63        DBASE                                               233712
380300200616     C                     MOVE *ON       *INU7                                               233712
380400200616     C                     MOVE *ON       *INU8                                               233712
380500200616     C                     EXSR *PSSR                                                         233712
380600200616      *                                                                                       233712
380700200616      ** If return code = Private Individual                                                  233712
380800200616      *                                                                                       233712
380900200616     C           @@RTRN    WHNE 'JOINT'                                                       233712
381000200616      *                                                                                       233712
381100200616     C           @@TOTO    IFNE *ZERO                                                         233712
381200200616     C           @@STAT    IFEQ 'TAXAB'                                                       233712
381300200616     C           @@STAT    OREQ 'DISCL'                                                       233712
381400200616     C           @@STAT    OREQ 'SELF'                                                        233712
381500200616      *                                                                                       233712
381600200616     C                     MOVE 'Y'       WTXPI                                               233712
381700200616     C                     MOVE WCTAX     KCSIS                                               233712
381800200616     C                     MOVE @@CTAX    KCTRT                                               233712
381900200616      *                                                                                       233712
382000200616     C           KTXCM     CHAINSDTXCML1             61                                       233712
382100200616     C           *IN61     IFEQ *OFF                                                          233712
382200200616      *                                                                                       233712
382300200616     C                     SELEC                                                              233712
382400200616     C           TCTXCM    WHEQ 1                                                             233712
382500200616     C           WLTAX     OREQ 0                                                             234813
382600200616     C                     Z-ADD@@TAXA    @@TAXA                                              233712
382700200616     C           TCTXCM    WHEQ 2                                                             233712
382800200616     C           WLTAX     MULT @@TOTI    WTAXA  150                                          234813
382900200616     C                     DIV  100       WTAXA                                               234813
383000200616     C           @@TOTI    SUB  WTAXA     WTAXA                                               234813
383100200616     C                     DIV  100       WTAXA                                               234813
383200200616     C                     MULT @@TAXR    WTAXA                                               234813
383300200616     C           WTAXA     IFLT 0                                                             234813
383400200616     C                     Z-ADD0         @@TAXA                                              234813
383500200616     C                     ELSE                                                               234813
383600200616     C**********           Z-ADD@@TAXA    @@TAXA                                       233712 234813
383700200616     C                     Z-ADDWTAXA     @@TAXA                                              234813
383800200616     C                     ENDIF                                                              234813
383900200616     C           TCTXCM    WHEQ 3                                                             233712
384000200616     C           WLTAX     MULT @@TOTI    WTAXA                                               234813
384100200616     C                     DIV  100       WTAXA                                               234813
384200200616     C           @@TAXA    SUB  WTAXA     WTAXA                                               234813
384300200616     C           WTAXA     IFLT 0                                                             234813
384400200616     C                     Z-ADD0         @@TAXA                                              234813
384500200616     C                     ELSE                                                               234813
384600200616     C**********           Z-ADD@@TAXA    @@TAXA                                       233712 234813
384700200616     C                     Z-ADDWTAXA     @@TAXA                                              234813
384800200616     C                     ENDIF                                                              234813
384900200616     C           TCTXCM    WHEQ 4                                                             233712
385000200616     C                     Z-ADD0         @@TAXA                                              233712
385100200616     C                     ENDSL                                                              233712
385200200616      *                                                                                       233712
385300200616     C                     ENDIF                                                              233712
385400200616      *                                                                                       233712
385500200616      ** Write record to SDCSINPD                                                             233712
385600200616      *                                                                                       233712
385700200616     C                     EXSR CSINSR                                                        233712
385800200616      *                                                                                       233712
385900200616     C                     ENDIF                                                              233712
386000200616     C                     ENDIF                                                              233712
386100200616      *                                                                                       233712
386200200616      ** If return code = Private Individual                                                  233712
386300200616      *                                                                                       233712
386400200616     C           @@RTRN    WHEQ 'JOINT'                                                       233712
386500200616     C                     MOVE VCCNUM    KJANO   6                                           233712
386600200616      *                                                                                       233712
386700200616     C           KJANO     SETLLSDJACCLB                                                      233712
386800200616     C           KJANO     READESDJACCLB                 60                                   233712
386900200616      *                                                                                       233712
387000200616     C           *IN60     DOWEQ*OFF                                                          233712
387100200616      *                                                                                       233712
387200200616     C                     CALL 'ZATXCLJA'                                                    233712
387300200616      ** Input                                                                                233712
387400200616     C                     PARM 'S'       @@MODI                                              233712
387500200616     C                     PARM VCSESN    @@TRRF                                              233712
387600200616     C                     PARM VCBRCD    @@BRCA                                              233712
387700200616     C                     PARM JCJANO    @@JANO  6                                           233712
387800200616     C                     PARM JCCUST    @@CUST                                              233712
387900200616     C                     PARM JCNAHO    @@NARF 10                                           233712
388000200616     C                     PARM JCINVP    @@INVP 10                                           233712
388100200616     C                     PARM JCPAHT    @@PAHT  1                                         BUG26839
388200200616     C                     PARM *ZERO     @@STRD                                              233712
388300200616     C                     PARM *ZERO     @@ENDD                                              233712
388400200616     C                     PARM WRESLT    @@TOTI                                              233712
388500200616     C                     PARM WTRAB     @@TAXR                                              233712
388600200616     C                     PARM NMCY      @@OCCY                                              233568
388700200616     C                     PARM *BLANKS   PINTH                                               CER048
388800200616      ** Output                                                                               233712
388900200616     C                     PARM           @@IAED                                              233712
389000200616     C                     PARM           @@TAXA                                              233712
389100200616     C                     PARM           @@TOTO                                              233712
389200200616     C                     PARM           @@TXCY                                              233712
389300200616     C                     PARM           @@CTAX                                              233712
389400200616     C                     PARM           @@TXBS                                              233712
389500200616     C                     PARM           @@WTAC                                              233712
389600200616     C                     PARM           @@COLC                                              233712
389700200616     C                     PARM           @@STAT                                              233712
389800200616     C                     PARM           @@TRTE                                              233712
389900200616     C                     PARM           @@TXR1                                              233712
390000200616     C                     PARM           @@JAMG  1                                           233712
390100200616     C**********           PARM *ZEROS    PSTXB                                      CER048 BUG22911
390200200616     C**********           PARM *ZEROS    PSTAC                                      CER048 BUG22911
390300200616     C**********           PARM *ZEROS    PSTTR                                      CER048 BUG22911
390400200616     C**********           PARM *BLANKS   PSTTP                                      CER048 BUG22911
390500200616     C**********           PARM *ZEROS    PSTXA                                      CER048 BUG22911
390600200616     C                     PARM           @@KEY                                               233712
390700200616     C                     PARM           @@FILE                                              233712
390800200616     C                     PARM           @@RTRN                                              233712
390900200616     C           SDTXPA    PARM SDTXPA    DSSDY                                             BUG22911
391000200616      *                                                                                       233712
391100200616      ** If return code = Error.                                                              233712
391200200616      *                                                                                       233712
391300200616     C           @@RTRN    IFEQ 'ERROR'                                                       233712
391400200616     C                     MOVE @@FILE    DBFILE                                              233712
391500200616     C                     MOVE @@KEY     DBKEY                                               233712
391600200616     C                     Z-ADD65        DBASE                                               233712
391700200616     C                     MOVE *ON       *INU7                                               233712
391800200616     C                     MOVE *ON       *INU8                                               233712
391900200616     C                     EXSR *PSSR                                                         233712
392000200616     C                     ENDIF                                                              233712
392100200616      *                                                                                       233712
392200200616     C           @@TOTO    IFNE *ZERO                                                         233712
392300200616     C           @@STAT    IFEQ 'TAXAB'                                                       233712
392400200616     C           @@STAT    OREQ 'DISCL'                                                       233712
392500200616     C           @@STAT    OREQ 'SELF '                                                       233712
392600200616      *                                                                                       233712
392700200616     C                     MOVE 'Y'       WTXJA                                               233712
392800200616     C                     MOVE WCTAX     KCSIS                                               233712
392900200616     C                     MOVE @@CTAX    KCTRT                                               233712
393000200616      *                                                                                       233712
393100200616     C           KTXCM     CHAINSDTXCML1             61                                       233712
393200200616     C           *IN61     IFEQ *OFF                                                          233712
393300200616      *                                                                                       233712
393400200616     C                     SELEC                                                              233712
393500200616     C           TCTXCM    WHEQ 1                                                             233712
393600200616     C           WLTAX     OREQ 0                                                             234813
393700200616     C                     Z-ADD@@TAXA    @@TAXA                                              233712
393800200616     C           TCTXCM    WHEQ 2                                                             233712
393900200616     C           WLTAX     MULT @@TOTI    WTAXA  150                                          234813
394000200616     C                     DIV  100       WTAXA                                               234813
394100200616     C           @@TOTI    SUB  WTAXA     WTAXA                                               234813
394200200616     C                     DIV  100       WTAXA                                               234813
394300200616     C                     MULT @@TAXR    WTAXA                                               234813
394400200616     C           WTAXA     IFLT 0                                                             234813
394500200616     C                     Z-ADD0         @@TAXA                                              234813
394600200616     C                     ELSE                                                               234813
394700200616     C**********           Z-ADD@@TAXA    @@TAXA                                       233712 234813
394800200616     C                     Z-ADDWTAXA     @@TAXA                                              234813
394900200616     C                     ENDIF                                                              234813
395000200616     C           TCTXCM    WHEQ 3                                                             233712
395100200616     C           WLTAX     MULT @@TOTI    WTAXA                                               234813
395200200616     C                     DIV  100       WTAXA                                               234813
395300200616     C           @@TAXA    SUB  WTAXA     WTAXA                                               234813
395400200616     C           WTAXA     IFLT 0                                                             234813
395500200616     C                     Z-ADD0         @@TAXA                                              234813
395600200616     C                     ELSE                                                               234813
395700200616     C**********           Z-ADD@@TAXA    @@TAXA                                       233712 234813
395800200616     C                     Z-ADDWTAXA     @@TAXA                                              234813
395900200616     C                     ENDIF                                                              234813
396000200616     C           TCTXCM    WHEQ 4                                                             233712
396100200616     C                     Z-ADD0         @@TAXA                                              233712
396200200616     C                     ENDSL                                                              233712
396300200616      *                                                                                       233712
396400200616     C                     ENDIF                                                              233712
396500200616      *                                                                                       233712
396600200616      ** Write record to SDCSINPD                                                             233712
396700200616      *                                                                                       233712
396800200616     C                     EXSR CSINSR                                                        233712
396900200616      *                                                                                       233712
397000200616     C                     ENDIF                                                              233712
397100200616     C                     ENDIF                                                              233712
397200200616      *                                                                                       233712
397300200616     C           @@RTRN    IFEQ 'NOTAX'                                                       233712
397400200616     C           @@RTRN    OREQ 'TAXAB'                                                       233712
397500200616     C           KJANO     READESDJACCLB                 60                                   233712
397600200616     C                     ENDIF                                                              233712
397700200616      *                                                                                       233712
397800200616      ** If @@RTRN = Last, end loop                                                           233712
397900200616      *                                                                                       233712
398000200616     C           @@RTRN    IFEQ 'LAST'                                                        233712
398100200616     C                     MOVE *ON       *IN60                                               233712
398200200616     C                     ENDIF                                                              233712
398300200616      *                                                                                       233712
398400200616     C                     ENDDO                                                              233712
398500200616      *                                                                                       233712
398600200616     C                     ENDSL                                                              233712
398700200616      *                                                                                       233712
398800200616     C           ENDMTX    ENDSR                                                              233712
398900200616      *****************************************************************                       233712
399000200616      /EJECT                                                                                  233712
399100200616      *****************************************************************                       233712
399200200616      *                                                               *                       233712
399300200616      *  CSINSR - Subroutine to Calculate Tax Amounts for PF/POSETD   *                       233712
399400200616      *                                                               *                       233712
399500200616      *****************************************************************                       233712
399600200616      *                                                                                       233712
399700200616     C           CSINSR    BEGSR                                                              233712
399800200616      *                                                                                       233712
399900200616      ** Get Customer Status                                                                  233712
400000200616      *                                                                                       233712
400100200616     C                     SELEC                                                              233712
400200200616     C           @@STAT    WHEQ 'DISCL'                                                       233712
400300200616     C                     MOVEL'D'       TSSTAT  1                                           233709
400400200616     C           @@STAT    WHEQ 'SELF'                                                        233712
400500200616     C                     MOVEL'S'       TSSTAT                                              233712
400600200616     C           @@STAT    WHEQ 'TAXAB'                                                       233712
400700200616     C                     MOVEL'T'       TSSTAT                                              233712
400800200616     C                     ENDSL                                                              233712
400900200616     C                     MOVEL@@OCCY    TSOCCY  3                                           233709
401000200616      *                                                                                       233709
401100200616      ** Get Original Spot Rate                                                               233712
401200200616      *                                                                                       233712
401300200616     C                     CALL 'AOCURRR0'                                                    233712
401400200616     C                     PARM *BLANKS   @RTCD   7                                           233712
401500200616     C                     PARM '*KEY   ' @OPTN   7                                           233712
401600200616     C                     PARM TSOCCY    @AJCD   3                                           233712
401700200616     C           SDCURR    PARM SDCURR    DSSDY                                               233712
401800200616     C           @RTCD     IFNE *BLANKS                                                       233712
401900200616     C                     Z-ADD29        DBASE                                               233712
402000200616     C                     MOVEL'SDCURRPD'DBFILE                                              233712
402100200616     C                     MOVELTSOCCY    DBKEY                                               233712
402200200616     C                     EXSR *PSSR                                                         233712
402300200616     C                     ENDIF                                                              233712
402400200616     C           A6MDIN    IFEQ 'D'                                                           233712
402500200616     C                     MOVELA6SPRT    TSOCSR                                              233712
402600200616     C                     ELSE                                                               233712
402700200616     C           1         DIV  A6SPRT    TSOCSR 138H                                         233709
402800200616     C                     ENDIF                                                              233712
402900200616      *                                                                                       233712
403000200616     C                     MOVEL'D'       TSOCMD  1                                           233709
403100200616     C                     MOVELA6NBDP    TSOCDP  10                                          233709
403200200616     C                     MOVELTSOCCY    TSSCCY  3                                           233709
403300200616     C                     MOVELTSOCSR    TSSCSR 138                                          233709
403400200616     C                     MOVELTSOCMD    TSSCMD  1                                           233709
403500200616     C                     MOVELTSOCDP    TSSCDP  10                                          233709
403600200616     C                     MOVEL@@TXCY    TSTXCY  3                                           233709
403700200616      *                                                                                       233712
403800200616      ** Get Currency Spot Rate                                                               233712
403900200616      *                                                                                       233712
404000200616     C                     CALL 'AOCURRR0'                                                    233712
404100200616     C                     PARM *BLANKS   @RTCD   7                                           233712
404200200616     C                     PARM '*KEY   ' @OPTN   7                                           233712
404300200616     C                     PARM TSTXCY    @AJCD   3                                           233712
404400200616     C           SDCURR    PARM SDCURR    DSSDY                                               233712
404500200616     C           @RTCD     IFNE *BLANKS                                                       233712
404600200616     C                     Z-ADD29        DBASE                                               233712
404700200616     C                     MOVEL'SDCURRPD'DBFILE                                              233712
404800200616     C                     MOVELTSTXCY    DBKEY                                               233712
404900200616     C                     EXSR *PSSR                                                         233712
405000200616     C                     ENDIF                                                              233712
405100200616     C           A6MDIN    IFEQ 'D'                                                           233712
405200200616     C                     MOVELA6SPRT    TSTCSR 138                                          233709
405300200616     C                     ELSE                                                               233712
405400200616     C           1         DIV  A6SPRT    TSTCSR    H                                         233712
405500200616     C                     ENDIF                                                              233712
405600200616      *                                                                                       233712
405700200616     C                     MOVEL'D'       TSTCMD  1                                           233709
405800200616     C                     MOVELA6NBDP    TSTCDP  10                                          233709
405900200616      *                                                                                       233712
406000200616      ** Get Orig/Settlement Cross Rate                                                       233712
406100200616      *                                                                                       233712
406200200616     C                     Z-ADDTSOCSR    ZRATE1                                              233712
406300200616     C                     MOVE TSOCMD    ZMDI1                                               233712
406400200616     C                     Z-ADDTSSCSR    ZRATE2                                              233712
406500200616     C                     MOVE TSSCMD    ZMDI2                                               233712
406600200616     C                     EXSR ZXRATE                                                        233712
406700200616     C                     Z-ADDZRATEX    TSXROS 138                                          233709
406800200616     C                     MOVE ZMDIX     TSOSMD  1                                           233709
406900200616      *                                                                                       233712
407000200616      ** Get Settlement/Tax Currency Exchange Rate                                            233712
407100200616      *                                                                                       233712
407200200616     C                     Z-ADDTSSCSR    ZRATE1                                              233712
407300200616     C                     MOVE TSSCMD    ZMDI1                                               233712
407400200616     C                     Z-ADDTSTCSR    ZRATE2                                              233712
407500200616     C                     MOVE TSTCMD    ZMDI2                                               233712
407600200616     C                     EXSR ZXRATE                                                        233712
407700200616     C                     Z-ADDZRATEX    TSXRST 138                                          233709
407800200616     C                     MOVE ZMDIX     TSSTMD  1                                           233709
407900200616      *                                                                                       233712
408000200616      ** The following fields are calculated when the customer status = T only.               233712
408100200616      *                                                                                       233712
408200200616     C                     Z-ADD*ZERO     TSTXSR 150                                          233709
408300200616     C           TSSTAT    IFEQ 'T'                                                           233712
408400200616     C                     Z-ADD@@TAXA    TSTXSR                                              233712
408500200616      *                                                                                       233712
408600200616      *                                                                                       233712
408700200616     C           TSOCCY    IFEQ TSSCCY                                                        233712
408800200616     C                     Z-ADD@@TAXA    TSTXSS 150                                          233709
408900200616      *                                                                                       233712
409000200616     C                     ELSE                                                               233712
409100200616      *                                                                                       233712
409200200616     C                     Z-ADD@@TAXA    ZAMTF                                               233712
409300200616     C                     Z-ADDTSXROS    ZCRSRT                                              233712
409400200616     C                     MOVE TSOSMD    ZCRSMD                                              233712
409500200616     C                     Z-ADDTSOCDP    ZCDPF                                               233712
409600200616     C                     Z-ADDTSSCDP    ZCDPT                                               233712
409700200616     C                     EXSR ZCCYXR                                                        233712
409800200616     C                     Z-ADDZAMTT     TSTXSS                                              233712
409900200616     C                     ENDIF                                                              233712
410000200616      *                                                                                       233712
410100200616      *                                                                                       233712
410200200616     C           TSSCCY    IFEQ TSTXCY                                                        233712
410300200616     C                     Z-ADDTSTXSS    TSTXSC 150                                          233709
410400200616      *                                                                                       233712
410500200616     C                     ELSE                                                               233712
410600200616      *                                                                                       233712
410700200616     C                     Z-ADDTSTXSS    ZAMTF                                               233712
410800200616     C                     Z-ADDTSXRST    ZCRSRT                                              233712
410900200616     C                     MOVE TSSTMD    ZCRSMD                                              233712
411000200616     C                     Z-ADDTSSCDP    ZCDPF                                               233712
411100200616     C                     Z-ADDTSTCDP    ZCDPT                                               233712
411200200616     C                     EXSR ZCCYXR                                                        233712
411300200616     C                     Z-ADDZAMTT     TSTXSC                                              233712
411400200616     C                     ENDIF                                                              233712
411500200616      *                                                                                       233712
411600200616     C                     ADD  TSTXSR    TXNM                                                233709
411700200616     C                     ADD  TSTXSS    TXST                                                233709
411800200616     C                     ADD  TSTXSC    TAXA                                                233709
411900200616     C                     MOVE TSTXCY    TXCY                                                233709
412000200616     C                     ENDIF                                                              233712
412100200616      *                                                                                       233712
412200200616     C                     ENDSR                                                              233712
412300200616     C*****************************************************************
412400200616     C/EJECT
412500200616     C*****************************************************************   S01496
412600200616     C*                                                               *   S01496
412700200616     C*  ZSETAC SR. TO DETERMINE SETTLEMENT ACCOUNT                   *   S01496
412800200616     C*                                                               *   S01496
412900200616     C*  INPUT  FIELDS                                                *   S01496
413000200616     C*       ZMETH  2,0     SETTLEMENT METHOD                        *   S01496
413100200616     C********ZSETI**12A*****SETTLEMENT ACCOUNT************************                S01496 CGL029
413200200616      **      ZSETI  18A     SETTLEMENT ACCOUNT                       *                       CGL029
413300200616     C*       ZCNUM  6,0     TRANSACTION CUSTOMER NUMBER              *   S01496
413400200616     C*       ZCCY    3A     TRANSACTION CURRENCY                     *   S01496
413500200616     C*       ZBRCA   3A     SETTLEMENT BRANCH                        *   085862
413600200616     C*                                                               *   S01496
413700200616     C*  OUTPUT  FIELDS                                               *   S01496
413800200616     C********ZSETO**18A*****SETTLEMENT*ACCOUNT************************                S01496 CGL029
413900200616      **      ZSETO  24A     SETTLEMENT ACCOUNT                       *                       CGL029
414000200616     C*       ZPTFR   4A     PORTFOLIO OF SETTLEMENT ACCOUNT          *   S01496
414100200616     C*                                                               *   S01496
414200200616     C*****************************************************************   S01496
414300200616     C*                                                                   S01496
414400200616     C           ZSETAC    BEGSR                           *** ZSETAC *** S01496
414500200616     C*                                                                   S01496
414600200616     C** Define all fields                                                S01496
414700200616     C*                                                                   S01496
414800200616     C                     Z-ADDZMETH     ZMETH   20                      S01496
414900200616     C**********           MOVE ZSETI     ZSETI  12                                    S01496 CGL029
415000200616     C                     MOVE ZSETI     ZSETI  18                                           CGL029
415100200616     C**********           Z-ADDZCNUM     ZCNUM   60                                   S01496 CSD027
415200200616     C                     MOVE ZCNUM     ZCNUM   6                                           CSD027
415300200616     C                     MOVE ZCCY      ZCCY    3                       S01496
415400200616     C                     MOVE ZBRCA     ZBRCA   3                       085862
415500200616     C                     MOVE ZPTFR     ZPTFR   4                       S01496
415600200616     C**********           MOVE ZSETO     ZSETO  18                                    S01496 CGL029
415700200616     C                     MOVE ZSETO     ZSETO  24                                           CGL029
415800200616     C*                                                                   S01496
415900200616     C** If Settlement Method '04' set up account code in form            S01496
416000200616     C***AAAAAA-BBB-CCCC-DD*where:*************************************                S01496 CGL029
416100200616      ** AAAAAA-BBB-CCCCCCCCCC-DD where:                                                      CGL029
416200200616     C**   AAAAAA = Customer number                                       S01496
416300200616     C**   BBB    = Transaction currency                                  S01496
416400200616     C*****CCCC***=*Prime*current*account******************************                S01496 CGL029
416500200616      **   CCCCCCCCCC   = Prime Current Account                                               CGL029
416600200616     C**   DD     = Starting account sequence '01'                        S01496
416700200616     C                     MOVE ZBRCA     ZWBRCA                          085862
416800200616     C*                                                                   S01496
416900200616     C           ZMETH     IFEQ 04                                        S01496
417000200616     C                     MOVE ZCNUM     ZWCNUM                          S01496
417100200616     C                     MOVE ZCCY      ZWCCY                           S01496
417200200616     C                     MOVE BMACCD    ZWACOD                          S01496
417300200616     C                     MOVE ZBRCA     ZWBRCA                          085862
417400200616     C                     MOVE '01'      ZWACSQ                          S01496
417500200616     C                     END                                            S01496
417600200616     C*                                                                   S01496
417700200616     C** If Settlement Method '05' set up account code in form            S01496
417800200616      ** AAAAAA-BBB-CCCCCCCCCC-DD where:                                                      CGL029
417900200616      **   AAAAAA       = Customer Number                                                     CGL029
418000200616      **   BBB          = Transaction Currency                                                CGL029
418100200616      **   CCCCCCCCCC   = Account Code                                                        CGL029
418200200616      **   DD           = Account Sequence                                                    CGL029
418300200616     C***AAAAAA-BBB-CCCC-DD where:*************************************                S01496 CGL029
418400200616     C*****AAAAAA*=*Bytes*1*-*6*of*parameter*ZSETI*********************                S01496 CGL029
418500200616     C*****BBB****=*Transaction*currency*******************************                S01496 CGL029
418600200616     C*****CCCC***=*Bytes*7*-*10*of*parameter*ZSETI********************                S01496 CGL029
418700200616     C*****DD*****=*Bytes*7*-*11*unt*sequence*'01'*********************                S01496 CGL029
418800200616     C*                                                                   S01496
418900200616     C           ZMETH     IFEQ 05                                        S01496
419000200616     C                     MOVELZSETI     ZWCNUM                          S01496
419100200616     C                     MOVE ZCCY      ZWCCY                           S01496
419200200616     C**********           MOVELZSETI     ZWWORK 10                                    S01496 CGL029
419300200616     C                     MOVELZSETI     ZWWORK 16                                           CGL029
419400200616     C                     MOVE ZWWORK    ZWACOD                          S01496
419500200616     C                     MOVE ZSETI     ZWACSQ                          S01496
419600200616     C                     MOVE ZBRCA     ZWBRCA                          085862
419700200616     C                     END                                            S01496
419800200616     C*                                                                   S01496
419900200616     C** If Settlement Method '15' set up account code in form            S01496
420000200616     C***AAAAAA-BBB-CCCC-DD*where:*************************************                S01496 CGL029
420100200616      ** AAAAAA-BBB-CCCCCCCCCC-DD where:                                                      CGL029
420200200616     C**   AAAAAA = Customer number parameter                             S01496
420300200616     C**   BBB    = Transaction currency                                  S01496
420400200616     C*****CCCC***=*Customer*SE*Settlement*account*code*from*SDSECSPD**                S01496 CGL029
420500200616      **   CCCCCCCCCC   = Customer SE Sett. A/C from SDSECSPD                                 CGL029
420600200616     C**   DD     = Customer SE Settlement account sequence from SDSECSPD S01496
420700200616     C*                                                                   S01496
420800200616     C           ZMETH     IFEQ 15                         B1             S01496
420900200616     C                     MOVE ZCNUM     ZWCNUM                          S01496
421000200616     C                     MOVE ZCCY      ZWCCY                           S01496
421100200616     C                     MOVE ZBRCA     ZWBRCA                          085862
421200200616     C*                                                                   S01496
421300200616     C** On change of customer number access SE customer details          S01496
421400200616     C*                                                                   S01496
421500200616     C           ZCNUM     IFNE ZSECNU                     B2             S01496
421600200616     C                     MOVE ZCNUM     ZWCNUA  6                       S01496
421700200616     C*                                                                   S01496
421800200616     C                     CALL 'AOSECSR0'                                S01496
421900200616     C                     PARM *BLANKS   WLRTCD                          S01496
422000200616     C                     PARM '*KEY  '  WLOPTN                          S01496
422100200616     C                     PARM ZWCNUA    WLCUSN  6                       S01496
422200200616     C           SDSECS    PARM SDSECS    DSSDY                           S01496
422300200616     C*                                                                   S01496
422400200616     C           WLRTCD    IFNE *BLANKS                    B3             S01496
422500200616     C                     Z-ADD102       DBASE            ***************S01496
422600200616     C                     MOVE 'SDSECSPD'DBFILE           * DBERROR 102 *S01496
422700200616     C                     MOVELZWCNUA    DBKEY            ***************S01496
422800200616     C                     EXSR *PSSR                                     S01496
422900200616     C                     END                             E3             S01496
423000200616     C*                                                                   S01496
423100200616     C**********           Z-ADDZCNUM     ZSECNU  60                                   S01496 CSD027
423200200616     C                     MOVE ZCNUM     ZSECNU  6                                           CSD027
423300200616     C                     END                             E2             S01496
423400200616     C*                                                                   S01496
423500200616     C                     MOVE BFACCD    ZWACOD                          S01496
423600200616     C                     MOVE BFACSN    ZWACSQ                          S01496
423700200616     C                     END                             E1             S01496
423800200616     C*                                                                   S01496
423900200616     C** If Settlement Method 14 use account number passed to access      S01496
424000200616     C** LF/ACNUM                                                         S01496
424100200616     C*                                                                   S01496
424200200616     C           ZMETH     IFEQ 14                         B1             S01496
424300200616     C                     MOVELZSETI     ZWACNO 100                      S01496
424400200616     C           ZWACNO    CHAINACNUM                99                   S01496
424500200616     C**********           Z-ADDZRCNUM    ZWCNUM                                       S01496 CSD027
424600200616     C                     MOVE ZRCNUM    ZWCNUM                                              CSD027
424700200616     C                     MOVE ZRCCY     ZWCCY                           S01496
424800200616     C                     Z-ADDZRACOD    ZWACOD                          S01496
424900200616     C                     Z-ADDZRACSQ    ZWACSQ                          S01496
425000200616     C                     MOVE ZRBRCA    ZWBRCA                          S01496
425100200616     C                     END                             E1             S01496
425200200616     C*                                                                   S01496
425300200616     C** If Settlement Method 04, 05 OR 15 use account set up above       S01496
425400200616     C*                                                                   S01496
425500200616     C           ZMETH     IFEQ 04                         B1             S01496
425600200616     C           ZMETH     OREQ 05                                        S01496
425700200616     C           ZMETH     OREQ 15                                        S01496
425800200616     C           ZWACCN    CHAINACCNT                99                   S01496
425900200616     C                     END                             E1             S01496
426000200616     C*                                                                   S01496
426100200616     C** If account found set portfolio reference to reference from       S01496
426200200616     C** account                                                          S01496
426300200616     C*                                                                   S01496
426400200616     C           *IN99     IFEQ '0'                                       S01496
426500200616     C                     MOVE ZRPTFR    ZPTFR                           S01496
426600200616     C                     MOVE ZKACCN    ZSETO                           S01496
426700200616     C*                                                                   S01496
426800200616     C** ... otherwise blank                                              S01496
426900200616     C*                                                                   S01496
427000200616     C                     ELSE                                           S01496
427100200616     C                     MOVE *BLANKS   ZPTFR                           S01496
427200200616     C                     MOVE *BLANKS   ZSETO                           S01496
427300200616     C                     END                                            S01496
427400200616     C*                                                                   S01496
427500200616     C                     ENDSR                                          S01496
427600200616     C*****************************************************************   S01496
427700200616     C/EJECT                                                              S01496
427800200616     C/COPY WNCPYSRC,SE6720C004
427900200616     C*****************************************************************
428000200616     C*  ZCONV  -CONVERT AMOUNT IN ONE CURRENCY TO ANOTHER            *
428100200616     C*****************************************************************
428200200616     C*
428300200616     C/COPY ZSRSRC,ZCONVZ1                                                S01496
428400200616     C*                                                                   S01496
428500200616     C***********ZCONV     BEGSR                                          S01496
428600200616     C***********                                                         S01496
428700200616     C***********          Z-ADDZAMTCI    ZAMTCI 150                      S01496
428800200616     C***********          Z-ADD0         ZAMTCO 150                      S01496
428900200616     C***********                                                         S01496
429000200616     C***Currency*from*************************************************   S01496
429100200616     C***********          MOVE ZCCYI     ZCCYF                           S01496
429200200616     C***********ZCCYF     CHAINSDCURRL1             89                   S01496
429300200616     C************IN89     IFEQ '1'                                       S01496
429400200616     C***********          MOVEL'SDCURRL1'DBFILE           ***************S01496
429500200616     C***********          MOVELZCCYF     DBKEY            ** DB ERROR 12 S01496
429600200616     C***********          Z-ADD12        DBASE            ***************S01496
429700200616     C***********          EXSR *PSSR                                     S01496
429800200616     C***********          ENDIF                                          S01496
429900200616     C***********                                                         S01496
430000200616     C***********          MOVE A6SPRT    ZRATEF                          S01496
430100200616     C***********          MOVE A6MDIN    ZMDINF                          S01496
430200200616     C***********          MOVE A6NBDP    ZCDPF                           S01496
430300200616     C***********                                                         S01496
430400200616     C***Currency*to***************************************************   S01496
430500200616     C***********          MOVE ZCCYO     ZCCYT                           S01496
430600200616     C***********ZCCYT     CHAINSDCURRL1             89                   S01496
430700200616     C************IN89     IFEQ '1'                                       S01496
430800200616     C***********          MOVEL'SDCURRL1'DBFILE           ***************S01496
430900200616     C***********          MOVELZCCYT     DBKEY            ** DB ERROR 13 S01496
431000200616     C***********          Z-ADD13        DBASE            ***************S01496
431100200616     C***********          EXSR *PSSR                                     S01496
431200200616     C***********          ENDIF                                          S01496
431300200616     C***********                                                         S01496
431400200616     C***********          MOVE A6SPRT    ZRATET                          S01496
431500200616     C***********          MOVE A6MDIN    ZMDINT                          S01496
431600200616     C***********          MOVE A6NBDP    ZCDPT                           S01496
431700200616     C***********                                                         S01496
431800200616     C***Amount*from***************************************************   S01496
431900200616     C***********          Z-ADDZAMTCI    ZAMTF                           S01496
432000200616     C***********                                                         S01496
432100200616     C***********          EXSR ZCCYCN                                    S01496
432200200616     C***********                                                         S01496
432300200616     C***********          Z-ADDZAMTT     ZAMTCO                          S01496
432400200616     C***********                                                         S01496
432500200616     C***********          ENDSR                                          S01496
432600200616     C*****************************************************************
432700200616     C/COPY WNCPYSRC,SE6720C005
432800200616      /EJECT
432900200616     C*****************************************************************
433000200616     C*                                                               *
433100200616     C*  MIDAS STANDARD SUBROUTINE                                *
433200200616     C*                                                               *
433300200616     C*  ZA0830 - THIS SUBROUTINE FINDS OUT WHETHER A PARTICULAR DAY  *
433400200616     C*           IS A HOLIDAY IN A PARTICULAR CURRENCY               *
433500200616     C*                                                               *
433600200616      *  (c) Finastra International Limited 2001                      *
433700200616     C*                                                               *
433800200616     C*  LAST AMEND NO. E22098             DATE 14MAY90               *
433900200616     C*                                                               *
434000200616     C*****************************************************************
434100200616     C*                                                               *
434200200616     C*  E22098  -  CREATION PARAMETERS PHYSICALLY REMOVED AND        *
434300200616     C*             HEADER BOX ADDED.                                 *
434400200616     C*                                                               *
434500200616     C***********************************************************************
434600200616     C*                                                                     *
434700200616     C* CALLED BY :                                                         *
434800200616     C*                                                                     *
434900200616     C* CALLS :                                                             *
435000200616     C*                                                                     *
435100200616     C* INPUT  : @@MNO  MIDAS DAY NUMBER 5N                                 *
435200200616     C*          @@CCY  CURRENCY CODE 3A                                    *
435300200616     C*                                                                     *
435400200616     C* OUTPUT : @@HIND HOLIDAY/WORKING DAY INDICATOR 1A                    *
435500200616     C*                                                                     *
435600200616     C* USES :   @@MNO  MIDAS DAY NUMBER                                    *
435700200616     C*          @@CCY  CURRENCY CODE                                       *
435800200616     C*          @@ONCE FIRST TIME THROUGH INDICATOR                        *
435900200616     C*          @@CY1  FIRST HALF OF CURRENCY ARRAY                        *
436000200616     C*          @@CY2  SECOND HALF OF CURRENCY ARRAY                       *
436100200616     C*          @@MNO6 MIDAS NUMBER WITH TRAILING BLANK                    *
436200200616     C*          @@HIND HOLIDAY/WORKING DAY INDICATOR                       *
436300200616     C*          @@INEX INCLUDE/EXCLUDE INDICATOR                           *
436400200616     C*                                                                     *
436500200616     C*          INDICATORS                                                 *
436600200616     C*          80 RECORD NOT FOUND                                        *
436700200616     C*          81 CURRENCY NOT FOUND ON RECORD                            *
436800200616     C*                                                                     *
436900200616     C***********************************************************************
437000200616     C***        ZA0830    BEGSR                                         64743
437100200616     C*
437200200616     C** OPEN CURRENCY/HOLIDAY FILE IF FIRST TIME THROUGH                 64743
437300200616     C***        @@ONCE    IFNE 'Y'                        B1             64743
437400200616     C***                  OPEN FDTABJLL                   *1             64743
437500200616     C***                  MOVE 'Y'       @@ONCE  1        *1             64743
437600200616     C***                  END                             E1             64743
437700200616     C*                                                                   64743
437800200616     C** BLANK OUT ARRAY                                                  64743
437900200616     C***                  MOVE *BLANKS   @@CY1                           64743
438000200616     C***                  MOVE *BLANKS   @@CY2                           64743
438100200616     C*                                                                   64743
438200200616     C** ACCESS TABLE ON FIRST KEY                                        64743
438300200616     C***                  MOVEL@@MNO     @@MNO6  6                       64743
438400200616     C***                  MOVE @@MNO6    @@0830 12                       64743
438500200616     C***                  MOVEL'22    '  @@0830                          64743
438600200616     C***                  MOVE '1'       @@0830                          64743
438700200616     C***        @@0830    CHAINTABLETJF             80                   64743
438800200616     C*                                                                   64743
438900200616     C** IF RECORD NOT FOUND OR DELETED                                   64743
439000200616     C***        *IN80     IFEQ '1'                        B1             64743
439100200616     C***        RECI      OREQ '*'                        *1             64743
439200200616     C***                  MOVE 'W'       @@HIND           *1             64743
439300200616     C***                  GOTO ZA0839                     *1             64743
439400200616     C***                  END                             E1             64743
439500200616     C*                                                                   64743
439600200616     C** MOVE FIRST 25 CURRENCIES TO ARRAY                                64743
439700200616     C***                  MOVE HCCY      @@CY1                           64743
439800200616     C*                                                                   64743
439900200616     C** ACCESS TABLE ON SECOND KEY                                       64743
440000200616     C***                  MOVE '2'       @@0830                          64743
440100200616     C***        @@0830    CHAINTABLETJF             80                   64743
440200200616     C*                                                                   64743
440300200616     C** IF SECOND RECORD FOUND AND NOT DELETED                           64743
440400200616     C***        *IN80     IFEQ '0'                        B1             64743
440500200616     C***        RECI      ANDNE'*'                        *1             64743
440600200616     C***                  MOVE HCCY      @@CY2            *1             64743
440700200616     C***                  END                             E1             64743
440800200616     C*                                                                   64743
440900200616     C** SEARCH ARRAY FOR INPUT CURRENCY                                  64743
441000200616     C***        @@CCY     LOKUP@CY                      81               64743
441100200616     C*                                                                   64743
441200200616     C** IF INPUT CURRENCY IS IN ARRAY                                    64743
441300200616     C***        *IN81     IFEQ '1'                        B1             64743
441400200616     C*                                                                   64743
441500200616     C** IF INCLUDE/EXCLUDE INDICATOR EQ 'E'                              64743
441600200616     C***        INEX      IFEQ 'E'                        B*2            64743
441700200616     C***                  MOVE 'W'       @@HIND  1        **2            64743
441800200616     C***                  ELSE                            X*2            64743
441900200616     C***                  MOVE 'H'       @@HIND           **2            64743
442000200616     C***                  END                             E*2            64743
442100200616     C***                  END                             E1             64743
442200200616     C*                                                                   64743
442300200616     C** IF INPUT CURRENCY IS NOT IN ARRAY                                64743
442400200616     C***        *IN81     IFEQ '0'                        B1             64743
442500200616     C*                                                                   64743
442600200616     C** IF INCLUDE/EXCLUDE INDICATOR EQ 'I'                              64743
442700200616     C***        INEX      IFEQ 'I'                        B*2            64743
442800200616     C***                  MOVE 'W'       @@HIND           **2            64743
442900200616     C***                  ELSE                            X*2            64743
443000200616     C***                  MOVE 'H'       @@HIND           **2            64743
443100200616     C***                  END                             E*2            64743
443200200616     C***                  END                             E1             64743
443300200616     C***        ZA0839    ENDSR                                          64743
443400200616     C**************************************************************************
443500200616      /EJECT
443600200616     C**************************************************************************
443700200616     C*                                                                        *
443800200616     C*  ZAPNUM - CALCULATE AP NUMERATOR                                       *
443900200616     C*                                                                        *
444000200616     C*  PURPOSE : TO MULTIPLY A NOMINAL POSITION BY THE PRICE OF THE          *
444100200616     C*  POSITION TO GIVE A VALUE OF THE POSITION WITH THE CORRECT NUMBER      *
444200200616     C*  OF DECIMAL PLACES FOR THE NOMINAL CURRENCY                            *
444300200616     C*                                                                        *
444400200616     C*  INPUT  FIELDS                                                         *
444500200616     C********ZNOML**11 0*****NOMINAL                                     S10978
444600200616     C*       ZNOML  15 0     NOMINAL                                     S10978
444700200616     C*       ZAVPR  15 8     AVERAGE PRICE                                    *
444800200616     C*       ZNMDP   1 0     NOMINAL DECIMAL PLACES (0-4)                     *
444900200616     C*       ZNMCD   1 0     NOMINAL CURRENCY DECIMAL PLACES (0-3)            *
445000200616     C*       ZPRCB   1 A     PRICE BASIS (P/U)                                *
445100200616     C*                                                                        *
445200200616     C*  OUTPUT  FIELDS                                                        *
445300200616     C*       ZVALU  15 0     VALUE                                            *
445400200616     C*                                                                        *
445500200616     C*  ALSO REQUIRED                                                         *
445600200616     C*       POWER8 ARRAY OF MULTIPLYING FACTORS FOR NOMINAL DECIMAL PLACES   *
445700200616     C*                                                                        *
445800200616     C*  WORK FIELDS:                                                          *
445900200616     C*       ZVAL0  15 0 - AVERAGE PRICE WITH 0 DECIMAL PLACES                *
446000200616     C*       ZVAL1  15 1 - --------------- '' ----------------                *
446100200616     C*       ZVAL2  15 2 - --------------- '' ----------------                *
446200200616     C*       ZVAL3  15 3 - --------------- '' ----------------                *
446300200616     C*       ZI      1 0 - POWER ARRAY                                        *
446400200616     C*                                                                        *
446500200616     C*  CALLED FROM:                                                          *
446600200616     C*                                                                        *
446700200616     C*************************************************************************
446800200616     C           ZAPNUM    BEGSR                           *** ZAPNUM ***
446900200616     C*
447000200616     C** DEFINE ALL FIELDS
447100200616     C**********           Z-ADDZNOML     ZNOML  110                      S10978
447200200616     C                     Z-ADDZNOML     ZNOML  150                      S10978
447300200616     C                     Z-ADDZAVPR     ZAVPR  158
447400200616     C                     Z-ADDZNMDP     ZNMDP   10
447500200616     C                     Z-ADDZNMCD     ZNMCD   10
447600200616     C                     MOVE ZPRCB     ZPRCB   1
447700200616     C                     Z-ADDZVALU     ZVALU  150
447800200616     C*
447900200616     C** IF NUMBER OF CURRENCY DECIMAL PLACES I = 0
448000200616     C           ZNMCD     IFEQ 0
448100200616     C           ZNOML     MULT ZAVPR     ZVAL0  150H
448200200616     C                     MOVE ZVAL0     ZVALU
448300200616     C                     END
448400200616     C*
448500200616     C** IF NUMBER OF CURRENCY DECIMAL PLACES I = 1
448600200616     C           ZNMCD     IFEQ 1
448700200616     C           ZNOML     MULT ZAVPR     ZVAL1  151H
448800200616     C                     MOVE ZVAL1     ZVALU
448900200616     C                     END
449000200616     C*
449100200616     C** IF NUMBER OF CURRENCY DECIMAL PLACES I = 2
449200200616     C           ZNMCD     IFEQ 2
449300200616     C           ZNOML     MULT ZAVPR     ZVAL2  152H
449400200616     C                     MOVE ZVAL2     ZVALU
449500200616     C                     END
449600200616     C*
449700200616     C** IF NUMBER OF CURRENCY DECIMAL PLACES I = 3
449800200616     C           ZNMCD     IFEQ 3
449900200616     C           ZNOML     MULT ZAVPR     ZVAL3  153H
450000200616     C                     MOVE ZVAL3     ZVALU
450100200616     C                     END
450200200616     C*
450300200616     C** SET INDEX ZI EQUAL TO 5 -. NOMINAL DECIMAL PLACES )
450400200616     C           5         SUB  ZNMDP     ZI      10
450500200616     C*
450600200616     C** MULTIPLY ZVALU BY  POWER8,ZI TO GET AMOUNT WITH NOMINAL DECIMAL PLACES
450700200616     C           ZVALU     MULT POWER8,ZI ZVALU
450800200616     C*
450900200616     C** PRICE BASIS IF = PERCENTAGE
451000200616     C           ZPRCB     IFEQ 'P'
451100200616     C           ZVALU     DIV  100       ZVALU     H
451200200616     C                     END
451300200616     C*
451400200616     C                     ENDSR
451500200616     C**********************************************************************
451600200616      /EJECT                                                                                  CGL020
451700200616      *****************************************************************                       CGL020
451800200616      *                                                               *                       CGL020
451900200616      * SRAMPR - Determine AML Pay/Receive Instructions               *                       CGL020
452000200616      *                                                               *                       CGL020
452100200616      * Called by: W101, W201                                         *                       CGL020
452200200616      *                                                               *                       CGL020
452300200616      * Calls: ZAAMLSETSE                                             *                       CGL020
452400200616      *                                                               *                       CGL020
452500200616      *****************************************************************                       CGL020
452600200616      *                                                                                       CGL020
452700200616     C           SRAMPR    BEGSR                           ** SRAMPR **                       CGL020
452800200616      *                                                                                       CGL020
452900200616     C           STLA      IFEQ *BLANKS                                                       CGL020
453000200616     C                     MOVE *BLANKS   F1RACT                                              CGL020
453100200616     C                     MOVE *BLANKS   F1RCTY                                              CGL020
453200200616     C                     MOVE *BLANKS   F1RBNK                                              CGL020
453300200616     C                     MOVE *BLANKS   F1RCDE                                              CGL020
453400200616     C                     MOVE *BLANKS   F1PACT                                              CGL020
453500200616     C                     MOVE *BLANKS   F1PCTY                                              CGL020
453600200616     C                     MOVE *BLANKS   F1PBNK                                              CGL020
453700200616     C                     MOVE *BLANKS   F1PCDE                                              CGL020
453800200616     C                     MOVE *BLANKS   F1DACT                                              CGL020
453900200616     C                     MOVE *BLANKS   F1DCTY                                              CGL020
454000200616     C                     MOVE *BLANKS   F1DBNK                                              CGL020
454100200616     C                     Z-ADD*ZEROS    F1SDAT                                              CGL020
454200200616      *                                                                                       CGL020
454300200616     C                     ELSE                                                               CGL020
454400200616     C                     MOVE *BLANKS   PINTG                                               CGL020
454500200616     C                     MOVE *BLANKS   PINTGA                                              CGL020
454600200616     C                     MOVE *BLANKS   PINST                                               CGL020
454700200616     C                     MOVE *BLANKS   PINSTA                                              CGL020
454800200616     C                     MOVE *BLANKS   PBENM                                               CGL020
454900200616     C                     MOVE *BLANKS   PBENMA                                              CGL020
455000200616     C**********           Z-ADDCSTN      PCUSTN                                       CGL020 CSD027
455100200616     C                     MOVE CSTN      PCUSTN                                              CSD027
455200200616      *                                                                                       CGL020
455300200616     C                     CALL ZAAMLP                                                        CGL020
455400200616     C                     PARM           PINTG  10                                           CGL020
455500200616     C                     PARM           PINTGA 35                                           CGL020
455600200616     C                     PARM           PINST  10                                           CGL020
455700200616     C                     PARM           PINSTA 35                                           CGL020
455800200616     C                     PARM           PBENM  10                                           CGL020
455900200616     C                     PARM           PBENMA 35                                           CGL020
456000200616     C                     PARM           PDEBT  10                                           CSW210
456100200616     C                     PARM           PDEBTA 35                                           CSW210
456200200616     C                     PARM           PCUSTN                                              CGL020
456300200616     C                     PARM *BLANKS   PBLANK  8                                           CGL020
456400200616     C                     PARM           STLA                                                CGL020
456500200616     C                     PARM           SEBR                                                CGL020
456600200616     C                     PARM           EVCY                                                CGL020
456700200616     C                     PARM           F1RACT                                              CGL020
456800200616     C                     PARM           F1RCTY                                              CGL020
456900200616     C                     PARM           F1RBNK                                              CGL020
457000200616     C                     PARM           F1RCDE                                              CGL020
457100200616     C                     PARM           F1PACT                                              CGL020
457200200616     C                     PARM           F1PCTY                                              CGL020
457300200616     C                     PARM           F1PBNK                                              CGL020
457400200616     C                     PARM           F1PCDE                                              CGL020
457500200616     C                     PARM           F1DACT                                              CGL020
457600200616     C                     PARM           F1DCTY                                              CGL020
457700200616     C                     PARM           F1DBNK                                              CGL020
457800200616      *                                                                                       CGL020
457900200616     C                     ENDIF                                                              CGL020
458000200616      *                                                                                       CGL020
458100200616     C                     Z-ADDEVDT      F1SDAT                                              CGL020
458200200616     C                     MOVE *BLANKS   F1TICK                                              CGL020
458300200616     C                     MOVE *BLANKS   F1EXCH                                              CGL020
458400200616     C                     MOVE *ZEROS    F1NOML                                              CGL020
458500200616      *                                                                                       CGL020
458600200616     C                     ENDSR                                                              CGL020
458700200616      *                                                                                       CGL020
458800200616      ********************************************************************                    CGL020
458900200616     C/COPY WNCPYSRC,SE6720C006
459000200616      /EJECT
459100200616     C**********************************************************************
459200200616     C**   SR/ZCCAL1 TO CALCULATE CHARGES/COMMISSIONS
459300200616     C**
459400200616     C/COPY ZSRSRC,ZCCAL1Z2
459500200616     C**********************************************************************
459600200616      /EJECT
459700200616     C**********************************************************************
459800200616     C**   SR/ZCCAL2 TO CALCULATE CHARGES/COMMISSIONS
459900200616     C**
460000200616     C/COPY ZSRSRC,ZCCAL2Z1
460100200616     C**********************************************************************
460200200616      /EJECT
460300200616     C**********************************************************************
460400200616     C**   SR/ZCCYCN TO CONVERT AMOUNT IN CCY1 TO CCY2
460500200616     C**
460600200616     C/COPY ZSRSRC,ZCCYCN
460700200616     C/COPY ZSRSRC,ZCCYXR                                                                     233712
460800200616     C**********************************************************************
460900200616      /EJECT
461000200616     C**********************************************************************
461100200616     C**   SR/ZEVCD TO ACCESS EVENT CONTROL DATE
461200200616     C**
461300200616     C/COPY ZSRSRC,ZEVCDZ1
461400200616     C**********************************************************************
461500200616      /EJECT
461600200616     C**********************************************************************
461700200616     C**   SR/ZHASH
461800200616     C**
461900200616     C/COPY ZSRSRC,ZHASHZ3
462000200616     C**********************************************************************
462100200616      /EJECT
462200200616     C**********************************************************************
462300200616     C*****SR/ZSETAC***************************************************   S01496
462400200616     C***********                                                         S01496
462500200616     C***/COPY*ZSRSRC,ZSETAC                                              S01496
462600200616     C**********************************************************************
462700200616      /EJECT
462800200616     C**********************************************************************
462900200616     C**   SR/ZTNLU1
463000200616     C**
463100200616     C/COPY ZSRSRC,ZTNLU1Z2
463200200616     C**********************************************************************
463300200616      /EJECT
463400200616     C********************************************************************CH0273
463500200616     C**   SR/ZXRATE                                                      CH0273
463600200616     C**                                                                  CH0273
463700200616     C/COPY ZSRSRC,ZXRATEZ1                                               CH0273
463800200616     C********************************************************************CH0273
463900200616     C/COPY ZSRSRC,ZICD2Z1                                                101626
464000200616      /COPY ZSRSRC,ZPOWER8Z2
464100200616**  POWER - ARRAY OF POWERS FOR CURRENCY CONVERSION
4642002006160000001
4643002006160000010
4644002006160000100
4645002006160001000
4646002006160010000
4647002006160100000
4648002006161000000
464900200616**  CPY@
465000200616(c) Finastra International Limited 2001
