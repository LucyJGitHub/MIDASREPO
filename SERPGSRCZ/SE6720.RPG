     H        1
      *****************************************************************
/*STD *  RPGBASE                                                      *
/*EXI *  TEXT('Midas SE ER gen. a/c keys and rc pos.settlments')      *
     F*****************************************************************
     F*                                                               *
     F*  Midas - Securities Trading Module                            *
     F*                                                               *
     F*  SE6720 - SE ER Generates A/C Keys & Position Settlements     *
     F*                                                               *
      *  (c) Finastra International Limited 2001                      *
     F*                                                               *
      *  Last Amend No. AR324886           Date 08Apr20               *
      *  Prev Amend No. MD046248           Date 27Oct17               *
      *                 215959             Date 21Mar16               *
      *                 CGL165             Date 17Feb15               *
      *                 CSW210             Date 04May10               *
      *                 BUG26839           Date 05Jan10               *
      *                 CER054             Date 07Apr09               *
      *                 BUG23123           Date 09Mar09               *
      *                 BUG22911           Date 17Feb09               *
      *                 CER048             Date 19May08               *
      * Bank Fusion Midas 1.4 Base -----------------------------------*
      * Midas Plus 1.4 Base 04 ---------------------------------------*
      * Midas Plus 1.4 Base ------------------------------------------*
      *                 234054             Date 14Feb07               *
      *                 219566             Date 09Feb07               *
      * Midas Plus 1.3 ----------- Base ------------------------------*
      *                 150158             Date 13Oct06               *
      *                 219688             Date 11Oct06               *
      *                 CSD031             Date 10Apr06               *
      *                 CSD027A            Date 06May06               *
      *                 CSD027             Date 09Dec05               *
      *                 BUG11164           Date 06Apr06               *
      *                 236137             Date 20Sep05               *
      *                 235546             Date 26Jul05               *
      *                 234874             Date 08Aug05               *
      *                 234813             Date 14Jul05               *
      *                 234440             Date 27Jun05               *
      *                 234140             Date 17May05               *
      *                 233712             Date 09Jun05               *
      *                 233709             Date 25May05               *
      *                 CSE071             Date 19Jul05               *
      *                 CSW037A            Date 02May05               *
      *                 CSD025             Date 11Jan05               *
      *                 CSW037             Date 15Dec04               *
      *                 CSW036             Date 15Dec04               *
      *                 BUG3122            Date 17Jul04               *
      *                 CLE025             Date 20Oct03               *
      *                 CGL029             Date 01Sep03               *
      *                 CGL020             Date 12Dec02               *
      * Midas Release 4.01.02 ----------------------------------------*
      *                 160338             Date 23Apr02               *
      * Midas Release 4.01 -------------------------------------------*
      *                 CSE034             Date 24Apr02               *
      * Midas Release 4 --------------- Base -------------------------*
      *                 CSE028             Date 06Jun01               *
      * Midas DBA 3.05 -----------------------------------------------*
      *                 189109             Date 12Jan01               *
      * Midas DBA 3.04 -----------------------------------------------*
      *                 CSE023             Date 12Jul00               *
      * Midas DBA 3.02 -----------------------------------------------*
      *                 CPB001             DATE 26Aug99               *
      * Midas DBA 3.00 ---------------- Base -------------------------*
     F*                 CEU005             Date 04Feb98               *
     F*                 092665             DATE 24FEB98               *
     F*                 CAC003             Date 25Feb97               *
     F*                 101626             Date 18JUL96               *
     F*                 095236             DATE 30OCT95               *
     F*                 094693             DATE 18OCT95               *
     F*                 085862             DATE 16MAR95               *
     F*                 S01496             DATE 02NOV94               *
     F*                 64743              DATE 12JAN94               *
     F*                 CH0273             DATE 02AUG93               *
     F*                 S10978             DATE 03MAY93               *
     F*                                                               *
     F*---------------------------------------------------------------*
     F*                                                               *
      *  AR324886 - Implement 4-eyes processing in Position           *
      *             Settlement Maintenance.                           *
      *             (Upgrade as required by HUT105)                   *
      *  MD046248 - Finastra Rebranding                               *
      *  215959 - Truncation error on event amount in SE2450P3.       *
      *           Recompiled due to changes in PF/SEKEYD.             *
      *         - Applied for MD-37439.                               *
      *  CGL165 - Dual Withholding Tax (Recompile)                    *
      *  CSW210 - SWIFT 2010 Changes                                  *
      *  CER054 - German Features - Church Tax (Recompile)            *
      *  BUG23123 - Report: Does not show Retail Account Number       *
      *                     Date is not Midas Standard Date           *
      *                     Period should be actual int. calc. period *
      *                     Secondary Tax amount is not printed       *
      *                     Added field TSSLID                        *
      *                     (Recompile)                               *
      *  BUG22911 - Changes for Correct Tax Calculation               *
      *  CER048 - German Features - Taxes                             *
     F*  234054 - Complete fix for for Depositary customer.           *
      *  219566 - Default the settlement account if no account for    *
      *           the specified portfolio. This is a LUX local fix    *
      *           so conditioned in core using new system value       *
      *           "UseDefaultSettAccnt" in SDSVALPD.                  *
     F*  150158 - Complete CAC003 : If profit center not found, use   *
     F*           the one by default.                                 *
      *  219688 - Settlement account not correctly retrieved          *
      *           If the customer is a portfolio one, access first    *
      *           with the account code defined as settlement in      *
      *           SDSECSPD. If not found use the PMACCNL0 account.    *
      *  CSD031 - Enhanced Centralised Static Data (Recompile)        *
      *  CSD027A - Conversion Of Customer Number to Alpha             *
      *  CSD027 - Conversion Of Customer Number to Alpha              *
      *  BUG11164 - A Serious Midas Error on SETRAD insert/amend      *
      *  236137 - Change Control for CGL031 Parts 4 & 5.              *
      *           Several changes in the Taxation of Savings Income   *
      *           functionality.                                      *
      *           - Choice of calculation method for fiscal price     *
      *           must take in account Tax Calculation Basis          *
      *           indicator from Country of Tax Codes file SDCTTXPD.  *
      *  235546 - Parameter to ZAINTPL2 has wrong length.             *
      *  234874 - Early redemption error in the EU tax calculation    *
      *           Parameters to call program SEETCPRTV                *
      *           Review calculation if country is 'CH'               *
      *  234813 - Do not calculate EU Tax if local tax is higher.     *
      *  234440 - Use new file ETCPOSND for average price, average    *
      *           fiscal price, purchased interest etc                *
      *         - Change Control 1 Part 4 - For Switzerland only,     *
      *           bonds at at a discount will have their fiscal price *
      *           calculated on a yield curve, and funds will not     *
      *           take into account the profit on a sale when deciding*
      *           the tax amount - THE LATTER PART HAS BEEN INSERTED  *
      *           AND THEN REMOVED AGAIN                              *
      *  234140 - EU witholding tax (recompile)                       *
      *  233712 - Changes for CGL031 (EU Taxation of Savings Income)  *
      *  233709 - Tax must be calculated prorata temporis to          *
      *           Effective Date.                                     *
      *  CSE071 - Multiple Holidays Re Securities (recompile)         *
      *  CSW037A- Additional Field extended to 40 chars (recompile)   *
      *  CSD025 - Customer De-Activation                              *
      *  CSW037 - Additional Field Data on MT300/MT320                *
      *  CSW036 - Dual SWIFT BIC held on Client Details               *
      *  BUG3122 - Recompiled due to changes in SDSECSPD.             *
      *  CLE025 - Credit Lines (Recompile)                            *
      *  CGL029 - Increase Account Code to 10 digits                  *
     F*  CGL020 - Midas Compliance Watch - Additional A/C Postings    *
     F*           Information                                         *
     F*  160338 - Although standard settlements instructions for the  *
     F*           customer was defined in Securities Standard         *
     F*           Settlement Maintenance, the settlement details for  *
     F*           the customer in Position Settlement for event type  *
     F*           'RC' is incorrect. Amend program in such a way that *
     F*           standard settlement instructions defined for the    *
     F*           customer is used in generating Position Settlement. *
      *  CSE034 - Standard Settlement Instruction improvements        *
      *  CSE028 - Standing Settlement Instructions Enhancement.       *
      *  189109 - Init field DAMT linked to CSE023                    *
      *  CSE023 - Treaty Withholding Tax (Recompiled)                 *
     F*  CPB001 - 'Private Banking' Module                            *
     F*  CEU005 - EMU SE Settlement Ccy Conversion                    *
     F*  092665 - CORRECT WEEKEND GENERATION                          *
      *  CAC003 - Profit Centre Accounting Development Phase 3.       *
     F*  101626 - If a security has a coupon and a redemption on the  *
     F*           same day, the redemption settlement is generated    *
     F*           one day after the coupon settlement. Fix is to use  *
     F*           'Type End of Day' parameter to set up Event Control *
     F*           Date to be the same as other SE settlement event    *
     F*           generation programs (e.g. SE2100)                   *
     F*  095236 - Value Date was zero                                 *
     F*  094693 - ACCNT's key is now split due to branch so use       *
     F*           external file description                           *
     F*  085862 - ZSETAC SHOULD INCLUDE BRANCH                        *
     F*  S01496 - Incorporation of Jyske Enhancements (S10978)        *
     F*  64743  - If there are CP/MT or CP/RC, both events should be  *
     F*           generated in the same EOD and not the day before    *
     F*           the last day before the redemption date (RC)        *
     F*                                                               *
     F*  CH0273 - INCORRECT CURRENCY FOR EARLY REDEMPTION.            *
     F*  S10978 - JYSZRH: EARLY REDEMPTIONS                           *
     F*                                                               *
     F*****************************************************************
     F*  C R E A T I O N     P A R A M E T E R S                      *
     F*                                                               *
     F*                                                               *
     F*****************************************************************
     F*
     F** Input files
     F*
     F********Bank*Details*********************************************   S01496
     F***SDBANKL1IF**E           K        DISK                            S01496
     F********Branch*Details*******************************************   S01496
     F***SDBRCHL0IF**E           K        DISK                            S01496
     F********General*Ledger*Details***********************************   S01496
     F***SDGELRL1IF**E           K        DISK                            S01496
     F********Retail*Details*******************************************   S01496
     F***SDRETLL1IF**E           K        DISK                            S01496
     F********Swiss*Taxes*ICD.*************************************CH0273 S01496
     F***SDSTAXPDIF**E           K        DISK                     CH0273 S01496
     F**      Portfolio
     F***PMPORTPPIF**E           K        DISK                            S01496
     FPMPORTPDIF  E           K        DISK                               S01496
     F*
     F**      Account Details by 15A Account Code. no prefix
     F***ACCNT***IF  F     416 15AI     2 DISK         KINFSR *PSSR       S01496
     F***ACCNT***IF**F     416 18AI     2 DISK         KINFSR *PSSR S01496094693
     FACCNT   IF  E           K        DISK         KINFSR *PSSR          094693
     F            ACCNTAAF                          KIGNORE               094693
     F            ACCNTABF                          KRENAMEACCNTB1F       094693
     F            ACCNTACF                          KIGNORE               094693
     F*
     F**      Account Details by 15N Account Number. no prefix
     F***ACNUM***IF**F      47 10AI     2 DISK         KINFSR *PSSR       094693
     FACNUM   IF  E           K        DISK         KINFSR *PSSR          094693
     F            ACCNTABF                          KRENAMEACCNTB2F       094693
     F********Client*Details*******************************************   S01496
     F***SDCUSTL0IF**E           K        DISK                            S01496
     F********Securities*Clients***************************************   S01496
     F***SDSECSL0IF**E           K        DISK                            S01496
     F********PM*special*Customer*Details******************************   S01496
     F***SDPLCSPDIF**E           K        DISK                            S01496
     F**      Security Details
     FSECTY   IF  E           K        DISK
     F********Securities*Trading***************************************   S01496
     F***SDSTRDL1IF**E           K        DISK                            S01496
     F********Currency*************************************************   S01496
     F***SDCURRL1IF**E           K        DISK                            S01496
     F*
     FSECGT   IF  E           K        DISK
     F*                                                                   CAC003
     F** Customer Position Profit Centre File                             CAC003
     FSEPCCD  IF  E           K        DISK                               CAC003
     F*
     F***SEDFTCL2IF**E           K        DISK                            S01496
     FSEDFTCL2IF  E           K        DISK                           UC  S01496
     F*                                                                   S01496
     FSEDFGRL0IF  E           K        DISK                           UC  S01496
     F            SEDFTCD0                          KRENAMESEDFGRD0       S01496
     F**
     F***FDTABJLLIF  E           K        DISK                         UC 64743
     F**      Standard Settlements Instructions
     FSTDSED  IF  E           K        DISK
     F**      Accounts by Portfolio
     F***ACCNTPS*IF**E           K        DISK                            S01496
     FPMACCNL0IF  E           K        DISK                               S01496
     F            ACCNTABF                          KRENAMEACCNTABI
     FPMACCNL1IF  E           K        DISK                               219688
     F            ACCNTABF                          KRENAMEACCNTL1F       219688
     F*                                                                   219688
     FTABSE   IF  E           K        DISK                               101626
     F            TABLETAF                          KIGNORE               101626
     F            TABTB10F                          KIGNORE               101626
     F            TABTB36F                          KIGNORE               101626
     F            TABTB40F                          KIGNORE               101626
     F            TABTE10F                          KIGNORE               101626
     F            TABTE20F                          KIGNORE               101626
     F            TABTG10F                          KIGNORE               101626
     F            TABTG20F                          KIGNORE               101626
     F            TABLETHF                          KIGNORE               101626
     F            TABLETKF                          KIGNORE               101626
     F            TABLETLF                          KIGNORE               101626
     F            TABLETNF                          KIGNORE               101626
     F            TABLETPF                          KIGNORE               101626
     F            TABLETRF                          KIGNORE               101626
     F            TABLETXF                          KIGNORE               101626
     F            TABLET2F                          KIGNORE               101626
     F            TABLET3F                          KIGNORE               101626
     F            TABLET5F                          KIGNORE               101626
      *                                                                                       234813
      ** Securities WHT details file                                                          234813
     FSESWHTL0IF  E           K        DISK         KINFSR *PSSR                              234813
      *                                                                                       233712
      ** Midas SD Tax Calculation Method                                                      233712
     FSDTXCML1IF  E           K        DISK         KINFSR *PSSR                              233712
      *                                                                                       233712
      ** Midas SD Joint Account Member                                                        233712
     FSDJACCLBIF  E           K        DISK         KINFSR *PSSR                              233712
      *                                                                                       233712
      ***Midas*SE*Customer*Position*File*******************************                233712 234440
     F***CPOSC** IF  E           K        DISK         KINFSR *PSSR                    233712 234440
      *                                                                                       233712
     F/COPY WNCPYSRC,SE6720F001
     F*****************************************************************
     F*
     F** Update files
     F*
     FSEERDPL0UF  E           K        DISK         KINFSR *PSSR
     FSEERALL0UF  E           K        DISK         KINFSR *PSSR
     FSEERRFL2UF  E           K        DISK         KINFSR *PSSR
     F*****************************************************************
     F*
     F** Output files
     F*
     FPOSETA  O   E                    DISK         KINFSR *PSSR
     FPOSETD  O   E           K        DISK         KINFSR *PSSR
     F***POSETDX0O***E           K        DISK         KINFSR *PSSR       S01496
     FPSAUTD  O   E           K        DISK                                                 AR324886
      ** SE Position Settlement Authorisation detail                                        AR324886
      *                                                                                     AR324886
     FSEKEYA  O   E                    DISK         KINFSR *PSSR
     FSEKEYD  O   E           K        DISK         KINFSR *PSSR
     FSE6720AUO   E                    PRINTER
     F**********************************************************************
     F*
     F*  FUNCTION OF INDICATORS
     F*
     F*    40  -  Analytical Accounting module and CAC003 is installed    CAC003
     F*    55  -  CHARGES BY CUSTOMER GROUP FEATURE IS ON                 S01496
     F*    60  -  Access to PF/SEPCCD                                     CAC003
      *    62  -  Access to PF/SESWHTPD                               *                       234813
     F*    89  -  FILE CHAIN/READ INDICATOR FOR FILES
     F*    90-99 - USED IN Z SUBROUTINES
     F*    U7  -  DATABASE ERROR
     F*    U8  -  DATABASE ERROR
     F*
     F*    I N D E X   T O   S U B R O U T I N E S
     F*
     F*  P001    - INITIAL PROCESSING
     F*  P002    - MAIN PROCESSING
     F*  P003    - TERMINATION PROCESSING
     F*  P005    - PROCESS ALL DEPOT RECORDS IN LF/SEERDPL0
     F*  P006    - PROCESS ALL ALLOCATION RECORDS IN LF/SEERALL0
     F*  P008    - DETERMINE IF EARLY REDEMPTION MUST BE PROCESSED
     F*  P801    - CALCULATE LAST WORKING DAY BEFORE REDEMPTION
     F*  P04     - SUBROUTINE TO CALCULATE CHARGE/COMMISSION AMOUNTS
     F*  P05     - SUBROUTINE TO CALCULATE DEFAULT AMOUNTS
     F*  P06     - SUBROUTINE TO CALCULATE SETTLEMENT AMOUNTS
     F*  CALAMT  - SUB ROUTINE TO DETERMINE IF AMOUNTS NEED TO BE
     F*            DEFAULTED FOR CHARGES
     F*  CALAM2  - SUB ROUTINE TO CALCULATE CHARGE AMOUNTS
     F*  CHKTAX  - Check if record is existing in SDCTTXPD for taxing                         233712
     F*  CSINSR  - Output Information on SDCSINPD                                             233712
     F*  ERTAX   - Calculate tax for descretionary and Safe                                   233712
     F*            Custody Customers for Mature                                               233712
     F*  MATXCL  - Calculate tax amount for the Maturity or Early                             233712
     F*            Redemption and to Output Information on SDCSINPD                           233712
     F*
     F*  W101    - WRITE ACCOUNT KEY (DEPOT)
     F*  W102    - WRITE POSITION SETTLEMENT  (DEPOT)
     F***P102****-*WRITE*POSITION*SETTLEMENT*EXTENSION*(DEPOT)*********   S01496
     F*  W201    - WRITE ACCOUNT KEY (CUSTOMER)
     F*  W202    - WRITE POSITION SETTLEMENT (CUSTOMER)
     F***P202****-*WRITE*POSITION*SETTLEMENT*EXTENSION*(CUSTOMER)******   S01496
     F*
     F*  AUDIT   - OUTPUTS AUDIT RECORD UDEPPA AND CONTROL REPORT
     F*  FIRST   - ACCESSES ICD INFORMATION
     F*  SECTIN  - GET SECURITY DETAIL RECORD IN
     F*  ZCONV   - CALLED BY ZCCAL1. IN THIS PROGRAM NOT STANDARD
     F*            SUBROUTINE; CALLS ZCCYCN TO GET AMOUNT IN ANOTHER
     F*            CURRENCY (SAME NAME AS STANDARD SUBROUTINE BECAUSE
     F*            NO CHANGE IN ZCCAL1)
     F*
     F*     STANDARD SUBROUTINE
     F*
     F*   ZA0830 - Check whether date is an holiday
     F*   ZAPNUM  - CALCULATE AP NUMERATOR
     F*       STANDARD SUBROUTINE DIRECTLY COPIED AND CHANGED |||||
     F*       CHANGE IS MARKED WITH S10978
     F*       ZNOML DEFINED 15,0 BECAUSE IN ZCCAL1 IS 15,0 TOO.
     F*   ZCCAL1  - TO CALCULATE CHARGES/COMMISSIONS
     F*   ZCCAL2  - TO CALCULATE CHARGES/COMMISSIONS
     F*   ZCCYCN  - CONVERT AMOUNT IN ONE CURRENCY TO ANOTHER CURRENCY
     F*   ZEVCD  - Calculate Event Control Date
     F*   ZHASH  - HASH TOTALLING STD SUBROUTINE
     F*   ZSETAC - SR. TO DETERMINE SETTLEMENT ACCOUNT
     F*   ZTNLU1  - TO LOCK THE TRANSACTION NUMBER DATA AREA,
     F**********************************************************************
      /EJECT
     E**********************************************************************
     E**    TABLES AND ARRAYS    **
     E*
     E/COPY ZSRSRC,ZPOWER8Z1
     E/COPY ZSRSRC,ZPOWERZ1
     E*
     E                    CPY@    1   1 80
     E/COPY ZSRSRC,ZHASHZ1
     E/COPY ZSRSRC,ZCCAL1Z1
     E*
     E**  USED BY SR. ZA0830 - CURRENCY RECORDS
     E***                 @CY        50  3                                64743
     E/COPY WNCPYSRC,SE6720E001
     E**********************************************************************
      /EJECT
     I**********************************************************************
     I***********                                                         094693
     I***ACCNT***NS**                                                     094693
     I***********                             2   70ZRCNUM                094693
     I***********                             8  10 ZRCCY                 094693
     I***********                            11  140ZRACOD                094693
     I***********                            15  160ZRACSQ                094693
     I***********                            27  29 ZRBRCA          S01496094693
     I***********                           401 404 ZRPTFR                094693
     I***ACNUM***NS*                                                      094693
     I***********                            12  170ZRCNUM                094693
     I***********                            18  20 ZRCCY                 094693
     I***********                            21  240ZRACOD                094693
     I***********                            25  260ZRACSQ                094693
     I***********                            29  31 ZRBRCA          S01496094693
     I***********                            41  44 ZRPTFR                094693
     IACCNTB1F                                                            094693
     I              CNUM                            ZRCNUM                094693
     I              CCY                             ZRCCY                 094693
     I              ACOD                            ZRACOD                094693
     I              ACSQ                            ZRACSQ                094693
     I              BRCA                            ZRBRCA                094693
     I              PTFR                            ZRPTFR                094693
     I*                                                                   094693
     IACCNTB2F                                                            094693
     I              CNUM                            ZRCNUM                094693
     I              CCY                             ZRCCY                 094693
     I              ACOD                            ZRACOD                094693
     I              ACSQ                            ZRACSQ                094693
     I              BRCA                            ZRBRCA                094693
     I              PTFR                            ZRPTFR                094693
     I*
     I**15*A*SETTLEMENT*ACCOUNT*RETURNED****************************      S01496
     I*                                                                   S01496
     I** 18 A Settlement Account Returned                                 S01496
     I            DS                            256
     I**********                              1   60ZWCNUM                                    CSD027
     I                                        1   6 ZWCNUM                                    CSD027
     I                                        7   9 ZWCCY
     I**********                             10  130ZWACOD                                    CGL029
     I**********                             14  150ZWACSQ                                    CGL029
     I                                       10  190ZWACOD                                    CGL029
     I                                       20  210ZWACSQ                                    CGL029
     I                                       22  24 ZWBRCA                                    CGL029
     I                                        1  24 ZKACCN                                    CGL029
     I****************************************1  15 ZWACCN                S01496
     I**********                             16  18 ZWBRCA                             S01496 CGL029
     I***********                             1  18 ZWACCN          S01496094693
     I**********                              1  18 ZKACCN                             S01496 CGL029
     I            DS                                                                          234874
     I                                        1   6 KCCNUM                                    234874
     I**********                              1   60VCCNUM                            234874 CSD027A
     I                                        1   6 VCCNUM                                   CSD027A
     I*
     I*  DATA STRUCTURE FOR COMPILATION  - COPYRIGHT INSERTION
     ICPYR@#      DS
     I                                        1  80 CPY@
     I                                        1  20 CPY@##
     I*
     ILDA         DS                            256
     I                                      132 183 WWLOT
     I                                      132 141 WWFILE
     I                                      142 170 WWKEY
     I                                      171 180 WWPGM
     I                                      181 1830WWASE
     I*
     I** Account Key Data Structure SR/W101
     IWACKEY      DS
     I                                        1   3 WACITY
     I                                        4   4 WACEVC
     I                                        5   5 WACTRT
     I                                        6   6 WACPFI
     I                                        7   8 WACBKC
     I                                        9  10 WACTST
     I                                        9  10 WACPSB
     I                                       11  12 WACCCC
     I                                       13  13 WACMKT
     I                                       14  14 WACCON
     I                                       15  15 WACNEG
     I                                       17  18 WARCTR                                    233712
     I                                       19  20 WACAMC
     I*
     I**  USED BY SR. ZA0830 - ARRAY DATA STRUCTURE
     I***                                     1 150 @CY                   64743
     I***                                     1  75 @@CY1                 64743
     I***                                    76 150 @@CY2                 64743
     I*
     I*  DS TO DEFINE A WORKING FIELD
     I*
     I            DS
     I**********                              1  12 PSEA1                                     CGL029
     I                                        1  18 PSEA1                                     CGL029
     I**********                              1   60CNUM                                      CSD027
     I                                        1   6 CNUM                                      CSD027
     I**********                              7  100ACOD                                      CGL029
     I**********                             11  120ACSQ                                      CGL029
     I                                        7  160ACOD                                      CGL029
     I                                       17  180ACSQ                                      CGL029
     I*
     I***LZSTAT      DS                            256                    S01496
     I***********                            24  24 COUR                  S01496
     I*
     I/COPY ZSRSRC,ZTNLU1Z1
     I/COPY ZSRSRC,ZHASHZ2
     I/COPY ZSRSRC,ZNCDZ2                                                                     234440
     I***/COPY*ZSRSRC,ZCCAL1Z3                                            S01496
     I/COPY WNCPYSRC,SE6720I001
     I*                                                                   CAC003
     I** External DS for Modules File                                     CAC003
     ISDMMOD    E DSSDMMODPD                                              CAC003
     I*
     ISDBANK    E DSSDBANKPD                                              S01496
     I**  Data structure for bank details                                 S01496
     I*                                                                   S01496
      *                                                                                       233712
     ISDLOCN    E DSSDLOCNPD                                                                  233712
      ** Midas SD Location Codes                                                              233712
      *                                                                                       233712
     ISDCUST    E DSSDCUSTPD                                                                  233712
      ** Midas SD Customer Details File                                                       233712
      *                                                                                       233712
     ISDBRCH    E DSSDBRCHPD                                                                  233712
     I              QQDFAC                          ZZDFAC                                    CGL035
     I** Branch Details                                                                       233712
     I*                                                                                       233712
     ISDCTTX    E DSSDCTTXPD                                                                  233712
      ** Midas SD Country of Tax Codes                                                        233712
      *                                                                                       233712
     ISECNTR    E DSSECNTRPD                                                                  234813
      ** Midas SE Country of Tax Rates                                                        234813
      *                                                                                       234813
     ISDSTRD    E DSSDSTRDPD                                              S01496
     I**  Data structure for securities trading details                   S01496
     I*                                                                   S01496
     ISDRETL    E DSSDRETLPD                                              S01496
     I**  Data structure for retail details                               S01496
     I*                                                                   S01496
     ISDGELR    E DSSDGELRPD                                              S01496
     I              QQACCD                          QQACC1                                    CGL029
     I**  Data structure for general ledger details                       S01496
     I*                                                                   S01496
     ISDSECS    E DSSDSECSPD                                              S01496
     I              QQACCD                          QQACC2                                    CGL029
     I**  Data structure for securities customer details                  S01496
     I*                                                                   S01496
     ISDPLCS    E DSSDPLCSPD                                              S01496
     I**  Data structure for portfolio management customer details        S01496
     I*                                                                   S01496
     ISCSARD    E DSSCSARDPD                                              S01496
     I**  Data structure for switchable features file                     S01496
     I              LCD                             WLLCD                 S01496
     I*                                                                   S01496
     ISDCURR    E DSSDCURRPD                                              S01496
     I**  Data structure for currency details                             S01496
     I*                                                                   S01496
     ISDTXPA    E DSSDTXPAPD                                                                BUG22911
      ** Data structure for Tax Parameter File                                              BUG22911
      *                                                                                     BUG22911
     IDSSDY     E DSDSSDY                                                 S01496
     I**  Long data structure for access objects                          S01496
     I*                                                                   S01496
     IDSFDY     E DSDSFDY                                                                     CGL020
      **  Short data structure for access objects                                             CGL020
      *                                                                                       CSE028
      ** DS for customer/book standard settlement instruction                                 CSE028
      **  to be passed to SESSIR0                                                             CSE028
      *                                                                                       CSE028
     IPCBSTD    E DSSTDSED                    2                                               CSE028
      *                                                                                       CSE028
      ** Data structure for standard additional settlement details                            CSE028
      ** for customer/book to be passed to SESSIR0                                            CSE028
      *                                                                                       CSE028
     IPCBSAD    E DSSTDADSED                  8                                               CSE028
      *                                                                                       234440
     IETCPOS    E DSETCPOSND                                                                  234440
     I              RECI                            ETRECI                                    234440
      ** Customer position for EU Savings tax                                                 234440
      *                                                                                       CSE028
     I              'ZAAMLSETSE'          C         ZAAMLP                                    CGL020
      *                                                                                       CGL020
     I**********                              1   60PCUSTN                             CGL020 CSD027
     I                                        1   6 PCUSTN                                    CSD027
      *                                                                                       CGL020
      * Data structure for AOSVALR0 string                                                    219566
     I            DS                                                                          219566
     I                                        1 200 SVAL1                                     219566
     I                                        1   1 DEF001                                    219566
      *                                                                                       219566
      * System Value                                                                          219566
     I            DS                                                                          219566
     I I            'UseDefaultSettAccnt '    1  20 SVALK1                                    219566
      *                                                                                       219566
     ISDSTAT    E DSSDSTAT                                                                  AR324886
      ** SD Data area                                                                       AR324886
      *                                                                                     AR324886
     I********************************************************************
      /EJECT
     C********************************************************************
     C*================================================================
     C*  P R O G R A M     S T A R T
     C*================================================================
     C********************************************************************
     C** MAIN PROCESSING
     C********************************************************************
     C*
     C***LZSTAT********************************************************   S01496
     C*
     C************NAMVAR   DEFN           LZSTAT                          S01496
     C***********          IN   LZSTAT                                    S01496
     C           *ENTRY    PLIST                                          101626
     C                     PARM           ACRLRN  1                       101626
     C*
     C                     EXSR P001
     C*
     C                     EXSR P002
     C*
     C                     EXSR P003
     C*
     ******************************************************************
      /EJECT
     ******************************************************************
     C* P001   : INITIAL PROCESSING                                   *
     ******************************************************************
     C*
     C           P001      BEGSR
     C*                                                                   S01496
     C**  Copyright statement                                             S01496
     C*                                                                   S01496
     C                     MOVEACPY@      ACT@   80                       S01496
     C                     MOVE PROT      PROT    1                       S01496
     C*
     C** 1. INITIALISE KEY AND WORKING FIELDS
     C*
     C                     MOVE *BLANKS   WWLOT
     C                     MOVEL'SE6720  'DBPGM  10
     C*
     C** Saved Security
     C           *LIKE     DEFN VASESN    #1SESN
     C** Security Nominal Currecny                                        CEU005
     C           *LIKE     DEFN NMCY      #1NMCY                          CEU005
     C           *LIKE     DEFN VLCY      #1VLCY                          160338
     C** Security Investment Type
     C           *LIKE     DEFN SITP      #1SITP
     C** Security Nominal CCY Spot,M/D Ind,Dec.places
     C           *LIKE     DEFN A6SPRT    WNSPRT
     C           *LIKE     DEFN A6MDIN    WNMDIN
     C           *LIKE     DEFN A6NBDP    WNNBDP
     C** EMU Currency fields                                              CEU005
     C           *LIKE     DEFN A6EUER    SVEUER                          CEU005
     C           *LIKE     DEFN A6EUMD    SVEUMD                          CEU005
     C** Fields for SR/ZEVCD (Event Control Date)
     C************LIKE     DEFN BKAPDT    APDA                            S01496
     C************LIKE     DEFN BJDNWD    DNWD                            S01496
     C           *NAMVAR   DEFN           SDSTAT                                            AR324886
     C                     IN   SDSTAT                                                      AR324886
     C*
     C** EXECUTE INITIAL PROCESSING
     C                     EXSR FIRST
     C*
     C** 4. CALCULATE 'EVENT CONTROL DATE' (ECD)
     C***********          MOVE BKAPDT    APDA                            S01496
     C***********          MOVE BJDNWD    DNWD                            S01496
     C                     MOVE BKAPDT    ZZAPDT                          S01496
     C                     MOVE BJDNWD    ZZDNWD                          S01496
     C                     EXSR ZEVCD
     C** ON ACCRUAL DATE FOLLOWED BY A NON WORKING DAY-                   101626
     C**     SE6720 IS RUN TWICE:                                         101626
     C**         - 1ST TIME PROCESSES EVENTS UP TO APDA                   101626
     C**           (ACRLRN SET ACCORDING TO RUN,IE 3)                     101626
     C**         - 2ND TIME PROCESSES EVENTS UP TO DNWD                   101626
     C**           (ACRLRN SET TO 4)                                      101626
     C** OTHERWISE -                                                      101626
     C**     SE6720 IS RUN ONCE.PROCESSES EVENTS UP TO DNWD               101626
     C**               (ACRLRN SET ACCORDING TO RUN,IE 1 OR 2)            101626
     C           ACRLRN    IFNE '3'                                       101626
     C                     Z-ADDDNWD      ECD     50                      101626
     C                     ELSE                                           101626
     C                     Z-ADDAPDA      ECD                             101626
     C                     END                                            101626
     C*
     C/COPY WNCPYSRC,SE6720C007
     C           EP001     ENDSR
     ******************************************************************
      /EJECT
     ******************************************************************
     C* P002   : MAIN PROCESSING                                      *
     ******************************************************************
     C*
     C           P002      BEGSR
     C*
     C** Access first record in ER References file
     C                     READ SEERRFL2                 89
     C*
     C** Do While end of file is not reached
     C           *IN89     DOWEQ'0'
     C*
     C** Determine if ER must be processed
     C                     EXSR P008
     C*
     C** If 'Position Settlement Required' and 'Account key Req.'
     C** Indicators are both equal to 'N', goto next ER
     C           PSRI      IFEQ 'N'
     C           AKRI      ANDEQ'N'
     C                     GOTO P002#1
     C                     ENDIF
     C*
     C** If New Security, access security details
     C           VASESN    IFNE #1SESN
     C                     MOVELVASESN    #1SESN
     C                     EXSR SECTIN
     C                     ENDIF
     C*
     C** Process all Depot Records
     C                     EXSR P005
     C*
     C** Process all Customer records
     C                     EXSR P006
     C*
     C** Update Early Redemption Reference Record
     C           PSRI      IFEQ 'Y'
     C                     MOVEL'Y'       VAPOSI
     C                     ENDIF
     C*
     C** If 'Account key Req.' Indicator equal to 'Y'
     C** and 'Status' is not 'Reverse'
     C           AKRI      IFEQ 'Y'
     C           VAERST    ANDNE'R'
     C           VAEVNI    ANDEQ'Y'                                       092665
     C                     MOVEL'C'       VAERST
     C                     ENDIF
     C*
     C** If 'Status' is not 'Reverse', Update the Early Redemp. Reference Record
     C           VAERST    IFNE 'R'
     C                     UPDATSEERRFD0
     C                     ENDIF
     C*
     C** Access next record
     C           P002#1    TAG
     C                     READ SEERRFL2                 89
     C*
     C                     ENDDO
     C*
     C           EP002     ENDSR
     ******************************************************************
      /EJECT
     ******************************************************************
     C* P003   : TERMINATION PROCESSING                               *
     ******************************************************************
     C*
     C           P003      BEGSR
     C*
     C** PROCESS AUDIT PROCESSING SR/AUDIT
     C                     EXSR AUDIT
     C*
     C** MOVE '1' TO *INLR
     C                     MOVE '1'       *INLR
     C*
     C** RETURN OUT OF THE PROGRAM
     C                     RETRN
     C*
     C           EP003     ENDSR
     ******************************************************************
      /EJECT
     C*****************************************************************
     C* FIRST - SUBROUTINE TO ACCESS ICD INFORMATION
     C*****************************************************************
     C*
     C           FIRST     BEGSR                           ** FIRST **
     C*
     C           *NAMVAR   DEFN           LDA
     C*
     C** Access to bank details
     C************LOVAL    SETLLSDBANKL1                                  S01496
     C***********          READ SDBANKL1                 89               S01496
     C*
     C                     CALL 'AOBANKR0'                                S01496
     C                     PARM *BLANKS   WLRTCD  7                       S01496
     C                     PARM '*FIRST'  WLOPTN  7                       S01496
     C           SDBANK    PARM SDBANK    DSSDY                           S01496
     C*                                                                   S01496
     C************IN89     IFEQ '1'                                       S01496
     C           WLRTCD    IFNE *BLANKS                                   S01496
     C                     Z-ADD1         DBASE            *****************
     C***********          MOVEL'SDBANKL1'DBFILE           ** DB ERROR 01 S01496
     C                     MOVE 'SDBANKPD'DBFILE           * DB ERROR 01 *S01496
     C                     MOVEL*BLANKS   DBKEY            *****************
     C                     MOVEL'*FIRST ' DBKEY                           S01496
     C                     EXSR *PSSR
     C                     ENDIF
     C*
     C** Parameter for ZA0830
     C***                  MOVE BJLCCY    @@CCY   3                       64743
     C*
     C** Access to General Ledger Details
     C************LOVAL    SETLLSDGELRL1                                  S01496
     C***********          READ SDGELRL1                 89               S01496
     C*                                                                   S01496
     C**********           CALL 'AOGELRR0'                                S01496              CGL029
     C                     CALL 'AOGELRR1'                                                    CGL029
     C                     PARM *BLANKS   WLRTCD                          S01496
     C                     PARM '*FIRST'  WLOPTN                          S01496
     C           SDGELR    PARM SDGELR    DSSDY                           S01496
     C*
     C************IN89     IFEQ '1'                                       S01496
     C           WLRTCD    IFNE *BLANKS                                   S01496
     C                     Z-ADD2         DBASE            *****************
     C***********          MOVEL'SDGELRL1'DBFILE           ** DB ERROR 02 S01496
     C                     MOVE 'SDGELRPD'DBFILE           * DB ERROR 02 *S01496
     C                     MOVEL*BLANKS   DBKEY            *****************
     C                     MOVEL'*FIRST ' DBKEY                           S01496
     C                     EXSR *PSSR
     C                     ENDIF
     C*
     C** Chain Securities Trading
     C*
     C************LOVAL    SETLLSDSTRDL1                                  S01496
     C***********          READ SDSTRDL1                 89               S01496
     C*                                                                   S01496
     C                     CALL 'AOSTRDR0'                                S01496
     C                     PARM *BLANKS   WLRTCD                          S01496
     C                     PARM '*FIRST'  WLOPTN                          S01496
     C           SDSTRD    PARM SDSTRD    DSSDY                           S01496
     C*
     C************IN89     IFEQ '1'                        ***************S01496
     C           WLRTCD    IFNE *BLANKS                    ***************S01496
     C                     Z-ADD3         DBASE            ** DB ERROR 03 **
     C***********          MOVEL'SDSTRDL1'DBFILE           ***************S01496
     C                     MOVE 'SDSTRDPD'DBFILE           ***************S01496
     C                     MOVEL*BLANK    DBKEY
     C                     MOVEL'*FIRST ' DBKEY                           S01496
     C                     EXSR *PSSR
     C                     ENDIF
     C*
     C** Retrieve account code
     C************LOVAL    SETLLSDRETLL1                                  S01496
     C***********          READ SDRETLL1                 89               S01496
     C*                                                                   S01496
     C                     CALL 'AORETLR0'                                S01496
     C                     PARM *BLANKS   WLRTCD                          S01496
     C                     PARM '*FIRST'  WLOPTN                          S01496
     C           SDRETL    PARM SDRETL    DSSDY                           S01496
     C*                                                                   S01496
     C************IN89     IFEQ '1'                        ***************S01496
     C           WLRTCD    IFNE *BLANKS                    ***************S01496
     C                     Z-ADD4         DBASE            ** DB ERROR 04 **
     C***********          MOVEL'SDRETLL1'DBFILE           ***************S01496
     C                     MOVE 'SDRETLPD'DBFILE           ***************S01496
     C                     MOVEL*BLANK    DBKEY
     C                     MOVEL'*FIRST ' DBKEY                           S01496
     C                     EXSR *PSSR                                     CH0273
     C                     ELSE
     C                     MOVE BMACCD    ACOD
     C                     ENDIF
     C***********                                                  CH0273 S01496
     C***RETRIEVE*SWISS*TAX*ICD************************************CH0273 S01496
     C***********                                                  CH0273 S01496
     C***********          READ SDSTAXPD                 89        CH0273 S01496
     C************IN89     IFEQ '1'                                CH0273 S01496
     C***********          Z-ADD100       DBASE            ********CH0273 S01496
     C***********          MOVEL'SDSTAXL1'DBFILE           ** DBER CH0273 S01496
     C***********          MOVEL*BLANKS   DBKEY            ********CH0273 S01496
     C***********          EXSR *PSSR                              CH0273 S01496
     C***********          ENDIF                                   CH0273 S01496
     C***********                                                  CH0273 S01496
     C***IF*RECORD*FOUND*AND*IF*'CHARGES*CURRENCY'*ISN'T*BLANK*****CH0273 S01496
     C***********                                                  CH0273 S01496
     C***********TXCHCY    IFNE *BLANKS                            CH0273 S01496
     C***********                                                  CH0273 S01496
     C***GET*SPOT*RATE*AND*MULTIPLY/DIVIDE*INDICATOR***************CH0273 S01496
     C***********                                                  CH0273 S01496
     C***********TXCHCY    CHAINSDCURRL1             89            CH0273 S01496
     C************IN89     IFEQ '1'                                CH0273 S01496
     C***********          Z-ADD101       DBASE            ********CH0273 S01496
     C***********          MOVEL'SDCURRL1'DBFILE           ** DBER CH0273 S01496
     C***********          MOVELTXCHCY    DBKEY            ********CH0273 S01496
     C***********          EXSR *PSSR                              CH0273 S01496
     C***********          ENDIF                                   CH0273 S01496
     C***********                                                  CH0273 S01496
     C***SAVE*BASE*CURRENCY*SPOT,*M/D*INDICATOR,*DEC.PLACES*FOR*LATCH0273 S01496
     C***********                                                  CH0273 S01496
     C***********          Z-ADDA6SPRT    TXSPOT 138               CH0273 S01496
     C***********          MOVE A6MDIN    TXMDI   10               CH0273 S01496
     C***********          MOVE A6NBDP    WNNBDP                   CH0273 S01496
     C***********          END                                     CH0273 S01496
     C*                                                                   CAC003
     C** Access MIDAS Modules.                                            CAC003
     C                     CALL 'AOMMODR0'                                CAC003
     C                     PARM '*MSG   ' WLRTCD                          CAC003
     C                     PARM '*FIRST'  WLOPTN                          CAC003
     C           SDMMOD    PARM SDMMOD    DSSDY                           CAC003
     C*                                                                   CAC003
     C           WLRTCD    IFNE *BLANKS                                   CAC003
     C                     Z-ADD20        DBASE            ***************CAC003
     C                     MOVEL'SDMMODPD'DBFILE           * DB ERROR 20 *CAC003
     C                     MOVEL'*FIRST  'DBKEY            ***************CAC003
     C                     EXSR *PSSR                                     CAC003
     C                     ENDIF                                          CAC003
     C*                                                                   CAC003
     C** Check if SAR CAC003 is installed                                 CAC003
     C*                                                                   CAC003
     C                     CALL 'AOSARDR0'                                CAC003
     C                     PARM *BLANKS   WLRTCD                          CAC003
     C                     PARM '*VERIFY' WLOPTN                          CAC003
     C                     PARM 'CAC003'  P@SARD  6                       CAC003
     C*                                                                   CAC003
     C** Set on *IN40 if Analytical Accounting Module and                 CAC003
     C** SAR CAC003 is installed                                          CAC003
     C           WLRTCD    IFEQ *BLANKS                                   CAC003
     C           BGN0ST    ANDEQ'Y'                                       CAC003
     C                     MOVE '1'       *IN40                           CAC003
     C                     ENDIF                                          CAC003
     C*
     C**  Check if feature "Customer Commissions/Courtage" is on          S01496
     C*                                                                   S01496
     C                     CALL 'AOSARDR0'                                S01496
     C                     PARM *BLANKS   WLRTCD                          S01496
     C                     PARM '*VERIFY' WLOPTN                          S01496
     C                     PARM 'S01446'  WLSARD  6                       S01496
     C           SCSARD    PARM SCSARD    DSSDY                           S01496
     C                     MOVE 'N'       S01446  1                       S01496
     C*                                                                   S01496
     C           WLRTCD    IFEQ *BLANKS                                   S01496
     C                     MOVE 'Y'       S01446                          S01496
     C                     ELSE                                           S01496
     C*                                                                   S01496
     C**  Return code other than *NRF                                     S01496
     C*                                                                   S01496
     C           WLRTCD    IFNE '*NRF'                                    S01496
     C                     Z-ADD15        DBASE            ***************S01496
     C                     MOVE 'SCSARDPD'DBFILE           * DB ERROR 15 *S01496
     C                     MOVELWLOPTN    DBKEY            ***************S01496
     C                     EXSR *PSSR                                     S01496
     C                     END                                            S01496
     C                     END                                            S01496
     C*                                                                   S01496
     C**  If feature "Customer Commissions/Courtage" is on and            S01496
     C**  securities charges currency is not blank, access currencies     S01496
     C**  file to get spot rate, mult/div ind. & no. of decimal places    S01496
     C*                                                                   S01496
     C           S01446    IFEQ 'Y'                                       S01496
     C           BVCHRC    ANDNE*BLANKS                                   S01496
     C*                                                                   S01496
     C                     CALL 'AOCURRR0'                                S01496
     C                     PARM *BLANKS   WLRTCD                          S01496
     C                     PARM '*KEY  '  WLOPTN                          S01496
     C                     PARM BVCHRC    WLCYCD                          S01496
     C           SDCURR    PARM SDCURR    DSSDY                           S01496
     C*                                                                   S01496
     C           WLRTCD    IFNE *BLANKS                                   S01496
     C                     Z-ADD16        DBASE            ***************S01496
     C                     MOVE 'SDCURRPD'DBFILE           * DB ERROR 16 *S01496
     C                     MOVELBVCHRC    DBKEY            ***************S01496
     C                     EXSR *PSSR                                     S01496
     C                     END                                            S01496
     C*                                                                   S01496
     C                     Z-ADDA6SPRT    WLSPRT 138                      S01496
     C                     Z-ADDA6NBDP    WLNBDP  10                      S01496
     C                     MOVE A6MDIN    WLMDIN  1                       S01496
     C*                                                                   S01496
     C                     END                                            S01496
     C*                                                                   S01496
     C**  Check if feature "Jyske Enhancements" is on                     S01496
     C*                                                                   S01496
     C                     CALL 'AOSARDR0'                                S01496
     C                     PARM *BLANKS   WLRTCD                          S01496
     C                     PARM '*VERIFY' WLOPTN                          S01496
     C                     PARM 'S01496'  WLSARD                          S01496
     C           SCSARD    PARM SCSARD    DSSDY                           S01496
     C                     MOVE 'N'       S01496  1                       S01496
     C*                                                                   S01496
     C           WLRTCD    IFEQ *BLANKS                                   S01496
     C                     MOVE 'Y'       S01496                          S01496
     C                     ELSE                                           S01496
     C*                                                                   S01496
     C**  Return code other than *NRF                                     S01496
     C*                                                                   S01496
     C           WLRTCD    IFNE '*NRF'                                    S01496
     C                     Z-ADD17        DBASE            ***************S01496
     C                     MOVE 'SCSARDPD'DBFILE           * DB ERROR 17 *S01496
     C                     MOVELWLOPTN    DBKEY            ***************S01496
     C                     EXSR *PSSR                                     S01496
     C                     END                                            S01496
     C                     END                                            S01496
     C*                                                                   S01496
     C**  If S01496 is on and autocharge option (BVACOP) is set to 'Y',   S01496
     C**  set on *IN55 to indicate that charges by customer group         S01496
     C**  feature is on                                                   S01496
     C*                                                                   S01496
     C           S01496    IFEQ 'Y'                                       S01496
     C           BVACOP    ANDEQ'Y'                                       S01496
     C                     MOVE '1'       *IN55                           S01496
     C                     END                                            S01496
     C*                                                                   S01496
     C**  Check if feature "Position Settlements Autocharges" is on       S01496
     C*                                                                   S01496
     C                     CALL 'AOSARDR0'                                S01496
     C                     PARM *BLANKS   WLRTCD                          S01496
     C                     PARM '*VERIFY' WLOPTN                          S01496
     C                     PARM 'S01519'  WLSARD                          S01496
     C           SCSARD    PARM SCSARD    DSSDY                           S01496
     C                     MOVE 'N'       S01519  1                       S01496
     C*                                                                   S01496
     C           WLRTCD    IFEQ *BLANKS                                   S01496
     C                     MOVE 'Y'       S01519                          S01496
     C                     ELSE                                           S01496
     C*                                                                   S01496
     C**  Return code other than *NRF                                     S01496
     C*                                                                   S01496
     C           WLRTCD    IFNE '*NRF'                                    S01496
     C                     Z-ADD18        DBASE            ***************S01496
     C                     MOVE 'SCSARDPD'DBFILE           * DB ERROR 18 *S01496
     C                     MOVELWLOPTN    DBKEY            ***************S01496
     C                     EXSR *PSSR                                     S01496
     C                     END                                            S01496
     C                     END                                            S01496
     C*                                                                   101626
     C                     EXSR ZICD2                                     101626
     C*  ERROR IN ZICD2                                                   101626
     C*                                                                   101626
     C           *INU8     IFEQ '1'                        ***************101626
     C                     Z-ADD12        DBASE            * DB ERROR 12 *101626
     C                     MOVEL'TABSE'   DBFILE           ***************101626
     C                     MOVELZTABKY    DBKEY                           101626
     C                     EXSR *PSSR                                     101626
     C                     END                                            101626
     C*                                                                   CEU005
     C**  Check if feature EMU Settlement Ccy Conversion is on.           CEU005
     C*                                                                   CEU005
     C                     CALL 'AOSARDR0'                                CEU005
     C                     PARM *BLANKS   WLRTCD                          CEU005
     C                     PARM '*VERIFY' WLOPTN                          CEU005
     C                     PARM 'CEU005'  WLSARD                          CEU005
     C           SCSARD    PARM SCSARD    DSSDY                           CEU005
     C                     MOVE 'N'       CEU005  1                       CEU005
     C*                                                                   CEU005
     C           WLRTCD    IFEQ *BLANKS                                   CEU005
     C                     MOVE 'Y'       CEU005                          CEU005
     C                     ELSE                                           CEU005
     C*                                                                   CEU005
     C**  Return code other than *NRF                                     CEU005
     C*                                                                   CEU005
     C           WLRTCD    IFNE '*NRF'                                    CEU005
     C                     Z-ADD21        DBASE            ***************CEU005
     C                     MOVE 'SCSARDPD'DBFILE           * DB ERROR 21 *CEU005
     C                     MOVELWLOPTN    DBKEY            ***************CEU005
     C                     EXSR *PSSR                                     CEU005
     C                     END                                            CEU005
     C                     END                                            CEU005
      *                                                                                       CSE028
      ** Check if CSE028 feature is installed                                                 CSE028
      *                                                                                       CSE028
     C                     MOVE 'N'       CSE028  1                                           CSE028
     C                     CALL 'AOSARDR0'                                                    CSE028
     C                     PARM '       ' WLRTCD                                              CSE028
     C                     PARM '*VERIFY' WLOPTN                                              CSE028
     C                     PARM 'CSE028'  WLSARD                                              CSE028
     C           SCSARD    PARM SCSARD    DSSDY                                               CSE028
      *                                                                                       CSE028
     C           WLRTCD    IFNE *BLANKS                                                       CSE028
     C           WLRTCD    ANDNE'*NRF   '                                                     CSE028
     C                     Z-ADD46        DBASE                                               CSE028
     C                     MOVEL'SE6720'  DBPGM                                               CSE028
     C                     MOVEL'SCSARDPD'DBFILE                                              CSE028
     C                     MOVELWLSARD    DBKEY                                               CSE028
     C                     EXSR *PSSR                                                         CSE028
     C                     ENDIF                                                              CSE028
      *                                                                                       CSE028
     C           WLRTCD    IFEQ *BLANK                                                        CSE028
     C                     MOVE 'Y'       CSE028                                              CSE028
     C                     ENDIF                                                              CSE028
      *                                                                                       233712
      ** Check if CGL031 - Taxation of Savings Income                                         233712
      **   is switched on.                                                                    233712
      *                                                                                       233712
     C                     CALL 'AOSARDR0'                                                    233712
     C                     PARM *BLANKS   P@RTCD  7                                           233712
     C                     PARM '*VERIFY' P@OPTN  7                                           233712
     C                     PARM 'CGL031'  P@SARD  6                                           233712
      *                                                                                       233712
     C           P@RTCD    IFEQ *BLANK                                                        233712
     C                     MOVE 'Y'       CGL031  1                                           233712
     C                     ELSE                                                               233712
     C                     MOVE 'N'       CGL031                                              233712
     C                     ENDIF                                                              233712
      * Set up the pgm name                                                                   234440
      *                                                                                       234440
     C                     MOVEL'SEETCPRT'WPGM    9                                           234440
     C                     MOVE 'V'       WPGM                                                234440
      *                                                                   094693
      ** Determine if Midas Compliance Watch is installed                                     CGL020
      *                                                                                       CGL020
     C                     MOVE 'N'       CGL020  1                                           CGL020
     C                     CALL 'AOSARDR0'                                                    CGL020
     C                     PARM '      '  WLRTCD                                              CGL020
     C                     PARM '*VERIFY' WLOPTN                                              CGL020
     C                     PARM 'CGL020'  WLSARD                                              CGL020
     C           SCSARD    PARM SCSARD    DSFDY                                               CGL020
      *                                                                                       CGL020
     C           WLRTCD    IFNE *BLANK                                                        CGL020
     C           WLRTCD    ANDNE'*NRF   '                                                     CGL020
     C           *LOCK     IN   LDA                                                           CGL020
     C                     MOVEL'SCSARDPD'DBFILE                                              CGL020
     C                     Z-ADD22        DBASE                                               CGL020
     C                     MOVELWLSARD    DBKEY                                               CGL020
     C                     EXSR *PSSR                                                         CGL020
      *                                                                                       CGL020
     C                     ELSE                                                               CGL020
     C                     MOVE 'Y'       CGL020                                              CGL020
     C                     ENDIF                                                              CGL020
      *                                                                                       CGL020
      *                                                                                       219566
      **  Access SDSAVLPD for Default settlement account to portfolio 001 indicator (Y/N)     219566
     C                     CALL 'AOSVALR0'                                                    219566
     C                     PARM *BLANKS   RTNCDE  7                                           219566
     C                     PARM           SVALK1 20                                           219566
     C                     PARM           SVAL1 200                                           219566
     C                     PARM           SVALK2 20                                           219566
     C                     PARM           SVAL2 200                                           219566
     C                     PARM           SVALK3 20                                           219566
     C                     PARM           SVAL3 200                                           219566
     C                     PARM           SVALK4 20                                           219566
     C                     PARM           SVAL4 200                                           219566
     C                     PARM           SVALK5 20                                           219566
     C                     PARM           SVAL5 200                                           219566
     C                     PARM           SVALK6 20                                           219566
     C                     PARM           SVAL6 200                                           219566
     C                     PARM           SVALK7 20                                           219566
     C                     PARM           SVAL7 200                                           219566
     C                     PARM           SVALK8 20                                           219566
     C                     PARM           SVAL8 200                                           219566
     C                     PARM           SVALK9 20                                           219566
     C                     PARM           SVAL9 200                                           219566
     C                     PARM           SVALK0 20                                           219566
     C                     PARM           SVAL10200                                           219566
      *                                                                                       219566
     C           RTNCDE    IFNE *BLANKS                                                       219566
     C                     MOVE SVALK1    DBKEY            * DB ERROR 50 *                    219566
     C                     Z-ADD50        DBASE                                               219566
     C                     MOVE 'SDSVALPD'DBFILE                                              219566
     C                     MOVEL'SE6720'  DBPGM                                               219566
     C                     EXSR *PSSR                                                         219566
     C                     ENDIF                                                              219566
      *                                                                                       219566
     C** Klist for ACCNT                                                  094693
     C*                                                                   094693
     C           ZWACCN    KLIST                                          094693
     C                     KFLD           ZWCNUM                          094693
     C                     KFLD           ZWCCY                           094693
     C                     KFLD           ZWACOD                          094693
     C                     KFLD           ZWACSQ                          094693
     C                     KFLD           ZWBRCA                          094693
     C*                                                                   S01496
      ** Get Tax Calculation Method - LF/SDTXCML1 (PF/SDTXCMPD)                               233712
      *                                                                                       233712
     C           KTXCM     KLIST                                                              233712
     C                     KFLD           KCSIS   2                                           233712
     C                     KFLD           KCTRT   2                                           233712
     C*                                                                                       233712
      ** Customer Current position                                                            233712
      *                                                                                       233712
     C           CPKEY     KLIST                                                              233712
     C                     KFLD           VCBRCD                                              233712
     C                     KFLD           VCCNUM                                              233712
     C                     KFLD           VCSESN                                              233712
      *                                                                                       233712
     C/COPY WNCPYSRC,SE6720C001
     C                     ENDSR
     C*
     C*****************************************************************
      /EJECT
     ******************************************************************
     C* P005   : PROCESS ALL DEPOT RECORDS IN LF/SEERDPL0             *
     ******************************************************************
     C*
     C           P005      BEGSR
     C*
     C** Access first depot record for current ER Reference
     C           VAERRF    SETLLSEERDPL0
     C                     READ SEERDPL0                 89
     C*
     C           *IN89     DOWEQ'0'
     C           VAERRF    ANDEQVBERRF
     C*
     C** If 'Record Identifier' is 'D' and
     C** if 'Nominal to be Redeemed' is not zero
     C           VBRECI    IFEQ 'D'
     C           VBNRDM    ANDNE0
     C*
     C** Calculate Nominal
     C                     Z-ADDVBNRDM    ZNOML
     C                     Z-ADDVAREDP    ZAVPR
     C                     EXSR ZAPNUM
     C                     Z-ADDZVALU     EVAM
     C*
     C** Retrieve Settlement instructions (Needed both in W102 and
     C** in W101)
     C                     EXSR P007
     C*
     C** If Position Settlement Required
     C           PSRI      IFEQ 'Y'
     C*
     C** 'Event Type' (PEVT)
     C                     MOVEL'RC'      PEVT
     C*
     C** 'Pay Receive' (PPRE)
     C                     MOVEL'R'       PPRE
     C*
     C** Write Position Settlement Record
     C                     EXSR W102
     C*
     C***Write*Position*Settlement*Extended*Record*********************   S01496
     C***********          EXSR P102                                      S01496
     C/COPY WNCPYSRC,SE6720C008
     C*
     C** Save 'TRANSACTION NUMBER OF THE LAST UPDATE' (TNL1)
     C** into 'POSITION SETTLEMENT TNL1' of LF/SEERDPL0
     C***********          Z-ADDTNL1      VBTNL1                          S01496
     C                     Z-ADDTNLU      VBTNL1                          S01496
     C*
     C** Update Early Redemption Depot record on LF/SEERDPL0
     C                     UPDATSEERDPD0
     C*
     C                     ENDIF
     C*
     C** If Account key Required
     C           AKRI      IFEQ 'Y'
     C*
     C** Write an Account Key Record
     C                     EXSR W101
     C*
     C                     ENDIF
     C*
     C                     ENDIF
     C*
     C** Access next Record
     C                     READ SEERDPL0                 89
     C*
     C                     ENDDO
     C*
     C           EP005     ENDSR
     C*
     ******************************************************************
      /EJECT
     ******************************************************************
     C* P006   : PROCESS ALL ALLOCATION RECORDS IN LF/SEERALL0        *
     ******************************************************************
     C*
     C           P006      BEGSR
     C*
     C** Access first Allocation record for current ER Reference
     C           VAERRF    SETLLSEERALL0
     C                     READ SEERALL0                 89
     C*
     C           *IN89     DOWEQ'0'
     C           VAERRF    ANDEQVCERRF
     C*
     C** If 'Record Identifier' is 'D', 'Er Type' is 'P' (Cust. Allocation Rec.)
     C** and if 'Nominal to be Redeemed' is not zero
     C** OR 'Status' is 'Reversed', 'Er Type' is 'P' (Cust. Allocation Rec.)
     C** and if 'Position Settlement TNL1' is not zero
     C           VCRECI    IFEQ 'D'
     C           VCERTP    ANDEQ'P'
     C           VCNOMA    ANDNE0
     C           VAERST    OREQ 'R'
     C           VCERTP    ANDEQ'P'
     C           VCTNL1    ANDNE*ZEROS
     C*
     C** Calculate Nominal
     C           VCNOMA    IFLT *ZEROS
     C           *ZERO     SUB  VCNOMA    ZNOML
     C                     ELSE
     C                     Z-ADDVCNOMA    ZNOML
     C                     ENDIF
     C                     Z-ADDVAREDP    ZAVPR
     C                     EXSR ZAPNUM
     C                     Z-ADDZVALU     EVAM
     C                     Z-ADDZVALU     WNOMAT 150                                          233712
     C*
     C** Retrieve Settlement instructions (Needed both for W202 and W201
     C                     EXSR P009
     C*                                                                   CAC003
     C** Declare KLIST for SEPCCD if Analytical Module and                CAC003
     C** SAR CAC003 is installed.                                         CAC003
     C           *IN40     IFEQ '1'                                       CAC003
     C*                                                                   CAC003
     C           KLPCCD    KLIST                                          CAC003
     C                     KFLD           VCCNUM                          CAC003
     C                     KFLD           VCBRCD                          CAC003
     C                     KFLD           VASESN                          CAC003
     C*                                                                   CAC003
     C** Access PF/SEPCCD using KLIST KLPCCD                              CAC003
     C                     MOVE 'N'       FIND    1                       CAC003
     C           KLPCCD    CHAINSEPCCD               60                   CAC003
     C           *IN60     IFEQ '0'                                       CAC003
     C                     MOVE 'Y'       FIND                            CAC003
     C                     ELSE                                           150158
     C                     MOVE BVSEPC    PCCU                            150158
     C                     MOVE 'Y'       FIND                            150158
     C                     ENDIF                                          CAC003
     C*                                                                   CAC003
     C                     ENDIF                                          CAC003
     C*
     C** Position Settlement required
     C           PSRI      IFEQ 'Y'
     C*
     C** Event Type
     C                     MOVEL'RC'      PEVT
     C*
     C** Pay Receive Indicator (depending on nominal sign)
     C           VCNOMA    IFGT 0
     C                     MOVEL'P'       PPRE
     C                     ELSE
     C                     MOVEL'R'       PPRE
     C                     ENDIF
     C*                                                                                       233712
     C** Check if tax needed to be calucated                                                  233712
     C*                                                                                       233712
     C           CGL031    IFEQ 'Y'                                                           233712
     C           SETX      ANDEQ'Y'                                                           233712
     C                     EXSR ERTAX                                                         233712
     C                     END                                                                233712
     C*
     C** Write Position Settlement Record
     C                     EXSR W202
     C*
     C***Write*Position*Settlement*Extended*Record*********************   S01496
     C***********          EXSR P202                                      S01496
     C/COPY WNCPYSRC,SE6720C009
     C*
     C** Transaction Number of Last Update into TNL1,SEERALL0
     C***********          Z-ADDTNL1      VCTNL1                          S01496
     C                     Z-ADDTNLU      VCTNL1                          S01496
     C*
     C** Update Early Redemption Record
     C                     UPDATSEERALD0
     C*
     C                     ENDIF
     C*
     C** Account Key required
     C           AKRI      IFEQ 'Y'
     C*
     C** Write an Account Key Record
     C                     EXSR W201
     C*
     C                     ENDIF
     C*
     C                     ENDIF
     C*
     C** Access next Record
     C                     READ SEERALL0                 89
     C*
     C                     ENDDO
     C*
     C           EP006     ENDSR
     C*
     ******************************************************************
      /EJECT
     ******************************************************************
     C* P007   : RETRIEVE SETTLEMENT INSTRUCTIONS FOR DEPOTS          *
     ******************************************************************
     C*
     C           P007      BEGSR
     C*
     C** Settlement Method
     C                     Z-ADD0         WPSMT   20
     C** Settlement Account
     C**********           MOVEL*BLANKS   WPSEA  12                                           CGL029
     C                     MOVE *BLANKS   WPSEA  18                                           CGL029
     C** Settlement Branch
     C                     MOVEL*BLANKS   WPSEB   3
     C** Counterparty Bank
     C                     MOVEL*BLANKS   WPCPN   8
     C** For Account Of
     C                     MOVEL*BLANKS   WPFAC   8
     C** Special Instructions
     C                     MOVEL*BLANKS   WPSPI  35
      *                                                                                       CSE028
      ** If CSE028 is on, call SESSIR0 for default of MT5xx information                       CSE028
      *                                                                                       CSE028
     C           CSE028    IFEQ 'Y'                                                           CSE028
      *                                                                                       CSE028
     C                     MOVE '0'       *IN89                                               CSE028
      *                                                                                       CSE028
     C                     CALL 'SESSIR0'                                                     CSE028
     C                     PARM 'D'       POTYP   1                                           CSE028
     C                     PARM           VBBRCD                                              CSE028
     C                     PARM           VBDDPT                                              CSE028
     C                     PARM *BLANKS   KBKCD                                               CSE028
     C                     PARM           NMCY                                                CSE028
     C                     PARM           SMCC                                                CSE034
     C                     PARM           SITP                                                CSE028
     C                     PARM *BLANKS   KPTFR                                               CSE028
     C                     PARM           PCBSTD                                              CSE028
     C                     PARM           PCBSAD                                              CSE028
     C                     PARM *BLANKS   PRTCD   5                                           CSE028
      *                                                                                       CSE028
     C           PRTCD     IFNE '*NCRF'                                                       CSE028
     C           PRTCD     ANDNE'*NRF '                                                       CSE028
     C           2         OCUR PCBSTD                                                        CSE028
     C                     ELSE                                                               CSE028
     C                     MOVE '1'       *IN89                                               CSE028
     C                     ENDIF                                                              CSE028
      *                                                                                       CSE028
     C                     ELSE                                                               CSE028
      *                                                                                       CSE028
     C                     MOVE *BLANKS   KBKCD   2                                           CSE028
     C                     MOVE *BLANKS   KPTFR   4                                           CSE028
     C*
     C** For Settlement Instruction access STDSED with key of
     C** Branch and Customer,SEERDPPD, Nominal CCY and Investment
     C** Type,SECTYD
     C           KEY102    KLIST
     C                     KFLD           VBBRCD
     C                     KFLD           VBDDPT
     C                     KFLD           KBKCD                                               CSE028
     C*********************KFLD           NMCY                            CEU005
     C                     KFLD           #1NMCY                          CEU005
     C                     KFLD           #1SITP
     C                     KFLD           KPTFR                                               CSE028
     C                     MOVELNMCY      #1NMCY                          CEU005
     C                     MOVELSITP      #1SITP
     C                     MOVELNMCY      PSCU                            160338
     C                     Z-ADD1         PSXR                            160338
     C                     MOVEL'M'       PMDI                            160338
     C           KEY102    CHAINSTDSED               89
     C           *IN89     IFEQ '1'
     C                     MOVEL*BLANKS   #1SITP
     C           KEY102    CHAINSTDSED               89
     C                     ENDIF
      *                                                                                       CSE028
     C                     ENDIF                                                              CSE028
      *                                                                                       CSE028
     C           *IN89     IFEQ '0'
      *                                                                   CEU005
      * CEU005 active and Settlement Ccy used on STDSED.                  CEU005
     C           CEU005    IFEQ 'Y'                                       CEU005
     C           SCCY      ANDNE*BLANKS                                   CEU005
     C***********          MOVE SCCY      SVSCCY  3                CEU005 160338
      *                                                                   CEU005
      * Access currencies file for EURO rate, EURO M/D indicator and      CEU005
      * Transition Date for 'In' Ccy.                                     CEU005
      *                                                                   CEU005
     C           NMCY      IFEQ BKEURO                                    CEU005
     C                     CALL 'AOCURRR0'                                CEU005
     C                     PARM           @RTCD   7                       CEU005
     C                     PARM '*KEY   ' @OPTN   7                       CEU005
     C                     PARM SCCY      @AJCD   3                       CEU005
     C           SDCURR    PARM SDCURR    DSSDY                           CEU005
     C           @RTCD     IFNE *BLANKS                                   CEU005
     C                     Z-ADD44        DBASE             ************  CEU005
     C                     MOVEL'SDCURRPD'DBFILE            * DATABASE *  CEU005
     C                     MOVELSCCY      DBKEY             * ERROR 44 *  CEU005
     C                     EXSR *PSSR                       ************  CEU005
     C                     ENDIF                                          CEU005
     C                     ELSE                                           CEU005
     C           SCCY      IFEQ BKEURO                                    CEU005
     C                     CALL 'AOCURRR0'                                CEU005
     C                     PARM           @RTCD   7                       CEU005
     C                     PARM '*KEY   ' @OPTN   7                       CEU005
     C                     PARM NMCY      @AJCD   3                       CEU005
     C           SDCURR    PARM SDCURR    DSSDY                           CEU005
     C           @RTCD     IFNE *BLANKS                                   CEU005
     C                     Z-ADD45        DBASE             ************  CEU005
     C                     MOVEL'SDCURRPD'DBFILE            * DATABASE *  CEU005
     C                     MOVELNMCY      DBKEY             * ERROR 45 *  CEU005
     C                     EXSR *PSSR                       ************  CEU005
     C                     ENDIF                                          CEU005
     C                     ENDIF                                          CEU005
     C                     ENDIF                                          CEU005
      *                                                                   CEU005
     C***********          MOVE A6EUMD    SVEUMD                   CEU005 160338
     C***********          MOVE A6EUER    SVEUER                   CEU005 160338
      *                                                                   CEU005
      * Value date is later than Transition Start Date.                   CEU005
     C           VAERPD    IFGE A6TPSD                                    CEU005
     C           A6INCY    ANDEQ'Y'                                       160338
     C                     Z-ADDA6EUER    PSXR                            160338
     C*                                                                   160338
     C** Nominal currency is Euro currency, reverse M/D indicator.        160338
     C*                                                                   160338
     C           NMCY      IFEQ BKEURO                                    160338
     C           A6EUMD    IFEQ 'M'                                       160338
     C                     MOVE 'D'       PMDI                            160338
     C                     ELSE                                           160338
     C                     MOVE 'M'       PMDI                            160338
     C                     ENDIF                                          160338
     C*                                                                   160338
     C** Settlement currency is Euro currency, use Euro M/D indicator.    160338
     C*                                                                   160338
     C                     ELSE                                           160338
     C                     MOVE A6EUMD    PMDI                            160338
     C                     ENDIF                                          160338
     C                     MOVE SCCY      PSCU                            160338
      *                                                                                       CSE028
      ** If CSE028 is on, call SESSIR0 for default of MT5xx information                       CSE028
      *                                                                                       CSE028
     C           CSE028    IFEQ 'Y'                                                           CSE028
      *                                                                                       CSE028
     C                     MOVE '0'       *IN78                                               CSE028
      *                                                                                       CSE028
     C                     CALL 'SESSIR0'                                                     CSE028
     C                     PARM 'D'       POTYP                                               CSE028
     C                     PARM           VBBRCD                                              CSE028
     C                     PARM           VBDDPT                                              CSE028
     C                     PARM *BLANKS   KBKCD                                               CSE028
     C                     PARM           SCCY                                                CSE028
     C                     PARM           SMCC                                                CSE034
     C                     PARM           SITP                                                CSE028
     C                     PARM *BLANKS   KPTFR                                               CSE028
     C                     PARM           PCBSTD                                              CSE028
     C                     PARM           PCBSAD                                              CSE028
     C                     PARM *BLANKS   PRTCD                                               CSE028
      *                                                                                       CSE028
     C           PRTCD     IFNE '*NCRF'                                                       CSE028
     C           PRTCD     ANDNE'*NRF '                                                       CSE028
     C           2         OCUR PCBSTD                                                        CSE028
     C                     ELSE                                                               CSE028
     C                     MOVE '1'       *IN78                                               CSE028
     C                     ENDIF                                                              CSE028
      *                                                                                       CSE028
     C                     ELSE                                                               CSE028
      * Chain STDSED again.                                               CEU005
     C                     MOVE SCCY      #1NMCY                          CEU005
     C           KEY102    CHAINSTDSED               78                   CEU005
      *                                                                                       CSE028
     C                     ENDIF                                                              CSE028
      *                                                                                       CSE028
     C***********          ENDIF                                   CEU005 160338
     C***********          ENDIF                                   CEU005 160338
      *                                                                   CEU005
      * If no record found ensure fields from last chain not loaded       CEU005
      * to output fields.                                                 CEU005
     C           *IN78     IFEQ '0'                                       CEU005
     C** Settlement Method
     C                     Z-ADDSRSM      WPSMT
     C** Settlement Account
     C                     MOVELSRAC      WPSEA
     C** Settlement Branch
     C***********          MOVELSRBR      WPSEB                           S01496
     C                     MOVELSRAB      WPSEB                           S01496
     C** Counterparty Bank
     C                     MOVELSRCB      WPCPN
     C** IF SRSM = 04 AND SRAC = BLANKS THE DETERMINE SETTLEMENT A/C
     C**    VIA SR/ZSETAC  AND OUTPUT TO FIELD PSEA
     C           SRSM      IFEQ 04
     C           SRAC      ANDEQ*BLANK
     C*
     C** PASS PARAMETERS TO SR/ZSETAC AND EXECUTE ROUTINE
     C                     MOVE SRSM      ZMETH
     C                     MOVE SRAC      ZSETI
     C                     MOVE VBDDPT    ZCNUM
     C                     MOVE NMCY      ZCCY
     C                     MOVE SRAB      ZBRCA                           085862
     C                     EXSR ZSETAC
     C                     MOVELZSETO     WPSEA
     C                     MOVELZWBRCA    WPSEB                           S01496
     C*
     C                     ENDIF
     C                     ENDIF
     C                     ENDIF                                          CEU005
     C                     ELSE                                           160338
     C*                                                                   160338
     C** Settlement method                                                160338
     C*                                                                   160338
     C                     Z-ADDSRSM      WPSMT                           160338
     C*                                                                   160338
     C** Settlement account                                               160338
     C*                                                                   160338
     C                     MOVELSRAC      WPSEA                           160338
     C*                                                                   160338
     C** Settlement branch                                                160338
     C*                                                                   160338
     C                     MOVELSRAB      WPSEB                           160338
     C*                                                                   160338
     C** Counterparty bank                                                160338
     C*                                                                   160338
     C                     MOVELSRCB      WPCPN                           160338
     C*                                                                   160338
     C** If SRSM = 04 and SRAC = Blanks then determine settlement a/c     160338
     C** via SR/ZSETAC and output to field PSEA                           160338
     C*                                                                   160338
     C           SRSM      IFEQ 04                                        160338
     C           SRAC      ANDEQ*BLANK                                    160338
     C*                                                                   160338
     C** Pass parameters to SR/ZSETAC and execute routine                 160338
     C*                                                                   160338
     C                     MOVE SRSM      ZMETH                           160338
     C                     MOVE SRAC      ZSETI                           160338
     C                     MOVE VBDDPT    ZCNUM                           160338
     C                     MOVE NMCY      ZCCY                            160338
     C                     MOVE SRAB      ZBRCA                           160338
     C                     EXSR ZSETAC                                    160338
     C                     MOVELZSETO     WPSEA                           160338
     C                     MOVELZWBRCA    WPSEB                           160338
     C                     ENDIF                                          160338
     C                     ENDIF                                          160338
     C                     ENDIF                                          160338
     C*
     C           EP007     ENDSR
     C*
     ******************************************************************
      /EJECT
     ******************************************************************
     C* P008   : DETERMINE IF EARLY REDEMPTION MUST BE PROCESSED      *
     ******************************************************************
     C*
     C           P008      BEGSR
     C*
     C                     MOVE 'N'       AKRI    1
     C                     MOVE 'N'       PSRI    1
     C*
     C** If 'Status' is not 'Reverse'
     C           VAERST    IFNE 'R'
     C*
     C** If Redemption Date *LE Events control date
     C           VAERRD    IFLE ECD
     C           VAPOSI    ANDEQ'N'                                      092665
     C                     MOVE 'Y'       AKRI
     C           VAPOSI    IFNE 'Y'
     C                     MOVE 'Y'       PSRI
     C                     ENDIF
     C                     ENDIF
     C*
     C***If*Position*Settlement*Required**NE*'Y',***                      64743
     C***and*if*there*are*not*yet*generated****                           64743
     C***        PSRI      IFNE 'Y'                                       64743
     C***        VAPOSI    ANDNE'Y'                                       64743
     C*                                                                   64743
     C***Calculate*last*Working*day*before*Redemption***                  64743
     C***                  EXSR P801                                      64743
     C*                                                                   64743
     C***If*'Last*Working*day*before*Redemption'*is*lower*than*or*equal*to64743
     C***'Date*of*next*Working*day'***                                    64743
     C***        WWERRD    IFLE BJDNWD                                    64743
     C***                  MOVEL'Y'       PSRI                            64743
     C***                  ENDIF                                          64743
     C***                  ENDIF                                          64743
     C*
     C** If 'Status' is 'Reverse'
     C                     ELSE
     C*
     C** If 'Last Change Date' is the 'Run Date' (= Reversed Today)
     C           VALCD     IFEQ BJRDNB
     C*
     C** If 'Trade/Depot Movmnt event Indicator' is equal to 'Y'
     C** (= was Completed before Reversing)
     C           VAEVNI    IFEQ 'Y'
     C                     MOVE 'Y'       AKRI
     C                     ENDIF
     C                     ENDIF
     C*
     C                     MOVEL'N'       PSRI
     C                     ENDIF
     C*
     C           EP008     ENDSR
     C*
     ******************************************************************
      /EJECT
     ******************************************************************
     C* P801   : CALCULATE LAST WORKING DAY BEFORE REDEMPTION         *
     ******************************************************************
     C*
     C***        P801      BEGSR                                          64743
     C*                                                                   64743
     C** POSITION SETTLEMENT MUST BE GENERATED ONE WORKING DAY BEFORE     64743
     C** REDEMPTION. IT IS TO ALLOW USER TO CHANGE/AMEND THEM BEFORE      64743
     C** A/C KEYS GENERATION.                                             64743
     C** THE NORMAL WAY IS TO GENERATE THEM WHEN REDEMPTION DATE IS       64743
     C** LOWER THAN NEXT WORKING DAY. BUT IF REDEMPTION DATE IS           64743
     C** (P.E. SUNDAY),THERE ARE GENERATED FRIDAY COB AND IT IS           64743
     C** TO LATE |                                                        64743
     C** SOLUTION IS TO COMPARE 'LAST WORKING DAY BEFORE REDEMPTION'      64743
     C** AND 'NEXT WORKING DAY'                                           64743
     C** 1 Z-ADD REDEMPTION DATE INTO A WORKING FIELD WWERRD (5,0)        64743
     C**   ('LAST WORKING DAY BEFORE REDEMPTION')                         64743
     C***                  Z-ADDVAERRD    WWERRD  50                      64743
     C** 2 MOVE 'H' IN @@HIND (HOLIDAY INDICATOR PARAMETER OF ZA0830)     64743
     C**   MOVE LOCAL CURRENCY CODE BJLCCY, FROM SDBANKL1 INTO @@CCY      64743
     C**   (CURRENCY PARAMETER).                                          64743
     C***                  MOVEL'H'       @@HIND                          64743
     C*                                                                   64743
     C** 3. DO WHILE DAY IS A HOLIDAY IN LOCAL CURRENCY                   64743
     C***        @@HIND    DOWEQ'H'                                       64743
     C*                                                                   64743
     C** 3.1 Z-ADD WWERRD INTO @@MNO (DATE PARAMETER)                     64743
     C***                  Z-ADDWWERRD    @@MNO   50                      64743
     C** 3.2 CHECK WHETHER THE DATE WWERRD IS A HOLIDAY                   64743
     C***                  EXSR ZA0830                                    64743
     C** 3.3 IF @@HIND IS 'H' (IT IS HOLIDAY).                            64743
     C***        @@HIND    IFEQ 'H'                                       64743
     C** 3.3.1 SUBTRACT 1 DAY FROM WWERRD                                 64743
     C***                  SUB  1         WWERRD                          64743
     C***                  ENDIF                                          64743
     C*                                                                   64743
     C***                  ENDDO                                          64743
     C*                                                                   64743
     C***                  ENDSR                                          64743
     C*                                                                   64743
     ******************************************************************
      /EJECT
     ******************************************************************
     C* P009   : Retrieve Settlement Instructions for Customers       *
     ******************************************************************
     C*
     C           P009      BEGSR
     C*
     C** DETERMINE SETTLEMENT CURRENCY  AND ACCOUNT AS FOLLOWS:
     C           *LIKE     DEFN VLCY      #1VCY0
     C           *LIKE     DEFN VLCY      #1VCY1
     C           *LIKE     DEFN VLCY      #1VCY2
     C           *LIKE     DEFN VLCY      #1VCY3
     C*
     C** Set Currency 1 to Value Currency
     C                     MOVELVLCY      #1VCY1
     C*
     C                     MOVE VCCNUM    #1CUST  6
     C*
     C** Access SDSECSL0 for Customer Settlement Currency
     C***********#1CUST    CHAINSDSECSL0             89                   S01496
     C*                                                                   S01496
     C                     MOVE *BLANKS   WZACOD 100                      219688
     C                     CALL 'AOSECSR0'                                S01496
     C                     PARM *BLANKS   WLRTCD                          S01496
     C                     PARM '*KEY  '  WLOPTN                          S01496
     C                     PARM #1CUST    WLCUSN  6                       S01496
     C           SDSECS    PARM SDSECS    DSSDY                           S01496
     C*                                                                   S01496
     C************IN89     IFEQ *ON                                       S01496
     C           WLRTCD    IFNE *BLANKS                                   S01496
     C                     Z-ADD5         DBASE            *****************
     C***********          MOVEL'SDSECSL0'DBFILE           ** DB ERROR 05 S01496
     C                     MOVE 'SDSECSPD'DBFILE           * DB ERROR 05 *S01496
     C                     MOVEL*BLANKS   DBKEY            *****************
     C                     MOVEL#1CUST    DBKEY                           S01496
     C                     EXSR *PSSR
     C                     ENDIF
     C*
      *                                                                   219688
     C                     MOVE BFACCD    WZACOD                          219688
      *                                                                   219688
     C** Portfolio Reference not blank and not '9997'
     C           VCPTFR    IFNE *BLANKS
     C           VCPTFR    ANDNE'9997'
     C***Access*PMPORTPP*for*Portfolio*Currency************************   S01496
     C** Access PMPORTPD for Portfolio Currency                           S01496
     C           W202K1    KLIST
     C                     KFLD           VCCNUM
     C                     KFLD           VCPTFR
     C***********W202K1    CHAINPMPORTPP             89                   S01496
     C           W202K1    CHAINPMPORTPD             89                   S01496
     C           *IN89     IFEQ *ON
     C                     Z-ADD6         DBASE            *****************
     C***********          MOVEL'PMPORTPP'DBFILE           ** DB ERROR 06 S01496
     C                     MOVE 'PMPORTPD'DBFILE           * DB ERROR 06 *S01496
     C                     MOVEL*BLANKS   DBKEY            *****************
     C                     EXSR *PSSR
     C                     ENDIF
     C** SET CCY2 TO PTFR CCY
     C                     MOVELPNPTCY    #1VCY2
     C                     ENDIF
     C*
     C** Portfolio reference not blank
     C           VCPTFR    IFNE *BLANKS
     C           BGPFMG    ANDEQ'Y'                                       CPB001
     C** Access SDPLCSPD for Customer Base Currency
     C***********#1CUST    CHAINSDPLCSPD             89                   S01496
     C*                                                                   S01496
     C                     CALL 'AOPLCSR0'                                S01496
     C                     PARM *BLANKS   WLRTCD                          S01496
     C                     PARM '*KEY  '  WLOPTN                          S01496
     C                     PARM #1CUST    WLCUST 10                       S01496
     C           SDPLCS    PARM SDPLCS    DSSDY                           S01496
     C*                                                                   S01496
     C************IN89     IFEQ *ON                                       S01496
     C           WLRTCD    IFNE *BLANKS                                   S01496
     C                     Z-ADD7         DBASE            *****************
     C***********          MOVEL'SDPLCSPD'DBFILE           ** DB ERROR 07 S01496
     C                     MOVE 'SDPLCSPD'DBFILE           * DB ERROR 07 *S01496
     C                     MOVEL*BLANKS   DBKEY            *****************
     C                     MOVEL#1CUST    DBKEY                           S01496
     C                     EXSR *PSSR
     C                     ENDIF
     C** Set Currency 3 to Customer Currency
     C                     MOVELQBCSBY    #1VCY3
     C** if PTFR = '9997', set Currency 2 to Customer Currency
     C           VCPTFR    IFEQ '9997'
     C           BGN4ST    ANDNE'Y'                                       CPB001
     C                     MOVELQBCSBY    #1VCY2
     C                     ENDIF
     C*
     C** else = Portfolio reference blank
     C                     ELSE
     C** Set Currency 2 and Currency 3 to Customer Settlement CCY
     C***********          MOVELBFPCYP    #1VCY2                          S01496
     C***********          MOVELBFPCYP    #1VCY3                          S01496
     C                     MOVELBFPCYC    #1VCY2                          S01496
     C                     MOVELBFPCYC    #1VCY3                          S01496
     C                     ENDIF
     C*
     C** Check for Customer Account in Currency 1 & same Portfolio.
     C** If found, use this account otherwise check for Account in
     C** Currency 2 and 3.
     C           *LIKE     DEFN ACSQ      #1ACSQ
     C           *LIKE     DEFN VCCNUM    #CCNUM
     C           *LIKE     DEFN VCPTFR    #CPTFR
     C           W202K2    KLIST
     C                     KFLD           #CCNUM
     C                     KFLD           #1VCY0
     C                     KFLD           #CPTFR
     C                     KFLD           #1ACSQ
     C*                                                                   219688
     C** ACCOUNT DETAILS PMACCNL1                                         219688
     C           ACCNTL    KLIST                                          219688
     C                     KFLD           #CCNUM                          219688
     C                     KFLD           #CPTFR                          219688
     C                     KFLD           #1VCY0                          219688
     C                     KFLD           WZACOD                          219688
     C                     KFLD           #1ACSQ                          219688
     C*                                                                   219688
     C           KEY103    KLIST                                          160338
     C                     KFLD           VCBRCD                          160338
     C                     KFLD           VCCNUM                          160338
     C                     KFLD           VCBOOK                          160338
     C                     KFLD           #1VLCY                          160338
     C                     KFLD           #1SITP                          160338
     C                     KFLD           VCPTFR                          160338
     C                     MOVELVLCY      #1VLCY                          160338
     C                     MOVELSITP      #1SITP                          160338
     C           KEY103    CHAINSTDSED               89                   160338
     C           *IN89     IFEQ '1'                                       160338
     C                     MOVE *BLANKS   #1SITP                          160338
     C           KEY103    CHAINSTDSED               89                   160338
     C                     ENDIF                                          160338
     C           *IN89     IFEQ '0'                                       160338
     C*                                                                   160338
     C** CEU005 active and Settlement Ccy used on STDSED.                 160338
     C*                                                                   160338
     C           CEU005    IFEQ 'Y'                                       160338
     C           SCCY      ANDNE*BLANKS                                   160338
     C                     MOVE SCCY      SVSCCY  3                       160338
     C*                                                                   160338
     C** Access currencies file for EURO rate, EURO M/D indicator and     160338
     C** Transition Date for 'In' Ccy.                                    160338
     C*                                                                   160338
     C           NMCY      IFEQ BKEURO                                    160338
     C                     CALL 'AOCURRR0'                                160338
     C                     PARM           @RTCD   7                       160338
     C                     PARM '*KEY   ' @OPTN   7                       160338
     C                     PARM SCCY      @AJCD   3                       160338
     C           SDCURR    PARM SDCURR    DSSDY                           160338
     C           @RTCD     IFNE *BLANKS                                   160338
     C                     Z-ADD46        DBASE             ************  160338
     C                     MOVEL'SDCURRPD'DBFILE            * DATABASE *  160338
     C                     MOVELSCCY      DBKEY             * ERROR 46 *  160338
     C                     EXSR *PSSR                       ************  160338
     C                     ENDIF                                          160338
     C                     ELSE                                           160338
     C           SCCY      IFEQ BKEURO                                    160338
     C                     CALL 'AOCURRR0'                                160338
     C                     PARM           @RTCD   7                       160338
     C                     PARM '*KEY   ' @OPTN   7                       160338
     C                     PARM NMCY      @AJCD   3                       160338
     C           SDCURR    PARM SDCURR    DSSDY                           160338
     C           @RTCD     IFNE *BLANKS                                   160338
     C                     Z-ADD47        DBASE             ************  160338
     C                     MOVEL'SDCURRPD'DBFILE            * DATABASE *  160338
     C                     MOVELNMCY      DBKEY             * ERROR 47 *  160338
     C                     EXSR *PSSR                       ************  160338
     C                     ENDIF                                          160338
     C                     ENDIF                                          160338
     C                     ENDIF                                          160338
     C                     MOVE A6EUMD    SVEUMD                          160338
     C                     MOVE A6EUER    SVEUER                          160338
     C*                                                                   160338
     C** Value date is later than Transition Start Date.                  160338
     C*                                                                   160338
     C           VAERPD    IFGE A6TPSD                                    160338
     C           A6INCY    ANDEQ'Y'                                       160338
     C                     Z-ADDA6EUER    PSXR                            160338
     C*                                                                   160338
     C** Nominal currency is Euro currency, reverse M/D indicator.        160338
     C*                                                                   160338
     C           NMCY      IFEQ BKEURO                                    160338
     C           A6EUMD    IFEQ 'M'                                       160338
     C                     MOVE 'D'       PMDI                            160338
     C                     ELSE                                           160338
     C                     MOVE 'M'       PMDI                            160338
     C                     ENDIF                                          160338
     C*                                                                   160338
     C** Settlement currency is Euro currency, use Euro M/D indicator.    160338
     C*                                                                   160338
     C                     ELSE                                           160338
     C                     MOVE A6EUMD    PMDI                            160338
     C                     ENDIF                                          160338
     C                     MOVE SCCY      WPSCU                           160338
      * Chain STDSED again.                                               160338
     C                     MOVE SCCY      #1VLCY                          160338
     C           KEY103    CHAINSTDSED               78                   160338
     C           *IN78     IFEQ '1'                                       160338
     C                     Z-ADD0         WPSMT                           160338
     C                     MOVEL*BLANKS   WPSEA                           160338
     C                     MOVEL*BLANKS   WPSEB                           160338
     C                     MOVEL*BLANKS   WPCPN                           160338
     C                     ELSE                                           160338
     C           VCNOMA    IFGT 0                                         160338
     C                     Z-ADDSPSM      WPSMT                           160338
     C                     MOVELSPAT      WPSEA                           160338
     C                     MOVELSPBA      WPSEB                           160338
     C                     MOVELSPCB      WPCPN                           160338
     C*                                                                   160338
     C** If SPSM = 04 and SPAT = blanks then determine a/c                160338
     C** via SR/ZSETAC and output to field PSEA                           160338
     C*                                                                   160338
     C           SPSM      IFEQ 04                                        160338
     C           SPAT      ANDEQ*BLANK                                    160338
     C*                                                                   160338
     C** Pass parameters to SR/ZSETAC and execute routine                 160338
     C*                                                                   160338
     C                     MOVE SPSM      ZMETH                           160338
     C                     MOVE SPAT      ZSETI                           160338
     C                     MOVE VCCNUM    ZCNUM                           160338
     C                     MOVE VLCY      ZCCY                            160338
     C                     MOVE SPBA      ZBRCA                           160338
     C                     EXSR ZSETAC                                    160338
     C                     MOVELZSETO     WPSEA                           160338
     C                     MOVELZWBRCA    WPSEB                           160338
     C                     ENDIF                                          160338
     C                     ELSE                                           160338
     C                     Z-ADDSRSM      WPSMT                           160338
     C                     MOVELSRAC      WPSEA                           160338
     C                     MOVELSRAB      WPSEB                           160338
     C                     MOVELSRCB      WPCPN                           160338
     C*                                                                   160338
     C** If SRSM = 04 and SRAC = blanks then determine a/c                160338
     C** via SR/ZSETAC and output to field PSEA                           160338
     C*                                                                   160338
     C           SRSM      IFEQ 04                                        160338
     C           SRAC      ANDEQ*BLANK                                    160338
     C*                                                                   160338
     C** Pass parameters to SR/ZSETAC and execute routine                 160338
     C*                                                                   160338
     C                     MOVE SRSM      ZMETH                           160338
     C                     MOVE SRAC      ZSETI                           160338
     C                     MOVE VCCNUM    ZCNUM                           160338
     C                     MOVE VLCY      ZCCY                            160338
     C                     MOVE SRAB      ZBRCA                           160338
     C                     EXSR ZSETAC                                    160338
     C                     MOVELZSETO     WPSEA                           160338
     C                     MOVELZWBRCA    WPSEB                           160338
     C                     ENDIF                                          160338
     C                     ENDIF                                          160338
     C                     ENDIF                                          160338
     C                     ENDIF                                          160338
     C                     ELSE                                           160338
     C                     MOVELVLCY      WPSCU                           160338
     C           VCNOMA    IFGT 0                                         160338
     C                     Z-ADDSPSM      WPSMT                           160338
     C                     MOVELSPAT      WPSEA                           160338
     C                     MOVELSPBA      WPSEB                           160338
     C                     MOVELSPCB      WPCPN                           160338
     C*                                                                   160338
     C** If SPSM = 04 and SPAT = blanks then determine a/c                160338
     C** via SR/ZSETAC and output to field PSEA                           160338
     C*                                                                   160338
     C           SPSM      IFEQ 04                                        160338
     C           SPAT      ANDEQ*BLANK                                    160338
     C*                                                                   160338
     C** Pass parameters to SR/ZSETAC and execute routine                 160338
     C*                                                                   160338
     C                     MOVE SPSM      ZMETH                           160338
     C                     MOVE SPAT      ZSETI                           160338
     C                     MOVE VCCNUM    ZCNUM                           160338
     C                     MOVE VLCY      ZCCY                            160338
     C                     MOVE SPBA      ZBRCA                           160338
     C                     EXSR ZSETAC                                    160338
     C                     MOVELZSETO     WPSEA                           160338
     C                     MOVELZWBRCA    WPSEB                           160338
     C                     ENDIF                                          160338
     C                     ELSE                                           160338
     C                     Z-ADDSRSM      WPSMT                           160338
     C                     MOVELSRAC      WPSEA                           160338
     C                     MOVELSRAB      WPSEB                           160338
     C                     MOVELSRCB      WPCPN                           160338
     C*                                                                   160338
     C** If SRSM = 04 and SRAC = blanks then determine a/c                160338
     C** via SR/ZSETAC and output to field PSEA                           160338
     C*                                                                   160338
     C           SRSM      IFEQ 04                                        160338
     C           SRAC      ANDEQ*BLANK                                    160338
     C*                                                                   160338
     C** Pass parameters to SR/ZSETAC and execute routine                 160338
     C*                                                                   160338
     C                     MOVE SRSM      ZMETH                           160338
     C                     MOVE SRAC      ZSETI                           160338
     C                     MOVE VCCNUM    ZCNUM                           160338
     C                     MOVE VLCY      ZCCY                            160338
     C                     MOVE SRAB      ZBRCA                           160338
     C                     EXSR ZSETAC                                    160338
     C                     MOVELZSETO     WPSEA                           160338
     C                     MOVELZWBRCA    WPSEB                           160338
     C                     ENDIF                                          160338
     C                     ENDIF                                          160338
     C                     ENDIF                                          160338
     C*                                                                   160338
     C** Record not found in file STDSED                                  160338
     C*                                                                   160338
     C                     ELSE                                           160338
     C*
     C** Preset Key W202K2
     C                     MOVELVCCNUM    #CCNUM
     C                     MOVEL#1VCY1    #1VCY0
     C                     MOVELVCPTFR    #CPTFR
     C                     Z-ADD0         #1ACSQ
     C*
     C** CURRENCY 1
     C***********W202K2    SETLLACCNTPS                                   S01496
     C***********          READ ACCNTPS                  89               S01496
     C** READ FIRST RECORD FOR ACCOUNT FOR THE SDSECSPD ACCOUNT CODE      219688
     C           ACCNTL    SETLLPMACCNL1                                  219688
     C                     READ PMACCNL1                 89               219688
      *                                                                   219688
     C                     MOVEL*IN89     W202F1                          219688
      *                                                                   219688
     C           *IN89     IFEQ '0'                                       219688
     C           CNUM      ANDEQ#CCNUM                                    219688
     C           CCY       ANDEQ#1VCY0                                    219688
     C           PTFR      ANDEQ#CPTFR                                    219688
     C           ACOD      ANDEQWZACOD                                    219688
     C                     ELSE                                           219688
     C*                                                                   219688
     C           W202K2    SETLLPMACCNL0                                  S01496
     C                     READ PMACCNL0                 89               S01496
     C                     MOVEL*IN89     W202F1  1
     C           *IN89     IFEQ *OFF
     C           CNUM      IFNE #CCNUM
     C           CCY       ORNE #1VCY0
     C           PTFR      ORNE #CPTFR
     C**                                                                  219566
     C** IF system value 'UseDefaultSettAccnt' is 'Y' then                219566
     C**    get first record of same account and currency                 219566
     C           DEF001    IFEQ 'Y'                                       219566
     C                     MOVE *BLANKS   #CPTFR                          219566
     C           W202K2    SETLLPMACCNL0                                  219566
     C                     READ PMACCNL0                 89               219566
     C*                                                                   219566
     C           *IN89     IFEQ *OFF                                      219566
     C           CNUM      IFNE #CCNUM                                    219566
     C           CCY       ORNE #1VCY0                                    219566
     C                     MOVEL*ON       W202F1                          219566
     C                     ENDIF                                          219566
     C                     ENDIF                                          219566
     C*                                                                   219566
     C                     ELSE                                           219566
     C                     MOVEL*ON       W202F1  1
     C                     ENDIF                           Endif DEF001=Y 219566
     C*                                                                   219566
     C                     ENDIF
     C                     ENDIF
     C*
     C                     END                                            219688
      *                                                                   219688
     C** CURRENCY 2
     C           W202F1    IFEQ *ON
     C                     MOVEL#1VCY2    #1VCY0
     C** READ FIRST RECORD FOR ACCOUNT FOR THE SDSECSPD ACCOUNT CODE      219688
     C           ACCNTL    SETLLPMACCNL1                                  219688
     C                     READ PMACCNL1                 89               219688
      *                                                                   219688
     C                     MOVEL*IN89     W202F1                          219688
      *                                                                   219688
     C           *IN89     IFEQ '0'                                       219688
     C           CNUM      ANDEQ#CCNUM                                    219688
     C           CCY       ANDEQ#1VCY0                                    219688
     C           PTFR      ANDEQ#CPTFR                                    219688
     C           ACOD      ANDEQWZACOD                                    219688
     C                     ELSE                                           219688
     C*                                                                   219688
     C***********W202K2    SETLLACCNTPS                                   S01496
     C***********          READ ACCNTPS                  89               S01496
     C           W202K2    SETLLPMACCNL0                                  S01496
     C                     READ PMACCNL0                 89               S01496
     C                     MOVEL*IN89     W202F1
     C           *IN89     IFEQ *OFF
     C           CNUM      IFNE #CCNUM
     C           CCY       ORNE #1VCY0
     C           PTFR      ORNE #CPTFR
     C**                                                                  219566
     C** IF system value 'UseDefaultSettAccnt' is 'Y' then                219566
     C**    get first record of same account and currency                 219566
     C           DEF001    IFEQ 'Y'                                       219566
     C                     MOVE *BLANKS   #CPTFR                          219566
     C           W202K2    SETLLPMACCNL0                                  219566
     C                     READ PMACCNL0                 89               219566
     C*                                                                   219566
     C           *IN89     IFEQ *OFF                                      219566
     C           CNUM      IFNE #CCNUM                                    219566
     C           CCY       ORNE #1VCY0                                    219566
     C                     MOVEL*ON       W202F1                          219566
     C                     ENDIF                                          219566
     C                     ENDIF                                          219566
     C*                                                                   219566
     C                     ELSE                                           219566
     C                     MOVEL*ON       W202F1
     C                     ENDIF                           Endif DEF001=Y 219566
     C*                                                                   219566
     C                     ENDIF
     C                     ENDIF
     C                     END                                            219688
     C                     ENDIF
     C*
     C** CURRENCY 3
     C           W202F1    IFEQ *ON
     C                     MOVEL#1VCY3    #1VCY0
     C***********W202K2    SETLLACCNTPS                                   S01496
     C***********          READ ACCNTPS                  89               S01496
     C** READ FIRST RECORD FOR ACCOUNT FOR THE SDSECSPD ACCOUNT CODE      219688
     C           ACCNTL    SETLLPMACCNL1                                  219688
     C                     READ PMACCNL1                 89               219688
      *                                                                   219688
     C                     MOVEL*IN89     W202F1                          219688
      *                                                                   219688
     C           *IN89     IFEQ '0'                                       219688
     C           CNUM      ANDEQ#CCNUM                                    219688
     C           CCY       ANDEQ#1VCY0                                    219688
     C           PTFR      ANDEQ#CPTFR                                    219688
     C           ACOD      ANDEQWZACOD                                    219688
     C                     ELSE                                           219688
     C*                                                                   219688
     C           W202K2    SETLLPMACCNL0                                  S01496
     C                     READ PMACCNL0                 89               S01496
     C                     MOVEL*IN89     W202F1
     C           *IN89     IFEQ *OFF
     C           CNUM      IFNE #CCNUM
     C           CCY       ORNE #1VCY0
     C           PTFR      ORNE #CPTFR
     C**                                                                  219566
     C** IF system value 'UseDefaultSettAccnt' is 'Y' then                219566
     C**    get first record of same account and currency                 219566
     C           DEF001    IFEQ 'Y'                                       219566
     C                     MOVE *BLANKS   #CPTFR                          219566
     C           W202K2    SETLLPMACCNL0                                  219566
     C                     READ PMACCNL0                 89               219566
     C*                                                                   219566
     C           *IN89     IFEQ *OFF                                      219566
     C           CNUM      IFNE #CCNUM                                    219566
     C           CCY       ORNE #1VCY0                                    219566
     C                     MOVEL*ON       W202F1                          219566
     C                     ENDIF                                          219566
     C                     ENDIF                                          219566
     C*                                                                   219566
     C                     ELSE                                           219566
     C                     MOVEL*ON       W202F1
     C                     ENDIF                           Endif DEF001=Y 219566
     C*                                                                   219566
     C                     ENDIF
     C                     ENDIF
     C                     END                                            219688
     C                     ENDIF
     C*
     C** IF ACCOUNT FOUND IN ANY OF CURRENCIES CHECKED
     C           W202F1    IFEQ *OFF
     C*
     C** SETTLEMENT CURRENCY = CCY OF SETTLEMENT A/C
     C                     MOVELCCY       WPSCU   3
     C** SETTLEMENT METHOD   = 05
     C                     MOVE 05        WPSMT
     C** SETTLEMENT ACCOUNT  = CUSTOMER NO., A/C, A/C SEQUENCE
     C                     MOVELPSEA1     WPSEA
     C** SETTLEMENT BRANCH   = BRANCH OF ACCOUNT, ACCNT
     C***********          MOVE BRCD      WPSEB                           S01496
     C                     MOVE BRCA      WPSEB                           S01496
     C*
     C** ELSE  IF ACCOUNT FOUND IN ANY OF CURRENCIES CHECKED
     C                     ELSE
     C*
     C** SETTLEMENT CURRENCY = CCY OF SETTLEMENT A/C
     C                     MOVELVLCY      WPSCU
     C** SETTLEMENT METHOD   = 00
     C                     MOVE 00        WPSMT
     C** SETTLEMENT ACCOUNT  = CUSTOMER NO., A/C, A/C SEQUENCE
     C                     MOVEL*BLANKS   WPSEA
     C** SETTLEMENT BRANCH   = BRANCH OF ACCOUNT, ACCNT
     C                     MOVE '000'     WPSEB
     C*
     C                     ENDIF
     C                     ENDIF                                          160338
     C*
     C                     ENDSR
     C*
     ******************************************************************
      /EJECT
      *****************************************************************
      *  P04     SUBROUTINE TO CALCULATE CHARGE/COMMISSION AMOUNTS    *
      *****************************************************************
      *
     C           P04       BEGSR
     C*
     C* DEFAULT CHARGES TABLE.  LF/SEDFTCL2
     C*
     C           DFTKY1    KLIST
     C***********          KFLD           DCCLGR                          S01496
     C                     KFLD           DCCLAS                          S01496
     C                     KFLD           DCINVT
     C                     KFLD           DCCUST
     C*                                                                   S01496
     C           DFTKY2    KLIST                                          S01496
     C                     KFLD           DCCLGR                          S01496
     C                     KFLD           DCINVT                          S01496
     C/COPY WNCPYSRC,SE6720C016
     C                     KFLD           DCCUST                          S01496
     C*                                                                   S01496
     C**  Open appropriate file                                           S01496
     C*                                                                   S01496
     C************IN55     IFEQ 'Y'                                S01496 160338
     C           *IN55     IFEQ '1'                                       160338
     C                     OPEN SEDFGRL0                                  S01496
     C                     ELSE                                           S01496
     C                     OPEN SEDFTCL2                                  S01496
     C                     END                                            S01496
     C*
     C***********          MOVE PNCY      ZCCYO                           CH0273
     C                     MOVE PSCU      ZCCYO                           CH0273
     C                     MOVE PNCY      ZCCYI
     C***********          MOVE 'M'       ZMD                             CH0273
     C***********          Z-ADD1         ZEXCH                           CH0273
     C                     MOVE PMDI      ZMD                             CH0273
     C                     Z-ADDPSXR      ZEXCH                           CH0273
     C                     MOVE 'N'       WWDFTF  1
     C*
     C**  SET UP KEY FOR CHAINING TO DEFAULT CHARGES TABLE (SEDFTCL2).
     C*
     C**  IF CHARGES BY CUSTOMER GROUP IS ON
     C***********BVCUGR    IFEQ 'Y'                        B*             S01496
     C************IN55     IFEQ 'Y'                        B*      S01496 160338
     C           *IN55     IFEQ '1'                                       160338
     C                     MOVELBFPSCG    DCCLGR
     C                     ELSE                            X*
     C                     MOVEL*BLANKS   DCCLGR
     C***********          MOVELBFCLAS    DCCLGR                          S01496
     C                     MOVELBFCLAS    DCCLAS                          S01496
     C                     END                             E*
     C*
     C                     MOVE SITP      DCINVT
     C                     MOVE VCCNUM    DCCUST
     C*
     C/COPY WNCPYSRC,SE6720C017
     C************IN55     IFEQ 'Y'                                S01496 160338
     C           *IN55     IFEQ '1'                                       160338
     C           DFTKY2    CHAINSEDFGRL0             89                   S01496
     C                     ELSE                                           S01496
     C           DFTKY1    CHAINSEDFTCL2             89
     C                     END                                            S01496
     C           *IN89     IFEQ '0'                        B3
     C                     EXSR P05
     C                     ELSE                            X3
     C*
     C                     MOVE *BLANKS   DCCUST
     C************IN55     IFEQ 'Y'                                S01496 160338
     C           *IN55     IFEQ '1'                                       160338
     C           DFTKY2    CHAINSEDFGRL0             89                   S01496
     C                     ELSE                                           S01496
     C           DFTKY1    CHAINSEDFTCL2             89
     C                     END                                            S01496
     C           *IN89     IFEQ '0'
     C                     EXSR P05
     C                     ELSE
     C*
     C                     MOVE *BLANKS   DCINVT
     C************IN55     IFEQ 'Y'                                S01496 160338
     C           *IN55     IFEQ '1'                                       160338
     C           DFTKY2    CHAINSEDFGRL0             89                   S01496
     C                     ELSE                                           S01496
     C           DFTKY1    CHAINSEDFTCL2             89
     C                     END                                            S01496
     C           *IN89     IFEQ '0'
     C                     EXSR P05
     C                     ELSE
     C*
     C* IF NO RECORDS FOUND ZEROIZE DEFAULT CHARGE/COMMISSION
     C* AMOUNT FIELDS.
     C                     MOVE *ZEROS    PCHA
     C                     MOVE *ZEROS    PCAM
     C/COPY WNCPYSRC,SE6720C010
     C*
     C                     END
     C                     END
     C                     END
     C/COPY WNCPYSRC,SE6720C018
     C*                                                                   S01496
     C**  Close file                                                      S01496
     C*                                                                   S01496
     C************IN55     IFEQ 'Y'                                S01496 160338
     C           *IN55     IFEQ '1'                                       160338
     C                     CLOSESEDFGRL0                                  S01496
     C                     ELSE                                           S01496
     C                     CLOSESEDFTCL2                                  S01496
     C                     END                                            S01496
     C*
     C                     ENDSR                           ** P04    **
     C*
     C*****************************************************************
      /EJECT
     C/COPY WNCPYSRC,SE6720C011
      *****************************************************************
      *  P05     SUBROUTINE TO CALCULATE DEFAULT AMOUNTS              *
      *****************************************************************
      *
     C           P05       BEGSR
     C*
     C           @CCOD     KLIST
     C                     KFLD           @CCY
     C                     KFLD           @CAM    2
     C*
     C* UPDATE COMMISSIONS AMOUNT.
     C*
     C           DCRDCM    IFEQ *BLANKS
     C                     Z-ADD*ZEROS    PCAM
     C                     ELSE
     C                     MOVE DCRDCM    @CAM
     C                     EXSR CALAMT
     C                     Z-ADDZCHGA     PCAM
     C                     END
     C                     MOVE DCRDCM    PCCD
     C*
     C* UPDATE CHARGE AMOUNT.
     C*
     C           DCRDCC    IFEQ *BLANKS
     C                     Z-ADD*ZEROS    PCHA
     C                     ELSE
     C                     MOVE DCRDCC    @CAM
     C                     EXSR CALAMT
     C                     Z-ADDZCHGA     PCHA
     C                     END
     C                     MOVE DCRDCC    PCHC
     C*
     C                     ENDSR                           ** P05    **
     C*
     C*****************************************************************
      /EJECT
      *****************************************************************
      *                                                               *
      *  P06     SUBROUTINE TO CALCULATE SETTLEMENT AMOUNTS           *
      *                                                               *
      *****************************************************************
      *
     C           P06       BEGSR
     C*
     C                     Z-ADD0         WKCALC
     C*
     C* CALCULATE AND UPDATE SETTLEMENT AMOUNT.
     C* WKCALC = AMOUNT DUE IN VALUECURRENCY
     C*
     C           PPRE      IFEQ 'P'
     C*
     C********** PAMD      SUB  PCHA      WKCALC                                           234874
     C           PAMD1     SUB  PCHA      WKCALC                                           234874
     C           WKCALC    SUB  PCAM      WKCALC
     C/COPY WNCPYSRC,SE6720C012
     C*
     C                     ELSE
     C*
     C********** PAMD      ADD  PCHA      WKCALC 140                                       234874
     C           PAMD1     ADD  PCHA      WKCALC 140                                       234874
     C           WKCALC    ADD  PCAM      WKCALC
     C/COPY WNCPYSRC,SE6720C013
     C*
     C                     ENDIF
     C*
     C           WKCALC    IFLT *ZEROS
     C*
     C           PAMD      DIV  2         PCHA
     C           PAMD      DIV  2         PCAM
     C/COPY WNCPYSRC,SE6720C014
     C                     Z-ADD0         PSAT
     C                     Z-ADD0         WKCALC
     C*
     C***********          ELSE                                           160338
     C***********PMDI      IFEQ 'M'                                       160338
     C***********WKCALC    MULT PSXR      PSAT                            160338
     C***********          ELSE                                           160338
     C***********WKCALC    DIV  PSXR      PSAT                            160338
     C***********          ENDIF                                          160338
     C                     ENDIF
     C*
     C                     Z-ADDWKCALC    PSAT                            160338
     C*
     C                     ENDSR                           ** P06    **
     C*****************************************************************
      /EJECT
      *****************************************************************
      *  CALAMT  SUB ROUTINE TO DETERMINE IF AMOUNTS NEED TO BE       *
      *          DEFAULTED FOR CHARGES                                *
      *****************************************************************
      *
     C           CALAMT    BEGSR
     C*
     C** CHARGES TO BE DISPLAYED IN NOMINAL CURRENCY WHETHER THE
     C** SECURITY IS SINGLE, DUAL OR MULTI CURRENCY (REF AMEND TO FS)
     C*
     C                     MOVE PNCY      @CCY    3
     C           @CCOD     CHAINSECGT                21
     C*
     C*  IF NO LIVE RECORD FOUND FIELD DEFAULTS TO BLANK
     C*
     C           *IN21     IFEQ '1'
     C           RECI      ORNE 'D'
     C                     Z-ADD*ZEROS    ZCHGA
     C                     END
     C*
     C           *IN21     IFEQ '0'
     C           RECI      ANDEQ'D'
     C*
     C*  IF TRADE TYPE IS PURCHASE AND LEVY ON SALE OR TRADE TYPE IS
     C*  SALE AND LEVY ON PURCHASE FIELD IS BLANK, OTHERWISE CALCULATE
     C*  AMOUNT
     C*
     C           LPSI      IFEQ 'S'
     C           LPSI      OREQ 'P'
     C                     Z-ADD*ZEROS    ZCHGA
     C                     ELSE
     C                     EXSR CALAM2
     C                     END
     C*
     C                     END
      *
     C                     ENDSR
      *
      *****************************************************************
      /EJECT
      *****************************************************************
      *                                                               *
      *  CALAM2  SUB ROUTINE TO CALCULATE CHARGE AMOUNTS              *
      *                                                               *
      *****************************************************************
      *
     C           CALAM2    BEGSR
     C*
     C*  CHARGE DETAILS
     C*
     C                     MOVE CHGB      ZCHGB
     C                     MOVE THRI      ZTHRI
     C                     Z-ADDMNCH      ZMNCH
     C                     Z-ADDMXCH      ZMXCH
     C*
     C*  SET UP ARRAY FOR UPPER RANGE LIMITS
     C*
     C                     Z-ADDSTU1      ZRA,1
     C                     Z-ADDSTU2      ZRA,2
     C                     Z-ADDSTU3      ZRA,3
     C                     Z-ADDSTU4      ZRA,4
     C                     Z-ADDSTU5      ZRA,5
     C                     Z-ADDSTU6      ZRA,6
     C                     Z-ADDSTU7      ZRA,7
     C                     Z-ADDSTU8      ZRA,8
     C                     Z-ADDSTU9      ZRA,9
     C                     Z-ADDST10      ZRA,10
     C                     Z-ADDST11      ZRA,11
     C                     Z-ADDST12      ZRA,12
     C                     Z-ADDST13      ZRA,13
     C                     Z-ADDST14      ZRA,14
     C*
     C*  SET UP ARRAY FOR PERCENTAGE LEVELS
     C*
     C                     Z-ADDPL01      ZPC,1
     C                     Z-ADDPL02      ZPC,2
     C                     Z-ADDPL03      ZPC,3
     C                     Z-ADDPL04      ZPC,4
     C                     Z-ADDPL05      ZPC,5
     C                     Z-ADDPL06      ZPC,6
     C                     Z-ADDPL07      ZPC,7
     C                     Z-ADDPL08      ZPC,8
     C                     Z-ADDPL09      ZPC,9
     C                     Z-ADDPL10      ZPC,10
     C                     Z-ADDPL11      ZPC,11
     C                     Z-ADDPL12      ZPC,12
     C                     Z-ADDPL13      ZPC,13
     C                     Z-ADDPL14      ZPC,14
     C                     Z-ADDPL15      ZPC,15
     C*
     C*  SET UP ARRAY FOR FLAT CHARGES
     C*
     C                     Z-ADDFC01      ZCG,1
     C                     Z-ADDFC02      ZCG,2
     C                     Z-ADDFC03      ZCG,3
     C                     Z-ADDFC04      ZCG,4
     C                     Z-ADDFC05      ZCG,5
     C                     Z-ADDFC06      ZCG,6
     C                     Z-ADDFC07      ZCG,7
     C                     Z-ADDFC08      ZCG,8
     C                     Z-ADDFC09      ZCG,9
     C                     Z-ADDFC10      ZCG,10
     C                     Z-ADDFC11      ZCG,11
     C                     Z-ADDFC12      ZCG,12
     C                     Z-ADDFC13      ZCG,13
     C                     Z-ADDFC14      ZCG,14
     C                     Z-ADDFC15      ZCG,15
     C*
     C***********PNCY      CHAINSDCURRL1             89                   S01496
     C*                                                                   S01496
     C                     CALL 'AOCURRR0'                                S01496
     C                     PARM *BLANKS   WLRTCD                          S01496
     C                     PARM '*KEY  '  WLOPTN                          S01496
     C                     PARM PNCY      WLCYCD  3                       S01496
     C           SDCURR    PARM SDCURR    DSSDY                           S01496
     C*                                                                   S01496
     C************IN89     IFEQ '1'                                       S01496
     C           WLRTCD    IFNE *BLANKS                                   S01496
     C***********          MOVEL'SDCURRL1'DBFILE 10        ***************S01496
     C                     MOVE 'SDCURRPD'DBFILE 10        ***************S01496
     C                     MOVELPNCY      DBKEY  29        ** DB ERROR 08 **
     C                     Z-ADD8         DBASE   30       *****************
     C                     EXSR *PSSR
     C                     ENDIF
     C*
     C                     MOVE A6NBDP    ZDECS
     C*
     C*  NOMINAL DECIMAL PLACES
     C*
     C                     Z-ADD0         ZNMDP
     C*
     C*  SECURITY DETAILS
     C                     Z-ADD1         ZPRICE
     C                     Z-ADDPAMD      ZNOML
     C                     Z-ADD0         ZTCFC
     C                     MOVE 'P'       ZPROT
     C                     MOVE *BLANKS   ZSPBS
     C*
     C***********COUR      IFEQ 'Y'                                       S01496
     C           S01446    IFEQ 'Y'                                       S01496
     C* PURCHASE INTEREST.
     C***********          Z-ADD*ZEROS    ZPIN0                           S01496
     C                     Z-ADD*ZEROS    ZTPI                            S01496
     C*                                                                   S01496
     C**  Access currencies file to get value currency decimal places     S01496
     C*                                                                   S01496
     C                     CALL 'AOCURRR0'                                S01496
     C                     PARM *BLANKS   WLRTCD                          S01496
     C                     PARM '*KEY  '  WLOPTN                          S01496
     C                     PARM VLCY      WLCYCD                          S01496
     C           SDCURR    PARM SDCURR    DSSDY                           S01496
     C*                                                                   S01496
     C           WLRTCD    IFNE *BLANKS                                   S01496
     C                     Z-ADD19        DBASE            ***************S01496
     C                     MOVE 'SDCURRPD'DBFILE           * DB ERROR 19 *S01496
     C                     MOVELVLCY      DBKEY            ***************S01496
     C                     EXSR *PSSR                                     S01496
     C                     END                                            S01496
     C*                                                                   S01496
     C                     Z-ADDA6NBDP    WLVDCP  10                      S01496
     C*                                                                   CH0273
     C***********TXCHCY    IFNE *BLANKS                            CH0273 S01496
     C***********          MOVE TXCHCY    ZCCYI                    CH0273 S01496
     C           BVCHRC    IFNE *BLANKS                                   S01496
     C                     MOVE BVCHRC    ZCCYI                           S01496
     C                     Z-ADDWLNBDP    ZCDPI   10                      S01496
     C                     MOVE VLCY      ZCCYO                           CH0273
     C                     Z-ADDWLVDCP    ZCDPO   10                      S01496
     C                     Z-ADDWWSPOT    ZRATE2 138                      CH0273
     C                     MOVE WWMDIN    ZMDI2   1                       CH0273
     C***********          Z-ADDTXSPOT    ZRATE1 138               CH0273 S01496
     C***********          MOVE TXMDI     ZMDI1   1                CH0273 S01496
     C                     Z-ADDWLSPRT    ZRATE1 138                      S01496
     C                     MOVE WLMDIN    ZMDI1   1                       S01496
     C                     EXSR ZXRATE                                    CH0273
     C                     MOVE ZRATEX    TRATEX 138                      CH0273
     C                     MOVE ZMDIX     TMDIX   1                       CH0273
     C                     MOVE TRATEX    ZEXCH                           CH0273
     C                     MOVE TMDIX     ZMD                             CH0273
     C*                                                                   CH0273
     C                     ELSE                                           CH0273
     C*
     C* TOTAL CONSIDERATION.
     C***********          Z-ADD*ZEROS    ZTCON0                          S01496
     C                     Z-ADD*ZEROS    ZTCON                           S01496
     C                     MOVE *BLANKS   ZCCYI
     C                     MOVE *BLANKS   ZCCYO
     C                     MOVE *BLANKS   ZEXCH
     C                     MOVE *BLANKS   ZMD
     C*                                                                   CH0273
     C                     END                                            CH0273
     C*                    END
     C                     END
     C*
     C* TOTAL NOMINAL.
     C                     Z-ADD*ZEROS    ZTNOM  150
     C*
     C                     EXSR ZCCAL1
     C*
     C                     ENDSR
      *
     C********************************************************************                  AR324886
     C/EJECT                                                                                AR324886
     C********************************************************************                  AR324886
     C           PSAUDT    BEGSR                                                            AR324886
      *                                                                                     AR324886
     C                     MOVE RECI      PARECI                                            AR324886
     C                     MOVE PBCA      PAPBCA                                            AR324886
     C                     MOVE PSSH      PAPSSH                                            AR324886
     C                     MOVE PCPY      PAPCPY                                            AR324886
     C                     MOVE PDUD      PAPDUD                                            AR324886
     C                     MOVE PEVT      PAPEVT                                            AR324886
     C                     MOVE PTFR      PAPTFR                                            AR324886
     C                     MOVE TNLU      PATNLU                                            AR324886
     C                     MOVE TXBS      PATXBS                                            AR324886
     C                     MOVE BNFO      PABNFO                                            AR324886
     C                     MOVE EXCD      PAEXCD                                            AR324886
     C           LIBR      CAT  'OWNER'   PALUSR                                            AR324886
     C                     MOVE LCD       PALCD                                             AR324886
     C                     MOVE CHTP      PALCTP                                            AR324886
     C                     WRITEPSAUTDF                                                     AR324886
      *                                                                                     AR324886
     C                     ENDSR                                                            AR324886
      *****************************************************************
     C/EJECT
     ******************************************************************
     C* *PSSR : DATABASE ERROR PROCESSING
     ******************************************************************
     C           *PSSR     BEGSR
     C*
     C** UPDATE LDA WITH ERROR INFORMATION
     C*
     C           *LOCK     IN   LDA
     C                     MOVELDBFILE    WWFILE
     C                     MOVELDBKEY     WWKEY
     C                     MOVELDBPGM     WWPGM
     C                     MOVELDBASE     WWASE
     C                     OUT  LDA
     C*
     C                     DUMP
     C*
     C           DBASE     IFNE *ZEROS
     C                     WRITEHEADAU
     C                     WRITEERROR
     C                     END
     C*
     C                     SETON                     U7U8LR
     C                     RETRN
     C*
     C                     ENDSR
     C**********************************************************************
      /EJECT
     C**********************************************************************
     C* SECTIN : GET SECURITY RECORD
     C**********************************************************************
     C*
     C           SECTIN    BEGSR                           ** SECTIN **
     C*
     C** Chain for Security Record
     C           VASESN    CHAINSECTY                89
     C           *IN89     IFEQ '1'
     C           RECI      OREQ '*'
     C***********          MOVEL'SECTY'   DBFILE           ***************S01496
     C                     MOVE 'SECTY'   DBFILE           ***************S01496
     C                     MOVELVASESN    DBKEY            ** DB ERROR 09 **
     C                     Z-ADD9         DBASE            *****************
     C                     EXSR *PSSR
     C                     ENDIF
     C*
     C** Security Nominal decimal places and Price Basis for SR/ZAPNUM
     C                     Z-ADDNMDP      ZNMDP
     C                     MOVE SPBS      ZPRCB
     C*
     C** Retrieve Nominal currency Spot, M/D ind. and Dec.places
     C***********NMCY      CHAINSDCURRL1             89                   S01496
     C*                                                                   S01496
     C                     CALL 'AOCURRR0'                                S01496
     C                     PARM *BLANKS   WLRTCD                          S01496
     C                     PARM '*KEY  '  WLOPTN                          S01496
     C                     PARM NMCY      WLCYCD  3                       S01496
     C           SDCURR    PARM SDCURR    DSSDY                           S01496
     C*                                                                   S01496
     C************IN89     IFEQ '1'                                       S01496
     C           WLRTCD    IFNE *BLANKS                                   S01496
     C***********          MOVEL'SDCURRL1'DBFILE           ***************S01496
     C                     MOVE 'SDCURRPD'DBFILE           ***************S01496
     C                     MOVELBJCYCD    DBKEY            ** DB ERROR 10 **
     C                     Z-ADD10        DBASE            *****************
     C                     EXSR *PSSR
     C                     ENDIF
      *                                                                                       234813
      ** Access security WHT details file                                                     234813
      *                                                                                       234813
     C           VASESN    CHAINSESWHTL0             62                                       234813
      *                                                                                       234813
     C           *IN62     IFEQ '1'                                                           234813
     C                     Z-ADD0         WLTAX   74                                          234813
     C                     ELSE                                                               234813
     C           S1TABD    IFEQ 0                                                             234813
     C                     Z-ADDS1RASO    WLTAX                                               234813
     C                     ELSE                                                               234813
      *                                                                                       234813
      ** If tax deducted at source is different from zero.                                    234813
      *                                                                                       234813
     C                     CALL 'AOSCTXR0'                                                    234813
     C                     PARM *BLANKS   WLRTCD                                              234813
     C                     PARM '*KEY   ' WLOPTN                                              234813
     C                     PARM S1CTTA    @PCTTA  2                                           234813
     C                     PARM S1TABD    @PTABD  10                                          234813
     C           SECNTR    PARM SECNTR    DSFDY                                               234813
      *                                                                                       234813
     C           WLRTCD    IFNE *BLANK                                                        234813
     C                     MOVEL@PCTTA    DBKEY                                               234813
     C                     MOVE @PTABD    DBKEY                                               234813
     C                     MOVEL'SECNTRL0'DBFILE                                              234813
     C                     Z-ADD22        DBASE                                               234813
     C                     EXSR *PSSR                                                         234813
     C                     ELSE                                                               234813
     C                     Z-ADDTXRASO    WLTAX                                               234813
     C                     ENDIF                                                              234813
     C                     ENDIF                                                              234813
     C                     ENDIF                                                              234813
     C*
     C** Save Base Currency Spot, M/D Indicator, Dec.places for later
     C                     MOVE A6SPRT    WNSPRT
     C                     MOVE A6MDIN    WNMDIN
     C                     MOVE A6NBDP    WNNBDP
     C*
     C** Nominal currency decimal places used in SR/ZAPNUM
     C                     Z-ADDA6NBDP    ZNMCD
     C*
     C                     ENDSR
     C*
     C**********************************************************************
      /EJECT
     C**********************************************************************
     C* W101     - WRITE ACCOUNT KEY
     C**********************************************************************
     C*
     C           W101      BEGSR                           **   W101 **
     C*
     C**  EXECUTE HASH TOTALLING SUBROUTINE ONCE (Z=1) FOR FIRST
     C*   ARRAY ELEMENTS (IND,S DEC,S) SO S=1 ,ACCUMULATING ZZAMT(15/3)
     C*
     C                     Z-ADD1         Z
     C                     Z-ADD1         S
     C                     Z-ADDEVAM      ZZAMT
     C                     EXSR ZHASH
     C*
     C**   Account Key           KEY IN FORMAT 'iiiM-X------Svn---CV'
     C**                         iii = Investment type, SECTYD
     C**                         v   = if convertible indic. in A/c key
     C**                               SDSTRPD *EQ 'Y' and
     C**                               convertible indic.SECTYD = 'Y'
     C**                                Output 'Y'
     C**                               Otherwise *BLANKS
     C**                         n   = If Split negative accrual ind,SDSTRDPD
     C**                               *EQ 'Y' and 'Nominal allocated' negative
     C**                               Set to 'N'
     C**                               Otherwise *BLANKS
     C                     MOVE SITP      WACITY
     C                     MOVE 'M'       WACEVC
     C                     MOVE ' '       WACTRT
     C                     MOVE 'X'       WACPFI
     C                     MOVE '  '      WACBKC
     C                     MOVE '  '      WACTST
     C                     MOVE '  '      WACCCC
     C                     MOVE 'S'       WACMKT
     C           BVCIAK    IFEQ 'Y'
     C           SCVI      ANDEQ'Y'
     C                     MOVE 'Y'       WACCON
     C                     ELSE
     C                     MOVE ' '       WACCON
     C                     ENDIF
     C                     MOVE *BLANKS   WACNEG
     C                     MOVE 'CV'      WACAMC
     C*
     C                     MOVELWACKEY    ACKY
     C*
     C**   Trade Reference       Zero
     C                     MOVE 0         TRFR
     C**   Customer Number       Customer, SEERDPPD
     C                     MOVE VBDDPT    CSTN
     C**   Branch                Branch,SEERDPPD
     C***********          MOVE VBBRCD    BRCH                            S01496
     C                     MOVE VBBRCD    BRHA                            S01496
     C**   Account Sequence Num. 0
     C***********          MOVE 0         ACSQ                            S01496
     C                     MOVE 0         ASQN                            S01496
     C**   Event Date            Redemption Date
     C                     MOVELVAERRD    EVDT
     C**   Event Amount          (EVAM filled before)
     C**   Event Currency        Nominal Currency, SECTYD
     C                     MOVELNMCY      EVCY
     C** Settlement Instructions from P007: (As for depot positions)
     C**   Settlement Type
     C                     Z-ADDWPSMT     STLT
     C**   Settlement Account
     C                     MOVELWPSEA     STLA
     C**   Settlement Branch                                              S01496
     C                     MOVELWPSEB     SEBR                            S01496
     C**   Reversal Indicator    If ER is being reversed Set to '1'
     C**                         Else Set to '0'
     C           VAERST    IFEQ 'R'
     C                     MOVE '1'       RVRS
     C                     ELSE
     C                     MOVE '0'       RVRS
     C                     ENDIF
     C**   Issuer                Issuer from Security
     C**   Our Depot Customer    Depot, SEERDPPD
     C                     MOVELVBDDPT    KCUST
     C**   Nominal Currency Amount
     C                     MOVE 0         KNCA
     C**   Nominal Currency      Nominal currency, SECTYD
     C                     MOVE NMCY      KCCY
     C**   Base Currency Amount  0
     C                     Z-ADD0         KBCA
     C**   Security Shortname    Security, SEERRFPD
     C                     MOVE VASESN    SESH
     C**   Profit Centre                                                  S01496
     C           *IN40     IFEQ '1'                                       CAC003
     C                     MOVE BVSEPC    PRFC                            CAC003
     C                     ELSE                                           CAC003
     C                     MOVE *BLANKS   PRFC                            S01496
     C                     ENDIF                                          CAC003
     C**   Portfolio Reference   BLANKS
     C                     MOVE *BLANKS   PTFR
     C**   Trans.no of last upd  0
     C                     Z-ADD0         TNLU
     C**   Record_ID
     C                     MOVE 'D'       RECI
      *                                                                                       CGL020
      ** If Midas Compliance Watch is installed                                               CGL020
      *                                                                                       CGL020
     C           CGL020    IFEQ 'Y'                                                           CGL020
     C                     EXSR SRAMPR                                                        CGL020
     C                     ENDIF                                                              CGL020
     C*
     C***COUNT*RECORDS*WRITTEN*****************************************                       234874
     C**********           ADD  1         W01CNT                                              234874
     C*
     C** WRITE GENERATED ACCOUNT KEY RECORD
     C           EVAM      IFNE 0                                                             234874
     C*  COUNT RECORDS WRITTEN only if write an account key                                   234874
     C                     ADD  1         W01CNT                                              234874
     C                     WRITESEKEYDF
     C                     ENDIF                                           234874
     C*
     C           W101E     ENDSR
     C*
     C**********************************************************************
      /EJECT
     C**********************************************************************
     C* W102     - WRITE POSITION SETTLEMENT
     C**********************************************************************
     C*
     C           W102      BEGSR                           **   W102  * *
     C*
     C** Branch Code                          Branch Code,SEERDPPD
     C***********          MOVE VBBRCD    PBCH                            S01496
     C                     MOVE VBBRCD    PBCA                            S01496
     C** Security short name                  Short name,SEERRFPD
     C                     MOVE VASESN    PSSH
     C** Counterparty                         Depot number,SEERDPPD
     C                     MOVELVBDDPT    PCPY
     C** Market                               Market,SECTYD
     C                     MOVELMKTI      PMAR
     C** Due Date                             Redemption Date,SEERRFPD
     C                     Z-ADDVAERRD    PDUD
     C** Event Type
     C                     MOVEL'RC'      PEVT
     C** Authorized Indicator                 Autopost Pos.Settlement
     C***********BVAPS     IFEQ 'Y'                                       S01496
     C           BVAPST    IFEQ 'Y'                                       S01496
     C                     MOVE 'Y'       PAUI
     C                     ELSE
     C                     MOVE *BLANKS   PAUI
     C                     END
     C** Nominal Position            Nominal to be redeemed, SEERDPPD
     C                     Z-ADDVBNRDM    PNMP
     C** Value Currency              Security Nominal Currency,SECTY
     C                     MOVELNMCY      PNCY
     C** Book Code                   Default Market Book,SDSTRDPD
     C                     MOVELBVDMBC    PBCD
     C** Amount Due           Nominal to be redeemed X Redemption Price
     C**                      Calculated via SR/ZAPNUM
     C                     Z-ADDZVALU     PAMD
     C** Pay/Receive Indicator
     C                     MOVEL'R'       PPRE
     C***Settlement*Currency*********Nominal*Currency,SECTYD***********   160338
     C***********          MOVELNMCY      PSCU                            160338
     C***Settlement*Exchange*Rate**************************************   160338
     C***********          Z-ADD1         PSXR                            160338
     C***Multiply/Divide*Indicator*************************************   160338
     C***********          MOVEL'M'       PMDI                            160338
     C** Base Currency Exchange Rate     Spot rate Nominal to Base CCY
     C                     Z-ADDWNSPRT    PBRX
     C** Settlement Instructions from P007:
     C** Settlement Method
     C                     Z-ADDWPSMT     PSMT
     C** Settlement Account
     C                     MOVELWPSEA     PSEA
     C** Settlement Branch
     C                     MOVELWPSEB     PSEB
     C*                                                                   234054
      ** If Settlement Branch is *blank - DB error in SE1540              234054
     C*                                                                   234054
     C           PEVT      IFEQ 'RC'                                      234054
     C           PSEB      ANDEQ'   '                                     234054
     C                     MOVE VBBRCD    PSEB                            234054
     C                     END                                            234054
     C*                                                                   234054
     C** Counterparty Bank
     C                     MOVELWPCPN     PCPN
     C** For Account Of
     C                     MOVELWPFAC     PFAC
     C** Special Instructions
     C                     MOVELWPSPI     PSPI
     C** Charge Code
     C                     MOVEL*BLANKS   PCHC
     C** Charge Amount
     C                     Z-ADD0         PCHA
     C** Commission Code
     C                     MOVEL*BLANKS   PCCD
     C** Commission Amount
     C                     Z-ADD0         PCAM
     C** Settlement Amount
     C                     Z-ADDPAMD      PSAT
     C*                                                                   160338
     C** Convert Settlement Amount from Nominal Currency                  160338
     C** to Settlement Currency                                           160338
     C*                                                                   160338
     C           PSCU      IFNE NMCY                                      160338
     C                     Z-ADDPSAT      ZAMTF                           160338
     C                     MOVE NMCY      ZCCYF                           160338
     C                     Z-ADDWNSPRT    ZRATEF                          160338
     C                     MOVE WNMDIN    ZMDINF                          160338
     C                     Z-ADDWNNBDP    ZCDPF                           160338
     C*                                                                   160338
     C** Settlement Currency (TO)                                         160338
     C*                                                                   160338
     C                     CALL 'AOCURRR0'                                160338
     C                     PARM *BLANKS   WLRTCD                          160338
     C                     PARM '*KEY  '  WLOPTN                          160338
     C                     PARM PSCU      WLCYCD                          160338
     C           SDCURR    PARM SDCURR    DSSDY                           160338
     C           WLRTCD    IFNE *BLANKS                                   160338
     C                     MOVE 'SDCURRPD'DBFILE           ***************160338
     C                     MOVELPSCU      DBKEY            * DB ERROR 14 *160338
     C                     Z-ADD14        DBASE            ***************160338
     C                     EXSR *PSSR                                     160338
     C                     ELSE                                           160338
     C                     MOVE PSCU      ZCCYT                           160338
     C                     MOVE A6SPRT    ZRATET                          160338
     C                     MOVE A6MDIN    ZMDINT                          160338
     C                     MOVE A6NBDP    ZCDPT                           160338
     C                     ENDIF                                          160338
     C*                                                                   160338
     C** Currency Conversion                                              160338
     C*                                                                   160338
     C                     EXSR ZCCYCN                                    160338
     C*                                                                   160338
     C** Settlement Amount                                                160338
     C*                                                                   160338
     C                     Z-ADDZAMTT     PSAT                            160338
     C                     ELSE                                           160338
     C                     Z-ADD1         PSXR                            160338
     C                     MOVEL'M'       PMDI                            160338
     C                     ENDIF                                          160338
     C** Message Indicator
     C                     MOVEL*BLANKS   PSMI
     C** Date Generated           Run Date
     C                     MOVE BJRDNB    PDTG
     C** Last Change Date         Run Date
     C                     MOVE BJRDNB    LCD
     C** Type of last change
     C                     MOVEL'I'       CHTP
     C** Transaction number of last update
     C                     EXSR ZTNLU1
     C***********          MOVELFNATN     TNL1                            S01496
     C                     MOVELFNATN     TNLU                            S01496
     C** Portfolio Reference
     C                     MOVEL*BLANKS   PTFR
     C** Position Settl. Value Date   PAYMENT DATE, SEERRFPD
     C***********          MOVE VAERPD    PSVL                            S01496
     C                     MOVE VAERPD    PSVL                      S01496095236
     C** Settlement Reversal Postings Gen
     C                     MOVEL*BLANKS   SRPG
     C** Record ID       'D'
     C                     MOVE 'D'       RECI
     C*
     C** COUNT RECORDS WRITTEN
     C                     ADD  1         W02CNT
     C*                                                                   CAC003
     C** Move SE Profit Centre to PPFC if *IN40 is on.                    CAC003
     C           *IN40     IFEQ '1'                                       CAC003
     C                     MOVE BVSEPC    PPFC                            CAC003
     C                     ENDIF                                          CAC003
     C*                                                                   CAC003
     C** Initialise FXMP, FXMR, and MAMT to zero                          CAC003
     C                     Z-ADD0         FXMP                            CAC003
     C                     Z-ADD0         FXMR                            CAC003
     C                     Z-ADD0         MAMT                            CAC003
     C*
     C** Initialise DAMT to zero                                          189109
     C                     Z-ADD0         DAMT                            189109
     C*                                                                   189109
     C** WRITE POSITION SETTLEMENT RECORD
     C                     WRITEPOSETDF
     C                     EXSR PSAUDT                                                      AR324886
     C*
     C           W102E     ENDSR
     C*
     C********************************************************************
      /EJECT
     C********************************************************************
     C**P102******-*WRITE*POSITION*SETTLEMENT*EXTENSION****************   S01496
     C********************************************************************
     C***********                                                         S01496
     C***********P102      BEGSR                           **  P102  **   S01496
     C***********                                                         S01496
     C**WRITE*A*RECORD*IN*THE*POSITION*SETTLEMENT*EXTENSION*FILE*******   S01496
     C***********                                                         S01496
     C***********          Z-ADDPBCH      POPBCH                          S01496
     C***********          MOVE PSSH      POPSSH                          S01496
     C***********          Z-ADDPCPY      POPCPY                          S01496
     C***********          Z-ADDPDUD      POPDUD                          S01496
     C***********          MOVE PEVT      POPEVT                          S01496
     C***********                                                         S01496
     C***********          WRITEPOSETDD0                                  S01496
     C***********                                                         S01496
     C***********          ENDSR                                          S01496
     C**********************************************************************
      /EJECT
     C**********************************************************************
     C* W201     - WRITE ACCOUNT KEY
     C**********************************************************************
     C*
     C           W201      BEGSR                           **   W01  **
     C*
     C**  EXECUTE HASH TOTALLING SUBROUTINE ONCE (Z=1) FOR FIRST
     C*   ARRAY ELEMENTS (IND,S DEC,S) SO S=1 ,ACCUMULATING ZZAMT(15/3)
     C*
     C                     Z-ADD1         Z
     C                     Z-ADD1         S
      *                                                                                       234874
     C           CGL031    IFNE 'Y'                                                           234874
     C           SETX      ORNE 'Y'                                                           234874
     C           CGL031    ANDEQ'Y'                                                           234874
     C                     Z-ADDEVAM      ZZAMT                                               234874
     C                     ELSE                                                               234874
     C                     Z-ADDPAMD      ZZAMT                                               234874
     C                     END                                                                234874
     C**********           Z-ADDEVAM      ZZAMT                                               234874
     C                     EXSR ZHASH
     C*
     C** DETAIL OUTPUT FOR DEPOT AS BELOW:
     C**   Account Key           KEY IN FORMAT 'iiiM-X------Svn---CV'
     C**                         iii = Investment type, SECTYD
     C**                         v   = if convertible indic. in A/c key
     C**                               SDSTRPD *EQ 'Y' and
     C**                               convertible indic.SECTYD = 'Y'
     C**                                Output 'Y'
     C**                               Otherwise *BLANKS
     C**                         n   = If Split negative accrual ind,SDSTRDPD
     C**                               *EQ 'Y' and 'Nominal allocated' negative
     C**                               Set to 'N'
     C**                               Otherwise *BLANKS
     C                     MOVE SITP      WACITY
     C                     MOVE 'M'       WACEVC
     C                     MOVE ' '       WACTRT
     C                     MOVE VCCNUM    WWCNUM  6
     C***********WWCNUM    CHAINSDSECSL0             89                   S01496
     C*                                                                   S01496
     C                     CALL 'AOSECSR0'                                S01496
     C                     PARM *BLANKS   WLRTCD                          S01496
     C                     PARM '*KEY  '  WLOPTN                          S01496
     C                     PARM WWCNUM    WLCUSN                          S01496
     C           SDSECS    PARM SDSECS    DSSDY                           S01496
     C*                                                                   S01496
     C************IN89     IFEQ '0'                                       S01496
     C           WLRTCD    IFEQ *BLANKS                                   S01496
     C                     MOVE BFCLAS    WACPFI
     C                     ENDIF
     C                     MOVE '  '      WACBKC
     C                     MOVE '  '      WACTST
     C                     MOVE '  '      WACCCC
     C                     MOVE 'S'       WACMKT
     C           BVCIAK    IFEQ 'Y'
     C           SCVI      ANDEQ'Y'
     C                     MOVE 'Y'       WACCON
     C                     ELSE
     C                     MOVE ' '       WACCON
     C                     ENDIF
     C           BVSNIN    IFEQ 'Y'
     C           VCNOMA    ANDLT*ZEROS
     C                     MOVE 'N'       WACNEG
     C                     ELSE
     C                     MOVE *BLANKS   WACNEG
     C                     ENDIF
     C                     MOVE 'CV'      WACAMC
     C                     MOVELWACKEY    ACKY
     C*
     C**   Trade Reference       Zero
     C                     MOVE 0         TRFR
     C**   Customer Number       Customer,SEERALPD
     C                     MOVE VCCNUM    CSTN
     C**   Branch                Branch,SEERALPD
     C***********          MOVE VCBRCD    BRCH                            S01496
     C                     MOVE VCBRCD    BRHA                            S01496
     C**   Account Sequence Number
     C***********          MOVE 0         ACSQ                            S01496
     C                     MOVE 0         ASQN                            S01496
     C**   Event Date            Redemption Date
     C                     MOVELVAERRD    EVDT
     C**   Event Amount          Nominal allocated X Redemption Price
     C           CGL031    IFNE 'Y'                                                           234874
     C           SETX      ORNE 'Y'                                                           234874
     C           CGL031    ANDEQ'Y'                                                           234874
     C                     Z-ADDZVALU     EVAM
     C                     ELSE                                                               234874
     C                     Z-ADDPAMD      EVAM                                                234874
     C                     END                                                                234874
     C**   Event Currency        Nominal Currency, SECTYD
     C                     MOVELNMCY      EVCY
     C**   Settlement Instructions as per P009
     C**   Settlement Type
     C                     Z-ADDWPSMT     STLT
     C**   Settlement Account
     C                     MOVE WPSEA     STLA
     C**   Settlement Branch                                              S01496
     C                     MOVE WPSEB     SEBR                            S01496
     C**   Reversal Indicator    If ER is being reversed Set to '1'
     C**                         Else Set to '0'
     C           VAERST    IFEQ 'R'
     C                     MOVE '1'       RVRS
     C                     ELSE
     C                     MOVE '0'       RVRS
     C                     ENDIF
     C**   Issuer                Issuer from Security
     C**   Our Depot Customer    Depot, SEERALPD
     C                     MOVELVBDDPT    KCUST            ?10A/6N
     C**   Nominal Currency Am   0
     C                     MOVE 0         KNCA
     C**   Nominal Currency      Nominal currency, SECTYD
     C                     MOVE NMCY      KCCY
     C**   Base Currency Amount  0
     C                     Z-ADD0         KBCA
     C**   Security Shortname    Security, SEERRFPD
     C                     MOVE VASESN    SESH
     C**   Profit Centre                                                  S01496
     C           *IN40     IFEQ '1'                                       CAC003
     C           FIND      ANDEQ'Y'                                       CAC003
     C                     MOVE PCCU      PRFC                            CAC003
     C                     ELSE                                           CAC003
     C                     MOVE *BLANKS   PRFC                            S01496
     C                     ENDIF                                          CAC003
     C**   Portfolio Reference   BLANKS
     C                     MOVE VCPTFR    PTFR
     C**   Trans.no of last upd  0
     C                     Z-ADD0         TNLU
     C**   Record_ID
     C                     MOVE 'D'       RECI
      *                                                                                       CGL020
      ** If Midas Compliance Watch is installed                                               CGL020
      *                                                                                       CGL020
     C           CGL020    IFEQ 'Y'                                                           CGL020
     C                     EXSR SRAMPR                                                        CGL020
     C                     ENDIF                                                              CGL020
     C*
     C***Count*of*record*written***************************************                       234874
     C**********           ADD  1         W01CNT                                              234874
     C*
     C** Write Generated Account Key Record
     C           EVAM      IFNE 0                                                             234874
     C*  COUNT RECORDS WRITTEN only if write an account key                                   234874
     C                     ADD  1         W01CNT                                              234874
     C                     WRITESEKEYDF
     C                     ENDIF                                           234874
     C*
     C           W201E     ENDSR                           ** ENDW01 **
     C*
     C**********************************************************************
      /EJECT
     C**********************************************************************
     C* W202      - WRITE POSITION SETTLEMENT
     C**********************************************************************
     C           W202      BEGSR                           **   W02  * *
     C*
     C** Branch Code                           Branch Code,SEERALPD
     C***********          MOVE VCBRCD    PBCH                            S01496
     C                     MOVE VCBRCD    PBCA                            S01496
     C** Security Short Name                   ,SEERRFPD
     C                     MOVE VASESN    PSSH
     C** Counterparty                          Customer Number,SEERALPD
     C                     MOVELVCCNUM    PCPY
     C** Market                                Market,SECTYD
     C                     MOVELMKTI      PMAR
     C** Due Date                              Redemption Date,SEERRFPD
     C                     MOVELVAERRD    PDUD
     C** Event Type
     C                     MOVEL'RC'      PEVT
     C** Authorized Indicator         Autopost position Settl.,SDSTRDPD
     C***********BVAPS     IFEQ 'Y'                                       S01496
     C           BVAPST    IFEQ 'Y'                                       S01496
     C                     MOVE 'Y'       PAUI
     C                     ELSE
     C                     MOVE *BLANKS   PAUI
     C                     END
     C** Nominal Position               Nominal to be redeemed,SEERDPPD
     C                     Z-ADDVCNOMA    PNMP
     C** Value Currency                          Nominal Currency,SECTY
     C                     MOVELNMCY      PNCY
     C** Book Code                        DEFAULT MARKET BOOK, SDSTRDPD
     C                     MOVELBVDMBC    PBCD
     C** Amount Due           ABS(Nominal Allocated) X REDEMPTION PRICE
     C**                      CALCULATE VIA SR/ZAPNUM
     C           CGL031    IFNE 'Y'                                                           233712
     C           SETX      ORNE 'Y'                                                           233712
     C           CGL031    ANDEQ'Y'                                                           233712
     C                     Z-ADDZVALU     PAMD
     C                     ELSE                                                               233712
     C********** WNOMAT    SUB  TXNM      PAMD                                         233712 234874
     C                     Z-ADDWNOMAT    PAMD                                                234874
     C           PAMD      SUB  TXNM      PAMD1  130                                          234874
     C                     ENDIF                                                              233712
     C** Pay/Receive Indicator
     C           VCNOMA    IFGT 0
     C                     MOVEL'P'       PPRE
     C                     ELSE
     C                     MOVEL'R'       PPRE
     C                     ENDIF
     C** Settlement instructions from P009
     C** Settlement Currency
     C                     MOVELWPSCU     PSCU
     C** Settlement Method
     C                     MOVE WPSMT     PSMT
     C** Settlement Account
     C                     MOVELWPSEA     PSEA
     C** Settlement Branch
     C                     MOVELWPSEB     PSEB
     C*                                                                   234054
      ** If Settlement Branch is *blank - DB error in SE1540              234054
     C*                                                                   234054
     C           PEVT      IFEQ 'RC'                                      234054
     C           PSEB      ANDEQ'   '                                     234054
     C                     MOVE VCBRCD    PSEB                            234054
     C                     END                                            234054
     C*                                                                   234054
     C*                                                                   160338
     C** Charge code, Charge amount, Commission code                      160338
     C** and Commission amount                                            160338
     C*                                                                   160338
     C                     MOVEL*BLANKS   PCHC                            160338
     C                     Z-ADD0         PCHA                            160338
     C                     MOVEL*BLANKS   PCCD                            160338
     C                     Z-ADD0         PCAM                            160338
     C*                                                                   160338
     C** Determine default charges from SEDFTCPD. (SEDFTCL2) only         160338
     C** if 'Position Settlements Auto-Charges' feature is on.            160338
     C*                                                                   160338
     C           S01519    IFEQ 'Y'                                       160338
     C                     EXSR P04                                       160338
     C/COPY WNCPYSRC,SE6720C015                                           160338
     C                     END                                            160338
     C*                                                                   160338
     C** Calculate Settlement Amount                                      160338
     C*                                                                   160338
     C                     EXSR P06                                       160338
     C** Base Currency Echange Rate       (Value CCY to Settlement CCY)
     C** Value Currency (FROM)=Security Nominal CCY - Saved values used
     C***********          Z-ADD1         ZAMTF                           160338
     C*                                                                   160338
     C** Convert Settlement Amount from Nominal Currency                  160338
     C** to Settlement Currency                                           160338
     C*                                                                   160338
     C           PSCU      IFNE NMCY                                      160338
     C                     Z-ADDPSAT      ZAMTF                           160338
     C                     MOVE NMCY      ZCCYF
     C                     Z-ADDWNSPRT    ZRATEF
     C                     MOVE WNMDIN    ZMDINF
     C                     Z-ADDWNNBDP    ZCDPF
     C*
     C** Settlement Currency (TO)
     C***********PSCU      CHAINSDCURRL1             89                   S01496
     C*                                                                   S01496
     C                     CALL 'AOCURRR0'                                S01496
     C                     PARM *BLANKS   WLRTCD                          S01496
     C                     PARM '*KEY  '  WLOPTN                          S01496
     C                     PARM PSCU      WLCYCD                          S01496
     C           SDCURR    PARM SDCURR    DSSDY                           S01496
     C*                                                                   S01496
     C************IN89     IFEQ '1'                                       S01496
     C           WLRTCD    IFNE *BLANKS                                   S01496
     C***********          MOVEL'SDCURRL1'DBFILE           ***************S01496
     C                     MOVE 'SDCURRPD'DBFILE           ***************S01496
     C                     MOVELPSCU      DBKEY            ** DB ERROR 11 **
     C                     Z-ADD11        DBASE            *****************
     C                     EXSR *PSSR
     C                     ELSE
     C                     MOVE PSCU      ZCCYT
     C                     MOVE A6SPRT    ZRATET
     C                     Z-ADDA6SPRT    WWSPOT 138                      CH0273
     C                     MOVE A6MDIN    WWMDIN  1                       CH0273
     C                     MOVE A6MDIN    ZMDINT
     C                     MOVE A6NBDP    ZCDPT
     C                     ENDIF
     C** Settlement Exchange Rate
     C/COPY WNCPYSRC,SE6720C002
     C                     EXSR ZCCYCN
     C/COPY WNCPYSRC,SE6720C003
     C                     Z-ADDZCRSRT    PSXR
     C                     Z-ADDZAMTT     PSAT                            160338
     C** Multiply/Divide Indicator
     C                     MOVE ZCRSMD    PMDI
     C                     ELSE                                           160338
     C                     Z-ADD1         PSXR                            160338
     C                     MOVEL'M'       PMDI                            160338
     C                     ENDIF                                          160338
     C** Base Currency Exchange Rate
     C***********          Z-ADDZRATET    PBRX                            160338
     C                     Z-ADDWNSPRT    PBRX                            160338
     C** Counterparty Bank
     C                     MOVEL*BLANKS   PCPN
     C** For Account of
     C                     MOVEL*BLANKS   PFAC
     C** Special Instructions
     C                     MOVEL*BLANKS   PSPI
     C***Charge*Code***************************************************   160338
     C***********          MOVEL*BLANKS   PCHC                            160338
     C***Charge*Amount*************************************************   160338
     C***********          Z-ADD0         PCHA                            160338
     C***Commission*Code***********************************************   160338
     C***********          MOVEL*BLANKS   PCCD                            160338
     C***Commission*Amount*********************************************   160338
     C***********          Z-ADD0         PCAM                            160338
     C*                                                                   S01496
     C***Determine*default*charges*from*SEDFTCPD.*(SEDFTCL2)***********   160338
     C****only*if*"Position*Settlements*Autocharges"*feature*is*on S01496 160338
     C*                                                                   S01496
     C***********S01519    IFEQ 'Y'                                S01496 160338
     C***********          EXSR P04                                       160338
     C*/C*PY*WNCPYSRC,SE6720C015***************************************   160338
     C***********          END                                     S01496 160338
     C*                                                                   S01496
     C***Calculate*Settlement*Amount***********************************   160338
     C***********          EXSR P06                                       160338
     C** Message Indicator
     C                     MOVEL*BLANKS   PSMI
     C** Date generated           RUN DATE
     C                     MOVE BJRDNB    PDTG
     C** Last change date         RUN DATE
     C                     MOVE BJRDNB    LCD
     C** Type of last change
     C                     MOVEL'I'       CHTP
     C** Transaction number of update
     C                     EXSR ZTNLU1
     C***********          MOVELFNATN     TNL1                            S01496
     C                     MOVELFNATN     TNLU                            S01496
     C** Portfolio reference
     C                     MOVELVCPTFR    PTFR
     C** Position settl. value date = PAYMENT DATE, SEERRFPD
     C***********          MOVE VAERPD    PSVL                            S01496
     C                     MOVE VAERPD    PSVL                      S01496095236
     C** Settlement reversal postings gen.
     C                     MOVEL*BLANKS   SRPG
     C** Record_ID       'D'
     C                     MOVE 'D'       RECI
     C*                                                                   CEU005
     C** If CEU005 active, use 'In' ccy values for settlement details     CEU005
     C*                                                                   CEU005
     C           CEU005    IFEQ 'Y'                                       CEU005
     C           SVSCCY    ANDNE*BLANKS                                   CEU005
     C                     MOVE SVEUER    PSXR                            CEU005
     C***********SVSCCY    IFEQ BKEURO                             CEU005 160338
     C           NMCY      IFEQ BKEURO                                    160338
     C           SVEUMD    IFEQ 'M'                                       CEU005
     C                     MOVE 'D'       PMDI                            CEU005
     C                     ELSE                                           CEU005
     C                     MOVE 'M'       PMDI                            CEU005
     C                     ENDIF                                          CEU005
      *                                                                   CEU005
      * Settlement ccy not Euro ccy, use Euro M/D indicator.              CEU005
     C                     ELSE                                           CEU005
     C                     MOVE SVEUMD    PMDI                            CEU005
     C                     ENDIF                                          CEU005
      * Use standard settlement ccy for position settlement ccy           CEU005
     C                     MOVE SVSCCY    PSCU                            CEU005
     C                     ENDIF                                          CEU005
     C*
     C** Count records written
     C                     ADD  1         W02CNT
     C*                                                                   CAC003
     C** Move PCCU to PPFC if *IN40 is on.                                CAC003
     C           *IN40     IFEQ '1'                                       CAC003
     C           FIND      ANDEQ'Y'                                       CAC003
     C                     MOVE PCCU      PPFC                            CAC003
     C                     ELSE                                           CAC003
     C                     MOVE *BLANKS   PPFC                            CAC003
     C                     ENDIF                                          CAC003
     C*                                                                   CAC003
     C** Initialise FXMP, FXMR, and MAMT to zero.                         CAC003
     C                     Z-ADD0         FXMP                            CAC003
     C                     Z-ADD0         FXMR                            CAC003
     C                     Z-ADD0         MAMT                            CAC003
     C*                                                                   189109
     C** Initialise DAMT to zero                                          189109
     C                     Z-ADD0         DAMT                            189109
     C*
     C** Write Position Settlement Record
     C                     WRITEPOSETDF
     C                     EXSR PSAUDT                                                      AR324886
     C*
     C           W202E     ENDSR                           ** ENDW02 **
     C*
     C********************************************************************
      /EJECT
     C********************************************************************
     C**P202******-*DEDUCE*IF*WITHHOLDING*TAX*IS*TO*BE*CALCULATED******   S01496
     C********************************************************************
     C***********                                                         S01496
     C***********P202      BEGSR                           **   P02  **   S01496
     C***********                                                         S01496
     C**WRITE*A*RECORD*IN*THE*POSITION*SETTLEMENT*EXTENSION*FILE*******   S01496
     C***********                                                         S01496
     C***********          MOVE PBCH      POPBCH                          S01496
     C***********          MOVE PSSH      POPSSH                          S01496
     C***********          MOVELPCPY      POPCPY                          S01496
     C***********          Z-ADDPDUD      POPDUD                          S01496
     C***********          MOVE PEVT      POPEVT                          S01496
     C***********          MOVE VCPTFR    POPTFR                          S01496
     C***********                                                         S01496
     C***********          WRITEPOSETDD0                                  S01496
     C***********                                                         S01496
     C***********ENP202    ENDSR                           ** ENDP02 **   S01496
     C***********                                                         S01496
     C**********************************************************************
     C/EJECT
     C**********************************************************************
     C           AUDIT     BEGSR                           ** AUDIT **
     C**********************************************************************
     C*
     C** UPDATE GEN A/C KEYS AUDIT AND POSN.SETT.AUDIT FIL             ES
     C*
     C                     Z-ADDW01CNT    NORE
     C                     Z-ADDINT,1     HRWN
     C                     Z-ADDDEC,1     HRDC
     C                     WRITESEKEYAF
     C                     Z-ADDW02CNT    NORE
     C                     Z-ADD*ZEROS    TNLU                            S01496
     C                     WRITEPOSETAF
     C*
     C* OUTPUT CONTROL REPORT
     C*
     C                     WRITEHEADAU
     C           *INU7     IFEQ '1'
     C                     WRITEERROR
     C                     ELSE
     C           W01CNT    IFEQ 0
     C           W02CNT    ANDEQ0
     C                     WRITENONE
     C                     ELSE
     C                     Z-ADDINT,1     WHASHT
     C                     Z-ADDDEC,1     WHASHD
     C                     WRITECONTROL
     C                     ENDIF
     C                     ENDIF
     C*
     C***********          WRITETRAILAU                                   S01496
     C*
     C                     ENDSR
      *****************************************************************                       233712
      /EJECT                                                                                  233712
      *****************************************************************                       233712
      *                                                               *                       233712
      *  ERTAX  - Subroutine to calculate tax for descretionary and   *                       233712
      *           safe custody customers.                             *                       233712
      *                                                               *                       233712
      *****************************************************************                       233712
      *                                                                                       233712
     C           ERTAX     BEGSR                                                              233712
      *                                                                                       233712
      ** Check if record needs to be taxed.                                                   233712
      *                                                                                       233712
     C                     EXSR CHKTAX                                                        233712
      *                                                                                       234440
      ** Calculate Tax Amount for the Redemption                                              234440
      *                                                                                       234440
     C           WNOTAX    IFEQ ' '                                                           234440
     C           ISSP      ANDNE100                                                           234440
      *                                                                                       234440
      ** Initialise work variables                                                            234874
      *                                                                                       234874
     C                     Z-ADD0         TXNM                                                234874
     C                     Z-ADD0         TXST                                                234874
     C                     Z-ADD0         TAXA                                                234874
     C                     MOVE *BLANKS   TXCY                                                234874
     C                     MOVE ' '       WTXPI   1                                           234874
     C                     MOVE ' '       WTXJA   1                                           234874
      *                                                                                       234874
      ** Get Fiscal Price at Event Date                                                       234440
      *                                                                                       234440
      ***If Country*of*Tax*is*not*Switzerland,*use*straight*line*basis                 234440 236137
      *****************************************************************                234440 236137
     C                     Z-ADDVAREDP    VARED2 158                                          235546
     C***********EWCTRT    IFNE 'CH'                                                   234440 236137
      *                                                                                       236137
      ** Choice of calculation method for fiscal price depends on Tax                         236137
      ** Calculation Basis indicator from Country of Tax Codes file.                          236137
      *                                                                                       236137
      ** Straight line basis:                                                                 236137
      *                                                                                       236137
     C           EWTXCB    IFEQ 'B'                                                           236137
     C                     CALL 'ZAINTPL2'                                                    234440
     C                     PARM           ISSD                                                234440
     C                     PARM           VAERRD                                              234440
     C                     PARM           MATY                                                234440
     C                     PARM           ISSP                                                234440
     C**********           PARM           VAREDP                                       234440 235546
     C                     PARM           VARED2                                              235546
     C                     PARM           WFSPR  158                                          234440
      *                                                                                       234440
      ***If*Country*of*Tax*is*Switzerland,*use*analytical*interpolation                234440 236137
      ** Actuarial interpolation:                                                             236137
      *                                                                                       234440
     C                     ELSE                                                               234440
     C                     CALL 'ZAACTUAR'                                                    234440
     C                     PARM           WRTCD  10                                           234440
     C                     PARM           ISSD                                                234440
     C                     PARM           ISSP                                                234440
     C                     PARM           MATY                                                234440
     C**********           PARM           VAREDP                                       234440 235546
     C                     PARM           VARED2                                              235546
     C                     PARM           DYBS                                                234440
     C                     PARM           DVBS                                                234440
     C                     PARM           CDDS                                                234440
     C                     PARM           CRDS                                                234440
     C                     PARM           LCPN                                              BUG11164
     C                     PARM           VAERRD                                              234440
     C                     PARM           WFSPR                                               234440
     C                     ENDIF                                                              234440
      *                                                                                       234440
      ** Always take the redemption price                                                     234874
      *                                                                                       234874
     C                     Z-ADDVARED2    WFSPR                                               234874
      *                                                                                       234440
      ** Get Average Fiscal Price of Position                                                 234440
      *                                                                                       234440
      *                                                                                       234440
      ** Access Customer Position                                                             234440
      *                                                                                       234440
     C                     CALL WPGM                                                          234440
     C                     PARM           WRTCD  10                                           234440
     C                     PARM           VCBRCD                                              234440
     C                     PARM           VCCNUM                                              234440
     C                     PARM           VCSESN                                              234440
     C                     PARM           VCPTFR                                              234440
     C                     PARM 'S'       WMKT    1                                           234440
     C                     PARM           VAEREX                                              234440
     C                     PARM           ETCPOS                                              234440
      *                                                                                       234440
     C                     Z-ADDAVFP      WAVFP  158                                          234440
      *                                                                                       234440
      ** Taxable amount is the difference between Fiscal Price and average                    234440
      ** Fiscal price x Nominal Amount                                                        234440
      *                                                                                       234440
     C           WFSPR     SUB  WAVFP     WFISC  158                                          234440
      *                                                                                       234440
      ********** SPBS      IFEQ 'P'                                                    234440 234874
      **********           DIV  100       WFISC     H                                  234440 234874
      **********           END                                                         234440 234874
      *                                                                                       233712
      ***FIND*THE*COST*OF*THE*HOLDING**********************************                233712 234440
      *                                                                                       233712
      ********** CPKEY     CHAINCPOSC                88                                233712 234440
      ********** *IN88     IFEQ '1'                                                    233712 234440
      **********           Z-ADD0         AVFP                                         233712 234440
      **********           ENDIF                                                       233712 234440
      *                                                                                       233712
     C           VCNOMA    IFLT *ZEROS                                                        233712
     C           *ZERO     SUB  VCNOMA    ZNOML                                               233712
     C                     ELSE                                                               233712
     C                     Z-ADDVCNOMA    ZNOML                                               233712
     C                     ENDIF                                                              233712
     C**********           Z-ADDAVFP      ZAVPR                                        233712 234440
     C                     Z-ADDWFISC     ZAVPR                                               234440
     C                     EXSR ZAPNUM                                                        233712
     C**********           Z-ADDZVALU     WCSAV  150                                   233712 234440
     C                     Z-ADDZVALU     WFSCA  150                                          234440
      *                                                                                       234440
      ** Now do comparison with profit on redemption, if country                              234440
      ** of tax is not Switzerland, and take the lower figure as the                          234440
      ** the taxable amount                                                                   234440
      *                                                                                       234440
      ** bit about CH is added and removed by this change control                             234440
      ** it is left in the code in case the situation changes again.                          234440
     C********** EWCTRT    IFNE 'CH'                                                          234440
     C           EWCTRT    IFNE 'CH'                                                          234874
      *                                                                                       234440
      ** If average price is greater than redemption price, there is no                       234440
      ** profit and so no tax.                                                                234440
     C           LAVP      IFGT VAREDP                                                        234440
     C                     Z-ADD0         WRESLT                                              234440
     C                     ELSE                                                               234440
     C           VCNOMA    IFLT *ZEROS                                                        234440
     C           *ZERO     SUB  VCNOMA    ZNOML                                               234440
     C                     ELSE                                                               234440
     C                     Z-ADDVCNOMA    ZNOML                                               234440
     C                     ENDIF                                                              234440
     C                     Z-ADDLAVP      ZAVPR                                               234440
     C                     EXSR ZAPNUM                                                        234440
     C**********           Z-ADDZVALU     WCSAV  150                                   233712 234440
     C           WNOMAT    SUB  ZVALU     WPRFA  150                                          234440
     C           WPRFA     IFLT WFSCA                                                         234440
     C                     Z-ADDWPRFA     WRESLT 150                                          234440
     C                     ELSE                                                               234440
     C                     Z-ADDWFSCA     WRESLT                                              234440
     C                     ENDIF                                                              234440
     C                     ENDIF                                                              234440
      *                                                                                       234440
      ** If Switzerland then just take "fiscal" amount                                        234440
      *                                                                                       234440
     C**********           ELSE                                                               234440
     C**********           Z-ADDWFSCA     WRESLT                                              234440
     C**********           ENDIF                                                              234440
     C                     ELSE                                                               234874
     C                     Z-ADDWFSCA     WRESLT                                              234874
     C                     ENDIF                                                              234874
      *                                                                                       233712
      ***If*no*record*found,*no*tax*is*calculated**********************                       233712
      *                                                                                       233712
      ***Calculate*Tax*Amount*for*the*Maturity*or*Early*Redemption*****                       233712
      ***and*to*Output*Information*on*SDCSINPD*************************                       233712
      *                                                                                       233712
     C********** WNOTAX    IFEQ ' '                                                           234440
      *                                                                                       233712
      ***Compute*the*difference*between*WNOMAT*and*WCSAV.**************                233712 234440
      ***If*WNOMAT*-*WCSAV*=*negative*or*0*nothing*must*be*calculated*or output        233712 234440
      ***in*SDCSINPD.**************************************************                233712 234440
      *                                                                                       233712
     C********** WNOMAT    SUB  WCSAV     WRESLT 150                                   233712 234440
      *                                                                                       233712
      ** Calculate tax from taxable amount and output it.                              233712 234440
      *                                                                                233712 234440
     C           WRESLT    IFGT 0                                                             233712
      *                                                                                       233709
     C********** EWTRT1    IFEQ '1'                                                    233709 234440
     C********** EWEDT1    ANDGTVAERRD                                                 233709 234440
     C********** VAERRD    SUB  CSDA      WDAY1   50                                   233709 234440
     C********** VAERRD    SUB  EWEDT1    WDAY2   50                                   233709 234440
     C********** WRESLT    MULT WDAY2     WRESLT                                       233709 234440
     C********** WRESLT    DIV  WDAY1     WRESLT                                       233709 234440
     C**********           ENDIF                                                       233709 234440
      *                                                                                       233709
     C                     EXSR MATXCL                                                        233712
      *                                                                                       233712
     C                     ENDIF                                                              233712
     C                     ENDIF                                                              233712
      *                                                                                       233712
     C                     ENDSR                                                              233712
      *****************************************************************                       233712
      /EJECT                                                                                  233712
      *****************************************************************                       233712
      *                                                               *                       233712
      *  CHKTAX - Subroutine to check if record is existing in        *                       233712
      *           SDCTTXPD for taxing.                                *                       233712
      *                                                               *                       233712
      *****************************************************************                       233712
      *                                                                                       233712
     C           CHKTAX    BEGSR                                                              233712
      *                                                                                       233712
      ** Retrieve Branch Location Code                                                        233712
      *                                                                                       233712
     C                     CALL 'AOBRCHR0'                                                    233712
     C                     PARM *BLANKS   P@RTCD                                              233712
     C                     PARM '*KEY   ' P@OPTN                                              233712
     C                     PARM VCBRCD    P@BRCD  3                                           233712
     C           SDBRCH    PARM SDBRCH    DSFDY                                               233712
      *                                                                                       233712
      ** Database Error                                                                       233712
      *                                                                                       233712
     C           P@RTCD    IFNE *BLANKS                                                       233712
     C           *LOCK     IN   LDA                                                           233712
     C                     MOVEL'SDBRCHL1'DBFILE                                              233712
     C                     MOVELVCBRCD    DBKEY                                               233712
     C                     Z-ADD53        DBASE                                               233712
     C                     MOVE *ON       *INU7                                               233712
     C                     MOVE *ON       *INU8                                               233712
     C                     EXSR *PSSR                                                         233712
     C                     ELSE                                                               233712
     C                     MOVELA8LCCD    P@LCCD  3                                           233712
      *                                                                                       233712
      ** Retrieve Country of Tax                                                              233712
      *                                                                                       233712
     C                     CALL 'AOLOCNR0'                                                    233712
     C                     PARM *BLANKS   P@RTCD                                              233712
     C                     PARM '*KEY   ' P@OPTN                                              233712
     C                     PARM           P@LCCD                                              233712
     C           SDLOCN    PARM SDLOCN    DSFDY                                               233712
      *                                                                                       233712
      ** Database Error                                                                       233712
      *                                                                                       233712
     C           P@RTCD    IFNE *BLANKS                                                       233712
     C           *LOCK     IN   LDA                                                           233712
     C                     MOVEL'SDLOCNL1'DBFILE                                              233712
     C                     MOVELA8LCCD    DBKEY                                               233712
     C                     Z-ADD54        DBASE                                               233712
     C                     MOVE *ON       *INU7                                               233712
     C                     MOVE *ON       *INU8                                               233712
     C                     EXSR *PSSR                                                         233712
     C                     ELSE                                                               233712
     C                     MOVE DVCNCD    WCTAX   2                                           233712
     C                     ENDIF                                                              233712
     C                     ENDIF                                                              233712
      *                                                                                       233712
      ** Retrieve Country of Residence                                                        233712
      *                                                                                       233712
     C                     MOVELVCCNUM    P@CSCN 10                                           233712
      *                                                                                       233712
     C                     CALL 'AOCUSTR0'                                                    233712
     C                     PARM *BLANKS   P@RTCD                                              233712
     C                     PARM '*KEY   ' P@OPTN                                              233712
     C                     PARM           P@CSCN                                              233712
     C                     PARM *BLANKS   P@KYST  7                                           233712
     C           SDCUST    PARM SDCUST    DSSDY                                               233712
      *                                                                                       233712
      ** Database Error                                                                       233712
      *                                                                                       233712
     C           P@RTCD    IFNE *BLANKS                                                       233712
     C           *LOCK     IN   LDA                                                           233712
     C                     MOVEL'SDCUSTL1'DBFILE                                              233712
     C                     MOVELVCCNUM    DBKEY                                               233712
     C                     Z-ADD55        DBASE                                               233712
     C                     MOVE *ON       *INU7                                               233712
     C                     MOVE *ON       *INU8                                               233712
     C                     EXSR *PSSR                                                         233712
     C                     ELSE                                                               233712
     C                     MOVE BBCOLC    WCOLC   2                                           233712
     C                     ENDIF                                                              233712
      *                                                                                       233712
      ** Retrieve Tax Basket                                                                  233712
      *                                                                                       233712
     C                     CALL 'AOCTTXR0'                                                    233712
     C                     PARM *BLANKS   P@RTCD                                              233712
     C                     PARM '*KEY   ' P@OPTN                                              233712
     C                     PARM WCTAX     P@CTRT  2                                           233712
     C                     PARM WCOLC     P@CTRR  2                                           233712
     C           SDCTTX    PARM SDCTTX    DSFDY                                               233712
      *                                                                                       233712
      ** If no record found, accessed with a country of tax and                               233712
      ** a blank country of residence.                                                        233712
      *                                                                                       233712
     C           P@RTCD    IFEQ 'NRF    '                                                     233712
     C                     CALL 'AOCTTXR0'                                                    233712
     C                     PARM *BLANKS   P@RTCD                                              233712
     C                     PARM '*KEY   ' P@OPTN                                              233712
     C                     PARM WCTAX     P@CTRT                                              233712
     C                     PARM *BLANKS   P@CTRR                                              233712
     C           SDCTTX    PARM SDCTTX    DSFDY                                               233712
     C                     ENDIF                                                              234440
      *                                                                                       233712
      ***Database*Error************************************************                233712 234440
      *                                                                                       233712
      ***No*tax*should*be*calculated*if*effective*date*is*in*the*future                       234440
      *                                                                                       234440
     C           P@RTCD    IFNE *BLANKS                                                       233712
     C           EWEDT1    ORGT VAERRD                                                        234440
     C********** *LOCK     IN   LDA                                                    233712 234440
     C**********           MOVEL'SDCTTXL1'DBFILE                                       233712 234440
     C**********           MOVELWCTAX     DBKEY                                        233712 234440
     C**********           Z-ADD56        DBASE                                        233712 234440
     C**********           MOVE *ON       *INU7                                        233712 234440
     C**********           MOVE *ON       *INU8                                        233712 234440
     C**********           EXSR *PSSR                                                  233712 234440
     C**********           ENDIF                                                       233712 234440
     C**********           ENDIF                                                       233712 234440
     C                     ELSE                                                               234440
      *                                                                                       233712
     C                     MOVE EWTXBS    WTAXBS  2                                           233712
      *                                                                                       233712
      ** Retrieve Tax Rate Applicable for Band                                                233712
      *                                                                                       233712
     C                     Z-ADDBJRDNB    P@DATE                                              233863
      *                                                                                       233863
     C                     CALL 'AOTXBSR0'                                                    233712
     C                     PARM *BLANKS   P@RTCD                                              233712
     C                     PARM '*KEY   ' P@OPTN                                              233712
     C                     PARM WCTAX     P@CTTT  2                                           233712
     C                     PARM WTAXBS    P@TXBS  2                                           233712
     C                     PARM           P@DATE  50                                          233863
     C                     PARM           P@NARR 15                                           233712
     C                     PARM           P@RATE  64                                          233712
      *                                                                                       233712
     C           P@RTCD    IFEQ *BLANKS                                                       233712
     C                     MOVE ' '       WNOTAX  1                                           233712
     C                     Z-ADDP@RATE    WTRAB   64                                          233712
     C                     ELSE                                                               233712
      *                                                                                       233712
      ** If no record found, no tax is calculated.                                            233712
      *                                                                                       233712
     C                     MOVE 'Y'       WNOTAX                                              233712
     C                     ENDIF                                                              233712
     C                     ENDIF                                                              234440
      *                                                                                       233712
     C                     ENDSR                                                              233712
      *****************************************************************                       233712
      /EJECT                                                                                  233712
      *****************************************************************                       233712
      *                                                               *                       233712
      *  MATXCL - Subroutine to calculate tax amount for the Maturity *                       233712
      *           or Early Redemption and to Output Information on    *                       233712
      *           SDCSINPD                                            *                       233712
      *                                                               *                       233712
      *****************************************************************                       233712
      *                                                                                       233712
     C           MATXCL    BEGSR                                                              233712
      *                                                                                       233712
      ** Initialise work variables                                                            233712
      *                                                                                       233712
     C                     Z-ADD0         TXNM                                                233709
     C                     Z-ADD0         TXST                                                233709
     C                     Z-ADD0         TAXA                                                233709
     C                     MOVE *BLANKS   TXCY                                                233709
     C                     MOVE ' '       WTXPI   1                                           233712
     C                     MOVE ' '       WTXJA   1                                           233712
      *                                                                                       233712
     C                     MOVE VCCNUM    @@CUST                                              233712
      *                                                                                       233712
     C                     CALL 'ZATXCLPI'                                                    233712
      ** Input                                                                                233712
     C                     PARM 'S'       @@MODI  1                                           233712
     C                     PARM VCSESN    @@TRRF 18                                           233712
     C                     PARM VCBRCD    @@BRCA  3                                           233712
     C                     PARM           @@CUST  6                                           233712
     C                     PARM *ZERO     @@STRD  50                                          233712
     C                     PARM *ZERO     @@ENDD  50                                          233712
     C                     PARM WRESLT    @@TOTI 150                                          233712
     C                     PARM WTRAB     @@TAXR  64                                          233712
     C                     PARM NMCY      @@OCCY  3                                           233568
     C                     PARM *BLANKS   PINTH   1                                           CER048
      ** Output                                                                               233712
     C                     PARM           @@IAED 150                                          233712
     C                     PARM           @@TAXA 150                                          233712
     C                     PARM           @@TOTO 150                                          233712
     C                     PARM           @@TXCY  3                                           233712
     C                     PARM           @@CTAX  2                                           233712
     C                     PARM           @@TXBS  2                                           233712
     C                     PARM           @@WTAC  40                                          233712
     C                     PARM           @@COLC  2                                           233712
     C                     PARM           @@STAT  5                                           233712
     C                     PARM           @@TRTE  1                                           233712
     C                     PARM           @@TXR1  64                                          233712
     C**********           PARM *ZEROS    PSTXB   20                                 CER048 BUG22911
     C**********           PARM *ZEROS    PSTAC  100                                 CER048 BUG22911
     C**********           PARM *ZEROS    PSTTR   64                                 CER048 BUG22911
     C**********           PARM *BLANKS   PSTTP   1                                  CER048 BUG22911
     C**********           PARM *ZEROS    PSTXA  150                                 CER048 BUG22911
     C                     PARM           @@KEY  10                                           233712
     C                     PARM           @@FILE 10                                           233712
     C                     PARM           @@RTRN  7                                           233712
     C           SDTXPA    PARM SDTXPA    DSSDY                                             BUG22911
      *                                                                                       233712
     C                     SELEC                                                              233712
      *                                                                                       233712
      ** If return code = Error.                                                              233712
      *                                                                                       233712
     C           @@RTRN    WHEQ 'ERROR'                                                       233712
     C                     MOVE @@FILE    DBFILE                                              233712
     C                     MOVE @@KEY     DBKEY                                               233712
     C                     Z-ADD63        DBASE                                               233712
     C                     MOVE *ON       *INU7                                               233712
     C                     MOVE *ON       *INU8                                               233712
     C                     EXSR *PSSR                                                         233712
      *                                                                                       233712
      ** If return code = Private Individual                                                  233712
      *                                                                                       233712
     C           @@RTRN    WHNE 'JOINT'                                                       233712
      *                                                                                       233712
     C           @@TOTO    IFNE *ZERO                                                         233712
     C           @@STAT    IFEQ 'TAXAB'                                                       233712
     C           @@STAT    OREQ 'DISCL'                                                       233712
     C           @@STAT    OREQ 'SELF'                                                        233712
      *                                                                                       233712
     C                     MOVE 'Y'       WTXPI                                               233712
     C                     MOVE WCTAX     KCSIS                                               233712
     C                     MOVE @@CTAX    KCTRT                                               233712
      *                                                                                       233712
     C           KTXCM     CHAINSDTXCML1             61                                       233712
     C           *IN61     IFEQ *OFF                                                          233712
      *                                                                                       233712
     C                     SELEC                                                              233712
     C           TCTXCM    WHEQ 1                                                             233712
     C           WLTAX     OREQ 0                                                             234813
     C                     Z-ADD@@TAXA    @@TAXA                                              233712
     C           TCTXCM    WHEQ 2                                                             233712
     C           WLTAX     MULT @@TOTI    WTAXA  150                                          234813
     C                     DIV  100       WTAXA                                               234813
     C           @@TOTI    SUB  WTAXA     WTAXA                                               234813
     C                     DIV  100       WTAXA                                               234813
     C                     MULT @@TAXR    WTAXA                                               234813
     C           WTAXA     IFLT 0                                                             234813
     C                     Z-ADD0         @@TAXA                                              234813
     C                     ELSE                                                               234813
     C**********           Z-ADD@@TAXA    @@TAXA                                       233712 234813
     C                     Z-ADDWTAXA     @@TAXA                                              234813
     C                     ENDIF                                                              234813
     C           TCTXCM    WHEQ 3                                                             233712
     C           WLTAX     MULT @@TOTI    WTAXA                                               234813
     C                     DIV  100       WTAXA                                               234813
     C           @@TAXA    SUB  WTAXA     WTAXA                                               234813
     C           WTAXA     IFLT 0                                                             234813
     C                     Z-ADD0         @@TAXA                                              234813
     C                     ELSE                                                               234813
     C**********           Z-ADD@@TAXA    @@TAXA                                       233712 234813
     C                     Z-ADDWTAXA     @@TAXA                                              234813
     C                     ENDIF                                                              234813
     C           TCTXCM    WHEQ 4                                                             233712
     C                     Z-ADD0         @@TAXA                                              233712
     C                     ENDSL                                                              233712
      *                                                                                       233712
     C                     ENDIF                                                              233712
      *                                                                                       233712
      ** Write record to SDCSINPD                                                             233712
      *                                                                                       233712
     C                     EXSR CSINSR                                                        233712
      *                                                                                       233712
     C                     ENDIF                                                              233712
     C                     ENDIF                                                              233712
      *                                                                                       233712
      ** If return code = Private Individual                                                  233712
      *                                                                                       233712
     C           @@RTRN    WHEQ 'JOINT'                                                       233712
     C                     MOVE VCCNUM    KJANO   6                                           233712
      *                                                                                       233712
     C           KJANO     SETLLSDJACCLB                                                      233712
     C           KJANO     READESDJACCLB                 60                                   233712
      *                                                                                       233712
     C           *IN60     DOWEQ*OFF                                                          233712
      *                                                                                       233712
     C                     CALL 'ZATXCLJA'                                                    233712
      ** Input                                                                                233712
     C                     PARM 'S'       @@MODI                                              233712
     C                     PARM VCSESN    @@TRRF                                              233712
     C                     PARM VCBRCD    @@BRCA                                              233712
     C                     PARM JCJANO    @@JANO  6                                           233712
     C                     PARM JCCUST    @@CUST                                              233712
     C                     PARM JCNAHO    @@NARF 10                                           233712
     C                     PARM JCINVP    @@INVP 10                                           233712
     C                     PARM JCPAHT    @@PAHT  1                                         BUG26839
     C                     PARM *ZERO     @@STRD                                              233712
     C                     PARM *ZERO     @@ENDD                                              233712
     C                     PARM WRESLT    @@TOTI                                              233712
     C                     PARM WTRAB     @@TAXR                                              233712
     C                     PARM NMCY      @@OCCY                                              233568
     C                     PARM *BLANKS   PINTH                                               CER048
      ** Output                                                                               233712
     C                     PARM           @@IAED                                              233712
     C                     PARM           @@TAXA                                              233712
     C                     PARM           @@TOTO                                              233712
     C                     PARM           @@TXCY                                              233712
     C                     PARM           @@CTAX                                              233712
     C                     PARM           @@TXBS                                              233712
     C                     PARM           @@WTAC                                              233712
     C                     PARM           @@COLC                                              233712
     C                     PARM           @@STAT                                              233712
     C                     PARM           @@TRTE                                              233712
     C                     PARM           @@TXR1                                              233712
     C                     PARM           @@JAMG  1                                           233712
     C**********           PARM *ZEROS    PSTXB                                      CER048 BUG22911
     C**********           PARM *ZEROS    PSTAC                                      CER048 BUG22911
     C**********           PARM *ZEROS    PSTTR                                      CER048 BUG22911
     C**********           PARM *BLANKS   PSTTP                                      CER048 BUG22911
     C**********           PARM *ZEROS    PSTXA                                      CER048 BUG22911
     C                     PARM           @@KEY                                               233712
     C                     PARM           @@FILE                                              233712
     C                     PARM           @@RTRN                                              233712
     C           SDTXPA    PARM SDTXPA    DSSDY                                             BUG22911
      *                                                                                       233712
      ** If return code = Error.                                                              233712
      *                                                                                       233712
     C           @@RTRN    IFEQ 'ERROR'                                                       233712
     C                     MOVE @@FILE    DBFILE                                              233712
     C                     MOVE @@KEY     DBKEY                                               233712
     C                     Z-ADD65        DBASE                                               233712
     C                     MOVE *ON       *INU7                                               233712
     C                     MOVE *ON       *INU8                                               233712
     C                     EXSR *PSSR                                                         233712
     C                     ENDIF                                                              233712
      *                                                                                       233712
     C           @@TOTO    IFNE *ZERO                                                         233712
     C           @@STAT    IFEQ 'TAXAB'                                                       233712
     C           @@STAT    OREQ 'DISCL'                                                       233712
     C           @@STAT    OREQ 'SELF '                                                       233712
      *                                                                                       233712
     C                     MOVE 'Y'       WTXJA                                               233712
     C                     MOVE WCTAX     KCSIS                                               233712
     C                     MOVE @@CTAX    KCTRT                                               233712
      *                                                                                       233712
     C           KTXCM     CHAINSDTXCML1             61                                       233712
     C           *IN61     IFEQ *OFF                                                          233712
      *                                                                                       233712
     C                     SELEC                                                              233712
     C           TCTXCM    WHEQ 1                                                             233712
     C           WLTAX     OREQ 0                                                             234813
     C                     Z-ADD@@TAXA    @@TAXA                                              233712
     C           TCTXCM    WHEQ 2                                                             233712
     C           WLTAX     MULT @@TOTI    WTAXA  150                                          234813
     C                     DIV  100       WTAXA                                               234813
     C           @@TOTI    SUB  WTAXA     WTAXA                                               234813
     C                     DIV  100       WTAXA                                               234813
     C                     MULT @@TAXR    WTAXA                                               234813
     C           WTAXA     IFLT 0                                                             234813
     C                     Z-ADD0         @@TAXA                                              234813
     C                     ELSE                                                               234813
     C**********           Z-ADD@@TAXA    @@TAXA                                       233712 234813
     C                     Z-ADDWTAXA     @@TAXA                                              234813
     C                     ENDIF                                                              234813
     C           TCTXCM    WHEQ 3                                                             233712
     C           WLTAX     MULT @@TOTI    WTAXA                                               234813
     C                     DIV  100       WTAXA                                               234813
     C           @@TAXA    SUB  WTAXA     WTAXA                                               234813
     C           WTAXA     IFLT 0                                                             234813
     C                     Z-ADD0         @@TAXA                                              234813
     C                     ELSE                                                               234813
     C**********           Z-ADD@@TAXA    @@TAXA                                       233712 234813
     C                     Z-ADDWTAXA     @@TAXA                                              234813
     C                     ENDIF                                                              234813
     C           TCTXCM    WHEQ 4                                                             233712
     C                     Z-ADD0         @@TAXA                                              233712
     C                     ENDSL                                                              233712
      *                                                                                       233712
     C                     ENDIF                                                              233712
      *                                                                                       233712
      ** Write record to SDCSINPD                                                             233712
      *                                                                                       233712
     C                     EXSR CSINSR                                                        233712
      *                                                                                       233712
     C                     ENDIF                                                              233712
     C                     ENDIF                                                              233712
      *                                                                                       233712
     C           @@RTRN    IFEQ 'NOTAX'                                                       233712
     C           @@RTRN    OREQ 'TAXAB'                                                       233712
     C           KJANO     READESDJACCLB                 60                                   233712
     C                     ENDIF                                                              233712
      *                                                                                       233712
      ** If @@RTRN = Last, end loop                                                           233712
      *                                                                                       233712
     C           @@RTRN    IFEQ 'LAST'                                                        233712
     C                     MOVE *ON       *IN60                                               233712
     C                     ENDIF                                                              233712
      *                                                                                       233712
     C                     ENDDO                                                              233712
      *                                                                                       233712
     C                     ENDSL                                                              233712
      *                                                                                       233712
     C           ENDMTX    ENDSR                                                              233712
      *****************************************************************                       233712
      /EJECT                                                                                  233712
      *****************************************************************                       233712
      *                                                               *                       233712
      *  CSINSR - Subroutine to Calculate Tax Amounts for PF/POSETD   *                       233712
      *                                                               *                       233712
      *****************************************************************                       233712
      *                                                                                       233712
     C           CSINSR    BEGSR                                                              233712
      *                                                                                       233712
      ** Get Customer Status                                                                  233712
      *                                                                                       233712
     C                     SELEC                                                              233712
     C           @@STAT    WHEQ 'DISCL'                                                       233712
     C                     MOVEL'D'       TSSTAT  1                                           233709
     C           @@STAT    WHEQ 'SELF'                                                        233712
     C                     MOVEL'S'       TSSTAT                                              233712
     C           @@STAT    WHEQ 'TAXAB'                                                       233712
     C                     MOVEL'T'       TSSTAT                                              233712
     C                     ENDSL                                                              233712
     C                     MOVEL@@OCCY    TSOCCY  3                                           233709
      *                                                                                       233709
      ** Get Original Spot Rate                                                               233712
      *                                                                                       233712
     C                     CALL 'AOCURRR0'                                                    233712
     C                     PARM *BLANKS   @RTCD   7                                           233712
     C                     PARM '*KEY   ' @OPTN   7                                           233712
     C                     PARM TSOCCY    @AJCD   3                                           233712
     C           SDCURR    PARM SDCURR    DSSDY                                               233712
     C           @RTCD     IFNE *BLANKS                                                       233712
     C                     Z-ADD29        DBASE                                               233712
     C                     MOVEL'SDCURRPD'DBFILE                                              233712
     C                     MOVELTSOCCY    DBKEY                                               233712
     C                     EXSR *PSSR                                                         233712
     C                     ENDIF                                                              233712
     C           A6MDIN    IFEQ 'D'                                                           233712
     C                     MOVELA6SPRT    TSOCSR                                              233712
     C                     ELSE                                                               233712
     C           1         DIV  A6SPRT    TSOCSR 138H                                         233709
     C                     ENDIF                                                              233712
      *                                                                                       233712
     C                     MOVEL'D'       TSOCMD  1                                           233709
     C                     MOVELA6NBDP    TSOCDP  10                                          233709
     C                     MOVELTSOCCY    TSSCCY  3                                           233709
     C                     MOVELTSOCSR    TSSCSR 138                                          233709
     C                     MOVELTSOCMD    TSSCMD  1                                           233709
     C                     MOVELTSOCDP    TSSCDP  10                                          233709
     C                     MOVEL@@TXCY    TSTXCY  3                                           233709
      *                                                                                       233712
      ** Get Currency Spot Rate                                                               233712
      *                                                                                       233712
     C                     CALL 'AOCURRR0'                                                    233712
     C                     PARM *BLANKS   @RTCD   7                                           233712
     C                     PARM '*KEY   ' @OPTN   7                                           233712
     C                     PARM TSTXCY    @AJCD   3                                           233712
     C           SDCURR    PARM SDCURR    DSSDY                                               233712
     C           @RTCD     IFNE *BLANKS                                                       233712
     C                     Z-ADD29        DBASE                                               233712
     C                     MOVEL'SDCURRPD'DBFILE                                              233712
     C                     MOVELTSTXCY    DBKEY                                               233712
     C                     EXSR *PSSR                                                         233712
     C                     ENDIF                                                              233712
     C           A6MDIN    IFEQ 'D'                                                           233712
     C                     MOVELA6SPRT    TSTCSR 138                                          233709
     C                     ELSE                                                               233712
     C           1         DIV  A6SPRT    TSTCSR    H                                         233712
     C                     ENDIF                                                              233712
      *                                                                                       233712
     C                     MOVEL'D'       TSTCMD  1                                           233709
     C                     MOVELA6NBDP    TSTCDP  10                                          233709
      *                                                                                       233712
      ** Get Orig/Settlement Cross Rate                                                       233712
      *                                                                                       233712
     C                     Z-ADDTSOCSR    ZRATE1                                              233712
     C                     MOVE TSOCMD    ZMDI1                                               233712
     C                     Z-ADDTSSCSR    ZRATE2                                              233712
     C                     MOVE TSSCMD    ZMDI2                                               233712
     C                     EXSR ZXRATE                                                        233712
     C                     Z-ADDZRATEX    TSXROS 138                                          233709
     C                     MOVE ZMDIX     TSOSMD  1                                           233709
      *                                                                                       233712
      ** Get Settlement/Tax Currency Exchange Rate                                            233712
      *                                                                                       233712
     C                     Z-ADDTSSCSR    ZRATE1                                              233712
     C                     MOVE TSSCMD    ZMDI1                                               233712
     C                     Z-ADDTSTCSR    ZRATE2                                              233712
     C                     MOVE TSTCMD    ZMDI2                                               233712
     C                     EXSR ZXRATE                                                        233712
     C                     Z-ADDZRATEX    TSXRST 138                                          233709
     C                     MOVE ZMDIX     TSSTMD  1                                           233709
      *                                                                                       233712
      ** The following fields are calculated when the customer status = T only.               233712
      *                                                                                       233712
     C                     Z-ADD*ZERO     TSTXSR 150                                          233709
     C           TSSTAT    IFEQ 'T'                                                           233712
     C                     Z-ADD@@TAXA    TSTXSR                                              233712
      *                                                                                       233712
      *                                                                                       233712
     C           TSOCCY    IFEQ TSSCCY                                                        233712
     C                     Z-ADD@@TAXA    TSTXSS 150                                          233709
      *                                                                                       233712
     C                     ELSE                                                               233712
      *                                                                                       233712
     C                     Z-ADD@@TAXA    ZAMTF                                               233712
     C                     Z-ADDTSXROS    ZCRSRT                                              233712
     C                     MOVE TSOSMD    ZCRSMD                                              233712
     C                     Z-ADDTSOCDP    ZCDPF                                               233712
     C                     Z-ADDTSSCDP    ZCDPT                                               233712
     C                     EXSR ZCCYXR                                                        233712
     C                     Z-ADDZAMTT     TSTXSS                                              233712
     C                     ENDIF                                                              233712
      *                                                                                       233712
      *                                                                                       233712
     C           TSSCCY    IFEQ TSTXCY                                                        233712
     C                     Z-ADDTSTXSS    TSTXSC 150                                          233709
      *                                                                                       233712
     C                     ELSE                                                               233712
      *                                                                                       233712
     C                     Z-ADDTSTXSS    ZAMTF                                               233712
     C                     Z-ADDTSXRST    ZCRSRT                                              233712
     C                     MOVE TSSTMD    ZCRSMD                                              233712
     C                     Z-ADDTSSCDP    ZCDPF                                               233712
     C                     Z-ADDTSTCDP    ZCDPT                                               233712
     C                     EXSR ZCCYXR                                                        233712
     C                     Z-ADDZAMTT     TSTXSC                                              233712
     C                     ENDIF                                                              233712
      *                                                                                       233712
     C                     ADD  TSTXSR    TXNM                                                233709
     C                     ADD  TSTXSS    TXST                                                233709
     C                     ADD  TSTXSC    TAXA                                                233709
     C                     MOVE TSTXCY    TXCY                                                233709
     C                     ENDIF                                                              233712
      *                                                                                       233712
     C                     ENDSR                                                              233712
     C*****************************************************************
     C/EJECT
     C*****************************************************************   S01496
     C*                                                               *   S01496
     C*  ZSETAC SR. TO DETERMINE SETTLEMENT ACCOUNT                   *   S01496
     C*                                                               *   S01496
     C*  INPUT  FIELDS                                                *   S01496
     C*       ZMETH  2,0     SETTLEMENT METHOD                        *   S01496
     C********ZSETI**12A*****SETTLEMENT ACCOUNT************************                S01496 CGL029
      **      ZSETI  18A     SETTLEMENT ACCOUNT                       *                       CGL029
     C*       ZCNUM  6,0     TRANSACTION CUSTOMER NUMBER              *   S01496
     C*       ZCCY    3A     TRANSACTION CURRENCY                     *   S01496
     C*       ZBRCA   3A     SETTLEMENT BRANCH                        *   085862
     C*                                                               *   S01496
     C*  OUTPUT  FIELDS                                               *   S01496
     C********ZSETO**18A*****SETTLEMENT*ACCOUNT************************                S01496 CGL029
      **      ZSETO  24A     SETTLEMENT ACCOUNT                       *                       CGL029
     C*       ZPTFR   4A     PORTFOLIO OF SETTLEMENT ACCOUNT          *   S01496
     C*                                                               *   S01496
     C*****************************************************************   S01496
     C*                                                                   S01496
     C           ZSETAC    BEGSR                           *** ZSETAC *** S01496
     C*                                                                   S01496
     C** Define all fields                                                S01496
     C*                                                                   S01496
     C                     Z-ADDZMETH     ZMETH   20                      S01496
     C**********           MOVE ZSETI     ZSETI  12                                    S01496 CGL029
     C                     MOVE ZSETI     ZSETI  18                                           CGL029
     C**********           Z-ADDZCNUM     ZCNUM   60                                   S01496 CSD027
     C                     MOVE ZCNUM     ZCNUM   6                                           CSD027
     C                     MOVE ZCCY      ZCCY    3                       S01496
     C                     MOVE ZBRCA     ZBRCA   3                       085862
     C                     MOVE ZPTFR     ZPTFR   4                       S01496
     C**********           MOVE ZSETO     ZSETO  18                                    S01496 CGL029
     C                     MOVE ZSETO     ZSETO  24                                           CGL029
     C*                                                                   S01496
     C** If Settlement Method '04' set up account code in form            S01496
     C***AAAAAA-BBB-CCCC-DD*where:*************************************                S01496 CGL029
      ** AAAAAA-BBB-CCCCCCCCCC-DD where:                                                      CGL029
     C**   AAAAAA = Customer number                                       S01496
     C**   BBB    = Transaction currency                                  S01496
     C*****CCCC***=*Prime*current*account******************************                S01496 CGL029
      **   CCCCCCCCCC   = Prime Current Account                                               CGL029
     C**   DD     = Starting account sequence '01'                        S01496
     C                     MOVE ZBRCA     ZWBRCA                          085862
     C*                                                                   S01496
     C           ZMETH     IFEQ 04                                        S01496
     C                     MOVE ZCNUM     ZWCNUM                          S01496
     C                     MOVE ZCCY      ZWCCY                           S01496
     C                     MOVE BMACCD    ZWACOD                          S01496
     C                     MOVE ZBRCA     ZWBRCA                          085862
     C                     MOVE '01'      ZWACSQ                          S01496
     C                     END                                            S01496
     C*                                                                   S01496
     C** If Settlement Method '05' set up account code in form            S01496
      ** AAAAAA-BBB-CCCCCCCCCC-DD where:                                                      CGL029
      **   AAAAAA       = Customer Number                                                     CGL029
      **   BBB          = Transaction Currency                                                CGL029
      **   CCCCCCCCCC   = Account Code                                                        CGL029
      **   DD           = Account Sequence                                                    CGL029
     C***AAAAAA-BBB-CCCC-DD where:*************************************                S01496 CGL029
     C*****AAAAAA*=*Bytes*1*-*6*of*parameter*ZSETI*********************                S01496 CGL029
     C*****BBB****=*Transaction*currency*******************************                S01496 CGL029
     C*****CCCC***=*Bytes*7*-*10*of*parameter*ZSETI********************                S01496 CGL029
     C*****DD*****=*Bytes*7*-*11*unt*sequence*'01'*********************                S01496 CGL029
     C*                                                                   S01496
     C           ZMETH     IFEQ 05                                        S01496
     C                     MOVELZSETI     ZWCNUM                          S01496
     C                     MOVE ZCCY      ZWCCY                           S01496
     C**********           MOVELZSETI     ZWWORK 10                                    S01496 CGL029
     C                     MOVELZSETI     ZWWORK 16                                           CGL029
     C                     MOVE ZWWORK    ZWACOD                          S01496
     C                     MOVE ZSETI     ZWACSQ                          S01496
     C                     MOVE ZBRCA     ZWBRCA                          085862
     C                     END                                            S01496
     C*                                                                   S01496
     C** If Settlement Method '15' set up account code in form            S01496
     C***AAAAAA-BBB-CCCC-DD*where:*************************************                S01496 CGL029
      ** AAAAAA-BBB-CCCCCCCCCC-DD where:                                                      CGL029
     C**   AAAAAA = Customer number parameter                             S01496
     C**   BBB    = Transaction currency                                  S01496
     C*****CCCC***=*Customer*SE*Settlement*account*code*from*SDSECSPD**                S01496 CGL029
      **   CCCCCCCCCC   = Customer SE Sett. A/C from SDSECSPD                                 CGL029
     C**   DD     = Customer SE Settlement account sequence from SDSECSPD S01496
     C*                                                                   S01496
     C           ZMETH     IFEQ 15                         B1             S01496
     C                     MOVE ZCNUM     ZWCNUM                          S01496
     C                     MOVE ZCCY      ZWCCY                           S01496
     C                     MOVE ZBRCA     ZWBRCA                          085862
     C*                                                                   S01496
     C** On change of customer number access SE customer details          S01496
     C*                                                                   S01496
     C           ZCNUM     IFNE ZSECNU                     B2             S01496
     C                     MOVE ZCNUM     ZWCNUA  6                       S01496
     C*                                                                   S01496
     C                     CALL 'AOSECSR0'                                S01496
     C                     PARM *BLANKS   WLRTCD                          S01496
     C                     PARM '*KEY  '  WLOPTN                          S01496
     C                     PARM ZWCNUA    WLCUSN  6                       S01496
     C           SDSECS    PARM SDSECS    DSSDY                           S01496
     C*                                                                   S01496
     C           WLRTCD    IFNE *BLANKS                    B3             S01496
     C                     Z-ADD102       DBASE            ***************S01496
     C                     MOVE 'SDSECSPD'DBFILE           * DBERROR 102 *S01496
     C                     MOVELZWCNUA    DBKEY            ***************S01496
     C                     EXSR *PSSR                                     S01496
     C                     END                             E3             S01496
     C*                                                                   S01496
     C**********           Z-ADDZCNUM     ZSECNU  60                                   S01496 CSD027
     C                     MOVE ZCNUM     ZSECNU  6                                           CSD027
     C                     END                             E2             S01496
     C*                                                                   S01496
     C                     MOVE BFACCD    ZWACOD                          S01496
     C                     MOVE BFACSN    ZWACSQ                          S01496
     C                     END                             E1             S01496
     C*                                                                   S01496
     C** If Settlement Method 14 use account number passed to access      S01496
     C** LF/ACNUM                                                         S01496
     C*                                                                   S01496
     C           ZMETH     IFEQ 14                         B1             S01496
     C                     MOVELZSETI     ZWACNO 100                      S01496
     C           ZWACNO    CHAINACNUM                99                   S01496
     C**********           Z-ADDZRCNUM    ZWCNUM                                       S01496 CSD027
     C                     MOVE ZRCNUM    ZWCNUM                                              CSD027
     C                     MOVE ZRCCY     ZWCCY                           S01496
     C                     Z-ADDZRACOD    ZWACOD                          S01496
     C                     Z-ADDZRACSQ    ZWACSQ                          S01496
     C                     MOVE ZRBRCA    ZWBRCA                          S01496
     C                     END                             E1             S01496
     C*                                                                   S01496
     C** If Settlement Method 04, 05 OR 15 use account set up above       S01496
     C*                                                                   S01496
     C           ZMETH     IFEQ 04                         B1             S01496
     C           ZMETH     OREQ 05                                        S01496
     C           ZMETH     OREQ 15                                        S01496
     C           ZWACCN    CHAINACCNT                99                   S01496
     C                     END                             E1             S01496
     C*                                                                   S01496
     C** If account found set portfolio reference to reference from       S01496
     C** account                                                          S01496
     C*                                                                   S01496
     C           *IN99     IFEQ '0'                                       S01496
     C                     MOVE ZRPTFR    ZPTFR                           S01496
     C                     MOVE ZKACCN    ZSETO                           S01496
     C*                                                                   S01496
     C** ... otherwise blank                                              S01496
     C*                                                                   S01496
     C                     ELSE                                           S01496
     C                     MOVE *BLANKS   ZPTFR                           S01496
     C                     MOVE *BLANKS   ZSETO                           S01496
     C                     END                                            S01496
     C*                                                                   S01496
     C                     ENDSR                                          S01496
     C*****************************************************************   S01496
     C/EJECT                                                              S01496
     C/COPY WNCPYSRC,SE6720C004
     C*****************************************************************
     C*  ZCONV  -CONVERT AMOUNT IN ONE CURRENCY TO ANOTHER            *
     C*****************************************************************
     C*
     C/COPY ZSRSRC,ZCONVZ1                                                S01496
     C*                                                                   S01496
     C***********ZCONV     BEGSR                                          S01496
     C***********                                                         S01496
     C***********          Z-ADDZAMTCI    ZAMTCI 150                      S01496
     C***********          Z-ADD0         ZAMTCO 150                      S01496
     C***********                                                         S01496
     C***Currency*from*************************************************   S01496
     C***********          MOVE ZCCYI     ZCCYF                           S01496
     C***********ZCCYF     CHAINSDCURRL1             89                   S01496
     C************IN89     IFEQ '1'                                       S01496
     C***********          MOVEL'SDCURRL1'DBFILE           ***************S01496
     C***********          MOVELZCCYF     DBKEY            ** DB ERROR 12 S01496
     C***********          Z-ADD12        DBASE            ***************S01496
     C***********          EXSR *PSSR                                     S01496
     C***********          ENDIF                                          S01496
     C***********                                                         S01496
     C***********          MOVE A6SPRT    ZRATEF                          S01496
     C***********          MOVE A6MDIN    ZMDINF                          S01496
     C***********          MOVE A6NBDP    ZCDPF                           S01496
     C***********                                                         S01496
     C***Currency*to***************************************************   S01496
     C***********          MOVE ZCCYO     ZCCYT                           S01496
     C***********ZCCYT     CHAINSDCURRL1             89                   S01496
     C************IN89     IFEQ '1'                                       S01496
     C***********          MOVEL'SDCURRL1'DBFILE           ***************S01496
     C***********          MOVELZCCYT     DBKEY            ** DB ERROR 13 S01496
     C***********          Z-ADD13        DBASE            ***************S01496
     C***********          EXSR *PSSR                                     S01496
     C***********          ENDIF                                          S01496
     C***********                                                         S01496
     C***********          MOVE A6SPRT    ZRATET                          S01496
     C***********          MOVE A6MDIN    ZMDINT                          S01496
     C***********          MOVE A6NBDP    ZCDPT                           S01496
     C***********                                                         S01496
     C***Amount*from***************************************************   S01496
     C***********          Z-ADDZAMTCI    ZAMTF                           S01496
     C***********                                                         S01496
     C***********          EXSR ZCCYCN                                    S01496
     C***********                                                         S01496
     C***********          Z-ADDZAMTT     ZAMTCO                          S01496
     C***********                                                         S01496
     C***********          ENDSR                                          S01496
     C*****************************************************************
     C/COPY WNCPYSRC,SE6720C005
      /EJECT
     C*****************************************************************
     C*                                                               *
     C*  MIDAS STANDARD SUBROUTINE                                *
     C*                                                               *
     C*  ZA0830 - THIS SUBROUTINE FINDS OUT WHETHER A PARTICULAR DAY  *
     C*           IS A HOLIDAY IN A PARTICULAR CURRENCY               *
     C*                                                               *
      *  (c) Finastra International Limited 2001                      *
     C*                                                               *
     C*  LAST AMEND NO. E22098             DATE 14MAY90               *
     C*                                                               *
     C*****************************************************************
     C*                                                               *
     C*  E22098  -  CREATION PARAMETERS PHYSICALLY REMOVED AND        *
     C*             HEADER BOX ADDED.                                 *
     C*                                                               *
     C***********************************************************************
     C*                                                                     *
     C* CALLED BY :                                                         *
     C*                                                                     *
     C* CALLS :                                                             *
     C*                                                                     *
     C* INPUT  : @@MNO  MIDAS DAY NUMBER 5N                                 *
     C*          @@CCY  CURRENCY CODE 3A                                    *
     C*                                                                     *
     C* OUTPUT : @@HIND HOLIDAY/WORKING DAY INDICATOR 1A                    *
     C*                                                                     *
     C* USES :   @@MNO  MIDAS DAY NUMBER                                    *
     C*          @@CCY  CURRENCY CODE                                       *
     C*          @@ONCE FIRST TIME THROUGH INDICATOR                        *
     C*          @@CY1  FIRST HALF OF CURRENCY ARRAY                        *
     C*          @@CY2  SECOND HALF OF CURRENCY ARRAY                       *
     C*          @@MNO6 MIDAS NUMBER WITH TRAILING BLANK                    *
     C*          @@HIND HOLIDAY/WORKING DAY INDICATOR                       *
     C*          @@INEX INCLUDE/EXCLUDE INDICATOR                           *
     C*                                                                     *
     C*          INDICATORS                                                 *
     C*          80 RECORD NOT FOUND                                        *
     C*          81 CURRENCY NOT FOUND ON RECORD                            *
     C*                                                                     *
     C***********************************************************************
     C***        ZA0830    BEGSR                                         64743
     C*
     C** OPEN CURRENCY/HOLIDAY FILE IF FIRST TIME THROUGH                 64743
     C***        @@ONCE    IFNE 'Y'                        B1             64743
     C***                  OPEN FDTABJLL                   *1             64743
     C***                  MOVE 'Y'       @@ONCE  1        *1             64743
     C***                  END                             E1             64743
     C*                                                                   64743
     C** BLANK OUT ARRAY                                                  64743
     C***                  MOVE *BLANKS   @@CY1                           64743
     C***                  MOVE *BLANKS   @@CY2                           64743
     C*                                                                   64743
     C** ACCESS TABLE ON FIRST KEY                                        64743
     C***                  MOVEL@@MNO     @@MNO6  6                       64743
     C***                  MOVE @@MNO6    @@0830 12                       64743
     C***                  MOVEL'22    '  @@0830                          64743
     C***                  MOVE '1'       @@0830                          64743
     C***        @@0830    CHAINTABLETJF             80                   64743
     C*                                                                   64743
     C** IF RECORD NOT FOUND OR DELETED                                   64743
     C***        *IN80     IFEQ '1'                        B1             64743
     C***        RECI      OREQ '*'                        *1             64743
     C***                  MOVE 'W'       @@HIND           *1             64743
     C***                  GOTO ZA0839                     *1             64743
     C***                  END                             E1             64743
     C*                                                                   64743
     C** MOVE FIRST 25 CURRENCIES TO ARRAY                                64743
     C***                  MOVE HCCY      @@CY1                           64743
     C*                                                                   64743
     C** ACCESS TABLE ON SECOND KEY                                       64743
     C***                  MOVE '2'       @@0830                          64743
     C***        @@0830    CHAINTABLETJF             80                   64743
     C*                                                                   64743
     C** IF SECOND RECORD FOUND AND NOT DELETED                           64743
     C***        *IN80     IFEQ '0'                        B1             64743
     C***        RECI      ANDNE'*'                        *1             64743
     C***                  MOVE HCCY      @@CY2            *1             64743
     C***                  END                             E1             64743
     C*                                                                   64743
     C** SEARCH ARRAY FOR INPUT CURRENCY                                  64743
     C***        @@CCY     LOKUP@CY                      81               64743
     C*                                                                   64743
     C** IF INPUT CURRENCY IS IN ARRAY                                    64743
     C***        *IN81     IFEQ '1'                        B1             64743
     C*                                                                   64743
     C** IF INCLUDE/EXCLUDE INDICATOR EQ 'E'                              64743
     C***        INEX      IFEQ 'E'                        B*2            64743
     C***                  MOVE 'W'       @@HIND  1        **2            64743
     C***                  ELSE                            X*2            64743
     C***                  MOVE 'H'       @@HIND           **2            64743
     C***                  END                             E*2            64743
     C***                  END                             E1             64743
     C*                                                                   64743
     C** IF INPUT CURRENCY IS NOT IN ARRAY                                64743
     C***        *IN81     IFEQ '0'                        B1             64743
     C*                                                                   64743
     C** IF INCLUDE/EXCLUDE INDICATOR EQ 'I'                              64743
     C***        INEX      IFEQ 'I'                        B*2            64743
     C***                  MOVE 'W'       @@HIND           **2            64743
     C***                  ELSE                            X*2            64743
     C***                  MOVE 'H'       @@HIND           **2            64743
     C***                  END                             E*2            64743
     C***                  END                             E1             64743
     C***        ZA0839    ENDSR                                          64743
     C**************************************************************************
      /EJECT
     C**************************************************************************
     C*                                                                        *
     C*  ZAPNUM - CALCULATE AP NUMERATOR                                       *
     C*                                                                        *
     C*  PURPOSE : TO MULTIPLY A NOMINAL POSITION BY THE PRICE OF THE          *
     C*  POSITION TO GIVE A VALUE OF THE POSITION WITH THE CORRECT NUMBER      *
     C*  OF DECIMAL PLACES FOR THE NOMINAL CURRENCY                            *
     C*                                                                        *
     C*  INPUT  FIELDS                                                         *
     C********ZNOML**11 0*****NOMINAL                                     S10978
     C*       ZNOML  15 0     NOMINAL                                     S10978
     C*       ZAVPR  15 8     AVERAGE PRICE                                    *
     C*       ZNMDP   1 0     NOMINAL DECIMAL PLACES (0-4)                     *
     C*       ZNMCD   1 0     NOMINAL CURRENCY DECIMAL PLACES (0-3)            *
     C*       ZPRCB   1 A     PRICE BASIS (P/U)                                *
     C*                                                                        *
     C*  OUTPUT  FIELDS                                                        *
     C*       ZVALU  15 0     VALUE                                            *
     C*                                                                        *
     C*  ALSO REQUIRED                                                         *
     C*       POWER8 ARRAY OF MULTIPLYING FACTORS FOR NOMINAL DECIMAL PLACES   *
     C*                                                                        *
     C*  WORK FIELDS:                                                          *
     C*       ZVAL0  15 0 - AVERAGE PRICE WITH 0 DECIMAL PLACES                *
     C*       ZVAL1  15 1 - --------------- '' ----------------                *
     C*       ZVAL2  15 2 - --------------- '' ----------------                *
     C*       ZVAL3  15 3 - --------------- '' ----------------                *
     C*       ZI      1 0 - POWER ARRAY                                        *
     C*                                                                        *
     C*  CALLED FROM:                                                          *
     C*                                                                        *
     C*************************************************************************
     C           ZAPNUM    BEGSR                           *** ZAPNUM ***
     C*
     C** DEFINE ALL FIELDS
     C**********           Z-ADDZNOML     ZNOML  110                      S10978
     C                     Z-ADDZNOML     ZNOML  150                      S10978
     C                     Z-ADDZAVPR     ZAVPR  158
     C                     Z-ADDZNMDP     ZNMDP   10
     C                     Z-ADDZNMCD     ZNMCD   10
     C                     MOVE ZPRCB     ZPRCB   1
     C                     Z-ADDZVALU     ZVALU  150
     C*
     C** IF NUMBER OF CURRENCY DECIMAL PLACES I = 0
     C           ZNMCD     IFEQ 0
     C           ZNOML     MULT ZAVPR     ZVAL0  150H
     C                     MOVE ZVAL0     ZVALU
     C                     END
     C*
     C** IF NUMBER OF CURRENCY DECIMAL PLACES I = 1
     C           ZNMCD     IFEQ 1
     C           ZNOML     MULT ZAVPR     ZVAL1  151H
     C                     MOVE ZVAL1     ZVALU
     C                     END
     C*
     C** IF NUMBER OF CURRENCY DECIMAL PLACES I = 2
     C           ZNMCD     IFEQ 2
     C           ZNOML     MULT ZAVPR     ZVAL2  152H
     C                     MOVE ZVAL2     ZVALU
     C                     END
     C*
     C** IF NUMBER OF CURRENCY DECIMAL PLACES I = 3
     C           ZNMCD     IFEQ 3
     C           ZNOML     MULT ZAVPR     ZVAL3  153H
     C                     MOVE ZVAL3     ZVALU
     C                     END
     C*
     C** SET INDEX ZI EQUAL TO 5 -. NOMINAL DECIMAL PLACES )
     C           5         SUB  ZNMDP     ZI      10
     C*
     C** MULTIPLY ZVALU BY  POWER8,ZI TO GET AMOUNT WITH NOMINAL DECIMAL PLACES
     C           ZVALU     MULT POWER8,ZI ZVALU
     C*
     C** PRICE BASIS IF = PERCENTAGE
     C           ZPRCB     IFEQ 'P'
     C           ZVALU     DIV  100       ZVALU     H
     C                     END
     C*
     C                     ENDSR
     C**********************************************************************
      /EJECT                                                                                  CGL020
      *****************************************************************                       CGL020
      *                                                               *                       CGL020
      * SRAMPR - Determine AML Pay/Receive Instructions               *                       CGL020
      *                                                               *                       CGL020
      * Called by: W101, W201                                         *                       CGL020
      *                                                               *                       CGL020
      * Calls: ZAAMLSETSE                                             *                       CGL020
      *                                                               *                       CGL020
      *****************************************************************                       CGL020
      *                                                                                       CGL020
     C           SRAMPR    BEGSR                           ** SRAMPR **                       CGL020
      *                                                                                       CGL020
     C           STLA      IFEQ *BLANKS                                                       CGL020
     C                     MOVE *BLANKS   F1RACT                                              CGL020
     C                     MOVE *BLANKS   F1RCTY                                              CGL020
     C                     MOVE *BLANKS   F1RBNK                                              CGL020
     C                     MOVE *BLANKS   F1RCDE                                              CGL020
     C                     MOVE *BLANKS   F1PACT                                              CGL020
     C                     MOVE *BLANKS   F1PCTY                                              CGL020
     C                     MOVE *BLANKS   F1PBNK                                              CGL020
     C                     MOVE *BLANKS   F1PCDE                                              CGL020
     C                     MOVE *BLANKS   F1DACT                                              CGL020
     C                     MOVE *BLANKS   F1DCTY                                              CGL020
     C                     MOVE *BLANKS   F1DBNK                                              CGL020
     C                     Z-ADD*ZEROS    F1SDAT                                              CGL020
      *                                                                                       CGL020
     C                     ELSE                                                               CGL020
     C                     MOVE *BLANKS   PINTG                                               CGL020
     C                     MOVE *BLANKS   PINTGA                                              CGL020
     C                     MOVE *BLANKS   PINST                                               CGL020
     C                     MOVE *BLANKS   PINSTA                                              CGL020
     C                     MOVE *BLANKS   PBENM                                               CGL020
     C                     MOVE *BLANKS   PBENMA                                              CGL020
     C**********           Z-ADDCSTN      PCUSTN                                       CGL020 CSD027
     C                     MOVE CSTN      PCUSTN                                              CSD027
      *                                                                                       CGL020
     C                     CALL ZAAMLP                                                        CGL020
     C                     PARM           PINTG  10                                           CGL020
     C                     PARM           PINTGA 35                                           CGL020
     C                     PARM           PINST  10                                           CGL020
     C                     PARM           PINSTA 35                                           CGL020
     C                     PARM           PBENM  10                                           CGL020
     C                     PARM           PBENMA 35                                           CGL020
     C                     PARM           PDEBT  10                                           CSW210
     C                     PARM           PDEBTA 35                                           CSW210
     C                     PARM           PCUSTN                                              CGL020
     C                     PARM *BLANKS   PBLANK  8                                           CGL020
     C                     PARM           STLA                                                CGL020
     C                     PARM           SEBR                                                CGL020
     C                     PARM           EVCY                                                CGL020
     C                     PARM           F1RACT                                              CGL020
     C                     PARM           F1RCTY                                              CGL020
     C                     PARM           F1RBNK                                              CGL020
     C                     PARM           F1RCDE                                              CGL020
     C                     PARM           F1PACT                                              CGL020
     C                     PARM           F1PCTY                                              CGL020
     C                     PARM           F1PBNK                                              CGL020
     C                     PARM           F1PCDE                                              CGL020
     C                     PARM           F1DACT                                              CGL020
     C                     PARM           F1DCTY                                              CGL020
     C                     PARM           F1DBNK                                              CGL020
      *                                                                                       CGL020
     C                     ENDIF                                                              CGL020
      *                                                                                       CGL020
     C                     Z-ADDEVDT      F1SDAT                                              CGL020
     C                     MOVE *BLANKS   F1TICK                                              CGL020
     C                     MOVE *BLANKS   F1EXCH                                              CGL020
     C                     MOVE *ZEROS    F1NOML                                              CGL020
      *                                                                                       CGL020
     C                     ENDSR                                                              CGL020
      *                                                                                       CGL020
      ********************************************************************                    CGL020
     C/COPY WNCPYSRC,SE6720C006
      /EJECT
     C**********************************************************************
     C**   SR/ZCCAL1 TO CALCULATE CHARGES/COMMISSIONS
     C**
     C/COPY ZSRSRC,ZCCAL1Z2
     C**********************************************************************
      /EJECT
     C**********************************************************************
     C**   SR/ZCCAL2 TO CALCULATE CHARGES/COMMISSIONS
     C**
     C/COPY ZSRSRC,ZCCAL2Z1
     C**********************************************************************
      /EJECT
     C**********************************************************************
     C**   SR/ZCCYCN TO CONVERT AMOUNT IN CCY1 TO CCY2
     C**
     C/COPY ZSRSRC,ZCCYCN
     C/COPY ZSRSRC,ZCCYXR                                                                     233712
     C**********************************************************************
      /EJECT
     C**********************************************************************
     C**   SR/ZEVCD TO ACCESS EVENT CONTROL DATE
     C**
     C/COPY ZSRSRC,ZEVCDZ1
     C**********************************************************************
      /EJECT
     C**********************************************************************
     C**   SR/ZHASH
     C**
     C/COPY ZSRSRC,ZHASHZ3
     C**********************************************************************
      /EJECT
     C**********************************************************************
     C*****SR/ZSETAC***************************************************   S01496
     C***********                                                         S01496
     C***/COPY*ZSRSRC,ZSETAC                                              S01496
     C**********************************************************************
      /EJECT
     C**********************************************************************
     C**   SR/ZTNLU1
     C**
     C/COPY ZSRSRC,ZTNLU1Z2
     C**********************************************************************
      /EJECT
     C********************************************************************CH0273
     C**   SR/ZXRATE                                                      CH0273
     C**                                                                  CH0273
     C/COPY ZSRSRC,ZXRATEZ1                                               CH0273
     C********************************************************************CH0273
     C/COPY ZSRSRC,ZICD2Z1                                                101626
      /COPY ZSRSRC,ZPOWER8Z2
**  POWER - ARRAY OF POWERS FOR CURRENCY CONVERSION
0000001
0000010
0000100
0001000
0010000
0100000
1000000
**  CPY@
(c) Finastra International Limited 2001
