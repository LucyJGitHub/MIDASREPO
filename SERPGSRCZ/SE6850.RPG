     H        1
      *****************************************************************
/*STD *  RPGBASE                                                      *
/*EXI *  TEXT('Midas SE Early Redemptions Confirmations')             *
     F*****************************************************************
     F*                                                               *
     F*  Midas - Securities Trading Module                            *
     F*                                                               *
     F*  SE6850 - SE Early Redemptions Confirmations                  *
     F*                                                               *
      *  (c) Misys International Banking Systems Ltd. 2001            *
     F*                                                               *
      *  Last Amend No. CER070             Date 19Aug14               *
      *  Prev Amend No. CLE134             Date 01Aug12               *
      *                 CER059             Date 19Jul10               *
      *                 CER045             Date 20Jul09               *
      * Bank Fusion Midas 1.4 Base -----------------------------------*
      * Midas Plus 1.4 Base 04 ---------------------------------------*
      *                 CRE026             Date 24May06               *
      * Midas Plus 1.3 ----------- Base ------------------------------*
      *                 CSD031             Date 10Apr06               *
      *                 CSD027             Date 09Dec05               *
      *                 BUG10701           Date 27Feb06               *
      *                 CSE071             Date 19Jul05               *
      *                 CSW037A            Date 02May05               *
      *                 CSD025             Date 11Jan05               *
      *                 CSW037             Date 15Dec04               *
      *                 CSW036             Date 15Dec04               *
      *                 CLE025             Date 20Oct03               *
      *                 CGL029             Date 01Sep03               *
      * Midas Release 4 --------------- Base -------------------------*
      * Midas DBA 3.03 -----------------------------------------------*
      * Midas DBA 3.00 ---------------- Base -------------------------*
      *                 166533             Date 26Aug99               *
      *                 S01496             Date 13Oct94               *
     F*                 68343              DATE 25MAR94               *
     F*                 CA9301             DATE 24FEB94               *
     F*                 S10978             DATE 22JUN93               *
     F*                                                               *
     F*---------------------------------------------------------------*
     F*                                                               *
      *  CER070 - BuBa Reporting / BAIS V.1.16.0 (Recompile)          *
      *  CLE134 - Past Due Call Loan Processing (Recompile)           *
      *  CER059 - German Feature Upgrade to Delhi                     *
      *  CER045 - German Features - Reporting Bundesbank (Recompile)  *
      *  CRE026 - Consumer Banking (Recompile)                        *
      *  CSD031 - Enhanced Centralised Static Data (Recompile)        *
      *  CSD027 - Conversion Of Customer Number to Alpha              *
      *  BUG10701 - SDACUSL0 clashes with SE6850P1                    *
      *  CSE071 - Multiple Holidays Re Securities (recompile)         *
      *  CSW037A- Additional Field extended to 40 chars (recompile)   *
      *  CSD025 - Customer De-Activation                              *
      *  CSW037 - Additional Field Data on MT300/MT320                *
      *  CSW036 - Dual SWIFT BIC held on Client Details               *
      *  CLE025 - Credit Lines (Recompile)                            *
      *  CGL029 - Increase Account Code to 10 digits                  *
     F*  166533 - Check ZDAYNO for Y2K not ZYEAR.                     *
     F*  S01496 - Incorporation of JYSKE Enhancements (S10978)        *
     F*  68343  - CORRECT DECIMAL PLACES FOR REDEMPTION PRICE         *
     F*  CA9301 - NEW LAYOUT FOR CONFIRMATIONS FOR JYSKE BANK ZURICH  *
     F*  S10978 - JYSZRH: EARLY REDEMPTIONS                           *
     F*                                                               *
     F*****************************************************************
     F*                                                               *
     F*  C R E A T I O N     P A R A M E T E R S                      *
     F*                                                               *
     F*                                                               *
     F*****************************************************************
      /EJECT
     F*
     F*****BJ*-*Bank*Details*-*Rtv*Idx*********************************   S01496
     F***SDBANKL1IF**E           K        DISK                            S01496
     F***********                                   KINFSR *PSSR          S01496
     F*
     F**Extension*File*************************************************   S01496
     F***SDCUSTX0IF**E           K        DISK         KINFSR *PSSR       S01496
     F*
     F**Account*Officer*Details****************************************   S01496
     F***SDACOFL1IF**E           K        DISK         KINFSR *PSSR       S01496
     F*
     F**Customer*Details***********************************************   S01496
     F***SDCUSTL0IF**E           K        DISK         KINFSR *PSSR       S01496
     F*                                                                   S01496
     F**  Additional Customer Details                                     S01496
     FSDACUSL0IF  E           K        DISK         KINFSR *PSSR          S01496
     F*
     F* Securities Details
     FSECTY   IF  E           K        DISK         KINFSR *PSSR
     F*                                                                   CA9301
     F* Investment type                                                   CA9301
     FINVTP   IF  E           K        DISK         KINFSR *PSSR          CA9301
     F*
     F**Customer*Details***********************************************   S01496
     F***CLINT***IF**E           K        DISK         KINFSR *PSSR       S01496
     F*
     F**Currencies*Details*********************************************   S01496
     F***SDCURRL0IF**E           K        DISK         KINFSR *PSSR       S01496
     F*
     F* Alternate Names and Addresses
     FSDALTNL1IF  E           K        DISK         KINFSR *PSSR
     F*
     F**VA*-*SE*Early*Redemptions*References*-*Rtv*Idx*****************   S01496
     F***SEERRFL2IF**E           K        DISK                            S01496
     F**  SE ER Confirmations Extract File                                S01496
     FSEERCEL0IF  E           K        DISK                               S01496
     F                                              KINFSR *PSSR
     F* VA - SE Early Redemptions References - Upd Idx
     FSEERRFL1UF  E           K        DISK
     F            SEERRFD0                          KRENAMESEERRFD1
     F                                              KINFSR *PSSR
     F                                              KCOMIT
     F*
     F* VC - SE Early Redemptions Allocation - Upd Idx
     FSEERALL0UF  E           K        DISK
     F                                              KINFSR *PSSR
     F                                              KCOMIT
     F*
     F* Printer file - SE Early Redemptions Confirmations
     F***SE6850P3O***E                    PRINTER                      UC S01496
     FSE6850P1O   E                    PRINTER      KINFDS SPOOL      UC  S01496
     F                                              KINFSR *PSSR          S01496
     F*
     F**Printer*file*-*SE*Early*Redemptions*Confirmations**************   S01496
     F***SE685HM3O***E                    PRINTER                      UC S01496
     F** Printer file - SE Early Redemptions Confirmations Audit          S01496
     FSE6850AUO   E                    PRINTER      KINFDS SPOOLU     UC  S01496
     F                                              KINFSR *PSSR          S01496
     F*                                                                   S01496
     F/COPY WNCPYSRC,SE6850F001
     ******************************************************************
      /EJECT
     ******************************************************************
     E*
     E**   FOR COMPILATION - COPYRIGHT INSERTION
     E                    CPY@    1   1 80
     E*
     E                    CMD     1   3 41               QCMDEXC ARRAY
     E*
     E                    ZA1        16  1               ZALIGN/ZEDIT ARRA
     E                    ZA2        16  1               ZALIGN/ZEDIT ARRA
     E*
     E                    AR01       50  1
     E*
     E                    ZYDY    4   4  4 0             ZDATE1/2 SR.ARRAY
     E                    ZMDY   13  13  3 0             ZDATE1/2 SR.ARRAY
     E                    ZMNM   12  12  3               ZDATE2 SR. ARRAY
     E*
     E                    ZS1        15  1 0
     E                    ZS2        21  1
     E*
     E** ARRAY USED IN CURRENCY AMOUNT CONVERSION FOR ZAPNUM
     E                    POWER8  1   8  8 4             POWER8 ARRAY
     E*
     E* HERRN/FRAU/FRAEULEIN/HERREN/MR/MRS/MISS INDICATOR
     E                    IND    32  32  1
     E*
     E* MR/MRS/MISS FOR ADRESS
     E**********          SEA        32 35                                                  BUG10701
     E                    SEA        32 70                                                  BUG10701
     E/COPY WNCPYSRC,SE6850E001
     E*****************************************************************
      /EJECT
     I*****************************************************************
     I*
     I/COPY WNCPYSRC,SE6850I001
     I**   DATA STRUCTURE FOR DATABASE ERROR
     ILDA         DS                            256
     I                                      132 183 WWLOT
     I                                      132 141 WWFILE
     I                                      142 170 WWKEY
     I                                      171 180 WWPGM
     I                                      181 1830WWASE
     I*
     I**  DATA STRUCTURE FOR COMPILATION  - COPYRIGHT INSERTION
     ICPYR@#      DS
     I                                        1  80 CPY@
     I                                        1  20 CPY@##
     I*
     I**  DATE FORMAT DD.MM.YYYY
     I            DS
     I                                        1  10 ZD2000
     I                                        1   2 WWDD
     I                                        3   3 WWPT1
     I                                        4   5 WWMM
     I                                        6   6 WWPT2
     I                                        7   8 WWCC
     I                                        9  10 WWYY
     I                                        1   6 WWC6
     I                                        1   5 WWC5
     I            DS
     I                                        1  150WORK15
     I                                        1  150ZS1
     I            DS
     I****************************************1  43 WWCMD                 S01496
     I***************************************31  32 FILTY                 S01496
     I                                        1  41 WWCMD                 S01496
     I*
     I**   MAIL DETAILS
     I            DS
     I***********                             1   5 CUMAIL                S01496
     I                                        1   5 E5MDTL                S01496
     I                                        1   1 INMRS
     I*                                                                   S01496
     I/COPY WNCPYSRC,SE6850I002
     ISPOOLU      DS                                                      S01496
     I** File Information Data Structure (Audit Report)                   S01496
     I*                                                                   S01496
     I                                       83  92 SFILEU                S01496
     I                                    B 123 1240SFNUMU                S01496
     ISPOOL       DS                                                      S01496
     I** File Information Data Structure (Detail Report)                  S01496
     I*                                                                   S01496
     I                                       83  92 SFILE                 S01496
     I                                    B 123 1240SFNUM                 S01496
     I*                                                                   S01496
     IRUNDAT    E DS                                                      S01496
     I**  Standard Data Area Layout for System flags and Run Date         S01496
     I*                                                                   S01496
     I@BANK     E DSSDBANKPD                                              S01496
     I** Dummy record format for access to Bank Details                   S01496
     I*                                                                   S01496
     I@CURR     E DSSDCURRPD                                              S01496
     I** Dummy record format for access to Currency Details               S01496
     I*                                                                   S01496
     I@CUST     E DSSDCUSTPD                                              S01496
     I** Dummy record format for access to Customer Details               S01496
     I*                                                                   S01496
     I@ACOF     E DSSDACOFPD                                              S01496
     I** Dummy record format for access to Account Officer Details        S01496
     I*                                                                   S01496
     I@SARD     E DSSCSARDPD                                              S01496
     I** Dummy record format for access to Alternate Names & Addresses    S01496
     I*                                                                   S01496
     I@BRCH     E DSSDBRCHPD                                              S01496
     I** Dummy record format for access to Branch Details                 S01496
     I*                                                                   S01496
     I              QQDFAC                          ##DFAC                                    CGL029
     IDSFDY     E DSDSFDY                                                 S01496
     I** First DS for access programs, short data structure               S01496
     I*                                                                   S01496
     IDSSDY     E DSDSSDY                                                 S01496
     I** Second DS for access programs, long data structure               S01496
     I*                                                                   S01496
     I*****************************************************************
      /EJECT
     C*****************************************************************
     C*================================================================
     C*  P R O G R A M     S T A R T
     C*================================================================
     C*****************************************************************   S01496
     C** PARAMETER LIST DECLARATIONS                                      S01496
     C*****************************************************************   S01496
     C*                                                                   S01496
     C           *ENTRY    PLIST                                          S01496
     C                     PARM           @RSEQ   5                       S01496
     C                     PARM           @RLEV   1                       S01496
     C                     PARM           @RENT   3                       S01496
     C*                                                                   S01496
     C*****************************************************************
     C** MAIN PROCESSING
     C*****************************************************************
     C*
     C**   INITIAL PROCESSING
     C                     EXSR P001
     C*
     C**   MAIN PROCESSING
     C                     EXSR P002
     C*
     C**   TERMINATION PROCESSING
     C                     EXSR P003
     C*
     ******************************************************************
      /EJECT
     ******************************************************************
     C* P001   : INITIAL PROCESSING                                   *
     ******************************************************************
     C*
     C           P001      BEGSR
     C*                                                                   S01496
     C**  Copyright statement                                             S01496
     C*                                                                   S01496
     C                     MOVEACPY@      ACT@   80                       S01496
     C*                                                                   S01496
     C**  Read in DTAARA/RUNDAT to get multibranching indicator.          S01496
     C*                                                                   S01496
     C           *NAMVAR   DEFN           RUNDAT                          S01496
     C                     IN   RUNDAT                                    S01496
     C*                                                                   S01496
     C**  Set up appropriate level and entity.                            S01496
     C*                                                                   S01496
     C           AGMBIN    IFNE 'Y'                                       S01496
     C                     MOVE 'S'       @RLEV                           S01496
     C                     MOVEL*BLANKS   @RENT                           S01496
     C                     END                                            S01496
     C*
     C***DEFINE*KEY*LIST*FOR*FILE*CLINT********************************   S01496
     C***********KLCLNT    KLIST                                          S01496
     C***********          KFLD           VCCNUM                          S01496
     C***********          KFLD           RCDT                            S01496
     C*                                                                   CA9301
     C*  SET UP KEY TO ACCESS INVTPD FOR PROCESSING TYPE FIELD            CA9301
     C*                                                                   CA9301
     C           KEYFLD    KLIST                                          CA9301
     C                     KFLD           NMCY                            CA9301
     C                     KFLD           SITP                            CA9301
     C*                                                                   CA9301
     C           ALKEY     KLIST                                          S01496
     C                     KFLD           VEERRF                          S01496
     C                     KFLD           VEBRCA                          S01496
     C                     KFLD           VEDDPT                          S01496
     C                     KFLD           VEERTP                          S01496
     C                     KFLD           VEBOOK                          S01496
     C                     KFLD           VECNUM                          S01496
     C                     KFLD           VEPTFR                          S01496
     C/COPY WNCPYSRC,SE6850C001
     C*
     C                     MOVE *BLANKS   WWLOT
     C                     MOVEL'SE6850  'DBPGM  10
     C*
     C                     MOVE *BLANKS   WSESN  10
     C*
     C** RETRIEVE RUN DATE AND BASE CURRENCY
     C************LOVAL    SETLLSDBANKL1                                  S01496
     C***********          READ SDBANKL1                 89               S01496
     C*                                                                   S01496
     C                     CALL 'AOBANKR0'                                S01496
     C                     PARM *BLANKS   @RTCD   7                       S01496
     C                     PARM '*FIRST  '@OPTN   7                       S01496
     C           @BANK     PARM @BANK     DSFDY                           S01496
     C*
     C************IN89     IFEQ '1'                                       S01496
     C           @RTCD     IFNE *BLANKS                                   S01496
     C                     Z-ADD1         DBASE   30       ******************
     C                     MOVEL*BLANKS   DBFILE 10        ** DB ERROR 001 **
     C***********          MOVEL'SDBANKL1'DBFILE           ***************S01496
     C                     MOVE 'SDBANKPD'DBFILE                          S01496
     C                     MOVEL*BLANKS   DBKEY  29
     C***********          OPEN SE6850P3               99                 S01496
     C***********          WRITEHEADAU1                                   S01496
     C***********          WRITEERROR1                                    S01496
     C                     EXSR *PSSR
     C                     END
     C*
     C** DETERMINE DATE FORMAT
     C           BJDFIN    IFEQ 'M'
     C                     MOVE '1'       *IN98
     C                     END
     C*
     C** LOAD RUNDATE ON FORMAT DD.MM.YYYY
     C                     EXSR RUNSYS
     C/COPY WNCPYSRC,SE6850C002
     C*                                                                   S01496
     C** Check if S01425 is installed.                                    S01496
     C*                                                                   S01496
     C                     CALL 'AOSARDR0'                                S01496
     C                     PARM *BLANKS   @RTCD                           S01496
     C                     PARM '*VERIFY' @OPTN                           S01496
     C                     PARM 'S01425'  @SARC   6                       S01496
     C           @SARD     PARM @SARD     DSFDY                           S01496
     C*                                                                   S01496
     C** Set indicator if installed.                                      S01496
     C*                                                                   S01496
     C           @RTCD     IFEQ *BLANKS                                   S01496
     C                     MOVE '1'       *IN40                           S01496
     C                     END                                            S01496
     C*
     C           EP001     ENDSR
     ******************************************************************
      /EJECT
     C**********************************************************************
     C*  RUNSYS : SUB-ROUTINE TO FORMAT THE RUNDATE ON DD.MM.YYYY
     C**********************************************************************
     C*
     C           RUNSYS    BEGSR
     C*
     C                     Z-ADDBJRDNB    ZDAYNO
     C                     EXSR ZDATE2
     C                     MOVE ZDAY      WWDD
     C                     MOVE '.'       WWPT1
     C                     MOVE ZMTH      WWMM
     C                     MOVE '.'       WWPT2
     C*
     C***********ZYEAR     IFGT 10227                                     166533
     C           ZDAYNO    IFGT 10227                                     166533
     C                     MOVE '20'      WWCC
     C                     ELSE
     C                     MOVE '19'      WWCC
     C                     END
     C*
     C                     MOVE ZYEAR     WWYY
     C                     MOVE ZD2000    P1RUNA 10
     C*
     C                     ENDSR
     C*
     C*****************************************************************
      /EJECT
     ******************************************************************
     C* P002   : MAIN PROCESSING                                      *
     ******************************************************************
     C*
     C           P002      BEGSR
     C*                                                                   S01496
     C                     MOVE *BLANKS   WWCMD                           S01496
     C                     MOVELCMD,3     WWCMD                           S01496
     C                     CALL 'QCMDEXC'                                 S01496
     C                     PARM WWCMD     QCAA   41                       S01496
     C                     PARM 41        QCAN   155                      S01496
     C                     EXSR GETMSG                                    S01496
     C*
     C***READ*FIRST*RECORD*IN*ER*REFERENCE*FILE*(AUTHORISED*AND*REVERSE   S01496
     C************LOVAL    SETLLSEERRFL2                                  S01496
     C***********          READ SEERRFL2                 88               S01496
     C*                                                                   S01496
     C**  Read and process each record from the extract file.             S01496
     C*                                                                   S01496
     C           *LOVAL    SETLLSEERCEL0                                  S01496
     C                     READ SEERCEL0                 88               S01496
     C*
     C** DO WHILE END OF FILE IS NOT REACHED
     C           *IN88     DOWEQ'0'                        B*1
     C*
     C***IF*CONFIRMATION*REQUIRED*INDICATOR*IS*'Y'*********************   S01496
     C***AND*IF*IT*IS*NOT*A*CORRECTION*(FOR*CORRECTION,*IT*IS*TO*LATE*TO  S01496
     C***A*CONFIRMATION,*REDEMPTION*DATE*IS*BEFORE*RUN*DATE*|)*********   S01496
     C***********VACFRI    IFEQ 'Y'                        B*2            S01496
     C***********VACORF    ANDEQ*BLANKS                                   S01496
     C*
     C** IF SECURITY SHORTNAME IS NOT EQUAL TO SAVED SECURITY
     C***********VASESN    IFNE WSESN                      B*3            S01496
     C           VESESN    IFNE WSESN                      B*3            S01496
     C*
     C** ACCESS TO SECURITY DETAILS
     C***********VASESN    CHAINSECTY                89                   S01496
     C           VESESN    CHAINSECTY                89                   S01496
     C*
     C** IF RECORD IS NOT FOUND
     C           *IN89     IFEQ '1'                        B*4
     C                     MOVEL'006'     DBASE            ******************
     C***********          MOVEL'SECTY   'DBFILE           * DB ERROR 006 S01496
     C                     MOVE 'SECTY   'DBFILE                          S01496
     C***********          MOVELVASESN    DBKEY            ***************S01496
     C                     MOVELVESESN    DBKEY                           S01496
     C                     EXSR *PSSR
     C                     END                             E*4
     C*                                                                   CA9301
     C*  CHAIN TO THE INVESTMENT TYPES FILE FOR THE PROCESSING TYPE FIELD CA9301
     C*  FOR THE CURRENT SECURITY.                                        CA9301
     C*                                                                   CA9301
     C           KEYFLD    CHAININVTPDF              89                   CA9301
     C           *IN89     IFEQ '1'                                       CA9301
     C           RECI      ORNE 'D'                                       CA9301
     C***********          MOVE 'INVTP'   DBFILE                   CA9301 S01496
     C                     MOVE 'INVTP   'DBFILE                          S01496
     C                     MOVELNMCY      ERRKEY  6                       CA9301
     C                     MOVE SITP      ERRKEY                          CA9301
     C                     MOVELERRKEY    DBKEY            ***************CA9301
     C                     MOVE '11'      DBASE            ** DB ERROR 11 CA9301
     C                     EXSR *PSSR                      ***************CA9301
     C                     END                                            CA9301
     C*                                                                   CA9301
     C*
     C** MOVE 'SECURITY SHORTNAME' INTO 'SAVED SECURITY'
     C                     MOVE SESN      WSESN
     C                     MOVE NMCY      NMCY1   3
     C*
     C**** EDIT MATURITY DATE IN FORMAT DD.MM.YYYY                        CA9301
     C*                                                                   CA9301
     C                     MOVE *BLANKS   P1MATY                          CA9301
     C***********PROT      IFNE '2'                                CA9301 S01496
     C***********PROT      ORNE '4'                                CA9301 S01496
     C***********PROT      ORNE '7'                                CA9301 S01496
     C           MATY      IFNE 0                                         S01496
     C           MATY      ANDNE99999                                     S01496
     C                     Z-ADDMATY      ZDAYNO                          CA9301
     C                     EXSR ZDATE2                                    CA9301
     C                     MOVE ZDAY      WWDD                            CA9301
     C                     MOVE '.'       WWPT1                           CA9301
     C                     MOVE ZMTH      WWMM                            CA9301
     C                     MOVE '.'       WWPT2                           CA9301
     C           ZDAYNO    IFGT 10227                      B002           CA9301
     C                     MOVE '20'      WWCC                            CA9301
     C                     ELSE                            X002           CA9301
     C                     MOVE '19'      WWCC                            CA9301
     C                     END                             E002           CA9301
     C                     MOVE ZYEAR     WWYY                            CA9301
     C                     MOVE ZD2000    P1MATY 10                       CA9301
     C                     END                                            CA9301
     C*   ..  Coupon rate                                                 CA9301
     C                     MOVE *BLANKS   RCPNR  13                       CA9301
     C                     MOVE *BLANKS   ZFLD15                          CA9301
     C                     MOVE CPNR      ZFLD15                          CA9301
     C                     MOVE 'J'       ZECODE                          CA9301
     C                     Z-ADD7         ZDECS                           CA9301
     C                     EXSR ZSEDIT                                    CA9301
     C                     MOVE ZOUT21    RCPNR                           CA9301
     C*                                                                   CA9301
     C                     MOVE *BLANK    P1CPNR                          CA9301
     C***********PROT      IFNE '2'                                CA9301 S01496
     C***********PROT      ORNE '4'                                CA9301 S01496
     C***********PROT      ORNE '7'                                CA9301 S01496
     C           CPNR      IFNE 0                                         S01496
     C                     MOVE RCPNR     P1CPNR                          CA9301
     C                     END                                            CA9301
     C*
     C** ACCESS TO SECURITY DETAILS
     C***********NMCY      CHAINSDCURRL0             89                   S01496
     C*                                                                   S01496
     C                     CALL 'AOCURRR0'                                S01496
     C                     PARM *BLANKS   @RTCD   7                       S01496
     C                     PARM '*KEY   ' @OPTN   7                       S01496
     C                     PARM NMCY      @CYCD   3                       S01496
     C           @CURR     PARM @CURR     DSSDY                           S01496
     C*
     C** IF RECORD IS NOT FOUND
     C************IN89     IFEQ '1'                        B*4            S01496
     C           @RTCD     IFNE *BLANKS                                   S01496
     C                     MOVEL'007'     DBASE            ******************
     C***********          MOVEL'SDCURRL0'DBFILE           * DB ERROR 007 S01496
     C                     MOVE 'SDCURRPD'DBFILE                          S01496
     C                     MOVELNMCY      DBKEY            ******************
     C                     EXSR *PSSR
     C                     END                             E*4
     C/COPY WNCPYSRC,SE6850C003
     C                     END                             E*3
     C*
     C***IF*STATUS*IS*'AUTHORISED'*OR*'REVERSED'*AND*CONFIRMATION*STATUS  S01496
     C***INDICATOR*IS*'Y'**********************************************   S01496
     C***********VAERST    IFEQ 'X'                        B*3            S01496
     C***********VAERST    OREQ 'R'                                       S01496
     C***********VACFSI    ANDEQ'Y'                                       S01496
     C*
     C** PROCESS ALL ALLOCATION RECORDS
     C                     EXSR P006
     C*
     C** UPDATE EARLY REDEMPTION CONFIRMATION FLAGS
     C***********VAERRF    CHAINSEERRFL1             89                   S01496
     C           VEERRF    CHAINSEERRFL1             89                   S01496
     C*
     C                     MOVE 'N'       VACFRI
     C                     MOVE 'Y'       VACFSI
     C*
     C** UPDATE THE EARLY REDEMPTIONS FILE
     C  N89                UPDATSEERRFD1
     C*
     C** COMIT THE UPDATE
     C                     COMIT
     C*
     C** ELSE, STATUS IS 'REVERSED' AND CONFIRMATION STATUS INDICATOR IS 'N'
     C** (CONFIRMATION NEVER PREVIOUSLY PRINTED, SO NOT NECESSARY TO PRODUCE
     C**  REVERSAL CONFIRMATIONS |||)
     C*********************ELSE                            X*3
     C***********                                                         S01496
     C***********          END                             E*3            S01496
     C***********                                                         S01496
     C***********          END                             E*2            S01496
     C***********                                                         S01496
     C***ACCESS*NEXT*RECORD*IN*ER*REFERENCES*FILE**********************   S01496
     C***********          READ SEERRFL2                 88               S01496
     C*                                                                   S01496
     C**  Process next record.                                            S01496
     C*                                                                   S01496
     C                     READ SEERCEL0                 88               S01496
     C*
     C                     END                             E*1
     C*
     C           EP002     ENDSR
     ******************************************************************
      /EJECT
     ******************************************************************
     C* P006   : PROCESS ALL ALLOCATION RECORDS                       *
     ******************************************************************
     C*
     C           P006      BEGSR
     C*
     C***ACCESS*FIRST*ALLOCATION*RECORD*FOR*CURRENT*ER*REFERENCE*******   S01496
     C***********VAERRF    SETLLSEERALL0                                  S01496
     C***********          READ SEERALL0                 87               S01496
     C***********                                                         S01496
     C***DO*WHILE*END*OF*FILE*AND*END*OF*REFERENCE*IS*NOT*REACHED******   S01496
     C************IN87     DOWEQ'0'                        B*1            S01496
     C***********VAERRF    ANDEQVCERRF                                    S01496
     C***********                                                         S01496
     C***IF*ER*TYPE*IS*NOT*B'*(BOOK*ALLOCATION*RECORD)*****************   S01496
     C***********VCERTP    IFNE 'B'                        B*2            S01496
     C***********                                                         S01496
     C***ACCESS*CUSTOMER*DETAILS***************************************   S01496
     C***********          MOVE VCCNUM    KCNUM   6                       S01496
     C***********KCNUM     CHAINSDCUSTL0             89                   S01496
     C***********                                                         S01496
     C***IF*RECORD*IS*NOT*FOUND****************************************   S01496
     C************IN89     IFEQ '1'                        B*3            S01496
     C***********          MOVEL'007'     DBASE            ***************S01496
     C***********          MOVEL'SDCUSTL0'DBFILE           * DB ERROR 007 S01496
     C***********          MOVELKCNUM     DBKEY            ***************S01496
     C***********          EXSR *PSSR                                     S01496
     C***********          END                             E*3            S01496
     C***********                                                         S01496
     C***********KCNUM     CHAINSDCUSTX0             89                   S01496
     C***********                                                         S01496
     C***IF*RECORD*IS*NOT*FOUND****************************************   S01496
     C************IN89     IFEQ '1'                        B*3            S01496
     C***********          MOVEL'008'     DBASE            ***************S01496
     C***********          MOVEL'SDCUSTX0'DBFILE           ** DB ERROR 008S01496
     C***********          MOVELKCNUM     DBKEY            ***************S01496
     C***********          EXSR *PSSR                                     S01496
     C***********          END                             E*3            S01496
     C*
     C**  Access Additional Customer Details file if S01425 is            S01496
     C**  installed.                                                      S01496
     C*                                                                   S01496
     C                     MOVE VECNUM    KCNUM   6                       S01496
     C           *IN40     IFEQ '1'                                       S01496
     C           KCNUM     CHAINSDACUSL0             89                   S01496
     C*                                                                   S01496
     C** Record not found                                                 S01496
     C*                                                                   S01496
     C           *IN89     IFEQ '1'                                       S01496
     C                     MOVEL*BLANKS   E5CNA1                          S01496
     C                     MOVEL*BLANKS   E5CNA2                          S01496
     C                     ELSE                                           S01496
     C                     Z-ADD1         M       20
     C           INMRS     LOKUPIND,M                    46
     C           *IN46     IFEQ '1'
     C**********           MOVEASEA,M     SEMRS  35                                         BUG10701
     C                     MOVEASEA,M     SEMRS  70                                         BUG10701
     C                     ELSE
     C                     MOVE *BLANK    SEMRS
     C                     END
     C                     END                                            S01496
     C*                                                                   S01496
     C                     END                                            S01496
     C*
     C***********          MOVE '0'       *IN71                           S01496
     C***********          MOVE '0'       *IN72                           S01496
     C***********          MOVE '0'       *IN73                           S01496
     C***********                                                         S01496
     C***SETUP*LANGUAGE*OF*THE*CONFIRMATION****************************   S01496
     C***********BBLANG    IFEQ 'DE'                       B*3            S01496
     C***********          MOVE '1'       *IN71                           S01496
     C***********          ELSE                            X*3            S01496
     C***********BBLANG    IFEQ 'FR'                       B*4
     C***********BBLANG    IFEQ 'DK'                       B*4            S01496
     C***********          MOVE '1'       *IN72                           S01496
     C***********          ELSE                            X*4            S01496
     C***********          MOVE '1'       *IN73                           S01496
     C***********          END                             E*4            S01496
     C***********          END                             E*3            S01496
     C*
     C                     MOVE *BLANKS   AZACON
     C*
     C***IF*ACCOUNT*OFFICER*IS*NOT*BLANK*******************************   S01496
     C***********BBACOC    IFNE *BLANKS                    B*3            S01496
     C***********                                                         S01496
     C***********BBACOC    CHAINSDACOFL1             89                   S01496
     C*                                                                   S01496
     C**  Access Account Officer Details file.                            S01496
     C*                                                                   S01496
     C           VEACOC    IFNE *BLANKS                    B*3            S01496
     C*                                                                   S01496
     C                     CALL 'AOACOFR0'                                S01496
     C                     PARM *BLANKS   @RTCD   7                       S01496
     C                     PARM '*KEY   ' @OPTN   7                       S01496
     C                     PARM VEACOC    @ACOC   2                       S01496
     C           @ACOF     PARM @ACOF     DSSDY                           S01496
     C*
     C** IF RECORD IS NOT FOUND
     C************IN89     IFEQ '1'                        B*4            S01496
     C           @RTCD     IFNE *BLANKS                                   S01496
     C                     MOVEL'009'     DBASE            ******************
     C***********          MOVEL'SDACOFL1'DBFILE           * DB ERROR 009 S01496
     C                     MOVE 'SDACOFPD'DBFILE                          S01496
     C***********          MOVELBBACOC    DBKEY            ***************S01496
     C                     MOVELVEACOC    DBKEY                           S01496
     C                     EXSR *PSSR
     C                     END                             E*4
     C                     END                             E*3
     C*
     C** ACCOUNT OFFICER NAME
     C           AZACON    IFNE *BLANKS                    B*3
     C                     MOVE '1'       *IN52
     C***********          MOVE AZACON    DEACON                          S01496
     C***********          MOVE AZACON    FRACON                          S01496
     C                     ELSE                            X*3
     C                     MOVE '0'       *IN52
     C***********          MOVE *BLANKS   DEACON                          S01496
     C***********          MOVE *BLANKS   FRACON                          S01496
     C                     END                             E*3
     C*
     C************LIKE     DEFN BBLANG    WWLANG                          S01496
     C***********                                                         S01496
     C***********BBLANG    IFEQ '  '                       B*3            S01496
     C***********          MOVE 'GB'      BBLANG                          S01496
     C***********          END                             E*3            S01496
     C***********                                                         S01496
     C***********BBLANG    IFNE WWLANG                     B*3            S01496
     C***********          MOVE *BLANKS   WWCMD                           S01496
     C***********          MOVELCMD,3     WWCMD  43                       S01496
     C***********          MOVE BBLANG    FILTY                           S01496
     C***********          MOVELCMD,3     WWCMD                           S01496
     C***********          CALL 'QCMDEXC'                                 S01496
     C***********          PARM WWCMD     QCAA   43                       S01496
     C***********          PARM 43        QCAN   155                      S01496
     C***********          EXSR GETMSG                                    S01496
     C***********          MOVE BBLANG    WWLANG                          S01496
     C***********          END                             E*3            S01496
     C***********                                                         S01496
     C***SETUP*THE*BRANCH*CODE*****************************************   S01496
     C***********BBBRCD    IFEQ '001'                      B*3            S01496
     C***********          MOVELGEB087    P1BRCD 10                       S01496
     C***********          ELSE                            X*3            S01496
     C***********          MOVELGEB086    P1BRCD                          S01496
     C***********          END                             E*3            S01496
     C***********                                                         S01496
     C***SPLIT*BRANCH*CONFIRMATION*************************************   S01496
     C***********BBBRCD    IFNE @@BRCD                     B*3            S01496
     C***********          CLOSESE6850P3                                  S01496
     C***********          MOVELCMD,1     WWCMD  43                       S01496
     C***********          MOVE ')'       WWPRTL  4                       S01496
     C***********          MOVELBBBRCD    WWPRTL                          S01496
     C***********          MOVE WWPRTL    WWCMD                           S01496
     C***********          CALL 'QCMDEXC'                                 S01496
     C***********          PARM WWCMD     QCAA   43                       S01496
     C***********          PARM 43        QCAN   155                      S01496
     C***********          OPEN SE6850P3                                  S01496
     C***********          CLOSESE685HM3               99                 S01496
     C***********          MOVELCMD,2     WWCMD  43                       S01496
     C***********          MOVE ')'       WWPRTL  4                       S01496
     C***********          MOVELBBBRCD    WWPRTL                          S01496
     C***********          MOVE WWPRTL    WWCMD                           S01496
     C***********          CALL 'QCMDEXC'                                 S01496
     C***********          PARM WWCMD     QCAA   43                       S01496
     C***********          PARM 43        QCAN   155                      S01496
     C***********          OPEN SE685HM3                                  S01496
     C***********          MOVELBBBRCD    @@BRCD  3                       S01496
     C***********          END                                            S01496
     C***********                                                         S01496
     C***********CUHLDM    IFNE 'Y'                        B*3            S01496
     C***********CUNRAC    IFNE 'Y'                        B*4            S01496
     C***********          MOVE SEA002    FRBB02 26                       S01496
     C***********          MOVE SEA002    DEBB02 26                       S01496
     C***********          MOVE SEA002    SEBB02 26                       S01496
     C***********          MOVE '1'       *IN54                           S01496
     C***********          ELSE                            X*4            S01496
     C***********          MOVE *BLANKS   FRBB02                          S01496
     C***********          MOVE *BLANKS   DEBB02                          S01496
     C***********          MOVE *BLANKS   SEBB02                          S01496
     C***********          MOVE '0'       *IN54                           S01496
     C***********          END                             E*4            S01496
     C***********          END                             E*3            S01496
     C***********                                                         S01496
     C***RETRIEVE*CUSTOMER*ADDRESS*************************************   S01496
     C***********          MOVE 'B'       RCDT                            S01496
     C***********KLCLNT    CHAINCLINTCCF             89                   S01496
     C***********                                                         S01496
     C***IF*RECORD*IS*NOT*FOUND****************************************   S01496
     C************IN89     IFEQ '1'                        B*3            S01496
     C***********RECI      OREQ '*'                                       S01496
     C***********          MOVEL'010'     DBASE            ***************S01496
     C***********          MOVEL'CLINTCCF'DBFILE           * DB ERROR 010 S01496
     C***********          MOVELVCCNUM    DBKEY            ***************S01496
     C***********          EXSR *PSSR                                     S01496
     C***********          END                             E*3            S01496
     C***********                                                         S01496
     C***********          MOVE CNA1      RCNA1                           S01496
     C***********          MOVE CNA2      RCNA2                           S01496
     C***********          MOVE CNA3      RCNA3                           S01496
     C***********          MOVE CNA4      RCNA4                           S01496
     C                     MOVE VECNA1    RCNA1                           S01496
     C                     MOVE VECNA2    RCNA2                           S01496
     C                     MOVE VECNA3    RCNA3                           S01496
     C                     MOVE VECNA4    RCNA4                           S01496
     C*
     C** SETUP THE REDEMPTION DATE IN THE FORMAT DD.MM.YY
     C                     MOVE *BLANKS   P1PSVL
     C***********          Z-ADDVAERRD    ZDAYNO                          S01496
     C                     Z-ADDVEERRD    ZDAYNO                          S01496
     C                     EXSR ZDATE2
     C                     MOVE ZDAY      WWDD
     C                     MOVE '.'       WWPT1
     C                     MOVE ZMTH      WWMM
     C                     MOVE '.'       WWPT2
     C*
     C***********ZYEAR     IFGT 10227                                     166533
     C           ZDAYNO    IFGT 10227                                     166533
     C                     MOVE '20'      WWCC
     C                     ELSE
     C                     MOVE '19'      WWCC
     C                     END
     C*
     C                     MOVE ZYEAR     WWYY
     C                     MOVE ZD2000    P1PSVL 10
     C*
     C** SETUP THE REDEMPTION PRICE (%)
     C                     MOVE *BLANKS   ZFLD15
     C***********          MOVE VAREDP    ZFLD15                          S01496
     C                     MOVE VEREDP    ZFLD15                          S01496
     C                     MOVE 'L'       ZECODE
     C**                   Z-ADD3         ZDECS                           068343
     C                     Z-ADD7         ZDECS                           068343
     C                     EXSR ZSEDIT
     C**                   MOVELZOUT21    RSDCP  12                       068343
     C                     MOVE ZOUT21    RSDCP  12                       068343
     C*                                                                   S01496
     C**  Process change in branch or change in hold indicator.           S01496
     C*                                                                   S01496
     C           VEBRCD    IFNE @@BRCD                                    S01496
     C           VEHMIN    ORNE WLHMIN                                    S01496
     C*                                                                   S01496
     C**  Get branch name using access object.                            S01496
     C*                                                                   S01496
     C**********           CALL 'AOBRCHR0'                                S01496              CGL029
     C                     CALL 'AOBRCHR1'                                                    CGL029
     C                     PARM *BLANKS   @RTCD                           S01496
     C                     PARM '*KEY   ' @OPTN                           S01496
     C                     PARM VEBRCD    @BRCA   3                       S01496
     C********** @BRCH     PARM @BRCH     DSFDY                           S01496              CGL029
     C           @BRCH     PARM @BRCH     DSSDY                                               CGL029
     C*                                                                   S01496
     C**  Check if error occurred.                                        S01496
     C*                                                                   S01496
     C           @RTCD     IFNE *BLANKS                                   S01496
     C                     MOVE 'SDBRCHPD'DBFILE           ***************S01496
     C                     MOVEL'050'     DBASE            * DBERROR 050 *S01496
     C                     MOVE *BLANKS   DBKEY            ***************S01496
     C                     MOVELVEBRCD    DBKEY                           S01496
     C                     EXSR *PSSR                                     S01496
     C                     END                                            S01496
     C*                                                                   S01496
     C**  Close P1 if opened and report level is branch.                  S01496
     C*                                                                   S01496
     C           *IN31     IFEQ '1'                                       S01496
     C           @RENT     ANDNE*BLANKS                                   S01496
     C           *IN31     OREQ '1'                                       S01496
     C           VEHMIN    ANDNEWLHMIN                                    S01496
     C                     CLOSESE6850P1                                  S01496
     C                     MOVE '0'       *IN31                           S01496
     C                     END                                            S01496
     C*                                                                   S01496
     C**  Open P1 if closed or report level is branch.                    S01496
     C*                                                                   S01496
     C           *IN31     IFEQ '0'                                       S01496
     C           @RENT     ORNE *BLANKS                                   S01496
     C                     MOVEL*BLANKS   WWCMD                           S01496
     C*                                                                   S01496
     C**  Override printer file with appropriate spooled file name.       S01496
     C*                                                                   S01496
     C           VEHMIN    IFEQ 'Y'                                       S01496
     C                     MOVELCMD,2     WWCMD                           S01496
     C                     ELSE                                           S01496
     C                     MOVELCMD,1     WWCMD                           S01496
     C                     END                                            S01496
     C*                                                                   S01496
     C                     CALL 'QCMDEXC'                                 S01496
     C                     PARM WWCMD     QCAA                            S01496
     C                     PARM 41        QCAN                            S01496
     C                     OPEN SE6850P1                                  S01496
     C                     EXSR RCFP1                                     S01496
     C                     MOVE '1'       *IN31                           S01496
     C                     END                                            S01496
     C*                                                                   S01496
     C                     MOVELVEHMIN    WLHMIN  1                       S01496
     C                     MOVELVEBRCD    @@BRCD  3                       S01496
     C                     END                                            S01496
     C*
     C** IF RECORD IDENTIFIER IS '*' (ALLOCATION DELETED/REVERSED)
     C***********VCRECI    IFEQ '*'                        B*3            S01496
     C           VERECI    IFEQ '*'                        B*3            S01496
     C*
     C** IF CONFIRMATION LAST NOMINAL IS NOT EQUAL TO ZERO
     C** (A CONFIRMATION WAS ALREADY PRINTED SO PRODUCE A REVERSAL CONFIRMATION)
     C***********VCCFNO    IFNE *ZEROS                     B*4            S01496
     C           VECFNO    IFNE *ZEROS                     B*4            S01496
     C*
     C                     MOVE '1'       *IN50            * REVERSAL *
     C                     MOVE '0'       *IN51            * AMENDEMENT *
     C*
     C** PRODUCE AN ADVICE WITH CONFIRMATION LAST NOMINAL AND 'REVERSAL'
     C                     MOVE *BLANKS   ZFLD15
     C***********          MOVE VCCFNO    ZFLD15                          S01496
     C                     MOVE VECFNO    ZFLD15                          S01496
     C*
     C                     Z-ADD*ZEROS    ZVALU
     C***********          Z-ADDVCCFNO    ZNOML                           S01496
     C                     Z-ADDVECFNO    ZNOML                           S01496
     C*
     C** CALCULATION AND SETUP OF THE AMOUNTS
     C                     EXSR P004
     C*
     C** TEST IF HOLD MAIL INDICATOR PRESENT
     C** TEST IF CUSTOMER HAS ALTERNATE ADRESS  DO NOT SEND MAIL ON THE MAIN
     C** ADRESS
     C*
     C***********          MOVE CNUM      CUSKEY  6                       S01496
     C                     MOVE VECNUM    CUSKEY  6                       S01496
     C           CUSKEY    SETLLSDALTNL1                 64
     C*
     C           *IN64     IFEQ '0'
     C***********CUHLDM    IFEQ 'Y'                                       S01496
     C***********          EXSR YESHM                                     S01496
     C***********          ELSE                                           S01496
     C                     EXSR NONHM
     C***********          END                                            S01496
     C                     END
     C*
     C** WORK WITH THE ALTERNATE ADDRESS
     C                     EXSR P005
     C*                                                                   S01496
     C**  Retrieve record from Allocations File.                          S01496
     C*                                                                   S01496
     C           ALKEY     CHAINSEERALL0             87                   S01496
     C*
     C                     Z-ADD*ZEROS    VCCFNO
     C*
     C** UPDATE ALLOCATION RECORD
     C                     UPDATSEERALD0
     C*
     C** COMIT THE UPDATE
     C                     COMIT
     C                     END                             E*4
     C                     END                             E*3
     C*
     C** IF RECORD IDENTIFIER IS 'D' (ALLOCATION INSERTED/AMENDED) AND
     C** IF NOMINAL ALLOCATED IS DIFFERENT THAN CONFIRMATION LAST NOMINAL
     C***********VCRECI    IFEQ 'D'                        B*3            S01496
     C***********VCNOMA    ANDNEVCCFNO                                    S01496
     C           VERECI    IFEQ 'D'                        B*3            S01496
     C           VENOMA    ANDNEVECFNO                                    S01496
     C*
     C** IF CONFIRMATION LAST NOMINAL IS NOT EQUAL TO ZEROS
     C** (A CONFIRMATION WAS ALREADY PRINTED, SO PRODUCE A NEW CONFIRMATION)
     C***********VCCFNO    IFNE *ZEROS                     B*4            S01496
     C           VECFNO    IFNE *ZEROS                     B*4            S01496
     C*
     C** PRODUCE AN ADVICE WITH NOMINAL ALLOCATED AND 'AMEND'
     C                     MOVE *BLANKS   ZFLD15
     C***********          MOVE VCNOMA    ZFLD15                          S01496
     C                     MOVE VENOMA    ZFLD15                          S01496
     C*
     C                     Z-ADD*ZEROS    ZVALU
     C***********          Z-ADDVCNOMA    ZNOML                           S01496
     C                     Z-ADDVENOMA    ZNOML                           S01496
     C*
     C** CALCULATION AND SETUP OF THE AMOUNTS
     C                     EXSR P004
     C*
     C                     MOVE '0'       *IN50            * REVERSAL *
     C                     MOVE '1'       *IN51            * AMENDEMENT *
     C*
     C** TEST IF HOLD MAIL INDICATOR PRESENT
     C** TEST IF CUSTOMER HAS ALTERNATE ADRESS  DO NOT SEND MAIL TO THE MAIN
     C** ADRESS
     C*
     C***********          MOVE CNUM      CUSKEY  6                       S01496
     C                     MOVE VECNUM    CUSKEY  6                       S01496
     C           CUSKEY    SETLLSDALTNL1                 64
     C*
     C           *IN64     IFEQ '0'
     C***********CUHLDM    IFEQ 'Y'                                       S01496
     C***********          EXSR YESHM                                     S01496
     C***********          ELSE                                           S01496
     C                     EXSR NONHM
     C***********          END                                            S01496
     C                     END
     C*
     C** WORK WITH THE ALTERNATE ADDRESS
     C                     EXSR P005
     C*                                                                   S01496
     C**  Retrieve record from Allocations File.                          S01496
     C*                                                                   S01496
     C           ALKEY     CHAINSEERALL0             87                   S01496
     C*
     C***********          Z-ADDVCNOMA    VCCFNO                          S01496
     C                     Z-ADDVENOMA    VCCFNO                          S01496
     C*
     C** UPDATE ALLOCATION RECORD
     C                     UPDATSEERALD0
     C*
     C** COMIT THE UPDATE
     C                     COMIT
     C                     END                             E*4
     C*
     C** IF CONFIRMATION LAST NOMINAL IS EQUAL TO ZEROS
     C** (A CONFIRMATION WAS NEVER PRINTED, SO PRODUCE THE FIRST CONFIRMATION)
     C***********VCCFNO    IFEQ *ZEROS                     B*4            S01496
     C           VECFNO    IFEQ *ZEROS                     B*4            S01496
     C*
     C** PRODUCE AN ADVICE WITH NOMINAL ALLOCATED
     C                     MOVE *BLANKS   ZFLD15
     C***********          MOVE VCNOMA    ZFLD15                          S01496
     C                     MOVE VENOMA    ZFLD15                          S01496
     C*
     C                     Z-ADD*ZEROS    ZVALU
     C***********          Z-ADDVCNOMA    ZNOML                           S01496
     C                     Z-ADDVENOMA    ZNOML                           S01496
     C*
     C** CALCULATION AND SETUP OF THE AMOUNTS
     C                     EXSR P004
     C*
     C                     MOVE '0'       *IN50            * REVERSAL *
     C                     MOVE '0'       *IN51            * AMENDEMENT *
     C*
     C** TEST IF HOLD MAIL INDICATOR PRESENT
     C** TEST IF CUSTOMER HAS ALTERNATE ADRESS  DO NOT SEND MAIL TO THE MAIN
     C** ADRESS
     C*
     C***********          MOVE CNUM      CUSKEY  6                       S01496
     C                     MOVE VECNUM    CUSKEY  6                       S01496
     C           CUSKEY    SETLLSDALTNL1                 64
     C*
     C           *IN64     IFEQ '0'
     C***********CUHLDM    IFEQ 'Y'                                       S01496
     C***********          EXSR YESHM                                     S01496
     C***********          ELSE                                           S01496
     C                     EXSR NONHM
     C***********          END                                            S01496
     C                     END
     C*
     C** WORK WITH THE ALTERNATE ADDRESS
     C                     EXSR P005
     C*                                                                   S01496
     C**  Retrieve record from Allocations File.                          S01496
     C*                                                                   S01496
     C           ALKEY     CHAINSEERALL0             87                   S01496
     C*
     C***********          Z-ADDVCNOMA    VCCFNO                          S01496
     C                     Z-ADDVENOMA    VCCFNO                          S01496
     C*
     C** UPDATE ALLOCATION RECORD
     C                     UPDATSEERALD0
     C*
     C** COMIT THE UPDATE
     C                     COMIT
     C                     END                             E*4
     C                     END                             E*3
     C***********          END                             E*2            S01496
     C***********                                                         S01496
     C***********          READ SEERALL0                 87               S01496
     C***********          END                             E*1            S01496
     C*
     C           EP006     ENDSR
     *********************************************************************
      /EJECT
     ******************************************************************
     C* P004   : CALCULATE AND SETUP OF THE AMOUNTS                   *
     ******************************************************************
     C*
     C           P004      BEGSR
     C*
     C                     Z-ADDNMDP      ZDECS
     C                     MOVE 'J'       ZECODE
     C                     EXSR ZSEDIT
     C                     MOVE ZOUT21    RPNMP  21
     C*
     C                     MOVELRPNMP     WFLD1  20
     C                     MOVE WFLD1     RPAMT1 17
     C*
     C                     MOVELRPAMT1    IN     50
     C                     EXSR ARRAY
     C                     MOVELOUT       RPAMT1
     C*
     C                     Z-ADD*ZEROS    ZVALU
     C*
     C***********          Z-ADDVAREDP    ZAVPR                           S01496
     C                     Z-ADDVEREDP    ZAVPR                           S01496
     C                     Z-ADDNMDP      ZNMDP
     C                     Z-ADDA6NBDP    ZNMCD
     C                     MOVE SPBS      ZPRCB
     C                     EXSR ZAPNUM
     C*
     C                     MOVE *BLANKS   ZFLD15
     C                     MOVE ZVALU     ZFLD15
     C                     Z-ADDA6NBDP    ZDECS
     C                     MOVE 'J'       ZECODE
     C                     EXSR ZSEDIT
     C                     MOVE ZOUT21    RPAMT2 17
     C*                                                                   S01496
     C                     MOVELRPAMT2    IN                              S01496
     C                     EXSR ARRAY                                     S01496
     C                     MOVELOUT       RPAMT2                          S01496
     C*
     C           EP004     ENDSR
     *********************************************************************
      /EJECT
     ******************************************************************
     C* P005   : PROCESS ALL ALTERNATE ADRESSES                       *
     ******************************************************************
     C*
     C           P005      BEGSR
     C*
     C******               MOVE CNUM      CUSKEY  6
     C******     CUSKEY    SETLLSDALTNL1
     C           CUSKEY    READESDALTNL1                 86
     C*
     C           *IN86     DOWEQ'0'                        B*1
     C           BCADCD    IFEQ 'C'                        B*2
     C                     MOVE '0'       *IN63
     C                     MOVE *BLANKS   SEMRS                           CA9303
     C                     ELSE                            X*2
     C                     MOVE '1'       *IN63
     C                     END                             E*2
     C***********          MOVE '0'       *IN71                           S01496
     C***********          MOVE '0'       *IN72                           S01496
     C***********          MOVE '0'       *IN73                           S01496
     C***********                                                         S01496
     C***********BCLANG    IFEQ 'DE'                       B*2            S01496
     C***********          MOVE '1'       *IN71                           S01496
     C***********          ELSE                            X*2            S01496
     C***********BCLANG    IFEQ 'FR'                       B*3
     C***********BCLANG    IFEQ 'DK'                       B*3            S01496
     C***********          MOVE '1'       *IN72                           S01496
     C***********          ELSE                            X*3            S01496
     C***********          MOVE '1'       *IN73                           S01496
     C***********          END                             E*3            S01496
     C***********          END                             E*2            S01496
     C*
     C                     MOVE BCCNA1    RCNA1
     C                     MOVE BCCNA2    RCNA2
     C                     MOVE BCCNA3    RCNA3
     C                     MOVE BCCNA4    RCNA4
     C*
     C***********BCLANG    IFEQ '  '                       B*2            S01496
     C***********          MOVE 'GB'      BCLANG                          S01496
     C***********          END                             E*2            S01496
     C***********                                                         S01496
     C***********BCLANG    IFNE WWLANG                     B*2            S01496
     C***********          MOVE *BLANKS   WWCMD                           S01496
     C***********          MOVELCMD,3     WWCMD  43                       S01496
     C***********          MOVE BCLANG    FILTY                           S01496
     C***********          CALL 'QCMDEXC'                                 S01496
     C***********          PARM WWCMD     QCAA   43                       S01496
     C***********          PARM 43        QCAN   155                      S01496
     C***********          EXSR GETMSG                                    S01496
     C***********          MOVE BCLANG    WWLANG                          S01496
     C***********          END                             E*2            S01496
     C***********                                                         S01496
     C***********BRCD      IFEQ 001                        B*2            S01496
     C***********          MOVELGEB087    P1BRCD                          S01496
     C***********          ELSE                            X*2            S01496
     C***********          MOVELGEB086    P1BRCD                          S01496
     C***********          END                             E*2            S01496
     C***********CUACO1    IFEQ *BLANKS                            CA9303 S01496
     C***********CUACO2    OREQ *BLANKS                            CA9303 S01496
     C*                                                                   S01496
     C           *IN40     IFEQ '1'                                       S01496
     C           E5CNA1    IFNE *BLANKS                                   S01496
     C           E5CNA2    ORNE *BLANKS                                   S01496
     C                     MOVE '1'       *IN77                           CA9303
     C                     ELSE                                           CA9303
     C                     MOVE '0'       *IN77                           CA9303
     C                     END                                            CA9303
     C                     END                                            S01496
     C*
     C***********BCHMBD    IFEQ 'Y'                        B*2            S01496
     C***********          EXSR YESHM                                     S01496
     C***********          ELSE                            X*2            S01496
     C                     EXSR NONHM
     C***********          END                             E*2            S01496
     C*
     C           CUSKEY    READESDALTNL1                 86
     C                     END                             E*1
     C*
     C                     MOVE '0'       *IN63
     C                     MOVE '0'       *IN77                           CA9303
     C*
     C           EP005     ENDSR
     *********************************************************************
      /EJECT
     C********************************************************************
     C***********                                                        *S01496
     C***YESHM**Sub*routine*to*print*confirmation**********************  *S01496
     C***********                                                        *S01496
     C********************************************************************
     C***********                                                         S01496
     C***********YESHM     BEGSR                                          S01496
     C***********                                                         S01496
     C***********          WRITEHEAPRH                                    S01496
     C***********          WRITESECUPH                                    S01496
     C***********          WRITEPERIOH                                    S01496
     C***********          WRITESENOTH                                    S01496
     C***********                                                         S01496
     C***********          ENDSR                                          S01496
     C********************************************************************
      /EJECT
     C********************************************************************
     C*                                                                  *
     C*  NONHM  Sub routine to print confirmation                        *
     C*                                                                  *
     C********************************************************************
     C**
     C           NONHM     BEGSR
     C*
     C***********          WRITEHEAPRT                                    S01496
     C***********          WRITESECUPR                                    S01496
     C***********          WRITEPERIO                                     S01496
     C***********          WRITESENOTX                                    S01496
     C/COPY WNCPYSRC,SE6850C004
     C                     WRITEERCONF                                    S01496
     C/COPY WNCPYSRC,SE6850C005
     C*
     C                     ENDSR
     C*****************************************************************
      /EJECT
     ******************************************************************
     C* GETMSG :                                                      *
     ******************************************************************
     C*
     C           GETMSG    BEGSR
     C*
     C**  SET UP PARAMETER TO RETRIEVE MESSAGE FROM MESSAGE FILE
     C           SUBR23    PLIST
     C                     PARM           VARMSG  7
     C                     PARM           TEXT  120
     C                     PARM           LEVEL   10
     C                     PARM           RETCD   10
     C                     PARM           TXTL    40
     C*
     C                     Z-ADD3         LEVEL
     C                     Z-ADD120       TXTL
      * GET MES. DATE:                                                    CA9301
     C                     MOVEL'SSE2580' VARMSG                          CA9301
     C                     CALL 'SUBR23R3'SUBR23                          CA9301
     C                     MOVELTEXT      SEC580 10                       CA9301
      * GET MES. CUSTOMER NUMBER                                          CA9301
     C                     MOVEL'SSE2586' VARMSG                          CA9301
     C                     CALL 'SUBR23R3'SUBR23                          CA9301
     C                     MOVELTEXT      SEC586 40                       CA9301
     C*
     C** GET MES. YOUR ADVISER:
     C                     MOVEL'SSE1001' VARMSG
     C                     CALL 'SUBR23R3'SUBR23
     C                     MOVELTEXT      SEA001 23
     C*
     C***GET*MES.*MAILING*ADRESS:**************************************   S01496
     C**  Get message REDEMPTION PRICE.                                   S01496
     C*                                                                   S01496
     C                     MOVEL'SSE1002' VARMSG
     C                     CALL 'SUBR23R3'SUBR23
     C***********          MOVELTEXT      SEA002 25                       S01496
     C                     MOVELTEXT      SEA002 18                       S01496
     C*
     C** GET MES. BLOCKED POSITION
     C                     MOVEL'SSE1047' VARMSG
     C                     CALL 'SUBR23R3'SUBR23
     C                     MOVELTEXT      SEA003 23
     C***********          MOVELTEXT      FEA003 23                       S01496
     C***********          MOVELTEXT      DEA003 23                       S01496
     C*
     C** GET MES. - AMENDEMENT
     C                     MOVEL'SSE2005' VARMSG
     C                     CALL 'SUBR23R3'SUBR23
     C                     MOVELTEXT      SEA004 12
     C***********          MOVELTEXT      FEA004 12                       S01496
     C***********          MOVELTEXT      DEA004 12                       S01496
     C*
     C** GET MES. - REVERSAL
     C                     MOVEL'SSE1046' VARMSG
     C                     CALL 'SUBR23R3'SUBR23
     C                     MOVELTEXT      SEA005 12
     C***********          MOVELTEXT      FEA005 12                       S01496
     C***********          MOVELTEXT      DEA005 12                       S01496
     C*
     C** GET MES. WE HAVE MARKED THE FOLLOWING POSITION
     C                     MOVEL'SSE1048' VARMSG
     C                     CALL 'SUBR23R3'SUBR23
     C                     MOVELTEXT      SEA007 65                       S01496
     C***********          MOVELTEXT      SEA007 44                       S01496
     C***********          MOVELTEXT      FEA007 44                       S01496
     C***********          MOVELTEXT      DEA007 44                       S01496
     C*
     C***GET*MES.*FOR*AN*EARLY*REDEMPTION******************************   S01496
     C**  Get message REFERENCE:                                          S01496
     C                     MOVEL'SSE1045' VARMSG
     C                     CALL 'SUBR23R3'SUBR23
     C                     MOVELTEXT      SEA008 12                       S01496
     C***********          MOVELTEXT      SEA008 50                       S01496
     C***********          MOVELTEXT      FEA008 50                       S01496
     C***********          MOVELTEXT      DEA008 50                       S01496
     C*
     C** GET MES. SECURITY NO:
     C                     MOVEL'SSE1013' VARMSG
     C                     CALL 'SUBR23R3'SUBR23
     C                     MOVELTEXT      SEA013 22
     C*
     C***GET*MES.*AT***************************************************   S01496
     C**  Get message COUPON RATE.                                        S01496
     C                     MOVEL'SSE1015' VARMSG
     C                     CALL 'SUBR23R3'SUBR23
     C                     MOVELTEXT      SEA015 12
     C***********          MOVELTEXT      FRA015 12                       S01496
     C*
     C** GET MES.  %
     C                     MOVEL'SSE1016' VARMSG
     C                     CALL 'SUBR23R3'SUBR23
     C                     MOVELTEXT      SEA016 12
     C*
     C** GET MES. VALUE:
     C                     MOVEL'SSE1028' VARMSG
     C                     CALL 'SUBR23R3'SUBR23
     C                     MOVELTEXT      SEA028 16
     C***********          MOVELTEXT      FEA028 16                       S01496
     C***********          MOVELTEXT      GEA028 16                       S01496
     C*
     C***GET*MES.*ZURICH***********************************************   S01496
     C**  Get message MATURITY DATE.                                      S01496
     C                     MOVEL'SSE2087' VARMSG
     C                     CALL 'SUBR23R3'SUBR23
     C                     MOVELTEXT      SEA087 16                       S01496
     C***********          MOVELTEXT      GEB087 10                       S01496
     C***********                                                         S01496
     C***GET*MES.*GENEVA***********************************************   S01496
     C***********          MOVEL'SSE2086' VARMSG                          S01496
     C***********          CALL 'SUBR23R3'SUBR23                          S01496
     C***********          MOVELTEXT      GEB086 10                       S01496
     C*
     C** GET MES. FORM WITHOUT SIGNATURE
     C                     MOVEL'SSE3025' VARMSG
     C                     CALL 'SUBR23R3'SUBR23
     C                     MOVELTEXT      SEC025 35
     C***********          MOVELTEXT      FRC025 35                       S01496
     C***********          MOVELTEXT      DEC025 35                       S01496
     C*
     C** GET MES. COPY
     C                     MOVEL'SSE2073' VARMSG
     C                     CALL 'SUBR23R3'SUBR23
     C                     MOVELTEXT      SEC073 19
     C*
     C** GET MES. REMARK: UNDER USUAL RESERVE
     C                     MOVEL'SSE1035' VARMSG
     C                     CALL 'SUBR23R3'SUBR23
     C                     MOVELTEXT      SEA035 37
     C*
     C** GET MES. REMARK: NOMINAL:
     C                     MOVEL'SSE1036' VARMSG
     C                     CALL 'SUBR23R3'SUBR23
     C                     MOVELTEXT      SEA036 18
     C*
     C** GET MES. YOUR SINCERELY
     C                     MOVEL'SSE2584' VARMSG
     C                     CALL 'SUBR23R3'SUBR23
     C                     MOVELTEXT      SEC584 30
     C*
     C***GET*MES.*JYSKE*BANK*******************************************   S01496
     C***********          MOVEL'SSE2585' VARMSG                          S01496
     C***********          CALL 'SUBR23R3'SUBR23                          S01496
     C***********          MOVELTEXT      SEC585 40                       S01496
     C***********                                                         S01496
     C***GET*MES.*HERRN************************************************   S01496
     C***********          MOVEL'SSE2587' VARMSG                          S01496
     C***********          CALL 'SUBR23R3'SUBR23                          S01496
     C***********          MOVELTEXT      SEA,01 35                       S01496
     C***********                                                         S01496
     C***GET*MES.*FRAU*************************************************   S01496
     C***********          MOVEL'SSE2588' VARMSG                          S01496
     C***********          CALL 'SUBR23R3'SUBR23                          S01496
     C***********          MOVELTEXT      SEA,02 35                       S01496
     C***********                                                         S01496
     C***GET*MES.*FRAEULEIN********************************************   S01496
     C***********          MOVEL'SSE2589' VARMSG                          S01496
     C***********          CALL 'SUBR23R3'SUBR23                          S01496
     C***********          MOVELTEXT      SEA,03 35                       S01496
     C***********                                                         S01496
     C***GET*MES.*HERREN***********************************************   S01496
     C***********          MOVEL'SSE2590' VARMSG                          S01496
     C***********          CALL 'SUBR23R3'SUBR23                          S01496
     C***********          MOVELTEXT      SEA,04 35                       S01496
     C***********                                                         S01496
     C***GET*MES.*HERRN*UND*FRAU***************************************   S01496
     C***********          MOVEL'SSE2591' VARMSG                          S01496
     C***********          CALL 'SUBR23R3'SUBR23                          S01496
     C***********          MOVELTEXT      SEA,05 35                       S01496
     C*
     C** GET MES. MR
     C                     MOVEL'SSE2592' VARMSG
     C                     CALL 'SUBR23R3'SUBR23
     C**********           MOVELTEXT      SEA,06 35                                         BUG10701
     C                     MOVELTEXT      SEA,06                                            BUG10701
     C*
     C** GET MES. MRS
     C                     MOVEL'SSE2593' VARMSG
     C                     CALL 'SUBR23R3'SUBR23
     C**********           MOVELTEXT      SEA,07 35                                         BUG10701
     C                     MOVELTEXT      SEA,07                                            BUG10701
     C*
     C** GET MES. MISS
     C                     MOVEL'SSE2594' VARMSG
     C                     CALL 'SUBR23R3'SUBR23
     C**********           MOVELTEXT      SEA,08 35                                         BUG10701
     C                     MOVELTEXT      SEA,08                                            BUG10701
     C*
     C***GET*MES.*MESSRS***********************************************   S01496
     C***********          MOVEL'SSE2595' VARMSG                          S01496
     C***********          CALL 'SUBR23R3'SUBR23                          S01496
     C***********          MOVELTEXT      SEA,09 35                       S01496
     C*
     C** GET MES. MR AND MRS
     C                     MOVEL'SSE2596' VARMSG
     C                     CALL 'SUBR23R3'SUBR23
     C**********           MOVELTEXT      SEA,10 35                                         BUG10701
     C                     MOVELTEXT      SEA,10                                            BUG10701
     C*
     C***GET*MES.*HR.**************************************************   S01496
     C***********          MOVEL'SSE2597' VARMSG                          S01496
     C***********          CALL 'SUBR23R3'SUBR23                          S01496
     C***********          MOVELTEXT      SEA,11 35                       S01496
     C***********                                                         S01496
     C***GET*MES.*FRU**************************************************   S01496
     C***********          MOVEL'SSE2598' VARMSG                          S01496
     C***********          CALL 'SUBR23R3'SUBR23                          S01496
     C***********          MOVELTEXT      SEA,12 35                       S01496
     C***********                                                         S01496
     C***GET*MES.*FRK.*************************************************   S01496
     C***********          MOVEL'SSE2599' VARMSG                          S01496
     C***********          CALL 'SUBR23R3'SUBR23                          S01496
     C***********          MOVELTEXT      SEA,13 35                       S01496
     C***********                                                         S01496
     C***GET*MES.*HERRER***********************************************   S01496
     C***********          MOVEL'SSE2600' VARMSG                          S01496
     C***********          CALL 'SUBR23R3'SUBR23                          S01496
     C***********          MOVELTEXT      SEA,14 35                       S01496
     C***********                                                         S01496
     C***GET*MES.*HR.*OG*FRU*******************************************   S01496
     C***********          MOVEL'SSE2601' VARMSG                          S01496
     C***********          CALL 'SUBR23R3'SUBR23                          S01496
     C***********          MOVELTEXT      SEA,15 35                       S01496
     C***********                                                         S01496
     C***GET*MES.*HR.*OG*FRU*******************************************   S01496
     C***********          MOVEL'SSE2044' VARMSG                          S01496
     C***********          CALL 'SUBR23R3'SUBR23                          S01496
     C***********          MOVELTEXT      SEC044 17                       S01496
     C***********          MOVELTEXT      DUP044 17                       S01496
      * GET MES. ACCOUNTHOLDER:                                           CA9303
     C                     MOVEL'SSE1043' VARMSG                          CA9303
     C                     CALL 'SUBR23R3'SUBR23                          CA9303
     C                     MOVELTEXT      SEA043 40                       CA9303
     C*
     C                     ENDSR
     ******************************************************************
      /EJECT
     ******************************************************************
     C* P003   : TERMINATION PROCESSING                               *
     ******************************************************************
     C*
     C           P003      BEGSR
     C*                                                                   S01496
     C**  If no confirmations produced, then print audit.                 S01496
     C*                                                                   S01496
     C           *IN31     IFEQ '0'                                       S01496
     C                     OPEN SE6850AU                                  S01496
     C                     EXSR RCFAU                                     S01496
     C                     WRITEHEADAU                                    S01496
     C                     WRITENODTLS                                    S01496
     C                     CLOSESE6850AU                                  S01496
     C                     ELSE                                           S01496
     C                     CLOSESE6850P1                                  S01496
     C                     END                                            S01496
     C*
     C** RETURN OUT OF THE PROGRAM
     C                     MOVE '1'       *INLR
     C                     RETRN
     C*
     C           EP003     ENDSR
     C*****************************************************************
      /EJECT
     C********************************************************************
     C*                                                                  *
     C*  ARRAY  Sub routine to print confirmation                        *
     C*                                                                  *
     C********************************************************************
     C**
     C           ARRAY     BEGSR
     C*
     C** PREPARE NOMINAL AND CURRENCY
     C                     MOVEAIN        AR01
     C                     Z-ADD1         X       20
     C*
     C           X         DOWLE50
     C*
     C           AR01,X    IFEQ ' '
     C           AR01,X    OREQ '0'
     C                     ADD  1         X
     C                     ELSE
     C                     MOVEAAR01,X    OUT    50
     C                     Z-ADD51        X
     C                     END
     C                     END
     C*
     C                     ENDSR
     C*****************************************************************
     C/COPY WNCPYSRC,SE6850C006
      /EJECT
     ******************************************************************
     C* *PSSR : STANDARD DATABASE ERROR PROCESSING
     ******************************************************************
     C           *PSSR     BEGSR
     C*
     C** UPDATE LDA WITH ERROR INFORMATION
     C           *NAMVAR   DEFN           LDA
     C           *LOCK     IN   LDA
     C                     MOVELDBFILE    WWFILE
     C                     MOVELDBKEY     WWKEY
     C                     MOVELDBPGM     WWPGM
     C                     MOVELDBASE     WWASE
     C                     OUT  LDA
     C*
     C                     ROLBK
     C*                                                                   S01496
     C                     OPEN SE6850AU                                  S01496
     C                     EXSR RCFAU                                     S01496
     C                     WRITEHEADAU                                    S01496
     C                     WRITEERRORAU                                   S01496
     C                     CLOSESE6850AU                                  S01496
     C*                                                                   S01496
     C           *IN31     IFEQ '1'                                       S01496
     C                     WRITEDBERROR                                   S01496
     C                     END                                            S01496
     C*
     C** PRINT DUMP AND CANCEL PROGRAM
     C                     DUMP
     C*
     C                     MOVE '1'       *INU7
     C                     MOVE '1'       *INU8
     C*
     C** RETURN OF CURRENT PROGRAM
     C                     MOVE '1'       *INLR
     C                     RETRN
     C*
     C                     ENDSR
     C**********************************************************************
      /EJECT
     C*****************************************************************   S01496
     C*                                                                   S01496
     C*  RCFP1 -- Subroutine to register P1 report via RCF                S01496
     C*                                                                   S01496
     C*****************************************************************   S01496
     C*                                                                   S01496
     C           RCFP1     BEGSR                            ** RCFP1 **   S01496
     C*                                                                   S01496
     C**  If held mail, then change spooled file name.                    S01496
     C*                                                                   S01496
     C           VEHMIN    IFEQ 'Y'                                       S01496
     C                     MOVEL'SE6850H1'SFILE                           S01496
     C                     END                                            S01496
     C*                                                                   S01496
     C**  Ensure report spool file is recorded by RCF.                    S01496
     C*                                                                   S01496
     C           @RENT     IFNE *BLANKS                                   S01496
     C                     MOVE VEBRCD    SENTY                           S01496
     C                     END                                            S01496
     C*                                                                   S01496
     C                     Z-ADDSFNUM     ZSNUM   60                      S01496
     C                     CALL 'ZSFILE'                                  S01496
     C                     PARM           @RSEQ                           S01496
     C                     PARM           SENTY   3                       S01496
     C                     PARM           SFILE                           S01496
     C                     PARM           ZSNUM                           S01496
     C                     PARM           ZSERR   1                       S01496
     C*                                                                   S01496
     C**  Error during ZSFILE processing, return to calling program.      S01496
     C*                                                                   S01496
     C           ZSERR     IFEQ 'Y'                                       S01496
     C                     SETON                     U7U8LR               S01496
     C                     RETRN                                          S01496
     C                     END                                            S01496
     C*                                                                   S01496
     C                     ENDSR                                          S01496
     C*                                                                   S01496
     C*****************************************************************   S01496
     C/EJECT                                                              S01496
     C*****************************************************************   S01496
     C*                                                                   S01496
     C*  RCFAU -- Subroutine to register AU report via RCF                S01496
     C*                                                                   S01496
     C*****************************************************************   S01496
     C*                                                                   S01496
     C           RCFAU     BEGSR                            ** RCFAU **   S01496
     C*                                                                   S01496
     C**   Ensure audit spool file is recorded by RCF.                    S01496
     C*                                                                   S01496
     C                     Z-ADDSFNUMU    ZSNUMU  60                      S01496
     C                     CALL 'ZSFILE'                                  S01496
     C                     PARM           @RSEQ                           S01496
     C                     PARM *BLANKS   SENTY                           S01496
     C                     PARM           SFILEU                          S01496
     C                     PARM           ZSNUMU                          S01496
     C                     PARM           ZSERR                           S01496
     C*                                                                   S01496
     C**  Error during ZSFILE processing, return to calling program.      S01496
     C*                                                                   S01496
     C           ZSERR     IFEQ 'Y'                                       S01496
     C                     SETON                     U7U8LR               S01496
     C                     RETRN                                          S01496
     C                     END                                            S01496
     C*                                                                   S01496
     C                     ENDSR                                          S01496
     C*                                                                   S01496
     C*****************************************************************   S01496
     C/EJECT                                                              S01496
     C********************************************************************
     C**
     C**   ZDATE2 SR. TO CONVERT A DAY NUMBER TO DATE FORMATS.
     C**
     C**   THE YEAR 2000, BEING DIVISIBLE BY 400, IS A LEAP YEAR.
     C**
     C           ZDATE2    BEGSR                           *** ZDATE2 ***
     C**
     C**   CLEAR LEAP YEAR WORK FIELD.
     C                     MOVE 'N'       ZLEAP   1
     C**
     C**   CLEAR DATE FIELDS.
     C                     Z-ADD0         ZDATE   60
     C                     MOVEL'       ' ZADATE  7
     C**
     C**   CALCULATION TO DEFINE INPUT DAY NUMBER.
     C                     Z-ADDZDAYNO    ZDAYNO  50
     C**
     C**   DETERMINE YEAR NUMBER.
     C**
     C**   ADJUST DAY NUMBER IN CASE LAST DAY OF YEAR.
     C           ZDAYNO    SUB  1         ZDAYN1  50
     C           ZDAYN1    IFLT 0
     C                     GOTO ZDEND2
     C                     END
     C**
     C**   CALCULATE NUMBER OF 4 YEAR SPANS SINCE 31/12/1971.
     C           ZDAYN1    DIV  1461      ZLYR    20
     C                     MVR            ZDAYN1           SAVE REMAINING
     C**                                                   DAYS
     C**   CALCULATE NUMBER OF REMAINING YEARS.
     C                     Z-ADD1         ZWRK2   20
     C           ZDTAG1    TAG                             ** ZDTAG1 TAG *
     C           ZDAYN1    IFGE ZYDY,ZWRK2
     C           ZWRK2     ADD  1         ZWRK2
     C                     GOTO ZDTAG1
     C                     END
     C*
     C           ZWRK2     SUB  1         ZWRK2
     C**
     C**   DECREMENT DAY NO. BY DAYS IN REMAINING YEARS.
     C           ZWRK2     IFNE 0
     C           ZDAYN1    SUB  ZYDY,ZWRK2ZDAYN1
     C                     END
     C**
     C**   CALCULATE ACTUAL YEAR NUMBER.
     C           ZLYR      MULT 4         ZWRK3   30
     C           ZWRK3     ADD  72        ZWRK3            BASE IS 1972
     C                     Z-ADDZWRK3     ZYEAR   20
     C           ZYEAR     ADD  ZWRK2     ZYEAR            YEAR
     C**
     C**   DETERMINE MONTH NUMBER.
     C**
     C**   ADJUST DAY NO. IN CASE LAST DAY OF LEAP YEAR FEBRUARY.
     C           ZWRK2     IFEQ 0
     C           ZDAYN1    IFEQ 59
     C                     MOVE 'Y'       ZLEAP
     C                     END
     C           ZDAYN1    IFGE 59
     C           ZDAYN1    SUB  1         ZDAYN1
     C                     END
     C                     END
     C**
     C**   CALCULATE MONTH NUMBER.
     C                     Z-ADD2         ZWRK2
     C           ZDTAG2    TAG                             ** ZDTAG2 TAG *
     C           ZDAYN1    IFGE ZMDY,ZWRK2
     C           ZWRK2     ADD  1         ZWRK2
     C                     GOTO ZDTAG2
     C                     END
     C*
     C           ZWRK2     SUB  1         ZWRK2
     C**
     C                     Z-ADDZWRK2     ZMTH    20       MONTH
     C**
     C**   DETERMINE DAY OF MONTH.
     C**
     C**   ADD BACK LAST DAY OF YEAR ADJUSTMENT.
     C           ZDAYN1    ADD  1         ZDAYN1
     C**
     C**   CALCULATE DAY OF MONTH.
     C           ZDAYN1    SUB  ZMDY,ZWRK2ZDAY    20       DAY
     C**
     C**   ADD BACK LEAP YEAR 29TH FEBUARY ADJUSTMENT, IF REQUIRED.
     C           ZLEAP     IFEQ 'Y'
     C           ZDAY      ADD  1         ZDAY
     C                     END
     C**
     C**   FORMAT DATE, DDMMYY OR MMDDYY.
     C  N98                MOVELZDAY      ZWRK4   40
     C   98                MOVE ZDAY      ZWRK4
     C  N98                MOVE ZMTH      ZWRK4
     C   98                MOVELZMTH      ZWRK4
     C                     MOVELZWRK4     ZDATE
     C                     MOVE ZYEAR     ZDATE
     C**
     C**   FORMAT ALPHA DATE, DDMMMYY.
     C                     MOVELZDAY      ZWRK5   5
     C           ZDAY      IFLT 10
     C                     MOVEL' '       ZWRK5
     C                     END
     C                     MOVE ZMNM,ZMTH ZWRK5
     C                     MOVELZWRK5     ZADATE
     C                     MOVE ZYEAR     ZADATE
     C**
     C           ZDEND2    ENDSR                           * ZDEND2 ENDSR*
     C**
     C**
     C********************************************************************
      /EJECT
     C********************************************************************
     C********************************************************************
     C**                                                                 *
     C** ZSEDIT subroutine to insert a decimal point and sign into a     *
     C** numeric field and to blank out leading zeros (optionaly         *
     C** inserting commas).                                              *
     C**     Input fields:   ZFLD15 15/0                                 *
     C**                     ZDECS  1/0                                  *
     C**                     ZECODE 1/  ('J', 'L' or blank)              *
     C**                                                                 *
     C**     Arrays:         ZS1    15/1/0                               *
     C**                     ZS2    21/1/                                *
     C**                                                                 *
     C**     Output fields:  ZOUT21 21                                   *
     C**                                                                 *
     CSR         ZSEDIT    BEGSR                           **  ZSEDIT   *
     C*
     C* Define/Clear fields
     C*
     C                     Z-ADDZFLD15    ZFLD15 150
     C                     Z-ADDZDECS     ZDECS   10
     C                     MOVE ZECODE    ZECODE  1
     C                     MOVE *BLANKS   ZOUT21 21
     C*
     C*       SET UP WORK FIELDS
     C*
     C                     Z-ADD0         ZS1
     C                     MOVE ' '       ZS2
     C*
     C                     Z-ADD15        Z1      20
     C                     Z-ADD20        Z2      20
     C*
     C           15        SUB  ZDECS     ZINTS   20
     C*
     C* Check if numeric field is negative
     C*
     C           ZFLD15    IFLT *ZEROS
     C                     MOVE '-'       ZS2,21
     C                     Z-SUBZFLD15    ZFLD15
     C                     END
     C*
     C                     Z-ADDZFLD15    WORK15
     C*
     C*       CHECK TO SEE IF THERE ARE ANY DECIMAL PLACES
     C*
     C           ZDECS     CABEQ0         ZS10
     C*
     C*       SET UP DECIMALS
     C*
     C                     Z-ADD*ZEROS    ZCNT    10
     C           ZCNT      DOUEQZDECS
     C                     MOVE ZS1,Z1    ZS2,Z2
     C                     SUB  1         Z2
     C                     ADD  1         ZCNT
     C                     SUB  1         Z1
     C                     END
     C*
     C*       PUT IN DECIMAL PLACE
     C*
     C                     MOVE '.'       ZS2,Z2
     C                     SUB  1         Z2
     C*
     C           ZS10      TAG                             ** ZS10 TAG **
     C*
     C*       SET UP INTEGERS
     C*
     C                     Z-ADD*ZEROS    CNT3    10
     C           Z1        DOUEQ*ZEROS
     C                     MOVE ZS1,Z1    ZS2,Z2
     C                     SUB  1         Z1
     C                     SUB  1         Z2
     C*
     C* If edit code is 'J', insert a ',' before each group of three
     C* digits - not if beginning of array reached.
     C*
     C           Z2        IFGT *ZEROS
     C           ZECODE    ANDEQ'J'
     C                     ADD  1         CNT3
     C           CNT3      IFEQ 3
     C                     MOVE ','       ZS2,Z2
     C                     SUB  1         Z2
     C                     Z-ADD*ZEROS    CNT3
     C                     END
     C                     END
     C*
     C                     END
     C*
     C*       PUT IN LEADING BLANKS
     C*
     C                     Z-ADD1         Z2
     C           ZS2,Z2    DOWEQ'0'
     C           ZS2,Z2    OREQ ' '
     C           ZS2,Z2    OREQ ','
     C                     MOVE ' '       ZS2,Z2
     C                     ADD  1         Z2
     C           Z2        CABEQ22        ZS20
     C                     END
     C*
     C*       IF NO INTEGERS PUT IN LEADING ZERO
     C*
     C           ZS20      TAG                             ** ZS20 TAG **
     C*
     C           Z2        IFEQ 22
     C                     SUB  2         Z2
     C                     MOVE '0'       ZS2,Z2
     C                     ELSE
     C*
     C           ZS2,Z2    IFEQ '.'
     C                     SUB  1         Z2
     C                     MOVE '0'       ZS2,Z2
     C                     END
     C                     END
     C*
     C*       SET UP OUTPUT FIELD
     C*
     C                     MOVEAZS2       ZOUT21
     C*
     CSR                   ENDSR
     C**************************************************************************
      /EJECT
     C**************************************************************************
     C*                                                                        *
     C*  ZAPNUM - CALCULATE AP NUMERATOR                                       *
     C*                                                                        *
     C*  PURPOSE : TO MULTIPLY A NOMINAL POSITION BY THE PRICE OF THE          *
     C*  POSITION TO GIVE A VALUE OF THE POSITION WITH THE CORRECT NUMBER      *
     C*  OF DECIMAL PLACES FOR THE NOMINAL CURRENCY                            *
     C*                                                                        *
     C*  INPUT  FIELDS                                                         *
     C*       ZNOML  11 0     NOMINAL                                          *
     C*       ZAVPR  15 8     AVERAGE PRICE                                    *
     C*       ZNMDP   1 0     NOMINAL DECIMAL PLACES (0-4)                     *
     C*       ZNMCD   1 0     NOMINAL CURRENCY DECIMAL PLACES (0-3)            *
     C*       ZPRCB   1 A     PRICE BASIS (P/U)                                *
     C*                                                                        *
     C*  OUTPUT  FIELDS                                                        *
     C*       ZVALU  15 0     VALUE                                            *
     C*                                                                        *
     C*  ALSO REQUIRED                                                         *
     C*       POWER8 ARRAY OF MULTIPLYING FACTORS FOR NOMINAL DECIMAL PLACES   *
     C*                                                                        *
     C*  WORK FIELDS:                                                          *
     C*       ZVAL0  15 0 - AVERAGE PRICE WITH 0 DECIMAL PLACES                *
     C*       ZVAL1  15 1 - --------------- '' ----------------                *
     C*       ZVAL2  15 2 - --------------- '' ----------------                *
     C*       ZVAL3  15 3 - --------------- '' ----------------                *
     C*       ZI      1 0 - POWER ARRAY                                        *
     C*                                                                        *
     C*  CALLED FROM:                                                          *
     C*                                                                        *
     C*************************************************************************
     C           ZAPNUM    BEGSR                           *** ZAPNUM ***
     C*
     C** DEFINE ALL FIELDS
     C                     Z-ADDZNOML     ZNOML  110
     C                     Z-ADDZAVPR     ZAVPR  158
     C                     Z-ADDZNMDP     ZNMDP   10
     C                     Z-ADDZNMCD     ZNMCD   10
     C                     MOVE ZPRCB     ZPRCB   1
     C                     Z-ADDZVALU     ZVALU  150
     C*
     C** IF NUMBER OF CURRENCY DECIMAL PLACES I = 0
     C           ZNMCD     IFEQ 0
     C           ZNOML     MULT ZAVPR     ZVAL0  150H
     C                     MOVE ZVAL0     ZVALU
     C                     END
     C*
     C** IF NUMBER OF CURRENCY DECIMAL PLACES I = 1
     C           ZNMCD     IFEQ 1
     C           ZNOML     MULT ZAVPR     ZVAL1  151H
     C                     MOVE ZVAL1     ZVALU
     C                     END
     C*
     C** IF NUMBER OF CURRENCY DECIMAL PLACES I = 2
     C           ZNMCD     IFEQ 2
     C           ZNOML     MULT ZAVPR     ZVAL2  152H
     C                     MOVE ZVAL2     ZVALU
     C                     END
     C*
     C** IF NUMBER OF CURRENCY DECIMAL PLACES I = 3
     C           ZNMCD     IFEQ 3
     C           ZNOML     MULT ZAVPR     ZVAL3  153H
     C                     MOVE ZVAL3     ZVALU
     C                     END
     C*
     C** SET INDEX ZI EQUAL TO 5 -. NOMINAL DECIMAL PLACES )
     C           5         SUB  ZNMDP     ZI      10
     C*
     C** MULTIPLY ZVALU BY  POWER8,ZI TO GET AMOUNT WITH NOMINAL DECIMAL PLACES
     C           ZVALU     MULT POWER8,ZI ZVALU
     C*
     C** PRICE BASIS IF = PERCENTAGE
     C           ZPRCB     IFEQ 'P'
     C           ZVALU     DIV  100       ZVALU     H
     C                     END
     C*
     C                     ENDSR
     C*************************************************************************
     C/COPY WNCPYSRC,SE6850C007
      /EJECT
     C*************************************************************************
     C*                                                                   S01496
     C**  SE6850P3 & SE685P3 changed to SE6850P1 & SE6850H1 and           S01496
     C**  GBLZUSRMSG changed to GBSEUSRMSG in CMD                         S01496
     C*                                                                   S01496
**  CPY@
(c) Misys International Banking Systems Ltd. 2001
**  CMD  - QCMDEXC ARRAY
OVRPRTF FILE(SE6850P1) SPLFNAME(SE6850P1)
OVRPRTF FILE(SE6850P1) SPLFNAME(SE6850H1)
OVRMSGF MSGF(QUSERMSG) TOMSGF(GBSEUSRMSG)
**   ZYDY - YEARS IN DAYS CUMULATIVE, FOUR YEAR SPAN
0366073110961461
**   ZMDY - MONTHS IN DAYS CUMULATIVE THROUGH YEAR
000031059090120151181212243273304334365
**   ZMNM - MONTHS SHORT NAMES
JANFEBMARAPRMAYJUNJULAUGSEPOCTNOVDEC
**  POWER8 - ARRAY OF POWERS FOR CURRENCY CONVERSION
00000001
00000010
00000100
00001000
00010000
00100000
01000000
10000000
**  IND  - INDICATOR ARRAY FOR ADRESS                                     CA9301
ABCDEFGHIJKLMNOPQRSTUVWXYZ
