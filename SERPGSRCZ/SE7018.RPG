     H        1
      *****************************************************************
/*STD *  RPGBASE                                                      *
/*EXI *  TEXT('Midas SE Market Migration - SOBDMVD')
      *****************************************************************
      *                                                               *
      *  Midas - Securities Trading Module                            *
      *                                                               *
      *  SE7018  - Market Migration Market Change - SOBDMVD           *
      *                                                               *
      *  (c) Finastra International Limited 2001                      *
      *                                                               *
      *  Function:  Market Migration of SOBDMVD file. File will not be*
      *  (I/C)      updated if a transaction/position already exists  *
      *             in the secondary market and all other updates will*
      *             rolled back.                                      *
      *                                                               *
      *  Called by: SEC7018                                           *
      *                                                               *
      *  Last Amend No. MD046248           Date 27Oct17               *
      * Bank Fusion Midas 1.4 Base -----------------------------------*
      * Midas Plus 1.4 Base 04 ---------------------------------------*
      * Midas Plus 1.4 Base ------------------------------------------*
      * Midas Plus 1.3 ----------- Base ------------------------------*
      *  Prev Amend No. CSD027             Date 09Dec05               *
      * Midas Release 4.01.01 ----------------------------------------*
      *                 207006             Date 18Jun02               *
      * Midas Release 4 --------------- Base -------------------------*
      * Midas DBA 3.02 -----------------------------------------------*
      *                 CSE015 *Create     Date 06Dec99               *
      *                                                               *
      *---------------------------------------------------------------*
      *                                                               *
      *  MD046248 - Finastra Rebranding                               *
      *  CSD027 - Conversion Of Customer Number to Alpha              *
      *  207006 - Add Counterparty & Market Centre to SSI (Recompile) *
      *  CSE015 - Forward Valued Depot Movement                       *
      *                                                               *
      *****************************************************************
     FSOBDMVD UF  E                    DISK         KCOMIT
      *
      *****************************************************************
      *  FUNCTION OF INDICATORS                                       *
      *                                                               *
      *  10 - File read error detected                                *
      *  LR - Last record                                             *
      *  U7 - Database error                                          *
      *  U8 - File out of balance                                     *
      *                                                               *
      *****************************************************************
     E                    CPY@    1   1 80
      *****************************************************************
     ICPYR@#      DS
      ** Data structure for compilation - copyright insertion
      *
     I                                        1  80 CPY@
     I                                        1  20 CPY@##
      *
     IPSDS       SDS
      ** Program status data structure
      *
     I                                      244 253 @JOB
     I                                      254 263 @USR
      *
     ILDA         DS                            256
      ** Local data area for database error details
      *
     I                                      134 183 DBLOT
     I                                      134 141 DBFILE
     I                                      142 170 DBKEY
     I                                      171 180 DBPGM
     I                                      181 1830DBASE
      *
      /EJECT
      *================================================================
      *  P R O G R A M     S T A R T
      *================================================================
      *
     C           *ENTRY    PLIST
     C                     PARM           WMARK   1
      *
      ** Prepare LDA
      *
     C           *NAMVAR   DEFN           LDA
     C           *LOCK     IN   LDA
     C                     MOVEL*BLANK    DBLOT
     C                     MOVEL'SE7018'  DBPGM
     C                     Z-ADD0         DBASE
     C                     OUT  LDA
      *
     C                     READ SOBDMVDF               10LR
      *
     C           *IN10     DOWEQ'0'
     C           *INLR     ANDEQ'0'
     C           DPMK      IFEQ 'S'
     C                     MOVE '1'       *IN10
     C                     ELSE
     C                     MOVE WMARK     DPMK
     C                     EXCPTMARKET
     C                     READ SOBDMVDF               10LR
     C                     ENDIF
     C                     ENDDO
      *
     C           *IN10     IFEQ '1'
     C           *LOCK     IN   LDA                        ************
     C                     MOVE 'SOBDMVD' DBFILE           * DBERR  1 *
     C                     Z-ADD1         DBASE            ************
     C                     OUT  LDA
     C                     SETON                     U7U8LR
     C                     EXSR *PSSR
     C                     ENDIF
      *
     C                     RETRN
      *****************************************************************
      /EJECT
      *****************************************************************
      *                                                               *
      *  *PSSR  - Error control subroutine                            *
      *                                                               *
      *****************************************************************
     C           *PSSR     BEGSR
      *
     C           @RUN      IFEQ *BLANKS
     C                     MOVE 'Y'       @RUN    1
     C                     DUMP
     C                     ENDIF
      *
     C                     ENDSR
      *****************************************************************
      /EJECT
     OSOBDMVDFE                MARKET
     O                         DPMK
**  CPY@
(c) Finastra International Limited 2001
