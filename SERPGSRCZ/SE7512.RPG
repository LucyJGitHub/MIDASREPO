000100200529     H        1
000200200529      *****************************************************************
000300200529/*XBI *: OVRDBF FILE(SECTYZ1) TOFILE(SECTY) SHARE(*NO)              : *
000400200529/*STD *  RPGBASE                                                      *
000500200529/*EXI *  TEXT('Midas SE Corporate actions depot selection')           *
000600200529      *****************************************************************
000700200529      *                                                               *
000800200529      *  Midas - Securities Trading Module                            *
000900200529      *                                                               *
001000200529      *  SE7512  - SE Corporate Actions - Depot Maintenance           *
001100200529      *                                                               *
001200200529      *  (c) Finastra International Limited 2001                      *
001300200529      *                                                               *
001800200619      *  Last Amend No. MD046248           Date 27Oct17               *
001900200619      *  PREV Amend No. CER059             Date 19Jul10               *
002000200529      *                 CER020             Date 19May08               *
002100200529      * Bank Fusion Midas 1.4 Base -----------------------------------*
002200200529      * Midas Plus 1.4 Base 04 ---------------------------------------*
002300200529      * Midas Plus 1.4 Base ------------------------------------------*
002400200529      * Midas Plus 1.3 ----------- Base ------------------------------*
002500200529      *                 CSD031             Date 10Apr06               *
002600200529      *                 CSD027             Date 09Dec05               *
002700200529      *                 CSE071             Date 19Jul05               *
002800200529      *                 CSW037A            Date 02May05               *
002900200529      *                 CSD025             Date 11Jan05               *
003000200529      *                 CSW037             Date 15Dec04               *
003100200529      *                 CSW036             Date 15Dec04               *
003200200529      *                 CLE025             Date 20Oct03               *
003300200529      *                 CSC023             Date 28Jan04               *
003400200529      * Midas Release 4 --------------- Base -------------------------*
003500200529      *                 CPK014             Date 14Nov01               *
003600200529      *                 189119             Date 12Jul01               *
003700200529      *                 190204             Date 31May01               *
003800200529      * Midas DBA 3.05 -----------------------------------------------*
003900200529      *                 184520             Date 16Nov00               *
004000200529      * Midas DBA 3.03 -----------------------------------------------*
004100200529      *                 CSE020             Date 21Mar00               *
004200200529      *                 161732             Date 21Mar00               *
004300200529      * Midas DBA 3.01 -----------------------------------------------*
004400200529      *                 164022             Date 13Jul99               *
004500200529      * Midas DBA 3.00 ---------------- Base -------------------------*
004600200529      *                 162284             Date 10Jun99               *
004700200529      *                 159908             Date 29Apr99               *
004800200529      *                 159517             Date 22Apr99               *
004900200529      *                 156532             Date 08Mar99               *
005000200529      *                 155622             Date 23Feb99               *
005100200529      *                 137877             Date 06Jul98               *
005200200529      *                 136935             Date 27Jul98               *
005300200529      *                 144398             Date 07Oct98               *
005400200529      *                 137879             Date 01Jul98               *
005500200529      *                 136930             Date 17Jun98               *
005600200529      *                 135690             Date 08Jun98               *
005700200529      *                 136428             Date 15Jun98               *
005800200529      *                 135689             Date 02Jun98               *
005900200529      *                 135685             Date 28May98               *
006000200529      *                 CEU017             Date 05Mar98               *
006100200529      *                 CSE007 *Create     Date 01Dec97               *
006200200529      *                                                               *
006300200529      *---------------------------------------------------------------*
006400200529      *                                                               *
008300200529      *  MD046248 - Finastra Rebranding                               *
008400200529      *  CER059 - German Feature Upgrade to Delhi                     *
008500200529      *  CER020 - Enhanced Rollover Window: Upgrade FGE089 to         *
008600200529      *           Midas Plus (Recompile)                              *
008700200529      *  CSD031 - Enhanced Centralised Static Data (Recompile)        *
008800200529      *  CSD027 - Conversion Of Customer Number to Alpha              *
008900200529      *  CSE071 - Multiple Holidays Re Securities (recompile)         *
009000200529      *  CSW037A- Additional Field extended to 40 chars (recompile)   *
009100200529      *  CSD025 - Customer De-Activation                              *
009200200529      *  CSW037 - Additional Field Data on MT300/MT320                *
009300200529      *  CSW036 - Dual SWIFT BIC held on Client Details               *
009400200529      *  CLE025 - Credit Lines (Recompile)                            *
009500200529      *  CSC023 - SBMJOB output queue must be *JOBD.                  *
009600200529      *  CPK014 - Submit jobs with user *JOBD                         *
009700200529      *  189119 - Allow allocation against a CA if Dummy customer     *
009800200529      *           position is not zero after warning operator.        *
009900200529      *  190204 - MDDIVU replaced by MDDIV1 in PF/SECODVPD.           *
010000200529      *  184520 - Do not allow allocation if dummy customer has       *
010100200529      *           position in CPOSN.                                  *
010200200529      *  CSE020 - Corporate Actions Domino Effect Processing          *
010300200529      *  161732 - Corporate Actions Exercise and Conversion -         *
010400200529      *           Part Stock/Keep Rest Calculation                    *
010500200529      *           (Recompiled due to changes in PF/SECOEXPD)          *
010600200529      *  164022 - no reply necessary for DV type 'C' or 'S'           *
010700200529      *  162284 - Don't validate if Mkt Price is 0 on SE7507          *
010800200529      *  159908 - Corporate Actions: Impossible to authorise a type   *
010900200529      *           'CR' with Status 'L' (Allocated) and Final Alloc.  *
011000200529      *           Indicator 'S' (Stock)                              *
011100200529      *  159517 - Corporate Actions: Allow Allocation run of a Rights *
011200200529      *           Issue even if the details from the rights tradable  *
011300200529      *           screen are not yet completely filled.               *
011400200529      *           These details must be filled before setting Final   *
011500200529      *           Allocation Indicator to 'Y'.                        *
011600200529      *  156532 - Corporate Actions: Invalid Action Code ...          *
011700200529      *  155622 - Corporate Actions: In case of multiple options,     *
011800200529      *           'Default No Reply' & 'Default Cash/Stock Preferred' *
011900200529      *           fields must be filled before action code 'L' valid. *
012000200529      *  137877 - Corporate Actions: Reply Handling amendments and    *
012100200529      *           review some validations when specific action taken  *
012200200529      *  136935 - Corporate Actions: Allocation processing amendments:*
012300200529      *           1. Correct error during control for requested stage *
012400200529      *              according to Processing Type.                    *
012500200529      *           2. For Stock Dividend, allow authorisation even if  *
012600200529      *              Market Ex Price and Subscription Price equal 0.  *
012700200529      *  144398 - Complete fix 137879                                 *
012800200529      *  137879 - Add validation on Authorisation (SPF)               *
012900200529      *  136930 - EMU and Corporate Actions: various errors:          *
013000200529      *           - Blink on confirmation screen Ex-Date Position if  *
013100200529      *             different from Allocation detail file and Depot   *
013200200529      *             Position file.                                    *
013300200529      *  135690 - Various errors for Corporate Actions:               *
013400200529      *           - For processing type Dividend Events, allow the    *
013500200529      *             entry of 'MARKET' on Subscription Price, which    *
013600200529      *             will use the Market Price of the Security minus   *
013700200529      *             Discount at allocation effective date.            *
013800200529      *  136428 - Recompile due to addition of Days Basis and Divisor *
013900200529      *           Basis field in SECORBPD.                            *
014000200529      *  135689 - Corporate Actions and EMU                           *
014100200529      *           (1) For 'CR', field 'Cash Payment' no more mandatory*
014200200529      *           (2) Status on PF/SECORBPD must never be reset to 'I'*
014300200529      *           (3) Review validation for the run of the allocation *
014400200529      *               on processing type 'DV' - Dividend Events       *
014500200529      *  135685 - It's not feasible to enter the Compensation Price   *
014600200529      *           at the Bulk level as the Bulk will have many        *
014700200529      *           Securities all giving a cash compensation at a      *
014800200529      *           different level. Therefore, allow the entry of      *
014900200529      *           'MARKET' which will use the Market Price of the     *
015000200529      *           Security at allocation effective date.              *
015100200529      *  CEU017 - Securities Redenomination Euro Changes              *
015200200529      *  CSE007 - Corporate Actions                                   *
015300200529      *                                                               *
015400200529      *****************************************************************
015500200529      /EJECT
015600200529      *       FILE DEFINITIONS
015700200529      *      ------------------
015800200529      *
015900200529      **   Midas SE Securities - Details
016000200529     FSECTYZ1 IF  E           K        DISK
016100200529     F                                              KINFSR *PSSR
016200200529      *
016300200529      **   Midas SE Depot Positions - Current and Historic
016400200529     FSEDPOHL0IF  E           K        DISK
016500200529     F                                              KINFSR *PSSR
016600200529      *
016700200529      **   Midas Corporate Actions - Depots update index
016800200529     FSECODPL1IF  E           K        DISK
016900200529     F                                              KINFSR *PSSR
017000200529      *
017100200529      **   Midas Corporate Actions - Depots Update index
017200200529     FSECODRL0UF  E           K        DISK                      A
017300200529     F                                              KINFSR *PSSR
017400200529     F                                              KCOMIT
017500200529      *
017600200529      **   MA - SE CORPORATE ACTIONS References - Upd Idx
017700200529     FSECORFL0UF  E           K        DISK                      A
017800200529     F                                              KINFSR *PSSR
017900200529     F                                              KCOMIT
018000200529      *
018100200529      **   MC - SE CORPORATE ACTIONS - Allocations
018200200529     FSECOALL7UF  E           K        DISK         KINFSR *PSSR A
018300200529     F                                              KCOMIT
018400200529      *                                                                   CSE020
018500200529      **   Midas SE Corporate Actions - Stock Allocations                 CSE020
018600200529     FSECOALL5IF  E           K        DISK                               CSE020
018700200529     F            SECOALD0                          KRENAMESECOALD5       CSE020
018800200529     F                                              KINFSR *PSSR          CSE020
018900200529      *                                                                   CSE020
019000200529      **   Midas SE Corporate Actions References - Rtv Idx                CSE020
019100200529     FSECORFL1UF  E           K        DISK                               CSE020
019200200529     F            SECORFD0                          KRENAMESECORFD1       CSE020
019300200529     F                                              KINFSR *PSSR          CSE020
019400200529      *                                                                   CSE020
019500200529      **   Midas SE Corporate Actions References - Rtv Idx                CSE020
019600200529     FSECORFPMIF  E                    DISK                               CSE020
019700200529     F                                              KINFSR *PSSR          CSE020
019800200529      *                                                                   CSE020
019900200529      **   Midas SE Corporate Actions - Name Changes                      CSE020
020000200529     FSECONCL1IF  E           K        DISK         KINFSR *PSSR          CSE020
020100200529      *                                                                   CSE020
020200200529      **   Midas SE Corporate Actions - Name Changes                      CSE020
020300200529     FSECODPL5UF  E           K        DISK         KINFSR *PSSR          CSE020
020400200529     F            SECODPD0                          KRENAMESECODPD5       CSE020
020500200529      *
020600200529      **   MD - SE CORPORATE ACTIONS - Dividends
020700200529     FSECODVL1IF  E           K        DISK
020800200529     F                                              KINFSR *PSSR
020900200529      *
021000200529      **   ME - SE CORPORATE ACTIONS - Free Allocations
021100200529     FSECOFRL1IF  E           K        DISK
021200200529     F                                              KINFSR *PSSR
021300200529      *
021400200529      **   MF - SE CORPORATE ACTIONS - Rights
021500200529     FSECORGL1IF  E           K        DISK
021600200529     F                                              KINFSR *PSSR
021700200529      *
021800200529      **   MG - SE CORPORATE ACTIONS - Capital events
021900200529     FSECOCEL1IF  E           K        DISK
022000200529     F                                              KINFSR *PSSR
022100200529      *
022200200529      **   MH - SE CORPORATE ACTIONS - Corporate Reorganisation
022300200529     FSECOCRL1IF  E           K        DISK
022400200529     F                                              KINFSR *PSSR
022500200529      *
022600200529      **   MI - SE CORPORATE ACTIONS - Offers
022700200529     FSECOOFL1IF  E           K        DISK
022800200529     F                                              KINFSR *PSSR
022900200529      *
023000200529      **   MJ - SE CORPORATE ACTIONS - Exercises and Conversions
023100200529     FSECOEXL1IF  E           K        DISK
023200200529     F                                              KINFSR *PSSR
023300200529      *                                                                   159517
023400200529      **  SE Corporate Actions - Exercises and Conversions                159517
023500200529     FSECOEXL2IF  E           K        DISK                               159517
023600200529     F            SECOEXD0                          KRENAMESECOEXD2       159517
023700200529     F                                              KINFSR *PSSR          159517
023800200529      *                                                                   CEU017
023900200529      **   NA - SE CORPORATE ACTIONS - Curreny Changes                    CEU017
024000200529     FSECOCCL2IF  E           K        DISK                               CEU017
024100200529     F                                              KINFSR *PSSR          CEU017
024200200529      *                                                                   CEU017
024300200529      **  NB - Securities Redenomination Bulk Details - Updt Index        CEU017
024400200529     FSECORBL0UF  E           K        DISK         KCOMIT                CEU017
024500200529     F                                              KINFSR *PSSR          CEU017
024600200529      *
024700200529      **  Customer position file.                                         184520
024800200529     FCPOSN   IF  E           K        DISK                               184520
024900200529      **   Display file
025000200529     FSE7512DFCF  E                    WORKSTN
025100200529     F                                              KINFSR *PSSR
025200200529     F                                              KINFDS SCRDS
025300200529     F                                        #1RRN KSFILE SE7512S1
025400200529      *****************************************************************
025500200529      /EJECT
025600200529      ********************************************************************
025700200529      *
025800200529      ** Array for copyright.
025900200529     E                    CPY@    1   1 80
026000200529      *
026100200529      ** Text messages for command keys.
026200200529     E***********         TXT     1   4 78                                CSE020
026300200529     E                    TXT     1   5 78                                CSE020
026400200529      *
026500200529      **  Array for testing MHMKTP                                               162284
026600200529      *                                                                          162284
026700200529     E                    AR1        20 10                                       162284
026800200529     E                    AR8        20 16                                       162284
026900200529      *                                                                   CSE020
027000200529      ** Array for the New Securities                                     CSE020
027100200529      *                                                                   CSE020
027200200529     E                    NSEC      180 10                                CSE020
027300200529      *
027400200529     E/COPY ZSRSRC,ZSEDITZ1
027500200529     E/COPY ZSRSRC,ZDATE2Z1
027600200529     E/COPY ZSRSRC,ZASIGNZ1
027700200529      *
027800200529      ** Array for Security Shortnames
027900200529     E                    SSARR      20 10
028000200529      *
028100200529     E                    CMD     1   3 80               SBMJOB
028200200529      *
028300200529     E                    NARR    1   3 24
028400200529      *
028500200529      ********************************************************************
028600200529      /EJECT
028700200529      *****************************************************************
028800200529     ISECOALD5                                                            CSE020
028900200529      ** Rename fields of SECOALL5: Midas SE CA - Stock Allocations       CSE020
029000200529      *                                                                   CSE020
029100200529     I              MCRECI                          M5RECI                CSE020
029200200529     I              MCLCD                           M5LCD                 CSE020
029300200529     I              MCCHTP                          M5CHTP                CSE020
029400200529     I              MCLUID                          M5LUID                CSE020
029500200529     I              MCCORF                          M5CORF                CSE020
029600200529     I              MCOPTN                          M5OPTN                CSE020
029700200529     I              MCBRCD                          M5BRCD                CSE020
029800200529     I              MCDDPT                          M5DDPT                CSE020
029900200529     I              MCCOTP                          M5COTP                CSE020
030000200529     I              MCBOOK                          M5BOOK                CSE020
030100200529     I              MCCNUM                          M5CNUM                CSE020
030200200529     I              MCPTFR                          M5PTFR                CSE020
030300200529     I              MCEXPO                          M5EXPO                CSE020
030400200529     I              MCSESN                          M5SESN                CSE020
030500200529     I              MCOALR                          M5OALR                CSE020
030600200529     I              MCOTSA                          M5OTSA                CSE020
030700200529     I              MCOSTR                          M5OSTR                CSE020
030800200529     I              MCOCAR                          M5OCAR                CSE020
030900200529     I              MCCAOP                          M5CAOP                CSE020
031000200529     I              MCASTA                          M5ASTA                CSE020
031100200529     I              MCHOST                          M5HOST                CSE020
031200200529     I              MCHOCA                          M5HOCA                CSE020
031300200529     I              MCACAA                          M5ACAA                CSE020
031400200529     I              MCASTR                          M5ASTR                CSE020
031500200529     I              MCACAR                          M5ACAR                CSE020
031600200529     I              MCOPT1                          M5OPT1                CSE020
031700200529     I              MCOPT2                          M5OPT2                CSE020
031800200529     I              MCREST                          M5REST                CSE020
031900200529     I              MCBSEC                          M5BSEC                CSE020
032000200529     I              MCBEDT                          M5BEDT                CSE020
032100200529     I              MCBSTT                          M5BSTT                CSE020
032200200529     I              MCBLTY                          M5BLTY                CSE020
032300200529     I              MCBEWI                          M5BEWI                CSE020
032400200529     I              MCCOAT                          M5COAT                CSE020
032500200529     I              MCTRRF                          M5TRRF                CSE020
032600200529     I              MCTRR2                          M5TRR2                CSE020
032700200529     I              MCTRR3                          M5TRR3                CSE020
032800200529     I              MCRVRF                          M5RVRF                CSE020
032900200529     I              MCRVR2                          M5RVR2                CSE020
033000200529     I              MCRVR3                          M5RVR3                CSE020
033100200529     I              MCTNL1                          M5TNL1                CSE020
033200200529     I              MCLTRQ                          M5LTRQ                CSE020
033300200529     I              MCTOTF                          M5TOTF                CSE020
033400200529     I              MCTOTT                          M5TOTT                CSE020
033500200529     ISECORFD1                                                            CSE020
033600200529      ** Rename fields of SECORFL1: Midas SE CA - References              CSE020
033700200529      *                                                                   CSE020
033800200529     I              MARECI                          MNRECI                CSE020
033900200529     I              MALCD                           MNLCD                 CSE020
034000200529     I              MACHTP                          MNCHTP                CSE020
034100200529     I              MALUID                          MNLUID                CSE020
034200200529     I              MACORF                          MNCORF                CSE020
034300200529     I              MAJOBN                          MNJOBN                CSE020
034400200529     I              MAUSER                          MNUSER                CSE020
034500200529     I              MAJNBR                          MNJNBR                CSE020
034600200529     I              MASESN                          MNSESN                CSE020
034700200529     I              MACOAT                          MNCOAT                CSE020
034800200529     I              MAPTYP                          MNPTYP                CSE020
034900200529     I              MACOAN                          MNCOAN                CSE020
035000200529     I              MACOEX                          MNCOEX                CSE020
035100200529     I              MAALEF                          MNALEF                CSE020
035200200529     I              MANBOP                          MNNBOP                CSE020
035300200529     I              MATDVD                          MNTDVD                CSE020
035400200529     I              MACOPD                          MNCOPD                CSE020
035500200529     I              MATDDT                          MNTDDT                CSE020
035600200529     I              MAEVDT                          MNEVDT                CSE020
035700200529     I              MACPNB                          MNCPNB                CSE020
035800200529     I              MASHMD                          MNSHMD                CSE020
035900200529     I              MALTBS                          MNLTBS                CSE020
036000200529     I              MAOCPV                          MNOCPV                CSE020
036100200529     I              MANCPV                          MNNCPV                CSE020
036200200529     I              MAONML                          MNONML                CSE020
036300200529     I              MANNML                          MNNNML                CSE020
036400200529     I              MACUPC                          MNCUPC                CSE020
036500200529     I              MAEXPC                          MNEXPC                CSE020
036600200529     I              MACLRD                          MNCLRD                CSE020
036700200529     I              MACLRT                          MNCLRT                CSE020
036800200529     I              MADLRD                          MNDLRD                CSE020
036900200529     I              MADLRT                          MNDLRT                CSE020
037000200529     I              MABLOS                          MNBLOS                CSE020
037100200529     I              MABLOP                          MNBLOP                CSE020
037200200529     I              MABFRD                          MNBFRD                CSE020
037300200529     I              MABEND                          MNBEND                CSE020
037400200529     I              MAREFO                          MNREFO                CSE020
037500200529     I              MACONR                          MNCONR                CSE020
037600200529     I              MADFNR                          MNDFNR                CSE020
037700200529     I              MADFCP                          MNDFCP                CSE020
037800200529     I              MADFSP                          MNDFSP                CSE020
037900200529     I              MALREQ                          MNLREQ                CSE020
038000200529     I              MALPRO                          MNLPRO                CSE020
038100200529     I              MALTSI                          MNLTSI                CSE020
038200200529     I              MASTAT                          MNSTAT                CSE020
038300200529     I              MAPREF                          MNPREF                CSE020
038400200529     ISECORFM0                                                            CSE020
038500200529      ** Rename fields of SECORFPM: Midas SE CA - References              CSE020
038600200529      *                                                                   CSE020
038700200529     I              MARECI                          MORECI                CSE020
038800200529     I              MALCD                           MOLCD                 CSE020
038900200529     I              MACHTP                          MOCHTP                CSE020
039000200529     I              MALUID                          MOLUID                CSE020
039100200529     I              MACORF                          MOCORF                CSE020
039200200529     I              MAJOBN                          MOJOBN                CSE020
039300200529     I              MAUSER                          MOUSER                CSE020
039400200529     I              MAJNBR                          MOJNBR                CSE020
039500200529     I              MASESN                          MOSESN                CSE020
039600200529     I              MACOAT                          MOCOAT                CSE020
039700200529     I              MAPTYP                          MOPTYP                CSE020
039800200529     I              MACOAN                          MOCOAN                CSE020
039900200529     I              MACOEX                          MOCOEX                CSE020
040000200529     I              MAALEF                          MOALEF                CSE020
040100200529     I              MANBOP                          MONBOP                CSE020
040200200529     I              MATDVD                          MOTDVD                CSE020
040300200529     I              MACOPD                          MOCOPD                CSE020
040400200529     I              MATDDT                          MOTDDT                CSE020
040500200529     I              MAEVDT                          MOEVDT                CSE020
040600200529     I              MACPNB                          MOCPNB                CSE020
040700200529     I              MASHMD                          MOSHMD                CSE020
040800200529     I              MALTBS                          MOLTBS                CSE020
040900200529     I              MAOCPV                          MOOCPV                CSE020
041000200529     I              MANCPV                          MONCPV                CSE020
041100200529     I              MAONML                          MOONML                CSE020
041200200529     I              MANNML                          MONNML                CSE020
041300200529     I              MACUPC                          MOCUPC                CSE020
041400200529     I              MAEXPC                          MOEXPC                CSE020
041500200529     I              MACLRD                          MOCLRD                CSE020
041600200529     I              MACLRT                          MOCLRT                CSE020
041700200529     I              MADLRD                          MODLRD                CSE020
041800200529     I              MADLRT                          MODLRT                CSE020
041900200529     I              MABLOS                          MOBLOS                CSE020
042000200529     I              MABLOP                          MOBLOP                CSE020
042100200529     I              MABFRD                          MOBFRD                CSE020
042200200529     I              MABEND                          MOBEND                CSE020
042300200529     I              MAREFO                          MOREFO                CSE020
042400200529     I              MACONR                          MOCONR                CSE020
042500200529     I              MADFNR                          MODFNR                CSE020
042600200529     I              MADFCP                          MODFCP                CSE020
042700200529     I              MADFSP                          MODFSP                CSE020
042800200529     I              MALREQ                          MOLREQ                CSE020
042900200529     I              MALPRO                          MOLPRO                CSE020
043000200529     I              MALTSI                          MOLTSI                CSE020
043100200529     I              MASTAT                          MOSTAT                CSE020
043200200529     I              MAPREF                          MOPREF                CSE020
043300200529     I              MALEVL                          MOLEVL                CSE020
043400200529      *                                                                   CSE020
043500200529      *                                                                   184520
043600200529     ISDSTRD    E DSSDSTRDPD                                              184520
043700200529      *                                                                   184520
043800200529     ISCRDS       DS
043900200529     I                                    B 378 3790CPFPOS
044000200529      *
044100200529      **  Data Structure for compilation - Copyright insertion
044200200529     ICPYR@$      DS
044300200529     I                                        1  80 CPY@
044400200529     I                                        1  20 CPY@$$
044500200529      *
044600200529      **  Data Structure for command string for QCMDEXC
044700200529     ICMDTXT      DS                            240
044800200529     I                                       12  20 @CJOB
044900200529     I                                       14  19 @REF
045000200529     I                                       20  20 @ACTI
045100200529     I                                       72  77 @REFN
045200200529     I                                       81 160 CMDTX2                                    CPK014
045300200529     I                                      161 240 CMDTX3                                    CPK014
045400200529     I                                       83  85 @BRCD
045500200529     I                                       91  96 @DEPT
045700200529      *
045800200529      **  Program status data structure
045900200529     IPSDS       SDS
046000200529     I                                     *PROGRAM ##PGM
046100200529     I                                      244 253 JOB
046200200529     I                                      254 263 USER
046300200529      *
046400200529      **  Parameters for Allocation report
046500200529     I@PARM       DS                            100
046600200529     I                                        1   1 DDSLAL
046700200529     I                                        2   7 DDREFN
046800200529     I                                        8   9 DDOPTN
046900200529     I                                       10  12 DDBRC
047000200529     I                                       13  18 DDDEP
047100200529      *
047200200529      **  Local data area for database error details
047300200529      **  *LOCK IN LDA immediately before and OUT LDA immediately
047400200529      **  after each database error handling.
047500200529     ILDA         DS                            256
047600200529     I                                      134 141 WWFILE
047700200529     I                                      142 170 WWKEY
047800200529     I                                      171 180 WWPGM
047900200529     I                                      181 1830WWASE
048000200529      *
048100200529      **  Date formatting data structure
048200200529     IUPDATE      DS
048300200529     I                                        1   2 CADAY
048400200529     I                                        3   5 CAMON
048500200529     I                                        6   7 CAYER
048600200529      *                                                                   144398
048700200529     IZMUSER      DS                             17                       144398
048800200529      ** Data area ZMUSER                                                 144398
049000200529     I                                       11  13 BVBRCD                144398
049100200529      *
049200200529      **  Standard Data Area Layout for System flags and Run Date
049300200529     IRUNDAT    E DS
049400200529      *
049500200529      **  Bank Details
049600200529     ISDBANK    E DSSDBANKPD
049700200529      *                                                                   S01117
049800200529      **  Customer Details                                                S01117
049900200529     ISDCUST    E DSSDCUSTPD                                              S01117
050000200529      *
050100200529      **  Second DS for access programs, long data structure
050200200529     IDSSDY     E DSDSSDY
050300200529      *
050400200529     I/COPY ZSRSRC,ZSEDITZ2
050500200529      *
050600200529      /EJECT
050700200529      *****************************************************************
050800200529      * Main Processing
050900200529      *****************************************************************
051000200529      *
051100200529      **  Entry parameters
051200200529     C           *ENTRY    PLIST
051300200529     C                     PARM           WWREFN  6        ER Reference
051400200529     C                     PARM           WWSECN 10        Security Shortname
051500200529     C                     PARM           WWCOAT  2        Corporate Action Type
051600200529     C                     PARM           WWPTYP  2        Processing Type
051700200529     C                     PARM           WWEXDT  5        Ex-Date
051800200529     C                     PARM           WWNBOP  2        Number of options
051900200529     C                     PARM           WWMODE  1        Amend or Enquiry ?
052000200529     C                     PARM           WWGSTS  1        General Status
052100200529     C                     PARM           WWRTCD  1        Return Code
052200200529      *
052300200529      ** Initial processing
052400200529     C                     EXSR P001
052500200529      *
052600200529      ** Set 'First Time' flag to 'Y'
052700200529     C                     MOVE 'Y'       FIRST   1
052800200529      *
052900200529      ** Do until F3 or F12
053000200529     C           *INKC     DOUEQ'1'                         B*1
053100200529     C           *INKL     OREQ '1'
053200200529      *
053300200529      ** If 'FIRST TIME' = 'Y'
053400200529     C           FIRST     IFEQ 'Y'                         B*2
053500200529      *
053600200529      ** Clear messages from program message quque.
053700200529     C                     CALL 'Y2CLMSC'
053800200529     C                     PARM ##PGM     ZAPGM  10
053900200529     C                     PARM '*SAME'   ZAPGRL  5
054000200529      *
054100200529      ** Build the subfile
054200200529     C                     EXSR P002
054300200529      *
054400200529      ** Set first time flag to 'N'
054500200529     C                     MOVE 'N'       FIRST
054600200529     C                     ENDIF
054700200529      *
054800200529      ** Write SE6512DF on screen
054900200529     C           WWCPT     IFEQ 0
055000200529     C                     Z-ADD0         #1RRN
055100200529     C                     MOVEL'CO00001' ZAMSID
055200200529     C                     EXSR ZASNMS
055300200529     C                     ELSE
055400200529     C                     Z-ADD1         #1RRN
055500200529     C                     ENDIF
055600200529      *
055700200529     C           W#FLAG    IFNE 'Y'                                       CSE020
055800200529     C                     MOVE TXT,1     ##CTX1
055900200529     C                     MOVE '0'       *IN60                           CSE020
056000200529     C                     ELSE                                           CSE020
056100200529     C                     MOVE TXT,5     ##CTX1                          CSE020
056200200529     C                     MOVE '1'       *IN60                           CSE020
056300200529     C                     ENDIF                                          CSE020
056400200529      *
056500200529     C                     WRITESE7512C2
056600200529     C                     WRITESE7512C1
056700200529     C                     WRITESE7512F1
056800200529      *
056900200529      ** Read SE7512DF
057000200529     C           *INKC     IFEQ *OFF
057100200529     C                     READ SE7512F1                 89
057200200529     C                     MOVE ' '       WWRTCD
057300200529     C                     ENDIF
057400200529      *
057500200529      ** Clear messages from program message quque.
057600200529     C                     CALL 'Y2CLMSC'
057700200529     C                     PARM ##PGM     ZAPGM  10
057800200529     C                     PARM '*SAME'   ZAPGRL  5
057900200529      *
058000200529      ** If ENTER taken
058100200529     C           *INKC     IFEQ *OFF                       B*2
058200200529     C           *INKL     ANDEQ*OFF
058300200529     C           *INKE     ANDEQ*OFF
058400200529     C           #1RRN     ANDNE0
058500200529      *
058600200529      ** Validate subfile records as per P003.
058700200529     C                     EXSR P003
058800200529     C                     ENDIF
058900200529      *
059000200529      ** If F3 taken
059100200529      ** OR If F12 taken
059200200529     C           *INKC     IFEQ *ON
059300200529     C           *INKL     OREQ *ON
059400200529      *
059500200529     C           WWCPT     IFNE 0
059600200529      *
059700200529      ** Access LF/SECODRL0 and read all records with same corporate
059800200529      ** action reference
059900200529     C           WWREFN    SETLLSECODRL0
060000200529     C           WWREFN    READESECODRL0                 89
060100200529      *
060200200529     C           *IN89     IFEQ '0'
060300200529     C                     MOVE MSCOST    WWCOST  1
060400200529     C                     MOVE MSCOST    WLCOST  1
060500200529     C                     ELSE
060600200529     C                     MOVE 'I'       WWCOST
060700200529     C                     MOVE 'I'       WLCOST
060800200529     C                     ENDIF
060900200529      *
061000200529     C                     MOVE 'Y'       WWSAME  1
061100200529     C                     MOVE 'Y'       WFIRST  1
061200200529      *
061300200529     C           *IN89     DOWEQ'0'
061400200529      *
061500200529     C           MSCOST    IFNE WWCOST
061600200529     C                     MOVE 'N'       WWSAME
061700200529     C                     ENDIF
061800200529      *
061900200529     C           MSCOST    IFNE WLCOST
062000200529      *
062100200529     C           MSCOST    IFEQ 'I'
062200200529     C                     MOVE 'I'       WLCOST
062300200529     C                     ENDIF
062400200529      *
062500200529     C           MSCOST    IFEQ 'L'
062600200529     C           WLCOST    ANDNE'I'
062700200529     C                     MOVE 'L'       WLCOST
062800200529     C                     ENDIF
062900200529      *
063000200529     C           MSCOST    IFEQ 'S'
063100200529     C           WLCOST    ANDNE'L'
063200200529     C           WLCOST    ANDNE'I'
063300200529     C                     MOVE 'S'       WLCOST
063400200529     C                     ENDIF
063500200529      *
063600200529     C           MSCOST    IFEQ 'X'
063700200529     C           WLCOST    ANDNE'L'
063800200529     C           WLCOST    ANDNE'I'
063900200529     C           WLCOST    ANDNE'S'
064000200529     C                     MOVE 'X'       WLCOST
064100200529     C                     ENDIF
064200200529      *
064300200529     C                     ENDIF
064400200529      *
064500200529     C           WWREFN    READESECODRL0                 89
064600200529     C                     ENDDO
064700200529      *
064800200529     C                     ELSE
064900200529     C                     MOVE 'I'       WWCOST
065000200529     C                     MOVE 'Y'       WWSAME
065100200529     C                     ENDIF
065200200529      *
065300200529      ** If all records have the same status, then update the status
065400200529      ** on PF/SECORFPD, else update it with the "lower" status found
065500200529     C           WWREFN    CHAINSECORFL0             89
065600200529     C           WWSAME    IFEQ 'Y'
065700200529     C                     MOVE WWCOST    MASTAT
065800200529     C                     UPDATSECORFD0
065900200529      *
066000200529     C           MAPTYP    IFEQ 'CC'                                      CEU017
066100200529     C           WWCOST    ANDNE'I'                                       135689
066200200529     C           MACORF    CHAINSECOCCL2             89                   CEU017
066300200529      *                                                                   CEU017
066400200529     C           *IN89     IFEQ '0'                                       CEU017
066500200529     C           NABLKR    ANDNE*ZEROS                                    CEU017
066600200529     C           NABLKR    CHAINSECORBL0             89                   CEU017
066700200529      *                                                                   CEU017
066800200529      **  Reverse matching record in LF/SECORBL0                          CEU017
066900200529     C                     MOVE WWCOST    NBSTAT                          CEU017
067000200529     C                     UPDATSECORBD0                                  CEU017
067100200529     C                     ENDIF                                          CEU017
067200200529     C                     ENDIF                                          CEU017
067300200529      *                                                                   CEU017
067400200529     C                     ELSE
067500200529     C           WLCOST    IFNE *BLANKS
067600200529     C                     MOVE WLCOST    MASTAT
067700200529      *
067800200529     C           MAPTYP    IFEQ 'CC'                                      CEU017
067900200529     C           WLCOST    ANDNE'I'                                       135689
068000200529     C           MACORF    CHAINSECOCCL2             89                   CEU017
068100200529      *                                                                   CEU017
068200200529     C           *IN89     IFEQ '0'                                       CEU017
068300200529     C           NABLKR    ANDNE*ZEROS                                    CEU017
068400200529     C           NABLKR    CHAINSECORBL0             89                   CEU017
068500200529      *                                                                   CEU017
068600200529      **  Reverse matching record in LF/SECORBL0                          CEU017
068700200529     C                     MOVE WLCOST    NBSTAT                          CEU017
068800200529     C                     UPDATSECORBD0                                  CEU017
068900200529     C                     ENDIF                                          CEU017
069000200529     C                     ENDIF                                          CEU017
069100200529      *                                                                   CEU017
069200200529     C                     ELSE
069300200529     C                     MOVE 'I'       MASTAT
069400200529     C                     ENDIF
069500200529     C                     UPDATSECORFD0
069600200529     C                     ENDIF
069700200529      *
069800200529     C                     MOVE MASTAT    WWGSTS           General Status
069900200529      *
070000200529     C                     ENDIF
070100200529      *
070200200529      ** If F3 taken
070300200529     C           *INKC     IFEQ *ON
070400200529     C                     MOVE '3'       WWRTCD
070500200529      *
070600200529      ** Comit changed records.
070700200529     C                     COMIT
070800200529     C                     ENDIF
070900200529      *
071000200529      ** If F12 taken
071100200529     C           *INKL     IFEQ *ON
071200200529     C                     MOVE '2'       WWRTCD
071300200529      *
071400200529      ** Comit changed records.
071500200529     C                     COMIT
071600200529     C                     ENDIF
071700200529      *
071800200529      ***  If F5:Refresh taken
071900200529     C           *INKE     IFEQ *ON
072000200529      *
072100200529      ***  Clear messages from program message queue.
072200200529     C                     CALL 'Y2CLMSC'
072300200529     C                     PARM ##PGM     ZAPGM  10
072400200529     C                     PARM '*SAME'   ZAPGRL  5
072500200529      *
072600200529      ***  Re-build Subfile.
072700200529     C                     MOVE *BLANKS   DDACN
072800200529     C                     MOVE *BLANKS   W#FLAG                          CSE020
072900200529     C                     MOVEA'000'     *IN,50
073000200529     C                     EXSR P002
073100200529     C                     ENDIF
073200200529      *
073300200529     C                     ENDDO
073400200529      *
073500200529      ** Return to SE7502
073600200529     C                     MOVE *ON       *INLR
073700200529     C                     RETRN
073800200529      *
073900200529      *****************************************************************
074000200529      * P001   : Initial Processing                                   *
074100200529      *****************************************************************
074200200529      *
074300200529     C           P001      BEGSR
074400200529      *
074500200529      **   ONLY TO DECLARE THE FILE IN 'ADD' MODE
074600200529      *
074700200529     C           *IN99     IFEQ '0'                        B*1
074800200529     C           *IN99     ANDEQ'1'
074900200529     C                     WRITESECOALD0
075000200529     C                     ENDIF                           E*1
075100200529      *
075200200529      ** Copyright statement
075300200529     C                     MOVEACPY@      ACT@   80
075400200529      *
075500200529     C           WWMODE    IFEQ 'E'                        B*1
075600200529     C                     MOVE '1'       *IN40
075700200529     C                     ELSE                            X*1
075800200529     C                     MOVE '0'       *IN40
075900200529     C                     ENDIF                           E*1
076000200529      *
076100200529     C           WWPTYP    IFEQ 'NC'                       B*1
076200200529     C           WWPTYP    OREQ 'NF'
076300200529     C***********WWPTYP    OREQ 'CC'                                      CEU017
076400200529     C                     MOVE '1'       *IN41
076500200529     C                     ELSE                            X*1
076600200529     C                     MOVE '0'       *IN41
076700200529     C                     ENDIF                           E*1
076800200529      *
076900200529      ** Initialise key and work fields
077000200529     C                     MOVEL'SE7512  'DBPGM  10
077100200529      *
077200200529     C                     MOVE WWREFN    DDREFN           ER Reference
077300200529     C                     MOVE WWSECN    DDSECU           Security Shortname
077400200529     C                     MOVE WWCOAT    DDACTY           Corporate Action Type
077500200529     C                     MOVE WWNBOP    WWOPNB           Number of Options
077600200529      *
077700200529     C           WWEXDT    IFEQ *BLANKS
077800200529     C           WWEXDT    OREQ *ZEROS
077900200529     C                     MOVE *BLANKS   DDEXDT
078000200529     C                     ELSE
078100200529     C                     MOVE WWEXDT    ZDAYNO
078200200529     C                     EXSR ZDATE2
078300200529     C                     MOVE ZDATE     DDEXDT           Ex-Date
078400200529     C                     ENDIF
078500200529      *
078600200529      ** Setup screen time
078700200529     C                     TIME           ##TME   60       Screen time.
078800200529      *                                                                   144398
078900200529      **  Read in DTAARA/ZMUSER                                           144398
079000200529     C           *NAMVAR   DEFN           ZMUSER                          144398
079100200529     C                     IN   ZMUSER                                    144398
079200200529      *
079300200529     C           *NAMVAR   DEFN           RUNDAT
079400200529     C                     IN   RUNDAT
079500200529      *
079600200529      ** If first time program called
079700200529     C           FIRST     IFNE 'N'                        B*1
079800200529      *
079900200529     C                     CALL 'AOBANKR0'
080000200529     C                     PARM *BLANKS   WLRTCD  7
080100200529     C                     PARM '*FIRST'  WLOPTN  7
080200200529     C           SDBANK    PARM SDBANK    DSSDY
080300200529      *
080400200529      ** If record not found in SDBANKL1
080500200529     C           WLRTCD    IFNE *BLANKS
080600200529     C           *LOCK     IN   LDA
080700200529     C                     MOVEL'001'     DBASE   30       ***************
080800200529     C                     MOVE 'SDBANKPD'DBFILE 10        * DB ERROR 01 *
080900200529     C                     MOVEL*BLANKS   DBKEY  29        ***************
081000200529     C                     OUT  LDA
081100200529     C                     EXSR *PSSR
081200200529     C                     ENDIF                           E*2
081300200529      *
081400200529     C                     MOVELUSER      USIDXX
081500200529     C                     MOVELJOB       WSID
081600200529     C                     MOVE BJMRDT    ##MRDT           MIDAS RUN DATE
081700200529     C                     MOVE *OFF      *IN98
081800200529      *
081900200529      ** Retrieve Nominal Currency and Nominal Currency dec. places.
082000200529     C           WWSECN    CHAINSECTYZ1              30
082100200529      *
082200200529      ** No record found
082300200529     C           *IN30     IFEQ '1'
082400200529     C           *LOCK     IN   LDA
082500200529     C                     MOVEL'002'     DBASE            ***************
082600200529     C                     MOVE 'SECTYZ1 'DBFILE           * DB ERROR 02 *
082700200529     C                     MOVEL*BLANKS   DBKEY            ***************
082800200529     C                     OUT  LDA
082900200529     C                     EXSR *PSSR
083000200529      *
083100200529     C                     ELSE
083200200529     C                     MOVE NMCY      DDNCCY
083300200529     C                     Z-ADDNMDP      WNCDP   10
083400200529     C                     ENDIF                           E*2
083500200529     C                     ENDIF
083600200529      *
083700200529      ** Select the program MSGQ for error msg
083800200529     C                     MOVEL'*'       TOPQ   10
083900200529     C                     MOVEL'*PRV'    TOPRQ   5
084000200529     C                     MOVEL'SEUSRMSG'PMSGF  10
084100200529      *
084200200529      ** Fill in fields for subroutine ZASNMS
084300200529     C                     MOVEL'SE7512'  ZAPGM  10        Message queue
084400200529     C                     MOVEL'SEUSRMSG'ZAMSGF 10        Message file
084500200529     C                     MOVEL*BLANK    ZAPGRL  5        Rel queue
084600200529     C                     MOVEL*BLANK    ZAMSID  7        Message Id.
084700200529     C                     MOVEL*BLANK    ZAMSDA132        Message data.
084800200529     C                     MOVEL*BLANK    ZAMSTP  7        Message type.
084900200529      *
085000200529     C           WWREFN    CHAINSECORFL0             89
085100200529      *
085200200529      ** ONLY to declare the file in 'ADD' mode
085300200529     C           *IN89     IFEQ '0'                        B*1
085400200529     C           *IN89     ANDEQ'1'
085500200529     C                     WRITESECORFD0
085600200529     C                     ENDIF                           E*1
085700200529      *
085800200529      ** If CA is a child, obtain the Security from the Originating CA    CSE020
085900200529      *                                                                   CSE020
086000200529     C           MAPREF    IFNE *BLANKS                                   CSE020
086100200529     C           MAPREF    CHAINSECORFL1             71                   CSE020
086200200529     C           *IN71     IFEQ *ON                                       CSE020
086300200529     C           *LOCK     IN   LDA                                       CSE020
086400200529     C                     Z-ADD008       DBASE            ***************CSE020
086500200529     C                     MOVEL'SECORFL1'DBFILE           * DB ERROR 008*CSE020
086600200529     C                     MOVELMAPREF    DBKEY            ***************CSE020
086700200529     C                     OUT  LDA                                       CSE020
086800200529     C                     EXSR *PSSR                                     CSE020
086900200529     C                     ENDIF                                          CSE020
087000200529      *                                                                   CSE020
087100200529     C           MNPREF    DOWNE*BLANKS                                   CSE020
087200200529     C           MNPREF    CHAINSECORFL1             71                   CSE020
087300200529     C           *IN71     IFEQ *ON                                       CSE020
087400200529     C           *LOCK     IN   LDA                                       CSE020
087500200529     C                     Z-ADD009       DBASE            ***************CSE020
087600200529     C                     MOVEL'SECORFL1'DBFILE           * DB ERROR 009*CSE020
087700200529     C                     MOVELMNPREF    DBKEY            ***************CSE020
087800200529     C                     OUT  LDA                                       CSE020
087900200529     C                     EXSR *PSSR                                     CSE020
088000200529     C                     ENDIF                                          CSE020
088100200529     C                     ENDDO                                          CSE020
088200200529     C                     MOVE MNSESN    WOSESN 10                       CSE020
088300200529     C                     ENDIF                                          CSE020
088400200529      *                                                                   CSE020
088500200529      ** Access SAR Details file to determine if CSE020 is installed      CSE020
088600200529      *                                                                   CSE020
088700200529     C                     CALL 'AOSARDR0'                                CSE020
088800200529     C                     PARM *BLANKS   WRTCD   7                       CSE020
088900200529     C                     PARM '*VERIFY' WOPTN   7                       CSE020
089000200529     C                     PARM 'CSE020'  WSARD   6                       CSE020
089100200529      *                                                                   CSE020
089200200529      ** Handle Database Error                                            CSE020
089300200529      *                                                                   CSE020
089400200529     C           WRTCD     IFNE *BLANKS                                   CSE020
089500200529     C           WRTCD     ANDNE'*NRF   '                                 CSE020
089600200529     C           *LOCK     IN   LDA                                       CSE020
089700200529     C                     MOVEL'SCSARDPD'DBFILE           ***************CSE020
089800200529     C                     Z-ADD010       DBASE            *DB ERROR 010 *CSE020
089900200529     C                     MOVEL'CSE020  'DBKEY            ***************CSE020
090000200529     C                     OUT  LDA                                       CSE020
090100200529     C                     EXSR *PSSR                                     CSE020
090200200529     C                     ENDIF                                          CSE020
090300200529      *                                                                   CSE020
090400200529     C           WRTCD     IFEQ *BLANKS                                   CSE020
090500200529     C                     MOVEL'Y'       CSE020  1                       CSE020
090600200529     C                     ELSE                                           CSE020
090700200529     C                     MOVEL'N'       CSE020                          CSE020
090800200529     C                     ENDIF                                          CSE020
090900200529      *                                                                   CSE020
091000200529     C/COPY WNCPYSRC,SEH00024
091100200529      ** Find out the number of the dummy customer for corporate action   184520
091200200529      *  customers.                                                       184520
091300200529      ***  Call Access Program for Securities Trading Details.            184520
091400200529      *                                                                   184520
091500200529     C                     CALL 'AOSTRDR0'                                184520
091600200529     C                     PARM '*BLANKS' WRTCD   7                       184520
091700200529     C                     PARM '*FIRST ' WOPTN   7                       184520
091800200529     C           SDSTRD    PARM SDSTRD    DSSDY                           184520
091900200529      *                                                                   184520
092000200529      ***  If record not found, handle database error.                    184520
092100200529      *                                                                   184520
092200200529     C           WRTCD     IFNE *BLANKS                                   184520
092300200529     C           *LOCK     IN   LDA                                       184520
092400200529     C                     MOVEL'SDSTRDPD'DBFILE           ***************184520
092500200529     C                     MOVEL'*FIRST  'DBKEY            * DB ERROR 04 *184520
092600200529     C                     Z-ADD004       DBASE            ***************184520
092700200529     C                     MOVEL'SE7512'  DBPGM                           184520
092800200529     C                     OUT  LDA                                       184520
092900200529     C                     EXSR *PSSR                                     184520
093000200529     C                     ENDIF                                          184520
093100200529      *                                                                   184520
093200200529      ***  Retrieve Dummy Customer Number.                                184520
093300200529      *                                                                   184520
093400200529     C**********           MOVE BVERCU    WDUMMY  60                                   184520 CSD027
093500200529     C                     MOVE BVERCU    WDUMMY  6                                           CSD027
093600200529      *                                                                   184520
093700200529      ** Setup keylist to LF/CPOSNX                                       184520
093800200529     C           WKEY1     KLIST                                          184520
093900200529     C                     KFLD           WBRCD1  3                       184520
094000200529     C                     KFLD           WSESN1 10                       184520
094100200529     C**********           KFLD           WCDCN1  60                                   184520 CSD027
094200200529     C                     KFLD           WCDCN1  6                                           CSD027
094300200529      *                                                                   184520
094400200529     C                     ENDSR
094500200529      *
094600200529      *****************************************************************
094700200529      * P002   : Build the subfile                                    *
094800200529      *****************************************************************
094900200529      *
095000200529     C           P002      BEGSR
095100200529      *
095200200529      ** Clear subfile
095300200529     C                     MOVE *ON       *IN80
095400200529     C                     WRITESE7512C1
095500200529     C                     MOVE *OFF      *IN80
095600200529     C                     MOVE *OFF      *IN81
095700200529      *
095800200529     C                     Z-ADD0         SFLLEN  40
095900200529     C                     Z-ADD1         #1RRN
096000200529     C                     Z-ADD#1RRN     SFLRRN
096100200529     C                     MOVE *OFF      P002#1  1
096200200529      *
096300200529      ** Setup screen time
096400200529     C                     TIME           ##TME   60       Screen time.
096500200529      *
096600200529      ** Read first record from LF/SEDPOHL0
096700200529     C           *LOVAL    SETLLSEDPOHL0
096800200529     C                     READ SEDPOHL0                 30
096900200529      *
097000200529      ** If record read
097100200529     C           *IN30     IFEQ *OFF
097200200529     C           *LIKE     DEFN DSBA      WWDSBA
097300200529     C           *LIKE     DEFN DDPT      WWDDPT
097400200529     C           *LIKE     DEFN DSSC      WWDSSC
097500200529     C           *LIKE     DEFN DDTE      WWDDTE
097600200529     C           *LIKE     DEFN DDTE      WWDDT2
097700200529      *
097800200529      ** Save branch and depot
097900200529     C                     MOVELDSBA      WWDSBA
098000200529     C                     MOVELDDPT      WWDDPT
098100200529      *
098200200529     C                     Z-ADD0         WWCPT   20
098300200529      *                                                                   CSE020
098400200529      ** If CA is a child, save Security.                                 CSE020
098500200529      *                                                                   CSE020
098600200529     C           MAPREF    IFNE *BLANKS                                   CSE020
098700200529     C                     MOVE WWSECN    WKSESN 10                       CSE020
098800200529     C                     ENDIF                                          CSE020
098900200529      *
099000200529      ** Do while records read from LF/SEDPOHL0
099100200529     C           *IN30     DOWEQ*OFF
099200200529     C           WWCPT     ANDLT16
099300200529      *                                                                   CSE020
099400200529      ** If CA is a child, use the Security obtained from the             CSE020
099500200529      ** Originating CA before reading LF/SEDPOHL0.                       CSE020
099600200529      *                                                                   CSE020
099700200529     C           MAPREF    IFNE *BLANKS                                   CSE020
099800200529     C                     MOVE WOSESN    WWSECN                          CSE020
099900200529     C                     ENDIF                                          CSE020
100000200529      *
100100200529      ** Setup first keylist to LF/SEDPOHL0
100200200529     C           KEY1      KLIST
100300200529     C                     KFLD           WWDSBA
100400200529     C                     KFLD           WWDDPT
100500200529     C                     KFLD           WWSECN
100600200529     C                     KFLD           WWDDTE
100700200529      *
100800200529      ** Setup second keylist to LF/SEDPOHL0
100900200529     C           KEY2      KLIST
101000200529     C                     KFLD           WWDSBA
101100200529     C                     KFLD           WWDDPT
101200200529     C                     KFLD           WWDSSC
101300200529     C                     KFLD           WWDDT2
101400200529      *
101500200529     C                     MOVE WWEXDT    WWDDTE
101600200529     C                     MOVELWWSECN    WWDSSC
101700200529      *
101800200529      ** SETGT on LF/SEDPOHL0 with key of save Branch and Depot, and
101900200529      ** Security and Date.
102000200529     C           KEY1      SETGTSEDPOHL0
102100200529      *
102200200529      ** Read previous record on LF/SEDPOHL0
102300200529     C                     READPSEDPOHL0                 30
102400200529      *
102500200529      **  If multibranching is ON, check if the user is authorised
102600200529      **  to the branch
102700200529     C           AGMBIN    IFEQ 'Y'
102800200529     C                     CALL 'ZVBBU'
102900200529     C                     PARM DSBA      WLBRCH  3
103000200529     C                     PARM *ZEROS    WLERR   10
103100200529     C                     END
103200200529      *
103300200529     C           WLERR     IFEQ *ZEROS
103400200529      *
103500200529      ** If record read...
103600200529     C           *IN30     IFEQ *OFF
103700200529      *
103800200529      ** For the same Security, Branch and Depot
103900200529     C           DSSC      IFEQ WWSECN
104000200529     C           DSBA      ANDEQWWDSBA
104100200529     C           DDPT      ANDEQWWDDPT
104200200529      *
104300200529      ** Setup keylist to LF/SECODPL1
104400200529     C           KEY3      KLIST
104500200529     C                     KFLD           WWREFN  6
104600200529     C                     KFLD           WWOPNB  20
104700200529     C                     KFLD           WWDSBA
104800200529     C                     KFLD           WWDDPT
104900200529      *
105000200529      ** Access LF/SECODPL1
105100200529     C           KEY3      CHAINSECODPL1             89
105200200529     C                     MOVE *IN89     KEY3F   1
105300200529      *
105400200529      ** Setup keylist to LF/SECODRL0
105500200529     C           KEY4      KLIST
105600200529     C                     KFLD           WWREFN  6
105700200529     C                     KFLD           WWDSBA
105800200529     C                     KFLD           WWDDPT
105900200529      *
106000200529      ** Access LF/SECODRL0
106100200529     C           KEY4      CHAINSECODRL0            N89
106200200529     C                     MOVE *IN89     KEY4F   1
106300200529      *                                                                   CSE020
106400200529      ** If CA is a child, restore saved security before writing to       CSE020
106500200529      ** the subfile.                                                     CSE020
106600200529      *                                                                   CSE020
106700200529     C           MAPREF    IFNE *BLANKS                                   CSE020
106800200529     C                     MOVE WKSESN    WWSECN                          CSE020
106900200529     C                     ENDIF                                          CSE020
107000200529      *
107100200529      ** Write the subfile record as per U001
107200200529     C                     ADD  1         WWCPT
107300200529     C                     EXSR U001
107400200529      *
107500200529     C                     ENDIF
107600200529     C                     ENDIF
107700200529     C                     ENDIF
107800200529      *
107900200529      ** SETGT on LF/SEDPOHL0 with key of saved Branch and Depot,
108000200529      ** and Security and Date of *HIVAL.
108100200529     C                     MOVEL*HIVAL    WWDSSC
108200200529     C                     MOVEL*HIVAL    WWDDT2
108300200529      *
108400200529     C           KEY2      SETGTSEDPOHL0
108500200529      *
108600200529     C                     READ SEDPOHL0                 30
108700200529      *
108800200529     C           *IN30     IFEQ *OFF
108900200529     C                     MOVELDSBA      WWDSBA
109000200529     C                     MOVELDDPT      WWDDPT
109100200529     C                     ENDIF
109200200529      *
109300200529     C                     ENDDO
109400200529      *
109500200529      ** End of cycle
109600200529     C                     ENDIF
109700200529      *
109800200529      ** If CA is a child, restore saved Security of the child action.    CSE020
109900200529      *                                                                   CSE020
110000200529     C           MAPREF    IFNE *BLANKS                                   CSE020
110100200529     C                     MOVE WKSESN    WWSECN                          CSE020
110200200529     C                     ENDIF                                          CSE020
110300200529      *                                                                   CSE020
110400200529     C                     Z-ADD1         #1RRN
110500200529     C                     ENDSR
110600200529      *
110700200529      *****************************************************************
110800200529      * P003   : Validate subfile records                             *
110900200529      *****************************************************************
111000200529      *
111100200529     C           P003      BEGSR
111200200529      *
111300200529      ** Clear messages from program message queue.
111400200529     C                     CALL 'Y2CLMSC'
111500200529     C                     PARM ##PGM     ZAPGM  10
111600200529     C                     PARM '*SAME'   ZAPGRL  5
111700200529      *
111800200529      ** Read first subfile record
111900200529     C                     Z-ADD1         SFLRRN  40
112000200529      *
112100200529     C                     READCSE7512S1                 87
112200200529      *
112300200529      ** Do while records exist in subfile
112400200529     C           *IN87     DOWEQ*OFF
112500200529     C           *INKC     ANDEQ'0'
112600200529     C           *INKL     ANDEQ'0'
112700200529      *
112800200529      ** Reset error indicators
112900200529     C                     MOVE *OFF      *IN50
113000200529     C                     MOVE *OFF      *IN51
113100200529     C                     MOVE *OFF      *IN52
113200200529      *
113300200529     C                     MOVE *ON       *IN84            SFLNXTCHG
113400200529      *
113500200529      ** Set 'RECORD VALID' flag to 'Y'
113600200529     C                     MOVE 'Y'       #RECVA  1
113700200529     C                     MOVE *BLANKS   W#FLAG                          CSE020
113800200529      *
113900200529      ** Execute SR/V001 to validate details input.
114000200529     C                     EXSR V001
114100200529      *
114200200529     C           #RECVA    IFEQ 'N'
114300200529     C                     MOVE SHIN54    *IN54                           136930
114400200529     C                     UPDATSE7512S1
114500200529     C                     GOTO TAG1
114600200529     C                     ENDIF
114700200529      *
114800200529      ** If action indicator is changed
114900200529     C           DDACN     IFNE ' '
115000200529     C                     EXSR P004
115100200529      *
115200200529     C           #RECVA    IFEQ 'N'
115300200529     C                     MOVE SHIN54    *IN54                           136930
115400200529     C                     UPDATSE7512S1
115500200529     C                     GOTO TAG1
115600200529     C                     ENDIF
115700200529      *
115800200529     C                     ENDIF
115900200529      *
116000200529      ** If Status is changed...
116100200529      ** Or If Final Allocation is changed...
116200200529     C           DDSTS     IFNE DDSTSH
116300200529     C           DDFLA     ORNE DDFLAH
116400200529     C                     MOVE DDSTS     DDSTSH
116500200529     C                     MOVE DDFLA     DDFLAH
116600200529      *
116700200529      ** Update SECODRPD
116800200529     C                     EXSR P006
116900200529      *                                                                   CSE020
117000200529      ** Delete all allocation records of subordinates if F10 is pressed  CSE020
117100200529      *                                                                   CSE020
117200200529     C           *INKJ     IFEQ '1'                                       CSE020
117300200529     C                     EXSR SRDELT                                    CSE020
117400200529     C                     ENDIF                                          CSE020
117500200529      *                                                                   CSE020
117600200529     C                     ENDIF
117700200529      *
117800200529      ** Process action
117900200529     C           DDACN     IFNE ' '
118000200529     C                     EXSR P004A
118100200529     C                     ENDIF
118200200529      *
118300200529     C           #RECVA    IFEQ 'Y'
118400200529     C                     MOVE *BLANKS   DDACN
118500200529     C                     MOVE '0'       *IN84
118600200529     C                     MOVE SHIN54    *IN54                           136930
118700200529     C                     UPDATSE7512S1
118800200529     C                     ELSE
118900200529     C                     MOVE '1'       *IN84
119000200529     C                     MOVE SHIN54    *IN54                           136930
119100200529     C                     UPDATSE7512S1
119200200529     C                     ENDIF
119300200529      *
119400200529     C           TAG1      TAG
119500200529      *
119600200529     C                     WRITESE7512C2
119700200529      *
119800200529      ** Read next subfile record
119900200529     C                     READCSE7512S1                 87
120000200529     C                     ENDDO
120100200529      *
120200200529      ** Redisplay current screen
120300200529      *
120400200529     C           *INKC     IFEQ '0'
120500200529     C                     WRITESE7512C2
120600200529     C                     WRITESE7512C1
120700200529     C                     WRITESE7512F1
120800200529     C                     ENDIF
120900200529      *
121000200529     C                     ENDSR
121100200529      *
121200200529      *****************************************************************
121300200529      * P004   : Process 'Action'                                     *
121400200529      *****************************************************************
121500200529      *
121600200529     C           P004      BEGSR
121700200529      *
121800200529      ** If 'Action' is not ' ', 'A', 'E', 'L', 'X' or 'P', error.
121900200529     C           DDACN     IFNE ' '                        B*1
122000200529     C           DDACN     ANDNE'A'
122100200529     C           DDACN     ANDNE'E'
122200200529     C           DDACN     ANDNE'L'
122300200529     C           DDACN     ANDNE'X'
122400200529     C           DDACN     ANDNE'P'
122500200529     C           WWMODE    ANDEQ'A'
122600200529      *
122700200529     C           DDACN     ORNE ' '
122800200529     C           DDACN     ANDNE'E'
122900200529     C           WWMODE    ANDEQ'E'
123000200529      *
123100200529     C                     MOVE 'N'       #RECVA
123200200529     C                     MOVE *ON       *IN50
123300200529     C                     MOVEL'CO00192' ZAMSID
123400200529     C                     EXSR ZASNMS
123500200529      *
123600200529      ** 'Action' entered is valid...
123700200529     C                     ELSE                            X*1
123800200529      *
123900200529      ** If 'Action' is 'X'.
124000200529     C           DDACN     IFEQ 'X'                        B*2
133300200529      *                                                                   144398
133400200529      **  Check if user is authorised to action 'Authorisation'           144398
133500200529      *                                                                   144398
133600200529     C           AGMBIN    IFNE 'Y'                                       144398
133700200529      *                                                                   144398
133800200529      **  If single branch environment                                    144398
133900200529      *                                                                   144398
134000200529     C                     CALL 'ZVACTU'                                  144398
134100200529     C                     PARM 'X'       WLACTN  1                       144398
134200200529     C                     PARM *ZERO     WLERR   10                      144398
134300200529      *                                                                   144398
134400200529     C           WLERR     IFNE *ZERO                                     144398
134500200529     C                     MOVE 'N'       #RECVA                          144398
134600200529     C                     MOVE *ON       *IN50                           144398
134700200529     C                     MOVEL'CO00034' ZAMSID                          144398
134800200529     C                     EXSR ZASNMS                                    144398
134900200529     C                     ENDIF                                          144398
135000200529      *                                                                   144398
135100200529     C                     ELSE                                           144398
135200200529      *                                                                   144398
135300200529      **  If multibranching environment                                   144398
135400200529      *                                                                   144398
135500200529     C                     CALL 'ZVACTBU'                                 144398
135600200529     C                     PARM 'X'       WLACTN  1                       144398
135700200529     C                     PARM BVBRCD    WLBRCH  3                       144398
135800200529     C                     PARM *ZERO     WLERR   10                      144398
135900200529      *                                                                   144398
136000200529     C           WLERR     IFEQ 1                                         144398
136100200529     C                     MOVE 'N'       #RECVA                          144398
136200200529     C                     MOVE *ON       *IN50                           144398
136300200529     C                     MOVEL'CO00035' ZAMSID                          144398
136400200529     C                     EXSR ZASNMS                                    144398
136500200529     C                     ELSE                                           144398
136600200529     C           WLERR     IFEQ 2                                         144398
136700200529     C                     MOVE 'N'       #RECVA                          144398
136800200529     C                     MOVE *ON       *IN50                           144398
136900200529     C                     MOVEL'CO00036' ZAMSID                          144398
137000200529     C                     EXSR ZASNMS                                    144398
137100200529     C                     ENDIF                                          144398
137200200529     C                     ENDIF                                          144398
137300200529      *                                                                   144398
137400200529     C                     ENDIF                                          144398
137500200529      *                                                                   144398
137600200529     C           WLERR     IFEQ *ZERO                                     144398
137700200529      *
137800200529      ** Action 'X' is not allowed if status is 'I' (Except for 'NC'), 'X', 'C'
137900200529     C           DDSTS     IFEQ 'I'                        B*3
138000200529     C           WWPTYP    ANDNE'NC'
138100200529     C           DDSTS     OREQ 'X'
138200200529     C           DDSTS     OREQ 'C'
138300200529     C           DDSTS     OREQ 'R'
138400200529      *
138500200529     C                     MOVE 'N'       #RECVA
138600200529     C                     MOVE *ON       *IN50
138700200529     C                     MOVEL'CO00193' ZAMSID
138800200529     C                     EXSR ZASNMS
138900200529     C                     ENDIF                           E*3
139000200529      *
139100200529      ** Action 'X' is not allowed if Final Allocation is 'N' or 'S'.
139200200529     C           DDFLA     IFEQ 'N'                        B*3
139300200529     C           DDSTS     OREQ 'S'
139400200529     C           DDFLA     ANDEQ'S'
139500200529     C                     MOVE 'N'       #RECVA
139600200529     C                     MOVE *ON       *IN50
139700200529     C                     MOVEL'CO00195' ZAMSID
139800200529     C                     EXSR ZASNMS
139900200529     C                     ENDIF                           E*3
140000200529      *
140100200529      ** Verify matching between Depot Actual Stock Alloc. and all Customers Act
140200200529      ** if Final Allocation indicator is 'S' or 'Y'
140300200529      ** Verify matching between Depot Actual Cash Alloc. and all Customers Actu
140400200529      ** If Final Allocation indicator is 'Y'
140500200529     C           DDFLA     IFEQ 'S'                        B*3
140600200529     C           DDFLA     OREQ 'Y'
140700200529     C                     EXSR P009
140800200529      *
140900200529      ** Action 'X' not allowed because NO MATCHING
141000200529     C           WWDIFF    IFEQ 'Y'                        B*4
141100200529     C           WFIRST    OREQ 'Y'
141200200529     C                     MOVE 'N'       #RECVA
141300200529     C                     MOVE *ON       *IN50
141400200529      *
141500200529     C           DDFLA     IFEQ 'S'                        B*5
141600200529     C                     MOVEL'CO00233' ZAMSID
141700200529     C                     ELSE                            X*5
141800200529     C                     MOVEL'CO00234' ZAMSID
141900200529     C                     ENDIF                           E*5
142000200529      *
142100200529     C                     EXSR ZASNMS
142200200529     C                     ELSE                            X*4
142300200529      *
142400200529      ** Action 'X' not allowed because at least one of the Customers/Books
142500200529      ** has no reply (=reply status is not 'R')
142600200529     C           WWRPLY    IFEQ 'Y'                        B*5
142700200529     C*****      WWPTYP    ANDNE'NC'                                      137877
142800200529     C*****      WWPTYP    ANDNE'CC'                               CEU017 137877
142900200529     C           WWPTYP    IFEQ 'EX'                       B*6            137877
143000200529     C           WWPTYP    OREQ 'RG'                                      137877
143100200529     C           WWPTYP    OREQ 'DV'                                      137877
143200200529     C           WWPTYP    OREQ 'OF'                                      137877
143300200529     C           WWPTYP    OREQ 'FR'                                      137877
143400200529     C           WWPTYP    OREQ 'CR'                                      137877
143500200529     C           WWPTYP    OREQ 'CE'                                      137877
143600200529      *                                                                   137877
143700200529     C                     SELEC                                          137877
143800200529     C           WWPTYP    WHEQ 'EX'                       B*7            137877
143900200529     C           WWREFN    CHAINSECOEXL1             89                   137877
144000200529     C           WWPTYP    WHEQ 'RG'                                      137877
144100200529     C           WWREFN    CHAINSECORGL1             89                   137877
144200200529     C           WWPTYP    WHEQ 'DV'                                      137877
144300200529     C           WWREFN    CHAINSECODVL1             89                   137877
144400200529     C           WWPTYP    WHEQ 'OF'                                      137877
144500200529     C           WWREFN    CHAINSECOOFL1             89                   137877
144600200529     C                     ENDSL                           E*7            137877
144700200529      *                                                                   137877
144800200529     C           MANBOP    IFGT 1                          B*7            137877
144900200529     C           MADFNR    ANDEQ*BLANKS                                   137877
145000200529     C           WWPTYP    OREQ 'EX'                                      137877
145100200529     C           MJDFNR    ANDEQ*BLANKS                                   137877
145200200529     C           WWPTYP    OREQ 'RG'                                      137877
145300200529     C           MFDFNR    ANDEQ*BLANKS                                   137877
145400200529     C           WWPTYP    OREQ 'DV'                                      137877
145500200529     C           MDDFNR    ANDEQ*BLANKS                                   137877
145600200529     C           MDSDIT    ANDNE'C'                                       164022
145700200529     C           MDSDIT    ANDNE'S'                                       164022
145800200529     C           WWPTYP    OREQ 'OF'                                      137877
145900200529     C           MIDFNR    ANDEQ*BLANKS                                   137877
146000200529     C                     MOVE 'N'       #RECVA
146100200529     C                     MOVE *ON       *IN50
146200200529     C                     MOVEL'CO00298' ZAMSID
146300200529     C                     EXSR ZASNMS
146400200529     C                     ENDIF                           E*7            137877
146500200529     C                     ENDIF                           E*6            137877
146600200529     C                     ENDIF                           E*5
146700200529     C                     ENDIF                           E*4
146800200529     C                     ENDIF                           E*3
146900200529      *
147000200529      ** If Market Ex Price is equal to *zeros
147100200529     C           MAEXPC    IFEQ *ZEROS                     B*3
147200200529      *
147300200529     C           WWPTYP    IFEQ 'DV'                       B*4
147400200529     C           WWPTYP    OREQ 'OF'
147500200529     C           WWPTYP    OREQ 'EX'
147600200529     C                     MOVE 'N'       WWZERO  1
147700200529      *
147800200529     C                     SELEC
147900200529      *
148000200529      ** If Processing Type is 'DV'
148100200529     C           WWPTYP    WHEQ 'DV'                       B*5
148200200529     C           WWREFN    SETLLSECODVL1
148300200529     C           WWREFN    READESECODVL1                 89
148400200529      *
148500200529     C           *IN89     DOWEQ'0'                        B*6
148600200529     C           WWZERO    ANDEQ'N'
148700200529     C           MDSBPR    IFEQ *ZEROS                     B*7
148800200529     C           MDMRKI    ANDNE'Y'                                       137877
148900200529     C*****      MDSDIT    ANDNE'S'                                136935 137877
149000200529     C                     MOVE 'Y'       WWZERO
149100200529     C                     ENDIF                           E*7
149200200529     C           WWREFN    READESECODVL1                 89
149300200529     C                     ENDDO                           E*6
149400200529      *
149500200529      ** If Processing Type is 'OF'
149600200529     C           WWPTYP    WHEQ 'OF'                       B*5
149700200529     C           WWREFN    SETLLSECOOFL1
149800200529     C           WWREFN    READESECOOFL1                 89
149900200529      *
150000200529     C           *IN89     DOWEQ'0'                        B*6
150100200529     C           WWZERO    ANDEQ'N'
150200200529     C           MISUPR    IFEQ *ZEROS                     B*7
150300200529     C                     MOVE 'Y'       WWZERO
150400200529     C                     ENDIF                           E*7
150500200529     C           WWREFN    READESECOOFL1                 89
150600200529     C                     ENDDO                           E*6
150700200529      *
150800200529      ** If Processing Type is 'EX'
150900200529     C           WWPTYP    WHEQ 'EX'                       B*5
151000200529     C           WWREFN    SETLLSECOEXL1
151100200529     C           WWREFN    READESECOEXL1                 89
151200200529      *
151300200529     C           *IN89     DOWEQ'0'                        B*6
151400200529     C           WWZERO    ANDEQ'N'
151500200529     C           MJSUPR    IFEQ *ZEROS                     B*7
151600200529     C                     MOVE 'Y'       WWZERO
151700200529     C                     ENDIF                           E*7
151800200529     C           WWREFN    READESECOEXL1                 89
151900200529     C                     ENDDO                           E*6
152000200529      *
152100200529     C                     ENDSL                           E*5
152200200529      *
152300200529     C           WWZERO    IFEQ 'Y'                        B*5
152400200529     C                     MOVE 'N'       #RECVA
152500200529     C                     MOVE *ON       *IN50
152600200529     C                     MOVEL'CO00235' ZAMSID
152700200529     C                     EXSR ZASNMS
152800200529     C                     ENDIF                           E*5
152900200529      *
153000200529     C                     ELSE                            X*4
153100200529     C           WWPTYP    IFNE 'CC'                       B*5            CEU017
153200200529     C           WWPTYP    ANDNE'NF'                                      137877
153300200529     C           WWPTYP    ANDNE'NC'                                      137877
153400200529     C                     MOVE 'N'       #RECVA
153500200529     C                     MOVE *ON       *IN50
153600200529     C                     MOVEL'CO00236' ZAMSID
153700200529     C                     EXSR ZASNMS
153800200529     C                     ENDIF                           E*5            CEU017
153900200529     C                     ENDIF                           E*4
154000200529     C                     ENDIF                           E*3
154100200529      *
154200200529     C                     ENDIF                                          144398
154300200529     C                     ENDIF                           E*2
154400200529      *
154500200529      ** If 'Action' is 'L'.
154600200529     C           DDACN     IFEQ 'L'                        B*2
154700200529      *
154800200529      * If customer dummy allocation already has a position against       184520
154900200529      * this security stop another allocation taking place until          184520
155000200529      * position cleared.                                                 184520
155100200529      *                                                                   184520
155200200529      * Check customer position file CPOSND to see if live position       184520
155300200529      * against dummy customer. Reject allocation if postion not equal    184520
155400200529      * zero and send rejection message.                                  184520
155500200529     C*                                                                   184520
155600200529     C                     MOVE DDBRC     WBRCD1                          184520
155700200529     C                     MOVE DDSECU    WSESN1                          184520
155800200529     C                     MOVE WDUMMY    WCDCN1                          184520
155900200529     C*                                                                   184520
156000200529     C                     MOVE '0'       *IN32                           184520
156100200529     C*                                                                   184520
156200200529     C           *IN33     IFEQ '0'                                                           189119
156300200529      *                                                                                       189119
156400200529     C           WKEY1     CHAINCPOSN                31                   184520
156500200529     C*                                                                   184520
156600200529     C           *IN31     IFEQ '0'                                       184520
156700200529     C           CSNT      IFNE 0                                         184520
156800200529     C           CSNV      ORNE 0                                         184520
156900200529     C           CSNS      ORNE 0                                         184520
157000200529     C           CSEX      ORNE 0                                         184520
157100200529     C                     MOVE '1'       *IN32                           184520
157200200529     C                     MOVE '1'       *IN33                                               189119
157300200529     C                     END                                            184520
157400200529     C                     END                                            184520
157500200529     C*                                                                   184520
157600200529     C                     END                                                                189119
157700200529      *                                                                   184520
157800200529      **If*indicator*32*on*send*out*message*and*stop*allocation*run.***                184520 189119
157900200529      ** Send warning message to operator that dummy position exists.                         189119
158000200529      *                                                                   184520
158100200529     C           *IN32     IFEQ '1'                                       184520
158200200529     C                     MOVE 'N'       #RECVA                          184520
158300200529     C**********           MOVE *ON       *IN50                                        184520 189119
158400200529     C**********           MOVEL'CO01112' ZAMSID                                       184520 189119
158500200529     C                     MOVEL'CO01113' ZAMSID                                              189119
158600200529     C                     EXSR ZASNMS                                    184520
158700200529     C                     ENDIF                                          184520
158800200529     C*                                                                   184520
158900200529      ** Action 'L' is not allowed if status is 'X', 'S', 'C' or 'R'.
159000200529     C           DDSTS     IFEQ 'X'                        B*3
159100200529     C           DDSTS     OREQ 'S'
159200200529     C           DDSTS     OREQ 'C'
159300200529     C           DDSTS     OREQ 'R'
159400200529      *
159500200529     C                     MOVE 'N'       #RECVA
159600200529     C                     MOVE *ON       *IN50
159700200529     C                     MOVEL'CO00194' ZAMSID
159800200529     C                     EXSR ZASNMS
159900200529     C                     ENDIF                           E*3
160000200529      *
160100200529      ** Action 'L' is not allowed if Final Allocation is 'Y'/'S'.
160200200529     C           DDFLA     IFEQ 'Y'                        B*3
160300200529     C           DDFLA     OREQ 'S'
160400200529     C                     MOVE 'N'       #RECVA
160500200529     C                     MOVE *ON       *IN50
160600200529     C                     MOVEL'CO00196' ZAMSID
160700200529     C                     EXSR ZASNMS
160800200529     C                     ENDIF                           E*3
167500200529     C/COPY WNCPYSRC,SEH00025
167600200529      *                                                                   155622
167700200529      ** Action 'L' is not allowed if 'Default No Reply' from             155622
167800200529      ** General Information screen is not entered ...                    155622
167900200529     C           #RECVA    IFEQ 'Y'                        B*3            155622
168000200529     C           MANBOP    ANDGT1                                         155622
168100200529     C           MADFNR    IFEQ *BLANKS                    B*4            155622
168200200529     C           MADFCP    OREQ *BLANKS                                   155622
168300200529     C           MADFSP    OREQ *BLANKS                                   155622
168400200529     C                     MOVE 'N'       #RECVA                          155622
168500200529     C                     MOVE *ON       *IN50                           155622
168600200529     C                     MOVEL'CO00606' ZAMSID                          155622
168700200529     C                     EXSR ZASNMS                                    155622
168800200529     C                     ENDIF                           E*4            155622
168900200529     C                     ENDIF                           E*3            155622
169000200529      *                                                                   CSE020
169100200529      ** Check if Action 'L' is allowed for child                         CSE020
169200200529      *                                                                   CSE020
169300200529     C           #RECVA    IFEQ 'Y'                                       CSE020
169400200529     C           MAPREF    ANDNE*BLANKS                                   CSE020
169500200529      *                                                                   CSE020
169600200529      ** Parent is not yet authorised                                     CSE020
169700200529      *                                                                   CSE020
169800200529     C           MAPREF    CHAINSECORFL1             71                   CSE020
169900200529     C           *IN71     IFEQ *OFF                                      CSE020
170000200529     C           MNSTAT    ANDNE'X'                                       CSE020
170100200529     C                     MOVE 'N'       #RECVA                          CSE020
170200200529     C                     MOVE *ON       *IN50                           CSE020
170300200529     C                     MOVEL'CO00366' ZAMSID                          CSE020
170400200529     C                     EXSR ZASNMS                                    CSE020
170500200529     C                     ENDIF                                          CSE020
170600200529      *                                                                   CSE020
170700200529      ** Ex-date of the child is not the same as the Parent Action        CSE020
170800200529      *                                                                   CSE020
170900200529     C           MACOEX    IFNE MNCOEX                                    CSE020
171000200529     C                     MOVE 'N'       #RECVA                          CSE020
171100200529     C                     MOVE *ON       *IN50                           CSE020
171200200529     C                     MOVEL'CO00370' ZAMSID                          CSE020
171300200529     C                     EXSR ZASNMS                                    CSE020
171400200529     C                     ENDIF                                          CSE020
171500200529      *                                                                   CSE020
171600200529      ** Initialise array for New Securities                              CSE020
171700200529      *                                                                   CSE020
171800200529     C                     Z-ADD1         X       30                      CSE020
171900200529      *                                                                   CSE020
172000200529     C           X         DOWLE180                                       CSE020
172100200529     C                     MOVE *BLANKS   NSEC,X                          CSE020
172200200529     C                     ADD  1         X                               CSE020
172300200529     C                     ENDDO                                          CSE020
172400200529      *                                                                   CSE020
172500200529      ** Security of the child action is not equal to one of the New      CSE020
172600200529      ** Security of the parent action                                    CSE020
172700200529      *                                                                   CSE020
172800200529     C                     Z-ADD1         X                               CSE020
172900200529      *                                                                   CSE020
173000200529     C                     SELEC                                          CSE020
173100200529     C           MNPTYP    WHEQ 'DV'                                      CSE020
173200200529     C           MNCORF    SETLLSECODVL1                                  CSE020
173300200529     C           MNCORF    READESECODVL1                 88               CSE020
173400200529     C           *IN88     DOWEQ'0'                                       CSE020
173500200529     C           MDNSEC    IFEQ *BLANKS                                   CSE020
173600200529     C                     MOVEAMNSESN    NSEC,X                          CSE020
173700200529     C                     ELSE                                           CSE020
173800200529     C                     MOVEAMDNSEC    NSEC,X                          CSE020
173900200529     C                     ENDIF                                          CSE020
174000200529     C                     ADD  1         X                               CSE020
174100200529     C           MNCORF    READESECODVL1                 88               CSE020
174200200529     C                     ENDDO                                          CSE020
174300200529      *                                                                   CSE020
174400200529     C           MNPTYP    WHEQ 'FR'                                      CSE020
174500200529     C           MNCORF    SETLLSECOFRL1                                  CSE020
174600200529     C           MNCORF    READESECOFRL1                 88               CSE020
174700200529     C           *IN88     DOWEQ'0'                                       CSE020
174800200529     C           MENSEC    IFEQ *BLANKS                                   CSE020
174900200529     C                     MOVEAMNSESN    NSEC,X                          CSE020
175000200529     C                     ELSE                                           CSE020
175100200529     C                     MOVEAMENSEC    NSEC,X                          CSE020
175200200529     C                     ENDIF                                          CSE020
175300200529     C                     ADD  1         X                               CSE020
175400200529     C           MNCORF    READESECOFRL1                 88               CSE020
175500200529     C                     ENDDO                                          CSE020
175600200529      *                                                                   CSE020
175700200529     C           MNPTYP    WHEQ 'CR'                                      CSE020
175800200529     C           MNCORF    SETLLSECOCRL1                                  CSE020
175900200529     C           MNCORF    READESECOCRL1                 88               CSE020
176000200529     C           *IN88     DOWEQ'0'                                       CSE020
176100200529     C           MHSECA    IFEQ *BLANKS                                   CSE020
176200200529     C                     MOVEAMNSESN    NSEC,X                          CSE020
176300200529     C                     ELSE                                           CSE020
176400200529     C                     MOVEAMHSECA    NSEC,X                          CSE020
176500200529     C                     ENDIF                                          CSE020
176600200529     C                     ADD  20        X                               CSE020
176700200529     C           MNCORF    READESECOCRL1                 88               CSE020
176800200529     C                     ENDDO                                          CSE020
176900200529      *                                                                   CSE020
177000200529     C           MNPTYP    WHEQ 'OF'                                      CSE020
177100200529     C           MNCORF    SETLLSECOOFL1                                  CSE020
177200200529     C           MNCORF    READESECOOFL1                 88               CSE020
177300200529     C           *IN88     DOWEQ'0'                                       CSE020
177400200529     C           MINSEC    IFEQ *BLANKS                                   CSE020
177500200529     C                     MOVE MNSESN    NSEC,X                          CSE020
177600200529     C                     ELSE                                           CSE020
177700200529     C                     MOVE MINSEC    NSEC,X                          CSE020
177800200529     C                     ENDIF                                          CSE020
177900200529     C                     ADD  1         X                               CSE020
178000200529     C           MNCORF    READESECOOFL1                 88               CSE020
178100200529     C                     ENDDO                                          CSE020
178200200529      *                                                                   CSE020
178300200529     C           MNPTYP    WHEQ 'RG'                                      CSE020
178400200529     C           MNCORF    SETLLSECORGL1                                  CSE020
178500200529     C           MNCORF    READESECORGL1                 88               CSE020
178600200529     C           *IN88     DOWEQ'0'                                       CSE020
178700200529     C           MFNSEC    IFEQ *BLANKS                                   CSE020
178800200529     C                     MOVE MNSESN    NSEC,X                          CSE020
178900200529     C                     ELSE                                           CSE020
179000200529     C                     MOVE MFNSEC    NSEC,X                          CSE020
179100200529     C                     ENDIF                                          CSE020
179200200529     C                     ADD  1         X                               CSE020
179300200529     C           MNCORF    READESECORGL1                 88               CSE020
179400200529     C                     ENDDO                                          CSE020
179500200529      *                                                                   CSE020
179600200529     C           MNPTYP    WHEQ 'EX'                                      CSE020
179700200529     C           MNCORF    SETLLSECOEXL1                                  CSE020
179800200529     C           MNCORF    READESECOEXL1                 88               CSE020
179900200529     C           *IN88     DOWEQ'0'                                       CSE020
180000200529     C           MJNSEC    IFEQ *BLANKS                                   CSE020
180100200529     C                     MOVE MNSESN    NSEC,X                          CSE020
180200200529     C                     ELSE                                           CSE020
180300200529     C                     MOVE MJNSEC    NSEC,X                          CSE020
180400200529     C                     ENDIF                                          CSE020
180500200529     C                     ADD  1         X                               CSE020
180600200529     C           MNCORF    READESECOEXL1                 88               CSE020
180700200529     C                     ENDDO                                          CSE020
180800200529      *                                                                   CSE020
180900200529     C           MNPTYP    WHEQ 'NC'                                      CSE020
181000200529     C           MNCORF    SETLLSECONCL1                                  CSE020
181100200529     C           MNCORF    READESECONCL1                 88               CSE020
181200200529     C           *IN88     DOWEQ'0'                                       CSE020
181300200529     C           MLSESN    IFEQ *BLANKS                                   CSE020
181400200529     C                     MOVE MNSESN    NSEC,X                          CSE020
181500200529     C                     ELSE                                           CSE020
181600200529     C                     MOVE MLSESN    NSEC,X                          CSE020
181700200529     C                     ENDIF                                          CSE020
181800200529     C                     ADD  1         X                               CSE020
181900200529     C           MNCORF    READESECONCL1                 88               CSE020
182000200529     C                     ENDDO                                          CSE020
182100200529      *                                                                   CSE020
182200200529     C           MNPTYP    WHEQ 'CC'                                      CSE020
182300200529     C           MNCORF    SETLLSECOCCL2                                  CSE020
182400200529     C           MNCORF    READESECOCCL2                 88               CSE020
182500200529     C           *IN88     DOWEQ'0'                                       CSE020
182600200529     C           NANSEC    IFEQ *BLANKS                                   CSE020
182700200529     C                     MOVE MNSESN    NSEC,X                          CSE020
182800200529     C                     ELSE                                           CSE020
182900200529     C                     MOVE NANSEC    NSEC,X                          CSE020
183000200529     C                     ENDIF                                          CSE020
183100200529     C                     ADD  1         X                               CSE020
183200200529     C           MNCORF    READESECOCCL2                 88               CSE020
183300200529     C                     ENDDO                                          CSE020
183400200529      *                                                                   CSE020
183500200529     C                     ENDSL                                          CSE020
183600200529      *                                                                   CSE020
183700200529      ** Validate security of the child such that it is equal to          CSE020
183800200529      ** new security of the parent                                       CSE020
183900200529      *                                                                   CSE020
184000200529     C           MASESN    LOKUPNSEC                     88               CSE020
184100200529     C           *IN88     IFEQ '0'                                       CSE020
184200200529     C                     MOVE 'N'       #RECVA                          CSE020
184300200529     C                     MOVE '1'       *IN50                           CSE020
184400200529     C                     MOVEL'CO00371' ZAMSID                          CSE020
184500200529     C                     EXSR ZASNMS                                    CSE020
184600200529     C                     ENDIF                                          CSE020
184700200529      *                                                                   CSE020
184800200529     C                     ENDIF                                          CSE020
184900200529      *                                                                   CSE020
185000200529     C                     ENDIF                           E*2
185100200529      *
185200200529      ** If action is 'A', 'E', 'P', 'L' or 'X', Ex-date must not be greater tha
185300200529      ** or equal to rundate.
185400200529     C                     MOVE WWEXDT    WWEXDN  50
185500200529     C           DDACN     IFEQ 'A'                        B*2
185600200529     C           DDACN     OREQ 'E'
185700200529     C           DDACN     OREQ 'P'
185800200529     C           DDACN     OREQ 'L'
185900200529     C           DDACN     OREQ 'X'
186000200529     C           WWEXDN    IFGE BJRDNB                     B*3
186100200529     C                     MOVE 'N'       #RECVA
186200200529     C                     MOVE *ON       *IN50
186300200529     C                     MOVEL'CO00197' ZAMSID
186400200529     C                     EXSR ZASNMS
186500200529     C                     ENDIF                           E*3
186600200529     C                     ENDIF                           E*2
186700200529      *
186800200529      ** Action 'L' is allowed if all the fields mandatory for the
186900200529      ** requested stage are not blanks or zero.
187000200529     C                     MOVE *BLANKS   WWSTGL  2
187100200529     C                     MOVE *BLANK    WWSTGX  1
187200200529      *
187300200529     C           DDACN     IFEQ 'L'                        B*2
187400200529     C           DDACN     OREQ 'A'
187500200529      *
187600200529      ** Setup the requested stage
187700200529     C                     MOVEL'L'       WWSTGL
187800200529     C                     MOVE DDFLA     WWSTGL
187900200529     C                     EXSR P007
188000200529     C                     ENDIF                           E*2
188100200529      *
188200200529      ** Action 'X' is allowed if all the fields mandatory for the
188300200529      ** requested stage are not blank or zero.
188400200529     C           DDACN     IFEQ 'X'                        B*2
188500200529      *
188600200529      ** Setup the requested stage
188700200529     C           DDFLA     IFEQ 'S'                        B*3
188800200529     C                     MOVE 'S'       WWSTGX
188900200529     C                     ENDIF                           E*3
189000200529      *
189100200529     C           DDFLA     IFEQ 'Y'                        B*3
189200200529     C                     MOVE 'X'       WWSTGX
189300200529     C                     ENDIF                           E*3
189400200529      *
189500200529     C                     EXSR P007
189600200529     C                     ENDIF                           E*2
189700200529      *
189800200529      ** If 'Action' is 'P'.
189900200529      ** Action 'P' is not allowed for status 'I', 'R'.
190000200529     C           DDACN     IFEQ 'P'                        B*2
190100200529     C           DDSTS     ANDEQ'I'
190200200529     C           DDACN     OREQ 'P'
190300200529     C           DDSTS     ANDEQ'R'
190400200529     C                     MOVE 'N'       #RECVA
190500200529     C                     MOVE *ON       *IN50
190600200529     C                     MOVEL'CO00198' ZAMSID
190700200529     C                     EXSR ZASNMS
190800200529     C                     ENDIF                           E*2
190900200529      *
191000200529      ** If 'Action' is 'A'.
191100200529     C           DDACN     IFEQ 'A'                        B*2
191200200529      *
191300200529      ** Action 'A' is not allowed for status 'C' or 'R'.
191400200529     C           DDSTS     IFEQ 'C'                        B*3
191500200529     C           DDSTS     OREQ 'R'
191600200529     C                     MOVE 'N'       #RECVA
191700200529     C                     MOVE *ON       *IN50
191800200529     C                     MOVEL'CO00199' ZAMSID
191900200529     C                     EXSR ZASNMS
192000200529     C                     ENDIF                           E*3
193200200529      *
193300200529      ** Action 'A' is not allowed for processing type 'NC' and 'NF'
193400200529     C           WWPTYP    IFEQ 'NC'                       B*3
193500200529     C           WWPTYP    OREQ 'NF'
193600200529     C                     MOVE 'N'       #RECVA
193700200529     C                     MOVE *ON       *IN50
193800200529     C                     MOVEL'CO00291' ZAMSID
193900200529     C                     EXSR ZASNMS
194000200529     C                     ENDIF                           E*3
194100200529     C                     ENDIF                           E*2
194200200529      *
194300200529     C                     ENDIF                           E*1
194400200529      *
194500200529     C                     ENDSR
194600200529      *
194700200529      *****************************************************************
194800200529      * P004A  : Process Action                                       *
194900200529      *****************************************************************
195000200529      *
195100200529     C           P004A     BEGSR
195200200529      *
195300200529      ** If Action is 'Allocation'('L') or 'Authorisation'('X'),
195400200529      ** process Confirmation.
195500200529     C           DDACN     IFEQ 'L'
195600200529     C           DDACN     OREQ 'X'
195700200529     C                     EXSR P005
195800200529     C                     ENDIF
195900200529      *
196000200529      ** If no error, process 'Action'.
196100200529     C           *IN50     IFEQ *OFF
196200200529      *
196300200529     C           DDACN     CASEQ'A'       P008
196400200529     C           DDACN     CASEQ'E'       P008
196500200529     C           DDACN     CASEQ'L'       PALOC
196600200529     C           DDACN     CASEQ'X'       PATHR
196700200529     C           DDACN     CASEQ'P'       PPRNT
196800200529     C                     END
196900200529      *
197000200529     C                     ENDIF
197100200529      *
197200200529     C                     ENDSR
197300200529      *
197400200529      *****************************************************************
197500200529      * P005   : Process 'Confirmation' screen                        *
197600200529      *****************************************************************
197700200529      *
197800200529     C           P005      BEGSR
197900200529      *
198000200529      ** Move subfile record fields to confirmation screen fields.
198100200529     C                     MOVELDDBRC     DDBRC2
198200200529     C                     MOVELDDDEP     DDDEP2
198300200529     C                     MOVELDDDEPS    DDDP2S
198400200529     C                     MOVELDDEDP     DDEDP2
198500200529     C                     MOVELDDLTA     DDLTA2
198600200529     C                     MOVELDDFLA     DDFLA2
198700200529     C                     MOVELDDSTS     DDSTS2
198800200529     C                     MOVE SHIN54    *IN54                           136930
198900200529      *
199000200529      ** Initialise 'Confirmation' indicator to blank and setup the
199100200529      ** narrative.
199200200529     C                     MOVE *BLANK    DDCONF
199300200529      *
199400200529     C           DDACN     IFEQ 'L'
199500200529     C                     MOVE *OFF      *IN53
199600200529     C                     ELSE
199700200529     C                     MOVE *ON       *IN53
199800200529     C                     ENDIF
199900200529      *
200000200529     C                     MOVE TXT,2     ##CTX1
200100200529     C                     MOVE *BLANKS   DDCONF
200200200529      *
200300200529      ** Loop while F3 or F12 is not pressed, or an error occurs.
200400200529     C           *INKC     DOWEQ*OFF
200500200529     C           *INKL     ANDEQ*OFF
200600200529     C           DDCONF    ANDNE'Y'
200700200529     C           DDCONF    ANDNE'N'
200800200529      *
200900200529     C                     WRITESE7512C2
201000200529     C                     WRITESE7512F1
201100200529     C                     EXFMTSE7512F2
201200200529      *
201300200529     C           *INKC     IFEQ *OFF
201400200529     C           *INKL     ANDEQ*OFF
201500200529      *
201600200529      ** Clear messages from program message queue.
201700200529     C                     CALL 'Y2CLMSC'
201800200529     C                     PARM ##PGM     ZAPGM  10
201900200529     C                     PARM '*SAME'   ZAPGRL  5
202000200529      *
202100200529     C                     MOVE *OFF      *IN55
202200200529     C           DDCONF    IFNE 'Y'
202300200529     C           DDCONF    ANDNE'N'
202400200529     C                     MOVE *ON       *IN55
202500200529     C                     MOVEL'CO00200' ZAMSID
202600200529     C                     EXSR ZASNMS
202700200529     C                     ENDIF
202800200529     C                     ENDIF
202900200529      *
203000200529     C                     ENDDO
203100200529      *
203200200529     C           #1RRN     CHAINSE7512S1             89
203300200529      *
203400200529     C           *INKL     IFEQ *ON
203500200529     C                     MOVE *OFF      *INKL
203600200529     C                     ENDIF
203700200529      *
203800200529     C                     ENDSR
203900200529      *
204000200529      *****************************************************************
204100200529      * P006   : UPDATE PF/SECODRPD                                   *
204200200529      *****************************************************************
204300200529      *
204400200529     C           P006      BEGSR
204500200529      *
204600200529     C                     MOVELDDBRC     WWDSBA
204700200529     C                     MOVELDDDEP     WWDDPT
204800200529      *
204900200529     C           KEY4      CHAINSECODRL0             89
205000200529      *
205100200529      ** If no record found, write a new record to PF/SECODRPD.
205200200529     C           *IN89     IFEQ *ON
205300200529      *
205400200529      ** Write details as per U002
205500200529     C                     MOVE 'W'       WWWRUP  1
205600200529     C                     EXSR U002
205700200529     C                     WRITESECODRD0
205800200529      *
205900200529      ** If a record is found, update the record in PF/SECODRPD.
206000200529     C                     ELSE
206100200529      *
206200200529      ** Update details as per U002
206300200529     C                     MOVE 'U'       WWWRUP
206400200529     C                     EXSR U002
206500200529     C                     UPDATSECODRD0
206600200529     C                     ENDIF
206700200529      *
206800200529     C                     ENDSR
206900200529      *
207000200529      *****************************************************************
207100200529      * P007   : Process the corporate action type                    *
207200200529      *****************************************************************
207300200529      *
207400200529     C           P007      BEGSR
207500200529      *
207600200529      ** Reset error indicator
207700200529     C                     MOVE *BLANKS   ERROR
207800200529      *
207900200529      ** Trial Allocation ('LN')
208000200529     C           WWSTGL    IFEQ 'LN'                       B*1
208100200529      ** Final Allocation Stock ('LS')
208200200529     C           WWSTGL    OREQ 'LS'
208300200529      ** Final Allocation Cash and Stock ('LY')
208400200529     C           WWSTGL    OREQ 'LY'
208500200529      ** Stock Authorised ('S')
208600200529     C           WWSTGX    OREQ 'S'
208700200529      ** Fully Authorised ('X')
208800200529     C           WWSTGX    OREQ 'X'
208900200529      *
209000200529     C           MACOEX    IFEQ *ZEROS                     B*2
209100200529     C           MATDVD    OREQ *BLANKS
209200200529     C           MAREFO    OREQ *BLANKS
209300200529     C                     MOVE 'Y'       ERROR
209400200529     C                     ELSE                            X*2
209500200529      *
209600200529      ** Stock Authorised ('S')
209700200529     C           WWSTGX    IFEQ 'S'                        B*3
209800200529      ** Fully Authorised ('X')
209900200529     C           WWSTGX    OREQ 'X'
210000200529      *
210100200529     C           MAALEF    IFEQ *ZEROS                     B*4
210200200529     C                     MOVE 'Y'       ERROR
210300200529     C                     ENDIF                           E*4
210400200529     C                     ENDIF                           E*3
210500200529     C                     ENDIF                           E*2
210600200529     C                     ENDIF                           E*1
210700200529      *
210800200529     C           ERROR     IFEQ *BLANKS                    B*1
210900200529     C           WWPTYP    ANDNE'NC'
211000200529     C           WWPTYP    ANDNE'NF'
211100200529     C           WWPTYP    ANDNE'CC'                                      CEU017
211200200529      *
211300200529      ** Read LF according to Processing type
211400200529     C                     SELEC                           B*2
211500200529     C           WWPTYP    WHEQ 'DV'
211600200529     C           WWREFN    SETLLSECODVL1
211700200529     C           WWREFN    READESECODVL1                 89
211800200529      *
211900200529     C           WWPTYP    WHEQ 'FR'
212000200529     C           WWREFN    SETLLSECOFRL1
212100200529     C           WWREFN    READESECOFRL1                 89
212200200529      *
212300200529     C           WWPTYP    WHEQ 'RG'
212400200529     C           WWREFN    SETLLSECORGL1
212500200529     C           WWREFN    READESECORGL1                 89
212600200529      *
212700200529     C           WWPTYP    WHEQ 'CE'
212800200529     C           WWREFN    SETLLSECOCEL1
212900200529     C           WWREFN    READESECOCEL1                 89
213000200529      *
213100200529     C           WWPTYP    WHEQ 'CR'
213200200529     C           WWREFN    SETLLSECOCRL1
213300200529     C           WWREFN    READESECOCRL1                 89
213400200529      *
213500200529     C           WWPTYP    WHEQ 'OF'
213600200529     C           WWREFN    SETLLSECOOFL1
213700200529     C           WWREFN    READESECOOFL1                 89
213800200529      *
213900200529     C           WWPTYP    WHEQ 'EX'
214000200529     C           WWREFN    SETLLSECOEXL1
214100200529     C           WWREFN    READESECOEXL1                 89
214200200529      *
214300200529     C                     ENDSL                           E*2
214400200529      *
214500200529      ** Execute subroutine according to Processing type.
214600200529     C           *IN89     DOWEQ'0'                        B*2
214700200529     C           ERROR     ANDEQ' '
214800200529      *
214900200529     C                     SELEC                           B*3
215000200529     C           WWPTYP    WHEQ 'DV'
215100200529     C                     EXSR V0DV
215200200529     C           WWREFN    READESECODVL1                 89
215300200529      *
215400200529     C           WWPTYP    WHEQ 'FR'
215500200529     C                     EXSR V0FR
215600200529     C           WWREFN    READESECOFRL1                 89
215700200529      *
215800200529     C           WWPTYP    WHEQ 'RG'
215900200529     C                     EXSR V0RG
216000200529     C           WWREFN    READESECORGL1                 89
216100200529      *
216200200529     C           WWPTYP    WHEQ 'CE'
216300200529     C                     EXSR V0CE
216400200529     C           WWREFN    READESECOCEL1                 89
216500200529      *
216600200529     C           WWPTYP    WHEQ 'CR'
216700200529     C                     EXSR V0CR
216800200529     C           WWREFN    READESECOCRL1                 89
216900200529      *
217000200529     C           WWPTYP    WHEQ 'OF'
217100200529     C                     EXSR V0OF
217200200529     C           WWREFN    READESECOOFL1                 89
217300200529      *
217400200529     C           WWPTYP    WHEQ 'EX'
217500200529     C                     EXSR V0EX
217600200529     C           WWREFN    READESECOEXL1                 89
217700200529      *
217800200529     C                     ENDSL                           E*3
217900200529      *
218000200529     C                     ENDDO                           E*2
218100200529     C                     ELSE                            X*1            CEU017
218200200529     C           WWPTYP    IFEQ 'CC'                       B*2            CEU017
218300200529     C           WWREFN    SETLLSECOCCL2                                  CEU017
218400200529     C           WWREFN    READESECOCCL2                 89               CEU017
218500200529     C                     EXSR V0CC                                      CEU017
218600200529     C                     ENDIF                           E*2            CEU017
218700200529     C                     ENDIF                           E*1
218800200529      *
218900200529      ** If error...
219000200529     C           ERROR     IFEQ 'Y'                        B*1
219100200529     C           MAALEF    IFEQ *ZEROS                     B*2
219200200529     C                     MOVE 'N'       #RECVA
219300200529     C                     MOVE *ON       *IN50
219400200529     C                     MOVEL'CO00296' ZAMSID
219500200529     C                     EXSR ZASNMS
219600200529     C                     ELSE                            E*1
219700200529     C                     MOVE 'N'       #RECVA
219800200529     C                     MOVE *ON       *IN50
219900200529     C                     MOVEL'CO00201' ZAMSID
220000200529     C                     EXSR ZASNMS
220100200529     C                     ENDIF                           E*1
220200200529     C                     ENDIF                           E*1
220300200529      *
220400200529     C                     ENDSR
220500200529      *
220600200529      *****************************************************************
220700200529      * P008   : Call Depot Maintenance program                       *
220800200529      *****************************************************************
220900200529      *
221000200529     C           P008      BEGSR
221100200529      *
221200200529      **  If number of options is greater than 1
221300200529     C                     MOVE WWNBOP    W2NBOP  20       Number of Options
221400200529     C           W2NBOP    IFGT 1                          B*1
221500200529      *
221600200529     C                     CALL 'SE7592'               99
221700200529     C                     PARM           WWREFN           ER Reference
221800200529     C                     PARM           WWSECN           Security Shortname
221900200529     C                     PARM           WWCOAT           Corporate Action Type
222000200529     C                     PARM           WWPTYP           Processing Type
222100200529     C                     PARM           WWEXDT           Ex-Date
222200200529     C                     PARM           WWNBOP           Number of Options
222300200529     C**********           PARM DDACN     WWMODE  1        Amend or Enqui 156532
222400200529     C                     PARM DDACN     WWACTN  1        Amend/Enquiry  156532
222500200529     C                     PARM DDBRC     WWBRCD  3        Branch
222600200529     C                     PARM DDDEP     WWDEPT  6        Depot
222700200529     C                     PARM DDEDP     WWEXPO 17        Ex-date position
222800200529     C                     PARM DDLTA     WWCOAD  6        Last Allocation Date
222900200529     C                     PARM DDSTS     WWCOST  1        Status
223000200529     C                     PARM DDFLA     WWFAID  1        Last Allocation Indic
223100200529     C                     PARM DDNCCY    WWNCCY  3        Nominal Currency
223200200529     C                     PARM *BLANKS   WWUPDT  1        Update done ?
223300200529     C                     PARM *BLANKS   WWRTCD  1        Return Code
223400200529      *
223500200529     C                     ELSE                            X*1
223600200529      *
223700200529     C                     CALL 'SE7593'               99
223800200529     C                     PARM           WWREFN  6        ER Reference
223900200529     C                     PARM           WWSECN 10        Security Shortname
224000200529     C                     PARM           WWCOAT  2        Corporate Action Type
224100200529     C                     PARM           WWPTYP  2        Processing Type
224200200529     C                     PARM           WWEXDT  5        Ex-Date
224300200529     C                     PARM '??'      WWNBOP  2        Option Number
224400200529     C                     PARM DDACN     WWACTN  1        Action 'A' or 'E'
224500200529     C                     PARM DDBRC     WWBRCD  3        Branch
224600200529     C                     PARM DDDEP     WWDEPT  6        Depot
224700200529     C                     PARM DDEDP     WWEXPO 17        Ex-date position
224800200529     C                     PARM DDLTA     WWCOAD  6        Last Allocation Date
224900200529     C                     PARM DDSTS     WWSTAT  1        Corporate Action Stat
225000200529     C                     PARM DDFLA     WWFINA  1        Final Allocation Indi
225100200529     C                     PARM DDNCCY    WWNCCY  3        Nominal Currency
225200200529     C                     PARM *BLANKS   WWUPDT  1        Update done ?
225300200529     C                     PARM *BLANKS   WWRTCD  1        Return Code
225400200529     C                     ENDIF                           E*1
225500200529      *
225600200529      **  If error indicator of the called program is on, Database error
225700200529     C           *IN99     IFEQ '1'                        B*1
225800200529     C           WWRTCD    OREQ 'E'
225900200529      *
226000200529     C           *LOCK     IN   LDA
226100200529     C           W2NBOP    IFGT 1                          B*2
226200200529     C                     MOVEANARR,2    DBKEY
226300200529     C                     ELSE                            X*2
226400200529     C                     MOVEANARR,3    DBKEY
226500200529     C                     ENDIF                           E*2
226600200529      *
226700200529     C                     MOVEL'003'     DBASE            *****************
226800200529     C                     MOVEL*BLANKS   DBFILE           ** DB ERROR 03 **
226900200529     C                     OUT  LDA                        *****************
227000200529     C                     EXSR *PSSR
227100200529     C                     ENDIF                           E*1
227200200529      *
227300200529     C           WWRTCD    IFEQ '3'                        B*1
227400200529     C                     MOVE '1'       *INKC
227500200529     C                     ENDIF                           E*1
227600200529      *
227700200529     C           WWUPDT    IFEQ 'Y'                        B*1
227800200529     C                     MOVELDDBRC     WWDSBA
227900200529     C                     MOVELDDDEP     WWDDPT
228000200529     C           KEY4      CHAINSECODRL0             89
228100200529     C                     Z-ADDBJRDNB    MSCOAD
228200200529     C                     MOVE 'L'       MSCOST
228300200529     C                     UPDATSECODRD0
228400200529      *
228500200529     C                     Z-ADDBJRDNB    ZDAYNO
228600200529     C                     EXSR ZDATE2
228700200529     C                     MOVE ZDATE     DDLTA
228800200529     C                     MOVE 'L'       DDSTS
228900200529     C                     MOVE 'L'       DDSTSH
229000200529     C                     ENDIF                           E*1
229100200529      *
229200200529     C                     ENDSR
229300200529      *
229400200529      *****************************************************************
229500200529      * P009   : Verification for the action 'X'                      *
229600200529      *****************************************************************
229700200529      *
229800200529     C           P009      BEGSR
229900200529      *
230000200529     C                     MOVE 'N'       WWDIFF  1
230100200529     C                     MOVE 'N'       WWRPLY  1
230200200529     C                     MOVE DDBRC     WWDSBA
230300200529     C                     MOVE DDDEP     WWDDPT
230400200529      *
230500200529     C           WWREFN    SETLLSECOALL7
230600200529      *
230700200529     C                     MOVE 'Y'       WFIRST  1
230800200529     C                     Z-ADD*ZEROS    WWOPTN  20
230900200529     C                     MOVE *BLANKS   WWSESN 10
231000200529     C                     Z-ADD*ZEROS    WWASTA 150
231100200529     C                     Z-ADD*ZEROS    WWACAA 150
231200200529      *
231300200529     C                     MOVE '0'       *IN61
231400200529      *
231500200529      ** Do while not end of file or a difference is found
231600200529     C           *IN61     DOWEQ'0'                        B*2
231700200529     C           WWDIFF    ANDEQ'N'
231800200529     C*****      WWRPLY    ANDEQ'N'                                       137879
231900200529      *
232000200529     C           WWREFN    READESECOALL7                 61
232100200529      *
232200200529      ** If record read for same Branch and Depot than fields from subfile recor
232300200529     C           MCBRCD    IFEQ WWDSBA                     B*3
232400200529     C           MCDDPT    ANDEQWWDDPT
232500200529     C           *IN61     ANDEQ'0'
232600200529      *
232700200529      ** If it's the first time
232800200529     C           WFIRST    IFEQ 'Y'                        B*4
232900200529     C                     Z-ADDMCOPTN    WWOPTN
233000200529     C                     MOVE MCSESN    WWSESN
233100200529     C                     MOVE 'N'       WFIRST
233200200529     C                     ENDIF                           E*4
233300200529      *
233400200529      ** If change of Option number
233500200529     C           MCOPTN    IFNE WWOPTN                     B*4
233600200529     C           MCSESN    ORNE WWSESN
233700200529     C                     MOVE '0'       *IN33                                               189119
233800200529      *                                                                                       189119
233900200529      *
234000200529      ** Setup keylist to LF/SECODPL1
234100200529     C           KEY5      KLIST
234200200529     C                     KFLD           WWREFN  6
234300200529     C                     KFLD           WWOPTN
234400200529     C                     KFLD           WWDSBA
234500200529     C                     KFLD           WWDDPT
234600200529     C                     KFLD           WWSESN
234700200529      *
234800200529      ** Access LF/SECODPL1
234900200529     C           KEY5      CHAINSECODPL1             89
235000200529      *
235100200529     C           *IN89     IFEQ '1'                        B*5
235200200529     C           *LOCK     IN   LDA
235300200529     C                     MOVEL'004'     DBASE            ***************
235400200529     C                     MOVE 'SECODPL1'DBFILE           * DB ERROR 04 *
235500200529     C                     MOVEL'SEE DUMP'DBKEY            ***************
235600200529     C                     OUT  LDA
235700200529     C                     EXSR *PSSR
235800200529     C                     ENDIF                           E*5
235900200529      *
236000200529      **  Stock Allocation of the depot must match the actual stock allocation
236100200529      **  of all customers holding a position at the depot
236200200529     C           MBASTA    IFNE WWASTA                     B*5
236300200529     C                     MOVE 'Y'       WWDIFF
236400200529     C                     ENDIF                           E*5
236500200529     C                     Z-ADDMCASTA    WWASTA
236600200529      *
236700200529      **  Total Cash Allocation of the depot must match the Total actual cash al
236800200529      **  of all customers holding a position at the depot
236900200529      **  (Total Cash = Actual Cash Allocation + Actual Cash Rounding)
237000200529     C           DDFLA     IFEQ 'Y'                        B*5
237100200529     C                     Z-ADD*ZEROS    WTOTCA 150
237200200529     C           MBACAA    ADD  MBACAR    WTOTCA
237300200529     C           WTOTCA    IFNE WWACAA                     B*6
237400200529     C                     MOVE 'Y'       WWDIFF
237500200529     C                     ENDIF                           E*6
237600200529     C                     Z-ADDMCACAA    WWACAA
237700200529     C                     ADD  MCACAR    WWACAA
237800200529     C                     ENDIF                           E*5
237900200529      *
238000200529     C                     Z-ADDMCOPTN    WWOPTN
238100200529     C                     MOVE MCSESN    WWSESN
238200200529      *
238300200529     C                     ELSE                            X*4
238400200529     C                     ADD  MCASTA    WWASTA
238500200529     C           DDFLA     IFEQ 'Y'                        B*5
238600200529     C                     ADD  MCACAA    WWACAA
238700200529     C                     ADD  MCACAR    WWACAA
238800200529     C                     ENDIF                           E*5
238900200529     C                     ENDIF                           E*4
239000200529      *
239100200529     C                     ENDIF                           E*3
239200200529      *
239300200529     C           MCREST    IFNE 'R'                        B*3
239400200529     C           WWDIFF    ANDEQ'N'
239500200529     C           WWPTYP    ANDNE'CC'                                      CEU017
239600200529     C*****                MOVE 'N'       WFIRST                          137879
239700200529     C                     MOVE 'Y'       WWRPLY
239800200529     C                     ENDIF                           E*3
239900200529      *
240000200529     C                     ENDDO                           E*2
240100200529      *
240200200529     C****       WWDIFF    IFEQ 'N'                        B*2            137879
240300200529      ****                                                                137879
240400200529     C****       MBASTA    IFNE WWASTA                     B*3            137879
240500200529     C****       WTOTCA    ORNE WWACAA                                    137879
240600200529     C****                 MOVE 'Y'       WWDIFF                          137879
240700200529     C****                 ENDIF                           E*3            137879
240800200529      ****                                                                137879
240900200529     C****                 ENDIF                           E*2            137879
241000200529      *                                                                   137879
241100200529     C           WWDIFF    IFEQ 'N'                        B*1            137879
241200200529     C           WFIRST    ANDNE'Y'                                       137879
241300200529      *                                                                   137879
241400200529      ** Access LF/SECODPL1                                               137879
241500200529     C           KEY5      CHAINSECODPL1             89                   137879
241600200529      *                                                                   137879
241700200529     C           *IN89     IFEQ '1'                        B*2            137879
241800200529     C           *LOCK     IN   LDA                                       137879
241900200529     C                     MOVEL'005'     DBASE            ***************137879
242000200529     C                     MOVE 'SECODPL1'DBFILE           * DB ERROR 05 *137879
242100200529     C                     MOVEL'SEE DUMP'DBKEY            ***************137879
242200200529     C                     OUT  LDA                                       137879
242300200529     C                     EXSR *PSSR                                     137879
242400200529     C                     ENDIF                           E*2            137879
242500200529      *                                                                   137879
242600200529     C                     Z-ADD*ZEROS    WTOTCA                          137879
242700200529     C           MBACAA    ADD  MBACAR    WTOTCA                          137879
242800200529      *                                                                   137879
242900200529     C           MBASTA    IFNE WWASTA                     B*2            137879
243000200529     C           WTOTCA    ORNE WWACAA                                    137879
243100200529     C           DDFLA     ANDEQ'Y'                                       137879
243200200529     C                     MOVE 'Y'       WWDIFF                          137879
243300200529     C                     ENDIF                           E*2            137879
243400200529      *                                                                   137879
243500200529     C                     ENDIF                           E*1            137879
243600200529      *
243700200529     C                     ENDSR
243800200529      *
243900200529      *****************************************************************
244000200529      * V001   : Validate subfile record                              *
244100200529      *****************************************************************
244200200529      *
244300200529     C           V001      BEGSR
244400200529      *
244500200529      ** If Final Allocation is changed...
244600200529     C           DDFLA     IFNE DDFLAH
244700200529      *                                                                   159517
244800200529     C           WWPTYP    IFEQ 'RG'                                      159517
244900200529     C           WWREFN    CHAINSECORGL1             89                   159517
245000200529      *                                                                   159517
245100200529     C           DDFLAH    IFEQ 'N'                                       159517
245200200529     C           DDFLA     ANDEQ'S'                                       159517
245300200529     C           DDFLAH    OREQ 'N'                                       159517
245400200529     C           DDFLA     ANDEQ'Y'                                       159517
245500200529      *                                                                   159517
245600200529     C           WWREFN    CHAINSECOEXL2             89                   159517
245700200529      *                                                                   159517
245800200529     C           *IN89     IFEQ '1'                                       159517
245900200529     C                     MOVE 'N'       #RECVA                          159517
246000200529     C                     MOVE *ON       *IN51                           159517
246100200529     C                     MOVEL'CO00608' ZAMSID                          159517
246200200529     C                     EXSR ZASNMS                                    159517
246300200529     C                     ENDIF                                          159517
246400200529     C                     ENDIF                                          159517
246500200529     C                     ENDIF                                          159517
246600200529      *
246700200529      ** Final Allocation
246800200529      ** Final Allocation is not 'N', 'S' or 'Y'.
246900200529     C           DDFLA     IFNE 'N'
247000200529     C           DDFLA     ANDNE'S'
247100200529     C           DDFLA     ANDNE'Y'
247200200529     C                     MOVE 'N'       #RECVA
247300200529     C                     MOVE *ON       *IN51
247400200529     C                     MOVEL'CO00188' ZAMSID
247500200529     C                     EXSR ZASNMS
247600200529     C                     ENDIF
247700200529      *
247800200529      ** If current status is 'I', 'X', 'R' or 'C', Final Allocation
247900200529      ** cannot be amended.
248000200529     C           DDFLA     IFNE DDFLAH
248100200529     C           DDSTSH    IFEQ 'I'
248200200529     C           DDSTSH    OREQ 'X'
248300200529     C           DDSTSH    OREQ 'R'
248400200529     C           DDSTSH    OREQ 'C'
248500200529     C                     MOVE 'N'       #RECVA
248600200529     C                     MOVE *ON       *IN51
248700200529     C                     MOVEL'CO00189' ZAMSID
248800200529     C                     EXSR ZASNMS
248900200529     C                     ENDIF
249000200529     C                     ENDIF
249100200529      *
249200200529      ** If current status is 'S', Final Allocation can only be amended
249300200529      ** to 'Y'.
249400200529     C           DDFLA     IFNE 'Y'
249500200529     C           DDSTSH    ANDEQ'S'
249600200529     C                     MOVE 'N'       #RECVA
249700200529     C                     MOVE *ON       *IN51
249800200529     C                     MOVEL'CO00190' ZAMSID
249900200529     C                     EXSR ZASNMS
250000200529     C                     ENDIF
250100200529      *
250200200529     C                     ENDIF
250300200529      *
250400200529      ** If Status is changed...
250500200529     C           DDSTS     IFNE DDSTSH
250600200529      *
250700200529     C           DDSTS     IFEQ 'L'
250800200529     C           DDSTSH    ANDNE'X'
250900200529     C           DDSTSH    ANDNE'S'
251000200529     C           DDSTS     OREQ 'S'
251100200529     C           DDSTSH    ANDNE'X'
251200200529     C           DDSTS     ORNE 'L'
251300200529     C           DDSTS     ANDNE'S'
251400200529     C                     MOVE 'N'       #RECVA
251500200529     C                     MOVE *ON       *IN52
251600200529     C                     MOVEL'CO00191' ZAMSID
251700200529     C                     EXSR ZASNMS
251800200529     C                     ENDIF
251900200529      *                                                                   CSE020
252000200529      ** If Status is changed from 'X' to 'L', all the allocation records CSE020
252100200529      ** for the child, grandchild, and so on should be deleted from      CSE020
252200200529      ** SECOALPD, SECODPPD, and SECODRPD                                 CSE020
252300200529      *                                                                   CSE020
252400200529     C           CSE020    IFEQ 'Y'                                       CSE020
252500200529      *                                                                   CSE020
252600200529     C           DDSTS     IFEQ 'L'                                       CSE020
252700200529     C           DDSTSH    ANDEQ'X'                                       CSE020
252800200529     C           *INKJ     ANDEQ'0'                                       CSE020
252900200529     C                     MOVE 'N'       #RECVA                          CSE020
253000200529     C                     MOVE *ON       *IN52                           CSE020
253100200529     C                     MOVEL'CO00372' ZAMSID                          CSE020
253200200529     C                     EXSR ZASNMS                                    CSE020
253300200529     C                     MOVE 'Y'       W#FLAG  1                       CSE020
253400200529     C                     ENDIF                                          CSE020
253500200529      *                                                                   CSE020
253600200529     C                     ENDIF                                          CSE020
253700200529      *
253800200529     C                     ENDIF
253900200529      *
254000200529     C                     ENDSR
254100200529      *
254200200529      *****************************************************************
254300200529      * V0DV   : 'DV' Processing Type                                 *
254400200529      *****************************************************************
254500200529      *
254600200529     C           V0DV      BEGSR
254700200529      *
254800200529      ** Select requested stage for Dividends Events.
254900200529      *
255000200529      ** Trial Allocation ('LN')
255100200529     C           WWSTGL    IFEQ 'LN'                       B*1
255200200529      ** Final Allocation Stock ('LS')
255300200529     C           WWSTGL    OREQ 'LS'
255400200529      ** Final Allocation Cash and Stock ('LY')
255500200529     C           WWSTGL    OREQ 'LY'
255600200529      ** Stock Authorised ('S')
255700200529     C           WWSTGX    OREQ 'S'
255800200529      ** Fully Authorised ('X')
255900200529     C           WWSTGX    OREQ 'X'
256000200529      *
256100200529     C           MDNSEC    IFEQ *BLANKS                    B*2
256200200529     C           MDSDIT    OREQ *BLANKS
256300200529      *
256400200529     C********** MDDIVU    OREQ *ZEROS                                    190204
256500200529     C           MDDIV1    OREQ *ZEROS                                    190204
256600200529     C           MDSDIT    ANDEQ'C'
256700200529     C********** MDDIVU    OREQ *ZEROS                                    190204
256800200529     C           MDDIV1    OREQ *ZEROS                                    190204
256900200529     C           MDSDIT    ANDEQ'O'
257000200529     C********** MDDIVU    OREQ *ZEROS                                    190204
257100200529     C           MDDIV1    OREQ *ZEROS                                    190204
257200200529     C           MDSDIT    ANDEQ'R'
257300200529      *
257400200529     C********** MDDIVU    OREQ *ZEROS                                    190204
257500200529     C           MDDIV1    OREQ *ZEROS                                    190204
257600200529     C           MDNSHA    ANDEQ*ZEROS
257700200529     C           MDSDIT    ANDEQ'S'
257800200529      *
257900200529     C******     MDSBPR    OREQ *ZEROS                                    135690
258000200529     C******     MDSDIT    ANDEQ'R'                                135689 135690
258100200529     C           MDSDIT    OREQ 'R'                                       135690
258200200529     C           MDSBPR    ANDEQ*ZEROS                                    135690
258300200529     C           MDMRKI    ANDNE'Y'                                       135690
258400200529     C           MDSBPR    OREQ *ZEROS                                    135689
258500200529     C           MDMRKI    ANDNE'Y'                                       135690
258600200529     C********** MDDIVU    ANDNE*ZEROS                              135689190204
258700200529     C           MDDIV1    ANDNE*ZEROS                                    190204
258800200529     C           MDSDIT    ANDEQ'S'                                       135689
258900200529     C           MDSBPR    OREQ *ZEROS                                    135689
259000200529     C           MDMRKI    ANDNE'Y'                                       135690
259100200529     C           MDNSHA    ANDEQ*ZEROS                                    135689
259200200529     C           MDSDIT    ANDEQ'O'                                       135689
259300200529      *
259400200529     C******     MDDSRT    OREQ *ZEROS                                    135689
259500200529     C******     MDSDIT    ANDEQ'R'                                       135689
259600200529      *
259700200529     C           MDNSHA    OREQ *ZEROS
259800200529     C           MDSDIT    ANDEQ'C'
259900200529     C           MDNSHA    OREQ *ZEROS                                    135689
260000200529     C           MDSBPR    ANDEQ*ZEROS                                    135689
260100200529     C           MDMRKI    ANDNE'Y'                                       135690
260200200529     C           MDSDIT    ANDEQ'O'
260300200529      *
260400200529     C           MDOSHA    OREQ *ZEROS
260500200529     C           MDNSHA    ANDNE*ZEROS
260600200529     C           MDDMLT    OREQ *ZEROS
260700200529     C           MDRNDN    OREQ *BLANKS
260800200529     C           MDRNDS    OREQ *BLANKS
260900200529      *
261000200529     C           MDCOMP    OREQ *ZEROS
261100200529     C           MDRNDS    ANDEQ'Y'
261200200529      *
261300200529     C           MDOPSH    OREQ *BLANKS
261400200529     C                     MOVE 'Y'       ERROR   1
261500200529      *
261600200529     C                     ELSE                            X*2
261700200529     C           MDSBRT    IFEQ 'Y'                        B*3
261800200529     C           MDSBRS    IFEQ *BLANKS                    B*4
261900200529     C*****      MDREPR    OREQ *ZEROS                                    137877
262000200529     C           MDREXD    OREQ *ZEROS
262100200529     C           MDREAT    OREQ *BLANKS
262200200529     C           MDRTRF    OREQ *ZEROS
262300200529     C           WWSTGX    ANDEQ'S'                                       137877
262400200529     C           MDRTRF    OREQ *ZEROS                                    137877
262500200529     C           WWSTGX    ANDEQ'X'                                       137877
262600200529     C           MDRTRT    OREQ *ZEROS
262700200529     C           WWSTGX    ANDEQ'S'                                       137877
262800200529     C           MDRTRT    OREQ *ZEROS                                    137877
262900200529     C           WWSTGX    ANDEQ'X'                                       137877
263000200529     C           MDRNNS    OREQ *ZEROS
263100200529     C           MDRNRI    OREQ *ZEROS
263200200529     C           MDRMLT    OREQ *ZEROS
263300200529     C*****      MDRDIV    OREQ *ZEROS                                    137877
263400200529     C                     MOVE 'Y'       ERROR   1
263500200529     C                     ENDIF                           E*4
263600200529     C                     ENDIF                           E*3
263700200529      *
263800200529     C                     ENDIF                           E*2
263900200529      *
264000200529     C                     ENDIF                           E*1
264100200529      *
264200200529      ** Stock Authorised ('S')
264300200529     C           WWSTGX    IFEQ 'S'                        B*1
264400200529      ** Fully Authorised ('X')
264500200529     C           WWSTGX    OREQ 'X'
264600200529      *
264700200529     C           MDSBRT    IFEQ 'Y'                        B*2
264800200529     C           MDREXA    ANDEQ*ZEROS
264900200529     C                     MOVE 'Y'       ERROR   1
265000200529     C                     ENDIF                           E*2
265100200529     C                     ENDIF                           E*1
265200200529      *
265300200529     C                     ENDSR
265400200529      *
265500200529      *****************************************************************
265600200529      * V0FR   : 'FR' Processing Type                                 *
265700200529      *****************************************************************
265800200529      *
265900200529     C           V0FR      BEGSR
266000200529      *
266100200529      ** Status Allocated, Trial Allocation ('LN')
266200200529     C           WWSTGL    IFEQ 'LN'
266300200529      ** Final Allocation Stock ('LS')
266400200529     C           WWSTGL    OREQ 'LS'
266500200529      ** Final Allocation Cash and Stock ('LY')
266600200529     C           WWSTGL    OREQ 'LY'
266700200529      ** Stock Authorised ('S')
266800200529     C           WWSTGX    OREQ 'S'
266900200529      ** Fully Authorised ('X')
267000200529     C           WWSTGX    OREQ 'X'
267100200529      *
267200200529     C           MENSEC    IFEQ *BLANKS
267300200529     C           MENSHA    OREQ *ZEROS
267400200529     C           MEOSHA    OREQ *ZEROS
267500200529     C           MEADRE    OREQ *BLANKS
267600200529     C           MEDMLT    OREQ *ZEROS
267700200529     C           MERNDN    OREQ *BLANKS
267800200529     C           MERNDS    OREQ *BLANKS
267900200529     C           MECOMP    OREQ *ZEROS
268000200529     C           MERNDS    ANDEQ'Y'
268100200529     C           MEOPSH    OREQ *BLANKS
268200200529     C                     MOVE 'Y'       ERROR
268300200529     C                     ENDIF
268400200529     C                     ENDIF
268500200529      *
268600200529     C                     ENDSR
268700200529      *
268800200529      *****************************************************************
268900200529      * V0RG   : 'RG' Processing Type                                 *
269000200529      *****************************************************************
269100200529      *
269200200529     C           V0RG      BEGSR
269300200529      *
269400200529      ** Status Allocated, Trial Allocation ('LN')
269500200529     C           WWSTGL    IFEQ 'LN'
269600200529      ** Final Allocation Stock ('LS')
269700200529     C           WWSTGL    OREQ 'LS'
269800200529      ** Final Allocation Cash and Stock ('LY')
269900200529     C           WWSTGL    OREQ 'LY'
270000200529      ** Stock Authorised ('S')
270100200529     C           WWSTGX    OREQ 'S'
270200200529      ** Fully Authorised ('X')
270300200529     C           WWSTGX    OREQ 'X'
270400200529      *
270500200529     C           MFNSEC    IFEQ *BLANKS
270600200529     C           MFRIMP    OREQ *ZEROS
270700200529     C           MFADRE    OREQ *BLANKS
270800200529     C           MFNSHA    OREQ *ZEROS
270900200529     C           MFOSHA    OREQ *ZEROS
271000200529     C           MFDMLT    OREQ *ZEROS
271100200529     C           MFRNDN    OREQ *BLANKS
271200200529     C           MFRNDS    OREQ *BLANKS
271300200529     C           MFCOMP    OREQ *ZEROS
271400200529     C           MFRNDS    ANDEQ'Y'
271500200529     C           MFOPSH    OREQ *BLANKS
271600200529     C*****      MFSBRS    OREQ *BLANKS                                   159517
271700200529     C*****      MFSBRP    OREQ *ZEROS                                    159517
271800200529     C*****      MFREXD    OREQ *ZEROS                                    159517
271900200529     C*****      MFREXA    OREQ *ZEROS                                    159517
272000200529     C*****      MFREAT    OREQ *BLANKS                                   159517
272100200529     C*****      MFRTRF    OREQ *ZEROS                                    159517
272200200529     C*****      MFRTRT    OREQ *ZEROS                                    159517
272300200529     C*****      MFRNNS    OREQ *ZEROS                                    159517
272400200529     C*****      MFRNRI    OREQ *ZEROS                                    159517
272500200529     C*****      MFRMLT    OREQ *ZEROS                                    159517
272600200529     C*****      MFRDIV    OREQ *ZEROS                                    137877
272700200529     C*****      MFAVOP    OREQ *BLANKS                                   159517
272800200529     C                     MOVE 'Y'       ERROR
272900200529     C                     ENDIF
273000200529     C                     ENDIF
273100200529      *
273200200529     C                     ENDSR
273300200529      *
273400200529      *****************************************************************
273500200529      * V0CE   : 'CE' Processing Type                                 *
273600200529      *****************************************************************
273700200529      *
273800200529     C           V0CE      BEGSR
273900200529      *
274000200529      ** Status Allocated, Trial Allocation ('LN')
274100200529     C           WWSTGL    IFEQ 'LN'
274200200529      ** Final Allocation Stock ('LS')
274300200529     C           WWSTGL    OREQ 'LS'
274400200529      ** Final Allocation Cash and Stock ('LY')
274500200529     C           WWSTGL    OREQ 'LY'
274600200529      ** Stock Authorised ('S')
274700200529     C           WWSTGX    OREQ 'S'
274800200529      ** Fully Authorised ('X')
274900200529     C           WWSTGX    OREQ 'X'
275000200529      *
275100200529     C           MGCARE    IFEQ *ZEROS
275200200529     C           MGOPSH    OREQ *BLANKS
275300200529     C                     MOVE 'Y'       ERROR
275400200529     C                     ENDIF
275500200529     C                     ENDIF
275600200529      *
275700200529     C                     ENDSR
275800200529      *
275900200529      *****************************************************************
276000200529      * V0CR   : 'CR' Processing Type                                 *
276100200529      *****************************************************************
276200200529      *
276300200529     C           V0CR      BEGSR
276400200529      *
276500200529      ** Status Allocated, Trial Allocation ('LN')
276600200529     C           WWSTGL    IFEQ 'LN'
276700200529      ** Final Allocation Stock ('LS')
276800200529     C           WWSTGL    OREQ 'LS'
276900200529      ** Final Allocation Cash and Stock ('LY')
277000200529     C           WWSTGL    OREQ 'LY'
277100200529      ** Stock Authorised ('S')
277200200529     C           WWSTGX    OREQ 'S'
277300200529      ** Fully Authorised ('X')
277400200529     C           WWSTGX    OREQ 'X'
277500200529      *
277600200529     C           MHOSHA    IFEQ *ZEROS
277700200529     C*****      MHCAPA    OREQ *ZEROS                                    135689
277800200529     C           MHADRE    OREQ *BLANKS
277900200529     C           MHOPSH    OREQ *BLANKS
278000200529     C           MHSECA    OREQ *BLANKS
278100200529     C           MHNSHA    OREQ *BLANKS
278200200529     C           MHDMLA    OREQ *BLANKS
278300200529     C           MHRNDN    OREQ *BLANKS
278400200529     C           MHRNDS    OREQ *BLANKS
278500200529     C                     MOVE 'Y'       ERROR
278600200529     C                     ELSE
278700200529      *
278800200529      ** Stock Authorised ('S')
278900200529     C           WWSTGX    IFEQ 'S'
279000200529      ** Fully Authorised ('X')
279100200529     C           WWSTGX    OREQ 'X'
279200200529     C*****      MHMKTP    ANDEQ*BLANKS                                   159908
279300200529     C***********MHMKTP    IFEQ *BLANKS                            159908 162284
279400200529     C                     Z-ADD1         W       20                      162284
279500200529     C                     MOVEAMHSECA    AR1                             162284
279600200529     C                     MOVEAMHMKTP    AR8                             162284
279700200529     C           W         DOWLT21                                        162284
279800200529     C           AR1,W     IFNE *BLANKS                                   162284
279900200529     C           AR8,W     ANDEQ*BLANKS                                   162284
280000200529     C           AR1,W     ORNE *BLANKS                                   162284
280100200529     C           AR8,W     ANDEQ*ZERO                                     162284
280200200529     C                     MOVE 'Y'       ERROR                           136935
280300200529     C                     ENDIF                                          162284
280400200529     C                     ADD  1         W                               162284
280500200529     C                     ENDDO                                          162284
280600200529     C***********          ENDIF                                   159908 162284
280700200529     C           ERROR     IFEQ 'Y'                        B*1            162284
280800200529     C                     MOVEL'CO00700' ZAMSID                          162284
280900200529     C                     EXSR ZASNMS                                    162284
281000200529     C                     ENDIF                                          162284
281100200529     C                     ENDIF
281200200529     C                     ENDIF
281300200529     C                     ENDIF
281400200529      *
281500200529     C                     ENDSR
281600200529      *
281700200529      *****************************************************************
281800200529      * V0OF   : 'OF' Processing Type                                 *
281900200529      *****************************************************************
282000200529      *
282100200529     C           V0OF      BEGSR
282200200529      *
282300200529      ** Status Allocated, Trial Allocation ('LN')
282400200529     C           WWSTGL    IFEQ 'LN'
282500200529      ** Final Allocation Stock ('LS')
282600200529     C           WWSTGL    OREQ 'LS'
282700200529      ** Final Allocation Cash and Stock ('LY')
282800200529     C           WWSTGL    OREQ 'LY'
282900200529      ** Stock Authorised ('S')
283000200529     C           WWSTGX    OREQ 'S'
283100200529      ** Fully Authorised ('X')
283200200529     C           WWSTGX    OREQ 'X'
283300200529      *
283400200529     C           MINSEC    IFEQ *BLANKS
283500200529     C           MIADRE    OREQ *BLANKS
283600200529     C           MIOFTY    ANDNE'P'                                       135689
283700200529     C           MIOFTY    OREQ *BLANKS
283800200529     C           MINSHA    OREQ *ZEROS
283900200529     C           MIOFTY    ANDEQ'E'
284000200529     C           MIOSHA    OREQ *ZEROS
284100200529     C           MIOFTY    ANDEQ'E'
284200200529     C           MIDMLT    OREQ *ZEROS
284300200529     C           MISUPR    OREQ *ZEROS
284400200529     C           MIOFTY    ANDEQ'S'
284500200529     C           MIREPR    OREQ *ZEROS
284600200529     C           MIOFTY    ANDEQ'P'
284700200529     C           MIRNDN    OREQ *BLANKS
284800200529     C           MIRNDS    OREQ *BLANKS
284900200529     C           MICOMP    OREQ *ZEROS
285000200529     C           MIRNDS    ANDEQ'Y'
285100200529     C           MIOPSH    OREQ *BLANKS
285200200529     C                     MOVE 'Y'       ERROR
285300200529     C                     ELSE
285400200529      *
285500200529      ** Stock Authorised ('S')
285600200529     C           WWSTGX    IFEQ 'S'
285700200529      ** Fully Authorised ('X')
285800200529     C           WWSTGX    OREQ 'X'
285900200529     C*****      MIMKTP    ANDEQ*ZEROS                                    159908
286000200529     C           MIMKTP    IFEQ *ZEROS                                    159908
286100200529     C                     MOVE 'Y'       ERROR                           136935
286200200529     C                     ENDIF                                          159908
286300200529     C                     ENDIF
286400200529     C                     ENDIF
286500200529     C                     ENDIF
286600200529      *
286700200529     C                     ENDSR
286800200529      *
286900200529      *****************************************************************
287000200529      * V0EX   : 'EX' processing Type                                 *
287100200529      *****************************************************************
287200200529      *
287300200529     C           V0EX      BEGSR
287400200529      *
287500200529      ** Status Allocated, Trial Allocation ('LN')
287600200529     C           WWSTGL    IFEQ 'LN'
287700200529      ** Final Allocation Stock ('LS')
287800200529     C           WWSTGL    OREQ 'LS'
287900200529      ** Final Allocation Cash and Stock ('LY')
288000200529     C           WWSTGL    OREQ 'LY'
288100200529      ** Stock Authorised ('S')
288200200529     C           WWSTGX    OREQ 'S'
288300200529      ** Fully Authorised ('X')
288400200529     C           WWSTGX    OREQ 'X'
288500200529      *
288600200529     C           MJNSEC    IFEQ *BLANKS
288700200529     C*****      MJTRAF    OREQ *ZEROS                                    137877
288800200529     C*****      MJTRAT    OREQ *ZEROS                                    137877
288900200529     C           MJNSHA    OREQ *ZEROS
289000200529     C           MJCPRC    ANDEQ*ZEROS
289100200529     C           MJOSHA    OREQ *ZEROS
289200200529     C           MJNSHA    ANDNE*ZEROS
289300200529     C*****      MJSUPR    OREQ *ZEROS                                    137877
289400200529     C           MJDMLT    OREQ *ZEROS
289500200529     C           MJRNDN    OREQ *BLANKS
289600200529     C           MJRNDS    OREQ *BLANKS
289700200529     C           MJCOMP    OREQ *ZEROS
289800200529     C           MJRNDS    ANDEQ'Y'
289900200529     C           MJSUPR    OREQ *ZEROS                                    137877
290000200529     C           MJCPRC    ANDNE*ZEROS                                    137877
290100200529     C           MJOPSH    OREQ *BLANKS
290200200529     C                     MOVE 'Y'       ERROR
290300200529     C                     ENDIF
290400200529     C                     ENDIF
290500200529      *
290600200529     C                     ENDSR
290700200529      *
290800200529      *****************************************************************   CEU017
290900200529      * V0CC   : 'CC' processing Type                                 *   CEU017
291000200529      *****************************************************************   CEU017
291100200529      *                                                                   CEU017
291200200529     C           V0CC      BEGSR                                          CEU017
291300200529      *                                                                   CEU017
291400200529      ** Status Allocated, Trial Allocation ('LN')                        CEU017
291500200529     C           WWSTGL    IFEQ 'LN'                                      CEU017
291600200529      ** Final Allocation Stock ('LS')                                    CEU017
291700200529     C           WWSTGL    OREQ 'LS'                                      CEU017
291800200529      ** Final Allocation Cash and Stock ('LY')                           CEU017
291900200529     C           WWSTGL    OREQ 'LY'                                      CEU017
292000200529      ** Stock Authorised ('S')                                           CEU017
292100200529     C           WWSTGX    OREQ 'S'                                       CEU017
292200200529      ** Fully Authorised ('X')                                           CEU017
292300200529     C           WWSTGX    OREQ 'X'                                       CEU017
292400200529      *                                                                   CEU017
292500200529     C           NANCCY    IFEQ *BLANKS                                   CEU017
292600200529     C           NAVCCY    OREQ *BLANKS                                   CEU017
292700200529     C           NANSEC    OREQ *BLANKS                                   CEU017
292800200529     C           NADMLT    OREQ *ZEROS                                    CEU017
292900200529     C           NAONSZ    OREQ *ZEROS                                    CEU017
293000200529     C           NANNSZ    OREQ *ZEROS                                    CEU017
293100200529     C           NARNDN    OREQ *BLANKS                                   CEU017
293200200529     C           NARNDS    OREQ *BLANKS                                   CEU017
293300200529     C******     NACOMP    OREQ *ZEROS                             CEU017 135685
293400200529     C******     NARNDS    ANDEQ'Y'                                CEU017 135685
293500200529     C           NARNDS    OREQ 'Y'                                       135685
293600200529     C           NACOMP    ANDEQ*ZEROS                                    135685
293700200529     C           NAMRKI    ANDNE'Y'                                       135685
293800200529     C                     MOVE 'Y'       ERROR                           CEU017
293900200529     C                     ENDIF                                          CEU017
294000200529     C                     ENDIF                                          CEU017
294100200529      *                                                                   CEU017
294200200529     C                     ENDSR                                          CEU017
294300200529      *                                                                   CEU017
294400200529      *****************************************************************
294500200529      * U001   : Write a record to the subfile                        *
294600200529      *****************************************************************
294700200529      *
294800200529     C           U001      BEGSR
294900200529      *
295000200529      ** ACTION
295100200529     C                     MOVEL*BLANKS   DDACN
295200200529      *
295300200529      ** DEPOT BRANCH
295400200529     C                     MOVELDSBA      DDBRC
295500200529      *
295600200529      ** DEPOT NUMBER
295700200529     C                     MOVELDDPT      DDDEP
295800200529      *
295900200529      ** DEPOT SHORTNAME
296000200529     C                     MOVE *BLANKS   WLKEYC
296100200529     C                     MOVELDDPT      WLKEYC
296200200529     C                     CALL 'AOCUSTR0'
296300200529     C                     PARM '*DBERR'  WLRTCD
296400200529     C                     PARM '*KEY   ' WLOPTN
296500200529     C                     PARM           WLKEYC 10
296600200529     C                     PARM *BLANKS   WLKYST  7
296700200529     C           SDCUST    PARM SDCUST    DSSDY
296800200529      *
296900200529      **  If record not found
297000200529     C           WLRTCD    IFNE *BLANKS                    B*1
297100200529     C           *LOCK     IN   LDA
297200200529     C                     Z-ADD006       DBASE            ****************
297300200529     C                     MOVE 'SDCUSTPD'DBFILE           * DB ERROR 006 *
297400200529     C                     MOVELDDPT      DBKEY            ****************
297500200529     C                     OUT  LDA
297600200529     C                     EXSR *PSSR
297700200529     C                     ENDIF                           E*1
297800200529      *
297900200529     C                     MOVELBBCSSN    DDDEPS
298000200529      *
298100200529      ** EX-DATE POSITION
298200200529     C                     MOVE *OFF      *IN54
298300200529      *
298400200529      ** If record found in LF/SECODPL1, use ex-date position
298500200529      ** in PF/SECODPPD.
298600200529     C           KEY3F     IFEQ *OFF
298700200529      *
298800200529      ** Edit DDEDP
298900200529     C                     MOVE *BLANKS   ZFLD15
299000200529     C                     MOVE MBEXPO    ZFLD15
299100200529     C                     Z-ADDWNCDP     ZDECS
299200200529     C                     MOVE 'L'       ZECODE
299300200529     C                     EXSR ZSEDIT
299400200529     C                     MOVE ZOUT21    DDEDP
299500200529      *
299600200529     C           MATDVD    IFEQ 'V'
299700200529     C           MBEXPO    ANDNEDSNV
299800200529     C           MATDVD    OREQ 'T'
299900200529     C           MBEXPO    ANDNEDSNT
300000200529     C                     MOVE *ON       *IN54
300100200529     C                     ENDIF
300200200529      *
300300200529      ** If not found, use value date or trade date position
300400200529      ** in PF/DPOSND
300500200529     C                     ELSE
300600200529      *
300700200529     C                     MOVE *BLANKS   ZFLD15
300800200529     C           MATDVD    IFEQ 'V'
300900200529     C                     MOVE DSNV      ZFLD15
301000200529     C                     ELSE
301100200529     C                     MOVE DSNT      ZFLD15
301200200529     C                     ENDIF
301300200529      *
301400200529      ** Edit DDEDP
301500200529     C                     Z-ADDWNCDP     ZDECS
301600200529     C                     MOVE 'L'       ZECODE
301700200529     C                     EXSR ZSEDIT
301800200529     C                     MOVE ZOUT21    DDEDP
301900200529      *
302000200529     C                     ENDIF
302100200529      *                                                                   CSE020
302200200529      ** If CA is a child, derive Ex-date position by adding up the       CSE020
302300200529      ** Actual Stock Allocation of the Parent CA.                        CSE020
302400200529      *                                                                   CSE020
302500200529     C           MAPREF    IFNE *BLANKS                                   CSE020
302600200529     C           KEY6      KLIST                                          CSE020
302700200529     C                     KFLD           MAPREF                          CSE020
302800200529     C                     KFLD           DSBA                            CSE020
302900200529     C                     KFLD           DDPT                            CSE020
303000200529     C                     Z-ADD*ZERO     WWASTA                          CSE020
303100200529     C           KEY6      SETLLSECOALL5                                  CSE020
303200200529     C           KEY6      READESECOALL5                 72               CSE020
303300200529     C           *IN72     DOWEQ*OFF                                      CSE020
303400200529     C           M5SESN    IFEQ WWSECN                                    CSE020
303500200529     C                     ADD  M5ASTA    WWASTA                          CSE020
303600200529     C                     ENDIF                                          CSE020
303700200529     C           KEY6      READESECOALL5                 72               CSE020
303800200529     C                     ENDDO                                          CSE020
303900200529     C                     MOVE *BLANKS   ZFLD15                          CSE020
304000200529     C                     MOVE WWASTA    ZFLD15                          CSE020
304100200529     C                     Z-ADDWNCDP     ZDECS                           CSE020
304200200529     C                     MOVE 'L'       ZECODE                          CSE020
304300200529     C                     EXSR ZSEDIT                                    CSE020
304400200529     C                     MOVE ZOUT21    DDEDP                           CSE020
304500200529     C                     ENDIF                                          CSE020
304600200529      *
304700200529      ** LAST ALLOCATION
304800200529      *
304900200529      ** If record found in LF/SECODRL0, use last allocation
305000200529      ** in PF/SECODRPD.
305100200529     C           KEY4F     IFEQ *OFF
305200200529     C           MSCOAD    ANDNE*ZEROS
305300200529     C                     MOVE MSCOAD    ZDAYNO
305400200529      *
305500200529      ** Format date
305600200529     C                     EXSR ZDATE2
305700200529     C                     MOVE ZDATE     DDLTA
305800200529      *
305900200529      ** If not found, output blanks
306000200529     C                     ELSE
306100200529     C                     MOVE *BLANKS   DDLTA
306200200529     C                     ENDIF
306300200529      *
306400200529      ** FINAL ALLOCATION
306500200529      ** If record found in LF/SECODRL0, use final allocation
306600200529      ** in PF/SECODRPD.
306700200529     C           KEY4F     IFEQ *OFF
306800200529     C                     MOVE MSFAID    DDFLA
306900200529      *
307000200529      ** If not found, output blanks
307100200529     C                     ELSE
307200200529     C                     MOVE 'N'       DDFLA
307300200529     C                     ENDIF
307400200529      *
307500200529     C                     MOVE '0'       *IN70
307600200529      *
307700200529      ** STATUS
307800200529      ** If record found in LF/SECODRL0, use status
307900200529      ** in PF/SECODRPD.
308000200529     C           KEY4F     IFEQ *OFF
308100200529     C                     MOVE MSCOST    DDSTS
308200200529     C           MSALOC    IFEQ 'Y'
308300200529     C                     MOVE '1'       *IN70
308400200529     C                     ENDIF
308500200529      *
308600200529      ** If not found, output blanks
308700200529     C                     ELSE
308800200529     C                     MOVE 'I'       DDSTS
308900200529     C                     ENDIF
309000200529      *
309100200529      ** Hidden fields
309200200529     C                     MOVE DDFLA     DDFLAH
309300200529     C                     MOVE DDSTS     DDSTSH
309400200529     C                     MOVE *IN54     SHIN54                          136930
309500200529      *
309600200529      ** Write subfile record
309700200529     C                     WRITESE7512S1
309800200529     C                     ADD  1         SFLLEN
309900200529     C                     ADD  1         SFLRRN     81
310000200529     C                     Z-ADDSFLRRN    #1RRN
310100200529      *
310200200529      ** If record not found write a record on PF/SECODRPD
310300200529     C           KEY4F     IFEQ *ON
310400200529     C                     MOVE 'W'       WWWRUP
310500200529     C                     EXSR U002
310600200529     C                     WRITESECODRD0
310700200529     C                     ENDIF
310800200529      *
310900200529     C                     ENDSR
311000200529      *
311100200529      *****************************************************************
311200200529      * U002   : Update/Write details on PF/SECODRPD                  *
311300200529      *****************************************************************
311400200529      *
311500200529     C           U002      BEGSR
311600200529      *
311700200529      ** Record Identifier
311800200529     C                     MOVE 'D'       MSRECI
311900200529      *
312000200529      ** Last Change Date
312100200529     C                     Z-ADDBJRDNB    MSLCD
312200200529      *
312300200529      ** Type of Last Change
312400200529      ** New Record
312500200529     C           WWWRUP    IFEQ 'W'
312600200529     C                     MOVE 'I'       MSCHTP
312700200529     C                     ENDIF
312800200529      *
312900200529      ** Amend a Record
313000200529     C           WWWRUP    IFEQ 'U'
313100200529     C                     MOVE 'A'       MSCHTP
313200200529     C                     ENDIF
313300200529      *
313400200529      ** Last User Identifier
313500200529     C                     MOVELUSER      MSLUID
313600200529      *
313700200529      ** Reference Number
313800200529     C                     MOVE DDREFN    MSCORF
313900200529      *
314000200529      ** Branch
314100200529     C                     MOVE DDBRC     MSBRCD
314200200529      *
314300200529      ** Depot number
314400200529     C                     MOVELDDDEP     MSDDPT
314500200529      *
314600200529      ** Final Allocation
314700200529     C                     MOVE DDFLA     MSFAID
314800200529      *
314900200529      ** Status
315000200529     C                     MOVE DDSTS     MSCOST
315100200529      *
315200200529      ** Last Allocation Date
315300200529     C                     MOVE DDLTA     ZDATE
315400200529      *
315500200529      ** Convert to equivalent Midas day no.
315600200529     C                     EXSR ZDATE1
315700200529     C                     Z-ADDZDAYNO    MSCOAD
315800200529      *
315900200529     C                     MOVE 'N'       MSALOC
316000200529      *
316100200529     C                     ENDSR
316200200529      *****************************************************************
316300200529      /EJECT
316400200529      *****************************************************************
316500200529      * PALOC  : Action 'L' - Allocation                              *
316600200529      *****************************************************************
316700200529      *
316800200529     C           PALOC     BEGSR
316900200529      *
317000200529     C           DDCONF    IFEQ 'Y'
317100200529      *
317200200529     C                     MOVELDDBRC     WWDSBA
317300200529     C                     MOVELDDDEP     WWDDPT
317400200529      *
317500200529     C           KEY4      CHAINSECODRL0             89
317600200529      *
317700200529     C                     MOVE 'Y'       MSALOC
317800200529     C                     UPDATSECODRD0
317900200529     C                     COMIT
318000200529      *
318100200529     C                     MOVE '1'       *IN70
318200200529      *
318300200529      **   SUBMIT IN BATCH 'CORPORATE ACTIONS ALLOCATION' PROGRAM
318400200529      **   WITH CO REFERENCE AS PARAMETER
318500200529      *
318600200529     C                     MOVEL*BLANKS   CMDTXT
318700200529     C***********          MOVEL*BLANKS   CMDTX1160                                           CPK014
318800200529     C                     Z-ADD240       CMDLEN 155
318900200529     C***********          MOVELCMD,1     CMDTX1                                              CPK014
319000200529     C***********          MOVE CMD,2     CMDTX1                                              CPK014
319100200529     C***********          MOVELCMDTX1    CMDTXT                                              CPK014
319200200529     C***********          MOVE CMD,3     CMDTXT                                              CPK014
319300200529     C                     MOVELCMD,1     CMDTXT                                              CPK014
319400200529     C                     MOVELCMD,2     CMDTX2                                              CPK014
319500200529     C                     MOVELCMD,3     CMDTX3                                              CPK014
319600200529      *
319700200529     C                     MOVELDDREFN    @REF
319800200529     C                     MOVELDDACN     @ACTI
319900200529      *
320000200529     C                     MOVELDDREFN    @REFN
320100200529     C                     MOVELDDBRC     @BRCD
320200200529     C                     MOVELDDDEP     @DEPT
320500200529      *
320600200529     C                     CALL 'QCMDEXC'
320700200529     C                     PARM           CMDTXT
320800200529     C                     PARM           CMDLEN
320900200529      *
321000200529      ** Clear messages from program message quque.
321100200529      *
321200200529     C                     CALL 'Y2CLMSC'
321300200529     C                     PARM ##PGM     ZAPGM  10
321400200529     C                     PARM '*SAME'   ZAPGRL  5
321500200529      *
321600200529     C                     MOVEL'CO00293' ZAMSID
321700200529     C                     EXSR ZASNMS
321800200529     C                     ENDIF
321900200529      *
322000200529     C                     MOVE *BLANKS   DDACN
322100200529      *
322200200529     C                     ENDSR
322300200529      *****************************************************************
322400200529      /EJECT
322500200529      *****************************************************************
322600200529      * PATHR  : Action 'X' - Authorisation                           *
322700200529      *****************************************************************
322800200529      *
322900200529     C           PATHR     BEGSR
323000200529      *
323100200529     C           DDCONF    IFEQ 'Y'
323200200529      *
323300200529      ** If the Final Indicator is 'S' (Final Stock Allocation)
323400200529      ** Status will be changed to 'S'
323500200529     C           DDFLA     IFEQ 'S'
323600200529     C                     MOVE 'S'       DDSTS
323700200529     C                     MOVE 'S'       DDSTSH
323800200529     C                     ELSE
323900200529      *
324000200529      ** If the Final Indicator is 'Y' (Final Stock AND Cash Allocation)
324100200529      ** Status will be changed to 'X'
324200200529     C           DDFLA     IFEQ 'Y'
324300200529     C                     MOVE 'X'       DDSTS
324400200529     C                     MOVE 'X'       DDSTSH
324500200529     C                     ENDIF
324600200529     C                     ENDIF
324700200529      *
324800200529     C           KEY4      CHAINSECODRL0             89
324900200529     C                     MOVE DDSTS     MSCOST
325000200529     C                     UPDATSECODRD0
325100200529     C                     ENDIF
325200200529      *
325300200529     C                     ENDSR
325400200529      *****************************************************************   CSE020
325500200529      /EJECT                                                              CSE020
325600200529      *****************************************************************   CSE020
325700200529      * SRDELT : Delete all allocation records of subordinates        *   CSE020
325800200529      *****************************************************************   CSE020
325900200529      *                                                                   CSE020
326000200529     C           SRDELT    BEGSR                                          CSE020
326100200529      *                                                                   CSE020
326200200529      ** Set pointer                                                      CSE020
326300200529      *                                                                   CSE020
326400200529     C           1         SETLLSECORFPM                                  CSE020
326500200529     C                     READ SECORFPM                 88               CSE020
326600200529     C           MOCORF    DOWNEWWREFN                                    CSE020
326700200529     C           *IN88     ANDNE'1'                                       CSE020
326800200529     C                     READ SECORFPM                 88               CSE020
326900200529     C                     ENDDO                                          CSE020
327000200529      *                                                                   CSE020
327100200529     C                     READ SECORFPM                 88               CSE020
327200200529      *                                                                   CSE020
327300200529     C           MOLEVL    DOWNE*BLANKS                                   CSE020
327400200529     C           MOLEVL    ANDNE'+'                                       CSE020
327500200529     C           *IN88     ANDEQ'0'                                       CSE020
327600200529      *                                                                   CSE020
327700200529      ** Delete all records in SECOALPD                                   CSE020
327800200529      *                                                                   CSE020
327900200529     C           MOCORF    SETLLSECOALL7                                  CSE020
328000200529     C           MOCORF    READESECOALL7                 88               CSE020
328100200529     C           *IN88     DOWEQ'0'                                       CSE020
328200200529     C                     DELETSECOALL7                                  CSE020
328300200529     C           MOCORF    READESECOALL7                 88               CSE020
328400200529     C                     ENDDO                                          CSE020
328500200529      *                                                                   CSE020
328600200529      ** Delete all records in SECODPPD                                   CSE020
328700200529      *                                                                   CSE020
328800200529     C           MOCORF    SETLLSECODPL5                                  CSE020
328900200529     C           MOCORF    READESECODPL5                 88               CSE020
329000200529     C           *IN88     DOWEQ'0'                                       CSE020
329100200529     C                     DELETSECODPL5                                  CSE020
329200200529     C           MOCORF    READESECODPL5                 88               CSE020
329300200529     C                     ENDDO                                          CSE020
329400200529      *                                                                   CSE020
329500200529      ** Delete all records in SECODRPD                                   CSE020
329600200529      *                                                                   CSE020
329700200529     C           MOCORF    SETLLSECODRL0                                  CSE020
329800200529     C           MOCORF    READESECODRL0                 88               CSE020
329900200529     C           *IN88     DOWEQ'0'                                       CSE020
330000200529     C                     DELETSECODRL0                                  CSE020
330100200529     C           MOCORF    READESECODRL0                 88               CSE020
330200200529     C                     ENDDO                                          CSE020
330300200529      *                                                                   CSE020
330400200529      ** Update Status of Subordinates                                    CSE020
330500200529      *                                                                   CSE020
330600200529     C           MOCORF    CHAINSECORFL1             88                   CSE020
330700200529     C           *IN88     IFEQ '0'                                       CSE020
330800200529     C                     MOVE 'I'       MNSTAT                          CSE020
330900200529     C                     UPDATSECORFD1                                  CSE020
331000200529     C                     ENDIF                                          CSE020
331100200529      *                                                                   CSE020
331200200529     C                     READ SECORFPM                 88               CSE020
331300200529      *                                                                   CSE020
331400200529     C                     ENDDO                                          CSE020
331500200529      *                                                                   CSE020
331600200529     C                     ENDSR                                          CSE020
331700200529      *****************************************************************
331800200529      /EJECT
331900200529      *****************************************************************
332000200529      * PPRNT  : Action 'P' - Print Allocation Report                 *
332100200529      *****************************************************************
332200200529      *
332300200529     C           PPRNT     BEGSR
332400200529      *
332500200529     C                     MOVE *BLANKS   DDACN
332600200529     C                     MOVE *BLANKS   DDSLAL
332700200529      *
332800200529     C                     MOVEL'SE7534'  @RNAM
332900200529     C                     MOVEL'SEC7534' @COTT
333000200529     C                     CALL 'FC0040X'
333100200529     C                     PARM *BLANKS   @RTCD   7
333200200529     C                     PARM           @RNAM  10
333300200529     C                     PARM           @COTT  10
333400200529     C                     PARM '10001'   @CSEQ   5
333500200529     C                     PARM           @PARM 100
333600200529     C                     PARM AGMBIN    @MBRC   1
333700200529     C                     PARM 'S'       @LVL    1
333800200529     C                     PARM *BLANKS   @ETTY   3
333900200529      *
334000200529      **   IR ERROR INDICATOR OF THE PROGRAM CALL IS ON
334100200529      **   OR IF RETURN CODE IS EQUAL TO 'E' (ERROR)
334200200529      **         DATABASE ERROR
334300200529      *
334400200529     C           @RTCD     IFNE *BLANKS
334500200529     C           *LOCK     IN   LDA
334600200529     C                     MOVEL'007'     DBASE            *****************
334700200529     C                     MOVEL*BLANKS   DBFILE           ** DB ERROR 07 **
334800200529     C                     MOVELNARR,1    DBKEY            *****************
334900200529     C                     OUT  LDA
335000200529     C                     EXSR *PSSR
335100200529     C                     END                             E*2
335200200529      *
335300200529     C                     MOVEL'CO00292' ZAMSID
335400200529     C                     EXSR ZASNMS
335500200529      *
335600200529     C                     ENDSR
335700200529      *****************************************************************
335800200529      /EJECT
335900200529      *****************************************************************
336000200529      * *PSSR : Error processing                                      *
336100200529      *****************************************************************
336200200529      *
336300200529     C           *PSSR     BEGSR
336400200529      *
336500200529      ** Update LDA with error information
336600200529      *
336700200529     C           *NAMVAR   DEFN           LDA
336800200529     C           *LOCK     IN   LDA
336900200529     C                     MOVELDBFILE    WWFILE
337000200529     C                     MOVELDBKEY     WWKEY
337100200529     C                     MOVELDBPGM     WWPGM
337200200529     C                     MOVELDBASE     WWASE
337300200529     C                     OUT  LDA
337400200529      *
337500200529      **   ROLLBACK CHANGES, PRINT DUMP AND CANCEL PROGRAM
337600200529     C                     ROLBK
337700200529     C                     MOVE 'E'       WWRTCD
337800200529     C                     DUMP
337900200529      *
338000200529     C                     MOVE *ON       *INU7
338100200529     C                     MOVE *ON       *INU8
338200200529     C                     MOVE *ON       *INLR
338300200529     C                     RETRN
338400200529      *
338500200529     C                     ENDSR
338600200529      *****************************************************************
338700200529      /EJECT
338800200529      *****************************************************************
338900200529      *                                                               *
339000200529      * ZASNMS   - Send message to program message queue              *
339100200529      *                                                               *
339200200529      * CALLS    Y2SNMSGC                                             *
339300200529      *                                                               *
339400200529      * CALLED BY                                                     *
339500200529      *                                                               *
339600200529      *****************************************************************
339700200529     C           ZASNMS    BEGSR
339800200529      *
339900200529     C                     CALL 'Y2SNMGC'
340000200529     C                     PARM           ZAPGM            Program queue
340100200529     C                     PARM           ZAPGRL           Rel queue
340200200529     C                     PARM           ZAMSID           Message Id.
340300200529     C                     PARM           ZAMSGF           Message file.
340400200529     C                     PARM           ZAMSDA           Message data.
340500200529     C                     PARM           ZAMSTP           Message type.
340600200529      *
340700200529      ** Clear all fields for default mechanism next time.
340800200529     C                     MOVEL*BLANK    ZAPGM            Message queue
340900200529     C                     MOVEL*BLANK    ZAPGRL           Rel queue
341000200529     C                     MOVEL*BLANK    ZAMSDA           Message data.
341100200529     C                     MOVEL*BLANK    ZAMSTP           Message type.
341200200529      *
341300200529     C           ZASNM9    ENDSR                           ZASNM9 TAG
341400200529      **
341500200529     C/COPY ZSRSRC,ZSEDITZ3
341600200529     C/COPY ZSRSRC,ZDATE1Z2
341700200529     C/COPY ZSRSRC,ZDATE2Z4
341800200529     C/COPY ZSRSRC,ZASIGNZ2
341900200529      **
342000200529**  CPY@
342100200529(c) Finastra International Limited 2001
342200200529**
342300200529F3=Exit  F5=Refresh  F12=Previous Screen  Rollup/Down
342400200529F3=Exit  F12=Previous
342500200529F3=Exit F5=Refresh Screen F12=Previous F20=Exit Without Saving   Rollup/Down
342600200529F12=Previous
342700200529F3=Exit  F5=Refresh  F12=Previous Screen  Rollup/Down  F10=Confirm
342800200529**   ZYDY - YEARS IN DAYS CUMULATIVE, FOUR YEAR SPAN
3429002005290366073110961461
343000200529**   ZMDY - MONTHS IN DAYS CUMULATIVE THROUGH YEAR
343100200529000031059090120151181212243273304334365
343200200529**   ZMNM - MONTHS SHORT NAMES
343300200529JANFEBMARAPRMAYJUNJULAUGSEPOCTNOVDEC
343400200529**  CMD - CALL 'QCMDEXC' TO SBMJOB
343401200619SBMJOB JOB(CONNNNNNX) JOBD(BULKTJOBD) RQSDTA('CALL PGM(SEC7550) PARM(''XXXXXX''
343402200619''XXX'' ''XXXXXX'' ''  '' ''          '' ''  '' ''      '' ''    '')')
343403200619MSGQ(MOPERQ) RTGDTA(*NONE) INLLIBL(*JOBD) USER(*JOBD) OUTQ(*JOBD)                             CSC023
343800200529**  NARR
343900200529ERROR CALL PGM 'SE7534'
344000200529ERROR CALL PGM 'SE7592'
344100200529ERROR CALL PGM 'SE7593'
