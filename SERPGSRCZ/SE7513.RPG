000100200529     H        1
000200200529      *****************************************************************
000300200529/*XBI *: OVRDBF FILE(SECTYZ1) TOFILE(SECTY) SHARE(*NO)              : *
000400200529/*STD *  RPGBASE                                                      *
000500200529/*EXI *  TEXT('Midas SE CO customer/book by depot maintenance')
000600200529      *****************************************************************
000700200529      *                                                               *
000800200529      *  Midas - Securities Trading Module                            *
000900200529      *                                                               *
001000200529      *  SE7513 -  Corporate Action Customer/Book Maintenance         *
001100200529      *                                                               *
001200200529      *  Function:  Used to maintain details of allocations per       *
001300200529      *  (I/C)      Customer/Book position to a specific depot.       *
001400200529      *                                                               *
001500200529      *  BE CAREFUL: All amendments of calculations made in this      *
001600200529      *              program must obligatorily be done in RPG/        *
001700200529      *              SE7550: Midas SE Corporate Actions Automatic     *
001800200529      *               Allocation Processing |                         *
001900200529      *               Some of those amendments must perhaps be done   *
002000200529      *               in RPG/SE7593: Midas SE Corporate Actions       *
002100200529      *               Depot Maintenance, depending on calculations    *
002200200529      *               used in this program |                          *
002300200529      *                                                               *
002400200529      *  Called by: SE7593  -  Corporate Action Depot Maintenance     *
002500200529      *                                                               *
002600200529      *  Calls: AOSTRDR0 - Midas AO Securities Trading ICD access obj.*
002700200529      *         AOMMODR0 - Midas AO Access Midas Modules *RDR.        *
002800200529      *         AOPORTR0 - Midas AO Portfolio Management ICD *RDR.    *
002900200529      *         AOBANKR0 - Midas AO Bank ICD access object.           *
003000200529      *         AOCUSTR0 - Midas AO Client details access object.     *
003100200529      *         AOCUSTR1 - Midas AO Client details access object.     *                       223539
003200200529      *         AOCURRR0 - Midas AO Currency codes access object.     *
003300200529      *         AOPLCSR0 - Midas AO Portfolio Mngemnt Cust Det. *RDR. *
003400200529      *         AOSARDR0 - Midas AO Sweatchable Features.             *
003500200529      *         AOBRCHR0 - Midas AO Branch details access object.     *
003600200529      *         AOSCTXR0 - Midas AO SE Country Tax Rates.             *
003700200529      *         AOCBTXR0 - Midas AO SE Country to Branch Tax Rates.   *
003800200529      *         AOSECSR0 - Midas AO Securities Clients *RDR.          *
003900200529      *         Y2CLMSC  - Midas ABS Clear specific program message   *
004000200529      *                    queue.                                     *
004100200529      *         Y2SNMGC  - Midas ABS Send a message SNDxxxMSG.        *
004200200529      *         DBERRCTL - Midas SC DB error ctl for interactive jobs.*
004300200529      *         SE7515   - Midas SE Corporate Action Reply Handling   *
004400200529      *                    Maintenance.                               *
004500200529      *         SE7540   - Midas SE Global Customer/Book Enquiry.     *
004600200529      *         SE7550   - Midas SE Corporate Actiona Automatic       *
004700200529      *                    Allocation Processing (SBMJOB BY CALL      *
004800200529      *                    QCMDEXC).                                  *
004900200529      *                                                               *
005000200529      *  (c) Finastra International Limited 2001                      *
005100200529      *                                                               *
005500200619      *  Last Amend No. MD046248           Date 27Oct17               *
005600200529      * Bank Fusion Midas 1.4 Base -----------------------------------*
005700200529      * Midas Plus 1.4 Base 04 ---------------------------------------*
005800200529      * Midas Plus 1.4 Base ------------------------------------------*
005900200529      * Midas Plus 1.3 ----------- Base ------------------------------*
006000200619      *  PREV Amend No. CSD031             Date 10Apr06               *
006100200529      *                 CSD027             Date 09Dec05               *
006200200529      *                 CSE071             Date 19Jul05               *
006300200529      *                 CSW037A            Date 02May05               *
006400200529      *                 223182             Date 30Jan04               *
006500200529      *                 223539             Date 23Jan04               *
006600200529      *                 CSD025             Date 11Jan05               *
006700200529      *                 CSW037             Date 15Dec04               *
006800200529      *                 CSW036             Date 15Dec04               *
006900200529      *                 BUG3122            Date 17Jul04               *
007000200529      *                 CLE025             Date 20Oct03               *
007100200529      *                 CGL029             Date 01Sep03               *
007200200529      *                 CSC023             Date 28Jan04               *
007300200529      * Midas Release 4 --------------- Base -------------------------*
007400200529      *                 CPK014             Date 11Oct01               *
007500200529      *                 190204             Date 31May01               *
007600200529      * Midas DBA 3.05 -----------------------------------------------*
007700200529      *                 184520             Date 17Jan01               *
007800200529      *                 179205             Date 27Dec00               *
007900200529      * Midas DBA 3.03 -----------------------------------------------*
008000200529      *                 177221             Date 28Mar00               *
008100200529      *                 CSE020             Date 21Mar00               *
008200200529      *                 161732             Date 21Mar00               *
008300200529      *                 179197             Date 18May00               *
008400200529      * Midas DBA 3.02 -----------------------------------------------*
008500200529      *                 CPB001             Date 26Aug99               *
008600200529      * Midas DBA 3.00 ---------------- Base -------------------------*
008700200529      *                  161591            Date 07JUN99               *
008800200529      *                  161641            Date 13MAY99               *
008900200529      *                  CAC005            Date 23Nov98               *
009000200529      *                  155622            Date 18Feb99               *
009100200529      *                  145872            Date 23Oct98               *
009200200529      *                  136935            Date 27Jul98               *
009300200529      *                  137879            Date 01Jul98               *
009400200529      *                  136930            Date 17Jun98               *
009500200529      *                  135690            Date 08Jun98               *
009600200529      *                  135686            Date 05Jun98               *
009700200529      *                  135689            Date 02Jun98               *
009800200529      *                  135685            Date 28May98               *
009900200529      *                  CEU017            Date 05Mar98               *
010000200529      *                  CSE007 *CREATE    Date 01Dec97               *
010100200529      *                                                               *
010200200529      *****************************************************************
010300200529      *                                                               *
012000200529      *  MD046248 - Finastra Rebranding                               *
012100200529      *  CSD031 - Enhanced Centralised Static Data (Recompile)        *
012200200529      *  CSD027 - Conversion Of Customer Number to Alpha              *
012300200529      *  CSE071 - Multiple Holidays Re Securities (recompile)         *
012400200529      *  CSW037A- Additional Field extended to 40 chars (recompile)   *
012500200529      *  223182 - Error on Corporate Action - Write *CLOSED*          *
012600200529      *           narrative to closed customers and protected fields  *
012700200529      *           for manual allocations.                             *
012800200529      *  223539 - Corporate Actions - Locks on CA events maintenance  *
012900200529      *           Access AOCUSTR1 insted of AOCUSTR0 and Ignore       *
013000200529      *           DBERR if Customer is closed.                        *
013100200529      *  CSD025 - Customer De-Activation                              *
013200200529      *  CSW037 - Additional Field Data on MT300/MT320                *
013300200529      *  CSW036 - Dual SWIFT BIC held on Client Details               *
013400200529      *  BUG3122 - Recompiled due to changes in SDSECSPD.             *
013500200529      *  CLE025 - Credit Lines (Recompile)                            *
013600200529      *  CGL029 - Increase Account Code to 10 digits                  *
013700200529      *  CSC023 - SBMJOB output queue must be *JOBD.                  *
013800200529      *  CPK014 - Release 4 packaging. Field names for subfile out of *
013900200529      *           step.                                               *
014000200529      *         - Submit jobs with user *JOBD                         *
014100200529      *  190204 - Changed Dividend per Unit format from 9N0 to 13N8.  *
014200200529      *  184520 - If two dummy records needed for corporate action,   *
014300200529      *           display the second one on file.                     *
014400200529      *  179205 - If only a charge or a commission, fee calculated    *
014500200529      *           is zero. Allow the two to be calculated seperately. *
014600200529      *           Do not multiply result by CCY decimal places.       *
014700200529      *  177221 - DB error on CA Customer/Book Depot Maintenance due  *
014800200529      *           to opened file.                                     *
014900200529      *  CSE020 - Corporate Actions Domino Effect Processing          *
015000200529      *  161732 - Corporate Actions Exercise and Conversion - Part    *
015100200529      *           Stock/Keep Rest Calculation.                        *
015200200529      *  179197 - Corrected Mesage IDs                                *
015300200529      *  CPB001 - 'Private Banking' Module                            *
015400200529      *  161591 - Actual Cash Allocation Incorrect After Manual       *
015500200529      *           Changes Of Actual Stock Allocation                  *
015600200529      *  161641 - Change way of calculation of Total Settlement       *
015700200529      *  CAC005 - Profit Centre Accounting - SE Enhancement           *
015800200529      *  155622 - Corporate Actions: IBM problem displaying narrative *
015900200529      *           fields inside a subfile when compiling with multi-  *
016000200529      *           language indicator *ON                              *
016100200529      *  145872 - Corporate Actions: '% to Exchange' added for        *
016200200529      *           Exchange Offer ('OF').                              *
016300200529      *           If Exchange Offer, Calculat Base Ex-Date Position = *
016400200529      *           Ex-Date Position multiplied by Percentage to        *
016500200529      *           Exchange.                                           *
016600200529      *  136935 - Corporate Actions: Allocation processing amendments:*
016700200529      *           1. Due to database error, setup Portfolio screen    *
016800200529      *              fields to blank if Dummy Customer.               *
016900200529      *           2. Amend wrong calculation of Balancing Cash Alloca-*
017000200529      *              tion if Actual Stock Allocation amended on       *
017100200529      *              normal screen and loading new field on subfile   *
017200200529      *              control.                                         *
017300200529      *           3. Amend wrong calculation of Actual Cash rounding  *
017400200529      *              for Security '**CASH**' if Actual Cash Rounding  *
017500200529      *              amended on normal screen.                        *
017600200529      *           4. Amend Reply Status to 'M' (=Maunally Changed) for*
017700200529      *              Security '**CASH**' when at least one field has  *
017800200529      *              been recalculated, instead of when all fields    *
017900200529      *              have been recalculated.                          *
018000200529      *           5. Input Balancing Difference on Dummy Customer if  *
018100200529      *              Currency Change or depending if field 'Allocate  *
018200200529      *              Difference to Dummy' = 'Y' on Securities Trading *
018300200529      *              ICD.                                             *
018400200529      *           6. Amend wrong recalculation of Total Taxes, only   *
018500200529      *              for Reinvestment of Dividend.                    *
018600200529      *           7. Amend calculations for Offers.                   *
018700200529      *           8. Amend calculations for Exercices and Conversions.*
018800200529      *           9. For Reinvestment of Dividend, if Compensation    *
018900200529      *              Price entered, use Compensation Price instead of *
019000200529      *              Subscription Price, otherwise, calculate Sub-    *
019100200529      *              scription Price = Subscription Price minus Dis-  *
019200200529      *              count Rate.                                      *
019300200529      *  137879 - Amend Review from processing, if Status selected    *
019400200529      *           and roll up, the next pages shown all Status.       *
019500200529      *  136930 - EMU and Corporate Actions: various errors:          *
019600200529      *           1. Retrieve Allocation details for Customers in     *
019700200529      *              each case, not only if Status equal 'L' or 'X'.  *
019800200529      *           2. Amend wrong validation of action codes on        *
019900200529      *              enquiry mode.                                    *
020000200529      *  135690 - Various errors for Corporate Actions:               *
020100200529      *           1. Due to Fix 135689: Error in validation of        *
020200200529      *              Dividend per Unit, amend number of decimal       *
020300200529      *              places of Dividend per Unit for Dividend Events, *
020400200529      *              from New Currency instead of New Security.       *
020500200529      *           2. Amend wrong calculation of Holding Taken as      *
020600200529      *              Stock for Dividend Events.                       *
020700200529      *           3. Amend wrong loading of Cash preferred % for      *
020800200529      *              Processing Type Rights Issues, Cash Preferred %  *
020900200529      *              must always equal 0.                             *
021000200529      *           4. Amend wrong calculation of Cash Preferred % in   *
021100200529      *              case 2.1: if Standard Instruction found,         *
021200200529      *              condition if Cash % later than 50 or greater     *
021300200529      *              50 becomes if later than 50 or greater or equal  *
021400200529      *              50.                                              *
021500200529      *  135686 - Corporate Actions and EMU                           *
021600200529      *           1. Change Database error 23 to 33, 23 already used  *
021700200529      *           2. Due database error, don't check if Actual Stock  *
021800200529      *              Allocation entered is on Denomination Multiplier *
021900200529      *              precision if processing type = CE, NC or NF      *
022000200529      *           3. Amend wrong calculation on Actual Stock          *
022100200529      *              Allocation: if with Denomination Multiplier      *
022200200529      *              precision, no Decimal Placesused, so retrieve    *
022300200529      *              New Security Decimal Places.                     *
022400200529      *  135689 - Corporate Actions and EMU: various errors:          *
022500200529      *           1. Reset saved field SHIND4 used to blink Ex-Date   *
022600200529      *              Position on subfile record.                      *
022700200529      *           2. Don't allow Action Code 'L' (Run Allocation) on  *
022800200529      *              subfile for 'CASH' screen'.                      *
022900200529      *  135685 - It's not feasible to enter the Compensation Price   *
023000200529      *           at the Bulk level as the Bulk will have many        *
023100200529      *           Securities all giving a cash compensation at a      *
023200200529      *           different level. Therefore, allow the entry of      *
023300200529      *           'MARKET' which will use the Market Price of the     *
023400200529      *           Security at allocation effective date.              *
023500200529      *  CEU017 - Securities Redenomination Euro Changes              *
023600200529      *  CSE007- Corporate Actions                                    *
023700200529      *                                                               *
023800200529      *****************************************************************
023900200529      *
024000200529      ***  Midas SE Securities                                           - Prefixe
024100200529      *
024200200529     FSECTYZ1 IF  E           K        DISK         KINFSR *PSSR
024300200529      *
024400200529      ***  SE Corporate Actions - References Rtv Idx                     - Prefixe MA
024500200529      *
024600200529     FSECORFL1IF  E           K        DISK         KINFSR *PSSR
024700200529      *                                                                   CPB001
024800200529      ***  Midas PM Live Portfolio definition details                     CPB001
024900200529      *                                                                   CPB001
025000200529     F***PMPORTLLIF  E           K        DISK         KINFSR *PSSRCPB001 177221
025100200529     FPMPORTLLIF  E           K        DISK         KINFSR *PSSR      UC  177221
025200200529      *
025300200529      ***  Midas Corporate Actions - Depots live records                 - Prefixe MB
025400200529      *
025500200529     FSECODPL3UF  E           K        DISK         KINFSR *PSSR
025600200529     F                                              KCOMIT
026000200529      *
026100200529      ***  SE Corpotrate Actions - Allocat. Live Records                 - Prefixe MC
026200200529      *
026300200529     FSECOALL7UF  E           K        DISK         KINFSR *PSSR A
026400200529     F                                              KCOMIT
026500200529      *
026600200529      ***  SE Corporate Actions - Allocat. Live Records                  - Prefixe MC
026700200529      *
026800200529     FSECOALL1IF  E           K        DISK         KINFSR *PSSR
026900200529     F            SECOALD0                          KRENAMESECOALD1
027000200529      *
027100200529      ***  Midas SE User Depot Positions - Detail                        - Prefixe
027200200529      *
027300200529     FSEUDEPL0IF  E           K        DISK         KINFSR *PSSR
027400200529      *
027500200529      ***  Midas SE Client Depot Positions - Detail                      - Prefixe
027600200529      *
027700200529     FSECDEPL4IF  E           K        DISK         KINFSR *PSSR
027800200529      *
027900200529      ***  Midas SE Corporate Actions - Reply Handling                   - Prefixe MQ
028000200529      *
028100200529     FSECOREL1IF  E           K        DISK         KINFSR *PSSR
028200200529      *
028300200529      ***  Midas SE Corporate Actions - Instructions by Cust.            - Prefixe MO
028400200529      *
028500200529     FSECOSIL1IF  E           K        DISK         KINFSR *PSSR
028600200529      *
028700200529      ***  Midas SE Corporate Actions - Instructions by Book             - Prefixe MO
028800200529      *
028900200529     FSECOSIL2IF  E           K        DISK         KINFSR *PSSR
029000200529     F            SECOSID0                          KRENAMESECOSID2
029100200529      *
029200200529      ***  Midas SE Corporate Actions - Exchange Offers                  - Prefixe MI
029300200529      *
029400200529     FSECOOFL1IF  E           K        DISK         KINFSR *PSSR
029500200529      *
029600200529      ***  Midas SE Corporate Actions - Dividends Events                 - Prefixe MD
029700200529      *
029800200529     FSECODVL1IF  E           K        DISK         KINFSR *PSSR
029900200529      *
030000200529      ***  Midas SE Corporate Actions - Rights                           - Prefixe MF
030100200529      *
030200200529     FSECORGL1IF  E           K        DISK         KINFSR *PSSR
030300200529      *
030400200529      ***  Midas SE Corporate Actions - Exercice & Conversion            - Prefixe MJ
030500200529      *
030600200529     FSECOEXL1IF  E           K        DISK         KINFSR *PSSR
030700200529      *                                                                   CSE020
030800200529      ***  Midas SE Corporate Actions - Exercice & Conversion            -CSE020
030900200529      *                                                                   CSE020
031000200529     FSECONCL1IF  E           K        DISK         KINFSR *PSSR          CSE020
031100200529      *
031200200529      ***  Midas SE Corporate Actions - Corp. Reorganisation             - Prefixe MH
031300200529      *
031400200529     FSECOCRL1IF  E           K        DISK         KINFSR *PSSR
031500200529      *
031600200529      ***  Midas SE Corporate Actions - Free Allocations                 - Prefixe ME
031700200529      *
031800200529     FSECOFRL1IF  E           K        DISK         KINFSR *PSSR
031900200529      *
032000200529      ***  Midas SE Corporate Actions - Capital Events                   - Prefixe MG
032100200529      *
032200200529     FSECOCEL1IF  E           K        DISK         KINFSR *PSSR
032300200529      *                                                                   CEU017
032400200529      ***  Midas SE Corporate Actions - Currency Changes                  CEU017
032500200529      ***                                                    - Prefixe NA CEU017
032600200529      *                                                                   CEU017
032700200529     FSECOCCL2IF  E           K        DISK         KINFSR *PSSR          CEU017
032800200529      *
032900200529      ***  Midas SE Security Withholding Tax Details                     - Prefixe S1
033000200529      *
033100200529     FSESWHTL0IF  E           K        DISK         KINFSR *PSSR
033200200529      *
033300200529      ***  Midas SD Customer master file                                 - Prefixe
033400200529      *
033500200529     FCLINT   IF  E           K        DISK         KINFSR *PSSR
033600200529     F            CLINTCAF                          KIGNORE
033700200529     F            CLINTCCF                          KIGNORE
033800200529     F            CLINTC1F                          KIGNORE
033900200529     F            CLINTSEF                          KIGNORE
034000200529      *
034100200529      ***  Midas SE Corporate Actions - Default Charges                  - Prefixe MR
034200200529      *
034300200529     FSECOCHL0IF  E           K        DISK         KINFSR *PSSR
034400200529      *
034500200529      ***  Midas SE Corporate Actions - Default Charges                  - Prefixe MR
034600200529      *
034700200529     FSECOCHL1IF  E           K        DISK         KINFSR *PSSR
034800200529     F            SECOCHD0                          KRENAMESECOCHD1
034900200529      *
035000200529      ***  Midas SE Charge Types - CCY,CCOM                              - Prefixe
035100200529      *
035200200529     FSECGT   IF  E           K        DISK         KINFSR *PSSR
035300200529      *
035400200529      ***  Midas SE Market Prices file.                                  - Prefixe
035500200529      *
035600200529     FPRICM   IF  E           K        DISK         KINFSR *PSSR
035700200529      *                                                                   CSE020
035800200529      ***  SE Corporate Actions - Stock Allocations                       CSE020
035900200529      *                                                                   CSE020
036000200529     FSECOALL5IF  E           K        DISK         KINFSR *PSSR          CSE020
036100200529     F            SECOALD0                          KRENAMESECOALD5       CSE020
036200200529      *                                                                   CSE020
036300200529      ***  SE Corporate Actions - Reference Upd Idx                       CSE020
036400200529      *                                                                   CSE020
036500200529     FSECORFL9IF  E           K        DISK         KINFSR *PSSR          CSE020
036600200529     F            SECORFD0                          KRENAMESECORFD2       CSE020
036700200529      *
036800200529      ***  Display file
036900200529      *
037000200529     FSE7513DFCF  E                    WORKSTN      KINFSR *PSSR
037100200529     F                                              KINFDS SCRDS
037200200529     F                                        SRRN  KSFILE SE7513S0
037300200529     F                                        SRRN  KSFILE SE7513S1
037400200529      *
037500200529      *****************************************************************
037600200529      *                                                               *
037700200529      *  F U N C T I O N   O F   I N D I C A T O R S                  *
037800200529      *                                                               *
037900200529      *  13    Portfolio Management Facilities licensed,       (*ON)  *
038000200529      *        Customer and Portfolio displayed                       *
038100200529      *  14    Field SCOAL in error in SE7513F3-F4             (*ON)  *
038200200529      *  16    Record not found in file SECODPL3, SECOALL7,    (*ON)  *
038300200529      *********SECOxxL1.***********************************************   CEU017
038400200529      *        SECOxxL1, SECOCCL2.                                    *   CEU017
038500200529      *        (where xx = DV, OF, RG, EX, CR, CE or FR)              *
038600200529      *  17    Used to find informations for New Security      (*ON)  *
038700200529      *        in arrays retrieve from file SECOCRL1.                 *
038800200529      *  20    F20 pressed = Exit Without Saving               (*ON)  *
038900200529      *  21    - Confirm screen Exit Without Saving            (*ON)  *
039000200529      *        - Confirm screen allocation                     (*OFF) *
039100200529      *  25    End of program message subfile                         *
039200200529      *  27    Roll up key pressed                             (*ON)  *
039300200529      *  30    End of subfile SE7513S0-S1                      (*ON)  *
039400200529      *        (End of file SECDEPL4)                                 *
039500200529      *  33    No record change on subfile SE7513S0-S1         (*ON)  *
039600200529      *  40    - Record read from SEUDEPL0 (= Book calculation)(*ON)  *
039700200529      *        - Record read from SECDEPL4 (= Customer calcul.)(*OFF) *
039800200529      *  41    - Customer non Dummy Customer calculation       (*ON)  *
039900200529      *        - Dummy Customer calculation                    (*OFF) *
040000200529      *  45    First time processing                           (*OFF) *
040100200529      *  47    Processing running from 'Review from'           (*ON)  *
040200200529      *  50    Field SCUST in error in SE7513C0-C1             (*ON)  *
040300200529      *  51    Field SCSTAT in error in SE7513C0-C1            (*ON)  *
040400200529      *  52    Field SACODE in error in SE7513S0-S1            (*ON)  *
040500200529      *  53 - Field SPRFC in error in SE7513S0-S1              (*ON)  *   CAC005
040600200529      *  54    Field SASAL in error in SE7513S0                (*ON)  *
040700200529      *  55    Field SACRO in error in SE7513S0                (*ON)  *
040800200529      *  56    Field SRFBK in error in SE7513C0-C1             (*ON)  *
040900200529      *  57    Field SACAL in error in SE7513S1                (*ON)  *
041000200529      *  58    Field SACRO in error in SE7513S1                (*ON)  *
041100200529      *  59    Field SCONF in error in SE7513F3-F4             (*ON)  *
041200200529      *  60    - Cash Screen displayed                         (*ON)  *
041300200529      *        - Normal Screen displayed                       (*OFF) *
041400200529      *  62    Protect and non-display Portfolio               (*ON)  *
041500200529      *  63    Non-display Ex-Date Position                    (*ON)  *
041600200529      *  64    Ex-Date Position blink on subfile record        (*ON)  *
041700200529      *        (Ex-Date Position from SEUDEPL0 or SECDEPL4 is         *
041800200529      *        different than Ex-Date Position from SECOALL1)         *
041900200529      *  66    Protect Actual Stock Alloc. in normal subfile   (*ON)  *
042000200529      *  67    Protect Actual Cash Alloc. in normal subfile    (*ON)  *
042100200529      *        and Actual Cash Rounding in normal and 'CASH'          *
042200200529      *        subfile.                                               *
042300200529      *  68    Portfolio Management is present, so display     (*ON)  *
042400200529      *        Portfolio Reference in all screens.                    *
042500200529      *        Or Private BankingModule is present             (*ON)  *   CPB001
042600200529      *  69 - No Display for 'Prof Ctr' text                   (*ON)  *   CAC005
042700200529      *  70    Enquiry mode                                    (*ON)  *
042800200529      *  71    Record not found in file SDCUSTPD               (*ON)  *   CPB001
042900200529      *  75    Record not found in file SECORFL1               (*ON)  *
043000200529      *  76    Record not found in file SECODPL3               (*ON)  *
043100200529      *  79    Record not found in file SECOALL7               (*ON)  *
043200200529      ***80****Display*Subfile*SE7513S0-S1*********************(*ON)***   137879
043300200529      ***81****Display*Subfile*Control*SE7513C0-C1*************(*ON)***   137879
043400200529      *  80    - Clear Subfile SE7513S0-S1                     (*ON)  *   137879
043500200529      *        - Display Subfile Control SE7513C0-C1           (*OFF) *   137879
043600200529      *  81    Display Subfile SE7513S0-S1                     (*ON)  *   137879
043700200529      *  82    Record not found in file SECOREL1               (*ON)  *
043800200529      *  83    Record not found in file SECOSIL1, SECOSIL2     (*ON)  *
043900200529      *  84    SFLNXTCHG in subfile SE7513S0, SE7513S1         (*ON)  *
044000200529      *  87    Error calling PGM SE7515 or SE7540 or           (*ON)  *
044100200529      *        SBMJOB call SEC7550 (by QCMDEXC).                      *
044200200529      *  88    Use to position on subfile SE7513S0-S1                 *
044300200529      *  89    Record not found in file SECTYZ1 (= SECTY)      (*ON)  *
044400200529      *  98    - System Date Format DDMMYY                     (*OFF) *
044500200529      *        - System Date Format MMDDYY                     (*ON)  *
044600200529      *  90-99 Used by standard MIDAS subroutines                     *
044700200529      *                                                               *
044800200529      *  KC    F3 pressed = Exit program                       (*ON)  *
044900200529      *  KE    F5 pressed = Refresh screen                     (*ON)  *
045000200529      *  KL    F12 pressed = Previous screen                   (*ON)  *
045100200529      *                                                               *
045200200529      *  LR    End Program indicator.                          (*ON)  *
045300200529      *  U7-U8 Database error indicator.                       (*ON)  *
045400200529      *                                                               *
045500200529      *****************************************************************
045600200529      /SPACE 3
045700200529      *****************************************************************
045800200529      *                                                               *
045900200529      *  S U B R O U T I N E   I N D E X                              *
046000200529      *                                                               *
046100200529      *  SRINIT - Initial processing.                                 *
046200200529      *  SRMAIN - Main processing.                                    *
046300200529      *  SRENDP - Termination processing.                             *
046400200529      *  SRCLSF - Clear subfile.                                      *
046500200529      *  SRBLDF - Build the first subfile page.                       *
046600200529      *  SRS001 - Set first lines of subfile for each Book Position   *
046700200529      *           records when subfile is build from begining.        *
046800200529      *  SRS002 - Set detail lines of subfile for each Customer       *
046900200529      *           Position records when subfile is build.             *
047000200529      *  SRS003 - Set subfile last line for each build of the subfile *
047100200529      *           when all details in files are reached.              *
047200200529      *  SRBLDN - Build the next subfile page.                        *
047300200529      *  SRVALD - Validate subfile records.                           *
047400200529      *  SRVLD2 - Validate amended fields.                            *
047500200529      *  RECCAS - Recalculate fields due Actual Cash Allocation or    *
047600200529      *           Actual Cash Rounding changed from 'CASH' screen.    *
047700200529      *  RECTAX - Recalculate Total Taxes.                            *
047800200529      *  RECFEE - Recalculate Total Fees.                             *
047900200529      *  CALAM2 - Calculate Charge Amounts.                           *
048000200529      *  RECNSE - Recalculate fields due Actual Stock Allocation or   *
048100200529      *           Actual Cash Rounding changed from normal screen.    *
048200200529      *  CHACAL - Check if Actual Allocation fields can be            *
048300200529      *           recalculated.                                       *
048400200529      *  RTVRPL - Retrieve Customer/Book Current Reply and Customer/  *
048500200529      *           Book Standard Corporate Action Instruction.         *
048600200529      *  REACAA - Recalculate Actual Cash Allocation.                 *
048700200529      *  REASTR - Recalculate Actual Stock Rounding.                  *
048800200529      *  REHOST - Recalculate Holding Taken as Stock.                 *
048900200529      *  REACAR - Recalculate Actual Cash Rounding.                   *
049000200529      *  CACAPO - Calculate Actual Cash Pool for Book/Customer.       *
049100200529      *  REHOCA - Recalculate Holding Taken as Cash.                  *
049200200529      *  SRPRAC - Process Action Code.                                *
049300200529      *  SRSAVE - Save subfile datas.                                 *
049400200529      *  SRU001 - Write a record to the subfile for each subfile      *
049500200529      *           record changes when subfile is build.               *
049600200529      *  SRU002 - Write/Update Allocation file for each subfile       *
049700200529      *           changes when enter is pressed or add mode is        *
049800200529      *           selected.                                           *
049900200529      *  *PSSR  - Error control subroutine.                           *
050000200529      *  ZASNMS - Send Message to Program Message Queue.              *
050100200529      *  RTVNDP - Set amount from num field 15.0 to num field 30.9    *
050200200529      *           with Retrieve Number of Decimal Places of a Ccy.    *
050300200529      *  SETNDP - Set amount from num field 30.9 to num field 15.0    *
050400200529      *           with Number of Decimal Places of a Currency.        *
050500200529      *  ROUNDD - Perform rounding to the Number of Decimal Places.   *
050600200529      *  CSBPR  - Calculate Subscription Price if Subscription Price  *
050700200529      *           entered as Market for Dividend Events.              *
050800200529      *  ZSEDIT - Standart subroutine to insert a decimal point into  *
050900200529      *           a numeric field and to blank out leading zeroes.    *
051000200529      *  ZDATE2 - Standart subroutine to convert a Day Number to      *
051100200529      *           date formats.                                       *
051200200529      *  ZALIGN - Standart subroutine to validate and righr-align     *
051300200529      *           numeric fields.                                     *
051400200529      *  ZASIGN - Standart subroutine to validate and right-align     *
051500200529      *           signed numeric fields.                              *
051600200529      *  ZCCAL1 - Standart subroutine to calculate Charges/           *
051700200529      *           Commissions.                                        *
051800200529      *  ZCCAL2 - Standart subroutine to calculate Charges/           *
051900200529      *           Commissions.                                        *
052000200529      *  ZCONV  - Standart subroutine to convert an amount from one   *
052100200529      *           Currency to another.                                *
052200200529      *                                                               *
052300200529      *****************************************************************
052400200529      /EJECT
052500200529      *
052600200529      ***  Array containing Reply Status narratives.
052700200529      *
052800200529     E                    STATUS  1   5 17
052900200529      *
053000200529      ***  Array containing error narrative when calling PGM.
053100200529      *
053200200529     E                    NARR    1   3 29
053300200529      *
053400200529      ***  Array to retrieve New Securities (20 potential) from SECOCRL1.
053500200529      *
053600200529     E                    TSEC       20 10
053700200529      *
053800200529      ***  Array to retrieve Number of New Shares (20 potential) from SECOCRL1.
053900200529      *
054000200529     E                    TNSH       20 16
054100200529      *
054200200529      ***  Array to retrieve Rounding (20 potential) from SECOCRL1.
054300200529      *
054400200529     E                    TNDN       20  1
054500200529      *
054600200529      ***  Array to retrieve Rounding Settlement in Cash (20 potential) from SECOCRL1.
054700200529      *
054800200529     E                    TNDS       20  1
054900200529      *
055000200529      ***  Array to retrieve Compensation Price (20 potential) from SECOCRL1.
055100200529      *
055200200529     E                    TOPA       20 16
055300200529      *
055400200529      ***  Array to retrieve Denomination Multiplier (20 potential) from SECOCRL1.
055500200529      *
055600200529     E                    TDML       20 16
055700200529      *                                                                   CSE020
055800200529      ** Array for the New Securities                                     CSE020
055900200529      *                                                                   CSE020
056000200529     E                    NSEC      180 10                                CSE020
056100200529      *
056200200529      ***  Array containing parameters for CALL 'QCMDEXC'.
056300200529      *
056400200529     E                    CMD     1   3 80               SBMJOB
056500200529      *
056600200529      ***  Arrays ZS1 and ZS2 used by standart subroutine ZSEDIT.
056700200529      *
056800200529     E/COPY ZSRSRC,ZSEDITZ1
056900200529      *
057000200529      ***  Arrays used by standart subroutine ZDATE2:
057100200529      ***    ZYDY containing Years in days cumulative, four year span,
057200200529      ***    ZMDY containing Months in days cumulative through year,
057300200529      ***    ZMNM containing Months short name.
057400200529      *
057500200529     E/COPY ZSRSRC,ZDATE2Z1
057600200529      *
057700200529      ***  Arrays ZA1 and ZA2 used by standart subroutine ZALIGN.
057800200529      *
057900200529     E/COPY ZSRSRC,ZALIGNZ1
058000200529      *
058100200529      ***  Arrays ZS3, ZS4 and ZS5 used by standart subroutine ZASIGN.
058200200529      *
058300200529     E/COPY ZSRSRC,ZASIGNZ1
058400200529      *
058500200529      ***  Arrays: - ZRA: Range Limits, used in standart subroutine ZCCAL1 and ZCCAL2 (called by
058600200529      ***                 standart subroutine ZCCAL1).
058700200529      ***          - ZPC: Percentages, used in standart subroutine ZCCAL1 and ZCCAL2 (called by
058800200529      ***                 standart subroutine ZCCAL1).
058900200529      ***          - ZCG: Flat Charges, used in standart subroutine ZCCAL1.
059000200529      *
059100200529     E/COPY ZSRSRC,ZCCAL1Z1
059200200529      *
059300200529      ***  Array POWER8: POWER8 array, used in standart subroutine ZCCAL1.
059400200529      *
059500200529     E/COPY ZSRSRC,ZPOWER8Z1
059600200529      *
059700200529      ***  Array POWER: POWER array, used in standart subroutine ZCONV (called by standard
059800200529      ***  subroutine ZCCAL1).
059900200529      *
060000200529     E/COPY ZSRSRC,ZPOWERZ1
060100200529      *
060200200529      ***  Array containing Copyright statement.
060300200529      *
060400200529     E                    CPY@    1   1 80
060500200529      *
060600200529      /SPACE 3
060700200529      *
060800200529      ***  Rename fields of SECOOFL1: Midas SE Corporate Actions - Offers.
060900200529      *
061000200529     ISECOOFD0
061100200529     I              MIRECI                          MDRECI
061200200529     I              MINSHA                          MDNSHA
061300200529     I              MIOSHA                          MDOSHA
061400200529     I              MIRNDN                          MDRNDN
061500200529     I              MIRNDS                          MDRNDS
061600200529     I              MICOMP                          MDCOMP
061700200529     I              MIDMLT                          MDDMLT
061800200529      *
061900200529      ***  Rename fields of SECORGL1: Midas SE Corporate Actions - Rights Issues.
062000200529      *
062100200529     ISECORGD0
062200200529     I              MFRECI                          MDRECI
062300200529     I              MFNSHA                          MDNSHA
062400200529     I              MFOSHA                          MDOSHA
062500200529     I              MFDFNR                          MDDFNR
062600200529     I              MFRNDN                          MDRNDN
062700200529     I              MFRNDS                          MDRNDS
062800200529     I              MFCOMP                          MDCOMP
062900200529     I              MFDMLT                          MDDMLT
063000200529      *
063100200529      ***  Rename fields of SECOEXL1: Midas SE Corporate Actions - Exercices and Conversions.
063200200529      *
063300200529     ISECOEXD0
063400200529     I              MJRECI                          MDRECI
063500200529     I              MJOSHA                          MDOSHA
063600200529     I              MJNSHA                          MDNSHA
063700200529     I              MJDFNR                          MDDFNR
063800200529     I              MJSUPR                          MDSBPR
063900200529     I              MJRNDN                          MDRNDN
064000200529     I              MJDMLT                          MDDMLT
064100200529      *
064200200529      ***  Rename fields of SECOCRL1: Midas SE Corporate Actions - Corporate Reorganisation.
064300200529      *
064400200529     ISECOCRD0
064500200529     I              MHRECI                          MDRECI
064600200529     I              MHOSHA                          MDOSHA
064700200529      *
064800200529      ***  Rename fields of SECOFRL1: Midas SE Corporate Actions - Free Allocation.
064900200529      *
065000200529     ISECOFRD0
065100200529     I              MERECI                          MDRECI
065200200529     I              MENSHA                          MDNSHA
065300200529     I              MEOSHA                          MDOSHA
065400200529     I              MERNDN                          MDRNDN
065500200529     I              MERNDS                          MDRNDS
065600200529     I              MECOMP                          MDCOMP
065700200529     I              MEDMLT                          MDDMLT
065800200529      *
065900200529      ***  Rename fields of SECOCEL1: Midas SE Corporate Actions - Capital Changes.
066000200529      *
066100200529     ISECOCED0
066200200529     I              MGRECI                          MDRECI
066300200529      *                                                                   CEU017
066400200529      ***  Rename fields of SECOCCL2: Midas SE Corporate Actions -        CEU017
066500200529      ***                             Currency Changes.                   CEU017
066600200529      *                                                                   CEU017
066700200529     ISECOCCD0                                                            CEU017
066800200529     I              NARECI                          MDRECI                CEU017
066900200529     I              NANNSZ                          MDNSHA                CEU017
067000200529     I              NAONSZ                          MDOSHA                CEU017
067100200529     I              NACOMP                          MDCOMP                CEU017
067200200529     I              NARNDN                          MDRNDN                CEU017
067300200529     I              NARNDS                          MDRNDS                CEU017
067400200529     I              NADMLT                          MDDMLT                CEU017
067500200529      *                                                                   CSE020
067600200529      ** Rename fields of SECOALL5:  Corporate Actions - Stock Alloc.     CSE020
067700200529      *                                                                   CSE020
067800200529     ISECOALD5                                                            CSE020
067900200529     I              MCRECI                          M5RECI                CSE020
068000200529     I              MCLCD                           M5LCD                 CSE020
068100200529     I              MCCHTP                          M5CHTP                CSE020
068200200529     I              MCLUID                          M5LUID                CSE020
068300200529     I              MCCORF                          M5CORF                CSE020
068400200529     I              MCOPTN                          M5OPTN                CSE020
068500200529     I              MCBRCD                          M5BRCD                CSE020
068600200529     I              MCDDPT                          M5DDPT                CSE020
068700200529     I              MCCOTP                          M5COTP                CSE020
068800200529     I              MCBOOK                          M5BOOK                CSE020
068900200529     I              MCCNUM                          M5CNUM                CSE020
069000200529     I              MCPTFR                          M5PTFR                CSE020
069100200529     I              MCEXPO                          M5EXPO                CSE020
069200200529     I              MCSESN                          M5SESN                CSE020
069300200529     I              MCOALR                          M5OALR                CSE020
069400200529     I              MCOTSA                          M5OTSA                CSE020
069500200529     I              MCOSTR                          M5OSTR                CSE020
069600200529     I              MCOCAR                          M5OCAR                CSE020
069700200529     I              MCCAOP                          M5CAOP                CSE020
069800200529     I              MCASTA                          M5ASTA                CSE020
069900200529     I              MCHOST                          M5HOST                CSE020
070000200529     I              MCHOCA                          M5HOCA                CSE020
070100200529     I              MCACAA                          M5ACAA                CSE020
070200200529     I              MCASTR                          M5ASTR                CSE020
070300200529     I              MCACAR                          M5ACAR                CSE020
070400200529     I              MCOPT1                          M5OPT1                CSE020
070500200529     I              MCOPT2                          M5OPT2                CSE020
070600200529     I              MCREST                          M5REST                CSE020
070700200529     I              MCBSEC                          M5BSEC                CSE020
070800200529     I              MCBEDT                          M5BEDT                CSE020
070900200529     I              MCBSTT                          M5BSTT                CSE020
071000200529     I              MCBLTY                          M5BLTY                CSE020
071100200529     I              MCBEWI                          M5BEWI                CSE020
071200200529     I              MCCOAT                          M5COAT                CSE020
071300200529     I              MCTRRF                          M5TRRF                CSE020
071400200529     I              MCTRR2                          M5TRR2                CSE020
071500200529     I              MCTRR3                          M5TRR3                CSE020
071600200529     I              MCRVRF                          M5RVRF                CSE020
071700200529     I              MCRVR2                          M5RVR2                CSE020
071800200529     I              MCRVR3                          M5RVR3                CSE020
071900200529     I              MCTNL1                          M5TNL1                CSE020
072000200529     I              MCLTRQ                          M5LTRQ                CSE020
072100200529     I              MCTOTF                          M5TOTF                CSE020
072200200529     I              MCTOTT                          M5TOTT                CSE020
072300200529      *                                                                   CSE020
072400200529      ** Rename fields of SECORFL9: Corporate Actions Upd Idx             CSE020
072500200529      *                                                                   CSE020
072600200529     ISECORFD2                                                            CSE020
072700200529     I              MARECI                          IPRECI                CSE020
072800200529     I              MALCD                           IPLCD                 CSE020
072900200529     I              MACHTP                          IPCHTP                CSE020
073000200529     I              MALUID                          IPLUID                CSE020
073100200529     I              MACORF                          IPCORF                CSE020
073200200529     I              MAJOBN                          IPJOBN                CSE020
073300200529     I              MAUSER                          IPUSER                CSE020
073400200529     I              MAJNBR                          IPJNBR                CSE020
073500200529     I              MASESN                          IPSESN                CSE020
073600200529     I              MACOAT                          IPCOAT                CSE020
073700200529     I              MAPTYP                          IPPTYP                CSE020
073800200529     I              MACOAN                          IPCOAN                CSE020
073900200529     I              MACOEX                          IPCOEX                CSE020
074000200529     I              MAALEF                          IPALEF                CSE020
074100200529     I              MANBOP                          IPNBOP                CSE020
074200200529     I              MATDVD                          IPTDVD                CSE020
074300200529     I              MACOPD                          IPCOPD                CSE020
074400200529     I              MATDDT                          IPTDDT                CSE020
074500200529     I              MAEVDT                          IPEVDT                CSE020
074600200529     I              MACPNB                          IPCPNB                CSE020
074700200529     I              MASHMD                          IPSHMD                CSE020
074800200529     I              MALTBS                          IPLTBS                CSE020
074900200529     I              MAOCPV                          IPOCPV                CSE020
075000200529     I              MANCPV                          IPNCPV                CSE020
075100200529     I              MAONML                          IPONML                CSE020
075200200529     I              MANNML                          IPNNML                CSE020
075300200529     I              MACUPC                          IPCUPC                CSE020
075400200529     I              MAEXPC                          IPEXPC                CSE020
075500200529     I              MACLRD                          IPCLRD                CSE020
075600200529     I              MACLRT                          IPCLRT                CSE020
075700200529     I              MADLRD                          IPDLRD                CSE020
075800200529     I              MADLRT                          IPDLRT                CSE020
075900200529     I              MABLOS                          IPBLOS                CSE020
076000200529     I              MABLOP                          IPBLOP                CSE020
076100200529     I              MABFRD                          IPBFRD                CSE020
076200200529     I              MABEND                          IPBEND                CSE020
076300200529     I              MAREFO                          IPREFO                CSE020
076400200529     I              MACONR                          IPCONR                CSE020
076500200529     I              MADFNR                          IPDFNR                CSE020
076600200529     I              MADFCP                          IPDFCP                CSE020
076700200529     I              MADFSP                          IPDFSP                CSE020
076800200529     I              MALREQ                          IPLREQ                CSE020
076900200529     I              MALPRO                          IPLPRO                CSE020
077000200529     I              MALTSI                          IPLTSI                CSE020
077100200529     I              MASTAT                          IPSTAT                CSE020
077200200529     I              MAPREF                          IPPREF                CSE020
080100200529      *
080200200529      *
080300200529      ***  External data structure for Securities Trading details            - Prefixe BV
080400200529      *
080500200529     ISDSTRD    E DSSDSTRDPD
080600200529      *
080700200529      ***  External data structure for Module details                        - Prefixe BG
080800200529      *
080900200529     ISDMMOD    E DSSDMMODPD
081000200529      *
081100200529      ***  External data structure for Portfolio Management details          - Prefixe FC
081200200529      *
081300200529     ISDPORT    E DSSDPORTPD
081400200529      *
081500200529      ***  External data structures for Bank Details                         - Prefixe BJ.
081600200529      *
081700200529     ISDBANK    E DSSDBANKPD
081800200529      *
081900200529      ***  External data structure for Portfolio Customer details            - Prefixe QB
082000200529      *
082100200529     ISDPLCS    E DSSDPLCSPD
082200200529      *
082300200529      ***  External data structures for Customer Details                     - Prefixe BB.
082400200529      *
082500200529     ISDCUST    E DSSDCUSTPD
082600200529      *
082700200529      ***  External data structure for SE Country Tax Rate Details           - Prefixe TX
082800200529      *
082900200529     ISECNTR    E DSSECNTRPD
083000200529      *
083100200529      ***  External data structure for SE Country to Branch Tax Rate Details - Prefixe TB
083200200529      *
083300200529     ISECBTX    E DSSECBTXPD
083400200529      *
083500200529      ***  External data structure for Branch Details.                       - Prefixe A8
083600200529      *
083700200529     ISDBRCH    E DSSDBRCHPD
083800200529      *
083900200529      ***  External data structure for Security Customer Details.            - Prefixe BF
084000200529      *
084100200529     I              QQDFAC                          QQDFA1                                    CGL029
084200200529     ISDSECS    E DSSDSECSPD
084300200529      *
084400200529      ***  External data structure for Currency Details.                     - Prefixe A6
084500200529      *
084600200529     ISDCURR    E DSSDCURRPD
084700200529      *
084800200529      ***  First Data Strusture for Access Programs, Long Data Structure.
084900200529      *
085000200529     IDSSDY     E DSDSSDY
085100200529      *
085200200529      ***  Second Data Strusture for Access Programs, Short Data Structure.
085300200529      *
085400200529     IDSFDY     E DSDSFDY
085500200529      *                                                                                       223539
085600200529     IDSLDY     E DSDSLDY                                                                     223539
085700200529      *
085800200529      ***  Local Data Area.
085900200529      *
086000200529     ILDA       E DSLDA                         256
086100200529      *
086200200529      ***  Local data area for database error details
086300200529      ***  *LOCK IN LDA immediately before and OUT LDA immediately
086400200529      ***  after each database error handling.
086500200529      ***
086600200529      ***                                   134 141 DBFILE
086700200529      ***      Defines:                     142 170 DBKEY
086800200529      ***                                   171 180 DBPGM
086900200529      ***                                   181 1830DBASE
087000200529      *
087100200529      *
087200200529      ***  Data Area giving Midas SE Status.
087300200529      *
087400200529     ISESTAT    E DSSESTAT
087500200529      *
087600200529      ***  Program Status Data Structure.
087700200529      *
087800200529     IPSDS       SDS
087900200529     I                                     *PROGRAM SPGM
088000200529     I                                      244 253 SJOB
088100200529     I                                      254 263 SUSER
088200200529     I                                      282 2870STIME
088300200529      *
088400200529      ***  Display File Status Data Structure.
088500200529      *
088600200529     ISCRDS       DS
088700200529     I                                    B 378 3790CPFPOS
088800200529      *
088900200529      ***  Data structure for command string for QCMDEXC.
089000200529      *
089100200529     ICMDTXT      DS                            240
089200200529     I                                       81 160 CMDTX2                                    CPK014
089300200529     I                                      161 240 CMDTX3                                    CPK014
089400200529     I                                       12  20 @CJOB
089500200529     I                                       14  19 @REF
089600200529     I                                       20  20 @ACTI
089700200529     I                                       72  77 @REFN
089800200529     I                                       83  85 @BRCD
089900200529     I                                       91  96 @DEPT
090000200529     I                                      102 103 @OPTN
090100200529     I                                      109 118 @NSEC
090200200529     I                                      124 125 @BOOK
090300200529     I                                      131 136 @CNUM
090400200529     I                                      142 145 @PTFR
091200200529      ***  Data structure for fields WORK15 used by standart subroutine ZSEDIT.
091300200529      *
091400200529     I/COPY ZSRSRC,ZSEDITZ2
091500200529      *
091600200529      /EJECT
091700200529      *================================================================
091800200529      *  P R O G R A M   S T A R T                                    *
091900200529      *================================================================
092000200529      *
092100200529      ***  Initial processing.
092200200529      *
092300200529     C                     EXSR SRINIT
092400200529      *
092500200529      ***  Main processing
092600200529      *
092700200529     C                     EXSR SRMAIN
092800200529      *
092900200529      ***  End processing
093000200529      *
093100200529     C                     EXSR SRENDP
093200200529      *
093300200529      *================================================================
093400200529      *  P R O G R A M   E N D                                        *
093500200529      *================================================================
093600200529      /EJECT
093700200529      *****************************************************************
093800200529      *                                                               *
093900200529      *  SRINIT - Initial processing.                                 *
094000200529      *                                                               *
094100200529      *  Called by: Start mainline.                                   *
094200200529      *                                                               *
094300200529      *  Calls: *PSSR    - Error control subroutine.                  *
094400200529      *         ZSEDIT   - Standart subroutine to insert a decimal    *
094500200529      *                    point into a numeric field and to blank    *
094600200529      *                    out leading zeroes.                        *
094700200529      *         ZDATE2   - Standart subroutine to convert a Day       *
094800200529      *                    Number to date formats.                    *
094900200529      *         AOSTRDR0 - Midas AO Securities Trading ICD access obj.*
095000200529      *         AOMMODR0 - Midas AO Access Midas Modules *RDR.        *
095100200529      *         AOPORTR0 - Midas AO Portfolio Management ICD *RDR.    *
095200200529      *         AOBANKR0 - Midas AO Bank ICD access object.           *
095300200529      *         AOCUSTR0 - Midas AO Client details access object.     *
095400200529      *         AOCURRR0 - Midas AO Currency codes access object.     *
095500200529      *         AOSARDR0 - Midas AO Sweatchable Features.             *
095600200529      *         AOBRCHR0 - Midas AO Branch details access object.     *
095700200529      *                                                               *
095800200529      *****************************************************************
095900200529      *
096000200529     C           SRINIT    BEGSR                           ** SRINIT SR **
096100200529      *
096200200529      ***  Setup Copyright statement.
096300200529      *
096400200529     C                     MOVEACPY@      CPY2@  80
096500200529      *
096600200529      ***  Input Parameter List.
096700200529      *
096800200529     C           *ENTRY    PLIST
096900200529     C                     PARM           PCORF   6        CO Reference
097000200529     C                     PARM           PSESN  10        Event Security
097100200529     C                     PARM           PACT    2        Action Type
097200200529     C                     PARM           PPROC   2        Processing Type
097300200529     C                     PARM           PEXDT   5        Ex-Date
097400200529     C                     PARM           PSTAT   1        Status
097500200529     C                     PARM           PFINA   1        Final Allocation Indicator
097600200529     C                     PARM           PBRCD   3        Branch
097700200529     C                     PARM           PDPOT   6        Depot
097800200529     C                     PARM           PNMCY   3        Nominal CCY of the Event Security
097900200529     C                     PARM           PNWSEC 10        New Security
098000200529     C                     PARM           POPNB   2        Option Number
098100200529     C                     PARM           PMODE   1        Mode 'A' or 'E'
098200200529     C                     PARM           PRTCD   1        Return code
098300200529      *
098400200529      ***  Define Local dataarea.
098500200529      *
098600200529     C           *NAMVAR   DEFN           LDA
099200200529      *
099300200529      ***  Define Midas SE Status Data Area.
099400200529      *
099500200529     C           *NAMVAR   DEFN           SESTAT
099600200529      *
099700200529      ***  Search keys for LF/SECODPL3.
099800200529      *
099900200529     C           WKEY1     KLIST
100000200529     C                     KFLD           WKCORF  6        CO Reference
100100200529     C                     KFLD           WKOPTN  20       Option Number
100200200529     C                     KFLD           WKBRCD  3        Branch
100300200529     C**********           KFLD           WKDEPO  60       Depot                              CSD027
100400200529     C                     KFLD           WKDEPO  6        Depot                              CSD027
100500200529     C                     KFLD           WKSESN 10        Security
100600200529      *
100700200529      ***  Search keys for LF/SECDEPL4, LF/SEUDEPL0
100800200529      *
100900200529     C           WKEY2     KLIST
101000200529     C                     KFLD           WKBRCD           Branch
101100200529     C                     KFLD           WKSESN           Security
101200200529     C                     KFLD           WKDEPO           Depot
101300200529      *
101400200529      ***  Search keys for LF/SEUDEPL0.
101500200529      *
101600200529     C           WKEY3     KLIST
101700200529     C                     KFLD           WKBRCD           Branch
101800200529     C                     KFLD           WKSESN           Security
101900200529     C                     KFLD           WKDEPO           Depot
102000200529     C                     KFLD           WKUDMK  1        Market
102100200529     C                     KFLD           WKUDBK  2        Book
102200200529     C                     KFLD           WKUDDT  50       Ex-Date
102300200529      *
102400200529      ***  Search keys for LF/SECOALL1.
102500200529      *
102600200529     C           WKEY4     KLIST
102700200529     C                     KFLD           WKCORF           CO Reference
102800200529     C                     KFLD           WKOPTN           Option Number
102900200529     C                     KFLD           WKBRCD           Branch
103000200529     C                     KFLD           WKDEPO           Depot
103100200529     C                     KFLD           WKSESN           Security
103200200529     C                     KFLD           WKCOTP  1        Customer/Book Indicator
103300200529     C                     KFLD           WKBOOK  2        Book
103400200529     C**********           KFLD           WKCNUM  60       Customer                           CSD027
103500200529     C                     KFLD           WKCNUM  6        Customer                           CSD027
103600200529     C                     KFLD           WKPTFR  4        Portfolio
103700200529      *
103800200529      ***  Search keys for LF/SECDEPL4.
103900200529      *
104000200529     C           WKEY5     KLIST
104100200529     C                     KFLD           WKBRCD           Branch
104200200529     C                     KFLD           WKSESN           Security
104300200529     C                     KFLD           WKDEPO           Depot
104400200529     C                     KFLD           WKCDMK  1        Market
104500200529     C**********           KFLD           WKCDCN  60       Customer                           CSD027
104600200529     C                     KFLD           WKCDCN  6        Customer                           CSD027
104700200529     C                     KFLD           WKPTFR           Portfolio
104800200529     C                     KFLD           WKDDTE  50       Ex-Date
104900200529      *
105000200529      ***  Search keys for LF/SECOREL1.
105100200529      *
105200200529     C           WKEY6     KLIST
105300200529     C                     KFLD           WKCORF           CO Reference
105400200529     C                     KFLD           WKBRCD           Branch
105500200529     C                     KFLD           WKCOTP           Customer/Book Indicator
105600200529     C                     KFLD           WKBOOK           Book
105700200529     C                     KFLD           WKCNUM           Customer
105800200529      *
105900200529      ***  Search keys for LF/SECOSIL2.
106000200529      *
106100200529     C           WKEY7     KLIST
106200200529     C                     KFLD           PBRCD            Branch (parameter)
106300200529     C                     KFLD           WKBOOK           Book
106400200529     C                     KFLD           WKCOAT  2        Corporate Action Type
106500200529     C                     KFLD           WKNSEC 10        New Security
106600200529      *
106700200529      ***  Search keys for LF/SECOSIL1.
106800200529      *
106900200529     C           WKEY8     KLIST
107000200529     C                     KFLD           PBRCD            Branch (parameter)
107100200529     C                     KFLD           WKCNUM           Customer
107200200529     C                     KFLD           WKPORT  4        Portfolio Reference
107300200529     C                     KFLD           WKCOAT           Corporate Action Type
107400200529     C                     KFLD           WKNSEC           New Security
107500200529      *
107600200529      ***  Search Key for LF/CLINT (format CLINTCBF).
107700200529      *
107800200529     C           WKEY9     KLIST
107900200529     C**********           KFLD           KCUST   60       Customer                           CSD027
108000200529     C                     KFLD           KCUST   6        Customer                           CSD027
108100200529     C                     KFLD           KRTYP   1        Record Type
108200200529      *
108300200529      ***  Search Key for LF/SECOCHL0.
108400200529      *
108500200529     C           WKEY10    KLIST
108600200529     C                     KFLD           KCUGR   2        Customer Group
108700200529     C**********           KFLD           KCDCN   60       Customer                           CSD027
108800200529     C                     KFLD           KCDCN   6        Customer                           CSD027
108900200529     C                     KFLD           KSITP   3        Investment Type
109000200529     C                     KFLD           KCOAT   2        Corporate Action Type
109100200529      *
109200200529      ***  Search Key for LF/SECOCHL1.
109300200529      *
109400200529     C           WKEY11    KLIST
109500200529     C                     KFLD           KCLAS   1        Classification
109600200529     C                     KFLD           KCDCN            Customer
109700200529     C                     KFLD           KSITP            Investment Type
109800200529     C                     KFLD           KCOAT            Corporate Action Type
109900200529      *
110000200529      ***  Search Key for LF/SECGT.
110100200529      *
110200200529     C           WKEY12    KLIST
110300200529     C                     KFLD           NMCY1            Event Nominal Currency
110400200529     C                     KFLD           KCCOM            Charge Code
110500200529      *
110600200529      ***  Search keys for LF/SEUDEPL0.
110700200529      *
110800200529     C           WKEY13    KLIST
110900200529     C                     KFLD           WKBRCD           Brench
111000200529     C                     KFLD           WKSESN           Security
111100200529     C                     KFLD           WKDEPO           Depot
111200200529     C                     KFLD           WKUDMK           Market
111300200529     C                     KFLD           WKUDBK           Book
111400200529      *
111500200529      ***  Search Key for LF/SECOxxL1 (where xx = OF, DV, RG, EX, CR, FR or CE).
111600200529      *
111700200529     C           WKEY14    KLIST
111800200529     C                     KFLD           PCORF            CO Reference
111900200529     C                     KFLD           POPTN            Option Number
112000200529      *
112100200529      ***  Search Key for LF/PRICM.
112200200529      *
112300200529     C           WKEY15    KLIST
112400200529     C                     KFLD           MDNSEC           New Security from SECODVL1
112500200529     C                     KFLD           KPVDT   50       Value Date
112600200529      *
112700200529      ***  Search keys for LF/SECDEPL4.
112800200529      *
112900200529     C           WKEY16    KLIST
113000200529     C                     KFLD           WKBRCD           Branch
113100200529     C                     KFLD           WKSESN           Security
113200200529     C                     KFLD           WKDEPO           Depot
113300200529     C                     KFLD           WKCDMK           Market
113400200529     C                     KFLD           WKCDCN           Customer
113500200529     C                     KFLD           WKPTFR           Portfolio
114400200529      *
114500200529      ***  Initialise Key and Working Fields.
114600200529      *
114700200529     C                     MOVE PCORF     WKCORF           CO Reference
114800200529     C                     Z-ADDPOPTN     WKOPTN           Option Number
114900200529     C                     MOVE PBRCD     WKBRCD           Branch
115000200529     C                     Z-ADD0         WWRRN   40       Record Number saved
115100200529     C                     MOVE PEXDT     PEXDAT  50       Ex-Date
115200200529     C**********           MOVE PDPOT     PDEPO   60       Depot                              CSD027
115300200529     C**********           Z-ADDPDEPO     WKDEPO           Depot                              CSD027
115400200529     C                     MOVE PDPOT     PDEPO   6        Depot                              CSD027
115500200529     C                     MOVE PDEPO     WKDEPO           Depot                              CSD027
115600200529     C                     MOVE POPNB     POPTN   20       Option Number
115700200529     C                     MOVE 'A'       KRTYP            Record Type for Key
115800200529     C                     MOVE PROT      PROT    1        Used in standart SR ZCCAL1
115900200529      *
116000200529      ***  Access data area SESTAT: Midas SE Status to check if Portfolio Management have been
116100200529      ***  licensed, to diplay Customer and Portfolio Reference on screens.
116200200529      *
116300200529     C                     IN   SESTAT
116400200529     C           PFPL      IFEQ 'Y'
116500200529     C                     MOVE '1'       *IN13            Portolio Management installed
116600200529     C                     ENDIF
116700200529      *
116800200529      ***  Call Access Program for Switchable Feature Details to see if Private Banking SE
116900200529      ***  Enhancements is installed.
117000200529      *
117100200529     C                     MOVE 'N'       S01496  1
117200200529     C                     CALL 'AOSARDR0'
117300200529     C                     PARM '       ' WRTCD
117400200529     C                     PARM '*VERIFY' WOPTN
117500200529     C                     PARM 'S01496'  WSARD   6
117600200529      *
117700200529     C           WRTCD     IFEQ *BLANKS
117800200529     C                     MOVE 'Y'       S01496
117900200529     C                     ENDIF
118000200529     C/COPY WNCPYSRC,SE7513C001
118100200529      *                                                                   CAC005
118200200529      ** Check if CAC005 is installed                                     CAC005
118300200529      *                                                                   CAC005
118400200529     C                     CALL 'AOSARDR0'                                CAC005
118500200529     C                     PARM *BLANKS   PRTCD1  7                       CAC005
118600200529     C                     PARM '*VERIFY' POPTN1  7                       CAC005
118700200529     C                     PARM 'CAC005'  PSARD   6                       CAC005
118800200529      *                                                                   CAC005
118900200529     C           PRTCD1    IFEQ *BLANKS                                   CAC005
119000200529     C                     MOVE 'Y'       CAC005  1                       CAC005
119100200529     C                     MOVE *OFF      *IN69                           CAC005
119200200529     C                     ELSE                                           CAC005
119300200529     C                     MOVE 'N'       CAC005                          CAC005
119400200529     C                     MOVE *ON       *IN69                           CAC005
119500200529     C                     ENDIF                                          CAC005
119600200529      *
119700200529      ***  Call Access Program for Switchable Feature Details to see if Customer Commissions
119800200529      ***  (Courtage) amendment is installed.
119900200529      *
120000200529     C                     MOVE 'N'       S01446  1
120100200529     C                     CALL 'AOSARDR0'
120200200529     C                     PARM '       ' WRTCD
120300200529     C                     PARM '*VERIFY' WOPTN
120400200529     C                     PARM 'S01446'  WSARD
120500200529      *
120600200529     C           WRTCD     IFEQ *BLANKS
120700200529     C                     MOVE 'Y'       S01446
120800200529     C                     ENDIF
120900200529      *
121000200529      ***  Call Access Program for Switchable Feature Details to see if Withholding Tax feature
121100200529      ***  is installed.
121200200529      *
121300200529     C                     MOVE 'N'       S01447  1
121400200529     C                     CALL 'AOSARDR0'
121500200529     C                     PARM '       ' WRTCD
121600200529     C                     PARM '*VERIFY' WOPTN
121700200529     C                     PARM 'S01447'  WSARD   6
121800200529      *
121900200529     C           WRTCD     IFEQ *BLANKS
122000200529     C                     MOVE 'Y'       S01447
122100200529     C                     ENDIF
122200200529      *
122300200529      ***  If Withholding Tax feature is ON.
122400200529      *
122500200529     C           S01447    IFEQ 'Y'
122600200529      *
122700200529      ***  Call Access Program for Branch Details to retrieve Branch Internal Customer.
122800200529      *
122900200529     C**********           CALL 'AOBRCHR0'                                                    CGL029
123000200529     C                     CALL 'AOBRCHR1'                                                    CGL029
123100200529     C                     PARM *BLANKS   WRTCD
123200200529     C                     PARM '*KEY   ' WOPTN
123300200529     C                     PARM PBRCD     WBRCD   3
123400200529     C********** SDBRCH    PARM SDBRCH    DSFDY                                               CGL029
123500200529     C           SDBRCH    PARM SDBRCH    DSSDY                                               CGL029
123600200529      *
123700200529      ***  If record not found, handle database error.
123800200529      *
123900200529     C           WRTCD     IFNE *BLANKS
124000200529     C           *LOCK     IN   LDA
124100200529     C                     Z-ADD001       DBASE            ***************
124200200529     C                     MOVEL'SDBRCHPD'DBFILE           * DB ERROR 01 *
124300200529     C                     MOVELPBRCD     DBKEY            ***************
124400200529     C                     MOVEL'SE7513'  DBPGM
124500200529     C                     OUT  LDA
124600200529     C                     EXSR *PSSR
124700200529     C                     ELSE
124800200529      *
124900200529      ***  Otherwise, retrieve Country of Location for Branch Internal Customer.
125000200529      *
125100200529     C                     MOVE A8BICN    KCUST
125200200529     C           WKEY9     CHAINCLINT                84
125300200529      *
125400200529      ***  If record not found or not live, handle database error.
125500200529      *
125600200529     C           *IN84     IFEQ '1'
125700200529     C           RECI      OREQ '*'
125800200529     C           *LOCK     IN   LDA
125900200529     C                     Z-ADD002       DBASE            ***************
126000200529     C                     MOVEL'CLINTCB 'DBFILE           * DB ERROR 02 *
126100200529     C                     MOVELKCUST     DBKEYB  7        ***************
126200200529     C                     MOVE KRTYP     DBKEYB
126300200529     C                     MOVELDBKEYB    DBKEY
126400200529     C                     MOVEL'SE7513'  DBPGM
126500200529     C                     OUT  LDA
126600200529     C                     EXSR *PSSR
126700200529     C                     ELSE
126800200529      *
126900200529      ***  Otherwise, set Country of Location for Branch Internal Customer.
127000200529      *
127100200529     C                     MOVE CLOC      UBRLOC  2
127200200529     C                     ENDIF
127300200529     C                     ENDIF
127400200529     C                     ENDIF
127500200529      *
127600200529      ***  Retrieve CO References details.
127700200529      *
127800200529     C           PCORF     CHAINSECORFL1             75
127900200529     C           *IN75     IFEQ '1'
128000200529     C           *LOCK     IN   LDA
128100200529     C                     MOVEL'SECORFL1'DBFILE           ***************
128200200529     C                     MOVELPCORF     DBKEY            * DB ERROR 03 *
128300200529     C                     Z-ADD003       DBASE            ***************
128400200529     C                     MOVEL'SE7513'  DBPGM
128500200529     C                     OUT  LDA
128600200529     C                     EXSR *PSSR
128700200529     C                     ENDIF
128800200529      *                                                                   CSE020
128900200529     C           MAPREF    IFNE *BLANKS                                   CSE020
129000200529     C           MAPREF    CHAINSECORFD2             75                   CSE020
129100200529      *                                                                   CSE020
129200200529     C           *IN75     IFEQ '1'                                       CSE020
129300200529     C           *LOCK     IN   LDA                                       CSE020
129400200529     C                     MOVEL'SECORFL9'DBFILE           ***************CSE020
129500200529     C                     MOVELMAPREF    DBKEY            * DB ERROR 40 *CSE020
129600200529     C                     Z-ADD040       DBASE            ***************CSE020
129700200529     C                     MOVEL'SE7513'  DBPGM                           CSE020
129800200529     C                     OUT  LDA                                       CSE020
129900200529     C                     EXSR *PSSR                                     CSE020
130000200529     C                     ENDIF                                          CSE020
130100200529      *                                                                   CSE020
130200200529     C           IPPREF    DOWNE*BLANKS                                   CSE020
130300200529     C           IPPREF    CHAINSECORFD2             75                   CSE020
130400200529     C           *IN75     IFEQ '1'                                       CSE020
130500200529     C                     MOVEL'SECORFL9'DBFILE           ***************CSE020
130600200529     C                     MOVELMAPREF    DBKEY            * DB ERROR 41 *CSE020
130700200529     C                     Z-ADD041       DBASE            ***************CSE020
130800200529     C                     MOVEL'SE7513'  DBPGM                           CSE020
130900200529     C                     OUT  LDA                                       CSE020
131000200529     C                     EXSR *PSSR                                     CSE020
131100200529     C                     ENDIF                                          CSE020
131200200529     C                     ENDDO                                          CSE020
131300200529     C                     MOVE IPSESN    WOSESN 10                       CSE020
131400200529     C                     ENDIF                                          CSE020
131500200529      *
131600200529      ***  Call Access Program for Securities Trading Details.
131700200529      *
131800200529     C                     CALL 'AOSTRDR0'
131900200529     C                     PARM '*BLANKS' WRTCD   7
132000200529     C                     PARM '*FIRST ' WOPTN   7
132100200529     C           SDSTRD    PARM SDSTRD    DSSDY
132200200529      *
132300200529      ***  If record not found, handle database error.
132400200529      *
132500200529     C           WRTCD     IFNE *BLANKS
132600200529     C           *LOCK     IN   LDA
132700200529     C                     MOVEL'SDSTRDPD'DBFILE           ***************
132800200529     C                     MOVEL'*FIRST  'DBKEY            * DB ERROR 04 *
132900200529     C                     Z-ADD004       DBASE            ***************
133000200529     C                     MOVEL'SE7513'  DBPGM
133100200529     C                     OUT  LDA
133200200529     C                     EXSR *PSSR
133300200529     C                     ENDIF
133400200529      *
133500200529      ***  Retrieve Dummy Customer Number.
133600200529      *
133700200529     C**********           MOVE BVERCU    WDUMMY  60                                          CSD027
133800200529     C                     MOVE BVERCU    WDUMMY  6                                           CSD027
133900200529      *
134000200529      ***  Call Access Program for Module Details - Portfolio Management Indicator.
134100200529      *
134200200529     C                     CALL 'AOMMODR0'
134300200529     C                     PARM '*BLANKS' WRTCD
134400200529     C                     PARM '*FIRST ' WOPTN
134500200529     C           SDMMOD    PARM SDMMOD    DSSDY
134600200529      *
134700200529      ***  If record not found, handle database error.
134800200529      *
134900200529     C           WRTCD     IFNE *BLANKS
135000200529     C           *LOCK     IN   LDA
135100200529     C                     MOVEL'SDMMODPD'DBFILE           ***************
135200200529     C                     MOVEL'*FIRST  'DBKEY            * DB ERROR 05 *
135300200529     C                     Z-ADD005       DBASE            ***************
135400200529     C                     MOVEL'SE7513'  DBPGM
135500200529     C                     OUT  LDA
135600200529     C                     EXSR *PSSR
135700200529     C                     ENDIF
135800200529      *
135900200529      ***  Check if Portfolio Management is present.
136000200529      *
136100200529     C           BGPFMG    IFEQ 'Y'
136200200529     C           BGN4ST    OREQ 'Y'                                       CPB001
136300200529     C                     MOVE '1'       *IN68
136400200529      *
136500200529      ***  Call Access Program for Portfolio Management ICD.
136600200529      *
136700200529     C           BGPFMG    IFEQ 'Y'                                       CPB001
136800200529     C                     CALL 'AOPORTR0'
136900200529     C                     PARM '*BLANK ' WRTCD
137000200529     C                     PARM '*FIRST ' WOPTN
137100200529     C           SDPORT    PARM SDPORT    DSSDY
137200200529      *
137300200529      ***  If record not found, handle database error.
137400200529      *
137500200529     C           WRTCD     IFNE *BLANK                     ***************
137600200529     C           *LOCK     IN   LDA                        * DB ERROR 06 *
137700200529     C                     Z-ADD006       DBASE            ***************
137800200529     C                     MOVEL'SDPORTPD'DBFILE
137900200529     C                     MOVEL'*FIRST'  DBKEY
138000200529     C                     MOVEL'SE7513'  DBPGM
138100200529     C                     OUT  LDA
138200200529     C                     EXSR *PSSR
138300200529     C                     ENDIF
138400200529      *
138500200529      ***  Retrieve Reference Attached to 9997 field.
138600200529      *
138700200529     C                     MOVE FCR997    W9997   4
138800200529     C                     ENDIF                                          CPB001
138900200529      *
139000200529     C                     ENDIF
139100200529      *
139200200529      ***  Call Access Program for Bank Details - Title, Run Date and
139300200529      ***  Run Day Number.
139400200529      *
139500200529     C                     CALL 'AOBANKR0'
139600200529     C                     PARM '*BLANKS' WRTCD
139700200529     C                     PARM '*FIRST ' WOPTN
139800200529     C           SDBANK    PARM SDBANK    DSSDY
139900200529      *
140000200529      ***  If record not found, handle database error.
140100200529      *
140200200529     C           WRTCD     IFNE *BLANKS
140300200529     C           *LOCK     IN   LDA
140400200529     C                     MOVEL'SDBANKPD'DBFILE           ***************
140500200529     C                     MOVEL'*FIRST  'DBKEY            * DB ERROR 07 *
140600200529     C                     Z-ADD007       DBASE            ***************
140700200529     C                     MOVEL'SE7513'  DBPGM
140800200529     C                     OUT  LDA
140900200529     C                     EXSR *PSSR
141000200529     C                     ENDIF
141100200529      *
141200200529     C                     MOVE BJMRDT    SMRDT
141300200529      *
141400200529      ***  Check System Date Format, DDMMYY (*IN98 off)
141500200529      ***                            MMDDYY (*IN98 on).
141600200529      *
141700200529     C           BJDFIN    IFEQ 'M'
141800200529     C                     MOVE '1'       *IN98
141900200529     C                     ENDIF
142000200529      *
142100200529      ***  Retrieve Event Currency, Event Security Decimal Places, Event Price Basis and Event
142200200529      ***  Security Investment Type.
142300200529      *
142400200529     C           PSESN     CHAINSECTYZ1              89
142500200529     C           *IN89     IFEQ '1'
142600200529     C           *LOCK     IN   LDA
142700200529     C                     MOVEL'SECTY   'DBFILE
142800200529     C                     MOVELPSESN     DBKEY            ***************
142900200529     C                     Z-ADD008       DBASE            * DB ERROR 08 *
143000200529     C                     MOVEL'SE7513'  DBPGM            ***************
143100200529     C                     OUT  LDA
143200200529     C                     EXSR *PSSR
143300200529     C                     ELSE
143400200529     C                     Z-ADDNMDP      NMDP1   10       Event Security Decimal Places
143500200529     C                     MOVE NMCY      NMCY1   3        Event Currency
143600200529     C                     MOVE SPBS      SPBS1   1        Event Price Basis
143700200529     C                     MOVE SITP      SITP1   3        Event Security Investment Type
143800200529      *
143900200529      ***  Retrieve Number of Decimal Places of Event Currency by calling access objet.
144000200529      *
144100200529     C                     CALL 'AOCURRR0'
144200200529     C                     PARM '*MSG   ' WRTCD
144300200529     C                     PARM '*KEY   ' WOPTN
144400200529     C                     PARM NMCY      WAJCD   3
144500200529     C           SDCURR    PARM SDCURR    DSSDY
144600200529      *
144700200529      ***  If record not found, handle database error.
144800200529      *
144900200529     C           WRTCD     IFNE *BLANKS
145000200529     C           *LOCK     IN   LDA
145100200529     C                     Z-ADD009       DBASE            ***************
145200200529     C                     MOVEL'SDCURRPD'DBFILE           * DB ERROR 09 *
145300200529     C                     MOVELWAJCD     DBKEY            ***************
145400200529     C                     MOVEL'SE7513'  DBPGM
145500200529     C                     OUT  LDA
145600200529     C                     EXSR *PSSR
145700200529     C                     ENDIF
145800200529     C                     Z-ADDA6NBDP    NMDPC1  10       Event Currency Decimal Places
145900200529     C                     ENDIF
146000200529      *
146100200529      ***  If New Security = '**CASH**'.
146200200529      *
146300200529     C           PNWSEC    IFEQ '**CASH**'
146400200529      *
146500200529     C                     MOVE *BLANKS   WUNSEC 10
146600200529      *
146700200529      ***  If Processing Type not Corporate Reorganisation.
146800200529      *
146900200529     C           PPROC     IFNE 'CR'
147000200529      *
147100200529      ***  Retrieve New Security Shortname on Corporate Actions Detail file, not for Processing
147200200529      ***  Type Capital Changes, where New Security = Event Security.
147300200529      *
147400200529     C                     SELEC
147500200529     C           PPROC     WHEQ 'DV'                       Divedend Events
147600200529     C           WKEY14    SETGTSECODVL1
147700200529     C           WKEY14    REDPESECODVL1                 89
147800200529     C                     MOVE MDNSEC    WUNSEC
147900200529     C                     MOVEL'SECODVL1'DBFILS  8
148000200529      *
148100200529     C           PPROC     WHEQ 'FR'                       Free Allocation
148200200529     C           WKEY14    SETGTSECOFRL1
148300200529     C           WKEY14    REDPESECOFRL1                 89
148400200529     C                     MOVE MENSEC    WUNSEC
148500200529     C                     MOVEL'SECOFRL1'DBFILS
148600200529      *
148700200529     C           PPROC     WHEQ 'RG'                       Rights Issues
148800200529     C           WKEY14    SETGTSECORGL1
148900200529     C           WKEY14    REDPESECORGL1                 89
149000200529     C                     MOVE MFNSEC    WUNSEC
149100200529     C                     MOVEL'SECORGL1'DBFILS
149200200529      *
149300200529     C           PPROC     WHEQ 'OF'                       Offers
149400200529     C           WKEY14    SETGTSECOOFL1
149500200529     C           WKEY14    REDPESECOOFL1                 89
149600200529     C                     MOVE MINSEC    WUNSEC
149700200529     C                     MOVEL'SECOOFL1'DBFILS
149800200529      *
149900200529     C           PPROC     WHEQ 'EX'                       Exercices and Conversions
150000200529     C           WKEY14    SETGTSECOEXL1
150100200529     C           WKEY14    REDPESECOEXL1                 89
150200200529     C                     MOVE MJNSEC    WUNSEC
150300200529     C                     MOVEL'SECOEXL1'DBFILS
150400200529      *
150500200529     C           PPROC     WHEQ 'CC'                       Currency       CEU017
150600200529     C           PCORF     SETGTSECOCCL2                   Changes        CEU017
150700200529     C           PCORF     REDPESECOCCL2                 89               CEU017
150800200529     C                     MOVE NANSEC    WUNSEC                          CEU017
150900200529     C                     MOVEL'SECOCCL2'DBFILS                          CEU017
151000200529      *                                                                   CEU017
151100200529      ***  If record not found, handle database error.
151200200529      *
151300200529     C           *IN89     IFEQ '1'
151400200529     C           *LOCK     IN   LDA
151500200529     C                     Z-ADD010       DBASE            ***************
151600200529     C                     MOVELDBFILS    DBFILE           * DB ERROR 10 *
151700200529     C                     MOVEL'SE7513'  DBPGM            ***************
151800200529     C           PPROC     IFEQ 'CC'
151900200529     C                     MOVELPCORF     DBKEY
152000200529     C                     ELSE
152100200529     C                     MOVELPCORF     DBKEY1
152200200529     C                     MOVE POPTN     DBKEY1
152300200529     C                     MOVELDBKEY1    DBKEY
152400200529     C                     ENDIF
152500200529     C                     OUT  LDA
152600200529     C                     EXSR *PSSR
152700200529     C                     ENDIF
152800200529     C                     ENDSL
152900200529      *
153000200529     C           WUNSEC    IFNE *BLANKS
153100200529      *
153200200529      ***  If Processing Type with New Security entered (else, New Security = Event Security),
153300200529      ***  retrieve New Currency.
153400200529      *
153500200529     C           WUNSEC    CHAINSECTYZ1              89
153600200529     C           *IN89     IFEQ '1'
153700200529     C           *LOCK     IN   LDA
153800200529     C                     MOVEL'SECTYZ1 'DBFILE
153900200529     C                     MOVELWUNSEC    DBKEY            ***************
154000200529     C                     Z-ADD011       DBASE            * DB ERROR 11 *
154100200529     C                     MOVEL'SE7513'  DBPGM            ***************
154200200529     C                     OUT  LDA
154300200529     C                     EXSR *PSSR
154400200529     C                     ENDIF
154500200529      *
154600200529      ***  Retrieve Number of Decimal Places of New Currency by calling access objet.
154700200529      *
154800200529     C                     CALL 'AOCURRR0'
154900200529     C                     PARM '*MSG   ' WRTCD
155000200529     C                     PARM '*KEY   ' WOPTN
155100200529     C                     PARM NMCY      WAJCD
155200200529     C           SDCURR    PARM SDCURR    DSSDY
155300200529      *
155400200529      ***  If record not found, handle Database Error.
155500200529      *
155600200529     C           WRTCD     IFNE *BLANKS
155700200529     C           *LOCK     IN   LDA
155800200529     C                     Z-ADD012       DBASE            ***************
155900200529     C                     MOVEL'SDCURRPD'DBFILE           * DB ERROR 12 *
156000200529     C                     MOVELWAJCD     DBKEY            ***************
156100200529     C                     MOVEL'SE7513'  DBPGM
156200200529     C                     OUT  LDA
156300200529     C                     EXSR *PSSR
156400200529     C                     ENDIF
156500200529     C                     Z-ADDA6NBDP    NMDPC2           New Currency Decimal Places
156600200529     C                     ELSE
156700200529      *
156800200529      ***  If Processing Type with no New Security entered (New Security = Event Security),
156900200529      ***  set New Currency Decimal Places to Event Currency Decimal Places.
157000200529      *
157100200529     C                     Z-ADDNMDPC1    NMDPC2           New Currency Decimal Places = Event
157200200529     C                     ENDIF
157300200529     C                     ENDIF
157400200529     C                     ENDIF
157500200529      *
157600200529      ***  If the value of PNWSEC is not equal to '**CASH**' display normal screen.
157700200529      *
157800200529     C           PNWSEC    IFNE '**CASH**'
157900200529      *
158000200529      ***  Load key fields.
158100200529      *
158200200529     C                     MOVE PCORF     WKCORF           CO Reference
158300200529     C                     MOVE POPTN     WKOPTN           Option Number
158400200529     C                     MOVE PBRCD     WKBRCD           Branch
158500200529     C**********           Z-ADDPDEPO     WKDEPO           Depot                              CSD027
158600200529     C                     MOVE PDEPO     WKDEPO           Depot                              CSD027
158700200529     C                     MOVE PNWSEC    WKSESN           Security = 'CASH'
158800200529     C                     MOVE '1'       *IN60            Normal screen processed
158900200529      *
159000200529      ***  Retrieve CO Depot details.
159100200529      *
159200200529     C           WKEY1     CHAINSECODPD0            N76
159300200529      *
159400200529      ***  If record not found, handle database error.
159500200529      *
159600200529     C           *IN76     IFEQ '1'
159700200529     C           *LOCK     IN   LDA
159800200529     C                     MOVEL'SECODPL3'DBFILE
159900200529     C                     MOVE WKOPTN    WWOPTN  2
160000200529     C                     MOVE WKDEPO    WWDEPO  6
160100200529     C           WKCORF    CAT  WWOPTN:0  DBKEY1  8
160200200529     C           WKBRCD    CAT  WWDEPO:0  DBKEY2  9
160300200529     C           DBKEY1    CAT  DBKEY2:0  DBKEY3 17
160400200529     C           DBKEY3    CAT  WKSESN:0  DBKEY4 27
160500200529     C                     MOVELDBKEY4    DBKEY            ***************
160600200529     C                     Z-ADD013       DBASE            * DB ERROR 13 *
160700200529     C                     MOVEL'SE7513'  DBPGM            ***************
160800200529     C                     OUT  LDA
160900200529     C                     EXSR *PSSR
161000200529     C                     ENDIF
161100200529      *
161200200529      ***  Retrieve New Currency, New Security Decimal Places and New Price Basis.
161300200529      *
161400200529     C           PNWSEC    CHAINSECTYZ1              89
161500200529      *
161600200529      ***  If record not found, handle database error.
161700200529      *
161800200529     C           *IN89     IFEQ '1'
161900200529     C           *LOCK     IN   LDA
162000200529     C                     MOVEL'SECTY   'DBFILE
162100200529     C                     MOVELPNWSEC    DBKEY            ***************
162200200529     C                     Z-ADD014       DBASE            * DB ERROR 14 *
162300200529     C                     MOVEL'SE7513'  DBPGM            ***************
162400200529     C                     OUT  LDA
162500200529     C                     EXSR *PSSR
162600200529     C                     ELSE
162700200529     C                     Z-ADDNMDP      NMDP2   10       New Security Decimal Places
162800200529     C                     MOVE NMCY      NMCY2   3        New Currency
162900200529     C                     MOVE SPBS      SPBS2   1        New Price Basis
163000200529      *
163100200529      ***  Retrieve Number of Decimal Places of Event Currency by calling access objet.
163200200529      *
163300200529     C                     CALL 'AOCURRR0'
163400200529     C                     PARM '*MSG   ' WRTCD   7
163500200529     C                     PARM '*KEY   ' WOPTN   7
163600200529     C                     PARM NMCY      WAJCD   3
163700200529     C           SDCURR    PARM SDCURR    DSSDY
163800200529      *
163900200529      ***  If record not found, handle database error.
164000200529      *
164100200529     C           WRTCD     IFNE *BLANKS
164200200529     C           *LOCK     IN   LDA
164300200529     C                     Z-ADD015       DBASE            ***************
164400200529     C                     MOVEL'SDCURRPD'DBFILE           * DB ERROR 15 *
164500200529     C                     MOVELWAJCD     DBKEY            ***************
164600200529     C                     MOVEL'SE7513'  DBPGM
164700200529     C                     OUT  LDA
164800200529     C                     EXSR *PSSR
164900200529     C                     ENDIF
165000200529     C                     Z-ADDA6NBDP    NMDPC2  10       New Currency Decimal Places
165100200529     C                     ENDIF
165200200529      *
165300200529      ***  Load screen fields.
165400200529      *
165500200529     C                     MOVE *BLANKS   ZFLD15
165600200529     C                     MOVE MBBSTA    ZFLD15
165700200529     C                     MOVE NMDP2     ZDECS            New Security Decimal Places
165800200529     C                     MOVE 'L'       ZECODE
165900200529     C                     EXSR ZSEDIT
166000200529     C                     MOVE *BLANKS   SACSTK
166100200529     C                     MOVE ZOUT21    SACSTK           Balancing Stock Allocation
166200200529     C                     MOVE NMCY2     SSTCCY           New Currency
166300200529      *
166400200529     C                     ENDIF
166500200529      *
166600200529      ***  Access CO Depot file with New Security = '**CASH**'.
166700200529      *
166800200529     C                     MOVE PCORF     WKCORF
166900200529     C                     MOVE POPTN     WKOPTN
167000200529     C                     MOVE PBRCD     WKBRCD
167100200529     C**********           Z-ADDPDEPO     WKDEPO                                              CSD027
167200200529     C                     MOVE PDEPO     WKDEPO                                              CSD027
167300200529     C                     MOVE *BLANKS   WKSESN
167400200529     C                     MOVEL'**CASH**'WKSESN
167500200529     C           WKEY1     CHAINSECODPD0            N76
167600200529      *
167700200529      ***  If record not found, handle database error.
167800200529      *
167900200529     C           *IN76     IFEQ '1'
168000200529     C           MBRECI    ORNE 'D'
168100200529     C           *LOCK     IN   LDA
168200200529     C                     MOVEL'SECODPL3'DBFILE
168300200529     C                     MOVE WKOPTN    WWOPTN
168400200529     C                     MOVE WKDEPO    WWDEPO
168500200529     C           WKCORF    CAT  WWOPTN:0  DBKEY1  8
168600200529     C           WKBRCD    CAT  WWDEPO:0  DBKEY2  9
168700200529     C           DBKEY1    CAT  DBKEY2:0  DBKEY3 17
168800200529     C           DBKEY3    CAT  WKSESN:0  DBKEY4 27
168900200529     C                     MOVELDBKEY4    DBKEY            ***************
169000200529     C                     Z-ADD016       DBASE            * DB ERROR 16 *
169100200529     C                     MOVEL'SE7513'  DBPGM            ***************
169200200529     C                     OUT  LDA
169300200529     C                     EXSR *PSSR
169400200529      *
169500200529      ***  If record found, output Balancing Actual Cash Allocation and currency.
169600200529      *
169700200529     C                     ELSE
169800200529     C                     MOVE *BLANKS   ZFLD15
169900200529     C                     MOVE MBBCAA    ZFLD15
170000200529     C           PPROC     IFEQ 'CR'
170100200529     C                     MOVE NMDPC1    ZDECS            Event Currency Decimal Places
170200200529     C                     ELSE
170300200529     C                     MOVE NMDPC2    ZDECS            New Currency Decimal Places
170400200529     C                     ENDIF
170500200529     C                     EXSR ZSEDIT
170600200529     C                     MOVE *BLANKS   SCASH
170700200529     C                     MOVE ZOUT21    SCASH            Actual Cash Allocation
170800200529     C           PPROC     IFEQ 'CR'
170900200529     C                     MOVE NMCY1     SCHCCY           Event Currency
171000200529     C                     ELSE
171100200529     C                     MOVE NMCY2     SCHCCY           New Currency
171200200529     C                     ENDIF
171300200529      *
171400200529      ***  If the value of PNWSEC is equal to '**CASH**',
171500200529      ***  output Balancing Actual Stock Allocation and Currency
171600200529      *
171700200529     C           PNWSEC    IFEQ '**CASH**'
171800200529     C                     MOVE *BLANKS   ZFLD15
171900200529     C                     MOVE MBBSTA    ZFLD15
172000200529     C           PPROC     IFEQ 'CR'
172100200529     C                     MOVE NMDPC1    ZDECS            Event Currency Decimal Places
172200200529     C                     ELSE
172300200529     C                     MOVE NMDPC2    ZDECS            New Currency Decimal Places
172400200529     C                     ENDIF
172500200529     C                     MOVE 'L'       ZECODE
172600200529     C                     EXSR ZSEDIT
172700200529     C                     MOVE *BLANKS   SACSTK
172800200529     C                     MOVE ZOUT21    SACSTK           Actual Stock Allocation
172900200529     C           PPROC     IFEQ 'CR'
173000200529     C                     MOVE NMCY1     SSTCCY           Event Currency
173100200529     C                     ELSE
173200200529     C                     MOVE NMCY2     SSTCCY           New Currency
173300200529     C                     ENDIF
173400200529     C                     ENDIF
173500200529     C                     ENDIF
173600200529      *
173700200529      ***  Load screen fields.
173800200529      *
173900200529      * Call SDRTVTXT pgm to access appropriate text                      155622
174000200529      *  for a field used in a SFL                                        155622
174100200529      *                                                                   155622
174200200529      * Stock Allocation                                                  155622
174300200529     C                     MOVEL'ZZGBMSGF'MSGNM                           155622
174400200529     C                     MOVEL'ZZN6113' MSGDNB                          155622
174500200529     C                     CALL 'SDRTVTXT'                                155622
174600200529     C                     PARM           MSGDNB  7                       155622
174700200529     C                     PARM           MSGNM  10                       155622
174800200529     C                     PARM           MSGTXT 80                       155622
174900200529     C                     MOVELMSGTXT    ZZM002 16                       155622
175000200529      *                                                                   155622
175100200529      * Stock Rounding                                                    155622
175200200529     C                     MOVEL'ZZGBMSGF'MSGNM                           155622
175300200529     C                     MOVEL'ZZN6114' MSGDNB                          155622
175400200529     C                     CALL 'SDRTVTXT'                                155622
175500200529     C                     PARM           MSGDNB                          155622
175600200529     C                     PARM           MSGNM                           155622
175700200529     C                     PARM           MSGTXT                          155622
175800200529     C                     MOVELMSGTXT    ZZM003 14                       155622
175900200529      *                                                                   155622
176000200529      * Cash Rounding                                                     155622
176100200529     C                     MOVEL'ZZGBMSGF'MSGNM                           155622
176200200529     C                     MOVEL'ZZN6115' MSGDNB                          155622
176300200529     C                     CALL 'SDRTVTXT'                                155622
176400200529     C                     PARM           MSGDNB                          155622
176500200529     C                     PARM           MSGNM                           155622
176600200529     C                     PARM           MSGTXT                          155622
176700200529     C                     MOVELMSGTXT    ZZM004 13                       155622
176800200529      *                                                                   155622
176900200529      * Cash Option                                                       155622
177000200529     C                     MOVEL'ZZGBMSGF'MSGNM                           155622
177100200529     C                     MOVEL'ZZN6128' MSGDNB                          155622
177200200529     C                     CALL 'SDRTVTXT'                                155622
177300200529     C                     PARM           MSGDNB                          155622
177400200529     C                     PARM           MSGNM                           155622
177500200529     C                     PARM           MSGTXT                          155622
177600200529     C***********          MOVELMSGTXT    ZZM040 11                                    155622 CPK014
177700200529     C                     MOVELMSGTXT    ZZM041 11                                           CPK014
177800200529      *                                                                   155622
177900200529      * Actual Cash Allocation                                            155622
178000200529     C                     MOVEL'ZZGBMSGF'MSGNM                           155622
178100200529     C                     MOVEL'ZZN6129' MSGDNB                          155622
178200200529     C                     CALL 'SDRTVTXT'                                155622
178300200529     C                     PARM           MSGDNB                          155622
178400200529     C                     PARM           MSGNM                           155622
178500200529     C                     PARM           MSGTXT                          155622
178600200529     C***********          MOVELMSGTXT    ZZM041 18                                    155622 CPK014
178700200529     C                     MOVELMSGTXT    ZZM042 18                                           CPK014
178800200529      *                                                                   155622
178900200529      * Original Cash Rounding                                            155622
179000200529     C                     MOVEL'ZZGBMSGF'MSGNM                           155622
179100200529     C                     MOVEL'ZZN6130' MSGDNB                          155622
179200200529     C                     CALL 'SDRTVTXT'                                155622
179300200529     C                     PARM           MSGDNB                          155622
179400200529     C                     PARM           MSGNM                           155622
179500200529     C                     PARM           MSGTXT                          155622
179600200529     C***********          MOVELMSGTXT    ZZM042 17                                    155622 CPK014
179700200529     C                     MOVELMSGTXT    ZZM043 17                                           CPK014
179800200529      *                                                                   155622
179900200529      * Actual Cash Rounding                                              155622
180000200529     C                     MOVEL'ZZGBMSGF'MSGNM                           155622
180100200529     C                     MOVEL'ZZN6131' MSGDNB                          155622
180200200529     C                     CALL 'SDRTVTXT'                                155622
180300200529     C                     PARM           MSGDNB                          155622
180400200529     C                     PARM           MSGNM                           155622
180500200529     C                     PARM           MSGTXT                          155622
180600200529     C***********          MOVELMSGTXT    ZZM043 18                                    155622 CPK014
180700200529     C                     MOVELMSGTXT    ZZM044 18                                           CPK014
180800200529      *                                                                   155622
180900200529      * Total Fees                                                        155622
181000200529     C                     MOVEL'ZZGBMSGF'MSGNM                           155622
181100200529     C                     MOVEL'ZZN6132' MSGDNB                          155622
181200200529     C                     CALL 'SDRTVTXT'                                155622
181300200529     C                     PARM           MSGDNB                          155622
181400200529     C                     PARM           MSGNM                           155622
181500200529     C                     PARM           MSGTXT                          155622
181600200529     C***********          MOVELMSGTXT    ZZM044 10                                    155622 CPK014
181700200529     C                     MOVELMSGTXT    ZZM045 10                                           CPK014
181800200529      *                                                                   155622
181900200529      * Total Settlement                                                  155622
182000200529     C                     MOVEL'ZZGBMSGF'MSGNM                           155622
182100200529     C                     MOVEL'ZZN6133' MSGDNB                          155622
182200200529     C                     CALL 'SDRTVTXT'                                155622
182300200529     C                     PARM           MSGDNB                          155622
182400200529     C                     PARM           MSGNM                           155622
182500200529     C                     PARM           MSGTXT                          155622
182600200529     C***********          MOVELMSGTXT    ZZM045 16                                    155622 CPK014
182700200529     C                     MOVELMSGTXT    ZZM046 16                                           CPK014
182800200529      *                                                                   155622
182900200529     C                     MOVE PCORF     SREFNO           CO Reference
183000200529     C                     MOVE PSESN     SSESN            Security
183100200529     C                     MOVE PACT      SACTTY           CO Action Type
183200200529     C                     MOVE PSTAT     SSTAT            Status
183300200529     C                     MOVE PBRCD     SBRCH            Branch
183400200529     C                     MOVE POPNB     SOPT             Option Number
183500200529     C                     MOVE PNWSEC    SNWSEC           New Security
183600200529     C                     MOVE NMCY1     SNMCCY           Nominal Currency = Event Ccy
183700200529     C                     MOVE NMCY1     SCCY             Currency  = Event Ccy
183800200529     C                     MOVE NMCY2     SSACCY           Stock Allocation Currency = New Ccy
183900200529     C                     MOVE NMCY2     SSRCCY           Stock Rounding Currency = New Ccy
184000200529     C                     MOVE NMCY2     SCRCCY           Cash Rounding Currency = New Ccy
184100200529      *
184200200529     C                     MOVE PEXDT     ZDAYNO
184300200529     C                     EXSR ZDATE2
184400200529     C                     MOVE ZDATE     SEXDAT           Ex-Date
184500200529      *
184600200529      ***  Retrieve Depot Shortname.
184700200529      *
184800200529     C                     MOVE *BLANKS   WKEYC
184900200529     C                     MOVELPDPOT     WKEYC
185000200529     C**********           CALL 'AOCUSTR0'                                                    223539
185100200529     C                     CALL 'AOCUSTR1'                                                    223539
185200200529     C                     PARM '*DBERR'  WRTCD
185300200529     C                     PARM '*KEY   ' WOPTN
185400200529     C                     PARM           WKEYC  10
185500200529     C                     PARM *BLANKS   WKYST   7
185600200529     C********** SDCUST    PARM SDCUST    DSSDY                                               223539
185700200529     C           SDCUST    PARM SDCUST    DSLDY                                               223539
185800200529      *
185900200529      ***  If record not found, handle database error.
186000200529      *
186100200529     C           WRTCD     IFNE *BLANKS
186200200529     C           BBCLST    ANDNE'Y'                                                           223539
186300200529     C           *LOCK     IN   LDA
186400200529     C                     Z-ADD017       DBASE            ***************
186500200529     C                     MOVEL'SDCUSTPD'DBFILE           * DB ERROR 17 *
186600200529     C                     MOVELPDPOT     DBKEY            ***************
186700200529     C                     MOVEL'SE7513'  DBPGM
186800200529     C                     OUT  LDA
186900200529     C                     EXSR *PSSR
187000200529     C                     ENDIF
187100200529     C                     MOVELBBCSSN    SDEPOT           Depot Shortname
187200200529      *
187300200529     C                     MOVE 'Y'       WFIRST  1        Indicator first paasge
187400200529      *
187500200529      ***  Setup message file for subroutine ZASNMS.
187600200529      *
187700200529     C                     MOVEL'SEUSRMSG'ZAMSGF
187800200529      *
187900200529      *
188000200529     C                     ENDSR
188100200529      *
188200200529      *****************************************************************
188300200529      /EJECT
188400200529      *****************************************************************
188500200529      *                                                               *
188600200529      *  SRMAIN - Main processing.                                    *
188700200529      *                                                               *
188800200529      *  Called by: Start mainline.                                   *
188900200529      *                                                               *
189000200529      *  Calls: SRCLSF  - Clear subfile.                              *
189100200529      *         SRBLDF  - Build the first subfile page.               *
189200200529      *         SRBLDN  - Build the next subfile page.                *
189300200529      *         SRVALD  - Validate subfile records.                   *
189400200529      *         ZASNMS  - Send Message to Program Message Queue.      *
189500200529      *         ZALIGN  - Standart subroutine to validate and         *
189600200529      *                   right-align numeric fields.                 *
189700200529      *         Y2CLMSC - Midas ABS Clear specific program message    *
189800200529      *                    queue.                                     *
189900200529      *                                                               *
190000200529      *****************************************************************
190100200529      *
190200200529     C           SRMAIN    BEGSR                           ** SRMAIN SR **
190300200529      *
190400200529     C                     MOVE 'N'       ERMSG   1
190500200529      *
190600200529      ***  If Enquiry Mode, set indicator to protect fields.
190700200529      *
190800200529     C           PMODE     IFEQ 'E'
190900200529     C                     MOVE '1'       *IN70            Enquiry mode
191000200529     C                     ELSE
191100200529     C                     MOVE '0'       *IN70            Amend mode
191200200529     C                     ENDIF
191300200529      *
191400200529      ***  Do while F3: Exit, F12: Previous screen and F20: 'Exit without saving' pressed.
191500200529      *
191600200529     C           *INKL     DOWEQ'0'                        Exit
191700200529     C           *INKC     ANDEQ'0'                        Previous screen
191800200529     C           *IN20     ANDEQ'0'                        Exit without saving
191900200529      *
192000200529      ***  If it's the first time processing or F5: Refresh is pressed.
192100200529      *
192200200529     C           *IN45     IFEQ '0'                        First time processing
192300200529     C           *INKE     OREQ '1'                        Refresh
192400200529      *
192500200529     C                     MOVE '0'       *IN45            First time processing
192600200529      *
192700200529      ***  Reset Error indicators and field.
192800200529      *
192900200529     C                     MOVE 'N'       ERMSG            Error found indicator
193000200529     C***********          MOVEA'000'     *IN,50                          CAC005
193100200529     C                     MOVEA'0000'    *IN,50                          CAC005
193200200529     C                     MOVEA'00000'   *IN,54
193300200529     C                     MOVE ' '       SACODE           Action Code
193400200529      *                                                                   137879
193500200529      ***  Reset Review from fields.                                      137879
193600200529      *                                                                   137879
193700200529     C                     MOVE *BLANKS   SRFBK                           137879
193800200529     C                     MOVE *BLANKS   SPRFC                           CAC005
193900200529     C                     MOVE *BLANKS   SCUST                           137879
194000200529     C                     MOVE *BLANKS   SCSTAT                          137879
194100200529      *
194200200529      ***  Clear subfile.
194300200529      *
194400200529     C                     EXSR SRCLSF
194500200529      *
194600200529      ***  Build the first subfile page.
194700200529      *
194800200529     C                     EXSR SRBLDF
194900200529      *
195000200529     C                     MOVE '1'       *IN45            Not first time processing
195100200529     C                     ENDIF
195200200529      *
195300200529      ***  If Rollup is pressed and if no error detected.
195400200529      *
195500200529     C           *IN27     IFEQ '1'                        Rollup
195600200529     C           ERMSG     ANDEQ'N'                        No error
195700200529      *
195800200529      ***  Clear messages from program message queue.
195900200529      *
196000200529     C                     CALL 'Y2CLMSC'
196100200529     C                     PARM SPGM      ZAPGM  10
196200200529     C                     PARM '*SAME'   ZAPGRL  5
196300200529      *
196400200529      ***  Build the next subfile page.
196500200529      *
196600200529     C                     EXSR SRBLDN
196700200529     C                     ENDIF
196800200529      *
196900200529      ***  If a review field is changed and no error detected.
197000200529      *
197100200529     C******     SCUST     IFNE *BLANKS                    Review Cust.   137879
197200200529     C******     SRFBK     ORNE *BLANKS                    Review Book    137879
197300200529     C******     SCSTAT    ORNE ' '                        Review Status  137879
197400200529     C           SCUST     IFNE WSCUST                     Review Cust.   137879
197500200529     C           SRFBK     ORNE WSRFBK                     Review Book    137879
197600200529     C           SPRFC     ORNE WSPRFC                                    CAC005
197700200529     C           SCSTAT    ORNE WSSTAT                     Review Status  137879
197800200529     C           ERMSG     ANDEQ'N'                        No error
197900200529      *
198000200529      ***  Review Book and Customer can not be entered at the same time.
198100200529      *
198200200529     C           SCUST     IFNE *BLANKS
198300200529     C           SRFBK     ANDNE*BLANKS
198400200529     C                     MOVEL'CO00222' ZAMSID
198500200529     C                     EXSR ZASNMS
198600200529     C                     MOVE '1'       *IN50
198700200529     C                     MOVE '1'       *IN56
198800200529     C                     MOVE 'Y'       ERMSG
198900200529     C                     MOVE '0'       *IN47
199000200529      *
199100200529     C                     ELSE
199200200529      *                                                                   CAC005
199300200529      ** If CAC005 is installed                                           CAC005
199400200529      *                                                                   CAC005
199500200529     C           CAC005    IFEQ 'Y'                                       CAC005
199600200529      *                                                                   CAC005
199700200529      ** If screen-review-book code is blank and screen-review profit     CAC005
199800200529      ** centre is non-blank                                              CAC005
199900200529      *                                                                   CAC005
200000200529     C           SRFBK     IFEQ *BLANKS                                   CAC005
200100200529     C           SPRFC     ANDNE*BLANKS                                   CAC005
200200200529     C***********          MOVEL'PCA0008' ZAMSID                   CAC005 179197
200300200529     C                     MOVEL'PCA0014' ZAMSID                          179197
200400200529     C                     EXSR ZASNMS                                    CAC005
200500200529     C                     MOVE *ON       *IN53                           CAC005
200600200529     C                     MOVE 'Y'       ERMSG                           CAC005
200700200529     C                     MOVE *OFF      *IN47                           CAC005
200800200529     C                     ENDIF                                          CAC005
200900200529      *                                                                   CAC005
201000200529      ** If screen-review-book code is non-blank and screen-review profit CAC005
201100200529      ** centre is blank                                                  CAC005
201200200529      *                                                                   CAC005
201300200529     C           SRFBK     IFNE *BLANKS                                   CAC005
201400200529     C           SPRFC     ANDEQ*BLANKS                                   CAC005
201500200529     C                     MOVEL'PCA0013' ZAMSID                          CAC005
201600200529     C                     EXSR ZASNMS                                    CAC005
201700200529     C                     MOVE *ON       *IN53                           CAC005
201800200529     C                     MOVE 'Y'       ERMSG                           CAC005
201900200529     C                     MOVE *OFF      *IN47                           CAC005
202000200529     C                     ENDIF                                          CAC005
202100200529      *                                                                   CAC005
202200200529      ** If screen-review-book code is non-blank and screen-review-profit CAC005
202300200529      ** centre is non-blank                                              CAC005
202400200529      *                                                                   CAC005
202500200529     C           SRFBK     IFNE *BLANKS                                   CAC005
202600200529     C           SPRFC     ANDNE*BLANKS                                   CAC005
202700200529      *                                                                   CAC005
202800200529      ** Check if book - profit centre combination is valid               CAC005
202900200529      *                                                                   CAC005
203000200529     C                     CALL 'AOBKPCR0'                                CAC005
203100200529     C                     PARM *BLANKS   PRTCD1                          CAC005
203200200529     C                     PARM '*PSEUDO' POPTN1                          CAC005
203300200529     C                     PARM SRFBK     PBKCD   2                       CAC005
203400200529     C                     PARM SPRFC     PPRFC   4                       CAC005
203500200529     C                     PARM           PPSBK   2                       CAC005
203600200529      *                                                                   CAC005
203700200529     C           PRTCD1    IFNE *BLANKS                                   CAC005
203800200529     C                     MOVEL'PCA0012' ZAMSID                          CAC005
203900200529     C                     EXSR ZASNMS                                    CAC005
204000200529     C                     MOVE *ON       *IN53                           CAC005
204100200529     C                     MOVE 'Y'       ERMSG                           CAC005
204200200529     C                     MOVE *OFF      *IN47                           CAC005
204300200529     C                     ENDIF                                          CAC005
204400200529     C                     ENDIF                                          CAC005
204500200529     C                     ENDIF                                          CAC005
204600200529      *
204700200529      ***  Check validity of Review Customer, if entered.
204800200529      *
204900200529     C           SCUST     IFNE *BLANKS
205000200529     C                     MOVE *BLANKS   ZFIELD
205100200529     C                     MOVE SCUST     ZFIELD
205200200529     C                     Z-ADD6         ZADIG
205300200529     C                     Z-ADD0         ZADEC
205400200529     C                     EXSR ZALIGN
205500200529      *
205600200529      ***  If Review Customer not numeric, send error message.
205700200529      *
205800200529     C           *IN99     IFEQ '1'
205900200529     C                     MOVEL'CO00224' ZAMSID
206000200529     C                     EXSR ZASNMS
206100200529     C                     MOVE '1'       *IN50
206200200529     C                     MOVE 'Y'       ERMSG
206300200529     C                     MOVE '0'       *IN47
206400200529     C                     ENDIF
206500200529     C                     ENDIF
206600200529      *
206700200529     C                     ENDIF
206800200529      *
206900200529      ***  Review Reply Status must be blank or 'R'eply received, 'S'td Inst Default,
207000200529      ***  'C'orporate Default, 'M'anually Changes or 'N'one.
207100200529      *
207200200529     C           SCSTAT    IFNE ' '
207300200529     C           SCSTAT    ANDNE'R'
207400200529     C           SCSTAT    ANDNE'S'
207500200529     C           SCSTAT    ANDNE'C'
207600200529     C           SCSTAT    ANDNE'M'
207700200529     C           SCSTAT    ANDNE'N'
207800200529     C                     MOVEL'CO00269' ZAMSID
207900200529     C                     EXSR ZASNMS
208000200529     C                     MOVE '1'       *IN51
208100200529     C                     MOVE 'Y'       ERMSG
208200200529     C                     MOVE '0'       *IN47
208300200529     C                     ENDIF
208400200529      *
208500200529      ***  If no error detected.
208600200529      *
208700200529     C           ERMSG     IFEQ 'N'
208800200529      *
208900200529      ***  Clear subfile.
209000200529      *
209100200529     C                     EXSR SRCLSF
209200200529      *
209300200529     C                     MOVE '1'       *IN47            Review from asked
209400200529      *
209500200529      ***  Build the next subfile page but starting at 'Book', 'Customer' or 'Reply Status'
209600200529      ***  from 'Review'.
209700200529      *
209800200529     C                     EXSR SRBLDN
209900200529      *
210000200529     C                     MOVE '0'       *IN47            Reset indicator Review from asked
210100200529      *
210200200529      *****Reset*'Review*from'*fields.*********************************** 137879
210300200529      ***  Save 'Review from' fields.                                     137879
210400200529      *
210500200529     C******               MOVE *BLANKS   SRFBK            Book           137879
210600200529     C******               MOVE *BLANKS   SCUST            Customer       137879
210700200529     C******               MOVE ' '       SCSTAT           Reply Status   137879
210800200529     C                     MOVE SRFBK     WSRFBK  2        Book           137879
210900200529     C                     MOVE SPRFC     WSPRFC  4                       CAC005
211000200529     C                     MOVE SCUST     WSCUST  6        Customer       137879
211100200529     C                     MOVE SCSTAT    WSSTAT  1        Reply Status   137879
211200200529     C                     ENDIF
211300200529     C                     ENDIF
211400200529      *                                                                   137879
211500200529     C           *IN81     IFEQ '0'                                       137879
211600200529     C                     MOVEL'CO00001' ZAMSID                          137879
211700200529     C                     EXSR ZASNMS                                    137879
211800200529     C                     ENDIF                                          137879
211900200529      *
212000200529      ***  Setup screen time.
212100200529      *
212200200529     C                     TIME           STIME            Screen time.
212300200529      *
212400200529      ***  Execute the subfile control record.
212500200529      *
212600200529     C                     WRITE#MSGCTL                    program message137879
212700200529     C                     WRITESE7513F2                   Command keys
212800200529     C******               WRITE#MSGCTL                    program message137879
212900200529      *
213000200529     C           *IN60     IFEQ '1'
213100200529     C                     EXFMTSE7513C0                   normal screen
213200200529     C                     ELSE
213300200529     C                     EXFMTSE7513C1                   'CASH' screen
213400200529     C                     ENDIF
213500200529      *
213600200529      ***  Clear messages from program message queue.
213700200529      *
213800200529     C                     CALL 'Y2CLMSC'
213900200529     C                     PARM SPGM      ZAPGM  10
214000200529     C                     PARM '*SAME'   ZAPGRL  5
214100200529      *
214200200529      ***  If no function is pressed, validate all subfile records.
214300200529      *
214400200529     C           *IN46     IFEQ '0'
214500200529     C                     EXSR SRVALD
214600200529     C                     ENDIF
217000200529     C                     ENDDO
217100200529      *
217200200529     C                     ENDSR
217300200529      *
217400200529      *****************************************************************
217500200529      /EJECT
217600200529      *****************************************************************
217700200529      *                                                               *
217800200529      *  SRENDP - Termination processing.                             *
217900200529      *                                                               *
218000200529      *  Called by: Start mainline.                                   *
218100200529      *                                                               *
218200200529      *  Calls: ZASNMS - Send Message to Program Message Queue.       *
218300200529      *                                                               *
218400200529      *****************************************************************
218500200529      *
218600200529     C           SRENDP    BEGSR                           ** SRENDP SR **
218700200529      *
218800200529      ***  F12: Previous screen pressed.
218900200529      *
219000200529     C           *INKL     IFEQ '1'
219100200529     C                     MOVE '2'       PRTCD
219200200529     C                     COMIT
219300200529     C                     ENDIF
219400200529      *
219500200529      ***  If F20: Exit without saving pressed.
219600200529      *
219700200529     C           *IN20     IFEQ '1'
219800200529      *
219900200529     C                     MOVE ' '       SCONF            Reset Confirm exit field
220000200529     C                     MOVE '1'       *IN21            Confirm exit indicator
220100200529      *
220200200529      ***  Do while Confirm 'Exit without saving' field no valid.
220300200529      *
220400200529     C           SCONF     DOWNE'Y'
220500200529     C           SCONF     ANDNE'N'
220600200529     C                     WRITE#MSGCTL                    program message137879
220700200529     C                     WRITESE7513F5                   Command keys
220800200529     C******               WRITE#MSGCTL                    program message137879
220900200529     C           *IN60     IFEQ '1'
221000200529     C                     EXFMTSE7513F3                   Confirn normal screen
221100200529     C                     ELSE
221200200529     C                     EXFMTSE7513F4                   Confirm 'CASH' screen
221300200529     C                     ENDIF
221400200529      *
221500200529      ***  Confirm 'Exit without saving' field must be blank, 'Y'es or 'N'o.
221600200529      *
221700200529     C           SCONF     IFNE ' '
221800200529     C           SCONF     ANDNE'Y'
221900200529     C           SCONF     ANDNE'N'
222000200529     C                     MOVEL'CO00200' ZAMSID
222100200529     C                     EXSR ZASNMS
222200200529     C                     MOVE '1'       *IN59
222300200529     C                     ENDIF
222400200529      *
222500200529      ***  If Exit without saving confirmed, rollback changed records.
222600200529      *
222700200529     C           SCONF     IFEQ 'Y'
222800200529     C                     ROLBK
222900200529     C                     ELSE
223000200529      *
223100200529      ***  If Exit without saving not confirmed, comit changed records.
223200200529      *
223300200529     C           SCONF     IFEQ 'N'
223400200529     C                     COMIT
223500200529     C                     ENDIF
223600200529     C                     ENDIF
223700200529     C                     ENDDO
223800200529      *
223900200529      ***  Setup parameter indicator 'F3 pressed'.
224000200529      *
224100200529     C                     MOVE '3'       PRTCD
224200200529      *
224300200529     C                     ENDIF
224400200529      *
224500200529      ***  Setup *INKC = F3 = Exit.
224600200529      *
224700200529     C           *INKC     IFEQ '1'
224800200529     C                     MOVE '3'       PRTCD
224900200529     C                     ENDIF
225000200529      *
225100200529      ***  Return to calling program.
225200200529      *
225300200529     C                     MOVE '1'       *INLR
225400200529     C                     RETRN
225500200529      *
225600200529     C                     ENDSR
225700200529      *
225800200529      *****************************************************************
225900200529      /EJECT
226000200529      *****************************************************************
226100200529      *                                                               *
226200200529      *  SRCLSF - Clear subfile.                                      *
226300200529      *                                                               *
226400200529      *  Called by: SRMAIN - Main processing.                         *
226500200529      *                                                               *
226600200529      *  Calls: None.                                                 *
226700200529      *                                                               *
226800200529      *****************************************************************
226900200529      *
227000200529     C           SRCLSF    BEGSR                           ** SRCLSF SR **
227100200529      *
227200200529      ***  Clear subfile.
227300200529      *
227400200529     C                     MOVE '1'       *IN80            Clear subfile indicator
227500200529     C                     MOVE '0'       *IN81            Display subfile137879
227600200529      *
227700200529     C           *IN60     IFEQ '1'
227800200529     C                     WRITESE7513C0                   Normal subfile
227900200529     C                     ELSE
228000200529     C                     WRITESE7513C1                   'CASH' subfile
228100200529     C                     ENDIF
228200200529      *
228300200529     C                     MOVE '0'       *IN80            Clear subfile indicator
228400200529     C******               MOVE '1'       *IN81            Display subfile137879
228500200529     C                     MOVE '0'       *IN81            Display subfile137879
228600200529     C                     MOVE '0'       *IN30            End of subfile
228700200529     C                     Z-ADD*ZEROS    SRRN             Reset Record number
228800200529     C                     Z-ADD0         WWCPT   20       Meter record write in subfile
228900200529      *
229000200529     C                     ENDSR
229100200529      *
229200200529      *****************************************************************
229300200529      /EJECT
229400200529      *****************************************************************
229500200529      *                                                               *
229600200529      *  SRBLDF - Build the first subfile page.                       *
229700200529      *                                                               *
229800200529      *  Called by: SRMAIN - Main processing.                         *
229900200529      *                                                               *
230000200529      *  Calls: SRS001   - Set first lines of subfile for each Book   *
230100200529      *                    Position records when subfile is build     *
230200200529      *                    from begining.                             *
230300200529      *         SRS002   - Set detail lines of subfile for each       *
230400200529      *                    Customer Position records when subfile is  *
230500200529      *                    build.                                     *
230600200529      *         SRS003   - Set subfile last line for each build of    *
230700200529      *                    the subfile when all details in files are  *
230800200529      *                    reached.                                   *
230900200529      *         Y2CLMSC  - Midas ABS Clear specific program message   *
231000200529      *                    queue.                                     *
231100200529      *                                                               *
231200200529      *****************************************************************
231300200529      *
231400200529     C           SRBLDF    BEGSR                           ** SRBLDF SR **
231500200529      *
231600200529      ***  Clear messages from program message queue.
231700200529      *
231800200529     C                     CALL 'Y2CLMSC'
231900200529     C                     PARM SPGM      ZAPGM  10
232000200529     C                     PARM '*SAME'   ZAPGRL  5
232100200529      *
232200200529      ***  Initialise input 'Rreview from' fields.
232300200529      *
232400200529     C                     MOVE *BLANKS   SCUST            Customer
232500200529     C                     MOVE *BLANKS   SPRFC                           CAC005
232600200529     C                     MOVE *BLANKS   SRFBK            Book
232700200529     C                     MOVE *BLANKS   SCSTAT           Reply Status
232800200529      *
232900200529      ***  Reset subfile next change indicator.
233000200529      *
233100200529     C                     MOVE '0'       *IN84
233200200529      *
233300200529      ***  Initialise error indicators.
233400200529      *
233500200529     C***********          MOVEA'000'     *IN,50                          CAC005
233600200529     C                     MOVEA'0000'    *IN,50                          CAC005
233700200529     C                     MOVEA'00000'   *IN,54
233800200529      *
233900200529      ***  Init screen line number.
234000200529      *
234100200529     C                     Z-ADD0         WWCPT   20
234200200529      *                                                                   CSE020
234300200529      ** Move the originating parent's security if parent reference       CSE020
234400200529      ** is not blanks.                                                   CSE020
234500200529      *                                                                   CSE020
234600200529     C           MAPREF    IFNE *BLANKS                                   CSE020
234700200529     C                     MOVE PSESN     WSSESN 10                       CSE020
234800200529     C                     MOVE WOSESN    PSESN                           CSE020
234900200529     C                     ENDIF                                          CSE020
235000200529      *
235100200529      ***  Set key fields for LF/SEUDEPL0 with branch, security, depot.
235200200529      *
235300200529     C                     MOVE PBRCD     WKBRCD           Branch
235400200529     C                     MOVE PSESN     WKSESN           Security
235500200529     C                     MOVE PDEPO     WKDEPO           Depot
235600200529      *
235700200529      ***  Set first lines of subfile = Book Positions.
235800200529      *
235900200529     C           WKEY2     SETLLSEUDEPL0
236000200529     C                     EXSR SRS001
236100200529      *
236200200529      ***  Set key fields for LF/SECDEPL4 with branch, security, depot.
236300200529      *
236400200529     C                     MOVE PBRCD     WKBRCD           Branch
236500200529     C                     MOVE PSESN     WKSESN           Security
236600200529     C                     MOVE PDEPO     WKDEPO           Depot
236700200529     C           WKEY2     SETLLSECDEPL4
236800200529      *
236900200529      ***  Set detail lines of subfile = Customer Positions.
237000200529      *
237100200529     C                     EXSR SRS002
237200200529      *
237300200529      ***  Set last lines of subfile = Dummy Customer.
237400200529      *
237500200529     C                     Z-ADD0         DUSRRN                          136935
237600200529     C                     EXSR SRS003
237700200529      *
237800200529      ***  Save position.
237900200529      *
238000200529     C                     Z-ADDSRRN      WWRRN            Save SFLRCDNBR.
238100200529      *
238200200529     C                     ENDSR
238300200529      *
238400200529      *****************************************************************
238500200529      /EJECT
238600200529      *****************************************************************
238700200529      *                                                               *
238800200529      *  SRS001 - Set first lines of subfile for each Book Position   *
238900200529      *           records when subfile is build from begining.        *
239000200529      *                                                               *
239100200529      *  Called by: SRBLDF - Build the first subfile page.            *
239200200529      *             SRBLDN - Build the next subfile page.             *
239300200529      *                                                               *
239400200529      *  Calls: SRU001 - Write a record to the subfile for each       *
239500200529      *                  subfile record changes when subfile is       *
239600200529      *                  build.                                       *
239700200529      *         ZSEDIT - Standart subroutine to insert a decimal      *
239800200529      *                  point into a numeric field and to blank out  *
239900200529      *                  leading zeroes.                              *
240000200529      *                                                               *
240100200529      *****************************************************************
240200200529      *
240300200529     C           SRS001    BEGSR                           ** SRS001 SR **
240400200529      *
240500200529      ***  Read next record to retrieve first Book.
240600200529      *
240700200529     C                     READ SEUDEPL0                 30
240800200529      *
240900200529      ***  If not same Branch, Security Shortname and Depot, stop reading.
241000200529      *
241100200529     C           WKBRCD    IFNE UDBA                       not same Branch
241200200529     C           WKSESN    ORNE UDSN                       not same Security
241300200529     C           WKDEPO    ORNE UDPT                       not same Depot
241400200529     C                     MOVE '1'       *IN30
241500200529     C                     ENDIF
241600200529      *
241700200529      ***  Do while end of file not reached and line counter lower than 4.
241800200529      *
241900200529     C           *IN30     DOWEQ'0'
242000200529     C           WWCPT     ANDLT3
242100200529      *
242200200529      ***  Save Branch, Security, Depot, Market, Book and Ex-Date fields in work fields.
242300200529      *
242400200529     C                     MOVE PBRCD     WKBRCD           Branch
242500200529     C                     MOVE PSESN     WKSESN           Security
242600200529     C**********           Z-ADDPDEPO     WKDEPO           Depot                              CSD027
242700200529     C                     MOVE PDEPO     WKDEPO           Depot                              CSD027
242800200529     C                     MOVE UDMK      WKUDMK           Market
242900200529     C                     MOVE UDBK      WKUDBK           Book
243000200529     C                     Z-ADDPEXDAT    WKUDDT           Ex-Date
243100200529      *
243200200529      ***  Set greater on LF/SEUDEPL0 with Branch, Security, Depot, Market, Book and Ex-Date.
243300200529      *
243400200529     C           WKEY3     SETGTSEUDEPL0             30
243500200529     C                     READPSEUDEPL0                 30
243600200529      *
243700200529      ***  If same Branch, Security, Depot, Market and Book and not begining of file
243800200529      *
243900200529     C           *IN30     IFEQ '0'                        Not begining of file
244000200529     C           WKBRCD    ANDEQUDBA                       same Branch
244100200529     C           WKSESN    ANDEQUDSN                       same Security
244200200529     C           WKDEPO    ANDEQUDPT                       same Depot
244300200529     C           WKUDMK    ANDEQUDMK                       same Market
244400200529     C           WKUDBK    ANDEQUDBK                       same Book
244500200529      *
244600200529      ***  Use 'Nominal - Value Date Basis' or 'Nominal - Trade Date Basis'
244700200529      ***  from LF/SEUDEPL0 as 'Ex-Date Position', depending on Value/Trade Date Position.
244800200529      *
244900200529     C                     MOVE *BLANKS   SEXPOS
245000200529      *                                                                   CSE020
245100200529      ** Set up keys for Chain in SECOALL5                                CSE020
245200200529      *                                                                   CSE020
245300200529     C           WKEY18    KLIST                                          CSE020
245400200529     C                     KFLD           WKCORF                          CSE020
245500200529     C                     KFLD           WKBRCD                          CSE020
245600200529     C**********           KFLD           WKDDPT  60                                   CSE020 CSD027
245700200529     C                     KFLD           WKDDPT  6                                           CSD027
245800200529     C                     KFLD           WKCOTP                          CSE020
245900200529     C                     KFLD           WKBOOK                          CSE020
246000200529     C                     KFLD           WKCNUM                          CSE020
246100200529     C                     KFLD           WKPTFR                          CSE020
246200200529     C                     KFLD           WKSESN                          CSE020
246300200529      *                                                                   CSE020
246400200529     C                     MOVE MAPREF    WKCORF                          CSE020
246500200529     C                     MOVE UDBA      WKBRCD                          CSE020
246600200529     C**********           Z-ADDUDPT      WKDDPT                                       CSE020 CSD027
246700200529     C                     MOVE UDPT      WKDDPT                                              CSD027
246800200529     C                     MOVE 'B'       WKCOTP                          CSE020
246900200529     C                     MOVE UDBK      WKBOOK                          CSE020
247000200529     C**********           Z-ADD*ZEROS    WKCNUM                                       CSE020 CSD027
247100200529     C                     MOVE *BLANKS   WKCNUM                                              CSD027
247200200529     C                     MOVE *BLANKS   WKPTFR                          CSE020
247300200529     C                     MOVE WSSESN    WKSESN                          CSE020
247400200529      *                                                                   CSE020
247500200529      ** If Parent Refence is not blanks, Ex-date position of Child CA    CSE020
247600200529      ** depends on the parent CA. Otherwise, Ex-date position is equal   CSE020
247700200529      ** to Nominal Trade Date basis or Nominal Value Date basis.         CSE020
247800200529      *                                                                   CSE020
247900200529     C           MAPREF    IFNE *BLANKS                                   CSE020
248000200529     C           WKEY18    CHAINSECOALD5             90                   CSE020
248100200529      *                                                                   CSE020
248200200529     C           *IN90     IFEQ '0'                                       CSE020
248300200529     C                     MOVE *BLANKS   ZFLD15                          CSE020
248400200529     C                     MOVE M5ASTA    ZFLD15                          CSE020
248500200529     C                     Z-ADDNMDP1     ZDECS                           CSE020
248600200529     C                     EXSR ZSEDIT                                    CSE020
248700200529     C                     MOVE ZOUT21    SEXPOS                          CSE020
248800200529     C                     Z-ADDM5ASTA    SHTDVD                          CSE020
248900200529     C                     ENDIF                                          CSE020
249000200529      *                                                                   CSE020
249100200529     C                     ELSE                                           CSE020
249200200529     C           MATDVD    IFEQ 'V'
249300200529     C                     MOVE *BLANKS   ZFLD15
249400200529     C                     MOVE UDNV      ZFLD15
249500200529     C                     Z-ADDNMDP1     ZDECS            Event Security Decimal Places
249600200529     C                     EXSR ZSEDIT
249700200529     C                     MOVE ZOUT21    SEXPOS           Ex-Date Position = Value Date Basis
249800200529     C                     Z-ADDUDNV      SHTDVD           Ex-Date Position hidden screen field
249900200529     C                     ELSE
250000200529     C           MATDVD    IFEQ 'T'
250100200529     C                     MOVE *BLANKS   ZFLD15
250200200529     C                     MOVE UDNT      ZFLD15
250300200529     C                     Z-ADDNMDP1     ZDECS            Event Security Decimal Places
250400200529     C                     EXSR ZSEDIT
250500200529     C                     MOVE ZOUT21    SEXPOS           Ex-Date Position = Trade Date Basis
250600200529     C                     Z-ADDUDNT      SHTDVD           Ex-Date Position hidden screen field
250700200529     C                     ENDIF
250800200529     C                     ENDIF
250900200529     C                     ENDIF                                          CSE020
251000200529     C                     Z-ADDSHTDVD    WWTDVD 150
251100200529      *
251200200529      ***  Setup key and work fields.
251300200529      *
251400200529     C                     MOVE PCORF     WKCORF           CO Reference
251500200529     C                     Z-ADDPOPTN     WKOPTN           Option Number
251600200529     C                     MOVE PBRCD     WKBRCD           Branch
251700200529     C                     MOVE PDEPO     WKDEPO           Depot
251800200529     C                     MOVE PNWSEC    WKSESN           Security
251900200529     C                     MOVE 'B'       WKCOTP           Customer/Book Ind. = 'B'ook
252000200529     C                     MOVE UDBK      WKBOOK           Book
252100200529     C**********           Z-ADD0         WKCNUM           Customer                           CSD027
252200200529     C                     MOVE *BLANKS   WKCNUM           Customer                           CSD027
252300200529     C                     MOVE *BLANKS   WKPTFR           Portfoplio
252400200529     C                     MOVE 'B'       SHCOTP           Customer/Book Ind. hidden screen field
252500200529      *
252600200529      ***  Retrieve CO Allocation details.
252700200529      *
252800200529     C           WKEY4     CHAINSECOALL1             79
252900200529      *
253000200529     C******     *IN47     IFEQ '1'                        If Review Proc.137879
253100200529     C******     *IN79     ANDEQ'0'                           rcd found   137879
253200200529     C           *IN79     IFEQ '0'                        If rcd found   137879
253300200529     C           SCSTAT    ANDEQ' '                           Review Reply Status blank
253400200529     C******     *IN47     OREQ '1'                        Or Review Proc.137879
253500200529     C******     *IN79     ANDEQ'0'                           rcd found   137879
253600200529     C           *IN79     OREQ '0'                        Or rcd found   137879
253700200529     C           MCREST    ANDEQSCSTAT                        Reply Status = Review Reply Status
253800200529     C           SCSTAT    ANDNE' '                           Review Reply Status not blank
253900200529     C******     *IN47     OREQ '0'                        Or not Rw.Proc.137879
254000200529      *
254100200529      ***  Seton indicator to protect and non-display Portfolio.
254200200529      *
254300200529     C                     MOVEA'10'      *IN,62
254400200529      *
254500200529      ***  Add 1 to line counter.
254600200529      *
254700200529     C********             ADD  1         SRRN             SFLRCDNBR      137879
254800200529     C                     ADD  1         SRRN       81    SFLRCDNBR      137879
254900200529     C                     ADD  1         WWCPT            Screen line NBR
255000200529      *                                                                   CSE020
255100200529      ** Restore Security name if parent reference is non-blank           CSE020
255200200529      *                                                                   CSE020
255300200529     C           MAPREF    IFNE *BLANKS                                   CSE020
255400200529     C                     MOVE WSSESN    PSESN                           CSE020
255500200529     C                     ENDIF                                          CSE020
255600200529      *
255700200529      ***  Write a subfile record.
255800200529      *
255900200529     C                     MOVE '1'       *IN40
256000200529     C                     EXSR SRU001
256100200529     C                     MOVE '0'       *IN40
256200200529      *
256300200529     C                     ENDIF
256400200529     C                     ENDIF
256500200529      *                                                                   CSE020
256600200529      ** Set PSESN again as Originating parent's security if parent       CSE020
256700200529      ** reference is non-blank.                                          CSE020
256800200529      *                                                                   CSE020
256900200529     C           MAPREF    IFNE *BLANKS                                   CSE020
257000200529     C                     MOVE WOSESN    PSESN                           CSE020
257100200529     C                     ENDIF                                          CSE020
257200200529      *
257300200529      ***  Set Ex-Date to hival value.
257400200529      *
257500200529     C                     MOVE PSESN     WKSESN
257600200529     C                     Z-ADD*HIVAL    WKUDDT
257700200529      *
257800200529      ***  Set greater with Branch, Security, Depot, Market, Book and Ex-Date.
257900200529      *
258000200529     C           WKEY3     SETGTSEUDEPL0             30
258100200529      *
258200200529      ***  Read next record on LF/SEUDEPL0 to find next Book.
258300200529      *
258400200529     C                     READ SEUDEPL0                 30
258500200529      *
258600200529      ***  If not same Branch, Security Shortname and Depot, stop reading.
258700200529      *
258800200529     C           WKBRCD    IFNE UDBA                       not same Branch
258900200529     C           WKSESN    ORNE UDSN                       not same Security
259000200529     C           WKDEPO    ORNE UDPT                       not same Depot
259100200529     C                     MOVE '1'       *IN30
259200200529     C                     ENDIF
259300200529      *
259400200529     C                     ENDDO
259500200529      *                                                                   CSE020
259600200529      ** Restore Security name if parent reference is non-blank           CSE020
259700200529      *                                                                   CSE020
259800200529     C           MAPREF    IFNE *BLANKS                                   CSE020
259900200529     C                     MOVE WOSESN    PSESN                           CSE020
260000200529     C                     ENDIF                                          CSE020
260100200529      *
260200200529     C                     ENDSR
260300200529      *
260400200529      *****************************************************************
260500200529      /EJECT
260600200529      *****************************************************************
260700200529      *                                                               *
260800200529      *  SRS002 - Set detail lines of subfile for each Customer       *
260900200529      *           Position records when subfile is build.             *
261000200529      *                                                               *
261100200529      *  Called by: SRBLDF - Build the first subfile page.            *
261200200529      *             SRBLDN - Build the next subfile page.             *
261300200529      *                                                               *
261400200529      *  Calls: SRU001 - Write a record to the subfile for each       *
261500200529      *                  subfile record changes when subfile is       *
261600200529      *                  build.                                       *
261700200529      *         ZSEDIT - Standart subroutine to insert a decimal      *
261800200529      *                  point into a numeric field and to blank out  *
261900200529      *                  leading zeroes.                              *
262000200529      *                                                               *
262100200529      *****************************************************************
262200200529      *
262300200529     C           SRS002    BEGSR                           ** SRS002 SR **
262400200529      *
262500200529      ***  Read next record to retrieve first Customer.
262600200529      *
262700200529     C                     READ SECDEPL4                 30
262800200529      *
262900200529      ***  If not same Branch, Security Shortname and Depot, stop reading.
263000200529      *
263100200529     C           WKBRCD    IFNE CDPA                       not same Branch
263200200529     C           WKSESN    ORNE CDSN                       not same Security
263300200529     C           WKDEPO    ORNE CDPT                       not same Depot
263400200529     C                     MOVE '1'       *IN30
263500200529     C                     ENDIF
263600200529      *
263700200529      ***  Do while end of file not reached and line counter lower than 4.
263800200529      *
263900200529     C           *IN30     DOWEQ'0'
264000200529     C           WWCPT     ANDLT3
264100200529      *
264200200529      ***  Save Branch, Security, Depot, Market, Customer and Portfolio and Ex-Date fields in work
264300200529      ***  fields.
264400200529      *
264500200529     C                     MOVE PBRCD     WKBRCD           Branch
264600200529     C                     MOVE PSESN     WKSESN           Security
264700200529     C**********           Z-ADDPDEPO     WKDEPO           Depot                              CSD027
264800200529     C                     MOVE PDEPO     WKDEPO           Depot                              CSD027
264900200529     C                     Z-ADDPEXDAT    WKDDTE           Ex-Date
265000200529     C                     MOVE CDMK      WKCDMK           Market
265100200529     C**********           Z-ADDCDCN      WKCDCN           Customer                           CSD027
265200200529     C                     MOVE CDCN      WKCDCN           Customer                           CSD027
265300200529     C                     MOVE PTFR      WKPTFR           Portfolio Reference
265400200529      *
265500200529      ***  Set greater on LF/SECDEPL4 with Branch, Security, Depot, Market, Customer, Portfolio and
265600200529      ***  Ex-Date.
265700200529      *
265800200529     C           WKEY5     SETGTSECDEPL4             30
265900200529     C                     READPSECDEPL4                 30
266000200529      *
266100200529      ***  If same Branch, Security, Depot, Market, Customer and Portfolio and Customer not
266200200529      ***  equal Dummy Customer and not begining of file.
266300200529      *
266400200529     C           *IN30     IFEQ '0'                        not begining of file
266500200529     C           WKBRCD    ANDEQCDPA                       same Branch
266600200529     C           WKSESN    ANDEQCDSN                       same Security
266700200529     C           WKDEPO    ANDEQCDPT                       same Depot
266800200529     C           WKCDMK    ANDEQCDMK                       same Market
266900200529     C           WKCDCN    ANDEQCDCN                       same Customer
267000200529     C           WKPTFR    ANDEQPTFR                       same Portfolio
267100200529     C           WDUMMY    ANDNECDCN                       Customer not Dummy Customer
267200200529      *
267300200529      ***  Use 'Nominal - Value Date Basis' or 'Nominal - Trade Date Basis'
267400200529      ***  from LF/SECDEPL4 as 'Ex-Date Position'.
267500200529      *
267600200529     C                     MOVE *BLANKS   SEXPOS
267700200529      *                                                                   CSE020
267800200529      ** Set up keys for Chain in SECOALL5                                CSE020
267900200529      *                                                                   CSE020
268000200529     C                     MOVE MAPREF    WKCORF                          CSE020
268100200529     C                     MOVE CDPA      WKBRCD                          CSE020
268200200529     C**********           Z-ADDCDPT      WKDDPT                                       CSE020 CSD027
268300200529     C                     MOVE CDPT      WKDDPT                                              CSD027
268400200529     C                     MOVE 'C'       WKCOTP                          CSE020
268500200529     C                     MOVE *BLANKS   WKBOOK                          CSE020
268600200529     C**********           Z-ADDCDCN      WKCNUM                                       CSE020 CSD027
268700200529     C                     MOVE CDCN      WKCNUM                                              CSD027
268800200529     C                     MOVE PTFR      WKPTFR                          CSE020
268900200529     C                     MOVE WSSESN    WKSESN                          CSE020
269000200529      *                                                                   CSE020
269100200529      ** If Parent Refence is not blanks, Ex-date position of Child CA    CSE020
269200200529      ** depends on the parent CA. Otherwise, Ex-date position is equal   CSE020
269300200529      ** to Nominal Trade Date basis or Nominal Value Date basis.         CSE020
269400200529      *                                                                   CSE020
269500200529     C           MAPREF    IFNE *BLANKS                                   CSE020
269600200529     C           WKEY18    CHAINSECOALD5             90                   CSE020
269700200529      *                                                                   CSE020
269800200529     C           *IN90     IFEQ '0'                                       CSE020
269900200529     C                     MOVE *BLANKS   ZFLD15                          CSE020
270000200529     C                     MOVE M5ASTA    ZFLD15                          CSE020
270100200529     C                     Z-ADDNMDP1     ZDECS                           CSE020
270200200529     C                     EXSR ZSEDIT                                    CSE020
270300200529     C                     MOVE ZOUT21    SEXPOS                          CSE020
270400200529     C                     Z-ADDM5ASTA    SHTDVD                          CSE020
270500200529     C                     ENDIF                                          CSE020
270600200529     C                     ELSE                                           CSE020
270700200529      *                                                                   CSE020
270800200529     C           MATDVD    IFEQ 'V'
270900200529     C                     MOVE *BLANKS   ZFLD15
271000200529     C                     MOVE CDNV      ZFLD15
271100200529     C                     Z-ADDNMDP1     ZDECS            Event Security Decimal Places
271200200529     C                     EXSR ZSEDIT
271300200529     C                     MOVE ZOUT21    SEXPOS           Ex-Date Position = Value Date Basis
271400200529     C                     Z-ADDCDNV      SHTDVD           Ex-Date Position hidden screen field
271500200529     C                     ELSE
271600200529     C           MATDVD    IFEQ 'T'
271700200529     C                     MOVE *BLANKS   ZFLD15
271800200529     C                     MOVE CDNT      ZFLD15
271900200529     C                     Z-ADDNMDP1     ZDECS            Event Security Decimal Places
272000200529     C                     EXSR ZSEDIT
272100200529     C                     MOVE ZOUT21    SEXPOS           Ex-Date Position = Trade Date Basis
272200200529     C                     Z-ADDCDNT      SHTDVD           Ex-Date Position hidden screen field
272300200529     C                     ENDIF
272400200529     C                     ENDIF
272500200529     C                     ENDIF                                          CSE020
272600200529      *                                                                   CSE020
272700200529     C                     Z-ADDSHTDVD    WWTDVD
272800200529      ******                                                              136930
272900200529      *****If*Status*not*Allocated*and*not*Fully*Authorised*(Cash*and**** 136930
273000200529      *****Stock).******************************************************* 136930
273100200529      ******                                                              136930
273200200529     C******     PSTAT     IFEQ 'L'                                       136930
273300200529     C******     PSTAT     OREQ 'X'                                       136930
273400200529      *
273500200529      ***  Setup key and work fields.
273600200529      *
273700200529     C                     MOVE PCORF     WKCORF           CO Reference
273800200529     C                     Z-ADDPOPTN     WKOPTN           Option Number
273900200529     C                     MOVE PBRCD     WKBRCD           Branch
274000200529     C**********           Z-ADDPDEPO     WKDEPO           Depot                              CSD027
274100200529     C                     MOVE PDEPO     WKDEPO           Depot                              CSD027
274200200529     C                     MOVE PNWSEC    WKSESN           Security
274300200529     C                     MOVE 'C'       WKCOTP           Customer/Book Ind. = 'C'ustomer
274400200529     C                     MOVE '  '      WKBOOK           Book
274500200529     C**********           Z-ADDCDCN      WKCNUM           Customer                           CSD027
274600200529     C                     MOVE CDCN      WKCNUM           Customer                           CSD027
274700200529     C                     MOVE PTFR      WKPTFR           Portfolio
274800200529     C                     MOVE 'C'       SHCOTP           Customer/Book Ind. hidden screen field
274900200529      *
275000200529      ***  Retrieve CO Allocation details.
275100200529      *
275200200529     C           WKEY4     CHAINSECOALL1             79
275300200529     C******               ELSE                                           136930
275400200529     C******               MOVE '1'       *IN79                           136930
275500200529     C******               ENDIF                                          136930
275600200529      *
275700200529     C******     *IN47     IFEQ '1'                        If Review Proc.137879
275800200529     C******     *IN79     ANDEQ'0'                           rcd found   137879
275900200529     C           *IN79     IFEQ '0'                        If rcd found   137879
276000200529     C           SCSTAT    ANDEQ' '                           Review Reply Status blank
276100200529     C******     *IN47     OREQ '1'                        Or Review Proc.137879
276200200529     C******     *IN79     ANDEQ'0'                           rcd found   137879
276300200529     C           *IN79     OREQ '0'                        Or rcd found   137879
276400200529     C           MCREST    ANDEQSCSTAT                        Reply Status = Review Reply status
276500200529     C           SCSTAT    ANDNE' '                           Review Reply Status not blank
276600200529     C******     *IN47     OREQ '0'                        Or not Rw Proc.137879
276700200529      *
276800200529      ***  Seton indicator to non-protect and display 'Portfolio'.
276900200529      *
277000200529     C                     MOVEA'00'      *IN,62
277100200529      *
277200200529      ***  Add 1 to line counter.
277300200529      *
277400200529     C********             ADD  1         SRRN             SFLRCDNBR      137879
277500200529     C                     ADD  1         SRRN       81    SFLRCDNBR      137879
277600200529     C                     ADD  1         WWCPT            Screen line NBR
277700200529      *                                                                   CSE020
277800200529      ** Restore Security name if parent reference is non-blank           CSE020
277900200529      *                                                                   CSE020
278000200529     C           MAPREF    IFNE *BLANKS                                   CSE020
278100200529     C                     MOVE WSSESN    PSESN                           CSE020
278200200529     C                     ENDIF                                          CSE020
278300200529      *
278400200529      ***  Write a subfile record.
278500200529      *
278600200529     C                     MOVE '1'       *IN41
278700200529     C                     EXSR SRU001
278800200529     C                     MOVE '0'       *IN41
278900200529      *
279000200529     C                     ENDIF
279100200529     C                     ENDIF
279200200529      *                                                                   CSE020
279300200529      ** Set PSESN again as Originating parent's security if parent       CSE020
279400200529      ** reference is non-blank.                                          CSE020
279500200529      *                                                                   CSE020
279600200529     C           MAPREF    IFNE *BLANKS                                   CSE020
279700200529     C                     MOVE WOSESN    PSESN                           CSE020
279800200529     C                     ENDIF                                          CSE020
279900200529      *
280000200529      ***  Set Ex-Date to hival value.
280100200529      *
280200200529     C                     MOVE PSESN     WKSESN
280300200529     C                     Z-ADD*HIVAL    WKDDTE
280400200529      *
280500200529      ***  Set greater with Branch, Security, Depot, Market, Customer, Portfolio and Ex-Date.
280600200529      *
280700200529     C           WKEY5     SETGTSECDEPL4             30
280800200529      *
280900200529      ***  Read next record on LF/SECDEPL4 to find next Customer.
281000200529      *
281100200529     C                     READ SECDEPL4                 30
281200200529      *
281300200529      ***  If not same Branch, Security Shortname and Depot, stop reading.
281400200529      *
281500200529     C           WKBRCD    IFNE CDPA                       not same Branch
281600200529     C           WKSESN    ORNE CDSN                       not same Security
281700200529     C           WKDEPO    ORNE CDPT                       not same Depot
281800200529     C                     MOVE '1'       *IN30
281900200529     C                     ENDIF
282000200529      *
282100200529     C                     ENDDO
282200200529      *                                                                   CSE020
282300200529      ** Restore Security name if parent reference is non-blank           CSE020
282400200529      *                                                                   CSE020
282500200529     C           MAPREF    IFNE *BLANKS                                   CSE020
282600200529     C                     MOVE WOSESN    PSESN                           CSE020
282700200529     C                     ENDIF                                          CSE020
282800200529      *
282900200529     C                     ENDSR
283000200529      *
283100200529      *****************************************************************
283200200529      /EJECT
283300200529      *****************************************************************
283400200529      *                                                               *
283500200529      *  SRS003 - Set subfile last line for each build of the subfile *
283600200529      *           when all details in files are reached.              *
283700200529      *                                                               *
283800200529      *  Called by: SRBLDF - Build the first subfile page.            *
283900200529      *             SRBLDN - Build the next subfile page.             *
284000200529      *                                                               *
284100200529      *  Calls: SRU001   - Write a record to the subfile for each     *
284200200529      *                    subfile record changes when subfile is     *
284300200529      *                    build.                                     *
284400200529      *         AOPLCSR0 - Midas AO Portfolio Mngemnt Cust Det. *RDR. *
284500200529      *                                                               *
284600200529      *****************************************************************
284700200529      *
284800200529     C           SRS003    BEGSR                           ** SRS003 SR **
284900200529      *
285000200529      ***  If line counter is lower than number of line per subfile page.
285100200529      *
285200200529     C           WWCPT     IFLT 3
285300200529      *
285400200529     C                     MOVE *BLANKS   WKPTFR           Reset Porfolio work field
285500200529      *
285600200529      ***  If Portfolio Management is present, use default '99997' Portfolio.
285700200529      *
285800200529     C           BGPFMG    IFEQ 'Y'
285900200529     C           BGN4ST    OREQ 'Y'                                       CPB001
286000200529      *
286100200529     C                     MOVE WDUMMY    KPNUM   6        Setup key with Dummy Customer
286200200529      *
286300200529      ***  Access Portfolio Customers file to check if the Dummy Customer is a Portfolio Customer.
286400200529      *
286500200529     C                     MOVE 'N'       WWEXC   1                       CPB001
286600200529     C           BGPFMG    IFEQ 'Y'                                       CPB001
286700200529     C                     CALL 'AOPLCSR0'
286800200529     C                     PARM *BLANKS   WLRTCD  7
286900200529     C                     PARM '*KEY  '  WLOPTN  7
287000200529     C                     PARM KPNUM     WLCUST 10
287100200529     C           SDPLCS    PARM SDPLCS    DSSDY
287200200529      *
287300200529      ***  If record is found, it means that Customer is a Portfolio Customer.
287400200529      *
287500200529     C           WLRTCD    IFEQ *BLANK
287600200529     C           BGN4ST    IFNE 'Y'                                       CPB001
287700200529     C                     MOVE '9997'    WKPTFR
287800200529     C                     ENDIF                                          CPB001
287900200529     C                     MOVE 'Y'       WWEXC                           CPB001
288000200529     C                     ENDIF
288100200529     C                     ENDIF
288200200529      *                                                                   CPB001
288300200529     C           BGN4ST    IFEQ 'Y'                                       CPB001
288400200529     C**********           CALL 'AOCUSTR0'                                             CPB001 223539
288500200529     C                     CALL 'AOCUSTR1'                                                    223539
288600200529     C                     PARM *BLANKS   WRTCD   7                       CPB001
288700200529     C                     PARM '*KEY   ' WOPTN   7                       CPB001
288800200529     C                     PARM KPNUM     WKEYC  10                       CPB001
288900200529     C                     PARM *BLANKS   WKYST   7                       CPB001
289000200529     C********** SDCUST    PARM SDCUST    DSSDY                                        CPB001 223539
289100200529     C           SDCUST    PARM SDCUST    DSLDY                                               223539
289200200529      *                                                                   CPB001
289300200529     C           WRTCD     IFEQ *BLANKS                                   CPB001
289400200529     C           BBCLST    ANDNE'Y'                                                           223539
289500200529     C                     MOVE 'Y'       WWEXC                           CPB001
289600200529     C                     ENDIF                                          CPB001
289700200529     C                     ENDIF                                          CPB001
289800200529      *                                                                   CPB001
289900200529     C           WWEXC     IFEQ 'Y'                                       CPB001
290000200529     C           BGN4ST    ANDEQ'Y'                                       CPB001
290100200529     C                     OPEN PMPORTLL                                  CPB001
290200200529     C           WDUMMY    SETLLPMPORTLL                                  CPB001
290300200529     C                     READ PMPORTLL                 71               CPB001
290400200529      *                                                                   CPB001
290500200529     C           *IN71     IFEQ '0'                                       CPB001
290600200529     C           PNCNUM    ANDEQWDUMMY                                    CPB001
290700200529     C                     MOVE PNPTFR    WKPTFR                          CPB001
290800200529     C                     ENDIF                                          CPB001
290900200529     C                     CLOSEPMPORTLL                                  CPB001
291000200529     C                     ENDIF                                          CPB001
291100200529     C                     ENDIF                                          CPB001
291600200529      *
291700200529     C********** WDUMMY    IFNE 0                                                             CSD027
291800200529     C           WDUMMY    IFNE *BLANKS                                                       CSD027
291900200529      *
292000200529      ***  If Dummy Customer not 0, Load screen field and write record on subfile.
292100200529      *
292200200529     C                     MOVE PCORF     WKCORF           CO Reference
292300200529     C                     MOVE POPTN     WKOPTN           Option Number
292400200529     C                     MOVE PBRCD     WKBRCD           Branch
292500200529     C**********           Z-ADDPDEPO     WKDEPO           Depot                              CSD027
292600200529     C                     MOVE PDEPO     WKDEPO           Depot                              CSD027
292700200529     C                     MOVE PNWSEC    WKSESN           New Security
292800200529     C                     MOVE 'C'       WKCOTP           Customer/Book Ind. = 'C'ustomer
292900200529     C                     MOVE '  '      WKBOOK           Book
293000200529     C**********           Z-ADDWDUMMY    WKCNUM           Customer = Dummy Customer          CSD027
293100200529     C                     MOVE WDUMMY    WKCNUM           Customer = Dummy Customer          CSD027
293200200529     C                     MOVE 'C'       SHCOTP           Customer/Book Ind. hidden screen field
293300200529      *
293400200529      ***  Retrieve CO Allocation Details for Dummy Customer.
293500200529      *
293600200529      ***  If two dummys were required for calculations, the second one   184520
293700200529      ***  contains the required data to display.                         184520
293800200529     C***********WKEY4     CHAINSECOALL1             79                   184520
293900200529     C           WKEY4     SETGTSECOALL1             79                   184520
294000200529     C           WKEY4     REDPESECOALL1                 79               184520
294100200529      *                                                                   137879
294200200529      ***  If Review from Status blank OR if Review from Status entered   137879
294300200529      ***  and record found and Reply Status = Review from Status entered.137879
294400200529      *                                                                   137879
294500200529     C           SCSTAT    IFEQ ' '                                       137879
294600200529     C           *IN79     ANDEQ'0'                                       CSE020
294700200529     C           SCSTAT    ORNE ' '                                       137879
294800200529     C           *IN79     ANDEQ'0'                                       137879
294900200529     C           MCREST    ANDEQSCSTAT                                    137879
295000200529      *
295100200529      ***  Protect and non-display Ex-Date Position.
295200200529      *
295300200529     C                     MOVEA'01'      *IN,62
295400200529      *
295500200529      ***  Add 1 to line counter.
295600200529      *
295700200529     C********             ADD  1         SRRN             SFLRCDNBR      137879
295800200529     C                     ADD  1         SRRN       81    SFLRCDNBR      137879
295900200529     C                     ADD  1         WWCPT            Screen line number
296000200529     C                     Z-ADDSRRN      DUSRRN  40                      136935
296100200529      *
296200200529      ***  Write a subfile record.
296300200529      *
296400200529     C                     EXSR SRU001
296500200529     C                     ENDIF                                          137879
296600200529     C                     ENDIF
296700200529      *
296800200529      ***  If Dummy Customer = 0, reset IN30 to see the '+' sign at the bottom of the screen.
296900200529      *
297000200529     C                     ELSE
297100200529     C                     MOVE '0'       *IN30
297200200529     C                     ENDIF
297300200529      *
297400200529     C                     ENDSR
297500200529      *
297600200529      *****************************************************************
297700200529      /EJECT
297800200529      *****************************************************************
297900200529      *                                                               *
298000200529      *  SRBLDN - Build the next subfile page.                        *
298100200529      *                                                               *
298200200529      *  Called by: SRMAIN - Main processing.                         *
298300200529      *                                                               *
298400200529      *  Calls: SRS001 - Set first lines of subfile for each Book     *
298500200529      *                  Position records when subfile is build from  *
298600200529      *                  begining.                                    *
298700200529      *         SRS002 - Set detail lines of subfile for each         *
298800200529      *                  Customer Position records when subfile is    *
298900200529      *                  build.                                       *
299000200529      *         SRS003 - Set subfile last line for each build of the  *
299100200529      *                  subfile when all details in files are        *
299200200529      *                  reached.                                     *
299300200529      *                                                               *
299400200529      *****************************************************************
299500200529      *
299600200529     C           SRBLDN    BEGSR                           ** SRBLDN SR **
299700200529      *
299800200529      ***  Reset subfile next change indicator.
299900200529      *
300000200529     C                     MOVE '0'       *IN84            No SFLNXTCHG
300100200529      *
300200200529      ***  Init screen line number.
300300200529      *
300400200529     C                     Z-ADD0         WWCPT   20
300500200529      *                                                                   CSE020
300600200529      ** Move the originating parent's security if parent reference       CSE020
300700200529      ** is not blanks.                                                   CSE020
300800200529      *                                                                   CSE020
300900200529     C           MAPREF    IFNE *BLANKS                                   CSE020
301000200529     C                     MOVE PSESN     WKSESN 10                       CSE020
301100200529     C                     MOVE WOSESN    PSESN                           CSE020
301200200529     C                     ENDIF                                          CSE020
301300200529      *
301400200529      ***  Set key fields for LF/SECDEPL4: branch, security and Depot.
301500200529      *
301600200529     C                     MOVE PBRCD     WKBRCD           Branch
301700200529     C                     MOVE PSESN     WKSESN           Security
301800200529     C                     MOVE PDEPO     WKDEPO           Depot
301900200529      *
302000200529      ***  If processing running from 'Review from', setup key fields with Review From fields
302100200529      ***  and position of file, depending on Review From field selected.
302200200529      *
302300200529     C           *IN47     IFEQ '1'
302400200529     C           SRFBK     IFEQ *BLANKS                                   137879
302500200529     C           SCUST     ANDEQ*BLANKS                                   137879
302600200529     C           WKEY2     SETLLSEUDEPL0                                  137879
302700200529     C           WKEY2     SETLLSECDEPL4                                  137879
302800200529     C                     ELSE                                           137879
302900200529     C           SRFBK     IFNE *BLANKS
303000200529     C                     MOVE SRFBK     WKUDBK           Review From Book
303100200529      *                                                                   CAC005
303200200529      ** If CAC005 is installed, retrieve the corresponding pseudo book   CAC005
303300200529      *                                                                   CAC005
303400200529     C           CAC005    IFEQ 'Y'                                       CAC005
303500200529     C                     CALL 'AOBKPCR0'                                CAC005
303600200529     C                     PARM *BLANKS   PRTCD1                          CAC005
303700200529     C                     PARM '*PSEUDO' POPTN1                          CAC005
303800200529     C                     PARM SRFBK     PBKCD                           CAC005
303900200529     C                     PARM SPRFC     PPRFC                           CAC005
304000200529     C                     PARM           PPSBK                           CAC005
304100200529      *                                                                   CAC005
304200200529     C           PRTCD1    IFEQ *BLANKS                                   CAC005
304300200529     C                     MOVE PPSBK     WKUDBK                          CAC005
304400200529     C                     ENDIF                                          CAC005
304500200529     C                     ENDIF                                          CAC005
304600200529      *                                                                   CAC005
304700200529     C           WKEY13    SETLLSEUDEPL0
304800200529     C           WKEY2     SETLLSECDEPL4
304900200529     C                     ELSE
305000200529     C                     MOVE *BLANKS   WKPTFR           Portfolio
305100200529     C                     MOVE SCUST     WKCDCN           Review From Customer
305200200529     C           WKEY16    SETLLSECDEPL4
305300200529     C                     ENDIF
305400200529     C                     ENDIF                                          137879
305500200529      *
305600200529     C                     ELSE
305700200529      *
305800200529      ***  If processing running from 'Rollup', retrieve last Customer and Portfolio processed on
305900200529      ***  subfile record, and set greater on LF/SECDEPL4.
306000200529      *
306100200529     C           *IN27     IFEQ '1'
306200200529     C                     MOVE '0'       *IN27
306300200529     C                     MOVE WWRRN     SRRN
306400200529     C           *IN60     IFEQ '1'
306500200529     C           SRRN      CHAINSE7513S0             88
306600200529     C                     ELSE
306700200529     C           SRRN      CHAINSE7513S1             88
306800200529     C                     ENDIF
306900200529     C                     MOVE SHCNUM    WKCDCN           Last Customer processed = hidden field
307000200529     C                     MOVE SHPORT    WKPTFR           Last Portfolio processed = hidden field
307100200529     C           WKEY5     SETGTSECDEPL4
307200200529     C                     ELSE
307300200529      *
307400200529      ***  Else, if not Rollup and not Review From processing, set greater on LF/SECDEPL4 with
307500200529      ***  Branch, Security and Depot.
307600200529      *
307700200529     C           WKEY2     SETGTSECDEPL4
307800200529     C                     ENDIF
307900200529     C                     ENDIF
308000200529      *
308100200529      ***  Set detail lines of subfile.
308200200529      *
308300200529     C                     EXSR SRS001
308400200529     C                     EXSR SRS002
308500200529      *
308600200529      ***  Set last line of subfile.
308700200529      *
308800200529     C                     Z-ADD0         DUSRRN                          136935
308900200529     C                     EXSR SRS003
309000200529      *
309100200529      ***  Save position.
309200200529      *
309300200529     C                     Z-ADDSRRN      WWRRN            Save SFLRCDNBR.
309400200529      *
309500200529     C                     ENDSR
309600200529      *
309700200529      *****************************************************************
309800200529      /EJECT
309900200529      *****************************************************************
310000200529      *                                                               *
310100200529      *  SRVALD - Validate subfile records.                           *
310200200529      *                                                               *
310300200529      *  Called by: SRMAIN - Main processing.                         *
310400200529      *                                                               *
310500200529      *  Calls: SRPRAC - Process Action Code.                         *
310600200529      *         SRVLD2 - Validate amended fields.                     *
310700200529      *         ZASNMS - Send Message to Program Message Queue.       *
310800200529      *                                                               *
310900200529      *****************************************************************
311000200529      *
311100200529     C           SRVALD    BEGSR                           ** SRVALD SR **
311200200529      *
311300200529      ***  Reset fields and indicators.
311400200529      *
311500200529     C                     MOVE ' '       SACODE           Action Code
311600200529     C                     MOVE 'N'       ERMSG            Error found
311700200529     C***********          MOVEA'000'     *IN,50                          CAC005
311800200529     C                     MOVEA'0000'    *IN,50                          CAC005
311900200529     C                     MOVEA'00000'   *IN,54
312000200529     C                     Z-ADD0         SVRRN   40       Record Number saved field
312100200529     C                     MOVE 'N'       DUMMYM  1                       136935
312200200529      *
312300200529      ***  Read first changed subfile record.
312400200529      *
312500200529     C           *IN60     IFEQ '1'
312600200529     C                     READCSE7513S0                 33Normal subfile
312700200529     C                     ELSE
312800200529     C                     READCSE7513S1                 33'CASH' subfile
312900200529     C                     ENDIF
313000200529      *
313100200529      ***  Do while record changed on subfile.
313200200529      *
313300200529     C           *IN33     DOWEQ'0'
313400200529      *
313500200529      ***  Save record number and indicator.
313600200529      *
313700200529     C                     Z-ADDSRRN      SVRRN
313800200529     C                     MOVE SHIND2    *IN62
313900200529     C                     MOVE SHIND3    *IN63
314000200529     C                     MOVE SHIND4    *IN64
314100200529     C                     MOVE SHIND6    *IN66
314200200529     C                     MOVE SHIND7    *IN67
314300200529      *
314400200529      ***  If Action field is not equal to blank.
314500200529      *
314600200529     C           SACODE    IFNE *BLANK
314700200529     C           PMODE     IFNE 'E'
314800200529     C           *IN60     IFEQ '1'                                       135689
314900200529     C           SACODE    IFNE 'Y'
315000200529     C           SACODE    ANDNE'J'
315100200529     C           SACODE    ANDNE'L'
315200200529     C           SACODE    ANDNE'V'
315300200529     C                     MOVEL'CO00267' ZAMSID
315400200529     C                     EXSR ZASNMS
315500200529     C                     MOVE '1'       *IN52
315600200529     C                     MOVE 'Y'       ERMSG
315700200529     C                     ENDIF                                          135689
315800200529     C                     ELSE                                           135689
315900200529     C           SACODE    IFNE 'Y'                                       135689
316000200529     C           SACODE    ANDNE'J'                                       135689
316100200529     C           SACODE    ANDNE'V'                                       135689
316200200529     C                     MOVEL'CO00585' ZAMSID                          135689
316300200529     C                     EXSR ZASNMS                                    135689
316400200529     C                     MOVE '1'       *IN52                           135689
316500200529     C                     MOVE 'Y'       ERMSG                           135689
316600200529     C                     ENDIF                                          135689
316700200529     C                     ENDIF                                          135689
316800200529     C******               ELSE                                           135689
316900200529     C           ERMSG     IFNE 'Y'                                       135689
317000200529     C           PPROC     IFEQ 'CC'                                      CEU017
317100200529     C           SACODE    IFEQ 'Y'                                       CEU017
317200200529     C           SACODE    OREQ 'J'                                       CEU017
317300200529     C           SACODE    IFEQ 'Y'                                       CEU017
317400200529     C                     MOVEL'CO00360' ZAMSID                          CEU017
317500200529     C                     ELSE                                           CEU017
317600200529     C                     MOVEL'CO00361' ZAMSID                          CEU017
317700200529     C                     ENDIF                                          CEU017
317800200529     C                     EXSR ZASNMS                                    CEU017
317900200529     C                     MOVE '1'       *IN52                           CEU017
318000200529     C                     MOVE 'Y'       ERMSG                           CEU017
318100200529     C                     ENDIF                                          CEU017
318200200529     C                     ENDIF                                          CEU017
318300200529     C           SACODE    IFEQ 'L'
318400200529     C           SHCNUM    IFEQ WDUMMY
318500200529     C                     MOVEL'CO00326' ZAMSID           Allocation not allowed for
318600200529     C                     EXSR ZASNMS                     Dummy Customer.
318700200529     C                     MOVE '1'       *IN52
318800200529     C                     MOVE 'Y'       ERMSG
318900200529     C                     ENDIF
319000200529     C           SSTAT     IFEQ 'S'
319100200529     C           SSTAT     OREQ 'X'
319200200529     C                     MOVEL'CO00308' ZAMSID           Allocation not allowed for Status
319300200529     C                     EXSR ZASNMS                     'Stock Authorised' or 'Fully
319400200529     C                     MOVE '1'       *IN52            Authorised'.
319500200529     C                     MOVE 'Y'       ERMSG
319600200529     C                     ENDIF
319700200529     C           PFINA     IFEQ 'S'
319800200529     C           PFINA     OREQ 'Y'
319900200529     C                     MOVEL'CO00196' ZAMSID           Allocation not allowed for Final
320000200529     C                     EXSR ZASNMS                     Allocation Indicator 'Final Stock
320100200529     C                     MOVE '1'       *IN52            Allocation' or 'Final Cash Allocation'.
320200200529     C                     MOVE 'Y'       ERMSG
320300200529     C                     ENDIF
320400200529      *                                                                   CSE020
320500200529      ** Check if child is allowed to be allocated                        CSE020
320600200529      *                                                                   CSE020
320700200529     C           MAPREF    IFNE *BLANKS                                   CSE020
320800200529     C           MAPREF    CHAINSECORFD2             90                   CSE020
320900200529      *                                                                   CSE020
321000200529      ** Parent is not yet authorised                                     CSE020
321100200529      *                                                                   CSE020
321200200529     C           IPSTAT    IFNE 'X'                                       CSE020
321300200529     C                     MOVEL'CO00366' ZAMSID                          CSE020
321400200529     C                     EXSR ZASNMS                                    CSE020
321500200529     C                     MOVE '1'       *IN52                           CSE020
321600200529     C                     MOVE 'Y'       ERMSG                           CSE020
321700200529     C                     ENDIF                                          CSE020
321800200529      *                                                                   CSE020
321900200529      ** Ex-date of the child is not the same as the Parent Action        CSE020
322000200529      *                                                                   CSE020
322100200529     C           MACOEX    IFNE IPCOEX                                    CSE020
322200200529     C                     MOVEL'CO00370' ZAMSID                          CSE020
322300200529     C                     EXSR ZASNMS                                    CSE020
322400200529     C                     MOVE *ON       *IN52                           CSE020
322500200529     C                     MOVE 'Y'       ERMSG                           CSE020
322600200529     C                     ENDIF                                          CSE020
322700200529      *                                                                   CSE020
322800200529      ** Initialise array for New Securities                              CSE020
322900200529      *                                                                   CSE020
323000200529     C                     Z-ADD1         Y       30                      CSE020
323100200529      *                                                                   CSE020
323200200529     C           Y         DOWLE180                                       CSE020
323300200529     C                     MOVE *BLANKS   NSEC,Y                          CSE020
323400200529     C                     ADD  1         Y                               CSE020
323500200529     C                     ENDDO                                          CSE020
323600200529      *                                                                   CSE020
323700200529      ** Security of the child action is not equal to one of the New      CSE020
323800200529      ** Security of the parent action                                    CSE020
323900200529      *                                                                   CSE020
324000200529     C                     Z-ADD1         Y                               CSE020
324100200529      *                                                                   CSE020
324200200529     C                     SELEC                                          CSE020
324300200529     C           IPPTYP    WHEQ 'DV'                                      CSE020
324400200529     C           IPCORF    SETLLSECODVL1                                  CSE020
324500200529     C           IPCORF    READESECODVL1                 88               CSE020
324600200529     C           *IN88     DOWEQ'0'                                       CSE020
324700200529     C           MDNSEC    IFEQ *BLANKS                                   CSE020
324800200529     C                     MOVEAIPSESN    NSEC,Y                          CSE020
324900200529     C                     ELSE                                           CSE020
325000200529     C                     MOVEAMDNSEC    NSEC,Y                          CSE020
325100200529     C                     ENDIF                                          CSE020
325200200529     C                     ADD  1         Y                               CSE020
325300200529     C           IPCORF    READESECODVL1                 88               CSE020
325400200529     C                     ENDDO                                          CSE020
325500200529      *                                                                   CSE020
325600200529     C           IPPTYP    WHEQ 'FR'                                      CSE020
325700200529     C           IPCORF    SETLLSECOFRL1                                  CSE020
325800200529     C           IPCORF    READESECOFRL1                 88               CSE020
325900200529     C           *IN88     DOWEQ'0'                                       CSE020
326000200529     C           MENSEC    IFEQ *BLANKS                                   CSE020
326100200529     C                     MOVEAIPSESN    NSEC,Y                          CSE020
326200200529     C                     ELSE                                           CSE020
326300200529     C                     MOVEAMENSEC    NSEC,Y                          CSE020
326400200529     C                     ENDIF                                          CSE020
326500200529     C                     ADD  1         Y                               CSE020
326600200529     C           IPCORF    READESECOFRL1                 88               CSE020
326700200529     C                     ENDDO                                          CSE020
326800200529      *                                                                   CSE020
326900200529     C           IPPTYP    WHEQ 'CR'                                      CSE020
327000200529     C           IPCORF    SETLLSECOCRL1                                  CSE020
327100200529     C           IPCORF    READESECOCRL1                 88               CSE020
327200200529     C           *IN88     DOWEQ'0'                                       CSE020
327300200529     C           MHSECA    IFEQ *BLANKS                                   CSE020
327400200529     C                     MOVEAIPSESN    NSEC,Y                          CSE020
327500200529     C                     ELSE                                           CSE020
327600200529     C                     MOVEAMHSECA    NSEC,Y                          CSE020
327700200529     C                     ENDIF                                          CSE020
327800200529     C                     ADD  20        Y                               CSE020
327900200529     C           IPCORF    READESECOCRL1                 88               CSE020
328000200529     C                     ENDDO                                          CSE020
328100200529      *                                                                   CSE020
328200200529     C           IPPTYP    WHEQ 'OF'                                      CSE020
328300200529     C           IPCORF    SETLLSECOOFL1                                  CSE020
328400200529     C           IPCORF    READESECOOFL1                 88               CSE020
328500200529     C           *IN88     DOWEQ'0'                                       CSE020
328600200529     C           MINSEC    IFEQ *BLANKS                                   CSE020
328700200529     C                     MOVE IPSESN    NSEC,Y                          CSE020
328800200529     C                     ELSE                                           CSE020
328900200529     C                     MOVE MINSEC    NSEC,Y                          CSE020
329000200529     C                     ENDIF                                          CSE020
329100200529     C                     ADD  1         Y                               CSE020
329200200529     C           IPCORF    READESECOOFL1                 88               CSE020
329300200529     C                     ENDDO                                          CSE020
329400200529      *                                                                   CSE020
329500200529     C           IPPTYP    WHEQ 'RG'                                      CSE020
329600200529     C           IPCORF    SETLLSECORGL1                                  CSE020
329700200529     C           IPCORF    READESECORGL1                 88               CSE020
329800200529     C           *IN88     DOWEQ'0'                                       CSE020
329900200529     C           MFNSEC    IFEQ *BLANKS                                   CSE020
330000200529     C                     MOVE IPSESN    NSEC,Y                          CSE020
330100200529     C                     ELSE                                           CSE020
330200200529     C                     MOVE MFNSEC    NSEC,Y                          CSE020
330300200529     C                     ENDIF                                          CSE020
330400200529     C                     ADD  1         Y                               CSE020
330500200529     C           IPCORF    READESECORGL1                 88               CSE020
330600200529     C                     ENDDO                                          CSE020
330700200529      *                                                                   CSE020
330800200529     C           IPPTYP    WHEQ 'EX'                                      CSE020
330900200529     C           IPCORF    SETLLSECOEXL1                                  CSE020
331000200529     C           IPCORF    READESECOEXL1                 88               CSE020
331100200529     C           *IN88     DOWEQ'0'                                       CSE020
331200200529     C           MJNSEC    IFEQ *BLANKS                                   CSE020
331300200529     C                     MOVE IPSESN    NSEC,Y                          CSE020
331400200529     C                     ELSE                                           CSE020
331500200529     C                     MOVE MJNSEC    NSEC,Y                          CSE020
331600200529     C                     ENDIF                                          CSE020
331700200529     C                     ADD  1         Y                               CSE020
331800200529     C           IPCORF    READESECOEXL1                 88               CSE020
331900200529     C                     ENDDO                                          CSE020
332000200529      *                                                                   CSE020
332100200529     C           IPPTYP    WHEQ 'NC'                                      CSE020
332200200529     C           IPCORF    SETLLSECONCL1                                  CSE020
332300200529     C           IPCORF    READESECONCL1                 88               CSE020
332400200529     C           *IN88     DOWEQ'0'                                       CSE020
332500200529     C           MLSESN    IFEQ *BLANKS                                   CSE020
332600200529     C                     MOVE IPSESN    NSEC,Y                          CSE020
332700200529     C                     ELSE                                           CSE020
332800200529     C                     MOVE MLSESN    NSEC,Y                          CSE020
332900200529     C                     ENDIF                                          CSE020
333000200529     C                     ADD  1         Y                               CSE020
333100200529     C           IPCORF    READESECONCL1                 88               CSE020
333200200529     C                     ENDDO                                          CSE020
333300200529      *                                                                   CSE020
333400200529     C           IPPTYP    WHEQ 'CC'                                      CSE020
333500200529     C           IPCORF    SETLLSECOCCL2                                  CSE020
333600200529     C           IPCORF    READESECOCCL2                 88               CSE020
333700200529     C           *IN88     DOWEQ'0'                                       CSE020
333800200529     C           NANSEC    IFEQ *BLANKS                                   CSE020
333900200529     C                     MOVE IPSESN    NSEC,Y                          CSE020
334000200529     C                     ELSE                                           CSE020
334100200529     C                     MOVE NANSEC    NSEC,Y                          CSE020
334200200529     C                     ENDIF                                          CSE020
334300200529     C                     ADD  1         Y                               CSE020
334400200529     C           IPCORF    READESECOCCL2                 88               CSE020
334500200529     C                     ENDDO                                          CSE020
334600200529      *                                                                   CSE020
334700200529     C                     ENDSL                                          CSE020
334800200529      *                                                                   CSE020
334900200529      ** Validate security of the child such that it is equal to          CSE020
335000200529      ** new security of the parent                                       CSE020
335100200529      *                                                                   CSE020
335200200529     C           MASESN    LOKUPNSEC                     88               CSE020
335300200529     C           *IN88     IFEQ '0'                                       CSE020
335400200529     C                     MOVEL'CO00371' ZAMSID                          CSE020
335500200529     C                     EXSR ZASNMS                                    CSE020
335600200529     C                     MOVE '1'       *IN52                           CSE020
335700200529     C                     MOVE 'Y'       ERMSG                           CSE020
335800200529     C                     ENDIF                                          CSE020
335900200529      *                                                                   CSE020
336000200529     C                     ENDIF                                          CSE020
336100200529      *                                                                   CSE020
336200200529     C                     ENDIF
336300200529     C                     ENDIF
336400200529     C                     ENDIF
336500200529     C           PMODE     IFEQ 'E'
336600200529     C******     SACODE    IFEQ 'L'                                       136930
336700200529     C******     SACODE    OREQ 'Y'                                       136930
336800200529     C           SACODE    IFNE 'J'                                       136930
336900200529     C           SACODE    ANDNE'V'                                       136930
337000200529     C                     MOVEL'CO00299' ZAMSID
337100200529     C                     EXSR ZASNMS
337200200529     C                     MOVE '1'       *IN52
337300200529     C                     MOVE 'Y'       ERMSG
337400200529     C                     ELSE                                           CEU017
337500200529     C           PPROC     IFEQ 'CC'                                      CEU017
337600200529     C           SACODE    IFEQ 'J'                                       CEU017
337700200529     C                     MOVEL'CO00361' ZAMSID                          CEU017
337800200529     C                     EXSR ZASNMS                                    CEU017
337900200529     C                     MOVE '1'       *IN52                           CEU017
338000200529     C                     MOVE 'Y'       ERMSG                           CEU017
338100200529     C                     ENDIF                                          CEU017
338200200529     C                     ENDIF                                          CEU017
338300200529     C                     ENDIF
338400200529     C                     ENDIF
338500200529      *
338600200529     C           ERMSG     IFEQ 'N'
338700200529     C                     EXSR SRPRAC
338800200529     C                     MOVE ' '       SACODE
338900200529     C                     MOVE '0'       *IN59
339000200529     C                     ENDIF
339100200529      *
339200200529     C                     ELSE
339300200529     C                     EXSR SRVLD2
339400200529     C                     ENDIF
339500200529      *
339600200529     C           ERMSG     IFEQ 'N'
339700200529     C                     MOVE '0'       *IN84
339800200529     C                     ELSE
339900200529     C                     MOVE '1'       *IN84
340000200529     C                     ENDIF
340100200529      *
340200200529     C           *IN60     IFEQ '1'
340300200529     C                     UPDATSE7513S0
340400200529     C                     ELSE
340500200529     C                     UPDATSE7513S1
340600200529     C                     ENDIF
340700200529      *
340800200529     C                     Z-ADDWWRRN     SRRN
340900200529      *
341000200529     C***********          MOVEA'000'     *IN,50                          CAC005
341100200529     C                     MOVEA'0000'    *IN,50                          CAC005
341200200529     C                     MOVEA'00000'   *IN,54
341300200529      *
341400200529      ***  Read next change of subfile record.
341500200529      *
341600200529     C           *IN60     IFEQ '1'
341700200529     C                     READCSE7513S0                 33
341800200529     C                     ELSE
341900200529     C                     READCSE7513S1                 33
342000200529     C                     ENDIF
342100200529      *
342200200529     C                     ENDDO
342300200529      *                                                                   136935
342400200529      ***  If Dummy Customer amended and already displayed, update record 136935
342500200529      ***  on subfile for Dummy Customer.                                 136935
342600200529      *                                                                   136935
342700200529     C           DUSRRN    IFNE 0                                         136935
342800200529     C           DUMMYM    ANDEQ'Y'                                       136935
342900200529      *                                                                   136935
343000200529      ***  Setup key and work fields.                                     136935
343100200529      *                                                                   136935
343200200529     C                     MOVE PCORF     WKCORF           CO Reference   136935
343300200529     C                     Z-ADDPOPTN     WKOPTN           Option Number  136935
343400200529     C                     MOVE PBRCD     WKBRCD           Branch         136935
343500200529     C**********           Z-ADDPDEPO     WKDEPO           Depot                       136935 CSD027
343600200529     C                     MOVE PDEPO     WKDEPO           Depot                              CSD027
343700200529     C                     MOVE 'C'       WKCOTP           Cust/Book Ind. 136935
343800200529     C                     MOVE *BLANKS   WKBOOK           Book           136935
343900200529     C**********           Z-ADDWDUMMY    WKCNUM           Customer                    136935 CSD027
344000200529     C                     MOVE WDUMMY    WKCNUM           Customer                           CSD027
344100200529     C                     MOVE *BLANKS   WKPTFR           Portfolio      136935
344300200529     C           *IN60     IFEQ '1'                                       136935
344400200529     C                     MOVE PNWSEC    WKSESN           Security       136935
344500200529     C                     ELSE                                           136935
344600200529     C                     MOVEL'**CASH**'WKSESN    P      Sec. = CASH    136935
344700200529     C                     ENDIF                                          136935
344800200529      *                                                                   136935
344900200529      ***  Retrieve CO Allocation details for Dummy Customer              136935
345000200529      *                                                                   136935
345100200529     C           WKEY4     CHAINSECOALL1             79                   136935
345200200529      *                                                                   136935
345300200529     C           *IN60     IFEQ '1'                                       136935
345400200529     C           DUSRRN    CHAINSE7513S0             33    Normal subfile 136935
345500200529     C                     ELSE                                           136935
345600200529     C           DUSRRN    CHAINSE7513S1             33    'CASH' subfile 136935
345700200529     C                     ENDIF                                          136935
345800200529      *                                                                   136935
345900200529     C                     MOVE SHIND2    *IN62                           136935
346000200529     C                     MOVE SHIND3    *IN63                           136935
346100200529     C                     MOVE SHIND4    *IN64                           136935
346200200529     C                     MOVE SHIND6    *IN66                           136935
346300200529     C                     MOVE SHIND7    *IN67                           136935
346400200529      *                                                                   136935
346500200529     C                     SELEC                           Reply Status   136935
346600200529     C           MCREST    WHEQ 'R'                                       136935
346700200529     C                     MOVE STATUS,1  SREST                           136935
346800200529     C           MCREST    WHEQ 'S'                                       136935
346900200529     C                     MOVE STATUS,2  SREST                           136935
347000200529     C           MCREST    WHEQ 'C'                                       136935
347100200529     C                     MOVE STATUS,3  SREST                           136935
347200200529     C           MCREST    WHEQ 'M'                                       136935
347300200529     C                     MOVE STATUS,4  SREST                           136935
347400200529     C           MCREST    WHEQ 'N'                                       136935
347500200529     C                     MOVE STATUS,5  SREST                           136935
347600200529     C           MCREST    WHEQ ' '                                       136935
347700200529     C                     MOVE STATUS,5  SREST                           136935
347800200529     C                     ENDSL                                          136935
347900200529      *                                                                   136935
348000200529     C           *IN60     IFEQ '1'                        Normal screen  136935
348100200529      *                                                                   136935
348200200529     C                     MOVE *BLANKS   SASAL            Act.Stk Alloc. 136935
348300200529     C           MCASTA    IFNE 0                                         136935
348400200529     C                     MOVE *BLANKS   ZFLD15                          136935
348500200529     C                     MOVE MCASTA    ZFLD15                          136935
348600200529     C                     Z-ADDNMDP2     ZDECS            New Sec.Dec.Pl.136935
348700200529     C                     EXSR ZSEDIT                                    136935
348800200529     C                     MOVE ZOUT21    SASAL                           136935
348900200529     C                     ENDIF                                          136935
349000200529     C                     MOVE SASAL     SHASAL                          136935
349100200529     C                     Z-ADDMCASTA    SHASTA                          136935
349200200529      *                                                                   136935
349300200529     C                     MOVE *BLANKS   SASRO            Act.Stk Round. 136935
349400200529     C           MCASTR    IFNE 0                                         136935
349500200529     C                     MOVE *BLANKS   ZFLD15                          136935
349600200529     C                     MOVE MCASTR    ZFLD15                          136935
349700200529     C                     Z-ADD8         ZDECS            8 Dec. Places  136935
349800200529     C                     EXSR ZSEDIT                                    136935
349900200529     C                     MOVE ZOUT21    SASRO                           136935
350000200529     C                     ENDIF                                          136935
350100200529     C                     Z-ADDMCASTR    SHASTR                          136935
350200200529      *                                                                   136935
350300200529     C                     MOVE *BLANKS   SACRO            Act.Cash Round.136935
350400200529     C           MCACAR    IFNE 0                                         136935
350500200529     C                     MOVE *BLANKS   ZFLD15                          136935
350600200529     C                     MOVE MCACAR    ZFLD15                          136935
350700200529     C                     Z-ADDNMDPC2    ZDECS            New Ccy Dec.Pl.136935
350800200529     C                     EXSR ZSEDIT                                    136935
350900200529     C                     MOVE ZOUT21    SACRO                           136935
351000200529     C                     ENDIF                                          136935
351100200529     C                     MOVE SACRO     SHACRO                          136935
351200200529     C                     Z-ADDMCACAR    SHACAR                          136935
351300200529      *                                                                   136935
351400200529     C                     ELSE                            CASH screen    136935
351500200529      *                                                                   136935
351600200529     C                     MOVE *BLANKS   SACAL            Act.Cash Alloc.136935
351700200529     C           MCACAA    IFNE 0                                         136935
351800200529     C                     MOVE *BLANKS   ZFLD15                          136935
351900200529     C                     MOVE MCACAA    ZFLD15                          136935
352000200529     C           PPROC     IFEQ 'CR'                                      136935
352100200529     C                     Z-ADDNMDPC1    ZDECS            Ev.Ccy Dec.Pl. 136935
352200200529     C                     ELSE                                           136935
352300200529     C                     Z-ADDNMDPC2    ZDECS            New Ccy Dec.Pl.136935
352400200529     C                     ENDIF                                          136935
352500200529     C                     EXSR ZSEDIT                                    136935
352600200529     C                     MOVE ZOUT21    SACAL                           136935
352700200529     C                     ENDIF                                          136935
352800200529     C                     MOVE SACAL     SHACAL                          136935
352900200529     C                     Z-ADDMCACAA    SHACAA                          136935
353000200529     C                     Z-ADDMCACAA    HSACAA                          136935
353100200529      *                                                                   136935
353200200529     C                     MOVE *BLANKS   SACRO            Act.Cash Round.136935
353300200529     C           MCACAR    IFNE 0                                         136935
353400200529     C                     MOVE *BLANKS   ZFLD15                          136935
353500200529     C                     MOVE MCACAR    ZFLD15                          136935
353600200529     C           PPROC     IFEQ 'CR'                                      136935
353700200529     C                     Z-ADDNMDPC1    ZDECS            Ev.Ccy Dec.Pl. 136935
353800200529     C                     ELSE                                           136935
353900200529     C                     Z-ADDNMDPC2    ZDECS            New Ccy Dec.Pl.136935
354000200529     C                     ENDIF                                          136935
354100200529     C                     EXSR ZSEDIT                                    136935
354200200529     C                     MOVE ZOUT21    SACRO                           136935
354300200529     C                     ENDIF                                          136935
354400200529     C                     MOVE SACRO     SHACRO                          136935
354500200529     C                     Z-ADDMCACAR    SHACAR                          136935
354600200529     C                     Z-ADDMCACAR    HSACAR                          136935
354700200529      *                                                                   136935
354800200529      ***  Total Settlement = Actual Cash Allocation & Rounding +/- Total 136935
354900200529      ***  Fees +/- Total Taxes (+ if Ex-Date Position is > or = 0,       136935
355000200529      ***  else -).                                                       136935
355100200529      *                                                                   136935
355200200529     C           MCACAA    ADD  MCACAR    WWTSET 150                      136935
355300200529     C           MCEXPO    IFGE 0                                         136935
355400200529     C***********          ADD  MCTOTF    WWTSET                    136935161641
355500200529     C***********          ADD  MCTOTT    WWTSET                    136935161641
355600200529     C                     SUB  MCTOTF    WWTSET                          161641
355700200529     C                     SUB  MCTOTT    WWTSET                          161641
355800200529     C                     ELSE                                           136935
355900200529     C                     SUB  MCTOTF    WWTSET                          136935
356000200529     C***********          SUB  MCTOTT    WWTSET                    136935161641
356100200529     C                     ADD  MCTOTT    WWTSET                          161641
356200200529     C                     ENDIF                                          136935
356300200529     C                     MOVE *BLANKS   STSET                           136935
356400200529     C           WWTSET    IFNE 0                                         136935
356500200529     C                     MOVE *BLANKS   ZFLD15                          136935
356600200529     C                     MOVE WWTSET    ZFLD15                          136935
356700200529     C           PPROC     IFEQ 'CR'                                      136935
356800200529     C                     Z-ADDNMDPC1    ZDECS            Ev.Ccy Dec.Pl. 136935
356900200529     C                     ELSE                                           136935
357000200529     C                     Z-ADDNMDPC2    ZDECS            New Ccy Dec.Pl.136935
357100200529     C                     ENDIF                                          136935
357200200529     C                     EXSR ZSEDIT                                    136935
357300200529     C                     MOVE ZOUT21    STSET                           136935
357400200529     C                     ENDIF                                          136935
357500200529      *                                                                   136935
357600200529     C                     ENDIF                                          136935
357700200529      *                                                                   136935
357800200529     C           *IN60     IFEQ '1'                                       136935
357900200529     C                     UPDATSE7513S0                   Normal screen  136935
358000200529     C                     ELSE                                           136935
358100200529     C                     UPDATSE7513S1                   CASH screen    136935
358200200529     C                     ENDIF                                          136935
358300200529      *                                                                   136935
358400200529     C                     ENDIF                                          136935
358500200529      *                                                                   136935
358600200529     C           SVRRN     IFEQ 0
358700200529     C                     Z-ADDCPFPOS    SRRN
358800200529     C                     ELSE
358900200529     C                     Z-ADDSVRRN     SRRN
359000200529     C                     ENDIF
359100200529      *
359200200529     C                     ENDSR
359300200529      *
359400200529      *****************************************************************
359500200529      /EJECT
359600200529      *****************************************************************
359700200529      *                                                               *
359800200529      *  SRVLD2 - Validate amended fields.                            *
359900200529      *                                                               *
360000200529      *  Called by: SRVALD - Validate subfile records.                *
360100200529      *                                                               *
360200200529      *  Calls:                                                       *
360300200529      *                                                               *
360400200529      *****************************************************************
360500200529      *
360600200529     C           SRVLD2    BEGSR                           ** SRVLD2 SR **
360700200529      *
360800200529     C                     MOVE 'N'       AMHOCA  1
360900200529     C                     MOVE 'N'       AMHOST  1
361000200529     C                     MOVE 'N'       AMASAL  1
361100200529     C                     MOVE 'N'       AMACRO  1
361200200529     C                     MOVE 'N'       AMASTR  1
361300200529     C                     MOVE 'N'       AMACAR  1
361400200529     C                     MOVE 'N'       AMACAA  1
361500200529      *
361600200529      ***  For normal screen.
361700200529      *
361800200529     C           *IN60     IFEQ '1'
361900200529      *
362000200529      ***  Actual Stock Allocation and Actual Cash Rounding can not
362100200529      ***  be changed in same time.
362200200529      *
362300200529     C           SASAL     IFNE SHASAL
362400200529     C           SACRO     ANDNESHACRO
362500200529     C                     MOVEL'CO00302' ZAMSID
362600200529     C                     EXSR ZASNMS
362700200529     C                     MOVE '1'       *IN54
362800200529     C                     MOVE '1'       *IN55
362900200529     C                     MOVE 'Y'       ERMSG
363000200529     C                     ELSE
363100200529      *
363200200529     C                     MOVE PCORF     WKCORF
363300200529     C                     Z-ADDPOPTN     WKOPTN
363400200529     C                     MOVE PBRCD     WKBRCD
363500200529     C**********           Z-ADDPDEPO     WKDEPO                                              CSD027
363600200529     C                     MOVE PDEPO     WKDEPO                                              CSD027
363700200529      *
363800200529      ***  If Actual Stock Allocation has changed.
363900200529      *
364000200529     C           SASAL     IFNE SHASAL
364100200529     C                     MOVE NMDP2     ZSDEC            New Security Decimal Places
364200200529     C           15        SUB  ZSDEC     ZSDIG
364300200529     C                     MOVE SASAL     ZFLD17
364400200529     C                     EXSR ZASIGN
364500200529      *
364600200529      ***  Field must be numeric.
364700200529      *
364800200529     C           *IN99     IFEQ '1'
364900200529     C                     MOVEL'CO00264' ZAMSID
365000200529     C                     EXSR ZASNMS
365100200529     C                     MOVE '1'       *IN54
365200200529     C                     MOVE 'Y'       ERMSG
365300200529     C                     ELSE
365400200529      *
365500200529      ***  Save Actual Stock Allocation entered.
365600200529      *
365700200529     C                     MOVE ZOUT15    WWASTA 150
365800200529     C           ZFSIGN    IFEQ '-'
365900200529     C                     MULT -1        WWASTA
366000200529     C                     ENDIF
366100200529     C                     Z-ADDNMDP2     WWNBDP  10       New Security Decimal Places
366200200529     C                     Z-ADDWWASTA    WUNUM
366300200529     C                     EXSR RTVNDP
366400200529     C                     Z-ADDWWNUM     WUASTA 309
366500200529      *
366600200529      ***  Access File depending on CO Type.
366700200529      *
366800200529     C                     SELEC
366900200529     C           PPROC     WHEQ 'DV'                       Dividend Events
367000200529     C           WKEY14    CHAINSECODVL1             89
367100200529     C                     MOVE 'SECODVL1'WWFILE  8
367200200529      *
367300200529     C           PPROC     WHEQ 'RG'                       Rights Issues
367400200529     C           WKEY14    CHAINSECORGL1             89
367500200529     C                     MOVE 'SECORGL1'WWFILE
367600200529      *
367700200529     C           PPROC     WHEQ 'FR'                       Free Allocation
367800200529     C           WKEY14    CHAINSECOFRL1             89
367900200529     C                     MOVE 'SECOFRL1'WWFILE
368000200529      *
368100200529     C           PPROC     WHEQ 'OF'                       Offers
368200200529     C           WKEY14    CHAINSECOOFL1             89
368300200529     C                     MOVE 'SECOOFL1'WWFILE
368400200529      *
368500200529     C           PPROC     WHEQ 'CR'                       Corporate Reorganisation
368600200529     C           WKEY14    CHAINSECOCRL1             89
368700200529     C                     MOVE 'SECOCRL1'WWFILE
368800200529      *
368900200529     C           PPROC     WHEQ 'EX'                       Exercices and Conversions
369000200529     C           WKEY14    CHAINSECOEXL1             89
369100200529     C                     MOVE 'SECOEXL1'WWFILE
369200200529      *                                                                   CEU017
369300200529     C           PPROC     WHEQ 'CC'                       Currency       CEU017
369400200529     C           PCORF     CHAINSECOCCL2             89    Changes.       CEU017
369500200529     C                     MOVE 'SECOCCL2'WWFILE                          CEU017
369600200529     C                     ENDSL
369700200529      *
369800200529      ***  If record not found in its corresponding LF, handle Database Error.
369900200529      *
370000200529     C           *IN89     IFEQ '1'
370100200529     C           *LOCK     IN   LDA
370200200529     C                     MOVELWWFILE    DBFILE
370300200529     C           PCORF     CAT  POPNB:0   DBKEY1  8
370400200529     C           DBKEY9    CAT  DBKEY1:0  DBKEYA 10
370500200529     C                     MOVELDBKEY1    DBKEY            ***************
370600200529     C******               Z-ADD023       DBASE            * DB ERROR 23 *135686
370700200529     C                     Z-ADD033       DBASE            * DB ERROR 33 *135686
370800200529     C                     MOVEL'SE7513'  DBPGM            ***************
370900200529     C                     OUT  LDA
371000200529     C                     EXSR *PSSR
371100200529     C                     ENDIF
371200200529      *
371300200529      ***  If Processing Type not Capital Changes, not Non Financial Events and not Name Changes.
371400200529      *
371500200529     C                     MOVE 'Y'       ASAVAL  1
371600200529     C           PPROC     IFNE 'CE'                       Not Capital Changes
371700200529     C           PPROC     ANDNE'NF'                       Not Non Financial Events
371800200529     C           PPROC     ANDNE'NC'                       Not Name Changes
371900200529      *
372000200529      ***  Retrieve Rounding and Denomination Multiplier depending on CO Type.
372100200529      *
372200200529     C                     Z-ADD0         WWDMLT                          135686
372300200529     C           PPROC     IFEQ 'CR'
372400200529     C                     MOVEAMHSECA    TSEC,1
372500200529     C                     Z-ADD1         I       20
372600200529     C           PNWSEC    LOKUPTSEC,I                   17Search New Security (20 Potential)
372700200529     C           *IN17     IFEQ '0'
372800200529     C                     MOVE ' '       WWRNDN  1        Rounding
372900200529     C******               Z-ADD0         WWDMLT 158       Denom. Multip. 135686
373000200529     C                     Z-ADD1         WWDMLT 309       Denom. Multip. 135686
373100200529     C                     ELSE
373200200529     C                     MOVEAMHRNDN    TNDN,1
373300200529     C                     MOVE TNDN,I    WWRNDN           Rounding
373400200529     C                     MOVEAMHDMLA    TDML,1
373500200529     C******               MOVE TDML,I    WWDMLT           Denom. Multip. 135686
373600200529     C                     MOVE TDML,I    WUNUM            Denom. Multip. 135686
373700200529     C                     ENDIF
373800200529     C                     ELSE
373900200529     C******               Z-ADDMDDMLT    WWDMLT           Denom. Multip. 135686
374000200529     C                     Z-ADDMDDMLT    WUNUM            Denom. Multip. 135686
374100200529     C                     MOVE MDRNDN    WWRNDN           Rounding
374200200529     C                     ENDIF
374300200529     C           WWDMLT    IFNE 1                                         135686
374400200529     C           PNWSEC    CHAINSECTYZ1              89                   135686
374500200529     C           *IN89     IFEQ '1'                                       135686
374600200529     C           *LOCK     IN   LDA                                       135686
374700200529     C                     MOVEL'SECTY   'DBFILE                          135686
374800200529     C                     MOVELPNWSEC    DBKEY            ***************135686
374900200529     C                     Z-ADD034       DBASE            * DB ERROR 34 *135686
375000200529     C                     MOVEL'SE7513'  DBPGM            ***************135686
375100200529     C                     OUT  LDA                                       135686
375200200529     C                     EXSR *PSSR                                     135686
375300200529     C                     ENDIF                                          135686
375400200529     C                     Z-ADDNMDP      WWNBDP                          135686
375500200529     C                     EXSR RTVNDP                                    135686
375600200529     C                     Z-ADDWWNUM     WWDMLT                          135686
375700200529     C                     ENDIF                                          135686
375800200529      *
375900200529     C******     WWRNDN    IFEQ 'D'                                       135686
376000200529     C           WUASTA    DIV  WWDMLT    W1ASTA 300
376100200529     C                     MVR            RESTE   90                      135686
376200200529     C******               ELSE                                           135686
376300200529     C******     WUASTA    DIV  WWDMLT    W1ASTA    H                     135686
376400200529     C******               ENDIF                                          135686
376500200529     C******     W1ASTA    MULT WWDMLT    W2ASTA 309                      135686
376600200529      *
376700200529      ***  Actual Stock Allocation entered must be in Denomination Multiplier and Rounding
376800200529      ***  precision.
376900200529      *
377000200529     C******     WUASTA    IFNE W2ASTA                                    135686
377100200529     C           RESTE     IFNE 0                                         135686
377200200529     C                     MOVE '1'       *IN54
377300200529     C                     MOVE 'Y'       ERMSG
377400200529     C                     MOVE 'N'       ASAVAL
377500200529     C                     MOVEL'CO00362' ZAMSID
377600200529     C                     EXSR ZASNMS
377700200529     C                     ENDIF
377800200529     C                     ENDIF                                          135686
377900200529      *
378000200529      ***  If Actual Stock Allocation entered valid.
378100200529      *
378200200529     C           ASAVAL    IFEQ 'Y'
378300200529     C                     MOVE 'Y'       AMASAL
378400200529     C                     Z-ADDWWASTA    WWASAL 150
378500200529     C                     Z-ADDWUASTA    WUASAL 309
378600200529     C                     ENDIF
378700200529     C                     ENDIF
378800200529     C                     ENDIF
378900200529      *
379000200529      ***  If Actual Cash Rounding has changed.
379100200529      *
379200200529     C           SACRO     IFNE SHACRO
379300200529     C                     MOVE NMDPC2    ZSDEC            New Currency Decimal Places
379400200529     C           15        SUB  ZSDEC     ZSDIG
379500200529     C                     MOVE SACRO     ZFLD17
379600200529     C                     EXSR ZASIGN
379700200529      *
379800200529      ***  Field must be numeric.
379900200529      *
380000200529     C           *IN99     IFEQ '1'
380100200529     C                     MOVEL'CO00265' ZAMSID
380200200529     C                     EXSR ZASNMS
380300200529     C                     MOVE '1'       *IN55
380400200529     C                     MOVE 'Y'       ERMSG
380500200529     C                     ELSE
380600200529     C                     MOVE 'Y'       AMACRO
380700200529     C                     MOVE ZOUT15    WWACRO 150
380800200529     C           ZFSIGN    IFEQ '-'
380900200529     C                     MULT -1        WWACRO
381000200529     C                     ENDIF
381100200529     C                     ENDIF
381200200529     C                     ENDIF
381300200529      *
381400200529      ***  If input/output fields are changed and no error occured.
381500200529      *
381600200529     C           ERMSG     IFEQ 'N'
381700200529     C           SASAL     IFNE SHASAL
381800200529     C           SACRO     ORNE SHACRO
381900200529     C           SASAL     IFNE SHASAL
382000200529     C                     MOVE *BLANKS   SASAL
382100200529     C           WWASAL    IFNE 0
382200200529     C                     MOVE *BLANKS   ZFLD15
382300200529     C                     MOVE WWASAL    ZFLD15
382400200529     C                     Z-ADDNMDP2     ZDECS            New Security Decimnal Places
382500200529     C                     EXSR ZSEDIT
382600200529     C                     MOVE ZOUT21    SASAL
382700200529     C                     ENDIF
382800200529     C                     ENDIF
382900200529     C           SACRO     IFNE SHACRO
383000200529     C                     MOVE *BLANKS   SACRO
383100200529     C           WWACRO    IFNE 0
383200200529     C                     MOVE *BLANKS   ZFLD15
383300200529     C                     MOVE WWACRO    ZFLD15
383400200529     C                     Z-ADDNMDPC2    ZDECS            New Currency Decimal Places
383500200529     C                     EXSR ZSEDIT
383600200529     C                     MOVE ZOUT21    SACRO
383700200529     C                     ENDIF
383800200529     C                     ENDIF
383900200529      *
384000200529      ***  Recalculate fields due amendments and update current record.
384100200529      *
384200200529     C                     MOVE 'N'       MDUMMY  1                       136935
384300200529     C                     Z-ADD0         ACAADU 150                      136935
384400200529     C                     Z-ADD0         ACARDU 150                      136935
384500200529     C                     Z-ADD0         ASTADU 150                      136935
384600200529     C                     Z-ADD0         ASTRDU 150                      136935
384700200529     C                     EXSR RECNSE
384800200529     C                     EXSR SRSAVE
384900200529     C           AMASAL    IFEQ 'Y'
385000200529     C                     MOVE SASAL     SHASAL
385100200529     C                     Z-ADDWWASAL    SHASTA
385200200529     C                     ENDIF
385300200529     C           AMACRO    IFEQ 'Y'
385400200529     C                     MOVE SACRO     SHACRO
385500200529     C                     Z-ADDWWACRO    SHACAR
385600200529     C                     ENDIF
385700200529     C           AMASTR    IFEQ 'Y'
385800200529     C                     Z-ADDWWASTR    SHASTR
385900200529     C                     ENDIF
386000200529     C********** SHCNUM    IFNE *ZEROS                                                        CSD027
386100200529     C           SHCNUM    IFNE *BLANKS                                                       CSD027
386200200529     C                     MOVE STATUS,4  SREST
386300200529     C                     ELSE
386400200529     C                     MOVE *BLANKS   SREST
386500200529     C                     ENDIF
386600200529     C                     ENDIF
386700200529     C                     ENDIF
386800200529     C                     ENDIF
386900200529      *
387000200529      ***  For Cash screen.
387100200529      *
387200200529     C                     ELSE
387300200529      *
387400200529      *
387500200529      ***  If Actual Cash Allocation has changed.
387600200529      *
387700200529     C           SACAL     IFNE SHACAL
387800200529     C           PPROC     IFEQ 'CR'
387900200529     C                     MOVE NMDPC1    ZSDEC            Event Currency Decimal Places
388000200529     C                     ELSE
388100200529     C                     MOVE NMDPC2    ZSDEC            New Currency Decimal Places
388200200529     C                     ENDIF
388300200529     C           15        SUB  ZSDEC     ZSDIG
388400200529     C                     MOVE SACAL     ZFLD17
388500200529     C                     EXSR ZASIGN
388600200529      *
388700200529      ***  Field must be numeric.
388800200529      *
388900200529     C           *IN99     IFEQ '1'
389000200529     C                     MOVEL'CO00266' ZAMSID
389100200529     C                     EXSR ZASNMS
389200200529     C                     MOVE '1'       *IN57
389300200529     C                     MOVE 'Y'       ERMSG
389400200529     C                     ELSE
389500200529     C                     MOVE ZOUT15    WWACAL 150
389600200529     C           ZFSIGN    IFEQ '-'
389700200529     C                     MULT -1        WWACAL
389800200529     C                     ENDIF
389900200529     C                     Z-ADDWWACAL    SHACAA
390000200529     C                     ENDIF
390100200529     C                     ENDIF
390200200529      *
390300200529      ***  If Actual Cash Rounding has changed.
390400200529      *
390500200529     C           SACRO     IFNE SHACRO
390600200529     C           PPROC     IFEQ 'CR'
390700200529     C                     MOVE NMDPC1    ZSDEC            Event Currency Decimal Places
390800200529     C                     ELSE
390900200529     C                     MOVE NMDPC2    ZSDEC            New Currency Decimal Places
391000200529     C                     ENDIF
391100200529     C           15        SUB  ZSDEC     ZSDIG
391200200529     C                     MOVE SACRO     ZFLD17
391300200529     C                     EXSR ZASIGN
391400200529      *
391500200529      ***  Field must be numeric.
391600200529      *
391700200529     C           *IN99     IFEQ '1'
391800200529     C                     MOVEL'CO00265' ZAMSID
391900200529     C                     EXSR ZASNMS
392000200529     C                     MOVE '1'       *IN58
392100200529     C                     MOVE 'Y'       ERMSG
392200200529     C                     ELSE
392300200529     C                     MOVE ZOUT15    WWACRO 150
392400200529     C           ZFSIGN    IFEQ '-'
392500200529     C                     MULT -1        WWACRO
392600200529     C                     ENDIF
392700200529     C                     Z-ADDWWACRO    SHACAR
392800200529     C                     ENDIF
392900200529     C                     ENDIF
393000200529      *
393100200529      ***  If input/output fields are changed and no error occured.
393200200529      *
393300200529     C           ERMSG     IFEQ 'N'
393400200529     C           SACAL     IFNE SHACAL
393500200529     C           SACRO     ORNE SHACRO
393600200529     C           SACAL     IFNE SHACAL
393700200529     C                     MOVE *BLANKS   SACAL
393800200529     C           WWACAL    IFNE 0
393900200529     C                     MOVE *BLANKS   ZFLD15
394000200529     C                     MOVE WWACAL    ZFLD15
394100200529     C           PPROC     IFEQ 'CR'
394200200529     C                     Z-ADDNMDPC1    ZDECS            Event Currency Decimal Places
394300200529     C                     ELSE
394400200529     C                     Z-ADDNMDPC2    ZDECS            New Currency Decimal Places
394500200529     C                     ENDIF
394600200529     C                     EXSR ZSEDIT
394700200529     C                     MOVE ZOUT21    SACAL
394800200529     C                     ENDIF
394900200529     C                     ENDIF
395000200529     C           SACRO     IFNE SHACRO
395100200529     C                     MOVE *BLANKS   SACRO
395200200529     C           WWACRO    IFNE 0
395300200529     C                     MOVE *BLANKS   ZFLD15
395400200529     C                     MOVE WWACRO    ZFLD15
395500200529     C           PPROC     IFEQ 'CR'
395600200529     C                     Z-ADDNMDPC1    ZDECS            Event Currency Decimal Places
395700200529     C                     ELSE
395800200529     C                     Z-ADDNMDPC2    ZDECS            New Currency Decimal Places
395900200529     C                     ENDIF
396000200529     C                     EXSR ZSEDIT
396100200529     C                     MOVE ZOUT21    SACRO
396200200529     C                     ENDIF
396300200529     C                     ENDIF
396400200529      *
396500200529      ***  Recalculate fields due amendments and update current record.
396600200529      *
396700200529     C                     MOVE 'N'       MDUMMY                          136935
396800200529     C                     Z-ADD0         ACAADU                          136935
396900200529     C                     Z-ADD0         ACARDU                          136935
397000200529     C                     Z-ADD0         ASTADU                          136935
397100200529     C                     Z-ADD0         ASTRDU                          136935
397200200529     C                     EXSR RECCAS
397300200529     C                     EXSR SRSAVE
397400200529     C                     Z-ADDSHACAA    HSACAA
397500200529     C                     MOVE SACAL     SHACAL
397600200529     C                     Z-ADDSHACAR    HSACAR
397700200529     C                     MOVE SACRO     SHACRO
397800200529     C********** SHCNUM    IFNE *ZEROS                                                        CSD027
397900200529     C           SHCNUM    IFNE *BLANKS                                                       CSD027
398000200529     C                     MOVE STATUS,4  SREST
398100200529     C                     ELSE
398200200529     C                     MOVE *BLANKS   SREST
398300200529     C                     ENDIF
398400200529     C                     ENDIF
398500200529     C                     ENDIF
398600200529     C                     ENDIF
398700200529      *
398800200529     C                     ENDSR
398900200529      *
399000200529      *****************************************************************
399100200529      /EJECT
399200200529      *****************************************************************
399300200529      *                                                               *
399400200529      *  RECCAS - Recalculate fields due Actual Cash Allocation or    *
399500200529      *           Actual Cash Rounding changed from 'CASH' screen.    *
399600200529      *                                                               *
399700200529      *  Called by:                                                   *
399800200529      *                                                               *
399900200529      *  Calls:                                                       *
400000200529      *                                                               *
400100200529      *****************************************************************
400200200529      *
400300200529     C           RECCAS    BEGSR                           ** RECCAS SR **
400400200529      *
400500200529     C                     MOVE 'N'       ACCDPF  1
400600200529     C                     Z-ADD0         DUACAA                          136935
400700200529     C                     Z-ADD0         DUACAR                          136935
400800200529     C                     Z-ADD0         DUASTA                          136935
400900200529     C                     Z-ADD0         DUASTR                          136935
401000200529      *
401100200529      ***  If Actual Cash Rounding has changed.
401200200529      *
401300200529     C           SACRO     IFNE SHACRO
401400200529      *
401500200529      ***  Access Depot file with CO Reference, Option Number, Branch,
401600200529      ***  Depot and New Security = '**CASH**'.
401700200529      *
401800200529     C                     MOVE PCORF     WKCORF
401900200529     C                     MOVE POPTN     WKOPTN
402000200529     C                     MOVE PBRCD     WKBRCD
402100200529     C**********           Z-ADDPDEPO     WKDEPO                                              CSD027
402200200529     C                     MOVE PDEPO     WKDEPO                                              CSD027
402300200529     C                     MOVE *BLANKS   WKSESN
402400200529     C                     MOVEL'**CASH**'WKSESN
402500200529     C           WKEY1     CHAINSECODPL3             16
402600200529      *
402700200529      ***  If record not found, handle Database error.
402800200529      *
402900200529     C           *IN16     IFEQ '1'
403000200529     C           *LOCK     IN   LDA
403100200529     C                     MOVEL'SECODPL3'DBFILE
403200200529     C                     MOVE WKOPTN    WWOPTN
403300200529     C                     MOVE WKDEPO    WWDEPO
403400200529     C           WKCORF    CAT  WWOPTN:0  DBKEY1  8
403500200529     C           WKBRCD    CAT  WWDEPO:0  DBKEY2  9
403600200529     C           DBKEY1    CAT  DBKEY2:0  DBKEY3 17
403700200529     C           DBKEY3    CAT  WKSESN:0  DBKEY4 27
403800200529     C                     MOVELDBKEY4    DBKEY            ***************
403900200529     C                     Z-ADD018       DBASE            * DB ERROR 18 *
404000200529     C                     MOVEL'SE7513'  DBPGM            ***************
404100200529     C                     OUT  LDA
404200200529     C                     EXSR *PSSR
404300200529     C                     ENDIF
404400200529     C                     MOVE 'Y'       ACCDPF
404500200529     C                     Z-ADDMBBCAA    SVBCAA                          136935
404600200529      *
404700200529      ***  Recalculate Balancing Cash Allocation by subtracting old value and adding new value
404800200529      ***  of Actual Cash Rounding.
404900200529      *
405000200529     C                     SUB  HSACAR    MBBCAA
405100200529     C                     ADD  SHACAR    MBBCAA
405200200529      *                                                                   136935
405300200529      ***  If Balancing Difference recalculated not 0 and Processing Type 136935
405400200529      ***  = Currency Change or not Currency Change with ICD field 'Allo- 136935
405500200529      ***  cate Difference to Dummy' = 'Y', save Balancing Difference and 136935
405600200529      ***  reset it.                                                      136935
405700200529      *                                                                   136935
405800200529     C           MBBCAA    IFNE 0                                         136935
405900200529     C           PPROC     ANDEQ'CC'                                      136935
406000200529     C           MBBCAA    ORNE 0                                         136935
406100200529     C           PPROC     ANDNE'CC'                                      136935
406200200529     C           BVALDC    ANDEQ'Y'                                       136935
406300200529     C                     Z-SUBMBBCAA    DUACAR                          136935
406400200529     C                     Z-ADD0         MBBCAA                          136935
406500200529     C                     ENDIF                                          136935
406600200529      *
406700200529      ***  Output new value for Balancing Cash Allocation on top line
406800200529      ***  of screen.
406900200529      *
407000200529     C                     MOVE *BLANKS   ZFLD15
407100200529     C                     MOVE MBBCAA    ZFLD15
407200200529     C           PPROC     IFEQ 'CR'
407300200529     C                     MOVE NMDPC1    ZDECS            Event Currency Decimal Places
407400200529     C                     ELSE
407500200529     C                     MOVE NMDPC2    ZDECS            New Currency Decimal Places
407600200529     C                     ENDIF
407700200529     C                     EXSR ZSEDIT
407800200529     C                     MOVE *BLANKS   SCASH
407900200529     C                     MOVE ZOUT21    SCASH
408000200529      *
408100200529     C                     ENDIF
408200200529      *
408300200529      ***  If Actual Cash Allocation has changed.
408400200529      *
408500200529     C           SACAL     IFNE SHACAL
408600200529      *
408700200529      ***  Access Depot file with CO Reference, Option Number, Branch,
408800200529      ***  Depot and New Security = '**CASH**'.
408900200529      *
409000200529     C           ACCDPF    IFEQ 'N'
409100200529     C                     MOVE PCORF     WKCORF
409200200529     C                     MOVE POPTN     WKOPTN
409300200529     C                     MOVE PBRCD     WKBRCD
409400200529     C**********           Z-ADDPDEPO     WKDEPO                                              CSD027
409500200529     C                     MOVE PDEPO     WKDEPO                                              CSD027
409600200529     C                     MOVE *BLANKS   WKSESN
409700200529     C                     MOVEL'**CASH**'WKSESN
409800200529     C           WKEY1     CHAINSECODPL3             16
409900200529      *
410000200529      ***  If record not found, handle Database error.
410100200529      *
410200200529     C           *IN16     IFEQ '1'
410300200529     C           *LOCK     IN   LDA
410400200529     C                     MOVEL'SECODPL3'DBFILE
410500200529     C                     MOVE WKOPTN    WWOPTN
410600200529     C                     MOVE WKDEPO    WWDEPO
410700200529     C           WKCORF    CAT  WWOPTN:0  DBKEY1  8
410800200529     C           WKBRCD    CAT  WWDEPO:0  DBKEY2  9
410900200529     C           DBKEY1    CAT  DBKEY2:0  DBKEY3 17
411000200529     C           DBKEY3    CAT  WKSESN:0  DBKEY4 27
411100200529     C                     MOVELDBKEY4    DBKEY            ***************
411200200529     C                     Z-ADD019       DBASE            * DB ERROR 19 *
411300200529     C                     MOVEL'SE7513'  DBPGM            ***************
411400200529     C                     OUT  LDA
411500200529     C                     EXSR *PSSR
411600200529     C                     ENDIF
411700200529     C                     MOVE 'Y'       ACCDPF
411800200529     C                     Z-ADDMBBCAA    SVBCAA                          136935
411900200529     C                     ENDIF
412000200529      *
412100200529      ***  Recalculate Balancing Cash Allocation by subtracting old value and adding new value
412200200529      ***  of Actual Cash Allocation.
412300200529      *
412400200529     C                     SUB  HSACAA    MBBCAA
412500200529     C                     ADD  SHACAA    MBBCAA
412600200529      *                                                                   136935
412700200529      ***  If Balancing Difference recalculated not 0 and Processing Type 136935
412800200529      ***  = Currency Change or not Currency Change with ICD field 'Allo- 136935
412900200529      ***  cate Difference to Dummy' = 'Y', save Balancing Difference and 136935
413000200529      ***  reset it.                                                      136935
413100200529      *                                                                   136935
413200200529     C           MBBCAA    IFNE 0                                         136935
413300200529     C           PPROC     ANDEQ'CC'                                      136935
413400200529     C           MBBCAA    ORNE 0                                         136935
413500200529     C           PPROC     ANDNE'CC'                                      136935
413600200529     C           BVALDC    ANDEQ'Y'                                       136935
413700200529     C                     Z-SUBMBBCAA    DUACAA                          136935
413800200529     C                     Z-ADD0         MBBCAA                          136935
413900200529     C                     ENDIF                                          136935
414000200529      *
414100200529      ***  Output new value for Balancing Cash Allocation on top line
414200200529      ***  of screen.
414300200529      *
414400200529     C                     MOVE *BLANKS   ZFLD15
414500200529     C                     MOVE MBBCAA    ZFLD15
414600200529     C           PPROC     IFEQ 'CR'
414700200529     C                     MOVE NMDPC1    ZDECS            Event Currency Decimal Places
414800200529     C                     ELSE
414900200529     C                     MOVE NMDPC2    ZDECS            New Currency Decimal Places
415000200529     C                     ENDIF
415100200529     C                     EXSR ZSEDIT
415200200529     C                     MOVE *BLANKS   SCASH
415300200529     C                     MOVE ZOUT21    SCASH
415400200529      *
415500200529     C                     ENDIF
415600200529      *
415700200529      ***  If process for Customer (Customer/Book Indicator = 'C'),
415800200529      ***  and if Processing Type not Currency Changes,                   CEU017
415900200529      ***  Recalculate Total Fees.
416000200529      *
416100200529     C           SHCOTP    IFEQ 'C'
416200200529     C           PPROC     ANDNE'CC'                                      CEU017
416300200529     C           PPROC     IFEQ 'CR'
416400200529     C                     Z-ADDNMDPC1    WWNBDP           Event Currency Decimal Places
416500200529     C                     ELSE
416600200529     C                     Z-ADDNMDPC2    WWNBDP           New Currency Decimal Places
416700200529     C                     ENDIF
416800200529     C                     Z-ADDSHACAA    WUNUM
416900200529     C                     EXSR RTVNDP
417000200529     C                     Z-ADDWWNUM     ZTCON
417100200529     C                     Z-ADDSHACAR    WUNUM
417200200529     C                     EXSR RTVNDP
417300200529     C                     ADD  WWNUM     ZTCON
417400200529     C                     EXSR RECFEE
417500200529     C                     Z-ADDWWTOTF    WWNUM
417600200529     C                     EXSR SETNDP
417700200529     C                     Z-ADDWUNUM     SHTOTF
417800200529     C                     MOVE *BLANKS   STFEE
417900200529     C           SHTOTF    IFNE 0
418000200529     C                     MOVE *BLANKS   ZFLD15
418100200529     C                     MOVE SHTOTF    ZFLD15
418200200529     C           PPROC     IFEQ 'CR'
418300200529     C                     Z-ADDNMDPC1    ZDECS            Event Currency Decimal Places
418400200529     C                     ELSE
418500200529     C                     Z-ADDNMDPC2    ZDECS            New Currency Decimal Places
418600200529     C                     ENDIF
418700200529     C                     EXSR ZSEDIT
418800200529     C                     MOVE ZOUT21    STFEE
418900200529     C                     ENDIF
419000200529     C                     ENDIF
419100200529      *
419200200529      ***  If Processing Type = Dividend Events and feature Withholding Tax is ON, recalculate
419300200529      ***  Total Taxes, otherwise, set Total Taxes to 0.
419400200529      *
419500200529     C           PPROC     IFEQ 'DV'
419600200529     C           MDSDIT    ANDEQ'R'                                       136935
419700200529     C           S01447    ANDEQ'Y'
419800200529     C           PPROC     IFEQ 'CR'
419900200529     C                     Z-ADDNMDPC1    WWNBDP           Event Currency Decimal Places
420000200529     C                     ELSE
420100200529     C                     Z-ADDNMDPC2    WWNBDP           New Currency Decimal Places
420200200529     C                     ENDIF
420300200529     C                     Z-ADDSHACAA    WUNUM
420400200529     C                     EXSR RTVNDP
420500200529     C                     Z-ADDWWNUM     WWAMTT 309
420600200529     C                     Z-ADDSHACAR    WUNUM
420700200529     C                     EXSR RTVNDP
420800200529     C                     ADD  WWNUM     WWAMTT
420900200529     C                     EXSR RECTAX
421000200529     C                     Z-ADDTOTTAX    WWNUM
421100200529     C                     EXSR SETNDP
421200200529     C                     Z-ADDWUNUM     SHTOTT
421300200529     C                     MOVE *BLANKS   STOTT
421400200529     C           SHTOTT    IFNE 0
421500200529     C                     MOVE *BLANKS   ZFLD15
421600200529     C                     MOVE SHTOTT    ZFLD15
421700200529     C           PPROC     IFEQ 'CR'
421800200529     C                     Z-ADDNMDPC1    ZDECS            Event Currency Decimal Places
421900200529     C                     ELSE
422000200529     C                     Z-ADDNMDPC2    ZDECS            New Currency Decimal Places
422100200529     C                     ENDIF
422200200529     C                     EXSR ZSEDIT
422300200529     C                     MOVE ZOUT21    STOTT
422400200529     C                     ENDIF
422500200529     C                     ELSE
422600200529     C                     Z-ADD0         SHTOTT
422700200529     C                     MOVE *BLANKS   STOTT
422800200529     C                     ENDIF
422900200529      *
423000200529      *****Recalculate*Total*Settlement*=******************************** 161641
423100200529      *****Actual*Cash*Allocation*&*Rounding*+/-*Total Fees*+/-*Total**** 161641
423200200529      *****Taxes*(+*if*Ex-Date*Position*>*or*=*0,*else*-).*************** 161641
423300200529      ***  Total Settlement = Actual Cash Allocation & Rounding   - Total 161641
423400200529      ***  Fees +/- Total Taxes (- if Ex-Date Position is > or = 0,       161641
423500200529      ***  else +).                                                       161641
423600200529      *
423700200529     C           SHACAA    ADD  SHACAR    WWTSET
423800200529     C           SHTDVD    IFGE 0
423900200529     C***********          ADD  SHTOTF    WWTSET                          161641
424000200529     C***********          ADD  SHTOTT    WWTSET                          161641
424100200529     C                     SUB  SHTOTF    WWTSET                          161641
424200200529     C                     SUB  SHTOTT    WWTSET                          161641
424300200529     C                     ELSE
424400200529     C                     SUB  SHTOTF    WWTSET
424500200529     C***********          SUB  SHTOTT    WWTSET                          161641
424600200529     C                     ADD  SHTOTT    WWTSET                          161641
424700200529     C                     ENDIF
424800200529     C                     MOVE *BLANKS   STSET
424900200529     C           WWTSET    IFNE 0
425000200529     C                     MOVE *BLANKS   ZFLD15
425100200529     C                     MOVE WWTSET    ZFLD15
425200200529     C           PPROC     IFEQ 'CR'
425300200529     C                     Z-ADDNMDPC1    ZDECS            Event Currency Decimal Places
425400200529     C                     ELSE
425500200529     C                     Z-ADDNMDPC2    ZDECS            New Currency Decimal Places
425600200529     C                     ENDIF
425700200529     C                     EXSR ZSEDIT
425800200529     C                     MOVE ZOUT21    STSET
425900200529     C                     ENDIF
426000200529      *
426100200529      ***  Update record on Depot File for CO Reference, Option Number,
426200200529      ***  Branch, Depot and New Security = '**CASH**'.
426300200529      *
426400200529     C           SVBCAA    IFNE MBBCAA                                    136935
426500200529     C                     MOVE 'A'       MBCHTP
426600200529     C                     MOVE SUSER     MBLUID
426700200529     C                     Z-ADDBJRDNB    MBLCD
426800200529     C                     ENDIF                                          136935
426900200529     C                     UPDATSECODPD0
427000200529      *                                                                   136935
427100200529      ***  If Balancing Difference has been allocated to Dummy Customer,  136935
427200200529      ***  update record from SECOALL7 for Security '**CASH**' and Dummy  136935
427300200529      ***  Customer                                                       136935
427400200529      *                                                                   136935
427500200529     C           DUACAA    IFNE 0                                         136935
427600200529     C           DUACAR    ORNE 0                                         136935
427700200529     C           SHCNUM    IFNE WDUMMY                                    136935
427800200529     C                     MOVE 'C'       WKCOTP                          136935
427900200529     C                     MOVE *BLANKS   WKBOOK                          136935
428000200529     C                     MOVE WDUMMY    WKCNUM                          136935
428100200529     C                     MOVE *BLANKS   WKPTFR                          136935
428300200529     C           WKEY4     CHAINSECOALL7             16                   136935
428400200529      *                                                                   136935
428500200529      ***  If record no longer on file, handle Database Error.            136935
428600200529      *                                                                   136935
428700200529     C           *IN16     IFEQ '1'                                       136935
428800200529     C           *LOCK     IN   LDA                                       136935
428900200529     C                     Z-ADD035       DBASE            ***************136935
429000200529     C                     MOVE 'SECOALL7'DBFILE           * DB ERROR 35 *136935
429100200529     C                     MOVELWKCORF    DBKEY1           ***************136935
429200200529     C                     MOVE WKOPTN    DBKEY1                          136935
429300200529     C                     MOVELWKBRCD    DBKEY2                          136935
429400200529     C                     MOVE WKDEPO    DBKEY2                          136935
429500200529     C                     MOVELDBKEY1    DBKEY3                          136935
429600200529     C                     MOVE DBKEY2    DBKEY3                          136935
429700200529     C                     MOVELDBKEY3    DBKEY4                          136935
429800200529     C                     MOVE WKSESN    DBKEY4                          136935
429900200529     C                     MOVELWKCOTP    DBKEY5                          136935
430000200529     C                     MOVE WKBOOK    DBKEY5                          136935
430100200529     C                     MOVELWKCNUM    DBKEY6                          136935
430200200529     C                     MOVE WKPTFR    DBKEY6                          136935
430300200529     C                     MOVELDBKEY5    DBKEY7                          136935
430400200529     C                     MOVE DBKEY6    DBKEY7                          136935
430500200529     C                     MOVELDBKEY4    DBKEY8                          136935
430600200529     C                     MOVE DBKEY7    DBKEY8                          136935
430700200529     C                     MOVELDBKEY8    DBKEY                           136935
430800200529     C                     MOVEL'SE7513'  DBPGM                           136935
430900200529     C                     OUT  LDA                                       136935
431000200529     C                     EXSR *PSSR                                     136935
431100200529     C                     ENDIF                                          136935
431200200529     C                     ADD  DUACAA    MCACAA                          136935
431300200529     C                     ADD  DUACAR    MCACAR                          136935
431400200529     C                     MOVE 'A'       MCCHTP                          136935
431500200529     C                     Z-ADDBJRDNB    MCLCD                           136935
431600200529     C                     MOVE SUSER     MCLUID                          136935
431700200529     C                     MOVE 'M'       MCREST                          136935
431800200529     C                     UPDATSECOALD0                                  136935
431900200529     C                     MOVE 'Y'       MDUMMY                          136935
432000200529     C                     MOVE 'Y'       DUMMYM                          136935
432100200529     C                     ELSE                                           136935
432200200529     C                     ADD  DUACAA    ACAADU                          136935
432300200529     C                     ADD  DUACAR    ACARDU                          136935
432400200529     C                     ENDIF                                          136935
432500200529     C                     ENDIF                                          136935
432600200529      *
432700200529     C                     ENDSR
432800200529      *
432900200529      *****************************************************************
433000200529      /EJECT
433100200529      *****************************************************************
433200200529      *                                                               *
433300200529      *  RECTAX - Recalculate Total Taxes.                            *
433400200529      *                                                               *
433500200529      *  Called by:                                                   *
433600200529      *                                                               *
433700200529      *  Calls:                                                       *
433800200529      *                                                               *
433900200529      *****************************************************************
434000200529      *
434100200529     C           RECTAX    BEGSR                           ** RECTAX SR **
434200200529      *
434300200529      ***  Initialise Total Tax.
434400200529      *
434500200529     C                     Z-ADD0         TOTTAX
434600200529      *
434700200529      ***  Access Security Withholding Tax details file to retrieve Tax for the Event Security.
434800200529      *
434900200529     C           SSESN     CHAINSESWHTL0             84
435000200529      *
435100200529      ***  If record found.
435200200529      *
435300200529     C           *IN84     IFEQ '0'
435400200529      *
435500200529      ***  Initialise work tax rate and amount fields.
435600200529      *
435700200529     C                     CLEARUTXRSR
435800200529     C                     CLEARUTXRRF
435900200529     C                     CLEARUTXRUS
436000200529     C                     CLEARUDLOR
436100200529      *
436200200529      ***  If Tax Band at source is zero, then take Rate from Security Withholding Tax file.
436300200529      *
436400200529     C           S1TABD    IFEQ *ZERO
436500200529     C                     Z-ADDS1RASO    UTXRSR  74
436600200529     C                     ELSE
436700200529      *
436800200529      ***  Otherwise access SE Country Tax Rate file to get Tax Rate at source.
436900200529      *
437000200529     C                     MOVELS1CTTA    UKEY    3
437100200529     C                     MOVE S1TABD    UKEY
437200200529     C                     CALL 'AOSCTXR0'
437300200529     C                     PARM *BLANKS   WRTCD
437400200529     C                     PARM '*KEY   ' WOPTN
437500200529     C                     PARM S1CTTA    WCTTA   2
437600200529     C                     PARM S1TABD    WTABD   10
437700200529     C           SECNTR    PARM SECNTR    DSSDY
437800200529      *
437900200529      ***  If record not found or not live, handle Database Error.
438000200529      *
438100200529     C           WRTCD     IFNE *BLANKS
438200200529     C           TXRECI    ORNE 'D'
438300200529     C           *LOCK     IN   LDA
438400200529     C                     Z-ADD020       DBASE            ***************
438500200529     C                     MOVEL'SECNTRL0'DBFILE           * DB ERROR 20 *
438600200529     C                     MOVELUKEY      DBKEY            ***************
438700200529     C                     MOVEL'SE7513'  DBPGM
438800200529     C                     OUT  LDA
438900200529     C                     EXSR *PSSR
439000200529     C                     ELSE
439100200529     C                     Z-ADDTXRASO    UTXRSR
439200200529     C                     ENDIF
439300200529     C                     ENDIF
439400200529      *
439500200529      ***  If Tax Band by User is not zero, then access Country to Branch Tax Rate file to get
439600200529      ***  Tax Rate by User, otherwise set to zero.
439700200529      *
439800200529     C           S1TABU    IFNE *ZERO
439900200529     C                     CALL 'AOCBTXR0'
440000200529     C                     PARM *BLANKS   WRTCD
440100200529     C                     PARM '*KEY   ' WOPTN
440200200529     C                     PARM PBRCD     WBRCA   3
440300200529     C                     PARM S1CTTA    WCTTA
440400200529     C                     PARM S1TABU    WTABU   10
440500200529     C           SECBTX    PARM SECBTX    DSFDY
440600200529     C           WRTCD     IFEQ *BLANKS
440700200529     C           TBRECI    ANDEQ'D'
440800200529     C                     Z-ADDTBRASR    UTXRRF  74
440900200529     C                     Z-ADDTBRAUS    UTXRUS  74
441000200529     C                     MOVE TBDLOR    UDLOR   1
441100200529     C                     ENDIF
441200200529     C                     ENDIF
441300200529      *
441400200529      ***  Calculate amount deducted at source.
441500200529      *
441600200529     C           UTXRSR    DIV  100       URATE   54
441700200529     C           WWAMTT    MULT URATE     TASO   130H
441800200529      *
441900200529      ***  Calculate amount deducted refundable.
442000200529      *
442100200529     C           UTXRRF    DIV  100       URATE
442200200529     C           WWAMTT    MULT URATE     TASR   130H
442300200529      *
442400200529      ***  Calculate amount deducted by user.
442500200529      *
442600200529     C                     CLEARTAUS
442700200529     C           UTXRUS    IFGT *ZERO
442800200529     C           UDLOR     IFEQ 'N'
442900200529     C                     MOVE SHCNUM    KCUST
443000200529     C           WKEY9     CHAINCLINT                84
443100200529     C           *IN84     IFEQ '1'
443200200529     C           RECI      OREQ '*'
443300200529     C           *LOCK     IN   LDA
443400200529     C                     Z-ADD021       DBASE            ***************
443500200529     C                     MOVEL'CLINTCB 'DBFILE           * DB ERROR 21 *
443600200529     C                     MOVELKCUST     DBKEYB  7        ***************
443700200529     C                     MOVE KRTYP     DBKEYB
443800200529     C                     MOVELDBKEYB    DBKEY
443900200529     C                     MOVEL'SE7513'  DBPGM
444000200529     C                     OUT  LDA
444100200529     C                     EXSR *PSSR
444200200529     C                     ENDIF
444300200529     C                     ENDIF
444400200529      *
444500200529     C           UDLOR     IFEQ 'Y'
444600200529     C           UDLOR     OREQ 'N'
444700200529     C           CLOC      ANDNEUBRLOC
444800200529     C           UTXRUS    DIV  100       URATE
444900200529     C           WWAMTT    MULT URATE     TAUS   130H
445000200529     C                     ENDIF
445100200529     C                     ENDIF
445200200529      *
445300200529      ***  Calculate Total Tax.
445400200529      *
445500200529     C           TAUS      ADD  TASO      TOTTAX 309
445600200529     C                     ENDIF
445700200529      *
445800200529     C                     ENDSR
445900200529      *
446000200529      *****************************************************************
446100200529      /EJECT
446200200529      *****************************************************************
446300200529      *                                                               *
446400200529      *  RECFEE - Recalculate Total Fees.                             *
446500200529      *                                                               *
446600200529      *  Called by:                                                   *
446700200529      *                                                               *
446800200529      *  Calls:                                                       *
446900200529      *                                                               *
447000200529      *****************************************************************
447100200529      *
447200200529     C           RECFEE    BEGSR                           ** RECFEE SR **
447300200529      *
447400200529      ***  Call Access Program for Security Customer Details to retrieve Customer Group.
447500200529      *
447600200529     C                     MOVE SHCNUM    WSCKY
447700200529     C                     CALL 'AOSECSR0'
447800200529     C                     PARM           WRTCD
447900200529     C                     PARM '*KEY   ' WOPTN
448000200529     C                     PARM           WSCKY   6
448100200529     C           SDSECS    PARM SDSECS    DSSDY
448200200529      *
448300200529      ***  Handle Database Error.
448400200529      *
448500200529     C           WRTCD     IFNE *BLANKS
448600200529     C           *LOCK     IN   LDA
448700200529     C                     Z-ADD022       DBASE            ***************
448800200529     C                     MOVEL'SDSECSPD'DBFILE           * DB ERROR 22 *
448900200529     C                     MOVELWSCKY     DBKEY            ***************
449000200529     C                     MOVEL'SE7513'  DBPGM
449100200529     C                     OUT  LDA
449200200529     C                     EXSR *PSSR
449300200529     C                     ENDIF
449400200529      *
449500200529     C           S01496    IFEQ 'Y'
449600200529     C           BVACOP    ANDEQ'Y'
449700200529      *
449800200529      ***  Retrieve the Commission and the Charge Code on the Corporate Actions Default Charges
449900200529      ***  file with Customer Group, Customer, Investment Type and Corporate Action Type.
450000200529      *
450100200529     C                     MOVE BFPSCG    KCUGR            Customer Group
450200200529     C**********           Z-ADDSHCNUM    KCDCN            Customer                           CSD027
450300200529     C                     MOVE SHCNUM    KCDCN            Customer                           CSD027
450400200529     C                     MOVE SITP1     KSITP            Investment Type
450500200529     C                     MOVE PACT      KCOAT            Corporate Action Type
450600200529     C           WKEY10    CHAINSECOCHL0             84
450700200529      *
450800200529      ***  If record not found, access with Customer Group, Customer and Investment Type and
450900200529      ***  Corporate Action Type = blank.
451000200529      *
451100200529     C           *IN84     IFEQ '1'
451200200529     C                     MOVE *BLANKS   KCOAT            Corporate Action Type
451300200529     C           WKEY10    CHAINSECOCHL0             84
451400200529      *
451500200529      ***  If record not found, access with Customer Group and Customer and Investment Type and
451600200529      ***  Corporate Action Type = blank.
451700200529      *
451800200529     C           *IN84     IFEQ '1'
451900200529     C                     MOVE *BLANKS   KSITP            Investment Type
452000200529     C           WKEY10    CHAINSECOCHL0             84
452100200529      *
452200200529      ***  If record not found, access with Customer Group and Customer = 0 and Investment Type and
452300200529      ***  Corporate Action Type = blank.
452400200529      *
452500200529     C           *IN84     IFEQ '1'
452600200529     C**********           Z-ADD0         KCDCN            Customer                           CSD027
452700200529     C                     MOVE *BLANKS   KCDCN            Customer                           CSD027
452800200529     C           WKEY10    CHAINSECOCHL0             84
452900200529     C                     ENDIF
453000200529     C                     ENDIF
453100200529     C                     ENDIF
453200200529      *
453300200529     C                     ELSE
453400200529      *
453500200529      ***  Retrieve the Commission and the Charge Code on the Corporate Actions Default Charges
453600200529      ***  file with Classification, Customer, Investment Type and Corporate Action Type.
453700200529      *
453800200529     C                     MOVE BFCLAS    KCLAS            Retrieve Classification
453900200529     C**********           Z-ADDSHCNUM    KCDCN            Customer                           CSD027
454000200529     C                     MOVE SHCNUM    KCDCN            Customer                           CSD027
454100200529     C                     MOVE SITP1     KSITP            Investment Type
454200200529     C                     MOVE PACT      KCOAT            Corporate Action Type
454300200529     C           WKEY11    CHAINSECOCHL1             84
454400200529      *
454500200529      ***  If record not found, access with Classification, Customer and Investment Type and
454600200529      ***  Corporate Action Type = blank.
454700200529      *
454800200529     C           *IN84     IFEQ '1'
454900200529     C                     MOVE *BLANKS   KCOAT            Corporate Action Type
455000200529     C           WKEY11    CHAINSECOCHL1             84
455100200529      *
455200200529      ***  If record not found, access with Classification and Customer and Investment type and
455300200529      ***  Corporate Action Type = blank.
455400200529      *
455500200529     C           *IN84     IFEQ '1'
455600200529     C                     MOVE *BLANKS   KSITP            Investment Type
455700200529     C           WKEY11    CHAINSECOCHL1             84
455800200529      *
455900200529      ***  If record not found, access with Classification and Customer = 0 and Investment Type and
456000200529      ***  Corporate Action Type = blank.
456100200529      *
456200200529     C           *IN84     IFEQ '1'
456300200529     C**********           Z-ADD0         KCDCN            Customer                           CSD027
456400200529     C                     MOVE *BLANKS   KCDCN            Customer                           CSD027
456500200529     C           WKEY11    CHAINSECOCHL1             84
456600200529     C                     ENDIF
456700200529     C                     ENDIF
456800200529     C                     ENDIF
456900200529     C                     ENDIF
457000200529      *
457100200529      ***  If record not found with one access, set Total Fees to 0.
457200200529      *
457300200529     C           *IN84     IFEQ '1'
457400200529     C                     Z-ADD0         WWTOTF 309       Total Fees
457500200529      *
457600200529      ***  If record found with one access.
457700200529      *
457800200529     C                     ELSE
457900200529      *
458000200529      ***  Retrieve Charge Basis Indicator on Charge Types file with Charge Code retrieve above
458100200529      ***  and Event Nominal Currency.
458200200529      *
458300200529     C                     MOVE MRCOCH    KCCOM   2
458400200529     C           WKEY12    CHAINSECGT                84
458500200529      *
458600200529      ***  If no live record found, set Total Fees to 0.
458700200529      *
458800200529     C           *IN84     IFEQ '1'
458900200529     C***********          Z-ADD0         WWTOTF                          179205
459000200529     C                     Z-ADD0         CHRAMT                          179205
459100200529      *
459200200529      ***  If live record found, Calculate Charge Amount.
459300200529      *
459400200529     C                     ELSE
459500200529     C                     Z-ADD0         ZTCON
459600200529     C                     Z-ADD0         ZNOML
459700200529      *
459800200529      ***  If Processing Type not Non Financial Event.
459900200529      *
460000200529     C           PACT      IFNE 'NF'
460100200529      *
460200200529      ***  If Charge Basis Indicator = 'C'.
460300200529      *
460400200529     C           CHGB      IFEQ 'C'
460500200529      *
460600200529      ***  Calculate Charge Amount.
460700200529      *
460800200529     C                     EXSR CALAM2
460900200529     C                     Z-ADDZCHGA     CHRAMT 309
461000200529     C                     ENDIF
461100200529     C                     ENDIF
461200200529     C                     ENDIF                                          179205
461300200529      *
461400200529     C                     Z-ADD0         ZTCON
461500200529     C                     Z-ADD0         ZNOML
461600200529      *
461700200529      ***  Retrieve Charge Basis Indicator on Charge Types file with Commission Code retrieve
461800200529      ***  above and Event Nominal Currency.
461900200529      *
462000200529     C                     MOVE MRCOCO    KCCOM
462100200529     C           WKEY12    CHAINSECGT                84
462200200529      *
462300200529      ***  If no live record found, set Total Fees to 0.
462400200529      *
462500200529     C           *IN84     IFEQ '1'
462600200529     C***********          Z-ADD0         WWTOTF                          179205
462700200529     C                     Z-ADD0         COMAMT                          179205
462800200529      *
462900200529      ***  If live record found, Calculate Commission Amount.
463000200529      *
463100200529     C                     ELSE
463200200529      *
463300200529      ***  If Processing Type not Non Financial Event.
463400200529      *
463500200529     C           PPROC     IFNE 'NF'
463600200529      *
463700200529      ***  If Charge Basis Indicator = 'C'.
463800200529      ***  Cash Rounding).
463900200529      *
464000200529     C           CHGB      IFEQ 'C'
464100200529      *
464200200529      ***  Calculate Commission Amount.
464300200529      *
464400200529     C                     EXSR CALAM2
464500200529     C                     Z-ADDZCHGA     COMAMT 309
464600200529     C                     ENDIF
464700200529     C                     ENDIF
464800200529     C                     ENDIF                                          179205
464900200529      *
465000200529      ***  Calculate Total Fees = Charge Amount + Commission Amount calculated above.
465100200529      *
465200200529     C           CHRAMT    ADD  COMAMT    WWTOTF
465300200529     C                     ENDIF
465400200529     C***********          ENDIF                                          179205
465500200529     C***********          ENDIF                                          179205
465600200529      *
465700200529     C                     ENDSR
465800200529      *
465900200529      *****************************************************************
466000200529      /EJECT
466100200529      *****************************************************************
466200200529      *                                                               *
466300200529      *  CALAM2 - Calculate Charge Amounts.                           *
466400200529      *                                                               *
466500200529      *  Called by:                                                   *
466600200529      *                                                               *
466700200529      *  Calls:                                                       *
466800200529      *                                                               *
466900200529      *****************************************************************
467000200529      *
467100200529     C           CALAM2    BEGSR                           ** CALAM2 SR **
467200200529      *
467300200529      ***  Charge Details.
467400200529      *
467500200529     C                     MOVE CHGB      ZCHGB
467600200529     C                     MOVE THRI      ZTHRI
467700200529     C                     Z-ADDMNCH      ZMNCH
467800200529     C                     Z-ADDMXCH      ZMXCH
467900200529      *
468000200529      ***  Set up array for Upper Range Limits.
468100200529      *
468200200529     C                     Z-ADDSTU1      ZRA,1
468300200529     C                     Z-ADDSTU2      ZRA,2
468400200529     C                     Z-ADDSTU3      ZRA,3
468500200529     C                     Z-ADDSTU4      ZRA,4
468600200529     C                     Z-ADDSTU5      ZRA,5
468700200529     C                     Z-ADDSTU6      ZRA,6
468800200529     C                     Z-ADDSTU7      ZRA,7
468900200529     C                     Z-ADDSTU8      ZRA,8
469000200529     C                     Z-ADDSTU9      ZRA,9
469100200529     C                     Z-ADDST10      ZRA,10
469200200529     C                     Z-ADDST11      ZRA,11
469300200529     C                     Z-ADDST12      ZRA,12
469400200529     C                     Z-ADDST13      ZRA,13
469500200529     C                     Z-ADDST14      ZRA,14
469600200529      *
469700200529      ***  Set up array for Percentage Levels.
469800200529      *
469900200529     C                     Z-ADDPL01      ZPC,1
470000200529     C                     Z-ADDPL02      ZPC,2
470100200529     C                     Z-ADDPL03      ZPC,3
470200200529     C                     Z-ADDPL04      ZPC,4
470300200529     C                     Z-ADDPL05      ZPC,5
470400200529     C                     Z-ADDPL06      ZPC,6
470500200529     C                     Z-ADDPL07      ZPC,7
470600200529     C                     Z-ADDPL08      ZPC,8
470700200529     C                     Z-ADDPL09      ZPC,9
470800200529     C                     Z-ADDPL10      ZPC,10
470900200529     C                     Z-ADDPL11      ZPC,11
471000200529     C                     Z-ADDPL12      ZPC,12
471100200529     C                     Z-ADDPL13      ZPC,13
471200200529     C                     Z-ADDPL14      ZPC,14
471300200529     C                     Z-ADDPL15      ZPC,15
471400200529      *
471500200529      ***  Set up array for Flat Charges.
471600200529      *
471700200529     C                     Z-ADDFC01      ZCG,1
471800200529     C                     Z-ADDFC02      ZCG,2
471900200529     C                     Z-ADDFC03      ZCG,3
472000200529     C                     Z-ADDFC04      ZCG,4
472100200529     C                     Z-ADDFC05      ZCG,5
472200200529     C                     Z-ADDFC06      ZCG,6
472300200529     C                     Z-ADDFC07      ZCG,7
472400200529     C                     Z-ADDFC08      ZCG,8
472500200529     C                     Z-ADDFC09      ZCG,9
472600200529     C                     Z-ADDFC10      ZCG,10
472700200529     C                     Z-ADDFC11      ZCG,11
472800200529     C                     Z-ADDFC12      ZCG,12
472900200529     C                     Z-ADDFC13      ZCG,13
473000200529     C                     Z-ADDFC14      ZCG,14
473100200529     C                     Z-ADDFC15      ZCG,15
473200200529      *
473300200529     C                     Z-ADDNMDP1     ZDECS
473400200529      *
473500200529      ***  Nominal Decimal Places.
473600200529      *
473700200529     C                     Z-ADD0         ZNMDP
473800200529      *
473900200529      ***  Security Details.
474000200529      *
474100200529     C                     Z-ADD1         ZPRICE
474200200529     C                     Z-ADD0         ZTCFC
474300200529     C                     MOVE 'P'       ZPROT
474400200529     C                     MOVE *BLANKS   ZSPBS
474500200529      *
474600200529     C           S01446    IFEQ 'Y'
474700200529      *
474800200529      ***  Purchase Interest.
474900200529      *
475000200529     C                     Z-ADD0         ZTPI
475100200529      *
475200200529     C                     MOVE *BLANKS   ZCCYI
475300200529     C                     MOVE *BLANKS   ZCCYO
475400200529     C                     MOVE *BLANKS   ZEXCH
475500200529     C                     MOVE *BLANKS   ZMD
475600200529      *
475700200529     C                     ENDIF
475800200529      *
475900200529      ***  Total Nominal.
476000200529      *
476100200529     C                     Z-ADD*ZEROS    ZTNOM  150
476200200529      *
476300200529     C                     EXSR ZCCAL1
476400200529      *
476500200529     C                     ENDSR
476600200529      *
476700200529      *****************************************************************
476800200529      /EJECT
476900200529      *****************************************************************
477000200529      *                                                               *
477100200529      *  RECNSE - Recalculate fields due Actual Stock Allocation or   *
477200200529      *           Actual Cash Rounding changed from normal screen.    *
477300200529      *                                                               *
477400200529      *  Called by:                                                   *
477500200529      *                                                               *
477600200529      *  Calls:                                                       *
477700200529      *                                                               *
477800200529      *****************************************************************
477900200529      *
478000200529     C           RECNSE    BEGSR                           ** RECNSE SR **
478100200529      *
478200200529      ***  Access File depending on CO Type.
478300200529      *
478400200529     C                     MOVE '0'       *IN16
478500200529     C                     MOVE *BLANKS   DBKEY9  2
478600200529     C           PPROC     IFEQ 'DV'
478700200529     C           WKEY14    CHAINSECODVL1             16
478800200529     C                     MOVEL'SECODVL1'WWFILE  8
478900200529     C                     ELSE
479000200529     C           PPROC     IFEQ 'CR'
479100200529     C           WKEY14    CHAINSECOCRL1             16
479200200529     C                     MOVEL'SECOCRL1'WWFILE
479300200529     C                     ELSE
479400200529     C           PPROC     IFEQ 'CE'
479500200529     C           WKEY14    CHAINSECOCEL1             16
479600200529     C                     MOVEL'SECOCEL1'WWFILE
479700200529     C                     ELSE
479800200529     C           PPROC     IFEQ 'OF'
479900200529     C           WKEY14    CHAINSECOOFL1             16
480000200529     C                     MOVEL'SECOOFL1'WWFILE
480100200529     C                     ELSE
480200200529     C           PPROC     IFEQ 'RG'
480300200529     C           WKEY14    CHAINSECORGL1             16
480400200529     C                     MOVEL'SECORGL1'WWFILE
480500200529     C                     ELSE
480600200529     C           PPROC     IFEQ 'EX'
480700200529     C           WKEY14    CHAINSECOEXL1             16
480800200529     C                     MOVEL'SECOEXL1'WWFILE
480900200529     C                     ELSE
481000200529     C           PPROC     IFEQ 'FR'
481100200529     C           WKEY14    CHAINSECOFRL1             16
481200200529     C                     MOVEL'SECOFRL1'WWFILE
481300200529     C                     ELSE
481400200529     C           PPROC     IFEQ 'CC'                                      CEU017
481500200529     C           PCORF     CHAINSECOCCL2             16                   CEU017
481600200529     C                     MOVEL'SECOCCL2'WWFILE                          CEU017
481700200529     C                     ELSE                                           CEU017
481800200529     C                     MOVE '1'       *IN16
481900200529     C                     MOVEL'SECOxxL1'WWFILE
482000200529     C                     MOVE PPROC     DBKEY9
482100200529     C                     ENDIF                                          CEU017
482200200529     C                     ENDIF
482300200529     C                     ENDIF
482400200529     C                     ENDIF
482500200529     C                     ENDIF
482600200529     C                     ENDIF
482700200529     C                     ENDIF
482800200529     C                     ENDIF
482900200529     C           *IN16     IFEQ '1'
483000200529     C           MDRECI    ORNE 'D'
483100200529     C           *LOCK     IN   LDA
483200200529     C                     MOVELWWFILE    DBFILE
483300200529     C           PCORF     CAT  POPNB:0   DBKEY1  8
483400200529     C           DBKEY9    CAT  DBKEY1:0  DBKEYA 10
483500200529     C                     MOVELDBKEY1    DBKEY            ***************
483600200529     C                     Z-ADD023       DBASE            * DB ERROR 23 *
483700200529     C                     MOVEL'SE7513'  DBPGM            ***************
483800200529     C                     OUT  LDA
483900200529     C                     EXSR *PSSR
484000200529     C                     ENDIF
484100200529      *
484200200529      ***  Prepare Rounding:
484300200529      ***  If Processing Type = 'CR': Corporate Reorganisation, retrieve position of array,
484400200529      ***  else retrieve from Corporate Actions Detail file.
484500200529      *
484600200529     C           PPROC     IFEQ 'CR'
484700200529     C                     MOVEAMHSECA    TSEC,1
484800200529     C                     Z-ADD1         I       20
484900200529     C           PNWSEC    LOKUPTSEC,I                   17
485000200529     C           *IN17     IFEQ '0'
485100200529     C                     MOVE ' '       WWRNDN  1
485200200529     C                     ELSE
485300200529     C                     MOVEAMHRNDN    TNDN,1
485400200529     C                     MOVE TNDN,I    WWRNDN
485500200529     C                     ENDIF
485600200529     C                     ELSE
485700200529     C                     MOVE MDRNDN    WWRNDN
485800200529     C                     ENDIF
485900200529      *
486000200529      ***  If Processing Type = Dividend Events and Subscription Price is entered as Market,
486100200529      ***  the Subscription Price must first be calculated from Current Market Price minus Discount.
486200200529      *
486300200529     C           PPROC     IFEQ 'DV'
486400200529     C           MDMRKI    ANDEQ'Y'
486500200529     C                     EXSR CSBPR
486600200529     C                     ENDIF
486700200529      *                                                                   136935
486800200529      ***  If Processing Type = Dividend Events with Stock Dividend Type  136935
486900200529      ***  = 'R', if Compensation Price entered, use Compensation Price   136935
487000200529      ***  instead of Subscription Price, otherwise, calculate Subscrip-  136935
487100200529      ***  tion Price = Subscription Price minus Discount Rate.           136935
487200200529      *                                                                   136935
487300200529     C           MAPTYP    IFEQ 'DV'                                      136935
487400200529     C           MDSDIT    ANDEQ'R'                                       136935
487500200529     C           MDCOMP    IFNE 0                                         136935
487600200529     C                     Z-ADDMDCOMP    MDSBPR                          136935
487700200529     C                     ELSE                                           136935
487800200529     C           MDMRKI    IFNE 'Y'                                       136935
487900200529     C           MDSBPR    MULT MDDSRT    WWSBPR                          136935
488000200529     C           WWSBPR    DIV  100       WWSBPR                          136935
488100200529     C                     SUB  WWSBPR    MDSBPR                          136935
488200200529     C                     ENDIF                                          136935
488300200529     C                     ENDIF                                          136935
488400200529     C                     ENDIF                                          136935
488500200529      *
488600200529      ***  If Actual Stock Allocation has changed.
488700200529      *
488800200529     C           SASAL     IFNE SHASAL
488900200529      *
489000200529      ***  Check if Actual Allocation fields can be recalculated.
489100200529      *
489200200529     C                     EXSR CHACAL
489300200529      *
489400200529      ***  Ptrepare Dividend Per Unit.
489500200529      *
489600200529     C           PPROC     IFEQ 'DV'                       If Dividend Events, from file
489700200529     C******               Z-ADDNMDP2     WWNBDP           New Sec.Dec.pl.135690
489800200529     C**********           Z-ADDNMDPC2    WWNBDP           New.Cur.135690 190204
489900200529     C**********           Z-ADDMDDIVU    WUNUM                           190204
490000200529     C**********           EXSR RTVNDP                                    190204
490100200529     C**********           Z-ADDWWNUM     WWDIVU 309                      190204
490200200529     C                     Z-ADDMDDIV1    WWDIVU 309       13,8 ==> 30,9  190204
490300200529     C                     ELSE
490400200529     C                     ENDIF
490500200529      *
490600200529      ***  If Actual Allocation fields can be recalculated,
490700200529      ***  recalculate Actual Stock Rounding.
490800200529      *
490900200529     C           SPWRKF    IFEQ 'Y'
491000200529     C                     EXSR REASTR
491100200529     C                     ELSE
491200200529     C                     MOVE *BLANKS   SASRO
491300200529     C                     Z-ADD0         WUASTR
491400200529     C                     Z-ADD0         WWASTR
491500200529     C                     Z-ADD0         MCASTR
491600200529     C                     ENDIF
491700200529      *
491800200529      ***  Recalculate Holding Taken as Stock.
491900200529      *
492000200529     C                     EXSR REHOST
492100200529      *
492200200529     C           PPROC     IFEQ 'DV'                       If Processing Type = Dividends Events
492300200529     C           MDSDIT    ANDEQ'R'                           Stk Dividend Tp=Reinvestment of Divid.
492400200529      *
492500200529     C           PPROC     OREQ 'EX'                       Or Processing Type = Dividends Events
492600200529     C           MJCPRC    ANDNE0                             Conversion Price not 0
492700200529     C           MJCEXR    ANDNE0                             Conversion Exchange Rate not 0
492800200529     C           MDSBPR    ANDNE0                             Subscription Price not 0
492900200529      *
493000200529      ***  Calculate Actual Cash Pool for Book/Customer.
493100200529      *
493200200529     C                     EXSR CACAPO
493300200529     C                     ENDIF
493400200529      *
493500200529      ***  If Actual Allocation fields can be recalculated, recalculate Actual Cash Rounding.
493600200529      *
493700200529     C           SPWRKF    IFEQ 'Y'
493800200529     C                     EXSR REACAR
493900200529     C                     ELSE
494000200529     C                     MOVE *BLANKS   SACRO
494100200529     C                     Z-ADD0         WWACRO
494200200529     C                     Z-ADD0         WUACAR 309
494300200529     C                     Z-ADD0         MCACAR
494400200529     C                     ENDIF
494500200529      *
494600200529      ***  Recalculate Holding Taken as Cash.
494700200529      *
494800200529     C           AMHOST    IFEQ 'Y'
494900200529     C                     EXSR REHOCA
495000200529     C                     ENDIF
495100200529      *
495200200529      ***  Access Allocation file with CO Reference, Option Number,
495300200529      ***  Branch, Depot, Security = '**CASH**', Cust/Book Ind.,
495400200529      ***  Book, Customer and Portfolio.
495500200529      *
495600200529     C                     MOVE PCORF     WKCORF
495700200529     C                     Z-ADDPOPTN     WKOPTN
495800200529     C                     MOVE PBRCD     WKBRCD
495900200529     C                     MOVE PDEPO     WKDEPO
496000200529     C                     MOVE *BLANKS   WKSESN
496100200529     C                     MOVEL'**CASH**'WKSESN
496200200529     C                     MOVE SHCOTP    WKCOTP
496300200529     C                     MOVE SHBOOK    WKBOOK
496400200529     C**********           Z-ADDSHCNUM    WKCNUM                                              CSD027
496500200529     C                     MOVE SHCNUM    WKCNUM                                              CSD027
496600200529     C                     MOVE SHPORT    WKPTFR
496700200529     C           WKEY4     CHAINSECOALL7             16
496800200529      *
496900200529      ***  If record not found, handle Database error.
497000200529      *
497100200529     C           *IN16     IFEQ '1'
497200200529     C           *LOCK     IN   LDA
497300200529     C                     MOVEL'SECOALL7'DBFILE
497400200529     C                     MOVE WKOPTN    WWOPTN
497500200529     C                     MOVE WKDEPO    WWDEPO
497600200529     C                     MOVE WKCNUM    WWCNUM  6
497700200529     C           WKCORF    CAT  WWOPTN:0  DBKEY1  8
497800200529     C           WKBRCD    CAT  WWDEPO:0  DBKEY2  9
497900200529     C           DBKEY1    CAT  DBKEY2:0  DBKEY3 17
498000200529     C           DBKEY3    CAT  WKSESN:0  DBKEY4 27
498100200529     C           WKCOTP    CAT  WKBOOK:0  DBKEY5  3
498200200529     C           WWCNUM    CAT  WKPORT:0  DBKEY6 10
498300200529     C           DBKEY5    CAT  DBKEY6:0  DBKEY7 13
498400200529     C           DBKEY4    CAT  DBKEY7:0  DBKEY8 40
498500200529     C                     MOVELDBKEY8    DBKEY            ***************
498600200529     C                     Z-ADD024       DBASE            * DB ERROR 24 *
498700200529     C                     MOVEL'SE7513'  DBPGM            ***************
498800200529     C                     OUT  LDA
498900200529     C                     EXSR *PSSR
499000200529     C                     ENDIF
499100200529      *
499200200529     C                     Z-ADDMCHOST    SVHOST 150
499300200529     C                     Z-ADDMCACAR    SVACAR 150
499400200529     C                     Z-ADDMCHOCA    SVHOCA 150
499500200529     C                     Z-ADDMCHOCA    WWHOCA                    161591
499600200529     C                     Z-ADDMCACAA    SVACAA 150
499700200529     C                     Z-ADDMCTOTF    SVTOTF 150
499800200529     C                     Z-ADDMCTOTT    SVTOTT 150
499900200529      *
500000200529      ***  Move Holding Taken as Cash re-calculated into file field.
500100200529      *
500200200529     C           AMHOCA    IFEQ 'Y'
500300200529     C           PPROC     IFEQ 'CR'
500400200529     C                     Z-ADDWWHOCA    WUNUM
500500200529     C                     Z-ADDNMDPC2    WWNBDP           New Currency Decimal Places
500600200529     C                     EXSR RTVNDP
500700200529     C                     Z-ADDNMDPC1    WWNBDP           Event Currency Decimal Places
500800200529     C                     MOVE 'R'       WUROOP           Rounding = half adjust
500900200529     C                     EXSR ROUNDD
501000200529     C                     EXSR SETNDP
501100200529     C                     Z-ADDWUNUM     MCHOCA
501200200529     C                     ELSE
501300200529     C                     Z-ADDWWHOCA    MCHOCA
501400200529     C                     ENDIF
501500200529     C                     ENDIF
501600200529      *
501700200529      ***  Move Holding Taken as Stock re-calculated into file field.
501800200529      *
501900200529     C           AMHOST    IFEQ 'Y'
502000200529     C                     Z-ADDWWHOST    MCHOST
502100200529     C                     ENDIF
502200200529      *
502300200529      ***  Recalculate Actual Cash Rounding by substract old value
502400200529      ***  and add new value of Actual Cash Rounding.
502500200529      *
502600200529     C           AMACAR    IFEQ 'Y'
502700200529     C                     SUB  SHACAR    MCACAR
502800200529     C           PPROC     IFEQ 'CR'
502900200529     C                     Z-ADDWWACRO    WUNUM
503000200529     C                     Z-ADDNMDPC2    WWNBDP           New Currency Decimal Places
503100200529     C                     EXSR RTVNDP
503200200529     C                     Z-ADDNMDPC1    WWNBDP           Event Currency Decimal Places
503300200529     C                     MOVE 'R'       WUROOP           Rounding = half adjust
503400200529     C                     EXSR ROUNDD
503500200529     C                     EXSR SETNDP
503600200529     C                     ADD  WUNUM     MCACAR
503700200529     C                     ELSE
503800200529     C                     ADD  WWACRO    MCACAR
503900200529     C                     ENDIF
504000200529     C                     ENDIF
504100200529      *
504200200529      ***  Re-calculate Actual Cash Allocation.
504300200529      *
504400200529     C                     Z-ADDMCACAA    SHACAA 150
504500200529     C                     EXSR REACAA
504600200529     C                     Z-ADDMCACAA    WWACAA 150
504700200529      *
504800200529      ***  If process for Customer (Customer/Book Indicator = 'C'),
504900200529      ***  and if Processing Type not Currency Changes,                   CEU017
505000200529      ***  Recalculate Total Fees.
505100200529      *
505200200529     C           MCCOTP    IFEQ 'C'
505300200529     C           PPROC     ANDNE'CC'                                      CEU017
505400200529     C           AMACAA    ANDEQ'Y'
505500200529     C           MCCOTP    OREQ 'C'
505600200529     C           PPROC     ANDNE'CC'                                      CEU017
505700200529     C           AMACAR    ANDEQ'Y'
505800200529     C           PPROC     IFEQ 'CR'
505900200529     C                     Z-ADDNMDPC1    WWNBDP           Event Currency Decimal Places
506000200529     C                     ELSE
506100200529     C                     Z-ADDNMDPC2    WWNBDP           New Currency Decimal Places
506200200529     C                     ENDIF
506300200529     C                     Z-ADDMCACAA    WUNUM
506400200529     C                     EXSR RTVNDP
506500200529     C                     Z-ADDWWNUM     ZTCON
506600200529     C                     Z-ADDMCACAR    WUNUM
506700200529     C                     EXSR RTVNDP
506800200529     C                     ADD  WWNUM     ZTCON
506900200529     C                     EXSR RECFEE
507000200529     C                     Z-ADDWWTOTF    WWNUM
507100200529      * No need to multiply the result, only to edit correctly on screen. 179205
507200200529     C***********          EXSR SETNDP                                    179205
507300200529     C                     Z-ADDWWNUM     WUNUM                           179205
507400200529     C                     Z-ADDWUNUM     MCTOTF
507500200529     C                     ENDIF
507600200529      *
507700200529      ***  If Processing Type = Dividend Events and feature Withholding Tax is ON, recalculate
507800200529      ***  Total Taxes, otherwise, set Total Taxes to 0.
507900200529      *
508000200529     C           PPROC     IFEQ 'DV'
508100200529     C           MDSDIT    ANDEQ'R'                                       136935
508200200529     C           S01447    IFEQ 'Y'
508300200529     C           AMACAA    IFEQ 'Y'
508400200529     C           AMACAR    OREQ 'Y'
508500200529     C           PPROC     IFEQ 'CR'
508600200529     C                     Z-ADDNMDPC1    WWNBDP           Event Currency Decimal Places
508700200529     C                     ELSE
508800200529     C                     Z-ADDNMDPC2    WWNBDP           New Currency Decimal Places
508900200529     C                     ENDIF
509000200529     C                     Z-ADDMCACAA    WUNUM
509100200529     C                     EXSR RTVNDP
509200200529     C                     Z-ADDWWNUM     WWAMTT 309
509300200529     C                     Z-ADDMCACAR    WUNUM
509400200529     C                     EXSR RTVNDP
509500200529     C                     ADD  WWNUM     WWAMTT
509600200529     C                     EXSR RECTAX
509700200529     C                     Z-ADDTOTTAX    WWNUM
509800200529     C                     EXSR SETNDP
509900200529     C                     Z-ADDWUNUM     MCTOTT
510000200529     C                     ENDIF
510100200529     C                     ELSE
510200200529     C                     Z-ADD0         MCTOTT
510300200529     C                     ENDIF
510400200529     C                     ENDIF
510500200529      *
510600200529     C           SVHOST    IFNE MCHOST
510700200529     C           SVACAR    ORNE MCACAR                                    136935
510800200529     C           SVHOCA    ORNE MCHOCA                                    136935
510900200529     C           SVACAA    ORNE MCACAA                                    136935
511000200529     C           SVTOTF    ORNE MCTOTF                                    136935
511100200529     C           SVTOTT    ORNE MCTOTT                                    136935
511200200529     C******     SVACAR    ANDNEMCACAR                                    136935
511300200529     C******     SVHOCA    ANDNEMCHOCA                                    136935
511400200529     C******     SVACAA    ANDNEMCACAA                                    136935
511500200529     C******     SVTOTF    ANDNEMCTOTF                                    136935
511600200529     C******     SVTOTT    ANDNEMCTOTT                                    136935
511700200529     C                     MOVE 'M'       MCREST
511800200529     C                     Z-ADDBJRDNB    MCLCD
511900200529     C                     MOVE 'A'       MCCHTP
512000200529     C                     MOVE SUSER     MCLUID
512100200529     C                     ENDIF
512200200529      *
512300200529      ***  Update Allocation file SECOALL7 for Security '**CASH**'.
512400200529      *
512500200529     C                     UPDATSECOALD0
512700200529      *
512800200529      ***  Access Depot file with CO Reference, Option Number, Branch,
512900200529      ***  Depot and New Security.
513000200529      *
513100200529     C                     MOVE PCORF     WKCORF
513200200529     C                     MOVE POPTN     WKOPTN
513300200529     C                     MOVE PBRCD     WKBRCD
513400200529     C**********           Z-ADDPDEPO     WKDEPO                                              CSD027
513500200529     C                     MOVE PDEPO     WKDEPO                                              CSD027
513600200529     C                     MOVE PNWSEC    WKSESN
513700200529     C           WKEY1     CHAINSECODPL3             16
513800200529      *
513900200529      ***  If record not found, handle Database error.
514000200529      *
514100200529     C           *IN16     IFEQ '1'
514200200529     C           *LOCK     IN   LDA
514300200529     C                     MOVEL'SECODPL3'DBFILE
514400200529     C                     MOVE WKOPTN    WWOPTN
514500200529     C                     MOVE WKDEPO    WWDEPO
514600200529     C           WKCORF    CAT  WWOPTN:0  DBKEY1  8
514700200529     C           WKBRCD    CAT  WWDEPO:0  DBKEY2  9
514800200529     C           DBKEY1    CAT  DBKEY2:0  DBKEY3 17
514900200529     C           DBKEY3    CAT  WKSESN:0  DBKEY4 27
515000200529     C                     MOVELDBKEY4    DBKEY            ***************
515100200529     C                     Z-ADD025       DBASE            * DB ERROR 25 *
515200200529     C                     MOVEL'SE7513'  DBPGM            ***************
515300200529     C                     OUT  LDA
515400200529     C                     EXSR *PSSR
515500200529     C                     ENDIF
515600200529      *                                                                   136935
515700200529     C                     Z-ADD0         DUACAA 150                      136935
515800200529     C                     Z-ADD0         DUACAR 150                      136935
515900200529     C                     Z-ADD0         DUASTA 150                      136935
516000200529     C                     Z-ADD0         DUASTR 150                      136935
516100200529     C                     Z-ADDMBBSTA    SVBSTA 150                      136935
516200200529     C                     Z-ADDMBBSTR    SVBSTR 150                      136935
516300200529     C                     Z-ADDMBBCAR    SVBCAR                          136935
516400200529      *
516500200529      ***  Recalculate Balancing Cash Rounding by adding old value and subtracting new value
516600200529      ***  of Actual Cash Rounding.
516700200529      *
516800200529     C           AMACAR    IFEQ 'Y'
516900200529     C                     ADD  SHACAR    MBBCAR
517000200529     C                     SUB  WWACRO    MBBCAR
517100200529      *                                                                   136935
517200200529      ***  If Balancing Difference recalculated not 0 and Processing Type 136935
517300200529      ***  = Currency Change or not Currency Change with ICD field 'Allo- 136935
517400200529      ***  cate Difference to Dummy' = 'Y', save Balancing Difference and 136935
517500200529      ***  reset it.                                                      136935
517600200529      *                                                                   136935
517700200529     C           MBBCAR    IFNE 0                                         136935
517800200529     C           PPROC     ANDEQ'CC'                                      136935
517900200529     C           MBBCAR    ORNE 0                                         136935
518000200529     C           PPROC     ANDNE'CC'                                      136935
518100200529     C           BVALDC    ANDEQ'Y'                                       136935
518200200529     C                     Z-ADDMBBCAR    DUACAR                          136935
518300200529     C                     Z-ADD0         MBBCAR                          136935
518400200529     C                     ENDIF                                          136935
518500200529     C                     ENDIF
518600200529      *
518700200529      ***  Recalculate Balancing Stock Rounding by adding old value and subtracting new value
518800200529      ***  of Actual Stock Rounding.
518900200529      *
519000200529     C           AMASTR    IFEQ 'Y'
519100200529     C                     ADD  SHASTR    MBBSTR
519200200529     C                     SUB  WWASTR    MBBSTR
519300200529      *                                                                   136935
519400200529      ***  If Balancing Difference recalculated not 0 and Processing Type 136935
519500200529      ***  = Currency Change or not Currency Change with ICD field 'Allo- 136935
519600200529      ***  cate Difference to Dummy' = 'Y', save Balancing Difference and 136935
519700200529      ***  reset it.                                                      136935
519800200529      *                                                                   136935
519900200529     C           MBBSTR    IFNE 0                                         136935
520000200529     C           PPROC     ANDEQ'CC'                                      136935
520100200529     C           MBBSTR    ORNE 0                                         136935
520200200529     C           PPROC     ANDNE'CC'                                      136935
520300200529     C           BVALDC    ANDEQ'Y'                                       136935
520400200529     C                     Z-ADDMBBSTR    DUASTR                          136935
520500200529     C                     Z-ADD0         MBBSTR                          136935
520600200529     C                     ENDIF                                          136935
520700200529     C                     ENDIF
520800200529      *
520900200529      ***  Recalculate Balancing Stock Allocation by adding old value and subtracting new value
521000200529      ***  of Actual Stock Allocation.
521100200529      *
521200200529     C                     ADD  SHASTA    MBBSTA
521300200529     C                     SUB  WWASAL    MBBSTA
521400200529      *                                                                   136935
521500200529      ***  If Balancing Difference recalculated not 0 and Processing Type 136935
521600200529      ***  = Currency Change or not Currency Change with ICD field 'Allo- 136935
521700200529      ***  cate Difference to Dummy' = 'Y', save Balancing Difference and 136935
521800200529      ***  reset it.                                                      136935
521900200529      *                                                                   136935
522000200529     C           MBBSTA    IFNE 0                                         136935
522100200529     C           PPROC     ANDEQ'CC'                                      136935
522200200529     C           MBBSTA    ORNE 0                                         136935
522300200529     C           PPROC     ANDNE'CC'                                      136935
522400200529     C           BVALDC    ANDEQ'Y'                                       136935
522500200529     C                     Z-ADDMBBSTA    DUASTA                          136935
522600200529     C                     Z-ADD0         MBBSTA                          136935
522700200529     C                     ENDIF                                          136935
522800200529      *
522900200529     C                     MOVE *BLANKS   ZFLD15
523000200529     C                     MOVE MBBSTA    ZFLD15
523100200529     C                     MOVE NMDP2     ZDECS            New Security Decimal Places
523200200529     C                     MOVE 'L'       ZECODE
523300200529     C                     EXSR ZSEDIT
523400200529     C                     MOVE *BLANKS   SACSTK
523500200529     C                     MOVE ZOUT21    SACSTK
523600200529      *
523700200529      ***  Update Depot file SECODPL3 for New Security.
523800200529      *
523900200529     C           SVBSTA    IFNE MBBSTA                                    136935
524000200529     C           SVBSTR    ORNE MBBSTR                                    136935
524100200529     C           SVBCAR    ORNE MBBCAR                                    136935
524200200529     C                     MOVE 'A'       MBCHTP
524300200529     C                     MOVE SUSER     MBLUID
524400200529     C                     Z-ADDBJRDNB    MBLCD
524500200529     C                     ENDIF                                          136935
524600200529     C                     UPDATSECODPD0
524700200529      *                                                                   136935
524800200529      ***  If at least one Balancing Difference has been allocated to     136935
524900200529      ***  Dummy Customer, update record from SECOALL7 for New Security   136935
525000200529      ***  and Dummy Customer.                                            136935
525100200529      *                                                                   136935
525200200529     C           DUASTA    IFNE 0                                         136935
525300200529     C           DUASTR    ORNE 0                                         136935
525400200529     C           DUACAR    ORNE 0                                         136935
525500200529     C           SHCNUM    IFNE WDUMMY                                    136935
525600200529     C                     MOVE 'C'       WKCOTP                          136935
525700200529     C                     MOVE *BLANKS   WKBOOK                          136935
525800200529     C                     MOVE WDUMMY    WKCNUM                          136935
525900200529     C                     MOVE *BLANKS   WKPTFR                          136935
526100200529     C           WKEY4     CHAINSECOALL7             16                   136935
526200200529      *                                                                   136935
526300200529      ***  If record no longer on file, handle Database Error.            136935
526400200529      *                                                                   136935
526500200529     C           *IN16     IFEQ '1'                                       136935
526600200529     C           *LOCK     IN   LDA                                       136935
526700200529     C                     Z-ADD036       DBASE            ***************136935
526800200529     C                     MOVE 'SECOALL7'DBFILE           * DB ERROR 36 *136935
526900200529     C                     MOVELWKCORF    DBKEY1           ***************136935
527000200529     C                     MOVE WKOPTN    DBKEY1                          136935
527100200529     C                     MOVELWKBRCD    DBKEY2                          136935
527200200529     C                     MOVE WKDEPO    DBKEY2                          136935
527300200529     C                     MOVELDBKEY1    DBKEY3                          136935
527400200529     C                     MOVE DBKEY2    DBKEY3                          136935
527500200529     C                     MOVELDBKEY3    DBKEY4                          136935
527600200529     C                     MOVE WKSESN    DBKEY4                          136935
527700200529     C                     MOVELWKCOTP    DBKEY5                          136935
527800200529     C                     MOVE WKBOOK    DBKEY5                          136935
527900200529     C                     MOVELWKCNUM    DBKEY6                          136935
528000200529     C                     MOVE WKPTFR    DBKEY6                          136935
528100200529     C                     MOVELDBKEY5    DBKEY7                          136935
528200200529     C                     MOVE DBKEY6    DBKEY7                          136935
528300200529     C                     MOVELDBKEY4    DBKEY8                          136935
528400200529     C                     MOVE DBKEY7    DBKEY8                          136935
528500200529     C                     MOVELDBKEY8    DBKEY                           136935
528600200529     C                     MOVEL'SE7513'  DBPGM                           136935
528700200529     C                     OUT  LDA                                       136935
528800200529     C                     EXSR *PSSR                                     136935
528900200529     C                     ENDIF                                          136935
529000200529     C                     ADD  DUASTA    MCASTA                          136935
529100200529     C                     ADD  DUASTR    MCASTR                          136935
529200200529     C                     ADD  DUACAR    MCACAR                          136935
529300200529     C                     MOVE 'A'       MCCHTP                          136935
529400200529     C                     Z-ADDBJRDNB    MCLCD                           136935
529500200529     C                     MOVE SUSER     MCLUID                          136935
529600200529     C                     MOVE 'M'       MCREST                          136935
529700200529     C                     UPDATSECOALD0                                  136935
529800200529     C                     MOVE 'Y'       MDUMMY                          136935
529900200529     C                     MOVE 'Y'       DUMMYM                          136935
530000200529     C                     ELSE                                           136935
530100200529     C                     ADD  DUASTA    ASTADU                          136935
530200200529     C                     ADD  DUASTR    ASTRDU                          136935
530300200529     C                     ADD  DUACAR    ACARDU                          136935
530400200529     C                     ENDIF                                          136935
530500200529     C                     ENDIF                                          136935
530600200529      *
530700200529      ***  Access Depot file with CO Reference, Option Number, Branch,
530800200529      ***  Depot and Security '**CASH**'.
530900200529      *
531000200529     C                     MOVE PCORF     WKCORF
531100200529     C                     MOVE POPTN     WKOPTN
531200200529     C                     MOVE PBRCD     WKBRCD
531300200529     C**********           Z-ADDPDEPO     WKDEPO                                              CSD027
531400200529     C                     MOVE PDEPO     WKDEPO                                              CSD027
531500200529     C                     MOVE *BLANKS   WKSESN
531600200529     C                     MOVEL'**CASH**'WKSESN
531700200529     C           WKEY1     CHAINSECODPL3             16
531800200529      *
531900200529      ***  If record not found, handle Database error.
532000200529      *
532100200529     C           *IN16     IFEQ '1'
532200200529     C           *LOCK     IN   LDA
532300200529     C                     MOVEL'SECODPL3'DBFILE
532400200529     C                     MOVE WKOPTN    WWOPTN
532500200529     C                     MOVE WKDEPO    WWDEPO
532600200529     C           WKCORF    CAT  WWOPTN:0  DBKEY1  8
532700200529     C           WKBRCD    CAT  WWDEPO:0  DBKEY2  9
532800200529     C           DBKEY1    CAT  DBKEY2:0  DBKEY3 17
532900200529     C           DBKEY3    CAT  WKSESN:0  DBKEY4 27
533000200529     C                     MOVELDBKEY4    DBKEY            ***************
533100200529     C                     Z-ADD026       DBASE            * DB ERROR 26 *
533200200529     C                     MOVEL'SE7513'  DBPGM            ***************
533300200529     C                     OUT  LDA
533400200529     C                     EXSR *PSSR
533500200529     C                     ENDIF
533600200529      *
533700200529     C                     Z-ADDMBBCAA    SVBCAA 150
533800200529      *                                                                   136935
533900200529     C                     Z-ADD0         DUACAA                          136935
534000200529     C                     Z-ADD0         DUACAR                          136935
534100200529     C                     Z-ADD0         DUASTA                          136935
534200200529     C                     Z-ADD0         DUASTR                          136935
534300200529      *
534400200529      ***  Recalculate Balancing Cash Allocation by subtracting old values and adding new values
534500200529      ***  of Actual Cash Rounding and Actual Cash Allocation, and update file.
534600200529      *
534700200529     C           AMACAR    IFEQ 'Y'
534800200529     C           PPROC     IFEQ 'CR'
534900200529     C                     Z-ADDNMDPC2    WWNBDP           New Currency Decimal Places
535000200529     C                     Z-ADDSHACAR    WUNUM
535100200529     C                     EXSR RTVNDP
535200200529     C                     Z-ADDNMDPC1    WWNBDP           Event Currency Decimal Places
535300200529     C                     MOVE 'R'       WUROOP           Rounding = half adjust
535400200529     C                     EXSR ROUNDD
535500200529     C                     EXSR SETNDP
535600200529     C                     SUB  WUNUM     MBBCAA
535700200529     C                     Z-ADDNMDPC2    WWNBDP           New Currency Decimal Places
535800200529     C                     Z-ADDWWACRO    WUNUM
535900200529     C                     EXSR RTVNDP
536000200529     C                     Z-ADDNMDPC1    WWNBDP           Event Currency Decimal Places
536100200529     C                     MOVE 'R'       WUROOP           Rounding = half adjust
536200200529     C                     EXSR ROUNDD
536300200529     C                     EXSR SETNDP
536400200529     C******               ADD  WWNUM     MBBCAA                          136935
536500200529     C                     ADD  WUNUM     MBBCAA                          136935
536600200529     C                     ELSE
536700200529     C                     SUB  SHACAR    MBBCAA
536800200529     C                     ADD  WWACRO    MBBCAA
536900200529     C                     ENDIF
537000200529      *                                                                   136935
537100200529      ***  If Balancing Difference recalculated not 0 and Processing Type 136935
537200200529      ***  = Currency Change or not Currency Change with ICD field 'Allo- 136935
537300200529      ***  cate Difference to Dummy' = 'Y', save Balancing Difference and 136935
537400200529      ***  reset it.                                                      136935
537500200529      *                                                                   136935
537600200529     C           MBBCAA    IFNE 0                                         136935
537700200529     C           PPROC     ANDEQ'CC'                                      136935
537800200529     C           MBBCAA    ORNE 0                                         136935
537900200529     C           PPROC     ANDNE'CC'                                      136935
538000200529     C           BVALDC    ANDEQ'Y'                                       136935
538100200529     C                     Z-SUBMBBCAA    DUACAR                          136935
538200200529     C                     Z-ADD0         MBBCAA                          136935
538300200529     C                     ENDIF                                          136935
538400200529     C                     ENDIF
538500200529     C           AMACAA    IFEQ 'Y'
538600200529     C           PPROC     IFEQ 'CR'
538700200529     C                     Z-ADDNMDPC2    WWNBDP           New Currency Decimal Places
538800200529     C                     Z-ADDSHACAA    WUNUM
538900200529     C                     EXSR RTVNDP
539000200529     C                     Z-ADDNMDPC1    WWNBDP           Event Currency Decimal Places
539100200529     C                     MOVE 'R'       WUROOP           Rounding = half adjust
539200200529     C                     EXSR ROUNDD
539300200529     C                     EXSR SETNDP
539400200529     C                     SUB  WUNUM     MBBCAA
539500200529     C                     Z-ADDNMDPC2    WWNBDP           New Currency Decimal Places
539600200529     C                     Z-ADDWWACAA    WUNUM
539700200529     C                     EXSR RTVNDP
539800200529     C                     Z-ADDNMDPC1    WWNBDP           Event Currency Decimal Places
539900200529     C                     MOVE 'R'       WUROOP           Rounding = half adjust
540000200529     C                     EXSR ROUNDD
540100200529     C                     EXSR SETNDP
540200200529     C                     ADD  WUNUM     MBBCAA
540300200529     C                     ELSE
540400200529     C                     SUB  SHACAA    MBBCAA
540500200529     C                     ADD  WWACAA    MBBCAA
540600200529     C                     ENDIF
540700200529      *                                                                   136935
540800200529      ***  If Balancing Difference recalculated not 0 and Processing Type 136935
540900200529      ***  = Currency Change or not Currency Change with ICD field 'Allo- 136935
541000200529      ***  cate Difference to Dummy' = 'Y', save Balancing Difference and 136935
541100200529      ***  reset it.                                                      136935
541200200529      *                                                                   136935
541300200529     C           MBBCAA    IFNE 0                                         136935
541400200529     C           PPROC     ANDEQ'CC'                                      136935
541500200529     C           MBBCAA    ORNE 0                                         136935
541600200529     C           PPROC     ANDNE'CC'                                      136935
541700200529     C           BVALDC    ANDEQ'Y'                                       136935
541800200529     C                     Z-SUBMBBCAA    DUACAA                          136935
541900200529     C                     Z-ADD0         MBBCAA                          136935
542000200529     C                     ENDIF                                          136935
542100200529     C                     ENDIF
542200200529     C           SVBCAA    IFNE MBBCAA
542300200529     C                     MOVE 'A'       MBCHTP
542400200529     C                     MOVE SUSER     MBLUID
542500200529     C                     Z-ADDBJRDNB    MBLCD
542600200529     C                     ENDIF
542700200529     C                     UPDATSECODPD0
542800200529      *                                                                   136935
542900200529      ***  If Balancing Difference has been allocated to Dummy Customer,  136935
543000200529      ***  update record from SECOALL7 for Security '**CASH**' and Dummy  136935
543100200529      ***  Customer                                                       136935
543200200529      *                                                                   136935
543300200529     C           DUACAA    IFNE 0                                         136935
543400200529     C           DUACAR    ORNE 0                                         136935
543500200529     C                     MOVE 'C'       WKCOTP                          136935
543600200529     C                     MOVE *BLANKS   WKBOOK                          136935
543700200529     C                     MOVE WDUMMY    WKCNUM                          136935
543800200529     C                     MOVE *BLANKS   WKPTFR                          136935
544000200529     C           WKEY4     CHAINSECOALL7             16                   136935
544100200529      *                                                                   136935
544200200529      ***  If record no longer on file, handle Database Error.            136935
544300200529      *                                                                   136935
544400200529     C           *IN16     IFEQ '1'                                       136935
544500200529     C           *LOCK     IN   LDA                                       136935
544600200529     C                     Z-ADD037       DBASE            ***************136935
544700200529     C                     MOVE 'SECOALL7'DBFILE           * DB ERROR 37 *136935
544800200529     C                     MOVELWKCORF    DBKEY1           ***************136935
544900200529     C                     MOVE WKOPTN    DBKEY1                          136935
545000200529     C                     MOVELWKBRCD    DBKEY2                          136935
545100200529     C                     MOVE WKDEPO    DBKEY2                          136935
545200200529     C                     MOVELDBKEY1    DBKEY3                          136935
545300200529     C                     MOVE DBKEY2    DBKEY3                          136935
545400200529     C                     MOVELDBKEY3    DBKEY4                          136935
545500200529     C                     MOVE WKSESN    DBKEY4                          136935
545600200529     C                     MOVELWKCOTP    DBKEY5                          136935
545700200529     C                     MOVE WKBOOK    DBKEY5                          136935
545800200529     C                     MOVELWKCNUM    DBKEY6                          136935
545900200529     C                     MOVE WKPTFR    DBKEY6                          136935
546000200529     C                     MOVELDBKEY5    DBKEY7                          136935
546100200529     C                     MOVE DBKEY6    DBKEY7                          136935
546200200529     C                     MOVELDBKEY4    DBKEY8                          136935
546300200529     C                     MOVE DBKEY7    DBKEY8                          136935
546400200529     C                     MOVELDBKEY8    DBKEY                           136935
546500200529     C                     MOVEL'SE7513'  DBPGM                           136935
546600200529     C                     OUT  LDA                                       136935
546700200529     C                     EXSR *PSSR                                     136935
546800200529     C                     ENDIF                                          136935
546900200529     C                     ADD  DUACAA    MCACAA                          136935
547000200529     C                     ADD  DUACAR    MCACAR                          136935
547100200529     C                     MOVE 'A'       MCCHTP                          136935
547200200529     C                     Z-ADDBJRDNB    MCLCD                           136935
547300200529     C                     MOVE SUSER     MCLUID                          136935
547400200529     C                     MOVE 'M'       MCREST                          136935
547500200529     C                     UPDATSECOALD0                                  136935
547600200529     C                     MOVE 'Y'       MDUMMY                          136935
547700200529     C                     MOVE 'Y'       DUMMYM                          136935
547800200529     C                     ENDIF                                          136935
547900200529      *                                                                   136935
548000200529      ***  Output new value for Balancing Cash Allocation on top line     136935
548100200529      ***  of screen.                                                     136935
548200200529      *                                                                   136935
548300200529     C                     MOVE *BLANKS   ZFLD15                          136935
548400200529     C                     MOVE MBBCAA    ZFLD15                          136935
548500200529     C           PPROC     IFEQ 'CR'                                      136935
548600200529     C                     MOVE NMDPC1    ZDECS            Ev.Ccy Dec.Pl. 136935
548700200529     C                     ELSE                                           136935
548800200529     C                     MOVE NMDPC2    ZDECS            New Ccy Dec.Pl.136935
548900200529     C                     ENDIF                                          136935
549000200529     C                     EXSR ZSEDIT                                    136935
549100200529     C                     MOVE *BLANKS   SCASH                           136935
549200200529     C                     MOVE ZOUT21    SCASH                           136935
549300200529      *
549400200529     C                     ELSE
549500200529      *
549600200529      ***  If Actual Cash Rounding has changed.
549700200529      *
549800200529     C           SACRO     IFNE SHACRO
549900200529      *
550000200529      ***  Access Allocation file with CO Reference, Option Number,
550100200529      ***  Branch, Depot, Security = '**CASH**', Cust/Book Ind.,
550200200529      ***  Book, Customer and Portfolio.
550300200529      *
550400200529     C                     MOVE PCORF     WKCORF
550500200529     C                     Z-ADDPOPTN     WKOPTN
550600200529     C                     MOVE PBRCD     WKBRCD
550700200529     C                     MOVE PDEPO     WKDEPO
550800200529     C                     MOVE *BLANKS   WKSESN
550900200529     C                     MOVEL'**CASH**'WKSESN
551000200529     C                     MOVE SHCOTP    WKCOTP
551100200529     C                     MOVE SHBOOK    WKBOOK
551200200529     C**********           Z-ADDSHCNUM    WKCNUM                                              CSD027
551300200529     C                     MOVE SHCNUM    WKCNUM                                              CSD027
551400200529     C                     MOVE SHPORT    WKPTFR
551500200529     C           WKEY4     CHAINSECOALL7             16
551600200529      *
551700200529      ***  If record not found, handle Database error.
551800200529      *
551900200529     C           *IN16     IFEQ '1'
552000200529     C           *LOCK     IN   LDA
552100200529     C                     MOVEL'SECOALL7'DBFILE
552200200529     C                     MOVE WKOPTN    WWOPTN
552300200529     C                     MOVE WKDEPO    WWDEPO
552400200529     C                     MOVE WKCNUM    WWCNUM
552500200529     C           WKCORF    CAT  WWOPTN:0  DBKEY1  8
552600200529     C           WKBRCD    CAT  WWDEPO:0  DBKEY2  9
552700200529     C           DBKEY1    CAT  DBKEY2:0  DBKEY3 17
552800200529     C           DBKEY3    CAT  WKSESN:0  DBKEY4 27
552900200529     C           WKCOTP    CAT  WKBOOK:0  DBKEY5  3
553000200529     C           WWCNUM    CAT  WKPORT:0  DBKEY6 10
553100200529     C           DBKEY5    CAT  DBKEY6:0  DBKEY7 13
553200200529     C           DBKEY4    CAT  DBKEY7:0  DBKEY8 40
553300200529     C                     MOVELDBKEY8    DBKEY            ***************
553400200529     C                     Z-ADD027       DBASE            * DB ERROR 27 *
553500200529     C                     MOVEL'SE7513'  DBPGM            ***************
553600200529     C                     OUT  LDA
553700200529     C                     EXSR *PSSR
553800200529     C                     ENDIF
553900200529      *
554000200529      ***  Recalculate Actual Cash Rounding by substract old value
554100200529      ***  and add new value of Actual Cash Rounding and update file.
554200200529      *
554300200529     C           PPROC     IFEQ 'CR'
554400200529     C                     Z-ADDNMDPC2    WWNBDP           New Currency Decimal Places
554500200529     C                     Z-ADDSHACAR    WUNUM
554600200529     C                     EXSR RTVNDP
554700200529     C                     Z-ADDNMDPC1    WWNBDP           Event Currency Decimal Places
554800200529     C                     MOVE 'R'       WUROOP           Rounding = half adjust
554900200529     C                     EXSR ROUNDD
555000200529     C                     EXSR SETNDP
555100200529     C******               SUB  WUNUM     MBBCAA                          136935
555200200529     C                     SUB  WUNUM     MCACAR                          136935
555300200529     C                     Z-ADDNMDPC2    WWNBDP           New Currency Decimal Places
555400200529     C                     Z-ADDWWACRO    WUNUM
555500200529     C                     EXSR RTVNDP
555600200529     C                     Z-ADDNMDPC1    WWNBDP           Event Currency Decimal Places
555700200529     C                     MOVE 'R'       WUROOP           Rounding = half adjust
555800200529     C                     EXSR ROUNDD
555900200529     C                     EXSR SETNDP
556000200529     C******               ADD  WUNUM     MBBCAA                          136935
556100200529     C                     ADD  WUNUM     MCACAR                          136935
556200200529     C                     ELSE
556300200529     C                     SUB  SHACAR    MCACAR
556400200529     C                     ADD  WWACRO    MCACAR
556500200529     C                     ENDIF
556600200529      *
556700200529     C                     MOVE 'M'       MCREST
556800200529     C                     Z-ADDBJRDNB    MCLCD
556900200529     C                     MOVE 'A'       MCCHTP
557000200529     C                     MOVE SUSER     MCLUID
557100200529     C                     UPDATSECOALD0
557300200529      *
557400200529      ***  Access Depot file with CO Reference, Option Number, Branch,
557500200529      ***  Depot and New Security = '**CASH**'.
557600200529      *
557700200529     C                     MOVE PCORF     WKCORF
557800200529     C                     MOVE POPTN     WKOPTN
557900200529     C                     MOVE PBRCD     WKBRCD
558000200529     C**********           Z-ADDPDEPO     WKDEPO                                              CSD027
558100200529     C                     MOVE PDEPO     WKDEPO                                              CSD027
558200200529     C                     MOVE *BLANKS   WKSESN
558300200529     C                     MOVEL'**CASH**'WKSESN
558400200529     C           WKEY1     CHAINSECODPL3             16
558500200529      *
558600200529      ***  If record not found, handle Database error.
558700200529      *
558800200529     C           *IN16     IFEQ '1'
558900200529     C           *LOCK     IN   LDA
559000200529     C                     MOVEL'SECODPL3'DBFILE
559100200529     C                     MOVE WKOPTN    WWOPTN
559200200529     C                     MOVE WKDEPO    WWDEPO
559300200529     C           WKCORF    CAT  WWOPTN:0  DBKEY1  8
559400200529     C           WKBRCD    CAT  WWDEPO:0  DBKEY2  9
559500200529     C           DBKEY1    CAT  DBKEY2:0  DBKEY3 17
559600200529     C           DBKEY3    CAT  WKSESN:0  DBKEY4 27
559700200529     C                     MOVELDBKEY4    DBKEY            ***************
559800200529     C                     Z-ADD028       DBASE            * DB ERROR 28 *
559900200529     C                     MOVEL'SE7513'  DBPGM            ***************
560000200529     C                     OUT  LDA
560100200529     C                     EXSR *PSSR
560200200529     C                     ENDIF
560300200529      *                                                                   136935
560400200529     C                     Z-ADDMBBCAA    SVBCAA                          136935
560500200529     C                     Z-ADD0         DUACAA                          136935
560600200529     C                     Z-ADD0         DUACAR                          136935
560700200529     C                     Z-ADD0         DUASTA                          136935
560800200529     C                     Z-ADD0         DUASTR                          136935
560900200529      *
561000200529      ***  Recalculate Balancing Cash Allocation by subtracting old value and adding new value
561100200529      ***  of Actual Cash Rounding, and update record.
561200200529      *
561300200529     C           PPROC     IFEQ 'CR'
561400200529     C                     Z-ADDNMDPC2    WWNBDP           New Currency Decimal Places
561500200529     C                     Z-ADDSHACAR    WUNUM
561600200529     C                     EXSR RTVNDP
561700200529     C                     Z-ADDNMDPC1    WWNBDP           Event Currency Decimal Places
561800200529     C                     MOVE 'R'       WUROOP           Rounding = half adjust
561900200529     C                     EXSR ROUNDD
562000200529     C                     EXSR SETNDP
562100200529     C                     SUB  WUNUM     MBBCAA
562200200529     C                     Z-ADDNMDPC2    WWNBDP           New Currency Decimal Places
562300200529     C                     Z-ADDWWACRO    WUNUM
562400200529     C                     EXSR RTVNDP
562500200529     C                     Z-ADDNMDPC1    WWNBDP           Event Currency Decimal Places
562600200529     C                     MOVE 'R'       WUROOP           Rounding = half adjust
562700200529     C                     EXSR ROUNDD
562800200529     C                     EXSR SETNDP
562900200529     C                     ADD  WUNUM     MBBCAA
563000200529     C                     ELSE
563100200529     C                     SUB  SHACAR    MBBCAA
563200200529     C                     ADD  WWACRO    MBBCAA
563300200529     C                     ENDIF
563400200529      *                                                                   136935
563500200529      ***  If Balancing Difference recalculated not 0 and Processing Type 136935
563600200529      ***  = Currency Change or not Currency Change with ICD field 'Allo- 136935
563700200529      ***  cate Difference to Dummy' = 'Y', save Balancing Difference and 136935
563800200529      ***  reset it.                                                      136935
563900200529      *                                                                   136935
564000200529     C           MBBCAA    IFNE 0                                         136935
564100200529     C           PPROC     ANDEQ'CC'                                      136935
564200200529     C           MBBCAA    ORNE 0                                         136935
564300200529     C           PPROC     ANDNE'CC'                                      136935
564400200529     C           BVALDC    ANDEQ'Y'                                       136935
564500200529     C                     Z-SUBMBBCAA    DUACAR                          136935
564600200529     C                     Z-ADD0         MBBCAA                          136935
564700200529     C                     ENDIF                                          136935
564800200529      *
564900200529     C           SVBCAA    IFNE MBBCAA                                    136935
565000200529     C                     MOVE 'A'       MBCHTP
565100200529     C                     MOVE SUSER     MBLUID
565200200529     C                     Z-ADDBJRDNB    MBLCD
565300200529     C                     ENDIF                                          136935
565400200529     C                     UPDATSECODPD0
565500200529      *                                                                   136935
565600200529      ***  If Balancing Difference has been allocated to Dummy Customer,  136935
565700200529      ***  update record from SECOALL7 for Security '**CASH**' and Dummy  136935
565800200529      ***  Customer                                                       136935
565900200529      *                                                                   136935
566000200529     C           DUACAR    IFNE 0                                         136935
566100200529     C                     MOVE 'C'       WKCOTP                          136935
566200200529     C                     MOVE *BLANKS   WKBOOK                          136935
566300200529     C                     MOVE WDUMMY    WKCNUM                          136935
566400200529     C                     MOVE *BLANKS   WKPTFR                          136935
566600200529     C           WKEY4     CHAINSECOALL7             16                   136935
566700200529      *                                                                   136935
566800200529      ***  If record no longer on file, handle Database Error.            136935
566900200529      *                                                                   136935
567000200529     C           *IN16     IFEQ '1'                                       136935
567100200529     C           *LOCK     IN   LDA                                       136935
567200200529     C                     Z-ADD038       DBASE            ***************136935
567300200529     C                     MOVE 'SECOALL7'DBFILE           * DB ERROR 38 *136935
567400200529     C                     MOVELWKCORF    DBKEY1           ***************136935
567500200529     C                     MOVE WKOPTN    DBKEY1                          136935
567600200529     C                     MOVELWKBRCD    DBKEY2                          136935
567700200529     C                     MOVE WKDEPO    DBKEY2                          136935
567800200529     C                     MOVELDBKEY1    DBKEY3                          136935
567900200529     C                     MOVE DBKEY2    DBKEY3                          136935
568000200529     C                     MOVELDBKEY3    DBKEY4                          136935
568100200529     C                     MOVE WKSESN    DBKEY4                          136935
568200200529     C                     MOVELWKCOTP    DBKEY5                          136935
568300200529     C                     MOVE WKBOOK    DBKEY5                          136935
568400200529     C                     MOVELWKCNUM    DBKEY6                          136935
568500200529     C                     MOVE WKPTFR    DBKEY6                          136935
568600200529     C                     MOVELDBKEY5    DBKEY7                          136935
568700200529     C                     MOVE DBKEY6    DBKEY7                          136935
568800200529     C                     MOVELDBKEY4    DBKEY8                          136935
568900200529     C                     MOVE DBKEY7    DBKEY8                          136935
569000200529     C                     MOVELDBKEY8    DBKEY                           136935
569100200529     C                     MOVEL'SE7513'  DBPGM                           136935
569200200529     C                     OUT  LDA                                       136935
569300200529     C                     EXSR *PSSR                                     136935
569400200529     C                     ENDIF                                          136935
569500200529     C                     ADD  DUACAR    MCACAR                          136935
569600200529     C                     MOVE 'A'       MCCHTP                          136935
569700200529     C                     Z-ADDBJRDNB    MCLCD                           136935
569800200529     C                     MOVE SUSER     MCLUID                          136935
569900200529     C                     MOVE 'M'       MCREST                          136935
570000200529     C                     UPDATSECOALD0                                  136935
570100200529     C                     MOVE 'Y'       MDUMMY                          136935
570200200529     C                     MOVE 'Y'       DUMMYM                          136935
570300200529     C                     ENDIF                                          136935
570400200529      *                                                                   136935
570500200529      ***  Output new value for Balancing Cash Allocation on top line     136935
570600200529      ***  of screen.                                                     136935
570700200529      *                                                                   136935
570800200529     C                     MOVE *BLANKS   ZFLD15                          136935
570900200529     C                     MOVE MBBCAA    ZFLD15                          136935
571000200529     C           PPROC     IFEQ 'CR'                                      136935
571100200529     C                     MOVE NMDPC1    ZDECS            Ev.Ccy Dec.Pl. 136935
571200200529     C                     ELSE                                           136935
571300200529     C                     MOVE NMDPC2    ZDECS            New Ccy Dec.Pl.136935
571400200529     C                     ENDIF                                          136935
571500200529     C                     EXSR ZSEDIT                                    136935
571600200529     C                     MOVE *BLANKS   SCASH                           136935
571700200529     C                     MOVE ZOUT21    SCASH                           136935
571800200529      *
571900200529      ***  Access Depot file with CO Reference, Option Number, Branch,
572000200529      ***  Depot and New Security.
572100200529      *
572200200529     C                     MOVE PCORF     WKCORF
572300200529     C                     MOVE POPTN     WKOPTN
572400200529     C                     MOVE PBRCD     WKBRCD
572500200529     C**********           Z-ADDPDEPO     WKDEPO                                              CSD027
572600200529     C                     MOVE PDEPO     WKDEPO                                              CSD027
572700200529     C                     MOVE PNWSEC    WKSESN
572800200529     C           WKEY1     CHAINSECODPL3             16
572900200529      *
573000200529      ***  If record not found, handle Database error.
573100200529      *
573200200529     C           *IN16     IFEQ '1'
573300200529     C           *LOCK     IN   LDA
573400200529     C                     MOVEL'SECODPL3'DBFILE
573500200529     C                     MOVE WKOPTN    WWOPTN
573600200529     C                     MOVE WKDEPO    WWDEPO
573700200529     C           WKCORF    CAT  WWOPTN:0  DBKEY1  8
573800200529     C           WKBRCD    CAT  WWDEPO:0  DBKEY2  9
573900200529     C           DBKEY1    CAT  DBKEY2:0  DBKEY3 17
574000200529     C           DBKEY3    CAT  WKSESN:0  DBKEY4 27
574100200529     C                     MOVELDBKEY4    DBKEY            ***************
574200200529     C                     Z-ADD029       DBASE            * DB ERROR 29 *
574300200529     C                     MOVEL'SE7513'  DBPGM            ***************
574400200529     C                     OUT  LDA
574500200529     C                     EXSR *PSSR
574600200529     C                     ENDIF
574700200529      *                                                                   136935
574800200529     C                     Z-ADDMBBCAR    SVBCAR 150                      136935
574900200529     C                     Z-ADD0         DUACAA                          136935
575000200529     C                     Z-ADD0         DUACAR                          136935
575100200529     C                     Z-ADD0         DUASTA                          136935
575200200529     C                     Z-ADD0         DUASTR                          136935
575300200529      *
575400200529      ***  Recalculate Balancing Cash Rounding by adding old value and subtracting new value
575500200529      ***  of Actual Cash Rounding, and update record.
575600200529      *
575700200529     C                     ADD  SHACAR    MBBCAR
575800200529     C                     SUB  WWACRO    MBBCAR
575900200529      *                                                                   136935
576000200529      ***  If Balancing Difference recalculated not 0 and Processing Type 136935
576100200529      ***  = Currency Change or not Currency Change with ICD field 'Allo- 136935
576200200529      ***  cate Difference to Dummy' = 'Y', save Balancing Difference and 136935
576300200529      ***  reset it.                                                      136935
576400200529      *                                                                   136935
576500200529     C           MBBCAR    IFNE 0                                         136935
576600200529     C           PPROC     ANDEQ'CC'                                      136935
576700200529     C           MBBCAR    ORNE 0                                         136935
576800200529     C           PPROC     ANDNE'CC'                                      136935
576900200529     C           BVALDC    ANDEQ'Y'                                       136935
577000200529     C                     Z-ADDMBBCAR    DUACAR                          136935
577100200529     C                     Z-ADD0         MBBCAR                          136935
577200200529     C                     ENDIF                                          136935
577300200529      *
577400200529     C           SVBCAR    IFNE MBBCAR                                    136935
577500200529     C                     MOVE 'A'       MBCHTP
577600200529     C                     MOVE SUSER     MBLUID
577700200529     C                     Z-ADDBJRDNB    MBLCD
577800200529     C                     ENDIF                                          136935
577900200529     C                     UPDATSECODPD0
578000200529      *                                                                   136935
578100200529      ***  If Balancing Difference has been allocated to Dummy Customer,  136935
578200200529      ***  update record from SECOALL7 for New Security and Dummy         136935
578300200529      ***  Customer                                                       136935
578400200529      *                                                                   136935
578500200529     C           DUACAR    IFNE 0                                         136935
578600200529     C           SHCNUM    IFNE WDUMMY                                    136935
578700200529     C                     MOVE 'C'       WKCOTP                          136935
578800200529     C                     MOVE *BLANKS   WKBOOK                          136935
578900200529     C                     MOVE WDUMMY    WKCNUM                          136935
579000200529     C                     MOVE *BLANKS   WKPTFR                          136935
579200200529     C           WKEY4     CHAINSECOALL7             16                   136935
579300200529      *                                                                   136935
579400200529      ***  If record no longer on file, handle Database Error.            136935
579500200529      *                                                                   136935
579600200529     C           *IN16     IFEQ '1'                                       136935
579700200529     C           *LOCK     IN   LDA                                       136935
579800200529     C                     Z-ADD039       DBASE            ***************136935
579900200529     C                     MOVE 'SECOALL7'DBFILE           * DB ERROR 39 *136935
580000200529     C                     MOVELWKCORF    DBKEY1           ***************136935
580100200529     C                     MOVE WKOPTN    DBKEY1                          136935
580200200529     C                     MOVELWKBRCD    DBKEY2                          136935
580300200529     C                     MOVE WKDEPO    DBKEY2                          136935
580400200529     C                     MOVELDBKEY1    DBKEY3                          136935
580500200529     C                     MOVE DBKEY2    DBKEY3                          136935
580600200529     C                     MOVELDBKEY3    DBKEY4                          136935
580700200529     C                     MOVE WKSESN    DBKEY4                          136935
580800200529     C                     MOVELWKCOTP    DBKEY5                          136935
580900200529     C                     MOVE WKBOOK    DBKEY5                          136935
581000200529     C                     MOVELWKCNUM    DBKEY6                          136935
581100200529     C                     MOVE WKPTFR    DBKEY6                          136935
581200200529     C                     MOVELDBKEY5    DBKEY7                          136935
581300200529     C                     MOVE DBKEY6    DBKEY7                          136935
581400200529     C                     MOVELDBKEY4    DBKEY8                          136935
581500200529     C                     MOVE DBKEY7    DBKEY8                          136935
581600200529     C                     MOVELDBKEY8    DBKEY                           136935
581700200529     C                     MOVEL'SE7513'  DBPGM                           136935
581800200529     C                     OUT  LDA                                       136935
581900200529     C                     EXSR *PSSR                                     136935
582000200529     C                     ENDIF                                          136935
582100200529     C                     ADD  DUACAR    MCACAR                          136935
582200200529     C                     MOVE 'A'       MCCHTP                          136935
582300200529     C                     Z-ADDBJRDNB    MCLCD                           136935
582400200529     C                     MOVE SUSER     MCLUID                          136935
582500200529     C                     MOVE 'M'       MCREST                          136935
582600200529     C                     UPDATSECOALD0                                  136935
582700200529     C                     MOVE 'Y'       MDUMMY                          136935
582800200529     C                     MOVE 'Y'       DUMMYM                          136935
582900200529     C                     ELSE                                           136935
583000200529     C                     ADD  DUACAR    ACARDU                          136935
583100200529     C                     ENDIF                                          136935
583200200529     C                     ENDIF                                          136935
583300200529      *
583400200529     C                     ENDIF
583500200529     C                     ENDIF
583600200529      *
583700200529     C                     ENDSR
583800200529      *
583900200529      *****************************************************************
584000200529      /EJECT
584100200529      *****************************************************************
584200200529      *                                                               *
584300200529      *  CHACAL - Check if Actual Allocation fields can be            *
584400200529      *           recalculated.                                       *
584500200529      *                                                               *
584600200529      *  Called by:                                                   *
584700200529      *                                                               *
584800200529      *  Calls:                                                       *
584900200529      *                                                               *
585000200529      *****************************************************************
585100200529      *
585200200529     C           CHACAL    BEGSR                           ** CHACAL SR **
585300200529      *
585400200529      ***  If Processing Type = 'NF': Non Financial Events or 'NC': Name Changes,
585500200529      ***  set-up special work field to 'N', it means the Actual Allocation fields must not be
585600200529      ***  calculated, else set-up this work field to 'Y'.
585700200529      *
585800200529     C           PPROC     IFEQ 'NF'                       Non Financial Events
585900200529     C           PPROC     OREQ 'NC'                       Name Changes
586000200529     C                     MOVE 'N'       SPWRKF  1
586100200529     C                     ELSE
586200200529     C                     MOVE 'Y'       SPWRKF
586300200529     C                     ENDIF
586400200529      *
586500200529      ***  Reset work fields.
586600200529      *
586700200529     C                     Z-ADD0         WCAPR   52       Cash %
586800200529     C                     MOVE ' '       OPTNAA  1        Option for Actual Allocation
586900200529      *
587000200529      ***  Retreive Customer/Book Current Reply and Standard Instruction.
587100200529      *
587200200529     C                     EXSR RTVRPL
587300200529      *
587400200529      ***  If Processing Type not Non Financial Events, not Name Changes, not Currency Changes
587500200529      ***  and Corporate Actions Type for Multiple Options (= with Number of Options retrieve
587600200529      ***  CO References file is > 1).
587700200529      *
587800200529     C           PPROC     IFNE 'NF'                       If not Non Financial Events
587900200529     C           PPROC     ANDNE'NC'                          not Name Changes
588000200529     C           PPROC     ANDNE'CC'                          not Currency Changes
588100200529     C           MANBOP    ANDGT1                             for Multiple Options
588200200529      *
588300200529      ***  If Customer/Book Current Reply and Standard Instruction does not exist.
588400200529      *
588500200529     C           EXBCRE    IFNE 'Y'
588600200529     C           EXBCSI    ANDNE'Y'
588700200529      *
588800200529      ***  If Default for No Reply from SECORFL1 is blank:
588900200529      ***  Actual Allocations must not be calculated and must be set to zeros. So set the Special
589000200529      ***  work field to 'N'.
589100200529      *
589200200529     C           MADFNR    IFEQ *BLANKS
589300200529     C                     MOVE 'N'       SPWRKF
589400200529     C                     ENDIF
589500200529     C                     ENDIF
589600200529     C                     ENDIF
589700200529      *
589800200529      ***  If Processing Type = Non Financial Events and Customer/Book Current Reply exists,
589900200529      ***  set Cash % to Reply Cash % Level 2.
590000200529      *
590100200529     C           PPROC     IFEQ 'NF'
590200200529     C           EXBCRE    ANDEQ'Y'
590300200529     C                     Z-ADDMQR2CA    WCAPR
590400200529     C                     ENDIF
590500200529      *
590600200529      ***  If Processing Type = Dividends Events, Rights Issues, Offers or Exercices and
590700200529      ***  Conversions.
590800200529      *
590900200529     C           PPROC     IFEQ 'DV'                       Dividend Events
591000200529     C           PPROC     OREQ 'RG'                       Rights Issues
591100200529     C           PPROC     OREQ 'OF'                       Offers
591200200529     C           PPROC     OREQ 'EX'                       Exercice and Conversion
591300200529      *
591400200529      ***  CASE 1: If Customer/Booh Current Reply exists.
591500200529      *
591600200529     C           EXBCRE    IFEQ 'Y'
591700200529      *
591800200529      ***  Set Option for Actual Allocation to Reply Option Level 2.
591900200529      *
592000200529     C                     MOVE MQR2RE    OPTNAA
592100200529      *
592200200529      ***  If Processing Type = Dividend Events.
592300200529      *
592400200529     C           PPROC     IFEQ 'DV'
592500200529      *
592600200529      ***  If Option 1 selected: Cash Payment/Sell Rights, set Cash % to 100.
592700200529      *
592800200529     C           OPTNAA    IFEQ '1'
592900200529     C                     Z-ADD100       WCAPR
593000200529     C                     ELSE
593100200529      *
593200200529      ***  If Option selected is 2: Take Stock+Buy Additional Rights or 3: Take Stock+Sell Excess
593300200529      ***  Rights or 4: Take Stock, set Cash % to 0.
593400200529      *
593500200529     C           OPTNAA    IFEQ '2'
593600200529     C           OPTNAA    OREQ '3'
593700200529     C           OPTNAA    OREQ '4'
593800200529     C                     Z-ADD0         WCAPR
593900200529     C                     ELSE
594000200529      *
594100200529      ***  If Option 5 selected: Take Part Cash/Rest Stock, set Cash % to Reply Cash % Level 2.
594200200529      *
594300200529     C           OPTNAA    IFEQ '5'
594400200529     C                     Z-ADDMQR2CA    WCAPR
594500200529     C                     ENDIF
594600200529     C                     ENDIF
594700200529     C                     ENDIF
594800200529     C                     ELSE
594900200529      ******                                                              135690
595000200529      ***  If Processing Type = Rights Issues.                            135690
595100200529      ******                                                              135690
595200200529     C******     PPROC     IFEQ 'RG'                                      135690
595300200529      ******                                                              135690
595400200529      ***  If Option 1 selected: Sell all Rights, set Cash % to 100.      135690
595500200529      ******                                                              135690
595600200529     C******     OPTNAA    IFEQ '1'                                       135690
595700200529     C******               Z-ADD100       WCAPR                           135690
595800200529     C******               ELSE                                           135690
595900200529      ******                                                              135690
596000200529      *****If*Option*selected*is*5:*Take*Part*Cash/Rest*Stock*or*6:*Take* 135690
596100200529      *****Part*Cash/Keep*Stock,*set*Cash*%*to*Reply*Cash*%*Level*2.***** 135690
596200200529      ******                                                              135690
596300200529     C******     OPTNAA    IFEQ '5'                                       135690
596400200529     C******     OPTNAA    OREQ '6'                                       135690
596500200529     C******               Z-ADDMQR2CA    WCAPR                           135690
596600200529     C******               ELSE                                           135690
596700200529      ******                                                              135690
596800200529      *****If*Option*selected*is*2:*Take*Stock+Buy*Fraction*or*3:*Take*** 135690
596900200529      *****Stock+Sell*Fraction*or*4:*Take*Stock*or*7:*Do*nothing,*set**** 135690
597000200529      *****Cash*%*to*0.************************************************** 135690
597100200529      ******                                                              135690
597200200529     C******     OPTNAA    IFEQ '2'                                       135690
597300200529     C******     OPTNAA    OREQ '3'                                       135690
597400200529     C******     OPTNAA    OREQ '4'                                       135690
597500200529     C******     OPTNAA    OREQ '7'                                       135690
597600200529     C******               Z-ADD0         WCAPR                           135690
597700200529     C******               ENDIF                                          135690
597800200529     C******               ENDIF                                          135690
597900200529     C******               ENDIF                                          135690
598000200529     C******               ELSE                                           135690
598100200529      *
598200200529      ***  If Processing Type = Offers.
598300200529      *
598400200529     C           PPROC     IFEQ 'OF'
598500200529      *
598600200529      ***  If Option 1 selected: Accept Offer, set Cash % to 100.
598700200529      *
598800200529     C           OPTNAA    IFEQ '1'
598900200529     C                     Z-ADD100       WCAPR
599000200529     C                     ELSE
599100200529      *
599200200529      ***  If Option 2 selected: Refuse Offer, set Cash % to 0.
599300200529      *
599400200529     C           OPTNAA    IFEQ '2'
599500200529     C                     Z-ADD0         WCAPR
599600200529     C                     ELSE
599700200529      *
599800200529      ***  If Option 3 selected: Partial Accept Offer, set Cash % to Reply Cash % Level 2.
599900200529      *
600000200529     C           OPTNAA    IFEQ '3'
600100200529     C                     Z-ADDMQR2CA    WCAPR
600200200529     C                     ENDIF
600300200529     C                     ENDIF
600400200529     C                     ENDIF
600500200529     C                     ELSE
600600200529      *
600700200529      ***  If Processing Type = Exercices and Conversions.
600800200529      *
600900200529     C           PPROC     IFEQ 'EX'
601000200529      *
601100200529      ***  If Option 1 selected: Sell all Rights, set Cash % to 100.
601200200529      *
601300200529     C           OPTNAA    IFEQ '1'
601400200529     C                     Z-ADD100       WCAPR
601500200529     C                     ELSE
601600200529      *
601700200529      *****If*Option*selected*is*5:*Take Part*Cash/Rest*Stock*or*6:*Take P161732
601800200529      ***  If Option selected is 5: Take Part Cash/Rest Stock             161732
601900200529      ***  set Cash % to Reply Cash % Level 2.
602000200529      *
602100200529     C           OPTNAA    IFEQ '5'
602200200529     C***********OPTNAA    OREQ '6'                                       161732
602300200529     C                     Z-ADDMQR2CA    WCAPR
602400200529     C                     ELSE
602500200529      *
602600200529      ***  If Option selected is 2: Take Stock+Buy Fraction or 3: Take Stock+Sell Fraction or 4:
602700200529      ***  Take Stock or 6:Take Part Stock/Keep Rest,                     161732
602800200529      ***  or 7: Do nothing, set Cash % to 0.                             161732
602900200529      *****Take*Stock*or*7:*Do*nothing,*set*Cash*%*to*0.                  161732
603000200529      *
603100200529     C           OPTNAA    IFEQ '2'
603200200529     C           OPTNAA    OREQ '3'
603300200529     C           OPTNAA    OREQ '4'
603400200529     C           OPTNAA    OREQ '6'                                       161732
603500200529     C           OPTNAA    OREQ '7'
603600200529     C                     Z-ADD0         WCAPR
603700200529     C                     ENDIF
603800200529     C                     ENDIF
603900200529     C                     ENDIF
604000200529     C                     ENDIF
604100200529     C                     ENDIF
604200200529     C******               ENDIF                                          135690
604300200529     C                     ENDIF
604400200529      *
604500200529      ***  CASE 2: Else, if Customer/Book Current Reply does not exist.
604600200529      *
604700200529     C                     ELSE
604800200529      *
604900200529      ***  Set Option for Actual Allocation to Default for No Reply from SECOxxL1
605000200529      ***  (where xx = 'DV', 'RG', 'EX' or 'OF').
605100200529      *
605200200529     C                     MOVE MDDFNR    OPTNAA
605300200529      *
605400200529      ***  CASE 2.1: If Customer/Book Standard Corporate Actions Instruction exists (and Customer/
605500200529      ***            Book Current Reply does not exist).
605600200529      *
605700200529     C           EXBCSI    IFEQ 'Y'
605800200529      *
605900200529      ***  If Processing Type not Rights Issues.                          135690
606000200529      ***  Set Cash % to Cash Preferred % from SECOSIL1.
606100200529      *
606200200529     C           MAPTYP    IFNE 'RG'                                      135690
606300200529     C                     Z-ADDMOCAPP    WCAPR
606400200529     C                     ENDIF                                          135690
606500200529      *
606600200529      ***  If Processing Type = Dividend Events.
606700200529      *
606800200529     C           PPROC     IFEQ 'DV'
606900200529      *
607000200529      ***  If Stock Dividend Type = Stock for Stock or Combined for Cash and Stock, set Cash % to 0.
607100200529      *
607200200529     C           MDSDIT    IFEQ 'S'                        Stock for Stock
607300200529     C           MDSDIT    OREQ 'C'                        Combined for Cash and Stock
607400200529     C                     Z-ADD0         WCAPR
607500200529     C                     ENDIF
607600200529      *
607700200529      ***  If Cash % is < 50.
607800200529      *
607900200529     C           WCAPR     IFLT 50
608000200529      *
608100200529      ***  If Option 5 not allowed, set Cash % to 0.
608200200529      *
608300200529     C           MDOPT5    IFNE 'Y'
608400200529     C                     Z-ADD0         WCAPR
608500200529     C                     ELSE
608600200529      *
608700200529      ***  If Option 5 allowed and Cash % not 0, default Option for Actual allocation is '5'
608800200529      ***  (Cash % already = Cash Preferred % from Standard Instruction (SECOSIL1)).
608900200529      *
609000200529     C           WCAPR     IFNE 0
609100200529     C                     MOVE '5'       OPTNAA
609200200529     C                     ENDIF
609300200529     C                     ENDIF
609400200529     C                     ELSE
609500200529      *
609600200529      *****If*Cash*%*>*50.*********************************************** 135690
609700200529      ***  Else, if Cash % > or = 50.                                     135690
609800200529      *
609900200529     C******     WCAPR     IFGT 50                                        135690
610000200529      *
610100200529      ***  If Option 5 not allowed, set Cash % to 100.
610200200529      *
610300200529     C           MDOPT5    IFNE 'Y'
610400200529     C                     Z-ADD100       WCAPR
610500200529     C                     ELSE
610600200529      *
610700200529      ***  If Option 5 allowed and Cash % not 100, default Option for Actual allocation is '5'
610800200529      ***  (Cash % already = Cash Preferred % from Standard Instruction (SECOSIL1)).
610900200529      *
611000200529     C           WCAPR     IFNE 100
611100200529     C                     MOVE '5'       OPTNAA
611200200529     C                     ENDIF
611300200529     C                     ENDIF
611400200529     C******               ENDIF                                          135690
611500200529     C                     ENDIF
611600200529      *
611700200529      ***  If Cash % is 0 (means it is Stock Preferred).
611800200529      *
611900200529     C           WCAPR     IFEQ 0
612000200529      *
612100200529      ***  If Rounding Option from SECOSIL1 = 'U' and Option 2 is allowed, default Option for
612200200529      ***  Actual Allocation is '2' (Cash % is already 0).
612300200529      *
612400200529     C           MOROOP    IFEQ 'U'
612500200529     C           MDOPT2    IFEQ 'Y'
612600200529     C                     MOVE '2'       OPTNAA
612700200529     C                     ELSE
612800200529      *
612900200529      ***  If Rounding Option is 'U' and Option 2 is not allowed and Option 4 is allowed, default
613000200529      ***  Option for Actual Allocation is '4' (Cash % is already 0).
613100200529      *
613200200529     C           MDOPT4    IFEQ 'Y'
613300200529     C                     MOVE '4'       OPTNAA
613400200529     C                     ELSE
613500200529      *
613600200529      ***  If Rounding Option is 'U' and Options 2 and 4 are not allowed and Option 3 is allowed,
613700200529      ***  default Option for Actual Allocation is '3' (Cash % is already 0).
613800200529      *
613900200529     C           MDOPT3    IFEQ 'Y'
614000200529     C                     MOVE '3'       OPTNAA
614100200529     C                     ELSE
614200200529      *
614300200529      ***  If Rounding Option is 'U' and Options 2, 4 and 3 are not allowed and Option 5 is allowed,
614400200529      ***  default Option for Actual Allocation is '5' and Set Cash % to Cash Preferred % from
614500200529      ***  Standard Instruction (SECOSIL1).
614600200529      *
614700200529     C           MDOPT5    IFEQ 'Y'
614800200529     C                     MOVE '5'       OPTNAA
614900200529     C                     Z-ADDMOCAPP    WCAPR
615000200529     C                     ELSE
615100200529      *
615200200529      ***  If Rounding Option is 'U' and Options 2, 4, 3 and 5 are not allowed and Option 1 is
615300200529      ***  allowed, default Option for Actual Allocation is '1' and Set Cash % to 100.
615400200529      *
615500200529     C           MDOPT1    IFEQ 'Y'
615600200529     C                     MOVE '1'       OPTNAA
615700200529     C                     Z-ADD100       WCAPR
615800200529     C                     ELSE
615900200529      *
616000200529      ***  If Rounding Option is 'U' and Options 2, 4, 3, 5 and 1 are not allowed, default
616100200529      ***  Option for Actual Allocation is blank.
616200200529      *
616300200529     C                     MOVE ' '       OPTNAA
616400200529     C                     ENDIF
616500200529     C                     ENDIF
616600200529     C                     ENDIF
616700200529     C                     ENDIF
616800200529     C                     ENDIF
616900200529     C                     ENDIF
617000200529      *
617100200529      ***  If Rounding Option from SECOSIL1 = 'D' and Option 3 is allowed, default Option for
617200200529      ***  Actual Allocation is '3' (Cash % is already 0).
617300200529      *
617400200529     C           MOROOP    IFEQ 'D'
617500200529     C           MDOPT3    IFEQ 'Y'
617600200529     C                     MOVE '3'       OPTNAA
617700200529     C                     ELSE
617800200529      *
617900200529      ***  If Rounding Option is 'D' and Option 3 is not allowed and Option 4 is allowed, default
618000200529      ***  Option for Actual Allocation is '4' (Cash % is already 0).
618100200529      *
618200200529     C           MDOPT4    IFEQ 'Y'
618300200529     C                     MOVE '4'       OPTNAA
618400200529     C                     ELSE
618500200529      *
618600200529      ***  If Rounding Option is 'D' and Options 3 and 4 are not allowed and Option 2 is allowed,
618700200529      ***  default Option for Actual Allocation is '2' (Cash % is already 0).
618800200529      *
618900200529     C           MDOPT2    IFEQ 'Y'
619000200529     C                     MOVE '2'       OPTNAA
619100200529     C                     ELSE
619200200529      *
619300200529      ***  If Rounding Option is 'D' and Options 3, 4 and 2 are not allowed and Option 5 is allowed,
619400200529      ***  default Option for Actual Allocation is '5' and Set Cash % to Cash Preferred % from
619500200529      ***  Standard Instruction (SECOSIL1).
619600200529      *
619700200529     C           MDOPT5    IFEQ 'Y'
619800200529     C                     MOVE '5'       OPTNAA
619900200529     C                     Z-ADDMOCAPP    WCAPR
620000200529     C                     ELSE
620100200529      *
620200200529      ***  If Rounding Option is 'D' and Options 3, 4, 2 and 5 are not allowed and Option 1 is
620300200529      ***  allowed, default Option for Actual Allocation is '1' and Set Cash % to 100.
620400200529      *
620500200529     C           MDOPT1    IFEQ 'Y'
620600200529     C                     MOVE '1'       OPTNAA
620700200529     C                     Z-ADD100       WCAPR
620800200529     C                     ELSE
620900200529      *
621000200529      ***  If Rounding Option is 'D' and Options 3, 4, 2, 5 and 1 are not allowed, default
621100200529      ***  Option for Actual Allocation is blank.
621200200529      *
621300200529     C                     MOVE ' '       OPTNAA
621400200529     C                     ENDIF
621500200529     C                     ENDIF
621600200529     C                     ENDIF
621700200529     C                     ENDIF
621800200529     C                     ENDIF
621900200529     C                     ENDIF
622000200529     C                     ELSE
622100200529      *
622200200529      ***  If Cash % is 100 (means it is Cash Preferred).
622300200529      *
622400200529     C           WCAPR     IFEQ 100
622500200529      *
622600200529      ***  If Option 1 allowed, default Option for Actual Allocation is '1' (Cash % is already
622700200529      ***  100).
622800200529      *
622900200529     C           MDOPT1    IFEQ 'Y'
623000200529     C                     MOVE '1'       OPTNAA
623100200529     C                     ELSE
623200200529      *
623300200529      ***  If Option 1 not allowed and Option 5 allowed, default Option for Actual Allocation is
623400200529      ***  '5' and set Cash % to Cash Preferred % from Standard Instruction (SECOSIL1).
623500200529      *
623600200529     C           MDOPT5    IFEQ 'Y'
623700200529     C                     MOVE '5'       OPTNAA
623800200529     C                     Z-ADDMOCAPP    WCAPR
623900200529     C                     ELSE
624000200529      *
624100200529      ***  If Option 1 and 5 not allowed, set Cash % to 0.
624200200529      *
624300200529     C                     Z-ADD0         WCAPR
624400200529     C                     ENDIF
624500200529     C                     ENDIF
624600200529     C                     ENDIF
624700200529     C                     ENDIF
624800200529     C                     ELSE
624900200529      *
625000200529      ***  If Processing Type = Offers.
625100200529      *
625200200529     C           PPROC     IFEQ 'OF'
625300200529      *
625400200529      ***  If % Accepted is < 50.
625500200529      *
625600200529     C           WCAPR     IFLT 50
625700200529      *
625800200529      ***  If Option 3 is not allowed, default as per % Accepted is 0.
625900200529      *
626000200529     C           MIOPT3    IFNE 'Y'
626100200529     C                     Z-ADD0         WCAPR
626200200529     C                     ELSE
626300200529      *
626400200529      ***  If Option 3 is allowed and % Accepted is not 0, default Option for Actual Allocation is
626500200529      ***  '3' (% Accepted already = Cash Preferred % from Standard Instruction (SECOSIL1)).
626600200529      *
626700200529     C           WCAPR     IFNE 0
626800200529     C                     MOVE '2'       OPTNAA
626900200529     C                     ENDIF
627000200529     C                     ENDIF
627100200529     C                     ELSE
627200200529      *
627300200529      *****If*Cash*%*>*50.*********************************************** 135690
627400200529      ***  Else, if Cash % > or = 50.                                     135690
627500200529      *
627600200529     C******     WCAPR     IFGT 50                                        135690
627700200529      *
627800200529      ***  If Option 3 is not allowed (and % Accepted is > 50), default as per % Accepted is 100.
627900200529      *
628000200529     C           MIOPT3    IFNE 'Y'
628100200529     C                     Z-ADD100       WCAPR
628200200529     C                     ELSE
628300200529      *
628400200529      ***  If Option 3 is allowed and % Accepted is not 100, default Option for Actual Allocation
628500200529      ***  is '3' (% Accepted already = Cash Preferred % from Standard Instruction (SECOSIL1)).
628600200529      *
628700200529     C           WCAPR     IFNE 100
628800200529     C                     MOVE '3'       OPTNAA
628900200529     C                     ENDIF
629000200529     C                     ENDIF
629100200529     C******               ENDIF                                          135690
629200200529     C                     ENDIF
629300200529      *
629400200529      ***  If % Accepted is 0 (means it is refused).
629500200529      *
629600200529     C           WCAPR     IFEQ 0
629700200529      *
629800200529      ***  If Option 2 allowed, default Option for Actual Allocation is '2' (% Accepted is
629900200529      ***  already 0).
630000200529      *
630100200529     C           MIOPT2    IFEQ 'Y'
630200200529     C                     MOVE '2'       OPTNAA
630300200529     C                     ELSE
630400200529      *
630500200529      ***  If Option 2 is not allowed and Option 3 is allowed, default Option for Actual Allocation
630600200529      ***  is '3' and set % Accepted to Cash Preferred % from Standard Instruction (SECOSIL1).
630700200529      *
630800200529     C           MIOPT3    IFEQ 'Y'
630900200529     C                     MOVE '3'       OPTNAA
631000200529     C                     Z-ADDMOCAPP    WCAPR
631100200529     C                     ELSE
631200200529      *
631300200529      ***  If Option 2 and 3 are not allowed and Option 1 is allowed, default Option for Actual
631400200529      ***   Allocation is '1' and set % Accepted to 100.
631500200529      *
631600200529     C           MIOPT1    IFEQ 'Y'
631700200529     C                     MOVE '1'       OPTNAA
631800200529     C                     Z-ADD100       WCAPR
631900200529     C                     ELSE
632000200529      *
632100200529      ***  If Option 2, 3 and 1 are not allowed, default Option for Actual Allocation is blank.
632200200529      *
632300200529     C                     MOVE ' '       OPTNAA
632400200529     C                     ENDIF
632500200529     C                     ENDIF
632600200529     C                     ENDIF
632700200529     C                     ELSE
632800200529      *
632900200529      ***  If % Accepted is 100 (means it is Cash Preferred).
633000200529      *
633100200529     C           WCAPR     IFEQ 100
633200200529      *
633300200529      ***  If Option 1 is allowed, default Option for Actual Allocation is '1' (% Accepted is
633400200529      ***  already 100).
633500200529      *
633600200529     C           MIOPT1    IFEQ 'Y'
633700200529     C                     MOVE '1'       OPTNAA
633800200529     C                     ELSE
633900200529      *
634000200529      ***  If Option 1 is not allowed and Option 3 is allowed, default Option for Actual Allocation
634100200529      ***  is '3' and set % Accepted to Cash Preferred % from Standard Instruction (SECOSIL1).
634200200529      *
634300200529     C           MIOPT3    IFEQ 'Y'
634400200529     C                     MOVE '3'       OPTNAA
634500200529     C                     Z-ADDMOCAPP    WCAPR
634600200529     C                     ELSE
634700200529      *
634800200529      ***  If Option 1 and 3 are not allowed and Option 2 is allowed, default Option for Actual
634900200529      ***  Allocation is '2' and set % Accepted to 0.
635000200529      *
635100200529     C           MIOPT2    IFEQ 'Y'
635200200529     C                     MOVE '2'       OPTNAA
635300200529     C                     Z-ADD0         WCAPR
635400200529     C                     ELSE
635500200529      *
635600200529      ***  If Option 1, 3 and 2 are not allowed, default Option for Actual Allocation is blank.
635700200529      *
635800200529     C                     MOVE ' '       OPTNAA
635900200529     C                     ENDIF
636000200529     C                     ENDIF
636100200529     C                     ENDIF
636200200529     C                     ENDIF
636300200529     C                     ENDIF
636400200529     C                     ELSE
636500200529      *
636600200529      *****If*Processing*Type*=*Rights*Issues*or*Exercices*and*********** 135690
636700200529      *****Conversions.************************************************** 135690
636800200529      ***  If Processing Type = Exercices and Conversions.                135690
636900200529      *
637000200529     C******     PPROC     IFEQ 'RG'                                      135690
637100200529     C******     PPROC     OREQ 'EX'                                      135690
637200200529     C           PPROC     IFEQ 'EX'                                      135690
637300200529      *
637400200529      ***  Set Customer Options 1, 2, 3, 4, 5, 6 and 7, depending on Processing Type.
637500200529      *
637600200529     C******     PPROC     IFEQ 'RG'                                      135690
637700200529     C******               MOVE MFOPT1    WUOPT1  1                       135690
637800200529     C******               MOVE MFOPT2    WUOPT2  1                       135690
637900200529     C******               MOVE MFOPT3    WUOPT3  1                       135690
638000200529     C******               MOVE MFOPT4    WUOPT4  1                       135690
638100200529     C******               MOVE MFOPT5    WUOPT5  1                       135690
638200200529     C******               MOVE MFOPT6    WUOPT6  1                       135690
638300200529     C******               MOVE MFOPT7    WUOPT7  1                       135690
638400200529     C******               ELSE                                           135690
638500200529     C******               MOVE MJOPT1    WUOPT1                          135690
638600200529     C******               MOVE MJOPT2    WUOPT2                          135690
638700200529     C******               MOVE MJOPT3    WUOPT3                          135690
638800200529     C******               MOVE MJOPT4    WUOPT4                          135690
638900200529     C******               MOVE MJOPT5    WUOPT5                          135690
639000200529     C******               MOVE MJOPT6    WUOPT6                          135690
639100200529     C******               MOVE MJOPT7    WUOPT7                          135690
639200200529     C                     MOVE MJOPT1    WUOPT1  1                       135690
639300200529     C                     MOVE MJOPT2    WUOPT2  1                       135690
639400200529     C                     MOVE MJOPT3    WUOPT3  1                       135690
639500200529     C                     MOVE MJOPT4    WUOPT4  1                       135690
639600200529     C                     MOVE MJOPT5    WUOPT5  1                       135690
639700200529     C                     MOVE MJOPT6    WUOPT6  1                       135690
639800200529     C                     MOVE MJOPT7    WUOPT7  1                       135690
639900200529     C******               ENDIF                                          135690
640000200529      *
640100200529      ***  If Cash % is < 50.
640200200529      *
640300200529     C           WCAPR     IFLT 50
640400200529      *
640500200529      *****If*Option*5*and*6*are*not*allowed,*default*as*per*Cash*%*is*0. 161732
640600200529      ** If Option 5 is not allowed, set Cash % to 0.                     161732
640700200529      *
640800200529     C           WUOPT5    IFNE 'Y'
640900200529     C***********WUOPT6    ANDNE'Y'                                       161732
641000200529     C                     Z-ADD0         WCAPR
641100200529     C                     ENDIF
641200200529      *
641300200529      *****If*Option*5*and*6*are*allowed*and*Cash*%*is*not*0.             161732
641400200529      ** If Cash % is not 0, and either Option 5 or 6 is allowed:         161732
641500200529      *
641600200529     C           WUOPT5    IFEQ 'Y'
641700200529     C           WCAPR     ANDNE0                                         161732
641800200529     C***********WUOPT6    ANDEQ'Y'                                       161732
641900200529     C           WUOPT6    OREQ 'Y'                                       161732
642000200529     C           WCAPR     ANDNE0
642100200529      *
642200200529      ***  If Convertible/Keep Indicator from Standard Instruction (SECOSIL1) is 'C', default
642300200529      ***  Option for Actual Allocation is '5' (Cash % already = Cash Preferred % from Standard
642400200529      ***  Instruction (SECOSIL1)).
642500200529      *
642600200529     C           MOCKIN    IFEQ 'C'
642700200529     C                     MOVE '5'       OPTNAA
642800200529     C                     ENDIF
642900200529      *
643000200529      ***  If Convertible/Keep Indicator from Standard Instruction (SECOSIL1) is 'K', default
643100200529      ***  Option for Actual Allocation is '6' (Cash % already = Cash Preferred % from Standard
643200200529      ***  Instruction (SECOSIL1)).
643300200529      *
643400200529     C           MOCKIN    IFEQ 'K'
643500200529     C                     MOVE '6'       OPTNAA
643600200529     C                     ENDIF
643700200529     C                     ENDIF
643800200529     C                     ELSE
643900200529      *
644000200529      *****If*Cash*%*>*50.*********************************************** 135690
644100200529      ***  Else, if Cash % > or = 50.                                     135690
644200200529      *
644300200529     C******     WCAPR     IFGT 50                                        135690
644400200529      *
644500200529      *****If*Option*5*and*6*are*not*allowed,*default*as*per*Cash*%*is*100161732
644600200529      ** If Option 5 is not allowed, set Cash % to 100.                   161732
644700200529      *
644800200529     C           WUOPT5    IFNE 'Y'
644900200529     C***********WUOPT6    ANDNE'Y'                                       161732
645000200529     C                     Z-ADD100       WCAPR
645100200529     C                     ENDIF
645200200529      *
645300200529      *****If*Option*5*and*6*are*allowed*and*Cash*%*is*not*0.             161732
645400200529      ** If Cash % is not 100, and either Option 5 or 6 is allowed:       161732
645500200529      *
645600200529     C           WUOPT5    IFEQ 'Y'
645700200529     C           WCAPR     ANDNE100                                       161732
645800200529     C***********WUOPT6    ANDEQ'Y'                                       161732
645900200529     C           WUOPT6    OREQ 'Y'                                       161732
646000200529     C           WCAPR     ANDNE100
646100200529      *
646200200529      ***  If Convertible/Keep Indicator from Standard Instruction (SECOSIL1) is 'C', default
646300200529      ***  Option for Actual Allocation is '5' (Cash % already = Cash Preferred % from Standard
646400200529      ***  Instruction (SECOSIL1)).
646500200529      *
646600200529     C           MOCKIN    IFEQ 'C'
646700200529     C                     MOVE '5'       OPTNAA
646800200529     C                     ENDIF
646900200529      *
647000200529      ***  If Convertible/Keep Indicator from Standard Instruction (SECOSIL1) is 'K', default
647100200529      ***  Option for Actual Allocation is '6' (Cash % already = Cash Preferred % from Standard
647200200529      ***  Instruction (SECOSIL1)).
647300200529      *
647400200529     C           MOCKIN    IFEQ 'K'
647500200529     C                     MOVE '6'       OPTNAA
647600200529     C                     ENDIF
647700200529     C                     ENDIF
647800200529     C******               ENDIF                                          135690
647900200529     C                     ENDIF
648000200529      *
648100200529      ***  If Cash % is 0 (means it is Stock Preferred).
648200200529      *
648300200529     C           WCAPR     IFEQ 0
648400200529      *
648500200529      ***  If Convertible/Keep Indicator from Standard Instruction (SECOSIL1) is 'K'
648600200529      *
648700200529     C           MOCKIN    IFEQ 'K'
648800200529      *
648900200529      ***  If Option 7 is allowed, default Option for Actual Allocation is '7' (Cash % already
649000200529      ***  = 0).
649100200529      *
649200200529     C           WUOPT7    IFEQ 'Y'
649300200529     C                     MOVE '7'       OPTNAA
649400200529     C                     ENDIF
649500200529     C                     ENDIF
649600200529      *
649700200529      ***  If Convertible/Keep Indicator from Standard Instruction (SECOSIL1) is 'C'
649800200529      *
649900200529     C           MOCKIN    IFEQ 'C'
650000200529      *
650100200529      ***  If Rounding Option from Standard Instruction (SECOSIL1) is 'U'.
650200200529      *
650300200529     C           MOROOP    IFEQ 'U'
650400200529      *
650500200529      ***  If Rounding Option from Standard Instruction (SECOSIL1) is 'U' and Option 2 is allowed,
650600200529      ***  default Option for Actual Allocation is '2' (Cash % already = 0).
650700200529      *
650800200529     C           WUOPT2    IFEQ 'Y'
650900200529     C                     MOVE '2'       OPTNAA
651000200529     C                     ELSE
651100200529      *
651200200529      ***  If Rounding Option from Standard Instruction (SECOSIL1) is 'U' and Option 2 is not
651300200529      ***  allowed and Option 4 is allowed, default Option for Actual Allocation is '4'
651400200529      ***  (Cash % already = 0).
651500200529      *
651600200529     C           WUOPT4    IFEQ 'Y'
651700200529     C                     MOVE '4'       OPTNAA
651800200529     C                     ELSE
651900200529      *
652000200529      ***  If Rounding Option from Standard Instruction (SECOSIL1) is 'U' and Options 2 and 4 are
652100200529      ***  not allowed and Option 3 is allowed, default Option for Actual Allocation is '3'
652200200529      ***  (Cash % already = 0).
652300200529      *
652400200529     C           WUOPT3    IFEQ 'Y'
652500200529     C                     MOVE '3'       OPTNAA
652600200529     C                     ELSE
652700200529      *
652800200529      ***  If Rounding Option from Standard Instruction (SECOSIL1) is 'U' and Options 2, 4 and 3 are
652900200529      ***  not allowed and Option 5 is allowed, default Option for Actual Allocation is '5' and
653000200529      ***  set Cash % to Cash Preferred % from Standard Instruction (SECOSIL1).
653100200529      *
653200200529     C           WUOPT5    IFEQ 'Y'
653300200529     C                     MOVE '5'       OPTNAA
653400200529     C                     Z-ADDMOCAPP    WCAPR
653500200529     C                     ELSE
653600200529      *
653700200529      ***  If Rounding Option from Standard Instruction (SECOSIL1) is 'U' and Options 2, 4, 3 and 5
653800200529      ***  are not allowed and Option 1 is allowed, default Option for Actual Allocation is '1'
653900200529      ***  and set Cash % to 100.
654000200529      *
654100200529     C           WUOPT1    IFEQ 'Y'
654200200529     C                     MOVE '1'       OPTNAA
654300200529     C                     Z-ADD100       WCAPR
654400200529     C                     ELSE
654500200529      *
654600200529      ***  If Rounding Option from Standard Instruction (SECOSIL1) is 'U' and Options 2, 4, 3, 5
654700200529      ***  and 1 are not allowed, default Option for Actual Allocation is blank.
654800200529      *
654900200529     C                     MOVE ' '       OPTNAA
655000200529     C                     ENDIF
655100200529     C                     ENDIF
655200200529     C                     ENDIF
655300200529     C                     ENDIF
655400200529     C                     ENDIF
655500200529     C                     ENDIF
655600200529      *
655700200529      ***  If Rounding Option from Standard Instruction (SECOSIL1) is 'D'.
655800200529      *
655900200529     C           MOROOP    IFEQ 'D'
656000200529      *
656100200529      ***  If Rounding Option from Standard Instruction (SECOSIL1) is 'D' and Option 3 is allowed,
656200200529      ***  default Option for Actual Allocation is '3' (Cash % already = 0).
656300200529      *
656400200529     C           WUOPT3    IFEQ 'Y'
656500200529     C                     MOVE '3'       OPTNAA
656600200529     C                     ELSE
656700200529      *
656800200529      ***  If Rounding Option from Standard Instruction (SECOSIL1) is 'D' and Option 3 is not
656900200529      ***  allowed and Option 4 is allowed, default Option for Actual Allocation is '4' (Cash %
657000200529      ***  already = 0).
657100200529      *
657200200529     C           WUOPT4    IFEQ 'Y'
657300200529     C                     MOVE '4'       OPTNAA
657400200529     C                     ELSE
657500200529      *
657600200529      ***  If Rounding Option from Standard Instruction (SECOSIL1) is 'D' and Options 3 and 4 are
657700200529      ***  not allowed and Option 2 is allowed, default Option for Actual Allocation is '2' (Cash %
657800200529      ***  already = 0).
657900200529      *
658000200529     C           WUOPT2    IFEQ 'Y'
658100200529     C                     MOVE '2'       OPTNAA
658200200529     C                     ELSE
658300200529      *
658400200529      ***  If Rounding Option from Standard Instruction (SECOSIL1) is 'D' and Options 3, 4 and 2 are
658500200529      ***  not allowed and Option 5 is allowed, default Option for Actual Allocation is '5' and set
658600200529      ***  Cash % to Cash Preferred % from Standard Instruction (SECOSIL1).
658700200529      *
658800200529     C           WUOPT5    IFEQ 'Y'
658900200529     C                     MOVE '5'       OPTNAA
659000200529     C                     Z-ADDMOCAPP    WCAPR
659100200529     C                     ELSE
659200200529      *
659300200529      ***  If Rounding Option from Standard Instruction (SECOSIL1) is 'D' and Options 3, 4, 2 and 5
659400200529      ***  are not allowed and Option 1 is allowed, default Option for Actual Allocation is '1' and
659500200529      ***  set Cash % to 100.
659600200529      *
659700200529     C           WUOPT1    IFEQ 'Y'
659800200529     C                     MOVE '1'       OPTNAA
659900200529     C                     Z-ADD100       WCAPR
660000200529     C                     ELSE
660100200529      *
660200200529      ***  If Rounding Option from Standard Instruction (SECOSIL1) is 'D' and Options 3, 4, 2, 5 and
660300200529      ***  1 are not allowed, default Option for Actual Allocation is blank.
660400200529      *
660500200529     C                     MOVE ' '       OPTNAA
660600200529     C                     ENDIF
660700200529     C                     ENDIF
660800200529     C                     ENDIF
660900200529     C                     ENDIF
661000200529     C                     ENDIF
661100200529     C                     ENDIF
661200200529     C                     ENDIF
661300200529     C                     ELSE
661400200529      *
661500200529      ***  If Cash % is 100 (means it is Cash Preferred).
661600200529      *
661700200529     C           WCAPR     IFEQ 100
661800200529      *
661900200529      ***  If Option 1 is allowed, default Option for Actual Allocation is '1' (Cash % already
662000200529      ***  = 100).
662100200529      *
662200200529     C           WUOPT1    IFEQ 'Y'
662300200529     C                     MOVE '1'       OPTNAA
662400200529     C                     ELSE
662500200529      *
662600200529      ***  If Option 1 is not allowed, default as per Cash % is 0.
662700200529      *
662800200529     C                     Z-ADD0         WCAPR
662900200529     C                     ENDIF
663000200529     C                     ENDIF
663100200529     C                     ENDIF
663200200529     C                     ENDIF
663300200529     C                     ENDIF
663400200529     C                     ENDIF
663500200529     C                     ENDIF
663600200529      *
663700200529      ***  CASE 2.2: IF Customer/Book Standard Corporate Action Instruction does not exist
663800200529      ***               (and Customer/Book Current Reply does not exist),
663900200529      ***            OR if Customer/Book Standard Corporate Action Instruction exist BUT default
664000200529      ***               Option (Option for Actual Allocation calculated in CASE 2.1 or retrieve
664100200529      ***               from Standard Instruction (SECOSIL1) in CASE 2) is blank (and Customer/Book
664200200529      ***               Current Reply does not exist).
664300200529      *
664400200529     C           EXBCSI    IFEQ 'N'
664500200529     C           EXBCSI    OREQ 'Y'
664600200529     C           OPTNAA    ANDEQ' '
664700200529      *
664800200529      ***  Set Option for Actual Allocation 2 to Default for No Reply from Corporate Actions
664900200529      ***  Detail (SECOxxL1, where xx = 'DV', 'RG', 'OF' or 'EX')
665000200529      *
665100200529     C                     MOVE MDDFNR    OPTNAA
665200200529      *
665300200529      ***  If Processing Type = Dividend Events.
665400200529      *
665500200529     C           PPROC     IFEQ 'DV'
665600200529      *
665700200529      ***  If Option 1 selected: Cash Payment/Sell Rights, set Cash % to 100.
665800200529      *
665900200529     C           OPTNAA    IFEQ '1'
666000200529     C                     Z-ADD100       WCAPR
666100200529     C                     ELSE
666200200529      *
666300200529      ***  If Option selected is 2: Take Stock+Buy Additional Rights or 3: Take Stock+Sell Excess
666400200529      ***  Rights or 4: Take Stock, set Cash % to 0.
666500200529      *
666600200529     C           OPTNAA    IFEQ '2'
666700200529     C           OPTNAA    OREQ '3'
666800200529     C           OPTNAA    OREQ '4'
666900200529     C                     Z-ADD0         WCAPR
667000200529     C                     ELSE
667100200529      *
667200200529      ***  Else, Default No Reply will not be an Option which requires the entry of the %).
667300200529      *
667400200529     C                     MOVE ' '       OPTNAA
667500200529     C                     ENDIF
667600200529     C                     ENDIF
667700200529     C                     ELSE
667800200529      ******                                                              135690
667900200529      *****If*Processing*Type*=*Rights*Issues.*************************** 135690
668000200529      ******                                                              135690
668100200529     C******     PPROC     IFEQ 'RG'                                      135690
668200200529      ******                                                              135690
668300200529      *****If*Option*1*selected:*Sell*all*Rights,*set*Cash*%*to*100.***** 135690
668400200529      ******                                                              135690
668500200529     C******     OPTNAA    IFEQ '1'                                       135690
668600200529     C******               Z-ADD100       WCAPR                           135690
668700200529     C******               ELSE                                           135690
668800200529      ******                                                              135690
668900200529      *****If*Option*selected*is*2:*Take*Stock+Buy*Fraction*or*3:*Take*** 135690
669000200529      *****Stock+Sell*Fraction*or*4:*Take*Stock*or*7:*Do*nothing,*set**** 135690
669100200529      *****Cash*%*to*0.************************************************** 135690
669200200529      ******                                                              135690
669300200529     C******     OPTNAA    IFEQ '2'                                       135690
669400200529     C******     OPTNAA    OREQ '3'                                       135690
669500200529     C******     OPTNAA    OREQ '4'                                       135690
669600200529     C******     OPTNAA    OREQ '7'                                       135690
669700200529     C******               Z-ADD0         WCAPR                           135690
669800200529     C******               ELSE                                           135690
669900200529      ******                                                              135690
670000200529      *****Else,*Default*No*Reply*will*not*be*an*Option*which*requires*** 135690
670100200529      *****the*entry*of*the*%).****************************************** 135690
670200200529      ******                                                              135690
670300200529     C******               MOVE ' '       OPTNAA                          135690
670400200529     C******               ENDIF                                          135690
670500200529     C******               ENDIF                                          135690
670600200529     C******               ELSE                                           135690
670700200529      *
670800200529      ***  If Processing Type = Offers.
670900200529      *
671000200529     C           PPROC     IFEQ 'OF'
671100200529      *
671200200529      ***  If Option 1 selected: Accept Offer, set Cash % to 100.
671300200529      *
671400200529     C           OPTNAA    IFEQ '1'
671500200529     C                     Z-ADD100       WCAPR
671600200529     C                     ELSE
671700200529      *
671800200529      ***  If Option 2 selected: Refuse Offer, set Cash % to 0.
671900200529      *
672000200529     C           OPTNAA    IFEQ '2'
672100200529     C                     Z-ADD0         WCAPR
672200200529     C                     ELSE
672300200529      *
672400200529      ***  Else, Default No Reply will not be an Option which requires the entry of the %).
672500200529      *
672600200529     C                     MOVE ' '       OPTNAA
672700200529     C                     ENDIF
672800200529     C                     ENDIF
672900200529     C                     ELSE
673000200529      *
673100200529      ***  If Processing Type = Exercices and Conversions.
673200200529      *
673300200529     C           PPROC     IFEQ 'EX'
673400200529      *
673500200529      ***  If Option 1 selected: Sell all Rights, set Cash % to 100.
673600200529      *
673700200529     C           OPTNAA    IFEQ '1'
673800200529     C                     Z-ADD100       WCAPR
673900200529     C                     ELSE
674000200529      *
674100200529      ***  If Option selected is 2: Take Stock+Buy Fraction or 3: Take Stock+Sell Fraction or 4:
674200200529      ***  Take Stock or 7: Do nothing, set Cash % to 0.
674300200529      *
674400200529     C           OPTNAA    IFEQ '2'
674500200529     C           OPTNAA    OREQ '3'
674600200529     C           OPTNAA    OREQ '4'
674700200529     C           OPTNAA    OREQ '7'
674800200529     C                     Z-ADD0         WCAPR
674900200529     C                     ELSE
675000200529      *
675100200529      ***  Else, Default No Reply will not be an Option which requires the entry of the %).
675200200529      *
675300200529     C                     MOVE ' '       OPTNAA
675400200529     C                     ENDIF
675500200529     C                     ENDIF
675600200529     C                     ENDIF
675700200529     C                     ENDIF
675800200529     C                     ENDIF
675900200529     C                     ENDIF
676000200529     C******               ENDIF                                          135690
676100200529     C                     ENDIF
676200200529      *
676300200529      ***  If Option not selected, set Cash % to 0 and 'Special Work Field' to 'N', it means that
676400200529      ***  the Actual Allocation fields must not be calculated.
676500200529      *
676600200529     C           OPTNAA    IFEQ ' '
676700200529     C                     Z-ADD0         WCAPR
676800200529     C                     MOVE 'N'       SPWRKF
676900200529     C                     ENDIF
677000200529     C                     ENDIF
677100200529      *
677200200529     C                     ENDSR
677300200529      *
677400200529      *****************************************************************
677500200529      /EJECT
677600200529      *****************************************************************
677700200529      *                                                               *
677800200529      *  RTVRPL - Retrieve Customer/Book Current Reply and Customer/  *
677900200529      *           Book Standard Corporate Action Instruction.         *
678000200529      *                                                               *
678100200529      *  Called by:                                                   *
678200200529      *  Calls:                                                       *
678300200529      *                                                               *
678400200529      *****************************************************************
678500200529      *
678600200529     C           RTVRPL    BEGSR                           ** RTVRPL SR **
678700200529      *
678800200529      ***  Set 'Customer/Book Current Reply Exists' work field to 'N'.
678900200529      *
679000200529     C                     MOVE 'N'       EXBCRE  1        Current Reply exist
679100200529      *
679200200529      ***  Retrieve current Reply with CO Reference, Branch, Customer/Book Indicator, Book and
679300200529      ***  Customer.
679400200529      *
679500200529     C                     MOVE PCORF     WKCORF
679600200529     C                     MOVE PBRCD     WKBRCD
679700200529     C                     MOVE SHCOTP    WKCOTP
679800200529     C                     MOVE SHBOOK    WKBOOK
679900200529     C                     MOVE SHCNUM    WKCNUM
680000200529     C           WKEY6     SETGTSECOREL1
680100200529     C           WKEY6     REDPESECOREL1                 82
680200200529      *
680300200529      ***  If record found and live.
680400200529      *
680500200529     C           *IN82     IFEQ '0'                        Found
680600200529     C           MQRECI    ANDEQ'D'                        Live
680700200529      *
680800200529      ***  Set 'Customer/Book Current Reply Exists' work field to 'Y'.
680900200529      *
681000200529     C                     MOVE 'Y'       EXBCRE
681100200529     C                     ENDIF
681200200529      *
681300200529      ***  Set 'Customer/Book Standard CO Instruction Exists' work field to 'N'.
681400200529      *
681500200529     C                     MOVE 'N'       EXBCSI  1        Standard Instruction exist
681600200529      *
681700200529      ***  If Book Calculation.
681800200529      *
681900200529     C           SHCOTP    IFEQ 'B'
682000200529      *
682100200529      ***  Retrieve the Standard Instructions for Books by accessing LF/SECOSIL2 with Branch
682200200529      ***  Book, Corporate Action Type and New Security.
682300200529      *
682400200529     C                     MOVE SHBOOK    WKBOOK
682500200529     C                     MOVE PACT      WKCOAT
682600200529     C                     MOVE PNWSEC    WKNSEC
682700200529     C           WKEY7     SETGTSECOSIL2
682800200529     C           WKEY7     REDPESECOSIL2                 83
682900200529      *
683000200529      ***  If no record found, access with Branch, Book, Corporate Action Type and Security = blank.
683100200529      *
683200200529     C           *IN83     IFEQ '1'
683300200529     C           MORECI    ORNE 'D'
683400200529     C                     MOVE *BLANKS   WKNSEC
683500200529     C           WKEY7     SETGTSECOSIL2
683600200529     C           WKEY7     REDPESECOSIL2                 83
683700200529      *
683800200529      ***  If no record found, access with Branch, Book and Corporate Action Type and Security
683900200529      ***  = blank.
684000200529      *
684100200529     C           *IN83     IFEQ '1'
684200200529     C           MORECI    ORNE 'D'
684300200529     C                     MOVE *BLANKS   WKCOAT
684400200529     C           WKEY7     SETGTSECOSIL2
684500200529     C           WKEY7     REDPESECOSIL2                 83
684600200529      *
684700200529      ***  If no record found, access with Branch and Book, Corporate Action Type and Security
684800200529      ***  = blank.
684900200529      *
685000200529     C           *IN83     IFEQ '1'
685100200529     C           MORECI    ORNE 'D'
685200200529     C                     MOVE *BLANKS   WKBOOK
685300200529     C           WKEY7     SETGTSECOSIL2
685400200529     C           WKEY7     REDPESECOSIL2                 83
685500200529     C                     ENDIF
685600200529     C                     ENDIF
685700200529     C                     ENDIF
685800200529      *
685900200529      ***  If Customer Calculation.
686000200529      *
686100200529     C                     ELSE
686200200529      *
686300200529      ***  Retrieve the Standard Instructions for Customer by accessing LF/SECOSIL1 with Branch,
686400200529      ***  Customer, Portfolio Reference, Corporate Action Type and Security.
686500200529      *
686600200529     C**********           Z-ADDSHCNUM    WKCNUM                                              CSD027
686700200529     C                     MOVE SHCNUM    WKCNUM                                              CSD027
686800200529     C                     MOVE SHPORT    WKPORT
686900200529     C                     MOVE PACT      WKCOAT
687000200529     C                     MOVE PNWSEC    WKNSEC
687100200529     C           WKEY8     SETGTSECOSIL1
687200200529     C           WKEY8     REDPESECOSIL1                 83
687300200529      *
687400200529      ***  If no record found, access with Branch, Customer, Portfolio Reference and Corporate
687500200529      ***  Action Type and Security = blank.
687600200529      *
687700200529     C           *IN83     IFEQ '1'
687800200529     C           MORECI    ORNE 'D'
687900200529     C                     MOVE *BLANKS   WKNSEC
688000200529     C           WKEY8     SETGTSECOSIL1
688100200529     C           WKEY8     REDPESECOSIL1                 83
688200200529      *
688300200529      ***  If no record found, access with Branch, Customer and Portfolio Reference and Corporate
688400200529      ***  Action Type and Security = blank.
688500200529      *
688600200529     C           *IN83     IFEQ '1'
688700200529     C           MORECI    ORNE 'D'
688800200529     C                     MOVE *BLANKS   WKCOAT
688900200529     C           WKEY8     SETGTSECOSIL1
689000200529     C           WKEY8     REDPESECOSIL1                 83
689100200529      *
689200200529      ***  If no record found, access with Branch and  Customer and Portfolio Reference, Corporate
689300200529      ***  Action Type and Security = blank.
689400200529      *
689500200529     C           *IN83     IFEQ '1'
689600200529     C           MORECI    ORNE 'D'
689700200529     C                     MOVE *BLANKS   WKPORT
689800200529     C           WKEY8     SETGTSECOSIL1
689900200529     C           WKEY8     REDPESECOSIL1                 83
690000200529      *
690100200529      ***  If no record found, access with Branch and Customer = 0 and Porfolio Reference,
690200200529      ***  Corporate Action Type and Security = blank.
690300200529      *
690400200529     C           *IN83     IFEQ '1'
690500200529     C           MORECI    ORNE 'D'
690600200529     C**********           Z-ADD*ZEROS    WKCNUM                                              CSD027
690700200529     C                     MOVE *BLANKS   WKCNUM                                              CSD027
690800200529     C           WKEY8     SETGTSECOSIL1
690900200529     C           WKEY8     REDPESECOSIL1                 83
691000200529     C                     ENDIF
691100200529     C                     ENDIF
691200200529     C                     ENDIF
691300200529     C                     ENDIF
691400200529     C                     ENDIF
691500200529      *
691600200529      ***  If Standard Corporate Actions Instruction exists (record found with one of the access).
691700200529      *
691800200529     C           *IN83     IFEQ '0'
691900200529     C           MORECI    ANDEQ'D'
692000200529      *
692100200529      ***  Set 'Customer/Booh Standard Instruction Exists' work field to 'Y'.
692200200529      *
692300200529     C                     MOVE 'Y'       EXBCSI
692400200529     C                     ENDIF
692500200529      *
692600200529     C                     ENDSR
692700200529      *
692800200529      *****************************************************************
692900200529      /EJECT
693000200529      *****************************************************************
693100200529      *                                                               *
693200200529      *  REACAA - Recalculate Actual Cash Allocation.                 *
693300200529      *                                                               *
693400200529      *  Called by:                                                   *
693500200529      *                                                               *
693600200529      *  Calls:                                                       *
693700200529      *                                                               *
693800200529      *****************************************************************
693900200529      *
694000200529     C           REACAA    BEGSR                           ** REACAA SR **
694100200529      *
694200200529      ***  Prepare Dividend Per Unit: from file if Processing Type = Dividends Events,
694300200529      ***                             = Receive Price if Processing Type = Offers and Offer Type =
694400200529      ***                               Exchange Offers or Purchase Offer,
694500200529      ***                             = Subscription Price if Processing Type = Offers and Offer
694600200529      ***                               Type = Subsrciption Offer.
694700200529      *
694800200529     C           PPROC     IFEQ 'DV'
694900200529     C******               Z-ADDNMDP2     WWNBDP           New Sec.Dec.Pl.135690
695000200529     C**********           Z-ADDNMDPC2    WWNBDP           New Cur.135690 190204
695100200529     C**********           Z-ADDMDDIVU    WUNUM                           190204
695200200529     C**********           EXSR RTVNDP                                    190204
695300200529     C**********           Z-ADDWWNUM     WWDIVU 309                      190204
695400200529     C                     Z-ADDMDDIV1    WWDIVU 309       13,8 ==>30,9   190204
695500200529     C                     ELSE
695600200529     C           PPROC     IFEQ 'OF'
695700200529     C           MIOFTY    ANDEQ'E'
695800200529     C           PPROC     OREQ 'OF'
695900200529     C           MIOFTY    ANDEQ'P'
696000200529     C                     Z-ADDMIREPR    WWDIVU
696100200529     C                     ELSE
696200200529     C           PPROC     IFEQ 'OF'
696300200529     C           MIOFTY    ANDEQ'S'
696400200529     C                     Z-ADDMISUPR    WWDIVU
696500200529     C                     ELSE
696600200529     C                     Z-ADD0         WWDIVU
696700200529     C                     ENDIF
696800200529     C                     ENDIF
696900200529     C                     ENDIF
697000200529      *
697100200529      *****If*Processing*Type*=*Offers*with*Offer*Type*=*Exchange*or***** 136935
697200200529      *****Subscription,************************************************* 136935
697300200529      ***  If Processing Type = Offers with Offer Type = Exchange,        136935
697400200529      ***  calculate Actual Cash Allocation = Holding Taken as stock previously calculated
697500200529      ***  multiplied by Receive Price.                                   136935
697600200529      *****multiplied*by*Receive*Price*(if*Offer*Type*=*Excahnge*Offers)* 136935
697700200529      *****or*Subscription*Price*(if*Offer*Type*=*Subscription*Price).*** 136935
697800200529      *
697900200529     C           PPROC     IFEQ 'OF'                       If Exchange Offers
698000200529     C           MIOFTY    ANDEQ'E'
698100200529     C******     PPROC     OREQ 'OF'                       Or Subscript.  136935
698200200529     C******     MIOFTY    ANDEQ'S'                           Offers      136935
698300200529     C                     Z-ADDNMDP1     WWNBDP           Event Security Decimal Places
698400200529     C                     Z-ADDWWHOST    WUNUM
698500200529     C                     EXSR RTVNDP
698600200529     C           WWNUM     MULT WWDIVU    WUACAA 309
698700200529      *
698800200529      ***  If Price Basis is 'P' for %, result should be divided by 100.
698900200529      *
699000200529     C           SPBS2     IFEQ 'P'
699100200529     C           WUACAA    DIV  100       WUACAA    H
699200200529     C                     ENDIF
699300200529      *
699400200529      ***  Set Actual Cash Allocation recalculated.
699500200529      *
699600200529     C                     Z-ADDNMDPC2    WWNBDP           New Currency Decimal Places
699700200529     C                     MOVE 'R'       WUROOP           Rounding = half adjust
699800200529     C                     Z-ADDWUACAA    WWNUM
699900200529     C                     EXSR ROUNDD
700000200529     C                     Z-ADDWWNUM     WUACAA
700100200529     C                     EXSR SETNDP
700200200529     C                     Z-ADDWUNUM     MCACAA
700300200529     C                     MOVE 'Y'       AMACAA
700400200529     C                     ELSE
700500200529      *
700600200529      *****If*Processing*Type*=*Exercices*and*Conversions and Customer*** 136935
700700200529      *****Option*1,*2,*3,*4,*5*or*6*is*allowed,************************* 136935
700800200529      ***  If Processing Type = Exercices and Conversions and Option for  136935
700900200529      ***  Allocation 2 = '1', '2', '3', '4', '5' or '6',                 136935
701000200529      ***  calculate Actual Cash Allocation = Holding Taken as Cash previously calculated multiplied
701100200529      ***  by Subscription Price.
701200200529      *
701300200529     C           PPROC     IFEQ 'EX'                       If Exercices and Conversions
701400200529     C******     MJOPT1    IFEQ 'Y'                           Cust.Opt.1  136935
701500200529     C******     MJOPT2    OREQ 'Y'                           Cust.Opt.2  136935
701600200529     C******     MJOPT3    OREQ 'Y'                           Cust.Opt.3  136935
701700200529     C******     MJOPT4    OREQ 'Y'                           Cust.Opt.4  136935
701800200529     C******     MJOPT5    OREQ 'Y'                           Cust.Opt.5  136935
701900200529     C******     MJOPT6    OREQ 'Y'                           Cust.Opt.6  136935
702000200529     C           OPTNAA    IFEQ '1'                           Opt.Alloc=1 136935
702100200529     C           OPTNAA    OREQ '2'                           Opt.Alloc=2 136935
702200200529     C           OPTNAA    OREQ '3'                           Opt.Alloc=3 136935
702300200529     C           OPTNAA    OREQ '4'                           Opt.Alloc=4 136935
702400200529     C           OPTNAA    OREQ '5'                           Opt.Alloc=5 136935
702500200529     C***********OPTNAA    OREQ '6'                           Opt.A136935 161732
702600200529     C                     Z-ADDNMDPC2    WWNBDP           New Currency Decimal Places
702700200529     C                     Z-ADDWWHOCA    WUNUM
702800200529     C                     EXSR RTVNDP
702900200529      *                                                                   161732
703000200529      ** Calculate Actual Cash Allocation =                               161732
703100200529      ** Holding Taken as Cash multiplied by Receive/Cash Price.          161732
703200200529      *                                                                   161732
703300200529     C***********WWNUM     MULT MDSBPR    WUACAA                          161732
703400200529     C           WWNUM     MULT MJRCPR    WUACAA                          161732
703500200529      *
703600200529      ***  If Price Basis is 'P' for %, result should be divided by 100.
703700200529      *
703800200529     C           SPBS2     IFEQ 'P'
703900200529     C           WUACAA    DIV  100       WUACAA
704000200529     C                     ENDIF
704100200529      *
704200200529      ***  Set Actual Cash Allocation recalculated.
704300200529      *
704400200529     C                     MOVE 'R'       WUROOP           Rounding = half adjust
704500200529     C                     Z-ADDWUACAA    WWNUM
704600200529     C                     EXSR ROUNDD
704700200529     C                     Z-ADDWWNUM     WUACAA
704800200529     C                     EXSR SETNDP
704900200529     C                     Z-ADDWUNUM     MCACAA
705000200529     C                     MOVE 'Y'       AMACAA
705100200529     C                     ENDIF
705200200529     C                     ELSE
705300200529      *
705400200529      ***  Calculate Actual Cash Allocation = Holding Taken as Cash calculated before
705500200529      ***  multiplied by Dividend Per Unit, and half adjust.              136935
705600200529      *****multiplied*by*Dividend*Per*Unit*(if*Processing*Type*=********* 136935
705700200529      *****Dividends*Events)*or*Cash*Payment*(if*Processing*Type*=******* 136935
705800200529      *****Corporate*Reorganisation),*and*half*adjust.******************* 136935
705900200529      *
706000200529     C******     PPROC     IFEQ 'OF'                       If Purchase    136935
706100200529     C******     MIOFTY    ANDEQ'P'                           Offer       136935
706200200529     C******     PPROC     OREQ 'DV'                       Or Dividend    136935
706300200529     C           PPROC     IFEQ 'DV'                       If Dividend    136935
706400200529     C           MDSDIT    ANDEQ'C'                           Stk Dividend Tp=Combined for Cash&Stk
706500200529     C           PPROC     OREQ 'DV'                       Or Dividend Events
706600200529     C           MDSDIT    ANDEQ'O'                           Stk Dividend Tp=Optional for Cash&Stk
706700200529     C                     Z-ADDNMDPC2    WWNBDP           New Currency Decimal Places
706800200529     C                     Z-ADDWWHOCA    WUNUM
706900200529     C                     EXSR RTVNDP
707000200529     C           WWNUM     MULT WWDIVU    WUACAA
707100200529      *
707200200529      ***  Set Actual Cash Allocation recalculated.
707300200529      *
707400200529     C                     MOVE 'R'       WUROOP           Rounding = half adjust
707500200529     C                     Z-ADDWUACAA    WWNUM
707600200529     C                     EXSR ROUNDD
707700200529     C                     Z-ADDWWNUM     WUACAA
707800200529     C                     EXSR SETNDP
707900200529     C                     Z-ADDWUNUM     MCACAA
708000200529     C                     MOVE 'Y'       AMACAA
708100200529     C                     ELSE                                           136935
708200200529      *                                                                   136935
708300200529      ***  If Processing Type = Offers with Offer Type = Subscription,    136935
708400200529      ***  calculate Actual Cash Allocation = Actual Stock Allocation     136935
708500200529      ***  multiplied by Subscription Price.                              136935
708600200529      *                                                                   136935
708700200529     C           PPROC     IFEQ 'OF'                                      136935
708800200529     C           MIOFTY    ANDEQ'S'                                       136935
708900200529     C           WUASTA    MULT WWDIVU    WUACAA                          136935
709000200529      *                                                                   136935
709100200529      ***  If Price Basis is 'P' for %, result should be divided by 100.  136935
709200200529      *                                                                   136935
709300200529     C           SPBS2     IFEQ 'P'                                       136935
709400200529     C           WUACAA    DIV  100       WUACAA                          136935
709500200529     C                     ENDIF                                          136935
709600200529      *                                                                   136935
709700200529      ***  Set Actual Cash Allocation recalculated.                       136935
709800200529      *                                                                   136935
709900200529     C                     Z-ADDNMDPC2    WWNBDP           New Cur.Dec.Pl.136935
710000200529     C                     MOVE 'R'       WUROOP           half adjust    136935
710100200529     C                     Z-ADDWUACAA    WWNUM                           136935
710200200529     C                     EXSR ROUNDD                                    136935
710300200529     C                     Z-ADDWWNUM     WUACAA                          136935
710400200529     C                     EXSR SETNDP                                    136935
710500200529     C                     Z-ADDWUNUM     MCACAA                          136935
710600200529     C                     MOVE 'Y'       AMACAA                          136935
710700200529     C                     ENDIF                                          136935
710800200529     C                     ENDIF
710900200529     C                     ENDIF
711000200529     C                     ENDIF
711100200529      *
711200200529     C                     ENDSR
711300200529      *
711400200529      *****************************************************************
711500200529      /EJECT
711600200529      *****************************************************************
711700200529      *                                                               *
711800200529      *  REASTR - Recalculate Actual Stock Rounding.                  *
711900200529      *                                                               *
712000200529      *  Called by:                                                   *
712100200529      *                                                               *
712200200529      *  Calls:                                                       *
712300200529      *                                                               *
712400200529      *****************************************************************
712500200529      *
712600200529     C           REASTR    BEGSR                           ** REASTR SR **
712700200529      *                                                                   136935
712800200529      ***  If Processing Type not Offers or if = Offers with Offer Type = 136935
712900200529      ***  Exchange.                                                      136935
713000200529      *                                                                   136935
713100200529     C           PPROC     IFNE 'OF'                                      136935
713200200529     C           PPROC     OREQ 'OF'                                      136935
713300200529     C           MIOFTY    ANDEQ'E'                                       136935
713400200529      *
713500200529     C                     Z-ADD0         FLDEE
713600200529      *
713700200529      ***  Calculate Stock preferred % = 100 - Cash Preeferred % previously calculated.
713800200529      *
713900200529     C           100       SUB  WCAPR     WSTPR   52
714000200529      *
714100200529      ***  If Current Reply exists and Reply Nominal (= Nominal Taken as Cash from SECOREL0) not 0,
714200200529      ***  calculate work field EE = Holding (= Ex-Date Position) - Reply Nominal (which is in fact
714300200529      ***  Nominal Accepted for Offers, which is Nominal Taken as Cash for Dividend Events or Rights
714400200529      ***  Issues).
714500200529      *
714600200529     C           EXBCRE    IFEQ 'Y'
714700200529     C           MQR2CN    ANDNE0
714800200529      *                                                                   145872
714900200529      ***  If Exchange Offer, calculate base Ex-Date Position = Ex-Date   145872
715000200529      ***  Position multiplied by Percentage to Exchange.                 145872
715100200529      *                                                                   145872
715200200529     C           PPROC     IFEQ 'OF'                                      145872
715300200529     C           MIOFTY    ANDEQ'E'                                       145872
715400200529     C           SHTDVD    MULT MIPREX    WUTDVD 249                      145872
715500200529     C           SHTDVD    DIV  100       WUTDVD                          145872
715600200529     C                     Z-ADDNMDP2     WWNBDP           New Sec.Dec.Pl.145872
715700200529     C                     MOVE WWRNDN    WUROOP           CO Det. Round. 145872
715800200529     C                     Z-ADDWUTDVD    WWNUM                           145872
715900200529     C                     EXSR ROUNDD                                    145872
716000200529     C                     Z-ADDWWNUM     WUTDVD                          145872
716100200529     C                     ENDIF                                          145872
716200200529      *                                                                   145872
716300200529     C                     Z-ADDNMDP1     WWNBDP           EVENT SECURITY DECIMAL PLACES
716400200529     C                     Z-ADDMQR2CN    WUNUM
716500200529     C                     EXSR RTVNDP
716600200529     C           PPROC     IFEQ 'OF'                                      145872
716700200529     C           MIOFTY    ANDEQ'E'                                       145872
716800200529     C           WUTDVD    SUB  WWNUM     FLDEE  249                      145872
716900200529     C                     ELSE                                           145872
717000200529     C           SHTDVD    SUB  WWNUM     FLDEE  249
717100200529     C                     ENDIF                                          145872
717200200529      *
717300200529      ***  Else, if Current Reply does not exist or Current Reply exists and Reply Nominal (=
717400200529      ***  Nominal Taken as Cash from SECOREL0) is 0.
717500200529      *
717600200529     C                     ELSE
717700200529      *
717800200529      ***  If Processing Type = Offers, calculate work field EE = True Stock Allocation previously
717900200529      ***  calculated multiplied by Cash Preferred % (which is in fact % Accepted) previously
718000200529      ***  calculated.
718100200529      *
718200200529     C           PPROC     IFEQ 'OF'                       If Offers
718300200529     C           SHOTSA    MULT WCAPR     FLDEE
718400200529     C           FLDEE     DIV  100       FLDEE
718500200529     C                     ELSE
718600200529      *
718700200529      ***  Else, if Processing Type not Offers, calculated work field EE = True Stock Allocation
718800200529      ***  previously calculated multiplied by Stock Preferred % calculated.
718900200529      *
719000200529     C           SHOTSA    MULT WSTPR     FLDEE
719100200529     C           FLDEE     DIV  100       FLDEE
719200200529     C                     ENDIF
719300200529     C                     ENDIF
719400200529      *
719500200529      ***  Calculate Actual Stock Rounding = work field EE -
719600200529      ***  Actual Stock Allocation entered.
719700200529      *
719800200529     C           FLDEE     SUB  WUASAL    WUASTR 309
719900200529     C                     Z-ADD8         WWNBDP           8 Decimal Places
720000200529     C                     MOVE WWRNDN    WUROOP  1        Rounding from CO Detail file
720100200529     C                     Z-ADDWUASTR    WWNUM
720200200529     C                     EXSR ROUNDD
720300200529     C                     Z-ADDWWNUM     WUASTR
720400200529      *
720500200529     C                     Z-ADDWUASTR    WWASTR 158
720600200529     C                     MOVE 'Y'       AMASTR
720700200529     C                     MOVE *BLANKS   SASRO
720800200529     C           WWASTR    IFNE 0
720900200529     C                     MOVE *BLANKS   ZFLD15
721000200529     C                     MOVE WWASTR    ZFLD15
721100200529     C                     Z-ADD8         ZDECS            8 Decimal Places
721200200529     C                     EXSR ZSEDIT
721300200529     C                     MOVE ZOUT21    SASRO
721400200529     C                     ENDIF
721500200529     C                     ENDIF                                          136935
721600200529      *
721700200529     C                     ENDSR
721800200529      *
721900200529      *****************************************************************
722000200529      /EJECT
722100200529      *****************************************************************
722200200529      *                                                               *
722300200529      *  REHOST - Recalculate Holding Taken as Stock.                 *
722400200529      *                                                               *
722500200529      *  Called by:                                                   *
722600200529      *                                                               *
722700200529      *  Calls:                                                       *
722800200529      *                                                               *
722900200529      *****************************************************************
723000200529      *
723100200529     C           REHOST    BEGSR                           ** REHOST SR **
723200200529      *
723300200529     C           PPROC     IFEQ 'DV'                       If CO Type = Dividends Events
723400200529      *
723500200529      ***  Retrieve Current Reply and Standard Instruction.
723600200529      *
723700200529     C                     EXSR RTVRPL
723800200529      *
723900200529      *****If*Standard*Instruction*exist.******************************** 135690
724000200529      ***  If Current Reply does not exist or Current Reply exists and    135690
724100200529      ***  Reply Nominal (= Nominal Taken as Cash Level 2) = 0.           135690
724200200529      *
724300200529     C******     EXBCSI    IFEQ 'Y'                                       135690
724400200529     C           EXBCRE    IFEQ 'N'                                       135690
724500200529     C           EXBCRE    OREQ 'Y'                                       135690
724600200529     C           MQR2CN    ANDEQ0                                         135690
724700200529      *
724800200529      ***  If Cash Preferred % not equal 100 and not equal 0.
724900200529      *
725000200529     C******     MOCAPP    IFNE 100                                       135690
725100200529     C******     MOCAPP    ANDNE0                                         135690
725200200529     C           WCAPR     IFNE 0                                         135690
725300200529     C           WCAPR     ANDNE100                                       135690
725400200529      *
725500200529      ***  If Number of Old and New Shares from SECODVL1 not equal 0.
725600200529      *
725700200529     C           MDNSHA    IFNE 0
725800200529     C           MDOSHA    ANDNE0
725900200529      *
726000200529      ***  Calculate Holding Taken as Stock = (Actual Stock Allocation entered
726100200529      ***  divided by Number of New Shares) multiplied by Number of Old Shares and rounded up.
726200200529      *
726300200529     C                     Z-ADDMDNSHA    WWNSHA                    161591
726400200529     C           WUASAL    DIV  WWNSHA    W1HOST 309
726500200529     C           W1HOST    MULT MDOSHA    WUHOST 309
726600200529      *
726700200529      ***  Else, if Number of Old or New Shares from SECODVL1 equal 0.
726800200529      *
726900200529     C                     ELSE
727000200529      *
727100200529      ***  Calculate Holding Taken as Stock = (Actual Stock Allocation entered
727200200529      ***  multiplied by Subscription Price) divided by Dividend Per Unit.
727300200529      *
727400200529     C           WUASAL    MULT MDSBPR    W1HOST
727500200529      *
727600200529      ***  If Price Basis is 'P' for %, result should be divided by 100.
727700200529      *
727800200529     C           SPBS2     IFEQ 'P'
727900200529     C           W1HOST    DIV  100       W1HOST
728000200529     C                     ENDIF
728100200529     C           W1HOST    DIV  WWDIVU    WUHOST
728200200529     C                     ENDIF
728300200529      *
728400200529     C                     MOVE 'Y'       AMHOST
728500200529     C                     Z-ADDNMDP1     WWNBDP           Event Security Decimal Places
728600200529     C                     Z-ADDWUHOST    WWNUM
728700200529     C                     MOVE 'U'       WUROOP           Rounding = up
728800200529     C                     EXSR ROUNDD
728900200529     C                     Z-ADDWWNUM     WUHOST
729000200529     C                     EXSR SETNDP
729100200529     C                     Z-ADDWUNUM     WWHOST 150
729200200529     C                     MOVE *BLANKS   STAST
729300200529     C           WWHOST    IFNE 0
729400200529     C                     MOVE *BLANKS   ZFLD15
729500200529     C                     MOVE WWHOST    ZFLD15
729600200529     C                     Z-ADDNMDP1     ZDECS            Event Security Decimal Places
729700200529     C                     EXSR ZSEDIT
729800200529     C                     MOVE ZOUT21    STAST
729900200529     C                     ENDIF
730000200529     C                     ENDIF
730100200529     C                     ENDIF
730200200529     C                     ENDIF
730300200529      *
730400200529      ** If Processing type is 'Exercise', and Option 6 was taken:        161732
730500200529      *                                                                   161732
730600200529     C           PPROC     IFEQ 'EX'                                      161732
730700200529     C           OPTNAA    ANDEQ'6'                                       161732
730800200529      *                                                                   161732
730900200529      ** If Reply Cash % level 2 is zero,                                 161732
731000200529      ** calculate Holding Taken as Stock = Reply Cash % level 2.         161732
731100200529      *                                                                   161732
731200200529     C           MQR2CA    IFEQ *ZERO                                     161732
731300200529     C                     Z-ADDMQR2CN    WUHOST                          161732
731400200529      *                                                                   161732
731500200529      ** Else, calculate Holding Taken as Stock as: Ex-date position      161732
731600200529      ** multiplied by Reply Cash % level 2, then divided by 100.         161732
731700200529      *                                                                   161732
731800200529     C                     ELSE                                           161732
731900200529     C           SHTDVD    MULT MQR2CA    WUHOST                          161732
732000200529     C                     DIV  100       WUHOST                          161732
732100200529     C                     ENDIF                                          161732
732200200529      *                                                                   161732
732300200529      ** Apply the correct number of decimal places to the Holding        161732
732400200529      ** Taken as Stock.                                                  161732
732500200529      *                                                                   161732
732600200529     C                     MOVE 'Y'       AMHOST                          161732
732700200529     C                     Z-ADDNMDP1     WWNBDP                          161732
732800200529     C                     Z-ADDWUHOST    WWNUM                           161732
732900200529     C                     MOVE 'U'       WUROOP                          161732
733000200529     C                     EXSR ROUNDD                                    161732
733100200529     C                     Z-ADDWWNUM     WUHOST                          161732
733200200529     C                     EXSR SETNDP                                    161732
733300200529     C                     Z-ADDWUNUM     WWHOST 150                      161732
733400200529      *                                                                   161732
733500200529      ** Output Holding Taken as Stock to the screen field.               161732
733600200529      *                                                                   161732
733700200529     C                     MOVE *BLANKS   STAST                           161732
733800200529     C           WWHOST    IFNE 0                                         161732
733900200529     C                     MOVE *BLANKS   ZFLD15                          161732
734000200529     C                     MOVE WWHOST    ZFLD15                          161732
734100200529     C                     Z-ADDNMDP1     ZDECS                           161732
734200200529     C                     EXSR ZSEDIT                                    161732
734300200529     C                     MOVE ZOUT21    STAST                           161732
734400200529     C                     ENDIF                                          161732
734500200529     C                     ENDIF                                          161732
734600200529      *                                                                   161732
734700200529     C                     ENDSR
734800200529      *
734900200529      *****************************************************************
735000200529      /EJECT
735100200529      *****************************************************************
735200200529      *                                                               *
735300200529      *  REACAR - Recalculate Actual Cash Rounding.                   *
735400200529      *                                                               *
735500200529      *  Called by:                                                   *
735600200529      *                                                               *
735700200529      *  Calls:                                                       *
735800200529      *                                                               *
735900200529      *****************************************************************
736000200529      *
736100200529     C           REACAR    BEGSR                           ** REACAR SR **
736200200529      *
736300200529      ***  Retrieve Number of New Shares, Compensation Price, and Rounding Settlement in Cash,
736400200529      ***  depending on CO Type.
736500200529      *
736600200529     C           PPROC     IFEQ 'CR'
736700200529     C                     MOVEAMHSECA    TSEC,1
736800200529     C                     Z-ADD1         I       20
736900200529     C           PNWSEC    LOKUPTSEC,I                   17
737000200529     C           *IN17     IFEQ '0'
737100200529     C                     Z-ADD0         WWNSHA 157
737200200529     C                     Z-ADD0         WWCOMP 158
737300200529     C                     MOVE ' '       WWRNDS  1
737400200529     C                     ELSE
737500200529     C                     MOVEAMHNSHA    TNSH,1
737600200529     C                     MOVE TNSH,I    WWNSHA
737700200529     C                     MOVEAMHRNDS    TNDS,1
737800200529     C                     MOVE TNDS,I    WWRNDS
737900200529     C                     MOVEAMHCOPA    TOPA,1
738000200529     C                     MOVE TOPA,I    WWCOMP
738100200529     C                     ENDIF
738200200529     C                     ELSE
738300200529     C                     Z-ADDMDNSHA    WWNSHA
738400200529      *                                                                   135685
738500200529      ***  If Processing Type = Currency Change                           135685
738600200529      ***  and Compensation Price is entered as Market,                   135685
738700200529      ***  the Compensation Price must first be calculated                135685
738800200529      ***  from Current Market Price.                                     135685
738900200529      *                                                                   135685
739000200529     C           PPROC     IFEQ 'CC'                                      135685
739100200529     C           NAMRKI    ANDEQ'Y'                                       135685
739200200529     C                     EXSR CCOMP                                     135685
739300200529     C                     ENDIF                                          135685
739400200529      *                                                                   135685
739500200529     C                     Z-ADDMDCOMP    WWCOMP
739600200529     C                     MOVE MDRNDS    WWRNDS
739700200529     C                     ENDIF
739800200529      *
739900200529     C           PPROC     IFEQ 'DV'                       If CO Type = Dividends Events
740000200529     C           MDSDIT    ANDEQ'S'                           Stock Dividend Type = Stock for Stock
740100200529     C           MDOSHA    ANDNE0                             Number of Old Shares not 0
740200200529     C           WWNSHA    ANDNE0                             Number of New Shares nor 0
740300200529      *
740400200529     C           PPROC     OREQ 'DV'                       Or CO Type = Dividends Events
740500200529     C           MDSDIT    ANDEQ'C'                           Stk Dividend Tp=Combined for Cash&Stk
740600200529     C           MDOSHA    ANDNE0                             Number of Old Shares not 0
740700200529     C           WWNSHA    ANDNE0                             Number of New Shares not 0
740800200529      *
740900200529     C           PPROC     OREQ 'DV'                       Or CO Type = Dividends Events
741000200529     C           MDSDIT    ANDEQ'O'                           Stk Dividend Tp=Optional for Cash&Stk
741100200529     C           MDOSHA    ANDNE0                             Number of Old Shares not 0
741200200529     C           WWNSHA    ANDNE0                             Number of New Shares not 0
741300200529      *
741400200529     C           PPROC     OREQ 'FR'                       Or CO Type = Free Allocation
741500200529     C           MDOSHA    ANDNE0                             Number of Old Shares not 0
741600200529     C           WWNSHA    ANDNE0                             Number of New Shares not 0
741700200529      *
741800200529     C           PPROC     OREQ 'RG'                       Or CO Type = Rights Issues
741900200529     C           MDOSHA    ANDNE0                             Number of Old Shares not 0
742000200529     C           WWNSHA    ANDNE0                             Number of New Shares not 0
742100200529      *
742200200529     C           PPROC     OREQ 'CR'                       Or CO Type = Corporate Reorganisation
742300200529     C           MDOSHA    ANDNE0                             Number of Old Shares not 0
742400200529     C           WWNSHA    ANDNE0                             Number of New Shares not 0
742500200529      *
742600200529     C           PPROC     OREQ 'EX'                       Or Proces.Type= Exervices and Conversions
742700200529     C           MDOSHA    ANDNE0                             Number of Old Shares not 0
742800200529     C           WWNSHA    ANDNE0                             Number of New Shares not 0
742900200529     C           MDSBPR    ANDNE0                             Subscription Price not 0
743000200529      *
743100200529     C           PPROC     OREQ 'OF'                       Or CO Type = Offers
743200200529     C           MIOFTY    ANDEQ'E'                           Exchange    136935
743300200529     C           MDOSHA    ANDNE0                             Number of Old Shares not 0
743400200529     C           WWNSHA    ANDNE0                             Number of New Shares not 0
743500200529      *                                                                   CEU017
743600200529      ***  Or Processing Type = Currency Changes and Old and New Nominal  CEU017
743700200529      ***  Size not zero.                                                 CEU017
743800200529      *                                                                   CEU017
743900200529     C           PPROC     OREQ 'CC'                                      CEU017
744000200529     C           MDOSHA    ANDNE0                                         CEU017
744100200529     C           MDNSHA    ANDNE0                                         CEU017
744200200529      *
744300200529      ***  If Rounding Settlement in Cash = 'Y'.
744400200529      *
744500200529     C           WWRNDS    IFEQ 'Y'
744600200529      *
744700200529      ***  Calculate Actual Cash Rounding = Actual Stock Rounding previously re-calculated
744800200529      ***  multiplied by Compensation Price from SECOxxL1 (where xx = DV, OF, RG, CR or OF)
744900200529      ***  or SECOCCL2.                                                   CEU017
745000200529      *
745100200529     C           WUASTR    MULT WWCOMP    WUACAR
745200200529      *
745300200529      ***  If Price Basis is 'P' for %, result should be divided by 100.
745400200529      *
745500200529     C           SPBS2     IFEQ 'P'
745600200529     C           WUACAR    DIV  100       WUACAR
745700200529     C                     ENDIF
745800200529      *
745900200529     C                     MOVE 'Y'       AMACAR
746000200529     C                     Z-ADDNMDPC2    WWNBDP           New Currency Decimal Places
746100200529     C                     MOVE 'R'       WUROOP           Rounding = half adjust
746200200529     C                     Z-ADDWUACAR    WWNUM
746300200529     C                     EXSR ROUNDD
746400200529     C                     Z-ADDWWNUM     WUACAR
746500200529     C                     EXSR SETNDP
746600200529     C                     Z-ADDWUNUM     WWACRO
746700200529     C                     MOVE *BLANKS   SACRO
746800200529     C           WWACRO    IFNE 0
746900200529     C                     MOVE *BLANKS   ZFLD15
747000200529     C                     MOVE WWACRO    ZFLD15
747100200529     C                     Z-ADDNMDPC2    ZDECS            New Currency Decimal Places
747200200529     C                     EXSR ZSEDIT
747300200529     C                     MOVE ZOUT21    SACRO
747400200529     C                     ENDIF
747500200529     C                     ENDIF
747600200529     C                     ENDIF
747700200529      *
747800200529     C           PPROC     IFEQ 'DV'                       If CO Type = Dividends Events
747900200529     C           MDSDIT    ANDEQ'S'                           Stock Dividend Type = Stock for Stock
748000200529     C********** MDDIVU    ANDNE0                             Dividend Per Unit not 0         190204
748100200529     C           MDDIV1    ANDNE0                             Dividend Per Unit not 0         190204
748200200529     C           MDSBPR    ANDNE0                             Subscription Price not 0
748300200529      *
748400200529      ***  If Rounding Settlement in Cash = 'Y'.
748500200529      *
748600200529     C           WWRNDS    IFEQ 'Y'
748700200529      *
748800200529      ***  Calculate Actual Cash Rounding =
748900200529      ***  (Holding Taken as Stock previously re-calculated multiplied by Dividend
749000200529      ***  Per Unit from SECODVL1) - (Actual Stock Allocation entered multiplied by
749100200529      ***  Subscription Price from SECODVL1.
749200200529      *
749300200529     C******               Z-ADDNMDP2     WWNBDP           New Sec.Dec.Pl.135690
749400200529     C**********           Z-ADDNMDPC2    WWNBDP           New Cur.135690 190204
749500200529     C**********           Z-ADDMDDIVU    WUNUM                           190204
749600200529     C**********           EXSR RTVNDP                                    190204
749700200529     C                     Z-ADDMDDIV1    WWNUM            13,8 ==> 30,9  190204
749800200529     C           WUHOST    MULT WWNUM     W1ACAR 309
749900200529     C           WUASAL    MULT MDSBPR    W2ACAR 309
750000200529      *
750100200529      ***  If Price Basis is 'P' for %, result should be divided by 100.
750200200529      *
750300200529     C           SPBS2     IFEQ 'P'
750400200529     C           W2ACAR    DIV  100       W2ACAR
750500200529     C                     ENDIF
750600200529     C           W1ACAR    SUB  W2ACAR    WUACAR
750700200529      *
750800200529     C                     MOVE 'Y'       AMACAR
750900200529     C                     Z-ADDNMDPC2    WWNBDP           New Currency Decimal Places
751000200529     C                     MOVE 'R'       WUROOP           Rounding = half adjust
751100200529     C                     Z-ADDWUACAR    WWNUM
751200200529     C                     EXSR ROUNDD
751300200529     C                     Z-ADDWWNUM     WUACAR
751400200529     C                     EXSR SETNDP
751500200529     C                     Z-ADDWUNUM     WWACRO
751600200529     C                     MOVE *BLANKS   SACRO
751700200529     C           WWACRO    IFNE 0
751800200529     C                     MOVE *BLANKS   ZFLD15
751900200529     C                     MOVE WWACRO    ZFLD15
752000200529     C                     Z-ADDNMDPC2    ZDECS            New Currency Decimal Places
752100200529     C                     EXSR ZSEDIT
752200200529     C                     MOVE ZOUT21    SACRO
752300200529     C                     ENDIF
752400200529     C                     ENDIF
752500200529     C                     ENDIF
752600200529      *
752700200529     C           PPROC     IFEQ 'DV'                       If Processing Type = Dividends Events
752800200529     C           MDSDIT    ANDEQ'R'                           Stk Dividend Tp=Reinvestment of Divid.
752900200529     C********** MDDIVU    ANDNE0                             Dividend Per Unit not 0         190204
753000200529     C           MDDIV1    ANDNE0                             Dividend Per Unit not 0         190204
753100200529     C           MDSBPR    ANDNE0                             Subscription Price not 0
753200200529      *
753300200529     C           PPROC     OREQ 'EX'                       Or Processing Type = Dividends Events
753400200529     C           MJCPRC    ANDNE0                             Conversion Price not 0
753500200529     C           MJCEXR    ANDNE0                             Conversion Exchange Rate not 0
753600200529     C           MDSBPR    ANDNE0                             Subscription Price not 0
753700200529      *
753800200529      ***  If Rounding Settlement in Cash = 'Y'.
753900200529      ***  Calculate Actual Cash Rounding = Actual Cash Pool previously calculated - (Actual Stock
754000200529      ***  Allocation previously calculated multiplied by Subscription Price).
754100200529      *
754200200529     C           WWRNDS    IFEQ 'Y'
754300200529     C           WUASAL    MULT MDSBPR    W1ACAR 309
754400200529      *
754500200529      ***  If Price Basis is 'P' for %, result should be divided by 100.
754600200529      *
754700200529     C           SPBS2     IFEQ 'P'
754800200529     C           W1ACAR    DIV  100       W1ACAR
754900200529     C                     ENDIF
755000200529     C           ACCAPO    SUB  W1ACAR    WUACAR
755100200529      *
755200200529     C                     MOVE 'Y'       AMACAR
755300200529     C                     Z-ADDNMDPC2    WWNBDP           New Currency Decimal Places
755400200529     C                     MOVE 'R'       WUROOP           Rounding = half adjust
755500200529     C                     Z-ADDWUACAR    WWNUM
755600200529     C                     EXSR ROUNDD
755700200529     C                     Z-ADDWWNUM     WUACAR
755800200529     C                     EXSR SETNDP
755900200529     C                     Z-ADDWUNUM     WWACRO
756000200529     C                     MOVE *BLANKS   SACRO
756100200529     C           WWACRO    IFNE 0
756200200529     C                     MOVE *BLANKS   ZFLD15
756300200529     C                     MOVE WWACRO    ZFLD15
756400200529     C                     Z-ADDNMDPC2    ZDECS            New Currency Decimal Places
756500200529     C                     EXSR ZSEDIT
756600200529     C                     MOVE ZOUT21    SACRO
756700200529     C                     ENDIF
756800200529     C                     ENDIF
756900200529     C                     ENDIF
757000200529      *
757100200529     C                     ENDSR
757200200529      *
757300200529      *****************************************************************
757400200529      /EJECT
757500200529      *****************************************************************
757600200529      *                                                               *
757700200529      *  CACAPO - Calculate Actual Cash Pool for Book/Customer.       *
757800200529      *                                                               *
757900200529      *  Called by:                                                   *
758000200529      *                                                               *
758100200529      *  Calls:                                                       *
758200200529      *                                                               *
758300200529      *****************************************************************
758400200529      *
758500200529     C           CACAPO    BEGSR                           ** CACAPO SR **
758600200529      *
758700200529      ***  If feature Withholding Tax is ON.
758800200529      *
758900200529     C           S01447    IFEQ 'Y'
759000200529      *
759100200529      ***  Calculate Tax Deducted at Source and Tax Deducted by User based on Dividend per Unit.
759200200529      *
759300200529     C                     Z-ADDWWDIVU    WWAMTT
759400200529     C                     EXSR RECTAX
759500200529      *
759600200529      ***  If Customer calculation, calculate Dividend Per Unit les Tax Deducted at Source and Tax
759700200529      ***  Deducted by User based on Dividend Per Unit.
759800200529      *
759900200529     C           SHCOTP    IFEQ 'C'
760000200529     C           WWDIVU    SUB  TOTTAX    TADIVU 309
760100200529     C                     ELSE
760200200529      *
760300200529      ***  If Book calculation, calculate Dividend Per Unit les Tax Deducted at Source based on
760400200529      ***  Dividend Per Unit.
760500200529      *
760600200529     C           WWDIVU    SUB  TASO      TADIVU
760700200529     C                     ENDIF
760800200529     C                     ELSE
760900200529      *
761000200529      ***  If feature Withholding Tax is OFF, Retrieve Dividend Per Unit.
761100200529      *
761200200529     C                     Z-ADDWWDIVU    TADIVU
761300200529     C                     ENDIF
761400200529      *
761500200529      ***  Calculate Actual Cash Pool:
761600200529      ***  - Customer Position: = Holding Taken as Stock multiplied by (Dividend Per Unit less Tax
761700200529      ***                         Deducted at Source and Tax Deducted by User) if feature
761800200529      ***                         Witholding Tax is ON,
761900200529      ***                       = Holding Taken as Stock multiplied by Dividend Per Unit if feature
762000200529      ***                         Witholding Tax is OFF.
762100200529      ***  - Book Position:     = Holding Taken as Stock multiplied by (Dividend Per Unit less Tax
762200200529      ***                         Deducted at Source) if feature Withholding Tax is ON,
762300200529      ***                       = Holding Taken as Stock multiplied by Dividend Per Unit if feature
762400200529      ***                         Witholding Tax is OFF.
762500200529      *
762600200529     C           AMHOST    IFEQ 'Y'
762700200529     C                     Z-ADDWUHOST    WWNUM            Holding Taken as Stock recalculated
762800200529     C                     ELSE
762900200529     C                     Z-ADDMCHOST    WUNUM            Retrieve Holding Taken as Stock
763000200529     C                     Z-ADDNMDP1     WWNBDP           Event Security Decimal Places
763100200529     C                     EXSR RTVNDP
763200200529     C                     ENDIF
763300200529     C           WWNUM     MULT TADIVU    ACCAPO 309
763400200529      *
763500200529     C                     ENDSR
763600200529      *
763700200529      *****************************************************************
763800200529      /EJECT
763900200529      *****************************************************************
764000200529      *                                                               *
764100200529      *  REHOCA - Recalculate Holding Taken as Cash.                  *
764200200529      *                                                               *
764300200529      *  Called by:                                                   *
764400200529      *                                                               *
764500200529      *  Calls:                                                       *
764600200529      *                                                               *
764700200529      *****************************************************************
764800200529      *
764900200529     C           REHOCA    BEGSR                           ** REHOCA SR **
765000200529      *
765100200529     C           PPROC     IFEQ 'DV'                       If CO Type = Dividends Events
765200200529     C           MDSDIT    ANDNE'C'                           Stk Divid.Tp not Combined for Cash&Stk
765300200529     C           PPROC     OREQ 'RG'                       Or CO Type = Rights Issues
765400200529     C           PPROC     OREQ 'CE'                       Or CO Type = Capital Changes
765500200529     C           PPROC     OREQ 'FR'                       Or CO Type = Free Allocation
765600200529     C           PPROC     OREQ 'CC'                       Or Ccy Changes CEU017
765700200529     C           PPROC     OREQ 'EX'                       Or CO Type = Exercices and Conversions
765800200529     C******     MJOPT1    ANDEQ'Y'                           Cust.Opt.1  136935
765900200529     C           OPTNAA    ANDEQ'1'                           Opt.Alloc=1 136935
766000200529     C           PPROC     OREQ 'EX'                       Or CO Type = Exercices and Conversions
766100200529     C******     MJOPT2    ANDEQ'Y'                           Cust.Opt.2  136935
766200200529     C           OPTNAA    ANDEQ'2'                           Opt.Alloc=2 136935
766300200529     C           PPROC     OREQ 'EX'                       Or CO Type = Exercices and Conversions
766400200529     C******     MJOPT3    ANDEQ'Y'                           Cust.Opt.3  136935
766500200529     C           OPTNAA    ANDEQ'3'                           Opt.Alloc=3 136935
766600200529     C           PPROC     OREQ 'EX'                       Or CO Type = Exercices and Conversions
766700200529     C******     MJOPT4    ANDEQ'Y'                           Cust.Opt.4  136935
766800200529     C           OPTNAA    ANDEQ'4'                           Opt.Alloc=4 136935
766900200529     C           PPROC     OREQ 'EX'                       Or CO Type = Exercices and Conversions
767000200529     C******     MJOPT5    ANDEQ'Y'                           Cust.Opt.5  136935
767100200529     C           OPTNAA    ANDEQ'5'                           Opt.Alloc=5 136935
767200200529      *
767300200529      ***  Calculate Holding Taken as Cash =
767400200529      ***  Ex-Date Position - Holding Taken as Stock previously re-calculated.
767500200529      *
767600200529     C           SHTDVD    SUB  WUHOST    WUHOCA 309
767700200529      *
767800200529     C                     MOVE 'Y'       AMHOCA
767900200529     C                     Z-ADDNMDPC2    WWNBDP           New Currency Decimal Places
768000200529     C                     MOVE 'R'       WUROOP           Rounding = half adjust
768100200529     C                     Z-ADDWUHOCA    WWNUM
768200200529     C                     EXSR ROUNDD
768300200529     C                     Z-ADDWWNUM     WUHOCA
768400200529     C                     EXSR SETNDP
768500200529     C                     Z-ADDWUNUM     WWHOCA 150
768600200529      *
768700200529     C                     ENDIF
768800200529      *
768900200529     C                     ENDSR
769000200529      *
769100200529      *****************************************************************
769200200529      /EJECT
769300200529      *****************************************************************
769400200529      *                                                               *
769500200529      *  SRPRAC - Process Action Code.                                *
769600200529      *                                                               *
769700200529      *  Called by: SRVALD - Validate subfile records.                *
769800200529      *                                                               *
769900200529      *  Calls:                                                       *
770000200529      *                                                               *
770100200529      *****************************************************************
770200200529      *
770300200529     C           SRPRAC    BEGSR                           ** SRPRAC SR **
770400200529      *
770500200529     C           P7515     PLIST
770600200529     C                     PARM           PCORF            Reference
770700200529     C                     PARM           PSESN            Security Shortname
770800200529     C                     PARM           PACT             Corporate Type
770900200529     C                     PARM           PPROC            Processing Type
771000200529     C                     PARM           PEXDT            Ex-Date
771100200529     C                     PARM           PSTAT            Corporate Action Status
771200200529     C                     PARM           PBRCD            Branch
771300200529     C                     PARM           PDPOT            Depot
771400200529     C                     PARM           SHBOOK           Book
771500200529     C                     PARM           WUCNUM           Customer
771600200529     C                     PARM           SHPORT           Portfolio
771700200529     C                     PARM           PEXPS  16        Ex-date Pos'n  161732
771800200529     C                     PARM           PCMODE           Mode
771900200529     C                     PARM *BLANKS   PCPGM   6        Calling program
772000200529     C                     PARM           PRTCD            Return Code
772100200529      *
772200200529     C                     MOVELSEXPOS    PEXPS                           161732
772300200529      *                                                                   161732
772400200529     C********** SHCNUM    IFEQ 0                                                             CSD027
772500200529     C           SHCNUM    IFEQ *BLANKS                                                       CSD027
772600200529     C                     MOVE *BLANKS   WUCNUM
772700200529     C                     ELSE
772800200529     C                     MOVE SHCNUM    WUCNUM  6
772900200529     C                     ENDIF
773000200529      *
773100200529     C           SACODE    IFEQ 'Y'
773200200529     C                     MOVE 'A'       PCMODE  1
773300200529     C                     CALL 'SE7515'  P7515        87
773400200529      *
773500200529      ***  Clear messages from program message queue.
773600200529      *
773700200529     C                     CALL 'Y2CLMSC'
773800200529     C                     PARM SPGM      ZAPGM  10
773900200529     C                     PARM '*SAME'   ZAPGRL  5
774000200529      *
774100200529     C                     MOVELNARR,1    DBKEYN 29
774200200529     C                     ENDIF
774300200529      *
774400200529     C           SACODE    IFEQ 'J'
774500200529     C                     MOVE 'E'       PCMODE  1
774600200529     C                     CALL 'SE7515'  P7515        87
774700200529      *
774800200529      ***  Clear messages from program message queue.
774900200529      *
775000200529     C                     CALL 'Y2CLMSC'
775100200529     C                     PARM SPGM      ZAPGM  10
775200200529     C                     PARM '*SAME'   ZAPGRL  5
775300200529      *
775400200529     C                     MOVELNARR,1    DBKEYN
775500200529     C                     ENDIF
775600200529      *
775700200529     C           SACODE    IFEQ 'V'
775800200529     C                     CALL 'SE7540'               87
775900200529     C                     PARM           PCORF
776000200529     C                     PARM           POPNB
776100200529     C                     PARM           PBRCD
776200200529     C                     PARM           SHBOOK
776300200529     C                     PARM           WUCNUM
776400200529     C                     PARM           SHPORT
776500200529     C                     PARM *BLANKS   PCPGM   6        Calling program
776600200529     C                     PARM           PRTCD
776700200529      *
776800200529      ***  Clear messages from program message queue.
776900200529      *
777000200529     C                     CALL 'Y2CLMSC'
777100200529     C                     PARM SPGM      ZAPGM  10
777200200529     C                     PARM '*SAME'   ZAPGRL  5
777300200529      *
777400200529     C                     MOVELNARR,2    DBKEYN
777500200529     C                     ENDIF
777600200529      *
777700200529      ***  If 'Corporate Actions Allocation' for one Book or Customer/Book asked.
777800200529      *
777900200529     C           SACODE    IFEQ 'L'
778000200529      *
778100200529     C                     MOVE *BLANKS   SCOAL
778200200529     C                     MOVE '0'       *IN14
778300200529      *
778400200529      ***  Loop while F12=Previous screen is not pressed, or Comfirmation field not
778500200529      ***  valid.
778600200529      *
778700200529     C           *INKL     DOWEQ'0'
778800200529     C           SCOAL     ANDNE'Y'
778900200529     C           SCOAL     ANDNE'N'
779000200529      *
779100200529      ***  Display comfirmation screen.
779200200529      *
779300200529     C                     WRITE#MSGCTL                                   137879
779400200529     C                     WRITESE7513F5
779500200529     C******               WRITE#MSGCTL                                   137879
779600200529     C           *IN60     IFEQ '1'
779700200529     C                     EXFMTSE7513F3
779800200529     C                     ELSE
779900200529     C                     EXFMTSE7513F4
780000200529     C                     ENDIF
780100200529      *
780200200529      ***  If F12=Previous screen not pressed.
780300200529      *
780400200529     C           *INKL     IFEQ '0'
780500200529      *
780600200529      ***  Clear messages from program message queue.
780700200529      *
780800200529     C                     CALL 'Y2CLMSC'
780900200529     C                     PARM SPGM      ZAPGM  10
781000200529     C                     PARM '*SAME'   ZAPGRL  5
781100200529      *
781200200529      ***  Reset error indicator.
781300200529      *
781400200529     C                     MOVE '0'       *IN14
781500200529      *
781600200529      ***  If Confirmation field not valid, send error message.
781700200529      *
781800200529     C           SCOAL     IFNE 'Y'
781900200529     C           SCOAL     ANDNE'N'
782000200529     C                     MOVE '1'       *IN14            Error indicator
782100200529     C                     MOVEL'CO00200' ZAMSID
782200200529     C                     EXSR ZASNMS
782300200529     C                     ENDIF
782400200529      *
782500200529      ***  If user confirm to run Allocation.
782600200529      *
782700200529     C           SCOAL     IFEQ 'Y'
782800200529      *
782900200529      ***  Prepare command.
783000200529      *
783100200529     C                     MOVEL*BLANKS   CMDTXT
783200200529     C***********          MOVEL*BLANKS   CMDTX1160                                           CPK014
783300200529     C                     Z-ADD240       CMDLEN 155
783400200529     C***********          MOVELCMD,1     CMDTX1                                              CPK014
783500200529     C***********          MOVE CMD,2     CMDTX1                                              CPK014
783600200529     C***********          MOVELCMDTX1    CMDTXT                                              CPK014
783700200529     C***********          MOVE CMD,3     CMDTXT                                              CPK014
783800200529     C                     MOVELCMD,1     CMDTXT                                              CPK014
783900200529     C                     MOVELCMD,2     CMDTX2                                              CPK014
784000200529     C                     MOVELCMD,3     CMDTX3                                              CPK014
784100200529      *
784200200529      ***  Prepare Job Name: COxxxxxxy (where xxxxxx = CO Reference and y = Action Code).
784300200529      *
784400200529     C                     MOVELSREFNO    @REF
784500200529     C                     MOVELSACODE    @ACTI
784600200529      *
784700200529      ***  Prepare parameters transmitted to CLP/SEC7550.
784800200529      *
784900200529     C                     MOVELSREFNO    @REFN            CO Refernce
785000200529     C                     MOVELSBRCH     @BRCD            Branch Code
785100200529     C                     MOVE PDPOT     @DEPT            Depot
785200200529     C                     MOVELSOPT      @OPTN            Option Number
785300200529     C                     MOVELSNWSEC    @NSEC            New Security
785400200529     C                     MOVELSHBOOK    @BOOK            Book Code
785500200529     C                     MOVELWUCNUM    @CNUM            Customer Number
785600200529     C                     MOVELSHPORT    @PTFR            Portfolio Reference
785900200529      *
786000200529      ***  Submit in batch 'CORPORATE ACTIONS ALLOCATION' program.
786100200529      *
786200200529     C                     CALL 'QCMDEXC'              87
786300200529     C                     PARM           CMDTXT
786400200529     C                     PARM           CMDLEN
786500200529      *
786600200529      ***  Clear messages from program message queue.
786700200529      *
786800200529     C                     CALL 'Y2CLMSC'
786900200529     C                     PARM SPGM      ZAPGM  10
787000200529     C                     PARM '*SAME'   ZAPGRL  5
787100200529      *
787200200529     C                     MOVELNARR,3    DBKEYN
787300200529      *
787400200529      ***  Send message 'Allocation processing submited ...'.
787500200529      *
787600200529     C                     MOVEL'CO00293' ZAMSID
787700200529     C                     EXSR ZASNMS
787800200529     C                     MOVE 'Y'       ERMSG
787900200529     C                     ENDIF
788000200529     C                     ENDIF
788100200529      *
788200200529     C                     ENDDO
788300200529      *
788400200529      ***  Reposition in Subfile.
788500200529      *
788600200529     C           *IN60     IFEQ '1'
788700200529     C           SRRN      CHAINSE7513S0             88
788800200529     C                     ELSE
788900200529     C           SRRN      CHAINSE7513S1             88
789000200529     C                     ENDIF
789100200529      *
789200200529      ***  Reset indicators F12 pressed to re-display subfile.
789300200529      *
789400200529     C                     MOVE '0'       *INKL
789500200529      *
789600200529     C                     ENDIF
789700200529      *
789800200529     C           PRTCD     IFEQ 'E'
789900200529     C           *INU7     OREQ '1'
790000200529     C           *INU8     OREQ '1'
790100200529     C           *IN87     OREQ '1'
790200200529     C           *LOCK     IN   LDA
790300200529     C                     Z-ADD030       DBASE            ***************
790400200529     C                     MOVEL*BLANKS   DBFILE           * DB ERROR 30 *
790500200529     C                     MOVEL'SE7513'  DBPGM            ***************
790600200529     C                     MOVELDBKEYN    DBKEY
790700200529     C                     OUT  LDA
790800200529     C                     EXSR *PSSR
790900200529     C                     ENDIF
791000200529      *
791100200529     C           PRTCD     IFEQ '3'
791200200529     C           PMODE     IFEQ 'E'
791300200529     C                     MOVE '1'       *INKC
791400200529     C                     ELSE
791500200529     C                     MOVE '1'       *IN20
791600200529     C                     ENDIF
791700200529     C                     ENDIF
791800200529      *
791900200529     C                     ENDSR
792000200529      *
792100200529      *****************************************************************
792200200529      /EJECT
792300200529      *****************************************************************
792400200529      *                                                               *
792500200529      *  SRSAVE - Save subfile datas.                                 *
792600200529      *                                                               *
792700200529      *  Called by:                                                   *
792800200529      *                                                               *
792900200529      *  Calls:                                                       *
793000200529      *                                                               *
793100200529      *****************************************************************
793200200529      *
793300200529     C           SRSAVE    BEGSR                           ** SRSAVE SR **
793400200529      *
793500200529     C                     MOVE PCORF     WKCORF
793600200529     C                     MOVE POPTN     WKOPTN
793700200529     C                     MOVE PBRCD     WKBRCD
793800200529     C**********           Z-ADDPDEPO     WKDEPO                                              CSD027
793900200529     C                     MOVE PDEPO     WKDEPO                                              CSD027
794000200529      *
794100200529     C           *IN60     IFEQ '1'
794200200529     C                     MOVE PNWSEC    WKSESN
794300200529     C                     ELSE
794400200529     C                     MOVEL'**CASH**'WKSESN
794500200529     C                     ENDIF
794600200529      *
794700200529     C           SHBOOK    IFEQ ' '
794800200529     C                     MOVE 'C'       WKCOTP
794900200529     C                     MOVE '  '      WKBOOK
795000200529     C                     MOVE SHCNUM    WKCNUM
795100200529     C                     MOVE SHPORT    WKPTFR
795200200529     C                     ELSE
795300200529     C                     MOVE 'B'       WKCOTP
795400200529     C                     MOVE SHBOOK    WKBOOK
795500200529     C**********           Z-ADD0         WKCNUM                                              CSD027
795600200529     C                     MOVE *BLANKS   WKCNUM                                              CSD027
795700200529     C                     MOVE *BLANKS   WKPTFR
795800200529     C                     ENDIF
795900200529      *
796000200529     C           WKEY4     CHAINSECOALL7             79
796100200529      *
796200200529     C                     EXSR SRU002
796300200529      *
796400200529     C                     ENDSR
796500200529      *
796600200529      *****************************************************************
796700200529      /EJECT
796800200529      *****************************************************************
796900200529      *                                                               *
797000200529      *  SRU001 - Write a record to the subfile for each subfile      *
797100200529      *           record changes when subfile is build.               *
797200200529      *                                                               *
797300200529      *  Called by: SRS001 - Set first lines of subfile for each Book *
797400200529      *                      Position records when subfile is build   *
797500200529      *                      from begining.                           *
797600200529      *             SRS002 - Set detail lines of subfile for each     *
797700200529      *                      Customer Position records when subfile   *
797800200529      *                      is build.                                *
797900200529      *             SRS003 - Set subfile last line for each build of  *
798000200529      *                      the subfile when all details in files    *
798100200529      *                      are reached.                             *
798200200529      *                                                               *
798300200529      *  Calls:                                                       *
798400200529      *                                                               *
798500200529      *****************************************************************
798600200529      *
798700200529     C           SRU001    BEGSR                           ** SRU001 SR **
798800200529      *
798900200529     C                     MOVE '0'       *IN64
799000200529     C                     MOVEA'00'      *IN,66
799100200529     C                     MOVE *IN62     SHIND2
799200200529     C                     MOVE *IN63     SHIND3
799300200529     C                     MOVE *IN64     SHIND4                          135689
799400200529      *
799500200529      ***  If record from LF/SEUDEPL0.
799600200529      *
799700200529     C           *IN40     IFEQ '1'
799800200529     C                     MOVE *BLANKS   SBC
799900200529     C                     MOVELUDBK      SBC
800000200529      *                                                                   CAC005
800100200529      ** If CAC005 is installed, retrieve the corresponding user book     CAC005
800200200529      ** and profit center. UDBK in the User Depot Positions file is      CAC005
800300200529      ** being held as a pseudo book.                                     CAC005
800400200529      *                                                                   CAC005
800500200529     C           CAC005    IFEQ 'Y'                                       CAC005
800600200529     C                     CALL 'AOBKPCR0'                                CAC005
800700200529     C                     PARM *BLANKS   PRTCD1                          CAC005
800800200529     C                     PARM '*USER  ' POPTN1                          CAC005
800900200529     C                     PARM           PBKCD                           CAC005
801000200529     C                     PARM           PPRFC                           CAC005
801100200529     C                     PARM UDBK      PPSBK                           CAC005
801200200529      *                                                                   CAC005
801300200529     C           PRTCD1    IFEQ *BLANKS                                   CAC005
801400200529     C                     MOVELPBKCD     SBC                             CAC005
801500200529     C                     MOVE PPRFC     SBC                             CAC005
801600200529     C                     ENDIF                                          CAC005
801700200529     C                     ENDIF                                          CAC005
801800200529      *                                                                   CAC005
801900200529     C                     MOVE UDBK      SHBOOK
802000200529     C**********           MOVE *ZEROS    SHCNUM                                              CSD027
802100200529     C                     MOVE *BLANKS   SHCNUM                                              CSD027
802200200529     C                     MOVE *BLANKS   SPORT
802300200529     C                     MOVE *BLANKS   SHPORT
802400200529     C                     ELSE
802500200529      *
802600200529      ***  If record from LF/SECDEPL4.
802700200529      *
802800200529     C           *IN41     IFEQ '1'
802900200529     C                     MOVE *BLANKS   SHBOOK
803000200529      *
803100200529      ***  Retrieve Customer Shortname.
803200200529      *
803300200529     C                     MOVE *BLANKS   WKEYC
803400200529     C                     MOVELCDCN      WKEYC
803500200529     C**********           CALL 'AOCUSTR0'                                                    223539
803600200529     C                     CALL 'AOCUSTR1'                                                    223539
803700200529     C                     PARM '*DBERR'  WRTCD
803800200529     C                     PARM '*KEY   ' WOPTN
803900200529     C                     PARM           WKEYC  10
804000200529     C                     PARM *BLANKS   WKYST   7
804100200529     C********** SDCUST    PARM SDCUST    DSSDY                                               223539
804200200529     C           SDCUST    PARM SDCUST    DSLDY                                               223539
804300200529      *
804400200529      ***  If record not found, handle Database error.
804500200529      *
804600200529     C           WRTCD     IFNE *BLANKS
804700200529     C           BBCLST    ANDNE'Y'                                                           223539
804800200529     C           *LOCK     IN   LDA
804900200529     C                     Z-ADD031       DBASE            ***************
805000200529     C                     MOVEL'SDCUSTPD'DBFILE           * DB ERROR 31 *
805100200529     C                     MOVELCDCN      DBKEY            ***************
805200200529     C                     MOVEL'SE7513'  DBPGM
805300200529     C                     OUT  LDA
805400200529     C                     EXSR *PSSR
805500200529     C                     ENDIF
805600200529     C                     MOVELBBCSSN    SBC
805700200529     C                     MOVE CDCN      SHCNUM
805800200529     C           PTFR      IFEQ '9997'
805900200529     C           BGN4ST    ANDNE'Y'                                       CPB001
806000200529     C                     MOVE W9997     SPORT
806100200529     C                     ELSE
806200200529     C                     MOVE PTFR      SPORT
806300200529     C                     ENDIF
806400200529     C                     MOVE PTFR      SHPORT
806500200529     C                     MOVE '0'       *IN85                                               223182
806600200529     C           BBCLST    IFEQ 'Y'                                                           223182
806700200529     C                     MOVE '1'       *IN85                                               223182
806800200529     C                     MOVE *BLANKS   SREST                                               223182
806900200529     C                     MOVE '*CLOSED*'SREST                                               223182
807000200529     C                     ENDIF                                                              223182
807100200529      *
807200200529      ***  If record for Dummy Customer.
807300200529      *
807400200529     C                     ELSE
807500200529     C                     MOVE '0'       *IN85                                               223182
807600200529     C                     MOVE *BLANKS   SHBOOK
807700200529     C                     MOVE *BLANKS   SPORT                           136935
807800200529     C                     MOVE *BLANKS   SHPORT                          136935
808000200529      *
808100200529      ***  Retrieve Customer Shortname.
808200200529      *
808300200529     C                     MOVE *BLANKS   WKEYC
808400200529     C                     MOVELWDUMMY    WKEYC
808500200529     C**********           CALL 'AOCUSTR0'                                                    223539
808600200529     C                     CALL 'AOCUSTR1'                                                    223539
808700200529     C                     PARM '*DBERR'  WRTCD
808800200529     C                     PARM '*KEY   ' WOPTN
808900200529     C                     PARM           WKEYC  10
809000200529     C                     PARM *BLANKS   WKYST   7
809100200529     C********** SDCUST    PARM SDCUST    DSSDY                                               223539
809200200529     C           SDCUST    PARM SDCUST    DSLDY                                               223539
809300200529      *
809400200529      ***  If record not found, handle Database error.
809500200529      *
809600200529     C           WRTCD     IFNE *BLANKS
809700200529     C           BBCLST    ANDNE'Y'                                                           223539
809800200529     C           *LOCK     IN   LDA
809900200529     C                     Z-ADD032       DBASE            ***************
810000200529     C                     MOVEL'SDCUSTPD'DBFILE           * DB ERROR 32 *
810100200529     C                     MOVELWDUMMY    DBKEY            ***************
810200200529     C                     MOVEL'SE7513'  DBPGM
810300200529     C                     OUT  LDA
810400200529     C                     EXSR *PSSR
810500200529     C                     ENDIF
810600200529     C                     MOVELBBCSSN    SBC
810700200529     C                     MOVE WDUMMY    SHCNUM
810800200529     C                     ENDIF
810900200529     C                     ENDIF
811000200529      *
811100200529      ***  If Ex-Date Position is not coming from SEUDEPL0 or SECDEPL4.
811200200529      *
811300200529     C           *IN79     IFEQ '0'
811400200529     C                     MOVE *BLANKS   ZFLD15
811500200529     C                     MOVE MCEXPO    ZFLD15
811600200529     C                     Z-ADDNMDP1     ZDECS            Event Security Decimal Places
811700200529     C                     EXSR ZSEDIT
811800200529     C                     MOVE *BLANKS   SEXPOS
811900200529     C                     MOVE ZOUT21    SEXPOS
812000200529     C                     Z-ADDMCEXPO    SHTDVD
812100200529     C                     Z-ADDMCEXPO    WWEXPO
812200200529     C                     ELSE
812300200529     C                     Z-ADD0         WWEXPO 150
812400200529     C                     ENDIF
812500200529      *
812600200529      ***  If the Ex-Date Position retrieved from SEUDEPL0 or SECDEPL4 is different than Ex-Date
812700200529      ***  Position on SECOALL1, the field will blink on the screen.
812800200529      *
812900200529     C           WWEXPO    IFNE WWTDVD
813000200529     C                     MOVE '1'       *IN64
813100200529     C                     MOVE *IN64     SHIND4
813200200529     C                     ENDIF
813300200529      *
813400200529      ***  Setup the STATUS field.
813500200529      *
813600200529     C           *IN85     IFNE '1'                                                           223182
813700200529     C           *IN79     IFEQ '0'
813800200529     C********** SHCNUM    ANDNE*ZEROS                                                        CSD027
813900200529     C           SHCNUM    ANDNE*BLANKS                                                       CSD027
814000200529     C                     SELEC
814100200529     C           MCREST    WHEQ 'R'
814200200529     C                     MOVE STATUS,1  SREST
814300200529     C           MCREST    WHEQ 'S'
814400200529     C                     MOVE STATUS,2  SREST
814500200529     C           MCREST    WHEQ 'C'
814600200529     C                     MOVE STATUS,3  SREST
814700200529     C           MCREST    WHEQ 'M'
814800200529     C                     MOVE STATUS,4  SREST
814900200529     C           MCREST    WHEQ 'N'
815000200529     C                     MOVE STATUS,5  SREST
815100200529     C           MCREST    WHEQ ' '
815200200529     C                     MOVE STATUS,5  SREST
815300200529     C                     ENDSL
815400200529     C                     ELSE
815500200529     C                     MOVE *BLANKS   SREST
815600200529     C                     ENDIF
815700200529     C                     ENDIF                                                              223182
815800200529      *
815900200529      ***  Check if Current Reply exist for the Book or Customer.
816000200529      *
816100200529     C                     MOVE POPNB     OPT     1
816200200529     C                     MOVE SHBOOK    WKBOOK
816300200529     C                     MOVE SHCNUM    WKCNUM
816400200529     C                     MOVE PCORF     WKCORF
816500200529     C                     Z-ADDPOPTN     WKOPTN
816600200529     C                     MOVE PBRCD     WKBRCD
816700200529     C           WKEY6     CHAINSECOREL1             15
816800200529      *
816900200529      ***  If Corporate Actions Status is not Fully authorised (Cash and Stock)
817000200529      ***  and Option Number equal the Current Reply Level 1 if exist else the Default No Reply,
817100200529      ***  and Number of Options is greater than 1,
817200200529      ***  Or if Corporate Actions Status is not Fully authorised (Cash and Stock)
817300200529      ***  and Number of Options equal 1,
817400200529      ***  authorise amendments on fields: Actual Cash Rounding
817500200529      ***  and Actual Cash Allocation if "Cash" screen.
817600200529      *
817700200529     C           SSTAT     IFNE 'X'
817800200529     C           *IN15     ANDEQ'0'
817900200529     C           MQR1RE    ANDEQPOPNB
818000200529     C           MANBOP    ANDGT1
818100200529     C           SSTAT     ORNE 'X'
818200200529     C           *IN15     ANDEQ'1'
818300200529     C           MADFNR    ANDEQOPT
818400200529     C           MANBOP    ANDGT1
818500200529     C           SSTAT     ORNE 'X'
818600200529     C           MANBOP    ANDEQ1
818700200529     C                     MOVE '1'       *IN67
818800200529     C                     ENDIF
818900200529     C                     MOVE *IN66     SHIND6
819000200529     C                     MOVE *IN67     SHIND7
819100200529      *
819200200529      ***  Setup other input/output fields.
819300200529      *
819400200529     C           *IN60     IFEQ '1'
819500200529      *
819600200529      ***  For Normal Screen.
819700200529      *
819800200529     C           *IN79     IFEQ '0'
819900200529      *
820000200529      ***  If record found in SECOALL1, edit amount if not equal 0 else set to blank.
820100200529      *
820200200529     C                     MOVE *BLANKS   STAST
820300200529     C           MCHOST    IFNE 0
820400200529     C                     MOVE *BLANKS   ZFLD15
820500200529     C                     MOVE MCHOST    ZFLD15
820600200529     C                     Z-ADDNMDP1     ZDECS            Event Security Decimal Places
820700200529     C                     EXSR ZSEDIT
820800200529     C                     MOVE ZOUT21    STAST
820900200529     C                     ENDIF
821000200529      *
821100200529     C                     MOVE *BLANKS   SOSAL
821200200529     C           MCOALR    IFNE 0
821300200529     C                     MOVE *BLANKS   ZFLD15
821400200529     C                     MOVE MCOALR    ZFLD15
821500200529     C                     Z-ADDNMDP2     ZDECS            New Security Decimal Places
821600200529     C                     EXSR ZSEDIT
821700200529     C                     MOVE ZOUT21    SOSAL
821800200529     C                     ENDIF
821900200529      *
822000200529     C                     MOVE *BLANKS   SASAL
822100200529     C           MCASTA    IFNE 0
822200200529     C                     MOVE *BLANKS   ZFLD15
822300200529     C                     MOVE MCASTA    ZFLD15
822400200529     C                     Z-ADDNMDP2     ZDECS            New Security Decimal Places
822500200529     C                     EXSR ZSEDIT
822600200529     C                     MOVE ZOUT21    SASAL
822700200529     C                     ENDIF
822800200529      *
822900200529     C                     MOVE SASAL     SHASAL
823000200529     C                     Z-ADDMCASTA    SHASTA
823100200529      *
823200200529     C                     Z-ADDMCOTSA    SHOTSA
823300200529      *
823400200529     C                     MOVE *BLANKS   SOSRO
823500200529     C           MCOSTR    IFNE 0
823600200529     C                     MOVE *BLANKS   ZFLD15
823700200529     C                     MOVE MCOSTR    ZFLD15
823800200529     C                     Z-ADD8         ZDECS            8 Decimal Places
823900200529     C                     EXSR ZSEDIT
824000200529     C                     MOVE ZOUT21    SOSRO
824100200529     C                     ENDIF
824200200529      *
824300200529     C                     MOVE *BLANKS   SASRO
824400200529     C           MCASTR    IFNE 0
824500200529     C                     MOVE *BLANKS   ZFLD15
824600200529     C                     MOVE MCASTR    ZFLD15
824700200529     C                     Z-ADD8         ZDECS            8 Decimal Places
824800200529     C                     EXSR ZSEDIT
824900200529     C                     MOVE ZOUT21    SASRO
825000200529     C                     ENDIF
825100200529     C                     Z-ADDMCASTR    SHASTR
825200200529      *
825300200529     C                     MOVE *BLANKS   SOCRO
825400200529     C           MCOCAR    IFNE 0
825500200529     C                     MOVE *BLANKS   ZFLD15
825600200529     C                     MOVE MCOCAR    ZFLD15
825700200529     C                     Z-ADDNMDPC2    ZDECS            New Currency Decimal Places
825800200529     C                     EXSR ZSEDIT
825900200529     C                     MOVE ZOUT21    SOCRO
826000200529     C                     ENDIF
826100200529      *
826200200529     C                     MOVE *BLANKS   SACRO
826300200529     C           MCACAR    IFNE 0
826400200529     C                     MOVE *BLANKS   ZFLD15
826500200529     C                     MOVE MCACAR    ZFLD15
826600200529     C                     Z-ADDNMDPC2    ZDECS            New Currency Decimal Places
826700200529     C                     EXSR ZSEDIT
826800200529     C                     MOVE ZOUT21    SACRO
826900200529     C                     ENDIF
827000200529      *
827100200529     C                     MOVE SACRO     SHACRO
827200200529     C                     Z-ADDMCACAR    SHACAR
827300200529      *
827400200529     C                     ELSE
827500200529      *
827600200529      ***  If record not found in SECOALL1, set all fields to blank.
827700200529      *
827800200529     C                     MOVE *BLANKS   STAST
827900200529     C                     MOVE *BLANKS   SOSAL
828000200529     C                     MOVE *BLANKS   SASAL
828100200529     C                     MOVE *BLANKS   SHASAL
828200200529     C                     MOVE *BLANKS   SOSRO
828300200529     C                     MOVE *BLANKS   SASRO
828400200529     C                     MOVE *BLANKS   SOCRO
828500200529     C                     MOVE *BLANKS   SACRO
828600200529     C                     MOVE *BLANKS   SHACRO
828700200529     C                     ENDIF
828800200529      *
828900200529      ***  If Corporate Actions Status is not Stock authorised or Fully authorised (Cash and Stock)
829000200529      ***  and Option Number equal the Current Reply Level 1 if exist else the Default No Reply,
829100200529      ***  and Number of Options is greater than 1,
829200200529      ***  Or if Corporate Actions Status is not Stock authorised or Fully authorised (Cash and
829300200529      ***  stock) and Number of Options equal 1,
829400200529      ***  authorise amendments on field Actual Stock Allocation.
829500200529      *
829600200529     C           SSTAT     IFNE 'X'
829700200529     C           SSTAT     ANDNE'S'
829800200529     C           *IN15     ANDEQ'0'
829900200529     C           MQR1RE    ANDEQPOPNB
830000200529     C           MANBOP    ANDGT1
830100200529     C           SSTAT     ORNE 'X'
830200200529     C           SSTAT     ANDNE'S'
830300200529     C           *IN15     ANDEQ'1'
830400200529     C           MADFNR    ANDEQOPT
830500200529     C           MANBOP    ANDGT1
830600200529     C           SSTAT     ORNE 'X'
830700200529     C           SSTAT     ANDNE'S'
830800200529     C           MANBOP    ANDEQ1
830900200529     C                     MOVE '1'       *IN66
831000200529     C                     MOVE *IN66     SHIND6
831100200529     C                     ENDIF
831200200529      *
831300200529      ***  Write a record in the subfile.
831400200529      *
831500200529     C                     WRITESE7513S0
831600200529      *
831700200529     C                     ELSE
831800200529      *
831900200529      ***  For Cash Screen.
832000200529      *
832100200529     C           *IN79     IFEQ '0'
832200200529      *
832300200529      ***  If record found in SECOALL1, edit amount if not equal 0 else set to blank.
832400200529      *
832500200529     C                     MOVE *BLANKS   STACA
832600200529     C           MCHOCA    IFNE 0
832700200529     C                     MOVE *BLANKS   ZFLD15
832800200529     C                     MOVE MCHOCA    ZFLD15
832900200529     C           PPROC     IFEQ 'CR'
833000200529     C                     Z-ADDNMDPC1    ZDECS            Event Currency Decimal Places
833100200529     C                     ELSE
833200200529     C                     Z-ADDNMDPC2    ZDECS            New Currency Decimal Places
833300200529     C                     ENDIF
833400200529     C                     EXSR ZSEDIT
833500200529     C                     MOVE ZOUT21    STACA
833600200529     C                     ENDIF
833700200529      *
833800200529     C                     MOVE *BLANKS   SCAOP
833900200529     C           MCCAOP    IFNE 0
834000200529     C                     MOVE *BLANKS   ZFLD15
834100200529     C                     MOVE MCCAOP    ZFLD15
834200200529     C           PPROC     IFEQ 'CR'
834300200529     C                     Z-ADDNMDPC1    ZDECS            Event Currency Decimal Places
834400200529     C                     ELSE
834500200529     C                     Z-ADDNMDPC2    ZDECS            New Currency Decimal Places
834600200529     C                     ENDIF
834700200529     C                     EXSR ZSEDIT
834800200529     C                     MOVE ZOUT21    SCAOP
834900200529     C                     ENDIF
835000200529      *
835100200529     C                     MOVE *BLANKS   SACAL
835200200529     C           MCACAA    IFNE 0
835300200529     C                     MOVE *BLANKS   ZFLD15
835400200529     C                     MOVE MCACAA    ZFLD15
835500200529     C           PPROC     IFEQ 'CR'
835600200529     C                     Z-ADDNMDPC1    ZDECS            Event Currency Decimal Places
835700200529     C                     ELSE
835800200529     C                     Z-ADDNMDPC2    ZDECS            New Currency Decimal Places
835900200529     C                     ENDIF
836000200529     C                     EXSR ZSEDIT
836100200529     C                     MOVE ZOUT21    SACAL
836200200529     C                     ENDIF
836300200529      *
836400200529     C                     MOVE SACAL     SHACAL
836500200529     C                     Z-ADDMCACAA    SHACAA
836600200529     C                     Z-ADDMCACAA    HSACAA
836700200529      *
836800200529     C                     MOVE *BLANKS   SOCRO
836900200529     C           MCOCAR    IFNE 0
837000200529     C                     MOVE *BLANKS   ZFLD15
837100200529     C                     MOVE MCOCAR    ZFLD15
837200200529     C           PPROC     IFEQ 'CR'
837300200529     C                     Z-ADDNMDPC1    ZDECS            Event Currency Decimal Places
837400200529     C                     ELSE
837500200529     C                     Z-ADDNMDPC2    ZDECS            New Currency Decimal Places
837600200529     C                     ENDIF
837700200529     C                     EXSR ZSEDIT
837800200529     C                     MOVE ZOUT21    SOCRO
837900200529     C                     ENDIF
838000200529      *
838100200529     C                     MOVE *BLANKS   SACRO
838200200529     C           MCACAR    IFNE 0
838300200529     C                     MOVE *BLANKS   ZFLD15
838400200529     C                     MOVE MCACAR    ZFLD15
838500200529     C           PPROC     IFEQ 'CR'
838600200529     C                     Z-ADDNMDPC1    ZDECS            Event Currency Decimal Places
838700200529     C                     ELSE
838800200529     C                     Z-ADDNMDPC2    ZDECS            New Currency Decimal Places
838900200529     C                     ENDIF
839000200529     C                     EXSR ZSEDIT
839100200529     C                     MOVE ZOUT21    SACRO
839200200529     C                     ENDIF
839300200529      *
839400200529     C                     MOVE SACRO     SHACRO
839500200529     C                     Z-ADDMCACAR    SHACAR
839600200529     C                     Z-ADDMCACAR    HSACAR
839700200529      *
839800200529     C                     MOVE *BLANKS   STFEE
839900200529     C           MCTOTF    IFNE 0
840000200529     C                     MOVE *BLANKS   ZFLD15
840100200529     C                     MOVE MCTOTF    ZFLD15
840200200529     C           PPROC     IFEQ 'CR'
840300200529     C                     Z-ADDNMDPC1    ZDECS            Event Currency Decimal Places
840400200529     C                     ELSE
840500200529     C                     Z-ADDNMDPC2    ZDECS            New Currency Decimal Places
840600200529     C                     ENDIF
840700200529     C                     EXSR ZSEDIT
840800200529     C                     MOVE ZOUT21    STFEE
840900200529     C                     ENDIF
841000200529      *
841100200529     C                     Z-ADDMCTOTF    SHTOTF
841200200529      *
841300200529     ******Total*Settlement*=*Actual*Cash*Allocation*&*Rounding*+/-*Total*Fees*+/-*Total*Taxes161641
841400200529     ******(+*if*Ex-Date*Position*is*>*or*=*0,*else*-).***************************************161641
841500200529      ***  Total Settlement = Actual Cash Allocation & Rounding   - Total 161641
841600200529      ***  Fees +/- Total Taxes (- if Ex-Date Position is > or = 0,       161641
841700200529      ***  else +).                                                       161641
841800200529      *
841900200529     C           MCACAA    ADD  MCACAR    WWTSET 150
842000200529     C           MCEXPO    IFGE 0
842100200529     C***********          ADD  MCTOTF    WWTSET                          161641
842200200529     C***********          ADD  MCTOTT    WWTSET                          161641
842300200529     C                     SUB  MCTOTF    WWTSET                          161641
842400200529     C                     SUB  MCTOTT    WWTSET                          161641
842500200529     C                     ELSE
842600200529     C                     SUB  MCTOTF    WWTSET
842700200529     C***********          SUB  MCTOTT    WWTSET                          161641
842800200529     C                     ADD  MCTOTT    WWTSET                          161641
842900200529     C                     ENDIF
843000200529     C                     MOVE *BLANKS   STSET
843100200529     C           WWTSET    IFNE 0
843200200529     C                     MOVE *BLANKS   ZFLD15
843300200529     C                     MOVE WWTSET    ZFLD15
843400200529     C           PPROC     IFEQ 'CR'
843500200529     C                     Z-ADDNMDPC1    ZDECS            Event Currency Decimal Places
843600200529     C                     ELSE
843700200529     C                     Z-ADDNMDPC2    ZDECS            New Currency Decimal Places
843800200529     C                     ENDIF
843900200529     C                     EXSR ZSEDIT
844000200529     C                     MOVE ZOUT21    STSET
844100200529     C                     ENDIF
844200200529      *
844300200529      ***  If Processing Type = Dividend Events and Withholding Tax feature is ON, display Total
844400200529      ***  Taxes, otherwise, display blank fields.
844500200529      *
844600200529     C           PPROC     IFEQ 'DV'
844700200529     C           S01447    ANDEQ'Y'
844800200529     C                     MOVEL'Total'   STTOT
844900200529     C                     MOVE 'Taxes'   STTOT
845000200529     C                     MOVE *BLANKS   STOTT
845100200529     C           MCTOTT    IFNE 0
845200200529     C                     MOVE *BLANKS   ZFLD15
845300200529     C                     MOVE MCTOTT    ZFLD15
845400200529     C           PPROC     IFEQ 'CR'
845500200529     C                     Z-ADDNMDPC1    ZDECS            Event Currency Decimal Places
845600200529     C                     ELSE
845700200529     C                     Z-ADDNMDPC2    ZDECS            New Currency Decimal Places
845800200529     C                     ENDIF
845900200529     C                     EXSR ZSEDIT
846000200529     C                     MOVE ZOUT21    STOTT
846100200529     C                     ENDIF
846200200529     C                     ELSE
846300200529     C                     MOVE *BLANKS   STTOT
846400200529     C                     MOVE *BLANKS   STOTT
846500200529     C                     ENDIF
846600200529     C                     Z-ADDMCTOTT    SHTOTT
846700200529      *
846800200529     C                     ELSE
846900200529      *
847000200529      ***  If record not found in SECOALL1, set all fields to blank.
847100200529      *
847200200529     C                     MOVE *BLANKS   STACA
847300200529     C                     MOVE *BLANKS   SCAOP
847400200529     C                     MOVE *BLANKS   SACAL
847500200529     C                     MOVE *BLANKS   SHACAL
847600200529     C                     MOVE *BLANKS   SOCRO
847700200529     C                     MOVE *BLANKS   SACRO
847800200529     C                     MOVE *BLANKS   SHACRO
847900200529     C                     MOVE *BLANKS   STFEE
848000200529     C                     MOVE *BLANKS   STSET
848100200529     C                     MOVE *BLANKS   STTOT
848200200529     C                     MOVE *BLANKS   STOTT
848300200529     C                     ENDIF
848400200529      *
848500200529      ***  Write a record in the subfile.
848600200529      *
848700200529     C                     WRITESE7513S1
848800200529      *
848900200529     C                     ENDIF
849000200529      *
849100200529     C                     ENDSR
849200200529      *
849300200529      *****************************************************************
849400200529      /EJECT
849500200529      *****************************************************************
849600200529      *                                                               *
849700200529      *  SRU002 - Write/Update Allocation file for each subfile       *
849800200529      *           changes when enter is pressed or add mode is        *
849900200529      *           selected.                                           *
850000200529      *                                                               *
850100200529      *  Called by:                                                   *
850200200529      *                                                               *
850300200529      *  Calls:                                                       *
850400200529      *                                                               *
850500200529      *****************************************************************
850600200529      *
850700200529     C           SRU002    BEGSR                           ** SRU002 SR **
850800200529      *
850900200529     C                     MOVE 'D'       MCRECI
851000200529     C                     Z-ADDBJRDNB    MCLCD
851100200529     C                     MOVE SUSER     MCLUID
851200200529     C                     MOVE PCORF     MCCORF
851300200529     C                     Z-ADDPOPTN     MCOPTN
851400200529     C                     MOVE PBRCD     MCBRCD
851500200529     C**********           Z-ADDPDEPO     MCDDPT                                              CSD027
851600200529     C                     MOVE PDEPO     MCDDPT                                              CSD027
851700200529      *
851800200529     C           SHBOOK    IFEQ *BLANKS
851900200529     C                     MOVE 'C'       MCCOTP
852000200529     C                     ELSE
852100200529     C                     MOVE 'B'       MCCOTP
852200200529     C                     ENDIF
852300200529      *
852400200529     C                     MOVE SHBOOK    MCBOOK
852500200529      *
852600200529     C                     MOVE *BLANKS   ZFIELD
852700200529     C                     MOVE SHCNUM    MCCNUM
852800200529      *
852900200529     C                     MOVE SHPORT    MCPTFR
853000200529      *
853100200529     C                     MOVE *BLANKS   ZFLD17
853200200529     C                     MOVE SEXPOS    ZFLD17
853300200529     C                     Z-ADDNMDP1     ZSDEC            Event Security Decimal Places
853400200529     C           15        SUB  ZSDEC     ZSDIG
853500200529     C                     EXSR ZASIGN
853600200529     C                     MOVE ZOUT15    MCEXPO
853700200529     C           ZFSIGN    IFEQ '-'
853800200529     C                     Z-SUBMCEXPO    MCEXPO
853900200529     C                     ENDIF
854000200529      *
854100200529     C           *IN60     IFEQ '1'
854200200529     C                     MOVE PNWSEC    MCSESN
854300200529     C           *IN79     IFEQ '1'
854400200529     C                     Z-ADD0         MCOALR
854500200529     C                     Z-ADD0         MCOTSA
854600200529     C                     Z-ADD0         MCOSTR
854700200529     C                     Z-ADD0         MCOCAR
854800200529     C                     ENDIF
854900200529     C                     Z-ADD0         MCCAOP
855000200529     C                     Z-ADD0         MCTOTF
855100200529     C                     Z-ADD0         MCTOTT
855200200529      *
855300200529     C                     MOVE *BLANKS   ZFLD17
855400200529     C                     MOVE SASAL     ZFLD17
855500200529     C                     Z-ADDNMDP2     ZSDEC            New Security Decimal Places
855600200529     C           15        SUB  ZSDEC     ZSDIG
855700200529     C                     EXSR ZASIGN
855800200529     C                     MOVE ZOUT15    MCASTA
855900200529     C           ZFSIGN    IFEQ '-'
856000200529     C                     Z-SUBMCASTA    MCASTA
856100200529     C                     ENDIF
856200200529     C           SHCNUM    IFEQ WDUMMY                                    136935
856300200529     C                     ADD  ASTADU    MCASTA                          136935
856400200529     C                     MOVE 'Y'       DUMMYM                          136935
856500200529     C                     ENDIF                                          136935
856600200529      *
856700200529     C                     MOVE *BLANKS   ZFLD17
856800200529     C                     MOVE STAST     ZFLD17
856900200529     C                     Z-ADDNMDP1     ZSDEC            Event Security Decimal Places
857000200529     C           15        SUB  ZSDEC     ZSDIG
857100200529     C                     EXSR ZASIGN
857200200529     C                     MOVE ZOUT15    MCHOST
857300200529     C           ZFSIGN    IFEQ '-'
857400200529     C                     Z-SUBMCHOST    MCHOST
857500200529     C                     ENDIF
857600200529      *
857700200529     C           AMHOCA    IFEQ 'Y'
857800200529     C                     Z-ADDWWHOCA    MCHOCA
857900200529     C                     ENDIF
858000200529      *
858100200529     C                     Z-ADD0         MCACAA
858200200529      *
858300200529     C                     MOVE *BLANKS   ZFLD17
858400200529     C                     MOVE SASRO     ZFLD17
858500200529     C                     Z-ADD7         ZSDIG
858600200529     C                     Z-ADD8         ZSDEC            8 Decimal Places
858700200529     C                     EXSR ZASIGN
858800200529     C                     MOVE ZOUT15    MCASTR
858900200529     C           ZFSIGN    IFEQ '-'
859000200529     C                     Z-SUBMCASTR    MCASTR
859100200529     C                     ENDIF
859200200529     C           SHCNUM    IFEQ WDUMMY                                    136935
859300200529     C                     ADD  ASTRDU    MCASTR                          136935
859400200529     C                     MOVE 'Y'       DUMMYM                          136935
859500200529     C                     ENDIF                                          136935
859600200529      *
859700200529     C                     MOVE *BLANKS   ZFLD17
859800200529     C                     MOVELSACRO     ZFLD17
859900200529     C                     Z-ADDNMDPC2    ZSDEC            New Currency Decimal Places
860000200529     C           15        SUB  ZSDEC     ZSDIG
860100200529     C                     EXSR ZASIGN
860200200529     C                     MOVE ZOUT15    MCACAR
860300200529     C           ZFSIGN    IFEQ '-'
860400200529     C                     Z-SUBMCACAR    MCACAR
860500200529     C                     ENDIF
860600200529     C           SHCNUM    IFEQ WDUMMY                                    136935
860700200529     C                     ADD  ACARDU    MCACAR                          136935
860800200529     C                     MOVE 'Y'       DUMMYM                          136935
860900200529     C                     ENDIF                                          136935
861000200529      *
861100200529     C                     ELSE
861200200529      *
861300200529     C                     MOVEL'**CASH**'MCSESN
861400200529     C                     Z-ADD0         MCOALR
861500200529     C                     Z-ADD0         MCOSTR
861600200529     C                     Z-ADD0         MCASTA
861700200529     C                     Z-ADD0         MCASTR
861800200529     C           *IN79     IFEQ '1'
861900200529     C                     Z-ADD0         MCOTSA
862000200529     C                     Z-ADD0         MCOCAR
862100200529     C                     Z-ADD0         MCCAOP
862200200529     C                     ENDIF
862300200529      *
862400200529     C                     MOVE *BLANKS   ZFLD17
862500200529     C                     MOVE SACAL     ZFLD17
862600200529     C           PPROC     IFEQ 'CR'
862700200529     C                     Z-ADDNMDPC1    ZSDEC            Event Currency Decimal Places
862800200529     C                     ELSE
862900200529     C                     Z-ADDNMDPC2    ZSDEC            New Currency Decimal Places
863000200529     C                     ENDIF
863100200529     C           15        SUB  ZSDEC     ZSDIG
863200200529     C                     EXSR ZASIGN
863300200529     C                     MOVE ZOUT15    MCACAA
863400200529     C           ZFSIGN    IFEQ '-'
863500200529     C                     Z-SUBMCACAA    MCACAA
863600200529     C                     ENDIF
863700200529     C           SHCNUM    IFEQ WDUMMY                                    136935
863800200529     C                     ADD  ACAADU    MCACAA                          136935
863900200529     C                     MOVE 'Y'       DUMMYM                          136935
864000200529     C                     ENDIF                                          136935
864100200529      *
864200200529     C                     MOVE *BLANKS   ZFLD17
864300200529     C                     MOVE SACRO     ZFLD17
864400200529     C           PPROC     IFEQ 'CR'
864500200529     C                     Z-ADDNMDPC1    ZSDEC            Event Currency Decimal Places
864600200529     C                     ELSE
864700200529     C                     Z-ADDNMDPC2    ZSDEC            New Currency Decimal Places
864800200529     C                     ENDIF
864900200529     C           15        SUB  ZSDEC     ZSDIG
865000200529     C                     EXSR ZASIGN
865100200529     C                     MOVE ZOUT15    MCACAR
865200200529     C           ZFSIGN    IFEQ '-'
865300200529     C                     Z-SUBMCACAR    MCACAR
865400200529     C                     ENDIF
865500200529     C           SHCNUM    IFEQ WDUMMY                                    136935
865600200529     C                     ADD  ACARDU    MCACAR                          136935
865700200529     C                     MOVE 'Y'       DUMMYM                          136935
865800200529     C                     ENDIF                                          136935
865900200529      *
866000200529     C                     MOVE *BLANKS   ZFLD17
866100200529     C                     MOVE STFEE     ZFLD17
866200200529     C           PPROC     IFEQ 'CR'
866300200529     C                     Z-ADDNMDPC1    ZSDEC            Event Currency Decimal Places
866400200529     C                     ELSE
866500200529     C                     Z-ADDNMDPC2    ZSDEC            New Currency Decimal Places
866600200529     C                     ENDIF
866700200529     C           15        SUB  ZSDEC     ZSDIG
866800200529     C                     EXSR ZASIGN
866900200529     C                     MOVE ZOUT15    MCTOTF
867000200529     C           ZFSIGN    IFEQ '-'
867100200529     C                     Z-SUBMCTOTF    MCTOTF
867200200529     C                     ENDIF
867300200529      *
867400200529     C                     MOVE *BLANKS   ZFLD17
867500200529     C                     MOVE STOTT     ZFLD17
867600200529     C           PPROC     IFEQ 'CR'
867700200529     C                     Z-ADDNMDPC1    ZSDEC            Event Currency Decimal Places
867800200529     C                     ELSE
867900200529     C                     Z-ADDNMDPC2    ZSDEC            New Currency Decimal Places
868000200529     C                     ENDIF
868100200529     C           15        SUB  ZSDEC     ZSDIG
868200200529     C                     EXSR ZASIGN
868300200529     C                     MOVE ZOUT15    MCTOTT
868400200529     C           ZFSIGN    IFEQ '-'
868500200529     C                     Z-SUBMCTOTT    MCTOTT
868600200529     C                     ENDIF
868700200529      *
868800200529     C                     ENDIF
868900200529      *
869000200529     C           *IN79     IFEQ '1'
869100200529     C                     MOVE 'I'       MCCHTP
869200200529     C                     MOVE ' '       MCOPT1
869300200529     C                     MOVE ' '       MCOPT2
869400200529     C                     MOVE 'M'       MCREST
869500200529     C                     Z-ADDMABEND    MCBEDT
869600200529     C                     Z-ADDMABFRD    MCBSTT
869700200529     C                     MOVE 'P'       MCBLTY
869800200529     C                     MOVE MABLOP    MCBEWI
869900200529     C                     MOVE PACT      MCCOAT
870000200529     C                     MOVE *BLANKS   MCTRRF
870100200529     C                     MOVE *BLANKS   MCTRR2
870200200529     C                     MOVE *BLANKS   MCRVRF
870300200529     C                     Z-ADD0         MCTNL1
870400200529     C                     MOVE MALREQ    MCLTRQ
870500200529      *
870600200529     C                     WRITESECOALD0
870700200529      *
870800200529     C                     ELSE
870900200529     C                     MOVE 'A'       MCCHTP
871000200529     C                     MOVE 'M'       MCREST
871100200529      *
871200200529     C                     UPDATSECOALD0
871400200529      *
871500200529     C                     ENDIF
871600200529      *
871700200529     C                     ENDSR
871800200529      *
871900200529      *****************************************************************
872000200529      /EJECT
872100200529      *****************************************************************
872200200529      *                                                               *
872300200529      *  *PSSR  - Error control subroutine.                           *
872400200529      *                                                               *
872500200529      *  Called by: SRINIT - Initial processing.                      *
872600200529      *                                                               *
872700200529      *  Calls:                                                       *
872800200529      *                                                               *
872900200529      *****************************************************************
873000200529      *
873100200529     C           *PSSR     BEGSR                           ** *PSSR SR **
873200200529      *
873300200529      ***  Rollback Changes, Print Dump and Cancel Program.
873400200529      *
873500200529     C                     ROLBK
873600200529     C                     MOVE 'E'       PRTCD
873700200529     C                     DUMP
873800200529      *
873900200529     C                     MOVE '1'       *INU7
874000200529     C                     MOVE '1'       *INU8
874100200529     C                     MOVE '1'       *INLR
874200200529     C                     CALL 'DBERRCTL'
874300200529     C                     RETRN
874400200529      *
874500200529     C                     ENDSR
874600200529      *
874700200529      *****************************************************************
874800200529      /EJECT
874900200529      *****************************************************************
875000200529      *                                                               *
875100200529      *  ZASNMS - Send Message to Program Message Queue.              *
875200200529      *                                                               *
875300200529      *  Called by: SRMAIN - Main processing.                         *
875400200529      *             SRENDP - Termination processing.                  *
875500200529      *             SRVALD - Validate subfile records.                *
875600200529      *                                                               *
875700200529      *  Calls:                                                       *
875800200529      *                                                               *
875900200529      *****************************************************************
876000200529      *
876100200529     C           ZASNMS    BEGSR                           ** ZASNMS SR **
876200200529      *
876300200529     C           ZAPGMQ    IFEQ *BLANKS
876400200529     C                     MOVELSPGM      ZAPGMQ
876500200529     C                     ENDIF
876600200529      *
876700200529     C                     CALL 'Y2SNMGC'
876800200529     C                     PARM           ZAPGMQ 10        Program queue
876900200529     C                     PARM           ZAPGRL  5        Rel queue
877000200529     C                     PARM           ZAMSID  7        Message Id.
877100200529     C                     PARM           ZAMSGF 10        Message file.
877200200529     C                     PARM           ZAMSDA132        Message data.
877300200529     C                     PARM           ZAMSTP  7        Message type.
877400200529      *
877500200529     C           ZASNM9    ENDSR                           ** ZASNM9 **
877600200529      *
877700200529      *****************************************************************
877800200529      /EJECT
877900200529      *****************************************************************
878000200529      *                                                               *
878100200529      *  RTVNDP - Set amount from num field 15.0 to num field 30.9    *
878200200529      *           with Retrieve Number of Decimal Places of a Ccy.    *
878300200529      *                                                               *
878400200529      *  Called by:                                                   *
878500200529      *                                                               *
878600200529      *  Calls:                                                       *
878700200529      *                                                               *
878800200529      *****************************************************************
878900200529      *
879000200529     C           RTVNDP    BEGSR                           ** RTVNDP SR **
879100200529      *
879200200529     C           WWNBDP    IFEQ 0                          If no Decimal Place
879300200529     C                     Z-ADDWUNUM     WWNUM  309
879400200529     C                     ELSE
879500200529     C           WWNBDP    IFEQ 1                          If 1 Decimal Place
879600200529     C           WUNUM     DIV  10        WWNUM
879700200529     C                     ELSE
879800200529     C           WWNBDP    IFEQ 2                          If 2 Decimal Places
879900200529     C           WUNUM     DIV  100       WWNUM
880000200529     C                     ELSE
880100200529     C           WWNBDP    IFEQ 3                          If 3 Decimal Places
880200200529     C           WUNUM     DIV  1000      WWNUM
880300200529     C                     ELSE
880400200529     C           WWNBDP    IFEQ 4                          If 4 Decimal Places
880500200529     C           WUNUM     DIV  10000     WWNUM
880600200529     C                     ENDIF
880700200529     C                     ENDIF
880800200529     C                     ENDIF
880900200529     C                     ENDIF
881000200529     C                     ENDIF
881100200529      *
881200200529     C                     ENDSR
881300200529      *
881400200529      *****************************************************************
881500200529      /EJECT
881600200529      *****************************************************************
881700200529      *                                                               *
881800200529      *  SETNDP - Set amount from num field 30.9 to num field 15.0    *
881900200529      *           with Number of Decimal Places of a Currency.        *
882000200529      *                                                               *
882100200529      *  Called by:                                                   *
882200200529      *                                                               *
882300200529      *  Calls:                                                       *
882400200529      *                                                               *
882500200529      *****************************************************************
882600200529      *
882700200529     C           SETNDP    BEGSR                           ** SETNDP SR **
882800200529      *
882900200529     C           WWNBDP    IFEQ 0                          If no Decimal Place
883000200529     C                     Z-ADDWWNUM     WUNUM  150
883100200529     C                     ELSE
883200200529     C           WWNBDP    IFEQ 1                          If 1 Decimal Place
883300200529     C           WWNUM     MULT 10        WUNUM
883400200529     C                     ELSE
883500200529     C           WWNBDP    IFEQ 2                          If 2 Decimal Places
883600200529     C           WWNUM     MULT 100       WUNUM
883700200529     C                     ELSE
883800200529     C           WWNBDP    IFEQ 3                          If 3 Decimal Places
883900200529     C           WWNUM     MULT 1000      WUNUM
884000200529     C                     ELSE
884100200529     C           WWNBDP    IFEQ 4                          If 4 Decimal Places
884200200529     C           WWNUM     MULT 10000     WUNUM
884300200529     C                     ENDIF
884400200529     C                     ENDIF
884500200529     C                     ENDIF
884600200529     C                     ENDIF
884700200529     C                     ENDIF
884800200529      *
884900200529     C                     ENDSR
885000200529      *
885100200529      *****************************************************************
885200200529      /EJECT
885300200529      *****************************************************************
885400200529      *                                                               *
885500200529      *  ROUNDD - Perform rounding to the Number of Decimal Places.   *
885600200529      *                                                               *
885700200529      *  Called by:                                                   *
885800200529      *                                                               *
885900200529      *  Calls:                                                       *
886000200529      *                                                               *
886100200529      *****************************************************************
886200200529      *
886300200529     C           ROUNDD    BEGSR                           ** ROUNDD SR **
886400200529      *
886500200529     C           WWNBDP    IFEQ 0                          If no Decimal Place
886600200529     C           WUROOP    IFEQ 'R'
886700200529     C                     Z-ADDWWNUM     WUFLD0 240H
886800200529     C                     ELSE
886900200529     C                     Z-ADDWWNUM     WUFLD0
887000200529     C           WUROOP    IFEQ 'U'
887100200529     C           WWNUM     ANDNEWUFLD0
887200200529     C                     ADD  1         WUFLD0
887300200529     C                     ENDIF
887400200529     C                     ENDIF
887500200529     C                     Z-ADDWUFLD0    WWNUM
887600200529     C                     ELSE
887700200529     C           WWNBDP    IFEQ 1                          If 1 Decimal Place
887800200529     C           WUROOP    IFEQ 'R'
887900200529     C                     Z-ADDWWNUM     WUFLD1 241H
888000200529     C                     ELSE
888100200529     C                     Z-ADDWWNUM     WUFLD1
888200200529     C           WUROOP    IFEQ 'U'
888300200529     C           WWNUM     ANDNEWUFLD1
888400200529     C                     ADD  0.1       WUFLD1
888500200529     C                     ENDIF
888600200529     C                     ENDIF
888700200529     C                     Z-ADDWUFLD1    WWNUM
888800200529     C                     ELSE
888900200529     C           WWNBDP    IFEQ 2                          If 2 Decimal Places
889000200529     C           WUROOP    IFEQ 'R'
889100200529     C                     Z-ADDWWNUM     WUFLD2 242H
889200200529     C                     ELSE
889300200529     C                     Z-ADDWWNUM     WUFLD2
889400200529     C           WUROOP    IFEQ 'U'
889500200529     C           WWNUM     ANDNEWUFLD2
889600200529     C                     ADD  0.01      WUFLD2
889700200529     C                     ENDIF
889800200529     C                     ENDIF
889900200529     C                     Z-ADDWUFLD2    WWNUM
890000200529     C                     ELSE
890100200529     C           WWNBDP    IFEQ 3                          If 3 Decimal Places
890200200529     C           WUROOP    IFEQ 'R'
890300200529     C                     Z-ADDWWNUM     WUFLD3 243H
890400200529     C                     ELSE
890500200529     C                     Z-ADDWWNUM     WUFLD3
890600200529     C           WUROOP    IFEQ 'U'
890700200529     C           WWNUM     ANDNEWUFLD3
890800200529     C                     ADD  0.001     WUFLD3
890900200529     C                     ENDIF
891000200529     C                     ENDIF
891100200529     C                     Z-ADDWUFLD3    WWNUM
891200200529     C                     ELSE
891300200529     C           WWNBDP    IFEQ 4                          If 4 Decimal Places
891400200529     C           WUROOP    IFEQ 'R'
891500200529     C                     Z-ADDWWNUM     WUFLD4 244H
891600200529     C                     ELSE
891700200529     C                     Z-ADDWWNUM     WUFLD4
891800200529     C           WUROOP    IFEQ 'U'
891900200529     C           WWNUM     ANDNEWUFLD4
892000200529     C                     ADD  0.0001    WUFLD4
892100200529     C                     ENDIF
892200200529     C                     ENDIF
892300200529     C                     Z-ADDWUFLD4    WWNUM
892400200529     C                     ELSE
892500200529     C           WWNBDP    IFEQ 8                          If 8 Decimal Places
892600200529     C           WUROOP    IFEQ 'R'
892700200529     C                     Z-ADDWWNUM     WUFLD8 248H
892800200529     C                     ELSE
892900200529     C                     Z-ADDWWNUM     WUFLD8
893000200529     C           WUROOP    IFEQ 'U'
893100200529     C           WWNUM     ANDNEWUFLD8
893200200529     C                     ADD  0.00000001WUFLD8
893300200529     C                     ENDIF
893400200529     C                     ENDIF
893500200529     C                     Z-ADDWUFLD8    WWNUM
893600200529     C                     ENDIF
893700200529     C                     ENDIF
893800200529     C                     ENDIF
893900200529     C                     ENDIF
894000200529     C                     ENDIF
894100200529     C                     ENDIF
894200200529      *
894300200529     C                     ENDSR
894400200529      *
894500200529      *****************************************************************
894600200529      /EJECT
894700200529      *****************************************************************
894800200529      *                                                               *
894900200529      *  CSBPR  - Calculate Subscription Price if Subscription Price  *
895000200529      *           entered as Market for Dividend Events.              *
895100200529      *                                                               *
895200200529      *  Called by:                                                   *
895300200529      *                                                               *
895400200529      *  Calls:                                                       *
895500200529      *                                                               *
895600200529      *****************************************************************
895700200529      *
895800200529     C           CSBPR     BEGSR                           ** CSBPR SR **
895900200529      *
896000200529      ***  Find Market Price with correct Date.
896100200529      *
896200200529     C                     MOVE 'N'       WWCHCK  1
896300200529      *
896400200529     C                     Z-ADDMACOEX    KPVDT
896500200529     C           WKEY15    SETGTPRICM
896600200529     C                     READPPRICM                    44
896700200529      *
896800200529      ***  If record found use this Price.
896900200529      *
897000200529     C           *IN44     IFEQ '0'
897100200529     C           PSSN      ANDEQMDNSEC
897200200529     C                     MOVE 'Y'       WWCHCK
897300200529      *
897400200529      ***  Otherwise check for Current Price.
897500200529      *
897600200529     C                     ELSE
897700200529     C                     Z-ADD*HIVAL    KPVDT
897800200529      *
897900200529     C           WKEY15    SETGTPRICM
898000200529     C                     READPPRICM                    44
898100200529      *
898200200529      ***  If record found use this price.
898300200529      *
898400200529     C           *IN44     IFEQ '0'
898500200529     C           PSSN      ANDEQMDNSEC
898600200529     C                     MOVE 'Y'       WWCHCK
898700200529     C                     ENDIF
898800200529     C                     ENDIF
898900200529      *
899000200529     C           WWCHCK    IFEQ 'N'
899100200529     C                     Z-ADDMKPR      MPRICE 158       Market Price from Security file.
899200200529     C                     ELSE
899300200529     C                     Z-ADDPPRC      MPRICE
899400200529     C                     ENDIF
899500200529      *
899600200529      ***  Calculate Subscription Price = Current Market Price minus Discount.
899700200529      *
899800200529     C           MPRICE    MULT MDDSRT    WWSBPR 158
899900200529     C           WWSBPR    DIV  100       WWSBPR
900000200529     C           MPRICE    SUB  WWSBPR    MDSBPR
900100200529      *
900200200529     C                     ENDSR
900300200529      *
900400200529      *****************************************************************
900500200529      /EJECT                                                              135685
900600200529      *****************************************************************   135685
900700200529      *                                                               *   135685
900800200529      *  CCOMP  - Calculate Compensation Price if Compensation Price  *   135685
900900200529      *           entered as Market for Currency Change Events.       *   135685
901000200529      *                                                               *   135685
901100200529      *  Called by:                                                   *   135685
901200200529      *                                                               *   135685
901300200529      *  Calls:                                                       *   135685
901400200529      *                                                               *   135685
901500200529      *****************************************************************   135685
901600200529      *                                                                   135685
901700200529     C           CCOMP     BEGSR                           ** CCOMP SR ** 135685
901800200529      *                                                                   135685
901900200529      ***  Find Market Price with correct Date.                           135685
902000200529      *                                                                   135685
902100200529     C                     MOVE 'N'       WWCHCK  1                       135685
902200200529      *                                                                   135685
902300200529     C           WKEY17    KLIST                                          135685
902400200529     C                     KFLD           NANSEC           New Security   135685
902500200529     C                     KFLD           KALEF   50       Alloc. Effec.  135685
902600200529      *                                                                   135685
902700200529     C                     Z-ADDMAALEF    KALEF                           135685
902800200529     C           WKEY17    SETGTPRICM                                     135685
902900200529     C                     READPPRICM                    44               135685
903000200529      *                                                                   135685
903100200529      ***  If record found use this Price.                                135685
903200200529      *                                                                   135685
903300200529     C           *IN44     IFEQ '0'                                       135685
903400200529     C           PSSN      ANDEQNANSEC                                    135685
903500200529     C                     MOVE 'Y'       WWCHCK                          135685
903600200529      *                                                                   135685
903700200529      ***  Otherwise check for Current Price.                             135685
903800200529      *                                                                   135685
903900200529     C                     ELSE                                           135685
904000200529     C                     Z-ADD*HIVAL    KALEF                           135685
904100200529      *                                                                   135685
904200200529     C           WKEY17    SETGTPRICM                                     135685
904300200529     C                     READPPRICM                    44               135685
904400200529      *                                                                   135685
904500200529      ***  If record found use this price.                                135685
904600200529      *                                                                   135685
904700200529     C           *IN44     IFEQ '0'                                       135685
904800200529     C           PSSN      ANDEQNANSEC                                    135685
904900200529     C                     MOVE 'Y'       WWCHCK                          135685
905000200529     C                     ENDIF                                          135685
905100200529     C                     ENDIF                                          135685
905200200529      *                                                                   135685
905300200529     C           WWCHCK    IFEQ 'N'                                       135685
905400200529     C                     Z-ADDMKPR      MDCOMP 158       Market Price   135685
905500200529     C                     ELSE                                           135685
905600200529     C                     Z-ADDPPRC      MDCOMP                          135685
905700200529     C                     ENDIF                                          135685
905800200529      *                                                                   135685
905900200529     C                     ENDSR                                          135685
906000200529      *                                                                   135685
906100200529      *****************************************************************   135685
906200200529      /EJECT
906300200529      *****************************************************************
906400200529      *                                                               *
906500200529      *  ZSEDIT - Standart subroutine to insert a decimal point into  *
906600200529      *           a numeric field and to blank out leading zeroes.    *
906700200529      *                                                               *
906800200529      *  Called by: SRINIT - Initial processing.                      *
906900200529      *             SRS001 - Set first lines of subfile for each Book *
907000200529      *                      Position records when subfile is build   *
907100200529      *                      from begining.                           *
907200200529      *             SRS002 - Set detail lines of subfile for each     *
907300200529      *                      Customer Position records when subfile   *
907400200529      *                      is build.                                *
907500200529      *                                                               *
907600200529      *  Calls:                                                       *
907700200529      *                                                               *
907800200529      *****************************************************************
907900200529      *
908000200529     C/COPY ZSRSRC,ZSEDITZ3
908100200529      *
908200200529      /EJECT
908300200529      *****************************************************************
908400200529      *                                                               *
908500200529      *  ZDATE2 - Standart subroutine to convert a Day Number to      *
908600200529      *           date formats.                                       *
908700200529      *                                                               *
908800200529      *  Called by: SRINIT - Initial processing.                      *
908900200529      *                                                               *
909000200529      *  Calls:                                                       *
909100200529      *                                                               *
909200200529      *****************************************************************
909300200529      *
909400200529     C/COPY ZSRSRC,ZDATE2Z2
909500200529      *
909600200529      /EJECT
909700200529      *****************************************************************
909800200529      *                                                               *
909900200529      *  ZALIGN - Standart subroutine to validate and righr-align     *
910000200529      *           numeric fields.                                     *
910100200529      *                                                               *
910200200529      *  Called by: SRMAIN - Main processing.                         *
910300200529      *                                                               *
910400200529      *  Calls:                                                       *
910500200529      *                                                               *
910600200529      *****************************************************************
910700200529      *
910800200529     C/COPY ZSRSRC,ZALIGNZ2
910900200529      *
911000200529      /EJECT
911100200529      *****************************************************************
911200200529      *                                                               *
911300200529      *  ZASIGN - Standart subroutine to validate and right-align     *
911400200529      *           signed numeric fields.                              *
911500200529      *                                                               *
911600200529      *  Called by:                                                   *
911700200529      *                                                               *
911800200529      *  Calls:                                                       *
911900200529      *                                                               *
912000200529      *****************************************************************
912100200529      *
912200200529     C/COPY ZSRSRC,ZASIGNZ2
912300200529      *
912400200529      /EJECT
912500200529      *****************************************************************
912600200529      *                                                               *
912700200529      *  ZCCAL1 - Standart subroutine to calculate Charges/           *
912800200529      *           Commissions.                                        *
912900200529      *                                                               *
913000200529      *  Called by:                                                   *
913100200529      *                                                               *
913200200529      *  Calls:                                                       *
913300200529      *                                                               *
913400200529      *****************************************************************
913500200529      *
913600200529     C/COPY ZSRSRC,ZCCAL1Z2
913700200529      *
913800200529      /EJECT
913900200529      *****************************************************************
914000200529      *                                                               *
914100200529      *  ZCCAL2 - Standart subroutine to calculate Charges/           *
914200200529      *           Commissions.                                        *
914300200529      *                                                               *
914400200529      *  Called by:                                                   *
914500200529      *                                                               *
914600200529      *  Calls:                                                       *
914700200529      *                                                               *
914800200529      *****************************************************************
914900200529      *
915000200529     C/COPY ZSRSRC,ZCCAL2Z1
915100200529      *
915200200529      /EJECT
915300200529      *****************************************************************
915400200529      *                                                               *
915500200529      *  ZCONV  - Standart subroutine to convert an amount from one   *
915600200529      *           Currency to another.                                *
915700200529      *                                                               *
915800200529      *  Called by:                                                   *
915900200529      *                                                               *
916000200529      *  Calls:                                                       *
916100200529      *                                                               *
916200200529      *****************************************************************
916300200529      *
916400200529     C/COPY ZSRSRC,ZCONVZ1
916500200529      *
916600200529      /EJECT
916700200529**  STATUS
916800200529Reply Received
916900200529Std Inst Default
917000200529Corporate Default
917100200529Manually Changed
917200200529None
917300200529**  NARR
917400200529ERROR CALLING PGM 'SE7515'
917500200529ERROR CALLING PGM 'SE7540'
917600200529ERROR SBMJOB CALLING'SEC7550'
917700200529**  CMD - CALL 'QCMDEXC' TO SBMJOB
917800200529SBMJOB JOB(COnnnnnnx) JOBD(BULKTJOBD) RQSDTA('CALL PGM(SEC7550) PARM(''xxxxxx''
917802200619''XXX'' ''XXXXXX'' ''XX'' ''XXXXXXXXXX'' ''XX'' ''XXXXXX'' ''XXXX'')')
917803200619MSGQ(MOPERQ) RTGDTA(*NONE) INLLIBL(*JOBD) USER(*JOBD) OUTQ(*JOBD)                             CSC023
918100200529**   ZYDY - YEARS IN DAYS CUMULATIVE, FOUR YEAR SPAN
9182002005290366073110961461
918300200529**   ZMDY - MONTHS IN DAYS CUMULATIVE THROUGH YEAR
918400200529000031059090120151181212243273304334365
918500200529**   ZMNM - MONTHS SHORT NAMES
918600200529JANFEBMARAPRMAYJUNJULAUGSEPOCTNOVDEC
918700200529**  POWER8 - ARRAY OF POWERS FOR CURRENCY CONVERSION
91880020052900000001
91890020052900000010
91900020052900000100
91910020052900001000
91920020052900010000
91930020052900100000
91940020052901000000
91950020052910000000
919600200529**  POWER - ARRAY OF POWERS FOR CURRENCY CONVERSION
9197002005290000001
9198002005290000010
9199002005290000100
9200002005290001000
9201002005290010000
9202002005290100000
9203002005291000000
920400200529**  CPY@
920500200529(c) Finastra International Limited 2001
