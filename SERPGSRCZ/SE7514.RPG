     H        1
      *****************************************************************
/*OVRF*: OVRDBF FILE(SECTYZ1) TOFILE(SECTY) SHARE(*NO)              : *
/*STD *  RPGBASE                                                      *
/*EXI *  TEXT('Midas SE Corporate action reply handling selection')
      *****************************************************************
      *                                                               *
      *  Midas - Securities Trading Module                            *
      *                                                               *
      *  SE7514 - Corporate Actions Reply Handling Selection          *
      *                                                               *
      *  Function:  This program maintains the Corporate Action       *
      *  (I/C)      Reply Handling Selection.                         *
      *                                                               *
      *  Called By: SE7502 - Corporate Actions Reference Maintenance  *
      *                                                               *
      *  (c) Finastra International Limited 2001                      *
      *                                                               *
      *  Last Amend No. MD058285           Date 22Jun21               *
      *  Prev Amend No. MD046248           Date 27Oct17               *
      * Bank Fusion Midas 1.4 Base -----------------------------------*
      * Midas Plus 1.4 Base 04 ---------------------------------------*
      * Midas Plus 1.4 Base ------------------------------------------*
      * Midas Plus 1.3 ----------- Base ------------------------------*
      *                 CSD031             Date 10Apr06               *
      *                 CPK024             Date 12Apr06               *
      *                 CSD027             Date 09Dec05               *
      *                 CSE071             Date 19Jul05               *
      *                 CSW037A            Date 02May05               *
      *                 223182             Date 30Jan04               *
      *                 CSD025             Date 11Jan05               *
      *                 CSW037             Date 15Dec04               *
      *                 CSW036             Date 15Dec04               *
      *                 CLE025             Date 20Oct03               *
      * Midas Release 4 --------------- Base -------------------------*
      *                 190204             Date 31May01               *
      * Midas DBA 3.03 -----------------------------------------------*
      *                 CSE020             Date 21Mar00               *
      *                 161732             Date 21Mar00               *
      *                 179197             Date 18May00               *
      * Midas DBA 3.02 -----------------------------------------------*
      *                 CPB001             Date 26Aug99               *
      * Midas DBA 3.00 ---------------- Base -------------------------*
      *                 CAC005             Date 04Dec98               *
      *                 155622             Date 22Feb99               *
      *                 137877             Date 30Jun98               *
      *                 CSE007  *CREATE    Date 01Dec97               *
      *                                                               *
      *---------------------------------------------------------------*
      *                                                               *
      *  MD058285 - Change base rate code to alphanumeric (Recompile) *
      *  MD046248 - Finastra Rebranding                               *
      *  CSD031 - Enhanced Centralised Static Data (Recompile)        *
      *  CPK024 - Packaging of MPlus 1.2.1. Copy sources needed by    *
      *           UTC0012.                                            *
      *  CSD027 - Conversion Of Customer Number to Alpha              *
      *  CSE071 - Multiple Holidays Re Securities (recompile)         *
      *  CSW037A- Additional Field extended to 40 chars (recompile)   *
      *  223182 - Error on Corporate Action.                          *
      *         - Ignore DBERR for closed customers. Applied 223539.  *
      *  CSD025 - Customer De-Activation                              *
      *  CSW037 - Additional Field Data on MT300/MT320                *
      *  CSW036 - Dual SWIFT BIC held on Client Details               *
      *  CLE025 - Credit Lines (Recompile)                            *
      *  190204 - Recompiled due to changes in PF/SECODVPD.           *
      *  CSE020 - Corporate Actions Domino Effect Processing          *
      *  161732 - Corporate Actions Exercise and Conversion -         *
      *           Part Stock/Keep Rest Calculation.                   *
      *           Also, change to: Build and retain the whole subfile *
      *  179197 - Correction of Message IDs                           *
      *  CPB001 - 'Private Banking' Module                            *
      *  CAC005 - PCA-SE Enhancement.                                 *
      *  155622 - Corporate Actions: Fields Standard Instructions     *
      *           Level 1 and 2 must be setup ONLY if record found    *
      *           in Standard Corporate Actions Instructions File.    *
      *  137877 - Corporate Actions: Reply Handling amendments.       *
      *  CSE007 - Corporate Actions                                   *
      *                                                               *
      *****************************************************************
      *
      ** SE Security Details
     FSECTYZ1 IF  E           K        DISK         KINFSR *PSSR
      *                                                                   CSE020
      ** SE Corporate Actions - References Upd Idx                        CSE020
     FSECORFL9IF  E           K        DISK                               CSE020
     F            SECORFD0                          KRENAMESECORFX0       CSE020
     F                                              KINFSR *PSSR          CSE020
      *
      **  MA - SE CORPORATE ACTIONS References
     FSECORFL1IF  E           K        DISK         KINFSR *PSSR
      *
      **  MD - SE Corporate Actions - Dividends Events
     FSECODVL1IF  E           K        DISK         KINFSR *PSSR
      *
      **  MF - SE Corporate Actions - Right Issues
     FSECORGL1IF  E           K        DISK         KINFSR *PSSR
      *
      **  MI - SE Corporate Actions - Exchange Offers
     FSECOOFL1IF  E           K        DISK         KINFSR *PSSR
      *
      **  MJ - SE Corporate Actions - Exercise & Conversion
     FSECOEXL1IF  E           K        DISK
     F                                              KINFSR *PSSR
      *
      **  MC - SE Corporate Actions - Allocations Rtv Idx
     FSECOALL2IF  E           K        DISK         KINFSR *PSSR
      *                                                                   137877
      **   MC - SE CORPORATE ACTIONS Allocation - Rtv Idx                 137877
     FSECOALL1IF  E           K        DISK                               137877
     F            SECOALD0                          KRENAMESECOALDU       137877
     F                                              KINFSR *PSSR          137877
      *                                                                   CSE020
      ** SE Corporate Actions - Stock Allocations                         CSE020
     FSECOALL5IF  E           K        DISK                               CSE020
     F            SECOALD0                          KRENAMESECOALD5       CSE020
     F                                              KINFSR *PSSR          CSE020
      *
      **  SE Corporate Actions - Customer Positions
     FSECOUPL0IF  E           K        DISK         KINFSR *PSSR
      *
      **  SE Corporate Actions - User Positions
     FSECOCPL0IF  E           K        DISK         KINFSR *PSSR
      *
      **  MQ - SE Corporate Actions - Reply Handling
     FSECOREL1IF  E           K        DISK         KINFSR *PSSR
      *
      **  MQ - SE Corporate Actions - Instructions
     FSECOSIL1IF  E           K        DISK         KINFSR *PSSR
      *
      **  MQ - SE Corporate Actions - Instructions
     FSECOSIL2IF  E           K        DISK         KINFSR *PSSR
     F            SECOSID0                          KRENAMESECOSID2
      *
      **  Display file
     FSE7514DFCF  E                    WORKSTN      KINFSR *PSSR
     F                                              KINFDS SCRDS
     F                                        #1RRN KSFILE SE7514S1
      *****************************************************************
      /EJECT
      *****************************************************************
      *                                                               *
      *                  FUNCTION OF INDICATORS                       *
      *                  ----------------------                       *
      *                                                               *
      *       20         Error in Branch                              *
      *       21         Error in Book                                *
      *       22         Error in Customer                            *
      *       23         Error in Portfolio                           *
      ********27*        Roll up key                                  *   161732
      *       30         Subfile End Indicator (SFLEND)               *
      *       31-33      Record not found                             *
      *       46         Any valid key                                *
      *       57         Protect Selection field                      *
      *       58         No display of Branch, Customer/Book,         *
      *                  Portfolio, Current Reply, Standard Instruc., *
      *                  & Default No Reply                           *
      *       59         No display of Depot & Position on Ex-Date    *
      *       62         Error in Selection field                     *
      *  63 - Error in Profit Centre.                                 *   CAC005
      *  70 - CAC005 is on, display profit centre in display file.    *   CAC005
      *       75         Record not found.                            *
      *       80-89      Standard RTS subroutines                     *
      *       90-99      Standard MIDAS subroutines                   *
      *       KC         Exit program                                 *
      *       KE         Refresh screen                               *
      *       KL         Previous screen                              *
      *       LR         End program.                                 *
      *       U7+U8      Database error occurs                        *
      *                                                               *
      *****************************************************************
      *                                                               *
      *  S U B R O U T I N E   I N D E X                              *
      *                                                               *
      *  SRINIT - Initial Processing                                  *
      *  SRALOC - Main Processing                                     *
      *  SRENDP - End Processing                                      *
      *  SRCLSF - Clear Subfile                                       *
      *  SRBLDS - Build Subfile                                       *
      *  SRPROC - Process read records                                *
      *  SRVALD - Validate action code                                *
      *  SRVIEW - View subfile from Review from fields                *
      *  SRVAC  - Validate action code
      *  SRSAVP - Save previous values of the subfile record          *
      *  SRRESP - Restore previous values of the subfile record       *
      *  *PSSR - Program error handling routine                       *
      *  ZASNMS - Send message to program's message queue             *
      *                                                               *
      *****************************************************************
      /EJECT
      ********************************************************************
      *
      **  Array for Copyright
     E                    CPY@    1   1 80
      *
     E                    NARR    1   3 27               Narrative
      *
      ** Temporary storage for *IN57 - *IN59
     E                    IND         3  1
      *
     E/COPY ZSRSRC,ZDATE2Z1
      *
     E/COPY ZSRSRC,ZALIGNZ1
      *
     E/COPY ZSRSRC,ZSEDITZ1
      *                                                                   161732
      ** Run-time array (loaded in C-Specs) that stores                   161732
      ** Branch-Customer/Book-Portfolio          (Argument Array)         161732
      *                                                                   161732
     E                    EXP1     9999 17                                161732
      *                                                                   161732
      ** Run-time array (loaded in C-Specs) for the total Ex-date         161732
      ** position (stored as character)          (Function Array)         161732
      *                                                                   161732
     E                    EXP2     9999 17                                161732
      ********************************************************************
      /EJECT
      ********************************************************************
     ISECORFX0                                                            CSE020
      ** Rename fields of SECORFL9: Midas SE CA Reference File            CSE020
      *                                                                   CSE020
     I              MARECI                          MNRECI                CSE020
     I              MALCD                           MNLCD                 CSE020
     I              MACHTP                          MNCHTP                CSE020
     I              MALUID                          MNLUID                CSE020
     I              MACORF                          MNCORF                CSE020
     I              MAJOBN                          MNJOBN                CSE020
     I              MAUSER                          MNUSER                CSE020
     I              MAJNBR                          MNJNBR                CSE020
     I              MASESN                          MNSESN                CSE020
     I              MACOAT                          MNCOAT                CSE020
     I              MAPTYP                          MNPTYP                CSE020
     I              MACOAN                          MNCOAN                CSE020
     I              MACOEX                          MNCOEX                CSE020
     I              MAALEF                          MNALEF                CSE020
     I              MANBOP                          MNNBOP                CSE020
     I              MATDVD                          MNTDVD                CSE020
     I              MACOPD                          MNCOPD                CSE020
     I              MATDDT                          MNTDDT                CSE020
     I              MAEVDT                          MNEVDT                CSE020
     I              MACPNB                          MNCPNB                CSE020
     I              MASHMD                          MNSHMD                CSE020
     I              MALTBS                          MNLTBS                CSE020
     I              MAOCPV                          MNOCPV                CSE020
     I              MANCPV                          MNNCPV                CSE020
     I              MAONML                          MNONML                CSE020
     I              MANNML                          MNNNML                CSE020
     I              MACUPC                          MNCUPC                CSE020
     I              MAEXPC                          MNEXPC                CSE020
     I              MACLRD                          MNCLRD                CSE020
     I              MACLRT                          MNCLRT                CSE020
     I              MADLRD                          MNDLRD                CSE020
     I              MADLRT                          MNDLRT                CSE020
     I              MABLOS                          MNBLOS                CSE020
     I              MABLOP                          MNBLOP                CSE020
     I              MABFRD                          MNBFRD                CSE020
     I              MABEND                          MNBEND                CSE020
     I              MAREFO                          MNREFO                CSE020
     I              MACONR                          MNCONR                CSE020
     I              MADFNR                          MNDFNR                CSE020
     I              MADFCP                          MNDFCP                CSE020
     I              MADFSP                          MNDFSP                CSE020
     I              MALREQ                          MNLREQ                CSE020
     I              MALPRO                          MNLPRO                CSE020
     I              MALTSI                          MNLTSI                CSE020
     I              MASTAT                          MNSTAT                CSE020
     I              MAPREF                          MNPREF                CSE020
     ISECOALD5                                                            CSE020
      ** Rename fields of SECOALL5: Midas SE CA Stock Allocations File    CSE020
      *                                                                   CSE020
     I              MCRECI                          M5RECI                CSE020
     I              MCLCD                           M5LCD                 CSE020
     I              MCCHTP                          M5CHTP                CSE020
     I              MCLUID                          M5LUID                CSE020
     I              MCCORF                          M5CORF                CSE020
     I              MCOPTN                          M5OPTN                CSE020
     I              MCBRCD                          M5BRCD                CSE020
     I              MCDDPT                          M5DDPT                CSE020
     I              MCCOTP                          M5COTP                CSE020
     I              MCBOOK                          M5BOOK                CSE020
     I              MCCNUM                          M5CNUM                CSE020
     I              MCPTFR                          M5PTFR                CSE020
     I              MCEXPO                          M5EXPO                CSE020
     I              MCSESN                          M5SESN                CSE020
     I              MCOALR                          M5OALR                CSE020
     I              MCOTSA                          M5OTSA                CSE020
     I              MCOSTR                          M5OSTR                CSE020
     I              MCOCAR                          M5OCAR                CSE020
     I              MCCAOP                          M5CAOP                CSE020
     I              MCASTA                          M5ASTA                CSE020
     I              MCHOST                          M5HOST                CSE020
     I              MCHOCA                          M5HOCA                CSE020
     I              MCACAA                          M5ACAA                CSE020
     I              MCASTR                          M5ASTR                CSE020
     I              MCACAR                          M5ACAR                CSE020
     I              MCOPT1                          M5OPT1                CSE020
     I              MCOPT2                          M5OPT2                CSE020
     I              MCREST                          M5REST                CSE020
     I              MCBSEC                          M5BSEC                CSE020
     I              MCBEDT                          M5BEDT                CSE020
     I              MCBSTT                          M5BSTT                CSE020
     I              MCBLTY                          M5BLTY                CSE020
     I              MCBEWI                          M5BEWI                CSE020
     I              MCCOAT                          M5COAT                CSE020
     I              MCTRRF                          M5TRRF                CSE020
     I              MCTRR2                          M5TRR2                CSE020
     I              MCTRR3                          M5TRR3                CSE020
     I              MCRVRF                          M5RVRF                CSE020
     I              MCRVR2                          M5RVR2                CSE020
     I              MCRVR3                          M5RVR3                CSE020
     I              MCTNL1                          M5TNL1                CSE020
     I              MCLTRQ                          M5LTRQ                CSE020
     I              MCTOTF                          M5TOTF                CSE020
     I              MCTOTT                          M5TOTT                CSE020
     IUDEPPDF
     I              UDBA                            MCBRCD
     I              UDSN                            MCSESN
     I              UDPT                            MCDDPT
     I              UDBK                            MCBOOK
     ICDEPPDF
     I              CDPA                            MCBRCD
     I              CDCN                            MCCNUM
     I              CDSN                            MCSESN
     I              CDPT                            MCDDPT
     I              PTFR                            MCPTFR
      *
      **  Program Data Structure
     IPGMDS     ESDSY2PGDSP
      *
     ISCRDS       DS
     I                                    B 378 3790CPFPOS
      *
      **   LOCAL DATA AREA
     ILDA       E DSLDA                         256
      *
      **  Local data area for database error details
      **  *LOCK IN LDA immediately before and OUT LDA immediately
      **  after each database error handling.
      **
      **                                    134 141 DBFILE
      **       Defines:                     142 170 DBKEY
      **                                    171 180 DBPGM
      **                                    181 1830DBASE
      *
      **  Bank Details
     ISDBANK    E DSSDBANKPD
     I*
     ISDCUST    E DSSDCUSTPD
     I** Customer Details
     I*
     ISDPORT    E DSSDPORTPD
     I**  Data structure for portfolio management details
     I*
     ISDSTRD    E DSSDSTRDPD
     I**  Data structure for securities trading details
     I*
     ISDMMOD    E DSSDMMODPD
     I**  Data structure for module details
      *
      **  Second DS for Access Programs, Long Data Structure
     IDSSDY     E DSDSSDY
      *
      *                                                                                       223182
      ** DS for access objects - long data structure                                          223182
      *                                                                                       223182
     IDSLDY     E DSDSLDY                                                                     223182
      *                                                                                       223182
     ISESTAT    E DSSESTAT
      *
     I/COPY ZSRSRC,ZSEDITZ2
     E***COPY*ZSRSRC,ZEDIT1*                                                                  CPK024
      *                                                                   161732
      ** Data Structure for Branch-Customer/Book-Portfolio combination    161732
      *                                                                   161732
     I                                        1  17 WBCBP                 161732
     I                                        1   3 WBRCH                 161732
     I                                        4  13 WCUBK                 161732
     I                                       14  17 WPORT                 161732
      *                                                                   161732
      ** Constant for 17 zeros                                            161732
      *                                                                   161732
     I              '                0'   C         WZERO                 161732
      ********************************************************************
      /EJECT
      ********************************************************************
      *                                                               *
      *            MAIN   - Start Mainline                            *
      *                                                               *
      * CALLS      SRINIT - Initial Processing                        *
      *            SRALOC - Main Processing                           *
      *            SRENDP   End Processing                            *
      *                                                               *
      * CALLED BY         -                                           *
      *                                                               *
      * FLDS USED         -                                           *
      *                                                               *
      *****************************************************************
      *
      **  Input Parameter List
      *
     C           *ENTRY    PLIST
     C                     PARM           @CORF   6        Reference
     C                     PARM           @SESN  10        Security Short.
     C                     PARM           @COAT   2        Corporate Type
     C                     PARM           @STAT   1        Status
     C                     PARM           @PTYP   2        Processing Type
     C                     PARM           @COEX   5        Ex-Date
     C                     PARM           @NMCY   3        Nominal Currency
     C                     PARM           @RTCD   1        Return Code
      *
      **  Initial Processing
     C                     EXSR SRINIT
      *
      **  Main Processing
     C           WWUDCD    IFEQ 'Y'
     C                     EXSR SRNOAL
     C                     ELSE
     C                     EXSR SRALOC
     C                     ENDIF
      *
      **  End Processing
     C                     EXSR SRENDP
      *****************************************************************
      /EJECT
      *****************************************************************
      *                                                               *
      *            SRINIT - Initial Processing                        *
      *                                                               *
      * CALLS      *PSSR  - Program error handling routine            *
      *                                                               *
      * CALLED BY  MAIN   - Main Routine.                             *
      *                                                               *
      * FLDS USED         -                                           *
      *                                                               *
      *****************************************************************
     C           SRINIT    BEGSR
      *
      **  Copyright Statement
     C                     MOVEACPY@      MKI@   80
      *
      **   Reset LDA
     C           *NAMVAR   DEFN           LDA
     C           *NAMVAR   DEFN           SESTAT
      *
      ***  Access data area SESTAT: Midas SE Status to check if Portfolio Manage
      ***  licensed.
     C                     IN   SESTAT
      *
     C           PFPL      IFEQ 'Y'
     C                     MOVE '1'       *IN55
     C                     ENDIF
      *
      **  Initialise Key and Working Fields
      *
     C                     Z-ADD*ZERO     #1RRN   40                      161732
      *                                                                   161732
      ** Search keys for LF/SECOALL2.
     C           KEY1      KLIST
     C                     KFLD           WCORF   6        Reference
     C                     KFLD           WOPNB   20       Option Number
      *
     C           KEY2      KLIST
     C                     KFLD           WCORF   6        Reference
     C                     KFLD           WOPNB   20       Option Number
     C                     KFLD           WBRCD   3        Branch Code
     C                     KFLD           WCOTP   1        Customer/Book Ind
     C                     KFLD           WBOOK   2        Book
     C**********           KFLD           WCNUM   60       Branch Code                        CSD027
     C                     KFLD           WCNUM   6        Branch Code                        CSD027
     C                     KFLD           WPTFR   4        Portfolio
     C**********           KFLD           WDDPT   60       Depot                              CSD027
     C                     KFLD           WDDPT   6        Depot                              CSD027
     C                     KFLD           WSESN  10        Security Shortname
      *
      ** Search keys for LF/SECOREL1.
     C           KEY3      KLIST
     C                     KFLD           WCORF   6        Reference
     C                     KFLD           WBRCD   3        Branch code
     C                     KFLD           WCOTP   1        Customer/Book Ind
     C                     KFLD           WBOOK   2        Book
     C**********           KFLD           WCNUM   60       Customer                           CSD027
     C                     KFLD           WCNUM   6        Customer                           CSD027
      *
      ** Search keys for LF/SECOSIL2.
     C           KEY4      KLIST
     C                     KFLD           WBRCD   3        Branch Code
     C                     KFLD           WBOOK   2        Book
     C                     KFLD           WCOAT   2        Corporate Type
     C                     KFLD           WSESN  10        Security Short.
      *
      ** Search keys for LF/SECOSIL1.
     C           KEY5      KLIST
     C                     KFLD           WBRCD   3        Branch Code
     C**********           KFLD           WCNUM   60       Customer                           CSD027
     C                     KFLD           WCNUM   6        Customer                           CSD027
     C                     KFLD           WPTFR   4        Portfolio
     C                     KFLD           WCOAT   2        Corporate Type
     C                     KFLD           WSESN  10        Security Short.
      *
     C           KEY11     KLIST
     C                     KFLD           KUDSN  10
     C                     KFLD           KUDBA   3
     C                     KFLD           KUDBK   2
     C**********           KFLD           KUDPT   60                                          CSD027
     C                     KFLD           KUDPT   6                                           CSD027
     C                     KFLD           KUDMK   1
     C                     KFLD           KEXDT   50
      *
     C           KEY11A    KLIST
     C                     KFLD           KUDSN  10
     C                     KFLD           KUDBA   3
     C                     KFLD           KUDBK   2
      *
     C           KEY12     KLIST
     C                     KFLD           KUDSN  10
     C                     KFLD           KUDBA   3
     C**********           KFLD           KCDCN   60                                          CSD027
     C                     KFLD           KCDCN   6                                           CSD027
     C                     KFLD           KPTFR   4
     C**********           KFLD           KUDPT   60                                          CSD027
     C                     KFLD           KUDPT   6                                           CSD027
     C                     KFLD           KUDMK   1
     C                     KFLD           KEXDT   50
      *
     C           KEY12A    KLIST
     C                     KFLD           KUDSN  10
     C                     KFLD           KUDBA   3
     C**********           KFLD           KCDCN   60                                          CSD027
     C                     KFLD           KCDCN   6                                           CSD027
     C                     KFLD           KPTFR   4
      *
     C           KEY13     KLIST
     C                     KFLD           KUDSN  10
     C                     KFLD           KUDBA   3
      *                                                                   CSE020
     C           KEY14     KLIST                                          CSE020
     C                     KFLD           MAPREF                          CSE020
     C                     KFLD           KUDBA                           CSE020
     C                     KFLD           KUDPT                           CSE020
     C                     KFLD           WKCOTP  1                       CSE020
     C                     KFLD           WKBOOK  2                       CSE020
     C**********           KFLD           WKCNUM  60                                   CSE020 CSD027
     C                     KFLD           WKCNUM  6                                           CSD027
     C                     KFLD           WKPTFR  4                       CSE020
     C                     KFLD           KUDSN                           CSE020
      *
     C                     MOVE @CORF     WCORF
     C           *LOCK     IN   LDA                                       CSE020
     C                     MOVEL'SE7514'  DBPGM
     C                     OUT  LDA                                       CSE020
      *
      **  Setup Screen Time
     C                     TIME           ##TME   60       Screen time.
      *
      **  Access Bank Details
     C                     CALL 'AOBANKR0'
     C                     PARM *BLANKS   WLRTCD  7
     C                     PARM '*FIRST'  WLOPTN  7
     C           SDBANK    PARM SDBANK    DSSDY
      *
      **  If record not found
     C           WLRTCD    IFNE *BLANKS                    B*1
     C           *LOCK     IN   LDA
     C                     Z-ADD001       DBASE            ****************
     C                     MOVE 'SDBANKPD'DBFILE           * DB ERROR 001 *
     C                     MOVEL*BLANKS   DBKEY            ****************
     C                     OUT  LDA
     C                     EXSR *PSSR
     C                     ENDIF                           E*1
      *
     C                     MOVE BJMRDT    ##MRDT           Midas Run Date
      *
      **  Determine Date Format
     C           BJDFIN    IFEQ 'M'                        B*1
     C                     MOVE '1'       *IN98
     C                     ENDIF                           E*1
      *
      **  Access SE ICD Details
     C                     CALL 'AOSTRDR0'
     C                     PARM *BLANKS   WLRTCD  7
     C                     PARM '*FIRST'  WLOPTN  7
     C           SDSTRD    PARM SDSTRD    DSSDY
      *
      **  If record not found
     C           WLRTCD    IFNE *BLANKS                    B*1
     C           *LOCK     IN   LDA
     C                     Z-ADD002       DBASE            ****************
     C                     MOVE 'SDSTRDPD'DBFILE           * DB ERROR 002 *
     C                     MOVEL*BLANKS   DBKEY            ****************
     C                     OUT  LDA
     C                     EXSR *PSSR
     C                     ENDIF                           E*1
      *                                                                   CAC005
      ***  Check if CAC005 - PCA-SE Enhancement is on.                    CAC005
      *                                                                   CAC005
     C                     MOVE 'N'       CAC005  1                       CAC005
     C                     MOVE *OFF      *IN70                           CAC005
     C                     CALL 'AOSARDR0'                                CAC005
     C                     PARM *BLANKS   WLRTCD                          CAC005
     C                     PARM '*VERIFY' @OPTN   7                       CAC005
     C                     PARM 'CAC005'  @SARD   6                       CAC005
      *                                                                   CAC005
     C           WLRTCD    IFEQ *BLANK                                    CAC005
     C                     MOVE *ON       *IN70                           CAC005
     C                     MOVE 'Y'       CAC005                          CAC005
     C                     ENDIF                                          CAC005
      *
      **  Access to modules details file to retrieve the 'Portfolio
      **  Management indicator'
     C                     CALL 'AOMMODR0'
     C                     PARM *BLANKS   WLRTCD
     C                     PARM '*FIRST'  WLOPTN
     C           SDMMOD    PARM SDMMOD    DSSDY
      *
      **  If record not found
     C           WLRTCD    IFNE *BLANKS
     C           *LOCK     IN   LDA
     C                     MOVEL'003'     DBASE            ***************
     C                     MOVE 'SDMMODPD'DBFILE           * DB ERROR 03 *
     C                     MOVEL*BLANKS   DBKEY            ***************
     C                     OUT  LDA
     C                     EXSR *PSSR
     C                     END                             E*1
      *
      **  If 'Portfolio Management' present
     C           BGPFMG    IFEQ 'Y'                        B*1
     C           BGN4ST    OREQ 'Y'                                       CPB001
      *
      **  Setup the portfolio management indicator
     C                     MOVE '1'       *IN56
      *
      **  Access to Portfolio Management File to retrieve the reference
      **  attached to "9997"
     C           BGPFMG    IFEQ 'Y'                                       CPB001
     C                     CALL 'AOPORTR0'
     C                     PARM *BLANKS   WLRTCD
     C                     PARM '*FIRST'  WLOPTN
     C           SDPORT    PARM SDPORT    DSSDY
      *
      **  If record not found
     C           WLRTCD    IFNE *BLANKS
     C                     MOVEL'004'     DBASE            ***************
     C                     MOVE 'SDPORTPD'DBFILE           * DB ERROR 04 *
     C                     MOVEL*BLANKS   DBKEY            ***************
     C                     EXSR *PSSR
     C                     END                             E*2
     C                     ENDIF                                          CPB001
     C                     END                             E*1
      *
     C                     MOVE *BLANKS   SBRCD            Review from: Branch
     C                     MOVE *BLANKS   SBOOK            Book
     C                     MOVE *BLANKS   SPRFC            Profit centre  CAC005
     C                     MOVE *BLANKS   SCNUM            Customer
     C                     MOVE *BLANKS   SPTFR            Portfolio
      *
     C                     MOVE @CORF     SCORF            Reference
     C                     MOVE @SESN     SSESN            Security Short.
     C                     MOVE @COAT     SCOAT            Corporate Type
      *
     C           @COEX     IFNE *BLANKS
     C           @COEX     ANDNE'00000'
     C                     MOVE @COEX     ZDAYNO
     C                     EXSR ZDATE2
     C                     MOVE ZDATE     SEXDT            Ex-Date
     C                     ELSE
     C                     MOVE *BLANKS   SEXDT            Ex-Date
     C                     ENDIF
      *
      **  Retrieve Nominal Currency of the Event Security
     C           @SESN     CHAINSECTYZ1              89
      *
      **  If record not found
     C           *IN89     IFEQ '1'                        B*1
     C           *LOCK     IN   LDA
     C                     Z-ADD005       DBASE            ****************
     C                     MOVE 'SECTYD'  DBFILE           * DB ERROR 005 *
     C                     MOVELMCSESN    DBKEY            ****************
     C                     OUT  LDA
     C                     EXSR *PSSR
     C                     ENDIF                           E*1
      *
     C                     MOVE NMCY      SNMCY
     C                     Z-ADDNMDP      SNMDP   10
     C                     MOVEL'SEUSRMSG'PMSGF  10
      *
      **  Fill in Fields for Subroutine ZASNMS
     C                     MOVEL'SE7514'  ZAPGM  10        Message queue
     C                     MOVEL'SEUSRMSG'ZAMSGF 10        Message file
     C                     MOVEL*BLANK    ZAPGRL  5        Rel queue
     C                     MOVEL*BLANK    ZAMSID  7        Message Id.
     C                     MOVEL*BLANK    ZAMSDA132        Message data.
     C                     MOVEL*BLANK    ZAMSTP  7        Message type.
      *
      **  Clear Messages from Program Message Queue.
     C                     CALL 'Y2CLMSC'
     C                     PARM ##PGM     ZAPGM  10
     C                     PARM '*SAME'   ZAPGRL  5
      *
     C                     WRITESE7514C2
      *
      ** Retrieve the Default No Reply (Level 1)
     C           @CORF     CHAINSECORFL1             89
      *
      **  If record not found
     C           *IN89     IFEQ '1'                        B*1
     C           *LOCK     IN   LDA
     C                     Z-ADD006       DBASE            ****************
     C                     MOVE 'SECORFL1'DBFILE           * DB ERROR 006 *
     C                     MOVEL@CORF     DBKEY            ****************
     C                     OUT  LDA
     C                     EXSR *PSSR
     C                     ELSE                            X*1
     C           MADFNR    IFNE *BLANKS                    B*2
     C                     MOVE MADFNR    SD1NR     P
     C                     ELSE                            X*2
     C           MANBOP    IFEQ 1                          B*3
     C                     MOVE ' 1'      SD1NR
     C                     ENDIF                           E*3
     C                     ENDIF                           E*2
     C                     ENDIF                           E*1
      *                                                                   CSE020
      ** If CA is a child, obtain the Security from the Originating CA    CSE020
      *                                                                   CSE020
     C           MAPREF    IFNE *BLANKS                                   CSE020
     C           MAPREF    CHAINSECORFL9             71                   CSE020
      *                                                                   CSE020
     C           *IN71     IFEQ *ON                                       CSE020
     C           *LOCK     IN   LDA                                       CSE020
     C                     Z-ADD012       DBASE            ***************CSE020
     C                     MOVEL'SECORFL9'DBFILE           * DB ERROR 012*CSE020
     C                     MOVELMAPREF    DBKEY            ***************CSE020
     C                     OUT  LDA                                       CSE020
     C                     EXSR *PSSR                                     CSE020
     C                     ENDIF                                          CSE020
      *                                                                   CSE020
      ** Loop to obtain the Security from the originating CA.             CSE020
      *                                                                   CSE020
     C           MNPREF    DOWNE*BLANKS                                   CSE020
     C           MNPREF    CHAINSECORFL9             71                   CSE020
     C           *IN71     IFEQ *ON                                       CSE020
     C           *LOCK     IN   LDA                                       CSE020
     C                     Z-ADD013       DBASE            ***************CSE020
     C                     MOVEL'SECORFL9'DBFILE           * DB ERROR 013*CSE020
     C                     MOVELMNPREF    DBKEY            ***************CSE020
     C                     OUT  LDA                                       CSE020
     C                     EXSR *PSSR                                     CSE020
     C                     ENDIF                                          CSE020
     C                     ENDDO                                          CSE020
     C                     MOVE MNSESN    WOSESN 10                       CSE020
      *                                                                   CSE020
     C                     ENDIF                                          CSE020
      *
      ** Retrieve the Default No Reply (Level 2)
     C                     MOVE '  '      SD2NR
      *
     C           @PTYP     IFEQ 'DV'                       B*1
     C           @PTYP     OREQ 'RG'
     C           @PTYP     OREQ 'OF'
     C           @PTYP     OREQ 'EX'
     C                     MOVE SD1NR     WOPNB
      *
     C           SD1NR     IFEQ '  '                       B*2
     C                     MOVE '1'       WOPNB
     C                     ENDIF                           E*2
      *
     C                     SELEC
      *
     C           @PTYP     WHEQ 'DV'                       B*2
     C           KEY1      CHAINSECODVL1             89
     C                     MOVE 'SECODVPD'DBFILE
      *
     C           @PTYP     WHEQ 'RG'                       B*2
     C           KEY1      CHAINSECORGL1             89
     C                     MOVE 'SECORGPD'DBFILE
      *
     C           @PTYP     WHEQ 'OF'                       B*2
     C           KEY1      CHAINSECOOFL1             89
     C                     MOVE 'SECOOFPD'DBFILE
      *
     C           @PTYP     WHEQ 'EX'                       B*2
     C           KEY1      CHAINSECOEXL1             8989
     C                     MOVE 'SECOEXPD'DBFILE
      *
     C                     ENDSL
      *
      **  If no record found
     C           *IN89     IFEQ '1'                        B*3
     C           *LOCK     IN   LDA
     C                     Z-ADD007       DBASE
     C                     MOVELWCORF     DBKEY
     C                     OUT  LDA
     C                     EXSR *PSSR
      *
     C                     ELSE                            X*3
      *
     C                     SELEC
      *
     C           @PTYP     WHEQ 'DV'                       B*2
     C                     MOVE MDDFNR    SD2NR     P
      *
     C           @PTYP     WHEQ 'RG'                       B*2
     C                     MOVE MFDFNR    SD2NR     P
      *
     C           @PTYP     WHEQ 'OF'                       B*2
     C                     MOVE MIDFNR    SD2NR     P
      *
     C           @PTYP     WHEQ 'EX'                       B*2
     C                     MOVE MJDFNR    SD2NR     P
      *
     C                     ENDSL                           E*3
      *
     C                     ENDIF                           E*2
      *
     C                     ELSE                            X*1
      *
     C                     MOVE SD1NR     WOPNB
      *
     C           SD1NR     IFEQ '  '                       B*2
     C                     MOVE '1'       WOPNB
     C                     ENDIF                           E*2
     C                     ENDIF                           E*1
      *
      ** Position file cursor
     C                     MOVE *LOVAL    WBRCD
     C                     MOVE *LOVAL    WCOTP
     C                     MOVE *LOVAL    WBOOK
     C***********          MOVE *LOVAL    WCNUM                                               CSD027
     C                     MOVE *BLANKS   WCNUM                                               CSD027
     C                     MOVE *LOVAL    WPTFR
     C                     MOVE *LOVAL    WDDPT
     C                     MOVE *LOVAL    WSESN
      *
     C           KEY2      SETLLSECOALL2
      *
      ** Read next record to retrieve first record for same Reference
      ** and Option Number
     C           KEY1      READESECOALL2                 32
      *
     C                     MOVE 'N'       WWUDCD  1
     C           *IN32     IFEQ '1'
     C                     MOVE 'Y'       WWUDCD
     C                     ENDIF
      *
     C                     ENDSR
      *****************************************************************
      /EJECT
      *****************************************************************
      *                                                               *
      *            SRALOC - Main Processing                           *
      *                                                               *
      * CALLS      SRCLSF - Clear Subfile                             *
      *            SRBLDS - Build Subfile                             *
      *            SRVALD - Validate action code                      *
      *                                                               *
      * CALLED BY  MAIN   - Main Routine.                             *
      *                                                               *
      * FLDS USED         -                                           *
      *                                                               *
      *****************************************************************
     C           SRALOC    BEGSR
      *
      ** Clear Subfile
     C                     EXSR SRCLSF
      *
      **  Do while F3, F12 not pressed
      *
     C           *INKC     DOWEQ'0'                        B*1
     C           *INKL     ANDEQ'0'
      *
     C           *IN39     IFEQ '1'
     C           *IN32     OREQ '1'
     C                     Z-ADD1         #1RRN
     C                     WRITESE7514S1
     C                     MOVE '1'       *IN80
     C                     MOVE '1'       *IN30
     C                     MOVE '0'       *IN39
     C                     MOVEL'CO00001' ZAMSID
     C                     EXSR ZASNMS
     C                     MOVE 'Y'       ERROR   1
     C                     ELSE
     C           ERROR     IFNE 'Y'
     C                     EXSR SRBLDS
     C                     ELSE
     C           #1RRN     IFEQ *ZEROS
     C           WWCPT     ANDNE*ZEROS
     C                     Z-ADDCPFPOS    #1RRN
     C                     ENDIF
     C                     ENDIF
     C                     ENDIF
      *
     C                     WRITESE7514C2
     C                     WRITESE7514F1
     C                     EXFMTSE7514C1
      *
      **  Clear Messages from Program Message Queue.
     C                     CALL 'Y2CLMSC'
     C                     PARM ##PGM     ZAPGM  10
     C                     PARM '*SAME'   ZAPGRL  5
     C                     WRITESE7514C2
      *
     C                     MOVEA'0000'    *IN,20
     C                     MOVE '0'       *IN62
     C                     MOVE '0'       *IN63                           CAC005
      *
     C************IN27     IFEQ '1'                        B*2            161732
     C***********SBRCD     IFNE *BLANKS                    B*3            161732
     C***********SBOOK     ORNE *BLANKS                                   161732
     C***********SPRFC     ORNE *BLANKS                            CAC005 161732
     C***********SCNUM     ORNE *BLANKS                                   161732
     C***********SPTFR     ORNE *BLANKS                                   161732
     C***********          MOVE '0'       *IN27                           161732
     C***********          MOVE '0'       *IN46                           161732
     C***********          ELSE                            X*3            161732
     C***********          MOVE 'N'       ERROR                           161732
     C***********          Z-ADD0         WWCPT                           161732
     C***********          ENDIF                           E*3            161732
     C***********          ENDIF                           E*2            161732
      *
      ** If no function key is pressed,
      **   Validate all Subfile records
      *
     C           *IN46     IFEQ '0'                        B*2
     C                     EXSR SRVALD
     C                     ENDIF                           E*2
      *
      **  If F5 is pressed, refresh screen
     C           *INKE     IFEQ '1'                        B*2
     C                     EXSR SRCLSF
      *
      ** Position file cursor
     C                     MOVE *LOVAL    WBRCD
     C                     MOVE *LOVAL    WCOTP
     C                     MOVE *LOVAL    WBOOK
     C***********          MOVE *LOVAL    WCNUM                                               CSD027
     C                     MOVE *BLANKS   WCNUM                                               CSD027
     C                     MOVE *LOVAL    WPTFR
     C                     MOVE *LOVAL    WDDPT
     C                     MOVE *LOVAL    WSESN
      *
     C           KEY2      SETLLSECOALL2
      *
      ** Read next record to retrieve first record for same Reference
      ** and Option Number
     C           KEY1      READESECOALL2                 32
     C                     ENDIF                           E*2
      *
     C                     ENDDO                           E*1
      *
     C                     ENDSR
      *****************************************************************
      /EJECT
      *****************************************************************
      *                                                               *
      *            SRNOAL - Main Processing                           *
      *                                                               *
      * CALLS      SRCLSF - Clear Subfile                             *
      *            SRBLDS - Build Subfile                             *
      *            SRVALD - Validate action code                      *
      *                                                               *
      * CALLED BY  MAIN   - Main Routine.                             *
      *                                                               *
      * FLDS USED         -                                           *
      *                                                               *
      *****************************************************************
     C           SRNOAL    BEGSR
      *
      ** Clear Subfile
     C                     EXSR SRCLSF
      *
     C                     EXSR SRRFRS
      *
      **  Do while F3, F12 not pressed
      *
     C           *INKC     DOWEQ'0'                        B*1
     C           *INKL     ANDEQ'0'
      *
     C           #1RRN     IFEQ *ZEROS
     C           WWCPT     ANDNE*ZEROS
     C                     Z-ADDCPFPOS    #1RRN
     C                     ENDIF
      *
     C                     WRITESE7514C2
     C                     WRITESE7514F1
     C                     EXFMTSE7514C1
      *
      **  Clear Messages from Program Message Queue.
     C                     CALL 'Y2CLMSC'
     C                     PARM ##PGM     ZAPGM  10
     C                     PARM '*SAME'   ZAPGRL  5
     C                     WRITESE7514C2
      *
     C                     MOVEA'0000'    *IN,20
     C                     MOVE '0'       *IN62
     C                     MOVE '0'       *IN63                           CAC005
      *
     C************IN27     IFEQ '1'                        B*2            161732
     C***********SBRCD     IFNE *BLANKS                    B*3            161732
     C***********SBOOK     ORNE *BLANKS                                   161732
     C***********SPRFC     ORNE *BLANKS                            CAC005 161732
     C***********SCNUM     ORNE *BLANKS                                   161732
     C***********SPTFR     ORNE *BLANKS                                   161732
     C***********          MOVE '0'       *IN27                           161732
     C***********          MOVE '0'       *IN46                           161732
     C***********          ELSE                            X*3            161732
     C***********          Z-ADD0         WWCPT                           161732
      ***********                                                         161732
     C************IN45     IFEQ '1'                        B*4            161732
     C***********          EXSR SRRESP                                    161732
     C***********MCDDPT    IFNE WWDPT                      B*5            161732
     C***********          Z-ADDMCDDPT    WWDPT                           161732
     C***********          ADD  1         #1RRN                           161732
     C***********          ADD  1         WWCPT                           161732
     C***********          WRITESE7514S1                                  161732
     C***********          ENDIF                           E*5            161732
     C***********          ENDIF                           E*4            161732
      ***********                                                         161732
     C***********          EXSR SRPROC                                    161732
      ***********                                                         161732
     C***********MCBOOK    IFNE *BLANKS                    B*4            161732
     C***********          EXSR SRBLD1                                    161732
     C***********          ELSE                            X*4            161732
     C***********          EXSR SRBLD2                                    161732
     C***********          ENDIF                           E*4            161732
      ***********                                                         161732
     C***********WWCPT     IFEQ 0                          B*4            161732
     C***********          Z-ADD1         #1RRN                           161732
     C***********          MOVE #1RRN     W1RRN   40                      161732
     C***********          WRITESE7514S1                                  161732
     C***********          MOVE '1'       *IN80                           161732
     C***********          MOVE '1'       *IN30                           161732
     C***********          MOVE '0'       *IN39                           161732
     C***********          MOVEL'CO00001' ZAMSID                          161732
     C***********          EXSR ZASNMS                                    161732
     C***********          MOVE 'Y'       ERROR   1                       161732
     C***********          ELSE                            X*4            161732
     C************IN32     IFEQ '1'                        B*5            161732
     C***********          MOVE '1'       *IN31                           161732
     C***********          MOVE '1'       *IN30                           161732
     C***********          ENDIF                           B*5            161732
     C***********          MOVE #1RRN     W1RRN   40                      161732
     C***********          MOVE '1'       *IN81                           161732
     C***********          ENDIF                           E*4            161732
     C***********          ENDIF                           E*3            161732
     C***********          ENDIF                           E*2            161732
      *
      ** If no function key is pressed,
      **   Validate all Subfile records
      *
     C           *IN46     IFEQ '0'                        B*2
     C                     EXSR SRVALD
     C                     ENDIF                           E*2
      *
      **  If F5 is pressed, refresh screen
     C           *INKE     IFEQ '1'                        B*2
     C                     EXSR SRCLSF
      *
     C                     EXSR SRRFRS
     C                     ENDIF                           E*2
      *
     C                     ENDDO                           E*1
      *
     C                     ENDSR
      *****************************************************************
      /EJECT
      *****************************************************************
      *                                                               *
      *            SRBLD1 - Build subfile for the records "Books"     *
      *                                                               *
      * CALLED BY  MAIN   - Main Routine.                             *
      *                                                               *
      * FLDS USED         -                                           *
      *                                                               *
      *****************************************************************
     C           SRBLD1    BEGSR
      *
     C**********           Z-ADD*ZEROS    MCCNUM                                              CSD027
     C                     MOVE *BLANKS   MCCNUM                                              CSD027
     C                     MOVE *BLANKS   MCPTFR
      *                                                                   CSE020
      ** If CA is a child, save Security and use Security obtained        CSE020
      ** from the originating CA                                          CSE020
      *                                                                   CSE020
     C           MAPREF    IFNE *BLANKS                                   CSE020
     C                     MOVE KUDSN     WKSESN 10                       CSE020
     C                     MOVE WOSESN    KUDSN                           CSE020
     C                     ENDIF                                          CSE020
      *
     C           *IN32     DOWEQ'0'
     C***********WWCPT     ANDLT11                                        161732
      *
     C                     MOVE MCBOOK    KUDBK
     C                     MOVE MCBRCD    KUDBA
     C**********           Z-ADDMCDDPT    KUDPT                                               CSD027
     C                     MOVE MCDDPT    KUDPT                                               CSD027
     C                     MOVE UDMK      KUDMK
     C                     MOVE @COEX     KEXDT
      *
     C           KEY11     SETGTSECOUPL0             32
     C                     READPSECOUPL0                 32
      *
     C           *IN32     IFEQ '0'
     C           KUDBA     ANDEQMCBRCD
     C           KUDSN     ANDEQMCSESN
     C           KUDPT     ANDEQMCDDPT
     C           KUDMK     ANDEQUDMK
     C           KUDBK     ANDEQMCBOOK
      *                                                                   CSE020
      ** If CA is a child, restore KUDSN with Security of the child.      CSE020
      ** Set Ex-date Position = Actual Stock Allocation of the            CSE020
      ** Parent CA instead.                                               CSE020
      *                                                                   CSE020
     C           MAPREF    IFNE *BLANKS                                   CSE020
     C                     MOVE WKSESN    KUDSN                           CSE020
     C                     MOVE 'B'       WKCOTP                          CSE020
     C                     MOVE KUDBK     WKBOOK                          CSE020
     C                     MOVE *BLANKS   WKCNUM                          CSE020
     C                     MOVE *BLANKS   WKPTFR                          CSE020
     C           KEY14     CHAINSECOALL5             71                   CSE020
     C           *IN71     IFEQ *OFF                                      CSE020
     C                     Z-ADDM5ASTA    MCEXPO                          CSE020
     C                     ELSE                                           CSE020
     C                     Z-ADD*ZERO     MCEXPO                          CSE020
     C                     ENDIF                                          CSE020
      *                                                                   CSE020
     C                     ELSE                                           CSE020
      *
     C           MATDVD    IFEQ 'V'
     C                     Z-ADDUDNV      MCEXPO
     C                     ELSE
     C                     Z-ADDUDNT      MCEXPO
     C                     ENDIF
     C                     ENDIF                                          CSE020
      *
     C                     EXSR SRPROC
      *
     C***********WWCPT     IFEQ 11                                        161732
     C***********          EXSR SRSAVP                                    161732
     C***********          ELSE                                           161732
     C           MCDDPT    IFNE WWDPT
     C**********           Z-ADDMCDDPT    WWDPT                                               CSD027
     C                     MOVE MCDDPT    WWDPT                                               CSD027
     C                     ADD  1         #1RRN
     C                     ADD  1         WWCPT
     C                     MOVEA'110'     *IN,57
     C                     WRITESE7514S1
     C                     ENDIF
     C***********          ENDIF                                          161732
     C                     ENDIF
      *
     C                     Z-ADD*HIVAL    KEXDT
      *                                                                   CSE020
      ** If CA is a child, use Security obtained from Originating CA      CSE020
      *                                                                   CSE020
     C           MAPREF    IFNE *BLANKS                                   CSE020
     C                     MOVE WOSESN    KUDSN                           CSE020
     C                     ENDIF                                          CSE020
      *
     C           KEY11     SETGTSECOUPL0             32
     C                     READ SECOUPL0                 32
      *
     C           KUDSN     IFNE MCSESN
     C                     MOVE '1'       *IN32
     C                     ENDIF
      *
     C                     ENDDO
      *
     C                     ENDSR
      *****************************************************************
      /EJECT
      *****************************************************************
      *                                                               *
      *            SRBLD2 - Build subfile for the records "Cust/Ptfr" *
      *                                                               *
      * CALLED BY  MAIN   - Main Routine.                             *
      *                                                               *
      * FLDS USED         -                                           *
      *                                                               *
      *****************************************************************
     C           SRBLD2    BEGSR
      *
     C                     MOVE *BLANKS   MCBOOK
      *                                                                   CSE020
      ** If CA is a child, save Security and use Security obtained        CSE020
      ** from the Originating CA                                          CSE020
      *                                                                   CSE020
     C           MAPREF    IFNE *BLANKS                                   CSE020
     C                     MOVE KUDSN     WKSESN                          CSE020
     C                     MOVE WOSESN    KUDSN                           CSE020
     C                     ENDIF                                          CSE020
      *
     C           *IN32     DOWEQ'0'
     C***********WWCPT     ANDLT11                                        161732
      *
     C                     MOVE MCCNUM    WWCNUM
      *
     C**********           Z-ADDMCCNUM    KCDCN                                               CSD027
     C                     MOVE MCCNUM    KCDCN                                               CSD027
     C                     MOVE MCPTFR    KPTFR
     C                     MOVE MCBRCD    KUDBA
     C**********           Z-ADDMCDDPT    KUDPT                                               CSD027
     C                     MOVE MCDDPT    KUDPT                                               CSD027
     C                     MOVE CDMK      KUDMK
     C                     MOVE @COEX     KEXDT
      *
     C           KEY12     SETGTSECOCPL0             32
     C                     READPSECOCPL0                 32
      *
     C           *IN32     IFEQ '0'
     C           KUDBA     ANDEQMCBRCD
     C           KUDSN     ANDEQMCSESN
     C           KUDPT     ANDEQMCDDPT
     C           KUDMK     ANDEQCDMK
     C           KCDCN     ANDEQMCCNUM
     C           KPTFR     ANDEQMCPTFR
      *                                                                   CSE020
      ** If CA is a child, restore KUDSN with Security of the child.      CSE020
      ** Set Ex-date Position = Actual Stock Allocation of the            CSE020
      ** Parent CA instead.                                               CSE020
      *                                                                   CSE020
     C           MAPREF    IFNE *BLANKS                                   CSE020
     C                     MOVE WKSESN    KUDSN                           CSE020
     C                     MOVE 'C'       WKCOTP                          CSE020
     C                     MOVE *BLANKS   WKBOOK                          CSE020
     C                     MOVE KCDCN     WKCNUM                          CSE020
     C                     MOVE KPTFR     WKPTFR                          CSE020
     C           KEY14     CHAINSECOALL5             72                   CSE020
     C           *IN72     IFEQ *OFF                                      CSE020
     C                     Z-ADDM5ASTA    MCEXPO                          CSE020
     C                     ELSE                                           CSE020
     C                     Z-ADD*ZERO     MCEXPO                          CSE020
     C                     ENDIF                                          CSE020
      *                                                                   CSE020
     C                     ELSE                                           CSE020
      *
     C           MATDVD    IFEQ 'V'
     C                     Z-ADDCDNV      MCEXPO
     C                     ELSE
     C                     Z-ADDCDNT      MCEXPO
     C                     ENDIF
     C                     ENDIF                                          CSE020
      *
     C                     EXSR SRPROC
      *
     C***********WWCPT     IFEQ 11                                        161732
     C***********          EXSR SRSAVP                                    161732
     C***********          ELSE                                           161732
     C           MCDDPT    IFNE WWDPT
     C**********           Z-ADDMCDDPT    WWDPT                                               CSD027
     C                     MOVE MCDDPT    WWDPT                                               CSD027
     C                     ADD  1         #1RRN
     C                     ADD  1         WWCPT
     C                     MOVEA'110'     *IN,57
     C                     WRITESE7514S1
     C                     ENDIF
     C***********          ENDIF                                          161732
     C                     ENDIF
      *
     C                     Z-ADD*HIVAL    KEXDT
      *                                                                   CSE020
      ** If CA is a child, use Security obtained from Originating CA      CSE020
      *                                                                   CSE020
     C           MAPREF    IFNE *BLANKS                                   CSE020
     C                     MOVE WOSESN    KUDSN                           CSE020
     C                     ENDIF                                          CSE020
      *
     C           KEY12     SETGTSECOCPL0             32
     C                     READ SECOCPL0                 32
      *
     C           KUDSN     IFNE MCSESN
     C                     MOVE '1'       *IN32
     C                     ENDIF
      *
     C                     ENDDO
      *
     C                     ENDSR
      *****************************************************************
      /EJECT
      *****************************************************************
      *                                                               *
      *            SRRFRS - Refresh screen                            *
      *                                                               *
      * CALLED BY  MAIN   - Main Routine.                             *
      *                                                               *
      * FLDS USED         -                                           *
      *                                                               *
      *****************************************************************
     C           SRRFRS    BEGSR
      *                                                                   161732
     C                     Z-ADD*ZERO     X       20                      161732
      *
      ** If CA is a child, use Security obtained from the Originating     CSE020
      ** action; Otherwise, use Security from entry parameter.            CSE020
      *                                                                   CSE020
     C           MAPREF    IFNE *BLANKS                                   CSE020
     C                     MOVE WOSESN    KUDSN                           CSE020
     C                     ELSE                                           CSE020
     C                     MOVE @SESN     KUDSN
     C                     ENDIF                                          CSE020
      *
      ** Read first record from SECOUPL0
     C           KUDSN     SETLLSECOUPL0
     C           KUDSN     READESECOUPL0                 32
      *
     C           *IN32     IFEQ '0'
     C                     MOVE 'B'       MCCOTP
     C                     MOVE @PTYP     MCCOAT
     C                     ENDIF
      *                                                                   CSE020
      ** If CA is a child, restore KUDSN.                                 CSE020
      *                                                                   CSE020
     C           MAPREF    IFNE *BLANKS                                   CSE020
     C                     MOVE @SESN     KUDSN                           CSE020
     C                     ENDIF                                          CSE020
      *
     C                     EXSR SRBLD1
      *
      ** Read first record from SECOCPL0
     C           KUDSN     SETLLSECOCPL0
     C           KUDSN     READESECOCPL0                 32
      *
     C           *IN32     IFEQ '0'
     C                     MOVE 'C'       MCCOTP
     C                     MOVE @PTYP     MCCOAT
     C                     ENDIF
      *                                                                   CSE020
      ** If CA is a child, restore KUDSN.                                 CSE020
      *                                                                   CSE020
     C           MAPREF    IFNE *BLANKS                                   CSE020
     C                     MOVE @SESN     KUDSN                           CSE020
     C                     ENDIF                                          CSE020
      *
     C                     EXSR SRBLD2
      *                                                                   CSE020
      ** If CA is a child, restore KUDSN.                                 CSE020
      *                                                                   CSE020
     C           MAPREF    IFNE *BLANKS                                   CSE020
     C                     MOVE @SESN     KUDSN                           CSE020
     C                     ENDIF                                          CSE020
      *
     C           WWCPT     IFEQ 0
     C                     Z-ADD1         #1RRN
     C                     MOVE #1RRN     W1RRN   40
     C                     WRITESE7514S1
     C                     MOVE '1'       *IN80
     C                     MOVE '1'       *IN30
     C                     MOVE '0'       *IN39
     C                     MOVEL'CO00001' ZAMSID
     C                     EXSR ZASNMS
     C                     MOVE 'Y'       ERROR   1
     C                     ELSE
     C           *IN32     IFEQ '1'
     C                     MOVE '1'       *IN31
     C                     MOVE '1'       *IN30
     C                     ENDIF
     C                     MOVE #1RRN     W1RRN   40
     C                     MOVE '1'       *IN81
     C                     ENDIF
      *
     C                     ENDSR
      *****************************************************************
      /EJECT
      *****************************************************************
      *                                                               *
      *            SRENDP - End Processing                            *
      *                                                               *
      * CALLS             -                                           *
      *                                                               *
      * CALLED BY  MAIN   - Main Routine.                             *
      *                                                               *
      * FLDS USED         -                                           *
      *                                                               *
      *****************************************************************
     C           SRENDP    BEGSR
      *
     C           *INKC     IFEQ '1'                        B*1
     C                     MOVE '3'       @RTCD
     C                     ENDIF                           E*1
      *
     C           *INKL     IFEQ '1'
     C                     MOVE '2'       @RTCD
     C                     ENDIF
      *
      **  End Program
     C                     MOVE '1'       *INLR
     C                     RETRN
      *
     C                     ENDSR
      *****************************************************************
      /EJECT
      *****************************************************************
      *                                                               *
      *            SRCLSF - Clear Subfile                             *
      *                                                               *
      * CALLS             -                                           *
      *                                                               *
      * CALLED BY  SRALOC - Main Processing                           *
      *            SRVIEW - View subfile from Review from fields      *
      *                                                               *
      * FLDS USED         -                                           *
      *                                                               *
      *****************************************************************
     C           SRCLSF    BEGSR
      *
      ** Clear Input Fields
     C                     TIME           ##TME            Screen time.
     C                     MOVE *BLANKS   SBRCD
     C                     MOVE *BLANKS   SBOOK
     C                     MOVE *BLANKS   SPRFC                           CAC005
     C                     MOVE *BLANKS   SCNUM
     C                     MOVE *BLANKS   SPTFR
     C                     MOVEA'0000'    *IN,20
     C                     MOVE '0'       *IN63                           CAC005
     C                     MOVE ' '       SACDE
     C                     MOVE 'N'       ERROR   1
      *
      ** Clear Subfile
     C                     MOVE '1'       *IN80
     C                     WRITESE7514C1
     C                     MOVE '0'       *IN80
     C                     MOVE '1'       *IN81
     C                     MOVE '0'       *IN30
     C                     MOVE '0'       *IN31
     C***********          MOVE '0'       *IN45                           161732
     C                     Z-ADD0         #1RRN
     C                     Z-ADD0         WWCPT   20
     C                     MOVE '0'       *IN39
      *
      **  Clear Messages from Program Message Queue.
     C                     CALL 'Y2CLMSC'
     C                     PARM ##PGM     ZAPGM  10
     C                     PARM '*SAME'   ZAPGRL  5
      *
     C                     WRITESE7514C2
      *
      ** Initialise checking fields
     C                     MOVE *BLANKS   WWBRC   3
     C                     MOVE *BLANKS   WWBOK   2
     C**********           Z-ADD*ZEROS    WWDPT   60                                          CSD027
     C**********           MOVE *BLANKS   WWCNM   60                                          CSD027
     C                     MOVE *BLANKS   WWDPT   6                                           CSD027
     C                     MOVE *BLANKS   WWCNM   6                                           CSD027
     C                     MOVE *BLANKS   WWPTF   4
      *
     C                     ENDSR
      *****************************************************************
      /EJECT
      *****************************************************************
      *                                                               *
      *            SRBLDS - Build Subfile                             *
      *                                                               *
      * CALLS      SRPROC - Process read records                      *
      *            SRSAVP - Save previous values of the subfile record*
      *            SRRESP - Restore previous values of the subfile    *
      *                     record                                    *
      *                                                               *
      * CALLED BY  SRALOC - Main Processing                           *
      *                                                               *
      * FLDS USED         -                                           *
      *                                                               *
      *****************************************************************
     C           SRBLDS    BEGSR
      *
     C           *IN31     DOWEQ'0'                        B*1
     C***********WWCPT     ANDLT11                                        161732
     C           *IN32     ANDEQ'0'
      *
     C                     MOVE MCCNUM    WWCNUM  6
      *
     C           MCSESN    IFNE '**CASH**'                 B*1A
     C           WWCNUM    ANDNEBVERCU
     C           MCSESN    OREQ '**CASH**'
     C           MCCOAT    ANDEQ'CE'
     C           WWCNUM    ANDNEBVERCU
      *
     C************IN45     IFEQ '1'                        B*2            161732
     C***********          EXSR SRRESP                                    161732
     C***********MCDDPT    IFNE WWDPT                      B*3            161732
     C***********          Z-ADDMCDDPT    WWDPT                           161732
     C***********          ADD  1         #1RRN                           161732
     C***********          ADD  1         WWCPT                           161732
     C***********          WRITESE7514S1                                  161732
     C***********          ENDIF                           E*3            161732
     C***********          ENDIF                           E*2            161732
      *
     C                     EXSR SRPROC
      *
     C***********WWCPT     IFEQ 11                         B*2            161732
     C***********          EXSR SRSAVP                                    161732
     C***********          ELSE                            X*2            161732
     C           MCDDPT    IFNE WWDPT                      B*3
     C**********           Z-ADDMCDDPT    WWDPT                                               CSD027
     C                     MOVE MCDDPT    WWDPT                                               CSD027
     C                     ADD  1         #1RRN
     C                     ADD  1         WWCPT
     C                     MOVEA'110'     *IN,57
     C                     WRITESE7514S1
     C                     ENDIF                           E*3
     C***********          ENDIF                           B*2            161732
     C                     ENDIF                           E*1A
      *
     C           KEY1      READESECOALL2                 31
      *
     C                     ENDDO                           E*1
      *
     C           WWCPT     IFEQ 0                          B*1
     C************IN27     ANDNE'1'                                137877 161732
     C                     Z-ADD1         #1RRN
     C                     MOVE #1RRN     W1RRN   40
     C                     WRITESE7514S1
     C                     MOVE '1'       *IN80
     C                     MOVE '1'       *IN30
     C                     MOVE '0'       *IN39
     C                     MOVEL'CO00001' ZAMSID
     C                     EXSR ZASNMS
     C                     MOVE 'Y'       ERROR   1
     C                     ELSE                            X*1
      *
     C           *IN31     IFEQ '1'                        B*2
      *
     C************IN45     IFEQ '1'                        B*3            161732
     C***********          EXSR SRRESP                                    161732
     C***********MCDDPT    IFNE WWDPT                      B*4            161732
     C***********          Z-ADDMCDDPT    WWDPT                           161732
     C***********          ADD  1         #1RRN                           161732
     C***********          ADD  1         WWCPT                           161732
     C***********          WRITESE7514S1                                  161732
     C***********          ENDIF                           E*4            161732
     C***********          ENDIF                           E*3            161732
      *
     C                     MOVE '1'       *IN30
     C                     ENDIF                           E*2
      *
     C                     MOVE #1RRN     W1RRN   40
     C                     MOVE '1'       *IN81
     C                     ENDIF                           E*1
      *
     C                     ENDSR
      *****************************************************************
      /EJECT
      *****************************************************************
      *                                                               *
      *            SRPROC - Process read records                      *
      *                                                               *
      * CALLS      SRSAVP - Save previous values of the subfile record*
      *                                                               *
      * CALLED BY  SRBLDS - Build Subfile                             *
      *                                                               *
      * FLDS USED         -                                           *
      *                                                               *
      *****************************************************************
     C           SRPROC    BEGSR
      *
     C           MCBRCD    IFNE WWBRC
     C           WWBRC     ANDNE*BLANKS
     C                     MOVE *BLANKS   WWBRC
     C                     MOVE *BLANKS   WWBOK
     C**********           Z-ADD*ZEROS    WWDPT                                               CSD027
     C**********           Z-ADD0         WWCNM                                               CSD027
     C                     MOVE *BLANKS   WWDPT                                               CSD027
     C                     MOVE *BLANKS   WWCNM                                               CSD027
     C                     MOVE *BLANKS   WWPTF
     C                     ELSE
     C                     MOVE MCBRCD    WWBRC
     C                     ENDIF
      *
     C                     MOVELMCCNUM    HCNUM
     C                     MOVE MCPTFR    HPORT
     C                     MOVELMCBOOK    HBOOK
     C                     MOVE MCDDPT    HDPOT
     C                     MOVE MCEXPO    HEXPO
      *
     C           MCCOTP    IFEQ 'B'                        B*1
      *
      ** If change of Book and Book just read not equal to blanks
      *
     C           WWBOK     IFNE MCBOOK                     B*2
     C           MCBOOK    ANDNE*BLANKS
     C                     MOVE MCBRCD    WBRCD
     C                     MOVE 'B'       WCOTP
     C                     MOVE MCBOOK    WBOOK
     C**********           Z-ADD*ZEROS    WCNUM                                               CSD027
     C                     MOVE *BLANKS   WCNUM                                               CSD027
     C           KEY3      CHAINSECOREL1             75
      *
     C           *IN75     IFEQ '0'                        B*3
     C                     MOVE 'Y'       EXBCRE  1        Current Reply exist
      *
     C           MQR1RE    IFNE *BLANKS                                   137877
     C                     MOVE *BLANKS   ZFIELD
     C                     MOVE MQR1RE    ZFIELD
     C                     Z-ADD2         ZADIG
     C                     Z-ADD*ZEROS    ZADEC
     C                     EXSR ZEDIT
     C                     MOVEL*BLANKS   SC1RE
     C                     MOVE ZFIELD    SC1RE
     C                     ELSE                                           137877
     C                     MOVE *BLANKS   SC1RE                           137877
     C                     ENDIF                                          137877
      *
     C           MQR2RE    IFNE *BLANKS                                   137877
     C                     MOVE *BLANKS   ZFIELD
     C                     MOVE MQR2RE    ZFIELD
     C                     Z-ADD2         ZADIG
     C                     Z-ADD*ZEROS    ZADEC
     C                     EXSR ZEDIT
     C                     MOVEL*BLANKS   SC2RE
     C                     MOVE ZFIELD    SC2RE
     C                     ELSE                                           137877
     C                     MOVE *BLANKS   SC2RE                           137877
     C                     ENDIF                                          137877
      *
     C                     ELSE                            X*3
     C                     MOVE 'N'       EXBCRE           Current Reply exist
     C                     MOVE *BLANKS   SC1RE
     C                     MOVE *BLANKS   SC2RE
     C                     ENDIF                           E*3
      *
     C           SC1RE     IFEQ *BLANKS                    B*3
     C           MANBOP    ANDEQ1
     C                     MOVE ' 1'      SC1RE
     C                     ENDIF                           E*3
      *
     C                     MOVE @COAT     WCOAT
     C                     MOVE @SESN     WSESN
      *
     C           KEY4      CHAINSECOSIL2             75
      *
     C           *IN75     IFEQ '1'                        B*3
     C                     MOVE *BLANKS   WSESN
     C           KEY4      CHAINSECOSIL2             75
      *
     C           *IN75     IFEQ '1'                        B*4
     C                     MOVE *BLANKS   WCOAT
     C           KEY4      CHAINSECOSIL2             75
      *
     C           *IN75     IFEQ '1'                        B*5
     C                     MOVE *BLANKS   WBOOK
     C           KEY4      CHAINSECOSIL2             75
     C                     ENDIF                           E*5
      *
     C                     ENDIF                           E*4
      *
     C                     ENDIF                           E*3
      *
     C                     MOVE *BLANKS   SS1IN
     C                     MOVE *BLANKS   SS2IN
      *
     C           *IN75     IFEQ '0'                        B*3
     C                     MOVE 'Y'       EXBCSI  1        Standard Instruction exist
     C                     ELSE                            X*3
     C                     MOVE 'N'       EXBCSI           Standard Instruction exist
     C                     ENDIF                           E*3
      *
      **  Retrieve the standard instructions reply for level 1 & 2
     C                     EXSR SRRPLY
      *
     C                     MOVE MCBRCD    SBRCH
     C                     MOVELMCBOOK    SCUBK     P
      *                                                                   CAC005
      ** If CAC005 is on, retrieve user book from AOBKPCR0.               CAC005
      *                                                                   CAC005
     C           CAC005    IFEQ 'Y'                                       CAC005
     C                     CALL 'AOBKPCR0'                                CAC005
     C                     PARM           PRTCD   7                       CAC005
     C                     PARM '*USER  ' POPTN   7                       CAC005
     C           PMBKCD    PARM *BLANKS   PMBKCD  2                       CAC005
     C           PMPRFC    PARM *BLANKS   PMPRFC  4                       CAC005
     C                     PARM MCBOOK    PMPSBK  2                       CAC005
     C           PRTCD     IFEQ *BLANKS                                   CAC005
     C                     MOVELPMBKCD    SCUBK                           CAC005
     C                     MOVE PMPRFC    SCUBK                           CAC005
     C                     ENDIF                                          CAC005
     C                     ENDIF                                          CAC005
      *                                                                   CAC005
     C                     MOVE *BLANKS   SPORT
     C                     MOVE 'B'       HINDC
     C                     MOVE MCBOOK    HBOOK
     C                     MOVE *BLANKS   HCNUM
      *
     C***********WWCPT     IFEQ 11                         B*3            161732
     C***********          EXSR SRSAVP                                    161732
     C***********          ELSE                            X*3            161732
     C                     MOVEA'001'     *IN,57
     C                     MOVE '0'       *IN62
     C                     ADD  1         #1RRN
     C                     ADD  1         WWCPT
     C                     WRITESE7514S1
     C                     MOVE MCBOOK    WWBOK
     C**********           Z-ADD*ZEROS    WWDPT                                               CSD027
     C                     MOVE *BLANKS   WWDPT                                               CSD027
     C***********          ENDIF                           E*3            161732
      *                                                                   161732
      ** Add a new element for both argument and function arrays          161732
      *                                                                   161732
     C                     MOVE SBRCH     WBRCH                           161732
     C                     MOVE SCUBK     WCUBK                           161732
     C                     MOVE SPORT     WPORT                           161732
     C                     ADD  1         X                               161732
     C                     MOVEAWBCBP     EXP1,X                          161732
     C                     MOVEAWZERO     EXP2,X                          161732
      *
     C                     ENDIF                           E*2
      *
     C                     ENDIF                           E*1
      *
     C           MCCOTP    IFEQ 'C'                        B*1
     C           PFPL      ANDEQ'Y'
      *
      ** If change of Customer Number & Customer Number just read
      ** is not equal to blanks
      *
     C           WWCNM     IFNE MCCNUM                     B*2
     C********** MCCNUM    ANDNE0                                                             CSD027
     C           MCCNUM    ANDNE*BLANKS                                                       CSD027
     C           WWPTF     ORNE MCPTFR
     C                     MOVE 'C'       WCOTP
     C                     MOVE *BLANKS   WBOOK
     C                     MOVE MCCNUM    WCNUM
     C                     MOVE MCBRCD    WBRCD
     C           KEY3      CHAINSECOREL1             75
      *
     C           *IN75     IFEQ '0'                        B*3
     C                     MOVE 'Y'       EXBCRE           Current Reply exist
      *
     C           MQR1RE    IFNE *BLANKS                                   137877
     C                     MOVE *BLANKS   ZFIELD
     C                     MOVE MQR1RE    ZFIELD
     C                     Z-ADD2         ZADIG
     C                     Z-ADD*ZEROS    ZADEC
     C                     EXSR ZEDIT
     C                     MOVEL*BLANKS   SC1RE
     C                     MOVE ZFIELD    SC1RE
     C                     ELSE                                           137877
     C                     MOVE *BLANKS   SC1RE                           137877
     C                     ENDIF                                          137877
      *
     C           MQR2RE    IFNE *BLANKS                                   137877
     C                     MOVE *BLANKS   ZFIELD
     C                     MOVE MQR2RE    ZFIELD
     C                     Z-ADD2         ZADIG
     C                     Z-ADD*ZEROS    ZADEC
     C                     EXSR ZEDIT
     C                     MOVEL*BLANKS   SC2RE
     C                     MOVE ZFIELD    SC2RE
     C                     ELSE                                           137877
     C                     MOVE *BLANKS   SC2RE                           137877
     C                     ENDIF                                          137877
      *
     C                     ELSE
     C                     MOVE 'N'       EXBCRE           Current Reply exist
     C                     MOVE *BLANKS   SC1RE
     C                     MOVE *BLANKS   SC2RE
     C                     ENDIF                           E*3
      *
     C           SC1RE     IFEQ *BLANKS                    B*3
     C           MANBOP    ANDEQ1
     C                     MOVE ' 1'      SC1RE
     C                     ENDIF                           E*3
      *
     C                     MOVE MCPTFR    WPTFR
     C                     MOVE @COAT     WCOAT
     C                     MOVE @SESN     WSESN
      *
     C           KEY5      CHAINSECOSIL1             75
      *
     C           *IN75     IFEQ '1'                        B*3
     C                     MOVE *BLANKS   WSESN
     C           KEY5      CHAINSECOSIL1             75
      *
     C           *IN75     IFEQ '1'                        B*4
     C                     MOVE *BLANKS   WCOAT
     C           KEY5      CHAINSECOSIL1             75
      *
     C           *IN75     IFEQ '1'                        B*5
     C                     MOVE *BLANKS   WPTFR
     C           KEY5      CHAINSECOSIL1             75
      *
     C           *IN75     IFEQ '1'                        B*6
     C**********           Z-ADD*ZEROS    WCNUM                                               CSD027
     C                     MOVE *BLANKS   WCNUM                                               CSD027
     C           KEY5      CHAINSECOSIL1             75
     C                     ENDIF                           E*6
      *
     C                     ENDIF                           E*5
      *
     C                     ENDIF                           E*4
      *
     C                     ENDIF                           E*3
      *
     C                     MOVE *BLANKS   SS1IN
     C                     MOVE *BLANKS   SS2IN
      *
     C           *IN75     IFEQ '0'                        B*3
     C                     MOVE 'Y'       EXBCSI           Standard Instruction exist
     C                     ELSE                            X*3
     C                     MOVE 'N'       EXBCSI           Standard Instruction exist
     C                     ENDIF                           E*3
      *
      **  Retrieve the standard instructions reply for level 1 & 2
     C                     EXSR SRRPLY
      *
     C                     MOVE MCBRCD    SBRCH
      *
     C                     MOVE *BLANKS   WLKEYC
     C                     MOVELMCCNUM    WLKEYC
     C**********           CALL 'AOCUSTR0'                                                    223182
     C                     CALL 'AOCUSTR1'                                                    223182
     C                     PARM '*DBERR'  WLRTCD
     C                     PARM '*KEY   ' WLOPTN
     C                     PARM           WLKEYC 10
     C                     PARM *BLANKS   WLKYST  7
     C********** SDCUST    PARM SDCUST    DSSDY                                               223182
     C           SDCUST    PARM SDCUST    DSLDY                                               223182
      *
      **  If record not found
     C           WLRTCD    IFNE *BLANKS                    B*1
     C           BBCLST    ANDNE'Y'                                                           223182
     C           *LOCK     IN   LDA
     C                     Z-ADD008       DBASE            ****************
     C                     MOVE 'SDCUSTPD'DBFILE           * DB ERROR 008 *
     C                     MOVELMCCNUM    DBKEY            ****************
     C                     OUT  LDA
     C                     EXSR *PSSR
     C                     ENDIF                           E*1
      *
     C                     MOVELBBCSSN    SCUBK
     C                     MOVE 'C'       HINDC
     C                     MOVE *BLANKS   HBOOK
     C                     MOVE MCCNUM    HCNUM
      *
     C           MCPTFR    IFEQ '9997'
     C           BGN4ST    ANDNE'Y'                                       CPB001
     C                     MOVE FCR997    SPORT
     C                     ELSE
     C                     MOVE MCPTFR    SPORT
     C                     ENDIF
      *
     C***********WWCPT     IFEQ 11                                        161732
     C***********          EXSR SRSAVP                                    161732
     C***********          ELSE                                           161732
     C                     MOVEA'001'     *IN,57
     C                     MOVE '0'       *IN62
     C                     ADD  1         #1RRN
     C                     ADD  1         WWCPT
     C                     WRITESE7514S1
     C**********           Z-ADDMCCNUM    WWCNM                                               CSD027
     C                     MOVE MCCNUM    WWCNM                                               CSD027
     C                     MOVE MCPTFR    WWPTF
     C**********           Z-ADD*ZEROS    WWDPT                                               CSD027
     C                     MOVE *BLANKS   WWDPT                                               CSD027
     C***********          ENDIF                                          161732
      *                                                                   161732
      ** Add a new element for both argument and function arrays          161732
      *                                                                   161732
     C                     MOVE SBRCH     WBRCH                           161732
     C                     MOVE SCUBK     WCUBK                           161732
     C                     MOVE SPORT     WPORT                           161732
     C                     ADD  1         X                               161732
     C                     MOVEAWBCBP     EXP1,X                          161732
     C                     MOVEAWZERO     EXP2,X                          161732
      *
     C                     ENDIF                           E*2
      *
     C                     ENDIF                           E*1
      *
      *
      **  Retrieve Nominal Currency of the Event Security
     C           MCSESN    IFNE '**CASH**'                 B*1
     C           MCSESN    CHAINSECTYZ1              89
      *
      **  If record not found
     C           *IN89     IFEQ '1'                        B*2
     C           *LOCK     IN   LDA
     C                     Z-ADD009       DBASE            ****************
     C                     MOVE 'SECTYD'  DBFILE           * DB ERROR 009 *
     C                     MOVELMCSESN    DBKEY            ****************
     C                     OUT  LDA
     C                     EXSR *PSSR
     C                     ENDIF                           E*2
     C                     ELSE                            X*1
     C                     Z-ADDSNMDP     NMDP
     C                     ENDIF                           E*1
      *
     C                     MOVEA'110'     *IN,57
      *
     C********** MCDDPT    IFNE *ZEROS                     B*1                                CSD027
     C           MCDDPT    IFNE *BLANKS                    B*1                                CSD027
     C                     MOVE *BLANKS   WLKEYC
     C                     MOVELMCDDPT    WLKEYC
     C**********           CALL 'AOCUSTR0'                                                    223182
     C                     CALL 'AOCUSTR1'                                                    223182
     C                     PARM '*DBERR'  WLRTCD
     C                     PARM '*KEY   ' WLOPTN
     C                     PARM           WLKEYC 10
     C                     PARM *BLANKS   WLKYST  7
     C********** SDCUST    PARM SDCUST    DSSDY                                               223182
     C           SDCUST    PARM SDCUST    DSLDY                                               223182
      *
      **  If record not found
     C           WLRTCD    IFNE *BLANKS                    B*2
     C           BBCLST    ANDNE'Y'                                                           223182
     C           *LOCK     IN   LDA
     C                     Z-ADD010       DBASE            ****************
     C                     MOVE 'SDCUSTPD'DBFILE           * DB ERROR 010 *
     C                     MOVELMCDDPT    DBKEY            ****************
     C                     OUT  LDA
     C                     EXSR *PSSR
     C                     ENDIF                           E*2
     C                     MOVELBBCSSN    SDPOT
      *
     C                     ELSE                            X*1
     C                     MOVE *BLANKS   SDPOT
     C                     ENDIF                           E*1
      *
     C           MCEXPO    IFNE *ZEROS                     B*1
     C                     MOVE *BLANKS   ZFLD15
     C                     MOVE MCEXPO    ZFLD15
     C                     Z-ADDNMDP      ZDECS
     C                     EXSR ZSEDIT
     C                     MOVEL*BLANKS   SEXPO
     C                     MOVE ZOUT21    WFLD17 17
     C                     MOVELWFLD17    SEXPO
     C                     ELSE                            X*1
     C                     MOVE *BLANKS   SEXPO
     C                     ENDIF                           E*1
      *                                                                   161732
      ** Add Ex-date position to the figure stored in the array           161732
      *                                                                   161732
     C                     EXSR SRCONV                                    161732
      *
     C                     ENDSR
      *****************************************************************
      /EJECT
      *****************************************************************
      *                                                               *
      *            SRVALD - Validate action code                      *
      *                                                               *
      * CALLS      SRVIEW - View subfile from Review from fields      *
      *            SRVAC  - Validate action code                      *
      *                                                               *
      * CALLED BY  SRALOC - Main Processing                           *
      *                                                               *
      * FLDS USED         -                                           *
      *                                                               *
      *****************************************************************
     C           SRVALD    BEGSR
      *
     C                     MOVE 'Y'       BRIN    1                       CAC005
     C           CAC005    IFEQ 'N'                                       CAC005
      *                                                                   CAC005
     C           SBOOK     IFEQ *BLANKS                                   CAC005
     C           SBOOK     OREQ HBOOK                                     CAC005
     C                     MOVE 'N'       BRIN                            CAC005
     C                     ENDIF                                          CAC005
      *                                                                   CAC005
     C                     ELSE                                           CAC005
      *                                                                   CAC005
     C           SBOOK     IFEQ *BLANKS                                   CAC005
     C           SPRFC     ANDEQ*BLANKS                                   CAC005
     C                     MOVE 'N'       BRIN                            CAC005
     C                     ELSE                                           CAC005
      *                                                                   CAC005
      ** Convert screen fields book & book profit centre into pseudo book.CAC005
      *                                                                   CAC005
     C                     CALL 'AOBKPCR0'                                CAC005
     C                     PARM           PRTCD                           CAC005
     C                     PARM '*PSEUDO' POPTN                           CAC005
     C                     PARM SBOOK     PMBKCD                          CAC005
     C                     PARM SPRFC     PMPRFC                          CAC005
     C           PMPSBK    PARM *BLANKS   PMPSBK                          CAC005
     C           PRTCD     IFEQ *BLANKS                                   CAC005
     C           PMPSBK    ANDEQHBOOK                                     CAC005
     C                     MOVE 'N'       BRIN                            CAC005
     C                     ENDIF                                          CAC005
     C                     ENDIF                                          CAC005
      *                                                                   CAC005
     C                     ENDIF                                          CAC005
      *                                                                   CAC005
     C           SBRCD     IFNE *BLANKS                    B*1
     C           SBRCD     ANDNEHBRCD
     C***********SBOOK     ORNE *BLANKS                                   CAC005
     C***********SBOOK     ANDNEHBOOK                                     CAC005
     C           BRIN      OREQ 'Y'                                       CAC005
     C           SCNUM     ORNE *BLANKS
     C           SCNUM     ANDNEHCNUM
     C           SPTFR     ORNE *BLANKS
     C           SPTFR     ANDNEHPTFR
      *
      ** Possible combinations: Branch, Branch/Book, Branch/Customer,
      ** Branch/Customer/Book, Book, Customer, Customer/Portfolio
      *
     C                     MOVE SBRCD     HBRCD
     C                     MOVE SBOOK     HBOOK
     C                     MOVE SCNUM     HCNUM
     C                     MOVE SPTFR     HPTFR
     C                     EXSR SRVIEW
     C                     MOVE *BLANKS   HBRCD
     C                     MOVE *BLANKS   HBOOK
     C                     MOVE *BLANKS   HCNUM
     C                     MOVE *BLANKS   HPTFR
     C                     ELSE                            X*1
      *
     C                     MOVE '0'       *IN62
     C                     MOVE 'N'       ERROR
     C                     READCSE7514S1                 33
      *
     C           *IN33     IFEQ '0'                        B*2
     C                     EXSR SRVAC
      *
     C           ERROR     IFEQ 'N'                        B*3
     C                     MOVE ' '       SACDE
     C                     MOVEA'001'     *IN,57
     C                     MOVE '0'       *IN62
     C                     UPDATSE7514S1
     C                     Z-ADDW1RRN     #1RRN
     C                     ENDIF                           E*3
      *
     C           @RTCD     IFEQ 'U'                        B*3
     C           @RTCD     OREQ 'W'
     C                     MOVE '1'       *INKE
     C                     ENDIF                           E*3
      *
     C                     ENDIF                           E*2
      *
     C                     ENDIF                           E*1
      *
     C                     ENDSR
      *****************************************************************
      /EJECT
      *****************************************************************
      *                                                               *
      *            SRVIEW - View subfile from Review from fields      *
      *                                                               *
      * CALLS      SRCLSF - Clear Subfile                             *
      *                                                               *
      * CALLED BY  SRVALD - Validate action code                      *
      *                                                               *
      * FLDS USED         -                                           *
      *                                                               *
      *****************************************************************
     C           SRVIEW    BEGSR
      *
      ** Position file cursor
     C                     MOVE *LOVAL    WBRCD
     C                     MOVE *LOVAL    WCOTP
     C                     MOVE *LOVAL    WBOOK
     C***********          MOVE *LOVAL    WCNUM                                               CSD027
     C                     MOVE *BLANKS   WCNUM                                               CSD027
     C                     MOVE *LOVAL    WPTFR
     C                     MOVE *LOVAL    WDDPT
     C                     MOVE *LOVAL    WSESN
      *                                                                   CAC005
      ** If CAC005 is on, validate screen fields SBOOK and SPRFC relation.CAC005
      *                                                                   CAC005
     C           CAC005    IFEQ 'Y'                                       CAC005
     C                     MOVE *OFF      *IN63                           CAC005
      *                                                                   CAC005
     C           SBOOK     IFEQ *BLANKS                                   CAC005
     C           SPRFC     ANDNE*BLANKS                                   CAC005
     C                     MOVE *ON       *IN63                           CAC005
     C***********          MOVEL'PCA0008' ZAMSID                   CAC005 179197
     C                     MOVEL'PCA0014' ZAMSID                          179197
     C                     EXSR ZASNMS                                    CAC005
     C                     MOVE 'Y'       ERROR                           CAC005
     C                     ENDIF                                          CAC005
      *                                                                   CAC005
     C           SBOOK     IFNE *BLANKS                                   CAC005
     C           SPRFC     ANDEQ*BLANKS                                   CAC005
     C                     MOVE *ON       *IN63                           CAC005
     C                     MOVEL'PCA0013' ZAMSID                          CAC005
     C                     EXSR ZASNMS                                    CAC005
     C                     MOVE 'Y'       ERROR                           CAC005
     C                     ENDIF                                          CAC005
      *                                                                   CAC005
     C           SBOOK     IFNE *BLANKS                                   CAC005
     C           SPRFC     ANDNE*BLANKS                                   CAC005
     C                     CALL 'AOBKPCR0'                                CAC005
     C                     PARM           PRTCD                           CAC005
     C                     PARM '*PSEUDO' POPTN                           CAC005
     C                     PARM SBOOK     PMBKCD                          CAC005
     C                     PARM SPRFC     PMPRFC                          CAC005
     C           PMPSBK    PARM *BLANKS   PMPSBK                          CAC005
     C           PRTCD     IFNE *BLANKS                                   CAC005
     C                     MOVE *ON       *IN63                           CAC005
     C                     MOVEL'PCA0012' ZAMSID                          CAC005
     C                     EXSR ZASNMS                                    CAC005
     C                     MOVE 'Y'       ERROR                           CAC005
     C                     ELSE                                           CAC005
     C                     MOVELPMPSBK    HBOOK                           CAC005
     C                     ENDIF                                          CAC005
     C                     ENDIF                                          CAC005
      *                                                                   CAC005
     C                     ENDIF                                          CAC005
      *
     C           HBRCD     IFEQ *BLANKS                    B*1
     C           HBOOK     ANDNE*BLANKS
     C           HBRCD     OREQ *BLANKS
     C           HCNUM     ANDNE*BLANKS
     C           HBRCD     OREQ *BLANKS
     C           HPTFR     ANDNE*BLANKS
     C                     MOVEA'1'       *IN,20
     C                     MOVEL'CO00275' ZAMSID
     C                     EXSR ZASNMS
     C                     MOVE 'Y'       ERROR
     C                     ENDIF                           E*1
      *
     C           HCNUM     IFNE *BLANKS                    B*1
     C                     MOVE *BLANKS   ZFIELD
     C                     MOVE HCNUM     ZFIELD
     C                     Z-ADD6         ZADIG
     C                     Z-ADD0         ZADEC
     C                     EXSR ZALIGN
      *
     C           *IN99     IFEQ '1'                        B*2
     C                     MOVEL'CO00224' ZAMSID
     C                     EXSR ZASNMS
     C                     MOVE '1'       *IN22
     C                     MOVE 'Y'       ERROR
     C                     ENDIF                           E*2
      *
     C                     ENDIF                           E*1
      *
     C           HBOOK     IFNE *BLANKS                    B*1
     C           HCNUM     ANDNE*BLANKS
     C                     MOVEA'11'      *IN,21
     C                     MOVEL'CO00222' ZAMSID
     C                     EXSR ZASNMS
     C                     MOVE 'Y'       ERROR   1
     C                     ENDIF                           E*1
      *
     C           HPTFR     IFNE *BLANKS                    B*1
     C           HCNUM     ANDEQ*BLANKS
     C                     MOVEA'11'      *IN,22
     C                     MOVEL'CO00223' ZAMSID
     C                     EXSR ZASNMS
     C                     MOVE 'Y'       ERROR   1
     C                     ENDIF                           E*1
      *
     C           ERROR     IFEQ 'N'                        B*1
      *
      ** Clear Subfile
     C                     EXSR SRCLSF
      *
     C           WWUDCD    IFEQ 'Y'                        B*2
      *
      ** If CA is a child, use Security from the Originating CA;          CSE020
      ** Otherwise, use Security from entry parameter.                    CSE020
      *                                                                   CSE020
     C           MAPREF    IFNE *BLANKS                                   CSE020
     C                     MOVE WOSESN    KUDSN                           CSE020
     C                     ELSE                                           CSE020
     C                     MOVE @SESN     KUDSN
     C                     ENDIF                                          CSE020
      *                                                                   CSE020
     C                     MOVE HBRCD     KUDBA
      *
     C           HBOOK     IFEQ *BLANKS                    B*3
     C           HCNUM     ANDEQ*BLANKS
      *
      ** Read first record from SECOUPL0
     C           KEY13     SETLLSECOUPL0
     C           KUDSN     READESECOUPL0                 32
      *
     C           *IN32     IFEQ '0'                        B*4
     C                     MOVE 'B'       MCCOTP
     C                     MOVE @PTYP     MCCOAT
     C                     EXSR SRBLD1
     C                     ENDIF                           E*4
      *
      ** Read first record from SECOCPL0
     C           KEY13     SETLLSECOCPL0
     C           KUDSN     READESECOCPL0                 32
      *
     C           *IN32     IFEQ '0'                        B*4
     C                     MOVE 'C'       MCCOTP
     C                     MOVE @PTYP     MCCOAT
     C                     EXSR SRBLD2
     C                     ENDIF                           E*4
      *
     C                     ELSE                            X*3
      *
     C                     MOVE HBOOK     KUDBK
     C                     MOVE HCNUM     KCDCN
     C                     MOVE HPTFR     KPTFR
      *
     C           HBOOK     IFNE *BLANKS                    B*4
      *
      ** Read first record from SECOUPL0
     C           KEY11A    SETLLSECOUPL0
     C           KUDSN     READESECOUPL0                 32
      *
     C           *IN32     IFEQ '0'                        B*5
     C                     MOVE 'B'       MCCOTP
     C                     MOVE @PTYP     MCCOAT
     C                     EXSR SRBLD1
     C                     ENDIF                           E*5
      *
      ** Read first record from SECOCPL0
     C           KUDSN     SETLLSECOCPL0
     C           KUDSN     READESECOCPL0                 32
      *
     C           *IN32     IFEQ '0'                        B*5
     C                     MOVE 'C'       MCCOTP
     C                     MOVE @PTYP     MCCOAT
     C                     EXSR SRBLD2
     C                     ENDIF                           E*5
     C                     ELSE                            X*4
      *
      ** Read first record from SECOCPL0
     C           KEY12A    SETLLSECOCPL0
     C           KUDSN     READESECOCPL0                 32
      *
     C           *IN32     IFEQ '0'                        B*5
     C                     MOVE 'C'       MCCOTP
     C                     MOVE @PTYP     MCCOAT
     C                     EXSR SRBLD2
     C                     ENDIF                           E*5
     C                     ENDIF                           E*4
     C                     ENDIF                           E*3
      *
      ** If CA is a child, restore KUDSN.                                 CSE020
      *                                                                   CSE020
     C           MAPREF    IFNE *BLANKS                                   CSE020
     C                     MOVE @SESN     KUDSN                           CSE020
     C                     ENDIF                                          CSE020
      *                                                                   CSE020
     C           WWCPT     IFEQ 0                          B*3
     C                     Z-ADD1         #1RRN
     C                     MOVE #1RRN     W1RRN   40
     C                     WRITESE7514S1
     C                     MOVE '1'       *IN80
     C                     MOVE '1'       *IN30
     C                     MOVE '0'       *IN39
     C                     MOVEL'CO00001' ZAMSID
     C                     EXSR ZASNMS
     C                     MOVE 'Y'       ERROR   1
     C                     ELSE                            X*3
      *
     C           *IN32     IFEQ '1'                        B*4
      *
     C************IN45     IFEQ '1'                        B*5            161732
     C***********          EXSR SRRESP                                    161732
     C***********MCDDPT    IFNE WWDPT                      B*6            161732
     C***********          Z-ADDMCDDPT    WWDPT                           161732
     C***********          ADD  1         #1RRN                           161732
     C***********          ADD  1         WWCPT                           161732
     C***********          WRITESE7514S1                                  161732
     C***********          ENDIF                           E*6            161732
     C***********          ENDIF                           E*5            161732
      *
     C                     MOVE '1'       *IN30
     C                     ENDIF                           E*4
      *
     C                     MOVE #1RRN     W1RRN   40
     C                     MOVE '1'       *IN81
     C                     ENDIF                           E*3
      *
     C                     ELSE                            X*2
      *
     C           HBRCD     IFNE *BLANKS                    B*3
     C                     MOVE HBRCD     WBRCD
     C                     ENDIF                           E*3
      *
     C           HBOOK     IFNE *BLANKS                    B*3
     C                     MOVE 'B'       WCOTP
     C                     MOVE HBOOK     WBOOK
     C                     ENDIF                           E*3
      *
     C           HCNUM     IFNE *BLANKS                    B*3
     C                     MOVE 'C'       WCOTP
     C                     MOVE HCNUM     WCNUM
     C                     ENDIF                           E*3
      *
     C           HPTFR     IFNE *BLANKS                    B*3
     C                     MOVE HPTFR     WPTFR
     C                     ENDIF                           E*3
      *
     C           KEY2      SETLLSECOALL2
     C           KEY1      READESECOALL2                 39
      *
      ** Checking for pointer if not in the right position
     C           WCOTP     IFEQ 'C'                        B*3
      *
     C           *IN39     DOWEQ'0'                        B*4
     C           WCNUM     ANDGTMCCNUM
     C           WBRCD     ANDEQMCBRCD
     C           KEY1      READESECOALL2                 39
     C                     ENDDO                           E*4
      *
     C                     ENDIF                           E*3
     C                     ENDIF                           E*2
      *
     C                     MOVE *BLANKS   SBRCD            Review from: Branch
     C                     MOVE *BLANKS   SBOOK            Book
     C                     MOVE *BLANKS   SPRFC                           CAC005
     C                     MOVE *BLANKS   SCNUM            Customer
     C                     MOVE *BLANKS   SPTFR            Portfolio
      *
     C                     ENDIF                           E*1
      *
     C                     ENDSR
      *****************************************************************
      /EJECT
      *****************************************************************
      *                                                               *
      *            SRVAC  - Validate action code                      *
      *                                                               *
      * CALLS      SE7515 - Reply Handling Details Maintenance/Enqy.  *
      *            SE7541 - Reply Handling History Enquiry            *
      *            SE7540 - Customer/Book Enquiry                     *
      *                                                               *
      * CALLED BY  SRVALD - Validate action code                      *
      *                                                               *
      * FLDS USED         -                                           *
      *                                                               *
      *****************************************************************
     C           SRVAC     BEGSR
      *
     C           SACDE     IFNE *BLANKS                    B*1
     C           SACDE     ANDNE'A'
     C           SACDE     ANDNE'E'
     C           SACDE     ANDNE'H'
     C           SACDE     ANDNE'V'
     C                     MOVEA'001'     *IN,57
     C                     MOVE '1'       *IN62
     C                     UPDATSE7514S1
     C                     MOVEL'CO00221' ZAMSID
     C                     EXSR ZASNMS
     C                     MOVE 'Y'       ERROR   1
     C                     ELSE                            X*1
     C           SACDE     IFEQ 'A'                        B*2
     C           HCNUM     ANDEQBVERCU
     C                     MOVEA'001'     *IN,57
     C                     MOVE '1'       *IN62
     C                     UPDATSE7514S1
     C                     MOVEL'CO00327' ZAMSID
     C                     EXSR ZASNMS
     C                     MOVE 'Y'       ERROR   1
     C                     ELSE                            X*2
      *
     C                     MOVE @CORF     PCORF   6
     C                     MOVE @SESN     PSESN  10
     C                     MOVE @COAT     PCOAT   2
     C                     MOVE @PTYP     PPTYP   2
     C                     MOVE @COEX     PCOEX   5
     C                     MOVE @STAT     PSTAT   1
     C                     MOVE SBRCH     PBRCH   3
     C                     MOVE HDPOT     PDPOT   6
      *                                                                   161732
      ** Retrieve total Ex-date position, to be passed to RPG/SE7515      161732
      *                                                                   161732
     C                     MOVE SBRCH     WBRCH                           161732
     C                     MOVE SCUBK     WCUBK                           161732
     C                     MOVE SPORT     WPORT                           161732
     C                     MOVE *BLANKS   PEXPS  16                       161732
     C                     MOVE *BLANKS   WSTR15 15                       161732
     C                     MOVE *BLANKS   WSTR17 17                       161732
     C                     Z-ADD1         Y       20                      161732
     C           WBCBP     LOKUPEXP1,Y                   88               161732
     C           *IN88     IFEQ *ON                                       161732
     C                     MOVEAEXP2,Y    WSTR17 17                       161732
     C                     MOVE WSTR17    WSIGN                           161732
     C           WSIGN     IFEQ '-'                                       161732
     C           16        SUBSTWSTR17:2  WSTR15 15                       161732
     C                     MOVE WSTR15    ZFLD15                          161732
     C           0         SUB  ZFLD15    ZFLD15                          161732
     C                     ELSE                                           161732
     C                     MOVE WSTR17    ZFLD15                          161732
     C                     ENDIF                                          161732
     C                     Z-ADDNMDP      ZDECS                           161732
     C                     EXSR ZSEDIT                                    161732
     C                     MOVE ZOUT21    PEXPS                           161732
     C                     ENDIF                                          161732
      *
     C           HINDC     IFEQ 'C'                        B*3
     C                     MOVELHCNUM     PCNUM   6
     C                     MOVE *BLANKS   PBOOK   2
     C                     ELSE
     C                     MOVE *BLANKS   PCNUM
     C                     MOVELHBOOK     PBOOK
     C                     ENDIF
      *
     C                     MOVE SPORT     PPORT   4
      *
     C           P7515     PLIST
     C                     PARM           PCORF            Reference
     C                     PARM           PSESN            Security Short.
     C                     PARM           PCOAT            Corporate Type
     C                     PARM           PPTYP            Processing Type
     C                     PARM           PCOEX            Ex-Date
     C                     PARM           PSTAT            Corporate Action Stat
     C                     PARM           PBRCH            Branch
     C                     PARM           PDPOT            Depot
     C                     PARM           PBOOK            Book
     C                     PARM           PCNUM            Customer
     C                     PARM           PPORT            Portfolio
     C                     PARM           PEXPS            Ex-date Pos'n  161732
     C                     PARM           PMODE            Mode
     C                     PARM           PCPGM            Calling Pgm
     C                     PARM *BLANKS   @RTCD            Return Code
      *
     C           SACDE     IFEQ 'A'                        B*4
     C                     MOVE 'A'       PMODE   1
     C                     MOVE *BLANKS   PCPGM   6
     C                     CALL 'SE7515'  P7515
      *
     C                     MOVELNARR,1    DBKEY
     C                     ENDIF                           E*4
      *
     C           SACDE     IFEQ 'E'                        B*4
     C                     MOVE 'E'       PMODE   1
     C                     MOVE *BLANKS   PCPGM   6
     C                     CALL 'SE7515'  P7515
      *
     C                     MOVELNARR,1    DBKEY
     C                     ENDIF                           E*4
      *
     C           SACDE     IFEQ 'H'                        B*4
     C                     CALL 'SE7541'
     C                     PARM           PCORF            CA Reference
     C                     PARM           PBOOK            Book
     C                     PARM           PCNUM            Customer NumbeR
     C                     PARM           PBRCH            Branch
     C                     PARM           PPORT            Portfolio Reference
     C                     PARM           PDPOT            Depot
     C                     PARM *BLANKS   @RTCD            Return Code
      *
     C                     MOVELNARR,2    DBKEY
     C                     ENDIF                           E*4
      *
     C           SACDE     IFEQ 'V'                        B*4
     C           PCORF     CHAINSECOALL1             89                   137877
      *                                                                   137877
     C           *IN89     IFEQ '1'                        B*5            137877
     C                     MOVEA'001'     *IN,57                          137877
     C                     MOVE '1'       *IN62                           137877
     C                     UPDATSE7514S1                                  137877
     C                     MOVEL'CO00256' ZAMSID           Message id.    137877
     C                     EXSR ZASNMS                     Send message   137877
     C                     MOVE 'Y'       ERROR   1                       137877
     C                     ELSE                            E*5            137877
     C                     MOVE 'SE7514'  PCPGM   6
     C                     MOVE WOPNB     POPNB   2
     C                     CALL 'SE7540'
     C                     PARM           PCORF
     C                     PARM           POPNB
     C                     PARM           PBRCH
     C                     PARM           PBOOK
     C                     PARM           PCNUM
     C                     PARM           PPORT
     C                     PARM           PCPGM
     C                     PARM *BLANKS   @RTCD
      *
     C                     MOVELNARR,3    DBKEY
     C                     ENDIF                           E*5            137877
     C                     ENDIF                           E*4
      *
     C           @RTCD     IFEQ 'E'
     C           *INU7     OREQ '1'
     C           *INU8     OREQ '1'
     C           *LOCK     IN   LDA
     C                     Z-ADD011       DBASE            ****************
     C                     MOVEL*BLANKS   DBFILE           * DB ERROR 011 *
     C                     OUT  LDA                        ****************
     C                     EXSR *PSSR
     C                     ENDIF
      *
     C           @RTCD     IFEQ '3'
     C                     MOVE '1'       *INKC
     C                     ENDIF                           E*3
     C                     ENDIF                           E*2
     C                     ENDIF                           E*1
      *
     C                     ENDSR
      *****************************************************************
      /EJECT
      *****************************************************************   161732
      ************                                                    *   161732
      ************ SRSAVP - Save previous values of the subfile record*   161732
      ***********                                                     *   161732
      **CALLS****         -                                           *   161732
      ***********                                                     *   161732
      **CALLLED*BY SRBLDS - Build Subfile                             *   161732
      ***********  SRPROC - Process read records                      *   161732
      ***********                                                     *   161732
      **FLDS*USED         -                                           *   161732
      ***********                                                     *   161732
      *****************************************************************   161732
     C***********SRSAVP    BEGSR                                          161732
      ***********                                                         161732
     C***********          MOVE SBRCH     SSBRC   3                       161732
     C***********          MOVE SCUBK     SSCUB  10                       161732
     C***********          MOVE SPORT     SSPOR   4                       161732
     C***********          MOVE SDPOT     SSDPO  10                       161732
     C***********          MOVE SEXPO     SSEXP  17                       161732
     C***********          MOVE SC1RE     SSC1R   2                       161732
     C***********          MOVE SC2RE     SSC2R   2                       161732
     C***********          MOVE SS1IN     SSS1I   2                       161732
     C***********          MOVE SS2IN     SSS2I   2                       161732
     C***********          MOVE HBOOK     SHBOOK  2                       161732
     C***********          MOVE HCNUM     SHCNUM  6                       161732
     C***********          MOVE HPORT     SHPOR   4                       161732
     C***********          MOVE HDPOT     SHDPO   6                       161732
     C***********          MOVE HEXPO     SHEXP  17                       161732
     C***********          MOVE '1'       *IN45                           161732
     C***********          MOVEA*IN,57    IND,1                           161732
      ***********                                                         161732
     C***********          ENDSR                                          161732
      *****************************************************************   161732
      */EJECT****                                                         161732
      *****************************************************************   161732
      ***********                                                     *   161732
      ***********  SRRESP - Restore previous values of the subfile    *   161732
      ***********           record                                    *   161732
      ***********                                                     *   161732
      **CALLS****         -                                           *   161732
      ***********                                                     *   161732
      **CALLLED*BY SRBLDS - Build Subfile                             *   161732
      ***********                                                     *   161732
      **FLDS*USED         -                                           *   161732
      ***********                                                     *   161732
      *****************************************************************   161732
     C***********SRRESP    BEGSR                                          161732
      ***********                                                         161732
     C***********          MOVE SSBRC     SBRCH                           161732
     C***********          MOVE SSCUB     SCUBK                           161732
     C***********          MOVE SSPOR     SPORT                           161732
     C***********          MOVE SSDPO     SDPOT                           161732
     C***********          MOVE SSEXP     SEXPO                           161732
     C***********          MOVE SSC1R     SC1RE                           161732
     C***********          MOVE SSC2R     SC2RE                           161732
     C***********          MOVE SSS1I     SS1IN                           161732
     C***********          MOVE SSS2I     SS2IN                           161732
     C***********          MOVE SHBOOK    HBOOK                           161732
     C***********          MOVE SHCNUM    HCNUM                           161732
     C***********          MOVE SHPOR     HPORT                           161732
     C***********          MOVE SHDPO     HDPOT                           161732
     C***********          MOVE SHEXP     HEXPO                           161732
     C***********          MOVE '0'       *IN45                           161732
     C***********          MOVEAIND,1     *IN,57                          161732
      ***********                                                         161732
     C***********          ENDSR                                          161732
      *****************************************************************   161732
      */EJECT****                                                         161732
      *****************************************************************
      *                                                               *
      *            SRRPLY - Retrieve the standard instructions        *
      *                     reply for level 2 for Books & Customers   *
      *                                                               *
      * CALLS                                                         *
      *                                                               *
      * CALLED BY                                                     *
      *                                                               *
      * FLDS USED         -                                           *
      *                                                               *
      *****************************************************************
     C           SRRPLY    BEGSR
      *
     C                     Z-ADD0         WCAPR   52       Cash %
      *
      *****If Customer/Book Current Reply exists.                         155622
     C*****      EXBCRE    IFEQ 'Y'                        B*1            155622
      *****                                                               155622
      *****Set SS1IN : Option for Actual Allocation 1 to Reply Option Leve155622
     C*****      MQR1RE    IFNE *BLANKS                            137877 155622
     C*****                MOVE *BLANKS   ZFIELD                          155622
     C*****                MOVE MQR1RE    ZFIELD                          155622
     C*****                Z-ADD2         ZADIG                           155622
     C*****                Z-ADD*ZEROS    ZADEC                           155622
     C*****                EXSR ZEDIT                                     155622
     C*****                MOVEL*BLANKS   SS1IN                           155622
     C*****                MOVE ZFIELD    SS1IN            Opt.for Actual 155622
     C*****                ELSE                                    137877 155622
     C*****                MOVE *BLANKS   SS1IN                    137877 155622
     C*****                ENDIF                                   137877 155622
      *****                                                               155622
      *****Else, if Customer/Book Current Reply does not exists.          155622
     C*****                ELSE                            X*1            155622
      *
      ***  If Customer/Book Standard Corporate Actions Instruction exists.
     C           EXBCSI    IFEQ 'Y'                        B*2
      *
      ***  If Cash Preferred % is > or = 50, set Option for Actual Allocation 1 to Default
      ***  Cash Preferred from SECORFL1.
     C           MOCAPP    IFGE 50                         B*3
     C                     MOVE MADFCP    SS1IN     P
      *
      ***  If Cash Preferred % is < 50, set Option for Actual Allocation 1 to Default Stock
      ***  Preferred from SECORFL1.
     C                     ELSE                            X*3
     C                     MOVE MADFSP    SS1IN     P
     C                     ENDIF                           E*3
      *
      *****Else, if Customer/Book Standard Corporate Actions Instruction d155622
      *****Customer/Book Current Reply does not exist).                   155622
     C*****                ELSE                            X*2            155622
      *****                                                               155622
      *****Set Option for Actual Allocation 1 to Default for No Reply from155622
     C*****                MOVE MADFNR    SS1IN     P                     155622
      *
     C                     ENDIF                           E*2
     C*****                ENDIF                           E*1            155622
      *
      ***  If Processing Type = Non Financial Events and Customer/Book Current Reply exists,
      ***  set Cash % to Reply Cash % Level 2.
     C           MAPTYP    IFEQ 'NF'                       B*1
     C           EXBCRE    ANDEQ'Y'
     C                     Z-ADDMQR2CA    WCAPR
     C                     ENDIF                           E*1
      *
      ***  If Processing Type = Dividends Events, Rights Issues, Offers or Exercices and
      ***  Conversions.
     C           MAPTYP    IFEQ 'DV'                       B*1 Dividend Events
     C           MAPTYP    OREQ 'RG'                       Rights Issues
     C           MAPTYP    OREQ 'OF'                       Offers
     C           MAPTYP    OREQ 'EX'                       Exercice and Conversion
      *
      *****CASE 1: If Customer/Booh Current Reply exists.                 155622
     C*****      EXBCRE    IFEQ 'Y'                        B*2            155622
      *****                                                               155622
      *****Set Option for Actual Allocation 2 to Reply Option Level 2.    155622
     C*****      MQR2RE    IFNE *BLANKS                            137877 155622
     C*****                MOVE *BLANKS   ZFIELD                          155622
     C*****                MOVE MQR2RE    ZFIELD                          155622
     C*****                Z-ADD2         ZADIG                           155622
     C*****                Z-ADD*ZEROS    ZADEC                           155622
     C*****                EXSR ZEDIT                                     155622
     C*****                MOVEL*BLANKS   SS2IN                           155622
     C*****                MOVE ZFIELD    SS2IN            Opt.for Actual 155622
     C*****                ELSE                                    137877 155622
     C*****                MOVE *BLANKS   SS2IN                    137877 155622
     C*****                ENDIF                                   137877 155622
      *****                                                               155622
      *****If Processing Type = Dividend Events.                          155622
     C*****      MAPTYP    IFEQ 'DV'                       B*3            155622
      *****                                                               155622
      *****If Option 1 selected: Cash Payment/Sell Rights, set Cash % to  155622
     C*****      MDOPT1    IFEQ 'Y'                        B*4            155622
     C*****                Z-ADD100       WCAPR                           155622
     C*****                ELSE                            X*4            155622
      *****                                                               155622
      *****If Option 5 selected: Take Part Cash/Rest Stock, set Cash % to 155622
     C*****      MDOPT5    IFEQ 'Y'                        B*5            155622
     C*****                Z-ADDMQR2CA    WCAPR                           155622
     C*****                ELSE                            X*5            155622
      *****                                                               155622
      *****If Option selected is 2: Take Stock+Buy Additional Rights or 3:155622
      *****Rights or 4: Take Stock, set Cash % to 0.                      155622
     C*****      MDOPT2    IFEQ 'Y'                        B*6            155622
     C*****      MDOPT3    OREQ 'Y'                                       155622
     C*****      MDOPT4    OREQ 'Y'                                       155622
     C*****                Z-ADD0         WCAPR                           155622
     C*****                ENDIF                           E*6            155622
     C*****                ENDIF                           E*5            155622
     C*****                ENDIF                           E*4            155622
     C*****                ELSE                            X*3            155622
      *****                                                               155622
      *****If Processing Type = Rights Issues.                            155622
     C*****      MAPTYP    IFEQ 'RG'                       B*4            155622
      *****                                                               155622
      *****If Option 1 selected: Sell all Rights, set Cash % to 100.      155622
     C*****      MFOPT1    IFEQ 'Y'                        B*5            155622
     C*****                Z-ADD100       WCAPR                           155622
     C*****                ELSE                            X*5            155622
      *****                                                               155622
      *****If Option selected is 5: Take Part Cash/Rest Stock or 6: Take P155622
      *****set Cash % to Reply Cash % Level 2.                            155622
     C*****      MFOPT5    IFEQ 'Y'                        B*6            155622
     C*****      MFOPT6    OREQ 'Y'                                       155622
     C*****                Z-ADDMQR2CA    WCAPR                           155622
     C*****                ELSE                            X*6            155622
      *****                                                               155622
      *****If Option selected is 2: Take Stock+Buy Fraction or 3: Take Sto155622
      *****Take Stock or 7: Do nothing, set Cash % to 0.                  155622
     C*****      MFOPT2    IFEQ 'Y'                        B*7            155622
     C*****      MFOPT3    OREQ 'Y'                                       155622
     C*****      MFOPT4    OREQ 'Y'                                       155622
     C*****      MFOPT7    OREQ 'Y'                                       155622
     C*****                Z-ADD0         WCAPR                           155622
     C*****                ENDIF                           E*7            155622
     C*****                ENDIF                           E*6            155622
     C*****                ENDIF                           E*5            155622
     C*****                ELSE                            X*4            155622
      *****                                                               155622
      *****If Processing Type = Offers.                                   155622
     C*****      MAPTYP    IFEQ 'OF'                       B*5            155622
      *****                                                               155622
      *****If Option 1 selected: Accept Offer, set Cash % to 100.         155622
     C*****      MIOPT1    IFEQ 'Y'                        B*6            155622
     C*****                Z-ADD100       WCAPR                           155622
     C*****                ELSE                            X*6            155622
      *****                                                               155622
      *****If Option 3 selected: Partial Accept Offer, set Cash % to Reply155622
     C*****      MIOPT3    IFEQ 'Y'                        B*7            155622
     C*****                Z-ADDMQR2CA    WCAPR                           155622
     C*****                ELSE                            X*7            155622
      *****                                                               155622
      *****If Option 2 selected: Refuse Offer, set Cash % to 0.           155622
     C*****      MIOPT2    IFEQ 'Y'                        B*8            155622
     C*****                Z-ADD0         WCAPR                           155622
     C*****                ENDIF                           E*8            155622
     C*****                ENDIF                           E*7            155622
     C*****                ENDIF                           E*6            155622
     C*****                ELSE                            X*5            155622
      *****                                                               155622
      *****If Processing Type = Exercices and Conversions.                155622
     C*****      MAPTYP    IFEQ 'EX'                       B*6            155622
      *****                                                               155622
      *****If Option 1 selected: Sell all Rights, set Cash % to 100.      155622
     C*****      MJOPT1    IFEQ 'Y'                        B*7            155622
     C*****                Z-ADD100       WCAPR                           155622
     C*****                ELSE                            X*7            155622
      *****                                                               155622
      *****If Option selected is 5: Take Part Cash/Rest Stock or 6: Take P155622
      *****set Cash % to Reply Cash % Level 2.                            155622
     C*****      MJOPT5    IFEQ 'Y'                        B*8            155622
     C*****      MJOPT6    OREQ 'Y'                                       155622
     C*****                Z-ADDMQR2CA    WCAPR                           155622
     C*****                ELSE                            X*8            155622
      *****                                                               155622
      *****If Option selected is 2: Take Stock+Buy Fraction or 3: Take Sto155622
      *****Take Stock or 7: Do nothing, set Cash % to 0.                  155622
     C*****      MJOPT2    IFEQ 'Y'                        B*9            155622
     C*****      MJOPT3    OREQ 'Y'                                       155622
     C*****      MJOPT4    OREQ 'Y'                                       155622
     C*****      MJOPT7    OREQ 'Y'                                       155622
     C*****                Z-ADD0         WCAPR                           155622
     C*****                ENDIF                           E*9            155622
     C*****                ENDIF                           E*8            155622
     C*****                ENDIF                           E*7            155622
     C*****                ENDIF                           E*6            155622
     C*****                ENDIF                           E*5            155622
     C*****                ENDIF                           E*4            155622
     C*****                ENDIF                           E*3            155622
      *****                                                               155622
      *****CASE 2: Else, if Customer/Book Current Reply does not exist.   155622
     C*****                ELSE                            X*2            155622
      *****                                                               155622
      *****Set Option for Actual Allocation 2 to Default for No Reply from155622
      *****(where xx = 'DV', 'RG', 'EX' or 'OF').                         155622
     C*****                SELEC                           B*3            155622
     C*****      @PTYP     WHEQ 'DV'                                      155622
     C*****                MOVE MDDFNR    SS2IN     P                     155622
      *****                                                               155622
     C*****      @PTYP     WHEQ 'RG'                                      155622
     C*****                MOVE MFDFNR    SS2IN     P                     155622
      *****                                                               155622
     C*****      @PTYP     WHEQ 'OF'                                      155622
     C*****                MOVE MIDFNR    SS2IN     P                     155622
      *****                                                               155622
     C*****      @PTYP     WHEQ 'EX'                                      155622
     C*****                MOVE MJDFNR    SS2IN     P                     155622
     C*****                ENDSL                           E*3            155622
      *
      ***  CASE 2.1: If Customer/Book Standard Corporate Actions Instruction exists (and Customer/
      ***            Book Current Reply does not exist).
     C           EXBCSI    IFEQ 'Y'                        B*3
      *
      ***  Set Cash % to Cash Preferred % from SECOSIL1.
     C                     Z-ADDMOCAPP    WCAPR
      *
      ***  If Processing Type = Dividend Events.
     C           MAPTYP    IFEQ 'DV'                       B*4
      *
      ***  If Stock Dividend Type = Stock for Stock or Combined for Cash and Stock, set Cash % to 0.
     C           MDSDIT    IFEQ 'S'                        B*5 Stock for Stock
     C           MDSDIT    OREQ 'C'                        Combined for Cash and Stock
     C                     Z-ADD0         WCAPR
     C                     ENDIF                           E*5
      *
      ***  If Cash % is < 50.
     C           WCAPR     IFLT 50                         B*5
      *
      ***  If Option 5 not allowed, set Cash % to 0.
     C           MDOPT5    IFNE 'Y'                        B*6
     C                     Z-ADD0         WCAPR
     C                     ELSE                            X*6
      *
      ***  If Option 5 allowed and Cash % not 0, default Option for Actual allocation 2 is '5'
      ***  (Cash % already = Cash Preferred % from Standard Instruction (SECOSIL1)).
     C           WCAPR     IFNE 0                          B*7
     C                     MOVE ' 5'      SS2IN
     C                     ENDIF                           E*7
     C                     ENDIF                           E*6
     C                     ELSE                            X*5
      *
      ***  If Cash % > 50.
     C           WCAPR     IFGT 50                         B*6
      *
      ***  If Option 5 not allowed, set Cash % to 100.
     C           MDOPT5    IFNE 'Y'                        B*7
     C                     Z-ADD100       WCAPR
     C                     ELSE                            X*7
      *
      ***  If Option 5 allowed and Cash % not 100, default Option for Actual allocation 2 is '5'
      ***  (Cash % already = Cash Preferred % from Standard Instruction (SECOSIL1)).
     C           WCAPR     IFNE 100                        B*8
     C                     MOVE ' 5'      SS2IN
     C                     ENDIF                           E*8
     C                     ENDIF                           E*7
     C                     ENDIF                           E*6
     C                     ENDIF                           E*5
      *
      ***  If Cash % is 0 (means it is Stock Preferred).
     C           WCAPR     IFEQ 0                          B*5
      *
      ***  If Rounding Option from SECOSIL1 = 'U' and Option 2 is allowed, default Option for
      ***  Actual Allocation 2 is '2' (Cash % is already 0).
     C           MOROOP    IFEQ 'U'                        B*6
     C           MDOPT2    IFEQ 'Y'                        B*7
     C                     MOVE ' 2'      SS2IN
     C                     ELSE                            X*7
      *
      ***  If Rounding Option is 'U' and Option 2 is not allowed and Option 4 is allowed, default
      ***  Option for Actual Allocation 2 is '4' (Cash % is already 0).
     C           MDOPT4    IFEQ 'Y'                        B*8
     C                     MOVE ' 4'      SS2IN
     C                     ELSE                            X*8
      *
      ***  If Rounding Option is 'U' and Options 2 and 4 are not allowed and Option 3 is allowed,
      ***  default Option for Actual Allocation 2 is '3' (Cash % is already 0).
     C           MDOPT3    IFEQ 'Y'                        B*9
     C                     MOVE ' 3'      SS2IN
     C                     ELSE                            X*9
      *
      ***  If Rounding Option is 'U' and Options 2, 4 and 3 are not allowed and Option 5 is allowed,
      ***  default Option for Actual Allocation 2 is '5' and Set Cash % to Cash Preferred % from
      ***  Standard Instruction (SECOSIL1).
     C           MDOPT5    IFEQ 'Y'                        B*10
     C                     MOVE ' 5'      SS2IN
     C                     Z-ADDMOCAPP    WCAPR
     C                     ELSE                            X*10
      *
      ***  If Rounding Option is 'U' and Options 2, 4, 3 and 5 are not allowed and Option 1 is
      ***  allowed, default Option for Actual Allocation 2 is '1' and Set Cash % to 100.
     C           MDOPT1    IFEQ 'Y'                        B*11
     C                     MOVE ' 1'      SS2IN
     C                     Z-ADD100       WCAPR
     C                     ELSE                            X*11
      *
      ***  If Rounding Option is 'U' and Options 2, 4, 3, 5 and 1 are not allowed, default
      ***  Option for Actual Allocation 2 is blank.
     C                     MOVE '  '      SS2IN
     C                     ENDIF                           E*11
     C                     ENDIF                           E*10
     C                     ENDIF                           E*9
     C                     ENDIF                           E*8
     C                     ENDIF                           E*7
     C                     ENDIF                           E*6
      *
      ***  If Rounding Option from SECOSIL1 = 'D' and Option 3 is allowed, default Option for
      ***  Actual Allocation 2 is '3' (Cash % is already 0).
     C           MOROOP    IFEQ 'D'                        B*6
     C           MDOPT3    IFEQ 'Y'                        B*7
     C                     MOVE ' 3'      SS2IN
     C                     ELSE                            X*7
      *
      ***  If Rounding Option is 'D' and Option 3 is not allowed and Option 4 is allowed, default
      ***  Option for Actual Allocation 2 is '4' (Cash % is already 0).
     C           MDOPT4    IFEQ 'Y'                        B*8
     C                     MOVE ' 4'      SS2IN
     C                     ELSE                            X*8
      *
      ***  If Rounding Option is 'D' and Options 3 and 4 are not allowed and Option 2 is allowed,
      ***  default Option for Actual Allocation 2 is '2' (Cash % is already 0).
     C           MDOPT2    IFEQ 'Y'                        B*9
     C                     MOVE ' 2'      SS2IN
     C                     ELSE                            X*9
      *
      ***  If Rounding Option is 'D' and Options 3, 4 and 2 are not allowed and Option 5 is allowed,
      ***  default Option for Actual Allocation 2 is '5' and Set Cash % to Cash Preferred % from
      ***  Standard Instruction (SECOSIL1).
     C           MDOPT5    IFEQ 'Y'                        B*10
     C                     MOVE ' 5'      SS2IN
     C                     Z-ADDMOCAPP    WCAPR
     C                     ELSE                            X*10
      *
      ***  If Rounding Option is 'D' and Options 3, 4, 2 and 5 are not allowed and Option 1 is
      ***  allowed, default Option for Actual Allocation 2 is '1' and Set Cash % to 100.
     C           MDOPT1    IFEQ 'Y'                        B*11
     C                     MOVE ' 1'      SS2IN
     C                     Z-ADD100       WCAPR
     C                     ELSE                            X*11
      *
      ***  If Rounding Option is 'D' and Options 3, 4, 2, 5 and 1 are not allowed, default
      ***  Option for Actual Allocation 2 is blank.
     C                     MOVE '  '      SS2IN
     C                     ENDIF                           E*11
     C                     ENDIF                           E*10
     C                     ENDIF                           E*9
     C                     ENDIF                           E*8
     C                     ENDIF                           E*7
     C                     ENDIF                           E*6
     C                     ELSE                            X*5
      *
      ***  If Cash % is 100 (means it is Cash Preferred).
     C           WCAPR     IFEQ 100                        B*6
      *
      ***  If Option 1 allowed, default Option for Actual Allocation 2 is '1' (Cash % is already
      ***  100).
     C           MDOPT1    IFEQ 'Y'                        B*7
     C                     MOVE ' 1'      SS2IN
     C                     ELSE                            X*7
      *
      ***  If Option 1 not allowed and Option 5 allowed, default Option for Actual Allocation 2 is
      ***  '5' and set Cash % to Cash Preferred % from Standard Instruction (SECOSIL1).
     C           MDOPT5    IFEQ 'Y'                        B*8
     C                     MOVE ' 5'      SS2IN
     C                     Z-ADDMOCAPP    WCAPR
     C                     ELSE                            X*8
      *
      ***  If Option 1 and 5 not allowed, set Cash % to 0.
     C                     Z-ADD0         WCAPR
     C                     ENDIF                           E*8
     C                     ENDIF                           E*7
     C                     ENDIF                           E*6
     C                     ENDIF                           E*5
     C                     ELSE                            X*4
      *
      ***  If Processing Type = Offers.
     C           MAPTYP    IFEQ 'OF'                       B*5
      *
      ***  If % Accepted is < 50.
     C           WCAPR     IFLT 50                         B*6
      *
      ***  If Option 3 is not allowed, default as per % Accepted is 0.
     C           MIOPT3    IFNE 'Y'                        B*7
     C                     Z-ADD0         WCAPR
     C                     ELSE                            X*7
      *
      ***  If Option 3 is allowed and % Accepted is not 0, default Option for Actual Allocation 2 is
      ***  '3' (% Accepted already = Cash Preferred % from Standard Instruction (SECOSIL1)).
     C           WCAPR     IFNE 0                          B*8
     C                     MOVE ' 2'      SS2IN
     C                     ENDIF                           E*8
     C                     ENDIF                           E*7
     C                     ELSE                            X*6
      *
      ***  If % Accepted is > 50.
     C           WCAPR     IFGT 50                         B*7
      *
      ***  If Option 3 is not allowed (and % Accepted is > 50), default as per % Accepted is 100.
     C           MIOPT3    IFNE 'Y'                        B*8
     C                     Z-ADD100       WCAPR
     C                     ELSE                            X*8
      *
      ***  If Option 3 is allowed and % Accepted is not 100, default Option for Actual Allocation 2
      ***  is '3' (% Accepted already = Cash Preferred % from Standard Instruction (SECOSIL1)).
     C           WCAPR     IFNE 100                        B*9
     C                     MOVE ' 3'      SS2IN
     C                     ENDIF                           E*9
     C                     ENDIF                           E*8
     C                     ENDIF                           E*7
     C                     ENDIF                           E*6
      *
      ***  If % Accepted is 0 (means it is refused).
     C           WCAPR     IFEQ 0                          B*6
      *
      ***  If Option 2 allowed, default Option for Actual Allocation 2 is '2' (% Accepted is
      ***  already 0).
     C           MIOPT2    IFEQ 'Y'                        B*7
     C                     MOVE ' 2'      SS2IN
     C                     ELSE                            X*7
      *
      ***  If Option 2 is not allowed and Option 3 is allowed, default Option for Actual Allocation
      ***  2 is '3' and set % Accepted to Cash Preferred % from Standard Instruction (SECOSIL1).
     C           MIOPT3    IFEQ 'Y'                        B*8
     C                     MOVE ' 3'      SS2IN
     C                     Z-ADDMOCAPP    WCAPR
     C                     ELSE                            X*8
      *
      ***  If Option 2 and 3 are not allowed and Option 1 is allowed, default Option for Actual
      ***   Allocation 2 is '1' and set % Accepted to 100.
     C           MIOPT1    IFEQ 'Y'                        B*9
     C                     MOVE ' 1'      SS2IN
     C                     Z-ADD100       WCAPR
     C                     ELSE                            X*9
      *
      ***  If Option 2, 3 and 1 are not allowed, default Option for Actual Allocation 2 is blank.
     C                     MOVE '   '     SS2IN
     C                     ENDIF                           E*9
     C                     ENDIF                           E*8
     C                     ENDIF                           E*7
     C                     ELSE                            X*6
      *
      ***  If % Accepted is 100 (means it is Cash Preferred).
     C           WCAPR     IFEQ 100                        B*7
      *
      ***  If Option 1 is allowed, default Option for Actual Allocation 2 is '1' (% Accepted is
      ***  already 100).
     C           MIOPT1    IFEQ 'Y'                        B*8
     C                     MOVE ' 1'      SS2IN
     C                     ELSE                            X*8
      *
      ***  If Option 1 is not allowed and Option 3 is allowed, default Option for Actual Allocation
      ***  2 is '3' and set % Accepted to Cash Preferred % from Standard Instruction (SECOSIL1).
     C           MIOPT3    IFEQ 'Y'                        B*9
     C                     MOVE ' 3'      SS2IN
     C                     Z-ADDMOCAPP    WCAPR
     C                     ELSE                            X*9
      *
      ***  If Option 1 and 3 are not allowed and Option 2 is allowed, default Option for Actual
      ***  Allocation 2 is '2' and set % Accepted to 0.
     C           MIOPT2    IFEQ 'Y'                        B*10
     C                     MOVE ' 2'      SS2IN
     C                     Z-ADD0         WCAPR
     C                     ELSE                            X*10
      *
      ***  If Option 1, 3 and 2 are not allowed, default Option for Actual Allocation is blank.
     C                     MOVE '  '      SS2IN
     C                     ENDIF                           E*10
     C                     ENDIF                           E*9
     C                     ENDIF                           E*8
     C                     ENDIF                           E*7
     C                     ENDIF                           E*6
     C                     ELSE                            X*5
      *
      ***  If Processing Type = Rights Issues or Exercices and Conversions.
     C           MAPTYP    IFEQ 'RG'                       B*6
     C           MAPTYP    OREQ 'EX'
      *
      ***  If Cash % is < 50.
     C           WCAPR     IFLT 50                         B*7
      *
      ***  If Option 5 and 6 are not allowed, default as per Cash % is 0.
     C           MFOPT5    IFNE 'Y'                        B*8
     C           MFOPT6    ANDNE'Y'
     C           MAPTYP    ANDEQ'RG'
     C           MJOPT5    ORNE 'Y'
     C           MJOPT6    ANDNE'Y'
     C           MAPTYP    ANDEQ'EX'
     C                     Z-ADD0         WCAPR
     C                     ENDIF                           E*8
      *
      ***  If Option 5 and 6 are allowed and Cash % is not 0.
     C           MFOPT5    IFEQ 'Y'                        B*8
     C           MFOPT6    ANDEQ'Y'
     C           WCAPR     ANDNE0
     C           MAPTYP    ANDEQ'RG'
     C           MJOPT5    OREQ 'Y'
     C           MJOPT6    ANDEQ'Y'
     C           WCAPR     ANDNE0
     C           MAPTYP    ANDEQ'EX'
      *
      ***  If Convertible/Keep Indicator from Standard Instruction (SECOSIL1) is 'C', default
      ***  Option for Actual Allocation 2 is '5' (Cash % already = Cash Preferred % from Standard
      ***  Instruction (SECOSIL1)).
     C           MOCKIN    IFEQ 'C'                        B*9
     C                     MOVE ' 5'      SS2IN
     C                     ENDIF                           E*9
      *
      ***  If Convertible/Keep Indicator from Standard Instruction (SECOSIL1) is 'K', default
      ***  Option for Actual Allocation 2 is '6' (Cash % already = Cash Preferred % from Standard
      ***  Instruction (SECOSIL1)).
     C           MOCKIN    IFEQ 'K'                        B*9
     C                     MOVE ' 6'      SS2IN
     C                     ENDIF                           E*9
     C                     ENDIF                           E*8
     C                     ELSE                            X*7
      *
      ***  If Cash % is > 50.
     C           WCAPR     IFGT 50                         B*8
      *
      ***  If Option 5 and 6 are not allowed, default as per Cash % is 100.
     C           MFOPT5    IFNE 'Y'                        B*9
     C           MFOPT6    ANDNE'Y'
     C           MAPTYP    ANDEQ'RG'
     C           MJOPT5    ORNE 'Y'
     C           MJOPT6    ANDNE'Y'
     C           MAPTYP    ANDEQ'EX'
     C                     Z-ADD100       WCAPR
     C                     ENDIF                           E*9
      *
      ***  If Option 5 and 6 are allowed and Cash % is not 0.
     C           MFOPT5    IFEQ 'Y'                        B*9
     C           MFOPT6    ANDEQ'Y'
     C           WCAPR     ANDNE100
     C           MAPTYP    ANDEQ'RG'
     C           MJOPT5    OREQ 'Y'
     C           MJOPT6    ANDEQ'Y'
     C           WCAPR     ANDNE100
     C           MAPTYP    ANDEQ'EX'
      *
      ***  If Convertible/Keep Indicator from Standard Instruction (SECOSIL1) is 'C', default
      ***  Option for Actual Allocation 2 is '5' (Cash % already = Cash Preferred % from Standard
      ***  Instruction (SECOSIL1)).
     C           MOCKIN    IFEQ 'C'                        B*10
     C                     MOVE ' 5'      SS2IN
     C                     ENDIF                           E*10
      *
      ***  If Convertible/Keep Indicator from Standard Instruction (SECOSIL1) is 'K', default
      ***  Option for Actual Allocation 2 is '6' (Cash % already = Cash Preferred % from Standard
      ***  Instruction (SECOSIL1)).
     C           MOCKIN    IFEQ 'K'                        B*10
     C                     MOVE ' 6'      SS2IN
     C                     ENDIF                           E*10
     C                     ENDIF                           E*9
     C                     ENDIF                           E*8
     C                     ENDIF                           E*7
      *
      ***  If Cash % is 0 (means it is Stock Preferred).
     C           WCAPR     IFEQ 0                          B*7
      *
      ***  If Convertible/Keep Indicator from Standard Instruction (SECOSIL1) is 'K'
     C           MOCKIN    IFEQ 'K'                        B*8
      *
      ***  If Option 7 is allowed, default Option for Actual Allocation is '7' (Cash % already
      ***  = 0).
     C           MFOPT7    IFEQ 'Y'                        B*9
     C           MAPTYP    ANDEQ'RG'
     C           MJOPT7    OREQ 'Y'
     C           MAPTYP    ANDEQ'EX'
     C                     MOVE ' 7'      SS2IN
     C                     ENDIF                           E*9
     C                     ENDIF                           E*8
      *
      ***  If Convertible/Keep Indicator from Standard Instruction (SECOSIL1) is 'C'
     C           MOCKIN    IFEQ 'C'                        B*8
      *
      ***  If Rounding Option from Standard Instruction (SECOSIL1) is 'U'.
     C           MOROOP    IFEQ 'U'                        B*9
      *
      ***  If Rounding Option from Standard Instruction (SECOSIL1) is 'U' and Option 2 is allowed,
      ***  default Option for Actual Allocation 2 is '2' (Cash % already = 0).
     C           MFOPT2    IFEQ 'Y'                        B*10
     C           MAPTYP    ANDEQ'RG'
     C           MJOPT2    OREQ 'Y'
     C           MAPTYP    ANDEQ'EX'
     C                     MOVE ' 2'      SS2IN
     C                     ELSE                            X*10
      *
      ***  If Rounding Option from Standard Instruction (SECOSIL1) is 'U' and Option 2 is not
      ***  allowed and Option 4 is allowed, default Option for Actual Allocation 2 is '4'
      ***  (Cash % already = 0).
     C           MFOPT4    IFEQ 'Y'                        B*11
     C           MAPTYP    ANDEQ'RG'
     C           MJOPT4    OREQ 'Y'
     C           MAPTYP    ANDEQ'EX'
     C                     MOVE ' 4'      SS2IN
     C                     ELSE                            X*11
      *
      ***  If Rounding Option from Standard Instruction (SECOSIL1) is 'U' and Options 2 and 4 are
      ***  not allowed and Option 3 is allowed, default Option for Actual Allocation 2 is '3'
      ***  (Cash % already = 0).
     C           MFOPT3    IFEQ 'Y'                        B*12
     C           MAPTYP    ANDEQ'RG'
     C           MJOPT3    OREQ 'Y'
     C           MAPTYP    ANDEQ'EX'
     C                     MOVE ' 3'      SS2IN
     C                     ELSE                            X*12
      *
      ***  If Rounding Option from Standard Instruction (SECOSIL1) is 'U' and Options 2, 4 and 3 are
      ***  not allowed and Option 5 is allowed, default Option for Actual Allocation 2 is '5' and
      ***  set Cash % to Cash Preferred % from Standard Instruction (SECOSIL1).
     C           MFOPT5    IFEQ 'Y'                        B*13
     C           MAPTYP    ANDEQ'RG'
     C           MJOPT5    OREQ 'Y'
     C           MAPTYP    ANDEQ'EX'
     C                     MOVE ' 5'      SS2IN
     C                     Z-ADDMOCAPP    WCAPR
     C                     ELSE                            X*13
      *
      ***  If Rounding Option from Standard Instruction (SECOSIL1) is 'U' and Options 2, 4, 3 and 5
      ***  are not allowed and Option 1 is allowed, default Option for Actual Allocation 2 is '1'
      ***  and set Cash % to 100.
     C           MFOPT1    IFEQ 'Y'                        B*14
     C           MAPTYP    ANDEQ'RG'
     C           MJOPT1    OREQ 'Y'
     C           MAPTYP    ANDEQ'EX'
     C                     MOVE ' 1'      SS2IN
     C                     Z-ADD100       WCAPR
     C                     ELSE                            X*14
      *
      ***  If Rounding Option from Standard Instruction (SECOSIL1) is 'U' and Options 2, 4, 3, 5
      ***  and 1 are not allowed, default Option for Actual Allocation 2 is blank.
     C                     MOVE '  '      SS2IN
     C                     ENDIF                           E*14
     C                     ENDIF                           E*13
     C                     ENDIF                           E*12
     C                     ENDIF                           E*11
     C                     ENDIF                           E*10
     C                     ENDIF                           E*9
      *
      ***  If Rounding Option from Standard Instruction (SECOSIL1) is 'D'.
     C           MOROOP    IFEQ 'D'                        B*9
      *
      ***  If Rounding Option from Standard Instruction (SECOSIL1) is 'D' and Option 3 is allowed,
      ***  default Option for Actual Allocation 2 is '3' (Cash % already = 0).
     C           MFOPT3    IFEQ 'Y'                        B*10
     C           MAPTYP    ANDEQ'RG'
     C           MJOPT3    OREQ 'Y'
     C           MAPTYP    ANDEQ'EX'
     C                     MOVE ' 3'      SS2IN
     C                     ELSE                            X*10
      *
      ***  If Rounding Option from Standard Instruction (SECOSIL1) is 'D' and Option 3 is not
      ***  allowed and Option 4 is allowed, default Option for Actual Allocation is '4' (Cash %
      ***  already = 0).
     C           MFOPT4    IFEQ 'Y'                        B*11
     C           MAPTYP    ANDEQ'RG'
     C           MJOPT4    OREQ 'Y'
     C           MAPTYP    ANDEQ'EX'
     C                     MOVE ' 4'      SS2IN
     C                     ELSE                            X*11
      *
      ***  If Rounding Option from Standard Instruction (SECOSIL1) is 'D' and Options 3 and 4 are
      ***  not allowed and Option 2 is allowed, default Option for Actual Allocation is '2' (Cash %
      ***  already = 0).
     C           MFOPT2    IFEQ 'Y'                        B*12
     C           MAPTYP    ANDEQ'RG'
     C           MJOPT2    OREQ 'Y'
     C           MAPTYP    ANDEQ'EX'
     C                     MOVE ' 2'      SS2IN
     C                     ELSE                            X*12
      *
      ***  If Rounding Option from Standard Instruction (SECOSIL1) is 'D' and Options 3, 4 and 2 are
      ***  not allowed and Option 5 is allowed, default Option for Actual Allocation is '5' and set
      ***  Cash % to Cash Preferred % from Standard Instruction (SECOSIL1).
     C           MFOPT5    IFEQ 'Y'                        B*13
     C           MAPTYP    ANDEQ'RG'
     C           MJOPT5    OREQ 'Y'
     C           MAPTYP    ANDEQ'EX'
     C                     MOVE ' 5'      SS2IN
     C                     Z-ADDMOCAPP    WCAPR
     C                     ELSE                            X*13
      *
      ***  If Rounding Option from Standard Instruction (SECOSIL1) is 'D' and Options 3, 4, 2 and 5
      ***  are not allowed and Option 1 is allowed, default Option for Actual Allocation is '1' and
      ***  set Cash % to 100.
     C           MFOPT1    IFEQ 'Y'                        B*14
     C           MAPTYP    ANDEQ'RG'
     C           MJOPT1    OREQ 'Y'
     C           MAPTYP    ANDEQ'EX'
     C                     MOVE ' 1'      SS2IN
     C                     Z-ADD100       WCAPR
     C                     ELSE                            X*14
      *
      ***  If Rounding Option from Standard Instruction (SECOSIL1) is 'D' and Options 3, 4, 2, 5 and
      ***  1 are not allowed, default Option for Actual Allocation is blank.
     C                     MOVE '  '      SS2IN
     C                     ENDIF                           E*14
     C                     ENDIF                           E*13
     C                     ENDIF                           E*12
     C                     ENDIF                           E*11
     C                     ENDIF                           E*10
     C                     ENDIF                           E*9
     C                     ENDIF                           E*8
     C                     ELSE                            X*7
      *
      ***  If Cash % is 100 (means it is Cash Preferred).
     C           WCAPR     IFEQ 100                        B*8
      *
      ***  If Option 1 is allowed, default Option for Actual Allocation 2 is '1' (Cash % already
      ***  = 100).
     C           MFOPT1    IFEQ 'Y'                        B*9
     C           MAPTYP    ANDEQ'RG'
     C           MJOPT1    OREQ 'Y'
     C           MAPTYP    ANDEQ'EX'
     C                     MOVE ' 1'      SS2IN
     C                     ELSE                            X*9
      *
      ***  If Option 1 is not allowed, default as per Cash % is 0.
     C                     Z-ADD0         WCAPR
     C                     ENDIF                           E*9
     C                     ENDIF                           E*8
     C                     ENDIF                           E*7
     C                     ENDIF                           E*6
     C                     ENDIF                           E*5
     C                     ENDIF                           E*4
     C                     ENDIF                           E*3
      *
      ***  CASE 2.2: IF Customer/Book Standard Corporate Action Instruction does not exist
      ***               (and Customer/Book Current Reply does not exist),
      ***            OR if Customer/Book Standard Corporate Action Instruction exist BUT default
      ***               Option (Option for Actual Allocation 2 calculated in CASE 2.1 or retrieve
      ***               from Standard Instruction (SECOSIL1) in CASE 2) is blank (and Customer/Book
      ***               Current Reply does not exist).
     C*****      EXBCSI    IFEQ 'N'                        B*3            155622
     C*****      EXBCSI    OREQ 'Y'                                       155622
     C*****      SS2IN     ANDEQ'  '                                      155622
      *****                                                               155622
     C*****                SELEC                           B*4            155622
     C*****      @PTYP     WHEQ 'DV'                                      155622
     C*****                MOVE MDDFNR    SS2IN     P                     155622
      *****                                                               155622
     C*****      @PTYP     WHEQ 'RG'                                      155622
     C*****                MOVE MFDFNR    SS2IN     P                     155622
      *****                                                               155622
     C*****      @PTYP     WHEQ 'OF'                                      155622
     C*****                MOVE MIDFNR    SS2IN     P                     155622
      *****                                                               155622
     C*****      @PTYP     WHEQ 'EX'                                      155622
     C*****                MOVE MJDFNR    SS2IN     P                     155622
     C*****                ENDSL                           E*4            155622
      *****                                                               155622
     C*****                ENDIF                           E*3            155622
     C*****                ENDIF                           E*2            155622
     C                     ENDIF                           E*1
      *
     C                     ENDSR
      *****************************************************************
      /EJECT
      *****************************************************************
      *                                                               *
      *            *PSSR  - Program error handling routine            *
      *                                                               *
      * CALLS     DBERRCTL- DB error                                  *
      *                                                               *
      * CALLED BY  SRINIT - Initial Processing                        *
      *            SRCLSF - Clear Subfile                             *
      *            SRPROC - Process read records                      *
      *                                                               *
      * FLDS USED         -                                           *
      *                                                               *
      *****************************************************************
     C           *PSSR     BEGSR
      *
      ** Print Dump and Cancel Program
     C                     MOVE 'E'       @RTCD
     C                     DUMP
      *
     C                     MOVE '1'       *INU7
     C                     MOVE '1'       *INU8
     C                     MOVE '1'       *INLR
     C                     CALL 'DBERRCTL'
     C                     RETRN
      *
     C                     ENDSR
      *****************************************************************
      /EJECT
      *****************************************************************
      *                                                               *
      *            ZASNMS - Send message to program's message queue   *
      *                                                               *
      * CALLS      Y2SNMGC- Send a message                            *
      *                                                               *
      * CALLED BY  SRVIEW - View subfile from Review from fields      *
      *            SRERR  - Action code not equal to A/E/H/V          *
      *                                                               *
      * FLDS USED         -                                           *
      *                                                               *
      *****************************************************************
     C           ZASNMS    BEGSR
      *
      **  Message file specified use PMSGF
     C                     MOVELPMSGF     ZAMSGF
     C                     CALL 'Y2SNMGC'
     C                     PARM           ZAPGM  10        Program queue
     C                     PARM           ZAPGRL  5        Rel queue
     C                     PARM           ZAMSID  7        Message Id.
     C                     PARM           ZAMSGF 10        Message file.
     C                     PARM           ZAMSDA132        Message data.
     C                     PARM           ZAMSTP  7        Message type.
      *
      **  Clear all fields for default mechanism next time.
     C                     MOVEL*BLANK    ZAPGM            Program queue
     C                     MOVEL*BLANK    ZAPGRL           Rel queue
     C                     MOVEL*BLANK    ZAMSDA           Message data.
     C                     MOVEL*BLANK    ZAMSTP           Message type.
     C                     MOVEL*BLANK    ZAMSGF           Message file
     C                     MOVEL*BLANK    ZAMSID           Message id.
      *
     C                     ENDSR
      ********************************************************************
      /EJECT
      *****************************************************************   161732
      *                                                               *   161732
      *  SRCONV - Convert signed alpha field to packed numeric field  *   161732
      *                                                               *   161732
      *  Calls:                                                       *   161732
      *  ZALIGN - Validate/right align numeric fields                 *   161732
      *                                                               *   161732
      *  Called by:                                                   *   161732
      *  SRBLD1 - Build subfile for the records "Books"               *   161732
      *  SRBLD2 - Build subfile for the records "Cust/Ptfr"           *   161732
      *  SRBLDS - Build subfile                                       *   161732
      *                                                               *   161732
      *****************************************************************   161732
     C           SRCONV    BEGSR                                          161732
      *                                                                   161732
     C                     MOVE *BLANKS   ZFIELD                          161732
     C                     MOVE *BLANKS   WSTR17                          161732
     C                     MOVEAEXP2,X    WSTR17                          161732
     C                     MOVEAEXP2,X    WSIGN   1                       161732
     C           WSIGN     IFEQ '-'                                       161732
     C           16        SUBSTWSTR17:1  ZFIELD                          161732
     C                     ELSE                                           161732
     C                     MOVE *BLANK    WSIGN                           161732
     C                     MOVE WSTR17    ZFIELD                          161732
     C                     ENDIF                                          161732
     C                     Z-ADDNMDP      ZADEC                           161732
     C           15        SUB  ZADEC     ZADIG                           161732
     C                     EXSR ZALIGN                                    161732
     C           *IN99     IFEQ *ON                                       161732
     C                     Z-ADD*ZERO     WNUM15 150                      161732
     C                     ELSE                                           161732
     C                     MOVE ZFIELD    WNUM15                          161732
     C                     ENDIF                                          161732
     C           WSIGN     IFEQ '-'                                       161732
     C           0         SUB  WNUM15    WNUM15                          161732
     C                     ENDIF                                          161732
     C                     MOVEAWZERO     EXP2,X                          161732
     C                     ADD  MCEXPO    WNUM15                          161732
     C                     SELEC                                          161732
     C           WNUM15    WHEQ *ZERO                                     161732
     C                     MOVEAWZERO     EXP2,X                          161732
     C           WNUM15    WHLT *ZERO                                     161732
     C                     MOVE *BLANKS   ZFLD15                          161732
     C                     MOVE WNUM15    ZFLD15                          161732
     C                     Z-ADD*ZERO     ZDECS                           161732
     C                     EXSR ZSEDIT                                    161732
     C                     MOVE ZOUT21    WSTR17                          161732
     C                     MOVEAWSTR17    EXP2,X                          161732
     C           WNUM15    WHGT *ZERO                                     161732
     C                     MOVE *BLANKS   ZFLD15                          161732
     C                     MOVE WNUM15    ZFLD15                          161732
     C                     Z-ADD*ZERO     ZDECS                           161732
     C                     EXSR ZSEDIT                                    161732
     C           17        SUBSTZOUT21:4  WSTR17                          161732
     C                     MOVEAWSTR17    EXP2,X                          161732
     C                     ENDSL                                          161732
      *                                                                   161732
     C                     ENDSR                                          161732
      ********************************************************************161732
      /EJECT                                                              161732
     C/COPY ZSRSRC,ZDATE2Z4
      /EJECT
     C/COPY ZSRSRC,ZSEDITZ3
      /EJECT
     C/COPY ZSRSRC,ZALIGNZ2
      /EJECT
     C/COPY ZSRSRC,ZEDITZ2
**  CPY@
(c) Finastra International Limited 2001
**  NARR
ERROR CALLING PGM 'SE7515'
ERROR CALLING PGM 'SE7541'
ERROR CALLING PGM 'SE7540'
**   ZYDY - YEARS IN DAYS CUMULATIVE, FOUR YEAR SPAN
0366073110961461
**   ZMDY - MONTHS IN DAYS CUMULATIVE THROUGH YEAR
000031059090120151181212243273304334365
**   ZMNM - MONTHS SHORT NAMES
JANFEBMARAPRMAYJUNJULAUGSEPOCTNOVDEC
