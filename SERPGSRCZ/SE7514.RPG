000100200529     H        1
000200200529      *****************************************************************
000300200529/*OVRF*: OVRDBF FILE(SECTYZ1) TOFILE(SECTY) SHARE(*NO)              : *
000400200529/*STD *  RPGBASE                                                      *
000500200529/*EXI *  TEXT('Midas SE Corporate action reply handling selection')
000600200529      *****************************************************************
000700200529      *                                                               *
000800200529      *  Midas - Securities Trading Module                            *
000900200529      *                                                               *
001000200529      *  SE7514 - Corporate Actions Reply Handling Selection          *
001100200529      *                                                               *
001200200529      *  Function:  This program maintains the Corporate Action       *
001300200529      *  (I/C)      Reply Handling Selection.                         *
001400200529      *                                                               *
001500200529      *  Called By: SE7502 - Corporate Actions Reference Maintenance  *
001600200529      *                                                               *
001700200529      *  (c) Finastra International Limited 2001                      *
001800200529      *                                                               *
002000200619      *  LAST Amend No. MD046248           Date 27Oct17               *
002100200529      * Bank Fusion Midas 1.4 Base -----------------------------------*
002200200529      * Midas Plus 1.4 Base 04 ---------------------------------------*
002300200529      * Midas Plus 1.4 Base ------------------------------------------*
002400200529      * Midas Plus 1.3 ----------- Base ------------------------------*
002500200619      *  Prev Amend No. CSD031             Date 10Apr06               *
002600200529      *                 CPK024             Date 12Apr06               *
002700200529      *                 CSD027             Date 09Dec05               *
002800200529      *                 CSE071             Date 19Jul05               *
002900200529      *                 CSW037A            Date 02May05               *
003000200529      *                 223182             Date 30Jan04               *
003100200529      *                 CSD025             Date 11Jan05               *
003200200529      *                 CSW037             Date 15Dec04               *
003300200529      *                 CSW036             Date 15Dec04               *
003400200529      *                 CLE025             Date 20Oct03               *
003500200529      * Midas Release 4 --------------- Base -------------------------*
003600200529      *                 190204             Date 31May01               *
003700200529      * Midas DBA 3.03 -----------------------------------------------*
003800200529      *                 CSE020             Date 21Mar00               *
003900200529      *                 161732             Date 21Mar00               *
004000200529      *                 179197             Date 18May00               *
004100200529      * Midas DBA 3.02 -----------------------------------------------*
004200200529      *                 CPB001             Date 26Aug99               *
004300200529      * Midas DBA 3.00 ---------------- Base -------------------------*
004400200529      *                 CAC005             Date 04Dec98               *
004500200529      *                 155622             Date 22Feb99               *
004600200529      *                 137877             Date 30Jun98               *
004700200529      *                 CSE007  *CREATE    Date 01Dec97               *
004800200529      *                                                               *
004900200529      *---------------------------------------------------------------*
005000200529      *                                                               *
005300200529      *  MD046248 - Finastra Rebranding                               *
005400200529      *  CSD031 - Enhanced Centralised Static Data (Recompile)        *
005500200529      *  CPK024 - Packaging of MPlus 1.2.1. Copy sources needed by    *
005600200529      *           UTC0012.                                            *
005700200529      *  CSD027 - Conversion Of Customer Number to Alpha              *
005800200529      *  CSE071 - Multiple Holidays Re Securities (recompile)         *
005900200529      *  CSW037A- Additional Field extended to 40 chars (recompile)   *
006000200529      *  223182 - Error on Corporate Action.                          *
006100200529      *         - Ignore DBERR for closed customers. Applied 223539.  *
006200200529      *  CSD025 - Customer De-Activation                              *
006300200529      *  CSW037 - Additional Field Data on MT300/MT320                *
006400200529      *  CSW036 - Dual SWIFT BIC held on Client Details               *
006500200529      *  CLE025 - Credit Lines (Recompile)                            *
006600200529      *  190204 - Recompiled due to changes in PF/SECODVPD.           *
006700200529      *  CSE020 - Corporate Actions Domino Effect Processing          *
006800200529      *  161732 - Corporate Actions Exercise and Conversion -         *
006900200529      *           Part Stock/Keep Rest Calculation.                   *
007000200529      *           Also, change to: Build and retain the whole subfile *
007100200529      *  179197 - Correction of Message IDs                           *
007200200529      *  CPB001 - 'Private Banking' Module                            *
007300200529      *  CAC005 - PCA-SE Enhancement.                                 *
007400200529      *  155622 - Corporate Actions: Fields Standard Instructions     *
007500200529      *           Level 1 and 2 must be setup ONLY if record found    *
007600200529      *           in Standard Corporate Actions Instructions File.    *
007700200529      *  137877 - Corporate Actions: Reply Handling amendments.       *
007800200529      *  CSE007 - Corporate Actions                                   *
007900200529      *                                                               *
008000200529      *****************************************************************
008100200529      *
008200200529      ** SE Security Details
008300200529     FSECTYZ1 IF  E           K        DISK         KINFSR *PSSR
008400200529      *                                                                   CSE020
008500200529      ** SE Corporate Actions - References Upd Idx                        CSE020
008600200529     FSECORFL9IF  E           K        DISK                               CSE020
008700200529     F            SECORFD0                          KRENAMESECORFX0       CSE020
008800200529     F                                              KINFSR *PSSR          CSE020
008900200529      *
009000200529      **  MA - SE CORPORATE ACTIONS References
009100200529     FSECORFL1IF  E           K        DISK         KINFSR *PSSR
009200200529      *
009300200529      **  MD - SE Corporate Actions - Dividends Events
009400200529     FSECODVL1IF  E           K        DISK         KINFSR *PSSR
009500200529      *
009600200529      **  MF - SE Corporate Actions - Right Issues
009700200529     FSECORGL1IF  E           K        DISK         KINFSR *PSSR
009800200529      *
009900200529      **  MI - SE Corporate Actions - Exchange Offers
010000200529     FSECOOFL1IF  E           K        DISK         KINFSR *PSSR
010100200529      *
010200200529      **  MJ - SE Corporate Actions - Exercise & Conversion
010300200529     FSECOEXL1IF  E           K        DISK
010400200529     F                                              KINFSR *PSSR
010500200529      *
010600200529      **  MC - SE Corporate Actions - Allocations Rtv Idx
010700200529     FSECOALL2IF  E           K        DISK         KINFSR *PSSR
010800200529      *                                                                   137877
010900200529      **   MC - SE CORPORATE ACTIONS Allocation - Rtv Idx                 137877
011000200529     FSECOALL1IF  E           K        DISK                               137877
011100200529     F            SECOALD0                          KRENAMESECOALDU       137877
011200200529     F                                              KINFSR *PSSR          137877
011300200529      *                                                                   CSE020
011400200529      ** SE Corporate Actions - Stock Allocations                         CSE020
011500200529     FSECOALL5IF  E           K        DISK                               CSE020
011600200529     F            SECOALD0                          KRENAMESECOALD5       CSE020
011700200529     F                                              KINFSR *PSSR          CSE020
011800200529      *
011900200529      **  SE Corporate Actions - Customer Positions
012000200529     FSECOUPL0IF  E           K        DISK         KINFSR *PSSR
012100200529      *
012200200529      **  SE Corporate Actions - User Positions
012300200529     FSECOCPL0IF  E           K        DISK         KINFSR *PSSR
012400200529      *
012500200529      **  MQ - SE Corporate Actions - Reply Handling
012600200529     FSECOREL1IF  E           K        DISK         KINFSR *PSSR
012700200529      *
012800200529      **  MQ - SE Corporate Actions - Instructions
012900200529     FSECOSIL1IF  E           K        DISK         KINFSR *PSSR
013000200529      *
013100200529      **  MQ - SE Corporate Actions - Instructions
013200200529     FSECOSIL2IF  E           K        DISK         KINFSR *PSSR
013300200529     F            SECOSID0                          KRENAMESECOSID2
013400200529      *
013500200529      **  Display file
013600200529     FSE7514DFCF  E                    WORKSTN      KINFSR *PSSR
013700200529     F                                              KINFDS SCRDS
013800200529     F                                        #1RRN KSFILE SE7514S1
013900200529      *****************************************************************
014000200529      /EJECT
014100200529      *****************************************************************
014200200529      *                                                               *
014300200529      *                  FUNCTION OF INDICATORS                       *
014400200529      *                  ----------------------                       *
014500200529      *                                                               *
014600200529      *       20         Error in Branch                              *
014700200529      *       21         Error in Book                                *
014800200529      *       22         Error in Customer                            *
014900200529      *       23         Error in Portfolio                           *
015000200529      ********27*        Roll up key                                  *   161732
015100200529      *       30         Subfile End Indicator (SFLEND)               *
015200200529      *       31-33      Record not found                             *
015300200529      *       46         Any valid key                                *
015400200529      *       57         Protect Selection field                      *
015500200529      *       58         No display of Branch, Customer/Book,         *
015600200529      *                  Portfolio, Current Reply, Standard Instruc., *
015700200529      *                  & Default No Reply                           *
015800200529      *       59         No display of Depot & Position on Ex-Date    *
015900200529      *       62         Error in Selection field                     *
016000200529      *  63 - Error in Profit Centre.                                 *   CAC005
016100200529      *  70 - CAC005 is on, display profit centre in display file.    *   CAC005
016200200529      *       75         Record not found.                            *
016300200529      *       80-89      Standard RTS subroutines                     *
016400200529      *       90-99      Standard MIDAS subroutines                   *
016500200529      *       KC         Exit program                                 *
016600200529      *       KE         Refresh screen                               *
016700200529      *       KL         Previous screen                              *
016800200529      *       LR         End program.                                 *
016900200529      *       U7+U8      Database error occurs                        *
017000200529      *                                                               *
017100200529      *****************************************************************
017200200529      *                                                               *
017300200529      *  S U B R O U T I N E   I N D E X                              *
017400200529      *                                                               *
017500200529      *  SRINIT - Initial Processing                                  *
017600200529      *  SRALOC - Main Processing                                     *
017700200529      *  SRENDP - End Processing                                      *
017800200529      *  SRCLSF - Clear Subfile                                       *
017900200529      *  SRBLDS - Build Subfile                                       *
018000200529      *  SRPROC - Process read records                                *
018100200529      *  SRVALD - Validate action code                                *
018200200529      *  SRVIEW - View subfile from Review from fields                *
018300200529      *  SRVAC  - Validate action code
018400200529      *  SRSAVP - Save previous values of the subfile record          *
018500200529      *  SRRESP - Restore previous values of the subfile record       *
018600200529      *  *PSSR - Program error handling routine                       *
018700200529      *  ZASNMS - Send message to program's message queue             *
018800200529      *                                                               *
018900200529      *****************************************************************
019000200529      /EJECT
019100200529      ********************************************************************
019200200529      *
019300200529      **  Array for Copyright
019400200529     E                    CPY@    1   1 80
019500200529      *
019600200529     E                    NARR    1   3 27               Narrative
019700200529      *
019800200529      ** Temporary storage for *IN57 - *IN59
019900200529     E                    IND         3  1
020000200529      *
020100200529     E/COPY ZSRSRC,ZDATE2Z1
020200200529      *
020300200529     E/COPY ZSRSRC,ZALIGNZ1
020400200529      *
020500200529     E/COPY ZSRSRC,ZSEDITZ1
020600200529      *                                                                   161732
020700200529      ** Run-time array (loaded in C-Specs) that stores                   161732
020800200529      ** Branch-Customer/Book-Portfolio          (Argument Array)         161732
020900200529      *                                                                   161732
021000200529     E                    EXP1     9999 17                                161732
021100200529      *                                                                   161732
021200200529      ** Run-time array (loaded in C-Specs) for the total Ex-date         161732
021300200529      ** position (stored as character)          (Function Array)         161732
021400200529      *                                                                   161732
021500200529     E                    EXP2     9999 17                                161732
021600200529      ********************************************************************
021700200529      /EJECT
021800200529      ********************************************************************
021900200529     ISECORFX0                                                            CSE020
022000200529      ** Rename fields of SECORFL9: Midas SE CA Reference File            CSE020
022100200529      *                                                                   CSE020
022200200529     I              MARECI                          MNRECI                CSE020
022300200529     I              MALCD                           MNLCD                 CSE020
022400200529     I              MACHTP                          MNCHTP                CSE020
022500200529     I              MALUID                          MNLUID                CSE020
022600200529     I              MACORF                          MNCORF                CSE020
022700200529     I              MAJOBN                          MNJOBN                CSE020
022800200529     I              MAUSER                          MNUSER                CSE020
022900200529     I              MAJNBR                          MNJNBR                CSE020
023000200529     I              MASESN                          MNSESN                CSE020
023100200529     I              MACOAT                          MNCOAT                CSE020
023200200529     I              MAPTYP                          MNPTYP                CSE020
023300200529     I              MACOAN                          MNCOAN                CSE020
023400200529     I              MACOEX                          MNCOEX                CSE020
023500200529     I              MAALEF                          MNALEF                CSE020
023600200529     I              MANBOP                          MNNBOP                CSE020
023700200529     I              MATDVD                          MNTDVD                CSE020
023800200529     I              MACOPD                          MNCOPD                CSE020
023900200529     I              MATDDT                          MNTDDT                CSE020
024000200529     I              MAEVDT                          MNEVDT                CSE020
024100200529     I              MACPNB                          MNCPNB                CSE020
024200200529     I              MASHMD                          MNSHMD                CSE020
024300200529     I              MALTBS                          MNLTBS                CSE020
024400200529     I              MAOCPV                          MNOCPV                CSE020
024500200529     I              MANCPV                          MNNCPV                CSE020
024600200529     I              MAONML                          MNONML                CSE020
024700200529     I              MANNML                          MNNNML                CSE020
024800200529     I              MACUPC                          MNCUPC                CSE020
024900200529     I              MAEXPC                          MNEXPC                CSE020
025000200529     I              MACLRD                          MNCLRD                CSE020
025100200529     I              MACLRT                          MNCLRT                CSE020
025200200529     I              MADLRD                          MNDLRD                CSE020
025300200529     I              MADLRT                          MNDLRT                CSE020
025400200529     I              MABLOS                          MNBLOS                CSE020
025500200529     I              MABLOP                          MNBLOP                CSE020
025600200529     I              MABFRD                          MNBFRD                CSE020
025700200529     I              MABEND                          MNBEND                CSE020
025800200529     I              MAREFO                          MNREFO                CSE020
025900200529     I              MACONR                          MNCONR                CSE020
026000200529     I              MADFNR                          MNDFNR                CSE020
026100200529     I              MADFCP                          MNDFCP                CSE020
026200200529     I              MADFSP                          MNDFSP                CSE020
026300200529     I              MALREQ                          MNLREQ                CSE020
026400200529     I              MALPRO                          MNLPRO                CSE020
026500200529     I              MALTSI                          MNLTSI                CSE020
026600200529     I              MASTAT                          MNSTAT                CSE020
026700200529     I              MAPREF                          MNPREF                CSE020
026800200529     ISECOALD5                                                            CSE020
026900200529      ** Rename fields of SECOALL5: Midas SE CA Stock Allocations File    CSE020
027000200529      *                                                                   CSE020
027100200529     I              MCRECI                          M5RECI                CSE020
027200200529     I              MCLCD                           M5LCD                 CSE020
027300200529     I              MCCHTP                          M5CHTP                CSE020
027400200529     I              MCLUID                          M5LUID                CSE020
027500200529     I              MCCORF                          M5CORF                CSE020
027600200529     I              MCOPTN                          M5OPTN                CSE020
027700200529     I              MCBRCD                          M5BRCD                CSE020
027800200529     I              MCDDPT                          M5DDPT                CSE020
027900200529     I              MCCOTP                          M5COTP                CSE020
028000200529     I              MCBOOK                          M5BOOK                CSE020
028100200529     I              MCCNUM                          M5CNUM                CSE020
028200200529     I              MCPTFR                          M5PTFR                CSE020
028300200529     I              MCEXPO                          M5EXPO                CSE020
028400200529     I              MCSESN                          M5SESN                CSE020
028500200529     I              MCOALR                          M5OALR                CSE020
028600200529     I              MCOTSA                          M5OTSA                CSE020
028700200529     I              MCOSTR                          M5OSTR                CSE020
028800200529     I              MCOCAR                          M5OCAR                CSE020
028900200529     I              MCCAOP                          M5CAOP                CSE020
029000200529     I              MCASTA                          M5ASTA                CSE020
029100200529     I              MCHOST                          M5HOST                CSE020
029200200529     I              MCHOCA                          M5HOCA                CSE020
029300200529     I              MCACAA                          M5ACAA                CSE020
029400200529     I              MCASTR                          M5ASTR                CSE020
029500200529     I              MCACAR                          M5ACAR                CSE020
029600200529     I              MCOPT1                          M5OPT1                CSE020
029700200529     I              MCOPT2                          M5OPT2                CSE020
029800200529     I              MCREST                          M5REST                CSE020
029900200529     I              MCBSEC                          M5BSEC                CSE020
030000200529     I              MCBEDT                          M5BEDT                CSE020
030100200529     I              MCBSTT                          M5BSTT                CSE020
030200200529     I              MCBLTY                          M5BLTY                CSE020
030300200529     I              MCBEWI                          M5BEWI                CSE020
030400200529     I              MCCOAT                          M5COAT                CSE020
030500200529     I              MCTRRF                          M5TRRF                CSE020
030600200529     I              MCTRR2                          M5TRR2                CSE020
030700200529     I              MCTRR3                          M5TRR3                CSE020
030800200529     I              MCRVRF                          M5RVRF                CSE020
030900200529     I              MCRVR2                          M5RVR2                CSE020
031000200529     I              MCRVR3                          M5RVR3                CSE020
031100200529     I              MCTNL1                          M5TNL1                CSE020
031200200529     I              MCLTRQ                          M5LTRQ                CSE020
031300200529     I              MCTOTF                          M5TOTF                CSE020
031400200529     I              MCTOTT                          M5TOTT                CSE020
031500200529     IUDEPPDF
031600200529     I              UDBA                            MCBRCD
031700200529     I              UDSN                            MCSESN
031800200529     I              UDPT                            MCDDPT
031900200529     I              UDBK                            MCBOOK
032000200529     ICDEPPDF
032100200529     I              CDPA                            MCBRCD
032200200529     I              CDCN                            MCCNUM
032300200529     I              CDSN                            MCSESN
032400200529     I              CDPT                            MCDDPT
032500200529     I              PTFR                            MCPTFR
032600200529      *
032700200529      **  Program Data Structure
032800200529     IPGMDS     ESDSY2PGDSP
032900200529      *
033000200529     ISCRDS       DS
033100200529     I                                    B 378 3790CPFPOS
033200200529      *
033300200529      **   LOCAL DATA AREA
033400200529     ILDA       E DSLDA                         256
033500200529      *
033600200529      **  Local data area for database error details
033700200529      **  *LOCK IN LDA immediately before and OUT LDA immediately
033800200529      **  after each database error handling.
033900200529      **
034000200529      **                                    134 141 DBFILE
034100200529      **       Defines:                     142 170 DBKEY
034200200529      **                                    171 180 DBPGM
034300200529      **                                    181 1830DBASE
034400200529      *
034500200529      **  Bank Details
034600200529     ISDBANK    E DSSDBANKPD
034700200529     I*
034800200529     ISDCUST    E DSSDCUSTPD
034900200529     I** Customer Details
035000200529     I*
035100200529     ISDPORT    E DSSDPORTPD
035200200529     I**  Data structure for portfolio management details
035300200529     I*
035400200529     ISDSTRD    E DSSDSTRDPD
035500200529     I**  Data structure for securities trading details
035600200529     I*
035700200529     ISDMMOD    E DSSDMMODPD
035800200529     I**  Data structure for module details
035900200529      *
036000200529      **  Second DS for Access Programs, Long Data Structure
036100200529     IDSSDY     E DSDSSDY
036200200529      *
036300200529      *                                                                                       223182
036400200529      ** DS for access objects - long data structure                                          223182
036500200529      *                                                                                       223182
036600200529     IDSLDY     E DSDSLDY                                                                     223182
036700200529      *                                                                                       223182
036800200529     ISESTAT    E DSSESTAT
036900200529      *
037000200529     I/COPY ZSRSRC,ZSEDITZ2
037100200529     E***COPY*ZSRSRC,ZEDIT1*                                                                  CPK024
037200200529      *                                                                   161732
037300200529      ** Data Structure for Branch-Customer/Book-Portfolio combination    161732
037400200529      *                                                                   161732
037500200529     I                                        1  17 WBCBP                 161732
037600200529     I                                        1   3 WBRCH                 161732
037700200529     I                                        4  13 WCUBK                 161732
037800200529     I                                       14  17 WPORT                 161732
037900200529      *                                                                   161732
038000200529      ** Constant for 17 zeros                                            161732
038100200529      *                                                                   161732
038200200529     I              '                0'   C         WZERO                 161732
038300200529      ********************************************************************
038400200529      /EJECT
038500200529      ********************************************************************
038600200529      *                                                               *
038700200529      *            MAIN   - Start Mainline                            *
038800200529      *                                                               *
038900200529      * CALLS      SRINIT - Initial Processing                        *
039000200529      *            SRALOC - Main Processing                           *
039100200529      *            SRENDP   End Processing                            *
039200200529      *                                                               *
039300200529      * CALLED BY         -                                           *
039400200529      *                                                               *
039500200529      * FLDS USED         -                                           *
039600200529      *                                                               *
039700200529      *****************************************************************
039800200529      *
039900200529      **  Input Parameter List
040000200529      *
040100200529     C           *ENTRY    PLIST
040200200529     C                     PARM           @CORF   6        Reference
040300200529     C                     PARM           @SESN  10        Security Short.
040400200529     C                     PARM           @COAT   2        Corporate Type
040500200529     C                     PARM           @STAT   1        Status
040600200529     C                     PARM           @PTYP   2        Processing Type
040700200529     C                     PARM           @COEX   5        Ex-Date
040800200529     C                     PARM           @NMCY   3        Nominal Currency
040900200529     C                     PARM           @RTCD   1        Return Code
041000200529      *
041100200529      **  Initial Processing
041200200529     C                     EXSR SRINIT
041300200529      *
041400200529      **  Main Processing
041500200529     C           WWUDCD    IFEQ 'Y'
041600200529     C                     EXSR SRNOAL
041700200529     C                     ELSE
041800200529     C                     EXSR SRALOC
041900200529     C                     ENDIF
042000200529      *
042100200529      **  End Processing
042200200529     C                     EXSR SRENDP
042300200529      *****************************************************************
042400200529      /EJECT
042500200529      *****************************************************************
042600200529      *                                                               *
042700200529      *            SRINIT - Initial Processing                        *
042800200529      *                                                               *
042900200529      * CALLS      *PSSR  - Program error handling routine            *
043000200529      *                                                               *
043100200529      * CALLED BY  MAIN   - Main Routine.                             *
043200200529      *                                                               *
043300200529      * FLDS USED         -                                           *
043400200529      *                                                               *
043500200529      *****************************************************************
043600200529     C           SRINIT    BEGSR
043700200529      *
043800200529      **  Copyright Statement
043900200529     C                     MOVEACPY@      MKI@   80
044000200529      *
044100200529      **   Reset LDA
044200200529     C           *NAMVAR   DEFN           LDA
044300200529     C           *NAMVAR   DEFN           SESTAT
044400200529      *
044500200529      ***  Access data area SESTAT: Midas SE Status to check if Portfolio Manage
044600200529      ***  licensed.
044700200529     C                     IN   SESTAT
044800200529      *
044900200529     C           PFPL      IFEQ 'Y'
045000200529     C                     MOVE '1'       *IN55
045100200529     C                     ENDIF
045200200529      *
045300200529      **  Initialise Key and Working Fields
045400200529      *
045500200529     C                     Z-ADD*ZERO     #1RRN   40                      161732
045600200529      *                                                                   161732
045700200529      ** Search keys for LF/SECOALL2.
045800200529     C           KEY1      KLIST
045900200529     C                     KFLD           WCORF   6        Reference
046000200529     C                     KFLD           WOPNB   20       Option Number
046100200529      *
046200200529     C           KEY2      KLIST
046300200529     C                     KFLD           WCORF   6        Reference
046400200529     C                     KFLD           WOPNB   20       Option Number
046500200529     C                     KFLD           WBRCD   3        Branch Code
046600200529     C                     KFLD           WCOTP   1        Customer/Book Ind
046700200529     C                     KFLD           WBOOK   2        Book
046800200529     C**********           KFLD           WCNUM   60       Branch Code                        CSD027
046900200529     C                     KFLD           WCNUM   6        Branch Code                        CSD027
047000200529     C                     KFLD           WPTFR   4        Portfolio
047100200529     C**********           KFLD           WDDPT   60       Depot                              CSD027
047200200529     C                     KFLD           WDDPT   6        Depot                              CSD027
047300200529     C                     KFLD           WSESN  10        Security Shortname
047400200529      *
047500200529      ** Search keys for LF/SECOREL1.
047600200529     C           KEY3      KLIST
047700200529     C                     KFLD           WCORF   6        Reference
047800200529     C                     KFLD           WBRCD   3        Branch code
047900200529     C                     KFLD           WCOTP   1        Customer/Book Ind
048000200529     C                     KFLD           WBOOK   2        Book
048100200529     C**********           KFLD           WCNUM   60       Customer                           CSD027
048200200529     C                     KFLD           WCNUM   6        Customer                           CSD027
048300200529      *
048400200529      ** Search keys for LF/SECOSIL2.
048500200529     C           KEY4      KLIST
048600200529     C                     KFLD           WBRCD   3        Branch Code
048700200529     C                     KFLD           WBOOK   2        Book
048800200529     C                     KFLD           WCOAT   2        Corporate Type
048900200529     C                     KFLD           WSESN  10        Security Short.
049000200529      *
049100200529      ** Search keys for LF/SECOSIL1.
049200200529     C           KEY5      KLIST
049300200529     C                     KFLD           WBRCD   3        Branch Code
049400200529     C**********           KFLD           WCNUM   60       Customer                           CSD027
049500200529     C                     KFLD           WCNUM   6        Customer                           CSD027
049600200529     C                     KFLD           WPTFR   4        Portfolio
049700200529     C                     KFLD           WCOAT   2        Corporate Type
049800200529     C                     KFLD           WSESN  10        Security Short.
049900200529      *
050000200529     C           KEY11     KLIST
050100200529     C                     KFLD           KUDSN  10
050200200529     C                     KFLD           KUDBA   3
050300200529     C                     KFLD           KUDBK   2
050400200529     C**********           KFLD           KUDPT   60                                          CSD027
050500200529     C                     KFLD           KUDPT   6                                           CSD027
050600200529     C                     KFLD           KUDMK   1
050700200529     C                     KFLD           KEXDT   50
050800200529      *
050900200529     C           KEY11A    KLIST
051000200529     C                     KFLD           KUDSN  10
051100200529     C                     KFLD           KUDBA   3
051200200529     C                     KFLD           KUDBK   2
051300200529      *
051400200529     C           KEY12     KLIST
051500200529     C                     KFLD           KUDSN  10
051600200529     C                     KFLD           KUDBA   3
051700200529     C**********           KFLD           KCDCN   60                                          CSD027
051800200529     C                     KFLD           KCDCN   6                                           CSD027
051900200529     C                     KFLD           KPTFR   4
052000200529     C**********           KFLD           KUDPT   60                                          CSD027
052100200529     C                     KFLD           KUDPT   6                                           CSD027
052200200529     C                     KFLD           KUDMK   1
052300200529     C                     KFLD           KEXDT   50
052400200529      *
052500200529     C           KEY12A    KLIST
052600200529     C                     KFLD           KUDSN  10
052700200529     C                     KFLD           KUDBA   3
052800200529     C**********           KFLD           KCDCN   60                                          CSD027
052900200529     C                     KFLD           KCDCN   6                                           CSD027
053000200529     C                     KFLD           KPTFR   4
053100200529      *
053200200529     C           KEY13     KLIST
053300200529     C                     KFLD           KUDSN  10
053400200529     C                     KFLD           KUDBA   3
053500200529      *                                                                   CSE020
053600200529     C           KEY14     KLIST                                          CSE020
053700200529     C                     KFLD           MAPREF                          CSE020
053800200529     C                     KFLD           KUDBA                           CSE020
053900200529     C                     KFLD           KUDPT                           CSE020
054000200529     C                     KFLD           WKCOTP  1                       CSE020
054100200529     C                     KFLD           WKBOOK  2                       CSE020
054200200529     C**********           KFLD           WKCNUM  60                                   CSE020 CSD027
054300200529     C                     KFLD           WKCNUM  6                                           CSD027
054400200529     C                     KFLD           WKPTFR  4                       CSE020
054500200529     C                     KFLD           KUDSN                           CSE020
054600200529      *
054700200529     C                     MOVE @CORF     WCORF
054800200529     C           *LOCK     IN   LDA                                       CSE020
054900200529     C                     MOVEL'SE7514'  DBPGM
055000200529     C                     OUT  LDA                                       CSE020
055100200529      *
055200200529      **  Setup Screen Time
055300200529     C                     TIME           ##TME   60       Screen time.
055400200529      *
055500200529      **  Access Bank Details
055600200529     C                     CALL 'AOBANKR0'
055700200529     C                     PARM *BLANKS   WLRTCD  7
055800200529     C                     PARM '*FIRST'  WLOPTN  7
055900200529     C           SDBANK    PARM SDBANK    DSSDY
056000200529      *
056100200529      **  If record not found
056200200529     C           WLRTCD    IFNE *BLANKS                    B*1
056300200529     C           *LOCK     IN   LDA
056400200529     C                     Z-ADD001       DBASE            ****************
056500200529     C                     MOVE 'SDBANKPD'DBFILE           * DB ERROR 001 *
056600200529     C                     MOVEL*BLANKS   DBKEY            ****************
056700200529     C                     OUT  LDA
056800200529     C                     EXSR *PSSR
056900200529     C                     ENDIF                           E*1
057000200529      *
057100200529     C                     MOVE BJMRDT    ##MRDT           Midas Run Date
057200200529      *
057300200529      **  Determine Date Format
057400200529     C           BJDFIN    IFEQ 'M'                        B*1
057500200529     C                     MOVE '1'       *IN98
057600200529     C                     ENDIF                           E*1
057700200529      *
057800200529      **  Access SE ICD Details
057900200529     C                     CALL 'AOSTRDR0'
058000200529     C                     PARM *BLANKS   WLRTCD  7
058100200529     C                     PARM '*FIRST'  WLOPTN  7
058200200529     C           SDSTRD    PARM SDSTRD    DSSDY
058300200529      *
058400200529      **  If record not found
058500200529     C           WLRTCD    IFNE *BLANKS                    B*1
058600200529     C           *LOCK     IN   LDA
058700200529     C                     Z-ADD002       DBASE            ****************
058800200529     C                     MOVE 'SDSTRDPD'DBFILE           * DB ERROR 002 *
058900200529     C                     MOVEL*BLANKS   DBKEY            ****************
059000200529     C                     OUT  LDA
059100200529     C                     EXSR *PSSR
059200200529     C                     ENDIF                           E*1
059300200529      *                                                                   CAC005
059400200529      ***  Check if CAC005 - PCA-SE Enhancement is on.                    CAC005
059500200529      *                                                                   CAC005
059600200529     C                     MOVE 'N'       CAC005  1                       CAC005
059700200529     C                     MOVE *OFF      *IN70                           CAC005
059800200529     C                     CALL 'AOSARDR0'                                CAC005
059900200529     C                     PARM *BLANKS   WLRTCD                          CAC005
060000200529     C                     PARM '*VERIFY' @OPTN   7                       CAC005
060100200529     C                     PARM 'CAC005'  @SARD   6                       CAC005
060200200529      *                                                                   CAC005
060300200529     C           WLRTCD    IFEQ *BLANK                                    CAC005
060400200529     C                     MOVE *ON       *IN70                           CAC005
060500200529     C                     MOVE 'Y'       CAC005                          CAC005
060600200529     C                     ENDIF                                          CAC005
060700200529      *
060800200529      **  Access to modules details file to retrieve the 'Portfolio
060900200529      **  Management indicator'
061000200529     C                     CALL 'AOMMODR0'
061100200529     C                     PARM *BLANKS   WLRTCD
061200200529     C                     PARM '*FIRST'  WLOPTN
061300200529     C           SDMMOD    PARM SDMMOD    DSSDY
061400200529      *
061500200529      **  If record not found
061600200529     C           WLRTCD    IFNE *BLANKS
061700200529     C           *LOCK     IN   LDA
061800200529     C                     MOVEL'003'     DBASE            ***************
061900200529     C                     MOVE 'SDMMODPD'DBFILE           * DB ERROR 03 *
062000200529     C                     MOVEL*BLANKS   DBKEY            ***************
062100200529     C                     OUT  LDA
062200200529     C                     EXSR *PSSR
062300200529     C                     END                             E*1
062400200529      *
062500200529      **  If 'Portfolio Management' present
062600200529     C           BGPFMG    IFEQ 'Y'                        B*1
062700200529     C           BGN4ST    OREQ 'Y'                                       CPB001
062800200529      *
062900200529      **  Setup the portfolio management indicator
063000200529     C                     MOVE '1'       *IN56
063100200529      *
063200200529      **  Access to Portfolio Management File to retrieve the reference
063300200529      **  attached to "9997"
063400200529     C           BGPFMG    IFEQ 'Y'                                       CPB001
063500200529     C                     CALL 'AOPORTR0'
063600200529     C                     PARM *BLANKS   WLRTCD
063700200529     C                     PARM '*FIRST'  WLOPTN
063800200529     C           SDPORT    PARM SDPORT    DSSDY
063900200529      *
064000200529      **  If record not found
064100200529     C           WLRTCD    IFNE *BLANKS
064200200529     C                     MOVEL'004'     DBASE            ***************
064300200529     C                     MOVE 'SDPORTPD'DBFILE           * DB ERROR 04 *
064400200529     C                     MOVEL*BLANKS   DBKEY            ***************
064500200529     C                     EXSR *PSSR
064600200529     C                     END                             E*2
064700200529     C                     ENDIF                                          CPB001
064800200529     C                     END                             E*1
064900200529      *
065000200529     C                     MOVE *BLANKS   SBRCD            Review from: Branch
065100200529     C                     MOVE *BLANKS   SBOOK            Book
065200200529     C                     MOVE *BLANKS   SPRFC            Profit centre  CAC005
065300200529     C                     MOVE *BLANKS   SCNUM            Customer
065400200529     C                     MOVE *BLANKS   SPTFR            Portfolio
065500200529      *
065600200529     C                     MOVE @CORF     SCORF            Reference
065700200529     C                     MOVE @SESN     SSESN            Security Short.
065800200529     C                     MOVE @COAT     SCOAT            Corporate Type
065900200529      *
066000200529     C           @COEX     IFNE *BLANKS
066100200529     C           @COEX     ANDNE'00000'
066200200529     C                     MOVE @COEX     ZDAYNO
066300200529     C                     EXSR ZDATE2
066400200529     C                     MOVE ZDATE     SEXDT            Ex-Date
066500200529     C                     ELSE
066600200529     C                     MOVE *BLANKS   SEXDT            Ex-Date
066700200529     C                     ENDIF
066800200529      *
066900200529      **  Retrieve Nominal Currency of the Event Security
067000200529     C           @SESN     CHAINSECTYZ1              89
067100200529      *
067200200529      **  If record not found
067300200529     C           *IN89     IFEQ '1'                        B*1
067400200529     C           *LOCK     IN   LDA
067500200529     C                     Z-ADD005       DBASE            ****************
067600200529     C                     MOVE 'SECTYD'  DBFILE           * DB ERROR 005 *
067700200529     C                     MOVELMCSESN    DBKEY            ****************
067800200529     C                     OUT  LDA
067900200529     C                     EXSR *PSSR
068000200529     C                     ENDIF                           E*1
068100200529      *
068200200529     C                     MOVE NMCY      SNMCY
068300200529     C                     Z-ADDNMDP      SNMDP   10
068400200529     C                     MOVEL'SEUSRMSG'PMSGF  10
068500200529      *
068600200529      **  Fill in Fields for Subroutine ZASNMS
068700200529     C                     MOVEL'SE7514'  ZAPGM  10        Message queue
068800200529     C                     MOVEL'SEUSRMSG'ZAMSGF 10        Message file
068900200529     C                     MOVEL*BLANK    ZAPGRL  5        Rel queue
069000200529     C                     MOVEL*BLANK    ZAMSID  7        Message Id.
069100200529     C                     MOVEL*BLANK    ZAMSDA132        Message data.
069200200529     C                     MOVEL*BLANK    ZAMSTP  7        Message type.
069300200529      *
069400200529      **  Clear Messages from Program Message Queue.
069500200529     C                     CALL 'Y2CLMSC'
069600200529     C                     PARM ##PGM     ZAPGM  10
069700200529     C                     PARM '*SAME'   ZAPGRL  5
069800200529      *
069900200529     C                     WRITESE7514C2
070000200529      *
070100200529      ** Retrieve the Default No Reply (Level 1)
070200200529     C           @CORF     CHAINSECORFL1             89
070300200529      *
070400200529      **  If record not found
070500200529     C           *IN89     IFEQ '1'                        B*1
070600200529     C           *LOCK     IN   LDA
070700200529     C                     Z-ADD006       DBASE            ****************
070800200529     C                     MOVE 'SECORFL1'DBFILE           * DB ERROR 006 *
070900200529     C                     MOVEL@CORF     DBKEY            ****************
071000200529     C                     OUT  LDA
071100200529     C                     EXSR *PSSR
071200200529     C                     ELSE                            X*1
071300200529     C           MADFNR    IFNE *BLANKS                    B*2
071400200529     C                     MOVE MADFNR    SD1NR     P
071500200529     C                     ELSE                            X*2
071600200529     C           MANBOP    IFEQ 1                          B*3
071700200529     C                     MOVE ' 1'      SD1NR
071800200529     C                     ENDIF                           E*3
071900200529     C                     ENDIF                           E*2
072000200529     C                     ENDIF                           E*1
072100200529      *                                                                   CSE020
072200200529      ** If CA is a child, obtain the Security from the Originating CA    CSE020
072300200529      *                                                                   CSE020
072400200529     C           MAPREF    IFNE *BLANKS                                   CSE020
072500200529     C           MAPREF    CHAINSECORFL9             71                   CSE020
072600200529      *                                                                   CSE020
072700200529     C           *IN71     IFEQ *ON                                       CSE020
072800200529     C           *LOCK     IN   LDA                                       CSE020
072900200529     C                     Z-ADD012       DBASE            ***************CSE020
073000200529     C                     MOVEL'SECORFL9'DBFILE           * DB ERROR 012*CSE020
073100200529     C                     MOVELMAPREF    DBKEY            ***************CSE020
073200200529     C                     OUT  LDA                                       CSE020
073300200529     C                     EXSR *PSSR                                     CSE020
073400200529     C                     ENDIF                                          CSE020
073500200529      *                                                                   CSE020
073600200529      ** Loop to obtain the Security from the originating CA.             CSE020
073700200529      *                                                                   CSE020
073800200529     C           MNPREF    DOWNE*BLANKS                                   CSE020
073900200529     C           MNPREF    CHAINSECORFL9             71                   CSE020
074000200529     C           *IN71     IFEQ *ON                                       CSE020
074100200529     C           *LOCK     IN   LDA                                       CSE020
074200200529     C                     Z-ADD013       DBASE            ***************CSE020
074300200529     C                     MOVEL'SECORFL9'DBFILE           * DB ERROR 013*CSE020
074400200529     C                     MOVELMNPREF    DBKEY            ***************CSE020
074500200529     C                     OUT  LDA                                       CSE020
074600200529     C                     EXSR *PSSR                                     CSE020
074700200529     C                     ENDIF                                          CSE020
074800200529     C                     ENDDO                                          CSE020
074900200529     C                     MOVE MNSESN    WOSESN 10                       CSE020
075000200529      *                                                                   CSE020
075100200529     C                     ENDIF                                          CSE020
075200200529      *
075300200529      ** Retrieve the Default No Reply (Level 2)
075400200529     C                     MOVE '  '      SD2NR
075500200529      *
075600200529     C           @PTYP     IFEQ 'DV'                       B*1
075700200529     C           @PTYP     OREQ 'RG'
075800200529     C           @PTYP     OREQ 'OF'
075900200529     C           @PTYP     OREQ 'EX'
076000200529     C                     MOVE SD1NR     WOPNB
076100200529      *
076200200529     C           SD1NR     IFEQ '  '                       B*2
076300200529     C                     MOVE '1'       WOPNB
076400200529     C                     ENDIF                           E*2
076500200529      *
076600200529     C                     SELEC
076700200529      *
076800200529     C           @PTYP     WHEQ 'DV'                       B*2
076900200529     C           KEY1      CHAINSECODVL1             89
077000200529     C                     MOVE 'SECODVPD'DBFILE
077100200529      *
077200200529     C           @PTYP     WHEQ 'RG'                       B*2
077300200529     C           KEY1      CHAINSECORGL1             89
077400200529     C                     MOVE 'SECORGPD'DBFILE
077500200529      *
077600200529     C           @PTYP     WHEQ 'OF'                       B*2
077700200529     C           KEY1      CHAINSECOOFL1             89
077800200529     C                     MOVE 'SECOOFPD'DBFILE
077900200529      *
078000200529     C           @PTYP     WHEQ 'EX'                       B*2
078100200529     C           KEY1      CHAINSECOEXL1             8989
078200200529     C                     MOVE 'SECOEXPD'DBFILE
078300200529      *
078400200529     C                     ENDSL
078500200529      *
078600200529      **  If no record found
078700200529     C           *IN89     IFEQ '1'                        B*3
078800200529     C           *LOCK     IN   LDA
078900200529     C                     Z-ADD007       DBASE
079000200529     C                     MOVELWCORF     DBKEY
079100200529     C                     OUT  LDA
079200200529     C                     EXSR *PSSR
079300200529      *
079400200529     C                     ELSE                            X*3
079500200529      *
079600200529     C                     SELEC
079700200529      *
079800200529     C           @PTYP     WHEQ 'DV'                       B*2
079900200529     C                     MOVE MDDFNR    SD2NR     P
080000200529      *
080100200529     C           @PTYP     WHEQ 'RG'                       B*2
080200200529     C                     MOVE MFDFNR    SD2NR     P
080300200529      *
080400200529     C           @PTYP     WHEQ 'OF'                       B*2
080500200529     C                     MOVE MIDFNR    SD2NR     P
080600200529      *
080700200529     C           @PTYP     WHEQ 'EX'                       B*2
080800200529     C                     MOVE MJDFNR    SD2NR     P
080900200529      *
081000200529     C                     ENDSL                           E*3
081100200529      *
081200200529     C                     ENDIF                           E*2
081300200529      *
081400200529     C                     ELSE                            X*1
081500200529      *
081600200529     C                     MOVE SD1NR     WOPNB
081700200529      *
081800200529     C           SD1NR     IFEQ '  '                       B*2
081900200529     C                     MOVE '1'       WOPNB
082000200529     C                     ENDIF                           E*2
082100200529     C                     ENDIF                           E*1
082200200529      *
082300200529      ** Position file cursor
082400200529     C                     MOVE *LOVAL    WBRCD
082500200529     C                     MOVE *LOVAL    WCOTP
082600200529     C                     MOVE *LOVAL    WBOOK
082700200529     C***********          MOVE *LOVAL    WCNUM                                               CSD027
082800200529     C                     MOVE *BLANKS   WCNUM                                               CSD027
082900200529     C                     MOVE *LOVAL    WPTFR
083000200529     C                     MOVE *LOVAL    WDDPT
083100200529     C                     MOVE *LOVAL    WSESN
083200200529      *
083300200529     C           KEY2      SETLLSECOALL2
083400200529      *
083500200529      ** Read next record to retrieve first record for same Reference
083600200529      ** and Option Number
083700200529     C           KEY1      READESECOALL2                 32
083800200529      *
083900200529     C                     MOVE 'N'       WWUDCD  1
084000200529     C           *IN32     IFEQ '1'
084100200529     C                     MOVE 'Y'       WWUDCD
084200200529     C                     ENDIF
084300200529      *
084400200529     C                     ENDSR
084500200529      *****************************************************************
084600200529      /EJECT
084700200529      *****************************************************************
084800200529      *                                                               *
084900200529      *            SRALOC - Main Processing                           *
085000200529      *                                                               *
085100200529      * CALLS      SRCLSF - Clear Subfile                             *
085200200529      *            SRBLDS - Build Subfile                             *
085300200529      *            SRVALD - Validate action code                      *
085400200529      *                                                               *
085500200529      * CALLED BY  MAIN   - Main Routine.                             *
085600200529      *                                                               *
085700200529      * FLDS USED         -                                           *
085800200529      *                                                               *
085900200529      *****************************************************************
086000200529     C           SRALOC    BEGSR
086100200529      *
086200200529      ** Clear Subfile
086300200529     C                     EXSR SRCLSF
086400200529      *
086500200529      **  Do while F3, F12 not pressed
086600200529      *
086700200529     C           *INKC     DOWEQ'0'                        B*1
086800200529     C           *INKL     ANDEQ'0'
086900200529      *
087000200529     C           *IN39     IFEQ '1'
087100200529     C           *IN32     OREQ '1'
087200200529     C                     Z-ADD1         #1RRN
087300200529     C                     WRITESE7514S1
087400200529     C                     MOVE '1'       *IN80
087500200529     C                     MOVE '1'       *IN30
087600200529     C                     MOVE '0'       *IN39
087700200529     C                     MOVEL'CO00001' ZAMSID
087800200529     C                     EXSR ZASNMS
087900200529     C                     MOVE 'Y'       ERROR   1
088000200529     C                     ELSE
088100200529     C           ERROR     IFNE 'Y'
088200200529     C                     EXSR SRBLDS
088300200529     C                     ELSE
088400200529     C           #1RRN     IFEQ *ZEROS
088500200529     C           WWCPT     ANDNE*ZEROS
088600200529     C                     Z-ADDCPFPOS    #1RRN
088700200529     C                     ENDIF
088800200529     C                     ENDIF
088900200529     C                     ENDIF
089000200529      *
089100200529     C                     WRITESE7514C2
089200200529     C                     WRITESE7514F1
089300200529     C                     EXFMTSE7514C1
089400200529      *
089500200529      **  Clear Messages from Program Message Queue.
089600200529     C                     CALL 'Y2CLMSC'
089700200529     C                     PARM ##PGM     ZAPGM  10
089800200529     C                     PARM '*SAME'   ZAPGRL  5
089900200529     C                     WRITESE7514C2
090000200529      *
090100200529     C                     MOVEA'0000'    *IN,20
090200200529     C                     MOVE '0'       *IN62
090300200529     C                     MOVE '0'       *IN63                           CAC005
090400200529      *
090500200529     C************IN27     IFEQ '1'                        B*2            161732
090600200529     C***********SBRCD     IFNE *BLANKS                    B*3            161732
090700200529     C***********SBOOK     ORNE *BLANKS                                   161732
090800200529     C***********SPRFC     ORNE *BLANKS                            CAC005 161732
090900200529     C***********SCNUM     ORNE *BLANKS                                   161732
091000200529     C***********SPTFR     ORNE *BLANKS                                   161732
091100200529     C***********          MOVE '0'       *IN27                           161732
091200200529     C***********          MOVE '0'       *IN46                           161732
091300200529     C***********          ELSE                            X*3            161732
091400200529     C***********          MOVE 'N'       ERROR                           161732
091500200529     C***********          Z-ADD0         WWCPT                           161732
091600200529     C***********          ENDIF                           E*3            161732
091700200529     C***********          ENDIF                           E*2            161732
091800200529      *
091900200529      ** If no function key is pressed,
092000200529      **   Validate all Subfile records
092100200529      *
092200200529     C           *IN46     IFEQ '0'                        B*2
092300200529     C                     EXSR SRVALD
092400200529     C                     ENDIF                           E*2
092500200529      *
092600200529      **  If F5 is pressed, refresh screen
092700200529     C           *INKE     IFEQ '1'                        B*2
092800200529     C                     EXSR SRCLSF
092900200529      *
093000200529      ** Position file cursor
093100200529     C                     MOVE *LOVAL    WBRCD
093200200529     C                     MOVE *LOVAL    WCOTP
093300200529     C                     MOVE *LOVAL    WBOOK
093400200529     C***********          MOVE *LOVAL    WCNUM                                               CSD027
093500200529     C                     MOVE *BLANKS   WCNUM                                               CSD027
093600200529     C                     MOVE *LOVAL    WPTFR
093700200529     C                     MOVE *LOVAL    WDDPT
093800200529     C                     MOVE *LOVAL    WSESN
093900200529      *
094000200529     C           KEY2      SETLLSECOALL2
094100200529      *
094200200529      ** Read next record to retrieve first record for same Reference
094300200529      ** and Option Number
094400200529     C           KEY1      READESECOALL2                 32
094500200529     C                     ENDIF                           E*2
094600200529      *
094700200529     C                     ENDDO                           E*1
094800200529      *
094900200529     C                     ENDSR
095000200529      *****************************************************************
095100200529      /EJECT
095200200529      *****************************************************************
095300200529      *                                                               *
095400200529      *            SRNOAL - Main Processing                           *
095500200529      *                                                               *
095600200529      * CALLS      SRCLSF - Clear Subfile                             *
095700200529      *            SRBLDS - Build Subfile                             *
095800200529      *            SRVALD - Validate action code                      *
095900200529      *                                                               *
096000200529      * CALLED BY  MAIN   - Main Routine.                             *
096100200529      *                                                               *
096200200529      * FLDS USED         -                                           *
096300200529      *                                                               *
096400200529      *****************************************************************
096500200529     C           SRNOAL    BEGSR
096600200529      *
096700200529      ** Clear Subfile
096800200529     C                     EXSR SRCLSF
096900200529      *
097000200529     C                     EXSR SRRFRS
097100200529      *
097200200529      **  Do while F3, F12 not pressed
097300200529      *
097400200529     C           *INKC     DOWEQ'0'                        B*1
097500200529     C           *INKL     ANDEQ'0'
097600200529      *
097700200529     C           #1RRN     IFEQ *ZEROS
097800200529     C           WWCPT     ANDNE*ZEROS
097900200529     C                     Z-ADDCPFPOS    #1RRN
098000200529     C                     ENDIF
098100200529      *
098200200529     C                     WRITESE7514C2
098300200529     C                     WRITESE7514F1
098400200529     C                     EXFMTSE7514C1
098500200529      *
098600200529      **  Clear Messages from Program Message Queue.
098700200529     C                     CALL 'Y2CLMSC'
098800200529     C                     PARM ##PGM     ZAPGM  10
098900200529     C                     PARM '*SAME'   ZAPGRL  5
099000200529     C                     WRITESE7514C2
099100200529      *
099200200529     C                     MOVEA'0000'    *IN,20
099300200529     C                     MOVE '0'       *IN62
099400200529     C                     MOVE '0'       *IN63                           CAC005
099500200529      *
099600200529     C************IN27     IFEQ '1'                        B*2            161732
099700200529     C***********SBRCD     IFNE *BLANKS                    B*3            161732
099800200529     C***********SBOOK     ORNE *BLANKS                                   161732
099900200529     C***********SPRFC     ORNE *BLANKS                            CAC005 161732
100000200529     C***********SCNUM     ORNE *BLANKS                                   161732
100100200529     C***********SPTFR     ORNE *BLANKS                                   161732
100200200529     C***********          MOVE '0'       *IN27                           161732
100300200529     C***********          MOVE '0'       *IN46                           161732
100400200529     C***********          ELSE                            X*3            161732
100500200529     C***********          Z-ADD0         WWCPT                           161732
100600200529      ***********                                                         161732
100700200529     C************IN45     IFEQ '1'                        B*4            161732
100800200529     C***********          EXSR SRRESP                                    161732
100900200529     C***********MCDDPT    IFNE WWDPT                      B*5            161732
101000200529     C***********          Z-ADDMCDDPT    WWDPT                           161732
101100200529     C***********          ADD  1         #1RRN                           161732
101200200529     C***********          ADD  1         WWCPT                           161732
101300200529     C***********          WRITESE7514S1                                  161732
101400200529     C***********          ENDIF                           E*5            161732
101500200529     C***********          ENDIF                           E*4            161732
101600200529      ***********                                                         161732
101700200529     C***********          EXSR SRPROC                                    161732
101800200529      ***********                                                         161732
101900200529     C***********MCBOOK    IFNE *BLANKS                    B*4            161732
102000200529     C***********          EXSR SRBLD1                                    161732
102100200529     C***********          ELSE                            X*4            161732
102200200529     C***********          EXSR SRBLD2                                    161732
102300200529     C***********          ENDIF                           E*4            161732
102400200529      ***********                                                         161732
102500200529     C***********WWCPT     IFEQ 0                          B*4            161732
102600200529     C***********          Z-ADD1         #1RRN                           161732
102700200529     C***********          MOVE #1RRN     W1RRN   40                      161732
102800200529     C***********          WRITESE7514S1                                  161732
102900200529     C***********          MOVE '1'       *IN80                           161732
103000200529     C***********          MOVE '1'       *IN30                           161732
103100200529     C***********          MOVE '0'       *IN39                           161732
103200200529     C***********          MOVEL'CO00001' ZAMSID                          161732
103300200529     C***********          EXSR ZASNMS                                    161732
103400200529     C***********          MOVE 'Y'       ERROR   1                       161732
103500200529     C***********          ELSE                            X*4            161732
103600200529     C************IN32     IFEQ '1'                        B*5            161732
103700200529     C***********          MOVE '1'       *IN31                           161732
103800200529     C***********          MOVE '1'       *IN30                           161732
103900200529     C***********          ENDIF                           B*5            161732
104000200529     C***********          MOVE #1RRN     W1RRN   40                      161732
104100200529     C***********          MOVE '1'       *IN81                           161732
104200200529     C***********          ENDIF                           E*4            161732
104300200529     C***********          ENDIF                           E*3            161732
104400200529     C***********          ENDIF                           E*2            161732
104500200529      *
104600200529      ** If no function key is pressed,
104700200529      **   Validate all Subfile records
104800200529      *
104900200529     C           *IN46     IFEQ '0'                        B*2
105000200529     C                     EXSR SRVALD
105100200529     C                     ENDIF                           E*2
105200200529      *
105300200529      **  If F5 is pressed, refresh screen
105400200529     C           *INKE     IFEQ '1'                        B*2
105500200529     C                     EXSR SRCLSF
105600200529      *
105700200529     C                     EXSR SRRFRS
105800200529     C                     ENDIF                           E*2
105900200529      *
106000200529     C                     ENDDO                           E*1
106100200529      *
106200200529     C                     ENDSR
106300200529      *****************************************************************
106400200529      /EJECT
106500200529      *****************************************************************
106600200529      *                                                               *
106700200529      *            SRBLD1 - Build subfile for the records "Books"     *
106800200529      *                                                               *
106900200529      * CALLED BY  MAIN   - Main Routine.                             *
107000200529      *                                                               *
107100200529      * FLDS USED         -                                           *
107200200529      *                                                               *
107300200529      *****************************************************************
107400200529     C           SRBLD1    BEGSR
107500200529      *
107600200529     C**********           Z-ADD*ZEROS    MCCNUM                                              CSD027
107700200529     C                     MOVE *BLANKS   MCCNUM                                              CSD027
107800200529     C                     MOVE *BLANKS   MCPTFR
107900200529      *                                                                   CSE020
108000200529      ** If CA is a child, save Security and use Security obtained        CSE020
108100200529      ** from the originating CA                                          CSE020
108200200529      *                                                                   CSE020
108300200529     C           MAPREF    IFNE *BLANKS                                   CSE020
108400200529     C                     MOVE KUDSN     WKSESN 10                       CSE020
108500200529     C                     MOVE WOSESN    KUDSN                           CSE020
108600200529     C                     ENDIF                                          CSE020
108700200529      *
108800200529     C           *IN32     DOWEQ'0'
108900200529     C***********WWCPT     ANDLT11                                        161732
109000200529      *
109100200529     C                     MOVE MCBOOK    KUDBK
109200200529     C                     MOVE MCBRCD    KUDBA
109300200529     C**********           Z-ADDMCDDPT    KUDPT                                               CSD027
109400200529     C                     MOVE MCDDPT    KUDPT                                               CSD027
109500200529     C                     MOVE UDMK      KUDMK
109600200529     C                     MOVE @COEX     KEXDT
109700200529      *
109800200529     C           KEY11     SETGTSECOUPL0             32
109900200529     C                     READPSECOUPL0                 32
110000200529      *
110100200529     C           *IN32     IFEQ '0'
110200200529     C           KUDBA     ANDEQMCBRCD
110300200529     C           KUDSN     ANDEQMCSESN
110400200529     C           KUDPT     ANDEQMCDDPT
110500200529     C           KUDMK     ANDEQUDMK
110600200529     C           KUDBK     ANDEQMCBOOK
110700200529      *                                                                   CSE020
110800200529      ** If CA is a child, restore KUDSN with Security of the child.      CSE020
110900200529      ** Set Ex-date Position = Actual Stock Allocation of the            CSE020
111000200529      ** Parent CA instead.                                               CSE020
111100200529      *                                                                   CSE020
111200200529     C           MAPREF    IFNE *BLANKS                                   CSE020
111300200529     C                     MOVE WKSESN    KUDSN                           CSE020
111400200529     C                     MOVE 'B'       WKCOTP                          CSE020
111500200529     C                     MOVE KUDBK     WKBOOK                          CSE020
111600200529     C                     MOVE *BLANKS   WKCNUM                          CSE020
111700200529     C                     MOVE *BLANKS   WKPTFR                          CSE020
111800200529     C           KEY14     CHAINSECOALL5             71                   CSE020
111900200529     C           *IN71     IFEQ *OFF                                      CSE020
112000200529     C                     Z-ADDM5ASTA    MCEXPO                          CSE020
112100200529     C                     ELSE                                           CSE020
112200200529     C                     Z-ADD*ZERO     MCEXPO                          CSE020
112300200529     C                     ENDIF                                          CSE020
112400200529      *                                                                   CSE020
112500200529     C                     ELSE                                           CSE020
112600200529      *
112700200529     C           MATDVD    IFEQ 'V'
112800200529     C                     Z-ADDUDNV      MCEXPO
112900200529     C                     ELSE
113000200529     C                     Z-ADDUDNT      MCEXPO
113100200529     C                     ENDIF
113200200529     C                     ENDIF                                          CSE020
113300200529      *
113400200529     C                     EXSR SRPROC
113500200529      *
113600200529     C***********WWCPT     IFEQ 11                                        161732
113700200529     C***********          EXSR SRSAVP                                    161732
113800200529     C***********          ELSE                                           161732
113900200529     C           MCDDPT    IFNE WWDPT
114000200529     C**********           Z-ADDMCDDPT    WWDPT                                               CSD027
114100200529     C                     MOVE MCDDPT    WWDPT                                               CSD027
114200200529     C                     ADD  1         #1RRN
114300200529     C                     ADD  1         WWCPT
114400200529     C                     MOVEA'110'     *IN,57
114500200529     C                     WRITESE7514S1
114600200529     C                     ENDIF
114700200529     C***********          ENDIF                                          161732
114800200529     C                     ENDIF
114900200529      *
115000200529     C                     Z-ADD*HIVAL    KEXDT
115100200529      *                                                                   CSE020
115200200529      ** If CA is a child, use Security obtained from Originating CA      CSE020
115300200529      *                                                                   CSE020
115400200529     C           MAPREF    IFNE *BLANKS                                   CSE020
115500200529     C                     MOVE WOSESN    KUDSN                           CSE020
115600200529     C                     ENDIF                                          CSE020
115700200529      *
115800200529     C           KEY11     SETGTSECOUPL0             32
115900200529     C                     READ SECOUPL0                 32
116000200529      *
116100200529     C           KUDSN     IFNE MCSESN
116200200529     C                     MOVE '1'       *IN32
116300200529     C                     ENDIF
116400200529      *
116500200529     C                     ENDDO
116600200529      *
116700200529     C                     ENDSR
116800200529      *****************************************************************
116900200529      /EJECT
117000200529      *****************************************************************
117100200529      *                                                               *
117200200529      *            SRBLD2 - Build subfile for the records "Cust/Ptfr" *
117300200529      *                                                               *
117400200529      * CALLED BY  MAIN   - Main Routine.                             *
117500200529      *                                                               *
117600200529      * FLDS USED         -                                           *
117700200529      *                                                               *
117800200529      *****************************************************************
117900200529     C           SRBLD2    BEGSR
118000200529      *
118100200529     C                     MOVE *BLANKS   MCBOOK
118200200529      *                                                                   CSE020
118300200529      ** If CA is a child, save Security and use Security obtained        CSE020
118400200529      ** from the Originating CA                                          CSE020
118500200529      *                                                                   CSE020
118600200529     C           MAPREF    IFNE *BLANKS                                   CSE020
118700200529     C                     MOVE KUDSN     WKSESN                          CSE020
118800200529     C                     MOVE WOSESN    KUDSN                           CSE020
118900200529     C                     ENDIF                                          CSE020
119000200529      *
119100200529     C           *IN32     DOWEQ'0'
119200200529     C***********WWCPT     ANDLT11                                        161732
119300200529      *
119400200529     C                     MOVE MCCNUM    WWCNUM
119500200529      *
119600200529     C**********           Z-ADDMCCNUM    KCDCN                                               CSD027
119700200529     C                     MOVE MCCNUM    KCDCN                                               CSD027
119800200529     C                     MOVE MCPTFR    KPTFR
119900200529     C                     MOVE MCBRCD    KUDBA
120000200529     C**********           Z-ADDMCDDPT    KUDPT                                               CSD027
120100200529     C                     MOVE MCDDPT    KUDPT                                               CSD027
120200200529     C                     MOVE CDMK      KUDMK
120300200529     C                     MOVE @COEX     KEXDT
120400200529      *
120500200529     C           KEY12     SETGTSECOCPL0             32
120600200529     C                     READPSECOCPL0                 32
120700200529      *
120800200529     C           *IN32     IFEQ '0'
120900200529     C           KUDBA     ANDEQMCBRCD
121000200529     C           KUDSN     ANDEQMCSESN
121100200529     C           KUDPT     ANDEQMCDDPT
121200200529     C           KUDMK     ANDEQCDMK
121300200529     C           KCDCN     ANDEQMCCNUM
121400200529     C           KPTFR     ANDEQMCPTFR
121500200529      *                                                                   CSE020
121600200529      ** If CA is a child, restore KUDSN with Security of the child.      CSE020
121700200529      ** Set Ex-date Position = Actual Stock Allocation of the            CSE020
121800200529      ** Parent CA instead.                                               CSE020
121900200529      *                                                                   CSE020
122000200529     C           MAPREF    IFNE *BLANKS                                   CSE020
122100200529     C                     MOVE WKSESN    KUDSN                           CSE020
122200200529     C                     MOVE 'C'       WKCOTP                          CSE020
122300200529     C                     MOVE *BLANKS   WKBOOK                          CSE020
122400200529     C                     MOVE KCDCN     WKCNUM                          CSE020
122500200529     C                     MOVE KPTFR     WKPTFR                          CSE020
122600200529     C           KEY14     CHAINSECOALL5             72                   CSE020
122700200529     C           *IN72     IFEQ *OFF                                      CSE020
122800200529     C                     Z-ADDM5ASTA    MCEXPO                          CSE020
122900200529     C                     ELSE                                           CSE020
123000200529     C                     Z-ADD*ZERO     MCEXPO                          CSE020
123100200529     C                     ENDIF                                          CSE020
123200200529      *                                                                   CSE020
123300200529     C                     ELSE                                           CSE020
123400200529      *
123500200529     C           MATDVD    IFEQ 'V'
123600200529     C                     Z-ADDCDNV      MCEXPO
123700200529     C                     ELSE
123800200529     C                     Z-ADDCDNT      MCEXPO
123900200529     C                     ENDIF
124000200529     C                     ENDIF                                          CSE020
124100200529      *
124200200529     C                     EXSR SRPROC
124300200529      *
124400200529     C***********WWCPT     IFEQ 11                                        161732
124500200529     C***********          EXSR SRSAVP                                    161732
124600200529     C***********          ELSE                                           161732
124700200529     C           MCDDPT    IFNE WWDPT
124800200529     C**********           Z-ADDMCDDPT    WWDPT                                               CSD027
124900200529     C                     MOVE MCDDPT    WWDPT                                               CSD027
125000200529     C                     ADD  1         #1RRN
125100200529     C                     ADD  1         WWCPT
125200200529     C                     MOVEA'110'     *IN,57
125300200529     C                     WRITESE7514S1
125400200529     C                     ENDIF
125500200529     C***********          ENDIF                                          161732
125600200529     C                     ENDIF
125700200529      *
125800200529     C                     Z-ADD*HIVAL    KEXDT
125900200529      *                                                                   CSE020
126000200529      ** If CA is a child, use Security obtained from Originating CA      CSE020
126100200529      *                                                                   CSE020
126200200529     C           MAPREF    IFNE *BLANKS                                   CSE020
126300200529     C                     MOVE WOSESN    KUDSN                           CSE020
126400200529     C                     ENDIF                                          CSE020
126500200529      *
126600200529     C           KEY12     SETGTSECOCPL0             32
126700200529     C                     READ SECOCPL0                 32
126800200529      *
126900200529     C           KUDSN     IFNE MCSESN
127000200529     C                     MOVE '1'       *IN32
127100200529     C                     ENDIF
127200200529      *
127300200529     C                     ENDDO
127400200529      *
127500200529     C                     ENDSR
127600200529      *****************************************************************
127700200529      /EJECT
127800200529      *****************************************************************
127900200529      *                                                               *
128000200529      *            SRRFRS - Refresh screen                            *
128100200529      *                                                               *
128200200529      * CALLED BY  MAIN   - Main Routine.                             *
128300200529      *                                                               *
128400200529      * FLDS USED         -                                           *
128500200529      *                                                               *
128600200529      *****************************************************************
128700200529     C           SRRFRS    BEGSR
128800200529      *                                                                   161732
128900200619     C                     Z-ADD*ZERO     X       20                                   161732
129100200529      *
129200200529      ** If CA is a child, use Security obtained from the Originating     CSE020
129300200529      ** action; Otherwise, use Security from entry parameter.            CSE020
129400200529      *                                                                   CSE020
129500200529     C           MAPREF    IFNE *BLANKS                                   CSE020
129600200529     C                     MOVE WOSESN    KUDSN                           CSE020
129700200529     C                     ELSE                                           CSE020
129800200529     C                     MOVE @SESN     KUDSN
129900200529     C                     ENDIF                                          CSE020
130000200529      *
130100200529      ** Read first record from SECOUPL0
130200200529     C           KUDSN     SETLLSECOUPL0
130300200529     C           KUDSN     READESECOUPL0                 32
130400200529      *
130500200529     C           *IN32     IFEQ '0'
130600200529     C                     MOVE 'B'       MCCOTP
130700200529     C                     MOVE @PTYP     MCCOAT
130800200529     C                     ENDIF
130900200529      *                                                                   CSE020
131000200529      ** If CA is a child, restore KUDSN.                                 CSE020
131100200529      *                                                                   CSE020
131200200529     C           MAPREF    IFNE *BLANKS                                   CSE020
131300200529     C                     MOVE @SESN     KUDSN                           CSE020
131400200529     C                     ENDIF                                          CSE020
131500200529      *
131600200529     C                     EXSR SRBLD1
131700200529      *
131800200529      ** Read first record from SECOCPL0
131900200529     C           KUDSN     SETLLSECOCPL0
132000200529     C           KUDSN     READESECOCPL0                 32
132100200529      *
132200200529     C           *IN32     IFEQ '0'
132300200529     C                     MOVE 'C'       MCCOTP
132400200529     C                     MOVE @PTYP     MCCOAT
132500200529     C                     ENDIF
132600200529      *                                                                   CSE020
132700200529      ** If CA is a child, restore KUDSN.                                 CSE020
132800200529      *                                                                   CSE020
132900200529     C           MAPREF    IFNE *BLANKS                                   CSE020
133000200529     C                     MOVE @SESN     KUDSN                           CSE020
133100200529     C                     ENDIF                                          CSE020
133200200529      *
133300200529     C                     EXSR SRBLD2
133400200529      *                                                                   CSE020
133500200529      ** If CA is a child, restore KUDSN.                                 CSE020
133600200529      *                                                                   CSE020
133700200529     C           MAPREF    IFNE *BLANKS                                   CSE020
133800200529     C                     MOVE @SESN     KUDSN                           CSE020
133900200529     C                     ENDIF                                          CSE020
134000200529      *
134100200529     C           WWCPT     IFEQ 0
134200200529     C                     Z-ADD1         #1RRN
134300200529     C                     MOVE #1RRN     W1RRN   40
134400200529     C                     WRITESE7514S1
134500200529     C                     MOVE '1'       *IN80
134600200529     C                     MOVE '1'       *IN30
134700200529     C                     MOVE '0'       *IN39
134800200529     C                     MOVEL'CO00001' ZAMSID
134900200529     C                     EXSR ZASNMS
135000200529     C                     MOVE 'Y'       ERROR   1
135100200529     C                     ELSE
135200200529     C           *IN32     IFEQ '1'
135300200529     C                     MOVE '1'       *IN31
135400200529     C                     MOVE '1'       *IN30
135500200529     C                     ENDIF
135600200529     C                     MOVE #1RRN     W1RRN   40
135700200529     C                     MOVE '1'       *IN81
135800200529     C                     ENDIF
135900200529      *
136000200529     C                     ENDSR
136100200529      *****************************************************************
136200200529      /EJECT
136300200529      *****************************************************************
136400200529      *                                                               *
136500200529      *            SRENDP - End Processing                            *
136600200529      *                                                               *
136700200529      * CALLS             -                                           *
136800200529      *                                                               *
136900200529      * CALLED BY  MAIN   - Main Routine.                             *
137000200529      *                                                               *
137100200529      * FLDS USED         -                                           *
137200200529      *                                                               *
137300200529      *****************************************************************
137400200529     C           SRENDP    BEGSR
137500200529      *
137600200529     C           *INKC     IFEQ '1'                        B*1
137700200529     C                     MOVE '3'       @RTCD
137800200529     C                     ENDIF                           E*1
137900200529      *
138000200529     C           *INKL     IFEQ '1'
138100200529     C                     MOVE '2'       @RTCD
138200200529     C                     ENDIF
138300200529      *
138400200529      **  End Program
138500200529     C                     MOVE '1'       *INLR
138600200529     C                     RETRN
138700200529      *
138800200529     C                     ENDSR
138900200529      *****************************************************************
139000200529      /EJECT
139100200529      *****************************************************************
139200200529      *                                                               *
139300200529      *            SRCLSF - Clear Subfile                             *
139400200529      *                                                               *
139500200529      * CALLS             -                                           *
139600200529      *                                                               *
139700200529      * CALLED BY  SRALOC - Main Processing                           *
139800200529      *            SRVIEW - View subfile from Review from fields      *
139900200529      *                                                               *
140000200529      * FLDS USED         -                                           *
140100200529      *                                                               *
140200200529      *****************************************************************
140300200529     C           SRCLSF    BEGSR
140400200529      *
140500200529      ** Clear Input Fields
140600200529     C                     TIME           ##TME            Screen time.
140700200529     C                     MOVE *BLANKS   SBRCD
140800200529     C                     MOVE *BLANKS   SBOOK
140900200529     C                     MOVE *BLANKS   SPRFC                           CAC005
141000200529     C                     MOVE *BLANKS   SCNUM
141100200529     C                     MOVE *BLANKS   SPTFR
141200200529     C                     MOVEA'0000'    *IN,20
141300200529     C                     MOVE '0'       *IN63                           CAC005
141400200529     C                     MOVE ' '       SACDE
141500200529     C                     MOVE 'N'       ERROR   1
141600200529      *
141700200529      ** Clear Subfile
141800200529     C                     MOVE '1'       *IN80
141900200529     C                     WRITESE7514C1
142000200529     C                     MOVE '0'       *IN80
142100200529     C                     MOVE '1'       *IN81
142200200529     C                     MOVE '0'       *IN30
142300200529     C                     MOVE '0'       *IN31
142400200529     C***********          MOVE '0'       *IN45                           161732
142500200529     C                     Z-ADD0         #1RRN
142600200529     C                     Z-ADD0         WWCPT   20
142700200529     C                     MOVE '0'       *IN39
142800200529      *
142900200529      **  Clear Messages from Program Message Queue.
143000200529     C                     CALL 'Y2CLMSC'
143100200529     C                     PARM ##PGM     ZAPGM  10
143200200529     C                     PARM '*SAME'   ZAPGRL  5
143300200529      *
143400200529     C                     WRITESE7514C2
143500200529      *
143600200529      ** Initialise checking fields
143700200529     C                     MOVE *BLANKS   WWBRC   3
143800200529     C                     MOVE *BLANKS   WWBOK   2
143900200529     C**********           Z-ADD*ZEROS    WWDPT   60                                          CSD027
144000200529     C**********           MOVE *BLANKS   WWCNM   60                                          CSD027
144100200529     C                     MOVE *BLANKS   WWDPT   6                                           CSD027
144200200529     C                     MOVE *BLANKS   WWCNM   6                                           CSD027
144300200529     C                     MOVE *BLANKS   WWPTF   4
144400200529      *
144500200529     C                     ENDSR
144600200529      *****************************************************************
144700200529      /EJECT
144800200529      *****************************************************************
144900200529      *                                                               *
145000200529      *            SRBLDS - Build Subfile                             *
145100200529      *                                                               *
145200200529      * CALLS      SRPROC - Process read records                      *
145300200529      *            SRSAVP - Save previous values of the subfile record*
145400200529      *            SRRESP - Restore previous values of the subfile    *
145500200529      *                     record                                    *
145600200529      *                                                               *
145700200529      * CALLED BY  SRALOC - Main Processing                           *
145800200529      *                                                               *
145900200529      * FLDS USED         -                                           *
146000200529      *                                                               *
146100200529      *****************************************************************
146200200529     C           SRBLDS    BEGSR
146300200529      *
146400200529     C           *IN31     DOWEQ'0'                        B*1
146500200529     C***********WWCPT     ANDLT11                                        161732
146600200529     C           *IN32     ANDEQ'0'
146700200529      *
146800200529     C                     MOVE MCCNUM    WWCNUM  6
146900200529      *
147000200529     C           MCSESN    IFNE '**CASH**'                 B*1A
147100200529     C           WWCNUM    ANDNEBVERCU
147200200529     C           MCSESN    OREQ '**CASH**'
147300200529     C           MCCOAT    ANDEQ'CE'
147400200529     C           WWCNUM    ANDNEBVERCU
147500200529      *
147600200529     C************IN45     IFEQ '1'                        B*2            161732
147700200529     C***********          EXSR SRRESP                                    161732
147800200529     C***********MCDDPT    IFNE WWDPT                      B*3            161732
147900200529     C***********          Z-ADDMCDDPT    WWDPT                           161732
148000200529     C***********          ADD  1         #1RRN                           161732
148100200529     C***********          ADD  1         WWCPT                           161732
148200200529     C***********          WRITESE7514S1                                  161732
148300200529     C***********          ENDIF                           E*3            161732
148400200529     C***********          ENDIF                           E*2            161732
148500200529      *
148600200529     C                     EXSR SRPROC
148700200529      *
148800200529     C***********WWCPT     IFEQ 11                         B*2            161732
148900200529     C***********          EXSR SRSAVP                                    161732
149000200529     C***********          ELSE                            X*2            161732
149100200529     C           MCDDPT    IFNE WWDPT                      B*3
149200200529     C**********           Z-ADDMCDDPT    WWDPT                                               CSD027
149300200529     C                     MOVE MCDDPT    WWDPT                                               CSD027
149400200529     C                     ADD  1         #1RRN
149500200529     C                     ADD  1         WWCPT
149600200529     C                     MOVEA'110'     *IN,57
149700200529     C                     WRITESE7514S1
149800200529     C                     ENDIF                           E*3
149900200529     C***********          ENDIF                           B*2            161732
150000200529     C                     ENDIF                           E*1A
150100200529      *
150200200529     C           KEY1      READESECOALL2                 31
150300200529      *
150400200529     C                     ENDDO                           E*1
150500200529      *
150600200529     C           WWCPT     IFEQ 0                          B*1
150700200529     C************IN27     ANDNE'1'                                137877 161732
150800200529     C                     Z-ADD1         #1RRN
150900200529     C                     MOVE #1RRN     W1RRN   40
151000200529     C                     WRITESE7514S1
151100200529     C                     MOVE '1'       *IN80
151200200529     C                     MOVE '1'       *IN30
151300200529     C                     MOVE '0'       *IN39
151400200529     C                     MOVEL'CO00001' ZAMSID
151500200529     C                     EXSR ZASNMS
151600200529     C                     MOVE 'Y'       ERROR   1
151700200529     C                     ELSE                            X*1
151800200529      *
151900200529     C           *IN31     IFEQ '1'                        B*2
152000200529      *
152100200529     C************IN45     IFEQ '1'                        B*3            161732
152200200529     C***********          EXSR SRRESP                                    161732
152300200529     C***********MCDDPT    IFNE WWDPT                      B*4            161732
152400200529     C***********          Z-ADDMCDDPT    WWDPT                           161732
152500200529     C***********          ADD  1         #1RRN                           161732
152600200529     C***********          ADD  1         WWCPT                           161732
152700200529     C***********          WRITESE7514S1                                  161732
152800200529     C***********          ENDIF                           E*4            161732
152900200529     C***********          ENDIF                           E*3            161732
153000200529      *
153100200529     C                     MOVE '1'       *IN30
153200200529     C                     ENDIF                           E*2
153300200529      *
153400200529     C                     MOVE #1RRN     W1RRN   40
153500200529     C                     MOVE '1'       *IN81
153600200529     C                     ENDIF                           E*1
153700200529      *
153800200529     C                     ENDSR
153900200529      *****************************************************************
154000200529      /EJECT
154100200529      *****************************************************************
154200200529      *                                                               *
154300200529      *            SRPROC - Process read records                      *
154400200529      *                                                               *
154500200529      * CALLS      SRSAVP - Save previous values of the subfile record*
154600200529      *                                                               *
154700200529      * CALLED BY  SRBLDS - Build Subfile                             *
154800200529      *                                                               *
154900200529      * FLDS USED         -                                           *
155000200529      *                                                               *
155100200529      *****************************************************************
155200200529     C           SRPROC    BEGSR
155300200529      *
155400200529     C           MCBRCD    IFNE WWBRC
155500200529     C           WWBRC     ANDNE*BLANKS
155600200529     C                     MOVE *BLANKS   WWBRC
155700200529     C                     MOVE *BLANKS   WWBOK
155800200529     C**********           Z-ADD*ZEROS    WWDPT                                               CSD027
155900200529     C**********           Z-ADD0         WWCNM                                               CSD027
156000200529     C                     MOVE *BLANKS   WWDPT                                               CSD027
156100200529     C                     MOVE *BLANKS   WWCNM                                               CSD027
156200200529     C                     MOVE *BLANKS   WWPTF
156300200529     C                     ELSE
156400200529     C                     MOVE MCBRCD    WWBRC
156500200529     C                     ENDIF
156600200529      *
156700200529     C                     MOVELMCCNUM    HCNUM
156800200529     C                     MOVE MCPTFR    HPORT
156900200529     C                     MOVELMCBOOK    HBOOK
157000200529     C                     MOVE MCDDPT    HDPOT
157100200529     C                     MOVE MCEXPO    HEXPO
157200200529      *
157300200529     C           MCCOTP    IFEQ 'B'                        B*1
157400200529      *
157500200529      ** If change of Book and Book just read not equal to blanks
157600200529      *
157700200529     C           WWBOK     IFNE MCBOOK                     B*2
157800200529     C           MCBOOK    ANDNE*BLANKS
157900200529     C                     MOVE MCBRCD    WBRCD
158000200529     C                     MOVE 'B'       WCOTP
158100200529     C                     MOVE MCBOOK    WBOOK
158200200529     C**********           Z-ADD*ZEROS    WCNUM                                               CSD027
158300200529     C                     MOVE *BLANKS   WCNUM                                               CSD027
158400200529     C           KEY3      CHAINSECOREL1             75
158500200529      *
158600200529     C           *IN75     IFEQ '0'                        B*3
158700200529     C                     MOVE 'Y'       EXBCRE  1        Current Reply exist
158800200529      *
158900200529     C           MQR1RE    IFNE *BLANKS                                   137877
159000200529     C                     MOVE *BLANKS   ZFIELD
159100200529     C                     MOVE MQR1RE    ZFIELD
159200200529     C                     Z-ADD2         ZADIG
159300200529     C                     Z-ADD*ZEROS    ZADEC
159400200529     C                     EXSR ZEDIT
159500200529     C                     MOVEL*BLANKS   SC1RE
159600200529     C                     MOVE ZFIELD    SC1RE
159700200529     C                     ELSE                                           137877
159800200529     C                     MOVE *BLANKS   SC1RE                           137877
159900200529     C                     ENDIF                                          137877
160000200529      *
160100200529     C           MQR2RE    IFNE *BLANKS                                   137877
160200200529     C                     MOVE *BLANKS   ZFIELD
160300200529     C                     MOVE MQR2RE    ZFIELD
160400200529     C                     Z-ADD2         ZADIG
160500200529     C                     Z-ADD*ZEROS    ZADEC
160600200529     C                     EXSR ZEDIT
160700200529     C                     MOVEL*BLANKS   SC2RE
160800200529     C                     MOVE ZFIELD    SC2RE
160900200529     C                     ELSE                                           137877
161000200529     C                     MOVE *BLANKS   SC2RE                           137877
161100200529     C                     ENDIF                                          137877
161200200529      *
161300200529     C                     ELSE                            X*3
161400200529     C                     MOVE 'N'       EXBCRE           Current Reply exist
161500200529     C                     MOVE *BLANKS   SC1RE
161600200529     C                     MOVE *BLANKS   SC2RE
161700200529     C                     ENDIF                           E*3
161800200529      *
161900200529     C           SC1RE     IFEQ *BLANKS                    B*3
162000200529     C           MANBOP    ANDEQ1
162100200529     C                     MOVE ' 1'      SC1RE
162200200529     C                     ENDIF                           E*3
162300200529      *
162400200529     C                     MOVE @COAT     WCOAT
162500200529     C                     MOVE @SESN     WSESN
162600200529      *
162700200529     C           KEY4      CHAINSECOSIL2             75
162800200529      *
162900200529     C           *IN75     IFEQ '1'                        B*3
163000200529     C                     MOVE *BLANKS   WSESN
163100200529     C           KEY4      CHAINSECOSIL2             75
163200200529      *
163300200529     C           *IN75     IFEQ '1'                        B*4
163400200529     C                     MOVE *BLANKS   WCOAT
163500200529     C           KEY4      CHAINSECOSIL2             75
163600200529      *
163700200529     C           *IN75     IFEQ '1'                        B*5
163800200529     C                     MOVE *BLANKS   WBOOK
163900200529     C           KEY4      CHAINSECOSIL2             75
164000200529     C                     ENDIF                           E*5
164100200529      *
164200200529     C                     ENDIF                           E*4
164300200529      *
164400200529     C                     ENDIF                           E*3
164500200529      *
164600200529     C                     MOVE *BLANKS   SS1IN
164700200529     C                     MOVE *BLANKS   SS2IN
164800200529      *
164900200529     C           *IN75     IFEQ '0'                        B*3
165000200529     C                     MOVE 'Y'       EXBCSI  1        Standard Instruction exist
165100200529     C                     ELSE                            X*3
165200200529     C                     MOVE 'N'       EXBCSI           Standard Instruction exist
165300200529     C                     ENDIF                           E*3
165400200529      *
165500200529      **  Retrieve the standard instructions reply for level 1 & 2
165600200529     C                     EXSR SRRPLY
165700200529      *
165800200529     C                     MOVE MCBRCD    SBRCH
165900200529     C                     MOVELMCBOOK    SCUBK     P
166000200529      *                                                                   CAC005
166100200529      ** If CAC005 is on, retrieve user book from AOBKPCR0.               CAC005
166200200529      *                                                                   CAC005
166300200529     C           CAC005    IFEQ 'Y'                                       CAC005
166400200529     C                     CALL 'AOBKPCR0'                                CAC005
166500200529     C                     PARM           PRTCD   7                       CAC005
166600200529     C                     PARM '*USER  ' POPTN   7                       CAC005
166700200529     C           PMBKCD    PARM *BLANKS   PMBKCD  2                       CAC005
166800200529     C           PMPRFC    PARM *BLANKS   PMPRFC  4                       CAC005
166900200529     C                     PARM MCBOOK    PMPSBK  2                       CAC005
167000200529     C           PRTCD     IFEQ *BLANKS                                   CAC005
167100200529     C                     MOVELPMBKCD    SCUBK                           CAC005
167200200529     C                     MOVE PMPRFC    SCUBK                           CAC005
167300200529     C                     ENDIF                                          CAC005
167400200529     C                     ENDIF                                          CAC005
167500200529      *                                                                   CAC005
167600200529     C                     MOVE *BLANKS   SPORT
167700200529     C                     MOVE 'B'       HINDC
167800200529     C                     MOVE MCBOOK    HBOOK
167900200529     C                     MOVE *BLANKS   HCNUM
168000200529      *
168100200529     C***********WWCPT     IFEQ 11                         B*3            161732
168200200529     C***********          EXSR SRSAVP                                    161732
168300200529     C***********          ELSE                            X*3            161732
168400200529     C                     MOVEA'001'     *IN,57
168500200529     C                     MOVE '0'       *IN62
168600200529     C                     ADD  1         #1RRN
168700200529     C                     ADD  1         WWCPT
168800200529     C                     WRITESE7514S1
168900200529     C                     MOVE MCBOOK    WWBOK
169000200529     C**********           Z-ADD*ZEROS    WWDPT                                               CSD027
169100200529     C                     MOVE *BLANKS   WWDPT                                               CSD027
169200200529     C***********          ENDIF                           E*3            161732
169300200529      *                                                                   161732
169400200529      ** Add a new element for both argument and function arrays          161732
169500200529      *                                                                   161732
169600200529     C                     MOVE SBRCH     WBRCH                           161732
169700200529     C                     MOVE SCUBK     WCUBK                           161732
169800200529     C                     MOVE SPORT     WPORT                           161732
169900200529     C                     ADD  1         X                               161732
170000200529     C                     MOVEAWBCBP     EXP1,X                          161732
170100200529     C                     MOVEAWZERO     EXP2,X                          161732
170200200529      *
170300200529     C                     ENDIF                           E*2
170400200529      *
170500200529     C                     ENDIF                           E*1
170600200529      *
170700200529     C           MCCOTP    IFEQ 'C'                        B*1
170800200529     C           PFPL      ANDEQ'Y'
170900200529      *
171000200529      ** If change of Customer Number & Customer Number just read
171100200529      ** is not equal to blanks
171200200529      *
171300200529     C           WWCNM     IFNE MCCNUM                     B*2
171400200529     C********** MCCNUM    ANDNE0                                                             CSD027
171500200529     C           MCCNUM    ANDNE*BLANKS                                                       CSD027
171600200529     C           WWPTF     ORNE MCPTFR
171700200529     C                     MOVE 'C'       WCOTP
171800200529     C                     MOVE *BLANKS   WBOOK
171900200529     C                     MOVE MCCNUM    WCNUM
172000200529     C                     MOVE MCBRCD    WBRCD
172100200529     C           KEY3      CHAINSECOREL1             75
172200200529      *
172300200529     C           *IN75     IFEQ '0'                        B*3
172400200529     C                     MOVE 'Y'       EXBCRE           Current Reply exist
172500200529      *
172600200529     C           MQR1RE    IFNE *BLANKS                                   137877
172700200529     C                     MOVE *BLANKS   ZFIELD
172800200529     C                     MOVE MQR1RE    ZFIELD
172900200529     C                     Z-ADD2         ZADIG
173000200529     C                     Z-ADD*ZEROS    ZADEC
173100200529     C                     EXSR ZEDIT
173200200529     C                     MOVEL*BLANKS   SC1RE
173300200529     C                     MOVE ZFIELD    SC1RE
173400200529     C                     ELSE                                           137877
173500200529     C                     MOVE *BLANKS   SC1RE                           137877
173600200529     C                     ENDIF                                          137877
173700200529      *
173800200529     C           MQR2RE    IFNE *BLANKS                                   137877
173900200529     C                     MOVE *BLANKS   ZFIELD
174000200529     C                     MOVE MQR2RE    ZFIELD
174100200529     C                     Z-ADD2         ZADIG
174200200529     C                     Z-ADD*ZEROS    ZADEC
174300200529     C                     EXSR ZEDIT
174400200529     C                     MOVEL*BLANKS   SC2RE
174500200529     C                     MOVE ZFIELD    SC2RE
174600200529     C                     ELSE                                           137877
174700200529     C                     MOVE *BLANKS   SC2RE                           137877
174800200529     C                     ENDIF                                          137877
174900200529      *
175000200529     C                     ELSE
175100200529     C                     MOVE 'N'       EXBCRE           Current Reply exist
175200200529     C                     MOVE *BLANKS   SC1RE
175300200529     C                     MOVE *BLANKS   SC2RE
175400200529     C                     ENDIF                           E*3
175500200529      *
175600200529     C           SC1RE     IFEQ *BLANKS                    B*3
175700200529     C           MANBOP    ANDEQ1
175800200529     C                     MOVE ' 1'      SC1RE
175900200529     C                     ENDIF                           E*3
176000200529      *
176100200529     C                     MOVE MCPTFR    WPTFR
176200200529     C                     MOVE @COAT     WCOAT
176300200529     C                     MOVE @SESN     WSESN
176400200529      *
176500200529     C           KEY5      CHAINSECOSIL1             75
176600200529      *
176700200529     C           *IN75     IFEQ '1'                        B*3
176800200529     C                     MOVE *BLANKS   WSESN
176900200529     C           KEY5      CHAINSECOSIL1             75
177000200529      *
177100200529     C           *IN75     IFEQ '1'                        B*4
177200200529     C                     MOVE *BLANKS   WCOAT
177300200529     C           KEY5      CHAINSECOSIL1             75
177400200529      *
177500200529     C           *IN75     IFEQ '1'                        B*5
177600200529     C                     MOVE *BLANKS   WPTFR
177700200529     C           KEY5      CHAINSECOSIL1             75
177800200529      *
177900200529     C           *IN75     IFEQ '1'                        B*6
178000200529     C**********           Z-ADD*ZEROS    WCNUM                                               CSD027
178100200529     C                     MOVE *BLANKS   WCNUM                                               CSD027
178200200529     C           KEY5      CHAINSECOSIL1             75
178300200529     C                     ENDIF                           E*6
178400200529      *
178500200529     C                     ENDIF                           E*5
178600200529      *
178700200529     C                     ENDIF                           E*4
178800200529      *
178900200529     C                     ENDIF                           E*3
179000200529      *
179100200529     C                     MOVE *BLANKS   SS1IN
179200200529     C                     MOVE *BLANKS   SS2IN
179300200529      *
179400200529     C           *IN75     IFEQ '0'                        B*3
179500200529     C                     MOVE 'Y'       EXBCSI           Standard Instruction exist
179600200529     C                     ELSE                            X*3
179700200529     C                     MOVE 'N'       EXBCSI           Standard Instruction exist
179800200529     C                     ENDIF                           E*3
179900200529      *
180000200529      **  Retrieve the standard instructions reply for level 1 & 2
180100200529     C                     EXSR SRRPLY
180200200529      *
180300200529     C                     MOVE MCBRCD    SBRCH
180400200529      *
180500200529     C                     MOVE *BLANKS   WLKEYC
180600200529     C                     MOVELMCCNUM    WLKEYC
180700200529     C**********           CALL 'AOCUSTR0'                                                    223182
180800200529     C                     CALL 'AOCUSTR1'                                                    223182
180900200529     C                     PARM '*DBERR'  WLRTCD
181000200529     C                     PARM '*KEY   ' WLOPTN
181100200529     C                     PARM           WLKEYC 10
181200200529     C                     PARM *BLANKS   WLKYST  7
181300200529     C********** SDCUST    PARM SDCUST    DSSDY                                               223182
181400200529     C           SDCUST    PARM SDCUST    DSLDY                                               223182
181500200529      *
181600200529      **  If record not found
181700200529     C           WLRTCD    IFNE *BLANKS                    B*1
181800200529     C           BBCLST    ANDNE'Y'                                                           223182
181900200529     C           *LOCK     IN   LDA
182000200529     C                     Z-ADD008       DBASE            ****************
182100200529     C                     MOVE 'SDCUSTPD'DBFILE           * DB ERROR 008 *
182200200529     C                     MOVELMCCNUM    DBKEY            ****************
182300200529     C                     OUT  LDA
182400200529     C                     EXSR *PSSR
182500200529     C                     ENDIF                           E*1
182600200529      *
182700200529     C                     MOVELBBCSSN    SCUBK
182800200529     C                     MOVE 'C'       HINDC
182900200529     C                     MOVE *BLANKS   HBOOK
183000200529     C                     MOVE MCCNUM    HCNUM
183100200529      *
183200200529     C           MCPTFR    IFEQ '9997'
183300200529     C           BGN4ST    ANDNE'Y'                                       CPB001
183400200529     C                     MOVE FCR997    SPORT
183500200529     C                     ELSE
183600200529     C                     MOVE MCPTFR    SPORT
183700200529     C                     ENDIF
183800200529      *
183900200529     C***********WWCPT     IFEQ 11                                        161732
184000200529     C***********          EXSR SRSAVP                                    161732
184100200529     C***********          ELSE                                           161732
184200200529     C                     MOVEA'001'     *IN,57
184300200529     C                     MOVE '0'       *IN62
184400200529     C                     ADD  1         #1RRN
184500200529     C                     ADD  1         WWCPT
184600200529     C                     WRITESE7514S1
184700200529     C**********           Z-ADDMCCNUM    WWCNM                                               CSD027
184800200529     C                     MOVE MCCNUM    WWCNM                                               CSD027
184900200529     C                     MOVE MCPTFR    WWPTF
185000200529     C**********           Z-ADD*ZEROS    WWDPT                                               CSD027
185100200529     C                     MOVE *BLANKS   WWDPT                                               CSD027
185200200529     C***********          ENDIF                                          161732
185300200529      *                                                                   161732
185400200529      ** Add a new element for both argument and function arrays          161732
185500200529      *                                                                   161732
185600200529     C                     MOVE SBRCH     WBRCH                           161732
185700200529     C                     MOVE SCUBK     WCUBK                           161732
185800200529     C                     MOVE SPORT     WPORT                           161732
185900200529     C                     ADD  1         X                               161732
186000200529     C                     MOVEAWBCBP     EXP1,X                          161732
186100200529     C                     MOVEAWZERO     EXP2,X                          161732
186200200529      *
186300200529     C                     ENDIF                           E*2
186400200529      *
186500200529     C                     ENDIF                           E*1
186600200529      *
186700200529      *
186800200529      **  Retrieve Nominal Currency of the Event Security
186900200529     C           MCSESN    IFNE '**CASH**'                 B*1
187000200529     C           MCSESN    CHAINSECTYZ1              89
187100200529      *
187200200529      **  If record not found
187300200529     C           *IN89     IFEQ '1'                        B*2
187400200529     C           *LOCK     IN   LDA
187500200529     C                     Z-ADD009       DBASE            ****************
187600200529     C                     MOVE 'SECTYD'  DBFILE           * DB ERROR 009 *
187700200529     C                     MOVELMCSESN    DBKEY            ****************
187800200529     C                     OUT  LDA
187900200529     C                     EXSR *PSSR
188000200529     C                     ENDIF                           E*2
188100200529     C                     ELSE                            X*1
188200200529     C                     Z-ADDSNMDP     NMDP
188300200529     C                     ENDIF                           E*1
188400200529      *
188500200529     C                     MOVEA'110'     *IN,57
188600200529      *
188700200529     C********** MCDDPT    IFNE *ZEROS                     B*1                                CSD027
188800200529     C           MCDDPT    IFNE *BLANKS                    B*1                                CSD027
188900200529     C                     MOVE *BLANKS   WLKEYC
189000200529     C                     MOVELMCDDPT    WLKEYC
189100200529     C**********           CALL 'AOCUSTR0'                                                    223182
189200200529     C                     CALL 'AOCUSTR1'                                                    223182
189300200529     C                     PARM '*DBERR'  WLRTCD
189400200529     C                     PARM '*KEY   ' WLOPTN
189500200529     C                     PARM           WLKEYC 10
189600200529     C                     PARM *BLANKS   WLKYST  7
189700200529     C********** SDCUST    PARM SDCUST    DSSDY                                               223182
189800200529     C           SDCUST    PARM SDCUST    DSLDY                                               223182
189900200529      *
190000200529      **  If record not found
190100200529     C           WLRTCD    IFNE *BLANKS                    B*2
190200200529     C           BBCLST    ANDNE'Y'                                                           223182
190300200529     C           *LOCK     IN   LDA
190400200529     C                     Z-ADD010       DBASE            ****************
190500200529     C                     MOVE 'SDCUSTPD'DBFILE           * DB ERROR 010 *
190600200529     C                     MOVELMCDDPT    DBKEY            ****************
190700200529     C                     OUT  LDA
190800200529     C                     EXSR *PSSR
190900200529     C                     ENDIF                           E*2
191000200529     C                     MOVELBBCSSN    SDPOT
191100200529      *
191200200529     C                     ELSE                            X*1
191300200529     C                     MOVE *BLANKS   SDPOT
191400200529     C                     ENDIF                           E*1
191500200529      *
191600200529     C           MCEXPO    IFNE *ZEROS                     B*1
191700200529     C                     MOVE *BLANKS   ZFLD15
191800200529     C                     MOVE MCEXPO    ZFLD15
191900200529     C                     Z-ADDNMDP      ZDECS
192000200529     C                     EXSR ZSEDIT
192100200529     C                     MOVEL*BLANKS   SEXPO
192200200529     C                     MOVE ZOUT21    WFLD17 17
192300200529     C                     MOVELWFLD17    SEXPO
192400200529     C                     ELSE                            X*1
192500200529     C                     MOVE *BLANKS   SEXPO
192600200529     C                     ENDIF                           E*1
192700200529      *                                                                   161732
192800200529      ** Add Ex-date position to the figure stored in the array           161732
192900200529      *                                                                   161732
193000200529     C                     EXSR SRCONV                                    161732
193100200529      *
193200200529     C                     ENDSR
193300200529      *****************************************************************
193400200529      /EJECT
193500200529      *****************************************************************
193600200529      *                                                               *
193700200529      *            SRVALD - Validate action code                      *
193800200529      *                                                               *
193900200529      * CALLS      SRVIEW - View subfile from Review from fields      *
194000200529      *            SRVAC  - Validate action code                      *
194100200529      *                                                               *
194200200529      * CALLED BY  SRALOC - Main Processing                           *
194300200529      *                                                               *
194400200529      * FLDS USED         -                                           *
194500200529      *                                                               *
194600200529      *****************************************************************
194700200529     C           SRVALD    BEGSR
194800200529      *
194900200529     C                     MOVE 'Y'       BRIN    1                       CAC005
195000200529     C           CAC005    IFEQ 'N'                                       CAC005
195100200529      *                                                                   CAC005
195200200529     C           SBOOK     IFEQ *BLANKS                                   CAC005
195300200529     C           SBOOK     OREQ HBOOK                                     CAC005
195400200529     C                     MOVE 'N'       BRIN                            CAC005
195500200529     C                     ENDIF                                          CAC005
195600200529      *                                                                   CAC005
195700200529     C                     ELSE                                           CAC005
195800200529      *                                                                   CAC005
195900200529     C           SBOOK     IFEQ *BLANKS                                   CAC005
196000200529     C           SPRFC     ANDEQ*BLANKS                                   CAC005
196100200529     C                     MOVE 'N'       BRIN                            CAC005
196200200529     C                     ELSE                                           CAC005
196300200529      *                                                                   CAC005
196400200529      ** Convert screen fields book & book profit centre into pseudo book.CAC005
196500200529      *                                                                   CAC005
196600200529     C                     CALL 'AOBKPCR0'                                CAC005
196700200529     C                     PARM           PRTCD                           CAC005
196800200529     C                     PARM '*PSEUDO' POPTN                           CAC005
196900200529     C                     PARM SBOOK     PMBKCD                          CAC005
197000200529     C                     PARM SPRFC     PMPRFC                          CAC005
197100200529     C           PMPSBK    PARM *BLANKS   PMPSBK                          CAC005
197200200529     C           PRTCD     IFEQ *BLANKS                                   CAC005
197300200529     C           PMPSBK    ANDEQHBOOK                                     CAC005
197400200529     C                     MOVE 'N'       BRIN                            CAC005
197500200529     C                     ENDIF                                          CAC005
197600200529     C                     ENDIF                                          CAC005
197700200529      *                                                                   CAC005
197800200529     C                     ENDIF                                          CAC005
197900200529      *                                                                   CAC005
198000200529     C           SBRCD     IFNE *BLANKS                    B*1
198100200529     C           SBRCD     ANDNEHBRCD
198200200529     C***********SBOOK     ORNE *BLANKS                                   CAC005
198300200529     C***********SBOOK     ANDNEHBOOK                                     CAC005
198400200529     C           BRIN      OREQ 'Y'                                       CAC005
198500200529     C           SCNUM     ORNE *BLANKS
198600200529     C           SCNUM     ANDNEHCNUM
198700200529     C           SPTFR     ORNE *BLANKS
198800200529     C           SPTFR     ANDNEHPTFR
198900200529      *
199000200529      ** Possible combinations: Branch, Branch/Book, Branch/Customer,
199100200529      ** Branch/Customer/Book, Book, Customer, Customer/Portfolio
199200200529      *
199300200529     C                     MOVE SBRCD     HBRCD
199400200529     C                     MOVE SBOOK     HBOOK
199500200529     C                     MOVE SCNUM     HCNUM
199600200529     C                     MOVE SPTFR     HPTFR
199700200529     C                     EXSR SRVIEW
199800200529     C                     MOVE *BLANKS   HBRCD
199900200529     C                     MOVE *BLANKS   HBOOK
200000200529     C                     MOVE *BLANKS   HCNUM
200100200529     C                     MOVE *BLANKS   HPTFR
200200200529     C                     ELSE                            X*1
200300200529      *
200400200529     C                     MOVE '0'       *IN62
200500200529     C                     MOVE 'N'       ERROR
200600200529     C                     READCSE7514S1                 33
200700200529      *
200800200529     C           *IN33     IFEQ '0'                        B*2
200900200529     C                     EXSR SRVAC
201000200529      *
201100200529     C           ERROR     IFEQ 'N'                        B*3
201200200529     C                     MOVE ' '       SACDE
201300200529     C                     MOVEA'001'     *IN,57
201400200529     C                     MOVE '0'       *IN62
201500200529     C                     UPDATSE7514S1
201600200529     C                     Z-ADDW1RRN     #1RRN
201700200529     C                     ENDIF                           E*3
201800200529      *
201900200529     C           @RTCD     IFEQ 'U'                        B*3
202000200529     C           @RTCD     OREQ 'W'
202100200529     C                     MOVE '1'       *INKE
202200200529     C                     ENDIF                           E*3
202300200529      *
202400200529     C                     ENDIF                           E*2
202500200529      *
202600200529     C                     ENDIF                           E*1
202700200529      *
202800200529     C                     ENDSR
202900200529      *****************************************************************
203000200529      /EJECT
203100200529      *****************************************************************
203200200529      *                                                               *
203300200529      *            SRVIEW - View subfile from Review from fields      *
203400200529      *                                                               *
203500200529      * CALLS      SRCLSF - Clear Subfile                             *
203600200529      *                                                               *
203700200529      * CALLED BY  SRVALD - Validate action code                      *
203800200529      *                                                               *
203900200529      * FLDS USED         -                                           *
204000200529      *                                                               *
204100200529      *****************************************************************
204200200529     C           SRVIEW    BEGSR
204300200529      *
204400200529      ** Position file cursor
204500200529     C                     MOVE *LOVAL    WBRCD
204600200529     C                     MOVE *LOVAL    WCOTP
204700200529     C                     MOVE *LOVAL    WBOOK
204800200529     C***********          MOVE *LOVAL    WCNUM                                               CSD027
204900200529     C                     MOVE *BLANKS   WCNUM                                               CSD027
205000200529     C                     MOVE *LOVAL    WPTFR
205100200529     C                     MOVE *LOVAL    WDDPT
205200200529     C                     MOVE *LOVAL    WSESN
205300200529      *                                                                   CAC005
205400200529      ** If CAC005 is on, validate screen fields SBOOK and SPRFC relation.CAC005
205500200529      *                                                                   CAC005
205600200529     C           CAC005    IFEQ 'Y'                                       CAC005
205700200529     C                     MOVE *OFF      *IN63                           CAC005
205800200529      *                                                                   CAC005
205900200529     C           SBOOK     IFEQ *BLANKS                                   CAC005
206000200529     C           SPRFC     ANDNE*BLANKS                                   CAC005
206100200529     C                     MOVE *ON       *IN63                           CAC005
206200200529     C***********          MOVEL'PCA0008' ZAMSID                   CAC005 179197
206300200529     C                     MOVEL'PCA0014' ZAMSID                          179197
206400200529     C                     EXSR ZASNMS                                    CAC005
206500200529     C                     MOVE 'Y'       ERROR                           CAC005
206600200529     C                     ENDIF                                          CAC005
206700200529      *                                                                   CAC005
206800200529     C           SBOOK     IFNE *BLANKS                                   CAC005
206900200529     C           SPRFC     ANDEQ*BLANKS                                   CAC005
207000200529     C                     MOVE *ON       *IN63                           CAC005
207100200529     C                     MOVEL'PCA0013' ZAMSID                          CAC005
207200200529     C                     EXSR ZASNMS                                    CAC005
207300200529     C                     MOVE 'Y'       ERROR                           CAC005
207400200529     C                     ENDIF                                          CAC005
207500200529      *                                                                   CAC005
207600200529     C           SBOOK     IFNE *BLANKS                                   CAC005
207700200529     C           SPRFC     ANDNE*BLANKS                                   CAC005
207800200529     C                     CALL 'AOBKPCR0'                                CAC005
207900200529     C                     PARM           PRTCD                           CAC005
208000200529     C                     PARM '*PSEUDO' POPTN                           CAC005
208100200529     C                     PARM SBOOK     PMBKCD                          CAC005
208200200529     C                     PARM SPRFC     PMPRFC                          CAC005
208300200529     C           PMPSBK    PARM *BLANKS   PMPSBK                          CAC005
208400200529     C           PRTCD     IFNE *BLANKS                                   CAC005
208500200529     C                     MOVE *ON       *IN63                           CAC005
208600200529     C                     MOVEL'PCA0012' ZAMSID                          CAC005
208700200529     C                     EXSR ZASNMS                                    CAC005
208800200529     C                     MOVE 'Y'       ERROR                           CAC005
208900200529     C                     ELSE                                           CAC005
209000200529     C                     MOVELPMPSBK    HBOOK                           CAC005
209100200529     C                     ENDIF                                          CAC005
209200200529     C                     ENDIF                                          CAC005
209300200529      *                                                                   CAC005
209400200529     C                     ENDIF                                          CAC005
209500200529      *
209600200529     C           HBRCD     IFEQ *BLANKS                    B*1
209700200529     C           HBOOK     ANDNE*BLANKS
209800200529     C           HBRCD     OREQ *BLANKS
209900200529     C           HCNUM     ANDNE*BLANKS
210000200529     C           HBRCD     OREQ *BLANKS
210100200529     C           HPTFR     ANDNE*BLANKS
210200200529     C                     MOVEA'1'       *IN,20
210300200529     C                     MOVEL'CO00275' ZAMSID
210400200529     C                     EXSR ZASNMS
210500200529     C                     MOVE 'Y'       ERROR
210600200529     C                     ENDIF                           E*1
210700200529      *
210800200529     C           HCNUM     IFNE *BLANKS                    B*1
210900200529     C                     MOVE *BLANKS   ZFIELD
211000200529     C                     MOVE HCNUM     ZFIELD
211100200529     C                     Z-ADD6         ZADIG
211200200529     C                     Z-ADD0         ZADEC
211300200529     C                     EXSR ZALIGN
211400200529      *
211500200529     C           *IN99     IFEQ '1'                        B*2
211600200529     C                     MOVEL'CO00224' ZAMSID
211700200529     C                     EXSR ZASNMS
211800200529     C                     MOVE '1'       *IN22
211900200529     C                     MOVE 'Y'       ERROR
212000200529     C                     ENDIF                           E*2
212100200529      *
212200200529     C                     ENDIF                           E*1
212300200529      *
212400200529     C           HBOOK     IFNE *BLANKS                    B*1
212500200529     C           HCNUM     ANDNE*BLANKS
212600200529     C                     MOVEA'11'      *IN,21
212700200529     C                     MOVEL'CO00222' ZAMSID
212800200529     C                     EXSR ZASNMS
212900200529     C                     MOVE 'Y'       ERROR   1
213000200529     C                     ENDIF                           E*1
213100200529      *
213200200529     C           HPTFR     IFNE *BLANKS                    B*1
213300200529     C           HCNUM     ANDEQ*BLANKS
213400200529     C                     MOVEA'11'      *IN,22
213500200529     C                     MOVEL'CO00223' ZAMSID
213600200529     C                     EXSR ZASNMS
213700200529     C                     MOVE 'Y'       ERROR   1
213800200529     C                     ENDIF                           E*1
213900200529      *
214000200529     C           ERROR     IFEQ 'N'                        B*1
214100200529      *
214200200529      ** Clear Subfile
214300200529     C                     EXSR SRCLSF
214400200529      *
214500200529     C           WWUDCD    IFEQ 'Y'                        B*2
214600200529      *
214700200529      ** If CA is a child, use Security from the Originating CA;          CSE020
214800200529      ** Otherwise, use Security from entry parameter.                    CSE020
214900200529      *                                                                   CSE020
215000200529     C           MAPREF    IFNE *BLANKS                                   CSE020
215100200529     C                     MOVE WOSESN    KUDSN                           CSE020
215200200529     C                     ELSE                                           CSE020
215300200529     C                     MOVE @SESN     KUDSN
215400200529     C                     ENDIF                                          CSE020
215500200529      *                                                                   CSE020
215600200529     C                     MOVE HBRCD     KUDBA
215700200529      *
215800200529     C           HBOOK     IFEQ *BLANKS                    B*3
215900200529     C           HCNUM     ANDEQ*BLANKS
216000200529      *
216100200529      ** Read first record from SECOUPL0
216200200529     C           KEY13     SETLLSECOUPL0
216300200529     C           KUDSN     READESECOUPL0                 32
216400200529      *
216500200529     C           *IN32     IFEQ '0'                        B*4
216600200529     C                     MOVE 'B'       MCCOTP
216700200529     C                     MOVE @PTYP     MCCOAT
216800200529     C                     EXSR SRBLD1
216900200529     C                     ENDIF                           E*4
217000200529      *
217100200529      ** Read first record from SECOCPL0
217200200529     C           KEY13     SETLLSECOCPL0
217300200529     C           KUDSN     READESECOCPL0                 32
217400200529      *
217500200529     C           *IN32     IFEQ '0'                        B*4
217600200529     C                     MOVE 'C'       MCCOTP
217700200529     C                     MOVE @PTYP     MCCOAT
217800200529     C                     EXSR SRBLD2
217900200529     C                     ENDIF                           E*4
218000200529      *
218100200529     C                     ELSE                            X*3
218200200529      *
218300200529     C                     MOVE HBOOK     KUDBK
218400200529     C                     MOVE HCNUM     KCDCN
218500200529     C                     MOVE HPTFR     KPTFR
218600200529      *
218700200529     C           HBOOK     IFNE *BLANKS                    B*4
218800200529      *
218900200529      ** Read first record from SECOUPL0
219000200529     C           KEY11A    SETLLSECOUPL0
219100200529     C           KUDSN     READESECOUPL0                 32
219200200529      *
219300200529     C           *IN32     IFEQ '0'                        B*5
219400200529     C                     MOVE 'B'       MCCOTP
219500200529     C                     MOVE @PTYP     MCCOAT
219600200529     C                     EXSR SRBLD1
219700200529     C                     ENDIF                           E*5
219800200529      *
219900200529      ** Read first record from SECOCPL0
220000200529     C           KUDSN     SETLLSECOCPL0
220100200529     C           KUDSN     READESECOCPL0                 32
220200200529      *
220300200529     C           *IN32     IFEQ '0'                        B*5
220400200529     C                     MOVE 'C'       MCCOTP
220500200529     C                     MOVE @PTYP     MCCOAT
220600200529     C                     EXSR SRBLD2
220700200529     C                     ENDIF                           E*5
220800200529     C                     ELSE                            X*4
220900200529      *
221000200529      ** Read first record from SECOCPL0
221100200529     C           KEY12A    SETLLSECOCPL0
221200200529     C           KUDSN     READESECOCPL0                 32
221300200529      *
221400200529     C           *IN32     IFEQ '0'                        B*5
221500200529     C                     MOVE 'C'       MCCOTP
221600200529     C                     MOVE @PTYP     MCCOAT
221700200529     C                     EXSR SRBLD2
221800200529     C                     ENDIF                           E*5
221900200529     C                     ENDIF                           E*4
222000200529     C                     ENDIF                           E*3
222100200529      *
222200200529      ** If CA is a child, restore KUDSN.                                 CSE020
222300200529      *                                                                   CSE020
222400200529     C           MAPREF    IFNE *BLANKS                                   CSE020
222500200529     C                     MOVE @SESN     KUDSN                           CSE020
222600200529     C                     ENDIF                                          CSE020
222700200529      *                                                                   CSE020
222800200529     C           WWCPT     IFEQ 0                          B*3
222900200529     C                     Z-ADD1         #1RRN
223000200529     C                     MOVE #1RRN     W1RRN   40
223100200529     C                     WRITESE7514S1
223200200529     C                     MOVE '1'       *IN80
223300200529     C                     MOVE '1'       *IN30
223400200529     C                     MOVE '0'       *IN39
223500200529     C                     MOVEL'CO00001' ZAMSID
223600200529     C                     EXSR ZASNMS
223700200529     C                     MOVE 'Y'       ERROR   1
223800200529     C                     ELSE                            X*3
223900200529      *
224000200529     C           *IN32     IFEQ '1'                        B*4
224100200529      *
224200200529     C************IN45     IFEQ '1'                        B*5            161732
224300200529     C***********          EXSR SRRESP                                    161732
224400200529     C***********MCDDPT    IFNE WWDPT                      B*6            161732
224500200529     C***********          Z-ADDMCDDPT    WWDPT                           161732
224600200529     C***********          ADD  1         #1RRN                           161732
224700200529     C***********          ADD  1         WWCPT                           161732
224800200529     C***********          WRITESE7514S1                                  161732
224900200529     C***********          ENDIF                           E*6            161732
225000200529     C***********          ENDIF                           E*5            161732
225100200529      *
225200200529     C                     MOVE '1'       *IN30
225300200529     C                     ENDIF                           E*4
225400200529      *
225500200529     C                     MOVE #1RRN     W1RRN   40
225600200529     C                     MOVE '1'       *IN81
225700200529     C                     ENDIF                           E*3
225800200529      *
225900200529     C                     ELSE                            X*2
226000200529      *
226100200529     C           HBRCD     IFNE *BLANKS                    B*3
226200200529     C                     MOVE HBRCD     WBRCD
226300200529     C                     ENDIF                           E*3
226400200529      *
226500200529     C           HBOOK     IFNE *BLANKS                    B*3
226600200529     C                     MOVE 'B'       WCOTP
226700200529     C                     MOVE HBOOK     WBOOK
226800200529     C                     ENDIF                           E*3
226900200529      *
227000200529     C           HCNUM     IFNE *BLANKS                    B*3
227100200529     C                     MOVE 'C'       WCOTP
227200200529     C                     MOVE HCNUM     WCNUM
227300200529     C                     ENDIF                           E*3
227400200529      *
227500200529     C           HPTFR     IFNE *BLANKS                    B*3
227600200529     C                     MOVE HPTFR     WPTFR
227700200529     C                     ENDIF                           E*3
227800200529      *
227900200529     C           KEY2      SETLLSECOALL2
228000200529     C           KEY1      READESECOALL2                 39
228100200529      *
228200200529      ** Checking for pointer if not in the right position
228300200529     C           WCOTP     IFEQ 'C'                        B*3
228400200529      *
228500200529     C           *IN39     DOWEQ'0'                        B*4
228600200529     C           WCNUM     ANDGTMCCNUM
228700200529     C           WBRCD     ANDEQMCBRCD
228800200529     C           KEY1      READESECOALL2                 39
228900200529     C                     ENDDO                           E*4
229000200529      *
229100200529     C                     ENDIF                           E*3
229200200529     C                     ENDIF                           E*2
229300200529      *
229400200529     C                     MOVE *BLANKS   SBRCD            Review from: Branch
229500200529     C                     MOVE *BLANKS   SBOOK            Book
229600200529     C                     MOVE *BLANKS   SPRFC                           CAC005
229700200529     C                     MOVE *BLANKS   SCNUM            Customer
229800200529     C                     MOVE *BLANKS   SPTFR            Portfolio
229900200529      *
230000200529     C                     ENDIF                           E*1
230100200529      *
230200200529     C                     ENDSR
230300200529      *****************************************************************
230400200529      /EJECT
230500200529      *****************************************************************
230600200529      *                                                               *
230700200529      *            SRVAC  - Validate action code                      *
230800200529      *                                                               *
230900200529      * CALLS      SE7515 - Reply Handling Details Maintenance/Enqy.  *
231000200529      *            SE7541 - Reply Handling History Enquiry            *
231100200529      *            SE7540 - Customer/Book Enquiry                     *
231200200529      *                                                               *
231300200529      * CALLED BY  SRVALD - Validate action code                      *
231400200529      *                                                               *
231500200529      * FLDS USED         -                                           *
231600200529      *                                                               *
231700200529      *****************************************************************
231800200529     C           SRVAC     BEGSR
231900200529      *
232000200529     C           SACDE     IFNE *BLANKS                    B*1
232100200529     C           SACDE     ANDNE'A'
232200200529     C           SACDE     ANDNE'E'
232300200529     C           SACDE     ANDNE'H'
232400200529     C           SACDE     ANDNE'V'
232500200529     C                     MOVEA'001'     *IN,57
232600200529     C                     MOVE '1'       *IN62
232700200529     C                     UPDATSE7514S1
232800200529     C                     MOVEL'CO00221' ZAMSID
232900200529     C                     EXSR ZASNMS
233000200529     C                     MOVE 'Y'       ERROR   1
233100200529     C                     ELSE                            X*1
233200200529     C           SACDE     IFEQ 'A'                        B*2
233300200529     C           HCNUM     ANDEQBVERCU
233400200529     C                     MOVEA'001'     *IN,57
233500200529     C                     MOVE '1'       *IN62
233600200529     C                     UPDATSE7514S1
233700200529     C                     MOVEL'CO00327' ZAMSID
233800200529     C                     EXSR ZASNMS
233900200529     C                     MOVE 'Y'       ERROR   1
234000200529     C                     ELSE                            X*2
234100200529      *
234200200529     C                     MOVE @CORF     PCORF   6
234300200529     C                     MOVE @SESN     PSESN  10
234400200529     C                     MOVE @COAT     PCOAT   2
234500200529     C                     MOVE @PTYP     PPTYP   2
234600200529     C                     MOVE @COEX     PCOEX   5
234700200529     C                     MOVE @STAT     PSTAT   1
234800200529     C                     MOVE SBRCH     PBRCH   3
234900200529     C                     MOVE HDPOT     PDPOT   6
235000200529      *                                                                   161732
235100200529      ** Retrieve total Ex-date position, to be passed to RPG/SE7515      161732
235200200529      *                                                                   161732
235300200529     C                     MOVE SBRCH     WBRCH                           161732
235400200529     C                     MOVE SCUBK     WCUBK                           161732
235500200529     C                     MOVE SPORT     WPORT                           161732
235600200529     C                     MOVE *BLANKS   PEXPS  16                       161732
235700200529     C                     MOVE *BLANKS   WSTR15 15                       161732
235800200529     C                     MOVE *BLANKS   WSTR17 17                       161732
235900200529     C                     Z-ADD1         Y       20                      161732
236000200529     C           WBCBP     LOKUPEXP1,Y                   88               161732
236100200529     C           *IN88     IFEQ *ON                                       161732
236200200529     C                     MOVEAEXP2,Y    WSTR17 17                       161732
236300200529     C                     MOVE WSTR17    WSIGN                           161732
236400200529     C           WSIGN     IFEQ '-'                                       161732
236500200529     C           16        SUBSTWSTR17:2  WSTR15 15                       161732
236600200529     C                     MOVE WSTR15    ZFLD15                          161732
236700200529     C           0         SUB  ZFLD15    ZFLD15                          161732
236800200529     C                     ELSE                                           161732
236900200529     C                     MOVE WSTR17    ZFLD15                          161732
237000200529     C                     ENDIF                                          161732
237100200529     C                     Z-ADDNMDP      ZDECS                           161732
237200200529     C                     EXSR ZSEDIT                                    161732
237300200529     C                     MOVE ZOUT21    PEXPS                           161732
237400200529     C                     ENDIF                                          161732
237500200529      *
237600200529     C           HINDC     IFEQ 'C'                        B*3
237700200529     C                     MOVELHCNUM     PCNUM   6
237800200529     C                     MOVE *BLANKS   PBOOK   2
237900200529     C                     ELSE
238000200529     C                     MOVE *BLANKS   PCNUM
238100200529     C                     MOVELHBOOK     PBOOK
238200200529     C                     ENDIF
238300200529      *
238400200529     C                     MOVE SPORT     PPORT   4
238500200529      *
238600200529     C           P7515     PLIST
238700200529     C                     PARM           PCORF            Reference
238800200529     C                     PARM           PSESN            Security Short.
238900200529     C                     PARM           PCOAT            Corporate Type
239000200529     C                     PARM           PPTYP            Processing Type
239100200529     C                     PARM           PCOEX            Ex-Date
239200200529     C                     PARM           PSTAT            Corporate Action Stat
239300200529     C                     PARM           PBRCH            Branch
239400200529     C                     PARM           PDPOT            Depot
239500200529     C                     PARM           PBOOK            Book
239600200529     C                     PARM           PCNUM            Customer
239700200529     C                     PARM           PPORT            Portfolio
239800200529     C                     PARM           PEXPS            Ex-date Pos'n  161732
239900200529     C                     PARM           PMODE            Mode
240000200529     C                     PARM           PCPGM            Calling Pgm
240100200529     C                     PARM *BLANKS   @RTCD            Return Code
240200200529      *
240300200529     C           SACDE     IFEQ 'A'                        B*4
240400200529     C                     MOVE 'A'       PMODE   1
240500200529     C                     MOVE *BLANKS   PCPGM   6
240600200529     C                     CALL 'SE7515'  P7515
240700200529      *
240800200529     C                     MOVELNARR,1    DBKEY
240900200529     C                     ENDIF                           E*4
241000200529      *
241100200529     C           SACDE     IFEQ 'E'                        B*4
241200200529     C                     MOVE 'E'       PMODE   1
241300200529     C                     MOVE *BLANKS   PCPGM   6
241400200529     C                     CALL 'SE7515'  P7515
241500200529      *
241600200529     C                     MOVELNARR,1    DBKEY
241700200529     C                     ENDIF                           E*4
241800200529      *
241900200529     C           SACDE     IFEQ 'H'                        B*4
242000200529     C                     CALL 'SE7541'
242100200529     C                     PARM           PCORF            CA Reference
242200200529     C                     PARM           PBOOK            Book
242300200529     C                     PARM           PCNUM            Customer NumbeR
242400200529     C                     PARM           PBRCH            Branch
242500200529     C                     PARM           PPORT            Portfolio Reference
242600200529     C                     PARM           PDPOT            Depot
242700200529     C                     PARM *BLANKS   @RTCD            Return Code
242800200529      *
242900200529     C                     MOVELNARR,2    DBKEY
243000200529     C                     ENDIF                           E*4
243100200529      *
243200200529     C           SACDE     IFEQ 'V'                        B*4
243300200529     C           PCORF     CHAINSECOALL1             89                   137877
243400200529      *                                                                   137877
243500200529     C           *IN89     IFEQ '1'                        B*5            137877
243600200529     C                     MOVEA'001'     *IN,57                          137877
243700200529     C                     MOVE '1'       *IN62                           137877
243800200529     C                     UPDATSE7514S1                                  137877
243900200529     C                     MOVEL'CO00256' ZAMSID           Message id.    137877
244000200529     C                     EXSR ZASNMS                     Send message   137877
244100200529     C                     MOVE 'Y'       ERROR   1                       137877
244200200529     C                     ELSE                            E*5            137877
244300200529     C                     MOVE 'SE7514'  PCPGM   6
244400200529     C                     MOVE WOPNB     POPNB   2
244500200529     C                     CALL 'SE7540'
244600200529     C                     PARM           PCORF
244700200529     C                     PARM           POPNB
244800200529     C                     PARM           PBRCH
244900200529     C                     PARM           PBOOK
245000200529     C                     PARM           PCNUM
245100200529     C                     PARM           PPORT
245200200529     C                     PARM           PCPGM
245300200529     C                     PARM *BLANKS   @RTCD
245400200529      *
245500200529     C                     MOVELNARR,3    DBKEY
245600200529     C                     ENDIF                           E*5            137877
245700200529     C                     ENDIF                           E*4
245800200529      *
245900200529     C           @RTCD     IFEQ 'E'
246000200529     C           *INU7     OREQ '1'
246100200529     C           *INU8     OREQ '1'
246200200529     C           *LOCK     IN   LDA
246300200529     C                     Z-ADD011       DBASE            ****************
246400200529     C                     MOVEL*BLANKS   DBFILE           * DB ERROR 011 *
246500200529     C                     OUT  LDA                        ****************
246600200529     C                     EXSR *PSSR
246700200529     C                     ENDIF
246800200529      *
246900200529     C           @RTCD     IFEQ '3'
247000200529     C                     MOVE '1'       *INKC
247100200529     C                     ENDIF                           E*3
247200200529     C                     ENDIF                           E*2
247300200529     C                     ENDIF                           E*1
247400200529      *
247500200529     C                     ENDSR
247600200529      *****************************************************************
247700200529      /EJECT
247800200529      *****************************************************************   161732
247900200529      ************                                                    *   161732
248000200529      ************ SRSAVP - Save previous values of the subfile record*   161732
248100200529      ***********                                                     *   161732
248200200529      **CALLS****         -                                           *   161732
248300200529      ***********                                                     *   161732
248400200529      **CALLLED*BY SRBLDS - Build Subfile                             *   161732
248500200529      ***********  SRPROC - Process read records                      *   161732
248600200529      ***********                                                     *   161732
248700200529      **FLDS*USED         -                                           *   161732
248800200529      ***********                                                     *   161732
248900200529      *****************************************************************   161732
249000200529     C***********SRSAVP    BEGSR                                          161732
249100200529      ***********                                                         161732
249200200529     C***********          MOVE SBRCH     SSBRC   3                       161732
249300200529     C***********          MOVE SCUBK     SSCUB  10                       161732
249400200529     C***********          MOVE SPORT     SSPOR   4                       161732
249500200529     C***********          MOVE SDPOT     SSDPO  10                       161732
249600200529     C***********          MOVE SEXPO     SSEXP  17                       161732
249700200529     C***********          MOVE SC1RE     SSC1R   2                       161732
249800200529     C***********          MOVE SC2RE     SSC2R   2                       161732
249900200529     C***********          MOVE SS1IN     SSS1I   2                       161732
250000200529     C***********          MOVE SS2IN     SSS2I   2                       161732
250100200529     C***********          MOVE HBOOK     SHBOOK  2                       161732
250200200529     C***********          MOVE HCNUM     SHCNUM  6                       161732
250300200529     C***********          MOVE HPORT     SHPOR   4                       161732
250400200529     C***********          MOVE HDPOT     SHDPO   6                       161732
250500200529     C***********          MOVE HEXPO     SHEXP  17                       161732
250600200529     C***********          MOVE '1'       *IN45                           161732
250700200529     C***********          MOVEA*IN,57    IND,1                           161732
250800200529      ***********                                                         161732
250900200529     C***********          ENDSR                                          161732
251000200529      *****************************************************************   161732
251100200529      */EJECT****                                                         161732
251200200529      *****************************************************************   161732
251300200529      ***********                                                     *   161732
251400200529      ***********  SRRESP - Restore previous values of the subfile    *   161732
251500200529      ***********           record                                    *   161732
251600200529      ***********                                                     *   161732
251700200529      **CALLS****         -                                           *   161732
251800200529      ***********                                                     *   161732
251900200529      **CALLLED*BY SRBLDS - Build Subfile                             *   161732
252000200529      ***********                                                     *   161732
252100200529      **FLDS*USED         -                                           *   161732
252200200529      ***********                                                     *   161732
252300200529      *****************************************************************   161732
252400200529     C***********SRRESP    BEGSR                                          161732
252500200529      ***********                                                         161732
252600200529     C***********          MOVE SSBRC     SBRCH                           161732
252700200529     C***********          MOVE SSCUB     SCUBK                           161732
252800200529     C***********          MOVE SSPOR     SPORT                           161732
252900200529     C***********          MOVE SSDPO     SDPOT                           161732
253000200529     C***********          MOVE SSEXP     SEXPO                           161732
253100200529     C***********          MOVE SSC1R     SC1RE                           161732
253200200529     C***********          MOVE SSC2R     SC2RE                           161732
253300200529     C***********          MOVE SSS1I     SS1IN                           161732
253400200529     C***********          MOVE SSS2I     SS2IN                           161732
253500200529     C***********          MOVE SHBOOK    HBOOK                           161732
253600200529     C***********          MOVE SHCNUM    HCNUM                           161732
253700200529     C***********          MOVE SHPOR     HPORT                           161732
253800200529     C***********          MOVE SHDPO     HDPOT                           161732
253900200529     C***********          MOVE SHEXP     HEXPO                           161732
254000200529     C***********          MOVE '0'       *IN45                           161732
254100200529     C***********          MOVEAIND,1     *IN,57                          161732
254200200529      ***********                                                         161732
254300200529     C***********          ENDSR                                          161732
254400200529      *****************************************************************   161732
254500200529      */EJECT****                                                         161732
254600200529      *****************************************************************
254700200529      *                                                               *
254800200529      *            SRRPLY - Retrieve the standard instructions        *
254900200529      *                     reply for level 2 for Books & Customers   *
255000200529      *                                                               *
255100200529      * CALLS                                                         *
255200200529      *                                                               *
255300200529      * CALLED BY                                                     *
255400200529      *                                                               *
255500200529      * FLDS USED         -                                           *
255600200529      *                                                               *
255700200529      *****************************************************************
255800200529     C           SRRPLY    BEGSR
255900200529      *
256000200529     C                     Z-ADD0         WCAPR   52       Cash %
256100200529      *
256200200529      *****If Customer/Book Current Reply exists.                         155622
256300200529     C*****      EXBCRE    IFEQ 'Y'                        B*1            155622
256400200529      *****                                                               155622
256500200529      *****Set SS1IN : Option for Actual Allocation 1 to Reply Option Leve155622
256600200529     C*****      MQR1RE    IFNE *BLANKS                            137877 155622
256700200529     C*****                MOVE *BLANKS   ZFIELD                          155622
256800200529     C*****                MOVE MQR1RE    ZFIELD                          155622
256900200529     C*****                Z-ADD2         ZADIG                           155622
257000200529     C*****                Z-ADD*ZEROS    ZADEC                           155622
257100200529     C*****                EXSR ZEDIT                                     155622
257200200529     C*****                MOVEL*BLANKS   SS1IN                           155622
257300200529     C*****                MOVE ZFIELD    SS1IN            Opt.for Actual 155622
257400200529     C*****                ELSE                                    137877 155622
257500200529     C*****                MOVE *BLANKS   SS1IN                    137877 155622
257600200529     C*****                ENDIF                                   137877 155622
257700200529      *****                                                               155622
257800200529      *****Else, if Customer/Book Current Reply does not exists.          155622
257900200529     C*****                ELSE                            X*1            155622
258000200529      *
258100200529      ***  If Customer/Book Standard Corporate Actions Instruction exists.
258200200529     C           EXBCSI    IFEQ 'Y'                        B*2
258300200529      *
258400200529      ***  If Cash Preferred % is > or = 50, set Option for Actual Allocation 1 to Default
258500200529      ***  Cash Preferred from SECORFL1.
258600200529     C           MOCAPP    IFGE 50                         B*3
258700200529     C                     MOVE MADFCP    SS1IN     P
258800200529      *
258900200529      ***  If Cash Preferred % is < 50, set Option for Actual Allocation 1 to Default Stock
259000200529      ***  Preferred from SECORFL1.
259100200529     C                     ELSE                            X*3
259200200529     C                     MOVE MADFSP    SS1IN     P
259300200529     C                     ENDIF                           E*3
259400200529      *
259500200529      *****Else, if Customer/Book Standard Corporate Actions Instruction d155622
259600200529      *****Customer/Book Current Reply does not exist).                   155622
259700200529     C*****                ELSE                            X*2            155622
259800200529      *****                                                               155622
259900200529      *****Set Option for Actual Allocation 1 to Default for No Reply from155622
260000200529     C*****                MOVE MADFNR    SS1IN     P                     155622
260100200529      *
260200200529     C                     ENDIF                           E*2
260300200529     C*****                ENDIF                           E*1            155622
260400200529      *
260500200529      ***  If Processing Type = Non Financial Events and Customer/Book Current Reply exists,
260600200529      ***  set Cash % to Reply Cash % Level 2.
260700200529     C           MAPTYP    IFEQ 'NF'                       B*1
260800200529     C           EXBCRE    ANDEQ'Y'
260900200529     C                     Z-ADDMQR2CA    WCAPR
261000200529     C                     ENDIF                           E*1
261100200529      *
261200200529      ***  If Processing Type = Dividends Events, Rights Issues, Offers or Exercices and
261300200529      ***  Conversions.
261400200529     C           MAPTYP    IFEQ 'DV'                       B*1 Dividend Events
261500200529     C           MAPTYP    OREQ 'RG'                       Rights Issues
261600200529     C           MAPTYP    OREQ 'OF'                       Offers
261700200529     C           MAPTYP    OREQ 'EX'                       Exercice and Conversion
261800200529      *
261900200529      *****CASE 1: If Customer/Booh Current Reply exists.                 155622
262000200529     C*****      EXBCRE    IFEQ 'Y'                        B*2            155622
262100200529      *****                                                               155622
262200200529      *****Set Option for Actual Allocation 2 to Reply Option Level 2.    155622
262300200529     C*****      MQR2RE    IFNE *BLANKS                            137877 155622
262400200529     C*****                MOVE *BLANKS   ZFIELD                          155622
262500200529     C*****                MOVE MQR2RE    ZFIELD                          155622
262600200529     C*****                Z-ADD2         ZADIG                           155622
262700200529     C*****                Z-ADD*ZEROS    ZADEC                           155622
262800200529     C*****                EXSR ZEDIT                                     155622
262900200529     C*****                MOVEL*BLANKS   SS2IN                           155622
263000200529     C*****                MOVE ZFIELD    SS2IN            Opt.for Actual 155622
263100200529     C*****                ELSE                                    137877 155622
263200200529     C*****                MOVE *BLANKS   SS2IN                    137877 155622
263300200529     C*****                ENDIF                                   137877 155622
263400200529      *****                                                               155622
263500200529      *****If Processing Type = Dividend Events.                          155622
263600200529     C*****      MAPTYP    IFEQ 'DV'                       B*3            155622
263700200529      *****                                                               155622
263800200529      *****If Option 1 selected: Cash Payment/Sell Rights, set Cash % to  155622
263900200529     C*****      MDOPT1    IFEQ 'Y'                        B*4            155622
264000200529     C*****                Z-ADD100       WCAPR                           155622
264100200529     C*****                ELSE                            X*4            155622
264200200529      *****                                                               155622
264300200529      *****If Option 5 selected: Take Part Cash/Rest Stock, set Cash % to 155622
264400200529     C*****      MDOPT5    IFEQ 'Y'                        B*5            155622
264500200529     C*****                Z-ADDMQR2CA    WCAPR                           155622
264600200529     C*****                ELSE                            X*5            155622
264700200529      *****                                                               155622
264800200529      *****If Option selected is 2: Take Stock+Buy Additional Rights or 3:155622
264900200529      *****Rights or 4: Take Stock, set Cash % to 0.                      155622
265000200529     C*****      MDOPT2    IFEQ 'Y'                        B*6            155622
265100200529     C*****      MDOPT3    OREQ 'Y'                                       155622
265200200529     C*****      MDOPT4    OREQ 'Y'                                       155622
265300200529     C*****                Z-ADD0         WCAPR                           155622
265400200529     C*****                ENDIF                           E*6            155622
265500200529     C*****                ENDIF                           E*5            155622
265600200529     C*****                ENDIF                           E*4            155622
265700200529     C*****                ELSE                            X*3            155622
265800200529      *****                                                               155622
265900200529      *****If Processing Type = Rights Issues.                            155622
266000200529     C*****      MAPTYP    IFEQ 'RG'                       B*4            155622
266100200529      *****                                                               155622
266200200529      *****If Option 1 selected: Sell all Rights, set Cash % to 100.      155622
266300200529     C*****      MFOPT1    IFEQ 'Y'                        B*5            155622
266400200529     C*****                Z-ADD100       WCAPR                           155622
266500200529     C*****                ELSE                            X*5            155622
266600200529      *****                                                               155622
266700200529      *****If Option selected is 5: Take Part Cash/Rest Stock or 6: Take P155622
266800200529      *****set Cash % to Reply Cash % Level 2.                            155622
266900200529     C*****      MFOPT5    IFEQ 'Y'                        B*6            155622
267000200529     C*****      MFOPT6    OREQ 'Y'                                       155622
267100200529     C*****                Z-ADDMQR2CA    WCAPR                           155622
267200200529     C*****                ELSE                            X*6            155622
267300200529      *****                                                               155622
267400200529      *****If Option selected is 2: Take Stock+Buy Fraction or 3: Take Sto155622
267500200529      *****Take Stock or 7: Do nothing, set Cash % to 0.                  155622
267600200529     C*****      MFOPT2    IFEQ 'Y'                        B*7            155622
267700200529     C*****      MFOPT3    OREQ 'Y'                                       155622
267800200529     C*****      MFOPT4    OREQ 'Y'                                       155622
267900200529     C*****      MFOPT7    OREQ 'Y'                                       155622
268000200529     C*****                Z-ADD0         WCAPR                           155622
268100200529     C*****                ENDIF                           E*7            155622
268200200529     C*****                ENDIF                           E*6            155622
268300200529     C*****                ENDIF                           E*5            155622
268400200529     C*****                ELSE                            X*4            155622
268500200529      *****                                                               155622
268600200529      *****If Processing Type = Offers.                                   155622
268700200529     C*****      MAPTYP    IFEQ 'OF'                       B*5            155622
268800200529      *****                                                               155622
268900200529      *****If Option 1 selected: Accept Offer, set Cash % to 100.         155622
269000200529     C*****      MIOPT1    IFEQ 'Y'                        B*6            155622
269100200529     C*****                Z-ADD100       WCAPR                           155622
269200200529     C*****                ELSE                            X*6            155622
269300200529      *****                                                               155622
269400200529      *****If Option 3 selected: Partial Accept Offer, set Cash % to Reply155622
269500200529     C*****      MIOPT3    IFEQ 'Y'                        B*7            155622
269600200529     C*****                Z-ADDMQR2CA    WCAPR                           155622
269700200529     C*****                ELSE                            X*7            155622
269800200529      *****                                                               155622
269900200529      *****If Option 2 selected: Refuse Offer, set Cash % to 0.           155622
270000200529     C*****      MIOPT2    IFEQ 'Y'                        B*8            155622
270100200529     C*****                Z-ADD0         WCAPR                           155622
270200200529     C*****                ENDIF                           E*8            155622
270300200529     C*****                ENDIF                           E*7            155622
270400200529     C*****                ENDIF                           E*6            155622
270500200529     C*****                ELSE                            X*5            155622
270600200529      *****                                                               155622
270700200529      *****If Processing Type = Exercices and Conversions.                155622
270800200529     C*****      MAPTYP    IFEQ 'EX'                       B*6            155622
270900200529      *****                                                               155622
271000200529      *****If Option 1 selected: Sell all Rights, set Cash % to 100.      155622
271100200529     C*****      MJOPT1    IFEQ 'Y'                        B*7            155622
271200200529     C*****                Z-ADD100       WCAPR                           155622
271300200529     C*****                ELSE                            X*7            155622
271400200529      *****                                                               155622
271500200529      *****If Option selected is 5: Take Part Cash/Rest Stock or 6: Take P155622
271600200529      *****set Cash % to Reply Cash % Level 2.                            155622
271700200529     C*****      MJOPT5    IFEQ 'Y'                        B*8            155622
271800200529     C*****      MJOPT6    OREQ 'Y'                                       155622
271900200529     C*****                Z-ADDMQR2CA    WCAPR                           155622
272000200529     C*****                ELSE                            X*8            155622
272100200529      *****                                                               155622
272200200529      *****If Option selected is 2: Take Stock+Buy Fraction or 3: Take Sto155622
272300200529      *****Take Stock or 7: Do nothing, set Cash % to 0.                  155622
272400200529     C*****      MJOPT2    IFEQ 'Y'                        B*9            155622
272500200529     C*****      MJOPT3    OREQ 'Y'                                       155622
272600200529     C*****      MJOPT4    OREQ 'Y'                                       155622
272700200529     C*****      MJOPT7    OREQ 'Y'                                       155622
272800200529     C*****                Z-ADD0         WCAPR                           155622
272900200529     C*****                ENDIF                           E*9            155622
273000200529     C*****                ENDIF                           E*8            155622
273100200529     C*****                ENDIF                           E*7            155622
273200200529     C*****                ENDIF                           E*6            155622
273300200529     C*****                ENDIF                           E*5            155622
273400200529     C*****                ENDIF                           E*4            155622
273500200529     C*****                ENDIF                           E*3            155622
273600200529      *****                                                               155622
273700200529      *****CASE 2: Else, if Customer/Book Current Reply does not exist.   155622
273800200529     C*****                ELSE                            X*2            155622
273900200529      *****                                                               155622
274000200529      *****Set Option for Actual Allocation 2 to Default for No Reply from155622
274100200529      *****(where xx = 'DV', 'RG', 'EX' or 'OF').                         155622
274200200529     C*****                SELEC                           B*3            155622
274300200529     C*****      @PTYP     WHEQ 'DV'                                      155622
274400200529     C*****                MOVE MDDFNR    SS2IN     P                     155622
274500200529      *****                                                               155622
274600200529     C*****      @PTYP     WHEQ 'RG'                                      155622
274700200529     C*****                MOVE MFDFNR    SS2IN     P                     155622
274800200529      *****                                                               155622
274900200529     C*****      @PTYP     WHEQ 'OF'                                      155622
275000200529     C*****                MOVE MIDFNR    SS2IN     P                     155622
275100200529      *****                                                               155622
275200200529     C*****      @PTYP     WHEQ 'EX'                                      155622
275300200529     C*****                MOVE MJDFNR    SS2IN     P                     155622
275400200529     C*****                ENDSL                           E*3            155622
275500200529      *
275600200529      ***  CASE 2.1: If Customer/Book Standard Corporate Actions Instruction exists (and Customer/
275700200529      ***            Book Current Reply does not exist).
275800200529     C           EXBCSI    IFEQ 'Y'                        B*3
275900200529      *
276000200529      ***  Set Cash % to Cash Preferred % from SECOSIL1.
276100200529     C                     Z-ADDMOCAPP    WCAPR
276200200529      *
276300200529      ***  If Processing Type = Dividend Events.
276400200529     C           MAPTYP    IFEQ 'DV'                       B*4
276500200529      *
276600200529      ***  If Stock Dividend Type = Stock for Stock or Combined for Cash and Stock, set Cash % to 0.
276700200529     C           MDSDIT    IFEQ 'S'                        B*5 Stock for Stock
276800200529     C           MDSDIT    OREQ 'C'                        Combined for Cash and Stock
276900200529     C                     Z-ADD0         WCAPR
277000200529     C                     ENDIF                           E*5
277100200529      *
277200200529      ***  If Cash % is < 50.
277300200529     C           WCAPR     IFLT 50                         B*5
277400200529      *
277500200529      ***  If Option 5 not allowed, set Cash % to 0.
277600200529     C           MDOPT5    IFNE 'Y'                        B*6
277700200529     C                     Z-ADD0         WCAPR
277800200529     C                     ELSE                            X*6
277900200529      *
278000200529      ***  If Option 5 allowed and Cash % not 0, default Option for Actual allocation 2 is '5'
278100200529      ***  (Cash % already = Cash Preferred % from Standard Instruction (SECOSIL1)).
278200200529     C           WCAPR     IFNE 0                          B*7
278300200529     C                     MOVE ' 5'      SS2IN
278400200529     C                     ENDIF                           E*7
278500200529     C                     ENDIF                           E*6
278600200529     C                     ELSE                            X*5
278700200529      *
278800200529      ***  If Cash % > 50.
278900200529     C           WCAPR     IFGT 50                         B*6
279000200529      *
279100200529      ***  If Option 5 not allowed, set Cash % to 100.
279200200529     C           MDOPT5    IFNE 'Y'                        B*7
279300200529     C                     Z-ADD100       WCAPR
279400200529     C                     ELSE                            X*7
279500200529      *
279600200529      ***  If Option 5 allowed and Cash % not 100, default Option for Actual allocation 2 is '5'
279700200529      ***  (Cash % already = Cash Preferred % from Standard Instruction (SECOSIL1)).
279800200529     C           WCAPR     IFNE 100                        B*8
279900200529     C                     MOVE ' 5'      SS2IN
280000200529     C                     ENDIF                           E*8
280100200529     C                     ENDIF                           E*7
280200200529     C                     ENDIF                           E*6
280300200529     C                     ENDIF                           E*5
280400200529      *
280500200529      ***  If Cash % is 0 (means it is Stock Preferred).
280600200529     C           WCAPR     IFEQ 0                          B*5
280700200529      *
280800200529      ***  If Rounding Option from SECOSIL1 = 'U' and Option 2 is allowed, default Option for
280900200529      ***  Actual Allocation 2 is '2' (Cash % is already 0).
281000200529     C           MOROOP    IFEQ 'U'                        B*6
281100200529     C           MDOPT2    IFEQ 'Y'                        B*7
281200200529     C                     MOVE ' 2'      SS2IN
281300200529     C                     ELSE                            X*7
281400200529      *
281500200529      ***  If Rounding Option is 'U' and Option 2 is not allowed and Option 4 is allowed, default
281600200529      ***  Option for Actual Allocation 2 is '4' (Cash % is already 0).
281700200529     C           MDOPT4    IFEQ 'Y'                        B*8
281800200529     C                     MOVE ' 4'      SS2IN
281900200529     C                     ELSE                            X*8
282000200529      *
282100200529      ***  If Rounding Option is 'U' and Options 2 and 4 are not allowed and Option 3 is allowed,
282200200529      ***  default Option for Actual Allocation 2 is '3' (Cash % is already 0).
282300200529     C           MDOPT3    IFEQ 'Y'                        B*9
282400200529     C                     MOVE ' 3'      SS2IN
282500200529     C                     ELSE                            X*9
282600200529      *
282700200529      ***  If Rounding Option is 'U' and Options 2, 4 and 3 are not allowed and Option 5 is allowed,
282800200529      ***  default Option for Actual Allocation 2 is '5' and Set Cash % to Cash Preferred % from
282900200529      ***  Standard Instruction (SECOSIL1).
283000200529     C           MDOPT5    IFEQ 'Y'                        B*10
283100200529     C                     MOVE ' 5'      SS2IN
283200200529     C                     Z-ADDMOCAPP    WCAPR
283300200529     C                     ELSE                            X*10
283400200529      *
283500200529      ***  If Rounding Option is 'U' and Options 2, 4, 3 and 5 are not allowed and Option 1 is
283600200529      ***  allowed, default Option for Actual Allocation 2 is '1' and Set Cash % to 100.
283700200529     C           MDOPT1    IFEQ 'Y'                        B*11
283800200529     C                     MOVE ' 1'      SS2IN
283900200529     C                     Z-ADD100       WCAPR
284000200529     C                     ELSE                            X*11
284100200529      *
284200200529      ***  If Rounding Option is 'U' and Options 2, 4, 3, 5 and 1 are not allowed, default
284300200529      ***  Option for Actual Allocation 2 is blank.
284400200529     C                     MOVE '  '      SS2IN
284500200529     C                     ENDIF                           E*11
284600200529     C                     ENDIF                           E*10
284700200529     C                     ENDIF                           E*9
284800200529     C                     ENDIF                           E*8
284900200529     C                     ENDIF                           E*7
285000200529     C                     ENDIF                           E*6
285100200529      *
285200200529      ***  If Rounding Option from SECOSIL1 = 'D' and Option 3 is allowed, default Option for
285300200529      ***  Actual Allocation 2 is '3' (Cash % is already 0).
285400200529     C           MOROOP    IFEQ 'D'                        B*6
285500200529     C           MDOPT3    IFEQ 'Y'                        B*7
285600200529     C                     MOVE ' 3'      SS2IN
285700200529     C                     ELSE                            X*7
285800200529      *
285900200529      ***  If Rounding Option is 'D' and Option 3 is not allowed and Option 4 is allowed, default
286000200529      ***  Option for Actual Allocation 2 is '4' (Cash % is already 0).
286100200529     C           MDOPT4    IFEQ 'Y'                        B*8
286200200529     C                     MOVE ' 4'      SS2IN
286300200529     C                     ELSE                            X*8
286400200529      *
286500200529      ***  If Rounding Option is 'D' and Options 3 and 4 are not allowed and Option 2 is allowed,
286600200529      ***  default Option for Actual Allocation 2 is '2' (Cash % is already 0).
286700200529     C           MDOPT2    IFEQ 'Y'                        B*9
286800200529     C                     MOVE ' 2'      SS2IN
286900200529     C                     ELSE                            X*9
287000200529      *
287100200529      ***  If Rounding Option is 'D' and Options 3, 4 and 2 are not allowed and Option 5 is allowed,
287200200529      ***  default Option for Actual Allocation 2 is '5' and Set Cash % to Cash Preferred % from
287300200529      ***  Standard Instruction (SECOSIL1).
287400200529     C           MDOPT5    IFEQ 'Y'                        B*10
287500200529     C                     MOVE ' 5'      SS2IN
287600200529     C                     Z-ADDMOCAPP    WCAPR
287700200529     C                     ELSE                            X*10
287800200529      *
287900200529      ***  If Rounding Option is 'D' and Options 3, 4, 2 and 5 are not allowed and Option 1 is
288000200529      ***  allowed, default Option for Actual Allocation 2 is '1' and Set Cash % to 100.
288100200529     C           MDOPT1    IFEQ 'Y'                        B*11
288200200529     C                     MOVE ' 1'      SS2IN
288300200529     C                     Z-ADD100       WCAPR
288400200529     C                     ELSE                            X*11
288500200529      *
288600200529      ***  If Rounding Option is 'D' and Options 3, 4, 2, 5 and 1 are not allowed, default
288700200529      ***  Option for Actual Allocation 2 is blank.
288800200529     C                     MOVE '  '      SS2IN
288900200529     C                     ENDIF                           E*11
289000200529     C                     ENDIF                           E*10
289100200529     C                     ENDIF                           E*9
289200200529     C                     ENDIF                           E*8
289300200529     C                     ENDIF                           E*7
289400200529     C                     ENDIF                           E*6
289500200529     C                     ELSE                            X*5
289600200529      *
289700200529      ***  If Cash % is 100 (means it is Cash Preferred).
289800200529     C           WCAPR     IFEQ 100                        B*6
289900200529      *
290000200529      ***  If Option 1 allowed, default Option for Actual Allocation 2 is '1' (Cash % is already
290100200529      ***  100).
290200200529     C           MDOPT1    IFEQ 'Y'                        B*7
290300200529     C                     MOVE ' 1'      SS2IN
290400200529     C                     ELSE                            X*7
290500200529      *
290600200529      ***  If Option 1 not allowed and Option 5 allowed, default Option for Actual Allocation 2 is
290700200529      ***  '5' and set Cash % to Cash Preferred % from Standard Instruction (SECOSIL1).
290800200529     C           MDOPT5    IFEQ 'Y'                        B*8
290900200529     C                     MOVE ' 5'      SS2IN
291000200529     C                     Z-ADDMOCAPP    WCAPR
291100200529     C                     ELSE                            X*8
291200200529      *
291300200529      ***  If Option 1 and 5 not allowed, set Cash % to 0.
291400200529     C                     Z-ADD0         WCAPR
291500200529     C                     ENDIF                           E*8
291600200529     C                     ENDIF                           E*7
291700200529     C                     ENDIF                           E*6
291800200529     C                     ENDIF                           E*5
291900200529     C                     ELSE                            X*4
292000200529      *
292100200529      ***  If Processing Type = Offers.
292200200529     C           MAPTYP    IFEQ 'OF'                       B*5
292300200529      *
292400200529      ***  If % Accepted is < 50.
292500200529     C           WCAPR     IFLT 50                         B*6
292600200529      *
292700200529      ***  If Option 3 is not allowed, default as per % Accepted is 0.
292800200529     C           MIOPT3    IFNE 'Y'                        B*7
292900200529     C                     Z-ADD0         WCAPR
293000200529     C                     ELSE                            X*7
293100200529      *
293200200529      ***  If Option 3 is allowed and % Accepted is not 0, default Option for Actual Allocation 2 is
293300200529      ***  '3' (% Accepted already = Cash Preferred % from Standard Instruction (SECOSIL1)).
293400200529     C           WCAPR     IFNE 0                          B*8
293500200529     C                     MOVE ' 2'      SS2IN
293600200529     C                     ENDIF                           E*8
293700200529     C                     ENDIF                           E*7
293800200529     C                     ELSE                            X*6
293900200529      *
294000200529      ***  If % Accepted is > 50.
294100200529     C           WCAPR     IFGT 50                         B*7
294200200529      *
294300200529      ***  If Option 3 is not allowed (and % Accepted is > 50), default as per % Accepted is 100.
294400200529     C           MIOPT3    IFNE 'Y'                        B*8
294500200529     C                     Z-ADD100       WCAPR
294600200529     C                     ELSE                            X*8
294700200529      *
294800200529      ***  If Option 3 is allowed and % Accepted is not 100, default Option for Actual Allocation 2
294900200529      ***  is '3' (% Accepted already = Cash Preferred % from Standard Instruction (SECOSIL1)).
295000200529     C           WCAPR     IFNE 100                        B*9
295100200529     C                     MOVE ' 3'      SS2IN
295200200529     C                     ENDIF                           E*9
295300200529     C                     ENDIF                           E*8
295400200529     C                     ENDIF                           E*7
295500200529     C                     ENDIF                           E*6
295600200529      *
295700200529      ***  If % Accepted is 0 (means it is refused).
295800200529     C           WCAPR     IFEQ 0                          B*6
295900200529      *
296000200529      ***  If Option 2 allowed, default Option for Actual Allocation 2 is '2' (% Accepted is
296100200529      ***  already 0).
296200200529     C           MIOPT2    IFEQ 'Y'                        B*7
296300200529     C                     MOVE ' 2'      SS2IN
296400200529     C                     ELSE                            X*7
296500200529      *
296600200529      ***  If Option 2 is not allowed and Option 3 is allowed, default Option for Actual Allocation
296700200529      ***  2 is '3' and set % Accepted to Cash Preferred % from Standard Instruction (SECOSIL1).
296800200529     C           MIOPT3    IFEQ 'Y'                        B*8
296900200529     C                     MOVE ' 3'      SS2IN
297000200529     C                     Z-ADDMOCAPP    WCAPR
297100200529     C                     ELSE                            X*8
297200200529      *
297300200529      ***  If Option 2 and 3 are not allowed and Option 1 is allowed, default Option for Actual
297400200529      ***   Allocation 2 is '1' and set % Accepted to 100.
297500200529     C           MIOPT1    IFEQ 'Y'                        B*9
297600200529     C                     MOVE ' 1'      SS2IN
297700200529     C                     Z-ADD100       WCAPR
297800200529     C                     ELSE                            X*9
297900200529      *
298000200529      ***  If Option 2, 3 and 1 are not allowed, default Option for Actual Allocation 2 is blank.
298100200529     C                     MOVE '   '     SS2IN
298200200529     C                     ENDIF                           E*9
298300200529     C                     ENDIF                           E*8
298400200529     C                     ENDIF                           E*7
298500200529     C                     ELSE                            X*6
298600200529      *
298700200529      ***  If % Accepted is 100 (means it is Cash Preferred).
298800200529     C           WCAPR     IFEQ 100                        B*7
298900200529      *
299000200529      ***  If Option 1 is allowed, default Option for Actual Allocation 2 is '1' (% Accepted is
299100200529      ***  already 100).
299200200529     C           MIOPT1    IFEQ 'Y'                        B*8
299300200529     C                     MOVE ' 1'      SS2IN
299400200529     C                     ELSE                            X*8
299500200529      *
299600200529      ***  If Option 1 is not allowed and Option 3 is allowed, default Option for Actual Allocation
299700200529      ***  2 is '3' and set % Accepted to Cash Preferred % from Standard Instruction (SECOSIL1).
299800200529     C           MIOPT3    IFEQ 'Y'                        B*9
299900200529     C                     MOVE ' 3'      SS2IN
300000200529     C                     Z-ADDMOCAPP    WCAPR
300100200529     C                     ELSE                            X*9
300200200529      *
300300200529      ***  If Option 1 and 3 are not allowed and Option 2 is allowed, default Option for Actual
300400200529      ***  Allocation 2 is '2' and set % Accepted to 0.
300500200529     C           MIOPT2    IFEQ 'Y'                        B*10
300600200529     C                     MOVE ' 2'      SS2IN
300700200529     C                     Z-ADD0         WCAPR
300800200529     C                     ELSE                            X*10
300900200529      *
301000200529      ***  If Option 1, 3 and 2 are not allowed, default Option for Actual Allocation is blank.
301100200529     C                     MOVE '  '      SS2IN
301200200529     C                     ENDIF                           E*10
301300200529     C                     ENDIF                           E*9
301400200529     C                     ENDIF                           E*8
301500200529     C                     ENDIF                           E*7
301600200529     C                     ENDIF                           E*6
301700200529     C                     ELSE                            X*5
301800200529      *
301900200529      ***  If Processing Type = Rights Issues or Exercices and Conversions.
302000200529     C           MAPTYP    IFEQ 'RG'                       B*6
302100200529     C           MAPTYP    OREQ 'EX'
302200200529      *
302300200529      ***  If Cash % is < 50.
302400200529     C           WCAPR     IFLT 50                         B*7
302500200529      *
302600200529      ***  If Option 5 and 6 are not allowed, default as per Cash % is 0.
302700200529     C           MFOPT5    IFNE 'Y'                        B*8
302800200529     C           MFOPT6    ANDNE'Y'
302900200529     C           MAPTYP    ANDEQ'RG'
303000200529     C           MJOPT5    ORNE 'Y'
303100200529     C           MJOPT6    ANDNE'Y'
303200200529     C           MAPTYP    ANDEQ'EX'
303300200529     C                     Z-ADD0         WCAPR
303400200529     C                     ENDIF                           E*8
303500200529      *
303600200529      ***  If Option 5 and 6 are allowed and Cash % is not 0.
303700200529     C           MFOPT5    IFEQ 'Y'                        B*8
303800200529     C           MFOPT6    ANDEQ'Y'
303900200529     C           WCAPR     ANDNE0
304000200529     C           MAPTYP    ANDEQ'RG'
304100200529     C           MJOPT5    OREQ 'Y'
304200200529     C           MJOPT6    ANDEQ'Y'
304300200529     C           WCAPR     ANDNE0
304400200529     C           MAPTYP    ANDEQ'EX'
304500200529      *
304600200529      ***  If Convertible/Keep Indicator from Standard Instruction (SECOSIL1) is 'C', default
304700200529      ***  Option for Actual Allocation 2 is '5' (Cash % already = Cash Preferred % from Standard
304800200529      ***  Instruction (SECOSIL1)).
304900200529     C           MOCKIN    IFEQ 'C'                        B*9
305000200529     C                     MOVE ' 5'      SS2IN
305100200529     C                     ENDIF                           E*9
305200200529      *
305300200529      ***  If Convertible/Keep Indicator from Standard Instruction (SECOSIL1) is 'K', default
305400200529      ***  Option for Actual Allocation 2 is '6' (Cash % already = Cash Preferred % from Standard
305500200529      ***  Instruction (SECOSIL1)).
305600200529     C           MOCKIN    IFEQ 'K'                        B*9
305700200529     C                     MOVE ' 6'      SS2IN
305800200529     C                     ENDIF                           E*9
305900200529     C                     ENDIF                           E*8
306000200529     C                     ELSE                            X*7
306100200529      *
306200200529      ***  If Cash % is > 50.
306300200529     C           WCAPR     IFGT 50                         B*8
306400200529      *
306500200529      ***  If Option 5 and 6 are not allowed, default as per Cash % is 100.
306600200529     C           MFOPT5    IFNE 'Y'                        B*9
306700200529     C           MFOPT6    ANDNE'Y'
306800200529     C           MAPTYP    ANDEQ'RG'
306900200529     C           MJOPT5    ORNE 'Y'
307000200529     C           MJOPT6    ANDNE'Y'
307100200529     C           MAPTYP    ANDEQ'EX'
307200200529     C                     Z-ADD100       WCAPR
307300200529     C                     ENDIF                           E*9
307400200529      *
307500200529      ***  If Option 5 and 6 are allowed and Cash % is not 0.
307600200529     C           MFOPT5    IFEQ 'Y'                        B*9
307700200529     C           MFOPT6    ANDEQ'Y'
307800200529     C           WCAPR     ANDNE100
307900200529     C           MAPTYP    ANDEQ'RG'
308000200529     C           MJOPT5    OREQ 'Y'
308100200529     C           MJOPT6    ANDEQ'Y'
308200200529     C           WCAPR     ANDNE100
308300200529     C           MAPTYP    ANDEQ'EX'
308400200529      *
308500200529      ***  If Convertible/Keep Indicator from Standard Instruction (SECOSIL1) is 'C', default
308600200529      ***  Option for Actual Allocation 2 is '5' (Cash % already = Cash Preferred % from Standard
308700200529      ***  Instruction (SECOSIL1)).
308800200529     C           MOCKIN    IFEQ 'C'                        B*10
308900200529     C                     MOVE ' 5'      SS2IN
309000200529     C                     ENDIF                           E*10
309100200529      *
309200200529      ***  If Convertible/Keep Indicator from Standard Instruction (SECOSIL1) is 'K', default
309300200529      ***  Option for Actual Allocation 2 is '6' (Cash % already = Cash Preferred % from Standard
309400200529      ***  Instruction (SECOSIL1)).
309500200529     C           MOCKIN    IFEQ 'K'                        B*10
309600200529     C                     MOVE ' 6'      SS2IN
309700200529     C                     ENDIF                           E*10
309800200529     C                     ENDIF                           E*9
309900200529     C                     ENDIF                           E*8
310000200529     C                     ENDIF                           E*7
310100200529      *
310200200529      ***  If Cash % is 0 (means it is Stock Preferred).
310300200529     C           WCAPR     IFEQ 0                          B*7
310400200529      *
310500200529      ***  If Convertible/Keep Indicator from Standard Instruction (SECOSIL1) is 'K'
310600200529     C           MOCKIN    IFEQ 'K'                        B*8
310700200529      *
310800200529      ***  If Option 7 is allowed, default Option for Actual Allocation is '7' (Cash % already
310900200529      ***  = 0).
311000200529     C           MFOPT7    IFEQ 'Y'                        B*9
311100200529     C           MAPTYP    ANDEQ'RG'
311200200529     C           MJOPT7    OREQ 'Y'
311300200529     C           MAPTYP    ANDEQ'EX'
311400200529     C                     MOVE ' 7'      SS2IN
311500200529     C                     ENDIF                           E*9
311600200529     C                     ENDIF                           E*8
311700200529      *
311800200529      ***  If Convertible/Keep Indicator from Standard Instruction (SECOSIL1) is 'C'
311900200529     C           MOCKIN    IFEQ 'C'                        B*8
312000200529      *
312100200529      ***  If Rounding Option from Standard Instruction (SECOSIL1) is 'U'.
312200200529     C           MOROOP    IFEQ 'U'                        B*9
312300200529      *
312400200529      ***  If Rounding Option from Standard Instruction (SECOSIL1) is 'U' and Option 2 is allowed,
312500200529      ***  default Option for Actual Allocation 2 is '2' (Cash % already = 0).
312600200529     C           MFOPT2    IFEQ 'Y'                        B*10
312700200529     C           MAPTYP    ANDEQ'RG'
312800200529     C           MJOPT2    OREQ 'Y'
312900200529     C           MAPTYP    ANDEQ'EX'
313000200529     C                     MOVE ' 2'      SS2IN
313100200529     C                     ELSE                            X*10
313200200529      *
313300200529      ***  If Rounding Option from Standard Instruction (SECOSIL1) is 'U' and Option 2 is not
313400200529      ***  allowed and Option 4 is allowed, default Option for Actual Allocation 2 is '4'
313500200529      ***  (Cash % already = 0).
313600200529     C           MFOPT4    IFEQ 'Y'                        B*11
313700200529     C           MAPTYP    ANDEQ'RG'
313800200529     C           MJOPT4    OREQ 'Y'
313900200529     C           MAPTYP    ANDEQ'EX'
314000200529     C                     MOVE ' 4'      SS2IN
314100200529     C                     ELSE                            X*11
314200200529      *
314300200529      ***  If Rounding Option from Standard Instruction (SECOSIL1) is 'U' and Options 2 and 4 are
314400200529      ***  not allowed and Option 3 is allowed, default Option for Actual Allocation 2 is '3'
314500200529      ***  (Cash % already = 0).
314600200529     C           MFOPT3    IFEQ 'Y'                        B*12
314700200529     C           MAPTYP    ANDEQ'RG'
314800200529     C           MJOPT3    OREQ 'Y'
314900200529     C           MAPTYP    ANDEQ'EX'
315000200529     C                     MOVE ' 3'      SS2IN
315100200529     C                     ELSE                            X*12
315200200529      *
315300200529      ***  If Rounding Option from Standard Instruction (SECOSIL1) is 'U' and Options 2, 4 and 3 are
315400200529      ***  not allowed and Option 5 is allowed, default Option for Actual Allocation 2 is '5' and
315500200529      ***  set Cash % to Cash Preferred % from Standard Instruction (SECOSIL1).
315600200529     C           MFOPT5    IFEQ 'Y'                        B*13
315700200529     C           MAPTYP    ANDEQ'RG'
315800200529     C           MJOPT5    OREQ 'Y'
315900200529     C           MAPTYP    ANDEQ'EX'
316000200529     C                     MOVE ' 5'      SS2IN
316100200529     C                     Z-ADDMOCAPP    WCAPR
316200200529     C                     ELSE                            X*13
316300200529      *
316400200529      ***  If Rounding Option from Standard Instruction (SECOSIL1) is 'U' and Options 2, 4, 3 and 5
316500200529      ***  are not allowed and Option 1 is allowed, default Option for Actual Allocation 2 is '1'
316600200529      ***  and set Cash % to 100.
316700200529     C           MFOPT1    IFEQ 'Y'                        B*14
316800200529     C           MAPTYP    ANDEQ'RG'
316900200529     C           MJOPT1    OREQ 'Y'
317000200529     C           MAPTYP    ANDEQ'EX'
317100200529     C                     MOVE ' 1'      SS2IN
317200200529     C                     Z-ADD100       WCAPR
317300200529     C                     ELSE                            X*14
317400200529      *
317500200529      ***  If Rounding Option from Standard Instruction (SECOSIL1) is 'U' and Options 2, 4, 3, 5
317600200529      ***  and 1 are not allowed, default Option for Actual Allocation 2 is blank.
317700200529     C                     MOVE '  '      SS2IN
317800200529     C                     ENDIF                           E*14
317900200529     C                     ENDIF                           E*13
318000200529     C                     ENDIF                           E*12
318100200529     C                     ENDIF                           E*11
318200200529     C                     ENDIF                           E*10
318300200529     C                     ENDIF                           E*9
318400200529      *
318500200529      ***  If Rounding Option from Standard Instruction (SECOSIL1) is 'D'.
318600200529     C           MOROOP    IFEQ 'D'                        B*9
318700200529      *
318800200529      ***  If Rounding Option from Standard Instruction (SECOSIL1) is 'D' and Option 3 is allowed,
318900200529      ***  default Option for Actual Allocation 2 is '3' (Cash % already = 0).
319000200529     C           MFOPT3    IFEQ 'Y'                        B*10
319100200529     C           MAPTYP    ANDEQ'RG'
319200200529     C           MJOPT3    OREQ 'Y'
319300200529     C           MAPTYP    ANDEQ'EX'
319400200529     C                     MOVE ' 3'      SS2IN
319500200529     C                     ELSE                            X*10
319600200529      *
319700200529      ***  If Rounding Option from Standard Instruction (SECOSIL1) is 'D' and Option 3 is not
319800200529      ***  allowed and Option 4 is allowed, default Option for Actual Allocation is '4' (Cash %
319900200529      ***  already = 0).
320000200529     C           MFOPT4    IFEQ 'Y'                        B*11
320100200529     C           MAPTYP    ANDEQ'RG'
320200200529     C           MJOPT4    OREQ 'Y'
320300200529     C           MAPTYP    ANDEQ'EX'
320400200529     C                     MOVE ' 4'      SS2IN
320500200529     C                     ELSE                            X*11
320600200529      *
320700200529      ***  If Rounding Option from Standard Instruction (SECOSIL1) is 'D' and Options 3 and 4 are
320800200529      ***  not allowed and Option 2 is allowed, default Option for Actual Allocation is '2' (Cash %
320900200529      ***  already = 0).
321000200529     C           MFOPT2    IFEQ 'Y'                        B*12
321100200529     C           MAPTYP    ANDEQ'RG'
321200200529     C           MJOPT2    OREQ 'Y'
321300200529     C           MAPTYP    ANDEQ'EX'
321400200529     C                     MOVE ' 2'      SS2IN
321500200529     C                     ELSE                            X*12
321600200529      *
321700200529      ***  If Rounding Option from Standard Instruction (SECOSIL1) is 'D' and Options 3, 4 and 2 are
321800200529      ***  not allowed and Option 5 is allowed, default Option for Actual Allocation is '5' and set
321900200529      ***  Cash % to Cash Preferred % from Standard Instruction (SECOSIL1).
322000200529     C           MFOPT5    IFEQ 'Y'                        B*13
322100200529     C           MAPTYP    ANDEQ'RG'
322200200529     C           MJOPT5    OREQ 'Y'
322300200529     C           MAPTYP    ANDEQ'EX'
322400200529     C                     MOVE ' 5'      SS2IN
322500200529     C                     Z-ADDMOCAPP    WCAPR
322600200529     C                     ELSE                            X*13
322700200529      *
322800200529      ***  If Rounding Option from Standard Instruction (SECOSIL1) is 'D' and Options 3, 4, 2 and 5
322900200529      ***  are not allowed and Option 1 is allowed, default Option for Actual Allocation is '1' and
323000200529      ***  set Cash % to 100.
323100200529     C           MFOPT1    IFEQ 'Y'                        B*14
323200200529     C           MAPTYP    ANDEQ'RG'
323300200529     C           MJOPT1    OREQ 'Y'
323400200529     C           MAPTYP    ANDEQ'EX'
323500200529     C                     MOVE ' 1'      SS2IN
323600200529     C                     Z-ADD100       WCAPR
323700200529     C                     ELSE                            X*14
323800200529      *
323900200529      ***  If Rounding Option from Standard Instruction (SECOSIL1) is 'D' and Options 3, 4, 2, 5 and
324000200529      ***  1 are not allowed, default Option for Actual Allocation is blank.
324100200529     C                     MOVE '  '      SS2IN
324200200529     C                     ENDIF                           E*14
324300200529     C                     ENDIF                           E*13
324400200529     C                     ENDIF                           E*12
324500200529     C                     ENDIF                           E*11
324600200529     C                     ENDIF                           E*10
324700200529     C                     ENDIF                           E*9
324800200529     C                     ENDIF                           E*8
324900200529     C                     ELSE                            X*7
325000200529      *
325100200529      ***  If Cash % is 100 (means it is Cash Preferred).
325200200529     C           WCAPR     IFEQ 100                        B*8
325300200529      *
325400200529      ***  If Option 1 is allowed, default Option for Actual Allocation 2 is '1' (Cash % already
325500200529      ***  = 100).
325600200529     C           MFOPT1    IFEQ 'Y'                        B*9
325700200529     C           MAPTYP    ANDEQ'RG'
325800200529     C           MJOPT1    OREQ 'Y'
325900200529     C           MAPTYP    ANDEQ'EX'
326000200529     C                     MOVE ' 1'      SS2IN
326100200529     C                     ELSE                            X*9
326200200529      *
326300200529      ***  If Option 1 is not allowed, default as per Cash % is 0.
326400200529     C                     Z-ADD0         WCAPR
326500200529     C                     ENDIF                           E*9
326600200529     C                     ENDIF                           E*8
326700200529     C                     ENDIF                           E*7
326800200529     C                     ENDIF                           E*6
326900200529     C                     ENDIF                           E*5
327000200529     C                     ENDIF                           E*4
327100200529     C                     ENDIF                           E*3
327200200529      *
327300200529      ***  CASE 2.2: IF Customer/Book Standard Corporate Action Instruction does not exist
327400200529      ***               (and Customer/Book Current Reply does not exist),
327500200529      ***            OR if Customer/Book Standard Corporate Action Instruction exist BUT default
327600200529      ***               Option (Option for Actual Allocation 2 calculated in CASE 2.1 or retrieve
327700200529      ***               from Standard Instruction (SECOSIL1) in CASE 2) is blank (and Customer/Book
327800200529      ***               Current Reply does not exist).
327900200529     C*****      EXBCSI    IFEQ 'N'                        B*3            155622
328000200529     C*****      EXBCSI    OREQ 'Y'                                       155622
328100200529     C*****      SS2IN     ANDEQ'  '                                      155622
328200200529      *****                                                               155622
328300200529     C*****                SELEC                           B*4            155622
328400200529     C*****      @PTYP     WHEQ 'DV'                                      155622
328500200529     C*****                MOVE MDDFNR    SS2IN     P                     155622
328600200529      *****                                                               155622
328700200529     C*****      @PTYP     WHEQ 'RG'                                      155622
328800200529     C*****                MOVE MFDFNR    SS2IN     P                     155622
328900200529      *****                                                               155622
329000200529     C*****      @PTYP     WHEQ 'OF'                                      155622
329100200529     C*****                MOVE MIDFNR    SS2IN     P                     155622
329200200529      *****                                                               155622
329300200529     C*****      @PTYP     WHEQ 'EX'                                      155622
329400200529     C*****                MOVE MJDFNR    SS2IN     P                     155622
329500200529     C*****                ENDSL                           E*4            155622
329600200529      *****                                                               155622
329700200529     C*****                ENDIF                           E*3            155622
329800200529     C*****                ENDIF                           E*2            155622
329900200529     C                     ENDIF                           E*1
330000200529      *
330100200529     C                     ENDSR
330200200529      *****************************************************************
330300200529      /EJECT
330400200529      *****************************************************************
330500200529      *                                                               *
330600200529      *            *PSSR  - Program error handling routine            *
330700200529      *                                                               *
330800200529      * CALLS     DBERRCTL- DB error                                  *
330900200529      *                                                               *
331000200529      * CALLED BY  SRINIT - Initial Processing                        *
331100200529      *            SRCLSF - Clear Subfile                             *
331200200529      *            SRPROC - Process read records                      *
331300200529      *                                                               *
331400200529      * FLDS USED         -                                           *
331500200529      *                                                               *
331600200529      *****************************************************************
331700200529     C           *PSSR     BEGSR
331800200529      *
331900200529      ** Print Dump and Cancel Program
332000200529     C                     MOVE 'E'       @RTCD
332100200529     C                     DUMP
332200200529      *
332300200529     C                     MOVE '1'       *INU7
332400200529     C                     MOVE '1'       *INU8
332500200529     C                     MOVE '1'       *INLR
332600200529     C                     CALL 'DBERRCTL'
332700200529     C                     RETRN
332800200529      *
332900200529     C                     ENDSR
333000200529      *****************************************************************
333100200529      /EJECT
333200200529      *****************************************************************
333300200529      *                                                               *
333400200529      *            ZASNMS - Send message to program's message queue   *
333500200529      *                                                               *
333600200529      * CALLS      Y2SNMGC- Send a message                            *
333700200529      *                                                               *
333800200529      * CALLED BY  SRVIEW - View subfile from Review from fields      *
333900200529      *            SRERR  - Action code not equal to A/E/H/V          *
334000200529      *                                                               *
334100200529      * FLDS USED         -                                           *
334200200529      *                                                               *
334300200529      *****************************************************************
334400200529     C           ZASNMS    BEGSR
334500200529      *
334600200529      **  Message file specified use PMSGF
334700200529     C                     MOVELPMSGF     ZAMSGF
334800200529     C                     CALL 'Y2SNMGC'
334900200529     C                     PARM           ZAPGM  10        Program queue
335000200529     C                     PARM           ZAPGRL  5        Rel queue
335100200529     C                     PARM           ZAMSID  7        Message Id.
335200200529     C                     PARM           ZAMSGF 10        Message file.
335300200529     C                     PARM           ZAMSDA132        Message data.
335400200529     C                     PARM           ZAMSTP  7        Message type.
335500200529      *
335600200529      **  Clear all fields for default mechanism next time.
335700200529     C                     MOVEL*BLANK    ZAPGM            Program queue
335800200529     C                     MOVEL*BLANK    ZAPGRL           Rel queue
335900200529     C                     MOVEL*BLANK    ZAMSDA           Message data.
336000200529     C                     MOVEL*BLANK    ZAMSTP           Message type.
336100200529     C                     MOVEL*BLANK    ZAMSGF           Message file
336200200529     C                     MOVEL*BLANK    ZAMSID           Message id.
336300200529      *
336400200529     C                     ENDSR
336500200529      ********************************************************************
336600200529      /EJECT
336700200529      *****************************************************************   161732
336800200529      *                                                               *   161732
336900200529      *  SRCONV - Convert signed alpha field to packed numeric field  *   161732
337000200529      *                                                               *   161732
337100200529      *  Calls:                                                       *   161732
337200200529      *  ZALIGN - Validate/right align numeric fields                 *   161732
337300200529      *                                                               *   161732
337400200529      *  Called by:                                                   *   161732
337500200529      *  SRBLD1 - Build subfile for the records "Books"               *   161732
337600200529      *  SRBLD2 - Build subfile for the records "Cust/Ptfr"           *   161732
337700200529      *  SRBLDS - Build subfile                                       *   161732
337800200529      *                                                               *   161732
337900200529      *****************************************************************   161732
338000200529     C           SRCONV    BEGSR                                          161732
338100200529      *                                                                   161732
338200200529     C                     MOVE *BLANKS   ZFIELD                          161732
338300200529     C                     MOVE *BLANKS   WSTR17                          161732
338400200529     C                     MOVEAEXP2,X    WSTR17                          161732
338500200529     C                     MOVEAEXP2,X    WSIGN   1                       161732
338600200529     C           WSIGN     IFEQ '-'                                       161732
338700200529     C           16        SUBSTWSTR17:1  ZFIELD                          161732
338800200529     C                     ELSE                                           161732
338900200529     C                     MOVE *BLANK    WSIGN                           161732
339000200529     C                     MOVE WSTR17    ZFIELD                          161732
339100200529     C                     ENDIF                                          161732
339200200529     C                     Z-ADDNMDP      ZADEC                           161732
339300200529     C           15        SUB  ZADEC     ZADIG                           161732
339400200529     C                     EXSR ZALIGN                                    161732
339500200529     C           *IN99     IFEQ *ON                                       161732
339600200529     C                     Z-ADD*ZERO     WNUM15 150                      161732
339700200529     C                     ELSE                                           161732
339800200529     C                     MOVE ZFIELD    WNUM15                          161732
339900200529     C                     ENDIF                                          161732
340000200529     C           WSIGN     IFEQ '-'                                       161732
340100200529     C           0         SUB  WNUM15    WNUM15                          161732
340200200529     C                     ENDIF                                          161732
340300200529     C                     MOVEAWZERO     EXP2,X                          161732
340400200529     C                     ADD  MCEXPO    WNUM15                          161732
340500200529     C                     SELEC                                          161732
340600200529     C           WNUM15    WHEQ *ZERO                                     161732
340700200529     C                     MOVEAWZERO     EXP2,X                          161732
340800200529     C           WNUM15    WHLT *ZERO                                     161732
340900200529     C                     MOVE *BLANKS   ZFLD15                          161732
341000200529     C                     MOVE WNUM15    ZFLD15                          161732
341100200529     C                     Z-ADD*ZERO     ZDECS                           161732
341200200529     C                     EXSR ZSEDIT                                    161732
341300200529     C                     MOVE ZOUT21    WSTR17                          161732
341400200529     C                     MOVEAWSTR17    EXP2,X                          161732
341500200529     C           WNUM15    WHGT *ZERO                                     161732
341600200529     C                     MOVE *BLANKS   ZFLD15                          161732
341700200529     C                     MOVE WNUM15    ZFLD15                          161732
341800200529     C                     Z-ADD*ZERO     ZDECS                           161732
341900200529     C                     EXSR ZSEDIT                                    161732
342000200529     C           17        SUBSTZOUT21:4  WSTR17                          161732
342100200529     C                     MOVEAWSTR17    EXP2,X                          161732
342200200529     C                     ENDSL                                          161732
342300200529      *                                                                   161732
342400200529     C                     ENDSR                                          161732
342500200529      ********************************************************************161732
342600200529      /EJECT                                                              161732
342700200529     C/COPY ZSRSRC,ZDATE2Z4
342800200529      /EJECT
342900200529     C/COPY ZSRSRC,ZSEDITZ3
343000200529      /EJECT
343100200529     C/COPY ZSRSRC,ZALIGNZ2
343200200529      /EJECT
343300200529     C/COPY ZSRSRC,ZEDITZ2
343400200529**  CPY@
343500200529(c) Finastra International Limited 2001
343600200529**  NARR
343700200529ERROR CALLING PGM 'SE7515'
343800200529ERROR CALLING PGM 'SE7541'
343900200529ERROR CALLING PGM 'SE7540'
344000200529**   ZYDY - YEARS IN DAYS CUMULATIVE, FOUR YEAR SPAN
3441002005290366073110961461
344200200529**   ZMDY - MONTHS IN DAYS CUMULATIVE THROUGH YEAR
344300200529000031059090120151181212243273304334365
344400200529**   ZMNM - MONTHS SHORT NAMES
344500200529JANFEBMARAPRMAYJUNJULAUGSEPOCTNOVDEC
