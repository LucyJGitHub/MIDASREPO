000100200529     H        1
000110200529      *****************************************************************
000120200529/*STD *  RPGBASE                                                      *
000130200529/*EXI *  TEXT('Midas SE CO automatic allocation processing')
000140200529      *****************************************************************
000150200529      *                                                               *
000160200529      *  Midas - Securities Trading Module                            *
000170200529      *                                                               *
000180200529      *  SE7550 - SE Corporate Actions Automatic Allocation           *
000190200529      *           Processing                                          *
000200200529      *                                                               *
000210200529      *  Function:  This program calculate Original and Actual        *
000220200529      *  (I/C)      Allocations for the Depot and for the Book/       *
000230200529      *             Customer Positions at the Depot.                  *
000240200529      *                                                               *
000250200529      *  BE CAREFUL: Some of amendments of calculations must          *
000260200529      *              perhaps be done in RPG/SE7593: Midas SE          *
000270200529      *              Corporate Actions Depot Maintenance and in       *
000280200529      *              RPG/SE7513: Midas SE Corporate Actions           *
000290200529      *              Customer/Book by Depot Maintenance, depending    *
000300200529      *              on calculations used in those programs |         *
000310200529      *                                                               *
000320200529      *  Called By: SEC7550 - SE CO Automatic Allocation Processing.  *
000330200529      *                                                               *
000340200529      *  (c) Finastra International Limited 2001                      *
000350200529      *                                                               *
000390200619      *  LAST Amend No. MD046248           Date 27Oct17               *
000400200529      * Bank Fusion Midas 1.4 Base -----------------------------------*
000410200529      * Midas Plus 1.4 Base 04 ---------------------------------------*
000420200529      * Midas Plus 1.4 Base ------------------------------------------*
000430200529      * Midas Plus 1.3 ----------- Base ------------------------------*
000440200619      *  PREV Amend No. CSD031             Date 10Apr06               *
000450200619      *                 CSD027             Date 09Dec05               *
000460200529      *                 CSE071             Date 19Jul05               *
000470200529      *                 CSW037A            Date 02May05               *
000480200529      *                 223182             Date 30Jan04               *
000490200529      *                 220007             Date 28Jul03               *
000500200529      *                 220006             Date 25Jul03               *
000510200529      *                 211444 (BUG2652)   Date 28Jul03               *
000520200529      *                 219976             Date 28Jul03               *
000530200529      *                 219635             Date 16JuL03               *
000540200529      *                 219579             Date 22JuL03               *
000550200529      *                 219553             Date 16JuL03               *
000560200529      *                 218698             Date 12Jun03               *
000570200529      *                 215071             Date 18Mar03               *
000580200529      *                 CSD025             Date 11Jan05               *
000590200529      *                 CSW037             Date 15Dec04               *
000600200529      *                 CSW036             Date 15Dec04               *
000610200529      *                 BUG3122            Date 17Jul04               *
000620200529      *                 CLE025             Date 20Oct03               *
000630200529      *                 BUG2652            Date 17May04               *
000640200529      *                 CGL029             Date 01Sep03               *
000650200529      * Midas Release 4.01 -------------------------------------------*
000660200529      *                 193662             Date 30Nov01               *
000670200529      *                 191178             Date 30Nov01               *
000680200529      * Midas Release 4 --------------- Base -------------------------*
000690200529      *                 190204             Date 31May01               *
000700200529      *                 164020             Date 08May01               *
000710200529      * Midas DBA 3.05 -----------------------------------------------*
000720200529      *                 179205             Date 27Dec00               *
000730200529      * Midas DBA 3.03 -----------------------------------------------*
000740200529      *                 181131             Date 06Jul00               *
000750200529      *                 CSE020             Date 21Mar00               *
000760200529      *                 161732             Date 21Mar00               *
000770200529      * Midas DBA 3.02 -----------------------------------------------*
000780200529      *                 CPB001             Date 08Sep99               *
000790200529      * Midas DBA 3.01 -----------------------------------------------*
000800200529      *                 164243             Date 19Aug99               *
000810200529      * Midas DBA 3.00 ---------------- Base -------------------------*
000820200529      *                 161419             Date 28May99               *
000830200529      *                 CAC005             Date 23Nov98               *
000840200529      *                 157229             Date 17Mar99               *
000850200529      *                 156701             Date 10Mar99               *
000860200529      *                 156690             Date 10Mar99               *
000870200529      *                 156538             Date 05Mar99               *
000880200529      *                 155622             Date 22Feb99               *
000890200529      *                 153729             Date 21Jan99               *
000900200529      *                 145872             Date 23Oct98               *
000910200529      *                 137886             Date 14Jul98               *
000920200529      *                 136935             Date 29Jun98               *
000930200529      *                 152932             Date 12Jan99               *
000940200529      *                 150252             Date 10Dec98               *
000950200529      *                 149782             Date 07Dec98               *
000960200529      *                 149257             Date 08Jun98               *
000970200529      *                 149153             Date 30Nov98               *
000980200529      *                 135690             Date 08Jun98               *
000990200529      *                 135692             Date 03Jun98               *
001000200529      *                 135686             Date 28May98               *
001010200529      *                 135685             Date 28May98               *
001020200529      *                 CEU017             Date 05Mar98               *
001030200529      *                 CSE007  *CREATE    Date 12Jan98               *
001040200529      *                                                               *
001050200529      *---------------------------------------------------------------*
001060200529      *                                                               *
001160200529      *  MD046248 - Finastra Rebranding                               *
001170200529      *  CSD031 - Enhanced Centralised Static Data (Recompile)        *
001180200529      *  CSD027 - Conversion Of Customer Number to Alpha              *
001190200529      *  CSE071 - Multiple Holidays Re Securities (recompile)         *
001200200529      *  CSW037A- Additional Field extended to 40 chars (recompile)   *
001210200529      *  223182 - Error on Corporate Action.                          *
001220200529      *           Zeroised Allocation for Dummy Customers.            *
001230200529      *  220007 - TO RETRIEVE THE CORRECT SECURITY.                   *
001240200529      *         - ARRAY INDEX NOT VALID  (I)                          *
001250200529      *  220006 - ALLOCATION IS WRONG FOR 'OF' TYPE 'E'               *
001260200529      *  219976 - PARTIAL OFFER INCORRECTLY HANDLED.                  *
001270200529      *  209292 - Replace line removed by 136935                      *
001280200529      *  219635 - Allocation ignoring nominal decimal places          *
001290200529      *           Apply 179024 Round denomination multiplier correctly*
001300200529      *  219635A- INCORRECT DEFINITION OF WUTDVD 15,0 >> 19,4         *
001310200529      *  219579 - For exchange offer (EX) with type '4', no cash      *
001320200529      *           is calculated. This should be done taking into con- *
001330200529      *           sideration the subscription price.                  *
001340200529      *  219553 - No stock allocation calculated and taken as stock   *
001350200529      *           for Exchange Offer.                                 *
001360200529      *  218698 - Actual stock allocation computed incorrectly for    *
001370200529      *           option 3 of Exchange offer. Fix is to use the actual*
001380200529      *           rate entered and not subtract it from 100.          *
001390200529      *  215071 - No stock allocation calculated for stock dividend   *
001400200529      *           types 'O'. Fix is to calculate stock allocation for *
001410200529      *           stock dividend types 'O'based on customer reply     *
001420200529      *           definition.                                         *
001430200529      *  CSD025 - Customer De-Activation                              *
001440200529      *  CSW037 - Additional Field Data on MT300/MT320                *
001450200529      *  CSW036 - Dual SWIFT BIC held on Client Details               *
001460200529      *  BUG3122 - Recompiled due to changes in SDSECSPD.             *
001470200529      *  CLE025 - Credit Lines (Recompile)                            *
001480200529      *  BUG2652 - Amend program to ensure Cash Repaid amount is 7    *
001490200529      *            decimal places.                                    *
001500200529      *  CGL029 - Increase Account Code to 10 digits                  *
001510200529      *  193662 - The system did not allocate shares eventhough a     *
001520200529      *           default reply "Accept Offer" is defined in the      *
001530200529      *           Subscription Offer corporate action details.        *
001540200529      *           Expected allocation should be generated if Default  *
001550200529      *           reply exists on the corporate action details.       *
001560200529      *  191178 - Corporate Action: Stock Dividend: Cash rounding     *
001570200529      *           included twice in total settlement. Fix is to amend *
001580200529      *           the computation of holding taken as cash when cash% *
001590200529      *           is entered to ensure that the exact amount is calcu-*
001600200529      *           lated to come up with an exact actual stock alloc.  *
001610200529      *           Fix only caters for processing type 'DV' with stock *
001620200529      *           dividend type not 'C'.                              *
001630200529      *  190204 - Changed Dividend per Unit format from 9N0 to 13N8.  *
001640200529      *  164020 - Calculate taxes with extra accuracy.                *
001650200529      *  179205 - If only a charge or a commission, fee calculated    *
001660200529      *           is zero. Allow the two to be calculated seperately. *
001670200529      *           Do not multiply result by CCY decimal places.       *
001680200529      *  181131 - Incorrect Actual Stock Allocation for Customer/Book *
001690200529      *  CSE020 - Corporate Actions Domino Effect Processing          *
001700200529      *  161732 - Corporate Actions Exercise and Conversion -         *
001710200529      *           Part Stock/Keep Rest Calculation                    *
001720200529      *  CPB001 - 'Private Banking' Module                            *
001730200529      *  164243 - Review actual stock allocation for 'EX' type        *
001740200529      *  161419 - Corporate Actions: The Stock allocation calculation *
001750200529      *           for No. of New and No. of Old is calculated         *
001760200529      *           incorrectly.                                        *
001770200529      *  CAC005 - Profit Centre Accounting - SE Enhancements          *
001780200529      *  157229 - Corporate Actions: Review calculation of Actual     *
001790200529      *           Cach Allocation for processing type 'CR'.           *
001800200529      *           Should use the Holding Taken as Stock instead of    *
001810200529      *           the Holding at the Ex-date position.                *
001820200529      *  156701 - Corporate Actions: Review Setup of field Convert/   *
001830200529      *           Keep indicator for allocation of Processing Type EX *
001840200529      *  156690 - Corporate Actions: Review Depot Calculation for 'OF'*
001850200529      *  156538 - Corporate Actions: Cash allocation for Depot not    *
001860200529      *           calculated.                                         *
001870200529      *  155622 - Corporate Actions: Cash Payment has now 7 decimal   *
001880200529      *           places (Corporate Reorganisation)                   *
001890200529      *  153729 - Corporate Actions: No Trades/Depot Movements        *
001900200529      *           generated for a processing type 'NC' with change of *
001910200529      *           Security Shortname                                  *
001920200529      *  145872 - Corporate Actions: '% to Exchange' added for        *
001930200529      *           Exchange Offer ('OF').                              *
001940200529      *           If Exchange Offer, Calculat Base Ex-Date Position = *
001950200529      *           Ex-Date Position multiplied by Percentage to        *
001960200529      *           Exchange.                                           *
001970200529      *  137886 - Corporate Actions: Add the possibility to allocate  *
001980200529      *           (or not) the balancing difference directly to the   *
001990200529      *           Dummy Customer.                                     *
002000200529      *  136935 - Corporate Actions: Allocation processing amendments:*
002010200529      *           1. If Number of Options greater than 1, record      *
002020200529      *              '**CASH**' for previous option write 2 times.    *
002030200529      *           2. Amend calculations for Exercices and Conversions.*
002040200529      *           3. Amend calculations for Offers.                   *
002050200529      *           4. Final Allocation must be set to Y' for Corporate *
002060200529      *              Actions with processing type 'NC' and 'NF'.      *
002070200529      *           5. Review calculation of cash (processing type 'CR')*
002080200529      *              Cash Option = (Holding divided by Number of OLD  *
002090200529      *              Shares) multiplied by Compensation Price.        *
002100200529      *           6. Input Balancing Cash Allocation on Dummy Cust.   *
002110200529      *              on Cash Alocation and Rounding instead of only   *
002120200529      *              on Cash Alocation, and all Balancing Differences *
002130200529      *              only on Actual field, no more on Original field. *
002140200529      *           7. For Reinvestment of Dividend, if Compensation    *
002150200529      *              Price entered, use Compensation Price instead of *
002160200529      *              Subscription Price, otherwise, calculate Sub-    *
002170200529      *              scription Price = Subscription Price minus Dis-  *
002180200529      *              count Rate.                                      *
002190200529      *           8. Review Allocation in case of multiple options    *
002200200529      *  152932 - If no Customer and no Book processed for the        *
002210200529      *           Security (no records in SECOALPD), don't processed  *
002220200529      *           Security for the Depot.                             *
002230200529      *  150252 - In some cases, balancing difference between Depot   *
002240200529      *           and Customers/Books not allocated to the Dummy Cust.*
002250200529      *  149782 - Error in calculating the stock allocation for       *
002260200529      *           french government OAT bonds                         *
002270200529      *  149257 - Allocation for Funds (Investment Type 7) do not     *
002280200529      *           take care of decimal positions                      *
002290200529      *  149153 - Error in allocation for EIB bonds                   *
002300200529      *  135690 - Various errors for Corporate Actions:               *
002310200529      *           1. Due to Fix 135689: Error in validation of        *
002320200529      *              Dividend per Unit, amend number of decimal       *
002330200529      *              places of Dividend per Unit for Dividend Events, *
002340200529      *              from New Currency instead of New Security.       *
002350200529      *           2. Amend wrong calculation of Holding Taken as      *
002360200529      *              Stock, for Dividend Events, Subscription and     *
002370200529      *              Exchange Offers and Non financial Events.        *
002380200529      *           3. Amend wrong loading of Cash preferred % for      *
002390200529      *              Processing Type Rights Issues, Cash Preferred %  *
002400200529      *              must always equal 0.                             *
002410200529      *           4. Amend wrong calculation of Cash Preferred % in   *
002420200529      *              case 2.1: if Standard Instruction found,         *
002430200529      *              condition if Cash % later than 50 or greater     *
002440200529      *              50 becomes if later than 50 or greater or equal  *
002450200529      *              50.                                              *
002460200529      *  135692 - Calculation of total taxes was processed if         *
002470200529      *           processing type not Dividend Events, process this   *
002480200529      *           calculation only if processing type is Dividend     *
002490200529      *           Events.                                             *
002500200529      *  135686 - EMU and Corporate Actions: various amendments:      *
002510200529      *           1. Allow rounding up with Denomination Multiplier   *
002520200529      *              precision on Original and Actual Stock           *
002530200529      *              Allocation calculations.                         *
002540200529      *           2. Allow Customer and Book processing if historic   *
002550200529      *              records find in Client and User Depot Positions  *
002560200529      *              detail files.                                    *
002570200529      *           3. On Depot calculations, process details if live   *
002580200529      *              record found on Allocation detail file.          *
002590200529      *           4. Process Dummy Customer only if Customer or       *
002600200529      *              Book processed.                                  *
002610200529      *           5. Due to database error when allocation called     *
002620200529      *              from Customer/Book maintenance, loop to delete   *
002630200529      *              all '**CASH**' records on Allocation file.       *
002640200529      *           6. Correct wrong calculation of Balancing Cash      *
002650200529      *              Allocation: Depot - Total instead of Total -     *
002660200529      *              Depot.                                           *
002670200529      *           7. Input Balancing Differences on Dummy Customer    *
002680200529      *              only for processing type Currency Change, else   *
002690200529      *              load Balancing Differences fields on Depot       *
002700200529      *              Allocation file, and input on Dummy Customer     *
002710200529      *              without inversion of sign.                       *
002720200529      *  135685 - It's not feasible to enter the Compensation Price   *
002730200529      *           at the Bulk level as the Bulk will have many        *
002740200529      *           Securities all giving a cash compensation at a      *
002750200529      *           different level. Therefore, allow the entry of      *
002760200529      *           'MARKET' which will use the Market Price of the     *
002770200529      *           Security at allocation effective date.              *
002780200529      *  CEU017 - Securities Redenomination Euro Changes              *
002790200529      *  CSE007 - Corporate Actions                                   *
002800200529      *                                                               *
002810200529      *****************************************************************
002820200529      /SPACE 3
002830200529      *
002840200529      ***  Midas SE Corporate Actions Reference - Rtv Idx                - Prefixe MA
002850200529      *
002860200529     FSECORFL1IF  E           K        DISK
002870200529     F                                              KINFSR *PSSR
002880200529      *                                                                   CSE020
002890200529      ** Midas SE Corporate Actions Reference - Rtv Idx                   CSE020
002900200529      *                                                                   CSE020
002910200529     FSECORFL0IF  E           K        DISK                               CSE020
002920200529     F            SECORFD0                          KRENAMESECORFX0       CSE020
002930200529     F                                              KINFSR *PSSR          CSE020
002940200529      *
002950200529      ***  Midas SE Corporate Actions Allocations - Upd Idx              - Prefixe MC
002960200529      *
002970200529     FSECOALL0UF  E           K        DISK                      A
002980200529     F                                              KCOMIT
002990200529     F                                              KINFSR *PSSR
003000200529      *
003010200529      ***  Midas SE Corporate Actions Depots - Upd Idx                   - Prefixe MB
003020200529      *
003030200529     FSECODPL0UF  E           K        DISK                      A
003040200529     F                                              KCOMIT
003050200529     F                                              KINFSR *PSSR
003060200529      *                                                                   CSE020
003070200529      ** Midas SE Corporate Actions Stock Allocations - Rtv Idx           CSE020
003080200529      *                                                                   CSE020
003090200529     FSECOALL5IF  E           K        DISK                               CSE020
003100200529     F            SECOALD0                          KRENAMESECOALD5       CSE020
003110200529     F                                              KINFSR *PSSR          CSE020
003120200529      *
003130200529      ***  Midas SE Corporate Actions Dividends Events - Rtv Idx         - Prefixe MD
003140200529      *
003150200529     FSECODVL1IF  E           K        DISK
003160200529     F                                              KINFSR *PSSR
003170200529      *
003180200529      ***  Midas SE Corporate Actions Free Allocation - Rtv Idx          - Prefixe ME
003190200529      *
003200200529     FSECOFRL1IF  E           K        DISK
003210200529     F                                              KINFSR *PSSR
003220200529      *
003230200529      ***  Midas SE Corporate Actions Rights Issues - Rtv Idx            - Prefixe MF
003240200529      *
003250200529     FSECORGL1IF  E           K        DISK
003260200529     F                                              KINFSR *PSSR
003270200529      *
003280200529      ***  Midas SE Corporate Actions Capital Change - Rtv Idx           - Prefixe MG
003290200529      *
003300200529     FSECOCEL1IF  E           K        DISK
003310200529     F                                              KINFSR *PSSR
003320200529      *
003330200529      ***  Midas SE Corporate Actions Corporate Reorganisation - Rtv Idx - Prefixe MH
003340200529      *
003350200529     FSECOCRL1IF  E           K        DISK
003360200529     F                                              KINFSR *PSSR
003370200529      *
003380200529      ***  Midas SE Corporate Actions Offers - Rtv Idx                   - Prefixe MI
003390200529      *
003400200529     FSECOOFL1IF  E           K        DISK
003410200529     F                                              KINFSR *PSSR
003420200529      *
003430200529      ***  Midas SE Corporate Actions Exercices and Conversion - Rtv Idx - Prefixe MJ
003440200529      *
003450200529     FSECOEXL1IF  E           K        DISK
003460200529     F                                              KINFSR *PSSR
003470200529      *
003480200529      ***  Midas SE Corporate Actions General Meeting/Info - Rtv Idx     - Prefixe MK
003490200529      *
003500200529     FSECONFL1IF  E           K        DISK
003510200529     F                                              KINFSR *PSSR
003520200529      *
003530200529      ***  Midas SE Corporate Actions Name Changes - Rtv Idx             - Prefixe ML
003540200529      *
003550200529     FSECONCL1IF  E           K        DISK
003560200529     F                                              KINFSR *PSSR
003570200529      *                                                                   CEU017
003580200529      ***  Midas SE Corporate Actions Currency Changes - Rtv Idx          CEU017
003590200529      ***                                                   -  Prefixe NA CEU017
003600200529      *                                                                   CEU017
003610200529     FSECOCCL2IF  E           K        DISK                               CEU017
003620200529     F                                              KINFSR *PSSR          CEU017
003630200529      *
003640200529      ***  Midas SE Securities.                                          - Prefixe
003650200529      *
003660200529     FSECTY   IF  E           K        DISK
003670200529     F                                              KINFSR *PSSR
003680200529      *
003690200529      ***  Midas SE User Depot Positions Details.                        - Prefixe
003700200529      *
003710200529     FSEUDEPL0IF  E           K        DISK
003720200529     F                                              KINFSR *PSSR
003730200529      *
003740200529      ***  Midas SE Client Depot Position Details.                       - Prefixe
003750200529      *
003760200529     FSECDEPL4IF  E           K        DISK
003770200529     F                                              KINFSR *PSSR
003780200529      *
003790200529      ***  Midas SE Depot Positions-Current & Historic.                  - Prefixe
003800200529      *
003810200529     FSEDPOHL0IF  E           K        DISK
003820200529     F                                              KINFSR *PSSR
003830200529      *
003840200529      ***  Midas SE Corporate Actions Depots Reference - Upd Idx.        - Prefixe MS
003850200529      *
003860200529     FSECODRL0UF  E           K        DISK                      A
003870200529     F                                              KCOMIT
003880200529     F                                              KINFSR *PSSR
003890200529      *
003900200529      ***  Midas SE Corporate Actions Reply Handling.                    - Prefixe MQ
003910200529      *
003920200529     FSECOREL0IF  E           K        DISK
003930200529     F                                              KINFSR *PSSR
003940200529      *
003950200529      ***  Midas SE Corporate Actions Instructions by Customer.          - Prefixe MO
003960200529      *
003970200529     FSECOSIL1IF  E           K        DISK
003980200529     F                                              KINFSR *PSSR
003990200529      *
004000200529      ***  Midas SE Corporate Actions Instructions by Book.              - Prefixe MO
004010200529      *
004020200529     FSECOSIL2IF  E           K        DISK
004030200529     F            SECOSID0                          KRENAMESECOSID2
004040200529     F                                              KINFSR *PSSR
004050200529      *
004060200529      ***  Midas SE Charge Types.                                        - Prefixe
004070200529      *
004080200529     FSECGT   IF  E           K        DISK
004090200529     F                                              KINFSR *PSSR
004100200529      *
004110200529      ***  Midas SE CO Default Charges file by Customer Group.           - Prefixe MR
004120200529      *
004130200529     FSECOCHL0IF  E           K        DISK
004140200529     F                                              KINFSR *PSSR
004150200529      *
004160200529      ***  Midas SE CO Default Charges file by Classification.           - Prefixe MR
004170200529      *
004180200529     FSECOCHL1IF  E           K        DISK
004190200529     F            SECOCHD0                          KRENAMESECOCHD1
004200200529     F                                              KINFSR *PSSR
004210200529      *
004220200529      ***  Midas SE Security Withholding Tax Details.                    - Prefixe S1
004230200529      *
004240200529     FSESWHTL0IF  E           K        DISK
004250200529     F                                              KINFSR *PSSR
004260200529      *
004270200529      ***  Midas SD Customer Master file.                                - Prefixe
004280200529      *
004290200529     FCLINT   IF  E           K        DISK         KINFSR *PSSR
004300200529     F            CLINTCAF                          KIGNORE
004310200529     F            CLINTCCF                          KIGNORE
004320200529     F            CLINTC1F                          KIGNORE
004330200529     F            CLINTSEF                          KIGNORE
004340200529      *
004350200529      ***  Midas SE Market Prices file.                                  - Prefixe
004360200529      *
004370200529     FPRICM   IF  E           K        DISK
004380200529     F                                              KINFSR *PSSR
004390200529      *                                                                   CPB001
004400200529      ***  Midas PM Portfolio Reference                                   CPB001
004410200529      *                                                                   CPB001
004420200529     FPMPORTLLIF  E           K        DISK                           UC  CPB001
004430200529     F                                              KINFSR *PSSR          CPB001
004440200529      *
004450200529      ***  Midas SE CO Automatic Allocation Processing - Audit.
004460200529      *
004470200529     FSE7550AUO   E                    PRINTER
004480200529     F                                              KINFDS SPOOLU
004490200529     F                                              KINFSR *PSSR
004500200529      /SPACE 3
004510200529      *****************************************************************
004520200529      *                                                               *
004530200529      *  F U N C T I O N   O F   I N D I C A T O R S                  *
004540200529      *                                                               *
004550200529      *   13  - Program called from SE7512: Corporate Actions  (*OFF) *
004560200529      *         Depot Selection.                                      *
004570200529      *       - Program called from SE7513: Corporate Actions  (*ON)  *
004580200529      *         Customers/Books by Depots Maintenance.                *
004590200529      *   44  - Record not Found on PRICM                      (*ON)  *
004600200529      *  79 - Print Profit Centre if CAC005 is installed              *   CAC005
004610200529      *   80  - Record not Found on SECORFL1, SECTY, SECOALL0  (*ON)  *
004620200529      *       - Record not Found on SECTY                      (*ON)  *
004630200529      *       - End of file SECOALL0, SECODPL0, SECOXXL1       (*ON)  *
004640200529      *         (Where xx = 'DV', 'FR', 'RG', 'CE', 'CR', 'OF',       *
004650200529      ***********'EX',*'NF'*or*'NC').**********************************   CEU017
004660200529      *          'EX', 'NF' or 'NC') or SECOCCL2.                     *   CEU017
004670200529      *   81  - Begin or end of file SEUDEPL0, SECDEPL4        (*ON)  *
004680200529      *       - Begin of file SEDPOHL0                         (*ON)  *
004690200529      *       - End of file SECOALL0                           (*ON)  *
004700200529      *   82  - Record not Found on SECOREL0, SECODRL0         (*ON)  *
004710200529      *   83  - Record not Found on SECOSIL1, SECOSIL2         (*ON)  *
004720200529      *   84  - Record not found on SECOCHL0-L1, SECGT,        (*ON)  *
004730200529      *         SESWHTL0, CLINT (format CLINTCBF)                     *
004740200529      *   87  - Error calling PGM 'SE7534' or 'ZSFILE'         (*ON)  *
004750200529      *   88  - Indicator used in calculation specifications   (*ON)  *
004760200529      *   89  - Error detected when write, update or delete    (*ON)  *
004770200529      *         operations on SECOALL0, SECODPL0, SECODRL0            *
004780200529      *   99  - Used in calculation.                                  *
004790200529      *                                                               *
004800200529      * U7+U8 - Database Error                                        *
004810200529      *                                                               *
004820200529      *****************************************************************
004830200529      /SPACE 3
004840200529      *****************************************************************
004850200529      *                                                               *
004860200529      *  S U B R O U T I N E   I N D E X                              *
004870200529      *                                                               *
004880200529      * #INIT  - Program Initialisation.                              *
004890200529      * DETAIL - Detail Processing.                                   *
004900200529      * DADCOR - Delete Corporate Actions Allocation and Depot for    *
004910200529      *          CO Reference and Depot.                              *
004920200529      * DADNSE - Delete Corporate Actions Allocation and Depot for    *
004930200529      *          CO Reference, Option, Branch, Depot, New Security,   *
004940200529      *          Book, Customer and Portfolio.                        *
004950200529      * PDCORF - Process Detail for CO Reference depending on the     *
004960200529      *          Processing Type.                                     *
004970200529      * PDNSEC - Process Detail for CO Reference, Option Number and   *
004980200529      *          New Security, depending on the Processing Type.      *
004990200529      * PBKDPT - Process Books for the Depot.                         *
005000200529      * PCUDPT - Process Customers for the Depot.                     *
005010200529      * PDUMCU - CO Dummy Customer processing.                        *
005020200529      * PDEPOT - Process the Depot.                                   *
005030200529      * PSEDPT - Process New Security for the Deopt.                  *
005040200529      * PRDTAG - Print details of Allocation generated.               *
005050200529      * PBLOCK - Blocking processing.                                 *
005060200529      * RAAOPT - Retrieve Actual Allocation for Options and           *
005070200529      *          Actual Allocation for options within the Option.     *
005080200529      * CALLOC - Calculate Allocations:                               *
005090200529      *            - Original Stock Allocation                        *
005100200529      *            - True Stock Allocation                            *
005110200529      *            - Original Stock Rounding                          *
005120200529      *            - Original Cask Rounding.                          *
005130200529      * CALBC  - Calculate other Book/Customer Allocations.           *
005140200529      * CALDPT - Calculate other Depot Allocations.                   *
005150200529      * CCABC  - Calculate Cash Option and Actual Cash Allocation     *
005160200529      *          for Book/Customer.                                   *
005170200529      * CCADPT - Calculate Cash Option and Actual Cash Allocation for *
005180200529      *          Depot.                                               *
005190200529      * CCAOPT - Calculate Cash Option.                               *
005200200529      * CACABC - Calculate Actual Cash Allocation for Book/Customer.  *
005210200529      * CACADP - Calculate Actual Cash Allocation for Depot.          *
005220200529      * CACRBC - Calculate Actual Cash Rounding for Book/Customer.    *
005230200529      * CACRDP - Calculate Actual Cash Rounding for Depot.            *
005240200529      * CASRDP - Calculate Actual Stock Rounding for Depot.           *
005250200529      * CASABC - Calculate Actual Stock Allocation for Book/Customer. *
005260200529      * CASADP - Calculate Actual Stock Allocation for Depot.         *
005270200529      * CASRBC - Calculate Actual Stock Rounding for Book/Customer.   *
005280200529      * CTSA1  - 1st calculation of True Stock Allocation.            *
005290200529      * CTSA2  - 2nd calculation of True Stock Allocation.            *
005300200529      * COCR1  - 1st calculation of Original Cash Rounding.           *
005310200529      * COCR2  - 2nd calculation of Original Cash Rounding.           *
005320200529      * COSA1  - 1st calculation of Original Stock Allocation.        *
005330200529      * COSA2  - 2nd calculation of Original Stock Allocation.        *
005340200529      * COSR1  - 1st calculation of Original Stock Rounding.          *
005350200529      * COSR2  - 2nd calculation of Original Stock Rounding.          *
005360200529      * CHCABC - Calculate Holding Taken as Cash for Book/Customer.   *
005370200529      * CHCADP - Calculate Holding Taken as Cash for Depot.           *
005380200529      * CHSTBC - Calculate Holding Taken as Stock for Book/Customer.  *
005390200529      * CHSTDP - Calculate Holding Taken as Stock for Depot.          *
005400200529      * CACAPO - Calculate Actual Cash Pool.                          *
005410200529      * CTFEES - Calculate Total Fees for Customer.                   *
005420200529      * CALAM2 - Calculate Charge Amounts.                            *
005430200529      * CTOTAX - Calculate total Tax.                                 *
005440200529      * RTVRPL - Retrieve Customer/Book Current Reply and Customer/   *
005450200529      *          Book Standard Corporate Action Instruction.          *
005460200529      * SETNDP - Set amount from num field 24.9 to num field 15.0     *
005470200529      *          with Number of Decimal Places from Nominal Currency  *
005480200529      *          received as parameter.                               *
005490200529      * RTVNDP - Set amount from num field 15.0 to num field 24.9     *
005500200529      *          with Retrieve Number of Decimal Places from Nominal  *
005510200529      *          Currency received as parameter.                      *
005520200529      * ROUNDD - Perform rounding to the Number of Decimal Places.    *
005530200529      * WRCOAL - Write a record on SECOALL0: Corporate Actions        *
005540200529      *          Allocations file.                                    *
005550200529      * WRCODP - Write a record on SECODPL0: Corporate Actions Depots *
005560200529      *          file.                                                *
005570200529      * CSBPR  - Calculate Subscription Price if Subscription Price   *
005580200529      *          entered as Market for Dividend Events.               *
005590200529      * ENDPGM - Termination Processing.                              *
005600200529      * RCFAU  - Subroutine to register the AU Printer File via RCF.  *
005610200529      * *PSSR  - Program exception error routine.                     *
005620200529      *                                                               *
005630200529      *****************************************************************
005640200529      *                                                               *
005650200529      *  S T A N D A R D   S U B R O U T I N E   I N D E X            *
005660200529      *                                                               *
005670200529      * ZCCAL1 - Calculate Charges/Commissions.                       *
005680200529      * ZCCAL2 - Calculate Charges/Commissions (Called by standard    *
005690200529      *          subroutine ZCCAL1).                                  *
005700200529      * ZCONV  - Convert Amount from one Currency to another (Called  *
005710200529      *          by standard subroutine ZCCAL1).                      *
005720200529      *                                                               *
005730200529      *****************************************************************
005740200529      *                                                               *
005750200529      *  E X T E R N A L   S T A N D A R D   P R O G R A M S   I D X  *
005760200529      *                                                               *
005770200529      * AOBANKR0 - Access Program for Bank Details.                   *
005780200529      * AOSTRDR0 - Access Program for Securities Trading Details.     *
005790200529      * AOMMODR0 - Access Program for Module Details.                 *
005800200529      * AOPLCSR0 - Access Program for Portfolio Management Customer   *
005810200529      *            Details.                                           *
005820200529      * AOSARDR0 - Access Program for Switchable Feature Details.     *
005830200529      * AOSECSR0 - Access Program for Security Customer Details.      *
005840200529      * ZSFILE   - Midas FC Set-up Spool File Number File.            *
005850200529      *                                                               *
005860200529      *****************************************************************
005870200529      *                                                               *
005880200529      *  E X T E R N A L   P R O G R A M S   I N D E X                *
005890200529      *                                                               *
005900200529      * SE7534   - Corporate Actions Report.                          *
005910200529      *                                                               *
005920200529      *****************************************************************
005930200529      /EJECT
005940200529      *
005950200529      ***  Arrays: - ZRA: Range Limits, used in standard subroutine ZCCAL1 and ZCCAL2 (called by
005960200529      ***                 standard subroutine ZCCAL1).
005970200529      ***          - ZPC: Percentages, used in standard subroutine ZCCAL1 and ZCCAL2 (called by
005980200529      ***                 standard subroutine ZCCAL1).
005990200529      ***          - ZCG: Flat Charges, used in standard subroutine ZCCAL1.
006000200529      *
006010200529     E/COPY ZSRSRC,ZCCAL1Z1
006020200529      *
006030200529      ***  Array POWER8: POWER8 array, used in standard subroutine ZCCAL1.
006040200529      *
006050200529     E/COPY ZSRSRC,ZPOWER8Z1
006060200529      *
006070200529      ***  Array POWER: POWER array, used in standard subroutine ZCONV (called by standard
006080200529      ***  subroutine ZCCAL1).
006090200529      *
006100200529     E/COPY ZSRSRC,ZPOWERZ1
006110200529      *
006120200529      ***  Arrays to perform processing for each New Securities.
006130200529      *
006140200529     E                    TSEC       20 10
006150200529     E                    SECT       20 10
006160200529      *
006170200529      ***  Arrays to retrieve Number of New Shares.
006180200529      *
006190200529     E                    TNSH       20 16
006200200529     E                    NSHT       20 16
006210200529      *
006220200529      ***  Arrays to retrieve Rounding.
006230200529      *
006240200529     E                    TNDN       20  1
006250200529     E                    NDNT       20  1
006260200529      *
006270200529      ***  Arrays to retrieve Rounding Settlement in Cash.
006280200529      *
006290200529     E                    TNDS       20  1
006300200529     E                    NDST       20  1
006310200529      *
006320200529      ***  Arrays to retrieve Denomination Multiplier.
006330200529      *
006340200529     E                    TDML       20 16
006350200529     E                    DMLT       20 16
006360200529      *
006370200529      ***  Arrays to retrieve Compensation Price.
006380200529      *
006390200529     E                    TOPA       20 16
006400200529     E                    OPAT       20 16
006410200529      *
006420200529      ***  Array to retrieve Number of Decimal Places for New Securities.
006430200529      *
006440200529     E                    TSDP       20  1 0
006450200529      *
006460200529      ***  Array to retrieve Price Basis for New Securities.
006470200529      *
006480200529     E                    TSPB       20  1
006490200529      *
006500200529      ***  Array to retrieve Number of Decimal places for New Currencies.
006510200529      *
006520200529     E                    TCDP       20  1 0
006530200529      *
006540200529      ***  Array to input Balancing Stock Allocation of New Security to Actual Stock Allocation
006550200529      ***  for Dummy Customer.
006560200529      *
006570200529     E                    TBSA       20 30 9
006580200529      *
006590200529      ***  Array to input Balancing Stock Rounding of New Security to Actual Stock Rounding
006600200529      ***  for Dummy Customer.
006610200529      *
006620200529     E                    TBSR       20 30 9
006630200529      *
006640200529      ***  Array to input Balancing Cash Rounding of New Security to Actual Cash Rounding
006650200529      ***  for Dummy Customer.
006660200529      *
006670200529     E                    TBCR       20 30 9
006680200529      *
006690200529      ***  Array for error narrative when calling PGM.
006700200529      *
006710200529     E                    NARR    1   2 29
006720200529      *
006730200529      ***  Array containing Copyright statement.
006740200529      *
006750200529     E                    CPY@    1   1 80
006760200529      /SPACE 3
006770200529     ISECORFX0                                                            CSE020
006780200529      ** Rename fields of SECORFL0: Midas SE CA Reference File            CSE020
006790200529      *                                                                   CSE020
006800200529     I              MARECI                          MNRECI                CSE020
006810200529     I              MALCD                           MNLCD                 CSE020
006820200529     I              MACHTP                          MNCHTP                CSE020
006830200529     I              MALUID                          MNLUID                CSE020
006840200529     I              MACORF                          MNCORF                CSE020
006850200529     I              MAJOBN                          MNJOBN                CSE020
006860200529     I              MAUSER                          MNUSER                CSE020
006870200529     I              MAJNBR                          MNJNBR                CSE020
006880200529     I              MASESN                          MNSESN                CSE020
006890200529     I              MACOAT                          MNCOAT                CSE020
006900200529     I              MAPTYP                          MNPTYP                CSE020
006910200529     I              MACOAN                          MNCOAN                CSE020
006920200529     I              MACOEX                          MNCOEX                CSE020
006930200529     I              MAALEF                          MNALEF                CSE020
006940200529     I              MANBOP                          MNNBOP                CSE020
006950200529     I              MATDVD                          MNTDVD                CSE020
006960200529     I              MACOPD                          MNCOPD                CSE020
006970200529     I              MATDDT                          MNTDDT                CSE020
006980200529     I              MAEVDT                          MNEVDT                CSE020
006990200529     I              MACPNB                          MNCPNB                CSE020
007000200529     I              MASHMD                          MNSHMD                CSE020
007010200529     I              MALTBS                          MNLTBS                CSE020
007020200529     I              MAOCPV                          MNOCPV                CSE020
007030200529     I              MANCPV                          MNNCPV                CSE020
007040200529     I              MAONML                          MNONML                CSE020
007050200529     I              MANNML                          MNNNML                CSE020
007060200529     I              MACUPC                          MNCUPC                CSE020
007070200529     I              MAEXPC                          MNEXPC                CSE020
007080200529     I              MACLRD                          MNCLRD                CSE020
007090200529     I              MACLRT                          MNCLRT                CSE020
007100200529     I              MADLRD                          MNDLRD                CSE020
007110200529     I              MADLRT                          MNDLRT                CSE020
007120200529     I              MABLOS                          MNBLOS                CSE020
007130200529     I              MABLOP                          MNBLOP                CSE020
007140200529     I              MABFRD                          MNBFRD                CSE020
007150200529     I              MABEND                          MNBEND                CSE020
007160200529     I              MAREFO                          MNREFO                CSE020
007170200529     I              MACONR                          MNCONR                CSE020
007180200529     I              MADFNR                          MNDFNR                CSE020
007190200529     I              MADFCP                          MNDFCP                CSE020
007200200529     I              MADFSP                          MNDFSP                CSE020
007210200529     I              MALREQ                          MNLREQ                CSE020
007220200529     I              MALPRO                          MNLPRO                CSE020
007230200529     I              MALTSI                          MNLTSI                CSE020
007240200529     I              MASTAT                          MNSTAT                CSE020
007250200529     I              MAPREF                          MNPREF                CSE020
007260200529     ISECOALD5                                                            CSE020
007270200529      ** Rename fields of SECOALL5: Midas SE CA Stock Allocations File    CSE020
007280200529      *                                                                   CSE020
007290200529     I              MCRECI                          M5RECI                CSE020
007300200529     I              MCLCD                           M5LCD                 CSE020
007310200529     I              MCCHTP                          M5CHTP                CSE020
007320200529     I              MCLUID                          M5LUID                CSE020
007330200529     I              MCCORF                          M5CORF                CSE020
007340200529     I              MCOPTN                          M5OPTN                CSE020
007350200529     I              MCBRCD                          M5BRCD                CSE020
007360200529     I              MCDDPT                          M5DDPT                CSE020
007370200529     I              MCCOTP                          M5COTP                CSE020
007380200529     I              MCBOOK                          M5BOOK                CSE020
007390200529     I              MCCNUM                          M5CNUM                CSE020
007400200529     I              MCPTFR                          M5PTFR                CSE020
007410200529     I              MCEXPO                          M5EXPO                CSE020
007420200529     I              MCSESN                          M5SESN                CSE020
007430200529     I              MCOALR                          M5OALR                CSE020
007440200529     I              MCOTSA                          M5OTSA                CSE020
007450200529     I              MCOSTR                          M5OSTR                CSE020
007460200529     I              MCOCAR                          M5OCAR                CSE020
007470200529     I              MCCAOP                          M5CAOP                CSE020
007480200529     I              MCASTA                          M5ASTA                CSE020
007490200529     I              MCHOST                          M5HOST                CSE020
007500200529     I              MCHOCA                          M5HOCA                CSE020
007510200529     I              MCACAA                          M5ACAA                CSE020
007520200529     I              MCASTR                          M5ASTR                CSE020
007530200529     I              MCACAR                          M5ACAR                CSE020
007540200529     I              MCOPT1                          M5OPT1                CSE020
007550200529     I              MCOPT2                          M5OPT2                CSE020
007560200529     I              MCREST                          M5REST                CSE020
007570200529     I              MCBSEC                          M5BSEC                CSE020
007580200529     I              MCBEDT                          M5BEDT                CSE020
007590200529     I              MCBSTT                          M5BSTT                CSE020
007600200529     I              MCBLTY                          M5BLTY                CSE020
007610200529     I              MCBEWI                          M5BEWI                CSE020
007620200529     I              MCCOAT                          M5COAT                CSE020
007630200529     I              MCTRRF                          M5TRRF                CSE020
007640200529     I              MCTRR2                          M5TRR2                CSE020
007650200529     I              MCTRR3                          M5TRR3                CSE020
007660200529     I              MCRVRF                          M5RVRF                CSE020
007670200529     I              MCRVR2                          M5RVR2                CSE020
007680200529     I              MCRVR3                          M5RVR3                CSE020
007690200529     I              MCTNL1                          M5TNL1                CSE020
007700200529     I              MCLTRQ                          M5LTRQ                CSE020
007710200529     I              MCTOTF                          M5TOTF                CSE020
007720200529     I              MCTOTT                          M5TOTT                CSE020
007730200529      *
007740200529      ***  Rename fields of SECOFRL1: Midas SE Corporate Actions - Free Allocations.
007750200529      *
007760200529     ISECOFRD0
007770200529     I              MERECI                          MDRECI
007780200529     I              MEOPTN                          MDOPTN
007790200529     I              MENSEC                          MDNSEC
007800200529     I              MENSHA                          MDNSHA
007810200529     I              MEOSHA                          MDOSHA
007820200529     I              MEDMLT                          MDDMLT
007830200529     I              MERNDN                          MDRNDN
007840200529     I              MERNDS                          MDRNDS
007850200529     I              MECOMP                          MDCOMP
007860200529      *
007870200529      ***  Rename fields of SECORGL1: Midas SE Corporate Actions - Rights Issues.
007880200529      *
007890200529     ISECORGD0
007900200529     I              MFRECI                          MDRECI
007910200529     I              MFOPTN                          MDOPTN
007920200529     I              MFNSEC                          MDNSEC
007930200529     I              MFNSHA                          MDNSHA
007940200529     I              MFOSHA                          MDOSHA
007950200529     I              MFDMLT                          MDDMLT
007960200529     I              MFRNDN                          MDRNDN
007970200529     I              MFRNDS                          MDRNDS
007980200529     I              MFCOMP                          MDCOMP
007990200529     I              MFDFNR                          MDDFNR
008000200529      *
008010200529      ***  Rename fields of SECOCEL1: Midas SE Corporate Actions - Capital Change.
008020200529      *
008030200529     ISECOCED0
008040200529     I              MGRECI                          MDRECI
008050200529     I              MGOPTN                          MDOPTN
008060200529      *
008070200529      ***  Rename fields of SECOCRL1: Midas SE Corporate Actions - Corporate Reorganisation.
008080200529      *
008090200529     ISECOCRD0
008100200529     I              MHRECI                          MDRECI
008110200529     I              MHOPTN                          MDOPTN
008120200529     I              MHOSHA                          MDOSHA
008130200529      *
008140200529      ***  Rename fields of SECOOFL1: Midas SE Corporate Actions - Offers.
008150200529      *
008160200529     ISECOOFD0
008170200529     I              MIRECI                          MDRECI
008180200529     I              MIOPTN                          MDOPTN
008190200529     I              MINSEC                          MDNSEC
008200200529     I              MINSHA                          MDNSHA
008210200529     I              MIOSHA                          MDOSHA
008220200529     I              MIDMLT                          MDDMLT
008230200529     I              MIRNDN                          MDRNDN
008240200529     I              MIRNDS                          MDRNDS
008250200529     I              MICOMP                          MDCOMP
008260200529     I              MIDFNR                          MDDFNR
008270200529      *
008280200529      ***  Rename fields of SECOEXL1: Midas SE Corporate Actions - Exercices and Conversions.
008290200529      *
008300200529     ISECOEXD0
008310200529     I              MJRECI                          MDRECI
008320200529     I              MJOPTN                          MDOPTN
008330200529     I              MJNSEC                          MDNSEC
008340200529     I              MJNSHA                          MDNSHA
008350200529     I              MJOSHA                          MDOSHA
008360200529     I              MJSUPR                          MDSBPR
008370200529     I              MJDMLT                          MDDMLT
008380200529     I              MJRNDN                          MDRNDN
008390200529     I              MJRNDS                          MDRNDS
008400200529     I              MJCOMP                          MDCOMP
008410200529     I              MJDFNR                          MDDFNR
008420200529     I              MJRCPR                          MDRCPR                161732
008430200529      *
008440200529      ***  Rename fields of SECONFL1: Midas SE Corporate Actions - Non Financial Events.
008450200529      *
008460200529     ISECONFD0
008470200529     I              MKRECI                          MDRECI
008480200529      *
008490200529      ***  Rename fields of SECONCL1: Midas SE Corporate Actions - Name Changes.
008500200529      *
008510200529     ISECONCD0
008520200529     I              MLRECI                          MDRECI
008530200529     I              MLSESN                          MDNSEC
008540200529      *                                                                   CEU017
008550200529      ***  Rename fields of SECOCCL2: Midas SE Corporate Actions -        CEU017
008560200529      ***                             Currency Changes.                   CEU017
008570200529      *                                                                   CEU017
008580200529     ISECOCCD0                                                            CEU017
008590200529     I              NARECI                          MDRECI                CEU017
008600200529     I              NANSEC                          MDNSEC                CEU017
008610200529     I              NADMLT                          MDDMLT                CEU017
008620200529     I              NARNDN                          MDRNDN                CEU017
008630200529     I              NARNDS                          MDRNDS                CEU017
008640200529     I              NAONSZ                          MDOSHA                CEU017
008650200529     I              NANNSZ                          MDNSHA                CEU017
008660200529     I              NACOMP                          MDCOMP                CEU017
008670200529      *
008680200529      ***  Data area for database error details
008690200529      *
008700200529     ILDA         DS                            256
008710200529     I                                      132 141 WWFILE
008720200529     I                                      142 170 WWKEY
008730200529     I                                      171 180 WWPGM
008740200529     I                                      181 1830WWASE
008750200529      *
008760200529      ***  Program Status Data Structure.
008770200529      *
008780200529     IPSDS       SDS
008790200529     I                                      254 263 USER
008800200529      *
008810200529      ***  File Information Data Structure for SE7550AU.
008820200529      *
008830200529     ISPOOLU      DS
008840200529     I                                       83  92 SFILEU
008850200529     I                                    B 123 1240SFNUMU
008860200529      *
008870200529      ***  Data structure for Bank Details.                              - Prefixs BJ
008880200529      *
008890200529     ISDBANK    E DSSDBANKPD
008900200529      *
008910200529      ***  Data structure for Securities Trading Details.                - Prefixe BV
008920200529      *
008930200529     ISDSTRD    E DSSDSTRDPD
008940200529      *
008950200529      ***  Data structure for Module Details.                            - Prefixe BG
008960200529      *
008970200529     ISDMMOD    E DSSDMMODPD
008980200529      *
008990200529      ***  Data structure for Portfolio Management Customer Details.     - Prefixe QB
009000200529      *
009010200529     ISDPLCS    E DSSDPLCSPD
009020200529      *
009030200529      ***  Data structure for Security Customer Details.                 - Prefixe BF
009040200529      *
009050200529     ISDSECS    E DSSDSECSPD
009060200529      *
009070200529      ***  Data structure for Currency Details.                          - Prefixe A6
009080200529      *
009090200529     ISDCURR    E DSSDCURRPD
009100200529      *
009110200529      ***  Data structure for SE Country Tax Rate Details.               - Prefixe TX
009120200529      *
009130200529     ISECNTR    E DSSECNTRPD
009140200529      *
009150200529      ***  Data structure for SE Country to Branch Tax Rate Details.     - Prefixe TB
009160200529      *
009170200529     ISECBTX    E DSSECBTXPD
009180200529      *
009190200529      ***  Data structure for Branch Details.                            - Prefixe A8
009200200529      *
009210200529     ISDBRCH    E DSSDBRCHPD
009220200529      *                                                                   CPB001
009230200529      ***  Data structure for Customer Details.                           CPB001
009240200529      *                                                                   CPB001
009250200529     ISDCUST    E DSSDCUSTPD                                              CPB001
009260200529      *
009270200529      ***  Short data structure for access objects.
009280200529      *
009290200529     I              QQDFAC                          QQDFA1                                    CGL029
009300200529     IDSFDY     E DSDSFDY
009310200529      *
009320200529      ***  Long data structure for access objects.
009330200529      *
009340200529     IDSSDY     E DSDSSDY
009350200529      *                                                                   CPB001
009360200529      ***  Very Long data structure for access objects.                   CPB001
009370200529      *                                                                   CPB001
009380200529     IDSLDY     E DSDSLDY                                                 CPB001
009390200529      *
009400200529      ***  Data Area giving Midas SE Status.
009410200529      *
009420200529     ISESTAT    E DSSESTAT
009430200529      *
009440200529      /EJECT
009450200529      *================================================================
009460200529      *  P R O G R A M   S T A R T                                    *
009470200529      *================================================================
009480200529      *
009490200529      ***  Perform Initialisation.
009500200529      *
009510200529     C                     EXSR #INIT
009520200529      *
009530200529      ***  Details Processing.
009540200529      *
009550200529     C                     EXSR DETAIL
009560200529      *
009570200529      ***  Termination Processing.
009580200529      *
009590200529     C                     EXSR ENDPGM
009600200529      *
009610200529      *================================================================
009620200529      *  P R O G R A M   E N D                                        *
009630200529      *================================================================
009640200529      /EJECT
009650200529      *****************************************************************
009660200529      *                                                               *
009670200529      * #INIT  - Program Initialisation.                              *
009680200529      *                                                               *
009690200529      * Called by: Main Processing.                                   *
009700200529      *                                                               *
009710200529      * Calls:                                                        *
009720200529      *                                                               *
009730200529      *****************************************************************
009740200529      *
009750200529     C           #INIT     BEGSR                           ** #INIT SR **
009760200529      *
009770200529      ***  Entry Parameters.
009780200529      *
009790200529     C           *ENTRY    PLIST
009800200529     C                     PARM           PCORF            CO Reference
009810200529     C                     PARM           PBRCD            Branch Code
009820200529     C                     PARM           PDDPT   6        Depot
009830200529     C                     PARM           POPTN   2        Option Number
009840200529     C                     PARM           PNSEC            New Security
009850200529     C***********          PARM           PBOOK            Book Code      CAC005
009860200529     C                     PARM           PBOOK   2        Book Code      CAC005
009870200529     C                     PARM           PCNUM   6        Customer Number
009880200529     C                     PARM           PPTFR            Portfolio Reference
009900200529      *
009910200529      ***  Set up copyright parameter.
009920200529      *
009930200529     C                     MOVEACPY@      CPY2@  80
009940200529      *
009950200529      ***  Define Local Data Area and Midas SE Status Data Area.
009960200529      *
009970200529     C           *NAMVAR   DEFN           LDA
009980200529     C           *NAMVAR   DEFN           SESTAT
009990200529      *
010000200529      ***  Access data area SESTAT: Midas SE Status to check if Portfolio Management have been
010010200529      ***  licensed.
010020200529      *
010030200529     C                     IN   SESTAT
010040200529      *
010050200529      ***  If Book Code or Customer Number received as parameter not blank, it seams that program
010060200529      ***  called from SE7513: Corporate Actions Customers/Books by Depots Maintenance,
010070200529      ***  else program called from SE7512: Corporate Actions Depot Selection.
010080200529      *
010090200529     C           PBOOK     IFNE *BLANKS
010100200529     C           PCNUM     ORNE *BLANKS
010110200529     C                     MOVE '1'       *IN13
010120200529     C                     MOVE POPTN     WWOPTN  20       Option Number (num field - parameter)
010130200529     C           PCNUM     IFNE *BLANKS
010140200529     C**********           MOVE PCNUM     WWCNUM  60      Customer No (num field - parameter) CSD027
010150200529     C                     MOVE PCNUM     WWCNUM  6        Customer No (num field - parameter CSD027
010160200529     C                     MOVE 'C'       KCOTP   1        Customer/Book Indicator (for key list)
010170200529     C                     ELSE
010180200529     C                     MOVE 'B'       KCOTP            Customer/Book Indicator (for key list)
010190200529     C                     ENDIF
010200200529     C                     ENDIF
010210200529      *
010220200529      ***  Initialise work fields.
010230200529      *
010240200529     C                     MOVE *BLANKS   WWERPT  4        Portfolio Reference
010250200529     C**********           MOVE PDDPT     WWDDPT  60       Depot (num field - parameter)      CSD027
010260200529     C                     MOVE PDDPT     WWDDPT  6        Depot (num field - parameter)      CSD027
010270200529     C                     MOVEL'SE7550'  DBPGM
010280200529     C                     MOVE PROT      PROT    1
010290200529     C                     MOVE POPTN     ROPT
010300200529     C                     MOVE 'A'       KRTYP            Record Type for Key
010310200529      *
010320200529      ***  Define key lists.
010330200529      *
010340200529     C           @KEY1     KLIST                           Short key for files SEUDEPL0,SECDEPL4
010350200529     C                     KFLD           PBRCD            Branch (Parameter)
010360200529     C                     KFLD           MASESN           Security (from SECORFL1)
010370200529     C                     KFLD           WWDDPT           Depot (num field - Parameter)
010380200529      *
010390200529     C           @KEY2     KLIST                           Long key for file SEUDEPL0
010400200529     C                     KFLD           PBRCD            Branch (Parameter)
010410200529     C                     KFLD           MASESN           Security (from SECORFL1)
010420200529     C                     KFLD           WWDDPT           Depot (num field - Parameter)
010430200529     C                     KFLD           WWUDMK           Market Ind. (work field)
010440200529     C                     KFLD           WWUDBK           Book (work field)
010450200529     C                     KFLD           KUDDT            Date
010460200529      *
010470200529     C           @KEY3     KLIST                           Long key for file SECDEPL4
010480200529     C                     KFLD           PBRCD            Branch (Parameter)
010490200529     C                     KFLD           MASESN           Security (from SECORFL1)
010500200529     C                     KFLD           WWDDPT           Depot (num field - Parameter)
010510200529     C                     KFLD           WWUDMK           Market Ind. (work field)
010520200529     C                     KFLD           WWCDCN           Customer (work field)
010530200529     C                     KFLD           WWPTFR           Portolio Reference (work field)
010540200529     C                     KFLD           KUDDT            Date
010550200529      *
010560200529     C           @KEY4     KLIST                           Key for file SEDPOHL0
010570200529     C                     KFLD           PBRCD            Branch (Parameter)
010580200529     C                     KFLD           WWDDPT           Depot (num field - Parameter)
010590200529     C                     KFLD           MASESN           Security (from SECORFL1)
010600200529     C                     KFLD           MACOEX           Ex-Date (from SECORFL1)
010610200529      *
010620200529     C           @KEY5     KLIST                           1st short key for file SECOALL0
010630200529     C                     KFLD           PCORF            CO Reference (Parameter)
010640200529     C                     KFLD           WWOPTN           Option Number
010650200529     C                     KFLD           PBRCD            Branch (Parameter)
010660200529     C                     KFLD           WWDDPT           Depot (num field - Parameter)
010670200529      *
010680200529     C           @KEY6     KLIST                           Key for file SECOREL0
010690200529     C                     KFLD           PCORF            CO Reference (Parameter)
010700200529     C                     KFLD           PBRCD            Branch (Parameter)
010710200529     C                     KFLD           WWCOTP           Customer/Book Indicator (Calculated)
010720200529     C                     KFLD           WWUDBK           Book (from SEUDEPL0)
010730200529     C                     KFLD           WWCDCN           Customer (from SECDEPL4)
010740200529      *
010750200529     C           @KEY7     KLIST                           Key for file SECOSIL2
010760200529     C                     KFLD           PBRCD            Branch (Parameter)
010770200529     C                     KFLD           KUDBK   2        Book
010780200529     C                     KFLD           KCOAT   2        Corporate Action Type
010790200529     C                     KFLD           KSESN  10        Security
010800200529      *
010810200529     C           @KEY8     KLIST                           Key for file CLINT (format CLINTCBF)
010820200529     C**********           KFLD           KCUST   60       Customer                           CSD027
010830200529     C                     KFLD           KCUST   6        Customer                           CSD027
010840200529     C                     KFLD           KRTYP   1        Record Type
010850200529      *
010860200529     C           @KEY9     KLIST                           Key for file SECOSIL1
010870200529     C                     KFLD           PBRCD            Branch (Parameter)
010880200529     C**********           KFLD           KCDCN   60       Customer                           CSD027
010890200529     C                     KFLD           KCDCN   6        Customer                           CSD027
010900200529     C                     KFLD           KPTFR   4        Portfolio Reference
010910200529     C                     KFLD           KCOAT            Corporate Action Type
010920200529     C                     KFLD           KSESN            Security
010930200529      *
010940200529     C           @KEY12    KLIST                           Key for file SECODRL0
010950200529     C                     KFLD           PCORF            CO Reference (Parameter)
010960200529     C                     KFLD           PBRCD            Branch (Parameter)
010970200529     C                     KFLD           WWDDPT           Depot (num field - Parameter)
010980200529      *
010990200529     C           @KEY13    KLIST                           Key for file SECOCHL0
011000200529     C                     KFLD           KCUGR   2        Customer Group
011010200529     C                     KFLD           KCDCN            Customer
011020200529     C                     KFLD           KSITP   3        Investment Type
011030200529     C                     KFLD           KCOAT            Corporate Action Type
011040200529      *
011050200529     C           @KEY14    KLIST                           Key for file SECOCHL1
011060200529     C                     KFLD           KCLAS   1        Classification
011070200529     C                     KFLD           KCDCN            Customer
011080200529     C                     KFLD           KSITP            Investment Type
011090200529     C                     KFLD           KCOAT            Corporate Action Type
011100200529      *
011110200529     C           @KEY17    KLIST                           Key for file SECGT
011120200529     C                     KFLD           ESNCCY           Event Nominal Currency
011130200529     C                     KFLD           KCCOM            Charge Code
011140200529      *
011150200529     C           @KEY18    KLIST                           Long key for file SECOALL0
011160200529     C                     KFLD           PCORF            CO Reference (parameter)
011170200529     C                     KFLD           WWOPTN           Option Number (Num field - parameter)
011180200529     C                     KFLD           PBRCD            Branch Code (parameter)
011190200529     C                     KFLD           WWDDPT           Depot (num field - parameter)
011200200529     C                     KFLD           KSESN            New Security
011210200529     C                     KFLD           KCOTP            Customer/Book Indicator
011220200529     C                     KFLD           PBOOK            Book Code (parameter)
011230200529     C                     KFLD           WWCNUM           Customer Number (num field - parameter)
011240200529     C                     KFLD           PPTFR            Portfolio Reference (parameter)
011250200529      *
011260200529     C           @KEY19    KLIST                           Key for file SECOxxL1
011270200529     C                     KFLD           PCORF            CO Reference (parameter)
011280200529     C                     KFLD           WWOPTN           Option Number (Num field - parameter)
011290200529      *
011300200529     C           @KEY20    KLIST                           Short key for file SECOALL0-SECODPL0
011310200529     C                     KFLD           PCORF            CO Reference (parameter)
011320200529     C                     KFLD           WWOPTN           Option Number (Num field - parameter)
011330200529     C                     KFLD           PBRCD            Branch Code (parameter)
011340200529     C                     KFLD           WWDDPT           Depot (num field - parameter)
011350200529      *
011360200529     C           @KEY21    KLIST                           Key for file PRICM
011370200529     C                     KFLD           MDNSEC           New Security from SECODVL1
011380200529     C                     KFLD           KPVDT   50       Value Date
011390200529      *                                                                   CSE020
011400200529     C           @KEY22    KLIST                                          CSE020
011410200529     C                     KFLD           MAPREF                          CSE020
011420200529     C                     KFLD           WKBRCD  3                       CSE020
011430200529     C**********           KFLD           WKDDPT  60                                   CSE020 CSD027
011440200529     C                     KFLD           WKDDPT  6                                           CSD027
011450200529     C                     KFLD           WKCOTP  1                       CSE020
011460200529     C                     KFLD           WKBOOK  2                       CSE020
011470200529     C**********           KFLD           WKCNUM  60                                   CSE020 CSD027
011480200529     C                     KFLD           WKCNUM  6                                           CSD027
011490200529     C                     KFLD           WKPTFR  4                       CSE020
011500200529     C                     KFLD           MASESN                          CSE020
011510200529      *                                                                   CSE020
011520200529     C           @KEY23    KLIST                                          CSE020
011530200529     C                     KFLD           MAPREF                          CSE020
011540200529     C                     KFLD           DSBA                            CSE020
011550200529     C                     KFLD           DDPT                            CSE020
011560200529      *
011570200529      ***  RCF Processing for Audit File.
011580200529      *
011590200529     C                     EXSR RCFAU
011600200529      *
011610200529      ***  Call Access Program for Bank Details.
011620200529      *
011630200529     C                     CALL 'AOBANKR0'
011640200529     C                     PARM *BLANKS   @RTCD   7
011650200529     C                     PARM '*FIRST'  @OPTN   7
011660200529     C           SDBANK    PARM SDBANK    DSSDY
011670200529      *
011680200529      ***  Handle Database Error.
011690200529      *
011700200529     C           @RTCD     IFNE *BLANKS
011710200529     C                     Z-ADD001       DBASE            ***************
011720200529     C                     MOVEL'SDBANKPD'DBFILE           * DB ERROR 01 *
011730200529     C                     MOVEL*BLANKS   DBKEY            ***************
011740200529     C                     EXSR *PSSR
011750200529     C                     ENDIF
011760200529      *
011770200529      ***  Call Access Program for Switchable Feature Details to see if Private Banking SE
011780200529      ***  Enhancements is installed.
011790200529      *
011800200529     C                     MOVE 'N'       S01496  1
011810200529     C                     CALL 'AOSARDR0'
011820200529     C                     PARM '       ' @RTCD
011830200529     C                     PARM '*VERIFY' @OPTN
011840200529     C                     PARM 'S01496'  @SARD   6
011850200529      *
011860200529     C           @RTCD     IFEQ *BLANKS
011870200529     C                     MOVE 'Y'       S01496
011880200529     C                     ENDIF
011890200529      *
011900200529      ***  Call Access Program for Switchable Feature Details to see if Customer Commissions
011910200529      ***  (Courtage) amendment is installed.
011920200529      *
011930200529     C                     MOVE 'N'       S01446  1
011940200529     C                     CALL 'AOSARDR0'
011950200529     C                     PARM '       ' @RTCD
011960200529     C                     PARM '*VERIFY' @OPTN
011970200529     C                     PARM 'S01446'  @SARD
011980200529      *
011990200529     C           @RTCD     IFEQ *BLANKS
012000200529     C                     MOVE 'Y'       S01446
012010200529     C                     ENDIF
012020200529      *
012030200529      ***  Call Access Program for Switchable Feature Details to see if Withholding Tax feature
012040200529      ***  is installed.
012050200529      *
012060200529     C                     MOVE 'N'       S01447  1
012070200529     C                     CALL 'AOSARDR0'
012080200529     C                     PARM '       ' @RTCD
012090200529     C                     PARM '*VERIFY' @OPTN
012100200529     C                     PARM 'S01447'  @SARD   6
012110200529      *
012120200529     C           @RTCD     IFEQ *BLANKS
012130200529     C                     MOVE 'Y'       S01447
012140200529     C                     ENDIF
012150200529      *                                                                   CAC005
012160200529      ** Check if CAC005 is installed                                     CAC005
012170200529      *                                                                   CAC005
012180200529     C                     CALL 'AOSARDR0'                                CAC005
012190200529     C                     PARM *BLANKS   PRTCD   7                       CAC005
012200200529     C                     PARM '*VERIFY' P1OPTN  7                       CAC005
012210200529     C                     PARM 'CAC005'  PSARD   6                       CAC005
012220200529      *                                                                   CAC005
012230200529     C           PRTCD     IFEQ *BLANKS                                   CAC005
012240200529     C                     MOVE 'Y'       CAC005  1                       CAC005
012250200529     C                     MOVE *ON       *IN79                           CAC005
012260200529     C                     ELSE                                           CAC005
012270200529     C                     MOVE 'N'       CAC005                          CAC005
012280200529     C                     MOVE *OFF      *IN79                           CAC005
012290200529     C                     ENDIF                                          CAC005
012300200529      *                                                                   CAC005
012310200529     C                     MOVELPBOOK     PBOOK1                          CAC005
012320200529     C                     MOVEL*BLANKS   PPRCT                           CAC005
012330200529      *                                                                   CAC005
012340200529     C           CAC005    IFEQ 'Y'                                       CAC005
012350200529     C           PBOOK     ANDNE*BLANKS                                   CAC005
012360200529     C                     CALL 'AOBKPCR0'                                CAC005
012370200529     C                     PARM *BLANKS   PRTCD                           CAC005
012380200529     C                     PARM '*USER  ' P1OPTN                          CAC005
012390200529     C                     PARM           PBKCD   2                       CAC005
012400200529     C                     PARM           PPRFC   4                       CAC005
012410200529     C                     PARM PBOOK     PPSBK   2                       CAC005
012420200529      *                                                                   CAC005
012430200529     C           PRTCD     IFEQ *BLANKS                                   CAC005
012440200529     C                     MOVELPBKCD     PBOOK1                          CAC005
012450200529     C                     MOVELPPRFC     PPRCT                           CAC005
012460200529     C                     ENDIF                                          CAC005
012470200529     C                     ENDIF                                          CAC005
012480200529      *
012490200529      ***  Call Access Program for Securities Trading Details.
012500200529      *
012510200529     C                     CALL 'AOSTRDR0'
012520200529     C                     PARM *BLANKS   @RTCD   7
012530200529     C                     PARM '*FIRST'  @OPTN   7
012540200529     C           SDSTRD    PARM SDSTRD    DSSDY
012550200529      *
012560200529      ***  Handle Database Error.
012570200529      *
012580200529     C           @RTCD     IFNE *BLANKS
012590200529     C                     Z-ADD002       DBASE            ***************
012600200529     C                     MOVEL'SDSTRDPD'DBFILE           * DB ERROR 02 *
012610200529     C                     MOVEL*BLANKS   DBKEY            ***************
012620200529     C                     EXSR *PSSR
012630200529     C                     ENDIF
012640200529      *
012650200529      ***  Call Access Program for Module Details - Portfolio Management Indicator.
012660200529      *
012670200529     C                     CALL 'AOMMODR0'
012680200529     C                     PARM *BLANKS   @RTCD
012690200529     C                     PARM '*FIRST'  @OPTN
012700200529     C           SDMMOD    PARM SDMMOD    DSFDY
012710200529      *
012720200529      ***  Handle Database Error.
012730200529      *
012740200529     C           @RTCD     IFNE *BLANKS
012750200529     C                     Z-ADD003       DBASE            ***************
012760200529     C                     MOVEL'SDMMODPD'DBFILE           * DB ERROR 03 *
012770200529     C                     MOVEL*BLANKS   DBKEY            ***************
012780200529     C                     EXSR *PSSR
012790200529     C                     ENDIF
012800200529      *                                                                   CPB001
012810200529     C           BGPFMG    IFEQ 'Y'                                       CPB001
012820200529     C           BGN4ST    OREQ 'Y'                                       CPB001
012830200529      *
012840200529      ***  If Portfolio Management Indicator = 'Y'.
012850200529      *
012860200529     C                     MOVE 'N'       WWEXC   1                       CPB001
012870200529     C           BGPFMG    IFEQ 'Y'
012880200529      *
012890200529      ***  Call Access Program for Portfolio Management Customer Details to check if CO
012900200529      ***  Dummy Customer is a Portfolio Customer.
012910200529      *
012920200529     C                     CALL 'AOPLCSR0'
012930200529     C                     PARM *BLANKS   @RTCD
012940200529     C                     PARM '*KEY  '  @OPTN
012950200529     C                     PARM BVERCU    @CUST  10
012960200529     C           SDPLCS    PARM SDPLCS    DSSDY
012970200529      *
012980200529      ***  If CO Dummy Customer is a Portfolio Customer, setup Portfolio Reference work field.
012990200529      *
013000200529     C           @RTCD     IFEQ *BLANKS                    Found
013010200529     C           BGN4ST    ANDNE'Y'                                       CPB001
013020200529     C                     MOVEL'9997'    WWERPT
013030200529     C                     ELSE                                           CPB001
013040200529     C           @RTCD     IFEQ *BLANKS                                   CPB001
013050200529     C                     MOVE 'Y'       WWEXC                           CPB001
013060200529     C                     ENDIF                                          CPB001
013070200529     C                     ENDIF
013080200529     C                     ENDIF
013090200529      *                                                                   CPB001
013100200529      ***  If Private Banking is ON                                       CPB001
013110200529      *                                                                   CPB001
013120200529     C           BGN4ST    IFEQ 'Y'                                       CPB001
013130200529     C                     CALL 'AOCUSTR1'                                CPB001
013140200529     C                     PARM *BLANKS   @RTCD                           CPB001
013150200529     C                     PARM '*KEY    '@OPTN                           CPB001
013160200529     C                     PARM BVERCU    @CUST                           CPB001
013170200529     C                     PARM           WWK7    7                       CPB001
013180200529     C           SDCUST    PARM SDCUST    DSLDY                           CPB001
013190200529     C           @RTCD     IFEQ *BLANKS                                   CPB001
013200200529     C           BBPRBA    ANDEQ'Y'                                       CPB001
013210200529     C                     MOVE 'Y'       WWEXC                           CPB001
013220200529     C                     ENDIF                                          CPB001
013230200529     C                     ENDIF                                          CPB001
013240200529      *                                                                   CPB001
013250200529      ***  Default Portfolio Reference if neede                           CPB001
013260200529      *                                                                   CPB001
013270200529     C           WWEXC     IFEQ 'Y'                                       CPB001
013280200529     C                     OPEN PMPORTLL                                  CPB001
013290200529     C**********           MOVELBVERCU    WKCUST  60                                   CPB001 CSD027
013300200529     C                     MOVELBVERCU    WKCUST  6                                           CSD027
013310200529     C           WKCUST    SETLLPMPORTLL                                  CPB001
013320200529     C           WKCUST    READEPMPORTLL                 89               CPB001
013330200529     C           *IN89     IFEQ *OFF                                      CPB001
013340200529     C                     MOVE PNPTFR    WWERPT                          CPB001
013350200529     C                     ENDIF                                          CPB001
013360200529     C                     CLOSEPMPORTLL                                  CPB001
013370200529     C                     ENDIF                                          CPB001
013380200529     C                     ENDIF                                          CPB001
013390200529      *
013400200529      ***  If Withholding Tax feature is ON.
013410200529      *
013420200529     C           S01447    IFEQ 'Y'
013430200529      *
013440200529      ***  Call Access Program for Branch Details to retrieve Branch Internal Customer.
013450200529      *
013460200529     C**********           CALL 'AOBRCHR0'                                                    CGL029
013470200529     C                     CALL 'AOBRCHR1'                                                    CGL029
013480200529     C                     PARM *BLANKS   @RTCD
013490200529     C                     PARM '*KEY   ' @OPTN
013500200529     C                     PARM PBRCD     @BRCD   3
013510200529     C********** SDBRCH    PARM SDBRCH    DSFDY                                               CGL029
013520200529     C           SDBRCH    PARM SDBRCH    DSSDY                                               CGL029
013530200529      *
013540200529      ***  If record not found, handle Database Error.
013550200529      *
013560200529     C           @RTCD     IFNE *BLANKS
013570200529     C                     Z-ADD004       DBASE            ***************
013580200529     C                     MOVEL'SDBRCHPD'DBFILE           * DB ERROR 04 *
013590200529     C                     MOVELPBRCD     DBKEY            ***************
013600200529     C                     EXSR *PSSR
013610200529     C                     ELSE
013620200529      *
013630200529      ***  Otherwise, retrieve Country of Location for Branch Interbal Customer.
013640200529      *
013650200529     C                     MOVE A8BICN    KCUST
013660200529     C           @KEY8     CHAINCLINT                84
013670200529      *
013680200529      ***  If record not found or not live, handle Database Error.
013690200529      *
013700200529     C           *IN84     IFEQ '1'
013710200529     C           RECI      OREQ '*'
013720200529     C                     Z-ADD005       DBASE            ***************
013730200529     C                     MOVEL'CLINTCB 'DBFILE           * DB ERROR 05 *
013740200529     C                     MOVELKCUST     DBKEY2  7        ***************
013750200529     C                     MOVE KRTYP     DBKEY2
013760200529     C                     MOVELDBKEY2    DBKEY
013770200529     C                     EXSR *PSSR
013780200529     C                     ELSE
013790200529      *
013800200529      ***  Otherwise, set Country of Location for Branch Internal Customer.
013810200529      *
013820200529     C                     MOVE CLOC      UBRLOC  2
013830200529     C                     ENDIF
013840200529     C                     ENDIF
013850200529     C                     ENDIF
013860200529     C/COPY WNCPYSRC,SE7550C001
013870200529      *
013880200529     C                     ENDSR
013890200529      *
013900200529      *****************************************************************
013910200529      /EJECT
013920200529      *****************************************************************
013930200529      *                                                               *
013940200529      * DETAIL - Detail Processing.                                   *
013950200529      *                                                               *
013960200529      * Called by: Main Processing.                                   *
013970200529      *                                                               *
013980200529      * Calls:                                                        *
013990200529      *                                                               *
014000200529      *****************************************************************
014010200529      *
014020200529     C           DETAIL    BEGSR                           ** DETAIL SR **
014030200529      *
014040200529      ***  Access Corporate Actions file with CO Reference received as parameter to obtain details.
014050200529      *
014060200529     C           PCORF     CHAINSECORFL1             80
014070200529      *
014080200529      ***  If record not found, handle Database Error.
014090200529      *
014100200529     C           *IN80     IFEQ '1'                        Not found
014110200529     C                     Z-ADD006       DBASE            ***************
014120200529     C                     MOVEL'SECORFL1'DBFILE           * DB ERROR 06 *
014130200529     C                     MOVELPCORF     DBKEY            ***************
014140200529     C                     EXSR *PSSR
014150200529     C                     ENDIF
014160200529      *                                                                   CSE020
014170200529      ** If CA is a child, obtain the Security from the Originating CA    CSE020
014180200529      *                                                                   CSE020
014190200529     C           MAPREF    IFNE *BLANKS                                   CSE020
014200200529     C           MAPREF    CHAINSECORFL0             70                   CSE020
014210200529     C           *IN70     IFEQ *ON                                       CSE020
014220200529     C           *LOCK     IN   LDA                                       CSE020
014230200529     C                     Z-ADD040       DBASE            ***************CSE020
014240200529     C                     MOVEL'SECORFPD'DBFILE           * DB ERROR 040*CSE020
014250200529     C                     MOVELMAPREF    DBKEY            ***************CSE020
014260200529     C                     OUT  LDA                                       CSE020
014270200529     C                     EXSR *PSSR                                     CSE020
014280200529     C                     ENDIF                                          CSE020
014290200529     C           MNPREF    DOWNE*BLANKS                                   CSE020
014300200529     C           MNPREF    CHAINSECORFL0             70                   CSE020
014310200529     C           *IN70     IFEQ *ON                                       CSE020
014320200529     C           *LOCK     IN   LDA                                       CSE020
014330200529     C                     Z-ADD041       DBASE            ***************CSE020
014340200529     C                     MOVEL'SECORFPD'DBFILE           * DB ERROR 041*CSE020
014350200529     C                     MOVELMNPREF    DBKEY            ***************CSE020
014360200529     C                     OUT  LDA                                       CSE020
014370200529     C                     EXSR *PSSR                                     CSE020
014380200529     C                     ENDIF                                          CSE020
014390200529     C                     ENDDO                                          CSE020
014400200529     C                     MOVE MNSESN    WOSESN 10                       CSE020
014410200529     C                     ENDIF                                          CSE020
014420200529      *
014430200529      ***  Retrieve field 'Letter Required'.
014440200529      *
014450200529     C                     MOVE MALREQ    WWLTRQ  1
014460200529      *
014470200529      ***  Access Midas SE Securities.
014480200529      *
014490200529     C           MASESN    CHAINSECTY                80
014500200529      *
014510200529      ***  If record not found, handle Database Error.
014520200529      *
014530200529     C           *IN80     IFEQ '1'                        Not found
014540200529     C                     Z-ADD007       DBASE            ***************
014550200529     C                     MOVEL'SECTY'   DBFILE           * DB ERROR 07 *
014560200529     C                     MOVELMASESN    DBKEY            ***************
014570200529     C                     EXSR *PSSR
014580200529     C                     ENDIF
014590200529      *
014600200529      ***  Save Nominal Currency, Number of Decimal Places for Nominal Currency, Investment Type,
014610200529      ***  Market Centre and Price Basis of Event Security from SECORFL1.
014620200529      *
014630200529     C                     MOVE NMCY      ESNCCY  3        Nominal Currency
014640200529     C                     Z-ADDNMDP      ESNBDP  10       Number of Decimal Places
014650200529     C                     MOVE SITP      ESSITP  3        Investment Type
014660200529     C                     MOVE SMCC      ESSMCC  2        Market Centre
014670200529     C                     MOVE SPBS      ESSPBS  1        Price Basis
014680200529      *
014690200529      ***  Retrieve Number of Decimal Places of Event Currency by calling access objet.
014700200529      *
014710200529     C                     CALL 'AOCURRR0'
014720200529     C                     PARM '*MSG   ' @RTCD   7
014730200529     C                     PARM '*KEY   ' @OPTN   7
014740200529     C                     PARM ESNCCY    @AJCD   3
014750200529     C           SDCURR    PARM SDCURR    DSSDY
014760200529      *
014770200529      ***  If record not found, handle Database Error.
014780200529      *
014790200529     C           @RTCD     IFNE *BLANKS
014800200529     C                     Z-ADD008       DBASE            ***************
014810200529     C                     MOVEL'SDCURRPD'DBFILE           * DB ERROR 08 *
014820200529     C                     MOVEL@AJCD     DBKEY            ***************
014830200529     C                     EXSR *PSSR
014840200529     C                     ENDIF
014850200529     C                     Z-ADDA6NBDP    ECNBDP  10
014860200529      *
014870200529      ***  If program called from SE7512: Corporate Actions Depot Selection (*IN13 OFF).
014880200529      *
014890200529     C           *IN13     IFEQ '0'
014900200529      *
014910200529      ***  Delete Corporate Actions Allocation and Depot for CO Reference and Depot received as
014920200529      ***  parameter.
014930200529      *
014940200529     C                     EXSR DADCOR
014950200529      *
014960200529      ***  Process Detail for CO Reference depending on the Processing Type.
014970200529      *
014980200529     C                     EXSR PDCORF
014990200529      *
015000200529      ***  Else, if program called from SE7513: Corporate Actions Customers/Books by Depots
015010200529      ***  Maintenance (*IN13 ON).
015020200529      *
015030200529     C                     ELSE
015040200529      *
015050200529      ***  Delete Corporate Actions Allocation and Depot for CO Reference, Option Number, Branch,
015060200529      ***  Depot, New Security, Book, Customer and Portfolio.
015070200529      *
015080200529     C                     EXSR DADNSE
015090200529      *
015100200529      ***  Process Detail for CO Reference, Option Number and New Security, depending on the
015110200529      ***  Processing Type.
015120200529      *
015130200529     C                     EXSR PDNSEC
015140200529     C                     ENDIF
015150200529      *
015160200529     C                     ENDSR
015170200529      *
015180200529      *****************************************************************
015190200529      /EJECT
015200200529      *****************************************************************
015210200529      *                                                               *
015220200529      * PBKDPT - Process Books for the Depot.                         *
015230200529      *                                                               *
015240200529      * Called by:                                                    *
015250200529      *                                                               *
015260200529      * Calls:                                                        *
015270200529      *                                                               *
015280200529      *****************************************************************
015290200529      *
015300200529     C           PBKDPT    BEGSR                           ** PBKDPT SR **
015310200529      *
015320200529      ***  Reset work fields.
015330200529      *
015340200529     C**********           MOVE *ZEROS    WWCDCN  60       Customer                           CSD027
015350200529     C                     MOVE *BLANKS   WWCDCN  6        Customer                           CSD027
015360200529     C                     MOVE *BLANKS   WWPTFR  4        Protfolio Reference
015370200529      *                                                                   CSE020
015380200529      ** If CA is a child, save Security. Instead, use Security           CSE020
015390200529      ** obtained from the Originating CA before reading SEUDEPL0.        CSE020
015400200529      *                                                                   CSE020
015410200529     C           MAPREF    IFNE *BLANKS                                   CSE020
015420200529     C                     MOVE MASESN    WKSESN 10                       CSE020
015430200529     C                     MOVE WOSESN    MASESN                          CSE020
015440200529     C                     ENDIF                                          CSE020
015450200529      *
015460200529      ***  If program called from SE7512: Corporate Actions Depot Selection.
015470200529      *
015480200529     C           *IN13     IFEQ '0'
015490200529      *
015500200529      ***  Set lower on User Depot Positions Details file with Branch, Security and Depot (num
015510200529      ***  field) received as parameter and read next record.
015520200529      *
015530200529     C           @KEY1     SETLLSEUDEPL0
015540200529     C                     READ SEUDEPL0                 81
015550200529      *
015560200529      ***  Else, if program called from SE7513: Corporate Actions Customers/Books by Depots
015570200529      ***  Maintenance.
015580200529      *
015590200529     C                     ELSE
015600200529      *
015610200529      ***  Set lower on User Depot Positions Details file with Branch, Security and Depot (num
015620200529      ***  field) received as parameter and read next record until Book = Book received as
015630200529      ***  parameter.
015640200529      *
015650200529     C                     MOVE '0'       *IN88
015660200529     C           @KEY1     SETLLSEUDEPL0
015670200529     C           @KEY1     READESEUDEPL0                 81
015680200529     C   81                MOVE '1'       *IN88
015690200529     C           *IN88     DOWEQ'0'
015700200529     C           UDBK      IFEQ PBOOK
015710200529     C                     MOVE '1'       *IN88
015720200529     C                     ELSE
015730200529     C           @KEY1     READESEUDEPL0                 81
015740200529     C   81                MOVE '1'       *IN88
015750200529     C                     ENDIF
015760200529     C                     ENDDO
015770200529     C                     ENDIF
015780200529      *
015790200529      ***  Save Market Indicator.
015800200529      *
015810200529     C                     MOVE UDMK      WWUDMK  1
015820200529      *
015830200529      ***  Do while not end of file, and record read with same Branch, Security and Depot (num
015840200529      ***  field) received as parameter and same Market Indicator saved, if program called from
015850200529      ***  SE7512: Corporate Actions Depot Selection,
015860200529      ***  OR do while not end of file, and record read with same Branch, New Security, Depot (num
015870200529      ***  field) and Book received as parameter and same Market Indicator saved, if program called
015880200529      ***  from SE7513: Corporate Actions Customers/Books by Depots Maintenance.
015890200529      *
015900200529     C           *IN81     DOWEQ'0'                        Do while: Not end of file
015910200529     C           *IN13     ANDEQ'0'                                  Program called from SE7512
015920200529     C           UDBA      ANDEQPBRCD                                Same Branch
015930200529     C           UDSN      ANDEQMASESN                               Same Security
015940200529     C           UDPT      ANDEQWWDDPT                               Same Depot
015950200529     C           UDMK      ANDEQWWUDMK                               Same Market Indicator
015960200529     C           *IN81     OREQ '0'                        OR      : Not end of file
015970200529     C           *IN13     ANDEQ'1'                                  Program called from SE7513
015980200529     C           UDBA      ANDEQPBRCD                                Same Branch
015990200529     C           UDSN      ANDEQMASESN                               Same Security
016000200529     C           UDPT      ANDEQWWDDPT                               Same Depot
016010200529     C           UDMK      ANDEQWWUDMK                               Same Market Indicator
016020200529     C           UDBK      ANDEQPBOOK                                Same Book
016030200529      ******                                                              135686
016040200529      *****If*live*record.*********************************************** 135686
016050200529      ******                                                              135686
016060200529     C******     RECI      IFEQ 'D'                                       135686
016070200529      *
016080200529      ***  Save Book.
016090200529      *
016100200529     C                     MOVE UDBK      WWUDBK  2
016110200529      *
016120200529      ***  Set greater on User Depot Positions Details file with Branch, Security and Depot (num
016130200529      ***  field) received as parameter, Market Indicator and Book saved and Ex-Date (num field)
016140200529      ***  received as parameter and read previous record.
016150200529      *
016160200529     C                     Z-ADDMACOEX    KUDDT   50
016170200529     C           @KEY2     SETGTSEUDEPL0
016180200529     C                     READPSEUDEPL0                 81
016190200529      *
016200200529      ***  If record read with same Branch, Security and Depot (num field) received as parameter
016210200529      ***  and same Market Indicator and Book saved.                      135686
016220200529      *****and*same*Market*Indicator*and*Book*saved*and*live*record.***** 135686
016230200529      *
016240200529     C           UDBA      IFEQ PBRCD                      Same Branch
016250200529     C           UDSN      ANDEQMASESN                     Same Security
016260200529     C           UDPT      ANDEQWWDDPT                     Same Depot
016270200529     C           UDMK      ANDEQWWUDMK                     Same Market Indicator
016280200529     C           UDBK      ANDEQWWUDBK                     Same Book
016290200529     C******     RECI      ANDEQ'D'                        Live record    135686
016300200529      *
016310200529      ***  Set Customer/Book Indicator to 'B'.
016320200529      *
016330200529     C                     MOVE 'B'       WWCOTP  1
016340200529      *                                                                   CSE020
016350200529      ** If CA is a child, restore MASESN with Security of the child      CSE020
016360200529      *                                                                   CSE020
016370200529     C           MAPREF    IFNE *BLANKS                                   CSE020
016380200529     C                     MOVE WKSESN    MASESN                          CSE020
016390200529     C                     ENDIF                                          CSE020
016400200529      *
016410200529      ***  Retrieve Book Current Reply and Standard Instruction.
016420200529      *
016430200529     C                     MOVE 'B'       FROMBC  1
016440200529     C                     EXSR RTVRPL
016450200529      *
016460200529      ***  Retrieve Actual Allocation for Options and Actual Allocation for options within the
016470200529      ***  Option.
016480200529      *
016490200529     C                     EXSR RAAOPT
016500200529      *
016510200529      ***  If Trade/Value Date Position from SECORFL1 = 'T', set Ex-Date Position = Nominal Trade
016520200529      ***  Date Basis.
016530200529      *
016540200529     C           MATDVD    IFEQ 'T'
016550200529     C**********           Z-ADDUDNT      WWTDVD 150                      149257
016560200529     C                     Z-ADDUDNT      WWTDVD 194                      149257
016570200529      *
016580200529      ***  If Trade/Value Date Position from SECORFL1 = 'V', set Ex-Date Position = Nominal Value
016590200529      ***  Date Basis.
016600200529      *
016610200529     C                     ELSE
016620200529     C                     Z-ADDUDNV      WWTDVD
016630200529     C                     ENDIF
016640200529      *                                                                   CSE020
016650200529      ** If CA is a child, set Ex-date Position = Actual Stock            CSE020
016660200529      ** Allocation of the Parent CA. Setup fields for the key list.      CSE020
016670200529      *                                                                   CSE020
016680200529     C           MAPREF    IFNE *BLANKS                                   CSE020
016690200529     C                     MOVE UDBA      WKBRCD                          CSE020
016700200529     C                     MOVE UDPT      WKDDPT                          CSE020
016710200529     C                     MOVE 'B'       WKCOTP                          CSE020
016720200529     C                     MOVE UDBK      WKBOOK                          CSE020
016730200529     C                     MOVE *BLANKS   WKCNUM                          CSE020
016740200529     C                     MOVE *BLANKS   WKPTFR                          CSE020
016750200529      *                                                                   CSE020
016760200529      ** Chain to LF/SECOALL5 to retrieve Actual Stock Allocation.        CSE020
016770200529      *                                                                   CSE020
016780200529     C           @KEY22    CHAINSECOALL5             70                   CSE020
016790200529     C           *IN70     IFEQ *OFF                                      CSE020
016800200529     C                     Z-ADDM5ASTA    WWTDVD                          CSE020
016810200529     C                     ELSE                                           CSE020
016820200529     C                     Z-ADD0         WWTDVD                          CSE020
016830200529     C                     ENDIF                                          CSE020
016840200529     C                     ENDIF                                          CSE020
016850200529      *                                                                   CSE020
016860200529     C                     Z-ADDESNBDP    WWNBDP  10
016870200529     C                     Z-ADDWWTDVD    WUNUM
016880200529     C                     EXSR RTVNDP
016890200529     C                     Z-ADDWWNUM     WWTDVD
016900200529      *
016910200529      ***  Set Total Fees and Total Taxes to 0, must not be calculated for Book.
016920200529      *
016930200529     C                     Z-ADD0         WWTOTF 309
016940200529     C                     Z-ADD0         WWTOTT 309
016950200529      *                                                                   136935
016960200529      ***  Reset total Original and Actual Stock Allocation work fields.  136935
016970200529      *                                                                   136935
016980200529     C                     Z-ADD0         WUOALR 309                      136935
016990200529     C                     Z-ADD0         W2OALR 309                      136935
017000200529     C                     Z-ADD0         WUASTA 309                      136935
017010200529      *
017020200529      ***  Do while New Security not blank.
017030200529      *
017040200529     C                     Z-ADD1         I       20
017050200529     C           I         DOWLE20
017060200529     C           TSEC,I    ANDNE*BLANKS
017070200529      *
017080200529      ***  Setup New Security Shortname.
017090200529      *
017100200529     C                     MOVE TSEC,I    NWSESN 10
017110200529      *
017120200529      ***  Prepare Price Basis for New Security.
017130200529      *
017140200529     C                     MOVE TSPB,I    NSSPBS  1
017150200529      *
017160200529      ***  Prepare Number of Decimal Places of New Security.
017170200529      *
017180200529     C                     MOVE TSDP,I    NSNBDP  10
017190200529      *
017200200529      ***  Prepare Number of Decimal Places of New Currency.
017210200529      *
017220200529     C                     MOVE TCDP,I    NCNBDP  10
017230200529      *
017240200529      ***  Prepare Number Of New Shares:
017250200529      ***  If Processing Type = 'CR': Corporate Reorganisation, retrieve position of array,
017260200529      ***  else retrieve from Corporate Actions Detail file.
017270200529      *
017280200529     C           MAPTYP    IFEQ 'CR'
017290200529     C                     MOVE TNSH,I    WWNSHA 157
017300200529     C                     ELSE
017310200529     C                     Z-ADDMDNSHA    WWNSHA
017320200529     C                     ENDIF
017330200529      *
017340200529      ***  Prepare Denomination Multiplier:
017350200529      ***  If Processing Type = 'CR': Corporate Reorganisation, retrieve position of array,
017360200529      ***  else retrieve from Corporate Actions Detail file.
017370200529      *
017380200529     C           MAPTYP    IFEQ 'CR'
017390200529     C*****                MOVE TDML,I    WUNUM                           179024
017400200529     C                     MOVE TDML,I    WDM16  160                      179024
017410200529     C                     ELSE
017420200529     C*****                Z-ADDMDDMLT    WUNUM                           179024
017430200529     C                     Z-ADDMDDMLT    WDM16                           179024
017440200529     C                     ENDIF
017450200529     C           5         SUB  NSNBDP    J       10                      179024
017460200529     C           WDM16     MULT POWER8,J  WWDMLT 309                      179024
017470200529     C*****                Z-ADDNSNBDP    WWNBDP                          179024
017480200529     C*****                EXSR RTVNDP                                    179024
017490200529     C*****                Z-ADDWWNUM     WWDMLT 309                      179024
017500200529      *
017510200529      ***  Prepare Rounding:
017520200529      ***  If Processing Type = 'CR': Corporate Reorganisation, retrieve position of array,
017530200529      ***  else retrieve from Corporate Actions Detail file.
017540200529      *
017550200529     C           MAPTYP    IFEQ 'CR'
017560200529     C                     MOVE TNDN,I    WWRNDN  1
017570200529     C                     ELSE
017580200529     C                     MOVE MDRNDN    WWRNDN
017590200529     C                     ENDIF
017600200529      *
017610200529      ***  Prepare field Rounding Settlement in Cash:
017620200529      ***  If Processing Type = 'CR': Corporate Reorganisation, retrieve position of array,
017630200529      ***  else retrieve from Corporate Actions Details File.
017640200529      *
017650200529     C           MAPTYP    IFEQ 'CR'
017660200529     C                     MOVE TNDS,I    WWRNDS  1
017670200529     C                     ELSE
017680200529     C                     MOVE MDRNDS    WWRNDS
017690200529     C                     ENDIF
017700200529      *
017710200529      ***  Prepare Compensation Price:
017720200529      ***  If Processing Type = 'CR': Corporate Reorganisation, retrieve position of array,
017730200529      ***  else retrieve from Corporate Actions Details File.
017740200529      *
017750200529     C           MAPTYP    IFEQ 'CR'
017760200529     C                     MOVE TOPA,I    WWCOMP 158
017770200529     C                     ELSE
017780200529      *                                                                   135685
017790200529      ***  If Processing Type = Currency Change                           135685
017800200529      ***  and Compensation Price is entered as Market,                   135685
017810200529      ***  the Compensation Price must first be calculated                135685
017820200529      ***  from Current Market Price.                                     135685
017830200529      *                                                                   135685
017840200529     C           MAPTYP    IFEQ 'CC'                                      135685
017850200529     C           NAMRKI    ANDEQ'Y'                                       135685
017860200529     C                     EXSR CCOMP                                     135685
017870200529     C                     ENDIF                                          135685
017880200529      *                                                                   135685
017890200529     C                     Z-ADDMDCOMP    WWCOMP
017900200529     C                     ENDIF
017910200529      *                                                                   145872
017920200529      ***  If Exchange Offer, calculate base Ex-Date Position = Ex-Date   145872
017930200529      ***  Position multiplied by Percentage to Exchange.                 145872
017940200529      *                                                                   145872
017950200529     C           MAPTYP    IFEQ 'OF'                                      145872
017960200529     C           MIOFTY    ANDEQ'E'                                       145872
017970200529     C***********          Z-ADDWWTDVD    WUTDVD 150               145872 219635A
017980200529     C                     Z-ADDWWTDVD    WUTDVD 194                      219635A
017990200529     C           WWTDVD    MULT MIPREX    WWTDVD                          145872
018000200529     C           WWTDVD    DIV  100       WWTDVD                          145872
018010200529     C                     Z-ADDESNBDP    WWNBDP           New Sec.Dec.Pl.145872
018020200529     C                     MOVE WWRNDN    WUROOP           CO Det. Round. 145872
018030200529     C                     Z-ADDWWTDVD    WWNUM                           145872
018040200529     C                     EXSR ROUNDD                                    145872
018050200529     C                     Z-ADDWWNUM     WWTDVD                          145872
018060200529     C                     ENDIF                                          145872
018070200529      *
018080200529      ***  Some fields must not be calculated for New Security.
018090200529      *
018100200529     C                     Z-ADD0         WWCAOP           Original Cash Option
018110200529     C                     Z-ADD0         WWACAA           Actual Cash Allocation
018120200529      *                                                                   136935
018130200529     C                     MOVE WWOPT1    WKOPTN  10                      136935
018140200529     C           MDOPTN    IFEQ WKOPTN                                    136935
018150200529     C           MANBOP    OREQ 1                                         136935
018160200529      *
018170200529      ***  Calculate Allocations: - Original Stock Allocation
018180200529      ***                         - True Stock Allocation
018190200529      ***                         - Original Stock Rounding
018200200529      ***                         - Original Cask Rounding.
018210200529      *
018220200529     C                     EXSR CALLOC
018230200529      *
018240200529      ***  Calculate other Book Allocations.
018250200529      *
018260200529     C                     EXSR CALBC
018270200529     C                     ELSE                                           136935
018280200529     C                     Z-ADD0         WWOALR                          136935
018290200529     C                     Z-ADD0         WWOTSA                          136935
018300200529     C                     Z-ADD0         WWOSTR                          136935
018310200529     C                     Z-ADD0         WWOCAR                          136935
018320200529     C                     Z-ADD0         WWASTA                          136935
018330200529     C                     Z-ADD0         WWASTR                          136935
018340200529     C                     Z-ADD0         WWACAR                          136935
018350200529     C                     Z-ADD0         WWHOST                          136935
018360200529     C                     Z-ADD0         WWHOCA                          136935
018370200529     C                     ENDIF                                          136935
018380200529      *
018390200529      ***  Set Reply Status to 'N' (by default).
018400200529      *
018410200529     C                     MOVE 'N'       WWREST  1        'None'
018420200529      *
018430200529      ***  If Book Current Reply exists, set Reply Status to 'R'.
018440200529      *
018450200529     C           EXBCRE    IFEQ 'Y'
018460200529     C                     MOVE 'R'       WWREST           'Reply Received'
018470200529      *
018480200529      ***  Else, if Book Current Reply does not exists.
018490200529      *
018500200529     C                     ELSE
018510200529      *
018520200529      ***  If Book Standard Corporate Actions Instruction exists, set Reply Status to 'S'.
018530200529      *
018540200529     C           EXBCSI    IFEQ 'Y'
018550200529     C                     MOVE 'S'       WWREST           'Std Inst Default'
018560200529     C                     ELSE
018570200529      *
018580200529      ***  Else, if Book Standard Corporate Actions Instruction does not exist (and Book Current
018590200529      ***  Reply does not exist), set the Reply Status to 'C' (the default no reply is used).
018600200529      *
018610200529     C                     MOVE 'C'       WWREST           'Corporate Default'
018620200529     C                     ENDIF
018630200529     C                     ENDIF
018640200529      *
018650200529      ***  Write a record on SECOALL0: Corporate Actions Allocations file.
018660200529      *
018670200529     C                     EXSR WRCOAL
018680200529      *                                                                   135686
018690200529      ***  Set indicator Customer or Book processed to 'Y'.               135686
018700200529      *                                                                   135686
018710200529     C                     MOVE 'Y'       BCPROC                          135686
018720200529      *
018730200529     C                     ADD  1         I
018740200529     C                     ENDDO
018750200529      *
018760200529      ***  Setup New Security to '**CASH**'.
018770200529      *
018780200529     C                     MOVE *BLANKS   NWSESN
018790200529     C                     MOVEL'**CASH**'NWSESN
018800200529      *
018810200529      ***  Some fields must not be calculated for Security = '**CASH**'.
018820200529      *
018830200529     C                     Z-ADD0         WWOALR           Original Stock Allocation
018840200529     C                     Z-ADD0         WWOTSA           True Stock Allocation
018850200529     C                     Z-ADD0         WWOSTR           Original Stock Rounding
018860200529     C                     Z-ADD0         WWASTA           Actual Stock Allocation
018870200529     C                     Z-ADD0         WWASTR           Actual Stock Rounding
018880200529      *                                                                   136935
018890200529     C                     MOVE WWOPT1    WKOPTN                          136935
018900200529     C           MDOPTN    IFEQ WKOPTN                                    136935
018910200529     C           MANBOP    OREQ 1                                         136935
018920200529      *
018930200529      ***  Calculate Original Cash Rounding for Security = '**CASH**'.
018940200529      *
018950200529     C                     EXSR COCR
018960200529      *
018970200529      ***  Calculate Actual Cash Rounding for Security = '**CASH**'.
018980200529      *
018990200529     C                     Z-ADDWTACAR    WWNUM            Total Actual Cash Rounding accumulated
019000200529     C                     EXSR CACR
019010200529      *
019020200529      ***  Calculate Holding Taken as Stock for Security = '**CASH**'.
019030200529      *
019040200529     C                     EXSR CHST
019050200529      *
019060200529      ***  Calculate Holding Taken as Cash for Security = '**CASH**'.
019070200529      *
019080200529     C                     EXSR CHCA
019090200529      *
019100200529      ***  Calculate Cash Option and Actual Cash Allocation for Book/Customer.
019110200529      *
019120200529     C                     EXSR CCABC
019130200529     C                     ELSE                                           136935
019140200529     C                     Z-ADD0         WWOALR                          136935
019150200529     C                     Z-ADD0         WWOTSA                          136935
019160200529     C                     Z-ADD0         WWOSTR                          136935
019170200529     C                     Z-ADD0         WWOCAR                          136935
019180200529     C                     Z-ADD0         WWASTA                          136935
019190200529     C                     Z-ADD0         WWASTR                          136935
019200200529     C                     Z-ADD0         WWACAR                          136935
019210200529     C                     Z-ADD0         WWHOST                          136935
019220200529     C                     Z-ADD0         WWHOCA                          136935
019230200529     C                     ENDIF                                          136935
019240200529      *
019250200529      ***  Write a record on SECOALL0: Corporate Actions Allocations file.
019260200529      *
019270200529     C                     EXSR WRCOAL
019280200529      *
019290200529      ***  Set to zero the Total Actual Cash Rounding and the Total Original Cash Rounding work
019300200529      ***  fields.
019310200529      *
019320200529     C                     Z-ADD0         WTACAR           Total Actual Cash Rounding
019330200529     C                     Z-ADD0         WTOCAR           Total Original Cash Rounding
019340200529      *
019350200529     C                     ENDIF
019360200529      *                                                                   CSE020
019370200529      ** If CA is a child, replace Security with the Security obtained    CSE020
019380200529      ** from the Originating CA before reading SEUDEPL0.                 CSE020
019390200529      *                                                                   CSE020
019400200529     C           MAPREF    IFNE *BLANKS                                   CSE020
019410200529     C                     MOVE WOSESN    MASESN                          CSE020
019420200529     C                     ENDIF                                          CSE020
019430200529      *
019440200529      ***  Set greater on User Depot Positions Details file with Branch, Security and Depot (num
019450200529      ***  field) received as parameter, Market Indicator and Book saved and Ex-Date equal to *HIVAL
019460200529      ***  and read next record.
019470200529      *
019480200529     C                     MOVE *HIVAL    KUDDT
019490200529     C           @KEY2     SETGTSEUDEPL0
019500200529     C                     READ SEUDEPL0                 81
019510200529      ******                                                              135686
019520200529     C******               ELSE                                           135686
019530200529     C***13*               READ SEUDEPL0                 81               135686
019540200529     C**N13*     @KEY1     READESEUDEPL0                 81               135686
019550200529     C******               ENDIF                                          135686
019560200529      *
019570200529     C                     ENDDO
019580200529      *
019590200529      ** If CA is a child, restore MASESN with Security of the child      CSE020
019600200529      *                                                                   CSE020
019610200529     C           MAPREF    IFNE *BLANKS                                   CSE020
019620200529     C                     MOVE WKSESN    MASESN                          CSE020
019630200529     C                     ENDIF                                          CSE020
019640200529      *                                                                   CSE020
019650200529     C                     ENDSR
019660200529      *
019670200529      *****************************************************************
019680200529      /EJECT
019690200529      *****************************************************************
019700200529      *                                                               *
019710200529      * PCUDPT - Process Customers for the Depot.                     *
019720200529      *                                                               *
019730200529      * Called by:                                                    *
019740200529      *                                                               *
019750200529      * Calls:                                                        *
019760200529      *                                                               *
019770200529      *****************************************************************
019780200529      *
019790200529     C           PCUDPT    BEGSR                           ** PCUDPT SR **
019800200529      *
019810200529      ***  Reset work field.
019820200529      *
019830200529     C                     MOVE *BLANKS   WWUDBK           Book
019840200529      *                                                                   CSE020
019850200529      ** If CA is a child, save Security. Instead, use Security           CSE020
019860200529      ** obtained from the Originating CA before reading SECDEPL4.        CSE020
019870200529      *                                                                   CSE020
019880200529     C           MAPREF    IFNE *BLANKS                                   CSE020
019890200529     C                     MOVE MASESN    WKSESN                          CSE020
019900200529     C                     MOVE WOSESN    MASESN                          CSE020
019910200529     C                     ENDIF                                          CSE020
019920200529      *
019930200529      ***  If program called from SE7512: Corporate Actions Depot Selection.
019940200529      *
019950200529     C           *IN13     IFEQ '0'
019960200529      *
019970200529      ***  Set lower on Client Depot Position Deatils with Branch, Security and Depot (num field)
019980200529      ***  received as parameter and read next record.
019990200529      *
020000200529     C           @KEY1     SETLLSECDEPL4
020010200529     C                     READ SECDEPL4                 81
020020200529      *
020030200529      ***  Else, if program called from SE7513: Corporate Actions Customers/Books by Depots
020040200529      ***  Maintenance.
020050200529      *
020060200529     C                     ELSE
020070200529      *
020080200529      ***  Set lower on User Depot Positions Details file with Branch, Security and Depot (num
020090200529      ***  field) received as parameter and read next record until Customer and Portfolio = Customer
020100200529      ***  (num field) and Portfolio received as parameter.
020110200529      *
020120200529     C                     MOVE '0'       *IN88
020130200529     C           @KEY1     SETLLSECDEPL4
020140200529     C           @KEY1     READESECDEPL4                 81
020150200529     C   81                MOVE '1'       *IN88
020160200529     C           *IN88     DOWEQ'0'
020170200529     C           CDCN      IFEQ WWCNUM
020180200529     C           PTFR      ANDEQPPTFR
020190200529     C                     MOVE '1'       *IN88
020200200529     C                     ELSE
020210200529     C           @KEY1     READESECDEPL4                 81
020220200529     C   81                MOVE '1'       *IN88
020230200529     C                     ENDIF
020240200529     C                     ENDDO
020250200529     C                     ENDIF
020260200529      *
020270200529      ***  Save Market Indicator.
020280200529      *
020290200529     C                     MOVE CDMK      WWUDMK
020300200529      *
020310200529      ***  Do while not end of file, and record read with same Branch, Security and Depot (num
020320200529      ***  field) received as parameter and same Market Indicator saved, if program called from
020330200529      ***  SE7512: Corporate Actions Depot Selection,
020340200529      ***  OR do while not end of file, and record read with same Branch, New Security, Depot (num
020350200529      ***  field), Customer (num field) and Portfolio received as parameter and same Market
020360200529      ***  Indicator saved, if program called from SE7513: Corporate Actions Customers/Books by
020370200529      ***  Depots Maintenance.
020380200529      *
020390200529     C           *IN81     DOWEQ'0'                        Do while: Not end of file
020400200529     C           *IN13     ANDEQ'0'                                  Program called from SE7512
020410200529     C           CDPA      ANDEQPBRCD                                Same Branch
020420200529     C           CDSN      ANDEQMASESN                               Same Security
020430200529     C           CDPT      ANDEQWWDDPT                               Same Depot
020440200529     C           CDMK      ANDEQWWUDMK                               Same Market Indicator
020450200529     C           *IN81     OREQ '0'                        OR      : Not end of file
020460200529     C           *IN13     ANDEQ'1'                                  Program called from SE7513
020470200529     C           CDPA      ANDEQPBRCD                                Same Branch
020480200529     C           CDSN      ANDEQMASESN                               Same Security
020490200529     C           CDPT      ANDEQWWDDPT                               Same Depot
020500200529     C           CDMK      ANDEQWWUDMK                               Same Market Indicator
020510200529     C           CDCN      ANDEQWWCNUM                               Same Customer
020520200529     C           PTFR      ANDEQPPTFR                                Same Portfolio
020530200529      ******                                                              135686
020540200529      *****If*live*record************************************************ 135686
020550200529      ******                                                              135686
020560200529     C******     RECI      IFEQ 'D'                                       135686
020570200529      *
020580200529      ***  Save Customer and Portfolio Reference.
020590200529      *
020600200529     C                     MOVE CDCN      WWCDCN
020610200529     C                     MOVE PTFR      WWPTFR
020620200529      *
020630200529      ***  Set greater on Client Depot Positions Details file with Branch, Security and Depot (num
020640200529      ***  field) received as parameter, Market Indicator, Customer and Portfolio Reference saved
020650200529      ***  and Ex-Date (num field) received as parameter and read previous record.
020660200529      *
020670200529     C                     Z-ADDMACOEX    KUDDT
020680200529     C           @KEY3     SETGTSECDEPL4
020690200529     C                     READPSECDEPL4                 81
020700200529      *
020710200529      ***  If record read with same Branch, Security and Depot (num field) received as parameter
020720200529      ***  and same Market Indicator, Customer and Portfolio Reference    135686
020730200529      ***  saved.                                                         135686
020740200529      *****and*same*Market*Indicator,*Customer*and*Portfolio*Reference*** 135686
020750200529      *****saved*and*live*record.**************************************** 135686
020760200529      *
020770200529     C           CDPA      IFEQ PBRCD                      Same Branch
020780200529     C           CDSN      ANDEQMASESN                     Same Security
020790200529     C           CDPT      ANDEQWWDDPT                     Same Depot
020800200529     C           CDMK      ANDEQWWUDMK                     Same Market Indicator
020810200529     C           CDCN      ANDEQWWCDCN                     Same Customer
020820200529     C           PTFR      ANDEQWWPTFR                     Same Portfolio Reference
020830200529     C******     RECI      ANDEQ'D'                        Live record    135686
020840200529      *
020850200529      ***  Set first passage for Processing Type Corporate Action to 'Y' (Block fields should only
020860200529      ***  be filled on first record written in CO Allocation file (SECOALL0) for Processing Type
020870200529      ***  = Corporate Reorganisation).
020880200529      *
020890200529     C                     MOVE 'Y'       FIRSCR  1
020900200529      *
020910200529      ***  Set Customer/Book Indicator to 'C'.
020920200529      *
020930200529     C                     MOVE 'C'       WWCOTP
020940200529      *                                                                   CSE020
020950200529      ** If CA is a child, restore MASESN with Security of the child      CSE020
020960200529      *                                                                   CSE020
020970200529     C           MAPREF    IFNE *BLANKS                                   CSE020
020980200529     C                     MOVE WKSESN    MASESN                          CSE020
020990200529     C                     ENDIF                                          CSE020
021000200529      *
021010200529      ***  Retrieve Book Current Reply and Standard Instruction.
021020200529      *
021030200529     C                     MOVE 'C'       FROMBC
021040200529     C                     EXSR RTVRPL
021050200529      *
021060200529      ***  Retrieve Actual Allocation for Options and Actual Allocation for options within the
021070200529      ***  Option.
021080200529      *
021090200529     C                     EXSR RAAOPT
021100200529      *
021110200529      ***  If Trade/Value Date Position from SECORFL1 = 'T', set Ex-Date Position = Nominal Trade
021120200529      ***  Date Basis.
021130200529      *
021140200529     C           MATDVD    IFEQ 'T'
021150200529     C                     Z-ADDCDNT      WWTDVD
021160200529      *
021170200529      ***  If Trade/Value Date Position from SECORFL1 = 'V', set Ex-Date Position = Nominal Value
021180200529      ***  Date Basis.
021190200529      *
021200200529     C                     ELSE
021210200529     C                     Z-ADDCDNV      WWTDVD
021220200529     C                     ENDIF
021230200529      *                                                                   CSE020
021240200529      ** If CA is a child, set Ex-date Position = Actual Stock            CSE020
021250200529      ** Allocation of the Parent CA. Setup fields for the key list.      CSE020
021260200529      *                                                                   CSE020
021270200529     C           MAPREF    IFNE *BLANKS                                   CSE020
021280200529     C                     MOVE CDPA      WKBRCD                          CSE020
021290200529     C                     MOVE CDPT      WKDDPT                          CSE020
021300200529     C                     MOVE 'C'       WKCOTP                          CSE020
021310200529     C                     MOVE *BLANKS   WKBOOK                          CSE020
021320200529     C                     MOVE CDCN      WKCNUM                          CSE020
021330200529     C                     MOVE PTFR      WKPTFR                          CSE020
021340200529      *                                                                   CSE020
021350200529      ** Chain to LF/SECOALL5 to retrieve Actual Stock Allocation.        CSE020
021360200529      *                                                                   CSE020
021370200529     C           @KEY22    CHAINSECOALL5             70                   CSE020
021380200529     C           *IN70     IFEQ *OFF                                      CSE020
021390200529     C                     Z-ADDM5ASTA    WWTDVD                          CSE020
021400200529     C                     ELSE                                           CSE020
021410200529     C                     Z-ADD0         WWTDVD                          CSE020
021420200529     C                     ENDIF                                          CSE020
021430200529     C                     ENDIF                                          CSE020
021440200529      *                                                                   CSE020
021450200529     C                     Z-ADDESNBDP    WWNBDP
021460200529     C                     Z-ADDWWTDVD    WUNUM
021470200529     C                     EXSR RTVNDP
021480200529     C                     Z-ADDWWNUM     WWTDVD
021490200529      *                                                                   136935
021500200529      ***  Reset total Original and Actual Stock Allocation work fields.  136935
021510200529      *                                                                   136935
021520200529     C                     Z-ADD0         WUOALR 309                      136935
021530200529     C                     Z-ADD0         W2OALR 309                      136935
021540200529     C                     Z-ADD0         WUASTA 309                      136935
021550200529      *
021560200529      ***  Do while New Security not blank.
021570200529      *
021580200529     C                     Z-ADD1         I
021590200529     C           I         DOWLE20
021600200529     C           TSEC,I    ANDNE*BLANKS
021610200529      *
021620200529      ***  Setup New Security Shortname.
021630200529      *
021640200529     C                     MOVE TSEC,I    NWSESN
021650200529      *
021660200529      ***  Prepare Price Basis for New Security.
021670200529      *
021680200529     C                     MOVE TSPB,I    NSSPBS  1
021690200529      *
021700200529      ***  Prepare Number of Decimal Places of New Security.
021710200529      *
021720200529     C                     MOVE TSDP,I    NSNBDP  10
021730200529      *
021740200529      ***  Prepare Number of Decimal Places of New Currency.
021750200529      *
021760200529     C                     MOVE TCDP,I    NCNBDP  10
021770200529      *
021780200529      ***  Prepare Number Of New Shares:
021790200529      ***  If Processing Type = 'CR': Corporate Reorganisation, retrieve position of array,
021800200529      ***  else retrieve from Corporate Actions Detail file.
021810200529      *
021820200529     C           MAPTYP    IFEQ 'CR'
021830200529     C                     MOVE TNSH,I    WWNSHA 157
021840200529     C                     ELSE
021850200529     C                     Z-ADDMDNSHA    WWNSHA
021860200529     C                     ENDIF
021870200529      *
021880200529      ***  Prepare Denomination Multiplier:
021890200529      ***  If Processing Type = 'CR': Corporate Reorganisation, retrieve position of array,
021900200529      ***  else retrieve from Corporate Actions Detail file.
021910200529      *
021920200529     C           MAPTYP    IFEQ 'CR'
021930200529     C*****                MOVE TDML,I    WUNUM                           179024
021940200529     C                     MOVE TDML,I    WDM16  160                      179024
021950200529     C                     ELSE
021960200529     C*****                Z-ADDMDDMLT    WUNUM                           179024
021970200529     C                     Z-ADDMDDMLT    WDM16                           179024
021980200529     C                     ENDIF
021990200529     C           5         SUB  NSNBDP    J       10                      179024
022000200529     C           WDM16     MULT POWER8,J  WWDMLT 309                      179024
022010200529     C*****                Z-ADDNSNBDP    WWNBDP                          179024
022020200529     C*****                EXSR RTVNDP                                    179024
022030200529     C*****                Z-ADDWWNUM     WWDMLT 309                      179024
022040200529      *
022050200529      ***  Prepare Rounding:
022060200529      ***  If Processing Type = 'CR': Corporate Reorganisation, retrieve position of array,
022070200529      ***  else retrieve from Corporate Actions Detail file.
022080200529      *
022090200529     C           MAPTYP    IFEQ 'CR'
022100200529     C                     MOVE TNDN,I    WWRNDN  1
022110200529     C                     ELSE
022120200529     C                     MOVE MDRNDN    WWRNDN
022130200529     C                     ENDIF
022140200529      *
022150200529      ***  Prepare field Rounding Settlement in Cash:
022160200529      ***  If Processing Type = 'CR': Corporate Reorganisation, retrieve position of array,
022170200529      ***  else retrieve from Corporate Actions Detail file.
022180200529      *
022190200529     C           MAPTYP    IFEQ 'CR'
022200200529     C                     MOVE TNDS,I    WWRNDS  1
022210200529     C                     ELSE
022220200529     C                     MOVE MDRNDS    WWRNDS
022230200529     C                     ENDIF
022240200529      *
022250200529      ***  Prepare Compensation Price:
022260200529      ***  If Processing Type = 'CR': Corporate Reorganisation, retrieve position of array,
022270200529      ***  else retrieve from Corporate Actions Details File.
022280200529      *
022290200529     C           MAPTYP    IFEQ 'CR'
022300200529     C                     MOVE TOPA,I    WWCOMP 158
022310200529     C                     ELSE
022320200529      *                                                                   135685
022330200529      ***  If Processing Type = Currency Change                           135685
022340200529      ***  and Compensation Price is entered as Market,                   135685
022350200529      ***  the Compensation Price must first be calculated                135685
022360200529      ***  from Current Market Price.                                     135685
022370200529      *                                                                   135685
022380200529     C           MAPTYP    IFEQ 'CC'                                      135685
022390200529     C           NAMRKI    ANDEQ'Y'                                       135685
022400200529     C                     EXSR CCOMP                                     135685
022410200529     C                     ENDIF                                          135685
022420200529      *                                                                   135685
022430200529     C                     Z-ADDMDCOMP    WWCOMP
022440200529     C                     ENDIF
022450200529      *                                                                   145872
022460200529      ***  If Exchange Offer, calculate base Ex-Date Position = Ex-Date   145872
022470200529      ***  Position multiplied by Percentage to Exchange.                 145872
022480200529      *                                                                   145872
022490200529     C           MAPTYP    IFEQ 'OF'                                      145872
022500200529     C           MIOFTY    ANDEQ'E'                                       145872
022510200529     C                     Z-ADDWWTDVD    WUTDVD                          145872
022520200529     C           WWTDVD    MULT MIPREX    WWTDVD                          145872
022530200529     C           WWTDVD    DIV  100       WWTDVD                          145872
022540200529     C                     Z-ADDESNBDP    WWNBDP           New Sec.Dec.Pl.145872
022550200529     C                     MOVE WWRNDN    WUROOP           CO Det. Round. 145872
022560200529     C                     Z-ADDWWTDVD    WWNUM                           145872
022570200529     C                     EXSR ROUNDD                                    145872
022580200529     C                     Z-ADDWWNUM     WWTDVD                          145872
022590200529     C                     ENDIF                                          145872
022600200529      *
022610200529      ***  Some fields must not be calculated for New Security.
022620200529      *
022630200529     C                     Z-ADD0         WWCAOP           Original Cash Option
022640200529     C                     Z-ADD0         WWACAA           Actual Cash Allocation
022650200529     C                     Z-ADD0         WWTOTF           Total Fees
022660200529     C                     Z-ADD0         WWTOTT           Total Taxes
022670200529      *                                                                   136935
022680200529     C                     MOVE WWOPT1    WKOPTN                          136935
022690200529     C           MDOPTN    IFEQ WKOPTN                                    136935
022700200529     C           MANBOP    OREQ 1                                         136935
022710200529      *
022720200529      ***  Calculate Allocations: - Original Stock Allocation
022730200529      ***                         - True Stock Allocation
022740200529      ***                         - Original Stock Rounding
022750200529      ***                         - Original Cask Rounding.
022760200529      *
022770200529     C                     EXSR CALLOC
022780200529      *
022790200529      ***  Calculate other Customer Allocations.
022800200529      *
022810200529     C                     EXSR CALBC
022820200529     C                     ELSE                                           136935
022830200529     C                     Z-ADD0         WWOALR                          136935
022840200529     C                     Z-ADD0         WWOTSA                          136935
022850200529     C                     Z-ADD0         WWOSTR                          136935
022860200529     C                     Z-ADD0         WWOCAR                          136935
022870200529     C                     Z-ADD0         WWASTA                          136935
022880200529     C                     Z-ADD0         WWASTR                          136935
022890200529     C                     Z-ADD0         WWACAR                          136935
022900200529     C                     Z-ADD0         WWHOST                          136935
022910200529     C                     Z-ADD0         WWHOCA                          136935
022920200529     C                     ENDIF                                          136935
022930200529      *
022940200529      ***  Set Reply Status to 'N' (by default).
022950200529      *
022960200529     C                     MOVE 'N'       WWREST           'None'
022970200529      *
022980200529      ***  If Customer Current Reply exists set Reply Status to 'R'.
022990200529      *
023000200529     C           EXBCRE    IFEQ 'Y'
023010200529     C                     MOVE 'R'       WWREST           'Reply Received'
023020200529      *
023030200529      ***  Else, if Customer Current Reply does not exist.
023040200529      *
023050200529     C                     ELSE
023060200529      *
023070200529      ***  If Standard Corporate Actions Instruction exists, set Reply Status to 'S'.
023080200529      *
023090200529     C           EXBCSI    IFEQ 'Y'
023100200529     C                     MOVE 'S'       WWREST           'Std Inst Default'
023110200529     C                     ELSE
023120200529      *
023130200529      ***  Else, if Customer Standard Corporate Action Instruction does not exist (and Customer
023140200529      ***  Current Reply does not exist), set the Reply Status to 'C' (default no reply is used).
023150200529      *
023160200529     C                     MOVE 'C'       WWREST           'Corporate Default'
023170200529     C                     ENDIF
023180200529     C                     ENDIF
023190200529      *
023200200529      ***  Write a record on SECOALL0: Corporate Actions Allocations file.
023210200529      *
023220200529     C                     EXSR WRCOAL
023230200529      *                                                                   135686
023240200529      ***  Set indicator Customer or Book processed to 'Y'.               135686
023250200529      *                                                                   135686
023260200529     C                     MOVE 'Y'       BCPROC                          135686
023270200529      *
023280200529     C                     ADD  1         I
023290200529     C                     ENDDO
023300200529      *
023310200529      ***  Setup New Security to '**CASH**'.
023320200529      *
023330200529     C                     MOVE *BLANKS   NWSESN
023340200529     C                     MOVEL'**CASH**'NWSESN
023350200529      *
023360200529      ***  Some fields must not be calculated for Security = '**CASH**'.
023370200529      *
023380200529     C                     Z-ADD0         WWOALR           Original Stock Allocation
023390200529     C                     Z-ADD0         WWOTSA           True Stock Allocation
023400200529     C                     Z-ADD0         WWOSTR           Original Stock Rounding
023410200529     C                     Z-ADD0         WWASTA           Actual Stock Allocation
023420200529     C                     Z-ADD0         WWASTR           Actual Stock Rounding
023430200529      *                                                                   136935
023440200529     C                     MOVE WWOPT1    WKOPTN                          136935
023450200529     C           MDOPTN    IFEQ WKOPTN                                    136935
023460200529     C           MANBOP    OREQ 1                                         136935
023470200529      *
023480200529      ***  Calculate Original Cash Rounding for Security = '**CASH**'.
023490200529      *
023500200529     C                     EXSR COCR
023510200529      *
023520200529      ***  Calculate Actual Cash Rounding for Security = '**CASH**'.
023530200529      *
023540200529     C                     Z-ADDWTACAR    WWNUM            Total Actual Cash Rounding accumulated
023550200529     C                     EXSR CACR
023560200529      *
023570200529      ***  Calculate Holding Taken as Stock for Security = '**CASH**'.
023580200529      *
023590200529     C                     EXSR CHST
023600200529      *
023610200529      ***  Calculate Holding Taken as Cash for Security = '**CASH**'.
023620200529      *
023630200529     C                     EXSR CHCA
023640200529      *
023650200529      ***  Calculate Cash Option and Actual Cash Allocation for Book/Customer.
023660200529      *
023670200529     C                     EXSR CCABC
023680200529      *
023690200529      ***  If Processing Type not Currency Changes,                       CEU017
023700200529      ***  Calculate Total Fees for Customer.
023710200529      *
023720200529     C           MAPTYP    IFNE 'CC'                                      CEU017
023730200529     C                     EXSR CTFEES
023740200529     C                     ENDIF                                          CEU017
023750200529      *
023760200529      ***  If Processing Type = Dividend Events and feature Withholding Tax is ON,
023770200529      ***  Calculate Total Taxes for Customer, based on Actual Cash Allocation + Rounding
023780200529      ***  if Stock Dividend Type not 'R' or based on Original Cash Option if Stock Dividend
023790200529      ***  Type = 'R' as Reinvestment of Dividend (Total Taxes = Tax Deducted at Source + Tax
023800200529      ***  Deducted by User).
023810200529      *
023820200529     C******     MAPTYP    IFNE 'DV'                                      135692
023830200529     C           MAPTYP    IFEQ 'DV'                                      135692
023840200529     C           S01447    ANDEQ'Y'
023850200529     C           MDSDIT    IFEQ 'R'
023860200529     C                     Z-ADDWWCAOP    WWAMTT
023870200529     C                     ELSE
023880200529     C           WWACAA    ADD  WWACAR    WWAMTT 309
023890200529     C                     ENDIF
023900200529     C                     EXSR CTOTAX
023910200529     C                     Z-ADDTOTTAX    WWTOTT
023920200529     C           MAPTYP    IFEQ 'CR'
023930200529     C                     Z-ADDECNBDP    WWNBDP           Event Currency Decimal Places
023940200529     C                     ELSE
023950200529     C                     Z-ADDTCDP,1    WWNBDP           New Currency Decimal Places
023960200529     C                     ENDIF
023970200529     C                     MOVE 'R'       WUROOP           Rounding = alf adjust
023980200529     C                     Z-ADDWWTOTT    WWNUM
023990200529     C                     EXSR ROUNDD
024000200529     C                     Z-ADDWWNUM     WWTOTT
024010200529     C                     ELSE
024020200529     C                     Z-ADD0         WWTOTT
024030200529     C                     ENDIF
024040200529     C                     ELSE                                           136935
024050200529     C                     Z-ADD0         WWOALR                          136935
024060200529     C                     Z-ADD0         WWOTSA                          136935
024070200529     C                     Z-ADD0         WWOSTR                          136935
024080200529     C                     Z-ADD0         WWOCAR                          136935
024090200529     C                     Z-ADD0         WWASTA                          136935
024100200529     C                     Z-ADD0         WWASTR                          136935
024110200529     C                     Z-ADD0         WWACAR                          136935
024120200529     C                     Z-ADD0         WWHOST                          136935
024130200529     C                     Z-ADD0         WWHOCA                          136935
024140200529     C                     ENDIF                                          136935
024150200529      *
024160200529      ***  Write a record on SECOALL0: Corporate Actions Allocations file.
024170200529      *
024180200529     C                     EXSR WRCOAL
024190200529      *
024200200529      ***  Set to zero the Total Actual Cash Rounding and the Total Original Cash Rounding work
024210200529      ***  fields.
024220200529      *
024230200529     C                     Z-ADD0         WTACAR           Total Actual Cash Rounding
024240200529     C                     Z-ADD0         WTOCAR           Total Original Cash Rounding
024250200529      *
024260200529     C                     ENDIF
024270200529      *                                                                   CSE020
024280200529      ** If CA is a child, replace Security with the Security obtained    CSE020
024290200529      ** from the Originating CA before reading SECDEPL4.                 CSE020
024300200529      *                                                                   CSE020
024310200529     C           MAPREF    IFNE *BLANKS                                   CSE020
024320200529     C                     MOVE WOSESN    MASESN                          CSE020
024330200529     C                     ENDIF                                          CSE020
024340200529      *
024350200529      ***  Set greater on Client Depot Positions Details file with Branch, Security and Depot (num
024360200529      ***  field) received as parameter, Market Indicator, Customer and Portfolio Reference saved
024370200529      ***  and Ex-Date equal to *HIVAL and read next record.
024380200529      *
024390200529     C                     MOVE *HIVAL    KUDDT
024400200529     C           @KEY3     SETGTSECDEPL4
024410200529     C                     READ SECDEPL4                 81
024420200529      ******                                                              135686
024430200529     C******               ELSE                                           135686
024440200529     C***13*               READ SECDEPL4                 81               135686
024450200529     C**N13*     @KEY1     READESECDEPL4                 81               135686
024460200529     C******               ENDIF                                          135686
024470200529      *
024480200529     C                     ENDDO
024490200529      *
024500200529      ** If CA is a child, restore MASESN with Security of the child      CSE020
024510200529      *                                                                   CSE020
024520200529     C           MAPREF    IFNE *BLANKS                                   CSE020
024530200529     C                     MOVE WKSESN    MASESN                          CSE020
024540200529     C                     ENDIF                                          CSE020
024550200529      *                                                                   CSE020
024560200529     C                     ENDSR
024570200529      *
024580200529      *****************************************************************
024590200529      /EJECT
024600200529      *****************************************************************
024610200529      *                                                               *
024620200529      * PDUMCU - CO Dummy Customer processing.                        *
024630200529      *                                                               *
024640200529      * Called by:                                                    *
024650200529      *                                                               *
024660200529      * Calls:                                                        *
024670200529      *                                                               *
024680200529      *****************************************************************
024690200529      *
024700200529     C           PDUMCU    BEGSR                           ** PDUMCU SR **
024710200529      *
024720200529      ***  Load fields (all amounts set to 0).
024730200529      *
024740200529     C                     MOVE 'D'       MCRECI           Record Id.
024750200529     C                     Z-ADDBJRDNB    MCLCD            Last Change Date = Run Date
024760200529     C                     MOVE 'I'       MCCHTP           Type of Last Change
024780200529     C                     MOVE USER      MCLUID           User Id.
024820200529     C                     MOVE PCORF     MCCORF           CO Reference = Parameter
024830200529      *
024840200529     C           MAPTYP    IFEQ 'NF'                       If Processing Type = Non Financial Events
024850200529     C           MAPTYP    OREQ 'NC'                       Or Processing Type = Name Changes
024860200529     C           MAPTYP    OREQ 'CC'                       Or Ccy Changes CEU017
024870200529     C                     MOVE '01'      MCOPTN              Option Number = 01
024880200529     C                     ELSE                            Else
024890200529     C                     MOVE MDOPTN    MCOPTN              Option Number = from SECOxxL0
024900200529     C                     ENDIF
024910200529      *
024920200529     C                     MOVE PBRCD     MCBRCD           Branch = Parameter
024930200529     C**********           Z-ADDWWDDPT    MCDDPT           Depot = Parameter (num field)      CSD027
024940200529     C                     MOVE WWDDPT    MCDDPT           Depot = Parameter (num field)      CSD027
024950200529     C                     MOVE 'C'       MCCOTP           Customer/Book Ind. = 'C'
024960200529     C                     MOVE *BLANKS   MCBOOK           Book = blank
024970200529     C                     MOVE BVERCU    MCCNUM           Customer = Dummy Customer from SDSTRDPD
024980200529     C                     Z-ADD0         MCEXPO           Ex-Date Position = 0
024990200529     C                     Z-ADD0         MCOALR           Orig.Stk Alloc.136935
025000200529     C                     Z-ADD0         MCOSTR           Orig.Stk Round.136935
025010200529     C                     Z-ADD0         MCOCAR           Orig.Cash Round136935
025020200529     C                     Z-ADD0         MCCAOP           Original Cash Option = 0
025030200529     C                     Z-ADD0         MCHOCA           Holding Taken as Cash = 0
025040200529     C                     Z-ADD0         MCACAA           Actual Cash Allocation = 0
025050200529     C                     Z-ADD0         MCOTSA           True Stock Allocation = 0
025060200529     C                     Z-ADD0         MCHOST           Holding Taken as Stock = 0
025070200529     C                     MOVE *BLANKS   MCOPT1           Option for Actual Allocation 1 = blank
025080200529     C                     MOVE *BLANKS   MCOPT2           Option for Actual Allocation 2 = blank
025090200529     C                     MOVE *BLANKS   MCBSEC           Block Security = blank
025100200529     C                     Z-ADD0         MCBEDT           Blocked End Date = 0
025110200529     C                     Z-ADD0         MCBSTT           Blocked Start Date = 0
025120200529     C                     MOVE *BLANKS   MCBLTY           Block Type = blank
025130200529     C                     MOVE *BLANKS   MCBEWI           Block Error/Warning Ind. = blank
025140200529     C                     MOVE MACOAT    MCCOAT           CO Type = from SECORFL1
025150200529     C                     MOVE *BLANKS   MCTRRF           Transaction Reference = blank
025160200529     C                     MOVE *BLANKS   MCTRR2           Transaction Reference 2 = blank
025170200529     C                     MOVE *BLANKS   MCTRR3           Transaction Reference 3 = blank
025180200529     C                     MOVE *BLANKS   MCRVRF           Reversal Reference = blank
025190200529     C                     MOVE *BLANKS   MCRVR2           Reversal Reference 2 = blank
025200200529     C                     MOVE *BLANKS   MCRVR3           Reversal Reference 3 = blank
025210200529     C                     Z-ADD0         MCTNL1           Position Settlement TNL1 = 0
025220200529     C                     MOVE *BLANKS   MCLTRQ           Letter Required = blank
025230200529     C                     Z-ADD0         MCTOTF           Total Fees = 0
025240200529     C                     Z-ADD0         MCTOTT           Total Taxes = 0
025250200529      *
025260200529      ***  If Dummy Customer is a Portfolio Customer, Portfolio Reference seted with '9997',
025270200529      ***  else it was seted with blank.
025280200529      *
025290200529     C                     MOVE WWERPT    MCPTFR           Portfolio Reference
025300200529      *                                                                   136935
025310200529     C                     Z-ADD0         BACRDC 309                      136935
025320200529      *
025330200529      ***  Do while New Security not blank.
025340200529      *
025350200529     C                     Z-ADD1         I
025360200529     C           I         DOWLE20
025370200529     C           TSEC,I    ANDNE*BLANKS
025380200529      *
025390200529      ***  Setup New Security Shortname.
025400200529      *
025410200529     C                     MOVE TSEC,I    MCSESN           Securiry Shortname
025420200529      *                                                                   135686
025430200529      ***  If processing type = Currency Change.                          135686
025440200529      *                                                                   135686
025450200529     C           MAPTYP    IFEQ 'CC'                                      135686
025460200529     C           MAPTYP    ORNE 'CC'                                      137886
025470200529     C           BVALDC    ANDEQ'Y'                                       137886
025480200529      *
025490200529      ***  Input Balancing Stock Allocation calculated for the New Security into Actual Stock
025500200529      ***  Allocation for the Dummy Customer.                             136935
025510200529      *****Allocation*and*Original*Stock*Allocation*for*the*Dummy******** 136935
025520200529      *****Customer.***************************************************** 136935
025530200529      *
025540200529     C                     Z-ADDTBSA,I    WWNUM
025550200529     C                     Z-ADDTSDP,I    WWNBDP           New Security Decimal Places
025560200529     C                     EXSR SETNDP
025570200529     C******               Z-SUBWUNUM     MCASTA           Act.Stk Alloc. 135686
025580200529     C******               Z-SUBWUNUM     MCOALR           Orig.Stk Alloc.135686
025590200529     C                     Z-ADDWUNUM     MCASTA           Act.Stk Alloc. 135686
025600200529     C******               Z-ADDWUNUM     MCOALR                   135686 136935
025610200529     C                     Z-ADD0         TBSA,I           Reset Actual Stock Allocation
025620200529      *
025630200529      ***  Input Balancing Stock Rounding calculated for the New Security into Actual Stock Rounding
025640200529      ***  for the Dummy Customer.                                        136935
025650200529      *****and*Original*Stock*Rounding*for*the*Dummy*Customer.*********** 136935
025660200529      *
025670200529     C******               Z-SUBTBSR,I    MCASTR           Act.Stk Round. 135686
025680200529     C******               Z-SUBTBSR,I    MCOSTR           Orig.Stk Round.135686
025690200529     C                     Z-ADDTBSR,I    MCASTR           Act.Stk Round. 135686
025700200529     C******               Z-ADDTBSR,I    MCOSTR                   135686 136935
025710200529     C                     Z-ADD0         TBSR,I           Reset Actual Stock Rounding
025720200529      *
025730200529      ***  Input Balancing Cash Rounding calculated for the New Security into Actual cash Rounding
025740200529      ***  for the Dummy Customer.                                        136935
025750200529      *****and*Original*Cash*Rounding*for*the*Dummy*Customer.************ 136935
025760200529      *
025770200529     C                     Z-ADDTBCR,I    WWNUM
025780200529     C                     Z-ADDTCDP,I    WWNBDP           New Currency Decimal Places
025790200529     C                     EXSR SETNDP
025800200529     C******               Z-SUBWUNUM     MCACAR           Act.Cash Round.135686
025810200529     C******               Z-SUBWUNUM     MCOCAR           Orig.Cash Round135686
025820200529     C                     Z-ADDWUNUM     MCACAR           Act.Cash Round.135686
025830200529     C******               Z-ADDWUNUM     MCOCAR                   135686 136935
025840200529     C                     ADD  TBCR,I    BACRDC                          136935
025850200529     C                     Z-ADD0         TBCR,I           Reset Actual Cash Rounding
025860200529      *                                                                   135686
025870200529      ***  Else, if processing type not Currency Change, set fields to 0. 135686
025880200529      *                                                                   135686
025890200529     C                     ELSE                                           135686
025900200529     C                     Z-ADD0         MCASTA           Act.Stk Alloc. 135686
025910200529     C                     Z-ADD0         MCOALR           Orig.Stk Alloc.135686
025920200529     C                     Z-ADD0         MCASTR           Act.Stk Round. 135686
025930200529     C                     Z-ADD0         MCOSTR           Orig.Stk Round.135686
025940200529     C                     Z-ADD0         MCACAR           Act.Cash Round.135686
025950200529     C                     Z-ADD0         MCOCAR           Orig.Cash Round135686
025960200529     C                     ENDIF                                          135686
025970200529      *
025980200529      ***  If Actual Stock Allocation and Actual Stock Rounding and Actual Cash Rounding = 0, set
025990200529      ***  Reply Status to blank, else set Reply Status to 'C' as 'Corporate Default'.
026000200529      *
026010200529     C           MCASTA    IFEQ 0
026020200529     C           MCASTR    ANDEQ0
026030200529     C           MCACAR    ANDEQ0
026040200529     C                     MOVE *BLANKS   MCREST           Reply Status = blank
026050200529     C                     ELSE
026060200529     C                     MOVE 'C'       MCREST           Reply Status = 'Corporate Default'
026070200529     C                     ENDIF
026080200529      *
026090200529      ***  Write record on file SECOALL0.
026100200529      *
026110200529     C                     WRITESECOALD0               89
026120200529      *
026130200529      ***  If error detected when write, handle Database Error.
026140200529      *
026150200529     C           *IN89     IFEQ '1'
026160200529     C                     Z-ADD009       DBASE            ***************
026170200529     C                     MOVEL'SECOALL0'DBFILE           * DB ERROR 09 *
026180200529     C                     MOVEL'WRITE'   DBKEY            ***************
026190200529     C                     EXSR *PSSR
026200200529     C                     ENDIF
026210200529     C                     COMIT
026220200529     C                     ADD  1         RSEAL
026230200529      *
026240200529     C                     ADD  1         I
026250200529     C                     ENDDO
026260200529      *
026270200529      ***  Write a record on SECOALL0: Corporate Actions Allocations file with Security Shortname =
026280200529      ***  '**CASH**'.
026290200529      *
026300200529     C                     MOVE *BLANKS   MCSESN
026310200529     C                     MOVEL'**CASH**'MCSESN           Securiry Shortname
026320200529      *
026330200529      ***  Reset Actual and Original Stock Allocation, Actual and Original Stock Rounding and
026340200529      ***  Actual and Original Cash Rounding.
026350200529      *
026360200529     C                     Z-ADD0         MCASTA           Actual Stock Allocation = 0
026370200529     C                     Z-ADD0         MCOALR           Original Stock Allocation = 0
026380200529     C                     Z-ADD0         MCASTR           Actual Stock Rounding = 0
026390200529     C                     Z-ADD0         MCOSTR           Original Stock Rounding = 0
026400200529     C                     Z-ADD0         MCACAR           Actual Cash Rounding = 0
026410200529     C                     Z-ADD0         MCOCAR           Original Cash Rounding = 0
026420200529      *                                                                   135686
026430200529      ***  If processing type = Currency Change.                          135686
026440200529      *                                                                   135686
026450200529     C           MAPTYP    IFEQ 'CC'                                      135686
026460200529     C           MAPTYP    ORNE 'CC'                                      137886
026470200529     C           BVALDC    ANDEQ'Y'                                       137886
026480200529      *
026490200529      ***  Input Balancing Cash Allocation calculatad for the Depot into Actual Cash Allocation
026500200529      ***  and Actual Cash Rounding for the Dummy Customer.               136935
026510200529      *****and*Original*Cash*Option*for*the*Dummy*Customer.************** 136935
026520200529      *
026530200529     C******               Z-ADDBACADC    WWNUM                           136935
026540200529     C           BACADC    SUB  BACRDC    WWNUM                           136935
026550200529     C           MAPTYP    IFEQ 'CR'
026560200529     C                     Z-ADDECNBDP    WWNBDP           Event Currency Decimal Places
026570200529     C                     ELSE
026580200529     C                     Z-ADDTCDP,1    WWNBDP           New Currency Decimal Places
026590200529     C                     ENDIF
026600200529     C                     EXSR SETNDP
026610200529     C******               Z-SUBWUNUM     MCACAA           Act.Cash Alloc.135686
026620200529     C******               Z-SUBWUNUM     MCCAOP           Orig.Cash Opt. 135686
026630200529     C                     Z-ADDWUNUM     MCACAA           Act.Cash Alloc.135686
026640200529     C******               Z-ADDWUNUM     MCCAOP                   135686 136935
026650200529     C                     Z-ADD0         BACADC           Reset Actual Cash Allocation
026660200529     C                     Z-ADDBACRDC    WWNUM                           136935
026670200529     C                     EXSR SETNDP                                    136935
026680200529     C                     Z-ADDWUNUM     MCACAR           Act.Cash Round.136935
026690200529     C                     Z-ADD0         BACRDC                          136935
026700200529      *                                                                   135686
026710200529      ***  Else, if processing type not Currency Change, set fields to 0. 135686
026720200529      *                                                                   135686
026730200529     C                     ELSE                                           135686
026740200529     C                     Z-ADD0         MCACAA           Act.Cash Alloc.135686
026750200529     C                     Z-ADD0         MCCAOP           Orig.Cash Opt. 135686
026760200529     C                     ENDIF                                          135686
026770200529      *
026780200529      ***  If Actual Cash Allocation = 0, set Reply Status to blank, else set Reply Status to 'C'
026790200529      ***  as 'Corporate Default'.
026800200529      *
026810200529     C           MCACAA    IFEQ 0
026820200529     C                     MOVE *BLANKS   MCREST           Reply Status = blank
026830200529     C                     ELSE
026840200529     C                     MOVE 'C'       MCREST           Reply Status = 'Corporate Default'
026850200529     C                     ENDIF
026860200529      *
026870200529      ***  Write record on file SECOALL0.
026880200529      *
026890200529     C                     WRITESECOALD0               89
026900200529      *
026910200529      ***  If error detected when write, handle Database Error.
026920200529      *
026930200529     C           *IN89     IFEQ '1'
026940200529     C                     Z-ADD010       DBASE            ***************
026950200529     C                     MOVEL'SECOALL0'DBFILE           * DB ERROR 10 *
026960200529     C                     MOVEL'WRITE'   DBKEY            ***************
026970200529     C                     EXSR *PSSR
026980200529     C                     ENDIF
026990200529     C                     COMIT
027000200529     C                     ADD  1         RSEAL
027010200529      *
027020200529     C                     ENDSR
027030200529      *
027040200529      *****************************************************************
027050200529      /EJECT
027060200529      *****************************************************************
027070200529      *                                                               *
027080200529      * PDEPOT - Process the Depot.                                   *
027090200529      *                                                               *
027100200529      * Called by:                                                    *
027110200529      *                                                               *
027120200529      * Calls:                                                        *
027130200529      *                                                               *
027140200529      *****************************************************************
027150200529      *
027160200529     C           PDEPOT    BEGSR                           ** PDEPOT SR **
027170200529      *                                                                   136935
027180200529      ***  Reset work field.                                              136935
027190200529      *                                                                   136935
027200200529     C                     MOVE *BLANKS   WWSESN                          136935
027210200529      *                                                                   CSE020
027220200529      ** If CA is a child, save Security. Instead, use Security           CSE020
027230200529      ** obtained from the Originating CA before reading SEDPOHL0.        CSE020
027240200529      *                                                                   CSE020
027250200529     C           MAPREF    IFNE *BLANKS                                   CSE020
027260200529     C                     MOVE MASESN    WKSESN                          CSE020
027270200529     C                     MOVE WOSESN    MASESN                          CSE020
027280200529     C                     ENDIF                                          CSE020
027290200529      *
027300200529      ***  Set greater on Depot Positions-Current & Historic with Branch, Depot (num field),
027310200529      ***  Security and Ex-Date (num field) received as parameter and read previous record.
027320200529      *
027330200529     C           @KEY4     SETGTSEDPOHL0
027340200529     C                     READPSEDPOHL0                 81
027350200529      *
027360200529      ***  If live record.
027370200529      *
027380200529     C           *IN81     IFEQ '0'                        Not begining of file
027390200529     C           DSBA      ANDEQPBRCD                      Same Branch
027400200529     C           DDPT      ANDEQWWDDPT                     Same Depot
027410200529     C           DSSC      ANDEQMASESN                     Same Security
027420200529      *                                                                   CSE020
027430200529      ** If CA is a child, restore MASESN with Security of the child      CSE020
027440200529      *                                                                   CSE020
027450200529     C           MAPREF    IFNE *BLANKS                                   CSE020
027460200529     C                     MOVE WKSESN    MASESN                          CSE020
027470200529     C                     ENDIF                                          CSE020
027480200529      *
027490200529      ***  If Trade/Value Date Position from SECORFL1 = 'T', set Ex-Date Position = Nominal Trade
027500200529      ***  Date Basis.
027510200529      *
027520200529     C           MATDVD    IFEQ 'T'
027530200529     C                     Z-ADDDSNT      WWTDVD
027540200529      *
027550200529      ***  If Trade/Value Date Position from SECORFL1 = 'V', set Ex-Date Position = Nominal Value
027560200529      ***  Date Basis.
027570200529      *
027580200529     C                     ELSE
027590200529     C                     Z-ADDDSNV      WWTDVD
027600200529     C                     ENDIF
027610200529      *                                                                   CSE020
027620200529      ** If CA is a child, set Ex-date Position = sum of Actual Stock     CSE020
027630200529      ** Allocation of the Parent CA.                                     CSE020
027640200529      *                                                                   CSE020
027650200529     C           MAPREF    IFNE *BLANKS                                   CSE020
027660200529     C                     Z-ADD*ZERO     WKASTA 150                      CSE020
027670200529     C           @KEY23    SETLLSECOALL5                                  CSE020
027680200529     C           @KEY23    READESECOALL5                 70               CSE020
027690200529     C           *IN70     DOWEQ*OFF                                      CSE020
027700200529     C           M5SESN    IFEQ MASESN                                    CSE020
027710200529     C                     ADD  M5ASTA    WKASTA                          CSE020
027720200529     C                     ENDIF                                          CSE020
027730200529     C           @KEY23    READESECOALL5                 70               CSE020
027740200529     C                     ENDDO                                          CSE020
027750200529     C                     Z-ADDWKASTA    WWTDVD                          CSE020
027760200529     C                     ENDIF                                          CSE020
027770200529      *
027780200529     C                     Z-ADDESNBDP    WWNBDP           Event Security Decimal Places
027790200529     C                     Z-ADDWWTDVD    WUNUM
027800200529     C                     EXSR RTVNDP
027810200529     C                     Z-ADDWWNUM     WWTDVD
027820200529      *
027830200529      ***  If Program called from SE7513: Corporate Actions Customer/Books by Depots Maintenance and
027840200529      ***  Processing Type is Corporate Reorganisation, retrieve the potential 20 New Securities,
027850200529      ***  Number of New Shares, Rounding, Rounding Settlement in Cash, Denomination Multiplier and
027860200529      ***  Compensation Price.
027870200529      *
027880200529     C           *IN13     IFEQ '1'
027890200529     C           MAPTYP    ANDEQ'CR'
027900200529     C                     MOVEAMHSECA    TSEC,1
027910200529     C                     MOVEAMHNSHA    TNSH,1
027920200529     C                     MOVEAMHRNDN    TNDN,1
027930200529     C                     MOVEAMHRNDS    TNDS,1
027940200529     C                     MOVEAMHDMLA    TDML,1
027950200529     C                     MOVEAMHCOPA    TOPA,1
027960200529      *
027970200529      ***  Retrieve Nominal Currency Decimal Places for the potential 20 New Securities.
027980200529      *
027990200529     C                     DO   20        I
028000200529     C           TSEC,I    IFNE *BLANKS
028010200529      *
028020200529      ***  Access Midas SE Securities to retrieve Nominal Currency decimal places with New Security.
028030200529      *
028040200529     C                     MOVE TSEC,I    @SEC
028050200529     C           @SEC      CHAINSECTY                80
028060200529      *
028070200529      ***  If record not found or not live, handle Database Error.
028080200529      *
028090200529     C           *IN80     IFEQ '1'                        Not found
028100200529     C           RECI      ORNE 'D'                        Not live
028110200529     C                     Z-ADD011       DBASE            ***************
028120200529     C                     MOVEL'SECTY'   DBFILE           * DB ERROR 11 *
028130200529     C                     MOVEL@SEC      DBKEY            ***************
028140200529     C                     EXSR *PSSR
028150200529     C                     ENDIF
028160200529      *
028170200529      ***  Save Number of Decimal Places and Price Basis for Nominal Currency of New Security.
028180200529      *
028190200529     C                     Z-ADDNMDP      TSDP,I
028200200529     C                     MOVE SPBS      TSPB,I
028210200529      *
028220200529      ***  Retrieve Number of Decimal Places of New Currency by calling access objet.
028230200529      *
028240200529     C                     CALL 'AOCURRR0'
028250200529     C                     PARM '*MSG   ' @RTCD   7
028260200529     C                     PARM '*KEY   ' @OPTN   7
028270200529     C                     PARM NMCY      @AJCD   3
028280200529     C           SDCURR    PARM SDCURR    DSSDY
028290200529      *
028300200529      ***  If record not found, handle Database Error.
028310200529      *
028320200529     C           @RTCD     IFNE *BLANKS
028330200529     C                     Z-ADD012       DBASE            ***************
028340200529     C                     MOVEL'SDCURRPD'DBFILE           * DB ERROR 12 *
028350200529     C                     MOVEL@AJCD     DBKEY            ***************
028360200529     C                     EXSR *PSSR
028370200529     C                     ENDIF
028380200529     C                     Z-ADDA6NBDP    TCDP,I           Number of Decimal Places
028390200529     C                     ENDIF
028400200529     C                     ENDDO
028410200529     C                     ENDIF
028420200529      *
028430200529      ***  Set lower on Corporate Actions Allocations file with CO Reference received as parameter,
028440200529      ***  Option Number from SECOxxL1, Branch and Depot (num field) received as parameter and read
028450200529      ***  next record with the same 4 fields (Reference, Option, Branch and Depot).
028460200529      *
028470200529     C           MAPTYP    IFEQ 'NF'                       If Processing Type = Non Financial Events
028480200529     C           MAPTYP    OREQ 'NC'                       Or Processing Type = Name Changes
028490200529     C           MAPTYP    OREQ 'CC'                       Or Ccy Changes CEU017
028500200529     C                     Z-ADD01        WWOPTN              Option Number = 01
028510200529     C                     ELSE                            Else
028520200529     C                     Z-ADDMDOPTN    WWOPTN              Option Number = from SECOxxL1
028530200529     C                     ENDIF
028540200529     C           @KEY5     SETLLSECOALL0
028550200529     C           @KEY5     READESECOALL0                 81
028560200529      *                                                                   135686
028570200529     C           *IN81     IFEQ '0'                                       135686
028580200529     C           MCRECI    ANDEQ'D'                                       135686
028590200529      *
028600200529      ***  Save New Security Shortname from SECOALL0.
028610200529      *
028620200529     C                     MOVE MCSESN    WWSESN 10
028630200529      *
028640200529      ***  Setup indice I to retrieve informations for New security.
028650200529      *
028660200529     C           MCSESN    IFNE '**CASH**'
028670200529     C                     Z-ADD1         I
028680200529     C           MCSESN    LOKUPTSEC,I                   90
028690200529     C                     ENDIF
028700200529      *
028710200529      ***  Setup New Security Shortname.
028720200529      *
028730200529     C                     MOVE TSEC,I    NWSESN
028740200529      *
028750200529      ***  Prepare Price Basis for New Security.
028760200529      *
028770200529     C                     MOVE TSPB,I    NSSPBS  1
028780200529      *
028790200529      ***  Prepare Number of Decimal Places of New Security.
028800200529      *
028810200529     C                     MOVE TSDP,I    NSNBDP  10
028820200529      *
028830200529      ***  Prepare Number of Decimal Places of New Currency.
028840200529      *
028850200529     C                     MOVE TCDP,I    NCNBDP  10
028860200529     C                     ENDIF                                          135686
028870200529      *                                                                   145872
028880200529      ***  If Exchange Offer, calculate base Ex-Date Position = Ex-Date   145872
028890200529      ***  Position multiplied by Percentage to Exchange.                 145872
028900200529      *                                                                   145872
028910200529     C           MAPTYP    IFEQ 'OF'                                      145872
028920200529     C           MIOFTY    ANDEQ'E'                                       145872
028930200529     C                     Z-ADDWWTDVD    WUTDVD                          145872
028940200529     C           WWTDVD    MULT MIPREX    WWTDVD                          145872
028950200529     C           WWTDVD    DIV  100       WWTDVD                          145872
028960200529     C                     Z-ADDESNBDP    WWNBDP           New Sec.Dec.Pl.145872
028970200529     C                     MOVE WWRNDN    WUROOP           CO Det. Round. 145872
028980200529     C                     Z-ADDWWTDVD    WWNUM                           145872
028990200529     C                     EXSR ROUNDD                                    145872
029000200529     C                     Z-ADDWWNUM     WWTDVD                          145872
029010200529     C                     ENDIF                                          145872
029020200529      *
029030200529      ***  Reset work fields.
029040200529      *
029050200529     C                     Z-ADD0         WTHOST 309       Total Holding Taken as Stock
029060200529     C                     Z-ADD0         WTHOCA 309       Total Holding Taken as Cash
029070200529     C                     Z-ADD0         WTASTA 309       Total Actual Stock Allocation
029080200529     C                     Z-ADD0         WTASTR 309       Total Actual Stock Rounding
029090200529     C                     Z-ADD0         WTACAR 309       1st total Actual Cash Rounding
029100200529     C                     Z-ADD0         WTAAAR 309       Total Actual Cash Allocation+Rounding
029110200529     C                     Z-ADD0         TWACAR 309       2nd total Actual Cash Rounding
029120200529     C                     Z-ADD0         WTOCAR 309       Total Original Cash Rounding
029130200529     C                     Z-ADD0         WTACAA 309                      136935
029140200529      *
029150200529      ***  Do while not end of file, and record read with same CO Reference received as parameter,
029160200529      ***  Same Option Number from SECOxxL1, same Branch and Depot (num field) received as
029170200529      ***  parameter.
029180200529      *
029190200529     C           *IN81     DOWEQ'0'
029200200529      *
029210200529     C           MCRECI    IFEQ 'D'
029220200529      *
029230200529      ***  If change of Security Shortname and Security work field not equal to '**CASH**'.
029240200529      *
029250200529     C           MCSESN    IFNE WWSESN
029260200529     C           WWSESN    ANDNE'**CASH**'
029270200529     C           WWSESN    ANDNE*BLANKS                                   135690
029280200529      *
029290200529     C                     Z-ADD1         I                               220007
029300200529     C           WWSESN    LOKUPTSEC,I                   90               220007
029310200529      *
029320200529      ***  Process New Security for the Depot.
029330200529      *
029340200529     C                     EXSR PSEDPT
029350200529     C                     ENDIF
029360200529      *
029370200529      ***  If Security is not '**CASH**'.
029380200529      *
029390200529     C           MCSESN    IFNE '**CASH**'
029400200529      *
029410200529      ***  If change of Security, Setup indice I to retrieve informations for New security.
029420200529      *
029430200529     C           MCSESN    IFNE WWSESN
029440200529     C                     Z-ADD1         I
029450200529     C           MCSESN    LOKUPTSEC,I                   90
029460200529     C                     ENDIF
029470200529      *
029480200529      ***  Setup New Security Shortname.
029490200529      *
029500200529     C                     MOVE TSEC,I    NWSESN
029510200529      *
029520200529      ***  Prepare Price Basis for New Security.
029530200529      *
029540200529     C                     MOVE TSPB,I    NSSPBS  1
029550200529      *
029560200529      ***  Prepare Number of Decimal Places of New Security.
029570200529      *
029580200529     C                     MOVE TSDP,I    NSNBDP  10
029590200529      *
029600200529      ***  Prepare Number of Decimal Places of New Currency.
029610200529      *
029620200529     C                     MOVE TCDP,I    NCNBDP  10
029630200529      *
029640200529      ***  Accumulate Total Holding taken as Stock.
029650200529      *
029660200529     C                     Z-ADDESNBDP    WWNBDP
029670200529     C                     Z-ADDMCHOST    WUNUM
029680200529     C                     EXSR RTVNDP
029690200529     C                     ADD  WWNUM     WTHOST
029700200529      *
029710200529      ***  Accumulate Total Actual Stock Allocation.
029720200529      *
029730200529     C                     Z-ADDNSNBDP    WWNBDP
029740200529     C                     Z-ADDMCASTA    WUNUM
029750200529     C                     EXSR RTVNDP
029760200529     C                     ADD  WWNUM     WTASTA
029770200529      *
029780200529      ***  Accumulate Total Actual Stock Rounding.
029790200529      *
029800200529     C                     ADD  MCASTR    WTASTR
029810200529      *
029820200529      ***  Accumulate Total Holding taken as Cash.
029830200529      *
029840200529     C                     Z-ADDNCNBDP    WWNBDP
029850200529     C                     Z-ADDMCHOCA    WUNUM
029860200529     C                     EXSR RTVNDP
029870200529     C                     ADD  WWNUM     WTHOCA
029880200529      *
029890200529      ***  Accumulate Total Actual Cash Rounding.
029900200529      *
029910200529     C                     Z-ADDMCACAR    WUNUM
029920200529     C                     EXSR RTVNDP
029930200529     C                     ADD  WWNUM     WTACAR
029940200529      *
029950200529     C                     ELSE
029960200529      *
029970200529      ***  Accumulate Actual Cash Allocation + Actual Cash Rounding.
029980200529      ***  and Actual Cash Allocation.                                    136935
029990200529      *
030000200529     C           MAPTYP    IFEQ 'CR'
030010200529     C                     Z-ADDECNBDP    WWNBDP
030020200529     C                     ELSE
030030200529     C                     Z-ADDTCDP,1    WWNBDP
030040200529     C                     ENDIF
030050200529     C                     Z-ADDMCACAR    WUNUM
030060200529     C                     EXSR RTVNDP
030070200529     C                     ADD  WWNUM     WTAAAR
030080200529     C                     Z-ADDMCACAA    WUNUM
030090200529     C                     EXSR RTVNDP
030100200529     C                     ADD  WWNUM     WTAAAR
030110200529     C                     ADD  WWNUM     WTACAA                          136935
030120200529      *
030130200529     C                     ENDIF
030140200529      *
030150200529      ***  Save Security Shortname from SECOALL0.
030160200529      *
030170200529     C                     MOVE MCSESN    WWSESN
030180200529      *
030190200529     C                     ENDIF
030200200529      *
030210200529      ***  Read next record with the same CO Reference received as parameter, same Option Number
030220200529      ***  from SECOxxL1, same Branch and same Depot (num field) received as parameter.
030230200529      *
030240200529     C           @KEY5     READESECOALL0                 81
030250200529      *
030260200529     C                     ENDDO
030270200529      *
030280200529      ***  Process New Security for the Depot.
030290200529      *
030300200529     C           MCSESN    IFNE '**CASH**'                                150252
030310200529     C           MCSESN    ANDNE*BLANKS                                   152932
030320200529     C                     Z-ADD1         I                               220007
030330200529     C           MCSESN    LOKUPTSEC,I                   90               220007
030340200529     C                     EXSR PSEDPT
030350200529     C                     ENDIF                                          150252
030360200529      *
030370200529      ***  Setup New Security to '**CASH**'.
030380200529      *
030390200529     C                     MOVE *BLANKS   NWSESN
030400200529     C                     MOVEL'**CASH**'NWSESN
030410200529      *
030420200529      ***  Some fields must not be calculated for Security = '**CASH**'.
030430200529      *
030440200529     C                     Z-ADD0         WWOALR           Original Stock Allocation
030450200529     C                     Z-ADD0         WWOTSA           True Stock Allocation
030460200529     C                     Z-ADD0         WWOSTR           Original Stock Rounding
030470200529     C                     Z-ADD0         WWASTA           Actual Stock Allocation
030480200529     C                     Z-ADD0         WWASTR           Actual Stock Rounding
030490200529     C                     Z-ADD0         WWBSTA           Balancing Stock Allocation
030500200529     C                     Z-ADD0         WWBSTR           Balancing Stock Rounding
030510200529     C                     Z-ADD0         WWBCAR           Balancing Cash Rounding
030520200529      *                                                                   136935
030530200529     C******               MOVE WWOPT1    WKOPTN                   136935 156538
030540200529     C******     MDOPTN    IFEQ WKOPTN                             136935 156538
030550200529     C******     MANBOP    OREQ 1                                  136935 156538
030560200529      *
030570200529      ***  Calculate Original Cash Rounding for Security = '**CASH**'.
030580200529      *
030590200529     C                     EXSR COCR
030600200529      *
030610200529      ***  Calculate Actual Cash Rounding for Security = '**CASH**'.
030620200529      *
030630200529     C                     Z-ADDTWACAR    WWNUM            Total Actual Cash Rounding accumulated
030640200529     C                     EXSR CACR
030650200529      *
030660200529      ***  Calculate Holding Taken as Stock for Security = '**CASH**'.
030670200529      *
030680200529     C                     EXSR CHST
030690200529      *
030700200529      ***  Calculate Holding Taken as Cash for Security = '**CASH**'.
030710200529      *
030720200529     C                     EXSR CHCA
030730200529      *
030740200529      ***  Calculate Cash Option and Actual Cash Allocation for Depot.
030750200529      *
030760200529     C                     EXSR CCADPT
030770200529     C******               ENDIF                                   136935 156538
030780200529      *
030790200529      ***  Calculate Balancing Cash Allocation =
030800200529      ***  Actual Cash Allocation+Rounding - Total Actual Cash            135686
030810200529      ***  Allocation+Rounding.                                           135686
030820200529      *****Total*Actual*Cash*Allocation+Rounding*-*Actual*Cash*********** 135686
030830200529      *****Allocation+Rounding.****************************************** 135686
030840200529      *
030850200529     C           WWACAA    ADD  WWACAR    WWAAAR 309
030860200529     C******     WTAAAR    SUB  WWAAAR    WWBCAA                          135686
030870200529     C           WWAAAR    SUB  WTAAAR    WWBCAA                          135686
030880200529      *
030890200529      ***  Set Balancing Cash Allocation calculated.
030900200529      *
030910200529     C           MAPTYP    IFEQ 'CR'
030920200529     C                     Z-ADDECNBDP    WWNBDP           Event Currency Decimal Places
030930200529     C                     ELSE
030940200529     C                     Z-ADDTCDP,1    WWNBDP           New Currency Decimal Places
030950200529     C                     ENDIF
030960200529     C                     MOVE 'R'       WUROOP           Rounding = half adjust
030970200529     C                     Z-ADDWWBCAA    WWNUM
030980200529     C                     EXSR ROUNDD
030990200529      *                                                                   135686
031000200529      ***  If processing type = Currency Change, load work field for      135686
031010200529      ***  Dummy Customer and reset work field for Depot Allocation file  135686
031020200529      ***  (Balancing Differences are input on Dummy Customer).           135686
031030200529      *                                                                   135686
031040200529     C           MAPTYP    IFEQ 'CC'                                      135686
031050200529     C           MAPTYP    ORNE 'CC'                                      137886
031060200529     C           BVALDC    ANDEQ'Y'                                       137886
031070200529     C                     Z-ADD0         WWBCAA
031080200529     C                     Z-ADDWWNUM     BACADC 309
031090200529      *                                                                   135686
031100200529      ***  Else, if processing type not Currency Change, load work field  135686
031110200529      ***  for Depot Allocation file and reset work field for Dummy       135686
031120200529      ***  Customer.                                                      135686
031130200529      *                                                                   135686
031140200529     C                     ELSE                                           135686
031150200529     C                     Z-ADDWWNUM     WWBCAA                          135686
031160200529     C                     Z-ADD0         BACADC                          135686
031170200529     C                     ENDIF                                          135686
031180200529      *                                                                   136935
031190200529     C           MDOPTN    IFNE WKOPTN                                    136935
031200200529     C           MANBOP    ANDNE1                                         136935
031210200529     C           WWBCAA    ANDNE*ZEROS                                    136935
031220200529     C           WWBCAA    IFLT *ZEROS                                    136935
031230200529     C                     Z-SUBWWBCAA    WWACAA                          136935
031240200529     C                     ELSE                                           136935
031250200529     C                     Z-ADDWWBCAA    WWACAA                          136935
031260200529     C                     ENDIF                                          136935
031270200529     C                     Z-ADD*ZEROS    WWBCAA                          136935
031280200529     C                     Z-ADD0         BACADC                          136935
031290200529     C                     ENDIF                                          136935
031300200529      *
031310200529      ***  Write a record on SECODPL0: Corporate Actions Depotrs file.
031320200529      *
031330200529     C                     EXSR WRCODP
031340200529      *
031350200529      ***  Set to zero the Total Holding taken as Stock.
031360200529      *
031370200529     C                     Z-ADD0         WTHOST
031380200529      *
031390200529     C                     ENDIF
031400200529      *
031410200529     C                     ENDSR
031420200529      *
031430200529      *****************************************************************
031440200529      /EJECT
031450200529      *****************************************************************
031460200529      *                                                               *
031470200529      * PRDTAG - Print details of Allocation generated.               *
031480200529      *                                                               *
031490200529      * Called by:                                                    *
031500200529      *                                                               *
031510200529      * Calls:                                                        *
031520200529      *                                                               *
031530200529      *****************************************************************
031540200529      *
031550200529     C           PRDTAG    BEGSR                           ** PRDTAG SR **
031560200529      *
031570200529      ***  Print details of Allocation generated by calling RPG/SE7534: Corporate Action Report.
031580200529      *
031590200529     C                     CALL 'SE7534'               87
031600200529     C                     PARM *BLANKS   WCSEQ   5        Sequence
031610200529     C                     PARM *BLANKS   WLVL    1        Level
031620200529     C                     PARM *BLANKS   WETTY   3        Entity
031630200529     C                     PARM *BLANKS   WSLAL   1        Select All
031640200529     C                     PARM           PCORF            CO Reference (Parameter)
031650200529     C                     PARM *BLANKS   POPTN            Option Number from SECOxxL0
031660200529     C                     PARM           PBRCD            Branch Code
031670200529     C                     PARM           PDDPT            Depot (Parameter)
031680200529      *
031690200529     C           *IN87     IFEQ '1'
031700200529     C           *INU7     OREQ '1'
031710200529     C           *INU8     OREQ '1'
031720200529     C                     Z-ADD015       DBASE            ***************
031730200529     C                     MOVEL*BLANKS   DBFILE           * DB ERROR 15 *
031740200529     C                     MOVELNARR,1    DBKEY            ***************
031750200529     C                     EXSR *PSSR
031760200529     C                     ENDIF
031770200529      *
031780200529     C                     ENDSR
031790200529      *
031800200529      *****************************************************************
031810200529      /EJECT
031820200529      *****************************************************************
031830200529      *                                                               *
031840200529      * PBLOCK - Blocking processing.                                 *
031850200529      *                                                               *
031860200529      * Called by:                                                    *
031870200529      *                                                               *
031880200529      * Calls:                                                        *
031890200529      *                                                               *
031900200529      *****************************************************************
031910200529      *
031920200529     C           PBLOCK    BEGSR                           ** PBLOCK SR **
031930200529      *
031940200529      ***  If Processing Type not Corporate Reorganisation or if Corporate Reorganisation and
031950200529      ***  not first passge, set Block fields (for Processing Type Corporate Reorganisation,
031960200529      ***  the Block fields should only be filled on first record written in CO Allocation file
031970200529      ***  (SECOALL0)).
031980200529      *
031990200529     C           MAPTYP    IFEQ 'CR'
032000200529     C           FIRSCR    ANDEQ'Y'
032010200529     C           MAPTYP    ORNE 'CR'
032020200529      *
032030200529      ***  If Customer Current Reply does not exist, set Blocked fields to fields from CO
032040200529      ***  References (SECORFL1).
032050200529      *
032060200529     C           CUSRPL    IFEQ 'N'
032070200529     C                     Z-ADDMABFRD    WWBSTT  50       Block Start Date = Block From Date
032080200529     C                     Z-ADDMABEND    WWBEDT  50       Block End Date = Block End Date
032090200529     C                     MOVE MABLOP    WWBEWI  1        Block Err./Warn.Ind.=Block Positions
032100200529     C                     ENDIF
032110200529     C           WWBEDT    IFNE 0                          If Blocked End Date not zero
032120200529     C                     MOVE 'P'       WWBLTY  1           Set Block Type to 'P'
032130200529     C                     ELSE                            Else, if Blocked End Date equal zero
032140200529     C                     MOVE *BLANK    WWBLTY              Set Block Type to blank
032150200529     C                     ENDIF
032160200529      *
032170200529      ***  Set other Blocked fields to fields from CO References (SECORFL1).
032180200529      *
032190200529     C                     MOVE MASESN    WWBSEC 10        Block Security
032200200529     C                     ENDIF
032210200529      *
032220200529     C                     ENDSR
032230200529      *
032240200529      *****************************************************************
032250200529      /EJECT
032260200529      *****************************************************************
032270200529      *                                                               *
032280200529      * RAAOPT - Retrieve Actual Allocation for Options and           *
032290200529      *          Actual Allocation for options within the Option.     *
032300200529      *                                                               *
032310200529      * Called by:                                                    *
032320200529      *                                                               *
032330200529      * Calls:                                                        *
032340200529      *                                                               *
032350200529      *****************************************************************
032360200529      *
032370200529     C           RAAOPT    BEGSR                           ** RAAOPT SR **
032380200529      *
032390200529      ***  If Processing Type = Non Financial Events or Name Changes,
032400200529      ***  set-up special work field to 'N', it means the Actual Allocation fields must not be
032410200529      ***  calculated, else set-up this work field to 'Y'.
032420200529      *
032430200529     C           MAPTYP    IFEQ 'NF'                       Non Financial Events
032440200529     C           MAPTYP    OREQ 'NC'                       Name Changes
032450200529     C                     MOVE 'N'       SPWRKF  1
032460200529     C                     ELSE
032470200529     C                     MOVE 'Y'       SPWRKF
032480200529     C                     ENDIF
032490200529      *
032500200529      ***  Reset work fields.
032510200529      *
032520200529     C                     Z-ADD0         WCAPR   52       Cash %
032530200529     C                     MOVE *BLANKS   WWOPT1  1        Option for Actual Allocation 1
032540200529     C                     MOVE *BLANKS   WWOPT2  1        Option for Actual Allocation 2
032550200529      *
032560200529      ***  If Customer/Book Current Reply exists.
032570200529      *
032580200529     C           EXBCRE    IFEQ 'Y'
032590200529      *
032600200529      ***  If Processing Type not Corporate Reorganisation or if Processing Type = Corporate
032610200529      ***  Reorganisation and this is the first passge, set Blocked fields to fields from
032620200529      ***  Customer Current Reply (SECOREL1) (for Processing Type = Corporate Reorganisation,
032630200529      ***  the Block fields should only be filled on first record written in CO Allocation file
032640200529      ***  (SECOALL0)).
032650200529      *
032660200529     C           MAPTYP    IFEQ 'CR'                       If Corporate Reorganistion
032670200529     C           FIRSCR    ANDEQ'Y'                           First passage
032680200529     C           MAPTYP    ORNE 'CR'                       Or not Corporate Reorganisation
032690200529     C           CUSRPL    IFEQ 'Y'
032700200529     C                     Z-ADDMQR1BF    WWBSTT           Block Start Date = Block from Date Level1
032710200529     C                     Z-ADDMQR1BE    WWBEDT           Block End Date = Block End Date Level 1
032720200529     C                     MOVE MQR1BA    WWBEWI           Block Err./Warn.Ind.=Block Pos.Level 1
032730200529     C           WWBEDT    IFNE 0                          If Blocked End Date not zero
032740200529     C                     MOVE 'P'       WWBLTY              Set Block Type to 'P'
032750200529     C                     ELSE                            Else, if Blocked End Date equal zero
032760200529     C                     MOVE *BLANKS   WWBLTY              Set Block Type to blank
032770200529     C                     ENDIF
032780200529     C                     ENDIF
032790200529     C                     ENDIF
032800200529     C                     ENDIF
032810200529      *
032820200529      ***  If Processing Type = Non Financial Events, Name Changes or Currency Changes, or if
032830200529      ***  Processing Type = Dividend Events, Offers, Rights Issues, Exercices and Conversions,
032840200529      ***  Free Allocation, Capital Changes or Corporate Reorganisation for Single Option
032850200529      ***  (= with Number of Options retrieve from CO References file (SECORFL1) < or = 1), set
032860200529      ***  Option for Actual Allocation 1 to '1'.
032870200529      *
032880200529     C           MAPTYP    IFEQ 'NF'                       If Non Financial Events
032890200529     C           MAPTYP    OREQ 'NC'                       Or Name Changes
032900200529     C           MAPTYP    OREQ 'CC'                       Or Currency Changes
032910200529     C           MANBOP    ORLE 1                          Or for Single Option
032920200529     C                     MOVE '1'       WWOPT1
032930200529      *
032940200529      ***  Else, if Processing Type = Dividend Events, Offers, Rights Issues, Exercices and
032950200529      ***  Conversions, Free Allocation, Capital Changes or Corporate Reorganisation for Multiple
032960200529      ***  Options (= with Number of Options retrieve from CO References file (SECORFL1) > 1).
032970200529      *
032980200529     C                     ELSE
032990200529      *
033000200529      ***  If Customer/Book Current Reply exists.
033010200529      *
033020200529     C           EXBCRE    IFEQ 'Y'
033030200529      *
033040200529      ***  Set Option for Actual Allocation 1 to Current Reply (Reply Option Level 1 from SECOREL0).
033050200529      *
033060200529     C                     MOVE MQR1RE    WWOPT1
033070200529      *
033080200529      ***  Else, if Customer/Book Current Reply does not exist.
033090200529      *
033100200529     C                     ELSE
033110200529      *
033120200529      ***  If Customer/Book Standard Corporate Actions Instruction exists.
033130200529      *
033140200529     C           EXBCSI    IFEQ 'Y'
033150200529      *
033160200529      ***  If Cash Preferred % is > or = 50, set Option for Actual Allocation 1 to Default
033170200529      ***  Cash Preferred from SECORFL1.
033180200529      *
033190200529     C           MOCAPP    IFGE 50
033200200529     C                     MOVE MADFCP    WWOPT1
033210200529      *
033220200529      ***  Else, if Cash Preferred % is < 50, set Option for Actual Allocation 1 to Default
033230200529      ***  Stock Preferred from SECORFL1.
033240200529      *
033250200529     C                     ELSE
033260200529     C                     MOVE MADFSP    WWOPT1
033270200529     C                     ENDIF
033280200529      *
033290200529      ***  Else, if Customer/Book Standard Corporate Actions Instruction does not exist (and
033300200529      ***  Customer/Book Current Reply does not exist).
033310200529      *
033320200529     C                     ELSE
033330200529      *
033340200529      ***  Set Option for Actual Allocation 1 to Default for No Reply from SECORFL1.
033350200529      *
033360200529     C                     MOVE MADFNR    WWOPT1
033370200529      *
033380200529      ***  If Default for No Reply from SECORFL1 is blank:
033390200529      ***  Actual Allocations must not be calculated and must be set to zeros. So set the Special
033400200529      ***  work field to 'N'.
033410200529      *
033420200529     C           MADFNR    IFEQ *BLANKS
033430200529     C                     MOVE 'N'       SPWRKF
033440200529     C                     ENDIF
033450200529     C                     ENDIF
033460200529     C                     ENDIF
033470200529     C                     ENDIF
033480200529      *
033490200529      ***  If Processing Type = Non Financial Events and Customer/Book Current Reply exists,
033500200529      ***  set Cash % to Reply Cash % Level 2 from SECOREL0.
033510200529      *
033520200529     C           MAPTYP    IFEQ 'NF'
033530200529     C           EXBCRE    ANDEQ'Y'
033540200529     C                     Z-ADDMQR2CA    WCAPR
033550200529     C                     ENDIF
033560200529      *
033570200529      ***  If Processing Type = Dividends Events, Rights Issues, Offers or Exercices and
033580200529      ***  Conversions.
033590200529      *
033600200529     C           MAPTYP    IFEQ 'DV'                       If Dividends Events
033610200529     C           MAPTYP    OREQ 'RG'                       Or Rights Issues
033620200529     C           MAPTYP    OREQ 'OF'                       Or Offers
033630200529     C           MAPTYP    OREQ 'EX'                       Or Exercices and Conversions
033640200529      *
033650200529      ***  CASE 1: If Customer/Book Current Reply exists.
033660200529      *
033670200529     C           EXBCRE    IFEQ 'Y'
033680200529      *
033690200529      ***  Set Option for Actual Allocation 2 to Reply Option Level 2 from SECOREL0.
033700200529      *
033710200529     C                     MOVE MQR2RE    WWOPT2
033720200529      *
033730200529      ***  If Processing Type = Dividends Events.
033740200529      *
033750200529     C           MAPTYP    IFEQ 'DV'
033760200529      *
033770200529      ***  If Option 1 selected: Cash Payment/Sell Rights, set Cash % to 100.
033780200529      *
033790200529     C           WWOPT2    IFEQ '1'
033800200529     C                     Z-ADD100       WCAPR
033810200529     C                     ELSE
033820200529      *
033830200529      ***  If Option selected is 2: Take Stock+Buy Additional Rights or 3: Take Stock+Sell Excess
033840200529      ***  Rights or 4: Take Stock, set Cash % to 0.
033850200529      *
033860200529     C           WWOPT2    IFEQ '2'
033870200529     C           WWOPT2    OREQ '3'
033880200529     C           WWOPT2    OREQ '4'
033890200529     C                     Z-ADD0         WCAPR
033900200529     C                     ELSE
033910200529      *
033920200529      ***  If Option 5 selected: Take Part Cash/Rest Stock, set Cash % to Reply Cash % Level 2
033930200529      ***  from SECOREL0.
033940200529      *
033950200529     C           WWOPT2    IFEQ '5'
033960200529     C                     Z-ADDMQR2CA    WCAPR
033970200529     C                     ENDIF
033980200529     C                     ENDIF
033990200529     C                     ENDIF
034000200529     C                     ELSE
034010200529      ******                                                              135690
034020200529      *****If*Processing*Type*=*Rights*Issues.*************************** 135690
034030200529      ******                                                              135690
034040200529     C******     MAPTYP    IFEQ 'RG'                                      135690
034050200529      ******                                                              135690
034060200529      *****If*Option*1*selected:*Sell*all*Rights,*set*Cash*%*to*100.***** 135690
034070200529      ******                                                              135690
034080200529     C******     WWOPT2    IFEQ '1'                                       135690
034090200529     C******               Z-ADD100       WCAPR                           135690
034100200529     C******               ELSE                                           135690
034110200529      ******                                                              135690
034120200529      *****If*Option*selected*is*5:*Take*Part*Cash/Rest*Stock*or*6:*Take* 135690
034130200529      *****Part*Cash/Keep*Stock,*set*Cash*%*to*Reply*Cash*%*Level*2*from* 135690
034140200529      *****SECOREL0.***************************************************** 135690
034150200529      ******                                                              135690
034160200529     C******     WWOPT2    IFEQ '5'                                       135690
034170200529     C******     WWOPT2    OREQ '6'                                       135690
034180200529     C******               Z-ADDMQR2CA    WCAPR                           135690
034190200529     C******               ELSE                                           135690
034200200529      ******                                                              135690
034210200529      *****If*Option*selected*is*2:*Take*Stock+Buy*Fraction*or*3:*Take*** 135690
034220200529      *****Stock+Sell*Fraction*or*4:*Take*Stock*or*7:*Do*nothing,*set**** 135690
034230200529      *****Cash*%*to*0.************************************************** 135690
034240200529      ******                                                              135690
034250200529     C******     WWOPT2    IFEQ '2'                                       135690
034260200529     C******     WWOPT2    OREQ '3'                                       135690
034270200529     C******     WWOPT2    OREQ '4'                                       135690
034280200529     C******     WWOPT2    OREQ '7'                                       135690
034290200529     C******               Z-ADD0         WCAPR                           135690
034300200529     C******               ENDIF                                          135690
034310200529     C******               ENDIF                                          135690
034320200529     C******               ENDIF                                          135690
034330200529     C******               ELSE                                           135690
034340200529      *
034350200529      ***  If Processing Type = Offers.
034360200529      *
034370200529     C           MAPTYP    IFEQ 'OF'
034380200529      *
034390200529      ***  If Option 1 selected: Accept Offer, set Cash % to 100.
034400200529      *
034410200529     C           WWOPT2    IFEQ '1'
034420200529     C           MIOFTY    IFEQ 'E'                                       136935
034430200529     C                     Z-ADD0         WCAPR                           136935
034440200529     C                     ELSE                                           136935
034450200529     C                     Z-ADD100       WCAPR
034460200529     C                     ENDIF                                          136935
034470200529     C                     ELSE
034480200529      *
034490200529      ***  If Option 2 selected: Refuse Offer, set Cash % to 0.
034500200529      *
034510200529     C           WWOPT2    IFEQ '2'
034520200529     C           MIOFTY    IFEQ 'E'                                       136935
034530200529     C                     Z-ADD100       WCAPR                           136935
034540200529     C                     ELSE                                           136935
034550200529     C                     Z-ADD0         WCAPR
034560200529     C                     ENDIF                                          136935
034570200529     C                     ELSE
034580200529      *
034590200529      ***  If Option 3 selected: Partial Accept Offer, set Cash % to Reply Cash % Level 2 from
034600200529      ***  SECOREL0.
034610200529      *
034620200529     C           WWOPT2    IFEQ '3'
034630200529     C                     Z-ADDMQR2CA    WCAPR
034640200529     C                     ENDIF
034650200529     C                     ENDIF
034660200529     C                     ENDIF
034670200529     C                     ELSE
034680200529      *
034690200529      ***  If Processing Type = Exercices and Conversions.
034700200529      *
034710200529     C           MAPTYP    IFEQ 'EX'
034720200529      *
034730200529      ***  If Option 1 selected: Sell all Rights, set Cash % to 100.
034740200529      *
034750200529     C           WWOPT2    IFEQ '1'
034760200529     C                     Z-ADD100       WCAPR
034770200529     C                     ELSE
034780200529      *
034790200529      *****If*Option*selected*is*5:*Take*Part*Cash/Rest*Stock*or*6:*Take* 161732
034800200529      *****set*Cash*%*to*Reply*Cash*%*Level*2*from*SECOREL0.************* 161732
034810200529      ** If Option selected is 5: Take Part Cash/Rest Stock,              161732
034820200529      ** set Cash % to Reply Cash % Level 2 from SECOREL0.                161732
034830200529      *
034840200529     C           WWOPT2    IFEQ '5'
034850200529     C***********WWOPT2    OREQ '6'                                       161732
034860200529     C                     Z-ADDMQR2CA    WCAPR
034870200529     C                     ELSE
034880200529      *
034890200529      *****If*Option*selected*is*2:*Take*Stock+Buy*Fraction*or*3:*Take*St 161732
034900200529      *****Take*Stock*or*7:*Do*nothing,*set*Cash*%*to*0.***************** 161732
034910200529      ** If Option selected is 2: Take Stock+Buy Fraction or 3: Take      161732
034920200529      ** Stock+Sell Fraction or 4: Take Stock or 6: Take Part Stock+      161732
034930200529      ** Keep Rest or 7: Do nothing, set Cash % to 0.                     161732
034940200529      *
034950200529     C           WWOPT2    IFEQ '2'
034960200529     C           WWOPT2    OREQ '3'
034970200529     C           WWOPT2    OREQ '4'
034980200529     C           WWOPT2    OREQ '6'                                       161732
034990200529     C           WWOPT2    OREQ '7'
035000200529     C                     Z-ADD0         WCAPR
035010200529     C                     ENDIF
035020200529     C                     ENDIF
035030200529     C                     ENDIF
035040200529     C                     ENDIF
035050200529     C                     ENDIF
035060200529     C******               ENDIF                                          135690
035070200529     C                     ENDIF
035080200529      *
035090200529      ***  CASE 2: Else, if Customer/Book Current Reply does not exist.
035100200529      *
035110200529     C                     ELSE
035120200529      *
035130200529      ***  Set Option for Actual Allocation 2 to Default for No Reply from SECOxxL1
035140200529      ***  (where xx = 'DV', 'RG', 'EX' or 'OF').
035150200529      *
035160200529     C                     MOVE MDDFNR    WWOPT2
035170200529      *
035180200529      ***  CASE 2.1: If Customer/Book Standard Corporate Actions Instruction exists (and Customer/
035190200529      ***            Book Current Reply does not exist).
035200200529      *
035210200529     C           EXBCSI    IFEQ 'Y'
035220200529      *
035230200529      ***  If Processing Type not Rights Issues.                          135690
035240200529      ***  Set Cash % to Cash Preferred % from Standard Instruction (SECOSIL1-2).
035250200529      *
035260200529     C           MAPTYP    IFNE 'RG'                                      135690
035270200529     C                     Z-ADDMOCAPP    WCAPR
035280200529     C                     ENDIF                                          135690
035290200529      *
035300200529      ***  If Processing Type = Dividends Events.
035310200529      *
035320200529     C           MAPTYP    IFEQ 'DV'
035330200529      *
035340200529      ***  If Stock Dividend Type = Stock for Stock or Combined for Cash and Stock, set Cash % to 0.
035350200529      *
035360200529     C           MDSDIT    IFEQ 'S'                        Stock for Stock
035370200529     C           MDSDIT    OREQ 'C'                        Combined for Cash and Stock
035380200529     C                     Z-ADD0         WCAPR
035390200529     C                     ENDIF
035400200529      *
035410200529      ***  If Cash % is < 50.
035420200529      *
035430200529     C           WCAPR     IFLT 50
035440200529      *
035450200529      ***  If Option 5 not allowed, set Cash % to 0.
035460200529      *
035470200529     C           MDOPT5    IFNE 'Y'
035480200529     C                     Z-ADD0         WCAPR
035490200529     C                     ELSE
035500200529      *
035510200529      ***  If Option 5 allowed and Cash % not 0, default Option for Actual allocation 2 is '5'
035520200529      ***  (Cash % already = Cash Preferred % from Standard Instruction (SECOSIL1-2)).
035530200529      *
035540200529     C           WCAPR     IFNE 0
035550200529     C                     MOVE '5'       WWOPT2
035560200529     C                     ENDIF
035570200529     C                     ENDIF
035580200529     C                     ELSE
035590200529      *
035600200529      *****If*Cash*%*>*50.*********************************************** 135690
035610200529      ***  Else, if Cash % > or = 50.                                     135690
035620200529      *
035630200529     C******     WCAPR     IFGT 50                                        135690
035640200529      *
035650200529      ***  If Option 5 not allowed, set Cash % to 100.
035660200529      *
035670200529     C           MDOPT5    IFNE 'Y'
035680200529     C                     Z-ADD100       WCAPR
035690200529     C                     ELSE
035700200529      *
035710200529      ***  If Option 5 allowed and Cash % not 100, default Option for Actual allocation 2 is '5'
035720200529      ***  (Cash % already = Cash Preferred % from Standard Instruction (SECOSIL1-2)).
035730200529      *
035740200529     C           WCAPR     IFNE 100
035750200529     C                     MOVE '5'       WWOPT2
035760200529     C                     ENDIF
035770200529     C                     ENDIF
035780200529     C******               ENDIF                                          135690
035790200529     C                     ENDIF
035800200529      *
035810200529      ***  If Cash % is 0 (means it is Stock Preferred).
035820200529      *
035830200529     C           WCAPR     IFEQ 0
035840200529      *
035850200529      ***  If Rounding Option from SECOSIL1-2 = 'U' and Option 2 is allowed, default Option for
035860200529      ***  Actual Allocation 2 is '2' (Cash % is already 0).
035870200529      *
035880200529     C           MOROOP    IFEQ 'U'
035890200529     C           MDOPT2    IFEQ 'Y'
035900200529     C                     MOVE '2'       WWOPT2
035910200529     C                     ELSE
035920200529      *
035930200529      ***  If Rounding Option is 'U' and Option 2 is not allowed and Option 4 is allowed, default
035940200529      ***  Option for Actual Allocation 2 is '4' (Cash % is already 0).
035950200529      *
035960200529     C           MDOPT4    IFEQ 'Y'
035970200529     C                     MOVE '4'       WWOPT2
035980200529     C                     ELSE
035990200529      *
036000200529      ***  If Rounding Option is 'U' and Options 2 and 4 are not allowed and Option 3 is allowed,
036010200529      ***  default Option for Actual Allocation 2 is '3' (Cash % is already 0).
036020200529      *
036030200529     C           MDOPT3    IFEQ 'Y'
036040200529     C                     MOVE '3'       WWOPT2
036050200529     C                     ELSE
036060200529      *
036070200529      ***  If Rounding Option is 'U' and Options 2, 4 and 3 are not allowed and Option 5 is allowed,
036080200529      ***  default Option for Actual Allocation 2 is '5' and Set Cash % to Cash Preferred % from
036090200529      ***  Standard Instruction (SECOSIL1-2).
036100200529      *
036110200529     C           MDOPT5    IFEQ 'Y'
036120200529     C                     MOVE '5'       WWOPT2
036130200529     C                     Z-ADDMOCAPP    WCAPR
036140200529     C                     ELSE
036150200529      *
036160200529      ***  If Rounding Option is 'U' and Options 2, 4, 3 and 5 are not allowed and Option 1 is
036170200529      ***  allowed, default Option for Actual Allocation 2 is '1' and Set Cash % to 100.
036180200529      *
036190200529     C           MDOPT1    IFEQ 'Y'
036200200529     C                     MOVE '1'       WWOPT2
036210200529     C                     Z-ADD100       WCAPR
036220200529     C                     ELSE
036230200529      *
036240200529      ***  If Rounding Option is 'U' and Options 2, 4, 3, 5 and 1 are not allowed, default
036250200529      ***  Option for Actual Allocation 2 is blank.
036260200529      *
036270200529     C                     MOVE ' '       WWOPT2
036280200529     C                     ENDIF
036290200529     C                     ENDIF
036300200529     C                     ENDIF
036310200529     C                     ENDIF
036320200529     C                     ENDIF
036330200529     C                     ENDIF
036340200529      *
036350200529      ***  If Rounding Option from SECOSIL1-2 = 'D' and Option 3 is allowed, default Option for
036360200529      ***  Actual Allocation 2 is '3' (Cash % is already 0).
036370200529      *
036380200529     C           MOROOP    IFEQ 'D'
036390200529     C           MDOPT3    IFEQ 'Y'
036400200529     C                     MOVE '3'       WWOPT2
036410200529     C                     ELSE
036420200529      *
036430200529      ***  If Rounding Option is 'D' and Option 3 is not allowed and Option 4 is allowed, default
036440200529      ***  Option for Actual Allocation 2 is '4' (Cash % is already 0).
036450200529      *
036460200529     C           MDOPT4    IFEQ 'Y'
036470200529     C                     MOVE '4'       WWOPT2
036480200529     C                     ELSE
036490200529      *
036500200529      ***  If Rounding Option is 'D' and Options 3 and 4 are not allowed and Option 2 is allowed,
036510200529      ***  default Option for Actual Allocation 2 is '2' (Cash % is already 0).
036520200529      *
036530200529     C           MDOPT2    IFEQ 'Y'
036540200529     C                     MOVE '2'       WWOPT2
036550200529     C                     ELSE
036560200529      *
036570200529      ***  If Rounding Option is 'D' and Options 3, 4 and 2 are not allowed and Option 5 is allowed,
036580200529      ***  default Option for Actual Allocation 2 is '5' and Set Cash % to Cash Preferred % from
036590200529      ***  Standard Instruction (SECOSIL1-2).
036600200529      *
036610200529     C           MDOPT5    IFEQ 'Y'
036620200529     C                     MOVE '5'       WWOPT2
036630200529     C                     Z-ADDMOCAPP    WCAPR
036640200529     C                     ELSE
036650200529      *
036660200529      ***  If Rounding Option is 'D' and Options 3, 4, 2 and 5 are not allowed and Option 1 is
036670200529      ***  allowed, default Option for Actual Allocation 2 is '1' and Set Cash % to 100.
036680200529      *
036690200529     C           MDOPT1    IFEQ 'Y'
036700200529     C                     MOVE '1'       WWOPT2
036710200529     C                     Z-ADD100       WCAPR
036720200529     C                     ELSE
036730200529      *
036740200529      ***  If Rounding Option is 'D' and Options 3, 4, 2, 5 and 1 are not allowed, default
036750200529      ***  Option for Actual Allocation 2 is blank.
036760200529      *
036770200529     C                     MOVE ' '       WWOPT2
036780200529     C                     ENDIF
036790200529     C                     ENDIF
036800200529     C                     ENDIF
036810200529     C                     ENDIF
036820200529     C                     ENDIF
036830200529     C                     ENDIF
036840200529     C                     ELSE
036850200529      *
036860200529      ***  If Cash % is 100 (means it is Cash Preferred).
036870200529      *
036880200529     C           WCAPR     IFEQ 100
036890200529      *
036900200529      ***  If Option 1 allowed, default Option for Actual Allocation 2 is '1' (Cash % is already
036910200529      ***  100).
036920200529      *
036930200529     C           MDOPT1    IFEQ 'Y'
036940200529     C                     MOVE '1'       WWOPT2
036950200529     C                     ELSE
036960200529      *
036970200529      ***  If Option 1 not allowed and Option 5 allowed, default Option for Actual Allocation 2 is
036980200529      ***  '5' and set Cash % to Cash Preferred % from Standard Instruction (SECOSIL1-2).
036990200529      *
037000200529     C           MDOPT5    IFEQ 'Y'
037010200529     C                     MOVE '5'       WWOPT2
037020200529     C                     Z-ADDMOCAPP    WCAPR
037030200529     C                     ELSE
037040200529      *
037050200529      ***  If Option 1 and 5 not allowed, set Cash % to 0.
037060200529      *
037070200529     C                     Z-ADD0         WCAPR
037080200529     C                     ENDIF
037090200529     C                     ENDIF
037100200529     C                     ENDIF
037110200529     C                     ENDIF
037120200529     C                     ELSE
037130200529      *
037140200529      ***  If Processing Type = Offers (% Accepted = field Cash %).
037150200529      *
037160200529     C           MAPTYP    IFEQ 'OF'
037170200529      *
037180200529      ***  If % Accepted is < 50.
037190200529      *
037200200529     C           WCAPR     IFLT 50
037210200529      *
037220200529      ***  If Option 3 is not allowed, default as per % Accepted is 0.
037230200529      *
037240200529     C           MIOPT3    IFNE 'Y'
037250200529     C                     Z-ADD0         WCAPR
037260200529     C                     ELSE
037270200529      *
037280200529      ***  If Option 3 is allowed and % Accepted is not 0, default Option for Actual Allocation 2 is
037290200529      ***  '3' (% Accepted already = Cash Preferred % from Standard Instruction (SECOSIL1-2)).
037300200529      *
037310200529     C           WCAPR     IFNE 0
037320200529     C                     MOVE '2'       WWOPT2
037330200529     C                     ENDIF
037340200529     C                     ENDIF
037350200529     C                     ELSE
037360200529      *
037370200529      *****If*%*Accepted*is*>*50.**************************************** 135690
037380200529      ***  Else, if % Accepted is > or = 50.                              135690
037390200529      *
037400200529     C******     WCAPR     IFGT 50                                        135690
037410200529      *
037420200529      ***  If Option 3 is not allowed (and % Accepted is > 50), default as per % Accepted is 100.
037430200529      *
037440200529     C           MIOPT3    IFNE 'Y'
037450200529     C                     Z-ADD100       WCAPR
037460200529     C                     ELSE
037470200529      *
037480200529      ***  If Option 3 is allowed and % Accepted is not 100, default Option for Actual Allocation 2
037490200529      ***  is '3' (% Accepted already = Cash Preferred % from Standard Instruction (SECOSIL1-2)).
037500200529      *
037510200529     C           WCAPR     IFNE 100
037520200529     C                     MOVE '3'       WWOPT2
037530200529     C                     ENDIF
037540200529     C                     ENDIF
037550200529     C******               ENDIF                                          135690
037560200529     C                     ENDIF
037570200529      *
037580200529      ***  If % Accepted is 0 (means it is refused).
037590200529      *
037600200529     C           WCAPR     IFEQ 0
037610200529      *
037620200529      ***  If Option 2 allowed, default Option for Actual Allocation 2 is '2' (% Accepted is
037630200529      ***  already 0).
037640200529      *
037650200529     C           MIOPT2    IFEQ 'Y'
037660200529     C           MIOFTY    IFEQ 'E'                                       136935
037670200529     C                     Z-ADD100       WCAPR                           136935
037680200529     C                     ELSE                                           136935
037690200529     C                     Z-ADD0         WCAPR                           136935
037700200529     C                     ENDIF                                          136935
037710200529     C                     MOVE '2'       WWOPT2
037720200529     C                     ELSE
037730200529      *
037740200529      ***  If Option 2 is not allowed and Option 3 is allowed, default Option for Actual Allocation
037750200529      ***  2 is '3' and set % Accepted to Cash Preferred % from Standard Instruction (SECOSIL1-2).
037760200529      *
037770200529     C           MIOPT3    IFEQ 'Y'
037780200529     C                     MOVE '3'       WWOPT2
037790200529     C                     Z-ADDMOCAPP    WCAPR
037800200529     C                     ELSE
037810200529      *
037820200529      ***  If Option 2 and 3 are not allowed and Option 1 is allowed, default Option for Actual
037830200529      ***  Allocation 2 is '1' and set % Accepted to 100.
037840200529      *
037850200529     C           MIOPT1    IFEQ 'Y'
037860200529     C                     MOVE '1'       WWOPT2
037870200529     C           MIOFTY    IFEQ 'E'                                       136935
037880200529     C                     Z-ADD0         WCAPR                           136935
037890200529     C                     ELSE                                           136935
037900200529     C                     Z-ADD100       WCAPR
037910200529     C                     ENDIF                                          136935
037920200529     C                     ELSE
037930200529      *
037940200529      ***  If Option 2, 3 and 1 are not allowed, default Option for Actual Allocation 2 is blank.
037950200529      *
037960200529     C                     MOVE ' '       WWOPT2
037970200529     C                     ENDIF
037980200529     C                     ENDIF
037990200529     C                     ENDIF
038000200529     C                     ELSE
038010200529      *
038020200529      ***  If % Accepted is 100 (means it is Cash Preferred).
038030200529      *
038040200529     C           WCAPR     IFEQ 100
038050200529      *
038060200529      ***  If Option 1 is allowed, default Option for Actual Allocation 2 is '1' (% Accepted is
038070200529      ***  already 100).
038080200529      *
038090200529     C           MIOPT1    IFEQ 'Y'
038100200529     C                     MOVE '1'       WWOPT2
038110200529     C           MIOFTY    IFEQ 'E'                                       136935
038120200529     C                     Z-ADD0         WCAPR                           136935
038130200529     C                     ELSE                                           136935
038140200529     C                     Z-ADD100       WCAPR                           136935
038150200529     C                     ENDIF                                          136935
038160200529     C                     ELSE
038170200529      *
038180200529      ***  If Option 1 is not allowed and Option 3 is allowed, default Option for Actual Allocation
038190200529      ***  2 is '3' and set % Accepted to Cash Preferred % from Standard Instruction (SECOSIL1-2).
038200200529      *
038210200529     C           MIOPT3    IFEQ 'Y'
038220200529     C                     MOVE '3'       WWOPT2
038230200529     C                     Z-ADDMOCAPP    WCAPR
038240200529     C                     ELSE
038250200529      *
038260200529      ***  If Option 1 and 3 are not allowed and Option 2 is allowed, default Option for Actual
038270200529      ***  Allocation 2 is '2' and set % Accepted to 0.
038280200529      *
038290200529     C           MIOPT2    IFEQ 'Y'
038300200529     C                     MOVE '2'       WWOPT2
038310200529     C           MIOFTY    IFEQ 'E'                                       136935
038320200529     C                     Z-ADD100       WCAPR                           136935
038330200529     C                     ELSE                                           136935
038340200529     C                     Z-ADD0         WCAPR
038350200529     C                     ENDIF                                          136935
038360200529     C                     ELSE
038370200529      *
038380200529      ***  If Option 1, 3 and 2 are not allowed, default Option for Actual Allocation is blank.
038390200529      *
038400200529     C                     MOVE ' '       WWOPT2
038410200529     C                     ENDIF
038420200529     C                     ENDIF
038430200529     C                     ENDIF
038440200529     C                     ENDIF
038450200529     C                     ENDIF
038460200529     C                     ELSE
038470200529      *
038480200529      *****If*Processing*Type*=*Rights*Issues*or*Exercices*and*********** 135690
038490200529      *****Conversions.************************************************** 135690
038500200529      ***  If Processing Type = Exercices and Conversions.                135690
038510200529      *
038520200529     C******     MAPTYP    IFEQ 'RG'                                      135690
038530200529     C******     MAPTYP    OREQ 'EX'                                      135690
038540200529     C           MAPTYP    IFEQ 'EX'                                      135690
038550200529      *
038560200529      ***  Set Customer Options 1, 2, 3, 4, 5, 6 and 7, depending on Processing Type.
038570200529      *
038580200529     C******     MAPTYP    IFEQ 'RG'                                      135690
038590200529     C******               MOVE MFOPT1    WUOPT1  1                       135690
038600200529     C******               MOVE MFOPT2    WUOPT2  1                       135690
038610200529     C******               MOVE MFOPT3    WUOPT3  1                       135690
038620200529     C******               MOVE MFOPT4    WUOPT4  1                       135690
038630200529     C******               MOVE MFOPT5    WUOPT5  1                       135690
038640200529     C******               MOVE MFOPT6    WUOPT6  1                       135690
038650200529     C******               MOVE MFOPT7    WUOPT7  1                       135690
038660200529     C******               ELSE                                           135690
038670200529     C******               MOVE MJOPT1    WUOPT1                          135690
038680200529     C******               MOVE MJOPT2    WUOPT2                          135690
038690200529     C******               MOVE MJOPT3    WUOPT3                          135690
038700200529     C******               MOVE MJOPT4    WUOPT4                          135690
038710200529     C******               MOVE MJOPT5    WUOPT5                          135690
038720200529     C******               MOVE MJOPT6    WUOPT6                          135690
038730200529     C******               MOVE MJOPT7    WUOPT7                          135690
038740200529     C                     MOVE MJOPT1    WUOPT1  1                       135690
038750200529     C                     MOVE MJOPT2    WUOPT2  1                       135690
038760200529     C                     MOVE MJOPT3    WUOPT3  1                       135690
038770200529     C                     MOVE MJOPT4    WUOPT4  1                       135690
038780200529     C                     MOVE MJOPT5    WUOPT5  1                       135690
038790200529     C                     MOVE MJOPT6    WUOPT6  1                       135690
038800200529     C                     MOVE MJOPT7    WUOPT7  1                       135690
038810200529     C******               ENDIF                                          135690
038820200529      *
038830200529      ***  If Cash % is < 50.
038840200529      *
038850200529     C           WCAPR     IFLT 50
038860200529      *
038870200529      *****If*Options*5*and*6*are*not*allowed,*default*as*per*Cash*%*is*0.161732
038880200529      ** If Options 5 is not allowed, default as per Cash % is 0.         161732
038890200529      *
038900200529     C           WUOPT5    IFNE 'Y'
038910200529     C***********WUOPT6    ANDNE'Y'                                       161732
038920200529     C                     Z-ADD0         WCAPR
038930200529     C                     ENDIF
038940200529      *
038950200529      *****If*Options*5*and*6*are*allowed*and*Cash*%*is*not*0.*********** 161732
038960200529      ** If either Option 5 or 6 is allowed, and Cash % is not 0          161732
038970200529      *
038980200529     C           WUOPT5    IFEQ 'Y'
038990200529     C           WCAPR     ANDNE0                                         161732
039000200529     C***********WUOPT6    ANDEQ'Y'                                       161732
039010200529     C           WUOPT6    OREQ 'Y'                                       161732
039020200529     C           WCAPR     ANDNE0
039030200529      *
039040200529      ***  If Convertible/Keep Indicator from Standard Instruction (SECOSIL1-2) is 'C', default
039050200529      ***  Option for Actual Allocation 2 is '5' (Cash % already = Cash Preferred % from Standard
039060200529      ***  Instruction (SECOSIL1-2)).
039070200529      *
039080200529     C           MOCKIN    IFEQ 'C'
039090200529     C                     MOVE '5'       WWOPT2
039100200529     C                     ENDIF
039110200529      *
039120200529      ***  If Convertible/Keep Indicator from Standard Instruction (SECOSIL1-2) is 'K', default
039130200529      ***  Option for Actual Allocation 2 is '6' (Cash % already = Cash Preferred % from Standard
039140200529      ***  Instruction (SECOSIL1-2)).
039150200529      *
039160200529     C           MOCKIN    IFEQ 'K'
039170200529     C                     MOVE '6'       WWOPT2
039180200529     C                     ENDIF
039190200529     C                     ENDIF
039200200529     C                     ELSE
039210200529      *
039220200529      *****If*Cash*%*is*>*50.******************************************** 135690
039230200529      ***  Else, if Cash % is > or = 50.                                  135690
039240200529      *
039250200529     C******     WCAPR     IFGT 50                                        135690
039260200529      *
039270200529      *****If*Options*5*and*6*are*not*allowed,*default*as*per*Cash*%*is*  161732
039280200529      ** If Options 5 is not allowed, default as per Cash % is 100.       161732
039290200529      *
039300200529     C           WUOPT5    IFNE 'Y'
039310200529     C***********WUOPT6    ANDNE'Y'                                       161732
039320200529     C                     Z-ADD100       WCAPR
039330200529     C                     ENDIF
039340200529      *
039350200529      ***  If Option 5 and 6 are allowed and Cash % is not 0.
039360200529      *
039370200529     C           WUOPT5    IFEQ 'Y'
039380200529     C           WCAPR     ANDNE100                                       161732
039390200529     C***********WUOPT6    ANDEQ'Y'                                       161732
039400200529     C           WUOPT6    OREQ 'Y'                                       161732
039410200529     C           WCAPR     ANDNE100
039420200529      *
039430200529      ***  If Convertible/Keep Indicator from Standard Instruction (SECOSIL1-2) is 'C', default
039440200529      ***  Option for Actual Allocation 2 is '5' (Cash % already = Cash Preferred % from Standard
039450200529      ***  Instruction (SECOSIL1-2)).
039460200529      *
039470200529     C           MOCKIN    IFEQ 'C'
039480200529     C                     MOVE '5'       WWOPT2
039490200529     C                     ENDIF
039500200529      *
039510200529      ***  If Convertible/Keep Indicator from Standard Instruction (SECOSIL1-2) is 'K', default
039520200529      ***  Option for Actual Allocation 2 is '6' (Cash % already = Cash Preferred % from Standard
039530200529      ***  Instruction (SECOSIL1-2)).
039540200529      *
039550200529     C           MOCKIN    IFEQ 'K'
039560200529     C                     MOVE '6'       WWOPT2
039570200529     C                     ENDIF
039580200529     C                     ENDIF
039590200529     C******               ENDIF                                          135690
039600200529     C                     ENDIF
039610200529      *
039620200529      ***  If Cash % is 0 (means it is Stock Preferred).
039630200529      *
039640200529     C           WCAPR     IFEQ 0
039650200529      *
039660200529      ***  If Convertible/Keep Indicator from Standard Instruction (SECOSIL1-2) is 'K'
039670200529      *
039680200529     C           MOCKIN    IFEQ 'K'
039690200529      *
039700200529      ***  If Option 7 is allowed, default Option for Actual Allocation is '7' (Cash % already
039710200529      ***  = 0).
039720200529      *
039730200529     C           WUOPT7    IFEQ 'Y'
039740200529     C                     MOVE '7'       WWOPT2
039750200529     C                     ENDIF
039760200529     C                     ENDIF
039770200529      *
039780200529      ***  If Convertible/Keep Indicator from Standard Instruction (SECOSIL1-2) is 'C'
039790200529      *
039800200529     C           MOCKIN    IFEQ 'C'
039810200529      *
039820200529      ***  If Rounding Option from Standard Instruction (SECOSIL1-2) is 'U'.
039830200529      *
039840200529     C           MOROOP    IFEQ 'U'
039850200529      *
039860200529      ***  If Rounding Option from Standard Instruction (SECOSIL1-2) is 'U' and Option 2 is allowed,
039870200529      ***  default Option for Actual Allocation 2 is '2' (Cash % already = 0).
039880200529      *
039890200529     C           WUOPT2    IFEQ 'Y'
039900200529     C                     MOVE '2'       WWOPT2
039910200529     C                     ELSE
039920200529      *
039930200529      ***  If Rounding Option from Standard Instruction (SECOSIL1-2) is 'U' and Option 2 is not
039940200529      ***  allowed and Option 4 is allowed, default Option for Actual Allocation 2 is '4'
039950200529      ***  (Cash % already = 0).
039960200529      *
039970200529     C           WUOPT4    IFEQ 'Y'
039980200529     C                     MOVE '4'       WWOPT2
039990200529     C                     ELSE
040000200529      *
040010200529      ***  If Rounding Option from Standard Instruction (SECOSIL1-2) is 'U' and Options 2 and 4 are
040020200529      ***  not allowed and Option 3 is allowed, default Option for Actual Allocation 2 is '3'
040030200529      ***  (Cash % already = 0).
040040200529      *
040050200529     C           WUOPT3    IFEQ 'Y'
040060200529     C                     MOVE '3'       WWOPT2
040070200529     C                     ELSE
040080200529      *
040090200529      ***  If Rounding Option from Standard Instruction (SECOSIL1-2) is 'U' and Options 2, 4 and 3
040100200529      ***  are not allowed and Option 5 is allowed, default Option for Actual Allocation 2 is '5'
040110200529      ***  and set Cash % to Cash Preferred % from Standard Instruction (SECOSIL1-2).
040120200529      *
040130200529     C           WUOPT5    IFEQ 'Y'
040140200529     C                     MOVE '5'       WWOPT2
040150200529     C                     Z-ADDMOCAPP    WCAPR
040160200529     C                     ELSE
040170200529      *
040180200529      ***  If Rounding Option from Standard Instruction (SECOSIL1-2) is 'U' and Options 2, 4, 3 and
040190200529      ***  5 are not allowed and Option 1 is allowed, default Option for Actual Allocation 2 is '1'
040200200529      ***  and set Cash % to 100.
040210200529      *
040220200529     C           WUOPT1    IFEQ 'Y'
040230200529     C                     MOVE '1'       WWOPT2
040240200529     C                     Z-ADD100       WCAPR
040250200529     C                     ELSE
040260200529      *
040270200529      ***  If Rounding Option from Standard Instruction (SECOSIL1-2) is 'U' and Options 2, 4, 3, 5
040280200529      ***  and 1 are not allowed, default Option for Actual Allocation 2 is blank.
040290200529      *
040300200529     C                     MOVE ' '       WWOPT2
040310200529     C                     ENDIF
040320200529     C                     ENDIF
040330200529     C                     ENDIF
040340200529     C                     ENDIF
040350200529     C                     ENDIF
040360200529     C                     ENDIF
040370200529      *
040380200529      ***  If Rounding Option from Standard Instruction (SECOSIL1-2) is 'D'.
040390200529      *
040400200529     C           MOROOP    IFEQ 'D'
040410200529      *
040420200529      ***  If Rounding Option from Standard Instruction (SECOSIL1-2) is 'D' and Option 3 is allowed,
040430200529      ***  default Option for Actual Allocation 2 is '3' (Cash % already = 0).
040440200529      *
040450200529     C           WUOPT3    IFEQ 'Y'
040460200529     C                     MOVE '3'       WWOPT2
040470200529     C                     ELSE
040480200529      *
040490200529      ***  If Rounding Option from Standard Instruction (SECOSIL1-2) is 'D' and Option 3 is not
040500200529      ***  allowed and Option 4 is allowed, default Option for Actual Allocation is '4' (Cash %
040510200529      ***  already = 0).
040520200529      *
040530200529     C           WUOPT4    IFEQ 'Y'
040540200529     C                     MOVE '4'       WWOPT2
040550200529     C                     ELSE
040560200529      *
040570200529      ***  If Rounding Option from Standard Instruction (SECOSIL1-2) is 'D' and Options 3 and 4 are
040580200529      ***  not allowed and Option 2 is allowed, default Option for Actual Allocation is '2' (Cash %
040590200529      ***  already = 0).
040600200529      *
040610200529     C           WUOPT2    IFEQ 'Y'
040620200529     C                     MOVE '2'       WWOPT2
040630200529     C                     ELSE
040640200529      *
040650200529      ***  If Rounding Option from Standard Instruction (SECOSIL1-2) is 'D' and Options 3, 4 and 2
040660200529      ***  are not allowed and Option 5 is allowed, default Option for Actual Allocation 2 is '5'
040670200529      ***  and set Cash % to Cash Preferred % from Standard Instruction (SECOSIL1-2).
040680200529      *
040690200529     C           WUOPT5    IFEQ 'Y'
040700200529     C                     MOVE '5'       WWOPT2
040710200529     C                     Z-ADDMOCAPP    WCAPR
040720200529     C                     ELSE
040730200529      *
040740200529      ***  If Rounding Option from Standard Instruction (SECOSIL1-2) is 'D' and Options 3, 4, 2 and
040750200529      ***  5 are not allowed and Option 1 is allowed, default Option for Actual Allocation is '1'
040760200529      ***  and set Cash % to 100.
040770200529      *
040780200529     C           WUOPT1    IFEQ 'Y'
040790200529     C                     MOVE '1'       WWOPT2
040800200529     C                     Z-ADD100       WCAPR
040810200529     C                     ELSE
040820200529      *
040830200529      ***  If Rounding Option from Standard Instruction (SECOSIL1-2) is 'D' and Options 3, 4, 2, 5
040840200529      ***  and 1 are not allowed, default Option for Actual Allocation is blank.
040850200529      *
040860200529     C                     MOVE ' '       WWOPT2
040870200529     C                     ENDIF
040880200529     C                     ENDIF
040890200529     C                     ENDIF
040900200529     C                     ENDIF
040910200529     C                     ENDIF
040920200529     C                     ENDIF
040930200529     C                     ENDIF
040940200529     C                     ELSE
040950200529      *
040960200529      ***  If Cash % is 100 (means it is Cash Preferred).
040970200529      *
040980200529     C           WCAPR     IFEQ 100
040990200529      *
041000200529      ***  If Option 1 is allowed, default Option for Actual Allocation 2 is '1' (Cash % already
041010200529      ***  = 100).
041020200529      *
041030200529     C           WUOPT1    IFEQ 'Y'
041040200529     C                     MOVE '1'       WWOPT2
041050200529     C                     ELSE
041060200529      *
041070200529      ***  If Option 1 is not allowed, default as per Cash % is 0.
041080200529      *
041090200529     C                     Z-ADD0         WCAPR
041100200529     C                     ENDIF
041110200529     C                     ENDIF
041120200529     C                     ENDIF
041130200529     C                     ENDIF
041140200529     C                     ENDIF
041150200529     C                     ENDIF
041160200529     C                     ENDIF
041170200529      *
041180200529      ***  CASE 2.2: IF Customer/Book Standard Corporate Action Instruction does not exist
041190200529      ***               (and Customer/Book Current Reply does not exist),
041200200529      ***            OR if Customer/Book Standard Corporate Action Instruction exist BUT default
041210200529      ***               Option (Option for Actual Allocation 2 calculated in CASE 2.1 or retrieve
041220200529      ***               from Standard Instruction (SECOSIL1-2) in CASE 2) is blank (and Customer/
041230200529      ***               Book Current Reply does not exist).
041240200529      *
041250200529     C           EXBCSI    IFEQ 'N'
041260200529     C           EXBCSI    OREQ 'Y'
041270200529     C           WWOPT2    ANDEQ' '
041280200529      *
041290200529      ***  Set Option for Actual Allocation 2 to Default for No Reply from Corporate Actions
041300200529      ***  Detail (SECOxxL1, where xx = 'DV', 'RG', 'OF' or 'EX')
041310200529      *
041320200529     C                     MOVE MDDFNR    WWOPT2
041330200529      *
041340200529      ***  If Processing Type = Dividends Events.
041350200529      *
041360200529     C           MAPTYP    IFEQ 'DV'
041370200529      *
041380200529      ***  If Option 1 selected: Cash Payment/Sell Rights, set Cash % to 100.
041390200529      *
041400200529     C           WWOPT2    IFEQ '1'
041410200529     C                     Z-ADD100       WCAPR
041420200529     C                     ELSE
041430200529      *
041440200529      ***  If Option selected is 2: Take Stock+Buy Additional Rights or 3: Take Stock+Sell Excess
041450200529      ***  Rights or 4: Take Stock, set Cash % to 0.
041460200529      *
041470200529     C           WWOPT2    IFEQ '2'
041480200529     C           WWOPT2    OREQ '3'
041490200529     C           WWOPT2    OREQ '4'
041500200529     C                     Z-ADD0         WCAPR
041510200529     C                     ELSE
041520200529      *
041530200529      ***  Else, Default No Reply will not be an Option which requires the entry of the %).
041540200529      *
041550200529     C                     MOVE ' '       WWOPT2
041560200529     C                     ENDIF
041570200529     C                     ENDIF
041580200529     C                     ELSE
041590200529      ******                                                              135690
041600200529      *****If*Processing*Type*=*Rights*Issues.*************************** 135690
041610200529      ******                                                              135690
041620200529     C******     MAPTYP    IFEQ 'RG'                                      135690
041630200529      ******                                                              135690
041640200529      *****If*Option*1*selected:*Sell*all*Rights,*set*Cash*%*to*100.***** 135690
041650200529      ******                                                              135690
041660200529     C******     WWOPT2    IFEQ '1'                                       135690
041670200529     C******               Z-ADD100       WCAPR                           135690
041680200529     C******               ELSE                                           135690
041690200529      ******                                                              135690
041700200529      *****If*Option*selected*is*2:*Take*Stock+Buy*Fraction*or*3:*Take*** 135690
041710200529      *****Stock+Sell*Fraction*or*4:*Take*Stock*or*7:*Do*nothing,*set**** 135690
041720200529      *****Cash*%*to*0.************************************************** 135690
041730200529      ******                                                              135690
041740200529     C******     WWOPT2    IFEQ '2'                                       135690
041750200529     C******     WWOPT2    OREQ '3'                                       135690
041760200529     C******     WWOPT2    OREQ '4'                                       135690
041770200529     C******     WWOPT2    OREQ '7'                                       135690
041780200529     C******               Z-ADD0         WCAPR                           135690
041790200529     C******               ELSE                                           135690
041800200529      ******                                                              135690
041810200529      *****Else,*Default*No*Reply*will*not*be*an*Option*which*requires*** 135690
041820200529      *****the*entry*of*the*%).****************************************** 135690
041830200529      ******                                                              135690
041840200529     C******               MOVE ' '       WWOPT2                          135690
041850200529     C******               ENDIF                                          135690
041860200529     C******               ENDIF                                          135690
041870200529     C******               ELSE                                           135690
041880200529      *
041890200529      ***  If Processing Type = Offers.
041900200529      *
041910200529     C           MAPTYP    IFEQ 'OF'
041920200529      *
041930200529      ***  If Option 1 selected: Accept Offer, set Cash % to 100.
041940200529      *
041950200529     C           WWOPT2    IFEQ '1'
041960200529     C           MIOFTY    IFEQ 'E'                                       136935
041970200529     C                     Z-ADD0         WCAPR                           136935
041980200529     C                     ELSE                                           136935
041990200529     C                     Z-ADD100       WCAPR
042000200529     C                     ENDIF                                          136935
042010200529     C                     ELSE
042020200529      *
042030200529      ***  If Option 2 selected: Refuse Offer, set Cash % to 0.
042040200529      *
042050200529     C           WWOPT2    IFEQ '2'
042060200529     C           MIOFTY    IFEQ 'E'                                       136935
042070200529     C                     Z-ADD100       WCAPR                           136935
042080200529     C                     ELSE                                           136935
042090200529     C                     Z-ADD0         WCAPR
042100200529     C                     ENDIF                                          136935
042110200529     C                     ELSE
042120200529      *
042130200529      ***  Else, Default No Reply will not be an Option which requires the entry of the %).
042140200529      *
042150200529     C                     MOVE ' '       WWOPT2
042160200529     C                     ENDIF
042170200529     C                     ENDIF
042180200529     C                     ELSE
042190200529      *
042200200529      ***  If Processing Type = Exercices and Conversions.
042210200529      *
042220200529     C           MAPTYP    IFEQ 'EX'
042230200529      *
042240200529      ***  If Option 1 selected: Sell all Rights, set Cash % to 100.
042250200529      *
042260200529     C           WWOPT2    IFEQ '1'
042270200529     C                     Z-ADD100       WCAPR
042280200529     C                     ELSE
042290200529      *
042300200529      *****If*Option*selected*is*2:*Take*Stock+Buy*Fraction*or*3:*Take St 161732
042310200529      *****Take*Stock*or*7:*Do*nothing,*set*Cash*%*to*0.***************** 161732
042320200529      ** If Option selected is 2: Take Stock+Buy Fraction or 3: Take      161732
042330200529      ** Stock+Sell Fraction or 4: Take Stock or 6: Take Part Stock+      161732
042340200529      ** Keep Rest or 7: Do nothing, set Cash % to 0.                     161732
042350200529      *
042360200529     C           WWOPT2    IFEQ '2'
042370200529     C           WWOPT2    OREQ '3'
042380200529     C           WWOPT2    OREQ '4'
042390200529     C           WWOPT2    OREQ '6'                                       161732
042400200529     C           WWOPT2    OREQ '7'
042410200529     C                     Z-ADD0         WCAPR
042420200529     C                     ELSE
042430200529      *
042440200529      ***  Else, Default No Reply will not be an Option which requires the entry of the %).
042450200529      *
042460200529     C                     MOVE ' '       WWOPT2
042470200529     C                     ENDIF
042480200529     C                     ENDIF
042490200529     C                     ENDIF
042500200529     C                     ENDIF
042510200529     C                     ENDIF
042520200529     C                     ENDIF
042530200529     C******               ENDIF                                          135690
042540200529     C                     ENDIF
042550200529      *
042560200529      ***  If Option not selected, set Cash % to 0 and 'Special Work Field' to 'N', it means that
042570200529      ***  the Actual Allocation fields must not be calculated.
042580200529      *
042590200529     C           WWOPT2    IFEQ ' '
042600200529     C                     Z-ADD0         WCAPR
042610200529     C                     MOVE 'N'       SPWRKF
042620200529     C                     ENDIF
042630200529     C                     ENDIF
042640200529      *
042650200529     C                     ENDSR
042660200529      *
042670200529      *****************************************************************
042680200529      /EJECT
042690200529      *****************************************************************
042700200529      *                                                               *
042710200529      * RTVRPL - Retrieve Customer/Book Current Reply and Customer/   *
042720200529      *          Book Standard Corporate Action Instruction.          *
042730200529      *                                                               *
042740200529      * Called by:                                                    *
042750200529      *                                                               *
042760200529      * Calls:                                                        *
042770200529      *                                                               *
042780200529      *****************************************************************
042790200529      *
042800200529     C           RTVRPL    BEGSR                           ** RTVRPL SR **
042810200529      *
042820200529      ***  Set 'Customer/Book Current Reply Exists' work field to 'N'.
042830200529      *
042840200529     C                     MOVE 'N'       EXBCRE  1        Current Reply exist
042850200529      *
042860200529      ***  Retrieve current Reply with CO Reference, Branch, Customer/Book Indicator, Book and
042870200529      ***  Customer.
042880200529      *
042890200529     C           @KEY6     SETGTSECOREL0
042900200529     C           @KEY6     REDPESECOREL0                 82
042910200529      *
042920200529      ***  If record found and live.
042930200529      *
042940200529     C           *IN82     IFEQ '0'                        Found
042950200529     C           MQRECI    ANDEQ'D'                        Live
042960200529      *
042970200529      ***  If SR called from Customer Calculation, set 'Customer Reply Exists' work field to 'Y'.
042980200529      *
042990200529     C           FROMBC    IFEQ 'C'
043000200529     C                     MOVE 'Y'       CUSRPL
043010200529     C                     ENDIF
043020200529      *
043030200529      ***  Set 'Customer/Book Current Reply Exists' work field to 'Y'.
043040200529      *
043050200529     C                     MOVE 'Y'       EXBCRE
043060200529     C                     ENDIF
043070200529      *
043080200529      ***  Set 'Customer/Book Standard CO Instruction Exists' work field to 'N'.
043090200529      *
043100200529     C                     MOVE 'N'       EXBCSI  1        Standard Instruction exist
043110200529      *
043120200529      ***  If SR called from Book Calculation.
043130200529      *
043140200529     C           FROMBC    IFEQ 'B'
043150200529      *
043160200529      ***  Retrieve the Standard Instructions for Books by accessing LF/SECOSIL2 with Branch
043170200529      ***  (parameter), Book from SEUDEPL0, Corporate Action Type and Security Shortname received
043180200529      ***  as parameter.
043190200529      *
043200200529     C                     MOVE WWUDBK    KUDBK
043210200529     C                     MOVE MACOAT    KCOAT
043220200529     C                     MOVE MASESN    KSESN
043230200529     C           @KEY7     SETGTSECOSIL2
043240200529     C           @KEY7     REDPESECOSIL2                 83
043250200529      *
043260200529      ***  If no record found, access with Branch (parameter), Book from SEUDEPL0, Corporate
043270200529      ***  Action Type received as parameter and Security = blank.
043280200529      *
043290200529     C           *IN83     IFEQ '1'
043300200529     C           MORECI    ORNE 'D'
043310200529     C                     MOVE *BLANKS   KSESN
043320200529     C           @KEY7     SETGTSECOSIL2
043330200529     C           @KEY7     REDPESECOSIL2                 83
043340200529      *
043350200529      ***  If no record found, access with Branch (parameter), Book from SEUDEPL0 and Corporate
043360200529      ***  Action Type and Security = blank.
043370200529      *
043380200529     C           *IN83     IFEQ '1'
043390200529     C           MORECI    ORNE 'D'
043400200529     C                     MOVE *BLANKS   KCOAT
043410200529     C           @KEY7     SETGTSECOSIL2
043420200529     C           @KEY7     REDPESECOSIL2                 83
043430200529      *
043440200529      ***  If no record found, access with Branch (parameter) and Book, Corporate Action Type and
043450200529      ***  Security = blank.
043460200529      *
043470200529     C           *IN83     IFEQ '1'
043480200529     C           MORECI    ORNE 'D'
043490200529     C                     MOVE *BLANKS   KUDBK
043500200529     C           @KEY7     SETGTSECOSIL2
043510200529     C           @KEY7     REDPESECOSIL2                 83
043520200529     C                     ENDIF
043530200529     C                     ENDIF
043540200529     C                     ENDIF
043550200529      *
043560200529      ***  If SR called from Customer Calculation.
043570200529      *
043580200529     C                     ELSE
043590200529      *
043600200529      ***  Retrieve the Standard Instructions for Customer by accessing LF/SECOSIL1 with Branch
043610200529      ***  (parameter), Customer and Portfolio Reference from SECDEPL4, Corporate Action Type and
043620200529      ***  Security Shortname received as parameter.
043630200529      *
043640200529     C**********           Z-ADDWWCDCN    KCDCN                                               CSD027
043650200529     C                     MOVE WWCDCN    KCDCN                                               CSD027
043660200529     C                     MOVE WWPTFR    KPTFR
043670200529     C                     MOVE MACOAT    KCOAT
043680200529     C                     MOVE MASESN    KSESN
043690200529     C           @KEY9     SETGTSECOSIL1
043700200529     C           @KEY9     REDPESECOSIL1                 83
043710200529      *
043720200529      ***  If no record found, access with Brancg (parameter), Customer and Portfolio Reference from
043730200529      ***  SECDEPL4, Corporate Action Type received as parameter and Security = blank.
043740200529      *
043750200529     C           *IN83     IFEQ '1'
043760200529     C           MORECI    ORNE 'D'
043770200529     C                     MOVE *BLANKS   KSESN
043780200529     C           @KEY9     SETGTSECOSIL1
043790200529     C           @KEY9     REDPESECOSIL1                 83
043800200529      *
043810200529      ***  If no record found, access with Branch (parameter), Customer and Portfolio Reference from
043820200529      ***  SECDEPL4 and Corporate Action Type and Security = blank.
043830200529      *
043840200529     C           *IN83     IFEQ '1'
043850200529     C           MORECI    ORNE 'D'
043860200529     C                     MOVE *BLANKS   KCOAT
043870200529     C           @KEY9     SETGTSECOSIL1
043880200529     C           @KEY9     REDPESECOSIL1                 83
043890200529      *
043900200529      ***  If no record found, access with Branch (parameter), Customer from SECDEPL4 and Portfolio
043910200529      ***  Reference, Corporate Action Type and Security = blank.
043920200529      *
043930200529     C           *IN83     IFEQ '1'
043940200529     C           MORECI    ORNE 'D'
043950200529     C                     MOVE *BLANKS   KPTFR
043960200529     C           @KEY9     SETGTSECOSIL1
043970200529     C           @KEY9     REDPESECOSIL1                 83
043980200529      *
043990200529      ***  If no record found, access with Branch (parameter), Customer = 0 and Porfolio Reference,
044000200529      ***  Corporate Action Type and Security = blank.
044010200529      *
044020200529     C           *IN83     IFEQ '1'
044030200529     C           MORECI    ORNE 'D'
044040200529     C**********           Z-ADD*ZEROS    KCDCN                                               CSD027
044050200529     C                     MOVE *BLANKS   KCDCN                                               CSD027
044060200529     C           @KEY9     SETGTSECOSIL1
044070200529     C           @KEY9     REDPESECOSIL1                 83
044080200529     C                     ENDIF
044090200529     C                     ENDIF
044100200529     C                     ENDIF
044110200529     C                     ENDIF
044120200529     C                     ENDIF
044130200529      *
044140200529      ***  If Standard Corporate Actions Instruction exists (record found with one of the access).
044150200529      *
044160200529     C           *IN83     IFEQ '0'
044170200529     C           MORECI    ANDEQ'D'
044180200529      *
044190200529      ***  Set 'Customer/Booh Standard Instruction Exists' work field to 'Y'.
044200200529      *
044210200529     C                     MOVE 'Y'       EXBCSI
044220200529     C                     ENDIF
044230200529      *
044240200529     C                     ENDSR
044250200529      *
044260200529      *****************************************************************
044270200529      /EJECT
044280200529      *****************************************************************
044290200529      *                                                               *
044300200529      * CALLOC - Calculate Allocations:                               *
044310200529      *            - Original Stock Allocation                        *
044320200529      *            - True Stock Allocation                            *
044330200529      *            - Original Stock Rounding                          *
044340200529      *            - Original Cask Rounding.                          *
044350200529      *                                                               *
044360200529      * Called by:                                                    *
044370200529      *                                                               *
044380200529      * Calls:                                                        *
044390200529      *                                                               *
044400200529      *****************************************************************
044410200529      *
044420200529     C           CALLOC    BEGSR                           ** CALLOC SR **
044430200529      *
044440200529      ***  Reset work fields.
044450200529      *
044460200529     C                     Z-ADD0         WWOALR 309       Original Stock Allocation
044470200529     C                     Z-ADD0         WWOTSA 309       True Stock Allocation
044480200529     C                     Z-ADD0         WWOSTR 309       Original Stock Rounding
044490200529     C                     Z-ADD0         WWOCAR 309       Original Cash Rounding
044500200529      *
044510200529      *****If*Processing*Type*=*Capital*Change,*Offers*with*Offer*Type*=* 136935
044520200529      *****Purchase*Offer*or*Non*Financial*Events,*********************** 136935
044530200529      ***  If Processing Type = Capital Change or Non Financial Events,   136935
044540200529      ***  some fields must not be calculated.
044550200529      *
044560200529     C           MAPTYP    IFEQ 'CE'                       Capital Change
044570200529     C******     MAPTYP    OREQ 'OF'                       Purchase Offer 136935
044580200529     C******     MIOFTY    ANDEQ'P'                                       136935
044590200529     C           MAPTYP    OREQ 'NF'                       Non Financial Events
044600200529     C                     Z-ADD0         WWOALR           Original Stock Allocation
044610200529     C                     Z-ADD0         WWOTSA           True Stock Allocation
044620200529     C                     Z-ADD0         WWOSTR           Original Stock Rounding
044630200529     C                     Z-ADD0         WWOCAR           Original Cash Rounding
044640200529     C                     ENDIF
044650200529      *
044660200529      ***  If Processing Type = 'NC': Name Changes, set Original Stock Rounding and Original
044670200529      ***  Cash Rounding to 0.
044680200529      *
044690200529     C           MAPTYP    IFEQ 'NC'
044700200529     C                     Z-ADD0         WWOSTR           Original Stock Rounding
044710200529     C                     Z-ADD0         WWOCAR           Original Cash Rounding
044720200529      *
044730200529      ***  If Security Shortname changed, set Original Stock Allocation and True Stock Allocation
044740200529      ***  to Current Holding (= Ex-Date Position), otherwise set thoses 2 fields to 0.
044750200529      *
044760200529     C           MASESN    IFNE MDNSEC
044770200529     C                     Z-ADDWWTDVD    WWOALR           Original Stock Allocation
044780200529      *
044790200529      ***  Set Original Stock Allocation calculated.
044800200529      *
044810200529     C                     Z-ADDNSNBDP    WWNBDP           New Security Decimal Places
044820200529     C                     MOVE WWRNDN    WUROOP           Rounding from CO Detail file
044830200529     C                     Z-ADDWWOALR    WWNUM
044840200529     C                     EXSR ROUNDD
044850200529     C                     Z-ADDWWNUM     WWOALR
044860200529      *
044870200529     C                     Z-ADDWWTDVD    WWOTSA           True Stock Allocation
044880200529      *
044890200529      ***  Set True Stock Allocation calculated.
044900200529      *
044910200529     C                     Z-ADDNSNBDP    WWNBDP           New Security Decimal Places
044920200529     C                     Z-ADD8         WWNBDP           Decimal Places = 8
044930200529     C                     Z-ADDWWOTSA    WWNUM
044940200529     C                     EXSR ROUNDD
044950200529     C                     Z-ADDWWNUM     WWOTSA
044960200529     C                     ELSE
044970200529     C                     Z-ADD0         WWOALR           Original Stock Allocation
044980200529     C                     Z-ADD0         WWOTSA           True Stock Allocation
044990200529     C                     ENDIF
045000200529     C                     ENDIF
045010200529      *
045020200529     C           MAPTYP    IFEQ 'DV'                       If Processing Type = Dividends Events
045030200529     C           MDSDIT    ANDEQ'S'                           Stock Dividend Type = Stock for Stock
045040200529     C           MDOSHA    ANDNE0                             Number of Old Shares not zero
045050200529     C           WWNSHA    ANDNE0                             Number of New Shares not zero
045060200529      *
045070200529     C           MAPTYP    OREQ 'DV'                       Or Processing Type = Dividends Events
045080200529     C           MDSDIT    ANDEQ'C'                           Stk Dividend Tp=Combined for Cash&Stk
045090200529     C           MDOSHA    ANDNE0                             Number of Old Shares not zero
045100200529     C           WWNSHA    ANDNE0                             Number of New Shares not zero
045110200529      *
045120200529     C           MAPTYP    OREQ 'DV'                       Or Processing Type = Dividends Events
045130200529     C           MDSDIT    ANDEQ'O'                           Stk Dividend Tp=Optional for Cash&Stk
045140200529     C           MDOSHA    ANDNE0                             Number of Old Shares not zero
045150200529     C           WWNSHA    ANDNE0                             Number of New Shares not zero
045160200529      *
045170200529     C           MAPTYP    OREQ 'CR'                       Or Proces.Type = Corporate Reorganisation
045180200529     C           MDOSHA    ANDNE0                             Number of Old Shares not zero
045190200529     C           WWNSHA    ANDNE0                             Number of New Shares not zero
045200200529      *
045210200529     C           MAPTYP    OREQ 'OF'                       Or Processing Type = Offers
045220200529     C           MIOFTY    ANDEQ'E'                           Offer Type = Exchange Offers
045230200529     C           MDOSHA    ANDNE0                             Number of Old Shares not zero
045240200529     C           WWNSHA    ANDNE0                             Number of New Shares not zero
045250200529      *
045260200529     C           MAPTYP    OREQ 'OF'                       Or Processing Type = Offers
045270200529     C           MIOFTY    ANDEQ'S'                           Offer Type = Subsrciption Offer
045280200529     C           MDOSHA    ANDNE0                             Number of Old Shares not zero
045290200529     C           WWNSHA    ANDNE0                             Number of New Shares not zero
045300200529      *                                                                   136935
045310200529     C           MAPTYP    OREQ 'OF'                       Or Purchase    136935
045320200529     C           MIOFTY    ANDEQ'P'                           Offer       136935
045330200529     C           MDOSHA    ANDNE0                             Old Shr <>0 136935
045340200529     C           WWNSHA    ANDNE0                             New Shr <>0 136935
045350200529      *
045360200529     C           MAPTYP    OREQ 'EX'                       Or Proces.Type= Exercices and Conversion
045370200529     C           MDOSHA    ANDNE0                             Number of Old Shares not zero
045380200529     C           WWNSHA    ANDNE0                             Number of New Shares not zero
045390200529     C*****      MDSBPR    ANDNE0                             Subscription136935
045400200529      *
045410200529     C           MAPTYP    OREQ 'FR'                       Or Processing Type = Free Allocation
045420200529     C           MDOSHA    ANDNE0                             Number of Old Shares not zero
045430200529     C           WWNSHA    ANDNE0                             Number of New Shares not zero
045440200529      *
045450200529     C           MAPTYP    OREQ 'RG'                       Or Processing Type = Rights Issues
045460200529     C           MDOSHA    ANDNE0                             Number of Old Shares not zero
045470200529     C           WWNSHA    ANDNE0                             Number of New Shares not zero
045480200529      *                                                                   CEU017
045490200529      ***  Or Processing Type = Currency Changes and Old and New Nominal  CEU017
045500200529      ***  Size not zero.                                                 CEU017
045510200529      *                                                                   CEU017
045520200529     C           MAPTYP    OREQ 'CC'                                      CEU017
045530200529     C           MDOSHA    ANDNE0                                         CEU017
045540200529     C           WWNSHA    ANDNE0                                         CEU017
045550200529      *
045560200529      ***  Calculate Original Stock Allocation.
045570200529      *
045580200529     C                     EXSR COSA1
045590200529      *
045600200529      ***  Calculate True Stock Allocation.
045610200529      *
045620200529     C                     EXSR CTSA1
045630200529      *
045640200529      ***  Calculate Original Stock Rounding.
045650200529      *
045660200529     C                     EXSR COSR1
045670200529      *
045680200529      ***  Calculate Original Cash Rounding.
045690200529      *
045700200529     C                     EXSR COCR1
045710200529      *
045720200529     C                     ENDIF
045730200529      *
045740200529     C           MAPTYP    IFEQ 'DV'                       If Processing Type = Dividends Events
045750200529     C           MDSDIT    ANDEQ'S'                           Stock Dividend Type = Stock for Stock
045760200529     C********** MDDIVU    ANDNE0                             Dividend per Unit not zero      190204
045770200529     C           MDDIV1    ANDNE0                             Dividend per Unit not zero      190204
045780200529     C           MDSBPR    ANDNE0                             Subscription Price not zero
045790200529      *
045800200529     C           MAPTYP    OREQ 'DV'                       Or Processing Type = Dividends Events
045810200529     C           MDSDIT    ANDEQ'R'                           Stk Dividend Tp=Reinvestment of Divid.
045820200529     C********** MDDIVU    ANDNE0                             Dividend per Unit not zero      190204
045830200529     C           MDDIV1    ANDNE0                             Dividend per Unit not zero      190204
045840200529     C           MDSBPR    ANDNE0                             Subscription Price not zero
045850200529      *
045860200529     C           MAPTYP    OREQ 'DV'                       If Processing Type = Div Events    215071
045870200529     C           MDSDIT    ANDEQ'O'                           Stock Div Tp=Opt for cash stock 215071
045880200529     C           MDDIV1    ANDNE0                             Dividend per Unit not zero      215071
045890200529     C           MDSBPR    ANDNE0                             Subscription Price not zero     215071
045900200529      *                                                                                       215071
045910200529     C           MAPTYP    OREQ 'EX'                       Or Proces.Type= Exercices and Conversion
045920200529     C           MJCPRC    ANDNE0                             Conversion Price not zero
045930200529     C           MJCEXR    ANDNE0                             Exchange Rate not zero
045940200529     C           MDSBPR    ANDNE0                             Subscription Price not zero
045950200529      *
045960200529      ***  Calculate Original Stock Allocation.
045970200529      *
045980200529     C                     EXSR COSA2
045990200529      *
046000200529      ***  Calculate True Stock Allocation.
046010200529      *
046020200529     C                     EXSR CTSA2
046030200529      *
046040200529      ***  Calculate Original Stock Rounding.
046050200529      *
046060200529     C                     EXSR COSR2
046070200529      *
046080200529      ***  Calculate Original Cash Rounding.
046090200529      *
046100200529     C                     EXSR COCR2
046110200529      *
046120200529     C                     ENDIF
046130200529      *
046140200529      ***  Accumulate Original Cash Rounding calculated.
046150200529      *
046160200529     C                     ADD  WWOCAR    WTOCAR 309
046170200529      *
046180200529     C                     ENDSR
046190200529      *
046200200529      *****************************************************************
046210200529      /EJECT
046220200529      *****************************************************************
046230200529      *                                                               *
046240200529      * CALBC  - Calculate other Book/Customer Allocations.           *
046250200529      *                                                               *
046260200529      * Called by:                                                    *
046270200529      *                                                               *
046280200529      * Calls:                                                        *
046290200529      *                                                               *
046300200529      *****************************************************************
046310200529      *
046320200529     C           CALBC     BEGSR                           ** CALBC SR **
046330200529      *
046340200529      ***  Reset work fields.
046350200529      *
046360200529     C                     Z-ADD0         WWASTA 309       Actual Stock Allocation
046370200529     C                     Z-ADD0         WWASTR 309       Actual Stock Rounding
046380200529     C                     Z-ADD0         WWACAR 309       Actual Cash Rounding
046390200529     C                     Z-ADD0         WWHOST 309       Holding Taken as Stock
046400200529     C                     Z-ADD0         WWHOCA 309       Holding Taken as Cash
046410200529     C                     Z-ADD0         ACCAPO 309       Actual Cash Pool for Book/Customer
046420200529     C                     Z-ADD0         WUHOST 309       Holding Taken as Stock saved
046430200529     C                     Z-ADD0         WUHOCA 309       Holding Taken as Cash saved
046440200529      *                                                                   153729
046450200529     C           MAPTYP    IFEQ 'NC'                       Name Changes   153729
046460200529     C                     Z-ADDWWOALR    WWASTA           Actual Stock   153729
046470200529     C                     ENDIF                                          153729
046480200529      *
046490200529      ***  If Special work field equal 'Y', it means the Actual Allocation fields must be
046500200529      ***  calculated.
046510200529      *
046520200529     C           SPWRKF    IFEQ 'Y'
046530200529      *
046540200529      ***  Calculate Actual Stock Allocation for Book/Customer.
046550200529      *
046560200529     C                     EXSR CASABC
046570200529      *
046580200529      ***  Calculate Actual Stock Rounding for Book/Customer.
046590200529      *
046600200529     C                     EXSR CASRBC
046610200529     C                     ENDIF
046620200529      *
046630200529      ***  Prepare Dividend Per Unit: = from CO Detail file if Processing Type = Dividends Events,
046640200529      ***                             = Cash Repaid if Processing Type = Capital Change,
046650200529      ***                             = Cash Payment if Processing Type = Corporate Reorganisation.
046660200529      *
046670200529     C           MAPTYP    IFEQ 'DV'
046680200529     C******               Z-ADDNSNBDP    WWNBDP                          135690
046690200529     C**********           Z-ADDNCNBDP    WWNBDP                   135690 190204
046700200529     C**********           Z-ADDMDDIVU    WUNUM                           190204
046710200529     C**********           EXSR RTVNDP                                    190204
046720200529     C                     Z-ADDMDDIV1    WWNUM             13,8 => 30.9  190204
046730200529     C                     Z-ADDWWNUM     WWDIVU 309
046740200529     C                     ELSE
046750200529     C           MAPTYP    IFEQ 'CE'
046760200529     C**********           Z-ADDESNBDP    WWNBDP                                             BUG2652
046770200529     C**********           Z-ADDMGCARE    WUNUM                                              BUG2652
046780200529     C**********           EXSR RTVNDP                                                       BUG2652
046790200529     C           MGCARE    DIV  10000000  WWNUM                                              BUG2652
046800200529     C                     Z-ADDWWNUM     WWDIVU
046810200529     C                     ELSE
046820200529     C           MAPTYP    IFEQ 'CR'
046830200529     C*****                Z-ADDESNBDP    WWNBDP                          155622
046840200529     C*****                Z-ADDMHCAPA    WUNUM                           155622
046850200529     C*****                EXSR RTVNDP                                    155622
046860200529     C           MHCAPA    DIV  10000000  WWNUM                           155622
046870200529     C                     Z-ADDWWNUM     WWDIVU
046880200529     C                     ELSE
046890200529     C                     Z-ADD0         WWDIVU
046900200529     C                     ENDIF
046910200529     C                     ENDIF
046920200529     C                     ENDIF
046930200529      *
046940200529      ***  Calculate Holding Taken as Stock for Book/Customer.
046950200529      *
046960200529     C                     EXSR CHSTBC
046970200529      *
046980200529     C           MAPTYP    IFEQ 'DV'                       If Processing Type = Dividends Events
046990200529     C           MDSDIT    ANDEQ'R'                           Stk Dividend Tp=Reinvestment of Divid.
047000200529      *
047010200529     C           MAPTYP    OREQ 'EX'                       Or Processing Type = Dividends Events
047020200529     C           MJCPRC    ANDNE0                             Conversion Price not 0
047030200529     C           MJCEXR    ANDNE0                             Conversion Exchange Rate not 0
047040200529     C           MDSBPR    ANDNE0                             Subscription Price not 0
047050200529      *
047060200529      ***  Calculate Actual Cash Pool for Book/Customer.
047070200529      *
047080200529     C                     EXSR CACAPO
047090200529     C                     ENDIF
047100200529      *
047110200529      ***  If Special work field equal 'Y', it means the Actual Allocation fields must be
047120200529      ***  calculated.
047130200529      *
047140200529     C           SPWRKF    IFEQ 'Y'
047150200529      *
047160200529      ***  Calculate Actual Cash Rounding for Book/Customer.
047170200529      *
047180200529     C                     EXSR CACRBC
047190200529     C                     ENDIF
047200200529      *
047210200529      ***  If Processing Type = 'NC': Name Changes, 'CR': Corporate Reorganisation,
047220200529      ***  or 'OF': Offers and Offer Type = 'E': Exchange Offers or 'S': Subscription Offers,
047230200529      ***  set Holding Taken as Cash to 0,
047240200529      *
047250200529     C           MAPTYP    IFEQ 'NC'                       If Name Changes
047260200529     C           MAPTYP    OREQ 'CR'                       Or Corporate Reorganisation
047270200529     C           MAPTYP    OREQ 'OF'                       Or Offers
047280200529     C           MIOFTY    ANDEQ'E'                           Exchange Offer
047290200529     C           MAPTYP    OREQ 'OF'                       Or Offers
047300200529     C           MIOFTY    ANDEQ'S'                           Subscription Offer
047310200529     C                     Z-ADD0         WWHOCA
047320200529      *
047330200529      ***  Else, calculate Holding Taken as Cash for Book/Customer.
047340200529      *
047350200529     C                     ELSE
047360200529     C                     EXSR CHCABC
047370200529     C                     ENDIF
047380200529      *
047390200529     C                     ENDSR
047400200529      *
047410200529      *****************************************************************
047420200529      /EJECT
047430200529      *****************************************************************
047440200529      *                                                               *
047450200529      * WRCOAL - Write a record on SECOALL0: Corporate Actions        *
047460200529      *          Allocations file.                                    *
047470200529      *                                                               *
047480200529      * Called by:                                                    *
047490200529      *                                                               *
047500200529      * Calls:                                                        *
047510200529      *                                                               *
047520200529      *****************************************************************
047530200529      *
047540200529     C           WRCOAL    BEGSR                           ** WRCOAL SR **
047550200529      *
047560200529      ***  Blocking processing.
047570200529      *
047580200529     C                     EXSR PBLOCK
047590200529      *
047600200529      ***  Load fields.
047610200529      *
047620200529     C                     MOVE 'D'       MCRECI           Record Id.
047630200529     C                     Z-ADDBJRDNB    MCLCD            Last Change Date = Run Date
047640200529     C                     MOVE 'I'       MCCHTP           Type of Last Change
047660200529     C                     MOVE USER      MCLUID           User Id.
047700200529     C                     MOVE PCORF     MCCORF           CO Reference = Parameter
047710200529      *
047720200529     C           MAPTYP    IFEQ 'NF'                       If Processing Type = Non Financial Events
047730200529     C           MAPTYP    OREQ 'NC'                       Or Processing Type = Name Changes
047740200529     C           MAPTYP    OREQ 'CC'                       Or Ccy Changes CEU017
047750200529     C                     MOVE '01'      MCOPTN              Option Number = 01
047760200529     C                     ELSE                            Else
047770200529     C                     MOVE MDOPTN    MCOPTN              Option Number = from SECOxxL0
047780200529     C                     ENDIF
047790200529      *
047800200529     C                     MOVE PBRCD     MCBRCD           Branch = Parameter
047810200529     C**********           Z-ADDWWDDPT    MCDDPT           Depot = Parameter (num field)      CSD027
047820200529     C                     MOVE WWDDPT    MCDDPT           Depot = Parameter (num field)      CSD027
047830200529     C                     MOVE WWCOTP    MCCOTP           Customer/Book Ind. = Calculated
047840200529     C                     MOVE WWUDBK    MCBOOK           Book = Calculated
047850200529     C                     MOVE WWCDCN    MCCNUM           Customer = Calculated
047860200529     C                     MOVE WWPTFR    MCPTFR           Portfolio Reference = Calculated
047870200529     C                     MOVE NWSESN    MCSESN           Security = Calculated
047880200529      *
047890200529      ***  Fields always in Event Security Decimal Places.
047900200529      *
047910200529     C                     Z-ADDESNBDP    WWNBDP           Event Security Decimal Places
047920200529     C           MAPTYP    IFEQ 'OF'                                      145872
047930200529     C           MIOFTY    ANDEQ'E'                                       145872
047940200529     C                     Z-ADDWUTDVD    WWNUM                           145872
047950200529     C                     ELSE                                           145872
047960200529     C                     Z-ADDWWTDVD    WWNUM
047970200529     C                     ENDIF                                          145872
047980200529     C                     EXSR SETNDP
047990200529     C                     Z-ADDWUNUM     MCEXPO           Ex-Date Position = Retrieve
048000200529     C                     Z-ADDWWHOST    WWNUM
048010200529     C                     EXSR SETNDP
048020200529     C                     Z-ADDWUNUM     MCHOST           Holding Taken as Stock = Calculated
048030200529      *
048040200529      ***  Fields always with 8 Decimal Places.
048050200529      *
048060200529     C                     Z-ADDWWOTSA    MCOTSA           True Stock Allocation = Calculated
048070200529     C                     Z-ADDWWOSTR    MCOSTR           Original Stock Rounding = Calculated
048080200529     C                     Z-ADDWWASTR    MCASTR           Actual Stock Rounding = Calculated
048090200529      *
048100200529      ***  Fields calculated only for New Security (for Security '**CASH**' = 0), so in New
048110200529      ***  Security Decimal Places.
048120200529      *
048130200529     C                     Z-ADDNSNBDP    WWNBDP           New Security Decimal Places
048140200529     C                     Z-ADDWWOALR    WWNUM
048150200529     C                     EXSR SETNDP
048160200529     C                     Z-ADDWUNUM     MCOALR           Original Stock Allocation = Calculated
048170200529     C                     Z-ADDWWASTA    WWNUM
048180200529     C                     EXSR SETNDP
048190200529     C                     Z-ADDWUNUM     MCASTA           Actual Stock Allocation = Calculated
048200200529      *
048210200529      ***  Fields calculated for New Security and for Security '**CASH**', in Event Currency Decimal
048220200529      ***  Places when Security = '**CASH**' and Processing Type = Corporate Reorganisation, else
048230200529      ***  in New Currency Decimal Places.
048240200529      *
048250200529     C           MCSESN    IFEQ '**CASH**'
048260200529     C           MAPTYP    IFEQ 'CR'
048270200529     C                     Z-ADDECNBDP    WWNBDP           Event Currency Decimal Places
048280200529     C                     ELSE
048290200529     C                     Z-ADDTCDP,1    WWNBDP           New Currency Decimal Places
048300200529     C                     ENDIF
048310200529     C                     ELSE
048320200529     C                     Z-ADDNCNBDP    WWNBDP           New Currency Decimal Places
048330200529     C                     ENDIF
048340200529     C                     Z-ADDWWOCAR    WWNUM
048350200529     C                     EXSR SETNDP
048360200529     C                     Z-ADDWUNUM     MCOCAR           Original Cash Rounding
048370200529     C                     Z-ADDWWHOCA    WWNUM
048380200529     C                     EXSR SETNDP
048390200529     C                     Z-ADDWUNUM     MCHOCA           Holding Taken as Cash = Calculated
048400200529     C                     Z-ADDWWACAR    WWNUM
048410200529     C                     EXSR SETNDP
048420200529     C                     Z-ADDWUNUM     MCACAR           Actual Cash Rounding
048430200529      *
048440200529      ***  Fields calculated only for Security '**CASH**' (for New Security = 0), in Event
048450200529      ***  Currency Decimal Places when Processing Type = Corporate Reorganisation, else in New
048460200529      ***  Currency Decimal Places.
048470200529      *
048480200529     C           MAPTYP    IFEQ 'CR'
048490200529     C                     Z-ADDECNBDP    WWNBDP           Event Currency Decimal Places
048500200529     C                     ELSE
048510200529     C                     Z-ADDTCDP,1    WWNBDP           New Currency Decimal Places
048520200529     C                     ENDIF
048530200529     C                     Z-ADDWWCAOP    WWNUM
048540200529     C                     EXSR SETNDP
048550200529     C                     Z-ADDWUNUM     MCCAOP           Original Cash Option = Calculated
048560200529     C                     Z-ADDWWACAA    WWNUM
048570200529     C                     EXSR SETNDP
048580200529     C                     Z-ADDWUNUM     MCACAA           Actual Cash Allocation = Calculated
048590200529      *
048600200529      ***  Fields calculated only for Security '**CASH**' for Customer calculations, else = 0,
048610200529      ***  so in New Currency Decimal Places.
048620200529      *
048630200529     C                     Z-ADDTCDP,1    WWNBDP           New Currency Decimal Places
048640200529     C                     Z-ADDWWTOTF    WWNUM
048650200529      * No need to multiply the result, only to edit correctly on screen. 179205
048660200529     C***********          EXSR SETNDP                                    179205
048670200529     C                     Z-ADDWWNUM     WUNUM                           179205
048680200529     C                     Z-ADDWUNUM     MCTOTF           Total Fees = calculated
048690200529     C                     Z-ADDWWTOTT    WWNUM
048700200529     C                     EXSR SETNDP
048710200529     C                     Z-ADDWUNUM     MCTOTT           Total Taxes = calculated
048720200529      *
048730200529     C                     MOVE WWOPT1    MCOPT1           Option for Actual Allocation 1 = Calculat
048740200529     C                     MOVE WWOPT2    MCOPT2           Option for Actual Allocation 2 = Calculat
048750200529     C                     MOVE WWREST    MCREST           Reply Status = Calculated
048760200529     C                     MOVE WWBSEC    MCBSEC           Block Security = Calculated
048770200529     C                     Z-ADDWWBEDT    MCBEDT           Blocked End Date = Calculated
048780200529     C                     Z-ADDWWBSTT    MCBSTT           Blocked Start Date = Calculated
048790200529     C                     MOVE WWBLTY    MCBLTY           Block Type = Calculated
048800200529     C                     MOVE WWBEWI    MCBEWI           Block Error/Warning Ind. = Calculated
048810200529     C                     MOVE MACOAT    MCCOAT           CO Type = from SECORFL1
048820200529     C                     MOVE WWLTRQ    MCLTRQ           Letter Required = calculated
048830200529      *
048840200529     C                     MOVE *BLANKS   MCTRRF           Transaction Reference
048850200529     C                     MOVE *BLANKS   MCTRR2           Transaction Reference 2
048860200529     C                     MOVE *BLANKS   MCTRR3           Transaction Reference 3
048870200529     C                     MOVE *BLANKS   MCRVRF           Reversal Reference
048880200529     C                     MOVE *BLANKS   MCRVR2           Reversal Reference 2
048890200529     C                     MOVE *BLANKS   MCRVR3           Reversal Reference 3
048900200529     C                     Z-ADD0         MCTNL1           Position Settlement TNL1
048910200529      *                                                                                       223182
048920200529     C                     MOVE *BLANKS   WTCNUM 10                                           223182
048930200529     C                     MOVELWWCDCN    WTCNUM                                              223182
048940200529     C                     CALL 'AOCUSTR1'                                                    223182
048950200529     C                     PARM *BLANKS   @RTCD                                               223182
048960200529     C                     PARM '*KEY    '@OPTN                                               223182
048970200529     C                     PARM WTCNUM    @CUST                                               223182
048980200529     C                     PARM           WWK7    7                                           223182
048990200529     C           SDCUST    PARM SDCUST    DSLDY                                               223182
049000200529     C           BBCLST    IFEQ 'Y'                                                           223182
049010200529     C           MCSESN    IFEQ '**CASH**'                                                    223182
049020200529     C                     Z-ADD0         MCACAA                                              223182
049030200529     C                     Z-ADD0         MCACAR                                              223182
049040200529     C                     ELSE                                                               223182
049050200529     C                     Z-ADD0         MCASTA                                              223182
049060200529     C                     Z-ADD0         MCASTR                                              223182
049070200529     C                     Z-ADD0         MCACAR                                              223182
049080200529     C                     ENDIF                                                              223182
049090200529     C                     ENDIF                                                              223182
049100200529      *
049110200529      ***  Write record on file SECOALL0.
049120200529      *
049130200529     C                     WRITESECOALD0               89
049140200529      *
049150200529      ***  If error detected when write, handle Database Error.
049160200529      *
049170200529     C           *IN89     IFEQ '1'
049180200529     C                     Z-ADD016       DBASE            ***************
049190200529     C                     MOVEL'SECOALL0'DBFILE           * DB ERROR 16 *
049200200529     C                     MOVEL'WRITE'   DBKEY            ***************
049210200529     C                     EXSR *PSSR
049220200529     C                     ENDIF
049230200529     C                     COMIT
049240200529     C                     ADD  1         RSEAL
049250200529      *
049260200529      ***  Reset all block fields if Corporate Action Type = Corporate Reorganisation
049270200529      ***  (must only be filled on first record written in CO Allocation file (SECOALL0)).
049280200529      *
049290200529     C           MAPTYP    IFEQ 'CR'
049300200529     C                     MOVE *BLANKS   WWBSEC           Block Security
049310200529     C                     Z-ADD0         WWBEDT           Blocked End Date
049320200529     C                     Z-ADD0         WWBSTT           Blocked Start Date
049330200529     C                     MOVE *BLANKS   WWBLTY           Block Typeed
049340200529     C                     MOVE *BLANKS   WWBEWI           Block Error/Warning Indicator
049350200529     C                     MOVE 'N'       FIRSCR           First passage for CO Type = 'CR' done
049360200529     C                     ENDIF
049370200529      *
049380200529     C                     ENDSR
049390200529      *
049400200529      *****************************************************************
049410200529      /EJECT
049420200529      *****************************************************************
049430200529      *                                                               *
049440200529      * CCABC  - Calculate Cash Option and Actual Cash Allocation     *
049450200529      *          for Book/Customer.                                   *
049460200529      *                                                               *
049470200529      * Called by:                                                    *
049480200529      *                                                               *
049490200529      * Calls:                                                        *
049500200529      *                                                               *
049510200529      *****************************************************************
049520200529      *
049530200529     C           CCABC     BEGSR                           ** CCABC SR **
049540200529      *
049550200529      ***  Reset work fields.
049560200529      *
049570200529     C                     Z-ADD0         WWCAOP 309       Original Cash Option
049580200529     C                     Z-ADD0         WWACAA 309       Actual Cash Allocation
049590200529      *
049600200529      ***  Prepare Dividend Per Unit: from file if Processing Type = Dividends Events,
049610200529      ***                             = Cash Repaid if Processing Type = Capital Change,
049620200529      ***                             = Cash Payment if Processing Type = Corporate Reorganisation.
049630200529      ***                             = Receive Price if Processing Type = Offers and Offer Type =
049640200529      ***                               Exchange Offers or Purchase Offer,
049650200529      ***                             = Subscription Price if Processing Type = Offers and Offer
049660200529      ***                               Type = Subsrciption Offer.
049670200529      *
049680200529     C           MAPTYP    IFEQ 'DV'
049690200529     C******               Z-ADDTSDP,1    WWNBDP                          135690
049700200529     C**********           Z-ADDTCDP,1    WWNBDP                   135690 190204
049710200529     C**********           Z-ADDMDDIVU    WUNUM                           190204
049720200529     C**********           EXSR RTVNDP                                    190204
049730200529     C                     Z-ADDMDDIV1    WWNUM             13,8 ==> 30,9 190204
049740200529     C                     Z-ADDWWNUM     WWDIVU
049750200529     C                     ELSE
049760200529     C           MAPTYP    IFEQ 'CE'
049770200529     C**********           Z-ADDESNBDP    WWNBDP                                             BUG2652
049780200529     C**********           Z-ADDMGCARE    WUNUM                                              BUG2652
049790200529     C**********           EXSR RTVNDP                                                       BUG2652
049800200529     C           MGCARE    DIV  10000000  WWNUM                                              BUG2652
049810200529     C                     Z-ADDWWNUM     WWDIVU
049820200529     C                     ELSE
049830200529     C           MAPTYP    IFEQ 'CR'
049840200529     C*****                Z-ADDESNBDP    WWNBDP                          155622
049850200529     C*****                Z-ADDMHCAPA    WUNUM                           155622
049860200529     C*****                EXSR RTVNDP                                    155622
049870200529     C           MHCAPA    DIV  10000000  WWNUM                           155622
049880200529     C                     Z-ADDWWNUM     WWDIVU
049890200529     C                     ELSE
049900200529     C           MAPTYP    IFEQ 'OF'
049910200529     C           MIOFTY    ANDEQ'E'
049920200529     C           MAPTYP    OREQ 'OF'
049930200529     C           MIOFTY    ANDEQ'P'
049940200529     C                     Z-ADDMIREPR    WWDIVU
049950200529     C                     ELSE
049960200529     C           MAPTYP    IFEQ 'OF'
049970200529     C           MIOFTY    ANDEQ'S'
049980200529     C                     Z-ADDMISUPR    WWDIVU
049990200529     C                     ELSE
050000200529     C                     Z-ADD0         WWDIVU
050010200529     C                     ENDIF
050020200529     C                     ENDIF
050030200529     C                     ENDIF
050040200529     C                     ENDIF
050050200529     C                     ENDIF
050060200529      *
050070200529     C           MAPTYP    IFEQ 'DV'                       If Processing Type = Dividends Events
050080200529     C           MDSDIT    ANDEQ'S'                           Stock Dividend Type = Stock for Stock
050090200529     C           MAPTYP    OREQ 'FR'                       Or Processing Type = Free Allocation
050100200529     C           MAPTYP    OREQ 'RG'                       Or Processing Type = Rights Issues
050110200529     C           MAPTYP    OREQ 'NF'                       Or Processing Type = Non Financial Events
050120200529     C           MAPTYP    OREQ 'NC'                       Or Processing Type = Name Changes
050130200529     C********** MAPTYP    OREQ 'EX'                       Or Proces. Type = Exercices & Conve219579
050140200529     C           MAPTYP    OREQ 'CC'                       Or Ccy Changes CEU017
050150200529      *
050160200529      ***  Set Cash Option to zero.
050170200529      *
050180200529     C                     Z-ADD0         WWCAOP
050190200529      *
050200200529      ***  Else, Calculate Cash Option.
050210200529      *
050220200529     C                     ELSE
050230200529     C                     EXSR CCAOPT
050240200529     C                     ENDIF
050250200529      *
050260200529      ***  Calculate Actual Cash Allocation for Book/Customer.
050270200529      *
050280200529     C                     EXSR CACABC
050290200529      *
050300200529     C                     ENDSR
050310200529      *
050320200529      *****************************************************************
050330200529      /EJECT
050340200529      *****************************************************************
050350200529      *                                                               *
050360200529      * CALDPT - Calculate other Depot Allocations.                   *
050370200529      *                                                               *
050380200529      * Called by:                                                    *
050390200529      *                                                               *
050400200529      * Calls:                                                        *
050410200529      *                                                               *
050420200529      *****************************************************************
050430200529      *
050440200529     C           CALDPT    BEGSR                           ** CALDPT SR **
050450200529      *
050460200529      ***  Reset work fields.
050470200529      *
050480200529     C                     Z-ADD0         WWASTA 309       Actual Stock Allocation
050490200529     C                     Z-ADD0         WWASTR 309       Actual Stock Rounding
050500200529     C                     Z-ADD0         WWACAR 309       Actual Cash Rounding
050510200529     C                     Z-ADD0         WWHOST 309       Holding Taken as Stock
050520200529     C                     Z-ADD0         WWHOCA 309       Holding Taken as Cash
050530200529     C                     Z-ADD0         WUHOST 309       Holding Taken as Stock saved
050540200529     C                     Z-ADD0         WUHOCA 309       Holding Taken as Cash saved
050550200529      *
050560200529     C           MAPTYP    IFEQ 'CE'                       If Processing Type = Capital Exchange
050570200529     C******     MAPTYP    OREQ 'OF'                       Or Purchase    136935
050580200529     C******     MIOFTY    ANDEQ'P'                           Offer       136935
050590200529     C           MAPTYP    OREQ 'NF'                       Or Processing Type = Non Financial Events
050600200529     C           MAPTYP    OREQ 'NC'                       Or Processing Type = Name Changes
050610200529      *
050620200529      ***  Set Actual Stock Allocation to zero.
050630200529      *
050640200529     C           MAPTYP    IFEQ 'NC'                       Name Changes   153729
050650200529     C                     Z-ADDWWOALR    WWASTA           Actual Stock   153729
050660200529     C                     ELSE                                           153729
050670200529     C                     Z-ADD0         WWASTA
050680200529     C                     ENDIF                                          153729
050690200529      *                                                                   153729
050700200529     C                     ELSE
050710200529      *
050720200529      ***  Calculate Actual Stock Allocation for Depot.
050730200529      *
050740200529     C                     EXSR CASADP
050750200529     C                     ENDIF
050760200529      *
050770200529      ***  Calculate Holding Taken as Stock for Depot.
050780200529      *
050790200529     C                     EXSR CHSTDP
050800200529      *
050810200529      ***  Calculate Holding Taken as Cash for Depot.
050820200529      *
050830200529     C                     EXSR CHCADP
050840200529      *
050850200529     C           MAPTYP    IFEQ 'NF'                       If Processing Type = Non Financial Events
050860200529     C           MAPTYP    OREQ 'NC'                       Or Processing Type = Name Changes
050870200529     C           MAPTYP    OREQ 'OF'                       Or Subscript.  136935
050880200529     C           MIOFTY    ANDEQ'S'                           Offers      136935
050890200529     C           MAPTYP    OREQ 'OF'                       Or Purchase    136935
050900200529     C           MIOFTY    ANDEQ'P'                           Offers      136935
050910200529      *
050920200529      ***  Set Actual Stock Rounding and WWACAR: Actual Cash Rounding to zero.
050930200529      *
050940200529     C                     Z-ADD0         WWASTR
050950200529     C                     Z-ADD0         WWACAR
050960200529     C                     ELSE
050970200529      *
050980200529      ***  Calculate Actual Stock Rounding for Depot.
050990200529      *
051000200529     C                     EXSR CASRDP
051010200529      *
051020200529      ***  Calculate Actual Cash Rounding for Depot.
051030200529      *
051040200529     C                     EXSR CACRDP
051050200529     C                     ENDIF
051060200529      *
051070200529     C                     ENDSR
051080200529      *
051090200529      *****************************************************************
051100200529      /EJECT
051110200529      *****************************************************************
051120200529      *                                                               *
051130200529      * WRCODP - Write a record on SECODPL0: Corporate Actions Depots *
051140200529      *          file.                                                *
051150200529      *                                                               *
051160200529      * Called by:                                                    *
051170200529      *                                                               *
051180200529      * Calls:                                                        *
051190200529      *                                                               *
051200200529      *****************************************************************
051210200529      *
051220200529     C           WRCODP    BEGSR                           ** WRCODP SR **
051230200529      *
051240200529      ***  Load fields.
051250200529      *
051260200529     C                     MOVE 'D'       MBRECI           Record Id.
051270200529     C                     Z-ADDBJRDNB    MBLCD            Last Change Date = Run Date
051280200529     C                     MOVE 'I'       MBCHTP           Type of Last Change
051300200529     C                     MOVE USER      MBLUID           User Id.
051340200529     C                     MOVE PCORF     MBCORF           CO Reference = Parameter
051350200529      *
051360200529     C           MAPTYP    IFEQ 'NF'                       If Processing Type = Non Financial Events
051370200529     C           MAPTYP    OREQ 'NC'                       Or Processing Type = Name Changes
051380200529     C           MAPTYP    OREQ 'CC'                       Or Ccy Changes CEU017
051390200529     C                     MOVE '01'      MBOPTN              Option Number = 01
051400200529     C                     ELSE                            Else
051410200529     C                     MOVE MDOPTN    MBOPTN              Option Number = from SECOxxL0
051420200529     C                     ENDIF
051430200529      *
051440200529     C                     MOVE PBRCD     MBBRCD           Branch = Parameter
051450200529     C**********           Z-ADDWWDDPT    MBDDPT           Depot = Parameter (num field)      CSD027
051460200529     C                     MOVE WWDDPT    MBDDPT           Depot = Parameter (num field)      CSD027
051470200529     C                     MOVE NWSESN    MBSESN           New Security
051480200529      *
051490200529      ***  Fields always in Event Security Decimal Places.
051500200529      *
051510200529     C                     Z-ADDESNBDP    WWNBDP           Event Security Decimal Places
051520200529     C           MAPTYP    IFEQ 'OF'                                      145872
051530200529     C           MIOFTY    ANDEQ'E'                                       145872
051540200529     C                     Z-ADDWUTDVD    WWNUM                           145872
051550200529     C                     ELSE                                           145872
051560200529     C                     Z-ADDWWTDVD    WWNUM
051570200529     C                     ENDIF                                          145872
051580200529     C                     EXSR SETNDP
051590200529     C                     Z-ADDWUNUM     MBEXPO           Ex-Date Position = retrieve
051600200529     C                     Z-ADDWWHOST    WWNUM
051610200529     C                     EXSR SETNDP
051620200529     C                     Z-ADDWUNUM     MBHOST           Holding Taken as Stock = calculated
051630200529      *
051640200529      ***  Fields calculated only for Security '**CASH**' (for New Security = 0), so in Event
051650200529      ***  Currency Decimal Places if Processing Type = Corporate reorganisation, else in New
051660200529      ***  Currency Decimal Places.
051670200529      *
051680200529     C           MAPTYP    IFEQ 'CR'
051690200529     C                     Z-ADDECNBDP    WWNBDP           Event Currency Decimal Places
051700200529     C                     ELSE
051710200529     C                     Z-ADDTCDP,1    WWNBDP           New Currency Decimal Places
051720200529     C                     ENDIF
051730200529     C                     Z-ADDWWCAOP    WWNUM
051740200529     C                     EXSR SETNDP
051750200529     C                     Z-ADDWUNUM     MBCAOP           Original Cash Option = Calculated
051760200529     C                     Z-ADDWWACAA    WWNUM
051770200529     C                     EXSR SETNDP
051780200529     C                     Z-ADDWUNUM     MBACAA           Actual Cash Allocation = Calculated
051790200529     C                     Z-ADDWWBCAA    WWNUM
051800200529     C                     EXSR SETNDP
051810200529     C           MBSESN    IFNE '**CASH**'                                137886
051820200529     C                     Z-ADDWUNUM     MBBCAA           Balancing Cash Allocation = Calculated
051830200529     C                     ELSE                                           137886
051840200529     C                     Z-SUBWUNUM     MBBCAA                          137886
051850200529     C                     ENDIF                                          137886
051860200529      *
051870200529      ***  Fields always in 8 Decimal Places.
051880200529      *
051890200529     C                     Z-ADD8         WWNBDP           8 Decimal Places
051900200529     C                     Z-ADDWWOTSA    MBOTSA           True Stock Allocation = Calculated
051910200529     C                     Z-ADDWWOSTR    MBOSTR           Original Stock Rounding = Calculated
051920200529     C                     Z-ADDWWASTR    MBASTR           Actual Stock Rounding = Calculated
051930200529     C                     Z-ADDWWBSTR    MBBSTR           Balancing Stock Rounding = Calculated
051940200529      *
051950200529      ***  Fields "stock" calculated only for New Security (for Security '**CASH**' = 0), so in
051960200529      ***  New Security Decimal Places.
051970200529      *
051980200529     C                     Z-ADDNSNBDP    WWNBDP           New Security Decimal Places
051990200529     C                     Z-ADDWWOALR    WWNUM
052000200529     C                     EXSR SETNDP
052010200529     C                     Z-ADDWUNUM     MBOALR           Original Stock Allocation = Calculated
052020200529     C                     Z-ADDWWASTA    WWNUM
052030200529     C                     EXSR SETNDP
052040200529     C                     Z-ADDWUNUM     MBASTA           Actual Stock Allocation = Calculated
052050200529     C                     Z-ADDWWBSTA    WWNUM
052060200529     C                     EXSR SETNDP
052070200529     C                     Z-ADDWUNUM     MBBSTA           Balancing Stock Allocation = Calculated
052080200529      *
052090200529      ***  Fields "cash" calculated only for New Security (for Security '**CASH**' = 0), so in
052100200529      ***  New Currency Decimal Places.
052110200529      *
052120200529     C                     Z-ADDNCNBDP    WWNBDP           New Currency Decimal Places
052130200529     C                     Z-ADDWWBCAR    WWNUM
052140200529     C                     EXSR SETNDP
052150200529     C                     Z-ADDWUNUM     MBBCAR           Balancing Cash Rounding = Calculated
052160200529      *
052170200529      ***  Fields calculated for New Security and for Security '**CASH**', in Event Currency Decimal
052180200529      ***  Places when Security = '**CASH**' and Processing Type = Corporate Reorganisation, else
052190200529      ***  in New Currency Decimal Places.
052200200529      *
052210200529     C           MBSESN    IFEQ '**CASH**'
052220200529     C           MAPTYP    IFEQ 'CR'
052230200529     C                     Z-ADDECNBDP    WWNBDP           Event Currency Decimal Places
052240200529     C                     ELSE
052250200529     C                     Z-ADDTCDP,1    WWNBDP           New Currency Decimal Places
052260200529     C                     ENDIF
052270200529     C                     ELSE
052280200529     C                     Z-ADDNCNBDP    WWNBDP           New Currency Decimal Places
052290200529     C                     ENDIF
052300200529     C                     Z-ADDWWOCAR    WWNUM
052310200529     C                     EXSR SETNDP
052320200529     C                     Z-ADDWUNUM     MBOCAR           Original Cash Rounding
052330200529     C                     Z-ADDWWHOCA    WWNUM
052340200529     C                     EXSR SETNDP
052350200529     C                     Z-ADDWUNUM     MBHOCA           Holding Taken as Cash = Calculated
052360200529     C                     Z-ADDWWACAR    WWNUM
052370200529     C                     EXSR SETNDP
052380200529     C                     Z-ADDWUNUM     MBACAR           Actual Cash Rounding
052390200529      *
052400200529     C                     MOVE MACOAT    MBCOAT           CO Type = Parameter
052410200529      *
052420200529     C                     Z-ADD0         MBTNL1           Position Settlement TNL1
052430200529      *
052440200529      ***  Write record on file SECODPL0.
052450200529      *
052460200529     C                     WRITESECODPD0               89
052470200529      *
052480200529      ***  If error detected when write, handle Database Error.
052490200529      *
052500200529     C           *IN89     IFEQ '1'
052510200529     C                     Z-ADD017       DBASE            ***************
052520200529     C                     MOVEL'SECODPL0'DBFILE           * DB ERROR 17 *
052530200529     C                     MOVEL'WRITE'   DBKEY            ***************
052540200529     C                     EXSR *PSSR
052550200529     C                     ENDIF
052560200529     C                     COMIT
052570200529     C                     ADD  1         RSEDP
052580200529      *
052590200529     C                     ENDSR
052600200529      *
052610200529      *****************************************************************
052620200529      /EJECT
052630200529      *****************************************************************
052640200529      *                                                               *
052650200529      * CCADPT - Calculate Cash Option and Actual Cash Allocation for *
052660200529      *          Depot.                                               *
052670200529      *                                                               *
052680200529      * Called by:                                                    *
052690200529      *                                                               *
052700200529      * Calls:                                                        *
052710200529      *                                                               *
052720200529      *****************************************************************
052730200529      *
052740200529     C           CCADPT    BEGSR                           ** CCADPT SR **
052750200529      *
052760200529      ***  Reset work fields.
052770200529      *
052780200529     C                     Z-ADD0         WWCAOP 309       Original Cash Option
052790200529     C                     Z-ADD0         WWACAA 309       Actual Cash Allocation
052800200529      *
052810200529      ***  Prepare Dividend Per Unit: from file if Processing Type = Dividends Events,
052820200529      ***                             = Cash Repaid if Processing Type = Capital Change,
052830200529      ***                             = Cash Payment if Processing Type = Corporate Reorganisation,
052840200529      ***                             = Receive Price if Processing Type = Offers and Offer Type =
052850200529      ***                               Exchange Offers or Purchase Offer,
052860200529      ***                             = Subscription Price if Processing Type = Offers and Offer
052870200529      ***                               Type = Subsrciption Offer.
052880200529      *
052890200529     C           MAPTYP    IFEQ 'DV'
052900200529     C******               Z-ADDTSDP,1    WWNBDP                          135690
052910200529     C**********           Z-ADDTCDP,1    WWNBDP                   135690 190204
052920200529     C**********           Z-ADDMDDIVU    WUNUM                           190204
052930200529     C**********           EXSR RTVNDP                                    190204
052940200529     C                     Z-ADDMDDIV1    WWNUM             13,8 => 30,9  190204
052950200529     C                     Z-ADDWWNUM     WWDIVU
052960200529     C                     ELSE
052970200529     C           MAPTYP    IFEQ 'CE'
052980200529     C**********           Z-ADDESNBDP    WWNBDP                                             BUG2652
052990200529     C**********           Z-ADDMGCARE    WUNUM                                              BUG2652
053000200529     C**********           EXSR RTVNDP                                                       BUG2652
053010200529     C           MGCARE    DIV  10000000  WWNUM                                              BUG2652
053020200529     C                     Z-ADDWWNUM     WWDIVU
053030200529     C                     ELSE
053040200529     C           MAPTYP    IFEQ 'CR'
053050200529     C*****                Z-ADDESNBDP    WWNBDP                          155622
053060200529     C*****                Z-ADDMHCAPA    WUNUM                           155622
053070200529     C*****                EXSR RTVNDP                                    155622
053080200529     C           MHCAPA    DIV  10000000  WWNUM                           155622
053090200529     C                     Z-ADDWWNUM     WWDIVU
053100200529     C                     ELSE
053110200529     C           MAPTYP    IFEQ 'OF'
053120200529     C           MIOFTY    ANDEQ'E'
053130200529     C           MAPTYP    OREQ 'OF'
053140200529     C           MIOFTY    ANDEQ'P'
053150200529     C                     Z-ADDMIREPR    WWDIVU
053160200529     C                     ELSE
053170200529     C           MAPTYP    IFEQ 'OF'
053180200529     C           MIOFTY    ANDEQ'S'
053190200529     C                     Z-ADDMISUPR    WWDIVU
053200200529     C                     ELSE
053210200529     C                     Z-ADD0         WWDIVU
053220200529     C                     ENDIF
053230200529     C                     ENDIF
053240200529     C                     ENDIF
053250200529     C                     ENDIF
053260200529     C                     ENDIF
053270200529      *
053280200529     C           MAPTYP    IFEQ 'DV'                       If Processing Type = Dividends Events
053290200529     C           MDSDIT    ANDEQ'S'                           Stock Dividend Type = Stock for Stock
053300200529     C           MAPTYP    OREQ 'FR'                       Or Processing Type = Free Allocation
053310200529     C           MAPTYP    OREQ 'RG'                       Or Processing Type = Rights Issues
053320200529     C           MAPTYP    OREQ 'NF'                       Or Processing Type = Non Financial Events
053330200529     C           MAPTYP    OREQ 'NC'                       Or Processing Type = Name Changes
053340200529     C***********MAPTYP    OREQ 'EX'                       Or Proces. Type = Exercices & Conve219579
053350200529     C           MAPTYP    OREQ 'CC'                       Or Ccy Changes CEU017
053360200529      *
053370200529      ***  Set Cash Option to zero.
053380200529      *
053390200529     C                     Z-ADD0         WWCAOP
053400200529      *
053410200529      ***  Else, calculate Cash Option.
053420200529      *
053430200529     C                     ELSE
053440200529     C                     EXSR CCAOPT
053450200529     C                     ENDIF
053460200529      *
053470200529      ***  Calculate Actual Cash Allocation for Depot.
053480200529      *
053490200529     C                     EXSR CACADP
053500200529      *
053510200529     C                     ENDSR
053520200529      *
053530200529      *****************************************************************
053540200529      /EJECT
053550200529      *****************************************************************
053560200529      *                                                               *
053570200529      * COSA1  - 1st calculation of Original Stock Allocation.        *
053580200529      *                                                               *
053590200529      * Called by:                                                    *
053600200529      *                                                               *
053610200529      * Calls:                                                        *
053620200529      *                                                               *
053630200529      *****************************************************************
053640200529      *
053650200529     C           COSA1     BEGSR                           ** COSA1 SR **
053660200529      *                                                                   136935
053670200529      ***  If Processing Type = Offer with Offer Type = Exchange.         136935
053680200529      *                                                                   136935
053690200529     C           MAPTYP    IFEQ 'OF'                                      136935
053700200529     C           MIOFTY    ANDEQ'E'                                       136935
053710200529     C           WINDPT    ANDNE'Y'                                       156690
053720200529      *                                                                   136935
053730200529      ***  Calculate work field A = (Ex-Date Position multiplied by Stock 136935
053740200529      ***  Preferred %) divided by Number of Old Shares, where Stock      136935
053750200529      ***  Preferred % = 100 - % Accepted previously calculated.          136935
053760200529      *                                                                   136935
053770200529     C********** 100       SUB  WCAPR     WSTPR                                        136935 218698
053780200529     C********** WWTDVD    MULT WSTPR     FLDA                                         136935 218698
053810200529     C           WWOPT2    IFEQ '3'                                                           220006
053820200529     C           WWTDVD    MULT WCAPR     FLDA                                                220006
053830200529     C                     END                                                                220006
053840200529     C           FLDA      DIV  100       FLDA                            136935
053850200529     C           FLDA      DIV  MDOSHA    FLDA                            136935
053860200529     C           EXBCRE    IFEQ 'Y'                                                           220006
053870200529     C           MQR2CN    ANDNE0                                                             220006
053880200529     C                     Z-ADDMQR2CN    FLDA                                                220006
053890200529     C                     END                                                                220006
053900200529      *                                                                   136935
053910200529      ***  Else, if Processing Type not Offer with Offer Type = Exchange. 136935
053920200529      *                                                                   136935
053930200529     C                     ELSE                                           136935
053940200529      *                                                                   136935
053950200529      ***  If Processing Type = Exercices and Conversions.                136935
053960200529      *                                                                   136935
053970200529     C           MAPTYP    IFEQ 'EX'                                      136935
053980200529      *                                                                   136935
053990200529      ***  If Standard Corporate Actions Instruction exists, set          136935
054000200529      ***  Convert/Keep work field to Convertible/Keep field retreive     136935
054010200529      ***  from SECOSIL1-2.                                               136935
054020200529      *                                                                   136935
054030200529     C                     MOVE ' '       WWCKIN  1                       136935
054040200529     C           EXBCSI    IFEQ 'Y'                                       136935
054050200529     C           MJOPT5    ANDEQ'Y'                                       156701
054060200529     C           MJOPT6    ANDEQ'Y'                                       156701
054070200529     C                     MOVE MOCKIN    WWCKIN                          136935
054080200529     C                     ELSE                                           136935
054090200529      *                                                                   136935
054100200529      ***  Else, if Customer/Book Standard Corporate Actions Instruction  136935
054110200529      ***  does not exist, set Convertible/Keep work field to 'C' if      136935
054120200529      ***  Default for no Reply retrieve from SECOEXL1 is 1 to 5, else    136935
054130200529      ***  set it to 'K' if Default No Reply = 6 or 7.                    136935
054140200529      *                                                                   136935
054150200529     C           MDDFNR    IFEQ '1'                                       136935
054160200529     C           MDDFNR    OREQ '2'                                       136935
054170200529     C           MDDFNR    OREQ '3'                                       136935
054180200529     C           MDDFNR    OREQ '4'                                       136935
054190200529     C           MDDFNR    OREQ '5'                                       136935
054200200529     C                     MOVE 'C'       WWCKIN                          136935
054210200529     C                     ELSE                                           136935
054220200529     C           MDDFNR    IFEQ '6'                                       136935
054230200529     C           MDDFNR    OREQ '7'                                       136935
054240200529     C                     MOVE 'K'       WWCKIN                          136935
054250200529     C                     ENDIF                                          136935
054260200529     C                     ENDIF                                          136935
054270200529     C                     ENDIF                                          136935
054280200529      *                                                                   136935
054290200529      ***  If Convert/Keep Indicator = 'K', set Accept on Holding to 0.   136935
054300200529      *                                                                   136935
054310200529     C           WWCKIN    IFEQ 'K'                                       136935
054320200529     C                     Z-ADD0         ACCHLD                          136935
054330200529     C                     ELSE                                           136935
054340200529      *                                                                   136935
054350200529      ***  Else, if Convert/Keep Indicator = 'C', calculate Accept on     136935
054360200529      ***  Holding = Holding (=Ex-Date Position) - Sell on Holding, where 136935
054370200529      ***  Sell on Holding = Holding (=Ex-Date Position multiplied by     136935
054380200529      ***  Cash % previously calculated.                                  136935
054390200529      *                                                                   136935
054400200529     C           WWTDVD    MULT WCAPR     SELHLD 309                      136935
054410200529     C           SELHLD    DIV  100       SELHLD                          136935
054420200529     C           WWTDVD    SUB  SELHLD    ACCHLD 309                      136935
054430200529     C                     ENDIF                                          136935
054440200529      *                                                                   136935
054450200529      ***  Calculate work field A = Accept on Holding divided by Number   136935
054460200529      ***  of Old Shares.                                                 136935
054470200529      *                                                                   136935
054480200529     C           ACCHLD    DIV  MDOSHA    FLDA                            136935
054490200529      *                                                                   136935
054500200529      ***  Else, if Processing Type not Offer with Offer Type = Exchange, 136935
054510200529      ***  and not Exercices and Conversions.                             136935
054520200529      *                                                                   136935
054530200529     C                     ELSE                                           136935
054540200529      *
054550200529      ***  Calculate work field A = Ex-Date Position divided by Number of Old Shares.
054560200529      *
054570200529     C           WWTDVD    DIV  MDOSHA    FLDA   309
054580200529     C                     ENDIF                                          136935
054590200529     C                     ENDIF                                          136935
054600200529      *
054610200529      ***  Calculate work field AA = work field A rounded down if Rounding Indicator from Corporate
054620200529      ***  Actions Details file = 'D' or half adjust if Rounding = 'R' (rounded is perform to Number
054630200529      ***  of Decimal Places of New Security).
054640200529      *
054650200529     C                     Z-ADDFLDA      WWNUM
054660200529     C                     Z-ADDNSNBDP    WWNBDP
054670200529     C                     MOVE WWRNDN    WUROOP
054680200529     C                     EXSR ROUNDD
054690200529     C                     Z-ADDWWNUM     FLDAA  309
054700200529      *
054710200529      ***  Calculate work field B = work field AA multipled by Number of New Shares.
054720200529      *
054730200529     C           WWRNDN    IFEQ 'B'                                       149153
054740200529     C           1         MULT WWNSHA    FLDB                            149153
054750200529     C                     ELSE                                           149153
054760200529     C********** WWRNDN    IFEQ 'O'                                149782 161419
054770200529     C           FLDA      MULT WWNSHA    FLDB   309                      149782
054780200529     C**********           ELSE                                    149782 161419
054790200529     C********** FLDAA     MULT WWNSHA    FLDB   309                      161419
054800200529     C**********           ENDIF                                   149782 161419
054810200529     C                     ENDIF                                          149153
054820200529      *
054830200529      ***  Calculate work field C = work field B divided by Denomination Multilier.
054840200529      *
054850200529     C           FLDB      DIV  WWDMLT    FLDC   309
054860200529      *
054870200529      ***  Calculate work field CA = work field C rounding down to nearest unit if Rounding
054880200529      ***  Indicator from Corporate Actions Detail file = 'D', or half adjust to nearest unit
054890200529      ***  if Rounding = 'R'.
054900200529      *
054910200529     C           WWRNDN    IFEQ 'D'
054920200529     C           WWRNDN    OREQ 'U'                                       135686
054930200529     C           WWRNDN    OREQ 'B'                                       149153
054940200529     C           WWRNDN    OREQ 'O'                                       149782
054950200529     C                     Z-ADDFLDC      FLDCA  300
054960200529     C                     ELSE
054970200529     C                     Z-ADDFLDC      FLDCA  300H
054980200529     C                     ENDIF
054990200529      *
055000200529      ***  Calculate Original Stock Allocation = work field CA multiplied by Denomination
055010200529      ***  Multiplier.
055020200529      *
055030200529     C           FLDCA     MULT WWDMLT    WWOALR
055040200529      *                                                                   135686
055050200529     C           WWRNDN    IFEQ 'U'                                       135686
055060200529     C           WWOALR    ANDNEFLDB                                      135686
055070200529     C                     ADD  WWDMLT    WWOALR                          135686
055080200529     C                     ENDIF                                          135686
055090200529      *                                                                   136935
055100200529      ***  If Processting Type = Offers with Offer Type = Subscription,   136935
055110200529      ***  accumulate Original Stock Allocation calculated.               136935
055120200529      *                                                                   136935
055130200529     C           MAPTYP    IFEQ 'OF'                                      136935
055140200529     C           MIOFTY    ANDEQ'S'                                       136935
055150200529     C                     ADD  WWOALR    WUOALR                          136935
055160200529     C                     ENDIF                                          136935
055170200529      *                                                                   136935
055180200529      ***  If Processting Type = Offers with Offer Type = Purchase,       136935
055190200529      ***  accumulate Original Stock Allocation calculated multiplied by  136935
055200200529      ***  Cash Preferred %.                                              136935
055210200529      *                                                                   136935
055220200529     C           MAPTYP    IFEQ 'OF'                                      136935
055230200529     C           MIOFTY    ANDEQ'P'                                       136935
055240200529     C           WWOALR    MULT WCAPR     W1OALR 309                      136935
055250200529     C                     DIV  100       W1OALR                          136935
055260200529     C           MQR2CN    IFNE 0                                         219976
055270200529     C                     Z-ADDMQR2CN    W1OALR                          219976
055280200529     C                     END                                            219976
055290200529     C**********           ADD  W1OALR    W2OALR                   136935 209292
055300200529     C                     ADD  W1OALR    W2OALR                          219976
055310200529     C                     ADD  WWOALR    WUOALR                                              193662
055320200529     C                     ENDIF                                          136935
055330200529      *                                                                   149153
055340200529     C           WWRNDN    IFEQ 'B'                                       149153
055350200529     C                     Z-ADDWWOALR    WWOAL1 309                      149153
055360200529     C           WWOALR    MULT FLDA      WWOALR                          149153
055370200529     C                     ENDIF                                          149153
055380200529      *
055390200529      ***  Set Original Stock Allocation calculated.
055400200529      *
055410200529     C                     Z-ADDNSNBDP    WWNBDP           New Security Decimal Places
055420200529     C                     MOVE WWRNDN    WUROOP           Rounding from CO Detail file
055430200529     C                     Z-ADDWWOALR    WWNUM
055440200529     C                     EXSR ROUNDD
055450200529     C                     Z-ADDWWNUM     WWOALR
055460200529      *
055470200529     C                     ENDSR
055480200529      *
055490200529      *****************************************************************
055500200529      /EJECT
055510200529      *****************************************************************
055520200529      *                                                               *
055530200529      * CTSA1  - 1st calculation of True Stock Allocation.            *
055540200529      *                                                               *
055550200529      * Called by:                                                    *
055560200529      *                                                               *
055570200529      * Calls:                                                        *
055580200529      *                                                               *
055590200529      *****************************************************************
055600200529      *
055610200529     C           CTSA1     BEGSR                           ** CTSA1 SR **
055620200529      *                                                                   136935
055630200529      ***  If Processing Type =  Offers with Offer Type = Subscription or 136935
055640200529      ***  Purchase, set True Stock Allocation to 0.                      136935
055650200529      *                                                                   136935
055660200529     C           MAPTYP    IFEQ 'OF'                                      136935
055670200529     C           MIOFTY    ANDEQ'S'                                       136935
055680200529     C           MAPTYP    OREQ 'OF'                                      136935
055690200529     C           MIOFTY    ANDEQ'P'                                       136935
055700200529     C                     Z-ADD0         WWOTSA                          136935
055710200529      *                                                                   136935
055720200529      ***  Else, if Processing Type not Offers with Offer Type =          136935
055730200529      ***  Subscription and Purchase.                                     136935
055740200529      *                                                                   136935
055750200529     C                     ELSE                                           136935
055760200529      *
055770200529      ***  Calculate True Stock Allocation = work field A calculated previously multiplied
055780200529      ***  by Number of new shares.
055790200529      *
055800200529     C           FLDA      MULT WWNSHA    WWOTSA
055810200529      *
055820200529      ***  Set True Stock Allocation calculated.
055830200529      *
055840200529     C                     Z-ADDNSNBDP    WWNBDP           New Security Decimal Places
055850200529     C                     Z-ADD8         WWNBDP           Decimal Places = 8
055860200529     C                     Z-ADDWWOTSA    WWNUM
055870200529     C                     EXSR ROUNDD
055880200529     C                     Z-ADDWWNUM     WWOTSA
055890200529     C                     ENDIF                                          136935
055900200529      *
055910200529     C                     ENDSR
055920200529      *
055930200529      *****************************************************************
055940200529      /EJECT
055950200529      *****************************************************************
055960200529      *                                                               *
055970200529      * COSR1  - 1st calculation of Original Stock Rounding.          *
055980200529      *                                                               *
055990200529      * Called by:                                                    *
056000200529      *                                                               *
056010200529      * Calls:                                                        *
056020200529      *                                                               *
056030200529      *****************************************************************
056040200529      *
056050200529     C           COSR1     BEGSR                           ** COSR1 SR **
056060200529      *                                                                   136935
056070200529      ***  If Processing Type =  Offers with Offer Type = Subscription or 136935
056080200529      ***  Purchase, set Original Stock Rounding to 0.                    136935
056090200529      *                                                                   136935
056100200529     C           MAPTYP    IFEQ 'OF'                                      136935
056110200529     C           MIOFTY    ANDEQ'S'                                       136935
056120200529     C           MAPTYP    OREQ 'OF'                                      136935
056130200529     C           MIOFTY    ANDEQ'P'                                       136935
056140200529     C                     Z-ADD0         WWOSTR                          136935
056150200529      *                                                                   136935
056160200529      ***  Else, if Processing Type not Offers with Offer Type =          136935
056170200529      ***  Subscription and Purchase.                                     136935
056180200529      *                                                                   136935
056190200529     C                     ELSE                                           136935
056200200529      *
056210200529      ***  Calculate Original Stock Rounding = True Stock Allocation calculated before
056220200529      ***  - Original Stock Allocation calculated before.
056230200529      *
056240200529     C           WWRNDN    IFEQ 'B'                                       149153
056250200529     C           WWNSHA    SUB  WWOAL1    WWOSTR                          149153
056260200529     C                     Z-ADDWWOSTR    WWOST1 309                      149153
056270200529     C           WWOSTR    MULT FLDA      WWOSTR                          149153
056280200529     C                     ELSE                                           149153
056290200529     C           WWOTSA    SUB  WWOALR    WWOSTR
056300200529     C                     ENDIF                                          149153
056310200529      *
056320200529      ***  Set Original Stock Rounding calculated.
056330200529      *
056340200529     C                     Z-ADDNSNBDP    WWNBDP           New Security Decimal Places
056350200529     C                     Z-ADD8         WWNBDP           Decimal Places = 8
056360200529     C                     Z-ADDWWOSTR    WWNUM
056370200529     C                     EXSR ROUNDD
056380200529     C                     Z-ADDWWNUM     WWOSTR
056390200529     C                     ENDIF                                          136935
056400200529      *
056410200529     C                     ENDSR
056420200529      *
056430200529      *****************************************************************
056440200529      /EJECT
056450200529      *****************************************************************
056460200529      *                                                               *
056470200529      * COSR2  - 2nd calculation of Original Stock Rounding.          *
056480200529      *                                                               *
056490200529      * Called by:                                                    *
056500200529      *                                                               *
056510200529      * Calls:                                                        *
056520200529      *                                                               *
056530200529      *****************************************************************
056540200529      *
056550200529     C           COSR2     BEGSR                           ** COSR2 SR **
056560200529      *
056570200529      ***  Calculate Original Stock Rounding = ((Holding (Ex-Date Position) multiplied by Dividend
056580200529      ***  Per Unit) - (Original Stock Allocation previously calculated multiplied by Subscription
056590200529      ***  Price) divided by Subscription Price.
056600200529      ***  Use Conversion Price multiplied by Exchange Rate instead of    136935
056610200529      ***  Dividend Per Unit if Processing Type = Exercices and           136935
056620200529      ***  Conversions (= if not 'DV').                                   136935
056630200529      *
056640200529     C           MAPTYP    IFEQ 'DV'                                      136935
056650200529     C******               Z-ADDNSNBDP    WWNBDP                          135690
056660200529     C**********           Z-ADDNCNBDP    WWNBDP                   135690 190204
056670200529     C**********           Z-ADDMDDIVU    WUNUM                           190204
056680200529     C**********           EXSR RTVNDP                                    190204
056690200529     C                     Z-ADDMDDIV1    WWNUM            13,8 => 30,9   190204
056700200529     C           WWTDVD    MULT WWNUM     FLDFW  309
056710200529     C                     ELSE                                           136935
056720200529     C           WWTDVD    MULT MJCPRC    FLDFW                           136935
056730200529     C           FLDFW     MULT MJCEXR    FLDFW                           136935
056740200529     C                     ENDIF                                          136935
056750200529     C           WWOALR    MULT MDSBPR    FLDFWW 309
056760200529      *
056770200529      ***  If Price Basis is 'P' for %, result should be divided by 100.
056780200529      *
056790200529     C           NSSPBS    IFEQ 'P'
056800200529     C           FLDFWW    DIV  100       FLDFWW
056810200529     C                     ENDIF
056820200529     C                     SUB  FLDFWW    FLDFW
056830200529     C           FLDFW     DIV  MDSBPR    WWOSTR
056840200529      *
056850200529      ***  If Price Basis is 'P' for %, result should be divided by 100.
056860200529      *
056870200529     C           NSSPBS    IFEQ 'P'
056880200529     C           WWOSTR    DIV  100       WWOSTR
056890200529     C                     ENDIF
056900200529      *
056910200529      ***  Set Original Stock Rounding calculated.
056920200529      *
056930200529     C                     Z-ADDNSNBDP    WWNBDP           New Security Decimal Places
056940200529     C                     Z-ADD8         WWNBDP           Decimal Places = 8
056950200529     C                     Z-ADDWWOSTR    WWNUM
056960200529     C                     EXSR ROUNDD
056970200529     C                     Z-ADDWWNUM     WWOSTR
056980200529      *
056990200529     C                     ENDSR
057000200529      *
057010200529      *****************************************************************
057020200529      /EJECT
057030200529      *****************************************************************
057040200529      *                                                               *
057050200529      * COCR1  - 1st calculation of Original Cash Rounding.           *
057060200529      *                                                               *
057070200529      * Called by:                                                    *
057080200529      *                                                               *
057090200529      * Calls:                                                        *
057100200529      *                                                               *
057110200529      *****************************************************************
057120200529      *
057130200529     C           COCR1     BEGSR                           ** COCR1 SR **
057140200529      *                                                                   136935
057150200529      ***  If Processing Type =  Offers with Offer Type = Subscription or 136935
057160200529      ***  Purchase, set Original Cash Rounding to 0.                     136935
057170200529      *                                                                   136935
057180200529     C           MAPTYP    IFEQ 'OF'                                      136935
057190200529     C           MIOFTY    ANDEQ'S'                                       136935
057200200529     C           MAPTYP    OREQ 'OF'                                      136935
057210200529     C           MIOFTY    ANDEQ'P'                                       136935
057220200529     C                     Z-ADD0         WWOCAR                          136935
057230200529      *                                                                   136935
057240200529      ***  Else, if Processing Type not Offers with Offer Type =          136935
057250200529      ***  Subscription and Purchase.                                     136935
057260200529      *                                                                   136935
057270200529     C                     ELSE                                           136935
057280200529      *
057290200529      ***  If Rounding Settlement in Cash = 'Y', calculate Original Cash Rounding = Original Stock
057300200529      ***  Rounding previously calculated multiplied by Compensation Price.
057310200529      *
057320200529     C           WWRNDS    IFEQ 'Y'
057330200529     C           WWRNDN    IFEQ 'B'                                       149153
057340200529     C           WWOST1    MULT WWCOMP    WWOCAR                          149153
057350200529     C           WWOCAR    MULT FLDA      WWOCAR                          149153
057360200529     C                     ELSE                                           149153
057370200529     C           WWOSTR    MULT WWCOMP    WWOCAR 309
057380200529     C                     ENDIF                                          149153
057390200529      *
057400200529      ***  If Price Basis is 'P' for %, result should be divided by 100.
057410200529      *
057420200529     C           NSSPBS    IFEQ 'P'
057430200529     C           WWOCAR    DIV  100       WWOCAR
057440200529     C                     ENDIF
057450200529      *
057460200529      ***  Set Original Cash Rounding calculated.
057470200529      *
057480200529     C                     Z-ADDNCNBDP    WWNBDP           New Currency Decimal Places
057490200529     C                     MOVE 'R'       WUROOP           Rounding = half adjust
057500200529     C                     Z-ADDWWOCAR    WWNUM
057510200529     C                     EXSR ROUNDD
057520200529     C                     Z-ADDWWNUM     WWOCAR
057530200529      *
057540200529      ***  Else, If Rounding Settlement in Cash not equal 'Y', set Original Cash Rounding
057550200529      ***  to zero.
057560200529      *
057570200529     C                     ELSE
057580200529     C                     Z-ADD0         WWOCAR
057590200529     C                     ENDIF
057600200529     C                     ENDIF                                          136935
057610200529      *
057620200529     C                     ENDSR
057630200529      *
057640200529      *****************************************************************
057650200529      /EJECT
057660200529      *****************************************************************
057670200529      *                                                               *
057680200529      * COCR   - Calculation of Original Cash Rounding for Security = *
057690200529      *          '**CASH**'.                                          *
057700200529      *                                                               *
057710200529      * Called by:                                                    *
057720200529      *                                                               *
057730200529      * Calls:                                                        *
057740200529      *                                                               *
057750200529      *****************************************************************
057760200529      *
057770200529     C           COCR      BEGSR                           ** COCR SR **
057780200529      *
057790200529      ***  Set Original Cash Rounding = Total Original Cash Rounding accumulated for all
057800200529      ***  New Securities.
057810200529      *
057820200529     C                     Z-ADDWTOCAR    WWNUM
057830200529     C           MAPTYP    IFEQ 'CR'
057840200529     C                     Z-ADDECNBDP    WWNBDP
057850200529     C                     ELSE
057860200529     C                     Z-ADDTCDP,1    WWNBDP
057870200529     C                     ENDIF
057880200529     C                     MOVE 'R'       WURROP  1
057890200529     C                     EXSR ROUNDD
057900200529     C                     Z-ADDWWNUM     WWOCAR
057910200529      *
057920200529     C                     ENDSR
057930200529      *
057940200529      *****************************************************************
057950200529      /EJECT
057960200529      *****************************************************************
057970200529      *                                                               *
057980200529      * CACR   - Calculation of Actual Cash Rounding for Security =   *
057990200529      *          '**CASH**'.                                          *
058000200529      *                                                               *
058010200529      * Called by:                                                    *
058020200529      *                                                               *
058030200529      * Calls:                                                        *
058040200529      *                                                               *
058050200529      *****************************************************************
058060200529      *
058070200529     C           CACR      BEGSR                           ** CACR SR **
058080200529      *
058090200529      ***  Set Actual Cash Rounding = Total Actual Cash Rounding accumulated for all
058100200529      ***  New Securities.
058110200529      *
058120200529     C           MAPTYP    IFEQ 'CR'
058130200529     C                     Z-ADDECNBDP    WWNBDP
058140200529     C                     ELSE
058150200529     C                     Z-ADDTCDP,1    WWNBDP
058160200529     C                     ENDIF
058170200529     C                     MOVE 'R'       WURROP
058180200529     C                     EXSR ROUNDD
058190200529     C                     Z-ADDWWNUM     WWACAR
058200200529      *
058210200529     C                     ENDSR
058220200529      *
058230200529      *****************************************************************
058240200529      /EJECT
058250200529      *****************************************************************
058260200529      *                                                               *
058270200529      * CHST   - Calculation of Holding Taken as Stock for Security = *
058280200529      *          '**CASH**'.                                          *
058290200529      *                                                               *
058300200529      * Called by:                                                    *
058310200529      *                                                               *
058320200529      * Calls:                                                        *
058330200529      *                                                               *
058340200529      *****************************************************************
058350200529      *
058360200529     C           CHST      BEGSR                           ** CHST SR **
058370200529      *
058380200529      ***  Set Holding Taken as Stock = same value as preceeding record (= value saved).
058390200529      *
058400200529     C                     Z-ADDESNBDP    WWNBDP
058410200529     C                     MOVE WWRNDN    WUROOP
058420200529     C                     Z-ADDWUHOST    WWNUM
058430200529     C                     EXSR ROUNDD
058440200529     C                     Z-ADDWWNUM     WWHOST
058450200529      *
058460200529     C                     ENDSR
058470200529      *
058480200529      *****************************************************************
058490200529      /EJECT
058500200529      *****************************************************************
058510200529      *                                                               *
058520200529      * CHCA   - Calculation of Holding Taken as Cash for Security =  *
058530200529      *          '**CASH**'.                                          *
058540200529      *                                                               *
058550200529      * Called by:                                                    *
058560200529      *                                                               *
058570200529      * Calls:                                                        *
058580200529      *                                                               *
058590200529      *****************************************************************
058600200529      *
058610200529     C           CHCA      BEGSR                           ** CHCA SR **
058620200529      *
058630200529      ***  Set Holding Taken as Cash = same value as preceeding record (= value saved).
058640200529      *
058650200529     C           MAPTYP    IFEQ 'CR'
058660200529     C                     Z-ADDECNBDP    WWNBDP
058670200529     C                     ELSE
058680200529     C                     Z-ADDTCDP,1    WWNBDP
058690200529     C                     ENDIF
058700200529     C                     MOVE 'R'       WUROOP
058710200529     C                     Z-ADDWUHOCA    WWNUM
058720200529     C                     EXSR ROUNDD
058730200529     C                     Z-ADDWWNUM     WWHOCA
058740200529      *
058750200529     C                     ENDSR
058760200529      *
058770200529      *****************************************************************
058780200529      /EJECT
058790200529      *****************************************************************
058800200529      *                                                               *
058810200529      * COSA2  - 2nd calculation of Original Stock Allocation.        *
058820200529      *                                                               *
058830200529      * Called by:                                                    *
058840200529      *                                                               *
058850200529      * Calls:                                                        *
058860200529      *                                                               *
058870200529      *****************************************************************
058880200529      *
058890200529     C           COSA2     BEGSR                           ** COSA2 SR **
058900200529      *
058910200529      ***  If Processing Type = Dividend Events,
058920200529      ***  calculate Cash Pool = Ex-Date Position multiplied by Dividend Per Unit.
058930200529      *
058940200529     C           MAPTYP    IFEQ 'DV'
058950200529     C******               Z-ADDNSNBDP    WWNBDP                          135690
058960200529     C**********           Z-ADDNCNBDP    WWNBDP                   135690 190204
058970200529     C**********           Z-ADDMDDIVU    WUNUM                           190204
058980200529     C**********           EXSR RTVNDP                                    190204
058990200529     C                     Z-ADDMDDIV1    WWNUM            13,8 => 30,9   190204
059000200529     C           WWTDVD    MULT WWNUM     CASPOO 309
059010200529      *
059020200529      ***  Else, if Processing Type = Exercices and Conversions.
059030200529      *
059040200529     C                     ELSE
059050200529      *
059060200529      ***  If Standard Corporate Actions Instruction exists, set Convertible/Keep work field to
059070200529      ***  Convertible/Keep field retreive from SECOSIL1-2.
059080200529      *
059090200529     C                     MOVE ' '       WWCKIN  1
059100200529     C           EXBCSI    IFEQ 'Y'
059110200529     C           MJOPT5    ANDEQ'Y'                                       156701
059120200529     C           MJOPT6    ANDEQ'Y'                                       156701
059130200529     C                     MOVE MOCKIN    WWCKIN
059140200529     C                     ELSE
059150200529      *
059160200529      ***  Else, if Customer/Book Standard Corporate Actions Instruction does not exist, set
059170200529      ***  Convertible/Keep work field to 'C' if Default for no Reply retreive from SECOEXL1
059180200529      ***  is 1 to 5, else set it to 'K' if Default No Reply = 6 or 7.
059190200529      *
059200200529     C           MDDFNR    IFEQ '1'
059210200529     C           MDDFNR    OREQ '2'
059220200529     C           MDDFNR    OREQ '3'
059230200529     C           MDDFNR    OREQ '4'
059240200529     C           MDDFNR    OREQ '5'
059250200529     C                     MOVE 'C'       WWCKIN
059260200529     C                     ELSE
059270200529     C           MDDFNR    IFEQ '6'
059280200529     C           MDDFNR    OREQ '7'
059290200529     C                     MOVE 'K'       WWCKIN
059300200529     C                     ENDIF
059310200529     C                     ENDIF
059320200529     C                     ENDIF
059330200529      *
059340200529      ***  If Convertible/Keep work field = 'C',calculate % to be converted = 100 - Cash %.
059350200529      ***  and calculate Accept on Holding = Holding (=Ex-Date Position)  136935
059360200529      ***  - Sell on Holding, where Sell on Holding = Holding (=Ex-Date   136935
059370200529      ***  Position multiplied by Cash % previously calculated.           136935
059380200529      *
059390200529     C           WWCKIN    IFEQ 'C'
059400200529     C           100       SUB  WCAPR     PETBCO  52       % to be converted
059410200529     C           WWTDVD    MULT WCAPR     SELHLD 309                      136935
059420200529     C           SELHLD    DIV  100       SELHLD                          136935
059430200529     C           WWTDVD    SUB  SELHLD    ACCHLD 309                      136935
059440200529      *
059450200529      ***  Else, if Convertible/Keep work field not 'K' (no conversion), set % to be converted to 0.
059460200529      ***  and Accept on Holding to 0.                                    136935
059470200529      *
059480200529     C                     ELSE
059490200529     C                     Z-ADD0         PETBCO           % to be converted
059500200529     C                     Z-ADD0         ACCHLD                          136935
059510200529     C                     ENDIF
059520200529      *
059530200529      *****Calculate*Nominal*to*be*converted*=*Ex-Date*Position********** 136935
059540200529      *****multiplied*by*%*to*be*converted.****************************** 136935
059550200529      ***  Calculate Nominal to be converted = Accept on Holding          136935
059560200529      ***  multiplied by % to be converted.                               136935
059570200529      *
059580200529     C******     WWTDVD    MULT PETBCO    NMTBCO 309                      136935
059590200529     C           ACCHLD    MULT PETBCO    NMTBCO 309                      136935
059600200529     C           NMTBCO    DIV  100       NMTBCO           Nominal to be converted
059610200529      *
059620200529      ***  Calculate Cash Pool = Nominal to be converted multiplied by Conversion Price multiplied
059630200529      ***  by Exchange Rate.
059640200529      *
059650200529     C           NMTBCO    MULT MJCPRC    CASPOW 309
059660200529      *
059670200529      ***  If Price Basis is 'P' for %, result should be divided by 100.
059680200529      *
059690200529     C           NSSPBS    IFEQ 'P'
059700200529     C           CASPOW    DIV  100       CASPOW    H
059710200529     C                     ENDIF
059720200529     C           CASPOW    MULT MJCEXR    CASPOO 309       Cash Pool
059730200529     C                     ENDIF
059740200529      *
059750200529      ***  Calculate work field BB = Cash Pool divided by Subscription Price.
059760200529      *
059770200529     C           CASPOO    DIV  MDSBPR    FLDBB  309
059780200529      *
059790200529      ***  If Price Basis is 'P' for %, result should be divided by 100.
059800200529      *
059810200529     C           NSSPBS    IFEQ 'P'
059820200529     C           FLDBB     DIV  100       FLDBB     H
059830200529     C                     ENDIF
059840200529      *
059850200529      ***  Calculate work field B = work field BB rounded down if Rounding Indicator from Corporate
059860200529      ***  Actions Details file = 'D' or half adjust if Rounding = 'R' (rounded is perform to
059870200529      ***  Number of Decimal Places of New Security).
059880200529      *
059890200529     C                     Z-ADDFLDBB     WWNUM
059900200529     C                     MOVE WWRNDN    WUROOP
059910200529     C                     Z-ADDNSNBDP    WWNBDP
059920200529     C                     EXSR ROUNDD
059930200529     C                     Z-ADDWWNUM     FLDB   309
059940200529      *
059950200529      ***  Calculate work field C = work field B divided by Denomination Multiplier.
059960200529      *
059970200529     C           FLDB      DIV  WWDMLT    FLDC   309
059980200529      *
059990200529      ***  Calculate work field CA = work field C rounding down to nearest unit if Rounding
060000200529      ***  Indicator from Corporate Actions Detail file = 'D' or half adjust to nearest unit
060010200529      ***  if Rounding = 'R'.
060020200529      *
060030200529     C           WWRNDN    IFEQ 'D'
060040200529     C           WWRNDN    OREQ 'U'                                       135686
060050200529     C                     Z-ADDFLDC      FLDCA
060060200529     C                     ELSE
060070200529     C                     Z-ADDFLDC      FLDCA     H
060080200529     C                     ENDIF
060090200529      *
060100200529      ***  Calculate Original Stock Allocation = work field CA multiplied by Denomination
060110200529      ***  Multiplier.
060120200529      *
060130200529     C           FLDCA     MULT WWDMLT    WWOALR
060140200529      *                                                                   135686
060150200529     C           WWRNDN    IFEQ 'U'                                       135686
060160200529     C           WWOALR    ANDNEFLDB                                      135686
060170200529     C                     ADD  WWDMLT    WWOALR                          135686
060180200529     C                     ENDIF                                          135686
060190200529      *
060200200529      ***  Set Original Stock Allocation calculated.
060210200529      *
060220200529     C                     Z-ADDNSNBDP    WWNBDP           New Security Decimal Places
060230200529     C                     MOVE WWRNDN    WUROOP           Rounding from CO Detail file
060240200529     C                     Z-ADDWWOALR    WWNUM
060250200529     C                     EXSR ROUNDD
060260200529     C                     Z-ADDWWNUM     WWOALR
060270200529      *
060280200529     C                     ENDSR
060290200529      *
060300200529      *****************************************************************
060310200529      /EJECT
060320200529      *****************************************************************
060330200529      *                                                               *
060340200529      * CTSA2  - 2nd calculation of True Stock Allocation.            *
060350200529      *                                                               *
060360200529      * Called by:                                                    *
060370200529      *                                                               *
060380200529      * Calls:                                                        *
060390200529      *                                                               *
060400200529      *****************************************************************
060410200529      *
060420200529     C           CTSA2     BEGSR                           ** CTSA2 SR **
060430200529      *
060440200529      ***  Calculate True Stock Allocation = work field BB calculated previously.
060450200529      *
060460200529     C                     Z-ADDFLDBB     WWOTSA
060470200529      *
060480200529      ***  Set True Stock Allocation calculated.
060490200529      *
060500200529     C                     Z-ADDNSNBDP    WWNBDP           New Security Decimal Places
060510200529     C                     Z-ADD8         WWNBDP           Decimal Places = 8
060520200529     C                     Z-ADDWWOTSA    WWNUM
060530200529     C                     EXSR ROUNDD
060540200529     C                     Z-ADDWWNUM     WWOTSA
060550200529      *
060560200529     C                     ENDSR
060570200529      *
060580200529      *****************************************************************
060590200529      /EJECT
060600200529      *****************************************************************
060610200529      *                                                               *
060620200529      * COCR2  - 2nd calculation of Original Cash Rounding.           *
060630200529      *                                                               *
060640200529      * Called by:                                                    *
060650200529      *                                                               *
060660200529      * Calls:                                                        *
060670200529      *                                                               *
060680200529      *****************************************************************
060690200529      *
060700200529     C           COCR2     BEGSR                           ** COCR2 SR **
060710200529      *
060720200529      ***  If Rounding Settlement in Cash = 'Y', Original Cash Rounding = (Holding (Ex-Date
060730200529      ***  Position) multiplied by Dividend Per Unit) - (Original Stock Allocation previously
060740200529      ***  calculated multiplied by Subscription Price).
060750200529      ***  Use Conversion Price multiplied by Exchange Rate instead of    136935
060760200529      ***  Dividend Per Unit if Processing Type = Exercices and           136935
060770200529      ***  Conversions (= if not 'DV').                                   136935
060780200529      *
060790200529     C           WWRNDS    IFEQ 'Y'
060800200529     C           MAPTYP    IFEQ 'DV'                                      136935
060810200529     C******               Z-ADDNSNBDP    WWNBDP                          135690
060820200529     C**********           Z-ADDNCNBDP    WWNBDP                   135690 190204
060830200529     C**********           Z-ADDMDDIVU    WUNUM                           190204
060840200529     C**********           EXSR RTVNDP                                    190204
060850200529     C                     Z-ADDMDDIV1    WWNUM            13,8 => 30,9   190204
060860200529     C           WWTDVD    MULT WWNUM     FLDGW  309
060870200529     C                     ELSE                                           136935
060880200529     C           WWTDVD    MULT MJCPRC    FLDGW                           136935
060890200529     C           FLDGW     MULT MJCEXR    FLDGW                           136935
060900200529     C                     ENDIF                                          136935
060910200529     C           WWOALR    MULT MDSBPR    WUOCAR 309
060920200529      *
060930200529      ***  If Price Basis is 'P' for %, result should be divided by 100.
060940200529      *
060950200529     C           NSSPBS    IFEQ 'P'
060960200529     C           WUOCAR    DIV  100       WUOCAR
060970200529     C                     ENDIF
060980200529     C           FLDGW     SUB  WUOCAR    WWOCAR
060990200529      *
061000200529      ***  Set Original Cash Rounding calculated.
061010200529      *
061020200529     C                     Z-ADDNCNBDP    WWNBDP           New Currency Decimal Places
061030200529     C                     MOVE 'R'       WUROOP           Rounding = half adjust
061040200529     C                     Z-ADDWWOCAR    WWNUM
061050200529     C                     EXSR ROUNDD
061060200529     C                     Z-ADDWWNUM     WWOCAR
061070200529      *
061080200529      ***  Else, If Rounding Settlement in Cash not equal 'Y', set Original Cash Rounding
061090200529      ***  to zero.
061100200529      *
061110200529     C                     ELSE
061120200529     C                     Z-ADD0         WWOCAR
061130200529     C                     ENDIF
061140200529      *
061150200529     C                     ENDSR
061160200529      *
061170200529      *****************************************************************
061180200529      /EJECT
061190200529      *****************************************************************
061200200529      *                                                               *
061210200529      * CASADP - Calculate Actual Stock Allocation for Depot.         *
061220200529      *                                                               *
061230200529      * Called by:                                                    *
061240200529      *                                                               *
061250200529      * Calls:                                                        *
061260200529      *                                                               *
061270200529      *****************************************************************
061280200529      *
061290200529     C           CASADP    BEGSR                           ** CASADP SR **
061300200529      *
061310200529     C           MAPTYP    IFEQ 'DV'                       If Processing Type = Dividends Events
061320200529     C           MDSDIT    ANDEQ'S'                           Stock Dividend Type = Stock for Stock
061330200529     C           MDOSHA    ANDNE0                             Number of Old Shares not zero
061340200529     C           WWNSHA    ANDNE0                             Number of New Shares not zero
061350200529      *
061360200529     C           MAPTYP    OREQ 'DV'                       Or Processing Type = Dividends Events
061370200529     C           MDSDIT    ANDEQ'C'                           Stk Dividend Tp=Combined for Cash&Stk
061380200529     C           MDOSHA    ANDNE0                             Number of Old Shares not zero
061390200529     C           WWNSHA    ANDNE0                             Number of New Shares not zero
061400200529      *
061410200529     C           MAPTYP    OREQ 'DV'                       Or Processing Type = Dividends Events
061420200529     C           MDSDIT    ANDEQ'O'                           Stk Dividend Tp=Optional for Cash&Stk
061430200529     C           MDOSHA    ANDNE0                             Number of Old Shares not zero
061440200529     C           WWNSHA    ANDNE0                             Number of New Shares not zero
061450200529      *
061460200529     C           MAPTYP    OREQ 'CR'                       Or Proces.Type = Corporate Reorganisation
061470200529     C           MDOSHA    ANDNE0                             Number of Old Shares not zero
061480200529     C           WWNSHA    ANDNE0                             Number of New Shares not zero
061490200529      ******                                                              136935
061500200529     C******     MAPTYP    OREQ 'OF'                       Or Exchange    136935
061510200529     C******     MIOFTY    ANDEQ'E'                           Offer       136935
061520200529     C******     MDOSHA    ANDNE0                             Old Sh.not 0136935
061530200529     C******     WWNSHA    ANDNE0                             New Sh.not 0136935
061540200529      ******                                                              136935
061550200529     C******     MAPTYP    OREQ 'OF'                       Or Subscript.  136935
061560200529     C******     MIOFTY    ANDEQ'S'                           Offers      136935
061570200529     C******     MDOSHA    ANDNE0                             Old Sh.not 0136935
061580200529     C******     WWNSHA    ANDNE0                             New Sh.not 0136935
061590200529      *                                                                   156690
061600200529     C           MAPTYP    OREQ 'OF'                       Or Exchange    156690
061610200529     C           MIOFTY    ANDEQ'E'                           Offer       156690
061620200529     C           MDOSHA    ANDNE0                             Old Sh.not 0156690
061630200529     C           WWNSHA    ANDNE0                             New Sh.not 0156690
061640200529      *                                                                   156690
061650200529     C           MAPTYP    OREQ 'OF'                       Or Subscript.  156690
061660200529     C           MIOFTY    ANDEQ'S'                           Offers      156690
061670200529     C           MDOSHA    ANDNE0                             Old Sh.not 0156690
061680200529     C           WWNSHA    ANDNE0                             New Sh.not 0156690
061690200529      *
061700200529     C           MAPTYP    OREQ 'EX'                       Or Proces.Type= Exercices and Conversion
061710200529     C           MDOSHA    ANDNE0                             Number of Old Shares not zero
061720200529     C           WWNSHA    ANDNE0                             Number of New Shares not zero
061730200529     C*****      MDSBPR    ANDNE0                             Subscription136935
061740200529      *
061750200529     C           MAPTYP    OREQ 'FR'                       Or Processing Type = Free Allocation
061760200529     C           MDOSHA    ANDNE0                             Number of Old Shares not zero
061770200529     C           WWNSHA    ANDNE0                             Number of New Shares not zero
061780200529      *
061790200529     C           MAPTYP    OREQ 'RG'                       Or Processing Type = Rights Issues
061800200529     C           MDOSHA    ANDNE0                             Number of Old Shares not zero
061810200529     C           WWNSHA    ANDNE0                             Number of New Shares not zero
061820200529      *                                                                   CEU017
061830200529      ***  Or Processing Type = Currency Changes and Old and New Nominal  CEU017
061840200529      ***  Size not zero.                                                 CEU017
061850200529      *                                                                   CEU017
061860200529     C           MAPTYP    OREQ 'CC'                                      CEU017
061870200529     C           MDOSHA    ANDNE0                                         CEU017
061880200529     C           WWNSHA    ANDNE0                                         CEU017
061890200529      *                                                                                       193662
061900200529     C           MAPTYP    IFEQ 'OF'                                                          193662
061910200529     C           MIOFTY    ANDEQ'S'                                                           193662
061920200529     C                     Z-ADDWTHOST    WWASTA                                              193662
061930200529     C                     Z-ADDWWASTA    WUASTA                                              193662
061940200529     C                     ELSE                                                               193662
061950200529      *
061960200529      ***  Calculate work field A = Total Holding Taken as Stock calculated before divided by
061970200529      ***  Number of Old Shares.
061980200529      *
061990200529     C           WTHOST    DIV  MDOSHA    FLDA   309
062000200529      *
062010200529      ***  Calculate work field AA = work field A rounded down if Rounding Indicator from Corporate
062020200529      ***  Actions Details file = 'D' or half adjust if Rounding = 'R' (rounded is perform to
062030200529      ***  Number of Decimal Places of New Security).
062040200529      *
062050200529     C                     Z-ADDFLDA      WWNUM
062060200529     C                     Z-ADDNSNBDP    WWNBDP
062070200529     C                     MOVE WWRNDN    WUROOP  1
062080200529     C                     EXSR ROUNDD
062090200529     C                     Z-ADDWWNUM     FLDAA  309
062100200529      *
062110200529      ***  Calculate work field B = work field AA multiplied by Number of New Shares.
062120200529      *
062130200529     C           WWRNDN    IFEQ 'B'                                       149153
062140200529     C           1         MULT WWNSHA    FLDB                            149153
062150200529     C                     ELSE                                           149153
062160200529     C********** FLDAA     MULT WWNSHA    FLDB                            161419
062170200529     C           FLDA      MULT WWNSHA    FLDB                            161419
062180200529     C                     ENDIF                                          149153
062190200529      *
062200200529      ***  Calculate work field C = work field B divided by Denomination Multilier.
062210200529      *
062220200529     C           FLDB      DIV  WWDMLT    FLDC   309
062230200529      *
062240200529      ***  Calculate work field CA = work field C rounded down to nearest unit if Rounding Indicator
062250200529      ***  from CO Details file = 'D' or half adjust to nearest unit if Rounding = 'R'.
062260200529      *
062270200529     C           WWRNDN    IFEQ 'D'
062280200529     C           WWRNDN    OREQ 'U'                                       135686
062290200529     C           WWRNDN    OREQ 'B'                                       149153
062300200529     C           WWRNDN    OREQ 'O'                                       149782
062310200529     C                     Z-ADDFLDC      FLDCA
062320200529     C                     ELSE
062330200529     C                     Z-ADDFLDC      FLDCA     H
062340200529     C                     ENDIF
062350200529      *
062360200529      ***  Calculate Actual Stock Allocation = work field CA multiplied by Denomination
062370200529      ***  Multiplier.
062380200529      *
062390200529     C           FLDCA     MULT WWDMLT    WWASTA
062400200529      *                                                                   135686
062410200529     C           WWRNDN    IFEQ 'U'                                       135686
062420200529     C           WWASTA    ANDNEFLDB                                      135686
062430200529     C                     ADD  WWDMLT    WWASTA                          135686
062440200529     C                     ENDIF                                          135686
062450200529      *                                                                   149153
062460200529     C           WWRNDN    IFEQ 'B'                                       149153
062470200529     C           WWASTA    MULT FLDAA     WWASTA                          149153
062480200529     C                     ENDIF                                          149153
062490200529      *                                                                                       193662
062500200529     C                     ENDIF                                                              193662
062510200529      *
062520200529     C                     ENDIF
062530200529      *
062540200529     C           MAPTYP    IFEQ 'DV'                       If Processing Type = Dividends Events
062550200529     C           MDSDIT    ANDEQ'S'                           Stock Dividend Type = Stock for Stock
062560200529     C********** MDDIVU    ANDNE0                             Dividend per Unit not zero      190204
062570200529     C           MDDIV1    ANDNE0                             Dividend per Unit not zero      190204
062580200529     C           MDSBPR    ANDNE0                             Subscription Price not zero
062590200529      *
062600200529     C           MAPTYP    OREQ 'DV'                       If Processing Type = Div Events    215071
062610200529     C           MDSDIT    ANDEQ'O'                           Stock Div Tp=Opt for cash stock 215071
062620200529     C           MDDIV1    ANDNE0                             Dividend per Unit not zero      215071
062630200529     C           MDSBPR    ANDNE0                             Subscription Price not zero     215071
062640200529      *                                                                                       215071
062650200529      ***  Calculate Cash Pool = Total Holding Taken as Stock previously calculated multiplied by
062660200529      ***  Dividend Per Unit.
062670200529      *
062680200529     C******               Z-ADDTSDP,I    WWNBDP                          135690
062690200529     C**********           Z-ADDTCDP,I    WWNBDP                   135690 190204
062700200529     C**********           Z-ADDMDDIVU    WUNUM                           190204
062710200529     C**********           EXSR RTVNDP                                    190204
062750200529     C                     Z-ADDMDDIV1    WWNUM            13,8 ==> 30,9  190204
062760200529     C           WTHOST    MULT WWNUM     CASPOO 309
062770200529      *
062780200529      ***  Calculate work field BB = Cash Pool divided by Subscription Price.
062790200529      *
062800200529     C           CASPOO    DIV  MDSBPR    FLDBB  309
062810200529      *
062820200529      ***  If Price Basis is 'P' for %, result should be divided by 100.
062830200529      *
062840200529     C           NSSPBS    IFEQ 'P'
062850200529     C           FLDBB     DIV  100       FLDBB     H
062860200529     C                     ENDIF
062870200529      *
062880200529      ***  Calculate work field B = work field BB rounded down if Rounding Indicator from Corporate
062890200529      ***  Actions Details file = 'D' or half adjust if Rounding = 'R' (rounded is perform to
062900200529      ***  Number of Decimal Places of New Security).
062910200529      *
062920200529     C                     Z-ADDFLDBB     WWNUM
062930200529     C                     MOVE WWRNDN    WUROOP
062940200529     C                     Z-ADDNSNBDP    WWNBDP
062950200529     C                     EXSR ROUNDD
062960200529     C                     Z-ADDWWNUM     FLDB   309
062970200529      *
062980200529      ***  Calculate work field C = work field B divided by Denomination Multiplier.
062990200529      *
063000200529     C           FLDB      DIV  WWDMLT    FLDC   309
063010200529      *
063020200529      ***  Calculate work field CA = work field C rounded down to nearest unit if Rounding Indicator
063030200529      ***  from CO Details file = 'D' or half adjust to nearest unit if Rounding = 'R'.
063040200529      *
063050200529     C           WWRNDN    IFEQ 'D'
063060200529     C           WWRNDN    OREQ 'U'                                       135686
063070200529     C                     Z-ADDFLDC      FLDCA
063080200529     C                     ELSE
063090200529     C                     Z-ADDFLDC      FLDCA     H
063100200529     C                     ENDIF
063110200529      *
063120200529      ***  Calculate Actual Stock Allocation = work field CA multiplied by Denomination
063130200529      ***  Multiplier.
063140200529      *
063150200529     C           FLDCA     MULT WWDMLT    WWASTA
063160200529      *                                                                   135686
063170200529     C           WWRNDN    IFEQ 'U'                                       135686
063180200529     C           WWASTA    ANDNEFLDB                                      135686
063190200529     C                     ADD  WWDMLT    WWASTA                          135686
063200200529     C                     ENDIF                                          135686
063210200529      *
063230200529     C                     ENDIF
063240200529      *
063250200529     C           MAPTYP    IFEQ 'DV'                       If Processing Type = Dividends Events
063260200529     C           MDSDIT    ANDEQ'R'                           Stk Dividend Tp=Reinvestment of Divid.
063270200529     C********** MDDIVU    ANDNE0                             Dividend per Unit not zero      190204
063280200529     C           MDDIV1    ANDNE0                             Dividend per Unit not zero      190204
063290200529     C           MDSBPR    ANDNE0                             Subscription Price not zero
063300200529      *
063310200529     C           MAPTYP    OREQ 'EX'                       Or Proces.Type= Exercices and Conversion
063320200529     C           MJCPRC    ANDNE0                             Conversion Price not zero
063330200529     C           MJCEXR    ANDNE0                             Exchange Rate not zero
063340200529     C           MDSBPR    ANDNE0                             Subscription Price not zero
063350200529      *                                                                   136935
063360200529     C           MAPTYP    OREQ 'OF'                       Or Purchase    136935
063370200529     C           MIOFTY    ANDEQ'P'                           Offer       136935
063380200529      *
063390200529      ***  Calculate Actual Stock Allocation = Total of all Actual Stock Allocation for all
063400200529      ***  Customer/Books, and accumulate Actual Stock Allocation.
063410200529      *
063420200529     C                     Z-ADDWTASTA    WWASTA
063430200529     C                     ADD  WWASTA    TWASTA 309
063440200529     C                     ENDIF
063450200529      *****                                                        136935 156690
063460200529      *****If*Processing*Type*=*Offers*with*Offer*Type*=*Subscripti136935 156690
063470200529      *****Exchange,*calculate*Actual*Stock*Allocation*=*Original*S136935 156690
063480200529      *****Allocation*previously*calculated*multiplied*by*Stock*Pre136935 156690
063490200529      *****%.******************************************************136935 156690
063500200529      *****                                                        136935 156690
063510200529     C*****      MAPTYP    IFEQ 'OF'                               136935 156690
063520200529     C*****      MIOFTY    ANDEQ'S'                                136935 156690
063530200529     C*****      MAPTYP    OREQ 'OF'                               136935 156690
063540200529     C*****      MIOFTY    ANDEQ'E'                                136935 156690
063550200529     C*****      100       SUB  WCAPR     WSTPR                    136935 156690
063560200529     C*****      WWOALR    MULT WSTPR     WWASTA                   136935 156690
063570200529     C*****      WWASTA    DIV  100       WWASTA                   136935 156690
063580200529     C*****                Z-ADDWWASTA    WUASTA                   136935 156690
063590200529     C*****                ENDIF                                   136935 156690
063600200529      *
063610200529      ***  Set Actual Stock Allocation calculated.
063620200529      *
063630200529     C                     Z-ADDNSNBDP    WWNBDP
063640200529     C                     MOVE WWRNDN    WUROOP
063650200529     C                     Z-ADDWWASTA    WWNUM
063660200529     C                     EXSR ROUNDD
063670200529     C                     Z-ADDWWNUM     WWASTA
063680200529      *
063690200529     C                     ENDSR
063700200529      *
063710200529      *****************************************************************
063720200529      /EJECT
063730200529      *****************************************************************
063740200529      *                                                               *
063750200529      * CHSTDP - Calculate Holding Taken as Stock for Depot.          *
063760200529      *                                                               *
063770200529      * Called by:                                                    *
063780200529      *                                                               *
063790200529      * Calls:                                                        *
063800200529      *                                                               *
063810200529      *****************************************************************
063820200529      *
063830200529     C           CHSTDP    BEGSR                           ** CHSTDP SR **
063840200529      *
063850200529      ***  Calculate Holding Taken as Stock = Total of all Customers and Books Holdings Taken
063860200529      ***  as Stock calculated, and save value.
063870200529      *
063880200529     C                     Z-ADDWTHOST    WWHOST
063890200529     C                     Z-ADDWWHOST    WUHOST
063900200529      *
063910200529      ***  Set Holding Taken as Stock calculated.
063920200529      *
063930200529     C                     Z-ADDESNBDP    WWNBDP
063940200529     C                     MOVE WWRNDN    WUROOP
063950200529     C                     Z-ADDWWHOST    WWNUM
063960200529     C                     EXSR ROUNDD
063970200529     C                     Z-ADDWWNUM     WWHOST
063980200529      *
063990200529     C                     ENDSR
064000200529      *
064010200529      *****************************************************************
064020200529      /EJECT
064030200529      *****************************************************************
064040200529      *                                                               *
064050200529      * CHCADP - Calculate Holding Taken as Cash for Depot.           *
064060200529      *                                                               *
064070200529      * Called by:                                                    *
064080200529      *                                                               *
064090200529      * Calls:                                                        *
064100200529      *                                                               *
064110200529      *****************************************************************
064120200529      *
064130200529     C           CHCADP    BEGSR                           ** CHCADP SR **
064140200529      *
064150200529      ***  Calculate Holding Taken as Cash = Total of all Customers and Books Holdings Taken
064160200529      ***  as Cash calculated, and save value.
064170200529      *
064180200529     C                     Z-ADDWTHOCA    WWHOCA
064190200529     C                     Z-ADDWWHOCA    WUHOCA
064200200529      *
064210200529      ***  Set Holding Taken as Cash calculated.
064220200529      *
064230200529     C                     Z-ADDNCNBDP    WWNBDP
064240200529     C                     MOVE 'R'       WUROOP
064250200529     C                     Z-ADDWWHOCA    WWNUM
064260200529     C                     EXSR ROUNDD
064270200529     C                     Z-ADDWWNUM     WWHOCA
064280200529      *
064290200529     C                     ENDSR
064300200529      *
064310200529      *****************************************************************
064320200529      /EJECT
064330200529      *****************************************************************
064340200529      *                                                               *
064350200529      * CASRDP - Calculate Actual Stock Rounding for Depot.           *
064360200529      *                                                               *
064370200529      * Called by:                                                    *
064380200529      *                                                               *
064390200529      * Calls:                                                        *
064400200529      *                                                               *
064410200529      *****************************************************************
064420200529      *
064430200529     C           CASRDP    BEGSR                           ** CASRDP SR **
064440200529      *
064450200529     C           MAPTYP    IFEQ 'DV'                       If Processing Type = Dividends Events
064460200529     C           MDSDIT    ANDEQ'R'                           Stk Dividend Tp=Reinvestment of Divid.
064470200529     C********** MDDIVU    ANDNE0                             Dividend per Unit not zero      190204
064480200529     C           MDDIV1    ANDNE0                             Dividend per Unit not zero      190204
064490200529     C           MDSBPR    ANDNE0                             Subscription Price not zero
064500200529      *
064510200529     C           MAPTYP    OREQ 'EX'                       Or Proces.Type= Exercices and Conversion
064520200529     C           MJCPRC    ANDNE0                             Conversion Price not zero
064530200529     C           MJCEXR    ANDNE0                             Exchange Rate not zero
064540200529     C           MDSBPR    ANDNE0                             Subscription Price not zero
064550200529      *
064560200529      ***  Set Actual Stock Rounding to 0.
064570200529      *
064580200529     C                     Z-ADD0         WWASTR
064590200529      *
064600200529     C                     ELSE
064610200529      *
064620200529     C           MAPTYP    IFEQ 'DV'                       If Processing Type = Dividends Events
064630200529     C           MDSDIT    ANDEQ'S'                           Stock Dividend Type = Stock for Stock
064640200529     C           MDOSHA    ANDNE0                             Number of Old Shares not zero
064650200529     C           WWNSHA    ANDNE0                             Number of New Shares not zero
064660200529      *
064670200529     C           MAPTYP    OREQ 'DV'                       Or Processing Type = Dividends Events
064680200529     C           MDSDIT    ANDEQ'C'                           Stk Dividend Tp=Combined for Cash&Stk
064690200529     C           MDOSHA    ANDNE0                             Number of Old Shares not zero
064700200529     C           WWNSHA    ANDNE0                             Number of New Shares not zero
064710200529      *
064720200529     C           MAPTYP    OREQ 'DV'                       Or Processing Type = Dividends Events
064730200529     C           MDSDIT    ANDEQ'O'                           Stk Dividend Tp=Optional for Cash&Stk
064740200529     C           MDOSHA    ANDNE0                             Number of Old Shares not zero
064750200529     C           WWNSHA    ANDNE0                             Number of New Shares not zero
064760200529      *
064770200529     C           MAPTYP    OREQ 'CR'                       Or Proces.Type = Corporate Reorganisation
064780200529     C           MDOSHA    ANDNE0                             Number of Old Shares not zero
064790200529     C           WWNSHA    ANDNE0                             Number of New Shares not zero
064800200529      *
064810200529     C           MAPTYP    OREQ 'OF'                       Or Processing Type = Offers
064820200529     C           MIOFTY    ANDEQ'E'                           Offer Type = Exchange Offers
064830200529     C           MDOSHA    ANDNE0                             Number of Old Shares not zero
064840200529     C           WWNSHA    ANDNE0                             Number of New Shares not zero
064850200529      *
064860200529      ******                                                              136935
064870200529     C******     MAPTYP    OREQ 'OF'                       Or Subscript.  136935
064880200529     C******     MIOFTY    ANDEQ'S'                           Offers      136935
064890200529     C******     MDOSHA    ANDNE0                             Old Sh.not 0136935
064900200529     C******     WWNSHA    ANDNE0                             New Sh.not 0136935
064910200529      *
064920200529     C           MAPTYP    OREQ 'EX'                       Or Proces.Type= Exercices and Conversion
064930200529     C           MDOSHA    ANDNE0                             Number of Old Shares not zero
064940200529     C           WWNSHA    ANDNE0                             Number of New Shares not zero
064950200529     C*****      MDSBPR    ANDNE0                             Subscription136935
064960200529      *
064970200529     C           MAPTYP    OREQ 'FR'                       Or Processing Type = Free Allocation
064980200529     C           MDOSHA    ANDNE0                             Number of Old Shares not zero
064990200529     C           WWNSHA    ANDNE0                             Number of New Shares not zero
065000200529      *
065010200529     C           MAPTYP    OREQ 'RG'                       Or Processing Type = Rights Issues
065020200529     C           MDOSHA    ANDNE0                             Number of Old Shares not zero
065030200529     C           WWNSHA    ANDNE0                             Number of New Shares not zero
065040200529      *                                                                   CEU017
065050200529      ***  Or Processing Type = Currency Changes and Old and New Nominal  CEU017
065060200529      ***  Size not zero.                                                 CEU017
065070200529      *                                                                   CEU017
065080200529     C           MAPTYP    OREQ 'CC'                                      CEU017
065090200529     C           MDOSHA    ANDNE0                                         CEU017
065100200529     C           WWNSHA    ANDNE0                                         CEU017
065110200529      *
065120200529      ***  Calculate work field A = Total of all Customers and Books Holdings Taken as Stock
065130200529      ***  divided by Number of Old Shares.
065140200529      *
065150200529     C           WTHOST    DIV  MDOSHA    FLDA   309
065160200529      *
065170200529      ***  Calculate True Stock Allocation (using Total of all Customers and Books Holdings Taken
065180200529      ***  as Stock as Holding) = work field A previously calculated multiplied by Number of New
065190200529      ***  Shares.
065200200529      *
065210200529     C           FLDA      MULT WWNSHA    WUOTSA 309
065220200529     C                     ENDIF
065230200529      *
065240200529     C           MAPTYP    IFEQ 'DV'                       If Processing Type = Dividends Events
065250200529     C           MDSDIT    ANDEQ'S'                           Stock Dividend Type = Stock for Stock
065260200529     C********** MDDIVU    ANDNE0                             Dividend per Unit not zero      190204
065270200529     C           MDDIV1    ANDNE0                             Dividend per Unit not zero      190204
065280200529     C           MDSBPR    ANDNE0                             Subscription Price not zero
065290200529      *
065300200529     C           MAPTYP    OREQ 'DV'                       If Processing Type = Div Events    215071
065310200529     C           MDSDIT    ANDEQ'O'                           Stock Div Tp=Opt for cash stock 215071
065320200529     C           MDDIV1    ANDNE0                             Dividend per Unit not zero      215071
065330200529     C           MDSBPR    ANDNE0                             Subscription Price not zero     215071
065340200529      *                                                                                       215071
065350200529      ***  Calculate Cash Pool = Total of all Customers and Books Holdings Taken as Stock multiplied
065360200529      ***  by Dividend Per Unit.
065370200529      *
065380200529     C******               Z-ADDNSNBDP    WWNBDP                          135690
065390200529     C**********           Z-ADDNCNBDP    WWNBDP                   135690 190204
065400200529     C**********           Z-ADDMDDIVU    WUNUM                           190204
065410200529     C**********           EXSR RTVNDP                                    190204
065420200529     C                     Z-ADDMDDIV1    WWNUM            13,8 ==> 30,9  190204
065430200529     C           WTHOST    MULT WWNUM     CASPOO 309
065440200529      *
065450200529      ***  Calculate work field BB = Cash Pool divided by Subscription Price.
065460200529      *
065470200529     C           CASPOO    DIV  MDSBPR    FLDBB  309
065480200529      *
065490200529      ***  If Price Basis is 'P' for %, result should be divided by 100.
065500200529      *
065510200529     C           NSSPBS    IFEQ 'P'
065520200529     C           FLDBB     DIV  100       FLDBB     H
065530200529     C                     ENDIF
065540200529      *
065550200529      ***  Set True Stock Allocation (using Total of all Customers and Books Holdings Taken
065560200529      ***  as Stock as Holding) = work field BB previously calculated.
065570200529      *
065580200529     C                     Z-ADDFLDBB     WUOTSA
065590200529     C                     ENDIF
065600200529      *
065610200529      ***  Calculate Actual Stock Rounding = True Stock Allocation (using Total of all Customers and
065620200529      ***  Books Holdings Taken as Stock) - Actual Stock Allocation previously calculated.
065630200529      *
065670200529     C           WUOTSA    SUB  WWASTA    WWASTR
065690200529     C                     ENDIF
065700200529      *
065710200529      ***  Set Actual Stock Rounding calculated.
065720200529      *
065730200529     C                     Z-ADD8         WWNBDP
065740200529     C                     MOVE WWRNDN    WUROOP
065750200529     C                     Z-ADDWWASTR    WWNUM
065760200529     C                     EXSR ROUNDD
065770200529     C                     Z-ADDWWNUM     WWASTR
065780200529      *
065790200529     C                     ENDSR
065800200529      *
065810200529      *****************************************************************
065820200529      /EJECT
065830200529      *****************************************************************
065840200529      *                                                               *
065850200529      * CACRDP - Calculate Actual Cash Rounding for Depot.            *
065860200529      *                                                               *
065870200529      * Called by:                                                    *
065880200529      *                                                               *
065890200529      * Calls:                                                        *
065900200529      *                                                               *
065910200529      *****************************************************************
065920200529      *
065930200529     C           CACRDP    BEGSR                           ** CACRDP SR **
065940200529      *
065950200529     C           MAPTYP    IFEQ 'DV'                       If Processing Type = Dividends Events
065960200529     C           MDSDIT    ANDEQ'S'                           Stock Dividend Type = Stock for Stock
065970200529     C           MDOSHA    ANDNE0                             Number of Old Shares not zero
065980200529     C           WWNSHA    ANDNE0                             Number of New Shares not zero
065990200529      *
066000200529     C           MAPTYP    OREQ 'DV'                       Or Processing Type = Dividends Events
066010200529     C           MDSDIT    ANDEQ'C'                           Stk Dividend Tp=Combined for Cash&Stk
066020200529     C           MDOSHA    ANDNE0                             Number of Old Shares not zero
066030200529     C           WWNSHA    ANDNE0                             Number of New Shares not zero
066040200529      *
066050200529     C           MAPTYP    OREQ 'DV'                       Or Processing Type = Dividends Events
066060200529     C           MDSDIT    ANDEQ'O'                           Stk Dividend Tp=Optional for Cash&Stk
066070200529     C           MDOSHA    ANDNE0                             Number of Old Shares not zero
066080200529     C           WWNSHA    ANDNE0                             Number of New Shares not zero
066090200529      *
066100200529     C           MAPTYP    OREQ 'FR'                       Or Processing Type = Free Allocation
066110200529     C           MDOSHA    ANDNE0                             Number of Old Shares not zero
066120200529     C           WWNSHA    ANDNE0                             Number of New Shares not zero
066130200529      *
066140200529     C           MAPTYP    OREQ 'RG'                       Or Processing Type = Rights Issues
066150200529     C           MDOSHA    ANDNE0                             Number of Old Shares not zero
066160200529     C           WWNSHA    ANDNE0                             Number of New Shares not zero
066170200529      *
066180200529     C           MAPTYP    OREQ 'CR'                       Or Proces.Type = Corporate Reorganisation
066190200529     C           MDOSHA    ANDNE0                             Number of Old Shares not zero
066200200529     C           WWNSHA    ANDNE0                             Number of New Shares not zero
066210200529      *
066220200529     C           MAPTYP    OREQ 'OF'                       Or Processing Type = Offers
066230200529     C           MDOSHA    ANDNE0                             Number of Old Shares not zero
066240200529     C           WWNSHA    ANDNE0                             Number of New Shares not zero
066250200529      *
066260200529     C           MAPTYP    OREQ 'EX'                       Or Proces.Type= Exervices and Conversions
066270200529     C           MDOSHA    ANDNE0                             Number of Old Shares not 0
066280200529     C           WWNSHA    ANDNE0                             Number of New Shares not 0
066290200529     C*****      MDSBPR    ANDNE0                             Subscription136935
066300200529      *                                                                   CEU017
066310200529      ***  Or Processing Type = Currency Changes and Old and New Nominal  CEU017
066320200529      ***  Size not zero.                                                 CEU017
066330200529      *                                                                   CEU017
066340200529     C           MAPTYP    OREQ 'CC'                                      CEU017
066350200529     C           MDOSHA    ANDNE0                                         CEU017
066360200529     C           WWNSHA    ANDNE0                                         CEU017
066370200529      *
066380200529      ***  If Rounding Settlement in Cash = 'Y', calculate Actual Cash Rounding = Actual Stock
066390200529      ***  Rounding previously calculated multiplied by Compensation Price.
066400200529      *
066410200529     C           WWRNDS    IFEQ 'Y'
066420200529     C           WWASTR    MULT WWCOMP    WWACAR 309
066430200529      *
066440200529      ***  If Price Basis is 'P' for %, result should be divided by 100.
066450200529      *
066460200529     C           NSSPBS    IFEQ 'P'
066470200529     C           WWACAR    DIV  100       WWACAR
066480200529     C                     ENDIF
066490200529      *
066500200529      ***  Else, If Rounding Settlement in Cash not equal 'Y', set Actual Cash Rounding to 0.
066510200529      *
066520200529     C                     ELSE
066530200529     C                     Z-ADD0         WWACAR
066540200529     C                     ENDIF
066550200529     C                     ENDIF
066560200529      *
066570200529     C           MAPTYP    IFEQ 'DV'                       If Processing Type = Dividends Events
066580200529     C           MDSDIT    ANDEQ'S'                           Stock Dividend Type = Stock for Stock
066590200529     C********** MDDIVU    ANDNE0                             Dividend Per Unit not zero      190204
066600200529     C           MDDIV1    ANDNE0                             Dividend Per Unit not zero      190204
066610200529     C           MDSBPR    ANDNE0                             Subscription Price not zero
066620200529      *
066630200529     C           MAPTYP    OREQ 'DV'                       If Processing Type = Div Events    215071
066640200529     C           MDSDIT    ANDEQ'O'                           Stock Div Tp=Opt for cash stock 215071
066650200529     C           MDDIV1    ANDNE0                             Dividend per Unit not zero      215071
066660200529     C           MDSBPR    ANDNE0                             Subscription Price not zero     215071
066670200529      *                                                                                       215071
066680200529      ***  If Rounding Settlement in Cash = 'Y', calculate Actual Cash Rounding = (Holding Taken as
066690200529      ***  Stock previously calculated multiplied by Dividend Per Unit) - (Actual Stock Allocation
066700200529      ***  previously calculated multiplied by Subscription Price).
066710200529      *
066720200529     C           WWRNDS    IFEQ 'Y'
066730200529     C******               Z-ADDNSNBDP    WWNBDP                          135690
066740200529     C**********           Z-ADDNCNBDP    WWNBDP                   135690 190204
066750200529     C**********           Z-ADDMDDIVU    WUNUM                           190204
066760200529     C**********           EXSR RTVNDP                                    190204
066770200529     C                     Z-ADDMDDIV1    WWNUM            13,8 => 30,9   190204
066780200529     C           WWHOST    MULT WWNUM     W1ACAR
066790200529     C           WWASTA    MULT MDSBPR    W2ACAR
066800200529      *
066810200529      ***  If Price Basis is 'P' for %, result should be divided by 100.
066820200529      *
066830200529     C           NSSPBS    IFEQ 'P'
066840200529     C           W2ACAR    DIV  100       W2ACAR
066850200529     C                     ENDIF
066860200529     C           W1ACAR    SUB  W2ACAR    WWACAR
066870200529      *
066880200529      ***  Else, If Rounding Settlement in Cash not equal 'Y', set Actual Cash Rounding to 0.
066890200529      *
066900200529     C                     ELSE
066910200529     C                     Z-ADD0         WWACAR
066920200529     C                     ENDIF
066930200529     C                     ENDIF
066940200529      *
066950200529     C           MAPTYP    IFEQ 'CE'                       If Processing Type = Capital Changes
066960200529      *
066970200529     C           MAPTYP    OREQ 'DV'                       Or Processing Type = Dividends Events
066980200529     C           MDSDIT    ANDEQ'R'                           Stk Dividend Tp=Combined for Cash&Stk
066990200529     C********** MDDIVU    ANDNE0                             Dividend Per Unit not zero      190204
067000200529     C           MDDIV1    ANDNE0                             Dividend Per Unit not zero      190204
067010200529     C           MDSBPR    ANDNE0                             Subscription Price not zero
067020200529      *
067030200529     C           MAPTYP    OREQ 'EX'                       Or Processing Type = Dividends Events
067040200529     C           MJCPRC    ANDNE0                             Conversion Price not 0
067050200529     C           MJCEXR    ANDNE0                             Conversion Exchange Rate not 0
067060200529     C           MDSBPR    ANDNE0                             Subscription Price not 0
067070200529      *
067080200529      ***  Set Actual Cash Rounding to 0.
067090200529      *
067100200529     C                     Z-ADD0         WWACAR
067110200529     C                     ENDIF
067120200529      *                                                                   161732
067130200529      ** If Processing Type = Exercise and Conversions, and Option for    161732
067140200529      ** Allocation = '6', zeroise Actual Cash Rounding.                  161732
067150200529      *                                                                   161732
067160200529     C           MAPTYP    IFEQ 'EX'                                      161732
067170200529     C           WWOPT2    ANDEQ'6'                                       161732
067180200529     C                     Z-ADD0         WWACAR                          161732
067190200529     C                     ENDIF                                          161732
067200200529      *
067210200529      ***  Set Actual Cash Rounding calculated.
067220200529      *
067230200529     C                     Z-ADDNCNBDP    WWNBDP
067240200529     C                     MOVE 'R'       WUROOP
067250200529     C                     Z-ADDWWACAR    WWNUM
067260200529     C                     EXSR ROUNDD
067270200529     C                     Z-ADDWWNUM     WWACAR
067280200529      *
067290200529      ***  Accumulate Actual Cash Rounding.
067300200529      *
067310200529     C                     ADD  WWACAR    TWACAR
067320200529      *
067330200529     C                     ENDSR
067340200529      *
067350200529      *****************************************************************
067360200529      /EJECT
067370200529      *****************************************************************
067380200529      *                                                               *
067390200529      * CCAOPT - Calculate Cash Option.                               *
067400200529      *                                                               *
067410200529      * Called by:                                                    *
067420200529      *                                                               *
067430200529      * Calls:                                                        *
067440200529      *                                                               *
067450200529      *****************************************************************
067460200529      *
067470200529     C           CCAOPT    BEGSR                           ** CCAOPT SR **
067480200529      *
067490200529      *****If*Processing*Type*=*Offers*and*Offer*Type*=*Exchange*Offers** 136935
067500200529      *****or*Purchase*Offer,******************************************** 136935
067510200529      ***  If Processing Type = Offers and Offer Type = Exchange Offers,  136935
067520200529      ***  calculate Cash Option = Ex-Date Position multiplied by Receive Price.
067530200529      *
067540200529     C           MAPTYP    IFEQ 'OF'
067550200529     C           MIOFTY    ANDEQ'E'
067560200529     C******     MAPTYP    OREQ 'OF'                                      136935
067570200529     C******     MIOFTY    ANDEQ'P'                                       136935
067580200529     C           WWTDVD    MULT MIREPR    WWCAOP
067590200529      *
067600200529      ***  If Price Basis is 'P' for %, result should be divided by 100.
067610200529      *
067620200529     C           TSPB,1    IFEQ 'P'
067630200529     C           WWCAOP    DIV  100       WWCAOP
067640200529     C                     ENDIF
067650200529     C                     ELSE
067660200529      *
067670200529      ***  If Processing Type = Offers and Offer Type = Subsrciption Offer,
067680200529      ***  calculate Cash Option = total Original Stock allocation        136935
067690200529      ***  previously calculatecalculated multiplied by Subscription      136935
067700200529      ***  Price.                                                         136935
067710200529      *****calculate*Cash*Option*=*Ex-Date*Position*multiplied*by******** 136935
067720200529      *****Subscription*Price.******************************************* 136935
067730200529      *
067740200529     C           MAPTYP    IFEQ 'OF'
067750200529     C           MIOFTY    ANDEQ'S'
067760200529     C           MAPTYP    OREQ 'EX'                                      219579
067770200529     C           WWOPT2    ANDEQ'4'                                       219579
067780200529     C******     WWTDVD    MULT MISUPR    WWCAOP                          136935
067790200529     C           WUOALR    MULT MISUPR    WWCAOP                          136935
067800200529     C           MAPTYP    IFEQ 'EX'                                      219579
067810200529     C           WWTDVD    MULT MDSBPR    WWCAOP                          219579
067820200529     C                     END                                            219579
067830200529      *
067840200529      ***  If Price Basis is 'P' for %, result should be divided by 100.
067850200529      *
067860200529     C           TSPB,1    IFEQ 'P'
067870200529     C           WWCAOP    DIV  100       WWCAOP
067880200529     C                     ENDIF
067890200529     C                     ELSE
067900200529      *                                                                   136935
067910200529      ***  If Processing Type = Offers and Offer Type = Purchase Offer,   136935
067920200529      ***  calculate Cash Option = total Original Stock allocation        136935
067930200529      ***  previously calculatecalculated multiplied by Recieve Price.    136935
067940200529      *                                                                   136935
067950200529     C           MAPTYP    IFEQ 'OF'                                      136935
067960200529     C           MIOFTY    ANDEQ'P'                                       136935
067970200529     C********** WUOALR    MULT MISUPR    WWCAOP                                       136935 193662
067980200529     C           WUOALR    MULT MIREPR    WWCAOP                                              193662
067990200529      *                                                                   136935
068000200529      ***  If Price Basis is 'P' for %, result should be divided by 100.  136935
068010200529      *                                                                   136935
068020200529     C           TSPB,1    IFEQ 'P'                                       136935
068030200529     C           WWCAOP    DIV  100       WWCAOP                          136935
068040200529     C                     ENDIF                                          136935
068050200529     C                     ELSE                                           136935
068060200529      *
068070200529      ***  If Processing Type = Dividends Events or Capital Changes or Corporate Reorganistion,
068080200529      ***  calculate Cash Option = Holding (=Ex-Date Position) multiplied by Dividend Per Unit
068090200529      ***  (for Capital Change, used Cash Repaid instead of Dividend Per Unit, and for Corporate
068100200529      ***  Reorganistion, used Cash Payment instead of Dividend Per Unit).
068110200529      *
068120200529     C           MAPTYP    IFEQ 'DV'                       If Dividend Events
068130200529     C           MAPTYP    OREQ 'CE'                       Or Capital Changes
068140200529     C           MAPTYP    OREQ 'CR'                       Or Corporate Reorganisation
068150200529     C           MAPTYP    IFEQ 'CR'                                      136935
068160200529     C           MDOSHA    ANDNE*ZEROS                                    136935
068170200529     C           WWTDVD    DIV  MDOSHA    WWCAOP                          136935
068180200529     C                     MULT WWDIVU    WWCAOP                          136935
068190200529     C                     ELSE                                           136935
068200200529     C           WWTDVD    MULT WWDIVU    WWCAOP
068210200529     C                     ENDIF                                          136935
068220200529     C                     ENDIF
068230200529     C                     ENDIF                                          136935
068240200529     C                     ENDIF
068250200529     C                     ENDIF
068260200529      *
068270200529      ***  Set Original Cash Option calculated.
068280200529      *
068290200529     C           MAPTYP    IFEQ 'CR'
068300200529     C                     Z-ADDECNBDP    WWNBDP           Event Currency Decimal Places
068310200529     C                     ELSE
068320200529     C                     Z-ADDTCDP,1    WWNBDP           New Currency Decimal Places
068330200529     C                     ENDIF
068340200529     C                     MOVE 'R'       WUROOP           Rounding = half adjust
068350200529     C                     Z-ADDWWCAOP    WWNUM
068360200529     C                     EXSR ROUNDD
068370200529     C                     Z-ADDWWNUM     WWCAOP
068380200529      *
068390200529     C                     ENDSR
068400200529      *
068410200529      *****************************************************************
068420200529      /EJECT
068430200529      *****************************************************************
068440200529      *                                                               *
068450200529      * CACABC - Calculate Actual Cash Allocation for Book/Customer.  *
068460200529      *                                                               *
068470200529      * Called by:                                                    *
068480200529      *                                                               *
068490200529      * Calls:                                                        *
068500200529      *                                                               *
068510200529      *****************************************************************
068520200529      *
068530200529     C           CACABC    BEGSR                           ** CACABC SR **
068540200529      *
068550200529     C           MAPTYP    IFEQ 'DV'                       If Processing Type = Dividend Events
068560200529     C           MDSDIT    ANDEQ'S'                           Stock Dividend Type = Stock for Stock
068570200529     C           MAPTYP    OREQ 'FR'                       Or Processing Type = free Allocation
068580200529     C           MAPTYP    OREQ 'RG'                       Or Processing Type = Rights Issues
068590200529     C           MAPTYP    OREQ 'NF'                       Or Processing Type = Non financial Events
068600200529     C           MAPTYP    OREQ 'NC'                       Or Processing Type = Name Changes
068610200529     C           MAPTYP    OREQ 'CC'                       Or Ccy Changes CEU017
068620200529     C           MAPTYP    OREQ 'EX'                       Or Exercices and Conversions
068630200529     C******     MJOPT7    ANDEQ'Y'                           Cust.Opt. 7 136935
068640200529     C           WWOPT2    ANDEQ'7'                           Opt.Alloc=7 136935
068650200529      *
068660200529      ***  Set Actual Cash Allocation to zero.
068670200529      *
068680200529     C                     Z-ADD0         WWACAA 309
068690200529     C                     ELSE
068700200529      *
068710200529      ***  Else, if Processing Type = Capital Changes or Corporate Reorganisation, calculate
068720200529      ***  Actual Cash Allocation = Current Holding (Ex-Date Position) multiplied by Cash Repaid
068730200529      ***  (if Processing Type = Capital Change) or Cash Payment (if Processing Type = Corporate
068740200529      ***  Reorganisation).
068750200529      *
068760200529     C           MAPTYP    IFEQ 'CE'                       If Capital Changes
068770200529     C           MAPTYP    OREQ 'CR'                       Or Corporate Reorganisation
068780200529     C           MAPTYP    IFEQ 'CR'                                      136935
068790200529     C           MDOSHA    ANDNE*ZEROS                                    136935
068800200529     C           WWTDVD    DIV  MDOSHA    WWACAA                          136935
068810200529     C                     MULT WWDIVU    WWACAA                          136935
068820200529     C                     ELSE                                           136935
068830200529     C           WWTDVD    MULT WWDIVU    WWACAA
068840200529     C                     ENDIF                                          136935
068850200529     C                     ELSE
068860200529      *
068870200529      *****If*Processing*Type*=*Offers*with*Offer*Type*=*Exchange*or***** 136935
068880200529      *****Subscription,************************************************* 136935
068890200529      ***  If Processing Type = Offers with Offer Type = Exchange,        136935
068900200529      ***  calculate Actual Cash Allocation = Holding Taken as stock previously calculated
068910200529      ***  multiplied by Receive Price.                                   136935
068920200529      *****multiplied*by*Receive*Price*(if*Offer*Type*=*Excahnge*Offers)* 136935
068930200529      *****or*Subscription*Price*(if*Offer*Type*=*Subscription*Price).*** 136935
068940200529      *
068950200529     C           MAPTYP    IFEQ 'OF'                       If Exchange Offers
068960200529     C           MIOFTY    ANDEQ'E'
068970200529     C******     MAPTYP    OREQ 'OF'                       Or Subscript.  136935
068980200529     C******     MIOFTY    ANDEQ'S'                           Offers      136935
068990200529     C           WWHOST    MULT WWDIVU    WWACAA
069000200529      *
069010200529      ***  If Price Basis is 'P' for %, result should be divided by 100.
069020200529      *
069030200529     C           TSPB,1    IFEQ 'P'
069040200529     C           WWACAA    DIV  100       WWACAA
069050200529     C                     ENDIF
069060200529     C                     ELSE
069070200529      *                                                                   136935
069080200529      ***  If Processing Type = Offers with Offer Type = Subscription,    136935
069090200529      ***  calculate Actual Cash Allocation = Actual Stock Allocation     136935
069100200529      ***  multiplied by Subscription Price.                              136935
069110200529      *                                                                   136935
069120200529     C           MAPTYP    IFEQ 'OF'                                      136935
069130200529     C           MIOFTY    ANDEQ'S'                                       136935
069140200529     C           WUASTA    MULT WWDIVU    WWACAA                          136935
069150200529      *                                                                   136935
069160200529      ***  If Price Basis is 'P' for %, result should be divided by 100.  136935
069170200529      *                                                                   136935
069180200529     C           TSPB,1    IFEQ 'P'                                       136935
069190200529     C           WWACAA    DIV  100       WWACAA                          136935
069200200529     C                     ENDIF                                          136935
069210200529     C                     ELSE                                           136935
069220200529      *                                                                   136935
069230200529      ***  If Processing Type = Offers with Offer Type = Purchase,        136935
069240200529      ***  calculate Actual Cash Allocation = total (Original Stock       136935
069250200529      ***  Allocation multiplied by Cash Preferred %) multiplied by       136935
069260200529      ***  Receive Price.                                                 136935
069270200529      *                                                                   136935
069280200529     C           MAPTYP    IFEQ 'OF'                                      136935
069290200529     C           MIOFTY    ANDEQ'P'                                       136935
069300200529     C           W2OALR    MULT WWDIVU    WWACAA                          136935
069310200529     C           MQR2CN    IFNE 0                                         219976
069320200529     C           MQR2CN    MULT MIREPR    WWACAA                          219976
069330200529     C                     END                                            219976
069340200529      *                                                                   136935
069350200529      ***  If Price Basis is 'P' for %, result should be divided by 100.  136935
069360200529      *                                                                   136935
069370200529     C           TSPB,1    IFEQ 'P'                                       136935
069380200529     C           WWACAA    DIV  100       WWACAA                          136935
069390200529     C                     ENDIF                                          136935
069400200529     C                     ELSE                                           136935
069410200529      *
069420200529      *****If*Processing*Type*=*Exercices*and*Conversions*and*Customer*** 136935
069430200529      *****Option*1,*2,*3,*4,*5*or*6*is*allowed,************************* 136935
069440200529      *****If*Processing*Type*=*Exercices*and*Conversions*and*Opti 136935 161732
069450200529      *****Allocation*2*=*'1',*'2',*'3',*'4',*'5'*or*'6',********* 136935 161732
069460200529      *****calculate*Actual*Cash*Allocation*=*Holding*Taken*as*Cash*previ 161732
069470200529      *****by*Subscription*Price.**************************************** 161732
069480200529      ** If Processing Type = Exercices and Conversions and Option for    161732
069490200529      ** Allocation 2 = '1', '2', '3', '4', or '5', calculate Actual      161732
069500200529      ** Cash Allocation = Holding Taken as Cash previously calculated    161732
069510200529      ** multiplied by Receive/Cash Price.                                161732
069520200529      *
069530200529     C           MAPTYP    IFEQ 'EX'                       If Exercices and Conversions
069540200529     C******     MJOPT1    IFEQ 'Y'                           Cust.Opt. 1 136935
069550200529     C******     MJOPT2    OREQ 'Y'                           Cust.Opt. 2 136935
069560200529     C******     MJOPT3    OREQ 'Y'                           Cust.Opt. 3 136935
069570200529     C******     MJOPT4    OREQ 'Y'                           Cust.Opt. 4 136935
069580200529     C******     MJOPT5    OREQ 'Y'                           Cust.Opt. 5 136935
069590200529     C******     MJOPT6    OREQ 'Y'                           Cust.Opt. 6 136935
069600200529     C           WWOPT2    IFEQ '1'                                       136935
069610200529     C           WWOPT2    OREQ '2'                                       136935
069620200529     C           WWOPT2    OREQ '3'                                       136935
069630200529     C           WWOPT2    OREQ '4'                                       136935
069640200529     C           WWOPT2    OREQ '5'                                       136935
069650200529     C***********WWOPT2    OREQ '6'                                136935 161732
069660200529     C***********WWHOCA    MULT MDSBPR    WWACAA                          161732
069670200529     C           WWHOCA    MULT MDRCPR    WWACAA                          161732
069680200529      *                                                                   219579
069690200529     C           WWOPT2    IFEQ '4'                                       219579
069700200529     C           WWHOCA    MULT MDSBPR    WWACAA                          219579
069710200529     C                     END                                            219579
069720200529      *
069730200529      ***  If Price Basis is 'P' for %, result should be divided by 100.
069740200529      *
069750200529     C           TSPB,1    IFEQ 'P'
069760200529     C           WWACAA    DIV  100       WWACAA
069770200529     C                     ENDIF
069780200529      *                                                                   161732
069790200529      ** Else, if Processing Type = Exercises and Conversions, and        161732
069800200529      ** Option for Allocation 2 = '6', zeroise Actual Cash Allocation    161732
069810200529      *                                                                   161732
069820200529     C                     ELSE                                           161732
069830200529     C           WWOPT2    IFEQ '6'                                       161732
069840200529     C                     Z-ADD0         WWACAA                          161732
069850200529     C                     ENDIF                                          161732
069860200529     C                     ENDIF
069870200529     C                     ELSE
069880200529      *
069890200529      ***  If Processing Type = Dividend Events and Stock Dividend Type = 'R' as Reinvestment of
069900200529      ***  Dividend, calculate Actual Cash Allocation = Original Cash Option - Actual Cash Pool.
069910200529      *
069920200529     C           MAPTYP    IFEQ 'DV'                       If Processing Type = Dividend Events
069930200529     C           MDSDIT    ANDEQ'R'                           Stk Dividend Tp=Reinvestment of Divid.
069940200529     C           WWCAOP    SUB  ACCAPO    WWACAA
069950200529     C                     ELSE
069960200529      *
069970200529      ***  Else, calculate Actual Cash Allocation = Holding Taken as Cash calculated before
069980200529      ***  multiplied by Dividend Per Unit (if Processing Type = Dividends Events) or Cash Payment
069990200529      ***  (if Processing Type = Corporate Reorganisation).
070000200529      *
070010200529     C           WWHOCA    MULT WWDIVU    WWACAA
070020200529     C                     ENDIF
070030200529     C                     ENDIF
070040200529     C                     ENDIF                                          136935
070050200529     C                     ENDIF                                          136935
070060200529     C                     ENDIF
070070200529     C                     ENDIF
070080200529     C                     ENDIF
070090200529      *
070100200529      ***  Set Actual Cash Allocation calculated.
070110200529      *
070120200529     C           MAPTYP    IFEQ 'CR'
070130200529     C                     Z-ADDECNBDP    WWNBDP           Event Currency Decimal Places
070140200529     C                     ELSE
070150200529     C                     Z-ADDTCDP,1    WWNBDP           New Currency Decimal Places
070160200529     C                     ENDIF
070170200529     C                     MOVE 'R'       WUROOP           Rounding = half adjust
070180200529     C                     Z-ADDWWACAA    WWNUM
070190200529     C                     EXSR ROUNDD
070200200529     C                     Z-ADDWWNUM     WWACAA
070210200529      *
070220200529     C                     ENDSR
070230200529      *
070240200529      *****************************************************************
070250200529      /EJECT
070260200529      *****************************************************************
070270200529      *                                                               *
070280200529      * CACADP - Calculate Actual Cash Allocation for Depot.          *
070290200529      *                                                               *
070300200529      * Called by:                                                    *
070310200529      *                                                               *
070320200529      * Calls:                                                        *
070330200529      *                                                               *
070340200529      *****************************************************************
070350200529      *
070360200529     C           CACADP    BEGSR                           ** CACADP SR **
070370200529      *
070380200529      ***  Reset work field.
070390200529      *
070400200529     C                     Z-ADD0         WWACAA
070410200529      *
070420200529     C           MAPTYP    IFEQ 'DV'                       If Dividend Events
070430200529     C           MDSDIT    ANDEQ'S'                           Stock for Stock
070440200529     C           MAPTYP    OREQ 'FR'                       Or Free Allocation
070450200529     C           MAPTYP    OREQ 'RG'                       Or Rights Issues
070460200529     C           MAPTYP    OREQ 'NF'                       Or Non Financial Events
070470200529     C           MAPTYP    OREQ 'NC'                       Or Name Changes
070480200529     C           MAPTYP    OREQ 'CC'                       Or Ccy Changes CEU017
070490200529      *
070500200529      ***  Set Actual Cash Allocation to zero.
070510200529      *
070520200529     C                     Z-ADD0         WWACAA
070530200529     C                     ELSE
070540200529      *
070550200529      ***  Else, if Processing Type = Capital Changes or Corporate Reorganisation, calculate
070560200529      ***  Actual Cash Allocation = Current Holding (Ex-Date Position) multiplied by Cash Repaid
070570200529      ***  (if Processing Type = Capital Change) or Cash Payment (if Processing Type = Corporate
070580200529      ***  Reorganisation).
070590200529      *
070600200529     C           MAPTYP    IFEQ 'CE'                       If Capital Changes
070610200529     C           MAPTYP    OREQ 'CR'                       Or Corporate Reorganisation
070620200529     C           MAPTYP    IFEQ 'CR'                                      136935
070630200529     C           MDOSHA    ANDNE*ZEROS                                    136935
070640200529     C*****      WWTDVD    DIV  MDOSHA    WWACAA                   136935 157229
070650200529     C           WWHOST    DIV  MDOSHA    WWACAA                          157229
070660200529     C                     MULT WWDIVU    WWACAA                          136935
070670200529     C                     ELSE                                           136935
070680200529     C           WWTDVD    MULT WWDIVU    WWACAA
070690200529     C                     ENDIF                                          136935
070700200529     C                     ELSE
070710200529      *                                                                   136935
070720200529      ***  Else, if Processing Type = Offers with Offer Type =            136935
070730200529      ***  Subscription, calculate Actual Cash Allocation = Actual Stock  136935
070740200529      ***  Allocation multiplied by Subscription Price.                   136935
070750200529      *                                                                   136935
070760200529     C           MAPTYP    IFEQ 'OF'                                      136935
070770200529     C           MIOFTY    ANDEQ'S'                                       136935
070780200529     C           WUASTA    MULT WWDIVU    WWACAA                          136935
070790200529      *                                                                   136935
070800200529      ***  If Price Basis is 'P' for %, result should be divided by 100.  136935
070810200529      *                                                                   136935
070820200529     C           TSPB,1    IFEQ 'P'                                       136935
070830200529     C           WWACAA    DIV  100       WWACAA                          136935
070840200529     C                     ENDIF                                          136935
070850200529     C                     ELSE                                           136935
070860200529      *                                                                   136935
070870200529      ***  Else, if Processing Type = Offers with Offer Type =            136935
070880200529      ***  Purchase, calculate Actual Cash Allocation = Actual Cash       136935
070890200529      ***  Allocation accumulated.                                        136935
070900200529      *                                                                   136935
070910200529     C           MAPTYP    IFEQ 'OF'                                      136935
070920200529     C           MIOFTY    ANDEQ'P'                                       136935
070930200529     C                     Z-ADDWTACAA    WWACAA                          136935
070940200529     C                     ELSE                                           136935
070950200529      *
070960200529      *****Else,*if*Processing*Type*=*Offers,*calculate*Actual*Cash****** 136935
070970200529      *****Allocation*=*Holding*Taken*as*Stock*previously*calculated***** 136935
070980200529      *****multiplied*by*Receive*Price*(if*Offer*Type*=*Excahnge*Offers** 136935
070990200529      *****or*Purchase*Offer)*or*Subscription*Price*(if*Offer*Type*=***** 136935
071000200529      *****Subscription).************************************************ 136935
071010200529      ***  Else, if Processing Type = Offers with Offer Type = Exchange,  136935
071020200529      ***  calculate Actual Cash Allocation = Holding Taken as Stock      136935
071030200529      ***  previously calculated multiplied by Receive Price.             136935
071040200529      *
071050200529     C           MAPTYP    IFEQ 'OF'                       If Offers
071060200529     C           MIOFTY    ANDEQ'E'                           Exchange    136935
071070200529     C           WWHOST    MULT WWDIVU    WWACAA
071080200529      *
071090200529      ***  If Price Basis is 'P' for %, result should be divided by 100.
071100200529      *
071110200529     C           TSPB,1    IFEQ 'P'
071120200529     C           WWACAA    DIV  100       WWACAA
071130200529     C                     ENDIF
071140200529     C                     ELSE
071150200529      *
071160200529      ***  Else, if Processing Type = Exercices and Conversions, calculate Actual Cash Allocation =
071170200529      *****Holding*Taken*as*Cash*previously*calculated*multiplied*by*Subsc161732
071180200529      ** Holding Taken as Cash previously calculated multiplied by        161732
071190200529      ** Receive/Cash Price.                                              161732
071200200529      *
071210200529     C           MAPTYP    IFEQ 'EX'                       If Exercices and Conversions
071220200529     C           WWOPT2    IFNE '6'                                       161732
071230200529     C***********WWHOCA    MULT MDSBPR    WWACAA                          161732
071240200529     C           WWHOCA    MULT MDRCPR    WWACAA                          161732
071250200529     C           WWOPT2    IFEQ '4'                                       219579
071260200529     C           WWHOCA    MULT MDSBPR    WWACAA                          219579
071270200529     C                     ENDIF                                          219579
071280200529     C                     ENDIF                                          161732
071290200529      *
071300200529      ***  If Price Basis is 'P' for %, result should be divided by 100.
071310200529      *
071320200529     C           TSPB,1    IFEQ 'P'
071330200529     C           WWACAA    DIV  100       WWACAA
071340200529     C                     ENDIF
071350200529     C                     ELSE
071360200529      *
071370200529      ***  Else, if Processing Type = Dividend Events and Stock Dividend Type = 'R' as Reinvestment
071380200529      ***  of Dividend, calculate Actual Cash Allocation = Original Cash Option of the Depot -
071390200529      ***  (Total of all Actual Stock Allocation for Customers/Books of the Depot multiplied by
071400200529      ***  Subscription Price).
071410200529      *
071420200529     C           MAPTYP    IFEQ 'DV'                       If Dividend Events
071430200529     C           MDSDIT    ANDEQ'R'                           Reinvestment of Dividend
071440200529     C           TWASTA    MULT MDSBPR    W1ACAA 309
071450200529      *
071460200529      ***  If Price Basis is 'P' for %, result should be divided by 100.
071470200529      *
071480200529     C           TSPB,1    IFEQ 'P'
071490200529     C           W1ACAA    DIV  100       W1ACAA
071500200529     C                     ENDIF
071510200529     C           WWCAOP    SUB  W1ACAA    WWACAA
071520200529     C                     Z-ADD0         TWASTA
071530200529     C                     ELSE
071540200529      *
071550200529      ***  Else, calculate Actual Cash Allocation = Holding Taken as Cash calculated before
071560200529      ***  multiplied by Dividend Per Unit (if Processing Type = Dividends Events) or Cash Payment
071570200529      ***  (if Processing Type = Corporate Reorganisation), and half adjust.
071580200529      *
071590200529     C           WWHOCA    MULT WWDIVU    WWACAA
071600200529     C                     ENDIF
071610200529     C                     ENDIF
071620200529     C                     ENDIF
071630200529     C                     ENDIF                                          136935
071640200529     C                     ENDIF                                          136935
071650200529     C                     ENDIF
071660200529     C                     ENDIF
071670200529      *
071680200529      ***  Set Actual Cash Allocation calculated.
071690200529      *
071700200529     C           MAPTYP    IFEQ 'CR'
071710200529     C                     Z-ADDECNBDP    WWNBDP           Event Currency Decimal Places
071720200529     C                     ELSE
071730200529     C                     Z-ADDTCDP,1    WWNBDP           New Currency Decimal Places
071740200529     C                     ENDIF
071750200529     C                     MOVE 'R'       WUROOP           Rounding = half adjust
071760200529     C                     Z-ADDWWACAA    WWNUM
071770200529     C                     EXSR ROUNDD
071780200529     C                     Z-ADDWWNUM     WWACAA
071790200529      *
071800200529     C                     ENDSR
071810200529      *
071820200529      *****************************************************************
071830200529      /EJECT
071840200529      *****************************************************************
071850200529      *                                                               *
071860200529      * CASABC - Calculate Actual Stock Allocation for Book/Customer. *
071870200529      *                                                               *
071880200529      * Called by:                                                    *
071890200529      *                                                               *
071900200529      * Calls:                                                        *
071910200529      *                                                               *
071920200529      *****************************************************************
071930200529      *
071940200529     C           CASABC    BEGSR                           ** CASABC SR **
071950200529      *                                                                                       193662
071960200529      ** For offers, cash preferred is on the actions                                         193662
071970200529      *                                                                                       193662
071980200529     C           MAPTYP    IFEQ 'OF'                                                          193662
071990200529     C           MIOFTY    ANDEQ'S'                                                           193662
072000200529     C           MAPTYP    OREQ 'OF'                                                          193662
072010200529     C           MIOFTY    ANDEQ'P'                                                           193662
072020200529     C                     Z-ADDWCAPR     WSTPR                                               193662
072030200529     C                     ELSE                                                               193662
072040200529      *
072050200529      ***  Calculate Stock preferred % = 100 - Cash Preeferred % previously calculated.
072060200529      *
072070200529     C           100       SUB  WCAPR     WSTPR   52
072080200529      *                                                                                       193662
072090200529     C                     ENDIF                                                              193662
072100200529      *
072110200529      ***  If Current Reply exists and Reply Nominal (= Nominal Taken as Cash from SECOREL0) not 0,
072120200529      ***  calculate work field EE = Holding (= Ex-Date Position) - Reply Nominal (which is in fact
072130200529      ***  Nominal Accepted for Offers, which is Nominal Taken as Cash for Dividend Events or Rights
072140200529      ***  Issues).
072150200529      *
072160200529     C           EXBCRE    IFEQ 'Y'
072170200529     C           MQR2CN    ANDNE0
072180200529     C                     Z-ADDESNBDP    WWNBDP
072190200529     C                     Z-ADDMQR2CN    WUNUM
072200200529     C                     EXSR RTVNDP
072210200529     C********   WWTDVD    SUB  WWNUM     FLDEE  309                      220006
072220200529     C                     Z-ADDWWNUM     FLDEE  309                      220006
072230200529     C           MAPTYP    IFEQ 'EX'                                      161732
072240200529     C           WWOPT2    ANDEQ'6'                                       161732
072250200529     C                     Z-ADDWWNUM     FLDEE                           161732
072260200529     C                     ENDIF                                          161732
072270200529      *                                                                   181131
072280200529      ** Multipy by No.of New Shares/No.of Old Shares                     181131
072290200529      *                                                                   181131
072300200529     C           MDOSHA    IFNE 0                                         181131
072310200529     C           FLDEE     DIV  MDOSHA    FLDEE                           181131
072320200529     C           FLDEE     MULT WWNSHA    FLDEE                           181131
072330200529     C                     Z-ADDFLDEE     WWOALR                          220006
072340200529     C                     ENDIF                                          181131
072350200529      *
072360200529      ***  Else, if Current Reply does not exist or Current Reply exists and Reply Nominal (=
072370200529      ***  Nominal Taken as Cash from SECOREL0) is 0.
072380200529      *
072390200529     C                     ELSE
072400200529      *
072410200529      ***  If Processing Type = Offers, calculate work field EE = True Stock Allocation previously
072420200529      ***  calculated multiplied by Cash Preferred % (which is in fact % Accepted) previously
072430200529      ***  calculated.
072440200529      *
072450200529     C           MAPTYP    IFEQ 'OF'                       If Offers
072460200529     C           MIOFTY    ANDNE'E'                                       136935
072470200529     C           WWOTSA    MULT WCAPR     FLDEE
072480200529     C           MIOFTY    IFEQ 'P'                                       219976
072490200529     C           WWOALR    MULT WCAPR     FLDEE                           219976
072500200529     C                     END                                            219976
072510200529     C           FLDEE     DIV  100       FLDEE
072520200529     C                     ELSE
072530200529      *
072540200529      ***  If Processing Type = 'EX', work field EE = WWOTSA (that has    164243
072550200529      ***  already been calculated with Cash Preferred %)                 164243
072560200529      *                                                                   164243
072570200529     C           MAPTYP    IFEQ 'EX'                       If 'EX'        164243
072580200529     C           WWOPT2    IFNE '6'                                       161732
072590200529     C                     Z-ADDWWOTSA    FLDEE                           164243
072600200529     C                     ELSE                                           161732
072610200529      *                                                                   161732
072620200529      ***  If Processing type is 'EX' and Option reply is 6               161732
072630200529      *                                                                   161732
072640200529     C           MQR2CA    IFNE 0                                         161732
072650200529     C           WWOTSA    MULT MQR2CA    FLDEE                           161732
072660200529     C           FLDEE     DIV  100       FLDEE                           161732
072670200529     C                     ENDIF                                          161732
072680200529     C                     ENDIF                                          161732
072690200529     C                     ELSE                                           164243
072700200529      *                                                                   164243
072710200529      ***  Else, if Processing Type not Offers, calculated work field EE = True Stock Allocation
072720200529      ***  previously calculated multiplied by Stock Preferred % calculated.
072730200529      *
072740200529     C           WWOTSA    MULT WSTPR     FLDEE
072750200529     C           FLDEE     DIV  100       FLDEE
072760200529     C           WWOPT2    IFEQ '3'                                                           220006
072770200529     C                     Z-ADDWWOTSA    FLDEE                                               220006
072780200529     C                     END                                                                220006
072790200529     C                     ENDIF                                          164243
072800200529     C                     ENDIF
072810200529     C                     ENDIF
072820200529      *
072830200529      ***  If Processing Type = Dividend Events and Stock Dividend Type = 'R' as Reinvestment
072840200529      ***  of Dividend and feature Withholding Tax is ON, calculate work field EE = work field EE
072850200529      ***  previously calculated less Tax Deducted at Source and Tax Deducted by User based on work
072860200529      ***  field EE.
072870200529      *
072880200529     C           MAPTYP    IFEQ 'DV'
072890200529     C           MDSDIT    ANDEQ'R'
072900200529     C           S01447    ANDEQ'Y'
072910200529     C                     Z-ADDFLDEE     WWAMTT
072920200529     C                     EXSR CTOTAX
072930200529     C                     SUB  TOTTAX    FLDEE
072940200529     C                     ENDIF
072950200529      *                                                                   136935
072960200529      ***  If Processing Type = Offers with Offer Type = Subscription or  136935
072970200529      ***  Exchange, calculate Actual Stock Allocation = Original Stock   136935
072980200529      ***  Allocation previously calculated multiplied by Stock Preferred 136935
072990200529      ***  %.                                                             136935
073000200529      *                                                                   136935
073010200529     C           MAPTYP    IFEQ 'OF'                                      136935
073020200529     C           MIOFTY    ANDEQ'S'                                       136935
073030200529     C           MAPTYP    OREQ 'OF'                                      136935
073040200529     C           MIOFTY    ANDEQ'E'                                       136935
073050200529     C********** 100       SUB  WCAPR     WSTPR                                        136935 193662
073060200529     C           WWOALR    MULT WSTPR     WWASTA                          136935
073070200529     C           WWASTA    DIV  100       WWASTA                          136935
073080200529     C                     Z-ADDWWASTA    WUASTA                          136935
073090200529     C           WWOPT2    IFEQ '3'                                       220006
073100200529     C                     Z-ADDWWOALR    WUASTA                          220006
073110200529     C                     Z-ADDWWOALR    WWASTA                          220006
073120200529     C                     END                                            220006
073130200529     C                     ELSE                                           136935
073140200529      *
073150200529      ***  If Processing Type = Exercices and Conversion.
073160200529      *
073170200529     C           MAPTYP    IFEQ 'EX'
073180200529      *
073190200529      *****If*Customer*Option*6*or*7*is*allowed,*Actual*Stock*Allocation* 136935
073200200529      *****must*be*set*to*0.********************************************* 136935
073210200529      ***  If Option for Allocation 2 = '6' or '7', Actual Stock          136935
073220200529      ***  Allocation must be set to 0.                                   136935
073230200529      *
073240200529     C******     MJOPT6    IFEQ 'Y'                                       136935
073250200529     C******     MJOPT7    OREQ 'Y'                                       136935
073260200529     C***********WWOPT2    IFEQ '6'                                136935 161732
073270200529     C***********WWOPT2    OREQ '7'                                136935 161732
073280200529     C           WWOPT2    IFEQ '7'                                       161732
073290200529     C                     Z-ADD0         WWASTA
073300200529     C                     ELSE
073310200529      *
073320200529      *****Else,*if*Customer*Option*1,*2,*3,*4*or*5*is*allowed,********** 136935
073330200529      *****calculate*Actual*Stock*Allocation*=*Holding*multiplied by***** 136935
073340200529      *****(100*-*Cash*%*calculated).************************************ 136935
073350200529      ***  Else, if Option for Allocation 2 = '1', '2', '3', '4' or '5',  136935
073360200529      ***  calculate Actual Stock Allocation = Original Stock Allocation  136935
073370200529      ***  previously calculated multiplied by (100 - Cash % calculated). 136935
073380200529      *
073390200529     C******     MJOPT1    IFEQ 'Y'                                       136935
073400200529     C******     MJOPT2    OREQ 'Y'                                       136935
073410200529     C******     MJOPT3    OREQ 'Y'                                       136935
073420200529     C******     MJOPT4    OREQ 'Y'                                       136935
073430200529     C******     MJOPT5    OREQ 'Y'                                       136935
073440200529     C           WWOPT2    IFEQ '1'                                       136935
073450200529     C           WWOPT2    OREQ '2'                                       136935
073460200529     C           WWOPT2    OREQ '3'                                       136935
073470200529     C           WWOPT2    OREQ '4'                                       136935
073480200529     C           WWOPT2    OREQ '5'                                       136935
073490200529     C           100       SUB  WCAPR     WWCAPR  52
073500200529     C******     WWTDVD    MULT WWCAPR    WWASTA                          136935
073510200529     C******     WWOALR    MULT WWCAPR    WWASTA                   136935 164243
073520200529     C******     WWASTA    DIV  100       WWASTA                          164243
073530200529     C                     Z-ADDWWOALR    WWASTA                          164243
073540200529     C                     ELSE                                           161732
073550200529     C           WWOPT2    IFEQ '6'                                       161732
073560200529     C           MQR2CA    IFNE 0                                         161732
073570200529     C           WWOALR    MULT MQR2CA    WWASTA                          161732
073580200529     C           WWASTA    DIV  100       WWASTA                          161732
073590200529     C                     ELSE                                           161732
073600200529     C                     Z-ADDESNBDP    WWNBDP                          161732
073610200529     C                     Z-ADDMQR2CN    WUNUM                           161732
073620200529     C                     EXSR RTVNDP                                    161732
073630200529     C           WWOALR    MULT WWNUM     @WST   300                      161732
073640200529     C           @WST      DIV  WWTDVD    WWASTA                          161732
073650200529     C                     ENDIF                                          161732
073660200529     C                     ENDIF                                          161732
073670200529     C                     ENDIF
073680200529     C                     ENDIF
073690200529     C                     ELSE
073700200529      *
073710200529      ***  If Processing Type = Offers and Offer Type = Purchase Offer,   136935
073720200529      ***  calculate Actual Stock Allocation = Original Stock Allocation  136935
073730200529      ***  previously calculated multiplied by Stock Preferred %.         136935
073740200529      *****set*Actual*Stock*Allocation*to*0.***************************** 136935
073750200529      *
073760200529     C           MAPTYP    IFEQ 'OF'
073770200529     C           MIOFTY    ANDEQ'P'
073780200529     C********** WWOALR    MULT WSTPR     WWASTA                   136935 219976
073790200529     C           WWOALR    MULT WCAPR     WWASTA                          219976
073800200529     C           WWASTA    DIV  100       WWASTA                          136935
073810200529     C           MQR2CN    IFNE 0                                         219976
073820200529     C                     Z-ADDMQR2CN    WWASTA                          219976
073830200529     C                     END                                            219976
073840200529     C******               Z-ADD0         WWASTA                          136935
073850200529     C                     ELSE
073860200529      *
073870200529      ***  If Processing Type with no Customer Options (= if Free Allocation or Capital Events or
073880200529      ***  Corporate Reorganistion or Currency Change), set Actual Stock Allocation to Original
073890200529      ***  Stock Allocation previously calculated (D).
073900200529      *
073910200529     C           MAPTYP    IFEQ 'FR'                       If Free Allocation
073920200529     C           MAPTYP    OREQ 'CE'                       Or Capital Events
073930200529     C           MAPTYP    OREQ 'CR'                       Or Corporate Reorganisation
073940200529     C           MAPTYP    OREQ 'CC'                       Or Currency Change
073950200529     C                     Z-ADDWWOALR    WWASTA
073960200529      *
073970200529      *****Else,*=*if*Processing*Type*=*Dividend*Events*or*Rights*Issues* 136935
073980200529      *****or*Offer*with*Offer*Type*=*Exchange*Offer*or*Subscription***** 136935
073990200529      *****Offer.******************************************************** 136935
074000200529      ***  Else, = if Processing Type = Dividend Events or Rights Issues. 136935
074010200529      *
074020200529     C                     ELSE
074030200529      *
074040200529      ***  If Standard Instruction exists, set Customer Preference to Rounding Option from Standard
074050200529      ***  Instruction.
074060200529      *
074070200529     C                     MOVE ' '       WWROOP
074080200529     C           EXBCSI    IFEQ 'Y'
074090200529     C                     MOVE MOROOP    WWROOP  1
074100200529      *
074110200529      ***  Else, if standard Instruction does not exist.
074120200529      *
074130200529     C                     ELSE
074140200529      *
074150200529      ***  If Processing Type = Dividend Events or Rights Issues, the Rounding depends on the Option
074160200529      ***  chosen (either by the Reply Handling or by the Default No Reply).
074170200529      *
074180200529     C           MAPTYP    IFEQ 'DV'                       If Dividend Events
074190200529     C           MAPTYP    OREQ 'RG'                       Or Rights Issues
074200200529      *
074210200529      ***  If Option chosen is 2, then Customer Preference should be Round Up.
074220200529      *
074230200529     C           WWOPT2    IFEQ '2'
074240200529     C                     MOVE 'U'       WWROOP
074250200529     C                     ELSE
074260200529      *
074270200529      ***  If Option chosen is 3, then Customer Preference should be Round Down.
074280200529      *
074290200529     C           WWOPT2    IFEQ '3'
074300200529     C                     MOVE 'D'       WWROOP
074310200529     C                     ENDIF
074320200529     C                     ENDIF
074330200529     C                     ENDIF
074340200529     C                     ENDIF
074350200529      *
074360200529      ***  If Cash Preferred % previously calculated = 0 and Reply Nominal = 0.
074370200529      *
074380200529     C           WCAPR     IFEQ 0
074390200529     C           MQR2CN    ANDEQ0
074400200529      *
074410200529      ***  Retrieve Customer Options 2 and 3, depending on Processing Type.
074420200529      *
074430200529     C           MAPTYP    IFEQ 'DV'                       If Dividend Events, fron SECODVL1
074440200529     C                     MOVE MDOPT2    WUOPT2
074450200529     C                     MOVE MDOPT3    WUOPT3
074460200529     C                     ELSE
074470200529     C           MAPTYP    IFEQ 'RG'                       If Rights Issues, from SECORGL1
074480200529     C                     MOVE MFOPT2    WUOPT2
074490200529     C                     MOVE MFOPT3    WUOPT3
074500200529     C******               ELSE                                           136935
074510200529     C******     MAPTYP    IFEQ 'OF'                       If Offers,     136935
074520200529     C******               MOVE MIOPT2    WUOPT2           from SECOOFL1  136935
074530200529     C******               MOVE MIOPT3    WUOPT3                          136935
074540200529     C******               ELSE                                           136935
074550200529     C******               ENDIF                                          136935
074560200529     C                     ENDIF
074570200529     C                     ENDIF
074580200529      *
074590200529      ***  If Customer Preference is Round Up.
074600200529      *
074610200529     C           WWROOP    IFEQ 'U'
074620200529      *
074630200529      ***  If Customer Option 2 is allowed.
074640200529      *
074650200529     C           WUOPT2    IFEQ 'Y'
074660200529      *
074670200529      ***  Calculate work field I = True Stock Allocation previously calculated divided by
074680200529      ***  Denomination Multiplier and rounding up to nearest unit.
074690200529      *
074700200529     C           WWOTSA    DIV  WWDMLT    FLDIW  309
074710200529     C                     Z-ADDFLDIW     FLDI   300
074720200529     C           FLDIW     IFNE FLDI
074730200529     C                     ADD  1         FLDI
074740200529     C                     ENDIF
074750200529      *
074760200529      ***  Calculate Actual Stock Allocation = work field I multiplied by Denomination
074770200529      ***  Multiplier.
074780200529      *
074790200529     C           FLDI      MULT WWDMLT    WWASTA
074800200529     C                     ELSE
074810200529      *
074820200529      ***  Else, if Customer Option 2 is not allowed, set Actual Stock Allocation to Original
074830200529      ***  Stock Allocation previously calculated.
074840200529      *
074850200529     C                     Z-ADDWWOALR    WWASTA
074860200529     C                     ENDIF
074870200529      *
074880200529      ***  Else, if Customer Preference is not Round Up.
074890200529      *
074900200529     C                     ELSE
074910200529      *
074920200529      ***  If Customer Option 3 is allowed.
074930200529      *
074940200529     C           WUOPT3    IFEQ 'Y'
074950200529      *
074960200529      ***  Calculate work field I = True Stock Allocation previously calculated divided by
074970200529      ***  Denomination Multiplier and rounding down to nearest unit.
074980200529      *
074990200529     C           WWOTSA    DIV  WWDMLT    FLDI
075000200529      *
075010200529      ***  Calculate Actual Stock Allocation = work field I multiplied by Denomination
075020200529      ***  Multiplier.
075030200529      *
075040200529     C           FLDI      MULT WWDMLT    WWASTA
075050200529     C                     ELSE
075060200529      *
075070200529      ***  Else, if Customer Option 3 is not allowed, set Actual Stock Allocation to Original
075080200529      ***  Stock Allocation previously calculated.
075090200529      *
075100200529     C                     Z-ADDWWOALR    WWASTA
075110200529     C                     ENDIF
075120200529     C                     ENDIF
075130200529      *
075140200529      ***  Else, if Cash Preferred % previously calculated not 0 or Reply Nominal not 0.
075150200529      *
075160200529     C                     ELSE
075170200529      *
075180200529      ***  If Customer Preference is Round Up, calculate work field I = work field EE divided by
075190200529      ***  Denomination Multiplier and rounding up to nearest unit.
075200200529      *
075210200529     C           WWROOP    IFEQ 'U'
075220200529     C           FLDEE     DIV  WWDMLT    FLDIW
075230200529     C                     Z-ADDFLDIW     FLDI
075240200529     C           FLDIW     IFNE FLDI
075250200529     C                     ADD  1         FLDI
075260200529     C                     ENDIF
075270200529     C                     ELSE
075280200529      *
075290200529      ***  Else, if Customer Preference is not Round Down, calculate work field I = work field EE
075300200529      ***  divided by Denomination Multiplier and rounding down to nearest unit.
075310200529      *
075320200529     C           FLDEE     DIV  WWDMLT    FLDI
075330200529     C                     ENDIF
075340200529      *
075350200529      ***  Calculate Actual Stock Allocation = Wrk field I multiplied by Denomination Multiplier.
075360200529      *
075370200529     C           FLDI      MULT WWDMLT    WWASTA
075380200529     C                     ENDIF
075390200529     C                     ENDIF
075400200529     C                     ENDIF
075410200529     C                     ENDIF
075420200529     C                     ENDIF                                          136935
075430200529      *
075440200529      ***  Set Actual Stock Allocation calculated.
075450200529      *
075460200529     C                     Z-ADDNSNBDP    WWNBDP           New Security Decimal Places
075470200529     C                     MOVE WWRNDN    WUROOP           Rounding from CO Detail file
075480200529     C                     Z-ADDWWASTA    WWNUM
075490200529     C                     EXSR ROUNDD
075500200529     C                     Z-ADDWWNUM     WWASTA
075510200529      *
075520200529     C                     ENDSR
075530200529      *
075540200529      *****************************************************************
075550200529      /EJECT
075560200529      *****************************************************************
075570200529      *                                                               *
075580200529      * CASRBC - Calculate Actual Stock Rounding for Book/Customer.   *
075590200529      *                                                               *
075600200529      * Called by:                                                    *
075610200529      *                                                               *
075620200529      * Calls:                                                        *
075630200529      *                                                               *
075640200529      *****************************************************************
075650200529      *
075660200529     C           CASRBC    BEGSR                           ** CASRBC SR **
075670200529      *                                                                   136935
075680200529      ***  If Processing Type = Offer with Offer Type = Subscription or   136935
075690200529      ***  Purchase, set Actual Stock Rounding to 0.                      136935
075700200529      *                                                                   136935
075710200529     C           MAPTYP    IFEQ 'OF'                                      136935
075720200529     C           MIOFTY    ANDEQ'S'                                       136935
075730200529     C           MAPTYP    OREQ 'OF'                                      136935
075740200529     C           MIOFTY    ANDEQ'P'                                       136935
075750200529     C                     Z-ADD0         WWASTR                          136935
075760200529      *                                                                   136935
075770200529      ***  Else, if Processing Type not Offer with Offer Type =           136935
075780200529      ***  Subscription and Purchase.                                     136935
075790200529      *                                                                   136935
075800200529     C                     ELSE                                           136935
075810200529      *
075820200529      ***  Calculate Actual Stock Rounding = work field EE previously calculated - Actual Stock
075830200529      ***  Allocation previously calculated.
075840200529      *
075850200529     C           FLDEE     SUB  WWASTA    WWASTR
075860200529      *
075870200529      ***  Set Actual Stock Rounding calculated.
075880200529      *
075890200529     C                     Z-ADD8         WWNBDP           8 Decimal Places
075900200529     C                     MOVE WWRNDN    WUROOP           Rounding from CO Detail file
075910200529     C                     Z-ADDWWASTR    WWNUM
075920200529     C                     EXSR ROUNDD
075930200529     C                     Z-ADDWWNUM     WWASTR
075940200529     C                     ENDIF                                          136935
075950200529      *
075960200529     C                     ENDSR
075970200529      *
075980200529      *****************************************************************
075990200529      /EJECT
076000200529      *****************************************************************
076010200529      *                                                               *
076020200529      * CACRBC - Calculate Actual Cash Rounding for Book/Customer.    *
076030200529      *                                                               *
076040200529      * Called by:                                                    *
076050200529      *                                                               *
076060200529      * Calls:                                                        *
076070200529      *                                                               *
076080200529      *****************************************************************
076090200529      *
076100200529     C           CACRBC    BEGSR                           ** CACRBC SR **
076110200529      *                                                                   136935
076120200529      ***  If Processing Type = Offer with Offer Type = Subscription or   136935
076130200529      ***  Purchase, set Actual Cash Rounding to 0.                       136935
076140200529      *                                                                   136935
076150200529     C           MAPTYP    IFEQ 'OF'                                      136935
076160200529     C           MIOFTY    ANDEQ'S'                                       136935
076170200529     C           MAPTYP    OREQ 'OF'                                      136935
076180200529     C           MIOFTY    ANDEQ'P'                                       136935
076190200529     C                     Z-ADD0         WWACAR                          136935
076200200529      *                                                                   136935
076210200529      ***  Else, if Processing Type not Offer with Offer Type =           136935
076220200529      ***  Subscription and Purchase.                                     136935
076230200529      *                                                                   136935
076240200529     C                     ELSE                                           136935
076250200529      *
076260200529     C           MAPTYP    IFEQ 'DV'                       If Processing Type = Dividends Events
076270200529     C           MDSDIT    ANDEQ'S'                           Stock Dividend Type = Stock for Stock
076280200529     C           MDOSHA    ANDNE0                             Number of Old Shares not 0
076290200529     C           WWNSHA    ANDNE0                             Number of New Shares not 0
076300200529      *
076310200529     C           MAPTYP    OREQ 'DV'                       Or Processing Type = Dividends Events
076320200529     C           MDSDIT    ANDEQ'C'                           Stk Dividend Tp=Combined for Cash&Stk
076330200529     C           MDOSHA    ANDNE0                             Number of Old Shares not 0
076340200529     C           WWNSHA    ANDNE0                             Number of New Shares not 0
076350200529      *
076360200529     C           MAPTYP    OREQ 'DV'                       Or Processing Type = Dividends Events
076370200529     C           MDSDIT    ANDEQ'O'                           Stk Dividend Tp=Optional for Cash&Stk
076380200529     C           MDOSHA    ANDNE0                             Number of Old Shares not 0
076390200529     C           WWNSHA    ANDNE0                             Number of New Shares not 0
076400200529      *
076410200529     C           MAPTYP    OREQ 'FR'                       Or Processing Type = Free Allocation
076420200529     C           MDOSHA    ANDNE0                             Number of Old Shares not 0
076430200529     C           WWNSHA    ANDNE0                             Number of New Shares not 0
076440200529      *
076450200529     C           MAPTYP    OREQ 'RG'                       Or Processing Type = Rights Issues
076460200529     C           MDOSHA    ANDNE0                             Number of Old Shares not 0
076470200529     C           WWNSHA    ANDNE0                             Number of New Shares not 0
076480200529      *
076490200529     C           MAPTYP    OREQ 'CR'                       Or Proces.Type = Corporate Reorganisation
076500200529     C           MDOSHA    ANDNE0                             Number of Old Shares not 0
076510200529     C           WWNSHA    ANDNE0                             Number of New Shares not 0
076520200529      *
076530200529     C           MAPTYP    OREQ 'EX'                       Or Proces.Type= Exervices and Conversions
076540200529     C           MDOSHA    ANDNE0                             Number of Old Shares not 0
076550200529     C           WWNSHA    ANDNE0                             Number of New Shares not 0
076560200529     C*****      MDSBPR    ANDNE0                             Subscription136935
076570200529      *
076580200529     C           MAPTYP    OREQ 'OF'                       Or Processing Type = Offers
076590200529     C           MDOSHA    ANDNE0                             Number of Old Shares not 0
076600200529     C           WWNSHA    ANDNE0                             Number of New Shares not 0
076610200529      *                                                                   CEU017
076620200529      ***  Or Processing Type = Currency Changes and Old and New Nominal  CEU017
076630200529      ***  Size not zero.                                                 CEU017
076640200529      *                                                                   CEU017
076650200529     C           MAPTYP    OREQ 'CC'                                      CEU017
076660200529     C           MDOSHA    ANDNE0                                         CEU017
076670200529     C           WWNSHA    ANDNE0                                         CEU017
076680200529      *
076690200529      ***  If Rounding Settlement in Cash = 'Y',
076700200529      ***  calculate Actual Cash Rounding = Actual Stock Rounding previously calculated
076710200529      ***  multiplied by Compensation Price.
076720200529      *
076730200529     C           WWRNDS    IFEQ 'Y'
076740200529     C           WWASTR    MULT WWCOMP    WWACAR
076750200529      *
076760200529      ***  If Price Basis is 'P' for %, result should be divided by 100.
076770200529      *
076780200529     C           NSSPBS    IFEQ 'P'
076790200529     C           WWACAR    DIV  100       WWACAR
076800200529     C                     ENDIF
076810200529     C                     ELSE
076820200529      *
076830200529      ***  If Rounding Settlement in Cash = 'N', set Actual Cash Rounding to 0.
076840200529      *
076850200529     C                     Z-ADD0         WWACAR
076860200529     C                     ENDIF
076870200529     C                     ENDIF
076880200529     C                     ENDIF                                          136935
076890200529      *
076900200529     C           MAPTYP    IFEQ 'DV'                       If Processing Type = Dividends Events
076910200529     C           MDSDIT    ANDEQ'S'                           Stock Dividend Type = Stock for Stock
076920200529     C********** MDDIVU    ANDNE0                             Dividend Per Unit not 0         190204
076930200529     C           MDDIV1    ANDNE0                             Dividend Per Unit not 0         190204
076940200529     C           MDSBPR    ANDNE0                             Subscription Price not 0
076950200529      *
076960200529     C           MAPTYP    OREQ 'DV'                       If Processing Type = Div Events    215071
076970200529     C           MDSDIT    ANDEQ'O'                           Stock Div Tp=Opt for cash stock 215071
076980200529     C           MDDIV1    ANDNE0                             Dividend per Unit not zero      215071
076990200529     C           MDSBPR    ANDNE0                             Subscription Price not zero     215071
077000200529      *                                                                                       215071
077010200529      ***  If Rounding Settlement in Cash = 'Y'.
077020200529      ***  Calculate Actual Cash Rounding = (Holding Taken as Stock previously calculated multiplied
077030200529      ***  by Dividend Per Unit) - (Actual Stock Allocation previously calculated multiplied by
077040200529      ***  Subscription Price).
077050200529      *
077060200529     C           WWRNDS    IFEQ 'Y'
077070200529     C******               Z-ADDNSNBDP    WWNBDP                          135690
077080200529     C**********           Z-ADDNCNBDP    WWNBDP                   135690 190204
077090200529     C**********           Z-ADDMDDIVU    WUNUM                           190204
077100200529     C**********           EXSR RTVNDP                                    190204
077110200529     C                     Z-ADDMDDIV1    WWNUM                           190204
077120200529     C           WWHOST    MULT WWNUM     W1ACAR 309
077130200529     C           WWASTA    MULT MDSBPR    W2ACAR 309
077140200529      *
077150200529      ***  If Price Basis is 'P' for %, result should be divided by 100.
077160200529      *
077170200529     C           NSSPBS    IFEQ 'P'
077180200529     C           W2ACAR    DIV  100       W2ACAR
077190200529     C                     ENDIF
077200200529     C           W1ACAR    SUB  W2ACAR    WWACAR
077210200529     C                     ELSE
077220200529      *
077230200529      ***  If Rounding Settlement in Cash = 'N', set Actual Cash Rounding to 0.
077240200529      *
077250200529     C                     Z-ADD0         WWACAR
077260200529     C                     ENDIF
077270200529     C                     ENDIF
077280200529      *
077290200529     C           MAPTYP    IFEQ 'DV'                       If Processing Type = Dividends Events
077300200529     C           MDSDIT    ANDEQ'R'                           Stk Dividend Tp=Reinvestment of Divid.
077310200529     C********** MDDIVU    ANDNE0                             Dividend Per Unit not 0         190204
077320200529     C           MDDIV1    ANDNE0                             Dividend Per Unit not 0         190204
077330200529     C           MDSBPR    ANDNE0                             Subscription Price not 0
077340200529      *
077350200529     C           MAPTYP    OREQ 'EX'                       Or Processing Type = Dividends Events
077360200529     C           MJCPRC    ANDNE0                             Conversion Price not 0
077370200529     C           MJCEXR    ANDNE0                             Conversion Exchange Rate not 0
077380200529     C           MDSBPR    ANDNE0                             Subscription Price not 0
077390200529      *
077400200529      ***  If Rounding Settlement in Cash = 'Y'.
077410200529      ***  Calculate Actual Cash Rounding = Actual Cash Pool previously calculated - (Actual Stock
077420200529      ***  Allocation previously calculated multiplied by Subscription Price).
077430200529      *
077440200529     C           WWRNDS    IFEQ 'Y'
077450200529     C           WWASTA    MULT MDSBPR    W1ACAR 309
077460200529      *
077470200529      ***  If Price Basis is 'P' for %, result should be divided by 100.
077480200529      *
077490200529     C           NSSPBS    IFEQ 'P'
077500200529     C           W1ACAR    DIV  100       W1ACAR
077510200529     C                     ENDIF
077520200529     C           ACCAPO    SUB  W1ACAR    WWACAR
077530200529     C                     ELSE
077540200529      *
077550200529      ***  If Rounding Settlement in Cash = 'N', set Actual Cash Rounding to 0.
077560200529      *
077570200529     C                     Z-ADD0         WWACAR
077580200529     C                     ENDIF
077590200529     C                     ENDIF
077600200529      *
077610200529      ***  If Processing Type = Capital Changes, set Actual Cash Rounding to 0.
077620200529      *
077630200529     C           MAPTYP    IFEQ 'CE'
077640200529     C                     Z-ADD0         WWACAR
077650200529     C                     ENDIF
077660200529      *                                                                   161732
077670200529      ** If Processing Type = Exercise and Conversions, and Option for    161732
077680200529      ** Allocation = '6', zeroise Actual Cash Rounding.                  161732
077690200529      *                                                                   161732
077700200529     C           MAPTYP    IFEQ 'EX'                                      161732
077710200529     C           WWOPT2    ANDEQ'6'                                       161732
077720200529     C                     Z-ADD0         WWACAR                          161732
077730200529     C                     ENDIF                                          161732
077740200529      *
077750200529      ***  Set Actual Cash Rounding calculated.
077760200529      *
077770200529     C                     Z-ADDNCNBDP    WWNBDP           New Currency Decimal Places
077780200529     C                     MOVE 'R'       WUROOP           Rounding = half adjust
077790200529     C                     Z-ADDWWACAR    WWNUM
077800200529     C                     EXSR ROUNDD
077810200529     C                     Z-ADDWWNUM     WWACAR
077820200529      *
077830200529      ***  Accumulate Actual Cash Rounding.
077840200529      *
077850200529     C                     ADD  WWACAR    WTACAR
077860200529      *
077870200529     C                     ENDSR
077880200529      *
077890200529      *****************************************************************
077900200529      /EJECT
077910200529      *****************************************************************
077920200529      *                                                               *
077930200529      * CHSTBC - Calculate Holding Taken as Stock for Book/Customer.  *
077940200529      *                                                               *
077950200529      * Called by:                                                    *
077960200529      *                                                               *
077970200529      * Calls:                                                        *
077980200529      *                                                               *
077990200529      *****************************************************************
078000200529      *
078010200529     C           CHSTBC    BEGSR                           ** CHSTBC SR **
078020200529      *                                                                   136935
078030200529      ***  If Processing Type = Offers with Offer Type = Subscription,    136935
078040200529      ***  calculate Holding Taken as Stock = Original Stock              136935
078050200529      ***  Allocation multiplied by Stock Preferred %.                    136935
078060200529      *                                                                   136935
078070200529     C           MAPTYP    IFEQ 'OF'                                      136935
078080200529     C           MIOFTY    ANDEQ'S'                                       136935
078090200529     C********** 100       SUB  WCAPR     WSTPR                                        136935 193662
078100200529     C           WWOALR    MULT WSTPR     WWHOST                          136935
078110200529     C           WWHOST    DIV  100       WWHOST                          136935
078120200529     C                     Z-ADDESNBDP    WWNBDP           Event Sec.DP   136935
078130200529     C                     MOVE WWRNDN    WUROOP           Rnd from CO Dt.136935
078140200529     C                     Z-ADDWWHOST    WWNUM                           136935
078150200529     C                     EXSR ROUNDD                                    136935
078160200529     C                     Z-ADDWWNUM     WWHOST                          136935
078170200529     C                     ELSE                                           136935
078180200529      *
078190200529     C           MAPTYP    IFEQ 'OF'                       If Processing Type = Offers
078200200529     C           MIOFTY    ANDEQ'P'                           Offer Type = Purchase Offer
078210200529      *
078220200529      ***  Set Holding Taken as Stock to 0 (must not be calculated) and save value.
078230200529      *
078240200529     C                     Z-ADD0         WWHOST
078250200529     C                     Z-ADD0         WUHOST
078260200529      *
078270200529     C                     ELSE
078280200529      *
078290200529     C           MAPTYP    IFEQ 'EX'                       If Process.Type = Exercices & Conversions
078300200529      *
078310200529      *****If*Customer*Option*6*or*7*is*allowed,*Holding*Taken*as*Stock** 136935
078320200529      *****must*be*set*to*0*and*save*value.****************************** 136935
078330200529      *****If*Option*for*Actual*Allocation*2*=*'6'*or*'7',*Holding 136935 161732
078340200529      *****as*Stock*must*be*set*to*0,*and*save*value.************* 136935 161732
078350200529      ** If Option for Allocation 2 = '7', set Holding Taken as Stock     161732
078360200529      ** to 0, and save value.                                            161732
078370200529      *
078380200529     C******     MJOPT6    IFEQ 'Y'                                       136935
078390200529     C******     MJOPT7    OREQ 'Y'                                       136935
078400200529     C***********WWOPT2    IFEQ '6'                                136935 161732
078410200529     C***********WWOPT2    OREQ '7'                                136935 161732
078420200529     C           WWOPT2    IFEQ '7'                                       161732
078430200529     C                     Z-ADD0         WWHOST
078440200529     C                     Z-ADD0         WUHOST
078450200529     C                     ELSE
078460200529      *
078470200529      *****Else,*if*Customer*Option*1,*2,*3,*4*or*5*is*allowed,********** 136935
078480200529      ***  Else, if Option for Allocation 2 = '1', '2', '3', '4' or '5',  136935
078490200529      ***  Calculate Holding Taken as Stock = Holding (= Ex-Date Position) multiplied by
078500200529      ***  (100 - Cash % calculated).
078510200529      *
078520200529     C******     MJOPT1    IFEQ 'Y'                                       136935
078530200529     C******     MJOPT2    OREQ 'Y'                                       136935
078540200529     C******     MJOPT3    OREQ 'Y'                                       136935
078550200529     C******     MJOPT4    OREQ 'Y'                                       136935
078560200529     C******     MJOPT5    OREQ 'Y'                                       136935
078570200529     C           WWOPT2    IFEQ '1'                                       136935
078580200529     C           WWOPT2    OREQ '2'                                       136935
078590200529     C           WWOPT2    OREQ '3'                                       136935
078600200529     C           WWOPT2    OREQ '4'                                       136935
078610200529     C           WWOPT2    OREQ '5'                                       136935
078620200529     C           100       SUB  WCAPR     WWCAPR  52
078630200529     C           WWTDVD    MULT WWCAPR    WWHOST
078640200529     C           WWHOST    DIV  100       WWHOST
078650200529      *
078660200529      ***  Save Holding Taken as Stock.
078670200529      *
078680200529     C                     Z-ADDWWHOST    WUHOST
078690200529      *
078700200529      ***  Set Holding Taken as Stock calculated.
078710200529      *
078720200529     C                     Z-ADDESNBDP    WWNBDP           Event Security Decimal Places
078730200529     C                     MOVE WWRNDN    WUROOP           Rounding from CO Detail file
078740200529     C                     Z-ADDWWHOST    WWNUM
078750200529     C                     EXSR ROUNDD
078760200529     C                     Z-ADDWWNUM     WWHOST
078770200529     C                     ELSE                                           161732
078780200529      *                                                                   161732
078790200529      ** Else if Option for Allocation 2 = '6'                            161732
078800200529      *                                                                   161732
078810200529     C           WWOPT2    IFEQ '6'                                       161732
078820200529      *                                                                   161732
078830200529      ** If Reply Cash % Level 2 is zero, set Holding Taken as Stock      161732
078840200529      ** equal to Nominal Taken as Cash Level 2.                          161732
078850200529      *                                                                   161732
078860200529     C           MQR2CA    IFEQ *ZERO                                     161732
078870200529     C                     Z-ADDMQR2CN    WUHOST                          161732
078880200529      *                                                                   161732
078890200529      ** Else, calculate Holding Taken as Stock = Ex-date position        161732
078900200529      ** multiplied by Reply Cash % Level 2 divided by 100                161732
078910200529      *                                                                   161732
078920200529     C                     ELSE                                           161732
078930200529     C           WWTDVD    MULT MQR2CA    WUHOST                          161732
078940200529     C                     DIV  100       WUHOST                          161732
078950200529     C                     ENDIF                                          161732
078960200529      *                                                                   161732
078970200529      ** Apply correct no. of decimal places to Holding Taken as Stock    161732
078980200529      *                                                                   161732
078990200529     C                     Z-ADDESNBDP    WWNBDP                          161732
079000200529     C                     MOVE WWRNDN    WUROOP                          161732
079010200529     C                     Z-ADDWUHOST    WWNUM                           161732
079020200529     C                     EXSR ROUNDD                                    161732
079030200529     C***********          Z-ADDWWNUM     WUHOST                          161732
079040200529     C                     Z-ADDWWNUM     WWHOST                          161732
079050200529     C                     ENDIF                                          161732
079060200529     C                     ENDIF
079070200529     C                     ENDIF
079080200529      *
079090200529     C                     ELSE
079100200529      *
079110200529     C           MAPTYP    IFEQ 'OF'                       If Processing Type = Offers
079120200529     C           MIOFTY    ANDEQ'E'                           Offer Type = Exchange Offers
079130200529     C******     MAPTYP    OREQ 'OF'                       Or Subscription136935
079140200529     C******     MIOFTY    ANDEQ'S'                           Offers      136935
079150200529     C           MAPTYP    OREQ 'NF'                       Or Processing Type = Non Financial Events
079160200529      *
079170200529      ***  If Current Reply exists.
079180200529      ***  and Reply Nominal (= Nominal Taken as Cash Level 2) not 0,     135690
079190200529      ***  calculate Holding Taken as Stock = Holding (= Ex-Date          135690
079200200529      ***  Position) - Reply Nominal (= Nominal Taken as Cash Level 2).   135690
079210200529      *
079220200529     C           EXBCRE    IFEQ 'Y'
079230200529     C           MQR2CN    ANDNE0                                         135690
079240200529      *                                                                   135690
079250200529      *****Calculate*Holding*Taken*as*Stock*=*Current*Holding*(=*Ex-Date* 135690
079260200529      *****Position)***%*accepted*calculated*previously*OR*Nominal******* 135690
079270200529      *****Accepted*(=*Nominal*Taken*as*Cash*Level*2*from*Current*Reply** 135690
079280200529      *****(SECOREL0)).************************************************** 135690
079290200529      ******                                                              135690
079300200529     C******     WCAPR     IFNE 0                                         135690
079310200529     C******     WWTDVD    MULT WCAPR     W1HOST 309                      135690
079320200529     C******     W1HOST    DIV  100       WWHOST 309                      135690
079330200529     C******               ELSE                                           135690
079340200529     C                     Z-ADDESNBDP    WWNBDP
079350200529     C                     Z-ADDMQR2CN    WUNUM
079360200529     C                     EXSR RTVNDP
079370200529     C           WWTDVD    MULT WWNUM     WWHOST 309
079380200529     C           WWOPT2    IFEQ '3'                                       220006
079390200529     C                     Z-ADDWWNUM     WWHOST                          220006
079400200529     C                     END                                            220006
079410200529     C******               ENDIF                                          135690
079420200529     C                     ELSE                                           135690
079430200529      *                                                                   135690
079440200529      ***  Else, if Current Reply does not exist otr Current Reply exists 135690
079450200529      ***  and Reply Nominal (= Nominal Taken as Cash Level 2) = 0,       135690
079460200529      ***  calculate Holding Taken as Stock = Current Holding (= Ex-Date  135690
079470200529      ***  Position) * % accepted calculated previously for Offers or %   135690
079480200529      ***  accepted entered on the Reply Handling screen (= Reply Cash %  135690
079490200529      ***  Level 2) for Non Financial Event.                              135690
079500200529      *                                                                   135690
079510200529     C           MAPTYP    IFEQ 'OF'                                      135690
079520200529     C*****      WWTDVD    MULT WCAPR     W1HOST 309               135690 136935
079530200529     C           MIOFTY    IFEQ 'E'                                                           193662
079540200529     C           100       SUB  WCAPR     WSTPR                           136935
079550200529     C                     ENDIF                                                              193662
079560200529     C           WWTDVD    MULT WSTPR     W1HOST 309                      136935
079570200529     C           WWOPT2    IFEQ '3'                                       220006
079580200529     C           WWTDVD    MULT WCAPR     W1HOST 309                      220006
079590200529     C                     END                                            220006
079600200529     C                     ELSE                                           135690
079610200529     C           WWTDVD    MULT MQR2CA    W1HOST 309                      135690
079620200529     C                     ENDIF                                          135690
079630200529     C           W1HOST    DIV  100       WWHOST 309                      135690
079640200529     C                     ENDIF                                          135690
079650200529      *
079660200529      ***  Save Holding Taken as Stock.
079670200529      *
079680200529     C                     Z-ADDWWHOST    WUHOST
079690200529      *
079700200529      ***  Set Holding Taken as Stock calculated.
079710200529      *
079720200529     C                     Z-ADDESNBDP    WWNBDP           Event Security Decimal Places
079730200529     C                     MOVE WWRNDN    WUROOP           Rounding from CO Detail file
079740200529     C                     Z-ADDWWHOST    WWNUM
079750200529     C                     EXSR ROUNDD
079760200529     C                     Z-ADDWWNUM     WWHOST
079770200529     C******               ELSE                                           135690
079780200529     C******               Z-ADD0         WWHOST                          135690
079790200529     C******               ENDIF                                          135690
079800200529      *
079810200529     C                     ELSE
079820200529      *
079830200529     C           MAPTYP    IFEQ 'FR'                       If Processing Type = Free Allocation
079840200529     C           MAPTYP    OREQ 'RG'                       Or Processing Type = Rights Issues
079850200529     C           MAPTYP    OREQ 'CE'                       Or Processing Type = Capital Change
079860200529     C           MAPTYP    OREQ 'CR'                       Or Proces.Type = Corporate Reorganisation
079870200529     C           MAPTYP    OREQ 'NC'                       Or Processing Type = Name Changes
079880200529     C           MAPTYP    OREQ 'CC'                       Or Ccy Changes CEU017
079890200529      *
079900200529      ***  Set Holding Taken as Stock to Ex-Date Position from SEUDEPL0 or SECDEPL4
079910200529      ***  previously retrieved (= Original Holding) and save value.
079920200529      *
079930200529     C                     Z-ADDWWTDVD    WWHOST
079940200529     C                     Z-ADDWWTDVD    WUHOST
079950200529      *
079960200529      ***  Set Holding Taken as Stock calculated.
079970200529      *
079980200529     C                     Z-ADDESNBDP    WWNBDP           Event Security Decimal Places
079990200529     C                     MOVE WWRNDN    WUROOP           Rounding from CO Detail file
080000200529     C                     Z-ADDWWHOST    WWNUM
080010200529     C                     EXSR ROUNDD
080020200529     C                     Z-ADDWWNUM     WWHOST
080030200529     C                     ELSE
080040200529      *
080050200529      ***  If Processing Type = Dividend Events,
080060200529      ***  if Current Reply exists and Reply Nominal (= Nominal Taken as Cash Level 2) not 0,
080070200529      ***  calculate Holding Taken as Stock = Holding (= Ex-Date Position) - Reply Nominal
080080200529      ***  (= Nominal Taken as Cah Level 2).
080090200529      *
080100200529     C           EXBCRE    IFEQ 'Y'
080110200529     C           MQR2CN    ANDNE0
080120200529     C                     Z-ADDESNBDP    WWNBDP
080130200529     C                     Z-ADDMQR2CN    WUNUM
080140200529     C                     EXSR RTVNDP
080150200529     C           WWTDVD    SUB  WWNUM     WWHOST
080160200529      *
080170200529      ***  Save Holding Taken as Stock.
080180200529      *
080190200529     C                     Z-ADDWWHOST    WUHOST
080200200529      *
080210200529      ***  Set Holding Taken as Stock calculated.
080220200529      *
080230200529     C                     Z-ADDESNBDP    WWNBDP           Event Security Decimal Places
080240200529     C                     MOVE WWRNDN    WUROOP           Rounding from CO Detail file
080250200529     C                     Z-ADDWWHOST    WWNUM
080260200529     C                     EXSR ROUNDD
080270200529     C                     Z-ADDWWNUM     WWHOST
080280200529      *
080290200529      ***  Else, if Current Reply does not exist otr Current Reply exists and Reply Nominal
080300200529      ***  (= Nominal Taken as Cash Level 2) = 0.
080310200529      *
080320200529     C                     ELSE
080330200529      *
080340200529      ***  If Cash Preferred % = 0.
080350200529      *
080360200529     C******     MOCAPP    IFEQ 0                                         135690
080370200529     C           WCAPR     IFEQ 0                                         135690
080380200529      *
080390200529      ***  Set Holding Taken as Stock to Ex-Date Position from SEUDEPL0 or SECDEPL4
080400200529      ***  previously retrieved and save value.
080410200529      *
080420200529     C                     Z-ADDWWTDVD    WWHOST
080430200529     C                     Z-ADDWWTDVD    WUHOST
080440200529      *
080450200529      ***  Set Holding Taken as Stock calculated.
080460200529      *
080470200529     C                     Z-ADDESNBDP    WWNBDP           Event Security Decimal Places
080480200529     C                     MOVE WWRNDN    WUROOP           Rounding from CO Detail file
080490200529     C                     Z-ADDWWHOST    WWNUM
080500200529     C                     EXSR ROUNDD
080510200529     C                     Z-ADDWWNUM     WWHOST
080520200529      *
080530200529      ***  Else, if Cash Preferred % not equal 0.
080540200529      *
080550200529     C                     ELSE
080560200529      *
080570200529      ***  If Cash Preferred % = 100.
080580200529      *
080590200529     C******     MOCAPP    IFEQ 100                                       135690
080600200529     C           WCAPR     IFEQ 100                                       135690
080610200529      *
080620200529      ***  Set Holding Taken as Stock to 0 and save value.
080630200529      *
080640200529     C                     Z-ADD0         WWHOST
080650200529     C                     Z-ADD0         WUHOST
080660200529      *
080670200529      ***  Else, if Cash Preferred % not equal 100 (and not equal 0).
080680200529      *
080690200529     C                     ELSE
080700200529      *
080710200529      ***  If Number of Old and New Shares from SECOxxL1 not equal 0.
080720200529      *
080730200529     C           WWNSHA    IFNE 0
080740200529     C           MDOSHA    ANDNE0
080750200529      *
080760200529      ***  Calculate Holding Taken as Stock = (Actual Stock Allocation calculated before
080770200529      ***  divided by Number of New Shares from SECOxxL1) multiplied by Number of Old Shares from
080780200529      ***  SECOxxL1 and rounded up.
080790200529      *
080800200529     C           WWASTA    DIV  WWNSHA    W1HOST 309
080810200529     C           W1HOST    MULT MDOSHA    WWHOST
080820200529      *
080830200529      ***  Save Holding Taken as Stock.
080840200529      *
080850200529     C                     Z-ADDWWHOST    WUHOST
080860200529      *
080870200529      ***  Set Holding Taken as Stock calculated.
080880200529      *
080890200529     C                     Z-ADDESNBDP    WWNBDP           Event Security Decimal Places
080900200529     C                     MOVE 'U'       WUROOP           Rounding = up
080910200529     C                     Z-ADDWWHOST    WWNUM
080920200529     C                     EXSR ROUNDD
080930200529     C                     Z-ADDWWNUM     WWHOST
080940200529      *
080950200529      ***  Else, if Number of Old or New Shares from SECOxxL1 equal 0.
080960200529      *
080970200529     C                     ELSE
080980200529      *
080990200529      ***  Calculate Holding Taken as Stock = (Actual Stock Allocation calculated before
081000200529      ***  multiplied by Subscription Price) divided by Dividend Per Unit (less Tax Deducted at
081010200529      ***  Source and Tax Deducted by User based on Dividend Per Unit if Stock Dividend Type = 'R'
081020200529      ***  as Reinvestment of Dividend and feature Witholding Tax is ON), and rounded up.
081030200529      *
081040200529     C           WWASTA    MULT MDSBPR    W1HOST
081050200529      *
081060200529      ***  If Price Basis is 'P' for %, result should be divided by 100.
081070200529      *
081080200529     C           NSSPBS    IFEQ 'P'
081090200529     C           W1HOST    DIV  100       W1HOST
081100200529     C                     ENDIF
081110200529     C           MDSDIT    IFEQ 'R'
081120200529     C           S01447    ANDEQ'Y'
081130200529     C                     Z-ADDWWDIVU    WWAMTT
081140200529     C                     EXSR CTOTAX
081150200529     C                     SUB  TOTTAX    WWDIVU
081160200529     C                     ENDIF
081170200529     C           W1HOST    DIV  WWDIVU    WWHOST
081180200529      *
081190200529      ***  Save Holding Taken as Stock.
081200200529      *
081210200529     C                     Z-ADDWWHOST    WUHOST
081220200529      *
081230200529      ***  Set Holding Taken as Stock calculated.
081240200529      *
081250200529     C                     Z-ADDESNBDP    WWNBDP           Event Security Decimal Places
081260200529     C                     MOVE 'U'       WUROOP           Rounding = up
081270200529     C                     Z-ADDWWHOST    WWNUM
081280200529     C                     EXSR ROUNDD
081290200529     C                     Z-ADDWWNUM     WWHOST
081300200529     C                     ENDIF
081310200529     C                     ENDIF
081320200529     C                     ENDIF
081330200529     C                     ENDIF
081340200529     C                     ENDIF
081350200529     C                     ENDIF
081360200529     C                     ENDIF
081370200529     C                     ENDIF
081380200529     C                     ENDIF                                          136935
081390200529      *
081400200529     C                     ENDSR
081410200529      *
081420200529      *****************************************************************
081430200529      /EJECT
081440200529      *****************************************************************
081450200529      *                                                               *
081460200529      * CACAPO - Calculate Actual Cash Pool for Book/Customer.        *
081470200529      *                                                               *
081480200529      * Called by:                                                    *
081490200529      *                                                               *
081500200529      * Calls:                                                        *
081510200529      *                                                               *
081520200529      *****************************************************************
081530200529      *
081540200529     C           CACAPO    BEGSR                           ** CACAPO SR **
081550200529      *
081560200529      ***  If feature Withholding Tax is ON.
081570200529      *
081580200529     C           S01447    IFEQ 'Y'
081590200529      *
081600200529      ***  Calculate Tax Deducted at Source and Tax Deducted by User based on Dividend per Unit.
081610200529      *
081620200529     C                     Z-ADDWWDIVU    WWAMTT
081630200529     C                     EXSR CTOTAX
081640200529      *
081650200529      ***  If Customer calculation, calculate Dividend Per Unit les Tax Deducted at Source and Tax
081660200529      ***  Deducted by User based on Dividend Per Unit.
081670200529      *
081680200529     C           FROMBC    IFEQ 'C'
081690200529     C           WWDIVU    SUB  TOTTAX    TADIVU 309
081700200529     C                     ELSE
081710200529      *
081720200529      ***  If Book calculation, calculate Dividend Per Unit les Tax Deducted at Source based on
081730200529      ***  Dividend Per Unit.
081740200529      *
081750200529     C           WWDIVU    SUB  TASO      TADIVU
081760200529     C                     ENDIF
081770200529     C                     ELSE
081780200529      *
081790200529      ***  If feature Withholding Tax is OFF, Retrieve Dividend Per Unit.
081800200529      *
081810200529     C                     Z-ADDWWDIVU    TADIVU
081820200529     C                     ENDIF
081830200529      *
081840200529      ***  Calculate Actual Cash Pool:
081850200529      ***  - Customer Position: = Holding Taken as Stock multiplied by (Dividend Per Unit less Tax
081860200529      ***                         Deducted at Source and Tax Deducted by User) if feature
081870200529      ***                         Witholding Tax is ON,
081880200529      ***                       = Holding Taken as Stock multiplied by Dividend Per Unit if feature
081890200529      ***                         Witholding Tax is OFF.
081900200529      ***  - Book Position:     = Holding Taken as Stock multiplied by (Dividend Per Unit less Tax
081910200529      ***                         Deducted at Source) if feature Withholding Tax is ON,
081920200529      ***                       = Holding Taken as Stock multiplied by Dividend Per Unit if feature
081930200529      ***                         Witholding Tax is OFF.
081940200529      *
081950200529     C           WWHOST    MULT TADIVU    ACCAPO 309
081960200529      *
081970200529     C                     ENDSR
081980200529      *
081990200529      *****************************************************************
082000200529      /EJECT
082010200529      *****************************************************************
082020200529      *                                                               *
082030200529      * CHCABC - Calculate Holding Taken as Cash for Book/Customer.   *
082040200529      *                                                               *
082050200529      * Called by:                                                    *
082060200529      *                                                               *
082070200529      * Calls:                                                        *
082080200529      *                                                               *
082090200529      *****************************************************************
082100200529      *
082110200529     C           CHCABC    BEGSR                           ** CHCABC SR **
082120200529      *
082130200529     C           MAPTYP    IFEQ 'OF'                       If Processing Type = Offers
082140200529     C******     MIOFTY    ANDEQ'S'                           Subscription136935
082150200529     C******     MAPTYP    OREQ 'OF'                       Or Offres      136935
082160200529     C           MIOFTY    ANDEQ'P'                           Offer Type = Purchase Offer
082170200529      *****If*Current*Reply*exists.************************************** 136935
082180200529      ******                                                              136935
082190200529     C******     EXBCRE    IFEQ 'Y'                                       136935
082200200529      ******                                                              136935
082210200529      *****Calculate*Holding*Taken*as*Cash*=*Current*Holding*(=*Ex-Date** 136935
082220200529      *****Position)***%*accepted*calculated*previously*OR*Nominal******* 136935
082230200529      *****Accepted*(=*Nominal*Taken*as*Cash*Level*2*from*Current*Reply** 136935
082240200529      *****(SECOREL0)).************************************************** 136935
082250200529      ******                                                              136935
082260200529     C******     WCAPR     IFNE 0                                         136935
082270200529     C******     WWTDVD    MULT WCAPR     W1HOCA 309                      136935
082280200529     C******     W1HOCA    DIV  100       WWHOCA                          136935
082290200529     C******               ELSE                                           136935
082300200529     C******               Z-ADDESNBDP    WWNBDP                          136935
082310200529     C******               Z-ADDMQR2CN    WUNUM                           136935
082320200529     C******               EXSR RTVNDP                                    136935
082330200529     C******     WWTDVD    MULT WWNUM     WWHOCA                          136935
082340200529     C******               ENDIF                                          136935
082350200529     C******               ELSE                                           136935
082360200529     C******               Z-ADD0         WWHOCA                          136935
082370200529     C******               ENDIF                                          136935
082380200529      *                                                                   136935
082390200529      ***  Calculate Holding Taken as Cash = Original Stock Allocation    136935
082400200529      ***  multiplied by Nominal Accepted if Current Reply exists and not 136935
082410200529      ***  0 or by Cash %.                                                136935
082420200529      *                                                                   136935
082430200529     C           EXBCRE    IFEQ 'Y'                                       136935
082440200529     C           MQR2CN    ANDNE0                                         136935
082450200529     C                     Z-ADDESNBDP    WWNBDP                          136935
082460200529     C                     Z-ADDMQR2CN    WUNUM                           136935
082470200529     C                     EXSR RTVNDP                                    136935
082480200529     *********** WWOALR    MULT WWNUM     WWHOCA                   136935 219976
082490200529     C                     Z-ADDWWNUM     WWHOCA                          219976
082500200529     C                     ELSE                                           136935
082510200529     C           WWOALR    MULT WCAPR     W1HOCA 309                      136935
082520200529     C           W1HOCA    DIV  100       WWHOCA                          136935
082530200529     C                     ENDIF                                          136935
082540200529     C                     ELSE
082550200529     C           MAPTYP    IFEQ 'DV'                       If Processing Type = Dividends Events
082560200529     C           MDSDIT    ANDEQ'C'                           Stk Dividend Tp=Combined for Cash&Stk
082570200529      *
082580200529      ***  Set Holding Taken as Cash to Ex-Date Position from SEUDEPL0 or SECDEPL4
082590200529      ***  previously retrieved.
082600200529      *
082610200529     C                     Z-ADDWWTDVD    WWHOCA 309
082620200529     C                     ELSE
082630200529      *
082640200529      ***  Else, if Processing Type = Exercices and Conversions and       136935
082650200529      ***  Option for Allocation 2 = '7'.                                 136935
082660200529      *****Else,*if*Processing*Type*=*Corporate*Reorganisation or******** 136935
082670200529      *****Processing*Type*=*Name*Changes*or*Processing*Type*=*Exercices* 136935
082680200529      *****and*Conversions*and*Customer*Option*7*is*allowed.************* 136935
082690200529      *
082700200529     C******     MAPTYP    IFEQ 'CR'                       If Corp. Reorg.136935
082710200529     C******     MAPTYP    OREQ 'NC'                       Or Name Changes136935
082720200529     C******     MAPTYP    OREQ 'OF'                       Or Exchange    136935
082730200529     C******     MIOFTY    ANDEQ'E'                           Offer       136935
082740200529     C******     MAPTYP    OREQ 'EX'                       Or Exerc.&Conv.136935
082750200529     C******     MJOPT7    ANDEQ'Y'                           Cust.Opt 7  136935
082760200529     C           MAPTYP    IFEQ 'EX'                       Or Exerc.&Conv.136935
082770200529     C           WWOPT2    ANDEQ'7'                           Opt.Alloc=7 136935
082780200529      *
082790200529      ***  Set Holding Taken as Cash to 0.
082800200529      *
082810200529     C                     Z-ADD0         WWHOCA 309
082820200529     C                     ELSE
082830200529      *
082840200529      *****Else,*if*Processing*Type*=*Exercices*and*Conversions*and****** 136935
082850200529      *****Customer*Option*6*is*allowed.********************************* 136935
082860200529      ***  Else, if Processing Type = Exercices and Conversions and       136935
082870200529      ***  Option for Allocation 2 = '6'.                                 136935
082880200529      *
082890200529     C           MAPTYP    IFEQ 'EX'                       Or Exercices and Conversions
082900200529     C******     MJOPT6    ANDEQ'Y'                           Cust.Opt.6  136935
082910200529     C           WWOPT2    ANDEQ'6'                           Opt.Alloc=6 136935
082920200529      ********************************************************************161732
082930200529      *****If*Current*Reply*exists*and*Reply*Nominal*(=*Nominal*Taken*as*C161732
082940200529      *****calculate*Holding*Taken*as*Cash*=*Reply*Nominal*(=*Nominal*Take161732
082950200529      *
082960200529     C***********EXBCRE    IFEQ 'Y'                                       161732
082970200529     C***********MQR2CN    IFNE 0                                         161732
082980200529     C***********          Z-ADDESNBDP    WWNBDP                          161732
082990200529     C***********          Z-ADDMQR2CN    WUNUM                           161732
083000200529     C***********          EXSR RTVNDP                                    161732
083010200529     C***********          Z-ADDWWNUM     WWHOCA                          161732
083020200529     C***********          ELSE                                           161732
083030200529      ********************************************************************161732
083040200529      *****If*Current*Reply*exists*and*Cash*%*not*0,*calculate*Holding*Tak161732
083050200529      *****(=*Ex-Date*Position)*multiplied*by*Cash*%.*********************161732
083060200529      ****************************************************************c***161732
083070200529     C***********WWTDVD    MULT WCAPR     W1HOCA 309                      161732
083080200529     C***********W1HOCA    DIV  100       WWHOCA                          161732
083090200529     C***********          ENDIF                                          161732
083100200529     C***********          ELSE                                           161732
083110200529      *
083120200529      *****If*Current*Reply*does*not*exist,*set*Holding*Taken*as*Cash*to*0161732
083130200529      *
083140200529     C                     Z-ADD0         WWHOCA
083150200529     C***********          ENDIF                                          161732
083160200529     C                     ELSE
083170200529      *                                                                                       191178
083180200529      **  If processing type is 'DV' and stock dividend type not 'C'...                       191178
083190200529      *                                                                                       191178
083200200529     C           MAPTYP    IFEQ 'DV'                                                          191178
083210200529     C           MDSDIT    ANDNE'C'                                                           191178
083220200529     C           MQR2CN    ANDEQ0                                                             191178
083230200529     C           WCAPR     ANDNE0                                                             191178
083240200529      *                                                                                       191178
083250200529     C                     Z-ADD0         W2HOCA 309                                          191178
083260200529      *                                                                                       191178
083270200529     C           WWTDVD    MULT WCAPR     W2HOCA                                              191178
083280200529     C           W2HOCA    DIV  100       WWHOCA                                              191178
083290200529     C                     ELSE                                                               191178
083300200529      *
083310200529      ***  Calculate Holding Taken as Cash = Ex-Date Position from SECDEPL4 ot SEUDEPL0
083320200529      ***  previously retrieved - Holding Taken as Stock previously calculated.
083330200529      *
083340200529     C           WWTDVD    SUB  WWHOST    WWHOCA
083350200529     C                     ENDIF                                                              191178
083360200529     C           MAPTYP    IFEQ 'EX'                       Or Exercices an219579
083370200529     C           WWOPT2    ANDEQ'4'                           Opt.Alloc=6 219579
083380200529     C                     Z-ADDWWHOST    WWHOCA                          219579
083390200529     C                     ENDIF                                          219579
083400200529     C                     ENDIF
083410200529     C                     ENDIF
083420200529     C                     ENDIF
083430200529     C                     ENDIF
083440200529      *
083450200529      ***  Save Holding Taken as Cash.
083460200529      *
083470200529     C                     Z-ADDWWHOCA    WUHOCA
083480200529      *
083490200529      ***  Set Holding Taken as Cash calculated.
083500200529      *
083510200529     C                     Z-ADDNCNBDP    WWNBDP           New Currency Decimal Places
083520200529     C                     MOVE 'R'       WUROOP           Rounding = half adjust
083530200529     C                     Z-ADDWWHOCA    WWNUM
083540200529     C                     EXSR ROUNDD
083550200529     C                     Z-ADDWWNUM     WWHOCA
083560200529      *
083570200529     C                     ENDSR
083580200529      *
083590200529      *****************************************************************
083600200529      /EJECT
083610200529      *****************************************************************
083620200529      *                                                               *
083630200529      * PSEDPT - Process New Security for the Deopt.                  *
083640200529      *                                                               *
083650200529      * Called by:                                                    *
083660200529      *                                                               *
083670200529      * Calls:                                                        *
083680200529      *                                                               *
083690200529      *****************************************************************
083700200529      *
083710200529     C           PSEDPT    BEGSR                           ** PSEDPT SR **
083720200529      *
083730200529      ***  Prepare Price Basis for New Security.
083740200529      *
083750200529     C                     MOVE TSPB,I    NSSPBS
083760200529      *
083770200529      ***  Prepare Number of Decimal Places of New Security.
083780200529      *
083790200529     C                     MOVE TSDP,I    NSNBDP
083800200529      *
083810200529      ***  Prepare Number of Decimal Places of New Currency.
083820200529      *
083830200529     C                     MOVE TCDP,I    NCNBDP
083840200529      *
083850200529      ***  Prepare Number Of New Shares:
083860200529      ***  If Processing Type = 'CR': Corporate Reorganisation, retrieve position of array,
083870200529      ***  else retrieve from Corporate Actions Detail file.
083880200529      *
083890200529     C           MAPTYP    IFEQ 'CR'
083900200529     C                     MOVE TNSH,I    WWNSHA
083910200529     C                     ELSE
083920200529     C                     Z-ADDMDNSHA    WWNSHA
083930200529     C                     ENDIF
083940200529      *
083950200529      ***  Prepare Denomination Multiplier:
083960200529      ***  If Processing Type = 'CR': Corporate Reorganisation, retrieve position of array,
083970200529      ***  else retrieve from Corporate Actions Detail file.
083980200529      *
083990200529     C           MAPTYP    IFEQ 'CR'
084000200529     C*****                MOVE TDML,I    WUNUM                           179024
084010200529     C                     MOVE TDML,I    WDM16  160                      179024
084020200529     C                     ELSE
084030200529     C*****                Z-ADDMDDMLT    WUNUM                           179024
084040200529     C                     Z-ADDMDDMLT    WDM16                           179024
084050200529     C                     ENDIF
084060200529     C           5         SUB  NSNBDP    J       10                      179024
084070200529     C           WDM16     MULT POWER8,J  WWDMLT                          179024
084080200529     C*****                Z-ADDNSNBDP    WWNBDP                          179024
084090200529     C*****                EXSR RTVNDP                                    179024
084100200529     C*****                Z-ADDWWNUM     WWDMLT                          179024
084110200529      *
084120200529      ***  Prepare Rounding:
084130200529      ***  If Processing Type = 'CR': Corporate Reorganisation, retrieve position of array,
084140200529      ***  Else retrieve from Corporate Actions Detail file.
084150200529      *
084160200529     C           MAPTYP    IFEQ 'CR'
084170200529     C                     MOVE TNDN,I    WWRNDN
084180200529     C                     ELSE
084190200529     C                     MOVE MDRNDN    WWRNDN
084200200529     C                     ENDIF
084210200529      *
084220200529      ***  Prepare Rounding Settlement in Cash:
084230200529      ***  If Processing Type = 'CR': Corporate Reorganisation, retrieve position of array,
084240200529      ***  Else retrieve from Corporate Actions Detail file.
084250200529      *
084260200529     C           MAPTYP    IFEQ 'CR'
084270200529     C                     MOVE TNDS,I    WWRNDS
084280200529     C                     ELSE
084290200529     C                     MOVE MDRNDS    WWRNDS
084300200529     C                     ENDIF
084310200529      *
084320200529      ***  Prepare Compensation Price:
084330200529      ***  If Processing Type = 'CR': Corporate Reorganisation, retrieve position of array,
084340200529      ***  else retrieve from Corporate Actions Details File.
084350200529      *
084360200529     C           MAPTYP    IFEQ 'CR'
084370200529     C                     MOVE TOPA,I    WWCOMP 158
084380200529     C                     ELSE
084390200529      *                                                                   135685
084400200529      ***  If Processing Type = Currency Change                           135685
084410200529      ***  and Compensation Price is entered as Market,                   135685
084420200529      ***  the Compensation Price must first be calculated                135685
084430200529      ***  from Current Market Price.                                     135685
084440200529      *                                                                   135685
084450200529     C           MAPTYP    IFEQ 'CC'                                      135685
084460200529     C           NAMRKI    ANDEQ'Y'                                       135685
084470200529     C                     EXSR CCOMP                                     135685
084480200529     C                     ENDIF                                          135685
084490200529      *                                                                   135685
084500200529     C                     Z-ADDMDCOMP    WWCOMP
084510200529     C                     ENDIF
084520200529      *
084530200529      ***  Some fields must not be calculated for New Security.
084540200529      *
084550200529     C                     Z-ADD0         WUOALR                                              193662
084560200529     C                     Z-ADD0         WWCAOP           Original Cash Option
084570200529     C                     Z-ADD0         WWACAA           Actual Cash Allocation
084580200529     C                     Z-ADD0         WWBCAA 309       Balancing Cash Allocation
084590200529      *
084600200529      ***  Calculate Allocations: - Original Stock Allocation
084610200529      ***                         - True Stock Allocation
084620200529      ***                         - Original Stock Rounding
084630200529      ***                         - Original Cask Rounding.
084640200529      *
084650200529     C                     MOVE 'Y'       WINDPT  1                       156690
084660200529     C                     EXSR CALLOC
084670200529     C                     MOVE 'N'       WINDPT                          156690
084680200529      *
084690200529      ***  Calculate other Depot Allocations.
084700200529      *
084710200529     C                     EXSR CALDPT
084720200529      *
084730200529      ***  Calculate Balancing Difference for Actual Stock Allocation, Actual Stock Rounding, Actual
084740200529      ***  Actual Cash Rounding = difference between the total fields accumulated above and the
084750200529      ***  Depot fields.
084760200529      *
084770200529     C           WWASTA    SUB  WTASTA    WWBSTA 309       Balancing Stock Allocation
084780200529     C           WWASTR    SUB  WTASTR    WWBSTR 309       Balancing Stock Rounding
084790200529     C           WWACAR    SUB  WTACAR    WWBCAR 309       Balancing Cash Rounding
084800200529      *
084810200529      ***  Set Balancing Stock Allocation calculated.
084820200529      *
084830200529     C                     Z-ADDNSNBDP    WWNBDP           New Security Decimal Places
084840200529     C                     MOVE WWRNDN    WUROOP           Rounding from CO Detail file
084850200529     C                     Z-ADDWWBSTA    WWNUM
084860200529     C                     EXSR ROUNDD
084870200529      *                                                                   135686
084880200529      ***  If processing type =  Currency Change, load work array entry   135686
084890200529      ***  for Dummy Customer and reset work field for Allocation details 135686
084900200529      ***  file (Balancing Differences are input on Dummy Customer).      135686
084910200529      *                                                                   135686
084920200529     C           MAPTYP    IFEQ 'CC'                                      135686
084930200529     C           MAPTYP    ORNE 'CC'                                      137886
084940200529     C           BVALDC    ANDEQ'Y'                                       137886
084950200529     C                     Z-ADD0         WWBSTA
084960200529     C                     Z-ADDWWNUM     TBSA,I
084970200529      *                                                                   135686
084980200529      ***  Else, if processing type not Currency Change, load work field  135686
084990200529      ***  for Depot Allocation file and reset work array entry for       135686
085000200529      ***  Dummy Customer.                                                135686
085010200529      *                                                                   135686
085020200529     C                     ELSE                                           135686
085030200529     C                     Z-ADDWWNUM     WWBSTA                          135686
085040200529     C                     Z-ADD0         TBSA,I                          135686
085050200529     C                     ENDIF                                          135686
085060200529      *
085070200529      ***  Set Balancing Stock Rounding calculated.
085080200529      *
085090200529     C                     Z-ADD8         WWNBDP           8 Decimal Places
085100200529     C                     Z-ADDWWBSTR    WWNUM
085110200529     C                     EXSR ROUNDD
085120200529      *                                                                   135686
085130200529      ***  If processing type =  Currency Change, load work array entry   135686
085140200529      ***  for Dummy Customer and reset work field for Allocation details 135686
085150200529      ***  file (Balancing Differences are input on Dummy Customer).      135686
085160200529      *                                                                   135686
085170200529     C           MAPTYP    IFEQ 'CC'                                      135686
085180200529     C           MAPTYP    ORNE 'CC'                                      137886
085190200529     C           BVALDC    ANDEQ'Y'                                       137886
085200200529     C                     Z-ADD0         WWBSTR
085210200529     C                     Z-ADDWWNUM     TBSR,I
085220200529      *                                                                   135686
085230200529      ***  Else, if processing type not Currency Change, load work field  135686
085240200529      ***  for Depot Allocation file and reset work array entry for       135686
085250200529      ***  Dummy Customer.                                                135686
085260200529      *                                                                   135686
085270200529     C                     ELSE                                           135686
085280200529     C                     Z-ADDWWNUM     WWBSTR                          135686
085290200529     C                     Z-ADD0         TBSR,I                          135686
085300200529     C                     ENDIF                                          135686
085310200529      *
085320200529      ***  Set Balancing Cash Rounding calculated.
085330200529      *
085340200529     C                     Z-ADDNCNBDP    WWNBDP           New Currency Decimal Places
085350200529     C                     MOVE 'R'       WUROOP           Rounding = half adjust
085360200529     C                     Z-ADDWWBCAR    WWNUM
085370200529     C                     EXSR ROUNDD
085380200529      *                                                                   135686
085390200529      ***  If processing type =  Currency Change, load work array entry   135686
085400200529      ***  for Dummy Customer and reset work field for Allocation details 135686
085410200529      ***  file (Balancing Differences are input on Dummy Customer).      135686
085420200529      *                                                                   135686
085430200529     C           MAPTYP    IFEQ 'CC'                                      135686
085440200529     C           MAPTYP    ORNE 'CC'                                      137886
085450200529     C           BVALDC    ANDEQ'Y'                                       137886
085460200529     C                     Z-ADD0         WWBCAR
085470200529     C                     Z-ADDWWNUM     TBCR,I
085480200529      *                                                                   135686
085490200529      ***  Else, if processing type not Currency Change, load work field  135686
085500200529      ***  for Depot Allocation file and reset work array entry for       135686
085510200529      ***  Dummy Customer.                                                135686
085520200529      *                                                                   135686
085530200529     C                     ELSE                                           135686
085540200529     C                     Z-ADDWWNUM     WWBCAR                          135686
085550200529     C                     Z-ADD0         TBCR,I                          135686
085560200529     C                     ENDIF                                          135686
085570200529      *
085580200529      ***  Write a record on SECODPL0: Corporate Actions Depots file.
085590200529      *
085600200529     C                     EXSR WRCODP
085610200529      *
085620200529      ***  Reset work fields.
085630200529      *
085640200529     C                     Z-ADD0         WTHOST           Total Holding Taken as Stock
085650200529     C                     Z-ADD0         WTHOCA           Total Holding Taken as Cash
085660200529     C                     Z-ADD0         WTASTA           Total Actual Stock Allocation
085670200529     C                     Z-ADD0         WTASTR           Total Actual Stock Rounding
085680200529     C                     Z-ADD0         WTACAR           1st total Actual Cash Rounding
085690200529      *
085700200529     C                     ENDSR
085710200529      *
085720200529      *****************************************************************
085730200529      /EJECT
085740200529      *****************************************************************
085750200529      *                                                               *
085760200529      * CTFEES - Calculate Total Fees for Customer.                   *
085770200529      *                                                               *
085780200529      * Called by:                                                    *
085790200529      *                                                               *
085800200529      * Calls:                                                        *
085810200529      *                                                               *
085820200529      *****************************************************************
085830200529      *
085840200529     C           CTFEES    BEGSR                           ** CTFEES SR **
085850200529      *
085860200529      ***  Call Access Program for Security Customer Details to retrieve Customer Group.
085870200529      *
085880200529     C                     MOVE WWCDCN    @SCKY
085890200529     C                     CALL 'AOSECSR0'
085900200529     C                     PARM           @RTCD
085910200529     C                     PARM '*KEY   ' @OPTN
085920200529     C                     PARM           @SCKY   6
085930200529     C           SDSECS    PARM SDSECS    DSSDY
085940200529      *
085950200529      ***  Handle Database Error.
085960200529      *
085970200529     C           @RTCD     IFNE *BLANKS
085980200529     C                     Z-ADD018       DBASE            ***************
085990200529     C                     MOVEL'SDSECSPD'DBFILE           * DB ERROR 18 *
086000200529     C                     MOVEL@SCKY     DBKEY            ***************
086010200529     C                     EXSR *PSSR
086020200529     C                     ENDIF
086030200529      *
086040200529     C           S01496    IFEQ 'Y'
086050200529     C           BVACOP    ANDEQ'Y'
086060200529      *
086070200529      ***  Retrieve the Commission and the Charge Code on the Corporate Actions Default Charges
086080200529      ***  file with Customer Group, Customer, Investment Type and Corporate Action Type.
086090200529      *
086100200529     C                     MOVE BFPSCG    KCUGR            Customer Group
086110200529     C**********           Z-ADDWWCDCN    KCDCN            Customer                           CSD027
086120200529     C                     MOVE WWCDCN    KCDCN            Customer                           CSD027
086130200529     C                     MOVE ESSITP    KSITP            Investment Type
086140200529     C                     MOVE MACOAT    KCOAT            COrporate Action Type
086150200529     C           @KEY13    CHAINSECOCHL0             84
086160200529      *
086170200529      ***  If record not found, access with Customer Group, Customer and Investment Type and
086180200529      ***  Corporate Action Type = blank.
086190200529      *
086200200529     C           *IN84     IFEQ '1'
086210200529     C                     MOVE *BLANKS   KCOAT            COrporate Action Type
086220200529     C           @KEY13    CHAINSECOCHL0             84
086230200529      *
086240200529      ***  If record not found, access with Customer Group and Customer and Investment Type and
086250200529      ***  Corporate Action Type = blank.
086260200529      *
086270200529     C           *IN84     IFEQ '1'
086280200529     C                     MOVE *BLANKS   KSITP            Investment Type
086290200529     C           @KEY13    CHAINSECOCHL0             84
086300200529      *
086310200529      ***  If record not found, access with Customer Group and Customer = 0 and Investment Type and
086320200529      ***  Corporate Action Type = blank.
086330200529      *
086340200529     C           *IN84     IFEQ '1'
086350200529     C**********           Z-ADD0         KCDCN            Customer                           CSD027
086360200529     C                     MOVE *BLANKS   KCDCN            Customer                           CSD027
086370200529     C           @KEY13    CHAINSECOCHL0             84
086380200529     C                     ENDIF
086390200529     C                     ENDIF
086400200529     C                     ENDIF
086410200529      *
086420200529     C                     ELSE
086430200529      *
086440200529      ***  Retrieve the Commission and the Charge Code on the Corporate Actions Default Charges
086450200529      ***  file with Classification, Customer, Investment Type and Corporate Action Type.
086460200529      *
086470200529     C                     MOVE BFCLAS    KCLAS            Retrieve Classification
086480200529     C**********           Z-ADDWWCDCN    KCDCN            Customer                           CSD027
086490200529     C                     MOVE WWCDCN    KCDCN            Customer                           CSD027
086500200529     C                     MOVE ESSITP    KSITP            Investment Type
086510200529     C                     MOVE MACOAT    KCOAT            COrporate Action Type
086520200529     C           @KEY14    CHAINSECOCHL1             84
086530200529      *
086540200529      ***  If record not found, access with Classification, Customer and Investment Type and
086550200529      ***  Corporate Action Type = blank.
086560200529      *
086570200529     C           *IN84     IFEQ '1'
086580200529     C                     MOVE *BLANKS   KCOAT            COrporate Action Type
086590200529     C           @KEY14    CHAINSECOCHL1             84
086600200529      *
086610200529      ***  If record not found, access with Classification and Customer and Investment type and
086620200529      ***  Corporate Action Type = blank.
086630200529      *
086640200529     C           *IN84     IFEQ '1'
086650200529     C                     MOVE *BLANKS   KSITP            Investment Type
086660200529     C           @KEY14    CHAINSECOCHL1             84
086670200529      *
086680200529      ***  If record not found, access with Classification and Customer = 0 and Investment Type and
086690200529      ***  Corporate Action Type = blank.
086700200529      *
086710200529     C           *IN84     IFEQ '1'
086720200529     C**********           Z-ADD0         KCDCN            Customer                           CSD027
086730200529     C                     MOVE *BLANKS   KCDCN            Customer                           CSD027
086740200529     C           @KEY14    CHAINSECOCHL1             84
086750200529     C                     ENDIF
086760200529     C                     ENDIF
086770200529     C                     ENDIF
086780200529     C                     ENDIF
086790200529      *
086800200529      ***  If record not found with one access, set Total Fees to 0.
086810200529      *
086820200529     C           *IN84     IFEQ '1'
086830200529     C***********          Z-ADD0         WWTOTF           Total Fees     179205
086840200529     C                     Z-ADD0         CHRAMT                          179205
086850200529      *
086860200529      ***  If record found with one access.
086870200529      *
086880200529     C                     ELSE
086890200529      *
086900200529      ***  Retrieve Charge Basis Indicator on Charge Types file with Charge Code retrieve above
086910200529      ***  and Event Nominal Currency.
086920200529      *
086930200529     C                     MOVE MRCOCH    KCCOM   2
086940200529     C           @KEY17    CHAINSECGT                84
086950200529      *
086960200529      ***  If no live record found, set Total Fees to 0.
086970200529      *
086980200529     C           *IN84     IFEQ '1'
086990200529     C                     Z-ADD0         WWTOTF
087000200529      *
087010200529      ***  If live record found, Calculate Charge Amount.
087020200529      *
087030200529     C                     ELSE
087040200529     C                     Z-ADD0         ZTCON
087050200529     C                     Z-ADD0         ZNOML
087060200529      *
087070200529      ***  If Processing Type = 'NF', set field ZNOML to Ex-Date Position for Corporate Action
087080200529      *
087090200529     C           MAPTYP    IFEQ 'NF'
087100200529     C                     Z-ADDWWTDVD    ZNOML
087110200529      *
087120200529      ***  Else, if Processing Type not = 'NF'.
087130200529      *
087140200529     C                     ELSE
087150200529      *
087160200529      ***  If Charge Basis Indicator = 'C', set field ZTCON to (Actual Cash Allocation + Actual
087170200529      ***  Cash Rounding).
087180200529      *
087190200529     C           CHGB      IFEQ 'C'
087200200529     C           WWACAA    ADD  WWACAR    ZTCON
087210200529      *
087220200529      ***  Else, if Processing Type not = 'NF' and Charge Basis Indicator not = 'C'.
087230200529      *
087240200529     C                     ELSE
087250200529      *
087260200529      ***  If Charge Basis Indicator = 'N', set field ZNOML to Ex-Date.
087270200529      *
087280200529     C           CHGB      IFEQ 'N'
087290200529     C                     Z-ADDWWTDVD    ZNOML
087300200529     C                     ENDIF
087310200529     C                     ENDIF
087320200529     C                     ENDIF
087330200529      *
087340200529      ***  Calculate Charge Amount.
087350200529      *
087360200529     C                     EXSR CALAM2
087370200529     C                     Z-ADDZCHGA     CHRAMT 309
087380200529     C                     ENDIF                                          179205
087390200529      *
087400200529     C                     Z-ADD0         ZTCON
087410200529     C                     Z-ADD0         ZNOML
087420200529      *
087430200529      ***  Retrieve Charge Basis Indicator on Charge Types file with Commission Code retrieve
087440200529      ***  above and Event Nominal Currency.
087450200529      *
087460200529     C                     MOVE MRCOCO    KCCOM
087470200529     C           @KEY17    CHAINSECGT                84
087480200529      *
087490200529      ***  If no live record found, set Total Fees to 0.
087500200529      *
087510200529     C           *IN84     IFEQ '1'
087520200529     C***********          Z-ADD0         WWTOTF                          179205
087530200529     C                     Z-ADD0         COMAMT                          179205
087540200529      *
087550200529      ***  If live record found, Calculate Commission Amount.
087560200529      *
087570200529     C                     ELSE
087580200529      *
087590200529      ***  If Processing Type = 'NF', set field ZNOML to Ex-Date Position for Corporate Action
087600200529      *
087610200529     C           MAPTYP    IFEQ 'NF'
087620200529     C                     Z-ADDWWTDVD    ZNOML
087630200529      *
087640200529      ***  Else, if Processing Type not = 'NF'.
087650200529      *
087660200529     C                     ELSE
087670200529      *
087680200529      ***  If Charge Basis Indicator = 'C', set field ZTCON to (Actual Cash Allocation + Actual
087690200529      ***  Cash Rounding).
087700200529      *
087710200529     C           CHGB      IFEQ 'C'
087720200529     C           WWACAA    ADD  WWACAR    ZTCON
087730200529      *
087740200529      ***  Else, if Processing Type not = 'NF' and Charge Basis Indicator not = 'C'.
087750200529      *
087760200529     C                     ELSE
087770200529      *
087780200529      ***  If Charge Basis Indicator = 'N', set field ZNOML to Ex-Date.
087790200529      *
087800200529     C           CHGB      IFEQ 'N'
087810200529     C                     Z-ADDWWTDVD    ZNOML
087820200529     C                     ENDIF
087830200529     C                     ENDIF
087840200529     C                     ENDIF
087850200529      *
087860200529      ***  Calculate Commission Amount.
087870200529      *
087880200529     C                     EXSR CALAM2
087890200529     C                     Z-ADDZCHGA     COMAMT 309
087900200529     C                     ENDIF                                          179205
087910200529      *
087920200529      ***  Calculate Total Fees = Charge Amount + Commission Amount calculated above.
087930200529      *
087940200529     C           CHRAMT    ADD  COMAMT    WWTOTF
087950200529      *
087960200529      ***  Set Total Fees calculated.
087970200529      *
087980200529     C           MAPTYP    IFEQ 'CR'
087990200529     C                     Z-ADDECNBDP    WWNBDP           Event Currency Decimal Places
088000200529     C                     ELSE
088010200529     C                     Z-ADDTCDP,1    WWNBDP           New Currency Decimal Places
088020200529     C                     ENDIF
088030200529     C                     MOVE 'R'       WUROOP           Rounding = alf adjust
088040200529     C                     Z-ADDWWTOTF    WWNUM
088050200529     C                     EXSR ROUNDD
088060200529     C                     Z-ADDWWNUM     WWTOTF
088070200529     C                     ENDIF
088080200529     C***********          ENDIF                                          179205
088090200529     C***********          ENDIF                                          179205
088100200529      *
088110200529     C                     ENDSR
088120200529      *
088130200529      *****************************************************************
088140200529      /EJECT
088150200529      *****************************************************************
088160200529      *                                                               *
088170200529      * CALAM2 - Calculate Charge Amounts.                            *
088180200529      *                                                               *
088190200529      * Called by:                                                    *
088200200529      *                                                               *
088210200529      * Calls:                                                        *
088220200529      *                                                               *
088230200529      *****************************************************************
088240200529      *
088250200529     C           CALAM2    BEGSR                           ** CALAM2 SR **
088260200529      *
088270200529      ***  Charge Details.
088280200529      *
088290200529     C                     MOVE CHGB      ZCHGB
088300200529     C                     MOVE THRI      ZTHRI
088310200529     C                     Z-ADDMNCH      ZMNCH
088320200529     C                     Z-ADDMXCH      ZMXCH
088330200529      *
088340200529      ***  Set up array for Upper Range Limits.
088350200529      *
088360200529     C                     Z-ADDSTU1      ZRA,1
088370200529     C                     Z-ADDSTU2      ZRA,2
088380200529     C                     Z-ADDSTU3      ZRA,3
088390200529     C                     Z-ADDSTU4      ZRA,4
088400200529     C                     Z-ADDSTU5      ZRA,5
088410200529     C                     Z-ADDSTU6      ZRA,6
088420200529     C                     Z-ADDSTU7      ZRA,7
088430200529     C                     Z-ADDSTU8      ZRA,8
088440200529     C                     Z-ADDSTU9      ZRA,9
088450200529     C                     Z-ADDST10      ZRA,10
088460200529     C                     Z-ADDST11      ZRA,11
088470200529     C                     Z-ADDST12      ZRA,12
088480200529     C                     Z-ADDST13      ZRA,13
088490200529     C                     Z-ADDST14      ZRA,14
088500200529      *
088510200529      ***  Set up array for Percentage Levels.
088520200529      *
088530200529     C                     Z-ADDPL01      ZPC,1
088540200529     C                     Z-ADDPL02      ZPC,2
088550200529     C                     Z-ADDPL03      ZPC,3
088560200529     C                     Z-ADDPL04      ZPC,4
088570200529     C                     Z-ADDPL05      ZPC,5
088580200529     C                     Z-ADDPL06      ZPC,6
088590200529     C                     Z-ADDPL07      ZPC,7
088600200529     C                     Z-ADDPL08      ZPC,8
088610200529     C                     Z-ADDPL09      ZPC,9
088620200529     C                     Z-ADDPL10      ZPC,10
088630200529     C                     Z-ADDPL11      ZPC,11
088640200529     C                     Z-ADDPL12      ZPC,12
088650200529     C                     Z-ADDPL13      ZPC,13
088660200529     C                     Z-ADDPL14      ZPC,14
088670200529     C                     Z-ADDPL15      ZPC,15
088680200529      *
088690200529      ***  Set up array for Flat Charges.
088700200529      *
088710200529     C                     Z-ADDFC01      ZCG,1
088720200529     C                     Z-ADDFC02      ZCG,2
088730200529     C                     Z-ADDFC03      ZCG,3
088740200529     C                     Z-ADDFC04      ZCG,4
088750200529     C                     Z-ADDFC05      ZCG,5
088760200529     C                     Z-ADDFC06      ZCG,6
088770200529     C                     Z-ADDFC07      ZCG,7
088780200529     C                     Z-ADDFC08      ZCG,8
088790200529     C                     Z-ADDFC09      ZCG,9
088800200529     C                     Z-ADDFC10      ZCG,10
088810200529     C                     Z-ADDFC11      ZCG,11
088820200529     C                     Z-ADDFC12      ZCG,12
088830200529     C                     Z-ADDFC13      ZCG,13
088840200529     C                     Z-ADDFC14      ZCG,14
088850200529     C                     Z-ADDFC15      ZCG,15
088860200529      *
088870200529     C                     Z-ADDESNBDP    ZDECS
088880200529      *
088890200529      ***  Nominal Decimal Places.
088900200529      *
088910200529     C                     Z-ADD0         ZNMDP
088920200529      *
088930200529      ***  Security Details.
088940200529      *
088950200529     C                     Z-ADD1         ZPRICE
088960200529     C                     Z-ADD0         ZTCFC
088970200529     C                     MOVE 'P'       ZPROT
088980200529     C                     MOVE *BLANKS   ZSPBS
088990200529      *
089000200529     C           S01446    IFEQ 'Y'
089010200529      *
089020200529      ***  Purchase Interest.
089030200529      *
089040200529     C                     Z-ADD0         ZTPI
089050200529      *
089060200529     C                     MOVE *BLANKS   ZCCYI
089070200529     C                     MOVE *BLANKS   ZCCYO
089080200529     C                     MOVE *BLANKS   ZEXCH
089090200529     C                     MOVE *BLANKS   ZMD
089100200529      *
089110200529     C                     ENDIF
089120200529      *
089130200529      ***  Total Nominal.
089140200529      *
089150200529     C                     Z-ADD*ZEROS    ZTNOM  150
089160200529      *
089170200529     C                     EXSR ZCCAL1
089180200529      *
089190200529     C                     ENDSR
089200200529      *
089210200529      *****************************************************************
089220200529      /EJECT
089230200529      *****************************************************************
089240200529      *                                                               *
089250200529      * DADCOR - Delete Corporate Actions Allocation and Depot for    *
089260200529      *          CO Reference and Depot.                              *
089270200529      *                                                               *
089280200529      * Called by:                                                    *
089290200529      *                                                               *
089300200529      * Calls:                                                        *
089310200529      *                                                               *
089320200529      *****************************************************************
089330200529      *
089340200529     C           DADCOR    BEGSR                           ** DADCOR SR **
089350200529      *
089360200529      ***  Access Corporate Actions Allocations file with CO Reference received as parameter.
089370200529      *
089380200529     C           PCORF     SETLLSECOALL0
089390200529     C           PCORF     READESECOALL0                 80
089400200529      *
089410200529     C           *IN80     DOWEQ'0'
089420200529      *
089430200529      ***  If Depot = Depot (num field) received as parameter and Branch = Branch received as
089440200529      ***  parameter.
089450200529      *
089460200529     C           MCDDPT    IFEQ WWDDPT
089470200529     C           MCBRCD    ANDEQPBRCD
089480200529      *
089490200529      ***  If record live, delete logically.
089500200529      *
089510200529     C           MCRECI    IFNE '*'
089520200529     C                     MOVE '*'       MCRECI
089530200529     C                     UPDATSECOALD0               89
089540200529      *
089550200529      ***  If error detected when update, handle Database Error.
089560200529      *
089570200529     C           *IN89     IFEQ '1'
089580200529     C                     Z-ADD019       DBASE            ***************
089590200529     C                     MOVEL'SECOALL0'DBFILE           * DB ERROR 19 *
089600200529     C                     MOVEL'UPDATE'  DBKEY            ***************
089610200529     C                     EXSR *PSSR
089620200529     C                     ENDIF
089630200529     C                     COMIT
089640200529      *
089650200529      ***  If record already logically deleted (MCRECI = '*'), delete physically.
089660200529      *
089670200529     C                     ELSE
089680200529     C                     DELETSECOALD0               89
089690200529      *
089700200529      ***  If error detected when delete, handle Database Error.
089710200529      *
089720200529     C           *IN89     IFEQ '1'
089730200529     C                     Z-ADD020       DBASE            ***************
089740200529     C                     MOVEL'SECOALL0'DBFILE           * DB ERROR 20 *
089750200529     C                     MOVEL'DELETE'  DBKEY            ***************
089760200529     C                     EXSR *PSSR
089770200529     C                     ENDIF
089780200529     C                     COMIT
089790200529     C                     ENDIF
089800200529     C                     ENDIF
089810200529     C           PCORF     READESECOALL0                 80
089820200529     C                     ENDDO
089830200529      *
089840200529      ***  Access Corporate Actions Depot file with CO Reference received as parameter.
089850200529      *
089860200529     C           PCORF     SETLLSECODPL0
089870200529     C           PCORF     READESECODPL0                 80
089880200529      *
089890200529     C           *IN80     DOWEQ'0'
089900200529      *
089910200529      ***  If Depot = Depot (num field) received as parameter, and Branch = Branch received as
089920200529      ***  parameter.
089930200529      *
089940200529     C           MBDDPT    IFEQ WWDDPT
089950200529     C           MBBRCD    ANDEQPBRCD
089960200529      *
089970200529      ***  If record live, delete logically.
089980200529      *
089990200529     C           MBRECI    IFNE '*'
090000200529     C                     MOVE '*'       MBRECI
090010200529     C                     UPDATSECODPD0               89
090020200529      *
090030200529      ***  If error detected when update, handle Database Error.
090040200529      *
090050200529     C           *IN89     IFEQ '1'
090060200529     C                     Z-ADD021       DBASE            ***************
090070200529     C                     MOVEL'SECODPL0'DBFILE           * DB ERROR 21 *
090080200529     C                     MOVEL'UPDATE'  DBKEY            ***************
090090200529     C                     EXSR *PSSR
090100200529     C                     ENDIF
090110200529     C                     COMIT
090120200529      *
090130200529      ***  If record already logically deleted (MBRECI = '*'), delete physically.
090140200529      *
090150200529     C                     ELSE
090160200529     C                     DELETSECODPD0               89
090170200529      *
090180200529      ***  If error detected when delete, handle Database Error.
090190200529      *
090200200529     C           *IN89     IFEQ '1'
090210200529     C                     Z-ADD022       DBASE            ***************
090220200529     C                     MOVEL'SECODPL0'DBFILE           * DB ERROR 22 *
090230200529     C                     MOVEL'DELETE'  DBKEY            ***************
090240200529     C                     EXSR *PSSR
090250200529     C                     ENDIF
090260200529     C                     COMIT
090270200529     C                     ENDIF
090280200529     C                     ENDIF
090290200529     C           PCORF     READESECODPL0                 80
090300200529     C                     ENDDO
090310200529      *
090320200529     C                     ENDSR
090330200529      *
090340200529      *****************************************************************
090350200529      /EJECT
090360200529      *****************************************************************
090370200529      *                                                               *
090380200529      * DADNSE - Delete Corporate Actions Allocation and Depot for    *
090390200529      *          CO Reference, Option, Branch, Depot, New Security,   *
090400200529      *          Book, Customer and Portfolio.                        *
090410200529      *                                                               *
090420200529      * Called by:                                                    *
090430200529      *                                                               *
090440200529      * Calls:                                                        *
090450200529      *                                                               *
090460200529      *****************************************************************
090470200529      *
090480200529     C           DADNSE    BEGSR                           ** DADNSE SR **
090490200529      *
090500200529      ***  Access Corporate Actions Allocations file with CO Reference, Option Number (num field),
090510200529      ***  Branch, Depot (num field), New Security, Book, Customer (num field) and Portfolio
090520200529      ***  Reference received as parameters and Customer/Book Indicator.
090530200529      *
090540200529     C                     MOVE PNSEC     KSESN
090550200529     C           @KEY18    SETLLSECOALL0
090560200529     C           @KEY18    READESECOALL0                 80
090570200529      *
090580200529     C           *IN80     DOWEQ'0'
090590200529      *
090600200529      ***  If record live, delete logically.
090610200529      *
090620200529     C           MCRECI    IFNE '*'
090630200529     C                     MOVE '*'       MCRECI
090640200529     C                     UPDATSECOALD0               89
090650200529      *
090660200529      ***  If error detected when update, handle Database Error.
090670200529      *
090680200529     C           *IN89     IFEQ '1'
090690200529     C                     Z-ADD023       DBASE            ***************
090700200529     C                     MOVEL'SECOALL0'DBFILE           * DB ERROR 23 *
090710200529     C                     MOVEL'UPDATE'  DBKEY            ***************
090720200529     C                     EXSR *PSSR
090730200529     C                     ENDIF
090740200529     C                     COMIT
090750200529      *
090760200529      ***  If record already logically deleted (MCRECI = '*'), delete physically.
090770200529      *
090780200529     C                     ELSE
090790200529     C                     DELETSECOALD0               89
090800200529      *
090810200529      ***  If error detected when delete, handle Database Error.
090820200529      *
090830200529     C           *IN89     IFEQ '1'
090840200529     C                     Z-ADD024       DBASE            ***************
090850200529     C                     MOVEL'SECOALL0'DBFILE           * DB ERROR 24 *
090860200529     C                     MOVEL'DELETE'  DBKEY            ***************
090870200529     C                     EXSR *PSSR
090880200529     C                     ENDIF
090890200529     C                     COMIT
090900200529     C                     ENDIF
090910200529     C           @KEY18    READESECOALL0                 80
090920200529     C                     ENDDO
090930200529      *
090940200529      ***  Access Corporate Actions Allocations file with CO Reference, Option Number (num field),
090950200529      ***  Branch, Depot (num field), Book, Customer (num field) and Portfolio Reference received
090960200529      ***  as parameters, Customer/Book Indicator and New Security = '**CASH**'.
090970200529      *
090980200529     C                     MOVE *BLANKS   KSESN
090990200529     C                     MOVEL'**CASH**'KSESN
091000200529     C******     @KEY18    CHAINSECOALL0             80                   135686
091010200529     C           @KEY18    SETLLSECOALL0                                  135686
091020200529     C           @KEY18    READESECOALL0                 80               135686
091030200529      *
091040200529     C******     *IN80     IFEQ '0'                                       135686
091050200529     C           *IN80     DOWEQ'0'                                       135686
091060200529      *
091070200529      ***  If record live, delete logically.
091080200529      *
091090200529     C           MCRECI    IFNE '*'
091100200529     C                     MOVE '*'       MCRECI
091110200529     C                     UPDATSECOALD0               89
091120200529      *
091130200529      ***  If error detected when update, handle Database Error.
091140200529      *
091150200529     C           *IN89     IFEQ '1'
091160200529     C                     Z-ADD025       DBASE            ***************
091170200529     C                     MOVEL'SECOALL0'DBFILE           * DB ERROR 25 *
091180200529     C                     MOVEL'UPDATE'  DBKEY            ***************
091190200529     C                     EXSR *PSSR
091200200529     C                     ENDIF
091210200529     C                     COMIT
091220200529      *
091230200529      ***  If record already logically deleted (MCRECI = '*'), delete physically.
091240200529      *
091250200529     C                     ELSE
091260200529     C                     DELETSECOALD0               89
091270200529      *
091280200529      ***  If error detected when delete, handle Database Error.
091290200529      *
091300200529     C           *IN89     IFEQ '1'
091310200529     C                     Z-ADD026       DBASE            ***************
091320200529     C                     MOVEL'SECOALL0'DBFILE           * DB ERROR 26 *
091330200529     C                     MOVEL'DELETE'  DBKEY            ***************
091340200529     C                     EXSR *PSSR
091350200529     C                     ENDIF
091360200529     C                     COMIT
091370200529     C                     ENDIF
091380200529     C******               ENDIF                                          135686
091390200529     C           @KEY18    READESECOALL0                 80               135686
091400200529     C                     ENDDO                                          135686
091410200529      *
091420200529      ***  Access Corporate Actions Depot file with CO Reference, Option Number (num field),
091430200529      ***  Branch and Depot (num field) received as parameter.
091440200529      *
091450200529     C           @KEY20    SETLLSECODPL0
091460200529     C           @KEY20    READESECODPL0                 80
091470200529      *
091480200529     C           *IN80     DOWEQ'0'
091490200529      *
091500200529      ***  If record live, delete logically.
091510200529      *
091520200529     C           MBRECI    IFNE '*'
091530200529     C                     MOVE '*'       MBRECI
091540200529     C                     UPDATSECODPD0               89
091550200529      *
091560200529      ***  If error detected when update, handle Database Error.
091570200529      *
091580200529     C           *IN89     IFEQ '1'
091590200529     C                     Z-ADD027       DBASE            ***************
091600200529     C                     MOVEL'SECODPL0'DBFILE           * DB ERROR 27 *
091610200529     C                     MOVEL'UPDATE'  DBKEY            ***************
091620200529     C                     EXSR *PSSR
091630200529     C                     ENDIF
091640200529     C                     COMIT
091650200529      *
091660200529      ***  If record already logically deleted (MBRECI = '*'), delete physically.
091670200529      *
091680200529     C                     ELSE
091690200529     C                     DELETSECODPD0               89
091700200529      *
091710200529      ***  If error detected when delete, handle Database Error.
091720200529      *
091730200529     C           *IN89     IFEQ '1'
091740200529     C                     Z-ADD028       DBASE            ***************
091750200529     C                     MOVEL'SECODPL0'DBFILE           * DB ERROR 28 *
091760200529     C                     MOVEL'DELETE'  DBKEY            ***************
091770200529     C                     EXSR *PSSR
091780200529     C                     ENDIF
091790200529     C                     COMIT
091800200529     C                     ENDIF
091810200529     C           @KEY20    READESECODPL0                 80
091820200529     C                     ENDDO
091830200529      *
091840200529     C                     ENDSR
091850200529      *
091860200529      *****************************************************************
091870200529      /EJECT
091880200529      *****************************************************************
091890200529      *                                                               *
091900200529      * PDCORF - Process Detail for CO Reference depending on the     *
091910200529      *          Processing Type.                                     *
091920200529      *                                                               *
091930200529      * Called by:                                                    *
091940200529      *                                                               *
091950200529      * Calls:                                                        *
091960200529      *                                                               *
091970200529      *****************************************************************
091980200529      *
091990200529     C           PDCORF    BEGSR                           ** PDCORF SR **
092000200529      *
092010200529      ***  Access Corporate Actions Details file depending on the Processing Type, with CO
092020200529      ***  Reference received as parameter.
092030200529      *
092040200529     C           MAPTYP    IFEQ 'DV'                       Dividends Events.
092050200529     C           PCORF     SETLLSECODVL1
092060200529     C           PCORF     READESECODVL1                 80
092070200529     C                     ELSE
092080200529     C           MAPTYP    IFEQ 'FR'                       Free Allocations.
092090200529     C           PCORF     SETLLSECOFRL1
092100200529     C           PCORF     READESECOFRL1                 80
092110200529     C                     ELSE
092120200529     C           MAPTYP    IFEQ 'RG'                       Rights Issues.
092130200529     C           PCORF     SETLLSECORGL1
092140200529     C           PCORF     READESECORGL1                 80
092150200529     C                     ELSE
092160200529     C           MAPTYP    IFEQ 'CE'                       Capital Change.
092170200529     C           PCORF     SETLLSECOCEL1
092180200529     C           PCORF     READESECOCEL1                 80
092190200529     C                     ELSE
092200200529     C           MAPTYP    IFEQ 'CR'                       Corporate Reorganisation.
092210200529     C           PCORF     SETLLSECOCRL1
092220200529     C           PCORF     READESECOCRL1                 80
092230200529     C                     ELSE
092240200529     C           MAPTYP    IFEQ 'OF'                       Offers.
092250200529     C           PCORF     SETLLSECOOFL1
092260200529     C           PCORF     READESECOOFL1                 80
092270200529     C                     ELSE
092280200529     C           MAPTYP    IFEQ 'EX'                       Exercises and Conversions.
092290200529     C           PCORF     SETLLSECOEXL1
092300200529     C           PCORF     READESECOEXL1                 80
092310200529     C                     ELSE
092320200529     C           MAPTYP    IFEQ 'NC'                       Name Changes.
092330200529     C           PCORF     SETLLSECONCL1
092340200529     C           PCORF     READESECONCL1                 80
092350200529     C                     ELSE
092360200529     C           MAPTYP    IFEQ 'NF'                       Non Financial.
092370200529     C           PCORF     SETLLSECONFL1
092380200529     C           PCORF     READESECONFL1                 80
092390200529     C                     ELSE
092400200529     C           MAPTYP    IFEQ 'CC'                       Currency       CEU017
092410200529     C           PCORF     SETLLSECOCCL2                   Changes.       CEU017
092420200529     C           PCORF     READESECOCCL2                 80               CEU017
092430200529     C                     ELSE                                           CEU017
092440200529     C                     Z-ADD029       DBASE            ***************
092450200529     C                     MOVEL'SECOxxLx'DBFILE           * DB ERROR 29 *
092460200529     C                     MOVELMAPTYP    DBKEY1  8        ***************
092470200529     C                     MOVE PCORF     DBKEY1
092480200529     C                     MOVELDBKEY1    DBKEY
092490200529     C                     EXSR *PSSR
092500200529     C                     ENDIF                                          CEU017
092510200529     C                     ENDIF
092520200529     C                     ENDIF
092530200529     C                     ENDIF
092540200529     C                     ENDIF
092550200529     C                     ENDIF
092560200529     C                     ENDIF
092570200529     C                     ENDIF
092580200529     C                     ENDIF
092590200529     C                     ENDIF
092600200529      *
092610200529      ***  Do while not end of file for CO Reference received as parameter = for each Option.
092620200529      *
092630200529     C           *IN80     DOWEQ'0'
092640200529      *
092650200529      ***  If live record.
092660200529      *
092670200529     C           MDRECI    IFEQ 'D'
092680200529      *
092690200529      ***  If Processing Type is Corporate Reorganisation, retrieve the potential 20 New Securities,
092700200529      ***  Numbers of New Shares, Roundings, Roundings Settlement in Cash, Denominations Multiplier
092710200529      ***  and Compensation Prices from SECOCRL2
092720200529      *
092730200529     C           MAPTYP    IFEQ 'CR'
092740200529     C                     MOVEAMHSECA    TSEC,1
092750200529     C                     MOVEAMHNSHA    TNSH,1
092760200529     C                     MOVEAMHRNDN    TNDN,1
092770200529     C                     MOVEAMHRNDS    TNDS,1
092780200529     C                     MOVEAMHDMLA    TDML,1
092790200529     C                     MOVEAMHCOPA    TOPA,1
092800200529     C                     ELSE
092810200529      *
092820200529      ***  Else, if Processing Type is Capital Change, Non Financial Events or Name Changes with
092830200529      ***  Security Shortname blank, set New Security = Event Security.
092840200529      *
092850200529     C           MAPTYP    IFEQ 'CE'                       If Capital Change
092860200529     C           MAPTYP    OREQ 'NF'                       Or Non Financial Events
092870200529     C           MAPTYP    OREQ 'NC'                       Or Name Changes
092880200529     C           MDNSEC    ANDEQ*BLANKS                       Security from SECONCL1 blank
092890200529     C                     MOVE MASESN    TSEC,1
092900200529      *
092910200529      ***  Else, if Processing Type is Dividend Events, Exercices and Conversions, Offers, Rights
092920200529      ***  Issues, Free Allocation or Name Changes with Security Shortname not blank,
092930200529      ***  or Currency Changes,                                           CEU017
092940200529      ***  retrieve New Security from Corporate Actions Detail file.
092950200529      *
092960200529     C                     ELSE
092970200529     C                     MOVE MDNSEC    TSEC,1
092980200529     C                     ENDIF
092990200529     C                     ENDIF
093000200529      *
093010200529      ***  Retrieve Number of Decimal Places of Security and Currency and Price Basis for the New
093020200529      ***  Securities.
093030200529      *
093040200529     C                     DO   20        I       20
093050200529     C           TSEC,I    IFNE *BLANKS
093060200529      *
093070200529      ***  Access Midas SE Securities.
093080200529      *
093090200529     C                     MOVE TSEC,I    @SEC   10
093100200529     C           @SEC      CHAINSECTY                80
093110200529      *
093120200529      ***  If record not found, handle Database Error.
093130200529      *
093140200529     C           *IN80     IFEQ '1'                        Not found
093150200529     C                     Z-ADD030       DBASE            ***************
093160200529     C                     MOVEL'SECTY'   DBFILE           * DB ERROR 30 *
093170200529     C                     MOVEL@SEC      DBKEY            ***************
093180200529     C                     EXSR *PSSR
093190200529     C                     ENDIF
093200200529      *
093210200529      ***  Save Number of Decimal Places for Nominal Currency and Price Basis of New Security.
093220200529      *
093230200529     C                     Z-ADDNMDP      TSDP,I           Number of Decimal Places
093240200529     C                     MOVE SPBS      TSPB,I           Price Basis
093250200529      *
093260200529      ***  Retrieve Number of Decimal Places of New Currency by calling access objet.
093270200529      *
093280200529     C                     CALL 'AOCURRR0'
093290200529     C                     PARM '*MSG   ' @RTCD   7
093300200529     C                     PARM '*KEY   ' @OPTN   7
093310200529     C                     PARM NMCY      @AJCD   3
093320200529     C           SDCURR    PARM SDCURR    DSSDY
093330200529      *
093340200529      ***  If record not found, handle Database Error.
093350200529      *
093360200529     C           @RTCD     IFNE *BLANKS
093370200529     C                     Z-ADD031       DBASE            ***************
093380200529     C                     MOVEL'SDCURRPD'DBFILE           * DB ERROR 31 *
093390200529     C                     MOVELNMCY      DBKEY            ***************
093400200529     C                     EXSR *PSSR
093410200529     C                     ENDIF
093420200529     C                     Z-ADDA6NBDP    TCDP,I           Number of Decimal Places
093430200529     C                     ENDIF
093440200529     C                     ENDDO
093450200529      *
093460200529      ***  If Processing Type = Dividend Events and Subscription Price is entered as Market,
093470200529      ***  the Subscription Price must first be calculated from Current Market Price minus Discount.
093480200529      *
093490200529     C           MAPTYP    IFEQ 'DV'
093500200529     C           MDMRKI    ANDEQ'Y'
093510200529     C                     EXSR CSBPR
093520200529     C                     ENDIF
093530200529      *                                                                   136935
093540200529      ***  If Processing Type = Dividend Events with Stock Dividend Type  136935
093550200529      ***  = 'R', if Compensation Price entered, use Compensation Price   136935
093560200529      ***  instead of Subscription Price, otherwise, calculate Subscrip-  136935
093570200529      ***  tion Price = Subscription Price minus Discount Rate.           136935
093580200529      *                                                                   136935
093590200529     C           MAPTYP    IFEQ 'DV'                                      136935
093600200529     C           MDSDIT    ANDEQ'R'                                       136935
093610200529     C           MDCOMP    IFNE 0                                         136935
093620200529     C                     Z-ADDMDCOMP    MDSBPR                          136935
093630200529     C                     ELSE                                           136935
093640200529     C           MDMRKI    IFNE 'Y'                                       136935
093650200529     C           MDSBPR    MULT MDDSRT    WWSBPR                          136935
093660200529     C           WWSBPR    DIV  100       WWSBPR                          136935
093670200529     C                     SUB  WWSBPR    MDSBPR                          136935
093680200529     C                     ENDIF                                          136935
093690200529     C                     ENDIF                                          136935
093700200529     C                     ENDIF                                          136935
093710200529      *
093720200529      ***  Set 'Customer Reply Exists' work field to 'N'.
093730200529      *
093740200529     C                     MOVE 'N'       CUSRPL  1
093750200529      *                                                                   135686
093760200529      ***  Reset indicator Customer or Book processed.                    135686
093770200529      *                                                                   135686
093780200529     C                     MOVE 'N'       BCPROC  1                       135686
093790200529      *
093800200529      ***  Process Books for the Depot.
093810200529      *
093820200529     C                     EXSR PBKDPT
093830200529      *
093840200529      ***  If Portfolio Management Facilities have been licensed, process Customers for the Depot.
093850200529      *
093860200529     C           PFPL      IFEQ 'Y'
093870200529     C                     EXSR PCUDPT
093880200529     C                     ENDIF
093890200529      *
093900200529      ***  Process the Depot.
093910200529      *
093920200529     C**********           MOVE *ZEROS    WWCDCN           Customer                           CSD027
093930200529     C                     MOVE *BLANKS   WWCDCN           Customer                           CSD027
093940200529     C                     MOVE *BLANKS   WWPTFR           Protfolio Reference
093950200529     C                     MOVE *BLANKS   WWUDBK           Book
093960200529     C                     EXSR PDEPOT
093970200529      *
093980200529      ***  CO Dummy Customer processing.
093990200529      ***  If Customer or Book processed.                                 135686
094000200529      *
094010200529     C********** BVERCU    IFNE *ZEROS                                                        CSD027
094020200529     C           BVERCU    IFNE *BLANKS                                                       CSD027
094030200529     C           BVERCU    ANDNE*BLANKS
094040200529     C           BCPROC    ANDEQ'Y'                                       135686
094050200529     C                     EXSR PDUMCU
094060200529     C                     ENDIF
094070200529      *
094080200529     C                     ENDIF
094090200529      *
094100200529      ***  Read next record depending on the Processing Type, with CO Reference received as
094110200529      ***  parameter.
094120200529      *
094130200529     C           MAPTYP    IFEQ 'DV'                       Dividends Events.
094140200529     C           PCORF     READESECODVL1                 80
094150200529     C                     ELSE
094160200529     C           MAPTYP    IFEQ 'FR'                       Free Allocations.
094170200529     C           PCORF     READESECOFRL1                 80
094180200529     C                     ELSE
094190200529     C           MAPTYP    IFEQ 'RG'                       Rights Issues.
094200200529     C           PCORF     READESECORGL1                 80
094210200529     C                     ELSE
094220200529     C           MAPTYP    IFEQ 'CE'                       Capital Change.
094230200529     C           PCORF     READESECOCEL1                 80
094240200529     C                     ELSE
094250200529     C           MAPTYP    IFEQ 'CR'                       Corporate Reorganisation.
094260200529     C           PCORF     READESECOCRL1                 80
094270200529     C                     ELSE
094280200529     C           MAPTYP    IFEQ 'OF'                       Offers.
094290200529     C           PCORF     READESECOOFL1                 80
094300200529     C                     ELSE
094310200529     C           MAPTYP    IFEQ 'EX'                       Exercises and Conversions.
094320200529     C           PCORF     READESECOEXL1                 80
094330200529     C                     ELSE
094340200529     C           MAPTYP    IFEQ 'NC'                       Name Changes.
094350200529     C           PCORF     READESECONCL1                 80
094360200529     C                     ELSE
094370200529     C           MAPTYP    IFEQ 'NF'                       Non Financial.
094380200529     C           PCORF     READESECONFL1                 80
094390200529     C                     ELSE                                           CEU017
094400200529     C           MAPTYP    IFEQ 'CC'                       Currency       CEU017
094410200529     C           PCORF     READESECOCCL2                 80Changes.       CEU017
094420200529     C                     ENDIF                                          CEU017
094430200529     C                     ENDIF
094440200529     C                     ENDIF
094450200529     C                     ENDIF
094460200529     C                     ENDIF
094470200529     C                     ENDIF
094480200529     C                     ENDIF
094490200529     C                     ENDIF
094500200529     C                     ENDIF
094510200529     C                     ENDIF
094520200529      *
094530200529     C                     ENDDO
094540200529      *
094550200529      ***  Access Corporate Actions Depots file with CO Reference received as parameter, Option
094560200529      ***  Number from SECOxxL0, Branch and Depot (num field) received as parameter.
094570200529      *
094580200529     C           @KEY12    CHAINSECODRL0             82
094590200529      *
094600200529      ***  If record found, update.
094610200529      *
094620200529     C           *IN82     IFEQ '0'
094630200529      *
094640200529     C                     Z-ADDBJRDNB    MSLCD            Last Change Date = Run Date
094650200529     C                     MOVE 'A'       MSCHTP           Type of last Change
094670200529     C                     MOVE USER      MSLUID           User Id.
094710200529     C                     Z-ADDBJRDNB    MSCOAD           Last Allocation Date = Run Date
094720200529     C                     MOVE 'L'       MSCOST           Set CO Status to 'L' = Allocated
094730200529     C                     MOVE 'N'       MSALOC           Allocation running ?
094740200529     C           MAPTYP    IFEQ 'NC'                       Currency       136935
094750200529     C           MAPTYP    OREQ 'NF'                       Currency       136935
094760200529     C                     MOVE 'Y'       MSFAID           Final Alloc.   136935
094770200529     C                     ENDIF                                          136935
094780200529     C                     UPDATSECODRD0               89  Update SECODRL0
094790200529      *
094800200529      ***  If error detected when update, handle Database Error.
094810200529      *
094820200529     C           *IN89     IFEQ '1'
094830200529     C                     Z-ADD013       DBASE            ***************
094840200529     C                     MOVEL'SECODRL0'DBFILE           * DB ERROR 13 *
094850200529     C                     MOVEL'UPDATE'  DBKEY            ***************
094860200529     C                     EXSR *PSSR
094870200529     C                     ENDIF
094880200529     C                     COMIT
094890200529      *
094900200529      ***  If record not found, write a new record on file.
094910200529      *
094920200529     C                     ELSE
094930200529     C                     MOVE 'D'       MSRECI           Record Id.
094940200529     C                     Z-ADDBJRDNB    MSLCD            Last Change Date = Run Date
094950200529     C                     MOVE 'I'       MSCHTP           Type of last Change
094970200529     C                     MOVE USER      MSLUID           User Id.
095010200529     C                     MOVE PCORF     MSCORF           CO Reference = Parameter
095020200529     C                     MOVE PBRCD     MSBRCD           Branch = Parameter
095030200529     C**********           Z-ADDWWDDPT    MSDDPT           Depot = Parameter (num field)      CSD027
095040200529     C                     MOVE WWDDPT    MSDDPT           Depot = Parameter (num field)      CSD027
095050200529     C                     Z-ADDBJRDNB    MSCOAD           Last Allocation Date = Run Date
095060200529     C           MAPTYP    IFEQ 'NC'                       Currency       136935
095070200529     C           MAPTYP    OREQ 'NF'                       Currency       136935
095080200529     C                     MOVE 'Y'       MSFAID           Final Alloc.   136935
095090200529     C                     ELSE                                           136935
095100200529     C                     MOVE 'N'       MSFAID           Final Allocation Ind. = Trial Allocation
095110200529     C                     ENDIF                                          136935
095120200529     C                     MOVE 'L'       MSCOST           CO Status = allocated
095130200529     C                     MOVE 'N'       MSALOC           Allocation running ?
095140200529     C                     WRITESECODRD0               89  Write record on SECODRL0
095150200529      *
095160200529      ***  If error detected when write, handle Database Error.
095170200529      *
095180200529     C           *IN89     IFEQ '1'
095190200529     C                     Z-ADD014       DBASE            ***************
095200200529     C                     MOVEL'SECODRL0'DBFILE           * DB ERROR 14 *
095210200529     C                     MOVEL'WRITE'   DBKEY            ***************
095220200529     C                     EXSR *PSSR
095230200529     C                     ENDIF
095240200529     C                     COMIT
095250200529     C                     ENDIF
095260200529      *
095270200529      ***  Print details of Allocation generated.
095280200529      *
095290200529     C                     EXSR PRDTAG
095300200529      *
095310200529     C                     ENDSR
095320200529      *
095330200529      *****************************************************************
095340200529      /EJECT
095350200529      *****************************************************************
095360200529      *                                                               *
095370200529      * PDNSEC - Process Detail for CO Reference, Option Number and   *
095380200529      *          New Security, depending on the Processing Type.      *
095390200529      *                                                               *
095400200529      * Called by:                                                    *
095410200529      *                                                               *
095420200529      * Calls:                                                        *
095430200529      *                                                               *
095440200529      *****************************************************************
095450200529      *
095460200529     C           PDNSEC    BEGSR                           ** PDNSEC SR **
095470200529      *
095480200529     C           @KEY20    SETLLSECOALL0
095490200529     C           @KEY20    READESECOALL0                 80
095500200529     C           *IN80     DOWEQ'0'
095510200529     C           MCRECI    IFEQ 'D'                        Live record
095520200529     C           MCCOTP    ANDEQKCOTP                      Same Customer/Book Indicator
095530200529     C           MCBOOK    ANDEQPBOOK                      Same Book
095540200529     C           MCCNUM    ANDEQWWCNUM                     Same Customer Number
095550200529     C           MCPTFR    ANDEQPPTFR                      Same Portfolio Reference
095560200529      *
095570200529      ***  Retrieve Currency Number of Decimal Places.
095580200529      *
095590200529      ***  Access Midas SE Securities.
095600200529      *
095610200529     C           MCSESN    CHAINSECTY                80
095620200529      *
095630200529      ***  If record not found, handle Database Error.
095640200529      *
095650200529     C           *IN80     IFEQ '1'                        Not found
095660200529     C                     Z-ADD032       DBASE            ***************
095670200529     C                     MOVEL'SECTY'   DBFILE           * DB ERROR 32 *
095680200529     C                     MOVELMCSESN    DBKEY            ***************
095690200529     C                     EXSR *PSSR
095700200529     C                     ENDIF
095710200529      *
095720200529      ***  Retrieve Number of Decimal Places of Currency by calling access objet.
095730200529      *
095740200529     C                     CALL 'AOCURRR0'
095750200529     C                     PARM '*MSG   ' @RTCD   7
095760200529     C                     PARM '*KEY   ' @OPTN   7
095770200529     C                     PARM NMCY      @AJCD   3
095780200529     C           SDCURR    PARM SDCURR    DSSDY
095790200529      *
095800200529      ***  If record not found, handle Database Error.
095810200529      *
095820200529     C           @RTCD     IFNE *BLANKS
095830200529     C                     Z-ADD033       DBASE            ***************
095840200529     C                     MOVEL'SDCURRPD'DBFILE           * DB ERROR 33 *
095850200529     C                     MOVELNMCY      DBKEY            ***************
095860200529     C                     EXSR *PSSR
095870200529     C                     ENDIF
095880200529     C                     Z-ADDA6NBDP    WWNBDP           Number of Decimal Places
095890200529      *
095900200529      ***  Accumulate Actual Cash Rounding.
095910200529      *
095920200529     C                     Z-ADDMCACAR    WUNUM
095930200529     C                     EXSR RTVNDP
095940200529     C                     ADD  WWNUM     WTACAR 309
095950200529      *
095960200529      ***  Accumulate Original Cash Rounding.
095970200529      *
095980200529     C                     Z-ADDMCOCAR    WUNUM
095990200529     C                     EXSR RTVNDP
096000200529     C                     ADD  WWNUM     WTOCAR 309
096010200529     C                     ENDIF
096020200529     C           @KEY20    READESECOALL0                 80
096030200529     C                     ENDDO
096040200529      *
096050200529      ***  Access Corporate Actions Details file depending on the Processing Type, with CO
096060200529      ***  Reference and Option Number received as parameter.
096070200529      *
096080200529     C           MAPTYP    IFEQ 'DV'                       Dividends Events.
096090200529     C           @KEY19    SETLLSECODVL1
096100200529     C           @KEY19    READESECODVL1                 80
096110200529     C                     ELSE
096120200529     C           MAPTYP    IFEQ 'FR'                       Free Allocations.
096130200529     C           @KEY19    SETLLSECOFRL1
096140200529     C           @KEY19    READESECOFRL1                 80
096150200529     C                     ELSE
096160200529     C           MAPTYP    IFEQ 'RG'                       Rights Issues.
096170200529     C           @KEY19    SETLLSECORGL1
096180200529     C           @KEY19    READESECORGL1                 80
096190200529     C                     ELSE
096200200529     C           MAPTYP    IFEQ 'CE'                       Capital Change.
096210200529     C           @KEY19    SETLLSECOCEL1
096220200529     C           @KEY19    READESECOCEL1                 80
096230200529     C                     ELSE
096240200529     C           MAPTYP    IFEQ 'CR'                       Corporate Reorganisation.
096250200529     C           @KEY19    SETLLSECOCRL1
096260200529     C           @KEY19    READESECOCRL1                 80
096270200529     C                     ELSE
096280200529     C           MAPTYP    IFEQ 'OF'                       Offers.
096290200529     C           @KEY19    SETLLSECOOFL1
096300200529     C           @KEY19    READESECOOFL1                 80
096310200529     C                     ELSE
096320200529     C           MAPTYP    IFEQ 'EX'                       Exercises and Conversions.
096330200529     C           @KEY19    SETLLSECOEXL1
096340200529     C           @KEY19    READESECOEXL1                 80
096350200529     C                     ELSE
096360200529     C           MAPTYP    IFEQ 'NF'                       Non Financial Events
096370200529     C           PCORF     SETLLSECONFL1
096380200529     C           PCORF     READESECONFL1                 80
096390200529     C                     ELSE
096400200529     C           MAPTYP    IFEQ 'NC'                       Name Changes
096410200529     C           PCORF     SETLLSECONCL1
096420200529     C           PCORF     READESECONCL1                 80
096430200529     C                     ELSE
096440200529     C           MAPTYP    IFEQ 'CC'                       Currency       CEU017
096450200529     C           PCORF     SETLLSECOCCL2                   Changes.       CEU017
096460200529     C           PCORF     READESECOCCL2                 80               CEU017
096470200529     C                     ELSE                                           CEU017
096480200529     C                     Z-ADD034       DBASE            ***************
096490200529     C                     MOVEL'SECOxxLx'DBFILE           * DB ERROR 34 *
096500200529     C                     MOVELMAPTYP    DBKEY1  8        ***************
096510200529     C                     MOVE PCORF     DBKEY1
096520200529     C                     MOVELDBKEY1    DBKEY
096530200529     C                     EXSR *PSSR
096540200529     C                     ENDIF                                          CEU017
096550200529     C                     ENDIF
096560200529     C                     ENDIF
096570200529     C                     ENDIF
096580200529     C                     ENDIF
096590200529     C                     ENDIF
096600200529     C                     ENDIF
096610200529     C                     ENDIF
096620200529     C                     ENDIF
096630200529     C                     ENDIF
096640200529      *
096650200529      ***  Do while not end of file for CO Reference and Option Number received as parameter.
096660200529      *
096670200529     C           *IN80     DOWEQ'0'
096680200529      *
096690200529      ***  If live record.
096700200529      *
096710200529     C           MDRECI    IFEQ 'D'
096720200529     C                     MOVE '0'       *IN88
096730200529      *
096740200529      ***  If Processing Type is Corporate Reorganisation.
096750200529      *
096760200529     C           MAPTYP    IFEQ 'CR'
096770200529     C                     MOVEAMHSECA    SECT,1
096780200529     C           PNSEC     LOKUPSECT                     88
096790200529     C                     ELSE
096800200529      *
096810200529      ***  Else, if Processing Type is Capital Change, Non Financial Events or Name Changes with
096820200529      ***  Security Shortname blank.
096830200529      *
096840200529     C           MAPTYP    IFEQ 'CE'                       If Capital Change
096850200529     C           MAPTYP    OREQ 'NF'                       Or Non Financial Events
096860200529     C           MAPTYP    OREQ 'NC'                       Or Name Changes
096870200529     C           MDNSEC    ANDEQ*BLANKS                       Security from SECONCL1 blank
096880200529     C                     MOVE '1'       *IN88
096890200529     C                     ELSE
096900200529      *
096910200529      ***  Else, if Processing Type is Dividends Events, Rights Issues, Offers, Exercises and
096920200529      ***  Conversions, Free Allocation or Name Changes with Security Shortname not blank.
096930200529      ***  or Currency Changes.                                           CEU017
096940200529      *
096950200529     C           MDNSEC    COMP PNSEC                    88
096960200529     C                     ENDIF
096970200529     C                     ENDIF
096980200529      *
096990200529      ***  If New Security = New Security received as parameter.
097000200529      *
097010200529     C           *IN88     IFEQ '1'
097020200529      *
097030200529      ***  If Processing Type is Corporate Reorganisation, retrieve the New Security,
097040200529      ***  Number of New Shares, Rounding, Rounding Settlement in Cash, Denomination Multiplier and
097050200529      ***  Compensation Price.
097060200529      *
097070200529     C           MAPTYP    IFEQ 'CR'
097080200529     C                     MOVEAMHNSHA    NSHT,1
097090200529     C                     MOVEAMHRNDN    NDNT,1
097100200529     C                     MOVEAMHRNDS    NDST,1
097110200529     C                     MOVEAMHDMLA    DMLT,1
097120200529     C                     MOVEAMHCOPA    OPAT,1
097130200529     C                     Z-ADD1         I
097140200529     C           PNSEC     LOKUPSECT,I                   90
097150200529     C                     MOVE SECT,I    TSEC,1
097160200529     C                     MOVE NSHT,I    TNSH,1
097170200529     C                     MOVE NDNT,I    TNDN,1
097180200529     C                     MOVE NDST,I    TNDS,1
097190200529     C                     MOVE DMLT,I    TDML,1
097200200529     C                     MOVE OPAT,I    TOPA,1
097210200529     C                     ELSE
097220200529      *
097230200529      ***  Else, if Processing Type is Capital Change, Non Financial Events or Name Changes with
097240200529      ***  Security Shortname blank, set New Security = Event Security.
097250200529      *
097260200529     C           MAPTYP    IFEQ 'CE'                       If Capital Change
097270200529     C           MAPTYP    OREQ 'NF'                       Or Non Financial Events
097280200529     C           MAPTYP    OREQ 'NC'                       Or Name Changes
097290200529     C           MDNSEC    ANDEQ*BLANKS                       Security from SECONCL1 blank
097300200529     C                     MOVE MASESN    TSEC,1
097310200529      *
097320200529      ***  Else, if Processing Type is Dividend Events, Exercices and Conversions, Offers, Rights
097330200529      ***  Issues, Free Allocation or Name Changes with Security Shortname not blank,
097340200529      ***  or Currency Changes,                                           CEU017
097350200529      ***  retrieve New Security from Corporate Actions Detail file.
097360200529      *
097370200529     C                     ELSE
097380200529     C                     MOVE MDNSEC    TSEC,1
097390200529     C                     ENDIF
097400200529     C                     ENDIF
097410200529      *
097420200529      ***  Retrieve Number of Decimal Places of Security and Currency and Price Basis for the New
097430200529      ***  Security.
097440200529      *
097450200529      ***  Access Midas SE Securities.
097460200529      *
097470200529     C                     MOVE TSEC,1    @SEC   10
097480200529     C           @SEC      CHAINSECTY                80
097490200529      *
097500200529      ***  If record not found, handle Database Error.
097510200529      *
097520200529     C           *IN80     IFEQ '1'                        Not found
097530200529     C                     Z-ADD035       DBASE            ***************
097540200529     C                     MOVEL'SECTY'   DBFILE           * DB ERROR 35 *
097550200529     C                     MOVEL@SEC      DBKEY            ***************
097560200529     C                     EXSR *PSSR
097570200529     C                     ENDIF
097580200529      *
097590200529      ***  Save Number of Decimal Places for Nominal Currency and Price Basis of New Security.
097600200529      *
097610200529     C                     Z-ADDNMDP      TSDP,1           Number of Decimal Places
097620200529     C                     MOVE SPBS      TSPB,1           Price Basis
097630200529      *
097640200529      ***  Retrieve Number of Decimal Places of Event Currency by calling access objet.
097650200529      *
097660200529     C                     CALL 'AOCURRR0'
097670200529     C                     PARM '*MSG   ' @RTCD   7
097680200529     C                     PARM '*KEY   ' @OPTN   7
097690200529     C                     PARM ESNCCY    @AJCD   3
097700200529     C           SDCURR    PARM SDCURR    DSSDY
097710200529      *
097720200529      ***  If record not found, handle Database Error.
097730200529      *
097740200529     C           @RTCD     IFNE *BLANKS
097750200529     C                     Z-ADD036       DBASE            ***************
097760200529     C                     MOVEL'SDCURRPD'DBFILE           * DB ERROR 36 *
097770200529     C                     MOVELESNCCY    DBKEY            ***************
097780200529     C                     EXSR *PSSR
097790200529     C                     ENDIF
097800200529     C                     Z-ADDA6NBDP    TCDP,1           Number of Decimal Places
097810200529      *
097820200529      ***  If Processing Type = Dividend Events and Subscription Price is entered as Market,
097830200529      ***  the Subscription Price must first be calculated from Current Market Price minus Discount.
097840200529      *
097850200529     C           MAPTYP    IFEQ 'DV'
097860200529     C           MDMRKI    ANDEQ'Y'
097870200529     C                     EXSR CSBPR
097880200529     C                     ENDIF
097890200529      *                                                                   136935
097900200529      ***  If Processing Type = Dividend Events with Stock Dividend Type  136935
097910200529      ***  = 'R', if Compensation Price entered, use Compensation Price   136935
097920200529      ***  instead of Subscription Price, otherwise, calculate Subscrip-  136935
097930200529      ***  tion Price = Subscription Price minus Discount Rate.           136935
097940200529      *                                                                   136935
097950200529     C           MAPTYP    IFEQ 'DV'                                      136935
097960200529     C           MDSDIT    ANDEQ'R'                                       136935
097970200529     C           MDCOMP    IFNE 0                                         136935
097980200529     C                     Z-ADDMDCOMP    MDSBPR                          136935
097990200529     C                     ELSE                                           136935
098000200529     C           MDMRKI    IFNE 'Y'                                       136935
098010200529     C           MDSBPR    MULT MDDSRT    WWSBPR                          136935
098020200529     C           WWSBPR    DIV  100       WWSBPR                          136935
098030200529     C                     SUB  WWSBPR    MDSBPR                          136935
098040200529     C                     ENDIF                                          136935
098050200529     C                     ENDIF                                          136935
098060200529     C                     ENDIF                                          136935
098070200529      *
098080200529      ***  Set 'Customer Reply Exists' work field to 'N'.
098090200529      *
098100200529     C                     MOVE 'N'       CUSRPL  1
098110200529      *                                                                   135686
098120200529      ***  Reset indicator Customer or Book processed.                    135686
098130200529      *                                                                   135686
098140200529     C                     MOVE 'N'       BCPROC  1                       135686
098150200529      *
098160200529      ***  If Book received as parameter not blank, it seams that allocation must be runed for one
098170200529      ***  Depot.
098180200529      *
098190200529     C           PBOOK     IFNE *BLANKS
098200200529      *
098210200529      ***  Process Books for the Depot.
098220200529      *
098230200529     C                     EXSR PBKDPT
098240200529      *
098250200529      ***  Else, if Customer received as parameter not blank, it seams that allocation must be runed
098260200529      ***  for one Customer/Portfolio.
098270200529      *
098280200529     C                     ELSE
098290200529      *
098300200529      ***  If Portfolio Management Facilities have been licensed, process Customers for the Depot.
098310200529      *
098320200529     C           PFPL      IFEQ 'Y'
098330200529     C                     EXSR PCUDPT
098340200529     C                     ENDIF
098350200529     C                     ENDIF
098360200529      *
098370200529      ***  Process the Depot.
098380200529      *
098390200529     C**********           MOVE *ZEROS    WWCDCN           Customer                           CSD027
098400200529     C                     MOVE *BLANKS   WWCDCN           Customer                           CSD027
098410200529     C                     MOVE *BLANKS   WWPTFR           Protfolio Reference
098420200529     C                     MOVE *BLANKS   WWUDBK           Book
098430200529     C                     EXSR PDEPOT
098440200529      *
098450200529     C                     ENDIF
098460200529     C                     ENDIF
098470200529      *
098480200529      ***  Read next record depending on the Processing Type, with CO Reference and Option Number
098490200529      ***  received as parameter.
098500200529      *
098510200529     C           MAPTYP    IFEQ 'DV'                       Dividends Events.
098520200529     C           @KEY19    READESECODVL1                 80
098530200529     C                     ELSE
098540200529     C           MAPTYP    IFEQ 'FR'                       Free Allocations.
098550200529     C           @KEY19    READESECOFRL1                 80
098560200529     C                     ELSE
098570200529     C           MAPTYP    IFEQ 'RG'                       Rights Issues.
098580200529     C           @KEY19    READESECORGL1                 80
098590200529     C                     ELSE
098600200529     C           MAPTYP    IFEQ 'CE'                       Capital Change.
098610200529     C           @KEY19    READESECOCEL1                 80
098620200529     C                     ELSE
098630200529     C           MAPTYP    IFEQ 'CR'                       Corporate Reorganisation.
098640200529     C           @KEY19    READESECOCRL1                 80
098650200529     C                     ELSE
098660200529     C           MAPTYP    IFEQ 'OF'                       Offers.
098670200529     C           @KEY19    READESECOOFL1                 80
098680200529     C                     ELSE
098690200529     C           MAPTYP    IFEQ 'EX'                       Exercises and Conversions.
098700200529     C           @KEY19    READESECOEXL1                 80
098710200529     C                     ELSE
098720200529     C           MAPTYP    IFEQ 'NF'                       Non Financial Events
098730200529     C           PCORF     READESECONFL1                 80
098740200529     C                     ELSE
098750200529     C           MAPTYP    IFEQ 'NC'                       Name Changes
098760200529     C           PCORF     READESECONCL1                 80
098770200529     C                     ELSE                                           CEU017
098780200529     C           MAPTYP    IFEQ 'CC'                       Currency       CEU017
098790200529     C           PCORF     READESECOCCL2                 80Changes.       CEU017
098800200529     C                     ENDIF                                          CEU017
098810200529     C                     ENDIF
098820200529     C                     ENDIF
098830200529     C                     ENDIF
098840200529     C                     ENDIF
098850200529     C                     ENDIF
098860200529     C                     ENDIF
098870200529     C                     ENDIF
098880200529     C                     ENDIF
098890200529     C                     ENDIF
098900200529      *
098910200529     C                     ENDDO
098920200529      *
098930200529      ***  Access Corporate Actions Depots file with CO Reference received as parameter, Option
098940200529      ***  Number from SECOxxL0, Branch and Depot (num field) received as parameter.
098950200529      *
098960200529     C           @KEY12    CHAINSECODRL0             82
098970200529      *
098980200529      ***  If record found, update.
098990200529      *
099000200529     C           *IN82     IFEQ '0'
099010200529      *
099020200529     C                     Z-ADDBJRDNB    MSLCD            Last Change Date = Run Date
099030200529     C                     MOVE 'A'       MSCHTP           Type of last Change
099050200529     C                     MOVE USER      MSLUID           User Id.
099090200529     C                     Z-ADDBJRDNB    MSCOAD           Last Allocation Date = Run Date
099100200529     C                     MOVE 'L'       MSCOST           Set CO Status to 'L' = Allocated
099110200529     C                     MOVE 'N'       MSALOC           Allocation running ?
099120200529     C           MAPTYP    IFEQ 'NC'                       Currency       136935
099130200529     C           MAPTYP    OREQ 'NF'                       Currency       136935
099140200529     C                     MOVE 'Y'       MSFAID           Final Alloc.   136935
099150200529     C                     ENDIF                                          136935
099160200529     C                     UPDATSECODRD0               89  Update SECODRL0
099170200529      *
099180200529      ***  If error detected when update, handle Database Error.
099190200529      *
099200200529     C           *IN89     IFEQ '1'
099210200529     C                     Z-ADD013       DBASE            ***************
099220200529     C                     MOVEL'SECODRL0'DBFILE           * DB ERROR 13 *
099230200529     C                     MOVEL'UPDATE'  DBKEY            ***************
099240200529     C                     EXSR *PSSR
099250200529     C                     ENDIF
099260200529     C                     COMIT
099270200529      *
099280200529      ***  If record not found, write a new record on file.
099290200529      *
099300200529     C                     ELSE
099310200529     C                     MOVE 'D'       MSRECI           Record Id.
099320200529     C                     Z-ADDBJRDNB    MSLCD            Last Change Date = Run Date
099330200529     C                     MOVE 'I'       MSCHTP           Type of last Change
099350200529     C                     MOVE USER      MSLUID           User Id.
099390200529     C                     MOVE PCORF     MSCORF           CO Reference = Parameter
099400200529     C                     MOVE PBRCD     MSBRCD           Branch = Parameter
099410200529     C**********           Z-ADDWWDDPT    MSDDPT           Depot = Parameter (num field)      CSD027
099420200529     C                     MOVE WWDDPT    MSDDPT           Depot = Parameter (num field)      CSD027
099430200529     C                     Z-ADDBJRDNB    MSCOAD           Last Allocation Date = Run Date
099440200529     C           MAPTYP    IFEQ 'NC'                       Currency       136935
099450200529     C           MAPTYP    OREQ 'NF'                       Currency       136935
099460200529     C                     MOVE 'Y'       MSFAID           Final Alloc.   136935
099470200529     C                     ELSE                                           136935
099480200529     C                     MOVE 'N'       MSFAID           Final Allocation Ind. = Trial Allocation
099490200529     C                     ENDIF                                          136935
099500200529     C                     MOVE 'L'       MSCOST           CO Status = allocated
099510200529     C                     MOVE 'N'       MSALOC           Allocation running ?
099520200529     C                     WRITESECODRD0               89  Write record on SECODRL0
099530200529      *
099540200529      ***  If error detected when write, handle Database Error.
099550200529      *
099560200529     C           *IN89     IFEQ '1'
099570200529     C                     Z-ADD014       DBASE            ***************
099580200529     C                     MOVEL'SECODRL0'DBFILE           * DB ERROR 14 *
099590200529     C                     MOVEL'WRITE'   DBKEY            ***************
099600200529     C                     EXSR *PSSR
099610200529     C                     ENDIF
099620200529     C                     COMIT
099630200529     C                     ENDIF
099640200529      *
099650200529      ***  Print details of Allocation generated.
099660200529      *
099670200529     C                     EXSR PRDTAG
099680200529      *
099690200529     C                     ENDSR
099700200529      *
099710200529      *****************************************************************
099720200529      /EJECT
099730200529      *****************************************************************
099740200529      *                                                               *
099750200529      * CTOTAX - Calculate total Tax.                                 *
099760200529      *                                                               *
099770200529      * Called by:                                                    *
099780200529      *                                                               *
099790200529      * Calls:                                                        *
099800200529      *                                                               *
099810200529      *****************************************************************
099820200529      *
099830200529     C           CTOTAX    BEGSR                           ** CTOTAX SR **
099840200529      *
099850200529      ***  Initialise Total Tax.
099860200529      *
099870200529     C                     Z-ADD0         TOTTAX
099880200529      *
099890200529      ***  Access Security Withholding Tax details file to retrieve Tax for the Event Security.
099900200529      *
099910200529     C           MASESN    CHAINSESWHTL0             84
099920200529      *
099930200529      ***  If record found.
099940200529      *
099950200529     C           *IN84     IFEQ '0'
099960200529      *
099970200529      ***  Initialise work tax rate and amount fields.
099980200529      *
099990200529     C                     CLEARUTXRSR
100000200529     C                     CLEARUTXRRF
100010200529     C                     CLEARUTXRUS
100020200529     C                     CLEARUDLOR
100030200529      *
100040200529      ***  If Tax Band at source is zero, then take Rate from Security Withholding Tax file.
100050200529      *
100060200529     C           S1TABD    IFEQ *ZERO
100070200529     C                     Z-ADDS1RASO    UTXRSR  74
100080200529     C                     ELSE
100090200529      *
100100200529      ***  Otherwise access SE Country Tax Rate file to get Tax Rate at source.
100110200529      *
100120200529     C                     MOVELS1CTTA    UKEY    3
100130200529     C                     MOVE S1TABD    UKEY
100140200529     C                     CALL 'AOSCTXR0'
100150200529     C                     PARM *BLANKS   @RTCD
100160200529     C                     PARM '*KEY   ' @OPTN
100170200529     C                     PARM S1CTTA    @CTTA   2
100180200529     C                     PARM S1TABD    @TABD   10
100190200529     C           SECNTR    PARM SECNTR    DSSDY
100200200529      *
100210200529      ***  If record not found or not live, handle Database Error.
100220200529      *
100230200529     C           @RTCD     IFNE *BLANKS
100240200529     C           TXRECI    ORNE 'D'
100250200529     C                     Z-ADD037       DBASE            ***************
100260200529     C                     MOVEL'SECNTRL0'DBFILE           * DB ERROR 37 *
100270200529     C                     MOVELUKEY      DBKEY            ***************
100280200529     C                     EXSR *PSSR
100290200529     C                     ELSE
100300200529     C                     Z-ADDTXRASO    UTXRSR
100310200529     C                     ENDIF
100320200529     C                     ENDIF
100330200529      *
100340200529      ***  If Tax Band by User is not zero, then access Country to Branch Tax Rate file to get
100350200529      ***  Tax Rate by User, otherwise set to zero.
100360200529      *
100370200529     C           S1TABU    IFNE *ZERO
100380200529     C                     CALL 'AOCBTXR0'
100390200529     C                     PARM *BLANKS   @RTCD
100400200529     C                     PARM '*KEY   ' @OPTN
100410200529     C                     PARM PBRCD     @BRCA   3
100420200529     C                     PARM S1CTTA    @CTTA
100430200529     C                     PARM S1TABU    @TABU   10
100440200529     C           SECBTX    PARM SECBTX    DSFDY
100450200529     C           @RTCD     IFEQ *BLANKS
100460200529     C           TBRECI    ANDEQ'D'
100470200529     C                     Z-ADDTBRASR    UTXRRF  74
100480200529     C                     Z-ADDTBRAUS    UTXRUS  74
100490200529     C                     MOVE TBDLOR    UDLOR   1
100500200529     C                     ENDIF
100510200529     C                     ENDIF
100520200529      *
100530200529      ***  Calculate amount deducted at source.
100540200529      *
100550200529     C           UTXRSR    DIV  100       URATE   54
100560200529     C***********WWAMTT    MULT URATE     TASO   130H                     164020
100570200529     C           WWAMTT    MULT URATE     TASO   152H                     164020
100580200529      *
100590200529      ***  Calculate amount deducted refundable.
100600200529      *
100610200529     C           UTXRRF    DIV  100       URATE
100620200529     C***********WWAMTT    MULT URATE     TASR   130H                     164020
100630200529     C           WWAMTT    MULT URATE     TASR   152H                     164020
100640200529      *
100650200529      ***  Calculate amount deducted by user.
100660200529      *
100670200529     C                     CLEARTAUS
100680200529     C           UTXRUS    IFGT *ZERO
100690200529     C           UDLOR     IFEQ 'N'
100700200529     C                     MOVE WWCDCN    KCUST
100710200529     C           @KEY8     CHAINCLINT                84
100720200529     C           *IN84     IFEQ '1'
100730200529     C           RECI      OREQ '*'
100740200529     C                     Z-ADD038       DBASE            ***************
100750200529     C                     MOVEL'CLINTCB 'DBFILE           * DB ERROR 38 *
100760200529     C                     MOVELKCUST     DBKEY2  7        ***************
100770200529     C                     MOVE KRTYP     DBKEY2
100780200529     C                     MOVELDBKEY2    DBKEY
100790200529     C                     EXSR *PSSR
100800200529     C                     ENDIF
100810200529     C                     ENDIF
100820200529      *
100830200529     C           UDLOR     IFEQ 'Y'
100840200529     C           UDLOR     OREQ 'N'
100850200529     C           CLOC      ANDNEUBRLOC
100860200529     C           UTXRUS    DIV  100       URATE
100870200529     C***********WWAMTT    MULT URATE     TAUS   130H                     164020
100880200529     C           WWAMTT    MULT URATE     TAUS   152H                     164020
100890200529     C                     ENDIF
100900200529     C                     ENDIF
100910200529      *
100920200529      ***  Calculate Total Tax.
100930200529      *
100940200529     C           TAUS      ADD  TASO      TOTTAX 309
100950200529     C                     ENDIF
100960200529      *
100970200529     C                     ENDSR
100980200529      *
100990200529      *****************************************************************
101000200529      /EJECT
101010200529      *****************************************************************
101020200529      *                                                               *
101030200529      * SETNDP - Set amount from num field 24.9 to num field 15.0     *
101040200529      *          with Number of Decimal Places from Nominal Currency  *
101050200529      *          received as parameter.                               *
101060200529      *                                                               *
101070200529      * Called by:                                                    *
101080200529      *                                                               *
101090200529      * Calls:                                                        *
101100200529      *                                                               *
101110200529      *****************************************************************
101120200529      *
101130200529     C           SETNDP    BEGSR                           ** SETNDP SR **
101140200529      *
101150200529     C           WWNBDP    IFEQ 0                          If no Decimal Place
101160200529     C**********           Z-ADDWWNUM     WUNUM  150                      149257
101170200529     C                     Z-ADDWWNUM     WUNUM  194                      149257
101180200529     C                     ELSE
101190200529     C           WWNBDP    IFEQ 1                          If 1 Decimal Place
101200200529     C           WWNUM     MULT 10        WUNUM
101210200529     C                     ELSE
101220200529     C           WWNBDP    IFEQ 2                          If 2 Decimal Places
101230200529     C           WWNUM     MULT 100       WUNUM
101240200529     C                     ELSE
101250200529     C           WWNBDP    IFEQ 3                          If 3 Decimal Places
101260200529     C           WWNUM     MULT 1000      WUNUM
101270200529     C                     ELSE
101280200529     C           WWNBDP    IFEQ 4                          If 4 Decimal Places
101290200529     C           WWNUM     MULT 10000     WUNUM
101300200529     C                     ENDIF
101310200529     C                     ENDIF
101320200529     C                     ENDIF
101330200529     C                     ENDIF
101340200529     C                     ENDIF
101350200529      *
101360200529     C                     ENDSR
101370200529      *
101380200529      *****************************************************************
101390200529      /EJECT
101400200529      *****************************************************************
101410200529      *                                                               *
101420200529      * RTVNDP - Set amount from num field 15.0 to num field 24.9     *
101430200529      *          with Retrieve Number of Decimal Places from Nominal  *
101440200529      *          Currency received as parameter.                      *
101450200529      *                                                               *
101460200529      * Called by:                                                    *
101470200529      *                                                               *
101480200529      * Calls:                                                        *
101490200529      *                                                               *
101500200529      *****************************************************************
101510200529      *
101520200529     C           RTVNDP    BEGSR                           ** RTVNDP SR **
101530200529      *
101540200529     C           WWNBDP    IFEQ 0                          If no Decimal Place
101550200529     C                     Z-ADDWUNUM     WWNUM  309
101560200529     C                     ELSE
101570200529     C           WWNBDP    IFEQ 1                          If 1 Decimal Place
101580200529     C           WUNUM     DIV  10        WWNUM
101590200529     C                     ELSE
101600200529     C           WWNBDP    IFEQ 2                          If 2 Decimal Places
101610200529     C           WUNUM     DIV  100       WWNUM
101620200529     C                     ELSE
101630200529     C           WWNBDP    IFEQ 3                          If 3 Decimal Places
101640200529     C           WUNUM     DIV  1000      WWNUM
101650200529     C                     ELSE
101660200529     C           WWNBDP    IFEQ 4                          If 4 Decimal Places
101670200529     C           WUNUM     DIV  10000     WWNUM
101680200529     C                     ENDIF
101690200529     C                     ENDIF
101700200529     C                     ENDIF
101710200529     C                     ENDIF
101720200529     C                     ENDIF
101730200529      *
101740200529     C                     ENDSR
101750200529      *
101760200529      *****************************************************************
101770200529      /EJECT
101780200529      *****************************************************************
101790200529      *                                                               *
101800200529      * ROUNDD - Perform rounding to the Number of Decimal Places.    *
101810200529      *                                                               *
101820200529      * Called by:                                                    *
101830200529      *                                                               *
101840200529      * Calls:                                                        *
101850200529      *                                                               *
101860200529      *****************************************************************
101870200529      *
101880200529     C           ROUNDD    BEGSR                           ** ROUNDD SR **
101890200529      *
101900200529     C           WWNBDP    IFEQ 0                          If no Decimal Place
101910200529     C           WUROOP    IFEQ 'R'
101920200529     C                     Z-ADDWWNUM     WUFLD0 300H
101930200529     C                     ELSE
101940200529     C                     Z-ADDWWNUM     WUFLD0
101950200529     C           WUROOP    IFEQ 'U'
101960200529     C           WWNUM     ANDNEWUFLD0
101970200529     C                     ADD  1         WUFLD0
101980200529     C                     ENDIF
101990200529     C                     ENDIF
102000200529     C                     Z-ADDWUFLD0    WWNUM
102010200529     C                     ELSE
102020200529     C           WWNBDP    IFEQ 1                          If 1 Decimal Place
102030200529     C           WUROOP    IFEQ 'R'
102040200529     C                     Z-ADDWWNUM     WUFLD1 241H
102050200529     C                     ELSE
102060200529     C                     Z-ADDWWNUM     WUFLD1
102070200529     C           WUROOP    IFEQ 'U'
102080200529     C           WWNUM     ANDNEWUFLD1
102090200529     C                     ADD  0.1       WUFLD1
102100200529     C                     ENDIF
102110200529     C                     ENDIF
102120200529     C                     Z-ADDWUFLD1    WWNUM
102130200529     C                     ELSE
102140200529     C           WWNBDP    IFEQ 2                          If 2 Decimal Places
102150200529     C           WUROOP    IFEQ 'R'
102160200529     C                     Z-ADDWWNUM     WUFLD2 242H
102170200529     C                     ELSE
102180200529     C                     Z-ADDWWNUM     WUFLD2
102190200529     C           WUROOP    IFEQ 'U'
102200200529     C           WWNUM     ANDNEWUFLD2
102210200529     C                     ADD  0.01      WUFLD2
102220200529     C                     ENDIF
102230200529     C                     ENDIF
102240200529     C                     Z-ADDWUFLD2    WWNUM
102250200529     C                     ELSE
102260200529     C           WWNBDP    IFEQ 3                          If 3 Decimal Places
102270200529     C           WUROOP    IFEQ 'R'
102280200529     C                     Z-ADDWWNUM     WUFLD3 243H
102290200529     C                     ELSE
102300200529     C                     Z-ADDWWNUM     WUFLD3
102310200529     C           WUROOP    IFEQ 'U'
102320200529     C           WWNUM     ANDNEWUFLD3
102330200529     C                     ADD  0.001     WUFLD3
102340200529     C                     ENDIF
102350200529     C                     ENDIF
102360200529     C                     Z-ADDWUFLD3    WWNUM
102370200529     C                     ELSE
102380200529     C           WWNBDP    IFEQ 4                          If 4 Decimal Places
102390200529     C           WUROOP    IFEQ 'R'
102400200529     C                     Z-ADDWWNUM     WUFLD4 244H
102410200529     C                     ELSE
102420200529     C                     Z-ADDWWNUM     WUFLD4
102430200529     C           WUROOP    IFEQ 'U'
102440200529     C           WWNUM     ANDNEWUFLD4
102450200529     C                     ADD  0.0001    WUFLD4
102460200529     C                     ENDIF
102470200529     C                     ENDIF
102480200529     C                     Z-ADDWUFLD4    WWNUM
102490200529     C                     ELSE
102500200529     C           WWNBDP    IFEQ 8                          If 8 Decimal Places
102510200529     C           WUROOP    IFEQ 'R'
102520200529     C                     Z-ADDWWNUM     WUFLD8 248H
102530200529     C                     ELSE
102540200529     C                     Z-ADDWWNUM     WUFLD8
102550200529     C           WUROOP    IFEQ 'U'
102560200529     C           WWNUM     ANDNEWUFLD8
102570200529     C                     ADD  0.00000001WUFLD8
102580200529     C                     ENDIF
102590200529     C                     ENDIF
102600200529     C                     Z-ADDWUFLD8    WWNUM
102610200529     C                     ENDIF
102620200529     C                     ENDIF
102630200529     C                     ENDIF
102640200529     C                     ENDIF
102650200529     C                     ENDIF
102660200529     C                     ENDIF
102670200529      *
102680200529     C                     ENDSR
102690200529      *
102700200529      *****************************************************************
102710200529      /EJECT
102720200529      *****************************************************************
102730200529      *                                                               *
102740200529      * CSBPR  - Calculate Subscription Price if Subscription Price   *
102750200529      *          entered as Market for Dividend Events.               *
102760200529      *                                                               *
102770200529      * Called by:                                                    *
102780200529      *                                                               *
102790200529      * Calls:                                                        *
102800200529      *                                                               *
102810200529      *****************************************************************
102820200529      *
102830200529     C           CSBPR     BEGSR                           ** CSBPR SR **
102840200529      *
102850200529      ***  Find Market Price with correct Date.
102860200529      *
102870200529     C                     MOVE 'N'       WWCHCK  1
102880200529      *
102890200529     C                     Z-ADDMACOEX    KPVDT
102900200529     C           @KEY21    SETGTPRICM
102910200529     C                     READPPRICM                    44
102920200529      *
102930200529      ***  If record found use this Price.
102940200529      *
102950200529     C           *IN44     IFEQ '0'
102960200529     C           PSSN      ANDEQMDNSEC
102970200529     C                     MOVE 'Y'       WWCHCK
102980200529      *
102990200529      ***  Otherwise check for Current Price.
103000200529      *
103010200529     C                     ELSE
103020200529     C                     Z-ADD*HIVAL    KPVDT
103030200529      *
103040200529     C           @KEY21    SETGTPRICM
103050200529     C                     READPPRICM                    44
103060200529      *
103070200529      ***  If record found use this price.
103080200529      *
103090200529     C           *IN44     IFEQ '0'
103100200529     C           PSSN      ANDEQMDNSEC
103110200529     C                     MOVE 'Y'       WWCHCK
103120200529     C                     ENDIF
103130200529     C                     ENDIF
103140200529      *
103150200529     C           WWCHCK    IFEQ 'N'
103160200529     C                     Z-ADDMKPR      MPRICE 158       Market Price from Security file.
103170200529     C                     ELSE
103180200529     C                     Z-ADDPPRC      MPRICE
103190200529     C                     ENDIF
103200200529      *
103210200529      ***  Calculate Subscription Price = Current Market Price minus Discount.
103220200529      *
103230200529     C           MPRICE    MULT MDDSRT    WWSBPR 158
103240200529     C           WWSBPR    DIV  100       WWSBPR
103250200529     C           MPRICE    SUB  WWSBPR    MDSBPR
103260200529      *
103270200529     C                     ENDSR
103280200529      *
103290200529      *****************************************************************
103300200529      /EJECT                                                              135685
103310200529      *****************************************************************   135685
103320200529      *                                                               *   135685
103330200529      * CCOMP  - Calculate Subscription Price if Subscription Price   *   135685
103340200529      *          entered as Market for Dividend Events.               *   135685
103350200529      *                                                               *   135685
103360200529      * Called by:                                                    *   135685
103370200529      *                                                               *   135685
103380200529      * Calls:                                                        *   135685
103390200529      *                                                               *   135685
103400200529      *****************************************************************   135685
103410200529      *                                                                   135685
103420200529     C           CCOMP     BEGSR                           ** CCOMP SR ** 135685
103430200529      *                                                                   135685
103440200529      ***  Find Market Price with correct Date.                           135685
103450200529      *                                                                   135685
103460200529     C                     MOVE 'N'       WWCHCK  1                       135685
103470200529      *                                                                   135685
103480200529     C                     Z-ADDMAALEF    KPVDT                           135685
103490200529     C           @KEY21    SETGTPRICM                                     135685
103500200529     C                     READPPRICM                    44               135685
103510200529      *                                                                   135685
103520200529      ***  If record found use this Price.                                135685
103530200529      *                                                                   135685
103540200529     C           *IN44     IFEQ '0'                                       135685
103550200529     C           PSSN      ANDEQMDNSEC                                    135685
103560200529     C                     MOVE 'Y'       WWCHCK                          135685
103570200529      *                                                                   135685
103580200529      ***  Otherwise check for Current Price.                             135685
103590200529      *                                                                   135685
103600200529     C                     ELSE                                           135685
103610200529     C                     Z-ADD*HIVAL    KPVDT                           135685
103620200529      *                                                                   135685
103630200529     C           @KEY21    SETGTPRICM                                     135685
103640200529     C                     READPPRICM                    44               135685
103650200529      *                                                                   135685
103660200529      ***  If record found use this price.                                135685
103670200529      *                                                                   135685
103680200529     C           *IN44     IFEQ '0'                                       135685
103690200529     C           PSSN      ANDEQMDNSEC                                    135685
103700200529     C                     MOVE 'Y'       WWCHCK                          135685
103710200529     C                     ENDIF                                          135685
103720200529     C                     ENDIF                                          135685
103730200529      *                                                                   135685
103740200529     C           WWCHCK    IFEQ 'N'                                       135685
103750200529     C                     Z-ADDMKPR      MDCOMP           Market Price   135685
103760200529     C                     ELSE                                           135685
103770200529     C                     Z-ADDPPRC      MDCOMP                          135685
103780200529     C                     ENDIF                                          135685
103790200529      *                                                                   135685
103800200529     C                     ENDSR                                          135685
103810200529      *                                                                   135685
103820200529      *****************************************************************   135685
103830200529      /EJECT
103840200529      *****************************************************************
103850200529      *                                                               *
103860200529      * ENDPGM - Termination Processing.                              *
103870200529      *                                                               *
103880200529      * Called by: Main Processing.                                   *
103890200529      *                                                               *
103900200529      * Calls:                                                        *
103910200529      *                                                               *
103920200529      *****************************************************************
103930200529      *
103940200529     C           ENDPGM    BEGSR                           ** ENDPGM SR **
103950200529      *
103960200529      ***  Write Report Header and File Control on Audit (PRTF/SE7550AU).
103970200529      *
103980200529     C                     WRITEHEADAU
103990200529     C  N13                WRITESUBHD1
104000200529     C   13                WRITESUBHD2
104010200529     C                     WRITECONTROL
104020200529      *
104030200529      ***  End of program.
104040200529      *
104050200529     C                     MOVE '1'       *INLR
104060200529     C                     RETRN
104070200529      *
104080200529     C                     ENDSR
104090200529      *
104100200529      *****************************************************************
104110200529      /EJECT
104120200529      *****************************************************************
104130200529      *                                                               *
104140200529      * RCFAU  - Subroutine to register the AU Printer File via RCF.  *
104150200529      *                                                               *
104160200529      * Called by:                                                    *
104170200529      *                                                               *
104180200529      * Calls:                                                        *
104190200529      *                                                               *
104200200529      *****************************************************************
104210200529      *
104220200529     C           RCFAU     BEGSR                            *** RCFAU  ***
104230200529      *
104240200529      ***  Ensure Audit Spool File recorded by RCF.
104250200529      *
104260200529     C                     Z-ADDSFNUMU    ZSNUMU  60
104270200529      *
104280200529     C                     CALL 'ZSFILE'               87
104290200529     C                     PARM           SEQ     5
104300200529     C                     PARM *BLANKS   SENTY   3
104310200529     C                     PARM           SFILEU
104320200529     C                     PARM           ZSNUMU
104330200529     C                     PARM *BLANK    ZSERR   1
104340200529      *
104350200529      ***  If Error occurs during ZSFILE processing, handle Database Error.
104360200529      *
104370200529     C           ZSERR     IFEQ 'Y'
104380200529     C           *IN87     OREQ '1'
104390200529     C           *INU7     OREQ '1'
104400200529     C           *INU8     OREQ '1'
104410200529     C                     Z-ADD039       DBASE            ***************
104420200529     C                     MOVEL*BLANKS   DBFILE           * DB ERROR 39 *
104430200529     C                     MOVELNARR,2    DBKEY            ***************
104440200529     C                     EXSR *PSSR
104450200529     C                     ENDIF
104460200529      *
104470200529     C                     ENDSR
104480200529      *
104490200529      *****************************************************************
104500200529      /EJECT
104510200529      *****************************************************************
104520200529      *                                                               *
104530200529      * *PSSR  - Program exception error routine                      *
104540200529      *          Called automatically if a program error occurs,      *
104550200529      *          or directly by the program code using EXSR.          *
104560200529      *          This subroutine DUMPs the program just once.         *
104570200529      *                                                               *
104580200529      * Called by:                                                    *
104590200529      *                                                               *
104600200529      * Calls:                                                        *
104610200529      *                                                               *
104620200529      *****************************************************************
104630200529      *
104640200529     C           *PSSR     BEGSR                           ** *PSSR SR **
104650200529      *
104660200529     C           @RUN      IFEQ *BLANK
104670200529     C                     MOVE 'Y'       @RUN    1
104680200529      *
104690200529      ***  Update LDA with error information.
104700200529      *
104710200529     C           *LOCK     IN   LDA
104720200529     C                     MOVELDBFILE    WWFILE
104730200529     C                     MOVELDBKEY     WWKEY
104740200529     C                     MOVELDBPGM     WWPGM
104750200529     C                     MOVELDBASE     WWASE
104760200529     C                     OUT  LDA
104770200529      *
104780200529      ***  Rollback and print Dump.
104790200529      *
104800200529     C                     ROLBK
104810200529     C                     DUMP
104820200529     C                     ENDIF
104830200529      *
104840200529      ***  Write Report Header and Database Error on Audit (PRTF/SE7550AU).
104850200529      *
104860200529     C                     WRITEHEADAU
104870200529     C  N13                WRITESUBHD1
104880200529     C   13                WRITESUBHD2
104890200529     C                     WRITEDBERROR
104900200529      *
104910200529     C                     SETON                     U7U8LR
104920200529     C                     RETRN
104930200529      *
104940200529     C                     ENDSR
104950200529      *
104960200529      *****************************************************************
104970200529      /EJECT
104980200529      *
104990200529      ***  Standard Subroutine to calculate Charges/Commissions.
105000200529      ***  ( Called by: CALAM2 - Calculate Charge Amounts.
105010200529      ***    Calls: ZCCAL2 - Calculate Charges/Commissions.
105020200529      ***           ZCONV  - Convert Amount from one Currency to another. )
105030200529      *
105040200529     C/COPY ZSRSRC,ZCCAL1Z2
105050200529      /EJECT
105060200529      *
105070200529      ***  Standard Subroutine to calculate Charges/Commissions.
105080200529      ***  ( Called by: ZCCAL1 - Calculate Charges/Commissions.
105090200529      ***    Calls: None. )
105100200529      *
105110200529     C/COPY ZSRSRC,ZCCAL2Z1
105120200529      /EJECT
105130200529      *
105140200529      ***  Standard Subroutine to convert Amount from one Currency to another.
105150200529      ***  ( Called by: ZCCAL1 - Calculate Charges/Commissions.
105160200529      ***    Calls: None. )
105170200529      *
105180200529     C/COPY ZSRSRC,ZCONVZ1
105190200529      /EJECT
105200200529**  POWER8 - ARRAY OF POWERS FOR CURRENCY CONVERSION
10521020052900000001
10522020052900000010
10523020052900000100
10524020052900001000
10525020052900010000
10526020052900100000
10527020052901000000
10528020052910000000
105290200529**  POWER - ARRAY OF POWERS FOR CURRENCY CONVERSION
1053002005290000001
1053102005290000010
1053202005290000100
1053302005290001000
1053402005290010000
1053502005290100000
1053602005291000000
105370200529**  NARR
105380200529ERROR CALL PGM 'SE7534'
105390200529ERROR CALL PGM 'ZSFILE'
105400200529**  CPY@
105410200529(c) Finastra International Limited 2001
