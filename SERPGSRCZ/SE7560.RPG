000100200610     H        1
000200200610      *****************************************************************
000300200610/*STD *  RPGBASE                                                      *
000400200610/*EXI *  TEXT('Midas SE CO generation trades and depot movements')    *
000500200610      *****************************************************************
000600200610      *                                                               *
000700200610      *  Midas - Securities Trading Module                            *
000800200610      *                                                               *
000900200610      *  RPG/SE7560 - SE CO Generates Trades and Depot Movements      *
001000200610      *                                                               *
001100200610      *  Function:  This Program Generate Trades for Book records     *
001200200610      *  (COB)      with the actual stock allocation different than   *
001300200610      *             zero and Depot Movements for all Customers        *
001400200610      *             records with the actual stock allocation          *
001500200610      *             different than zero.                              *
001600200610      *                                                               *
001700200610      *  Called by: SEC7560 - Generate Trades & Depot Movements       *
001800200610      *                                                               *
001900200610      *  (c) Finastra International Limited 2001                      *
002000200610      *                                                               *
002001200616      *  LAST Amend No. AR324886           Date 01JUN20               *
002100200616      *  PREV Amend No. 248698             Date 01Jun20               *
002200200616      *                 258814             Date 22May20               *
002300200610      *                 MD046248           Date 27Oct17               *
002400200610      *                 226449             Date 24Jun15               *
002500200610      *                 MD034776           Date 09Jul15               *
002600200610      *                 AR1067108          Date 11Dec12               *
002700200610      *                 AR1001183A         Date 20Nov12               *
002800200610      *                 CCB020             Date 06Aug12               *
002900200610      *                 AR850932           Date 14Nov11               *
003000200610      *                 CRE073             Date 06Dec10               *
003100200610      * Bank Fusion Midas 1.4 Base -----------------------------------*
003200200610      * Midas Plus 1.4 Base 04 ---------------------------------------*
003300200610      * Midas Plus 1.4 Base ------------------------------------------*
003400200610      * Midas Plus 1.3 ----------- Base ------------------------------*
003500200610      *                 234300             Date 29Sep06               *
003600200610      *                 240016             Date 24May06               *
003700200610      *                 CSD031             Date 10Apr06               *
003800200610      *                 CSD027A            Date 06May06               *
003900200610      *                 CSD027             Date 09Dec05               *
004000200610      *                 CER001             Date 25Apr05               *
004100200610      *                 CSE075             Date 17Nov05               *
004200200610      *                 235041             Date 20Jul05               *
004300200610      *                 234829             Date 08Jul05               *
004400200610      *                 CSE071             Date 19Jul05               *
004500200610      *                 CSW037A            Date 02May05               *
004600200610      *                 229857             Date 07Oct04               *
004700200610      *                 221751             Date 09OCT03               *
004800200610      *                 221680             Date 03OCT03               *
004900200610      *                 220219             Date 12Aug03
005000200610      *                 216944             Date 30Apr03               *
005100200610      *                 215278             Date 17MAR03               *
005200200610      *                 226570             Date 27Jun04               *
005300200610      *                 219634             Date 21Aug03
005400200610      *                 CSD025             Date 11Jan05               *
005500200610      *                 CSW037             Date 15Dec04               *
005600200610      *                 CSW036             Date 15Dec04               *
005700200610      *                 BUG3122            Date 17Jul04               *
005800200610      *                 CLE025             Date 20Oct03               *
005900200610      *                 CGL029             Date 01Sep03               *
006000200610      *                 222727             Date 05Nov03               *
006100200610      *                 194370             Date 12Jul01               *
006200200610      *                 CAS006             Date 21Jan03               *
006300200610      *                 217310             Date 21Jan03               *
006400200610      *                 CSE039             Date 23Apr03               *
006500200610      * Midas Release 4.01.02 ----------------------------------------*
006600200610      *                 186486             Date 11Apr02               *
006700200610      * Midas Release 4.01.01 ----------------------------------------*
006800200610      *                 207006             Date 18Jun02               *
006900200610      * Midas Release 4.01 -------------------------------------------*
007000200610      *                 CPK015             Date 17Jun01               *
007100200610      *                 193662             Date 30Nov01               *
007200200610      * Midas Release 4 --------------- Base -------------------------*
007300200610      *                 193752             Date 27Jun01               *
007400200610      *                 190204             Date 31May01               *
007500200610      * Midas DBA 3.05 -----------------------------------------------*
007600200610      *                 CSD006             Date 16May01               *
007700200610      *                 183579             Date 31Jan01               *
007800200610      * Midas DBA 3.04 -----------------------------------------------*
007900200610      *                 CSE023             Date 12Jul00               *
008000200610      * Midas DBA 3.03 -----------------------------------------------*
008100200610      *                 179732             Date 15Jun00               *
008200200610      *                 CSE020             Date 21Mar00               *
008300200610      *                 161732             Date 21Mar00               *
008400200610      *                 088864             Date 20Apr00               *
008500200610      * Midas DBA 3.02 -----------------------------------------------*
008600200610      *                 CSE015             Date 06Dec99               *
008700200610      *                 CSE017             Date 20Oct99               *
008800200610      *                 CSE012             Date 16Aug99               *
008900200610      *                 CPB001             Date 07Sep99               *
009000200610      * Midas DBA 3.01 -----------------------------------------------*
009100200610      *                 166599             Date 06SEP99               *
009200200610      *                 165216             Date 13SEP99               *
009300200610      *                 161746             Date 12Jul99               *
009400200610      *                 161910             Date 29Jun99               *
009500200610      *                 163065             Date 25Jun99               *
009600200610      *                 162290             Date 08Jun99               *
009700200610      * Midas DBA 3.00 ---------------- Base -------------------------*
009800200610      *                 158451             Date 02Apr99               *
009900200610      *                 CPL002             Date 08Mar99               *
010000200610      *                 CAC005             Date 23Nov98               *
010100200610      *                 148404             Date 23Nov98               *
010200200610      *                 145872             Date 24Nov98               *
010300200610      *                 152873             Date 18Jan99               *
010400200610      *                 153345             DATE 18Jan99               *
010500200610      *                 151945             DATE 06Jan99               *
010600200610      *                 152589             Date 06Jan99               *
010700200610      *                 151954             Date 05Jan99               *
010800200610      *                 151931             Date 30Dec98               *
010900200610      *                 151356             Date 28Dec98               *
011000200610      *                 151062             Date 22Dec98               *
011100200610      *                 151173             Date 18Dec98               *
011200200610      *                 150272             Date 10Dec98               *
011300200610      *                 150140             Date 10Dec98               *
011400200610      *                 150004             Date 09Dec98               *
011500200610      *                 148959             Date 09Dec98               *
011600200610      *                 148741             Date 25Nov98               *
011700200610      *                 148661             Date 24Nov98               *
011800200610      *                 148246             Date 19Nov98               *
011900200610      *                 147104             Date 11Nov98               *
012000200610      *                 147102             Date 11Nov98               *
012100200610      *                 137881             Date 08Jul98               *
012200200610      *                 136931             Date 19Jun98               *
012300200610      *                 CEU017             Date 05Mar98               *
012400200610      *                 CSE007   *CREATE   Date 19Jan98               *
012500200610      *                                                               *
012600200610      *---------------------------------------------------------------*
012700200610      *                                                               *
012701200616      *  AR324886 - Implement 4-eyes processing in Position           *
012702200616      *             Settlement Maintenance.                           *
012800200610      *  248698 - Rounding discrepancies on some SE reports. Applied  *
012900200610      *           fix 228682.                                         *
013000200610      *  228682 - Recompiled due to ZCNSDZ1 changes. Applied 176594.  *
013100200610      *  258814 - Wrong walk out position generated by system when    *
013200200610      *           Corp. action processing type = 'EX'. Remove 161732. *
013300200610      *  MD046248 - Finastra Rebranding                               *
013400200610      *  226449 - Recompiled over changes made in /COPY ZDYYRZ3.      *
013500200610      *         - Applied for MD034387.                               *
013600200610      *  MD034776 - Reverse AR1001183A to allow negative interest     *
013700200610      *             rate. (Recompile)                                 *
013800200610      *  AR1067108 - PMC1140 Component failed during Clean COB        *
013900200610      *              Applied fix AR1001183A                           *
014000200610      *  AR1001183A - Coupon rate was still used in computation of    *
014100200610      *              interest instead of using the details in FRN tab *
014200200610      *              (Reopen) (Recompile)                             *
014300200610      *  CCB020 - COB Restructure - Secondary COB Infrastructure      *
014400200610      *  AR850932 - SEC7560 00001 Database error in SE7560, file      *
014500200610      *           SECONCL0, at 015, key                               *
014600200610      *           Incorrect corporate action reference used for chain *
014700200610      *           in file SECONCPD. Use reference from field MACORF   *
014800200610      *           instead of MSCORF. Applied fix 185017.              *
014900200610      *  185017 - Data base in PGM - SE7560 - File name SECONCLO key  *
015000200610      *           001622.                                             *
015100200610      *  CRE073 - Interest Rate Rounding (Recompile)                  *
015200200610      *  234300 - Recompiled over changed in PF/HSTTRD.               *
015300200610      *  240016 - Should not add an In Depot to a date field.         *
015400200610      *  CSD031 - Enhanced Centralised Static Data (Recompile)        *
015500200610      *  CSD027A - Conversion Of Customer Number to Alpha             *
015600200610      *  CSD027 - Conversion Of Customer Number to Alpha              *
015700200610      *  CER001 - LUX Upgrade to MidasPlus                            *
015800200610      *  CSE075 - US Enhanced Treasury Upgrade to MidasPlus           *
015900200610      *           (Recompile)                                         *
016000200610      *  235041 - Speculative fixes from SE4860                       *
016100200610      *  234829 - For EU Tax write to ETCPOSND and set up new fields  *
016200200610      *  CSE071 - Multiple Holidays Re Securities (recompile)         *
016300200610      *  CSW037A- Additional Field extended to 40 chars (recompile)   *
016400200610      *  229857 - Recompiled due to change in ZYLDZ2.                 *
016500200610      *  221751 - DON'T GENERATE A DEPOT MOVEMENT IF NOMINAL IS 0.    *
016600200610      *  221680 - WHEN REVERSING A CORPORATE INPUT TODAY CHANGE       *
016700200610      *           RECI TO '*'.                                        *
016800200610      *  220219 - Don't replicate if generated in I/C                 *
016900200610      *  216944 - New depot movement generated instead of reversing   *
017000200610      *           original after reversing corp action. Fix is to     *
017100200610      *           reverse original transaction when reversing a corp  *
017200200610      *           action.                                             *
017300200610      *         - Update Dptmvd file if record not already deleted.   *
017400200610      *  215278 - For type 'CR', walk-out and trade sale on old posi- *
017500200610      *           tion must be processed only once when a walk-in and *
017600200610      *           Trade purchase have to be created for each new posi-*
017700200610      *           tion. This must be done for subr. #PRCRA too.       *
017800200610      *           Core Fix 186486 reviewed and completed.             *
017900200610      *  219634 - WHEN REVERSING A CORPORATE COUNT THE DELETED RECORDS*
018000200610      *           AND UPDATE THE TRAILER ACCORDINGLY.                 *
018100200610      *  226570 - Recompiled due to change in ZYLDZ2.                 *
018200200610      *  CSD025 - Customer De-Activation                              *
018300200610      *  CSW037 - Additional Field Data on MT300/MT320                *
018400200610      *  CSW036 - Dual SWIFT BIC held on Client Details               *
018500200610      *  BUG3122 - Recompiled due to changes in SDSECSPD.             *
018600200610      *  CLE025 - Credit Lines (Recompile)                            *
018700200610      *  CGL029 - Increase Account Code to 10 digits                  *
018800200610      *  222727 - Release 5.0 errors  (Recompile)                     *
018900200610      *  194370 - Recompile after change on copy sources ZYLDZ2,      *
019000200610      *           For securities with divisor basis = '5' and first   *
019100200610      *           coupon date > valuation date (rundate + 1), set     *
019200200610      *           event control date to first coupon date before      *
019300200610      *           processing SR/ZDYYR. This is to ensure that the     *
019400200610      *           correct hypothetical last and next coupon dates are *
019500200610      *           used in deriving the price/yield rate.              *
019600200610      *  CAS006 - Hedge Accounting Phase B                            *
019700200610      *  217310 - A default timestamp string is required when         *
019800200610      *           writing Trade and/or Trade Extension Details.       *
019900200610      *  CSE039 - Automatic Settlement of Trades - Write to Movement  *
020000200610      *           Status file SEMVTSPD                                *
020100200610      *  186486 - For processing type 'CR', walk-out and trade sale   *
020200200610      *           on old position must be processed only one time     *
020300200610      *           when a walk-in and a trade purchase have to be      *
020400200610      *           created for each new position.                      *
020500200610      *  207006 - Add Counterparty & Market Centre to SSI             *
020600200610      *  CPK015 - Release 4.01 Packaging:                             *
020700200610      *           - A default timestamp string is required for WRITE. *
020800200610      *         - Conversion of ZYIELD from PLI to RPG.               *
020900200610      *           Recompile over changed ZYLDZ2.                      *
021000200610      *  193662 - Nominal positions on trades and depot movements     *
021100200610      *           generated by offers (subscription and purchase)     *
021200200610      *           should be based on the actual stock allocations.    *
021300200610      *  193752 - Database error 40 occurs when generating depot      *
021400200610      *           movement for customer (Cust/Book indicator is 'C'). *
021500200610      *           Movement Subtype (MSTP field) should be defaulted   *
021600200610      *           with Corporate Action Trade Subtype if not blank.   *
021700200610      *           Else, use Default Portfolio Subtype from ICD.       *
021800200610      *  190204 - Recompiled due to changes in PF/SECODVPD.           *
021900200610      *  CSD006 - Market Data Feed (recompile)                        *
022000200610      *  183579 - Set up Movement Subtype on Depot Movements file.    *
022100200610      *  CSE023 - Treaty Withholding Tax (Recompiled)                 *
022200200610      *  179732 - Upgrade Profit centre default matrix to use the     *
022300200610      *           correct customer number and a value for the account *
022400200610      *           officer.                                            *
022500200610      *  CSE020 - Corporate Actions Domino Effect Processing          *
022600200610      *           (Recompiled due to changes in PF/SECORFPD)          *
022700200610      *  161732 - Corporate Actions Exercise and Conversion -         *
022800200610      *           Part Stock/Keep Rest Calculation                    *
022900200610      *           (Recompiled due to changes in PF/SECOEXPD)          *
023000200610      *  088864 - Recompile over amended /COPY ZPCINTZ1               *
023100200610      *  CSE015 - Forward Valued Depot Movement                       *
023200200610      *  CSE017 - Cum/Ex Indicator on Depot Movements                 *
023300200610      *  CSE012 - SE Depot Movement Narratives (Recompiled).          *
023400200610      *  CPB001 - Meridian DBA Middleware Replication Customization.  *
023500200610      *           Midas/TOF Interface.                                *
023600200610      *         - 'Private Banking' Module                            *
023700200610      *  166599 - For offers to exchange, Walk Out and Trade Sale on  *
023800200610      *           old positions should be calcd at current AV. Price  *
023900200610      *           and not with the Av price as adjusted for the Corp. *
024000200610      *           Reorgansiation which is used for Walk In and Trade  *
024100200610      *           Purchase on new Positions.                          *
024200200610      *  165216 - For Spin-Off,Walk-Out and Trade Sale on Old Position*
024300200610      *           must be processed only once when a walk-in and      *
024400200610      *           Trade purchase have to be created for each new posn *
024500200610      *  161746 - Average Price Option 'I' has been added in SE7505.  *
024600200610      *           (SECORGPD/MFAVOP)                                   *
024700200610      *           Manage it as option 'C' in this program and in      *
024800200610      *           SE7560 SE7561 SE7590 SE7591                         *
024900200610      *           ( SEINS-BBN20520 & GBSEUSRMSG/CO00175 changed too ) *
025000200610      *  161910 - Market Price Used Instead of Discounted Market      *
025100200610      *           Price                                               *
025200200610      *  163065 - Average price was wrongly calculated.               *
025300200610      *  162290 - Average price was zero due wrong charging of AVPR   *
025400200610      *           ( array )                                           *
025500200610      *  158451 - Review Transactions (TS and WO) for Processing Type *
025600200610      *           'OF' with Offer Type 'E'xchange                     *
025700200610      *  CPL002 - Midas-Plato Interface (Recompiled)                  *
025800200610      *  CAC005 - Profit Centre Accounting - SE Enhancement           *
025900200610      *  148404 - Corporate Actions (other processing type than 'CC') *
026000200610      *           Trades/Depot movements generated with negative      *
026100200610      *           Amounts. TS --> TP, TP --> TS, WI --> WO, WO --> WI *
026200200610      *  145872 - Corporate Actions: '% to Exchange' added for        *
026300200610      *           Exchange Offer ('OF').                              *
026400200610      *  152873 - To avoid problem with reversal processing, Depot    *
026500200610      *           reference must be unique anyway.                    *
026600200610      *  153345 - Exchange rate is not exactly the same with that in  *
026700200610      *           the EURO Exchange Rate. Use the EURO exchange rate  *
026800200610      *           from SDCURRPD if the Settlement Ccy is EUR and      *
026900200610      *           Nominal Ccy is an 'IN' Ccy or Nominal Ccy is EUR    *
027000200610      *           and Settlement Ccy is an 'IN' Ccy.                  *
027100200610      *  151945 - Recompiled Over changed ZDYYRZ3 .                   *
027200200610      *  152589 - When retrieve Book Last Average Price, access file  *
027300200610      *           BKPHD with complete key, add Trade/Value Date       *
027400200610      *           Position. Before, Last Average Price was always     *
027500200610      *           retrieve for Value Date Position.                   *
027600200610      *  151954 - Base ccy rate should be rate of SETTL ccy and not   *
027700200610      *           NOM ccy rate.                                       *
027800200610      *  151931 - Review Average Price Calculation when CEU002 *OFF   *
027900200610      *  151356 - Incorrect Trades generated if Trade Basis is 'Y'    *
028000200610      *  151062 - Review setup of field TMDI (Mult./Div. Indicator)   *
028100200610      *  151173 - Purchased interest must be calculated from VALUE    *
028200200610      *           DATE not from Event Control Date                    *
028300200610      *           No trade must be generated as ex-coupon             *
028400200610      *           Wrong currency decimal places used for purchased    *
028500200610      *           interest calculation                                *
028600200610      *  150272 - Problem with Amount greater than 99,999,999,999.    *
028700200610      *           Fields NOML from PF/TRADSD and DPNA from PF/DPTMVD  *
028800200610      *           are defined as 11,0 ! Split the Amount into 2 Trades*
028900200610      *           or 2 Depot Movements OR MORE ...                    *
029000200610      *  150140 - No confirmations for WI/WO produced from SE Reden.  *
029100200610      *  150004 - After Redenomination, for Short Positions, the Book *
029200200610      *           Price is reset to 0                                 *
029300200610      *  148959 - Incorrect setting up of settlement currency for     *
029400200610      *           SE redenomination for system without customer       *
029500200610      *           portfolio. Settlement currency for both trades      *
029600200610      *           should be currency from the old security.           *
029700200610      *  148741 - DB error in SE1460, file CLINTSE, at 12, key 000000 *
029800200610      *           Complete GEMS 147104 !!!                            *
029900200610      *  148661 - To calculate purchased interest the coupon rate     *
030000200610      *           is necessary, move some lines of coding to use the  *
030100200610      *           correct coupon rate                                 *
030200200610      *  148246 - Trades/Depot movements generated with negative      *
030300200610      *           Amounts. TS --> TP, TP --> TS, WI --> WO, WO --> WI *
030400200610      *  147104 - Invalid setup of clearance type when depot reference*
030500200610      *           is 'Cedel'. It must be '4' instead of '2'.          *
030600200610      *           It avoids DB error in SE1460, file CLINTSE, at 12,  *
030700200610      *           key '000000'.                                       *
030800200610      *  147102 - Market Price is incorrectly calculated when number  *
030900200610      *           of decimal positions of the 'old' security is not 0 *
031000200610      *  137881 - Corporate Actions: Generation of Trades/Depot Mvts  *
031100200610      *           - Processing for 'NC' was never executed.           *
031200200610      *           - No Trades/Depot Movements for 'NF' events.        *
031300200610      *           - Review calculation of Average Prices for 'CR'.    *
031400200610      *           - For 'NC', use the book price of the old position *
031500200610      *             for both sides.                                  *
031600200610      *  136931 - (1) Array Index Error on POWER8 with index equal 9; *
031700200610      *           Nominal Decimal Places can be from 0 to 4 !!!       *
031800200610      *           (2) If no record found on Customer Position File,   *
031900200610      *           Use Market Price of the Security (No more Db Error) *
032000200610      *           (3) For the Dummy Customer, use the Market Price    *
032100200610      *           or the Compensation Price depending of the Market   *
032200200610      *           Price Indicator retrieved on PF/SECOCCPD            *
032300200610      *           (4) Set record to 'C'omplete when Corporate Ref.    *
032400200610      *           is authorised and no position exists. For 'CC' only *
032500200610      *  CEU017 - Securities Redenomination Euro Changes              *
032600200610      *  CSE007 - Corporate Actions                                   *
032700200610      *                                                               *
032800200610      *****************************************************************
032900200610      *
033000200610     FPMPORTLLIF  E           K        DISK         KINFSR *PSSR
033100200610      ***  PM Live Portfolio Definition Details
033200200610      *
033300200610     FSECTY   UF  E           K        DISK         KINFSR *PSSR
033400200610      ***  Securities Details
033500200610      *
033600200610     FINVTP   IF  E           K        DISK
033700200610      ***  Investment type details
033800200610     F                                              KINFSR *PSSR
033900200610      *
034000200610     FTNRAN   UF  E           K        DISK         KINFSR *PSSR
034100200610      ***  Trade Number Range File
034200200610      *
034300200610     FTRADHS  IF  E           K        DISK         KINFSR *PSSR
034400200610      ***  Trades and Historic Trades
034500200610     F            TRADSDF                           KRENAMETRADSDF1
034600200610      *
034700200610     F*DPTMV***IF**E           K        DISK         KINFSR *PSSR                             216944
034800200610     FDPTMV   UF  E           K        DISK         KINFSR *PSSR                              216944
034900200610      ***  Depot Movements
035000200610     F            DPTMVDF                           KRENAMEDPTMVDF2
035100200610      *
035200200610     FDPTMVDL1IF  E           K        DISK         KINFSR *PSSR
035300200610      ***  Depot Movements
035400200610     F            DPTMVDF                           KRENAMEDPTMVDF1
035500200610      *
035600200610     FSECORFL2UF  E           K        DISK         KINFSR *PSSR
035700200610      ***  SE CO Reference                          Prefix - MA
035800200610      *
035900200610     FSECOFRL0IF  E           K        DISK         KINFSR *PSSR
036000200610      ***  SE CO Free Allocations                   Prefix - ME
036100200610      *
036200200610     FSECORGL0IF  E           K        DISK         KINFSR *PSSR
036300200610      ***  SE CO Rights                             Prefix - MF
036400200610      *
036500200610     FSECOOFL0IF  E           K        DISK         KINFSR *PSSR
036600200610      ***  SE CO Exchange Offers                    Prefix - MI
036700200610      *
036800200610     FSECOEXL0IF  E           K        DISK         KINFSR *PSSR
036900200610      ***  SE CO Exercises and Conversions          Prefix - MJ
037000200610      *
037100200610     FSECOCRL0IF  E           K        DISK         KINFSR *PSSR
037200200610      ***  SE CO Corp. Reorganisation               Prefix - MH
037300200610      *
037400200610     FSECODRL0UF  E           K        DISK         KINFSR *PSSR
037500200610      ***  SE CO Depots references file             Prefix - MS
037600200610      *
037700200610     FSECOALL0UF  E           K        DISK         KINFSR *PSSR
037800200610      ***  SE CO Allocations file                   Prefix - MC
037900200610     F            SECOALD0                          KRENAMESECOALR0
038000200610      *
038100200610     FSECOALL3IF  E           K        DISK         KINFSR *PSSR
038200200610      ***  SE CO Allocations file                   Prefix - MC
038300200610     F            SECOALD0                          KRENAMESECOALR3
038400200610      *
038500200610     FSECOALL5UF  E           K        DISK         KINFSR *PSSR
038600200610      ***  SE CO Allocations file                   Prefix - MC
038700200610     F            SECOALD0                          KRENAMESECOALR5
038800200610      *
038900200610     FSECOATL0IF  E           K        DISK         KINFSR *PSSR
039000200610      ***  SE CO Type file details                  Prefix - MM
039100200610      *
039200200610     FSECODVL0IF  E           K        DISK         KINFSR *PSSR
039300200610      ***  SE CO Dividends Events file details      Prefix - MD
039400200610      *
039500200610     FSECODPL0IF  E           K        DISK         KINFSR *PSSR
039600200610      ***  SE CO Depots file                        Prefix - MB
039700200610      *
039800200610     FSECONCL0UF  E           K        DISK         KINFSR *PSSR
039900200610      ***  SE CO Name Changes                       Prefix - ML
040000200610      *
040100200610     FSECOCCL0IF  E           K        DISK         KINFSR *PSSR          CEU017
040200200610      ***  SE CO Currency Change                    Prefix - NA           CEU017
040300200610      *                                                                   CEU017
040400200610     FSEPCBD  UF  E           K        DISK         KINFSR *PSSR A
040500200610      ***  SE Book Position Profit Center
040600200610      *
040700200610     FCPOSC   IF  E           K        DISK         KINFSR *PSSR
040800200610      ***  SE Cust Posn by Branch, Sec & Cus.
040900200610      *
041000200610     FBKPHD   IF  E           K        DISK         KINFSR *PSSR
041100200610      ***  SE Book Postion Headers
041200200610      *
041300200610     FSEPCCD  UF  E           K        DISK         KINFSR *PSSR A
041400200610      ***  SE Customer Position Profit Center
041500200610      *
041600200610     FSEPCA   UF  E                    DISK         KINFSR *PSSR
041700200610      ***  SE Position Profit Center Audit
041800200610      *
041900200610     FSEDEV   IF  E           K        DISK         KINFSR *PSSR
042000200610      ***
042100200610      *
042200200610     FSECEO   IF  E           K        DISK         KINFSR *PSSR
042300200610      ***
042400200610     F            SEDEVDF                           KRENAMESEDEVDO
042500200610     F            SNDEVDF                           KRENAMESNDEVDO
042600200610      *
042700200610     FTRADSA  UF  E                    DISK         KINFSR *PSSR
042800200610      ***  SE Trades audit
042900200610      *
043000200610     FDPTMVA  UF  E                    DISK         KINFSR *PSSR
043100200610      ***  SE Depot movements audit
043200200610      *
043300200610     FPOSETA  UF  E                    DISK         KINFSR *PSSR
043400200610      ***  SE Position Settlements - Audit
043500200610      *
043600200610     FPOSET1  UF  E           K        DISK         KINFSR *PSSR
043700200610      ***  SE Position Settlements - Details
043701200616     FPSAUT   UF  E           K        DISK         KINFSR *PSSR                            AR324886
043702200616      ** SE Position Settlement Authorisation detail                                        AR324886
043800200610      *
043900200610     FTRADS   UF  E           K        DISK         KINFSR *PSSR A
044000200610      ***  SE Trades details
044100200610      *
044200200610     FDPTMVD  O   E           K        DISK         KINFSR *PSSR
044300200610      ***  SE Depot Movements details
044400200610     F/COPY WNCPYSRC,SE7560F002
044500200610      *
044600200610     FDPTMVDY1UF  E           K        DISK         KINFSR *PSSR A    UC
044700200610      ***  SE Depot Movements Extended File
044800200610      *
044900200610     FTRADSDY1UF  E           K        DISK         KINFSR *PSSR A    UC
045000200610      ***  SE Trades details Extended File
045100200610     FETCPOSNDO   E           K        DISK         KINFSR *PSSR                              234829
045200200610     F            ETCPOSNDF                         KRENAMEETCPOSF                            234829
045300200610      ***  SE EU Tax positions file                                                           234829
045400200610     F/COPY WNCPYSRC,SE7560F003
045500200610      *
045600200610     FSEMVTSL1IF  E           K        DISK         KINFSR *PSSR A        CSE039
045700200610      ***  Movement Status                                                CSE039
045800200610     FSE7560AUO   E                    PRINTER      KINFSR *PSSR
045900200610      ***  Program run control report
046000200610     F                                              KINFDS SPOOLU
046100200610     F/COPY WNCPYSRC,SE7560F001
046200200610     FSETRX1PDUF  E           K        DISK         KINFSR *PSSR A    UC                      CER001
046300200610      *                                                                                       CER001
046400200610      ** IML ER Trades Details - Extension file                                               CER001
046500200610      *                                                                                       CER001
046600200610     FSEDPX1PDUF  E           K        DISK         KINFSR *PSSR A    UC                      CER001
046700200610      *                                                                                       CER001
046800200610      ** IML ER Depot Movements - Extension Detail                                            CER001
046900200610      *                                                                                       CER001
047000200610     FERLUICL1IF  E           K        DISK         KINFSR *PSSR      UC                      CER001
047100200610      *                                                                                       CER001
047200200610      ** ER ICD                                                                               CER001
047300200610      *
047400200610      *****************************************************************
047500200610      /EJECT
047600200610      *****************************************************************
047700200610      *
047800200610     E                    SECUR      20 10
047900200610      ***  Retrieve the Security from PF/SECOCRPD
048000200610      *
048100200610     E                    MPRICE     20 16
048200200610      ***  Retrieve Market Price from PF/SECOCRPD
048300200610      *
048400200610     E                    NPR        20 15 8
048500200610      ***  Market Price from PF/SECOCRPD converted on numeric field
048600200610      *
048700200610     E                    NSEC       22 10
048800200610      ***  Array Security for the Calculated Average Price (1) & (2)
048900200610      *
049000200610     E*****               NOMI       22 15 0                              137881
049100200610     E                    NOMI       22 23 8                              137881
049200200610      ***  Array Nominal for the Calculated Average Price (1) & (2)
049300200610      *
049400200610     E*****               MARK       22 15 0                              137881
049500200610     E                    MARK       22 23 8                              137881
049600200610      ***  Array Market Price for the Calculated Average Price (1) & (2)
049700200610      *
049800200610     E*****               AVPR       22 15 0                              137881
049900200610     E                    AVPR       22 23 8                              137881
050000200610      ***  Average price for each new Security on processing type 'CR'
050100200610      *
050200200610     E/COPY ZSRSRC,ZALIGNZ1
050300200610     E/COPY ZSRSRC,ZASIGNZ1
050400200610     E/COPY ZSRSRC,ZNCDZ1
050500200610     E/COPY ZSRSRC,ZHOLE
050600200610     E/COPY ZSRSRC,ZACCRZ0
050700200610     E                    POWER8  1   8  8 4             POWER8 ARRAY
050800200610     E                    POWER   1   7  7 3             POWER ARRAY
050900200610      *
051000200610      ***  Compile with 2 levels /copy
051100200610      *
051200200610      /COPY ZSRSRC,ZDAYSZ1
051300200610      /COPY ZSRSRC,ZDATE2Z1
051400200610     E/COPY WNCPYSRC,SE7560E001
051500200610     E                    STAMP   1   1 26                                                    CPK015
051600200610      ** Array containing dummy timestamp                                                     CPK015
051700200610     E                    CPY@    1   1 80
051800200610      ***  Copyrigth Array
051900200610      *
052000200610     E                    POWER9  1   9  9 4             POWER9 ARRAY     136931
052100200610     E                    TMMP    1   1 26               TIMESTAMP        CSE039
052200200610     E                    @FNXA      40 10                                                    234829
052300200610     E                    @MIXA      40  7                                                    234829
052400200610     E                    @MDXA      40 45                                                    234829
052500200610      *****************************************************************
052600200610      /EJECT
052700200610      *****************************************************************
052800200610      *
052900200610     ISEPCCDF                                                             CAC003
053000200610      ***  Rename Portfolio Reference Field                               CAC003
053100200610      *                                                                   CAC003
053200200610     I              PTFR                            PTFRXX                CAC003
053300200610     IBKPHDDF                                                             CSE017
053400200610     I              DPAP                            DPAPX                 CSE017
053500200610      *                                                                   CAC003
053600200610      **  Rename Security Replication Indicator.                          CPB001
053700200610     ISECTYDF                                                             CPB001
053800200610     I              REPI                            SEREPI                CPB001
053900200610      *                                                                   CPB001
054000200610      **  Rename Trade Replication Indicator.                             CPB001
054100200610     ITRADSDF                                                             CPB001
054200200610     I              REPI                            TRREPI                CPB001
054300200610      *                                                                   CPB001
054400200610     I**MPHAS*****E DSMPHAS                                                            220219 CCB020
054500200610     I**********    MPHAS                           PHASE                              220219 CCB020
054600200610      *                                                                                       220219
054700200610     ILDA       E DSLDA
054800200610      ***  Data structure for database error
054900200610      *
055000200610     ISPOOLU      DS
055100200610      ***  File information data structure
055200200610     I                                       83  92 SFILEU
055300200610     I                                    B 123 1240SFNUMU
055400200610      *
055500200610     I            DS
055600200610      ***  Working DS for Settlement Account
055700200610     I                                        1   6 WWCUST
055800200610     I**********                              7  10 WWSTAC                                    CGL029
055900200610     I**********                             11  12 WWSTSQ                                    CGL029
056000200610     I**********                              1  12 WWPAAC                                    CGL029
056100200610     I                                        7  16 WWSTAC                                    CGL029
056200200610     I                                       17  18 WWSTSQ                                    CGL029
056300200610     I                                        1  18 WWPAAC                                    CGL029
056400200610      *
056500200610     IWWCOOP      DS
056600200610      ***  Working DS for Database Error on LF/SECODVL0
056700200610     I                                        1   6 WKCOR2
056800200610     I                                        7   80WKOPT2
056900200610     IWWCOSC      DS
057000200610      ***  Working DS for Database Error on LF/CPOSC
057100200610     I                                        1   3 WCBRCD
057200200610     I                                        4  13 WCSESN
057300200610     I**********                             14  190WCCNUM                                    CSD027
057400200610     I                                       14  19 WCCNUM                                    CSD027
057500200610     IW2DPMV      DS
057600200610      ***  Working DS for Database Error on LF/DPTMV
057700200610     I                                        1  10 WKSES1
057800200610     I                                       11  16 WKTRRF
057900200610     I/COPY WNCPYSRC,SE7560I003
058000200610      *
058100200610     IWWINV       DS
058200200610      ***  Working DS for Database Error on LF/INVTP
058300200610     I                                        1   3 WKNMCY
058400200610     I                                        4   6 WKSITP
058500200610      *
058600200610     IWWPOSE      DS
058700200610      ***  Working DS for Database Error on LF/POSET1
058800200610     I                                        1   3 WKBRCD
058900200610     I                                        4  13 WKSESN
059000200610     I**********                             14  190WKDDPT                                    CSD027
059100200610     I                                       14  19 WKDDPT                                    CSD027
059200200610     I                                       20  240WKALEF
059300200610     I                                       25  26 WKEVTY
059400200610     I                                       27  30 WKPTFR
059500200610     I                                       31  350WKTNLU
059600200610      *
059700200610     IDNART       DS
059800200610      ***  Data structure for "Depot Narrative" ON LF/DPTMV
059900200610     I                                        1  35 WWDNAR
060000200610     I                                        1  35 WWTEXT
060100200610     I                                       18  23 WWCROF
060200200610     I                                       30  31 WWCOAT
060300200610      *
060400200610     IPSDS       SDS
060500200610      ***  Program Status Data Structure
060600200610     I                                      254 263 USER
060700200610      *
060800200610     I            DS
060900200610     I                                        1  140SDATI
061000200610     I                                        1   20SDD
061100200610     I                                        3   40SMM
061200200610     I                                        5   60SCC
061300200610     I                                        7   80SYY
061400200610     I                                        9  140STIME
061500200610     I            DS                                                                          234829
061600200610     I**********                              1   60DPBN                              234829 CSD027A
061700200610     I                                        1   6 DPBN                                     CSD027A
061800200610     I                                        1   6 @DPBN                                     234829
061900200610      *
062000200610     I            DS
062100200610      ***  DATA STRUCTURE FOR NUMERIC FIELDS TO NUMERIC ARRAY MOVES
062200200610      ***                                     1 300 APR
062300200610      ***                                     1 300 NPR
062400200610      *
062500200610     INWRCD     E DSSECOALL5
062600200610      ***  Current master file fields
062700200610      *
062800200610     ISVRCD       DS                            230
062900200610      ***  Stored master file fields
063000200610      *
063100200610      ***  Compile with 2 Levels /COPY
063200200610     I/COPY WNCPYSRC,SE7560I001
063300200610      *
063400200610     I/COPY ZSRSRC,ZNCDZ2
063500200610     I/COPY ZSRSRC,ZYLDZ1
063600200610     I/COPY ZSRSRC,ZHOLI
063700200610     I/COPY WNCPYSRC,SE7560I002
063800200610      *
063900200610     ISDBANK    E DSSDBANKPD
064000200610      ***  Dummy record format for access to Bank Details
064100200610      *
064200200610     ISCSARD    E DSSCSARDPD                                                                  CAS006
064300200610      ** Switchable Feature Details Data Structure                                            CAS006
064400200610      *                                                                                       CAS006
064500200610     ISDSECS    E DSSDSECSPD
064600200610      ***  Dummy record format for access to Securities Clients
064700200610      *
064800200610     ISDMMOD    E DSSDMMODPD
064900200610      ***  Dummy record format for access to Midas Module
065000200610      *
065100200610     ISDCURR    E DSSDCURRPD
065200200610      ***  Dummy record format for access to Currency Details
065300200610      *
065400200610     ISDPLCS    E DSSDPLCSPD
065500200610      ***  Dummy record format for access to PM Special Customer Details
065600200610      *
065700200610     ISDBRCH    E DSSDBRCHPD
065800200610      ***  Dummy record format for access to Branch Details
065900200610      *
066000200610     ISDGELR    E DSSDGELRPD
066100200610     I              QQACCD                          QQACD1                                    CGL029
066200200610      ***  Dummy record format for access to General Ledger Details
066300200610      *
066400200610     ISDSTRD    E DSSDSTRDPD
066500200610      ***  Dummy record format for access to Securities Trading Data
066600200610      *                                                                   CPB001
066700200610     ISDCUST    E DSSDCUSTPD                                              CPB001
066800200610     I              QQDFAC                          #DFAC1                                    CGL029
066900200610      ***  Dummy record format for access to Customer Details.            CPB001
067000200610     I*
067100200610     IDSFDY     E DSDSFDY
067200200610      ***  First DS for access programs, short data structure
067300200610      *
067400200610     IDSSDY     E DSDSSDY
067500200610      ***  Second DS for access programs, long data structure
067600200610      *
067700200610     IDSLDY     E DSDSLDY                                                 CPB001
067800200610      ***  Third DS for access programs, very long data structure         CPB001
067900200610      *                                                                   CPB001
068000200610     IETCPOS    E DSETCPOSND                                                                  234829
068100200610     I              PTFR                            EPTFR                                     234829
068200200610     I              TMST                            ETMST                                     234829
068300200610      ***  Dummy record format for access to Branch Details                                   234829
068400200610     I@TRDDS    E DSTRADSD                                                                    234829
068500200610     I              RECI                            RECIT                                     234829
068600200610     I              CHTP                            CHTPT                                     234829
068700200610     I              TNLU                            TNLUT                                     234829
068800200610     I              LCD                             LCDT                                      234829
068900200610      ** Security Details Data Structure                                                      234829
069000200610     I@SECTY    E DSSECTYD                                                                    234829
069100200610     I              RECI                            RECIA                                     234829
069200200610     I              NMCY                            NMCYA                                     234829
069300200610     I              ZZ005                           ZZ005A                                    234829
069400200610     I              CHTP                            CHTPA                                     234829
069500200610     I              TNLU                            TNLUA                                     234829
069600200610     I              REPI                            REPIA                                     234829
069700200610     I              REPA                            REPAA                                     234829
069800200610     I              LCD                             LCDTA                                     234829
069900200610     I              FRNT                            FRNTA                                     234829
070000200610     I              TMST                            TMSTA                                     234829
070100200610     I              CD01                            CD01A                                     234829
070200200610     I              CD02                            CD02A                                     234829
070300200610     I              CD03                            CD03A                                     234829
070400200610     I              CD04                            CD04A                                     234829
070500200610     I              CD05                            CD05A                                     234829
070600200610     I              CD06                            CD06A                                     234829
070700200610     I              CD07                            CD07A                                     234829
070800200610     I              CD08                            CD08A                                     234829
070900200610     I              CD09                            CD09A                                     234829
071000200610     I              CD10                            CD10A                                     234829
071100200610     I              CD11                            CD11A                                     234829
071200200610     I              CD12                            CD12A                                     234829
071300200610     I              CR01                            CR01A                                     234829
071400200610     I              CR02                            CR02A                                     234829
071500200610     I              CR03                            CR03A                                     234829
071600200610     I              CR04                            CR04A                                     234829
071700200610     I              CR05                            CR05A                                     234829
071800200610     I              CR06                            CR06A                                     234829
071900200610     I              CR07                            CR07A                                     234829
072000200610     I              CR08                            CR08A                                     234829
072100200610     I              CR09                            CR09A                                     234829
072200200610     I              CR10                            CR10A                                     234829
072300200610     I              CR11                            CR11A                                     234829
072400200610     I              CR12                            CR12A                                     234829
072500200610     I              SEZONE                          SEZONA                                    234829
072600200610     I@SEVDP    E DSSEVDPMVPD                                                                 234829
072700200610     I              RECI                            RECIV                                     234829
072800200610     I              ORBR                            ORBRV                                     234829
072900200610     I              TACI                            TACIV                                     234829
073000200610     I              ORED                            OREDV                                     234829
073100200610     I              LCD                             LCDV                                      234829
073200200610     I              CHTP                            CHTPV                                     234829
073300200610     I              TNLU                            TNLUV                                     234829
073400200610     I              SPXR                            SPXRV                                     234829
073500200610     I              SPMD                            SPMDV                                     234829
073600200610     I              PTFR                            PTFRV                                     234829
073700200610     I              COAF                            COAFV                                     234829
073800200610     I              ACIN                            ACINV                                     234829
073900200610     I              REPI                            REPIV                                     234829
074000200610     I              DPAP                            DPAPV                                     234829
074100200610     I              FSPR                            FSPRV                                     234829
074200200610     I              FSPP                            FSPPV                                     234829
074300200610     I              DPBN                            DPBNV                                     234829
074400200610      /COPY ZSRSRC,ZTNLU1Z1
074500200610     ICPYR@#      DS
074600200610      ***  Data structure for compilation  - COPYRIGHT INSERTION
074700200610     I                                        1  80 CPY@
074800200610     I                                        1  20 CPY@##
074900200610      *
075000200610     I              'CORPORATE ACTION nnn-C         DNARR
075100200610     I              'nnn TYPE mm    '
075200200610      *** Posting narrative Array --> GEFEPP/PF
075300200610     I              'SEVSEFSPR3'          C         SEVFSP                                    234829
075400200610     I              'SEETCPUPD'           C         SEETCP                                    234829
075500200610     I              'SEVOPUINT'           C         SEVOPI                                    234829
075600200610     I              'SEETCPRTV'           C         SEETRT                                    234829
075601200616     ISDSTAT    E DSSDSTAT                                                                  AR324886
075602200616      ** SD Data area                                                                       AR324886
075603200616      *                                                                                     AR324886
075604200616     I              PHASE                           PHASEX                                  AR324886
075700200610      *
075800200610     C/EJECT
075900200610      *****************************************************************
076000200610      /EJECT
076100200610      *****************************************************************
076200200610      *                M A I N     P R O C E S S I N G                *
076300200610      *****************************************************************
076400200610      *
076500200610      ***  Access first record (By read) In CO Reference Rtv Idx
076600200610      *
076700200610     C           *LOVAL    SETLLSECORFL2
076800200610     C                     READ SECORFL2                 44
076900200610      *
077000200610      ***  Do while end of file is not reached
077100200610      *
077200200610     C           *IN44     DOWEQ*OFF
077300200610      *
077400200610      ***  If "Security Shortname" is not equal to "Saved Security"
077500200610      ***  Access to Security Details
077600200610      *
077700200610     C           MASESN    IFNE WOSESN
077800200610     C                     MOVELMASESN    WOSESN    P
077900200610     C                     MOVELMASESN    WKSESN    P
078000200610     C                     EXSR #SECTO
078100200610     C                     ENDIF
078200200610      *
078300200610      ***  If Last Change Type is NOT a reversal
078400200610      ***  and Last Change Date is lower than control date
078500200610      *
078600200610     C           MACHTP    IFNE 'R'
078700200610      *
078800200610     C                     MOVELMACORF    KWCORF    P      CA Reference Number
078900200610      *
079000200610      ***  Access LF/SECODRL0 with reference in order to obtain
079100200610      ***  the depots linked to the Corporate Action
079200200610      *
079300200610     C           KWCORF    SETLLSECODRL0
079400200610     C           KWCORF    READESECODRL0                 45
079500200610      *
079600200610     C           *IN45     IFEQ *OFF
079700200610      *
079800200610      ***  Do while end of file is not reached
079900200610      *
080000200610     C           *IN45     DOWEQ*OFF
080100200610      *
080200200610      ***  If Status Corporate Action (MSCOST) is equal to 'S' or 'X'
080300200610      *
080400200610     C           MSCOST    IFEQ 'S'
080500200610     C           MSCOST    OREQ 'X'
080600200610      *
080700200610      ***  Check the processing type
080800200610      *
080900200610     C********             SELEC                                          137881
081000200610      *
081100200610      ***  Processing type is not 'NF' (Non Financial)
081200200610      *
081300200610     C********   MAPTYP    WHNE 'NF'                                      137881
081400200610     C           MAPTYP    IFNE 'NF'                                      137881
081500200610      *
081600200610      ***  Process depot record depending on processing type
081700200610      *
081800200610     C           MATDDT    IFLE WWECD
081900200610     C/COPY WNCPYSRC,SEH00026
082000200610     C                     EXSR #PDPTY
082100200610     C                     ENDIF
082200200610      *                                                                   137881
082300200610     C                     ELSE                                           137881
082400200610     C                     MOVE 'Y'       MSEVNI                          137881
082500200610     C                     ENDIF                                          137881
082600200610      *
082700200610      ***  Processing type is equal to 'NC' (Name Changes)
082800200610      *
082900200610     C********   MAPTYP    WHEQ 'NC'                                      137881
083000200610     C           MAPTYP    IFEQ 'NC'                                      137881
083100200610      *
083200200610      ***  Process Name changes
083300200610      *
083400200610     C           MAALEF    IFLE WWECD
083500200610     C                     EXSR #PDNCH
083600200610     C                     ENDIF
083700200610     C                     ENDIF                                          137881
083800200610     C********             ENDSL                           Check Proc. Typ137881
083900200610      *
084000200610      ***  Update Corporate Actions - References record
084100200610      *
084200200610     C                     UPDATSECODRD0
084300200610     C                     ENDIF                           Status 'S' or 'X'
084400200610      *
084500200610      ***  Read Next Corporate Action Reference
084600200610      *
084700200610     C           KWCORF    READESECODRL0                 45
084800200610     C                     ENDDO                           *IN45=*OFF
084900200610      *
085000200610     C                     ELSE                            *IN45=*ON
085100200610      *
085200200610      ***  Processing type is 'NC' and status is 'X' (authorised)
085300200610      *
085400200610     C           MAPTYP    IFEQ 'NC'
085500200610     C           MASTAT    ANDEQ'X'
085600200610      *
085700200610      ***  Process Name changes
085800200610      *
085900200610     C           MAALEF    IFLE WWECD
086000200610     C                     EXSR #PDNCH
086100200610      *
086200200610      ***  Update PF/SECORFPD Corporate Action Reference
086300200610      *
086400200610     C                     MOVE 'C'       MASTAT
086500200610     C                     UPDATSECORFD0
086600200610     C                     ENDIF
086700200610     C                     ENDIF
086800200610      *
086900200610      ***  Status is 'X' (authorised)                                     136931
087000200610      ***  and no record found on LF/SECODRL0                             136931
087100200610      *                                                                   136931
087200200610     C           MASTAT    IFEQ 'X'                                       136931
087300200610     C           MAPTYP    ANDEQ'CC'                                      136931
087400200610      *                                                                   136931
087500200610      ***  Update PF/SECORFPD Corporate Action Reference                  136931
087600200610      *                                                                   136931
087700200610     C           MAALEF    IFLE WWECD                                     136931
087800200610     C           MATDDT    ANDLEWWECD                                     136931
087900200610     C           MAEVDT    ANDLEWWECD                                     136931
088000200610     C           MACOPD    ANDLEZZDNWD                                    136931
088100200610     C                     MOVE 'C'       MASTAT                          136931
088200200610     C                     UPDATSECORFD0                                  136931
088300200610     C                     ENDIF                                          136931
088400200610     C                     ENDIF                                          136931
088500200610     C                     ENDIF                           *IN45=*ON
088600200610     C                     ENDIF                           Not Reversal
088700200610      *
088800200610      ***  If Last change type = 'R' and last change date = run date
088900200610      ***  and processing type is not 'NC'
089000200610      *
089100200610     C           MACHTP    IFEQ 'R'
089200200610     C           MALCD     ANDEQBJRDNB
089300200610     C           MAPTYP    ANDNE'NC'
089400200610      *
089500200610     C                     MOVELMACORF    KWCORF    P      CA Reference Number
089600200610      *
089700200610     C           MASESN    CHAINSECTY                89
089800200610      *
089900200610     C           *IN89     IFEQ *ON
090000200610     C           RECI      OREQ '*'
090100200610     C           *LOCK     IN   LDA
090200200610     C                     Z-ADD32        DBASE            ***************
090300200610     C                     MOVEL*BLANKS   DBFILE           * DB ERROR 32 *
090400200610     C                     MOVE 'SECTY   'DBFILE           ***************
090500200610     C                     MOVELMASESN    DBKEY
090600200610     C                     MOVEL'SE7560'  DBPGM     P
090700200610     C                     OUT  LDA
090800200610     C                     EXSR *PSSR
090900200610     C                     ENDIF
091000200610      *
091100200610      ***  Reset to zeros/blanks 'Sec. Red. Replaced by Shortname' & 'Sec. Red. Bulk Reference'
091200200610     C                     MOVE *BLANKS   SRRB
091300200610     C                     Z-ADD*ZEROS    SRBK
091400200610     C                     UPDATSECTYDF
091500200610      *
091600200610      ***  Access LF/SECODRL0 with reference in order to obtain
091700200610      ***  the depots linked to the Corporate Action
091800200610      *
091900200610     C           KWCORF    SETLLSECODRL0
092000200610     C           KWCORF    READESECODRL0                 45
092100200610      *
092200200610      ***  Do while end of file is not reached
092300200610      *
092400200610     C           *IN45     DOWEQ*OFF
092500200610      *
092600200610      ***  If Status Corporate Action (MSCOST) is equal to 'R'
092700200610      *
092800200610     C           MSCOST    IFEQ 'R'
092900200610     C                     EXSR #POSRV
093000200610     C                     EXSR #TDRVR
093100200610     C                     ENDIF                           status
093200200610      *
093300200610      ***  Read next record
093400200610      *
093500200610     C           KWCORF    READESECODRL0                 45
093600200610     C                     ENDDO                           *IN45=*OFF
093700200610     C                     ENDIF                           Reversal
093800200610      *
093900200610      ***  Access next record in CA References file
094000200610      *
094100200610     C                     READ SECORFL2                 44
094200200610      *
094300200610     C                     ENDDO                           *IN44=*OFF
094400200610     C/COPY WNCPYSRC,SE7560C011
094500200610      *
094600200610      ***  Termination processing
094700200610      *
094800200610     C                     EXSR #TERPR
094900200610      *
095000200610      *****************************************************************
095100200610     C/COPY WNCPYSRC,SE7560C012
095200200610      /EJECT
095300200610      *****************************************************************
095400200610      *  #PDPTY -  Process Depot records for processing type          *
095500200610      *  ------    Other than 'NF'                                    *
095600200610      *  Called by : Main processing                                  *
095700200610      *  Calls     : #POSET                                           *
095800200610      *****************************************************************
095900200610      *
096000200610     C           #PDPTY    BEGSR
096100200610      *
096200200610      ***  If "Trades/Depot Movements Indicator" is NOT 'Y'
096300200610      *
096400200610     C           MSEVNI    IFNE 'Y'
096500200610      *
096600200610      ***  Reset array SECUR (20 * 10A) to blanks
096700200610      ***  Reset array MPRICE (20 * 16A) to blanks
096800200610      *
096900200610     C                     MOVEA*BLANKS   SECUR
097000200610     C                     MOVEA*BLANKS   MPRICE
097100200610     C                     MOVE 'Y'       WFIRST  1
097200200610      *
097300200610      ***  Access to Stock Allocation with same Corporate Action Reference,
097400200610      ***  same branch, same depot
097500200610      ***  (LF only select records with actual stock allocation non zero)
097600200610     C                     MOVEL*BLANKS   WXBOOK  2                       186486
097700200610      *
097800200610     C                     MOVE MSCORF    WKCORF    P      CA Reference
097900200610     C                     MOVE MSBRCD    WKBRCD    P      Branch
098000200610     C**********           Z-ADDMSDDPT    WKDDPT           Depot                              CSD027
098100200610     C                     MOVE MSDDPT    WKDDPT           Depot                              CSD027
098200200610      *
098300200610     C           KWCOAL    SETLLSECOALL5
098400200610     C           KWCOAL    READESECOALL5                 46
098500200610      *
098600200610     C           *IN46     DOWEQ*OFF
098700200610      *
098800200610     C                     MOVE *BLANKS   WWTRR1  6
098900200610     C                     MOVE *BLANKS   WWTRR2  6
099000200610     C                     MOVE *BLANKS   WWTRR3  6
099100200610      *
099200200610      ***  Access to logical file depends on processing type
099300200610      *
099400200610     C                     EXSR #SELLF
099500200610      *
099600200610      ***  Retrieve the current average price
099700200610      *
099800200610     C           MAPTYP    IFEQ 'FR'
099900200610     C           MEADRE    ANDEQ'R'
100000200610     C           MAPTYP    OREQ 'CR'
100100200610     C           MAPTYP    OREQ 'CC'                                      CEU017
100200200610     C           MAPTYP    OREQ 'CE'
100300200610     C           MAPTYP    OREQ 'OF'
100400200610     C           MIOFTY    ANDEQ'E'
100500200610     C           MAPTYP    OREQ 'EX'
100600200610     C           MAPTYP    OREQ 'RG'
100700200610     C           MFAVOP    ANDEQ'M'
100800200610     C           MAPTYP    OREQ 'RG'
100900200610     C           MFAVOP    ANDEQ'C'
101000200610     C           MAPTYP    OREQ 'RG'                                      161746
101100200610     C           MFAVOP    ANDEQ'I'                                       161746
101200200610     C           MAPTYP    OREQ 'NC'
101300200610      *
101400200610     C                     EXSR #CUAVP
101500200610      *
101600200610      ***  Retrieve the current average price
101700200610      *
101800200610     C           MAPTYP    IFEQ 'CR'
101900200610     C           MAPTYP    OREQ 'CE'
102000200610     C           MAPTYP    OREQ 'OF'
102100200610     C           MIOFTY    ANDEQ'E'
102200200610     C           MAPTYP    OREQ 'RG'
102300200610     C           MFAVOP    ANDEQ'M'
102400200610     C           MAPTYP    OREQ 'RG'
102500200610     C           MFAVOP    ANDEQ'C'
102600200610     C           MAPTYP    OREQ 'RG'                                      161746
102700200610     C           MFAVOP    ANDEQ'I'                                       161746
102800200610     C*****      MAPTYP    OREQ 'NC'                                      137881
102900200610      *
103000200610      ***  If processing type is 'CR' Move Security file into workfield
103100200610      ***  and Market price file into workfield
103200200610      *
103300200610     C           MAPTYP    IFEQ 'CR'
103400200610     C           WFIRST    ANDEQ'Y'
103500200610     C                     MOVE 'N'       WFIRST
103600200610     C                     MOVEAMHSECA    SECUR
103700200610     C                     MOVEAMHMKTP    MPRICE
103800200610      *
103900200610      ***  Convert the market price from file to numeric array
104000200610      *
104100200610     C                     MOVEA*ZERO     NPR
104200200610     C                     Z-ADD1         X       20
104300200610      *
104400200610     C           X         DOWLT21
104500200610     C           MPRICE,X  IFNE *BLANKS
104600200610     C                     MOVE MPRICE,X  NPR,X                           137881
104700200610     C*****                MOVE MPRICE,X  ZFIELD                          137881
104800200610     C*****                Z-ADD8         ZADEC                           137881
104900200610     C*****      15        SUB  8         ZADIG                           137881
105000200610     C*****                MOVE *OFF      *IN99                           137881
105100200610     C*****                EXSR ZALIGN                                    137881
105200200610      *****                                                               137881
105300200610     C*****      *IN99     IFEQ *ON                                       137881
105400200610     C*****                Z-ADD*ZEROS    NPR,X                           137881
105500200610     C*****                ELSE                                           137881
105600200610     C*****                MOVE ZFIELD    NPR,X                           137881
105700200610     C*****                ENDIF                                          137881
105800200610     C*****                ADD  1         X                               136931
105900200610     C                     ENDIF
106000200610     C                     ADD  1         X                               136931
106100200610     C                     ENDDO
106200200610     C                     ENDIF
106300200610      *
106400200610     C                     EXSR #CAAVP
106500200610     C                     ENDIF
106600200610     C                     ENDIF
106700200610      *
106800200610      ***  Generate Trades/Depot Movements depending on Processing Type
106900200610      *
107000200610     C                     SELEC
107100200610      *
107200200610      ***  Processing type 'DV'
107300200610      *
107400200610     C           MAPTYP    WHEQ 'DV'
107500200610     C                     EXSR #PRDV
107600200610      *
107700200610      ***  Processing type 'FR'
107800200610      *
107900200610     C           MAPTYP    WHEQ 'FR'
108000200610     C                     EXSR #PRFR
108100200610      *
108200200610      ***  Processing type 'CR'
108300200610      *
108400200610     C           MAPTYP    WHEQ 'CR'
108500200610     C                     EXSR #PRCR
108600200610      *                                                                   CEU017
108700200610      ***  Processing type 'CC'                                           CEU017
108800200610      *                                                                   CEU017
108900200610     C           MAPTYP    WHEQ 'CC'                                      CEU017
109000200610     C                     EXSR #PRCC                                     CEU017
109100200610      *
109200200610      ***  Processing type 'CE'
109300200610      *
109400200610     C           MAPTYP    WHEQ 'CE'
109500200610     C                     EXSR #PRCE
109600200610      *
109700200610      ***  Processing type 'OF'
109800200610      *
109900200610     C           MAPTYP    WHEQ 'OF'
110000200610     C                     EXSR #PROF
110100200610      *
110200200610      ***  Processing type 'EX'
110300200610      *
110400200610     C           MAPTYP    WHEQ 'EX'
110500200610     C                     EXSR #PREX
110600200610      *
110700200610      ***  Processing type 'RG'
110800200610      *
110900200610     C           MAPTYP    WHEQ 'RG'
111000200610     C                     EXSR #PRRG
111100200610      *
111200200610      ***  Processing type 'NC'
111300200610      *
111400200610     C           MAPTYP    WHEQ 'NC'
111500200610     C                     EXSR #PRNC
111600200610     C                     ENDSL                           Check proc. type
111700200610      *
111800200610      ***  Update "Transaction Reference" from PF/SECOALPD
111900200610      *
112000200610     C                     MOVE WWTRR1    MCTRRF
112100200610     C                     MOVE WWTRR2    MCTRR2
112200200610     C                     MOVE WWTRR3    MCTRR3
112300200610      *
112400200610      ***  Update Stock Allocation
112500200610      *
112600200610     C                     UPDATSECOALR5
112700200610      *
112800200610      ***  Access next Stock Allocation
112900200610      *
113000200610     C           KWCOAL    READESECOALL5                 46
113100200610     C                     ENDDO                           *IN46=*OFF
113200200610      *
113300200610      ***  Setup Trade/Depot Movement indicator to 'Y'
113400200610      *
113500200610     C                     MOVE 'Y'       MSEVNI
113600200610     C                     ENDIF                           MSEVNI<>'Y'
113700200610      *
113800200610     C                     ENDSR
113900200610      *
114000200610      *****************************************************************
114100200610      /EJECT
114200200610      *****************************************************************
114300200610      *  #TDRVR -  Pocess Trades and Depot Movements Reversal         *
114400200610      *  ------                                                       *
114500200610      *  Called by : Main processing                                  *
114600200610      ***Calls*****:*#ADPMV*#WDPMV*#UTRAD******************************                       216944
114700200610      *  Calls     : #ADPMV #WDPMV #UDPMV #UTRAD                      *                       216944
114800200610      *****************************************************************
114900200610      *
115000200610     C           #TDRVR    BEGSR
115100200610      *
115200200610      ***  If "Trades/Depot Movement indicator" is 'Y'
115300200610      *
115400200610     C           MSEVNI    IFEQ 'Y'
115500200610      *
115600200610      ***  Access to Allocation Retrieve idx with same Coporate Action Reference
115700200610      *
115800200610     C                     MOVE MSCORF    WKCORF    P      CA Reference
115900200610     C                     MOVE MSBRCD    WWBRCD    P      Branch
116000200610     C**********           Z-ADDMSDDPT    WWDDPT           Depot                              CSD027
116100200610     C                     MOVE MSDDPT    WWDDPT           Depot                              CSD027
116200200610      *
116300200610     C           WKCORF    SETLLSECOALL0
116400200610     C           WKCORF    READESECOALL0                 46
116500200610      *
116600200610     C           *IN46     DOWEQ*OFF
116700200610      *
116800200610     C           MCBRCD    IFEQ WWBRCD
116900200610     C           MCDDPT    ANDEQWWDDPT
117000200610      *
117100200610      ***  If "Transaction Reference MCTRRF" is not equal to zeros
117200200610      *
117300200610     C           MCTRRF    IFNE *BLANKS
117400200610     C           MCTRRF    ANDNE'000000'
117500200610     C           MCRVRF    ANDEQ*BLANKS
117600200610      *
117700200610      ***  Check "Customer/Book indicator"
117800200610      *
117900200610     C                     SELEC
118000200610     C           MCCOTP    WHEQ 'C'                        Customer
118100200610      *
118200200610      ***  Access Depot Movements with Transaction Reference
118300200610      *
118400200610     C                     MOVELMCSESN    WKSESN    P      Security
118500200610     C                     MOVE MCTRRF    WKTRRF           Transaction Reference
118600200610      *
118700200610     C                     EXSR #ADPMV
118800200610      *                                                                                       216944
118900200610     C           CSE018    IFEQ 'N'                                                           216944
119000200610      *
119100200610      ***  Retrieve a new Depot Reference
119200200610      *
119300200610     C                     MOVE WWNTR2    WKTRRF  6        Reference
119400200610      *
119500200610     C                     EXSR #DPTNB
119600200610      *
119700200610     C                     MOVE 'R'       WALLOC           Reversal
119800200610     C                     MOVE WWNTR2    DPRN             Reference
119900200610     C                     ADD  1         WWNTR2
120000200610      *
120100200610     C           WDPMV     IFEQ 'WI'
120200200610     C                     MOVE 'WO'      DPMV
120300200610     C**********           Z-ADDWDPID     DPOD                                                CSD027
120400200610     C                     MOVE WDPID     DPOD                                                CSD027
120500200610     C                     Z-ADDWDPMD     DPDO
120600200610     C**********           Z-ADD*ZERO     DPID                                                CSD027
120700200610     C                     MOVE *BLANKS   DPID                                                CSD027
120800200610     C                     Z-ADD*ZERO     DPMD
120900200610     C                     ELSE
121000200610     C                     MOVE 'WI'      DPMV
121100200610     C**********           Z-ADDWDPOD     DPID                                                CSD027
121200200610     C                     MOVE WDPOD     DPID                                                CSD027
121300200610     C                     Z-ADDWDPDO     DPMD
121400200610     C**********           Z-ADD*ZERO     DPOD                                                CSD027
121500200610     C                     MOVE *BLANKS   DPOD                                                CSD027
121600200610     C                     Z-ADD*ZERO     DPDO
121700200610     C                     ENDIF
121800200610     C                     ENDIF                                                              216944
121900200610      *
122000200610      *****Write*Depot*Movement*record*********************************                       216944
122100200610      ** Write or Update Depot Movement record                                                216944
122200200610      *
122300200610     C           CSE018    IFEQ 'Y'                                                           216944
122400200610     C                     EXSR #UDPMV                                                        216944
122500200610     C                     ELSE                                                               216944
122600200610     C                     EXSR #WDPMV
122700200610     C                     ENDIF                                                              216944
122800200610      *
122900200610     C                     MOVE DPRN      MCRVRF           Reversal reference
123000200610      *
123100200610     C           MCCOTP    WHEQ 'B'                        Book
123200200610      *
123300200610      ***  Access Trades file and update it
123400200610      *
123500200610     C                     MOVE MCTRRF    WKTRRF           Reference
123600200610     C                     EXSR #UTRAD
123700200610     C                     ENDSL                           Check Customer/Book Ind
123800200610      *
123900200610     C                     ENDIF                           MCTRRF<>0
124000200610      *
124100200610      ***  If "Transaction Reference MCTRR2" is not equal to zeros
124200200610      *
124300200610     C           MCTRR2    IFNE *BLANKS
124400200610     C           MCTRR2    ANDNE'000000'
124500200610     C           MCRVR2    ANDEQ*BLANKS
124600200610      *
124700200610      ***  Check "Customer/Book indicator"
124800200610      *
124900200610     C                     SELEC
125000200610     C           MCCOTP    WHEQ 'C'                        Customer
125100200610      *
125200200610      ***  Access Depot Movements with Transaction Reference
125300200610      *
125400200610     C                     MOVELMCSESN    WKSESN    P      Security
125500200610     C                     MOVE MCTRR2    WKTRRF           Reference
125600200610      *
125700200610     C                     EXSR #ADPMV
125800200610      *
125900200610     C           CSE018    IFEQ 'N'                                                           216944
126000200610      ***  Retrieve a new Depot Reference
126100200610      *
126200200610     C                     MOVE WWNTR2    WKTRRF  6        Reference
126300200610      *
126400200610     C                     EXSR #DPTNB
126500200610      *
126600200610     C                     MOVE 'R'       WALLOC           Reversal
126700200610     C                     MOVE WWNTR2    DPRN             Reference
126800200610     C                     ADD  1         WWNTR2
126900200610      *
127000200610     C           WDPMV     IFEQ 'WI'
127100200610     C                     MOVE 'WO'      DPMV
127200200610     C**********           Z-ADDWDPID     DPOD                                                CSD027
127300200610     C                     MOVE WDPID     DPOD                                                CSD027
127400200610     C                     Z-ADDWDPMD     DPDO
127500200610     C**********           Z-ADD*ZERO     DPID                                                CSD027
127600200610     C                     MOVE *BLANKS   DPID                                                CSD027
127700200610     C                     Z-ADD*ZERO     DPMD
127800200610     C                     ELSE
127900200610     C                     MOVE 'WI'      DPMV
128000200610     C**********           Z-ADDWDPOD     DPID                                                CSD027
128100200610     C                     MOVE WDPOD     DPID                                                CSD027
128200200610     C                     Z-ADDWDPDO     DPMD
128300200610     C**********           Z-ADD*ZERO     DPOD                                                CSD027
128400200610     C                     MOVE *BLANKS   DPOD                                                CSD027
128500200610     C                     Z-ADD*ZERO     DPDO
128600200610     C                     ENDIF
128700200610     C                     ENDIF                                                              216944
128800200610      *
128900200610      *****Write*Depot*Movement*record*********************************                       216944
129000200610      ** Write or Update Depot Movement record                                                216944
129100200610      *
129200200610     C           CSE018    IFEQ 'Y'                                                           216944
129300200610     C                     EXSR #UDPMV                                                        216944
129400200610     C                     ELSE                                                               216944
129500200610     C                     EXSR #WDPMV
129600200610     C                     ENDIF                                                              216944
129700200610      *
129800200610     C                     MOVE DPRN      MCRVR2           Reversal reference
129900200610      *
130000200610     C           MCCOTP    WHEQ 'B'                        Book
130100200610      *
130200200610      ***  Access Trades file and update it
130300200610      *
130400200610     C                     MOVE MCTRR2    WKTRRF           Transaction Reference
130500200610     C                     EXSR #UTRAD
130600200610     C                     ENDSL                           Check Customer/Book Ind
130700200610      *
130800200610     C                     ENDIF                           MCTRR2<>0
130900200610      *
131000200610      ***  If "Transaction Reference MCTRR3" is not equal to zeros
131100200610      *
131200200610     C           MCTRR3    IFNE *BLANKS
131300200610     C           MCTRR3    ANDNE'000000'
131400200610     C           MCRVR3    ANDEQ*BLANKS
131500200610      *
131600200610      ***  Check "Customer/Book indicator"
131700200610      *
131800200610     C                     SELEC
131900200610     C           MCCOTP    WHEQ 'C'                        Customer
132000200610      *
132100200610      ***  Access Depot Movements with Transaction Reference
132200200610      *
132300200610     C                     MOVELMCSESN    WKSESN    P      Security
132400200610     C                     MOVE MCTRR3    WKTRRF           Reference
132500200610      *
132600200610     C                     EXSR #ADPMV
132700200610      *                                                                                       216944
132800200610     C           CSE018    IFEQ 'N'                                                           216944
132900200610      *
133000200610      ***  Retrieve a new Depot Reference
133100200610      *
133200200610     C                     MOVE WWNTR2    WKTRRF  6        Reference
133300200610      *
133400200610     C                     EXSR #DPTNB
133500200610      *
133600200610     C                     MOVE 'R'       WALLOC           Reversal
133700200610     C                     MOVE WWNTR2    DPRN             Reference
133800200610     C                     ADD  1         WWNTR2
133900200610      *
134000200610     C           WDPMV     IFEQ 'WI'
134100200610     C                     MOVE 'WO'      DPMV
134200200610     C**********           Z-ADDWDPID     DPOD                                                CSD027
134300200610     C                     MOVE WDPID     DPOD                                                CSD027
134400200610     C                     Z-ADDWDPMD     DPDO
134500200610     C**********           Z-ADD*ZERO     DPID                                                CSD027
134600200610     C                     MOVE *BLANKS   DPID                                                CSD027
134700200610     C                     Z-ADD*ZERO     DPMD
134800200610     C                     ELSE
134900200610     C                     MOVE 'WI'      DPMV
135000200610     C**********           Z-ADDWDPOD     DPID                                                CSD027
135100200610     C                     MOVE WDPOD     DPID                                                CSD027
135200200610     C                     Z-ADDWDPDO     DPMD
135300200610     C**********           Z-ADD*ZERO     DPOD                                                CSD027
135400200610     C                     MOVE *BLANKS   DPOD                                                CSD027
135500200610     C                     Z-ADD*ZERO     DPDO
135600200610     C                     ENDIF
135700200610     C                     ENDIF                                                              216944
135800200610      *
135900200610      *****Write*Depot*Movement*record*********************************                       216944
136000200610      ** Write or Update Depot Movement record                                                216944
136100200610      *
136200200610     C           CSE018    IFEQ 'Y'                                                           216944
136300200610     C                     EXSR #UDPMV                                                        216944
136400200610     C                     ELSE                                                               216944
136500200610     C                     EXSR #WDPMV
136600200610     C                     ENDIF                                                              216944
136700200610      *
136800200610     C                     MOVE DPRN      MCRVR3           Reversal reference
136900200610      *
137000200610     C           MCCOTP    WHEQ 'B'                        Book
137100200610      *
137200200610      ***  Access Trades file and update it
137300200610      *
137400200610     C                     MOVE MCTRR3    WKTRRF           Transaction Reference
137500200610     C                     EXSR #UTRAD
137600200610     C                     ENDSL                           Check Customer/Book Ind
137700200610      *
137800200610     C                     ENDIF                           MCTRR3<>0
137900200610      *
138000200610      ***  Update stock allocation
138100200610      ***  Access next Stock Allocation
138200200610      *
138300200610     C                     UPDATSECOALR0
138400200610     C                     ENDIF
138500200610      *
138600200610     C           WKCORF    READESECOALL0                 46
138700200610     C                     ENDDO                           *IN46=*OFF
138800200610      *
138900200610      ***  Setup Corporat Action Status to 'R'
139000200610      *
139100200610     C                     ENDIF                           MSEVNI='Y'
139200200610      *
139300200610     C                     ENDSR
139400200610      *
139500200610      *****************************************************************
139600200610      /EJECT
139700200610      *****************************************************************
139800200610      *  #POSRV -  Position Settlement Reversal                       *
139900200610      *  ------                                                       *
140000200610      *  Called by : Main processing                                  *
140100200610      *  Calls     : #POSET                                           *
140200200610      *****************************************************************
140300200610      *
140400200610     C           #POSRV    BEGSR
140500200610      *
140600200610      ***  If "Position Settlement indicator" is 'Y'
140700200610      *
140800200610     C           MSPOSI    IFEQ 'Y'
140900200610      *
141000200610      ********************************
141100200610      ***  Process Depot Reversal  ***
141200200610      ********************************
141300200610      *
141400200610      ***  Access to Depot Retrieve idx with same Coporate Action Reference,
141500200610      ***  same branch and same depot
141600200610      *
141700200610     C                     MOVE MSCORF    WSCORF    P      CA Reference
141800200610     C                     MOVE MSBRCD    WSBRCD    P      Branch
141900200610     C**********           Z-ADDMSDDPT    WSDDPT           Depot                              CSD027
142000200610     C                     MOVE MSDDPT    WSDDPT           Depot                              CSD027
142100200610      *
142200200610     C           WSCORF    SETLLSECODPL0
142300200610     C           WSCORF    READESECODPL0                 46
142400200610      *
142500200610     C           *IN46     DOWEQ*OFF
142600200610      *
142700200610     C           MBBRCD    IFEQ WSBRCD
142800200610     C           MBDDPT    ANDEQWSDDPT
142900200610      *
143000200610      ***  If "Position Settlement TNL1" is not equal to zeros
143100200610      *
143200200610     C           MBTNL1    IFNE *ZEROS
143300200610      *
143400200610      ***  Access to Position Settlement file to retrieve current Position Settlement
143500200610      ***  and update it to deleted or matured depending on record id
143600200610      *
143700200610     C                     MOVELMBBRCD    WKBRCD    P      Branch
143800200610     C                     MOVELMASESN    WKSESN    P      Security
143900200610     C**********           Z-ADDMBDDPT    WKDDPT           Depot/Customer                     CSD027
144000200610     C                     MOVE MBDDPT    WKDDPT           Depot/Customer                     CSD027
144100200610     C                     Z-ADDMAALEF    WKALEF           Allocation Effective Date
144200200610     C                     MOVE MACOAT    WKEVTY           Event Type
144300200610     C                     MOVE *BLANKS   WKPTFR           Portfolio
144400200610     C                     Z-ADDMBTNL1    WKTNLU           Position Settlement
144500200610     C                     EXSR #POSET
144600200610     C                     ENDIF                           MBTNL1<>0
144700200610     C                     ENDIF
144800200610      *
144900200610      ***  Access next Stock Allocation
145000200610      *
145100200610     C           WSCORF    READESECODPL0                 46
145200200610     C                     ENDDO                           *IN46=*OFF
145300200610      *
145400200610      ***********************************
145500200610      ***  Process Customer Reversal  ***
145600200610      ***********************************
145700200610      *
145800200610      ***  Access to Allocation Retrieve idx with same Coporate Action Reference
145900200610      *
146000200610     C                     MOVE MSCORF    WKCORF    P      CA Reference
146100200610     C                     MOVE MSBRCD    WWBRCD    P      Branch
146200200610     C**********           Z-ADDMSDDPT    WWDDPT           Depot                              CSD027
146300200610     C                     MOVE MSDDPT    WWDDPT           Depot                              CSD027
146400200610      *
146500200610     C           WKCORF    SETLLSECOALL0
146600200610     C           WKCORF    READESECOALL0                 46
146700200610      *
146800200610     C           *IN46     DOWEQ*OFF
146900200610      *
147000200610     C           MCBRCD    IFEQ WWBRCD
147100200610     C           MCDDPT    ANDEQWWDDPT
147200200610      *
147300200610      ***  If "Position Settlement TNL1" is not equal to zeros
147400200610      *
147500200610     C           MCTNL1    IFNE *ZEROS
147600200610      *
147700200610      ***  Access to Position Settlement file to retrieve current Position Settlement
147800200610      ***  and update it to deleted or matured depending on record id
147900200610      *
148000200610     C                     MOVELMCBRCD    WKBRCD    P      Branch
148100200610     C                     MOVELMASESN    WKSESN    P      Security
148200200610     C**********           Z-ADDMCCNUM    WKDDPT           Depot/Customer                     CSD027
148300200610     C                     MOVE MCCNUM    WKDDPT           Depot/Customer                     CSD027
148400200610     C                     Z-ADDMAALEF    WKALEF           Allocation Effective Date
148500200610     C                     MOVE MACOAT    WKEVTY           Event Type
148600200610     C                     MOVE MCPTFR    WKPTFR           Portfolio
148700200610     C                     Z-ADDMCTNL1    WKTNLU           Position Settlement
148800200610     C                     EXSR #POSET
148900200610     C                     ENDIF                           MCTNL1<>0
149000200610     C                     ENDIF
149100200610      *
149200200610      ***  Read Next record
149300200610      *
149400200610     C           WKCORF    READESECOALL0                 46
149500200610     C                     ENDDO                           *IN46=*OFF
149600200610     C                     ENDIF                           MSPOSI='Y'
149700200610      *
149800200610     C                     ENDSR
149900200610      *
150000200610      *****************************************************************
150100200610      /EJECT
150200200610      *****************************************************************
150300200610      *  #SELLF -  Select Logical file from the processing type       *
150400200610      *  ------                                                       *
150500200610      *  Called by : #PDPTY                                           *
150600200610      *  Calls     : *PSSR                                            *
150700200610      *****************************************************************
150800200610      *
150900200610     C           #SELLF    BEGSR
151000200610      *
151100200610     C                     MOVE MCCORF    WKCOR2
151200200610     C                     MOVE MCOPTN    WKOPT2
151300200610      *
151400200610     C                     SELEC
151500200610      *
151600200610      ***  Processing type 'DV'
151700200610      ***  Access to CO Dividends Events file
151800200610      *
151900200610     C           MAPTYP    WHEQ 'DV'
152000200610     C           KWCOOP    CHAINSECODVL0             47
152100200610     C                     MOVE MDRECI    WWRECI  1
152200200610     C                     MOVEL'SECODVL0'WWFILE 10
152300200610      *
152400200610      ***  Processing type 'FR'
152500200610      ***  Access to CO Free Allocations
152600200610      *
152700200610     C           MAPTYP    WHEQ 'FR'
152800200610     C           KWCOOP    CHAINSECOFRL0             47
152900200610     C                     MOVE MERECI    WWRECI  1
153000200610     C                     MOVEL'SECOFRL0'WWFILE 10
153100200610      *
153200200610      ***  Processing type 'RG'
153300200610      ***  Access to CO
153400200610      *
153500200610     C           MAPTYP    WHEQ 'RG'
153600200610     C           KWCOOP    CHAINSECORGL0             47
153700200610     C                     MOVE MFRECI    WWRECI  1
153800200610     C                     MOVEL'SECORGL0'WWFILE 10
153900200610      *
154000200610      ***  Processing type 'CR'
154100200610      ***  Access to CO
154200200610      *
154300200610     C           MAPTYP    WHEQ 'CR'
154400200610     C           KWCOOP    CHAINSECOCRL0             47
154500200610     C                     MOVE MHRECI    WWRECI  1
154600200610     C                     MOVEL'SECOCRL0'WWFILE 10
154700200610      *
154800200610      ***  Processing type 'OF'
154900200610      ***  Access to CO
155000200610      *
155100200610     C           MAPTYP    WHEQ 'OF'
155200200610     C           KWCOOP    CHAINSECOOFL0             47
155300200610     C                     MOVE MIRECI    WWRECI  1
155400200610     C                     MOVEL'SECOOFL0'WWFILE 10
155500200610      *
155600200610      ***  Processing type 'EX'
155700200610      ***  Access to CO
155800200610      *
155900200610     C           MAPTYP    WHEQ 'EX'
156000200610     C           KWCOOP    CHAINSECOEXL0             47
156100200610     C                     MOVE MJRECI    WWRECI  1
156200200610     C                     MOVEL'SECOEXL0'WWFILE 10
156300200610      *
156400200610      ***  Processing type 'NC'
156500200610      ***  Access to CO
156600200610      *
156700200610     C           MAPTYP    WHEQ 'NC'
156800200610     C           WKCOR2    CHAINSECONCL0             47
156900200610     C                     MOVE MLRECI    WWRECI  1
157000200610     C                     MOVEL'SECONCL0'WWFILE 10
157100200610      *                                                                   CEU017
157200200610      ***  Processing type 'CC'                                           CEU017
157300200610      ***  Access to CO Currency Change file                              CEU017
157400200610      *                                                                   CEU017
157500200610     C           MAPTYP    WHEQ 'CC'                                      CEU017
157600200610     C           WKCOR2    CHAINSECOCCL0             47                   CEU017
157700200610     C                     MOVE NARECI    WWRECI  1                       CEU017
157800200610     C                     MOVEL'SECOCCL0'WWFILE 10                       CEU017
157900200610     C                     ENDSL
158000200610      *
158100200610     C           *IN47     IFEQ *ON
158200200610     C           WWRECI    OREQ '*'
158300200610     C           *LOCK     IN   LDA
158400200610     C                     Z-ADD1         DBASE            ***************
158500200610     C                     MOVEL*BLANKS   DBFILE           * DB ERROR 01 *
158600200610     C                     MOVELWWFILE    DBFILE           ***************
158700200610     C           MAPTYP    IFNE 'NC'
158800200610     C           MAPTYP    ANDNE'CC'                                      CEU017
158900200610     C                     MOVELWWCOOP    DBKEY     P
159000200610     C                     ELSE
159100200610     C                     MOVELWKCOR2    DBKEY     P
159200200610     C                     ENDIF
159300200610     C                     MOVEL'SE7560'  DBPGM     P
159400200610     C                     OUT  LDA
159500200610     C                     EXSR *PSSR
159600200610     C                     ENDIF
159700200610      *
159800200610     C                     ENDSR
159900200610      *
160000200610      *****************************************************************
160100200610      /EJECT
160200200610      *****************************************************************
160300200610      *  #CUAVP -  Retrieve Current Average Price                     *
160400200610      *  ------                                                       *
160500200610      *  Called by : #PDPTY                                           *
160600200610      *  Calls     : Nothing                                          *
160700200610      *****************************************************************
160800200610      *
160900200610     C           #CUAVP    BEGSR
161000200610      *
161100200610     C                     MOVE 'N'       WNOPOS  1
161200200610      *
161300200610      ***  Check Cust/Book indicator
161400200610      *
161500200610     C                     SELEC
161600200610      *
161700200610      ***  If Cust/Book indicator is 'C' for customer
161800200610      *
161900200610     C           MCCOTP    WHEQ 'C'
162000200610      *
162100200610      ***  Retrieve the customer position record on LF/CPOSC
162200200610      *
162300200610     C                     MOVE MCBRCD    WCBRCD
162400200610     C                     MOVE MCCNUM    WCCNUM
162500200610     C                     MOVE MASESN    WCSESN
162600200610      *
162700200610     C           KWCOSC    CHAINCPOSC                48
162800200610      *
162900200610     C*****      *IN48     IFEQ *ON                                       136931
163000200610     C*****      MCCNUM    ANDNEWWERCU                                    136931
163100200610     C*****      RECI      OREQ '*'                                       136931
163200200610     C*****      MCCNUM    ANDNEWWERCU                                    136931
163300200610     C*****      *LOCK     IN   LDA                                       136931
163400200610     C*****                Z-ADD2         DBASE            ***************136931
163500200610     C*****                MOVEL*BLANKS   DBFILE           * DB ERROR 02 *136931
163600200610     C*****                MOVEL'CPOSC'   DBFILE           ***************136931
163700200610     C*****                MOVELWWCOSC    DBKEY     P                     136931
163800200610     C*****                MOVEL'SE7560'  DBPGM     P                     136931
163900200610     C*****                OUT  LDA                                       136931
164000200610     C*****                EXSR *PSSR                                     136931
164100200610     C*****                ENDIF                                          136931
164200200610      *
164300200610     C                     Z-ADD*ZERO     WWPRIC 158
164400200610      *
164500200610     C           *IN48     IFEQ *OFF
164600200610     C           RECI      ANDEQ'D'
164700200610      *
164800200610      ***  Check the "Trade/Value Date" indicator
164900200610      *
165000200610     C                     SELEC
165100200610      *
165200200610     C           MATDVD    WHEQ 'T'                        Trade Date
165300200610      *
165400200610      ***  Calculate average price using SR/ZAVPR2
165500200610      ***  SR/ZAVPR2 based on standard subroutine SR/ZAVPR
165600200610      *
165700200610     C           CSNT      IFNE *ZERO
165800200610     C                     Z-ADDCSNT      ZNOML            Nominal
165900200610     C                     Z-ADDCSPT      ZAPNC            Ap numerator
166000200610     C                     Z-ADDWONBDP    ZCDP             Nom. Ccy dec. places
166100200610     C                     Z-ADDWONMDP    NMDP             Nominal decimal places
166200200610     C                     EXSR ZAVPR2
166300200610     C                     Z-ADDZPRC      WWPRIC
166400200610     C                     ENDIF
166500200610      *
166600200610     C           MATDVD    WHEQ 'V'                        Value Date
166700200610      *
166800200610      ***  Calculate average price using SR/ZAVPR2
166900200610      ***  SR/ZAVPR2 based on standard subroutine SR/ZAVPR
167000200610      *
167100200610     C           CSNV      IFNE *ZERO
167200200610     C                     Z-ADDCSNV      ZNOML            Nominal
167300200610     C                     Z-ADDCSPV      ZAPNC            Ap numerator
167400200610     C                     Z-ADDWONBDP    ZCDP             Nom. Ccy dec. places
167500200610     C                     Z-ADDWONMDP    NMDP             Nominal decimal places
167600200610     C                     EXSR ZAVPR2
167700200610     C                     Z-ADDZPRC      WWPRIC
167800200610     C                     ENDIF
167900200610     C                     ENDSL
168000200610      *
168100200610      *****If*the*average*price*is*<*0,*set*average*price*to*zero******** 150004
168200200610      *
168300200610     C           WWPRIC    IFLT *ZERO
168400200610     C**********           Z-ADD*ZERO     WWPRIC                          150004
168500200610     C                     Z-SUBWWPRIC    WWPRIC                          150004
168600200610     C                     ENDIF
168700200610      *
168800200610     C                     ELSE
168900200610      *                                                                   136931
169000200610     C           MCCNUM    IFEQ WWERCU                                    136931
169100200610      *
169200200610     C                     MOVE 'Y'       WNOPOS
169300200610      *
169400200610      ***  Special Processing for the DUMMY customer without position
169500200610      *
169600200610     C                     SELEC
169700200610     C           MAPTYP    WHEQ 'DV'
169800200610     C                     Z-ADDMDCOMP    WWPRIC
169900200610     C           MAPTYP    WHEQ 'EX'
170000200610     C                     Z-ADDMJCOMP    WWPRIC
170100200610     C           MAPTYP    WHEQ 'FR'
170200200610     C                     Z-ADDMECOMP    WWPRIC
170300200610     C           MAPTYP    WHEQ 'OF'
170400200610     C                     Z-ADDMICOMP    WWPRIC
170500200610     C           MAPTYP    WHEQ 'RG'
170600200610     C                     Z-ADDMFCOMP    WWPRIC
170700200610     C           MAPTYP    WHEQ 'CC'                                      CEU017
170800200610     C           NAMRKI    IFEQ 'Y'                                       136931
170900200610     C                     Z-ADDMKPR      WWPRIC                          136931
171000200610     C                     ELSE                                           136931
171100200610     C                     Z-ADDNACOMP    WWPRIC                          CEU017
171200200610     C                     ENDIF                                          136931
171300200610     C                     ENDSL
171400200610      *                                                                   136931
171500200610     C                     ELSE                                           136931
171600200610     C                     Z-ADDMKPR      WWPRIC                          136931
171700200610     C                     ENDIF                                          136931
171800200610     C                     ENDIF
171900200610      *
172000200610      ***  If Cust/Book indicator is 'B' for book
172100200610      *
172200200610     C           MCCOTP    WHEQ 'B'
172300200610      *
172400200610      ***  Access to Book position Header to retrieve the Last Average Price
172500200610      *
172600200610     C                     MOVE MASESN    WKSESN
172700200610     C                     MOVE MCBRCD    WKBRCA
172800200610     C                     MOVE MCBOOK    WKBOOK
172900200610     C                     MOVE WOMKTI    WKMKTI
173000200610     C                     MOVE MATDVD    WKTDVD                          152589
173100200610      *
173200200610     C           KWBKPH    SETGTBKPHD
173300200610     C           KWBKPH    REDPEBKPHD                    89
173400200610      *
173500200610     C           *IN89     IFEQ *OFF
173600200610     C                     Z-ADDLAVP      WWPRIC
173700200610     C                     ENDIF
173800200610      *
173900200610      *****If*the*average*price*is*<*0,*set*average*price*to*zero******** 150004
174000200610      *
174100200610     C           WWPRIC    IFLT *ZERO
174200200610     C**********           Z-ADD*ZERO     WWPRIC                          150004
174300200610     C                     Z-SUBWWPRIC    WWPRIC                          150004
174400200610     C                     ENDIF
174500200610     C                     ENDSL
174600200610      *
174700200610     C                     ENDSR
174800200610      *
174900200610      *****************************************************************
175000200610      /EJECT
175100200610      *****************************************************************
175200200610      *  #CAAVP -  Retrieve Calculated average price (1) & (2)        *
175300200610      *  ------                                                       *
175400200610      *  Called by : #PDPTY                                           *
175500200610      *  Calls     : Nothing                                          *
175600200610      *****************************************************************
175700200610      *
175800200610     C           #CAAVP    BEGSR
175900200610      *
176000200610     C                     MOVE 'Y'       WRKA    1        Working field
176100200610     C                     Z-ADD22        X       20       Working field
176200200610     C                     MOVEA*BLANKS   NSEC             Event Security (22 * 10A)
176300200610     C                     MOVEA*ZERO     NOMI             Ex-Date position (22 * 15,ON)
176400200610     C                     MOVEA*ZERO     MARK             Market value (22 * 15,ON)
176500200610     C                     CLEARSVRCD
176600200610     C                     MOVELNWRCD     SVRCD            Saved LF/SECOALL5 field
176700200610      *
176800200610      ***  Access to Stock Allocation with same Coporate Action Reference,
176900200610      ***  same branch, same depot, same customer/book indicator, same book
177000200610      ***  same customer and portfolio
177100200610      ***  (||| If cust/book is 'B', book must be filled and customer portfolio must be blanks
177200200610      ***  else if cust/book is 'C', book must be blanks and customer/portfolio filled !!!)
177300200610      *
177400200610     C                     MOVE MCCORF    WKCORF
177500200610     C                     MOVE MCOPTN    WKOPTN
177600200610     C                     MOVE MCBRCD    WKBRCD
177700200610     C                     MOVE MCDDPT    WKDDPT
177800200610     C                     MOVE MCCOTP    WKCOTP
177900200610     C                     MOVE MCBOOK    WKBOOK
178000200610     C                     MOVE MCCNUM    WKCNUM
178100200610     C                     MOVE MCPTFR    WKPTFR
178200200610      *
178300200610     C           KWCOA3    SETLLSECOALL3
178400200610     C           KWCOA3    READESECOALL3                 48
178500200610      *
178600200610     C           *IN48     DOWEQ*OFF
178700200610      *
178800200610      ***  If working field is 'Y'
178900200610      *
179000200610     C           WRKA      IFEQ 'Y'
179100200610      *
179200200610      ***  Calculate consideration of event security = Ex-Date position * Average price
179300200610      *
179400200610     C                     MOVE *ZERO     WWTOTM 248       Total Market
179500200610     C                     Z-ADD*ZERO     WWCONE 238
179600200610     C           MCEXPO    MULT WWPRIC    WWCONE           Consideration of event sec.
179700200610      *
179800200610     C           MAPTYP    IFEQ 'CR'
179900200610     C           MHADRE    ANDEQ'A'                                       137881
180000200610     C           MAPTYP    OREQ 'CE'
180100200610     C           MAPTYP    OREQ 'RG'
180200200610     C           MFAVOP    ANDEQ'M'
180300200610     C           MAPTYP    OREQ 'RG'
180400200610     C           MFAVOP    ANDEQ'C'
180500200610     C           MAPTYP    OREQ 'RG'                                      161746
180600200610     C           MFAVOP    ANDEQ'I'                                       161746
180700200610     C*****      MAPTYP    OREQ 'NC'                                      137881
180800200610      *
180900200610      ***  Calculate Market value of event security
181000200610      ***  = Ex-Date position (held on first record readm in fact it is same on all records)
181100200610      ***    multiplied by market ex-price
181200200610      *
181300200610     C                     Z-ADD*ZERO     WWMRKV 238
181400200610     C           MCEXPO    MULT MAEXPC    WWMRKV           Market Value
181500200610      *
181600200610      ***  Fill the 3 arrays at index X=22
181700200610      *
181800200610     C                     MOVE MASESN    NSEC,X           Event Security
181900200610     C                     Z-ADDMCEXPO    NOMI,X           Ex-Date position
182000200610     C                     Z-ADDWWMRKV    MARK,X           Market Value
182100200610      *
182200200610      ***  Accumulate calculated market value into Total Market Value
182300200610      ***  Setup to 'N' working field and setup X by 1
182400200610      *
182500200610     C                     Z-ADDWWMRKV    WWTOTM
182600200610     C                     ENDIF
182700200610     C                     Z-ADD1         X
182800200610     C                     MOVE 'N'       WRKA
182900200610     C                     ENDIF                           WRKA='Y'
183000200610      *
183100200610      ***  If new security is not '**CASH**'
183200200610      *
183300200610     C           MCSESN    IFNE '**CASH**'
183400200610      *
183500200610      ***  Calculate Market Value = actual stock allocation multiplied by market price
183600200610      *
183700200610     C                     Z-ADDMCASTA    WWMRKV
183800200610      *                                                                   137881
183900200610     C                     MOVE MCSESN    WKSESN    P                     137881
184000200610     C                     EXSR #SECTN                                    137881
184100200610      *                                                                   137881
184200200610     C           WNNMDP    IFEQ 1                                         137881
184300200610     C           WWMRKV    DIV  10        WWMRKV                          137881
184400200610     C                     ELSE                                           137881
184500200610     C           WNNMDP    IFEQ 2                                         137881
184600200610     C           WWMRKV    DIV  100       WWMRKV                          137881
184700200610     C                     ELSE                                           137881
184800200610     C           WNNMDP    IFEQ 3                                         137881
184900200610     C           WWMRKV    DIV  1000      WWMRKV                          137881
185000200610     C                     ELSE                                           137881
185100200610     C           WNNMDP    IFEQ 4                                         137881
185200200610     C           WWMRKV    DIV  10000     WWMRKV                          137881
185300200610     C                     ENDIF                                          137881
185400200610     C                     ENDIF                                          137881
185500200610     C                     ENDIF                                          137881
185600200610     C                     ENDIF                                          137881
185700200610      *
185800200610     C                     SELEC
185900200610      *
186000200610      ***  Retrieve the market price depends on processing type
186100200610      *
186200200610     C           MAPTYP    WHEQ 'CR'
186300200610     C                     Z-ADD1         Y       20
186400200610     C           MCSESN    LOKUPSECUR,Y                  89
186500200610     C           *IN89     IFEQ *ON
186600200610     C                     MULT NPR,Y     WWMRKV
186700200610     C                     ENDIF
186800200610      *
186900200610     C           MAPTYP    WHEQ 'CE'
187000200610     C                     MULT MAEXPC    WWMRKV
187100200610      *
187200200610     C           MAPTYP    WHEQ 'OF'
187300200610     C                     MULT MIMKTP    WWMRKV
187400200610      *
187500200610     C           MAPTYP    WHEQ 'RG'
187600200610     C                     MULT MFRIMP    WWMRKV
187700200610     C                     ENDSL
187800200610      *
187900200610      ***  Fill the 3 arrays at index X=22
188000200610      *
188100200610     C                     MOVE MCSESN    NSEC,X           Event Security
188200200610     C                     Z-ADDMCASTA    NOMI,X           Ex-Date position
188300200610     C                     Z-ADDWWMRKV    MARK,X           Market Value
188400200610      *
188500200610      ***  Accumulate calculated market value into Total Market Value
188600200610      ***  Increment X by 1
188700200610      *
188800200610     C                     ADD  WWMRKV    WWTOTM
188900200610     C                     ADD  1         X
189000200610     C                     ENDIF
189100200610      *
189200200610      ***  If new security is '**CASH**'
189300200610      *
189400200610     C           MCSESN    IFEQ '**CASH**'
189500200610      *
189600200610      ***  Calculate Market Value = actual cash allocation + actual cash rounding
189700200610      *
189800200610     C                     Z-ADDMCACAA    WWMRKV
189900200610     C                     ADD  MCACAR    WWMRKV
190000200610      *                                                                   137881
190100200610     C           WONBDP    IFEQ 1                                         137881
190200200610     C           WWMRKV    DIV  10        WWMRKV                          137881
190300200610     C                     ELSE                                           137881
190400200610     C           WONBDP    IFEQ 2                                         137881
190500200610     C           WWMRKV    DIV  100       WWMRKV                          137881
190600200610     C                     ELSE                                           137881
190700200610     C           WONBDP    IFEQ 3                                         137881
190800200610     C           WWMRKV    DIV  1000      WWMRKV                          137881
190900200610     C                     ELSE                                           137881
191000200610     C           WONBDP    IFEQ 4                                         137881
191100200610     C           WWMRKV    DIV  10000     WWMRKV                          137881
191200200610     C                     ENDIF                                          137881
191300200610     C                     ENDIF                                          137881
191400200610     C                     ENDIF                                          137881
191500200610     C                     ENDIF                                          137881
191600200610      *
191700200610      ***  Fill the 3 arrays at index X
191800200610      *
191900200610     C                     MOVE MCSESN    NSEC,X           Event Security
192000200610     C                     Z-ADDWWMRKV    NOMI,X           Market value converted
192100200610     C                     Z-ADDWWMRKV    MARK,X           Market Value
192200200610      *
192300200610      ***  Accumulate calculated market value into Total Market Value
192400200610      ***  Increment X by 1
192500200610      *
192600200610     C                     ADD  WWMRKV    WWTOTM
192700200610     C                     ADD  1         X
192800200610     C                     ENDIF
192900200610      *
193000200610      ***  Read next record with same CO Reference, same option, same branch,
193100200610      ***  same depot, customer/book ind 'C' or 'B', same book or cust./port.
193200200610      *
193300200610     C           KWCOA3    READESECOALL3                 48
193400200610     C                     ENDDO
193500200610      *
193600200610      ***  Setup X by 1
193700200610      ***  Do while X is lower than 23 and array containing the security
193800200610      ***  at index X is not blank
193900200610      *
194000200610     C                     Z-ADD1         X
194100200610     C           X         DOWLT23
194200200610     C***********NSEC,X    ANDNE*BLANKS                                   162290
194300200610     C           NSEC,X    IFNE *BLANKS                                   162290
194400200610      *
194500200610      ***  Calculate % of Total Market Value (WWPTOM)
194600200610      ***           MARK,X
194700200610      ***  = -------------------  X  100
194800200610      ***     Total Market Value
194900200610      *
195000200610     C*****                Z-ADD*ZERO     WWPTOM 118                      137881
195100200610     C                     Z-ADD*ZERO     WWPTOM 238                      137881
195200200610     C           WWTOTM    IFNE *ZERO
195300200610     C*****                Z-ADDMARK,X    WWK170 170                      137881
195400200610     C                     Z-ADDMARK,X    WWK238 238                      137881
195500200610     C*****                MULT 100       WWK170                          137881
195600200610     C*****      WWK170    DIV  WWTOTM    WWPTOM                          137881
195700200610     C           WWK238    DIV  WWTOTM    WWPTOM                          137881
195800200610     C           WWPTOM    MULT 100       WWPTOM                          137881
195900200610     C                     ENDIF
196000200610      *
196100200610      ***  Calculate Consideration (WWCONS)
196200200610      ***     % of Total Market Value  *  Consideration of event security
196300200610      *****=*------------------------------------------------------------ 137881
196400200610      *******                         NOMI,X                              137881
196500200610      *
196600200610     C*****                Z-ADD*ZERO     WWCONS 158                      137881
196700200610     C                     Z-ADD*ZERO     WWCONS 238                      137881
196800200610     C*****      NOMI,X    IFNE *ZERO                                     137881
196900200610     C                     Z-ADDWWPTOM    WWK238 238
197000200610     C                     MULT WWCONE    WWK238
197100200610     C*****      WWK238    DIV  NOMI,X    WWCONS                          137881
197200200610     C*****                ENDIF                                          137881
197300200610      *
197400200610      ***  If security is not '**CASH**'
197500200610      *
197600200610     C*****      MCSESN    IFNE '**CASH**'                                137881
197700200610     C           NSEC,X    IFNE '**CASH**'                                137881
197800200610      *
197900200610      ***  Calculate Average Price (2) (WWAVR2) and store result in the array average price
198000200610      ***     Consideration
198100200610      ***  = ---------------
198200200610      ***        NOMI,X
198300200610      *
198400200610     C                     Z-ADD*ZERO     WWAVR2 158
198500200610     C           NOMI,X    IFNE *ZERO
198600200610     C*****      WWCONS    DIV  NOMI,X    WWAVR2                          137881
198700200610     C           WWK238    DIV  NOMI,X    WWAVR2                          137881
198800200610     C                     ENDIF
198900200610     C           WWAVR2    DIV  100       WWAVR2                          137881
199000200610     C                     Z-ADDWWAVR2    AVPR,X
199100200610     C                     ENDIF                           Sec.<>'**CASH**'
199200200610      *
199300200610      ***  If security is '**CASH**'
199400200610      *
199500200610     C*****      MCSESN    IFEQ '**CASH**'                                137881
199600200610     C           NSEC,X    IFEQ '**CASH**'                                137881
199700200610      *
199800200610      ***  Calculate Realised Profit (WWREPT)
199900200610      ***  = NOMI,X  -  Consideration
200000200610      *
200100200610     C                     Z-ADD*ZERO     WWREPT 238
200200200610     C           WWK238    DIV  100       WWCONS                          137881
200300200610     C           NOMI,X    SUB  WWCONS    WWREPT
200400200610     C                     ENDIF                           Sec.='**CASH**'
200500200610      *
200600200610      ***  Increment X by 1
200700200610      *
200800200610     C                     ENDIF                           NSEC,X <> ' '  162290
200900200610     C                     ADD  1         X
201000200610     C                     ENDDO
201100200610      *
201200200610      ***  Calculate Average Price (1) (WWAVR1)
201300200610      ***     Consideration of event security  +  realised profit
201400200610      ***  = -----------------------------------------------------
201500200610      ***                       Ex-Date Position
201600200610      *
201700200610     C                     Z-ADD*ZERO     WWAVR1 158
201800200610     C           MCEXPO    IFNE *ZERO
201900200610     C                     Z-ADDWWCONE    WWK238 238
202000200610     C                     ADD  WWREPT    WWK238
202100200610     C           WWK238    DIV  MCEXPO    WWAVR1
202200200610     C                     ENDIF
202300200610      *
202400200610     C                     CLEARNWRCD
202500200610     C                     MOVELSVRCD     NWRCD            Saved LF/SECOALL5 field
202600200610      *
202700200610     C                     ENDSR
202800200610      *
202900200610      *****************************************************************
203000200610      /EJECT
203100200610      *****************************************************************
203200200610      *  #CAPR - Processing for calculated price                      *
203300200610      *  -----                                                        *
203400200610      *  Called by : #PRFRO #PRFRR #PREX                              *
203500200610      *  Calls     : ZCCYCN                                           *
203600200610      *****************************************************************
203700200610      *
203800200610     C           #CAPR     BEGSR
203900200610      *
204000200610      ***                     ^(Nominal old position X average price) +/- cash element!
204100200610      ***                     CONVERTED IN nominal ccy of new Security
204200200610      ***  Calculated price = ---------------------------------------------------------
204300200610      ***                                          New position
204400200610      *
204500200610     C                     Z-ADD*ZERO     WWCAPR 158       Calculated price
204600200610     C********             Z-ADD*ZERO     WWCASH 238       Price converted in new security    150272
204700200610     C                     Z-ADD*ZERO     WWCASH 308       Price converted in new security    150272
204800200610     C                     Z-ADDMCEXPO    WWNMOP 150       Nominal old position
204900200610     C                     Z-ADDWWPRIC    WWAPOP 158       Average price old position
205000200610     C                     Z-ADDMCACAA    WWACAA 150       Actual cash allocation
205100200610     C                     Z-ADDMCACAR    WWACAR 150       Actual cash rounding
205200200610     C                     Z-ADDMCASTA    WWNWPO 150       New Position
205300200610      *
205400200610     C           WWNWPO    IFNE *ZERO
205500200610     C                     Z-ADD0         ZAMTF
205600200610      *
205700200610      ***  Multiply Nominal old position and Average price old position
205800200610      *
205900200610     C           WWNMOP    MULT WWAPOP    ZAMTF
206000200610      *
206100200610      ***  If Sign is '+' add the cash element else substract the cash element
206200200610      ***  Cash element = total cash
206300200610      ***                 (Actual cash allocation + Actual cash rounding)
206400200610      *
206500200610      *
206600200610     C           WWSIGN    IFEQ '+'
206700200610     C                     ADD  WWACAA    ZAMTF
206800200610     C                     ADD  WWACAR    ZAMTF
206900200610     C                     ELSE
207000200610     C           ZAMTF     SUB  WWACAA    ZAMTF
207100200610     C           ZAMTF     SUB  WWACAR    ZAMTF
207200200610     C                     ENDIF
207300200610      *
207400200610     C           ZAMTF     IFNE *ZERO
207500200610     C                     MOVE WONMCY    ZCCYF
207600200610     C                     MOVE WOSPRT    ZRATEF
207700200610     C                     MOVE WOMDIN    ZMDINF
207800200610     C                     MOVE WONBDP    ZCDPF
207900200610     C                     MOVE WNNMCY    ZCCYT
208000200610     C                     MOVE WNSPRT    ZRATET
208100200610     C                     MOVE WNMDIN    ZMDINT
208200200610     C                     MOVE WNNBDP    ZCDPT
208300200610     C                     EXSR ZCCYCN
208400200610     C                     Z-ADDZAMTT     WWCASH
208500200610     C                     ENDIF                           ZAMFT<>*ZERO
208600200610      *
208700200610      ***  Divide the result by the new position
208800200610      *
208900200610     C           WWCASH    DIV  WWNWPO    WWCAPR
209000200610     C                     ENDIF
209100200610      *
209200200610     C                     ENDSR
209300200610      *                                                                   CEU017
209400200610      *****************************************************************   CEU017
209500200610      /EJECT                                                              CEU017
209600200610      *****************************************************************   CEU017
209700200610      *  #CAPRC - Processing for calculated price                     *   CEU017
209800200610      *  ------   for processing type 'CC'                            *   CEU017
209900200610      *  Called by : #PRCC                                            *   CEU017
210000200610      *  Calls     : ZCCYCN                                           *   CEU017
210100200610      *****************************************************************   CEU017
210200200610      *                                                                   CEU017
210300200610     C           #CAPRC    BEGSR                                          CEU017
210400200610      *                                                                   CEU017
210500200610      ***                     (Nom. old pos. X Avr Pr.) +/- cash rounding CEU017
210600200610      ***  Calculated price = ------------------------------------------- CEU017
210700200610      ***                                          New position           CEU017
210800200610      *                                                                   CEU017
210900200610     C***********          Z-ADD*ZERO     WWCASH 238       Pr. convCEU017 150272
211000200610     C                     Z-ADD*ZERO     WWCASH 308       Pr. converted  150272
211100200610     C                     Z-ADD*ZERO     WWCAPR 158       Calc. price    CEU017
211200200610     C                     Z-ADDMCEXPO    WWNMOP 150       Nom. old pos   CEU017
211300200610     C                     Z-ADDWWPRIC    WWAPOP 158       Avr. pr old posCEU017
211400200610     C                     Z-ADDMCACAA    WWACAA 150       Cash alloc.    CEU017
211500200610     C                     Z-ADDMCACAR    WWACAR 150       Cash rounding  CEU017
211600200610     C                     Z-ADDMCASTA    WWNWPO 150       New Position   CEU017
211700200610      *                                                                   CEU017
211800200610     C                     Z-ADD*ZEROS    DEC     10                      CEU017
211900200610     C********** WNNMDP    ADD  5         DEC                      CEU017 147102
212000200610     C           WNNMDP    SUB  WONMDP    DEC                             147102
212100200610     C           DEC       ADD  5         DEC                             147102
212200200610     C********** WWNMOP    MULT POWER8,DECZAMTF                    CEU017 136931
212300200610     C           WWNMOP    MULT POWER9,DECZAMTF                           136931
212400200610      *                                                                   CEU017
212500200610     C                     Z-ADDZAMTF     WWCASH                          CEU017
212600200610      *                                                                   CEU017
212700200610      ***  Multiply Nominal old position and Average price old position   CEU017
212800200610      *                                                                   CEU017
212900200610     C           WWCASH    MULT WWAPOP    WWCASH                          CEU017
213000200610      *                                                                   CEU017
213100200610      ***  If Sign is '+' add the cash element else substract the cash eleCEU017
213200200610      *                                                                   CEU017
213300200610     C           WWSIGN    IFEQ '+'                                       CEU017
213400200610     C                     ADD  MCACAR    WWCASH                          CEU017
213500200610     C                     ELSE                                           CEU017
213600200610     C                     SUB  MCACAR    WWCASH                          CEU017
213700200610     C                     ENDIF                                          CEU017
213800200610      *                                                                   CEU017
213900200610     C           CEU002    IFEQ 'Y'                                       CEU017
214000200610     C           WOINCY    ANDEQ'Y'                                       CEU017
214100200610      *                                                                   CEU017
214200200610     C           WOEUMD    IFEQ 'M'                                       CEU017
214300200610     C           WWCASH    MULT WOEUER    WWCASH                          CEU017
214400200610     C                     ELSE                                           CEU017
214500200610     C           WWCASH    DIV  WOEUER    WWCASH                          CEU017
214600200610     C                     ENDIF                                          CEU017
214700200610      *                                                                   CEU017
214800200610     C                     ELSE                                           CEU017
214900200610     C                     Z-ADDWWCASH    ZAMTF                           151931
215000200610     C                     MOVE WONMCY    ZCCYF                           CEU017
215100200610     C                     MOVE WOSPRT    ZRATEF                          CEU017
215200200610     C                     MOVE WOMDIN    ZMDINF                          CEU017
215300200610     C                     MOVE WONBDP    ZCDPF                           CEU017
215400200610     C                     MOVE WNNMCY    ZCCYT                           CEU017
215500200610     C                     MOVE WNSPRT    ZRATET                          CEU017
215600200610     C                     MOVE WNMDIN    ZMDINT                          CEU017
215700200610     C                     MOVE WNNBDP    ZCDPT                           CEU017
215800200610     C                     EXSR ZCCYCN                                    CEU017
215900200610     C                     Z-ADDZAMTT     WWCASH                          CEU017
216000200610     C                     ENDIF                                          CEU017
216100200610      *                                                                   CEU017
216200200610      ***  Divide the result by the new position                          CEU017
216300200610      *                                                                   CEU017
216400200610     C           WWCASH    DIV  WWNWPO    WWCAPR                          CEU017
216500200610      *                                                                   CEU017
216600200610     C                     ENDSR                                          CEU017
216700200610      *                                                                   CEU017
216800200610      *****************************************************************
216900200610      /EJECT
217000200610      *****************************************************************
217100200610      *  #PRDV -  Generate Trades/Depot Movements                     *
217200200610      *  -----    for processing type 'DV'                            *
217300200610      *  Called by : #PDPTY                                           *
217400200610      *  Calls     : #SECTN #ACOAT #WTRAD #SDPMV                      *
217500200610      *****************************************************************
217600200610      *
217700200610     C           #PRDV     BEGSR
217800200610      *
217900200610      ***  Check Cust/Book indicator
218000200610      *
218100200610     C                     SELEC
218200200610      *
218300200610      ***  If Cust/Book indicator is 'B'
218400200610      ***  Generate a Trade Purchase for the book
218500200610      *
218600200610     C           MCCOTP    WHEQ 'B'
218700200610      *
218800200610      ***  Setup specific field for this processing type
218900200610      *
219000200610     C                     MOVELMCSESN    WWSESN    P      new security
219100200610     C                     MOVE MCSESN    WKSESN    P
219200200610     C                     MOVE 'TP'      WWTDTP           Purchase
219300200610     C                     Z-ADDMCASTA    WWNOML           Actual stock All.
219400200610      *                                                                   148404
219500200610     C           WWNOML    IFLT *ZEROS                                    148404
219600200610     C                     MOVE 'Y'       WWINVR  1                       148404
219700200610     C                     Z-SUBWWNOML    WWNOML                          148404
219800200610     C                     MOVE 'TS'      WWTDTP                          148404
219900200610     C                     ELSE                                           148404
220000200610     C                     MOVE 'N'       WWINVR                          148404
220100200610     C                     ENDIF                                          148404
220200200610      *
220300200610      ***  Access to Security Details
220400200610      *
220500200610     C                     EXSR #SECTN
220600200610      *
220700200610     C                     MOVE WNNMCY    WWNMCY
220800200610      *
220900200610      ***  If Market Price indicator is 'Y' use market price from PF/SECTYD
221000200610      ***  else use subscription price from PF/SECODVPD
221100200610      *
221200200610     C           MDMRKI    IFEQ 'Y'
221300200610     C                     Z-ADDWNMKPR    WWTPDY           Market Price
221400200610     C                     ELSE
221500200610     C           MDSBPR    IFNE *ZEROS                                    137881
221600200610     C                     Z-ADDMDSBPR    WWTPDY           Subscription Price
221700200610     C                     ELSE                                           137881
221800200610     C           MAEXPC    IFNE *ZEROS                                    137881
221900200610     C                     Z-ADDMAEXPC    WWTPDY           Mrkt Ex Price  137881
222000200610     C                     ELSE                                           137881
222100200610     C                     Z-ADDWNMKPR    WWTPDY           Market Price   137881
222200200610     C                     ENDIF                                          137881
222300200610     C                     ENDIF                                          137881
222400200610     C                     ENDIF
222500200610      *
222600200610      ***  Access to Corporate Action Type Details to retrieve
222700200610      ***  Settlement Account Code
222800200610      *
222900200610     C                     MOVE MACOAT    WKCOAT
223000200610     C                     EXSR #ACOAT
223100200610      *
223200200610     C                     MOVE BVCOTC    WWCUST
223300200610     C                     MOVE MMACOD    WWSTAC           Settl. Account Code
223400200610     C                     MOVE '01'      WWSTSQ           Settl. Account Seq.
223500200610     C           WWINVR    IFEQ 'Y'                                       148404
223600200610     C                     MOVELWWPAAC    WWPAYT           Pay to         148404
223700200610     C                     MOVE *BLANKS   WWPYFM           Pay from       148404
223800200610     C                     ELSE                                           148404
223900200610     C                     MOVE *BLANKS   WWPAYT           Pay to
224000200610     C                     MOVELWWPAAC    WWPYFM           Pay from
224100200610     C                     ENDIF                                          148404
224200200610     C                     MOVE MSCHTP    WALLOC
224300200610      *
224400200610      ***  Setup Default fields for a new Trade
224500200610      *
224600200610     C                     EXSR #WTRAD
224700200610     C                     MOVE WKTRRF    WWTRR1
224800200610      *
224900200610     C           MCCOTP    WHEQ 'C'
225000200610      *
225100200610      ***  If Cust/Book indicator is 'C'
225200200610      ***  Generate a Depot Movement for the customer (WI)
225300200610      *
225400200610      ***  Setup specific field for this processing type
225500200610      *
225600200610     C                     MOVELMCSESN    WWSESN    P      new security
225700200610     C                     MOVELMCSESN    WKSESN    P      new security
225800200610     C                     MOVE 'WI'      WWDPMV           movement type
225900200610      *
226000200610      ***  Access to Security Details
226100200610      *
226200200610     C                     EXSR #SECTN
226300200610      *
226400200610     C                     MOVE WNNMCY    WWNMCY
226500200610      *
226600200610      ***  If Market Price indicator is 'Y' use market price from PF/SECTYD
226700200610      ***  else use subscription price from PF/SECODVPD
226800200610      *
226900200610     C           MDMRKI    IFEQ 'Y'
227000200610     C*********************Z-ADDWNMKPR    WWMKTP           Market Price   161910
227100200610     C                     Z-ADDWWPRIC    WWTPDY           COMP.PRICE     161910
227200200610     C                     ELSE
227300200610     C           MDSBPR    IFNE *ZEROS                                    137881
227400200610     C                     Z-ADDMDSBPR    WWMKTP           Subscription Price
227500200610     C                     ELSE                                           137881
227600200610     C           MAEXPC    IFNE *ZEROS                                    137881
227700200610     C                     Z-ADDMAEXPC    WWMKTP           Mrkt Ex Price  137881
227800200610     C                     ELSE                                           137881
227900200610     C*********************Z-ADDWNMKPR    WWMKTP           Market P137881 161910
228000200610     C                     Z-ADDWWPRIC    WWTPDY           COMP.PRICE     161910
228100200610     C                     ENDIF                                          137881
228200200610     C                     ENDIF                                          137881
228300200610     C                     ENDIF
228400200610     C                     Z-ADDMCASTA    WWDPNA           Actual stock allocation
228500200610     C                     MOVE MSCHTP    WALLOC
228600200610      *                                                                   148404
228700200610     C           WWDPNA    IFLT *ZEROS                                    148404
228800200610     C                     Z-SUBWWDPNA    WWDPNA                          148404
228900200610     C                     MOVE 'WO'      WWDPMV                          148404
229000200610     C                     ENDIF                                          148404
229100200610      *
229200200610      ***  Setup Default fields
229300200610      ***  And generate a new depot movement
229400200610      *
229500200610     C                     EXSR #SDPMV
229600200610     C                     MOVE WKTRRF    WWTRR1
229700200610     C                     ENDSL                           Check cust/book ind.
229800200610      *
229900200610     C                     ENDSR
230000200610      *
230100200610      *****************************************************************
230200200610      /EJECT
230300200610      *****************************************************************
230400200610      *  #PRFR -  Check processing for type 'FR'                      *
230500200610      *  -----                                                        *
230600200610      *  Called by : #PDPTY                                           *
230700200610      *  Calls     : #PRFRR #PRFRO #PRFRA                             *
230800200610      *****************************************************************
230900200610      *
231000200610     C           #PRFR     BEGSR
231100200610      *
231200200610     C                     SELEC
231300200610      *
231400200610      ***  Processing type 'FR' and New Security entered and Replace
231500200610      *
231600200610     C           MENSEC    WHNE MASESN
231700200610     C           MEADRE    ANDEQ'R'
231800200610     C                     EXSR #PRFRR
231900200610      *
232000200610      ***  Processing type 'FR' and Old Security entered and Replace
232100200610      *
232200200610     C           MENSEC    WHEQ MASESN
232300200610     C           MEADRE    ANDEQ'R'
232400200610     C                     EXSR #PRFRO
232500200610      *
232600200610      ***  Processing type 'FR' and Add
232700200610      *
232800200610     C           MEADRE    WHEQ 'A'
232900200610     C                     EXSR #PRFRA
233000200610     C                     ENDSL
233100200610      *
233200200610     C                     ENDSR
233300200610      *
233400200610      *****************************************************************
233500200610      /EJECT
233600200610      *****************************************************************
233700200610      *  #PRFRR -  Generate Trades/Depot Movements                    *
233800200610      *  ------    for processing type 'FR' and New Security entered  *
233900200610      *            and Replace                                        *
234000200610      *  Called by : #PRFR                                            *
234100200610      *  Calls     : #SECTN #ACOAT #WTRAD #CAPR #SDPMV                *
234200200610      *****************************************************************
234300200610      *
234400200610     C           #PRFRR    BEGSR
234500200610      *
234600200610      ***  Check Cust/Book indicator
234700200610      *
234800200610     C                     SELEC
234900200610      *
235000200610      ***  If Cust/Book indicator is 'B'
235100200610      *
235200200610     C           MCCOTP    WHEQ 'B'
235300200610      *
235400200610      ***  Setup specific field for this processing type
235500200610      ***  Generate a Trade Sale for the book (old position)
235600200610      *
235700200610     C                     MOVELMASESN    WWSESN    P      old security
235800200610     C                     MOVELMASESN    WKSESN    P
235900200610     C                     MOVE 'TS'      WWTDTP           Sale
236000200610     C                     Z-ADDMCEXPO    WWNOML           Ex-Date position
236100200610      *                                                                   148404
236200200610     C           WWNOML    IFLT *ZEROS                                    148404
236300200610     C                     MOVE 'Y'       WWINVR  1                       148404
236400200610     C                     Z-SUBWWNOML    WWNOML                          148404
236500200610     C                     MOVE 'TP'      WWTDTP                          148404
236600200610     C                     ELSE                                           148404
236700200610     C                     MOVE 'N'       WWINVR                          148404
236800200610     C                     ENDIF                                          148404
236900200610      *
237000200610      ***  Access to Security Details
237100200610      *
237200200610     C                     EXSR #SECTN
237300200610      *
237400200610     C                     MOVE WONMCY    WWNMCY
237500200610      *
237600200610     C                     Z-ADDWWPRIC    WWTPDY           Average Price
237700200610      *
237800200610      ***  Access to Corporate Action Type Details to retrieve
237900200610      ***  Settlement Account Code
238000200610      *
238100200610     C                     MOVE MACOAT    WKCOAT
238200200610     C                     EXSR #ACOAT
238300200610      *
238400200610     C                     MOVE BVCOTC    WWCUST
238500200610     C                     MOVE MMACOD    WWSTAC           Settl. Account Code
238600200610     C                     MOVE '01'      WWSTSQ           Settl. Account Seq.
238700200610     C           WWINVR    IFEQ 'Y'                                       148404
238800200610     C                     MOVE *BLANKS   WWPAYT           Pay to         148404
238900200610     C                     MOVELWWPAAC    WWPYFM           Pay from       148404
239000200610     C                     ELSE                                           148404
239100200610     C                     MOVELWWPAAC    WWPAYT           Pay to
239200200610     C                     MOVE *BLANKS   WWPYFM           Pay from
239300200610     C                     ENDIF                                          148404
239400200610     C                     MOVE MSCHTP    WALLOC
239500200610      *
239600200610      ***  Setup Default fields for a new Trade
239700200610      *
239800200610     C                     EXSR #WTRAD
239900200610     C                     MOVE WKTRRF    WWTRR1
240000200610      *
240100200610      ***  Setup specific field for this processing type
240200200610      ***  Generate a Trade Purchase for the book (new position)
240300200610      *
240400200610     C                     MOVELMCSESN    WWSESN    P      new security
240500200610     C                     MOVELMCSESN    WKSESN    P
240600200610     C                     MOVE 'TP'      WWTDTP           Purchase
240700200610     C                     Z-ADDMCASTA    WWNOML           Actual Stock Allocation
240800200610      *                                                                   148404
240900200610     C           WWNOML    IFLT *ZEROS                                    148404
241000200610     C                     MOVE 'Y'       WWINVR  1                       148404
241100200610     C                     Z-SUBWWNOML    WWNOML                          148404
241200200610     C                     MOVE 'TS'      WWTDTP                          148404
241300200610     C                     ELSE                                           148404
241400200610     C                     MOVE 'N'       WWINVR                          148404
241500200610     C                     ENDIF                                          148404
241600200610      *
241700200610      ***  Access to Security Details
241800200610      *
241900200610     C                     EXSR #SECTN
242000200610      *
242100200610     C                     MOVE WNNMCY    WWNMCY
242200200610      *
242300200610     C                     MOVE '-'       WWSIGN  1        Sign
242400200610     C                     EXSR #CAPR
242500200610     C                     Z-ADDWWCAPR    WWTPDY           calculated price
242600200610      *
242700200610      ***  Access to Corporate Action Type Details to retrieve
242800200610      ***  Settlement Account Code
242900200610      *
243000200610     C                     MOVE MCCOAT    WKCOAT
243100200610     C                     EXSR #ACOAT
243200200610      *
243300200610     C                     MOVE BVCOTC    WWCUST
243400200610     C                     MOVE MMACOD    WWSTAC           Settl. Account Code
243500200610     C                     MOVE '01'      WWSTSQ           Settl. Account Seq.
243600200610     C           WWINVR    IFEQ 'Y'                                       148404
243700200610     C                     MOVELWWPAAC    WWPAYT           Pay to         148404
243800200610     C                     MOVE *BLANKS   WWPYFM           Pay from       148404
243900200610     C                     ELSE                                           148404
244000200610     C                     MOVE *BLANKS   WWPAYT           Pay to
244100200610     C                     MOVELWWPAAC    WWPYFM           Pay from
244200200610     C                     ENDIF                                          148404
244300200610     C                     MOVE MSCHTP    WALLOC
244400200610      *
244500200610      ***  Setup Default fields for a new Trade
244600200610      *
244700200610     C                     EXSR #WTRAD
244800200610     C                     MOVE WKTRRF    WWTRR2
244900200610      *
245000200610     C           MCCOTP    WHEQ 'C'
245100200610      *
245200200610      ***  If Cust/Book indicator is 'C'
245300200610      *
245400200610      ***  Setup specific field for this processing type
245500200610      ***  Generate a Depot Movement for the customer (WO) (old position)
245600200610      *
245700200610     C                     MOVELMASESN    WWSESN    P      old security
245800200610     C                     MOVELMASESN    WKSESN    P
245900200610     C                     MOVE 'WO'      WWDPMV           movement type
246000200610      *
246100200610      ***  Access to Security Details
246200200610      *
246300200610     C                     EXSR #SECTN
246400200610      *
246500200610     C                     MOVE WONMCY    WWNMCY
246600200610      *
246700200610     C                     Z-ADDWWPRIC    WWMKTP           Average Price
246800200610     C                     Z-ADDMCEXPO    WWDPNA           ex-date position
246900200610     C                     MOVE MSCHTP    WALLOC
247000200610      *                                                                   148404
247100200610     C           WWDPNA    IFLT *ZEROS                                    148404
247200200610     C                     Z-SUBWWDPNA    WWDPNA                          148404
247300200610     C                     MOVE 'WI'      WWDPMV                          148404
247400200610     C                     ENDIF                                          148404
247500200610      *
247600200610      ***  Setup Default fields
247700200610      ***  And generate a new depot movement
247800200610      *
247900200610     C                     EXSR #SDPMV
248000200610     C                     MOVE WKTRRF    WWTRR1
248100200610      *
248200200610      ***  Setup specific field for this processing type
248300200610      ***  Generate a Depot Movement for the customer (WI) (new position)
248400200610      *
248500200610     C                     MOVELMCSESN    WWSESN    P      new security
248600200610     C                     MOVELMCSESN    WKSESN    P
248700200610     C                     MOVE 'WI'      WWDPMV           movement type
248800200610      *
248900200610      ***  Access to Security Details
249000200610      *
249100200610     C                     EXSR #SECTN
249200200610      *
249300200610     C                     MOVE WNNMCY    WWNMCY
249400200610      *
249500200610     C                     MOVE '-'       WWSIGN  1        Sign
249600200610     C                     EXSR #CAPR
249700200610     C                     Z-ADDWWCAPR    WWMKTP           calculated price
249800200610     C                     Z-ADDMCASTA    WWDPNA           actual stock allocation
249900200610     C                     MOVE MSCHTP    WALLOC
250000200610      *                                                                   148404
250100200610     C           WWDPNA    IFLT *ZEROS                                    148404
250200200610     C                     Z-SUBWWDPNA    WWDPNA                          148404
250300200610     C                     MOVE 'WO'      WWDPMV                          148404
250400200610     C                     ENDIF                                          148404
250500200610      *
250600200610      ***  Setup Default fields
250700200610      ***  And generate a new depot movement
250800200610      *
250900200610     C                     EXSR #SDPMV
251000200610     C                     MOVE WKTRRF    WWTRR2
251100200610     C                     ENDSL                           Check cust/book ind.
251200200610      *
251300200610     C                     ENDSR
251400200610      *
251500200610      *****************************************************************
251600200610      /EJECT
251700200610      *****************************************************************
251800200610      *  #PRFRO -  Generate Trades/Depot Movements                    *
251900200610      *  ------    for processing type 'FR' and Old Security entered  *
252000200610      *            and Replace                                        *
252100200610      *  Called by : #PRFR                                            *
252200200610      *  Calls     : #SECTN #ACOAT #WTRAD #CAPR #SDPMV                *
252300200610      *****************************************************************
252400200610      *
252500200610     C           #PRFRO    BEGSR
252600200610      *
252700200610      ***  Check Cust/Book indicator
252800200610      *
252900200610     C                     SELEC
253000200610      *
253100200610      ***  If Cust/Book indicator is 'B'
253200200610      *
253300200610     C           MCCOTP    WHEQ 'B'
253400200610      *
253500200610      ***  Setup specific field for this processing type
253600200610      ***  Generate a Trade Sale for the book (old position)
253700200610      *
253800200610     C                     MOVELMASESN    WWSESN    P      old security
253900200610     C                     MOVELMASESN    WKSESN    P
254000200610     C                     MOVE 'TS'      WWTDTP           Sale
254100200610     C                     Z-ADDMCEXPO    WWNOML           Ex-Date position
254200200610      *                                                                   148404
254300200610     C           WWNOML    IFLT *ZEROS                                    148404
254400200610     C                     MOVE 'Y'       WWINVR  1                       148404
254500200610     C                     Z-SUBWWNOML    WWNOML                          148404
254600200610     C                     MOVE 'TP'      WWTDTP                          148404
254700200610     C                     ELSE                                           148404
254800200610     C                     MOVE 'N'       WWINVR                          148404
254900200610     C                     ENDIF                                          148404
255000200610      *
255100200610      ***  Access to Security Details
255200200610      *
255300200610     C                     EXSR #SECTN
255400200610      *
255500200610     C                     MOVE WONMCY    WWNMCY
255600200610      *
255700200610     C                     Z-ADDWWPRIC    WWTPDY           Average Price
255800200610      *
255900200610      ***  Access to Corporate Action Type Details to retrieve
256000200610      ***  Settlement Account Code
256100200610      *
256200200610     C                     MOVE MACOAT    WKCOAT
256300200610     C                     EXSR #ACOAT
256400200610      *
256500200610     C                     MOVE BVCOTC    WWCUST
256600200610     C                     MOVE MMACOD    WWSTAC           Settl. Account Code
256700200610     C                     MOVE '01'      WWSTSQ           Settl. Account Seq.
256800200610     C           WWINVR    IFEQ 'Y'                                       148404
256900200610     C                     MOVE *BLANKS   WWPAYT           Pay to         148404
257000200610     C                     MOVELWWPAAC    WWPYFM           Pay from       148404
257100200610     C                     ELSE                                           148404
257200200610     C                     MOVELWWPAAC    WWPAYT           Pay to
257300200610     C                     MOVE *BLANKS   WWPYFM           Pay from
257400200610     C                     ENDIF                                          148404
257500200610     C                     MOVE MSCHTP    WALLOC
257600200610      *
257700200610      ***  Setup Default fields for a new Trade
257800200610      *
257900200610     C                     EXSR #WTRAD
258000200610     C                     MOVE WKTRRF    WWTRR1
258100200610      *
258200200610      ***  Setup specific field for this processing type
258300200610      ***  Generate a Trade Purchase for the book (new position)
258400200610      *
258500200610     C                     MOVELMCSESN    WWSESN    P      new security
258600200610     C                     MOVELMCSESN    WKSESN    P
258700200610     C                     MOVE 'TP'      WWTDTP           Purchase
258800200610     C                     Z-ADDMCASTA    WWNOML           Actual Stock Allocation
258900200610      *                                                                                       148404
259000200610     C           WWNOML    IFLT *ZEROS                                                        148404
259100200610     C                     MOVE 'Y'       WWINVR  1                                           148404
259200200610     C                     Z-SUBWWNOML    WWNOML                                              148404
259300200610     C                     MOVE 'TS'      WWTDTP                                              148404
259400200610     C                     ELSE                                                               148404
259500200610     C                     MOVE 'N'       WWINVR                                              148404
259600200610     C                     ENDIF                                                              148404
259700200610      *
259800200610      ***  Access to Security Details
259900200610      *
260000200610     C                     EXSR #SECTN
260100200610      *
260200200610     C                     MOVE WNNMCY    WWNMCY
260300200610      *
260400200610     C                     MOVE '-'       WWSIGN  1        Sign
260500200610     C                     EXSR #CAPR
260600200610     C                     Z-ADDWWCAPR    WWTPDY           calculated price
260700200610      *
260800200610      ***  Access to Corporate Action Type Details to retrieve
260900200610      ***  Settlement Account Code
261000200610      *
261100200610     C                     MOVE MCCOAT    WKCOAT
261200200610     C                     EXSR #ACOAT
261300200610      *
261400200610     C                     MOVE BVCOTC    WWCUST
261500200610     C                     MOVE MMACOD    WWSTAC           Settl. Account Code
261600200610     C                     MOVE '01'      WWSTSQ           Settl. Account Seq.
261700200610     C           WWINVR    IFEQ 'Y'                                       148404
261800200610     C                     MOVELWWPAAC    WWPAYT           Pay to         148404
261900200610     C                     MOVE *BLANKS   WWPYFM           Pay from       148404
262000200610     C                     ELSE                                           148404
262100200610     C                     MOVE *BLANKS   WWPAYT           Pay to
262200200610     C                     MOVELWWPAAC    WWPYFM           Pay from
262300200610     C                     ENDIF                                          148404
262400200610     C                     MOVE MSCHTP    WALLOC
262500200610      *
262600200610      ***  Setup Default fields for a new Trade
262700200610      *
262800200610     C                     EXSR #WTRAD
262900200610     C                     MOVE WKTRRF    WWTRR2
263000200610      *
263100200610     C           MCCOTP    WHEQ 'C'
263200200610      *
263300200610      ***  If Cust/Book indicator is 'C'
263400200610      *
263500200610      ***  Setup specific field for this processing type
263600200610      ***  Generate a Depot Movement for the customer (WO) (old position)
263700200610      *
263800200610     C                     MOVELMASESN    WWSESN    P      old security
263900200610     C                     MOVELMASESN    WKSESN    P
264000200610     C                     MOVE 'WO'      WWDPMV           movement type
264100200610      *
264200200610      ***  Access to Security Details
264300200610      *
264400200610     C                     EXSR #SECTN
264500200610      *
264600200610     C                     MOVE WONMCY    WWNMCY
264700200610      *
264800200610     C                     Z-ADDWWPRIC    WWMKTP           Average Price
264900200610     C                     Z-ADDMCEXPO    WWDPNA           ex-date position
265000200610     C                     MOVE MSCHTP    WALLOC
265100200610      *                                                                   148404
265200200610     C           WWDPNA    IFLT *ZEROS                                    148404
265300200610     C                     Z-SUBWWDPNA    WWDPNA                          148404
265400200610     C                     MOVE 'WI'      WWDPMV                          148404
265500200610     C                     ENDIF                                          148404
265600200610      *
265700200610      ***  Setup Default fields
265800200610      ***  And generate a new depot movement
265900200610      *
266000200610     C                     EXSR #SDPMV
266100200610     C                     MOVE WKTRRF    WWTRR1
266200200610      *
266300200610      ***  Setup specific field for this processing type
266400200610      ***  Generate a Depot Movement for the customer (WI) (new position)
266500200610      *
266600200610     C                     MOVELMCSESN    WWSESN    P      new security
266700200610     C                     MOVELMCSESN    WKSESN    P      new security
266800200610     C                     MOVE 'WI'      WWDPMV           movement type
266900200610      *
267000200610      ***  Access to Security Details
267100200610      *
267200200610     C                     EXSR #SECTN
267300200610      *
267400200610     C                     MOVE WNNMCY    WWNMCY
267500200610      *
267600200610     C                     MOVE '-'       WWSIGN  1        Sign
267700200610     C                     EXSR #CAPR
267800200610     C                     Z-ADDWWCAPR    WWMKTP           calculated price
267900200610     C                     Z-ADDMCASTA    WWDPNA           actual stock allocation
268000200610     C                     MOVE MSCHTP    WALLOC
268100200610      *                                                                   148404
268200200610     C           WWDPNA    IFLT *ZEROS                                    148404
268300200610     C                     Z-SUBWWDPNA    WWDPNA                          148404
268400200610     C                     MOVE 'WO'      WWDPMV                          148404
268500200610     C                     ENDIF                                          148404
268600200610      *
268700200610      ***  Setup Default fields
268800200610      ***  And generate a new depot movement
268900200610      *
269000200610     C                     EXSR #SDPMV
269100200610     C                     MOVE WKTRRF    WWTRR2
269200200610     C                     ENDSL                           Check cust/book ind.
269300200610      *
269400200610     C                     ENDSR
269500200610      *
269600200610      *****************************************************************
269700200610      /EJECT
269800200610      *****************************************************************
269900200610      *  #PRFRA -  Generate Trades/Depot Movements                    *
270000200610      *  ------    for processing type 'FR' and Add                   *
270100200610      *  Called by : #PRFR                                            *
270200200610      *  Calls     : #SECTN #ACOAT #WTRAD #SDPMV                      *
270300200610      *****************************************************************
270400200610      *
270500200610     C           #PRFRA    BEGSR
270600200610      *
270700200610      ***  Check Cust/Book indicator
270800200610      *
270900200610     C                     SELEC
271000200610      *
271100200610      ***  If Cust/Book indicator is 'B'
271200200610      *
271300200610     C           MCCOTP    WHEQ 'B'
271400200610      *
271500200610      ***  Setup specific field for this processing type
271600200610      ***  Generate a Trade Purchase for the book
271700200610      *
271800200610     C                     MOVELMCSESN    WWSESN    P      new security
271900200610     C                     MOVELMCSESN    WKSESN    P
272000200610     C                     MOVE 'TP'      WWTDTP           Purchase
272100200610     C                     Z-ADDMCASTA    WWNOML           Actual Stock Allocation
272200200610     C                     Z-ADD*ZERO     WWTPDY           Price=0
272300200610      *                                                                   148404
272400200610     C           WWNOML    IFLT *ZEROS                                    148404
272500200610     C                     MOVE 'Y'       WWINVR  1                       148404
272600200610     C                     Z-SUBWWNOML    WWNOML                          148404
272700200610     C                     MOVE 'TS'      WWTDTP                          148404
272800200610     C                     ELSE                                           148404
272900200610     C                     MOVE 'N'       WWINVR                          148404
273000200610     C                     ENDIF                                          148404
273100200610      *
273200200610      ***  Access to Security Details
273300200610      *
273400200610     C                     EXSR #SECTN
273500200610      *
273600200610     C                     MOVE WNNMCY    WWNMCY
273700200610      *
273800200610      ***  Access to Corporate Action Type Details to retrieve
273900200610      ***  Settlement Account Code
274000200610      *
274100200610     C                     MOVE MCCOAT    WKCOAT
274200200610     C                     EXSR #ACOAT
274300200610      *
274400200610     C                     MOVE BVCOTC    WWCUST
274500200610     C                     MOVE MMACOD    WWSTAC           Settl. Account Code
274600200610     C                     MOVE '01'      WWSTSQ           Settl. Account Seq.
274700200610     C           WWINVR    IFEQ 'Y'                                       148404
274800200610     C                     MOVELWWPAAC    WWPAYT           Pay to         148404
274900200610     C                     MOVE *BLANKS   WWPYFM           Pay from       148404
275000200610     C                     ELSE                                           148404
275100200610     C                     MOVE *BLANKS   WWPAYT           Pay to
275200200610     C                     MOVELWWPAAC    WWPYFM           Pay from
275300200610     C                     ENDIF                                          148404
275400200610     C                     MOVE MSCHTP    WALLOC
275500200610      *
275600200610      ***  Setup Default fields for a new Trade
275700200610      *
275800200610     C                     EXSR #WTRAD
275900200610     C                     MOVE WKTRRF    WWTRR1
276000200610      *
276100200610     C           MCCOTP    WHEQ 'C'
276200200610      *
276300200610      ***  If Cust/Book indicator is 'C'
276400200610      *
276500200610      ***  Setup specific field for this processing type
276600200610      ***  Generate a Depot Movement for the customer (WI) (new position)
276700200610      *
276800200610     C                     MOVELMCSESN    WWSESN    P      new security
276900200610     C                     MOVELMCSESN    WKSESN    P
277000200610     C                     MOVE 'WI'      WWDPMV           movement type
277100200610     C                     Z-ADD*ZERO     WWMKTP           Price=0
277200200610     C                     Z-ADDMCASTA    WWDPNA           actual stock allocation
277300200610      *                                                                   148404
277400200610     C           WWDPNA    IFLT *ZEROS                                    148404
277500200610     C                     Z-SUBWWDPNA    WWDPNA                          148404
277600200610     C                     MOVE 'WO'      WWDPMV                          148404
277700200610     C                     ENDIF                                          148404
277800200610      *
277900200610      ***  Access to Security Details
278000200610      *
278100200610     C                     EXSR #SECTN
278200200610      *
278300200610     C                     MOVE WNNMCY    WWNMCY
278400200610      *
278500200610     C                     MOVE MSCHTP    WALLOC
278600200610      *
278700200610      ***  Setup Default fields
278800200610      ***  And generate a new depot movement
278900200610      *
279000200610     C                     EXSR #SDPMV
279100200610     C                     MOVE WKTRRF    WWTRR1
279200200610     C                     ENDSL                           Check cust/book ind.
279300200610      *
279400200610     C                     ENDSR
279500200610      *
279600200610      *****************************************************************
279700200610      /EJECT
279800200610      *****************************************************************
279900200610      *  #PRCR -  Check processing for type 'CR'                      *
280000200610      *  -----                                                        *
280100200610      *  Called by : #PDPTY                                           *
280200200610      *  Calls     : #PRCRR #PRCRA                                    *
280300200610      *****************************************************************
280400200610      *
280500200610     C           #PRCR     BEGSR
280600200610      *
280700200610     C                     SELEC
280800200610      *
280900200610      ***  Processing type 'CR' and Replace
281000200610      *
281100200610     C*****      MEADRE    WHEQ 'R'                                       137881
281200200610     C           MHADRE    WHEQ 'R'                                       137881
281300200610     C                     EXSR #PRCRR
281400200610      *
281500200610      ***  Processing type 'CR' and Add
281600200610      *
281700200610     C*****      MEADRE    WHEQ 'A'                                       137881
281800200610     C           MHADRE    WHEQ 'A'                                       137881
281900200610     C                     EXSR #PRCRA
282000200610     C                     ENDSL
282100200610      *
282200200610     C                     ENDSR
282300200610      *
282400200610      *****************************************************************
282500200610      /EJECT
282600200610      *****************************************************************
282700200610      *  #PRCRR -  Generate Trades/Depot Movements                    *
282800200610      *  ------    for processing type 'CR' and Replace               *
282900200610      *  Called by : #PRCR                                            *
283000200610      *  Calls     : #SECTN #ACOAT #WTRAD #SDPMV                      *
283100200610      *****************************************************************
283200200610      *
283300200610     C           #PRCRR    BEGSR
283400200610      *
283500200610      ***  Check Cust/Book indicator
283600200610      *
283700200610     C                     SELEC
283800200610      *
283900200610      ***  If Cust/Book indicator is 'B'
284000200610      *
284100200610     C           MCCOTP    WHEQ 'B'
284200200610     C                     SETOF                     52                   165216
284300200610     C********** MACOAT    IFEQ 'SO'                               165216 186486
284400200610     C********** MCBOOK    IFEQ WXBOOK                                                 186486 215278
284500200610     C           MAPTYP    IFEQ 'CR'                                                          215278
284600200610     C           MCBOOK    ANDEQWXBOOK                                                        215278
284700200610     C           MCBSEC    ANDEQ*BLANKS                                   165216
284800200610     C                     SETON                     52                   165216
284900200610     C                     END                                            165216
285000200610      *
285100200610      ***  Setup specific field for this processing type
285200200610      ***  Generate a Trade Sale for the book (old position)
285300200610      *
285400200610     C           *IN52     IFEQ '0'                                       165216
285500200610     C                     MOVELMCBOOK    WXBOOK                          186486
285600200610     C                     MOVELMASESN    WWSESN    P      old security
285700200610     C                     MOVELMASESN    WKSESN    P
285800200610     C                     MOVE 'TS'      WWTDTP           Sale
285900200610     C                     Z-ADDMCEXPO    WWNOML           Ex-Date position
286000200610     C                     Z-ADDWWAVR1    WWTPDY           Average Price (1)
286100200610      *                                                                   148404
286200200610     C           WWNOML    IFLT *ZEROS                                    148404
286300200610     C                     MOVE 'Y'       WWINVR  1                       148404
286400200610     C                     Z-SUBWWNOML    WWNOML                          148404
286500200610     C                     MOVE 'TP'      WWTDTP                          148404
286600200610     C                     ELSE                                           148404
286700200610     C                     MOVE 'N'       WWINVR                          148404
286800200610     C                     ENDIF                                          148404
286900200610      *
287000200610      ***  Access to Security Details
287100200610      *
287200200610     C                     EXSR #SECTN
287300200610      *
287400200610     C                     MOVE WONMCY    WWNMCY
287500200610      *
287600200610      ***  Access to Corporate Action Type Details to retrieve
287700200610      ***  Settlement Account Code
287800200610      *
287900200610     C                     MOVE MACOAT    WKCOAT
288000200610     C                     EXSR #ACOAT
288100200610      *
288200200610     C                     MOVE BVCOTC    WWCUST
288300200610     C                     MOVE MMACOD    WWSTAC           Settl. Account Code
288400200610     C                     MOVE '01'      WWSTSQ           Settl. Account Seq.
288500200610     C           WWINVR    IFEQ 'Y'                                       148404
288600200610     C                     MOVE *BLANKS   WWPAYT           Pay to         148404
288700200610     C                     MOVELWWPAAC    WWPYFM           Pay from       148404
288800200610     C                     ELSE                                           148404
288900200610     C                     MOVELWWPAAC    WWPAYT           Pay to
289000200610     C                     MOVE *BLANKS   WWPYFM           Pay from
289100200610     C                     ENDIF                                          148404
289200200610     C                     MOVE MSCHTP    WALLOC
289300200610      *
289400200610      ***  Setup Default fields for a new Trade
289500200610      *
289600200610     C                     EXSR #WTRAD
289700200610     C                     MOVE WKTRRF    WWTRR1
289800200610     C                     END                                            165216
289900200610      *
290000200610      ***  Setup specific field for this processing type
290100200610      ***  Generate a Trade Purchase for the book (old position)
290200200610      *
290300200610     C                     MOVELMCSESN    WWSESN    P      new security
290400200610     C                     MOVELMCSESN    WKSESN    P
290500200610      *
290600200610      ***  Access to Security Details
290700200610      *
290800200610     C                     EXSR #SECTN
290900200610     C                     MOVE 'TP'      WWTDTP           Purchase
291000200610     C                     Z-ADDMCASTA    WWNOML           actual stock allocation
291100200610     C                     Z-ADD1         Y       20
291200200610     C           WWSESN    LOKUPNSEC,Y                   89
291300200610     C           *IN89     IFEQ *ON
291400200610     C                     Z-ADDAVPR,Y    WWTPDY           Average price (2)
291500200610     C                     ELSE
291600200610     C                     Z-ADD*ZERO     WWTPDY
291700200610     C                     ENDIF
291800200610      *                                                                   148404
291900200610     C           WWNOML    IFLT *ZEROS                                    148404
292000200610     C                     MOVE 'Y'       WWINVR  1                       148404
292100200610     C                     Z-SUBWWNOML    WWNOML                          148404
292200200610     C                     MOVE 'TS'      WWTDTP                          148404
292300200610     C                     ELSE                                           148404
292400200610     C                     MOVE 'N'       WWINVR                          148404
292500200610     C                     ENDIF                                          148404
292600200610      *
292700200610     C                     MOVE WNNMCY    WWNMCY
292800200610      *
292900200610      ***  Access to Corporate Action Type Details to retrieve
293000200610      ***  Settlement Account Code
293100200610      *
293200200610     C                     MOVE MCCOAT    WKCOAT
293300200610     C                     EXSR #ACOAT
293400200610      *
293500200610     C                     MOVE BVCOTC    WWCUST
293600200610     C                     MOVE MMACOD    WWSTAC           Settl. Account Code
293700200610     C                     MOVE '01'      WWSTSQ           Settl. Account Seq.
293800200610     C           WWINVR    IFEQ 'Y'                                       148404
293900200610     C                     MOVELWWPAAC    WWPAYT           Pay to         148404
294000200610     C                     MOVE *BLANKS   WWPYFM           Pay from       148404
294100200610     C                     ELSE                                           148404
294200200610     C                     MOVE *BLANKS   WWPAYT           Pay to
294300200610     C                     MOVELWWPAAC    WWPYFM           Pay from
294400200610     C                     ENDIF                                          148404
294500200610     C                     MOVE MSCHTP    WALLOC
294600200610      *
294700200610      ***  Setup Default fields for a new Trade
294800200610      *
294900200610     C                     EXSR #WTRAD
295000200610     C                     MOVE WKTRRF    WWTRR2
295100200610      *
295200200610     C           MCCOTP    WHEQ 'C'
295300200610      *
295400200610      ***  If Cust/Book indicator is 'C'
295500200610     C                     SETOF                     51                   165216
295600200610     C********** MACOAT    IFEQ 'SO'                               165216 186486
295700200610     C********** MCBSEC    ANDEQ*BLANKS                            165216 186486
295800200610     C********** MCBSEC    IFEQ *BLANKS                                                186486 215278
295900200610     C           MAPTYP    IFEQ 'CR'                                                          215278
296000200610     C           MCBSEC    ANDEQ*BLANKS                                                       215278
296100200610     C                     SETON                     51                   165216
296200200610     C                     END                                            165216
296300200610      *
296400200610      ***  Setup specific field for this processing type
296500200610      ***  Generate a Depot Movement for the customer (WO) (old position)
296600200610      *
296700200610     C           *IN51     IFEQ '0'                                       165216
296800200610     C                     MOVELMASESN    WWSESN    P      old security
296900200610     C                     MOVELMASESN    WKSESN    P
297000200610     C                     MOVE 'WO'      WWDPMV           movement type
297100200610     C                     Z-ADDWWAVR1    WWMKTP           Average price (1)
297200200610     C                     Z-ADDMCEXPO    WWDPNA           ex-date position
297300200610      *                                                                   148404
297400200610     C           WWDPNA    IFLT *ZEROS                                    148404
297500200610     C                     Z-SUBWWDPNA    WWDPNA                          148404
297600200610     C                     MOVE 'WI'      WWDPMV                          148404
297700200610     C                     ENDIF                                          148404
297800200610      *
297900200610      ***  Access to Security Details
298000200610      *
298100200610     C                     EXSR #SECTN
298200200610      *
298300200610     C                     MOVE WONMCY    WWNMCY
298400200610      *
298500200610     C                     MOVE MSCHTP    WALLOC
298600200610      *
298700200610      ***  Setup Default fields
298800200610      ***  And generate a new depot movement
298900200610      *
299000200610     C                     EXSR #SDPMV
299100200610     C                     MOVE WKTRRF    WWTRR1
299200200610     C                     END                                            165216
299300200610      *
299400200610      ***  Setup specific field for this processing type
299500200610      ***  Generate a Depot Movement for the customer (WI) (old position)
299600200610      *
299700200610     C                     MOVELMCSESN    WWSESN    P      new security
299800200610     C                     MOVELMCSESN    WKSESN    P
299900200610      *
300000200610      ***  Access to Security Details
300100200610      *
300200200610     C                     EXSR #SECTN
300300200610     C                     MOVE 'WI'      WWDPMV           movement type
300400200610     C                     Z-ADD1         Y       20
300500200610     C           WWSESN    LOKUPNSEC,Y                   89
300600200610     C           *IN89     IFEQ *ON
300700200610     C                     Z-ADDAVPR,Y    WWMKTP           Average price (2)
300800200610     C                     ELSE
300900200610     C                     Z-ADD*ZERO     WWMKTP
301000200610     C                     ENDIF
301100200610     C                     Z-ADDMCASTA    WWDPNA           actual stock allocation
301200200610      *                                                                   148404
301300200610     C           WWDPNA    IFLT *ZEROS                                    148404
301400200610     C                     Z-SUBWWDPNA    WWDPNA                          148404
301500200610     C                     MOVE 'WO'      WWDPMV                          148404
301600200610     C                     ENDIF                                          148404
301700200610      *
301800200610     C                     MOVE WNNMCY    WWNMCY
301900200610     C                     MOVE MSCHTP    WALLOC
302000200610      *
302100200610      ***  Setup Default fields
302200200610      ***  And generate a new depot movement
302300200610      *
302400200610     C                     EXSR #SDPMV
302500200610     C                     MOVE WKTRRF    WWTRR2
302600200610     C                     ENDSL                           Check cust/book ind.
302700200610      *
302800200610     C                     ENDSR
302900200610      *
303000200610      *****************************************************************
303100200610      /EJECT
303200200610      *****************************************************************
303300200610      *  #PRCRA -  Generate Trades/Depot Movements                    *
303400200610      *  ------    for processing type 'CR' and Add                   *
303500200610      *  Called by : #PRCR                                            *
303600200610      *  Calls     : #SECTN #ACOAT #WTRAD #SDPMV                      *
303700200610      *****************************************************************
303800200610      *
303900200610     C           #PRCRA    BEGSR
304000200610      *
304100200610      ***  Check Cust/Book indicator
304200200610      *
304300200610     C                     SELEC
304400200610      *
304500200610      ***  If Cust/Book indicator is 'B'
304600200610      *
304700200610     C           MCCOTP    WHEQ 'B'
304800200610     C                     SETOF                     52                                       215278
304900200610     C           MAPTYP    IFEQ 'CR'                                                          215278
305000200610     C           MCBOOK    ANDEQWXBOOK                                                        215278
305100200610     C           MCBSEC    ANDEQ*BLANKS                                                       215278
305200200610     C                     SETON                     52                                       215278
305300200610     C                     END                                                                215278
305400200610      *
305500200610      ***  Setup specific field for this processing type
305600200610      ***  Generate a Trade Sale for the book (old position)
305700200610      *
305800200610     C           *IN52     IFEQ '0'                                                           215278
305900200610     C                     MOVELMCBOOK    WXBOOK                                              215278
306000200610     C                     MOVELMASESN    WWSESN    P      old security
306100200610     C                     MOVELMASESN    WKSESN    P
306200200610     C                     MOVE 'TS'      WWTDTP           Sale
306300200610     C                     Z-ADDMCEXPO    WWNOML           Ex-Date position
306400200610     C                     Z-ADDWWAVR1    WWTPDY           Average price (1)
306500200610      *                                                                   148404
306600200610     C           WWNOML    IFLT *ZEROS                                    148404
306700200610     C                     MOVE 'Y'       WWINVR  1                       148404
306800200610     C                     Z-SUBWWNOML    WWNOML                          148404
306900200610     C                     MOVE 'TP'      WWTDTP                          148404
307000200610     C                     ELSE                                           148404
307100200610     C                     MOVE 'N'       WWINVR                          148404
307200200610     C                     ENDIF                                          148404
307300200610      *
307400200610      ***  Access to Security Details
307500200610      *
307600200610     C                     EXSR #SECTN
307700200610      *
307800200610     C                     MOVE WONMCY    WWNMCY
307900200610      *
308000200610      ***  Access to Corporate Action Type Details to retrieve
308100200610      ***  Settlement Account Code
308200200610      *
308300200610     C                     MOVE MACOAT    WKCOAT
308400200610     C                     EXSR #ACOAT
308500200610      *
308600200610     C                     MOVE BVCOTC    WWCUST
308700200610     C                     MOVE MMACOD    WWSTAC           Settl. Account Code
308800200610     C                     MOVE '01'      WWSTSQ           Settl. Account Seq.
308900200610     C           WWINVR    IFEQ 'Y'                                       148404
309000200610     C                     MOVE *BLANKS   WWPAYT           Pay to         148404
309100200610     C                     MOVELWWPAAC    WWPYFM           Pay from       148404
309200200610     C                     ELSE                                           148404
309300200610     C                     MOVELWWPAAC    WWPAYT           Pay to
309400200610     C                     MOVE *BLANKS   WWPYFM           Pay from
309500200610     C                     ENDIF                                          148404
309600200610     C                     MOVE MSCHTP    WALLOC
309700200610      *
309800200610      ***  Setup Default fields for a new Trade
309900200610      *
310000200610     C                     EXSR #WTRAD
310100200610     C                     MOVE WKTRRF    WWTRR1
310200200610      *
310300200610      ***  Setup specific field for this processing type
310400200610      ***  Generate a Trade Purchase for the book (old position)
310500200610      *
310600200610     C                     MOVELMASESN    WWSESN    P      Event security
310700200610     C                     MOVELMASESN    WKSESN    P
310800200610     C                     MOVE 'TP'      WWTDTP           Purchase
310900200610     C                     Z-ADDMCEXPO    WWNOML           Ex-Date position
311000200610     C                     Z-ADD1         Y       20
311100200610     C           WWSESN    LOKUPNSEC,Y                   89
311200200610     C           *IN89     IFEQ *ON
311300200610     C                     Z-ADDAVPR,Y    WWTPDY           Average price (2)
311400200610     C                     ELSE
311500200610     C                     Z-ADD*ZERO     WWTPDY
311600200610     C                     ENDIF
311700200610      *                                                                   148404
311800200610     C           WWNOML    IFLT *ZEROS                                    148404
311900200610     C                     MOVE 'Y'       WWINVR  1                       148404
312000200610     C                     Z-SUBWWNOML    WWNOML                          148404
312100200610     C                     MOVE 'TS'      WWTDTP                          148404
312200200610     C                     ELSE                                           148404
312300200610     C                     MOVE 'N'       WWINVR                          148404
312400200610     C                     ENDIF                                          148404
312500200610      *
312600200610      ***  Access to Security Details
312700200610      *
312800200610     C                     EXSR #SECTN
312900200610      *
313000200610     C                     MOVE WONMCY    WWNMCY
313100200610      *
313200200610      ***  Access to Corporate Action Type Details to retrieve
313300200610      ***  Settlement Account Code
313400200610      *
313500200610     C                     MOVE MCCOAT    WKCOAT
313600200610     C                     EXSR #ACOAT
313700200610      *
313800200610     C                     MOVE BVCOTC    WWCUST
313900200610     C                     MOVE MMACOD    WWSTAC           Settl. Account Code
314000200610     C                     MOVE '01'      WWSTSQ           Settl. Account Seq.
314100200610     C           WWINVR    IFEQ 'Y'                                       148404
314200200610     C                     MOVELWWPAAC    WWPAYT           Pay to         148404
314300200610     C                     MOVE *BLANKS   WWPYFM           Pay from       148404
314400200610     C                     ELSE                                           148404
314500200610     C                     MOVE *BLANKS   WWPAYT           Pay to
314600200610     C                     MOVELWWPAAC    WWPYFM           Pay from
314700200610     C                     ENDIF                                          148404
314800200610     C                     MOVE MSCHTP    WALLOC
314900200610      *
315000200610      ***  Setup Default fields for a new Trade
315100200610      *
315200200610     C                     EXSR #WTRAD
315300200610     C                     MOVE WKTRRF    WWTRR2
315400200610     C                     END                                                                215278
315500200610      *
315600200610      ***  Setup specific field for this processing type
315700200610      ***  Generate a Trade Purchase for the book (new position)
315800200610      *
315900200610     C                     MOVELMCSESN    WWSESN    P      new security
316000200610     C                     MOVELMCSESN    WKSESN    P
316100200610      *
316200200610      ***  Access to Security Details
316300200610      *
316400200610     C                     EXSR #SECTN
316500200610     C                     MOVE 'TP'      WWTDTP           Purchase
316600200610     C                     Z-ADDMCASTA    WWNOML           Actual stock allocation
316700200610     C                     Z-ADD1         Y       20
316800200610     C           WWSESN    LOKUPNSEC,Y                   89
316900200610     C           *IN89     IFEQ *ON
317000200610     C                     Z-ADDAVPR,Y    WWTPDY           Average price (2)
317100200610     C                     ELSE
317200200610     C                     Z-ADD*ZERO     WWTPDY
317300200610     C                     ENDIF
317400200610      *
317500200610     C                     MOVE WNNMCY    WWNMCY
317600200610      *                                                                   148404
317700200610     C           WWNOML    IFLT *ZEROS                                    148404
317800200610     C                     MOVE 'Y'       WWINVR  1                       148404
317900200610     C                     Z-SUBWWNOML    WWNOML                          148404
318000200610     C                     MOVE 'TS'      WWTDTP                          148404
318100200610     C                     ELSE                                           148404
318200200610     C                     MOVE 'N'       WWINVR                          148404
318300200610     C                     ENDIF                                          148404
318400200610      *
318500200610      ***  Access to Corporate Action Type Details to retrieve
318600200610      ***  Settlement Account Code
318700200610      *
318800200610     C                     MOVE MCCOAT    WKCOAT
318900200610     C                     EXSR #ACOAT
319000200610      *
319100200610     C                     MOVE BVCOTC    WWCUST
319200200610     C                     MOVE MMACOD    WWSTAC           Settl. Account Code
319300200610     C                     MOVE '01'      WWSTSQ           Settl. Account Seq.
319400200610     C           WWINVR    IFEQ 'Y'                                       148404
319500200610     C                     MOVELWWPAAC    WWPAYT           Pay to         148404
319600200610     C                     MOVE *BLANKS   WWPYFM           Pay from       148404
319700200610     C                     ELSE                                           148404
319800200610     C                     MOVE *BLANKS   WWPAYT           Pay to
319900200610     C                     MOVELWWPAAC    WWPYFM           Pay from
320000200610     C                     ENDIF                                          148404
320100200610     C                     MOVE MSCHTP    WALLOC
320200200610      *
320300200610      ***  Setup Default fields for a new Trade
320400200610      *
320500200610     C                     EXSR #WTRAD
320600200610     C                     MOVE WKTRRF    WWTRR3
320700200610      *
320800200610     C           MCCOTP    WHEQ 'C'
320900200610      *
321000200610      ***  If Cust/Book indicator is 'C'
321100200610      *
321200200610     C                     SETOF                     51                                       215278
321300200610     C           MAPTYP    IFEQ 'CR'                                                          215278
321400200610     C           MCBSEC    ANDEQ*BLANKS                                                       215278
321500200610     C                     SETON                     51                                       215278
321600200610     C                     END                                                                215278
321700200610      *                                                                                       215278
321800200610      ***  Setup specific field for this processing type
321900200610      ***  Generate a Depot Movement for the customer (WO) (old position)
322000200610      *
322100200610     C           *IN51     IFEQ '0'                                                           215278
322200200610     C                     MOVELMASESN    WWSESN    P      old security
322300200610     C                     MOVELMASESN    WKSESN    P
322400200610     C                     MOVE 'WO'      WWDPMV           movement type
322500200610     C                     Z-ADDWWAVR1    WWMKTP           Average price (1)
322600200610     C                     Z-ADDMCEXPO    WWDPNA           ex-date position
322700200610      *                                                                   148404
322800200610     C           WWDPNA    IFLT *ZEROS                                    148404
322900200610     C                     Z-SUBWWDPNA    WWDPNA                          148404
323000200610     C                     MOVE 'WI'      WWDPMV                          148404
323100200610     C                     ENDIF                                          148404
323200200610      *
323300200610      ***  Access to Security Details
323400200610      *
323500200610     C                     EXSR #SECTN
323600200610      *
323700200610     C                     MOVE WONMCY    WWNMCY
323800200610     C                     MOVE MSCHTP    WALLOC
323900200610      *
324000200610      ***  Setup Default fields
324100200610      ***  And generate a new depot movement
324200200610      *
324300200610     C                     EXSR #SDPMV
324400200610     C                     MOVE WKTRRF    WWTRR1
324500200610      *
324600200610      ***  Setup specific field for this processing type
324700200610      ***  Generate a Depot Movement for the customer (WI) (old position)
324800200610      *
324900200610     C                     MOVELMASESN    WWSESN    P      Event security
325000200610     C                     MOVELMASESN    WKSESN    P
325100200610     C                     MOVE 'WI'      WWDPMV           movement type
325200200610      *
325300200610     C                     Z-ADD1         Y       20
325400200610     C           WWSESN    LOKUPNSEC,Y                   89
325500200610     C           *IN89     IFEQ *ON
325600200610     C                     Z-ADDAVPR,Y    WWMKTP           Average price (2)
325700200610     C                     ELSE
325800200610     C                     Z-ADD*ZERO     WWMKTP
325900200610     C                     ENDIF
326000200610     C                     Z-ADDMCEXPO    WWDPNA           ex-date position
326100200610      *                                                                   148404
326200200610     C           WWDPNA    IFLT *ZEROS                                    148404
326300200610     C                     Z-SUBWWDPNA    WWDPNA                          148404
326400200610     C                     MOVE 'WO'      WWDPMV                          148404
326500200610     C                     ENDIF                                          148404
326600200610      *
326700200610      ***  Access to Security Details
326800200610      *
326900200610     C                     EXSR #SECTN
327000200610      *
327100200610     C                     MOVE WONMCY    WWNMCY
327200200610     C                     MOVE MSCHTP    WALLOC
327300200610      *
327400200610      ***  Setup Default fields
327500200610      ***  And generate a new depot movement
327600200610      *
327700200610     C                     EXSR #SDPMV
327800200610     C                     MOVE WKTRRF    WWTRR2
327900200610     C                     END                                                                215278
328000200610      *
328100200610      ***  Setup specific field for this processing type
328200200610      ***  Generate a Depot Movement for the customer (WI) (new position)
328300200610      *
328400200610     C                     MOVELMCSESN    WWSESN    P      new security
328500200610     C                     MOVELMCSESN    WKSESN    P
328600200610      *
328700200610      ***  Access to Security Details
328800200610      *
328900200610     C                     EXSR #SECTN
329000200610     C                     MOVE 'WI'      WWDPMV           movement type
329100200610      *
329200200610     C                     Z-ADD1         Y       20
329300200610     C           WWSESN    LOKUPNSEC,Y                   89
329400200610     C           *IN89     IFEQ *ON
329500200610     C                     Z-ADDAVPR,Y    WWMKTP           Average price (2)
329600200610     C                     ELSE
329700200610     C                     Z-ADD*ZERO     WWMKTP
329800200610     C                     ENDIF
329900200610     C                     Z-ADDMCASTA    WWDPNA           actual stock allocation
330000200610      *                                                                   148404
330100200610     C           WWDPNA    IFLT *ZEROS                                    148404
330200200610     C                     Z-SUBWWDPNA    WWDPNA                          148404
330300200610     C                     MOVE 'WO'      WWDPMV                          148404
330400200610     C                     ENDIF                                          148404
330500200610      *
330600200610     C                     MOVE WNNMCY    WWNMCY
330700200610     C                     MOVE MSCHTP    WALLOC
330800200610      *
330900200610      ***  Setup Default fields
331000200610      ***  And generate a new depot movement
331100200610      *
331200200610     C                     EXSR #SDPMV
331300200610     C                     MOVE WKTRRF    WWTRR3
331400200610     C                     ENDSL                           Check cust/book ind.
331500200610      *
331600200610     C                     ENDSR
331700200610      *
331800200610      *****************************************************************
331900200610      /EJECT
332000200610      *****************************************************************
332100200610      *  #PRCE -  Generate Trades/Depot Movements                     *
332200200610      *  -----    for processing type 'CE'                            *
332300200610      *           (Same as processing type 'CR' and Add               *
332400200610      *  Called by : #PDPTY                                           *
332500200610      *  Calls     : #SECTN #ACOAT #WTRAD #SDPMV                      *
332600200610      *****************************************************************
332700200610      *
332800200610     C           #PRCE     BEGSR
332900200610      *
333000200610      ***  Check Cust/Book indicator
333100200610      *
333200200610     C                     SELEC
333300200610      *
333400200610      ***  If Cust/Book indicator is 'B'
333500200610      *
333600200610     C           MCCOTP    WHEQ 'B'
333700200610      *
333800200610      ***  Setup specific field for this processing type
333900200610      ***  Generate a Trade Sale for the book (old position)
334000200610      *
334100200610     C                     MOVELMASESN    WWSESN    P      old security
334200200610     C                     MOVELMASESN    WKSESN    P      old security
334300200610     C                     MOVE 'TS'      WWTDTP           Sale
334400200610     C                     Z-ADDMCEXPO    WWNOML           Ex-Date position
334500200610     C                     Z-ADDWWAVR1    WWTPDY           Average Price (1)
334600200610      *                                                                   148404
334700200610     C           WWNOML    IFLT *ZEROS                                    148404
334800200610     C                     MOVE 'Y'       WWINVR  1                       148404
334900200610     C                     Z-SUBWWNOML    WWNOML                          148404
335000200610     C                     MOVE 'TP'      WWTDTP                          148404
335100200610     C                     ELSE                                           148404
335200200610     C                     MOVE 'N'       WWINVR                          148404
335300200610     C                     ENDIF                                          148404
335400200610      *
335500200610      ***  Access to Security Details
335600200610      *
335700200610     C                     EXSR #SECTN
335800200610      *
335900200610     C                     MOVE WONMCY    WWNMCY
336000200610      *
336100200610      ***  Access to Corporate Action Type Details to retrieve
336200200610      ***  Settlement Account Code
336300200610      *
336400200610     C                     MOVE MACOAT    WKCOAT
336500200610     C                     EXSR #ACOAT
336600200610      *
336700200610     C                     MOVE BVCOTC    WWCUST
336800200610     C                     MOVE MMACOD    WWSTAC           Settl. Account Code
336900200610     C                     MOVE '01'      WWSTSQ           Settl. Account Seq.
337000200610     C           WWINVR    IFEQ 'Y'                                       148404
337100200610     C                     MOVE *BLANKS   WWPAYT           Pay to         148404
337200200610     C                     MOVELWWPAAC    WWPYFM           Pay from       148404
337300200610     C                     ELSE                                           148404
337400200610     C                     MOVELWWPAAC    WWPAYT           Pay to
337500200610     C                     MOVE *BLANKS   WWPYFM           Pay from
337600200610     C                     ENDIF                                          148404
337700200610     C                     MOVE MSCHTP    WALLOC
337800200610      *
337900200610      ***  Setup Default fields for a new Trade
338000200610      *
338100200610     C                     EXSR #WTRAD
338200200610     C                     MOVE WKTRRF    WWTRR1
338300200610      *
338400200610      ***  Setup specific field for this processing type
338500200610      ***  Generate a Trade Purchase for the book (old position)
338600200610      *
338700200610     C                     MOVELMASESN    WWSESN    P      Event security
338800200610     C                     MOVELMASESN    WKSESN    P
338900200610     C                     MOVE 'TP'      WWTDTP           Purchase
339000200610     C                     Z-ADDMCEXPO    WWNOML           Ex-Date position
339100200610     C                     Z-ADD1         Y       20
339200200610     C           WWSESN    LOKUPNSEC,Y                   89
339300200610     C           *IN89     IFEQ *ON
339400200610     C                     Z-ADDAVPR,Y    WWTPDY           Average price (2)
339500200610     C                     ELSE
339600200610     C                     Z-ADD*ZERO     WWTPDY
339700200610     C                     ENDIF
339800200610      *                                                                   148404
339900200610     C           WWNOML    IFLT *ZEROS                                    148404
340000200610     C                     MOVE 'Y'       WWINVR  1                       148404
340100200610     C                     Z-SUBWWNOML    WWNOML                          148404
340200200610     C                     MOVE 'TS'      WWTDTP                          148404
340300200610     C                     ELSE                                           148404
340400200610     C                     MOVE 'N'       WWINVR                          148404
340500200610     C                     ENDIF                                          148404
340600200610      *
340700200610      ***  Access to Security Details
340800200610      *
340900200610     C                     EXSR #SECTN
341000200610      *
341100200610     C                     MOVE WONMCY    WWNMCY
341200200610      *
341300200610      ***  Access to Corporate Action Type Details to retrieve
341400200610      ***  Settlement Account Code
341500200610      *
341600200610     C                     MOVE MCCOAT    WKCOAT
341700200610     C                     EXSR #ACOAT
341800200610      *
341900200610     C                     MOVE BVCOTC    WWCUST
342000200610     C                     MOVE MMACOD    WWSTAC           Settl. Account Code
342100200610     C                     MOVE '01'      WWSTSQ           Settl. Account Seq.
342200200610     C           WWINVR    IFEQ 'Y'                                       148404
342300200610     C                     MOVELWWPAAC    WWPAYT           Pay to         148404
342400200610     C                     MOVE *BLANKS   WWPYFM           Pay from       148404
342500200610     C                     ELSE                                           148404
342600200610     C                     MOVE *BLANKS   WWPAYT           Pay to
342700200610     C                     MOVELWWPAAC    WWPYFM           Pay from
342800200610     C                     ENDIF                                          148404
342900200610     C                     MOVE MSCHTP    WALLOC
343000200610      *
343100200610      ***  Setup Default fields for a new Trade
343200200610      *
343300200610     C                     EXSR #WTRAD
343400200610     C                     MOVE WKTRRF    WWTRR2
343500200610      *
343600200610     C           MCCOTP    WHEQ 'C'
343700200610      *
343800200610      ***  If Cust/Book indicator is 'C'
343900200610      *
344000200610      ***  Setup specific field for this processing type
344100200610      ***  Generate a Depot Movement for the customer (WO) (old position)
344200200610      *
344300200610     C                     MOVELMASESN    WWSESN    P      old security
344400200610     C                     MOVELMASESN    WKSESN    P      old security
344500200610     C                     MOVE 'WO'      WWDPMV           movement type
344600200610     C                     Z-ADDWWAVR1    WWMKTP           Average Price (1)
344700200610     C                     Z-ADDMCEXPO    WWDPNA           ex-date position
344800200610      *                                                                   148404
344900200610     C           WWDPNA    IFLT *ZEROS                                    148404
345000200610     C                     Z-SUBWWDPNA    WWDPNA                          148404
345100200610     C                     MOVE 'WI'      WWDPMV                          148404
345200200610     C                     ENDIF                                          148404
345300200610      *
345400200610      ***  Access to Security Details
345500200610      *
345600200610     C                     EXSR #SECTN
345700200610      *
345800200610     C                     MOVE WONMCY    WWNMCY
345900200610     C                     MOVE MSCHTP    WALLOC
346000200610      *
346100200610      ***  Setup Default fields
346200200610      ***  And generate a new depot movement
346300200610      *
346400200610     C                     EXSR #SDPMV
346500200610     C                     MOVE WKTRRF    WWTRR1
346600200610      *
346700200610      ***  Setup specific field for this processing type
346800200610      ***  Generate a Depot Movement for the customer (WI) (old position)
346900200610      *
347000200610     C                     MOVELMASESN    WWSESN    P      Event security
347100200610     C                     MOVELMASESN    WKSESN    P
347200200610     C                     MOVE 'WI'      WWDPMV           movement type
347300200610     C                     Z-ADD1         Y       20
347400200610     C           WWSESN    LOKUPNSEC,Y                   89
347500200610     C           *IN89     IFEQ *ON
347600200610     C                     Z-ADDAVPR,Y    WWMKTP           Average price (2)
347700200610     C                     ELSE
347800200610     C                     Z-ADD*ZERO     WWMKTP
347900200610     C                     ENDIF
348000200610     C                     Z-ADDMCEXPO    WWDPNA           ex-date position
348100200610      *                                                                   148404
348200200610     C           WWDPNA    IFLT *ZEROS                                    148404
348300200610     C                     Z-SUBWWDPNA    WWDPNA                          148404
348400200610     C                     MOVE 'WO'      WWDPMV                          148404
348500200610     C                     ENDIF                                          148404
348600200610      *
348700200610      ***  Access to Security Details
348800200610      *
348900200610     C                     EXSR #SECTN
349000200610      *
349100200610     C                     MOVE WONMCY    WWNMCY
349200200610     C                     MOVE MSCHTP    WALLOC
349300200610      *
349400200610      ***  Setup Default fields
349500200610      ***  And generate a new depot movement
349600200610      *
349700200610     C                     EXSR #SDPMV
349800200610     C                     MOVE WKTRRF    WWTRR2
349900200610     C                     ENDSL                           Check cust/book ind.
350000200610      *
350100200610     C                     ENDSR
350200200610      *
350300200610      *****************************************************************
350400200610      /EJECT
350500200610      *****************************************************************
350600200610      *  #PROF -  Check processing for type 'OF'                      *
350700200610      *  -----                                                        *
350800200610      *  Called by : #PDPTY                                           *
350900200610      *  Calls     : #PROFE #PROFP                                    *
351000200610      *****************************************************************
351100200610      *
351200200610     C           #PROF     BEGSR
351300200610      *
351400200610     C                     SELEC
351500200610      *
351600200610      ***  Processing type 'OF' and Offer type 'E'
351700200610      *
351800200610     C           MIOFTY    WHEQ 'E'
351900200610     C                     EXSR #PROFE
352000200610      *
352100200610      ***  Processing type 'OF' and Purchase Offers
352200200610      ***  or Processing type 'OF' and Subscriptions
352300200610      *
352400200610     C           MIOFTY    WHEQ 'P'
352500200610     C           MIOFTY    OREQ 'S'
352600200610     C                     EXSR #PROFP
352700200610     C                     ENDSL
352800200610      *
352900200610     C                     ENDSR
353000200610      *
353100200610      *****************************************************************
353200200610      /EJECT
353300200610      *****************************************************************
353400200610      *  #PROFE -  Generate Trades/Depot Movements                    *
353500200610      *  ------    for processing type 'OF' and Exchange Offers       *
353600200610      *  Called by : #PROF                                            *
353700200610      *  Calls     : #SECTN #ACOAT #WTRAD #SDPMV                      *
353800200610      *****************************************************************
353900200610      *
354000200610     C           #PROFE    BEGSR
354100200610      *
354200200610      ***  Check Cust/Book indicator
354300200610      *
354400200610     C                     SELEC
354500200610      *
354600200610      ***  If Cust/Book indicator is 'B'
354700200610      *
354800200610     C           MCCOTP    WHEQ 'B'
354900200610      *
355000200610      ***  Setup specific field for this processing type
355100200610      ***  Generate a Trade Sale for the book (old position)
355200200610      *
355300200610     C                     MOVELMASESN    WWSESN    P      old security
355400200610     C                     MOVELMASESN    WKSESN    P
355500200610     C                     MOVE 'TS'      WWTDTP           Sale
355600200610     C*******              Z-ADDMCHOST    WWNOML           Holding Taken as stock             145872
355700200610     C*******              Z-ADDMCASTA    WWNOML           Actual Stock                145872 158451
355800200610     C***  Actual Stock Allocation divided by Number of New Shares                            158451
355900200610     C***  multiplied by Number of Old Shares                                                 158451
356000200610     C                     Z-ADD*ZEROS    WWNOML                                              158451
356100200610     C           MCASTA    DIV  MINSHA    WWNOML                                              158451
356200200610     C           WWNOML    MULT MIOSHA    WWNOML                                              158451
356300200610     C********             Z-ADDWWAVR1    WWTPDY         Average Price(1) 166599
356400200610     C                     Z-ADDWWPRIC    WWTPDY           Av Price(1)    166599
356500200610      *                                                                   148404
356600200610     C           WWNOML    IFLT *ZEROS                                    148404
356700200610     C                     MOVE 'Y'       WWINVR  1                       148404
356800200610     C                     Z-SUBWWNOML    WWNOML                          148404
356900200610     C                     MOVE 'TP'      WWTDTP                          148404
357000200610     C                     ELSE                                           148404
357100200610     C                     MOVE 'N'       WWINVR                          148404
357200200610     C                     ENDIF                                          148404
357300200610      *
357400200610      ***  Access to Security Details
357500200610      *
357600200610     C                     EXSR #SECTN
357700200610      *
357800200610     C                     MOVE WONMCY    WWNMCY
357900200610      *
358000200610      ***  Access to Corporate Action Type Details to retrieve
358100200610      ***  Settlement Account Code
358200200610      *
358300200610     C                     MOVE MACOAT    WKCOAT
358400200610     C                     EXSR #ACOAT
358500200610      *
358600200610     C                     MOVE BVCOTC    WWCUST
358700200610     C                     MOVE MMACOD    WWSTAC           Settl. Account Code
358800200610     C                     MOVE '01'      WWSTSQ           Settl. Account Seq.
358900200610     C           WWINVR    IFEQ 'Y'                                       148404
359000200610     C                     MOVE *BLANKS   WWPAYT           Pay to         148404
359100200610     C                     MOVELWWPAAC    WWPYFM           Pay from       148404
359200200610     C                     ELSE                                           148404
359300200610     C                     MOVELWWPAAC    WWPAYT           Pay to
359400200610     C                     MOVE *BLANKS   WWPYFM           Pay from
359500200610     C                     ENDIF                                          148404
359600200610     C                     MOVE MSCHTP    WALLOC
359700200610      *
359800200610      ***  Setup Default fields for a new Trade
359900200610      *
360000200610     C                     EXSR #WTRAD
360100200610     C                     MOVE WKTRRF    WWTRR1
360200200610      *
360300200610      ***  Setup specific field for this processing type
360400200610      ***  Generate a Trade Purchase for the book (new position)
360500200610      *
360600200610     C                     MOVELMCSESN    WWSESN    P      new security
360700200610     C                     MOVELMCSESN    WKSESN    P      new security
360800200610      *
360900200610      ***  Access to Security Details
361000200610      *
361100200610     C                     EXSR #SECTN
361200200610     C                     MOVE 'TP'      WWTDTP           Purchase
361300200610     C                     Z-ADDMCASTA    WWNOML           Actual Stock Allocation
361400200610     C*****                Z-ADD1         Y       20                                          145872
361500200610     C*****      WWSESN    LOKUPNSEC,Y                   89                                   145872
361600200610     C*****      *IN89     IFEQ *ON                                                           145872
361700200610     C*****                Z-ADDAVPR,Y    WWTPDY           Average price (2)                  145872
361800200610     C*****                ELSE                                                               145872
361900200610     C*****                Z-ADD*ZERO     WWTPDY                                              145872
362000200610     C*****                ENDIF                                                              145872
362100200610     C                     Z-ADDWWAVR1    WWTPDY           Average Price                      145872
362200200610      *                                                                                       148404
362300200610     C           WWNOML    IFLT *ZEROS                                                        148404
362400200610     C                     MOVE 'Y'       WWINVR  1                                           148404
362500200610     C                     Z-SUBWWNOML    WWNOML                                              148404
362600200610     C                     MOVE 'TS'      WWTDTP                                              148404
362700200610     C                     ELSE                                                               148404
362800200610     C                     MOVE 'N'       WWINVR                                              148404
362900200610     C                     ENDIF                                                              148404
363000200610      *
363100200610     C                     MOVE WNNMCY    WWNMCY
363200200610      *
363300200610      ***  Access to Corporate Action Type Details to retrieve
363400200610      ***  Settlement Account Code
363500200610      *
363600200610     C                     MOVE MCCOAT    WKCOAT
363700200610     C                     EXSR #ACOAT
363800200610      *
363900200610     C                     MOVE BVCOTC    WWCUST
364000200610     C                     MOVE MMACOD    WWSTAC           Settl. Account Code
364100200610     C                     MOVE '01'      WWSTSQ           Settl. Account Seq.
364200200610     C           WWINVR    IFEQ 'Y'                                       148404
364300200610     C                     MOVELWWPAAC    WWPAYT           Pay to         148404
364400200610     C                     MOVE *BLANKS   WWPYFM           Pay from       148404
364500200610     C                     ELSE                                           148404
364600200610     C                     MOVE *BLANKS   WWPAYT           Pay to
364700200610     C                     MOVELWWPAAC    WWPYFM           Pay from
364800200610     C                     ENDIF                                          148404
364900200610     C                     MOVE MSCHTP    WALLOC
365000200610      *
365100200610      ***  Setup Default fields for a new Trade
365200200610      *
365300200610     C                     EXSR #WTRAD
365400200610     C                     MOVE WKTRRF    WWTRR2
365500200610      *
365600200610     C           MCCOTP    WHEQ 'C'
365700200610      *
365800200610      ***  If Cust/Book indicator is 'C'
365900200610      *
366000200610      ***  Setup specific field for this processing type
366100200610      ***  Generate a Depot Movement for the customer (WO) (old position)
366200200610      *
366300200610     C                     MOVELMASESN    WWSESN    P      old security
366400200610     C                     MOVELMASESN    WKSESN    P
366500200610     C                     MOVE 'WO'      WWDPMV           movement type
366600200610     C********             Z-ADDWWAVR1    WWMKTP           Average Price1 166599
366700200610     C                     Z-ADDWWPRIC    WWTPDY           Average Price1 166599
366800200610     C*******              Z-ADDMCEXPO    WWDPNA           ex-date position                  145872
366900200610     C*******              Z-ADDMCASTA    WWDPNA           actual stock position      145872 158451
367000200610     C***  Actual Stock Allocation divided by Number of New Shares                           158451
367100200610     C***  multiplied by Number of Old Shares                                                158451
367200200610     C                     Z-ADD*ZEROS    WWDPNA                                             158451
367300200610     C           MCASTA    DIV  MINSHA    WWDPNA                                             158451
367400200610     C           WWDPNA    MULT MIOSHA    WWDPNA                                             158451
367500200610      *                                                                                      148404
367600200610     C           WWDPNA    IFLT *ZEROS                                                       148404
367700200610     C                     Z-SUBWWDPNA    WWDPNA                                             148404
367800200610     C                     MOVE 'WI'      WWDPMV                                             148404
367900200610     C                     ENDIF                                                             148404
368000200610      *
368100200610      ***  Access to Security Details
368200200610      *
368300200610     C                     EXSR #SECTN
368400200610      *
368500200610     C                     MOVE WONMCY    WWNMCY
368600200610     C                     MOVE MSCHTP    WALLOC
368700200610      *
368800200610      ***  Setup Default fields
368900200610      ***  And generate a new depot movement
369000200610      *
369100200610     C                     EXSR #SDPMV
369200200610     C                     MOVE WKTRRF    WWTRR1
369300200610      *
369400200610      ***  Setup specific field for this processing type
369500200610      ***  Generate a Depot Movement for the customer (WI) (new position)
369600200610      *
369700200610     C                     MOVELMCSESN    WWSESN    P      new security
369800200610     C                     MOVELMCSESN    WKSESN    P      new security
369900200610      *
370000200610      ***  Access to Security Details
370100200610      *
370200200610     C                     EXSR #SECTN
370300200610     C                     MOVE 'WI'      WWDPMV           movement type
370400200610     C*****                Z-ADD1         Y       20                                          145872
370500200610     C*****      WWSESN    LOKUPNSEC,Y                   89                                   145872
370600200610     C*****      *IN89     IFEQ *ON                                                           145872
370700200610     C*****                Z-ADDAVPR,Y    WWMKTP           Average price (2)                  145872
370800200610     C*****                ELSE                                                               145872
370900200610     C*****                Z-ADD*ZERO     WWMKTP                                              145872
371000200610     C*****                ENDIF                                                              145872
371100200610     C                     Z-ADDWWAVR1    WWMKTP           Average Price                      145872
371200200610     C                     Z-ADDMCASTA    WWDPNA           actual stock allocation
371300200610      *                                                                                       148404
371400200610     C           WWDPNA    IFLT *ZEROS                                                        148404
371500200610     C                     Z-SUBWWDPNA    WWDPNA                                              148404
371600200610     C                     MOVE 'WO'      WWDPMV                                              148404
371700200610     C                     ENDIF                                                              148404
371800200610      *
371900200610     C                     MOVE WNNMCY    WWNMCY
372000200610     C                     MOVE MSCHTP    WALLOC
372100200610      *
372200200610      ***  Setup Default fields
372300200610      ***  And generate a new depot movement
372400200610      *
372500200610     C                     EXSR #SDPMV
372600200610     C                     MOVE WKTRRF    WWTRR2
372700200610     C                     ENDSL                           Check cust/book ind.
372800200610      *
372900200610     C                     ENDSR
373000200610      *
373100200610      *****************************************************************
373200200610      /EJECT
373300200610      *****************************************************************
373400200610      *  #PROFP -  Generate Trades/Depot Movements                    *
373500200610      *  ------    for processing type 'OF' and Purchase Offers       *
373600200610      *         or for processing type 'OF' and Subscriptions         *
373700200610      *  Called by : #PROF                                            *
373800200610      *  Calls     : #SECTN #ACOAT #WTRAD #SDPMV                      *
373900200610      *****************************************************************
374000200610      *
374100200610     C           #PROFP    BEGSR
374200200610      *
374300200610      ***  Check Cust/Book indicator
374400200610      *
374500200610     C                     SELEC
374600200610      *
374700200610      ***  If Cust/Book indicator is 'B'
374800200610      *
374900200610     C           MCCOTP    WHEQ 'B'
375000200610      *
375100200610      ***  Setup specific field for this processing type
375200200610      ***  Generate a Trade Sale for the book (old position)
375300200610      *
375400200610     C                     MOVELMASESN    WWSESN    P      old security
375500200610     C                     MOVELMASESN    WKSESN    P
375600200610     C**********           Z-ADDMCEXPO    WWNOML           ex-date position                   193662
375700200610     C                     Z-ADDMCASTA    WWNOML                                              193662
375800200610      *
375900200610     C           MIOFTY    IFEQ 'P'
376000200610     C           MCEXPO    IFGT *ZERO
376100200610     C                     MOVE 'TP'      WWTDTP           Purchase
376200200610     C                     ELSE
376300200610     C                     MOVE 'TS'      WWTDTP           Sale
376400200610     C                     ENDIF
376500200610     C                     ELSE
376600200610     C           MCEXPO    IFGT *ZERO
376700200610     C                     MOVE 'TS'      WWTDTP           Sale
376800200610     C                     ELSE
376900200610     C                     MOVE 'TP'      WWTDTP           Purchase
377000200610     C                     ENDIF
377100200610     C                     ENDIF
377200200610      *
377300200610     C           MIOFTY    IFEQ 'P'
377400200610     C                     Z-ADDMIREPR    WWTPDY           Receive price
377500200610     C                     ELSE
377600200610     C                     Z-ADDMISUPR    WWTPDY           Subscription price
377700200610     C                     ENDIF
377800200610      *
377900200610      ***  Access to Security Details
378000200610      *
378100200610     C                     EXSR #SECTN
378200200610      *
378300200610     C                     MOVE WONMCY    WWNMCY
378400200610      *
378500200610      ***  Access to Corporate Action Type Details to retrieve
378600200610      ***  Settlement Account Code
378700200610      *
378800200610     C                     MOVE MACOAT    WKCOAT
378900200610     C                     EXSR #ACOAT
379000200610      *
379100200610     C                     MOVE BVCOTC    WWCUST
379200200610     C                     MOVE MMACOD    WWSTAC           Settl. Account Code
379300200610     C                     MOVE '01'      WWSTSQ           Settl. Account Seq.
379400200610     C           WWTDTP    IFEQ 'TS'                       Sale
379500200610     C                     MOVELWWPAAC    WWPAYT           Pay to
379600200610     C                     MOVE *BLANKS   WWPYFM           Pay from
379700200610     C                     ELSE                            Purchase
379800200610     C                     MOVELWWPAAC    WWPYFM           Pay from
379900200610     C                     MOVE *BLANKS   WWPAYT           Pay to
380000200610     C                     ENDIF
380100200610     C                     MOVE MSCHTP    WALLOC
380200200610      *
380300200610      ***  Setup Default fields for a new Trade
380400200610      *
380500200610     C                     EXSR #WTRAD
380600200610     C                     MOVE WKTRRF    WWTRR1
380700200610      *
380800200610     C           MCCOTP    WHEQ 'C'
380900200610      *
381000200610      ***  If Cust/Book indicator is 'C'
381100200610      *
381200200610      ***  Setup specific field for this processing type
381300200610      ***  Generate a Depot Movement for the customer (WO) (old position)
381400200610      *
381500200610     C                     MOVELMASESN    WWSESN    P      old security
381600200610     C                     MOVELMASESN    WKSESN    P
381700200610     C**********           Z-ADDMCEXPO    WWDPNA           ex-date position                   193662
381800200610     C                     Z-ADDMCASTA    WWDPNA                                              193662
381900200610      *
382000200610     C           MIOFTY    IFEQ 'P'
382100200610     C           MCEXPO    IFLT *ZERO
382200200610     C                     MOVE 'WI'      WWDPMV           movement type
382300200610     C                     ELSE
382400200610     C                     MOVE 'WO'      WWDPMV           movement type
382500200610     C                     ENDIF
382600200610     C                     ELSE
382700200610     C           MCEXPO    IFLT *ZERO
382800200610     C                     MOVE 'WO'      WWDPMV           movement type
382900200610     C                     ELSE
383000200610     C                     MOVE 'WI'      WWDPMV           movement type
383100200610     C                     ENDIF
383200200610     C                     ENDIF
383300200610      *
383400200610     C           MIOFTY    IFEQ 'P'
383500200610     C                     Z-ADDMIREPR    WWMKTP           Receive price
383600200610     C                     ELSE
383700200610     C                     Z-ADDMISUPR    WWMKTP           Subscription price
383800200610     C                     ENDIF
383900200610      *
384000200610      ***  Access to Security Details
384100200610      *
384200200610     C                     EXSR #SECTN
384300200610      *
384400200610     C                     MOVE WONMCY    WWNMCY
384500200610     C                     MOVE MSCHTP    WALLOC
384600200610      *
384700200610      ***  Setup Default fields
384800200610      ***  And generate a new depot movement
384900200610      *
385000200610     C                     EXSR #SDPMV
385100200610     C                     MOVE WKTRRF    WWTRR1
385200200610     C                     ENDSL                           Check cust/book ind.
385300200610      *
385400200610     C                     ENDSR
385500200610      *
385600200610      *****************************************************************
385700200610      /EJECT
385800200610      *****************************************************************
385900200610      *  #PREX -   Generate Trades/Depot Movements                    *
386000200610      *  -----     for processing type 'EX'                           *
386100200610      *            (Same as processing type 'CR' and Replace)         *
386200200610      *  Called by : #PDPTY                                           *
386300200610      *  Calls     : #SECTN #ACOAT #WTRAD #CAPR #SDPMV                *
386400200610      *****************************************************************
386500200610      *
386600200610     C           #PREX     BEGSR
386700200610      *
386800200610      ***  Check Cust/Book indicator
386900200610      *
387000200610     C                     SELEC
387100200610      *
387200200610      ***  If Cust/Book indicator is 'B'
387300200610      *
387400200610     C           MCCOTP    WHEQ 'B'
387500200610      *
387600200610      ***  Setup specific field for this processing type
387700200610      ***  Generate a Trade Sale for the book (old position)
387800200610      *
387900200610     C                     MOVELMASESN    WWSESN    P      old security
388000200610     C                     MOVELMASESN    WKSESN    P
388100200610     C                     MOVE 'TS'      WWTDTP           Sale
388200200610      *****************************************************************                161732 258814
388300200610      *****When*generate*transaction*for*the*old*position,*the*********                161732 258814
388400200610      *****nomnial*should*be*equal*to*the*holding*taken*as*stock*******                161732 258814
388500200610      *****+*holding*taken*as*cash.*This*will*allow*for*the*option*of**                161732 258814
388600200610      *****take*part*stock*and*keep*rest.******************************                161732 258814
388700200610      *****************************************************************                161732 258814
388800200610      *                                                                   161732
388900200610    C***********          Z-ADDMCEXPO    WWNOML           Ex-Date positio161732
389000200610     C********** MCHOST    ADD  MCHOCA    WWNOML                                       161732 258814
389100200610      *****************************************************************                161732 258814
389200200610     C                     Z-ADDMCEXPO    WWNOML                                              258814
389300200610      *                                                                   161732
389400200610     C                     Z-ADDWWPRIC    WWTPDY           Average price for the book
389500200610      *                                                                                      148404
389600200610     C           WWNOML    IFLT *ZEROS                                                       148404
389700200610     C                     MOVE 'Y'       WWINVR  1                                          148404
389800200610     C                     Z-SUBWWNOML    WWNOML                                             148404
389900200610     C                     MOVE 'TP'      WWTDTP                                             148404
390000200610     C                     ELSE                                                              148404
390100200610     C                     MOVE 'N'       WWINVR                                             148404
390200200610     C                     ENDIF                                                             148404
390300200610      *
390400200610      ***  Access to Security Details
390500200610      *
390600200610     C                     EXSR #SECTN
390700200610      *
390800200610     C                     MOVE WONMCY    WWNMCY
390900200610      *
391000200610      ***  Access to Corporate Action Type Details to retrieve
391100200610      ***  Settlement Account Code
391200200610      *
391300200610     C                     MOVE MACOAT    WKCOAT
391400200610     C                     EXSR #ACOAT
391500200610      *
391600200610     C                     MOVE BVCOTC    WWCUST
391700200610     C                     MOVE MMACOD    WWSTAC           Settl. Account Code
391800200610     C                     MOVE '01'      WWSTSQ           Settl. Account Seq.
391900200610     C           WWINVR    IFEQ 'Y'                                       148404
392000200610     C                     MOVE *BLANKS   WWPAYT           Pay to         148404
392100200610     C                     MOVELWWPAAC    WWPYFM           Pay from       148404
392200200610     C                     ELSE                                           148404
392300200610     C                     MOVELWWPAAC    WWPAYT           Pay to
392400200610     C                     MOVE *BLANKS   WWPYFM           Pay from
392500200610     C                     ENDIF                                          148404
392600200610     C                     MOVE MSCHTP    WALLOC
392700200610      *
392800200610      ***  Setup Default fields for a new Trade
392900200610      *
393000200610     C                     EXSR #WTRAD
393100200610     C                     MOVE WKTRRF    WWTRR1
393200200610      *
393300200610      ***  Setup specific field for this processing type
393400200610      ***  Generate a Trade Purchase for the book (new position)
393500200610      *
393600200610     C                     MOVELMCSESN    WWSESN    P      new security
393700200610     C                     MOVELMCSESN    WKSESN    P
393800200610      *
393900200610      ***  Access to Security Details
394000200610      *
394100200610     C                     EXSR #SECTN
394200200610     C                     MOVE 'TP'      WWTDTP           Purchase
394300200610     C                     Z-ADDMCASTA    WWNOML           actual stock allocation
394400200610      *                                                                                       148404
394500200610     C           WWNOML    IFLT *ZEROS                                                        148404
394600200610     C                     MOVE 'Y'       WWINVR  1                                           148404
394700200610     C                     Z-SUBWWNOML    WWNOML                                              148404
394800200610     C                     MOVE 'TS'      WWTDTP                                              148404
394900200610     C                     ELSE                                                               148404
395000200610     C                     MOVE 'N'       WWINVR                                              148404
395100200610     C                     ENDIF                                                              148404
395200200610      *
395300200610     C                     MOVE WNNMCY    WWNMCY
395400200610      *
395500200610     C                     MOVE '+'       WWSIGN  1        Sign
395600200610     C                     EXSR #CAPR
395700200610     C                     Z-ADDWWCAPR    WWTPDY           calculated price
395800200610      *
395900200610      ***  Access to Corporate Action Type Details to retrieve
396000200610      ***  Settlement Account Code
396100200610      *
396200200610     C                     MOVE MCCOAT    WKCOAT
396300200610     C                     EXSR #ACOAT
396400200610      *
396500200610     C                     MOVE BVCOTC    WWCUST
396600200610     C                     MOVE MMACOD    WWSTAC           Settl. Account Code
396700200610     C                     MOVE '01'      WWSTSQ           Settl. Account Seq.
396800200610     C           WWINVR    IFEQ 'Y'                                                          148404
396900200610     C                     MOVELWWPAAC    WWPAYT           Pay to                            148404
397000200610     C                     MOVE *BLANKS   WWPYFM           Pay from                          148404
397100200610     C                     ELSE                                                              148404
397200200610     C                     MOVE *BLANKS   WWPAYT           Pay to
397300200610     C                     MOVELWWPAAC    WWPYFM           Pay from
397400200610     C                     ENDIF                                                             148404
397500200610     C                     MOVE MSCHTP    WALLOC
397600200610      *
397700200610      ***  Setup Default fields for a new Trade
397800200610      *
397900200610     C                     EXSR #WTRAD
398000200610     C                     MOVE WKTRRF    WWTRR2
398100200610      *
398200200610     C           MCCOTP    WHEQ 'C'
398300200610      *
398400200610      ***  If Cust/Book indicator is 'C'
398500200610      *
398600200610      ***  Setup specific field for this processing type
398700200610      ***  Generate a Depot Movement for the customer (WO) (old position)
398800200610      *
398900200610     C                     MOVELMASESN    WWSESN    P      old security
399000200610     C                     MOVELMASESN    WKSESN    P      old security
399100200610     C                     MOVE 'WO'      WWDPMV           movement type
399200200610     C                     Z-ADDWWPRIC    WWMKTP           Average Price for customer
399300200610     C***********          Z-ADDMCEXPO    WWDPNA           ex-date positio161732
399400200610      *****************************************************************                161732 258814
399500200610      *****When*generate*transaction*for*the*old*position,*the*********                161732 258814
399600200610      *****nomnial*should*be*equal*to*the*holding*taken*as*stock*******                161732 258814
399700200610      *****+*holding*taken*as*cash.*This*will*allow*for*the*option*of**                161732 258814
399800200610      *****take*part*stock*and*keep*rest.******************************                161732 258814
399900200610      *****************************************************************                161732 258814
400000200610     C********** MCHOST    ADD  MCHOCA    WWDPNA                                       161732 258814
400100200610     C                     Z-ADDMCEXPO    WWDPNA                                              258814
400200200610      *                                                                                       148404
400300200610     C           WWDPNA    IFLT *ZEROS                                                        148404
400400200610     C                     Z-SUBWWDPNA    WWDPNA                                              148404
400500200610     C                     MOVE 'WI'      WWDPMV                                              148404
400600200610     C                     ENDIF                                                              148404
400700200610      *
400800200610      ***  Access to Security Details
400900200610      *
401000200610     C                     EXSR #SECTN
401100200610      *
401200200610     C                     MOVE WONMCY    WWNMCY
401300200610     C                     MOVE MSCHTP    WALLOC
401400200610      *
401500200610      ***  Setup Default fields
401600200610      ***  And generate a new depot movement
401700200610      *
401800200610     C                     EXSR #SDPMV
401900200610     C                     MOVE WKTRRF    WWTRR1
402000200610      *
402100200610      ***  Setup specific field for this processing type
402200200610      ***  Generate a Depot Movement for the customer (WI) (old position)
402300200610      *
402400200610     C                     MOVELMCSESN    WWSESN    P      new security
402500200610     C                     MOVELMCSESN    WKSESN    P
402600200610      *
402700200610      ***  Access to Security Details
402800200610      *
402900200610     C                     EXSR #SECTN
403000200610     C                     MOVE 'WI'      WWDPMV           movement type
403100200610     C                     MOVE '+'       WWSIGN  1        Sign
403200200610     C                     EXSR #CAPR
403300200610     C                     Z-ADDWWCAPR    WWMKTP           calculated price
403400200610     C                     Z-ADDMCASTA    WWDPNA           actual stock allocation
403500200610      *                                                                                       148404
403600200610     C           WWDPNA    IFLT *ZEROS                                                        148404
403700200610     C                     Z-SUBWWDPNA    WWDPNA                                              148404
403800200610     C                     MOVE 'WO'      WWDPMV                                              148404
403900200610     C                     ENDIF                                                              148404
404000200610      *
404100200610     C                     MOVE WNNMCY    WWNMCY
404200200610     C                     MOVE MSCHTP    WALLOC
404300200610      *
404400200610      ***  Setup Default fields
404500200610      ***  And generate a new depot movement
404600200610      *
404700200610     C                     EXSR #SDPMV
404800200610     C                     MOVE WKTRRF    WWTRR2
404900200610     C                     ENDSL                           Check cust/book ind.
405000200610      *
405100200610     C                     ENDSR
405200200610      *
405300200610      *****************************************************************
405400200610      /EJECT
405500200610      *****************************************************************
405600200610      *  #PRRG -  Check processing for type 'RG'                      *
405700200610      *  -----                                                        *
405800200610      *  Called by : #PDPTY                                           *
405900200610      *  Calls     : #PRRGZ #PRRGM #PRRGC                             *
406000200610      *****************************************************************
406100200610      *
406200200610     C           #PRRG     BEGSR
406300200610      *
406400200610     C                     SELEC
406500200610      *
406600200610      ***  Processing type 'RG' and "Average Price Option" is 'Z' (zero average price)
406700200610      *
406800200610     C           MFAVOP    WHEQ 'Z'
406900200610     C                     EXSR #PRRGZ
407000200610      *
407100200610      ***  Processing type 'RG' and "Average Price Option" is 'M' (market price)
407200200610      *
407300200610     C           MFAVOP    WHEQ 'M'
407400200610     C                     EXSR #PRRGM
407500200610      *
407600200610      ***  Processing type 'RG' and "Average Price Option" is 'C' (calculated)
407700200610      *                                                    OR 'I' (calculated)     161746
407800200610      *
407900200610     C           MFAVOP    WHEQ 'C'
408000200610     C           MFAVOP    OREQ 'I'                                                161746
408100200610     C                     EXSR #PRRGC
408200200610      *
408300200610     C                     ENDSL
408400200610      *
408500200610     C                     ENDSR
408600200610      *
408700200610      *****************************************************************
408800200610      /EJECT
408900200610      *****************************************************************
409000200610      *  #PRRGZ -  Generate Trades/Depot Movements                    *
409100200610      *  ------    for processing type 'RG' and zero average price    *
409200200610      *  Called by : #PRRG                                            *
409300200610      *  Calls     : #SECTN #ACOAT #WTRAD #SDPMV                      *
409400200610      *****************************************************************
409500200610      *
409600200610     C           #PRRGZ    BEGSR
409700200610      *
409800200610      ***  Check Cust/Book indicator
409900200610      *
410000200610     C                     SELEC
410100200610      *
410200200610      ***  If Cust/Book indicator is 'B'
410300200610      *
410400200610     C           MCCOTP    WHEQ 'B'
410500200610      *
410600200610      ***  Setup specific field for this processing type
410700200610      ***  Generate a Trade Purchase for the book
410800200610      *
410900200610     C                     MOVELMCSESN    WWSESN    P      new security
411000200610     C                     MOVELMCSESN    WKSESN    P
411100200610     C                     MOVE 'TP'      WWTDTP           Purchase
411200200610     C                     Z-ADDMCASTA    WWNOML           Actual Stock Allocation
411300200610     C                     Z-ADD*ZERO     WWTPDY           Price=0
411400200610      *                                                                                       148404
411500200610     C           WWNOML    IFLT *ZEROS                                                        148404
411600200610     C                     MOVE 'Y'       WWINVR  1                                           148404
411700200610     C                     Z-SUBWWNOML    WWNOML                                              148404
411800200610     C                     MOVE 'TS'      WWTDTP                                              148404
411900200610     C                     ELSE                                                               148404
412000200610     C                     MOVE 'N'       WWINVR                                              148404
412100200610     C                     ENDIF                                                              148404
412200200610      *
412300200610      ***  Access to Security Details
412400200610      *
412500200610     C                     EXSR #SECTN
412600200610      *
412700200610     C                     MOVE WNNMCY    WWNMCY
412800200610      *
412900200610      ***  Access to Corporate Action Type Details to retrieve
413000200610      ***  Settlement Account Code
413100200610      *
413200200610     C                     MOVE MCCOAT    WKCOAT
413300200610     C                     EXSR #ACOAT
413400200610      *
413500200610     C                     MOVE BVCOTC    WWCUST
413600200610     C                     MOVE MMACOD    WWSTAC           Settl. Account Code
413700200610     C                     MOVE '01'      WWSTSQ           Settl. Account Seq.
413800200610     C           WWINVR    IFEQ 'Y'                                       148404
413900200610     C                     MOVELWWPAAC    WWPAYT           Pay to         148404
414000200610     C                     MOVE *BLANKS   WWPYFM           Pay from       148404
414100200610     C                     ELSE                                           148404
414200200610     C                     MOVE *BLANKS   WWPAYT           Pay to
414300200610     C                     MOVELWWPAAC    WWPYFM           Pay from
414400200610     C                     ENDIF                                          148404
414500200610     C                     MOVE MSCHTP    WALLOC
414600200610      *
414700200610      ***  Setup Default fields for a new Trade
414800200610      *
414900200610     C                     EXSR #WTRAD
415000200610     C                     MOVE WKTRRF    WWTRR1
415100200610      *
415200200610     C           MCCOTP    WHEQ 'C'
415300200610      *
415400200610      ***  If Cust/Book indicator is 'C'
415500200610      *
415600200610      ***  Setup specific field for this processing type
415700200610      ***  Generate a Depot Movement for the customer (WI) (new position)
415800200610      *
415900200610     C                     MOVELMCSESN    WWSESN    P      new security
416000200610     C                     MOVELMCSESN    WKSESN    P      new security
416100200610     C                     MOVE 'WI'      WWDPMV           movement type
416200200610     C                     Z-ADD*ZERO     WWMKTP           Price=0
416300200610     C                     Z-ADDMCASTA    WWDPNA           actual stock allocation
416400200610      *                                                                                       148404
416500200610     C           WWDPNA    IFLT *ZEROS                                                        148404
416600200610     C                     Z-SUBWWDPNA    WWDPNA                                              148404
416700200610     C                     MOVE 'WO'      WWDPMV                                              148404
416800200610     C                     ENDIF                                                              148404
416900200610      *
417000200610      ***  Access to Security Details
417100200610      *
417200200610     C                     EXSR #SECTN
417300200610      *
417400200610     C                     MOVE WNNMCY    WWNMCY
417500200610     C                     MOVE MSCHTP    WALLOC
417600200610      *
417700200610      ***  Setup Default fields
417800200610      ***  And generate a new depot movement
417900200610      *
418000200610     C                     EXSR #SDPMV
418100200610     C                     MOVE WKTRRF    WWTRR1
418200200610     C                     ENDSL                           Check cust/book ind.
418300200610      *
418400200610     C                     ENDSR
418500200610      *
418600200610      *****************************************************************
418700200610      /EJECT
418800200610      *****************************************************************
418900200610      *  #PRRGM -  Generate Trades/Depot Movements                    *
419000200610      *  ------    for processing type 'RG' and market price          *
419100200610      *  Called by : #PRRG                                            *
419200200610      *  Calls     : #SECTN #ACOAT #WTRAD ZCCYCN #SDPMV               *
419300200610      *****************************************************************
419400200610      *
419500200610     C           #PRRGM    BEGSR
419600200610      *
419700200610      ***  Check Cust/Book indicator
419800200610      *
419900200610     C                     SELEC
420000200610      *
420100200610      ***  If Cust/Book indicator is 'B'
420200200610      *
420300200610     C           MCCOTP    WHEQ 'B'
420400200610      *
420500200610      ***  Setup specific field for this processing type
420600200610      ***  Generate a Trade Sale for the book (old position)
420700200610      *
420800200610     C                     MOVELMASESN    WWSESN    P      old security
420900200610     C                     MOVELMASESN    WKSESN    P
421000200610     C                     MOVE 'TS'      WWTDTP           Sale
421100200610     C                     Z-ADDMCEXPO    WWNOML           Ex-Date position
421200200610     C                     Z-ADDWWPRIC    WWTPDY           Average price for the book
421300200610      *                                                                                       148404
421400200610     C           WWNOML    IFLT *ZEROS                                                        148404
421500200610     C                     MOVE 'Y'       WWINVR  1                                           148404
421600200610     C                     Z-SUBWWNOML    WWNOML                                              148404
421700200610     C                     MOVE 'TP'      WWTDTP                                              148404
421800200610     C                     ELSE                                                               148404
421900200610     C                     MOVE 'N'       WWINVR                                              148404
422000200610     C                     ENDIF                                                              148404
422100200610      *
422200200610      ***  Access to Security Details
422300200610      *
422400200610     C                     EXSR #SECTN
422500200610      *
422600200610     C                     MOVE WONMCY    WWNMCY
422700200610      *
422800200610      ***  Access to Corporate Action Type Details to retrieve
422900200610      ***  Settlement Account Code
423000200610      *
423100200610     C                     MOVE MACOAT    WKCOAT
423200200610     C                     EXSR #ACOAT
423300200610      *
423400200610     C                     MOVE BVCOTC    WWCUST
423500200610     C                     MOVE MMACOD    WWSTAC           Settl. Account Code
423600200610     C                     MOVE '01'      WWSTSQ           Settl. Account Seq.
423700200610     C           WWINVR    IFEQ 'Y'                                       148404
423800200610     C                     MOVE *BLANKS   WWPAYT           Pay to         148404
423900200610     C                     MOVELWWPAAC    WWPYFM           Pay from       148404
424000200610     C                     ELSE                                           148404
424100200610     C                     MOVELWWPAAC    WWPAYT           Pay to
424200200610     C                     MOVE *BLANKS   WWPYFM           Pay from
424300200610     C                     ENDIF                                          148404
424400200610     C                     MOVE MSCHTP    WALLOC
424500200610      *
424600200610      ***  Setup Default fields for a new Trade
424700200610      *
424800200610     C                     EXSR #WTRAD
424900200610     C                     MOVE WKTRRF    WWTRR1
425000200610      *
425100200610      ***  Setup specific field for this processing type
425200200610      ***  Generate a Trade Purchase for the book (old position)
425300200610      *
425400200610     C                     MOVELMASESN    WWSESN    P      Event security
425500200610     C                     MOVELMCSESN    WKSESN    P
425600200610      *
425700200610      ***  Access to Security Details
425800200610      *
425900200610     C                     EXSR #SECTN
426000200610     C                     MOVE 'TP'      WWTDTP           Purchase
426100200610     C                     Z-ADDMCEXPO    WWNOML           Ex-Date position
426200200610     C                     Z-ADD*ZERO     WWTPDY
426300200610      *                                                                   148404
426400200610     C           WWNOML    IFLT *ZEROS                                    148404
426500200610     C                     MOVE 'Y'       WWINVR  1                       148404
426600200610     C                     Z-SUBWWNOML    WWNOML                          148404
426700200610     C                     MOVE 'TS'      WWTDTP                          148404
426800200610     C                     ELSE                                           148404
426900200610     C                     MOVE 'N'       WWINVR                          148404
427000200610     C                     ENDIF                                          148404
427100200610      *
427200200610     C                     MOVE WONMCY    WWNMCY
427300200610      *
427400200610      ***           (Consider. event sec.  -  consider. new sec.  -  actual cash rounding)
427500200610      ***  Price =  ----------------------------------------------------------------------
427600200610      ***                                   Old Position
427700200610      *
427800200610      ***  Consideration event security = Ex-Date Position  *  Current Average Price
427900200610      ***  Consideration new security = Ex-Date Position  *  Right Market Price
428000200610      ***  Actual Cash Rounding = Converted from nominal ccy of event sec. to nominal ccy of new sec
428100200610      ***  Old Position = Ex-Date Position
428200200610      *
428300200610     C           MCEXPO    IFNE *ZERO
428400200610      *
428500200610     C                     Z-ADDMCEXPO    WWKCOE 150
428600200610     C                     MULT WWPRIC    WWKCOE           Cons. event Sec.
428700200610      *
428800200610     C                     Z-ADDMCEXPO    WWKCON 150
428900200610     C                     MULT MFRIMP    WWKCON           Cons. new Sec.
429000200610      *
429100200610     C                     Z-ADDWWKCOE    WWK150 150
429200200610     C                     SUB  WWKCON    WWK150
429300200610      *
429400200610     C                     Z-ADDMCACAA    ZAMTF
429500200610     C           ZAMTF     IFNE *ZERO
429600200610     C                     MOVE WONMCY    ZCCYF
429700200610     C                     MOVE WOSPRT    ZRATEF
429800200610     C                     MOVE WOMDIN    ZMDINF
429900200610     C                     MOVE WONBDP    ZCDPF
430000200610     C                     MOVE WNNMCY    ZCCYT
430100200610     C                     MOVE WNSPRT    ZRATET
430200200610     C                     MOVE WNMDIN    ZMDINT
430300200610     C                     MOVE WNNBDP    ZCDPT
430400200610     C                     EXSR ZCCYCN
430500200610     C                     SUB  ZAMTT     WWK150           Actual cash rounding
430600200610     C                     ENDIF
430700200610      *
430800200610     C           WWK150    DIV  MCEXPO    WWTPDY           Calculated Price
430900200610     C                     ENDIF
431000200610      *
431100200610      ***  Access to Corporate Action Type Details to retrieve
431200200610      ***  Settlement Account Code
431300200610      *
431400200610     C                     MOVE MCCOAT    WKCOAT
431500200610     C                     EXSR #ACOAT
431600200610      *
431700200610     C                     MOVE BVCOTC    WWCUST
431800200610     C                     MOVE MMACOD    WWSTAC           Settl. Account Code
431900200610     C                     MOVE '01'      WWSTSQ           Settl. Account Seq.
432000200610     C           WWINVR    IFEQ 'Y'                                       148404
432100200610     C                     MOVELWWPAAC    WWPAYT           Pay to         148404
432200200610     C                     MOVE *BLANKS   WWPYFM           Pay from       148404
432300200610     C                     ELSE                                           148404
432400200610     C                     MOVE *BLANKS   WWPAYT           Pay to
432500200610     C                     MOVELWWPAAC    WWPYFM           Pay from
432600200610     C                     ENDIF                                          148404
432700200610     C                     MOVE MSCHTP    WALLOC
432800200610      *
432900200610      ***  Setup Default fields for a new Trade
433000200610      *
433100200610     C                     EXSR #WTRAD
433200200610     C                     MOVE WKTRRF    WWTRR2
433300200610      *
433400200610      ***  Setup specific field for this processing type
433500200610      ***  Generate a Trade Purchase for the book (new position)
433600200610      *
433700200610     C                     MOVELMCSESN    WWSESN    P      new security
433800200610     C                     MOVELMCSESN    WKSESN    P
433900200610     C                     MOVE 'TP'      WWTDTP           Purchase
434000200610     C                     Z-ADDMCASTA    WWNOML           Actual Stock allocation
434100200610     C                     Z-ADDMFRIMP    WWTPDY           Rights Market Price
434200200610      *                                                                                       148404
434300200610     C           WWNOML    IFLT *ZEROS                                                        148404
434400200610     C                     MOVE 'Y'       WWINVR  1                                           148404
434500200610     C                     Z-SUBWWNOML    WWNOML                                              148404
434600200610     C                     MOVE 'TS'      WWTDTP                                              148404
434700200610     C                     ELSE                                                               148404
434800200610     C                     MOVE 'N'       WWINVR                                              148404
434900200610     C                     ENDIF                                                              148404
435000200610      *
435100200610      ***  Access to Security Details
435200200610      *
435300200610     C                     EXSR #SECTN
435400200610      *
435500200610     C                     MOVE WNNMCY    WWNMCY
435600200610      *
435700200610      ***  Access to Corporate Action Type Details to retrieve
435800200610      ***  Settlement Account Code
435900200610      *
436000200610     C                     MOVE MCCOAT    WKCOAT
436100200610     C                     EXSR #ACOAT
436200200610      *
436300200610     C                     MOVE BVCOTC    WWCUST
436400200610     C                     MOVE MMACOD    WWSTAC           Settl. Account Code
436500200610     C                     MOVE '01'      WWSTSQ           Settl. Account Seq.
436600200610     C           WWINVR    IFEQ 'Y'                                       148404
436700200610     C                     MOVELWWPAAC    WWPAYT           Pay to         148404
436800200610     C                     MOVE *BLANKS   WWPYFM           Pay from       148404
436900200610     C                     ELSE                                           148404
437000200610     C                     MOVE *BLANKS   WWPAYT           Pay to
437100200610     C                     MOVELWWPAAC    WWPYFM           Pay from
437200200610     C                     ENDIF                                          148404
437300200610     C                     MOVE MSCHTP    WALLOC
437400200610      *
437500200610      ***  Setup Default fields for a new Trade
437600200610      *
437700200610     C                     EXSR #WTRAD
437800200610     C                     MOVE WKTRRF    WWTRR3
437900200610      *
438000200610     C           MCCOTP    WHEQ 'C'
438100200610      *
438200200610      ***  If Cust/Book indicator is 'C'
438300200610      *
438400200610      ***  Setup specific field for this processing type
438500200610      ***  Generate a Depot Movement for the customer (WO) (old position)
438600200610      *
438700200610     C                     MOVELMASESN    WWSESN    P      old security
438800200610     C                     MOVELMASESN    WKSESN    P
438900200610     C                     MOVE 'WO'      WWDPMV           movement type
439000200610     C                     Z-ADDWWPRIC    WWMKTP           Average price for the customer
439100200610     C                     Z-ADDMCEXPO    WWDPNA           ex-date position
439200200610      *                                                                                       148404
439300200610     C           WWDPNA    IFLT *ZEROS                                                        148404
439400200610     C                     Z-SUBWWDPNA    WWDPNA                                              148404
439500200610     C                     MOVE 'WI'      WWDPMV                                              148404
439600200610     C                     ENDIF                                                              148404
439700200610      *
439800200610      ***  Access to Security Details
439900200610      *
440000200610     C                     EXSR #SECTN
440100200610      *
440200200610     C                     MOVE WONMCY    WWNMCY
440300200610     C                     MOVE MSCHTP    WALLOC
440400200610      *
440500200610      ***  Setup Default fields
440600200610      ***  And generate a new depot movement
440700200610      *
440800200610     C                     EXSR #SDPMV
440900200610     C                     MOVE WKTRRF    WWTRR1
441000200610      *
441100200610      ***  Setup specific field for this processing type
441200200610      ***  Generate a Depot Movement for the customer (WI) (old position)
441300200610      *
441400200610     C                     MOVELMASESN    WWSESN    P      Event security
441500200610     C                     MOVELMCSESN    WKSESN    P
441600200610      *
441700200610      ***  Access to Security Details
441800200610      *
441900200610     C                     EXSR #SECTN
442000200610     C                     MOVE 'WI'      WWDPMV           movement type
442100200610     C                     Z-ADDMCEXPO    WWDPNA           ex-date position
442200200610     C                     Z-ADD*ZERO     WWMKTP
442300200610      *                                                                   148404
442400200610     C           WWDPNA    IFLT *ZEROS                                    148404
442500200610     C                     Z-SUBWWDPNA    WWDPNA                          148404
442600200610     C                     MOVE 'WO'      WWDPMV                          148404
442700200610     C                     ENDIF                                          148404
442800200610      *
442900200610     C                     MOVE WONMCY    WWNMCY
443000200610      *
443100200610      ***           (Consider. event sec.  -  consider. new sec.  -  actual cash rounding)
443200200610      ***  Price =  ----------------------------------------------------------------------
443300200610      ***                                   Old Position
443400200610      *
443500200610      ***  Consideration event security = Ex-Date Position  *  Current Average Price
443600200610      ***  Consideration new security = Ex-Date Position  *  Right Market Price
443700200610      ***  Actual Cash Rounding = Converted from nominal ccy of event sec. to nominal ccy of new sec
443800200610      ***  Old Position = Ex-Date Position
443900200610      *
444000200610     C           MCEXPO    IFNE *ZERO
444100200610      *
444200200610     C                     Z-ADDMCEXPO    WWKCOE 150
444300200610     C                     MULT WWPRIC    WWKCOE           Cons. event Sec.
444400200610      *
444500200610     C                     Z-ADDMCEXPO    WWKCON 150
444600200610     C                     MULT MFRIMP    WWKCON           Cons. new Sec.
444700200610      *
444800200610     C                     Z-ADDWWKCOE    WWK150 150
444900200610     C                     SUB  WWKCON    WWK150
445000200610      *
445100200610     C                     Z-ADDMCACAA    ZAMTF
445200200610     C           ZAMTF     IFNE *ZERO
445300200610     C                     MOVE WONMCY    ZCCYF
445400200610     C                     MOVE WOSPRT    ZRATEF
445500200610     C                     MOVE WOMDIN    ZMDINF
445600200610     C                     MOVE WONBDP    ZCDPF
445700200610     C                     MOVE WNNMCY    ZCCYT
445800200610     C                     MOVE WNSPRT    ZRATET
445900200610     C                     MOVE WNMDIN    ZMDINT
446000200610     C                     MOVE WNNBDP    ZCDPT
446100200610     C                     EXSR ZCCYCN
446200200610     C                     SUB  ZAMTT     WWK150           Actual cash rounding
446300200610     C                     ENDIF
446400200610      *
446500200610     C           WWK150    DIV  MCEXPO    WWMKTP
446600200610     C                     ENDIF
446700200610      *
446800200610     C                     MOVE MSCHTP    WALLOC
446900200610      *
447000200610      ***  Setup Default fields
447100200610      ***  And generate a new depot movement
447200200610      *
447300200610     C                     EXSR #SDPMV
447400200610     C                     MOVE WKTRRF    WWTRR2
447500200610      *
447600200610      ***  Setup specific field for this processing type
447700200610      ***  Generate a Depot Movement for the customer (WI) (new position)
447800200610      *
447900200610     C                     MOVELMCSESN    WWSESN    P      new security
448000200610     C                     MOVELMCSESN    WKSESN    P
448100200610     C                     MOVE 'WI'      WWDPMV           movement type
448200200610     C                     Z-ADDMCASTA    WWDPNA           actual stock allocation
448300200610     C                     Z-ADDMFRIMP    WWMKTP           Rights Market Price
448400200610      *                                                                                       148404
448500200610     C           WWDPNA    IFLT *ZEROS                                                        148404
448600200610     C                     Z-SUBWWDPNA    WWDPNA                                              148404
448700200610     C                     MOVE 'WO'      WWDPMV                                              148404
448800200610     C                     ENDIF                                                              148404
448900200610      *
449000200610      ***  Access to Security Details
449100200610      *
449200200610     C                     EXSR #SECTN
449300200610      *
449400200610     C                     MOVE WNNMCY    WWNMCY
449500200610     C                     MOVE MSCHTP    WALLOC
449600200610      *
449700200610      ***  Setup Default fields
449800200610      ***  And generate a new depot movement
449900200610      *
450000200610     C                     EXSR #SDPMV
450100200610     C                     MOVE WKTRRF    WWTRR3
450200200610     C                     ENDSL                           Check cust/book ind.
450300200610      *
450400200610     C                     ENDSR
450500200610      *
450600200610      *****************************************************************
450700200610      /EJECT
450800200610      *****************************************************************
450900200610      *  #PRRGC -  Generate Trades/Depot Movements                    *
451000200610      *  ------    for processing type 'RG' and calculated price      *
451100200610      *  Called by : #PRRG                                            *
451200200610      *  Calls     : #SECTN #ACOAT #WTRAD #SDPMV                      *
451300200610      *****************************************************************
451400200610      *
451500200610     C           #PRRGC    BEGSR
451600200610      *
451700200610      ***  Check Cust/Book indicator
451800200610      *
451900200610     C                     SELEC
452000200610      *
452100200610      ***  If Cust/Book indicator is 'B'
452200200610      *
452300200610     C           MCCOTP    WHEQ 'B'
452400200610      *
452500200610      ***  Setup specific field for this processing type
452600200610      ***  Generate a Trade Sale for the book (old position)
452700200610      *
452800200610     C                     MOVELMASESN    WWSESN    P      old security
452900200610     C                     MOVELMASESN    WKSESN    P
453000200610     C                     MOVE 'TS'      WWTDTP           Sale
453100200610     C                     Z-ADDMCEXPO    WWNOML           Ex-Date position
453200200610     C                     Z-ADDWWAVR1    WWTPDY           Average Price (1)
453300200610      *                                                                   148404
453400200610     C           WWNOML    IFLT *ZEROS                                    148404
453500200610     C                     MOVE 'Y'       WWINVR  1                       148404
453600200610     C                     Z-SUBWWNOML    WWNOML                          148404
453700200610     C                     MOVE 'TP'      WWTDTP                          148404
453800200610     C                     ELSE                                           148404
453900200610     C                     MOVE 'N'       WWINVR                          148404
454000200610     C                     ENDIF                                          148404
454100200610      *
454200200610      ***  Access to Security Details
454300200610      *
454400200610     C                     EXSR #SECTN
454500200610      *
454600200610     C                     MOVE WONMCY    WWNMCY
454700200610      *
454800200610      ***  Access to Corporate Action Type Details to retrieve
454900200610      ***  Settlement Account Code
455000200610      *
455100200610     C                     MOVE MACOAT    WKCOAT
455200200610     C                     EXSR #ACOAT
455300200610      *
455400200610     C                     MOVE BVCOTC    WWCUST
455500200610     C                     MOVE MMACOD    WWSTAC           Settl. Account Code
455600200610     C                     MOVE '01'      WWSTSQ           Settl. Account Seq.
455700200610     C           WWINVR    IFEQ 'Y'                                       148404
455800200610     C                     MOVE *BLANKS   WWPAYT           Pay to         148404
455900200610     C                     MOVELWWPAAC    WWPYFM           Pay from       148404
456000200610     C                     ELSE                                           148404
456100200610     C                     MOVELWWPAAC    WWPAYT           Pay to
456200200610     C                     MOVE *BLANKS   WWPYFM           Pay from
456300200610     C                     ENDIF                                          148404
456400200610     C                     MOVE MSCHTP    WALLOC
456500200610      *
456600200610      ***  Setup Default fields for a new Trade
456700200610      *
456800200610     C                     EXSR #WTRAD
456900200610     C                     MOVE WKTRRF    WWTRR1
457000200610      *
457100200610      ***  Setup specific field for this processing type
457200200610      ***  Generate a Trade Purchase for the book (old position)
457300200610      *
457400200610     C                     MOVELMASESN    WWSESN    P      Event security
457500200610     C                     MOVELMASESN    WKSESN    P
457600200610      *
457700200610      ***  Access to Security Details
457800200610      *
457900200610     C                     EXSR #SECTN
458000200610     C                     MOVE 'TP'      WWTDTP           Purchase
458100200610     C                     Z-ADDMCEXPO    WWNOML           Ex-Date position
458200200610     C                     Z-ADD1         Y       20
458300200610     C           WWSESN    LOKUPNSEC,Y                   89
458400200610     C           *IN89     IFEQ *ON
458500200610     C***********          MULT AVPR,Y    WWTPDY           AveragePrice(2)163065
458600200610     C                     Z-ADDAVPR,Y    WWTPDY           AveragePrice(2)163065
458700200610     C                     ELSE
458800200610     C                     Z-ADD*ZERO     WWTPDY
458900200610     C                     ENDIF
459000200610      *                                                                   148404
459100200610     C           WWNOML    IFLT *ZEROS                                    148404
459200200610     C                     MOVE 'Y'       WWINVR  1                       148404
459300200610     C                     Z-SUBWWNOML    WWNOML                          148404
459400200610     C                     MOVE 'TS'      WWTDTP                          148404
459500200610     C                     ELSE                                           148404
459600200610     C                     MOVE 'N'       WWINVR                          148404
459700200610     C                     ENDIF                                          148404
459800200610      *
459900200610     C                     MOVE WONMCY    WWNMCY
460000200610      *
460100200610      ***  Access to Corporate Action Type Details to retrieve
460200200610      ***  Settlement Account Code
460300200610      *
460400200610     C                     MOVE MCCOAT    WKCOAT
460500200610     C                     EXSR #ACOAT
460600200610      *
460700200610     C                     MOVE BVCOTC    WWCUST
460800200610     C                     MOVE MMACOD    WWSTAC           Settl. Account Code
460900200610     C                     MOVE '01'      WWSTSQ           Settl. Account Seq.
461000200610     C           WWINVR    IFEQ 'Y'                                       148404
461100200610     C                     MOVELWWPAAC    WWPAYT           Pay to         148404
461200200610     C                     MOVE *BLANKS   WWPYFM           Pay from       148404
461300200610     C                     ELSE                                           148404
461400200610     C                     MOVE *BLANKS   WWPAYT           Pay to
461500200610     C                     MOVELWWPAAC    WWPYFM           Pay from
461600200610     C                     ENDIF                                          148404
461700200610     C                     MOVE MSCHTP    WALLOC
461800200610      *
461900200610      ***  Setup Default fields for a new Trade
462000200610      *
462100200610     C                     EXSR #WTRAD
462200200610     C                     MOVE WKTRRF    WWTRR2
462300200610      *
462400200610      ***  Setup specific field for this processing type
462500200610      ***  Generate a Trade Purchase for the book (new position)
462600200610      *
462700200610     C                     MOVELMCSESN    WWSESN    P      new security
462800200610     C                     MOVELMCSESN    WKSESN    P
462900200610      *
463000200610      ***  Access to Security Details
463100200610      *
463200200610     C                     EXSR #SECTN
463300200610     C                     MOVE 'TP'      WWTDTP           Purchase
463400200610     C                     Z-ADDMCASTA    WWNOML           Actual sotck allocation
463500200610     C                     Z-ADD1         Y       20
463600200610     C           WWSESN    LOKUPNSEC,Y                   89
463700200610     C           *IN89     IFEQ *ON
463800200610     C***********          MULT AVPR,Y    WWTPDY           AveragePrice(2)163065
463900200610     C                     Z-ADDAVPR,Y    WWTPDY           AveragePrice(2)163065
464000200610     C                     ELSE
464100200610     C                     Z-ADD*ZERO     WWTPDY
464200200610     C                     ENDIF
464300200610      *                                                                   148404
464400200610     C           WWNOML    IFLT *ZEROS                                    148404
464500200610     C                     MOVE 'Y'       WWINVR  1                       148404
464600200610     C                     Z-SUBWWNOML    WWNOML                          148404
464700200610     C                     MOVE 'TS'      WWTDTP                          148404
464800200610     C                     ELSE                                           148404
464900200610     C                     MOVE 'N'       WWINVR                          148404
465000200610     C                     ENDIF                                          148404
465100200610      *
465200200610     C                     MOVE WNNMCY    WWNMCY
465300200610      *
465400200610      ***  Access to Corporate Action Type Details to retrieve
465500200610      ***  Settlement Account Code
465600200610      *
465700200610     C                     MOVE MCCOAT    WKCOAT
465800200610     C                     EXSR #ACOAT
465900200610      *
466000200610     C                     MOVE BVCOTC    WWCUST
466100200610     C                     MOVE MMACOD    WWSTAC           Settl. Account Code
466200200610     C                     MOVE '01'      WWSTSQ           Settl. Account Seq.
466300200610     C           WWINVR    IFEQ 'Y'                                       148404
466400200610     C                     MOVELWWPAAC    WWPAYT           Pay to         148404
466500200610     C                     MOVE *BLANKS   WWPYFM           Pay from       148404
466600200610     C                     ELSE                                           148404
466700200610     C                     MOVE *BLANKS   WWPAYT           Pay to
466800200610     C                     MOVELWWPAAC    WWPYFM           Pay from
466900200610     C                     ENDIF                                          148404
467000200610     C                     MOVE MSCHTP    WALLOC
467100200610      *
467200200610      ***  Setup Default fields for a new Trade
467300200610      *
467400200610     C                     EXSR #WTRAD
467500200610     C                     MOVE WKTRRF    WWTRR3
467600200610      *
467700200610     C           MCCOTP    WHEQ 'C'
467800200610      *
467900200610      ***  If Cust/Book indicator is 'C'
468000200610      *
468100200610      ***  Setup specific field for this processing type
468200200610      ***  Generate a Depot Movement for the customer (WO) (old position)
468300200610      *
468400200610     C                     MOVELMASESN    WWSESN    P      old security
468500200610     C                     MOVELMASESN    WKSESN    P
468600200610     C                     MOVE 'WO'      WWDPMV           movement type
468700200610     C                     Z-ADDWWAVR1    WWMKTP           Average price (1)
468800200610     C                     Z-ADDMCEXPO    WWDPNA           ex-date position
468900200610      *                                                                   148404
469000200610     C           WWDPNA    IFLT *ZEROS                                    148404
469100200610     C                     Z-SUBWWDPNA    WWDPNA                          148404
469200200610     C                     MOVE 'WI'      WWDPMV                          148404
469300200610     C                     ENDIF                                          148404
469400200610      *
469500200610      ***  Access to Security Details
469600200610      *
469700200610     C                     EXSR #SECTN
469800200610      *
469900200610     C                     MOVE WONMCY    WWNMCY
470000200610     C                     MOVE MSCHTP    WALLOC
470100200610      *
470200200610      ***  Setup Default fields
470300200610      ***  And generate a new depot movement
470400200610      *
470500200610     C                     EXSR #SDPMV
470600200610     C                     MOVE WKTRRF    WWTRR1
470700200610      *
470800200610      ***  Setup specific field for this processing type
470900200610      ***  Generate a Depot Movement for the customer (WI) (old position)
471000200610      *
471100200610     C                     MOVELMASESN    WWSESN    P      Event security
471200200610     C                     MOVELMASESN    WKSESN    P
471300200610     C                     MOVE 'WI'      WWDPMV           movement type
471400200610     C                     Z-ADDMCEXPO    WWDPNA           ex-date position
471500200610      *                                                                   148404
471600200610     C           WWDPNA    IFLT *ZEROS                                    148404
471700200610     C                     Z-SUBWWDPNA    WWDPNA                          148404
471800200610     C                     MOVE 'WO'      WWDPMV                          148404
471900200610     C                     ENDIF                                          148404
472000200610      *                                                                   148404
472100200610     C                     Z-ADD1         Y       20
472200200610     C           WWSESN    LOKUPNSEC,Y                   89
472300200610     C           *IN89     IFEQ *ON
472400200610     C***********          MULT AVPR,Y    WWMKTP           AveragePrice(2)163065
472500200610     C                     Z-ADDAVPR,Y    WWMKTP           AveragePrice(2)163065
472600200610     C                     ELSE
472700200610     C                     Z-ADD*ZERO     WWMKTP
472800200610     C                     ENDIF
472900200610      *
473000200610      ***  Access to Security Details
473100200610      *
473200200610     C                     EXSR #SECTN
473300200610      *
473400200610     C                     MOVE WONMCY    WWNMCY
473500200610     C                     MOVE MSCHTP    WALLOC
473600200610      *
473700200610      ***  Setup Default fields
473800200610      ***  And generate a new depot movement
473900200610      *
474000200610     C                     EXSR #SDPMV
474100200610     C                     MOVE WKTRRF    WWTRR2
474200200610      *
474300200610      ***  Setup specific field for this processing type
474400200610      ***  Generate a Depot Movement for the customer (WI) (new position)
474500200610      *
474600200610     C                     MOVELMCSESN    WWSESN    P      new security
474700200610     C                     MOVELMCSESN    WKSESN    P      new security
474800200610      *
474900200610      ***  Access to Security Details
475000200610      *
475100200610     C                     EXSR #SECTN
475200200610     C                     MOVE 'WI'      WWDPMV           movement type
475300200610     C                     Z-ADDMCASTA    WWDPNA           actual stock allocation
475400200610      *                                                                   148404
475500200610     C           WWDPNA    IFLT *ZEROS                                    148404
475600200610     C                     Z-SUBWWDPNA    WWDPNA                          148404
475700200610     C                     MOVE 'WO'      WWDPMV                          148404
475800200610     C                     ENDIF                                          148404
475900200610      *                                                                   148404
476000200610     C                     Z-ADD1         Y       20
476100200610     C           WWSESN    LOKUPNSEC,Y                   89
476200200610     C           *IN89     IFEQ *ON
476300200610     C***********          MULT AVPR,Y    WWMKTP           AveragePrice(2)163065
476400200610     C                     Z-ADDAVPR,Y    WWMKTP           AveragePrice(2)163065
476500200610     C                     ELSE
476600200610     C                     Z-ADD*ZERO     WWMKTP
476700200610     C                     ENDIF
476800200610      *
476900200610     C                     MOVE WNNMCY    WWNMCY
477000200610     C                     MOVE MSCHTP    WALLOC
477100200610      *
477200200610      ***  Setup Default fields
477300200610      ***  And generate a new depot movement
477400200610      *
477500200610     C                     EXSR #SDPMV
477600200610     C                     MOVE WKTRRF    WWTRR3
477700200610     C                     ENDSL                           Check cust/book ind.
477800200610      *
477900200610     C                     ENDSR
478000200610      *
478100200610      *****************************************************************
478200200610      /EJECT
478300200610      *****************************************************************
478400200610      *  #PRNC  -  Generate Trades/Depot Movements                    *
478500200610      *  -----     for processing type 'NC'                           *
478600200610      *  Called by : #PDPTY                                           *
478700200610      *  Calls     : #SECTN #ACOAT #WTRAD #SDPMV                      *
478800200610      *****************************************************************
478900200610      *
479000200610     C           #PRNC     BEGSR
479100200610      *
479200200610      ***  If the Security Shortname has been changed
479300200610      *
479400200610     C           MLSESN    IFNE *BLANKS
479500200610      *
479600200610      ***  Check Cust/Book indicator
479700200610      *
479800200610     C                     SELEC
479900200610      *
480000200610      ***  If Cust/Book indicator is 'B'
480100200610      *
480200200610     C           MCCOTP    WHEQ 'B'
480300200610      *
480400200610      ***  Setup specific field for this processing type
480500200610      ***  Generate a Trade Sale for the book (old position)
480600200610      *
480700200610     C                     MOVELMASESN    WWSESN    P      old security
480800200610     C                     MOVELMASESN    WKSESN    P
480900200610     C                     MOVE 'TS'      WWTDTP           Sale
481000200610     C                     Z-ADDMCEXPO    WWNOML           Ex-Date position
481100200610     C*****                Z-ADDWWAVR1    WWTPDY           Average Price (137881
481200200610     C                     Z-ADDWWPRIC    WWTPDY                          137881
481300200610      *                                                                   148404
481400200610     C           WWNOML    IFLT *ZEROS                                    148404
481500200610     C                     MOVE 'Y'       WWINVR  1                       148404
481600200610     C                     Z-SUBWWNOML    WWNOML                          148404
481700200610     C                     MOVE 'TP'      WWTDTP                          148404
481800200610     C                     ELSE                                           148404
481900200610     C                     MOVE 'N'       WWINVR                          148404
482000200610     C                     ENDIF                                          148404
482100200610      *
482200200610      ***  Access to Security Details
482300200610      *
482400200610     C                     EXSR #SECTN
482500200610      *
482600200610     C                     MOVE WONMCY    WWNMCY
482700200610      *
482800200610      ***  Access to Corporate Action Type Details to retrieve
482900200610      ***  Settlement Account Code
483000200610      *
483100200610     C                     MOVE MACOAT    WKCOAT
483200200610     C                     EXSR #ACOAT
483300200610      *
483400200610     C                     MOVE BVCOTC    WWCUST
483500200610     C                     MOVE MMACOD    WWSTAC           Settl. Account Code
483600200610     C                     MOVE '01'      WWSTSQ           Settl. Account Seq.
483700200610     C           WWINVR    IFEQ 'Y'                                       148404
483800200610     C                     MOVE *BLANKS   WWPAYT           Pay to         148404
483900200610     C                     MOVELWWPAAC    WWPYFM           Pay from       148404
484000200610     C                     ELSE                                           148404
484100200610     C                     MOVELWWPAAC    WWPAYT           Pay to
484200200610     C                     MOVE *BLANKS   WWPYFM           Pay from
484300200610     C                     ENDIF                                          148404
484400200610     C                     MOVE MSCHTP    WALLOC
484500200610      *
484600200610      ***  Setup Default fields for a new Trade
484700200610      *
484800200610     C                     EXSR #WTRAD
484900200610     C                     MOVE WKTRRF    WWTRR1
485000200610      *
485100200610      ***  Setup specific field for this processing type
485200200610      ***  Generate a Trade Purchase for the book (old position)
485300200610      *
485400200610     C                     MOVELMCSESN    WWSESN    P      new security
485500200610     C                     MOVELMCSESN    WKSESN    P      new security
485600200610     C                     MOVE 'TP'      WWTDTP           Purchase
485700200610     C                     Z-ADDMCASTA    WWNOML           actual stock allocation
485800200610     C*****                Z-ADDWWAVR1    WWTPDY           Average Price (                    137881
485900200610     C                     Z-ADDWWPRIC    WWTPDY                                              137881
486000200610      *                                                                                       148404
486100200610     C           WWNOML    IFLT *ZEROS                                                        148404
486200200610     C                     MOVE 'Y'       WWINVR  1                                           148404
486300200610     C                     Z-SUBWWNOML    WWNOML                                              148404
486400200610     C                     MOVE 'TS'      WWTDTP                                              148404
486500200610     C                     ELSE                                                               148404
486600200610     C                     MOVE 'N'       WWINVR                                              148404
486700200610     C                     ENDIF                                                              148404
486800200610      *
486900200610      ***  Access to Security Details
487000200610      *
487100200610     C                     EXSR #SECTN
487200200610      *
487300200610     C                     MOVE WNNMCY    WWNMCY
487400200610      *
487500200610      ***  Access to Corporate Action Type Details to retrieve
487600200610      ***  Settlement Account Code
487700200610      *
487800200610     C                     MOVE MCCOAT    WKCOAT
487900200610     C                     EXSR #ACOAT
488000200610      *
488100200610     C                     MOVE BVCOTC    WWCUST
488200200610     C                     MOVE MMACOD    WWSTAC           Settl. Account Code
488300200610     C                     MOVE '01'      WWSTSQ           Settl. Account Seq.
488400200610     C           WWINVR    IFEQ 'Y'                                       148404
488500200610     C                     MOVELWWPAAC    WWPAYT           Pay to         148404
488600200610     C                     MOVE *BLANKS   WWPYFM           Pay from       148404
488700200610     C                     ELSE                                           148404
488800200610     C                     MOVE *BLANKS   WWPAYT           Pay to
488900200610     C                     MOVELWWPAAC    WWPYFM           Pay from
489000200610     C                     ENDIF                                          148404
489100200610     C                     MOVE MSCHTP    WALLOC
489200200610      *
489300200610      ***  Setup Default fields for a new Trade
489400200610      *
489500200610     C                     EXSR #WTRAD
489600200610     C                     MOVE WKTRRF    WWTRR2
489700200610      *
489800200610     C           MCCOTP    WHEQ 'C'
489900200610      *
490000200610      ***  If Cust/Book indicator is 'C'
490100200610      *
490200200610      ***  Setup specific field for this processing type
490300200610      ***  Generate a Depot Movement for the customer (WO) (old position)
490400200610      *
490500200610     C                     MOVELMASESN    WWSESN    P      old security
490600200610     C                     MOVELMASESN    WKSESN    P
490700200610     C                     MOVE 'WO'      WWDPMV           movement type
490800200610     C*****                Z-ADDWWAVR1    WWMKTP           Average Price (137881
490900200610     C                     Z-ADDWWPRIC    WWMKTP                          137881
491000200610     C                     Z-ADDMCEXPO    WWDPNA           ex-date position
491100200610      *                                                                   148404
491200200610     C           WWDPNA    IFLT *ZEROS                                    148404
491300200610     C                     Z-SUBWWDPNA    WWDPNA                          148404
491400200610     C                     MOVE 'WI'      WWDPMV                          148404
491500200610     C                     ENDIF                                          148404
491600200610      *
491700200610      ***  Access to Security Details
491800200610      *
491900200610     C                     EXSR #SECTN
492000200610      *
492100200610     C                     MOVE WONMCY    WWNMCY
492200200610     C                     MOVE MSCHTP    WALLOC
492300200610      *
492400200610      ***  Setup Default fields
492500200610      ***  And generate a new depot movement
492600200610      *
492700200610     C                     EXSR #SDPMV
492800200610     C                     MOVE WKTRRF    WWTRR1
492900200610      *
493000200610      ***  Setup specific field for this processing type
493100200610      ***  Generate a Depot Movement for the customer (WI) (old position)
493200200610      *
493300200610     C                     MOVELMCSESN    WWSESN    P      new security
493400200610     C                     MOVELMCSESN    WKSESN    P
493500200610     C                     MOVE 'WI'      WWDPMV           movement type
493600200610     C*****                Z-ADDWWAVR1    WWMKTP           Average Price (137881
493700200610     C                     Z-ADDWWPRIC    WWMKTP                          137881
493800200610     C                     Z-ADDMCASTA    WWDPNA           actual stock allocation
493900200610      *                                                                                       148404
494000200610     C           WWDPNA    IFLT *ZEROS                                                        148404
494100200610     C                     Z-SUBWWDPNA    WWDPNA                                              148404
494200200610     C                     MOVE 'WO'      WWDPMV                                              148404
494300200610     C                     ENDIF                                                              148404
494400200610      *
494500200610      ***  Access to Security Details
494600200610      *
494700200610     C                     EXSR #SECTN
494800200610      *
494900200610     C                     MOVE WNNMCY    WWNMCY
495000200610     C                     MOVE MSCHTP    WALLOC
495100200610      *
495200200610      ***  Setup Default fields
495300200610      ***  And generate a new depot movement
495400200610      *
495500200610     C                     EXSR #SDPMV
495600200610     C                     MOVE WKTRRF    WWTRR2
495700200610     C                     ENDSL                           Check cust/book ind.
495800200610      *
495900200610     C                     ENDIF
496000200610      *
496100200610     C                     ENDSR
496200200610      *
496300200610      *****************************************************************   CEU017
496400200610      /EJECT                                                              CEU017
496500200610      *****************************************************************   CEU017
496600200610      *  #PRCC  -  Generate Trades/Depot Movements                    *   CEU017
496700200610      *  ------    for processing type 'CC'                           *   CEU017
496800200610      *  Called by : #PRCR                                            *   CEU017
496900200610      *  Calls     : #SECTN #ACOAT #WTRAD #SDPMV                      *   CEU017
497000200610      *****************************************************************   CEU017
497100200610      *                                                                   CEU017
497200200610     C           #PRCC     BEGSR                                          CEU017
497300200610      *                                                                   150272
497400200610     C                     MOVE 'N'       WW2TRD  1                       150272
497500200610     C                     MOVE 'N'       WW4TRD  1                       150272
497600200610     C                     MOVE 'N'       WW8TRD  1                       150272
497700200610      *                                                                   150272
497800200610     C                     MOVE 'N'       WW2DPT  1                       150272
497900200610     C                     MOVE 'N'       WW4DPT  1                       150272
498000200610     C                     MOVE 'N'       WW8DPT  1                       150272
498100200610      *                                                                   150272
498200200610     C                     Z-ADD*HIVAL    ZZNOML 110                      150272
498300200610      *                                                                   150272
498400200610     C                     Z-ADD200000000 ZRANG1 150                      150272
498500200610     C           ZRANG1    MULT 1000      ZRANG1                          150272
498600200610     C                     Z-ADD400000000 ZRANG2 150                      150272
498700200610     C           ZRANG2    MULT 1000      ZRANG2                          150272
498800200610      *                                                                   CEU017
498900200610      ***  Check Cust/Book indicator                                      CEU017
499000200610      *                                                                   CEU017
499100200610     C                     SELEC                                          CEU017
499200200610      *                                                                   CEU017
499300200610      ***  If Cust/Book indicator is 'B'                                  CEU017
499400200610      *                                                                   CEU017
499500200610     C           MCCOTP    WHEQ 'B'                                       CEU017
499600200610      *                                                                   CEU017
499700200610      ***  Setup specific field for this processing type                  CEU017
499800200610      ***  Generate a Trade Sale for the book (old position)              CEU017
499900200610      *                                                                   CEU017
500000200610     C                     MOVELMASESN    WWSESN    P      old security   CEU017
500100200610     C                     MOVELMASESN    WKSESN    P                     CEU017
500200200610     C                     MOVE 'TS'      WWTDTP           Sale           CEU017
500300200610      *                                                                   150272
500400200610     C           MCEXPO    IFGT ZZNOML                                    150272
500500200610      *                                                                   150272
500600200610     C           MCEXPO    IFLT ZRANG1                                    150272
500700200610     C                     MOVE 'Y'       WW2TRD                          150272
500800200610     C           MCEXPO    DIV  2         WWNOML           Ex-Date Positio150272
500900200610     C                     ELSE                                           150272
501000200610     C           MCEXPO    IFGE ZRANG1                                    150272
501100200610     C           MCEXPO    ANDLTZRANG2                                    150272
501200200610     C                     MOVE 'Y'       WW4TRD                          150272
501300200610     C           MCEXPO    DIV  4         WWNOML           Ex-Date Positio150272
501400200610     C                     ELSE                                           150272
501500200610     C           MCEXPO    IFGE ZRANG2                                    150272
501600200610     C                     MOVE 'Y'       WW8TRD                          150272
501700200610     C           MCEXPO    DIV  8         WWNOML           Ex-Date Positio150272
501800200610     C                     ENDIF                                          150272
501900200610     C                     ENDIF                                          150272
502000200610     C                     ENDIF                                          150272
502100200610      *                                                                   150272
502200200610     C                     ELSE                                           150272
502300200610     C                     Z-ADDMCEXPO    WWNOML           Ex-Date positioCEU017
502400200610     C                     ENDIF                                          150272
502500200610      *                                                                   150272
502600200610     C                     Z-ADDWWPRIC    WWTPDY           Current AverageCEU017
502700200610      *                                                                   148246
502800200610     C           WWNOML    IFLT *ZEROS                                    148246
502900200610     C                     MOVE 'Y'       WWINVR  1                       148246
503000200610     C                     Z-SUBWWNOML    WWNOML                          148246
503100200610     C                     MOVE 'TP'      WWTDTP                          148246
503200200610     C                     ELSE                                           148246
503300200610     C                     MOVE 'N'       WWINVR                          148246
503400200610     C                     ENDIF                                          148246
503500200610      *                                                                   CEU017
503600200610      ***  Access to Security Details                                     CEU017
503700200610      *                                                                   CEU017
503800200610     C                     EXSR #SECTN                                    CEU017
503900200610      *                                                                   CEU017
504000200610     C                     MOVE WONMCY    WWNMCY                          CEU017
504100200610      *                                                                   CEU017
504200200610      ***  Access to Corporate Action Type Details to retrieve            CEU017
504300200610      ***  Settlement Account Code                                        CEU017
504400200610      *                                                                   CEU017
504500200610     C                     MOVE MACOAT    WKCOAT                          CEU017
504600200610     C                     EXSR #ACOAT                                    CEU017
504700200610      *                                                                   CEU017
504800200610     C                     MOVE BVCOTC    WWCUST                          CEU017
504900200610     C                     MOVE MMACOD    WWSTAC           Settl. Account CEU017
505000200610     C                     MOVE '01'      WWSTSQ           Settl. Account CEU017
505100200610     C           WWINVR    IFEQ 'Y'                                       148246
505200200610     C                     MOVE *BLANKS   WWPAYT           Pay to         148246
505300200610     C                     MOVELWWPAAC    WWPYFM           Pay from       148246
505400200610     C                     ELSE                                           148246
505500200610     C                     MOVELWWPAAC    WWPAYT           Pay to         CEU017
505600200610     C                     MOVE *BLANKS   WWPYFM           Pay from       CEU017
505700200610     C                     ENDIF                                          148246
505800200610     C                     MOVE MSCHTP    WALLOC                          CEU017
505900200610      *                                                                   CEU017
506000200610      ***  Setup Default fields for a new Trade                           CEU017
506100200610      *                                                                   CEU017
506200200610     C                     EXSR #WTRAD                                    CEU017
506300200610     C                     MOVE WKTRRF    WWTRR1                          CEU017
506400200610      *                                                                   150272
506500200610     C           WW2TRD    IFEQ 'Y'                                       150272
506600200610     C                     EXSR #WTRAD                                    150272
506700200610     C                     MOVE WKTRRF    WWTRR2                          150272
506800200610     C                     ELSE                                           150272
506900200610     C           WW4TRD    IFEQ 'Y'                                       150272
507000200610     C                     EXSR #WTRAD                                    150272
507100200610     C                     MOVE WKTRRF    WWTRR2                          150272
507200200610     C                     EXSR #WTRAD                                    150272
507300200610     C                     EXSR #WTRAD                                    150272
507400200610     C                     ELSE                                           150272
507500200610     C           WW8TRD    IFEQ 'Y'                                       150272
507600200610     C                     EXSR #WTRAD                                    150272
507700200610     C                     MOVE WKTRRF    WWTRR2                          150272
507800200610     C                     EXSR #WTRAD                                    150272
507900200610     C                     EXSR #WTRAD                                    150272
508000200610     C                     EXSR #WTRAD                                    150272
508100200610     C                     EXSR #WTRAD                                    150272
508200200610     C                     EXSR #WTRAD                                    150272
508300200610     C                     EXSR #WTRAD                                    150272
508400200610     C                     ENDIF                                          150272
508500200610     C                     ENDIF                                          150272
508600200610     C                     ENDIF                                          150272
508700200610      *                                                                   CEU017
508800200610      ***  Setup specific field for this processing type                  CEU017
508900200610      ***  Generate a Trade Purchase for the book (old position)          CEU017
509000200610      *                                                                   CEU017
509100200610     C                     MOVELMCSESN    WWSESN    P      new security   CEU017
509200200610     C                     MOVELMCSESN    WKSESN    P                     CEU017
509300200610      *                                                                   CEU017
509400200610      ***  Access to Security Details                                     CEU017
509500200610      *                                                                   CEU017
509600200610     C                     EXSR #SECTN                                    CEU017
509700200610      *                                                                   CEU017
509800200610     C                     MOVE 'TP'      WWTDTP           Purchase       CEU017
509900200610     C                     Z-ADDMCASTA    WWNOML           actual stock   CEU017
510000200610      *                                                                   148246
510100200610     C           WWNOML    IFLT *ZEROS                                    148246
510200200610     C                     MOVE 'Y'       WWINVR                          148246
510300200610     C                     Z-SUBWWNOML    WWNOML                          148246
510400200610     C                     MOVE 'TS'      WWTDTP                          148246
510500200610     C                     ELSE                                           148246
510600200610     C                     MOVE 'N'       WWINVR                          148246
510700200610     C                     ENDIF                                          148246
510800200610      *                                                                   148246
510900200610     C                     MOVE '-'       WWSIGN  1        Sign           CEU017
511000200610     C                     EXSR #CAPRC                                    CEU017
511100200610     C                     Z-ADDWWCAPR    WWTPDY           calculated pricCEU017
511200200610      *                                                                   CEU017
511300200610     C                     MOVE WNNMCY    WWNMCY                          CEU017
511400200610      *                                                                   CEU017
511500200610      ***  Access to Corporate Action Type Details to retrieve            CEU017
511600200610      ***  Settlement Account Code                                        CEU017
511700200610      *                                                                   CEU017
511800200610     C                     MOVE MCCOAT    WKCOAT                          CEU017
511900200610     C                     EXSR #ACOAT                                    CEU017
512000200610      *                                                                   CEU017
512100200610     C                     MOVE BVCOTC    WWCUST                          CEU017
512200200610     C                     MOVE MMACOD    WWSTAC           Settl. Account CEU017
512300200610     C                     MOVE '01'      WWSTSQ           Settl. Account CEU017
512400200610     C           WWINVR    IFEQ 'Y'                                       148246
512500200610     C                     MOVELWWPAAC    WWPAYT           Pay to         148246
512600200610     C                     MOVE *BLANKS   WWPYFM           Pay from       148246
512700200610     C                     ELSE                                           148246
512800200610     C                     MOVE *BLANKS   WWPAYT           Pay to         CEU017
512900200610     C                     MOVELWWPAAC    WWPYFM           Pay from       CEU017
513000200610     C                     ENDIF                                          148246
513100200610     C                     MOVE MSCHTP    WALLOC                          CEU017
513200200610      *                                                                   CEU017
513300200610      ***  Setup Default fields for a new Trade                           CEU017
513400200610      *                                                                   CEU017
513500200610     C                     EXSR #WTRAD                                    CEU017
513600200610      *                                                                   150272
513700200610     C           WW2TRD    IFEQ 'Y'                                       150272
513800200610     C           WW4TRD    OREQ 'Y'                                       150272
513900200610     C           WW8TRD    OREQ 'Y'                                       150272
514000200610     C                     MOVE WKTRRF    WWTRR3                          150272
514100200610     C                     ELSE                                           150272
514200200610     C                     MOVE WKTRRF    WWTRR2                          CEU017
514300200610     C                     ENDIF                                          150272
514400200610      *                                                                   CEU017
514500200610     C           MCCOTP    WHEQ 'C'                                       CEU017
514600200610      *                                                                   CEU017
514700200610      ***  If Cust/Book indicator is 'C'                                  CEU017
514800200610      *                                                                   CEU017
514900200610     C           WNOPOS    IFEQ 'N'                                       CEU017
515000200610      *                                                                   CEU017
515100200610      ***  No 'WO' for the dummy customer without a position (CPOSC)      CEU017
515200200610      *                                                                   CEU017
515300200610      ***  Setup specific field for this processing type                  CEU017
515400200610      ***  Generate a Depot Movement for the customer (WO) (old position) CEU017
515500200610      *                                                                   CEU017
515600200610     C                     MOVELMASESN    WWSESN    P      old security   CEU017
515700200610     C                     MOVELMASESN    WKSESN    P                     CEU017
515800200610     C                     MOVE 'WO'      WWDPMV           movement type  CEU017
515900200610     C                     Z-ADDWWPRIC    WWMKTP           Current AverageCEU017
516000200610      *                                                                   150272
516100200610     C           MCEXPO    IFGT ZZNOML                                    150272
516200200610      *                                                                   150272
516300200610     C           MCEXPO    IFLT ZRANG1                                    150272
516400200610     C                     MOVE 'Y'       WW2DPT                          150272
516500200610     C           MCEXPO    DIV  2         WWDPNA           Ex-Date Positio150272
516600200610     C                     ELSE                                           150272
516700200610     C           MCEXPO    IFGE ZRANG1                                    150272
516800200610     C           MCEXPO    ANDLTZRANG2                                    150272
516900200610     C                     MOVE 'Y'       WW4DPT                          150272
517000200610     C           MCEXPO    DIV  4         WWDPNA           Ex-Date Positio150272
517100200610     C                     ELSE                                           150272
517200200610     C           MCEXPO    IFGE ZRANG2                                    150272
517300200610     C                     MOVE 'Y'       WW8DPT                          150272
517400200610     C           MCEXPO    DIV  8         WWDPNA           Ex-Date Positio150272
517500200610     C                     ENDIF                                          150272
517600200610     C                     ENDIF                                          150272
517700200610     C                     ENDIF                                          150272
517800200610      *                                                                   150272
517900200610     C                     ELSE                                           150272
518000200610     C                     Z-ADDMCEXPO    WWDPNA           ex-date positioCEU017
518100200610     C                     ENDIF                                          150272
518200200610      *                                                                   148246
518300200610     C           WWDPNA    IFLT *ZEROS                                    148246
518400200610     C                     Z-SUBWWDPNA    WWDPNA                          148246
518500200610     C                     MOVE 'WI'      WWDPMV                          148246
518600200610     C                     ENDIF                                          148246
518700200610      *                                                                   CEU017
518800200610      ***  Access to Security Details                                     CEU017
518900200610      *                                                                   CEU017
519000200610     C                     EXSR #SECTN                                    CEU017
519100200610      *                                                                   CEU017
519200200610     C                     MOVE WONMCY    WWNMCY                          CEU017
519300200610     C                     MOVE MSCHTP    WALLOC                          CEU017
519400200610      *                                                                   CEU017
519500200610      ***  Setup Default fields                                           CEU017
519600200610      ***  And generate a new depot movement                              CEU017
519700200610      *                                                                   CEU017
519800200610     C                     EXSR #SDPMV                                    CEU017
519900200610     C                     MOVE WKTRRF    WWTRR1                          CEU017
520000200610      *                                                                   150272
520100200610     C           WW2DPT    IFEQ 'Y'                                       150272
520200200610     C                     EXSR #SDPMV                                    150272
520300200610     C                     MOVE WKTRRF    WWTRR2                          150272
520400200610     C                     ELSE                                           150272
520500200610     C           WW4DPT    IFEQ 'Y'                                       150272
520600200610     C                     EXSR #SDPMV                                    150272
520700200610     C                     MOVE WKTRRF    WWTRR2                          150272
520800200610     C                     EXSR #SDPMV                                    150272
520900200610     C                     EXSR #SDPMV                                    150272
521000200610     C                     ELSE                                           150272
521100200610     C           WW8DPT    IFEQ 'Y'                                       150272
521200200610     C                     EXSR #SDPMV                                    150272
521300200610     C                     MOVE WKTRRF    WWTRR2                          150272
521400200610     C                     EXSR #SDPMV                                    150272
521500200610     C                     EXSR #SDPMV                                    150272
521600200610     C                     EXSR #SDPMV                                    150272
521700200610     C                     EXSR #SDPMV                                    150272
521800200610     C                     EXSR #SDPMV                                    150272
521900200610     C                     EXSR #SDPMV                                    150272
522000200610     C                     ENDIF                                          150272
522100200610     C                     ENDIF                                          150272
522200200610     C                     ENDIF                                          150272
522300200610     C                     ENDIF                                          CEU017
522400200610      *                                                                   CEU017
522500200610      ***  Setup specific field for this processing type                  CEU017
522600200610      ***  Generate a Depot Movement for the customer (WI) (old position) CEU017
522700200610      *                                                                   CEU017
522800200610     C                     MOVELMCSESN    WWSESN    P      new security   CEU017
522900200610     C                     MOVELMCSESN    WKSESN    P                     CEU017
523000200610      *                                                                   CEU017
523100200610      ***  Access to Security Details                                     CEU017
523200200610      *                                                                   CEU017
523300200610     C                     EXSR #SECTN                                    CEU017
523400200610      *                                                                   CEU017
523500200610     C                     MOVE 'WI'      WWDPMV           movement type  CEU017
523600200610      *                                                                   CEU017
523700200610     C           WNOPOS    IFEQ 'N'                                       CEU017
523800200610     C                     MOVE '-'       WWSIGN  1        Sign           CEU017
523900200610     C                     EXSR #CAPRC                                    CEU017
524000200610     C                     Z-ADDWWCAPR    WWMKTP           calculated pricCEU017
524100200610     C                     ELSE                                           CEU017
524200200610     C                     Z-ADDWWPRIC    WWMKTP           calculated pricCEU017
524300200610     C                     ENDIF                                          CEU017
524400200610      *                                                                   CEU017
524500200610     C                     Z-ADDMCASTA    WWDPNA           actual stock alCEU017
524600200610      *                                                                   148246
524700200610     C           WWDPNA    IFLT *ZEROS                                    148246
524800200610     C                     Z-SUBWWDPNA    WWDPNA                          148246
524900200610     C                     MOVE 'WO'      WWDPMV                          148246
525000200610     C                     ENDIF                                          148246
525100200610      *                                                                   CEU017
525200200610     C                     MOVE WNNMCY    WWNMCY                          CEU017
525300200610     C                     MOVE MSCHTP    WALLOC                          CEU017
525400200610      *                                                                   CEU017
525500200610      ***  Setup Default fields                                           CEU017
525600200610      ***  And generate a new depot movement                              CEU017
525700200610      *                                                                   CEU017
525800200610     C                     EXSR #SDPMV                                    CEU017
525900200610     C           WNOPOS    IFEQ 'N'                                       CEU017
526000200610      *                                                                   150272
526100200610     C           WW2DPT    IFEQ 'Y'                                       150272
526200200610     C           WW4DPT    OREQ 'Y'                                       150272
526300200610     C           WW8DPT    OREQ 'Y'                                       150272
526400200610     C                     MOVE WKTRRF    WWTRR3                          150272
526500200610     C                     ELSE                                           150272
526600200610     C                     MOVE WKTRRF    WWTRR2                          CEU017
526700200610     C                     ENDIF                                          150272
526800200610      *                                                                   150272
526900200610     C                     ELSE                                           CEU017
527000200610     C                     MOVE WKTRRF    WWTRR1                          CEU017
527100200610     C                     ENDIF                                          CEU017
527200200610     C                     ENDSL                           Check cust/bookCEU017
527300200610      *                                                                   CEU017
527400200610     C                     ENDSR                                          CEU017
527500200610      *                                                                   CEU017
527600200610      *****************************************************************
527700200610      /EJECT
527800200610      *****************************************************************
527900200610      *  #POSET -  Retrieve current Position Settlement and update it *
528000200610      *  ------    to deleted or matured depending on record id       *
528100200610      *  Called by : #POSRV                                           *
528200200610      *  Calls     : *PSSR                                            *
528300200610      *****************************************************************
528400200610      *
528500200610     C           #POSET    BEGSR
528600200610      *
528700200610      ***  Access Posistion Settlement file to retrieve current Position Settlement
528800200610      *
528900200610     C           KWPOSE    CHAINPOSET1               88
529000200610      *
529100200610     C           *IN88     IFEQ *OFF
529200200610      *
529300200610      ***  Check Record Identifier for Position Settlement file
529400200610      *
529500200610     C                     SELEC
529600200610      *
529700200610      ***  If record identifier is 'D'
529800200610      *
529900200610     C           RECI      WHEQ 'D'
530000200610     C                     MOVE '*'       RECI             deleted
530100200610     C                     MOVE 'D'       CHTP
530200200610     C                     Z-ADDBJRDNB    LCD
530300200610     C                     UPDATPOSETDF                89
530301200616     C                     EXSR PSAUDT                                                      AR324886
530400200610      *
530500200610      ***  Record not found
530600200610      *
530700200610     C           *IN89     IFEQ *ON
530800200610     C           *LOCK     IN   LDA
530900200610     C                     Z-ADD3         DBASE            ***************
531000200610     C                     MOVEL*BLANKS   DBFILE           * DB ERROR 03 *
531100200610     C                     MOVE 'POSETDF 'DBFILE           ***************
531200200610     C                     MOVELWWPOSE    DBKEY     P
531300200610     C                     MOVEL'SE7560'  DBPGM     P
531400200610     C                     OUT  LDA
531500200610     C                     EXSR *PSSR
531600200610     C                     ENDIF                           *IN89=*ON
531700200610      *
531800200610     C                     ADD  1         W03CNT
531900200610     C                     MOVE 'Y'       WWDATA           one Read
532000200610      *
532100200610      ***  If record identifier is 'M'
532200200610      *
532300200610     C           RECI      WHEQ 'M'
532400200610     C                     MOVE 'R'       RECI             Matured
532500200610     C                     MOVE 'R'       CHTP
532600200610     C                     Z-ADDBJRDNB    LCD
532700200610     C                     UPDATPOSETDF                89
532701200616     C                     EXSR PSAUDT                                                      AR324886
532800200610      *
532900200610      ***  Record not found
533000200610      *
533100200610     C           *IN89     IFEQ *ON
533200200610     C           *LOCK     IN   LDA
533300200610     C                     Z-ADD4         DBASE            ***************
533400200610     C                     MOVEL*BLANKS   DBFILE           * DB ERROR 04 *
533500200610     C                     MOVE 'POSETDF 'DBFILE           ***************
533600200610     C                     MOVELWWPOSE    DBKEY     P
533700200610     C                     MOVEL'SE7560'  DBPGM     P
533800200610     C                     OUT  LDA
533900200610     C                     EXSR *PSSR
534000200610     C                     END
534100200610      *
534200200610     C                     ADD  1         W06CNT
534300200610     C                     MOVE 'Y'       WWDATA           one Read
534400200610     C                     ENDSL                           Check RECI
534500200610     C                     ENDIF                           *IN88=*OFF
534600200610      *
534700200610     C                     ENDSR
534800200610      *
534900200610      *****************************************************************
535000200610      /EJECT
535100200610      *****************************************************************
535200200610      *  #WTRAD -  Setup default fields for a new Trade               *
535300200610      *  ------                                                       *
535400200610      *  Called by : #PRDV #PRFRR #PRFRO #PRFRA #PRCRR #PRCRA #PRCE   *
535500200610      *              #PROFE #PROFP #PREX #PRTGZ #PRRGM #PRRGC #PRNC   *
535600200610      *  Calls     : #ACOAT #AOSEC ZNCD ZASIGN SPRCI ZBKDP ZAPNUM     *
535700200610      *              #AOPRF ZCCYCN ZTNLU1                             *
535800200610      *****************************************************************
535900200610      *
536000200610     C           #WTRAD    BEGSR
536100200610      *
536200200610      ** .. Trade reference
536300200610     C                     MOVE WWNTR1    WKTRRF  6
536400200610     C           WKTRRF    CHAINTRADHS               89
536500200610      *
536600200610     C           *IN89     DOWEQ*OFF
536700200610     C                     ADD  1         WWNTR1
536800200610     C                     MOVE WWNTR1    WKTRRF
536900200610     C           WKTRRF    CHAINTRADHS               89
537000200610     C                     ENDDO
537100200610     C                     ADD  1         WWNTR1
537200200610      *
537300200610     C                     CLEARTRADSDF
537400200610      *
537500200610      ** .. Branch
537600200610     C                     MOVE MCBRCD    TDBA
537700200610      ** .. Originat. Branch
537800200610     C                     MOVE MCBRCD    ORBR
537900200610      ** .. Book
538000200610     C                     MOVE MCBOOK    TDBK
538100200610      *
538200200610     C                     MOVE WKTRRF    TDRF
538300200610      *
538400200610      ***  Setup Specific fields
538500200610      *
538600200610      ** .. New Security
538700200610     C                     MOVE WWSESN    TDSS
538800200610      ** .. Trade Type
538900200610     C                     MOVE WWTDTP    TDTP
539000200610      ** .. Nominal
539100200610     C                     MOVE WWNOML    NOML
539200200610      ** .. Price/Discount/Yield
539300200610     C                     Z-ADDWWTPDY    TPDY
539400200610      ** .. Pay From
539500200610     C                     MOVE WWPYFM    PYFM
539600200610      ** .. Pay to
539700200610     C                     MOVE WWPAYT    PAYT
539800200610      *
539900200610     C                     MOVE WWNMCY    WKNMCY
540000200610     C           WONMCY    IFEQ WWNMCY
540100200610     C                     MOVE WOSITP    WKSITP
540200200610     C                     ELSE
540300200610     C                     MOVE WNSITP    WKSITP
540400200610     C                     ENDIF
540500200610      ***  Retrieve the processing type
540600200610     C           KWINV     CHAININVTP                89
540700200610     C           *IN89     IFEQ *ON
540800200610     C           RECI      OREQ '*'
540900200610     C           *LOCK     IN   LDA
541000200610     C                     Z-ADD5         DBASE            ***************
541100200610     C                     MOVEL*BLANKS   DBFILE           * DB ERROR 05 *
541200200610     C                     MOVE 'INVTP   'DBFILE           ***************
541300200610     C                     MOVELWWINV     DBKEY     P
541400200610     C                     MOVEL'SE7560'  DBPGM     P
541500200610     C                     OUT  LDA
541600200610     C                     EXSR *PSSR
541700200610     C                     ENDIF
541800200610      ** .. Incomplete indicator
541900200610     C                     MOVE 'C'       TINC
542000200610      ** .. Counterparty Customer number
542100200610     C                     MOVE BVCOTC    TCNR
542200200610      ** .. Nominal currency
542300200610     C                     MOVE WWNMCY    TNMC
542400200610      ** .. Nominal decimal places
542500200610     C           WWNMCY    IFEQ WONMCY
542600200610     C                     Z-ADDWONMDP    TNMD
542700200610     C                     ELSE
542800200610     C                     Z-ADDWNNMDP    TNMD
542900200610     C                     ENDIF
543000200610      ** .. Value Date
543100200610     C                     Z-ADDMAALEF    TDVD
543200200610      *                                                                   151356
543300200610      ** Calculate Yield                                                  151356
543400200610     C           WWNMCY    IFEQ WONMCY                                    151356
543500200610     C                     MOVE WOSTBS    STBS                            151356
543600200610     C                     ELSE                                           151356
543700200610     C                     MOVE WNSTBS    STBS                            151356
543800200610     C                     ENDIF                                          151356
543900200610      *                                                                   151356
544000200610     C           STBS      IFEQ 'Y'                                       151356
544100200610     C                     Z-ADDTPDY      ZPRICE                          151356
544200200610     C                     Z-ADDTDVD      ZFDATE                          151356
544300200610     C           WWNMCY    IFEQ WONMCY                                    151356
544400200610     C                     Z-ADDWOMATY    MATY                            151356
544500200610     C                     MOVELWOSYBS    SYBS                            151356
544600200610     C                     ELSE                                           151356
544700200610     C                     Z-ADDWNMATY    MATY                            151356
544800200610     C                     MOVELWNSYBS    SYBS                            151356
544900200610     C                     ENDIF                                          151356
545000200610     C                     EXSR ZPRCO                                     151356
545100200610     C                     Z-ADDZPRCOT    TPDY                            151356
545200200610     C                     ENDIF                                          151356
545300200610      ** .. Trade Date
545400200610     C                     Z-ADDMATDDT    TDDT
545500200610      ** .. Trade Subtype
545600200610      *
545700200610      ***  Access to Corporate Action Type Details to retrieve
545800200610      ***  Settlement Account Code
545900200610      *
546000200610     C                     MOVE MACOAT    WKCOAT
546100200610     C                     EXSR #ACOAT
546200200610      *
546300200610     C           MMTSUB    IFNE *BLANKS
546400200610     C                     MOVE MMTSUB    TSUB
546500200610     C                     ELSE
546600200610      *
546700200610      ***  Retrieve the classification from PF/SDSECDPD
546800200610      *
546900200610     C                     MOVELTCNR      WCUST
547000200610     C                     EXSR #AOSEC
547100200610      *
547200200610     C           BFCLAS    IFEQ 'M'
547300200610      *
547400200610      ***  Retrieve the Default Maket Subtype
547500200610      *
547600200610     C                     MOVE BVDMKS    TSUB
547700200610     C                     ELSE
547800200610      *
547900200610      ***  Retrieve the Default Portfolio Subtype
548000200610      *
548100200610     C                     MOVE BVDPFS    TSUB
548200200610     C                     ENDIF
548300200610     C                     ENDIF
548400200610      ** .. Link Reference
548500200610     C                     MOVE *BLANKS   LKRF
548600200610      ** .. Market Indicator
548700200610     C           WWNMCY    IFEQ WONMCY
548800200610     C                     MOVE WOMKTI    TDMI
548900200610     C                     ELSE
549000200610     C                     MOVE WNMKTI    TDMI
549100200610     C                     ENDIF
549200200610      ** .. Narrative
549300200610     C                     MOVELDNARR     WWTEXT
549400200610     C                     MOVE MACORF    WWCROF
549500200610     C                     MOVE MACOAT    WWCOAT
549600200610     C                     MOVE WWDNAR    TDNR
549700200610      ** .. Trader ID
549800200610     C                     MOVEL*BLANKS   TDID
549900200610      ** .. AIBD/IPMA
550000200610     C                     MOVE 'Y'       AIIP
550100200610      ** .. Market Centre
550200200610     C           WWNMCY    IFEQ WONMCY
550300200610     C                     MOVELWOSMCC    TMKC
550400200610     C                     MOVE WOEDFT    EDFT
550500200610     C                     ELSE
550600200610     C                     MOVELWNSMCC    TMKC
550700200610     C                     MOVE WNEDFT    EDFT
550800200610     C                     ENDIF
550900200610      ** .. Capacity
551000200610     C                     Z-ADD*ZEROS    TCAP
551100200610      ** .. Accrued Indicator
551200200610     C                     EXSR ZNCD
551300200610     C                     MOVE 'C'       ACIN             Default
551400200610     C           TDVD      IFEQ NCD
551500200610     C                     MOVE 'F'       ACIN
551600200610     C***********          ELSE                                           151173
551700200610     C***********          MOVELEDFT      ZNRDYS  20                      151173
551800200610     C***********ZNRDYS    IFNE *ZEROS                                    151173
551900200610     C***********TDVD      IFLT NCD                                       151173
552000200610     C***********TDVD      ANDGEZDYNBR                                    151173
552100200610     C***********          MOVE 'X'       ACIN                            151173
552200200610     C***********          ENDIF                                          151173
552300200610     C***********          ENDIF                                          151173
552400200610     C                     ENDIF
552500200610      ** .. Days Adjustment
552600200610     C                     MOVE *ZEROS    DADJ
552700200610      ** .. Actual/Difference Indicator
552800200610     C                     MOVE *BLANKS   ADIN
552900200610      ** .. Coupon Rate                                                   148661
553000200610     C           WWNMCY    IFEQ WONMCY                                    148661
553100200610     C                     Z-ADDWOCPNR    TDCR                            148661
553200200610     C                     ELSE                                           148661
553300200610     C                     Z-ADDWNCPNR    TDCR                            148661
553400200610     C                     ENDIF                                          148661
553500200610      ** .. Interest Amount
553600200610     C           DYBS      IFNE ' '
553700200610     C           DVBS      ANDNE' '
553800200610     C                     MOVE ACIN      ZACIN
553900200610     C                     Z-ADD0         ZDADJ
554000200610     C                     MOVE *BLANKS   ZADIN
554100200610     C                     MOVE 'N'       ZCPOVR
554200200610     C***********          Z-ADDTNMD      ZCDP                            151173
554300200610     C           WWNMCY    IFEQ WONMCY                                    151173
554400200610     C                     Z-ADDWONBDP    ZCDP                            151173
554500200610     C                     ELSE                                           151173
554600200610     C                     Z-ADDWNNBDP    ZCDP                            151173
554700200610     C                     ENDIF                                          151173
554800200610     C                     Z-ADDMAALEF    ECD                             151173
554900200610     C                     EXSR ZPCINT
555000200610     C                     Z-ADDZITRA     ITRA
555100200610     C                     ELSE
555200200610     C                     Z-ADD*ZEROS    ITRA
555300200610     C                     ENDIF
555400200610      ** .. Interest Adjustment
555500200610     C                     MOVE *ZEROS    TINA
555600200610      *                                                                                       CAS006
555700200610      ** Set the Interest Amount and Interest Adjustment Using Net-                           CAS006
555800200610      ** Treasury-Rate fields if CAS006 is enabled.                                           CAS006
555900200610      *                                                                                       CAS006
556000200610     C           CAS006    IFEQ 'Y'                                                           CAS006
556100200610      *                                                                                       CAS006
556200200610     C           DYBS      IFNE *BLANK                                                        CAS006
556300200610     C           DVBS      ANDNE*BLANK                                                        CAS006
556400200610      *                                                                                       CAS006
556500200610      ** Reuse the parameters of the previous Purchased Interest on a                         CAS006
556600200610      ** Trade calculation except the Coupon Rate.                                            CAS006
556700200610      *                                                                                       CAS006
556800200610     C                     Z-ADDTDCR      WTDCR  117                                          CAS006
556900200610     C                     Z-ADDCPNN      TDCR                                                CAS006
557000200610     C                     EXSR ZPCINT                                                        CAS006
557100200610     C                     Z-ADDZITRA     ITRN                                                CAS006
557200200610     C                     Z-ADDWTDCR     TDCR                                                CAS006
557300200610     C                     ELSE                                                               CAS006
557400200610     C                     Z-ADD*ZERO     ITRN                                                CAS006
557500200610     C                     ENDIF                                                              CAS006
557600200610      *                                                                                       CAS006
557700200610     C                     ELSE                                                               CAS006
557800200610     C                     Z-ADD*ZERO     ITRN                                                CAS006
557900200610     C                     ENDIF                                                              CAS006
558000200610      *                                                                                       CAS006
558100200610     C                     Z-ADD*ZERO     TINN                                                CAS006
558200200610      *                                                                                       CAS006
558300200610      ***..*Coupon Rate************************************************** 148661
558400200610     C********** WWNMCY    IFEQ WONMCY                                    148661
558500200610     C**********           Z-ADDWOCPNR    TDCR                            148661
558600200610     C**********           ELSE                                           148661
558700200610     C**********           Z-ADDWNCPNR    TDCR                            148661
558800200610     C**********           ENDIF                                          148661
558900200610      ** .. Price
559000200610     C           WWNMCY    IFEQ WONMCY
559100200610     C                     MOVE WOSTBS    STBS
559200200610     C                     ELSE
559300200610     C                     MOVE WNSTBS    STBS
559400200610     C                     ENDIF
559500200610      *
559600200610     C                     Z-ADD*ZERO     PRIC
559700200610     C           STBS      IFEQ 'D'
559800200610     C           STBS      OREQ 'Y'
559900200610     C                     MOVELTPDY      ZPRCIN
560000200610     C                     Z-ADDTDVD      ZFDATE
560100200610     C           WWNMCY    IFEQ WONMCY
560200200610     C                     Z-ADDWOMATY    MATY
560300200610     C                     MOVELWOSYBS    SYBS
560400200610     C                     ELSE
560500200610     C                     Z-ADDWNMATY    MATY
560600200610     C                     MOVELWNSYBS    SYBS
560700200610     C                     ENDIF
560800200610     C                     EXSR ZPRCI
560900200610     C                     Z-ADDZPRCOT    PRIC
561000200610     C                     ELSE
561100200610     C                     Z-ADDTPDY      PRIC
561200200610     C                     ENDIF
561300200610      ** .. Ex-Dividend
561400200610     C           WWNMCY    IFEQ WONMCY
561500200610     C                     Z-ADDWONDVD    NDVD
561600200610     C                     ELSE
561700200610     C                     Z-ADDWNNDVD    NDVD
561800200610     C                     ENDIF
561900200610      *
562000200610     C           NDVD      IFEQ *ZEROS
562100200610     C                     MOVE 'C'       EXDV
562200200610     C                     ELSE
562300200610     C                     MOVELEDFT      ZNRDYS
562400200610      *
562500200610     C           ZNRDYS    IFNE *ZEROS
562600200610     C                     MOVE EDFT      WEDFT   1
562700200610      *
562800200610     C           WEDFT     IFEQ 'W'
562900200610      ***  If working days
563000200610     C                     Z-ADDNDVD      ZDAYNO
563100200610     C                     MOVE WWNMCY    ZCCY
563200200610     C                     MOVE *BLANKS   ZLOC
563300200610     C                     EXSR ZBKDT
563400200610     C                     ELSE
563500200610      ***  If actual days
563600200610     C           NDVD      SUB  ZNRDYS    ZDYNBR
563700200610     C                     ENDIF
563800200610      *
563900200610     C           TDDT      IFLT NDVD
564000200610     C           TDDT      ANDGEZDYNBR
564100200610     C                     MOVE 'X'       EXDV
564200200610     C                     ENDIF
564300200610     C                     ENDIF
564400200610     C                     ENDIF
564500200610      ** .. Reallowance
564600200610     C                     MOVE *ZEROS    RALL
564700200610      ** .. Settlement Currency
564800200610     C           WWNMCY    IFEQ WONMCY
564900200610     C                     MOVE WONMCY    SETC
565000200610     C                     ELSE
565100200610     C                     MOVELTCNR      WCUST
565200200610     C                     EXSR #AOSEC
565300200610     C*                                                                   148959
565400200610     C*** Settlement Currency for SE Redenomination should always         148959
565500200610     C*** equal to the nominal currency of the old Security.              148959
565600200610     C*                                                                   148959
565700200610     C           MAPTYP    IFEQ 'CC'                                      148959
565800200610     C                     MOVE WONMCY    SETC                            148959
565900200610     C                     ELSE                                           148959
566000200610     C*                                                                   148959
566100200610     C           WNMLTI    IFNE 'Y'
566200200610     C           BFCLAS    ANDNE'S'
566300200610     C           BFCLAS    ANDNE'D'
566400200610     C                     MOVE WNNMCY    SETC
566500200610     C                     ELSE
566600200610     C                     MOVE WONMCY    SETC
566700200610     C                     ENDIF
566800200610     C                     ENDIF
566900200610     C*                                                                   148959
567000200610     C                     ENDIF                                          148959
567100200610      ** .. Exchange Rate
567200200610      *
567300200610      ***  .. Settlement currency is not = Nominal currency
567400200610      ***                         - Calculate cross rate
567500200610      *
567600200610     C           SETC      IFEQ TNMC
567700200610     C                     Z-ADD1         TDER
567800200610     C                     MOVE 'M'       TMDI                            151062
567900200610     C                     ELSE
568000200610     C                     CALL 'AOCURRR0'
568100200610     C                     PARM *BLANKS   @RTCD   7
568200200610     C                     PARM '*KEY   ' @OPTN   7
568300200610     C                     PARM TNMC      @CYCD   3
568400200610     C           SDCURR    PARM SDCURR    DSSDY
568500200610      *
568600200610     C                     Z-ADDA6SPRT    ZRATE1 138
568700200610     C                     MOVE A6MDIN    ZMDI1   1
568800200610     C                     MOVE A6INCY    WWINCY  1                       153345
568900200610      *
569000200610     C                     CALL 'AOCURRR0'
569100200610     C                     PARM *BLANKS   @RTCD   7
569200200610     C                     PARM '*KEY   ' @OPTN   7
569300200610     C                     PARM SETC      @CYCD   3
569400200610     C           SDCURR    PARM SDCURR    DSSDY
569500200610      *
569600200610     C                     Z-ADDA6SPRT    ZRATE2 138
569700200610     C                     MOVE A6MDIN    ZMDI2   1
569800200610     C                     EXSR ZXRATE
569900200610      *                                                                   153345
570000200610     C           TNMC      IFEQ BKEURO                                    153345
570100200610     C           A6INCY    ANDEQ'Y'                                       153345
570200200610     C           TDVD      ANDGEA6TPSD                                    153345
570300200610     C           SETC      OREQ BKEURO                                    153345
570400200610     C           WWINCY    ANDEQ'Y'                                       153345
570500200610     C           TDVD      ANDGEA6TPSD                                    153345
570600200610     C                     Z-ADDA6EUER    TDER                            153345
570700200610     C                     ELSE                                           153345
570800200610     C                     Z-ADDZRATEX    TDER
570900200610     C                     ENDIF                                          153345
571000200610      ** .. Multiply/Divide Ind.                                          151062
571100200610     C                     MOVE ZMDIX     TMDI                            151062
571200200610     C                     ENDIF
571300200610      ***..*Multiply/Divide*Ind.***************************************** 151062
571400200610     C*****                MOVE 'M'       TMDI                            151062
571500200610      ** .. Base Currency Rate
571600200610     C           SETC      IFEQ TNMC                                      151954
571700200610     C           WWNMCY    IFEQ WONMCY
571800200610     C                     Z-ADDWOSPRT    TBCR
571900200610     C                     ELSE
572000200610     C                     Z-ADDWNSPRT    TBCR
572100200610     C                     ENDIF
572200200610     C                     ELSE                                           151954
572300200610     C                     Z-ADDA6SPRT    TBCR                            151954
572400200610     C                     ENDIF                                          151954
572500200610      ** .. Settlement method
572600200610     C                     Z-ADD5         SMTH
572700200610      ** .. Pay from branch
572800200610     C           TDTP      IFEQ 'TP'
572900200610     C                     MOVE TDBA      PYFA
573000200610     C                     ENDIF
573100200610      ** .. Pay to branch
573200200610     C           TDTP      IFEQ 'TS'
573300200610     C                     MOVE TDBA      PYTA
573400200610     C                     ENDIF
573500200610      ** .. For Account of (Deliver to)
573600200610     C                     MOVE *BLANKS   TDFA
573700200610      ** .. Account Sequence Number
573800200610     C                     MOVE *BLANKS   ASNM
573900200610      ** .. Deliver to
574000200610     C********** TDTP      IFEQ 'TP'                                      148741
574100200610     C**********           Z-ADDMSDDPT    DELT                                                CSD027
574200200610     C                     MOVE MSDDPT    DELT                                                CSD027
574300200610     C**********           ENDIF                                          148741
574400200610      ** .. For Account of
574500200610     C                     MOVE *BLANKS   DTFA
574600200610      ** .. Deliver from
574700200610     C********** TDTP      IFEQ 'TS'                                      148741
574800200610     C**********           Z-ADDMSDDPT    DELF                                                CSD027
574900200610     C                     MOVE MSDDPT    DELF                                                CSD027
575000200610     C**********           ENDIF                                          148741
575100200610      ** .. Clearance type depends on Deliver To/Deliver From fields
575200200610     C                     MOVE '5'       CLTY
575300200610      *
575400200610     C           TDTP      IFEQ 'TP'
575500200610      *
575600200610     C                     MOVELDELT      WCUST            Deliver to
575700200610     C                     EXSR #AOSEC
575800200610     C                     SELEC
575900200610     C           BFCLAS    WHEQ 'E'                        Deliver to Euroclear
576000200610     C**********           MOVE '2'       CLTY                            148741
576100200610     C                     MOVE '1'       CLTY                            148741
576200200610     C           BFCLAS    WHEQ 'C'                        Deliver to Cedel
576300200610     C**********           MOVE '2'       CLTY                            147104
576400200610     C**********           MOVE '4'       CLTY                     147104 148741
576500200610     C                     MOVE '3'       CLTY                            148741
576600200610     C                     ENDSL
576700200610     C                     ELSE
576800200610      *
576900200610     C                     MOVELDELF      WCUST            Deliver from
577000200610     C                     EXSR #AOSEC
577100200610     C                     SELEC
577200200610     C           BFCLAS    WHEQ 'E'                        Deliver from Euroclear
577300200610     C**********           MOVE '2'       CLTY                            148741
577400200610     C                     MOVE '1'       CLTY                            148741
577500200610     C           BFCLAS    WHEQ 'C'                        Deliver from Cedel
577600200610     C**********           MOVE '2'       CLTY                            147104
577700200610     C**********           MOVE '4'       CLTY                     147104 148741
577800200610     C                     MOVE '3'       CLTY                            148741
577900200610     C                     ENDSL
578000200610     C                     ENDIF
578100200610      ** .. For Account of
578200200610     C                     MOVE *BLANKS   DFFA
578300200610      ** .. Special Instruction
578400200610     C                     MOVE *BLANKS   TDSI
578500200610      ** .. Priority Code
578600200610     C                     MOVE 'R'       PRYC
578700200610      ** .. Pay Code
578800200610     C                     MOVE '3'       PCOD
578900200610      ** .. Broker Commission Code
579000200610     C                     MOVE *BLANKS   TBCC
579100200610      ** .. Broker Commission Amount
579200200610     C                     Z-ADD*ZEROS    TBCA
579300200610      ** .. Broker Commission Code
579400200610     C                     MOVE *BLANKS   TCCC
579500200610      ** .. Customer Commission Amount
579600200610     C                     Z-ADD*ZEROS    TCCA
579700200610      ** .. Charges Code 1 - 7
579800200610     C                     MOVE *BLANKS   TCC1
579900200610     C                     MOVE *BLANKS   TCC2
580000200610     C                     MOVE *BLANKS   TCC3
580100200610     C                     MOVE *BLANKS   TCC4
580200200610     C                     MOVE *BLANKS   TCC5
580300200610     C                     MOVE *BLANKS   TCC6
580400200610     C                     MOVE *BLANKS   TCC7
580500200610      ** .. Charges Amount 1 - 7
580600200610     C                     Z-ADD*ZEROS    TCA1
580700200610     C                     Z-ADD*ZEROS    TCA2
580800200610     C                     Z-ADD*ZEROS    TCA3
580900200610     C                     Z-ADD*ZEROS    TCA4
581000200610     C                     Z-ADD*ZEROS    TCA5
581100200610     C                     Z-ADD*ZEROS    TCA6
581200200610     C                     Z-ADD*ZEROS    TCA7
581300200610      ** .. Tax Amount
581400200610     C                     Z-ADD*ZEROS    TAXA
581500200610      ** .. Broker Commission Rebate
581600200610     C                     Z-ADD0         BCMR
581700200610      ** .. Customer Commission Rebate
581800200610     C                     Z-ADD0         CCMR
581900200610      ** .. Tax Rebate
582000200610     C                     Z-ADD0         TXRB
582100200610      ** .. Bulk Reference
582200200610     C                     MOVE *BLANKS   BLKR
582300200610      ** .. Related Trade Reference
582400200610     C                     MOVE *BLANKS   RTRF
582500200610      ** .. Agency Trade Identifier
582600200610     C                     MOVE *BLANKS   ATRD
582700200610      ** .. Bulk confirmation required
582800200610     C                     MOVE *BLANKS   BCON
582900200610      ** .. Time of Input
583000200610     C                     TIME           WWTIME  60
583100200610     C                     Z-ADDWWTIME    TIME
583200200610      ** .. Autosettle Indicator
583300200610     C           WWNMCY    IFEQ WONMCY
583400200610     C                     MOVE WOMKTI    WWMKTI  1
583500200610     C                     ELSE
583600200610     C                     MOVE WNMKTI    WWMKTI
583700200610     C                     ENDIF
583800200610      *
583900200610     C           WWMKTI    IFEQ 'G'
584000200610     C                     MOVE 'N'       AUTS
584100200610     C                     ELSE
584200200610     C                     MOVELTCNR      WCUST
584300200610     C                     EXSR #AOSEC
584400200610     C                     MOVE BFASIN    AUTS             Count. aut. settl. ind
584500200610     C                     ENDIF
584600200610      ** .. Accounting Indicator
584700200610     C                     BITOF'01234567'TACI
584800200610      ** .. Message Indicator
584900200610     C                     BITOF'01234567'TMSI
585000200610      ** .. Confirmation Required
585100200610     C                     MOVE 'N'       TCFR
585200200610      ** .. Outstanding Nominal
585300200610     C                     Z-ADDNOML      TOSN
585400200610      ** .. Nominal Settled - not posted
585500200610     C                     Z-ADD*ZEROS    TNSN
585600200610      ** .. Nominal Settled - posted
585700200610     C                     Z-ADD*ZEROS    TNSP
585800200610      ** .. Value Settled - not posted
585900200610     C                     Z-ADD*ZEROS    TVSN
586000200610      ** .. Value Settled - posted
586100200610     C                     Z-ADD*ZEROS    TVSP
586200200610      ** .. Discrepancy - not posted
586300200610     C                     Z-ADD*ZEROS    TDSN
586400200610      ** .. Discrepancy - posted
586500200610     C                     Z-ADD*ZEROS    TDSP
586600200610      ** .. Date Fully Settled
586700200610     C                     Z-ADD*ZEROS    TDFS
586800200610      ** .. Settlement Sequence
586900200610     C                     Z-ADD*ZEROS    TSSQ
587000200610      ** .. Consideration
587100200610      *
587200200610      ***  If Security equal to event Security use nominal dec. places of event Security
587300200610      ***  else of new security
587400200610      *
587500200610     C           WOSESN    IFEQ TDSS
587600200610     C                     Z-ADDWONMDP    ZNMDP
587700200610     C                     Z-ADDWONBDP    ZNMCD
587800200610     C                     MOVE WOSPBS    ZPRCB
587900200610     C                     ELSE
588000200610     C                     Z-ADDWNNMDP    ZNMDP
588100200610     C                     Z-ADDWNNBDP    ZNMCD
588200200610     C                     MOVE WNSPBS    ZPRCB
588300200610     C                     ENDIF
588400200610      *
588500200610     C                     Z-ADDNOML      ZNOML
588600200610     C                     Z-ADDPRIC      ZAVPR
588700200610     C                     EXSR ZAPNUM
588800200610     C                     Z-ADDZVALU     TCSR
588900200610      ** .. Countervalue
589000200610      *
589100200610      ***  consideration +/- purchase interest +/- reallowance +/- charges +/- commissions
589200200610      *
589300200610     C                     Z-ADD0         ZWRALL
589400200610     C                     Z-ADDTCSR      ZCONS  150
589500200610     C                     MOVE WWNMCY    NMCY
589600200610     C           WWNMCY    IFEQ WONMCY
589700200610     C                     MOVE WOSPBS    SPBS
589800200610     C                     Z-ADDWONMDP    NMDP
589900200610     C                     Z-ADDWOCFCT    CFCT
590000200610     C                     Z-ADDWONBDP    ZCDP
590100200610     C                     ELSE
590200200610     C                     MOVE WNSPBS    SPBS
590300200610     C                     Z-ADDWNNMDP    NMDP
590400200610     C                     Z-ADDWNCFCT    CFCT
590500200610     C                     Z-ADDWNNBDP    ZCDP
590600200610     C                     ENDIF
590700200610     C                     EXSR ZCOTR
590800200610     C                     Z-ADDZCTRVL    TCTR
590900200610      ** .. Outstanding Value (contervalue converted in SETTLEMENT CURRENCY)
591000200610     C                     Z-ADD*ZEROS    TOSV
591100200610     C                     Z-ADDTCTR      ZAMTF
591200200610      *
591300200610      ***  If Settlement Currency is not equal to nominal currency
591400200610      *
591500200610     C           SETC      IFNE TNMC
591600200610     C           ZAMTF     ANDNE*ZEROS
591700200610     C                     MOVE WNNMCY    ZCCYF
591800200610     C                     MOVE WNSPRT    ZRATEF
591900200610     C                     MOVE WNMDIN    ZMDINF
592000200610     C                     MOVE WNNBDP    ZCDPF
592100200610     C                     MOVE WONMCY    ZCCYT
592200200610     C                     MOVE WOSPRT    ZRATET
592300200610     C                     MOVE WOMDIN    ZMDINT
592400200610     C                     MOVE WONBDP    ZCDPT
592500200610     C                     EXSR ZCCYCN
592600200610     C                     Z-ADDZAMTT     TOSV
592700200610     C                     ELSE
592800200610     C                     Z-ADDTCTR      TOSV
592900200610     C                     ENDIF
593000200610      ** .. Date Made Complete
593100200610     C                     Z-ADDBJRDNB    TDMC
593200200610      ** .. Original Entry Date
593300200610     C                     Z-ADDBJRDNB    TOED
593400200610      ** .. Profit Center
593500200610     C                     MOVE *BLANKS   PRFC
593600200610      *
593700200610      ***   If Profit Centre used
593800200610      ***   and Analytical Accounting Module is off
593900200610      *
594000200610     C           BKPRCU    IFEQ 'Y'
594100200610     C           BGN0ST    ANDNE'Y'
594200200610      *
594300200610      ***  If Book position/profit centres are to be reconciled
594400200610      *
594500200610     C           BVTBRC    IFEQ 'Y'
594600200610      *
594700200610      ***  Default from current book position profit centre record
594800200610      ***  if found & protect on screen
594900200610      *
595000200610     C                     MOVELTDBK      WKTDBK
595100200610     C                     MOVELTDBA      WKBRCA
595200200610     C                     MOVELTDSS      WKSESN    P
595300200610     C                     MOVELTDMI      WKMKTI
595400200610      *
595500200610     C           KWPCBD    CHAINSEPCBD               89
595600200610     C           *IN89     IFEQ *OFF
595700200610     C                     MOVE PCBK      PRFC
595800200610     C                     ELSE
595900200610     C                     MOVE WWSESN    WKSESN    P
596000200610     C           KWPCBD    CHAINSEPCBD               89
596100200610     C           *IN89     IFEQ *OFF
596200200610     C                     MOVE PCBK      PRFC
596300200610     C                     ELSE
596400200610      *
596500200610      ***  Else default from matrix and allow amendment
596600200610      *
596700200610     C           BKPCDU    IFEQ 'Y'
596800200610     C                     MOVE TDBK      @BOOK
596900200610     C                     MOVELTDTP      @TRTP     P
597000200610     C                     MOVE TSUB      @SUTP
597100200610     C                     MOVE TDBA      @BRAN
597200200610     C                     MOVELTCNR      WCUST
597300200610     C                     EXSR #AOPRF
597400200610     C                     MOVE WWPRFC    PRFC
597500200610     C                     ENDIF
597600200610     C                     ENDIF
597700200610     C                     ENDIF
597800200610      *
597900200610     C                     ELSE
598000200610      *
598100200610      ***  Customer Position Profit Centre defaulting
598200200610      *
598300200610      *
598400200610      ***  Default from current customer position profit centre
598500200610      ***  if found but do not protect on screen
598600200610      *
598700200610     C********** TCNR      IFNE *ZEROS                                                        CSD027
598800200610     C           TCNR      IFNE *BLANKS                                                       CSD027
598900200610     C                     MOVELTCNR      WKDPBN           Customer
599000200610     C                     MOVELTDBA      WKBRCA           Branch
599100200610     C                     MOVELTDSS      WKDPSS           Security
599200200610      *
599300200610     C           KWSEPC    CHAINSEPCCDF              89
599400200610     C           *IN89     IFEQ *OFF
599500200610     C                     MOVELPCCU      PRFC
599600200610     C                     ELSE
599700200610     C                     MOVELWWSESN    WKDPSS           Event Security
599800200610     C           KWSEPC    CHAINSEPCCDF              89
599900200610     C           *IN89     IFEQ *OFF
600000200610     C                     MOVELPCCU      PRFC
600100200610     C                     ELSE
600200200610     C           BKPCDU    IFEQ 'Y'
600300200610     C                     MOVE TDBK      @BOOK
600400200610     C                     MOVELTDTP      @TRTP     P
600500200610     C                     MOVE TSUB      @SUTP
600600200610     C                     MOVE TDBA      @BRAN
600700200610     C                     MOVELTCNR      WCUST
600800200610     C                     EXSR #AOPRF
600900200610     C                     MOVE WWPRFC    PRFC
601000200610     C                     ENDIF
601100200610     C                     ENDIF
601200200610     C                     ENDIF
601300200610     C                     ENDIF
601400200610     C                     ENDIF
601500200610     C                     ENDIF
601600200610      ** .. Pay/Rec Compl.
601700200610     C                     MOVE 'N'       PRPC
601800200610      ** .. Last SWIFT Sequence
601900200610     C                     Z-ADD0         LSWS
602000200610      ** .. Current Factor
602100200610     C                     Z-ADD0         TCFC
602200200610      ** .. Exchange Rate (Settle - Port)
602300200610     C                     Z-ADD0         SPXR
602400200610      ** .. Spot Rate Mult/Div Indicator
602500200610     C                     MOVE *BLANKS   SPMD
602600200610      *
602700200610      ***  New fields added for DBA 2 (amendment CAC002)
602800200610      ***  The following fileds are filled if the Analytical Accounting
602900200610      ***  module is ON else blank
603000200610      *
603100200610     C                     MOVE *BLANKS   BPRC
603200200610     C                     MOVE *BLANKS   TPRC
603300200610     C                     Z-ADD*ZERO     FXMP
603400200610     C                     Z-ADD*ZERO     FXMR
603500200610     C                     Z-ADD*ZERO     MAMT
603600200610      *
603700200610     C           BGN0ST    IFEQ 'Y'
603800200610      *                                                                   CAC005
603900200610      ** Defaulting of Book profit Centre will be done if CAC005 is       CAC005
604000200610      ** not installed                                                    CAC005
604100200610      *                                                                   CAC005
604200200610     C           CAC005    IFEQ 'N'                                       CAC005
604300200610      *
604400200610      ***  Booking Profit Centre
604500200610      *
604600200610      ***  Default from current book position profit centre record
604700200610      ***  if found & protect on screen
604800200610      *
604900200610     C                     MOVELTDBK      WKTDBK
605000200610     C                     MOVELTDBA      WKBRCA
605100200610     C                     MOVELTDSS      WKSESN    P
605200200610     C                     MOVELTDMI      WKMKTI
605300200610      *
605400200610     C           KWPCBD    CHAINSEPCBD               89
605500200610     C           *IN89     IFEQ *OFF
605600200610     C           RECI      ANDEQ'D'
605700200610     C                     MOVE PCBK      BPRC
605800200610      *
605900200610      ***  Else default from matrix and allow amendment
606000200610      *
606100200610     C                     ELSE
606200200610     C           BKPCDU    IFEQ 'Y'
606300200610     C                     MOVE TDBK      @BOOK
606400200610     C                     MOVELTDTP      @TRTP     P
606500200610     C                     MOVE TSUB      @SUTP
606600200610     C                     MOVE TDBA      @BRAN
606700200610     C                     MOVELTCNR      WCUST
606800200610     C                     EXSR #AOPRF
606900200610     C                     MOVE WWPRFC    BPRC
607000200610     C                     ENDIF
607100200610     C                     ENDIF
607200200610     C                     ENDIF                                          CAC005
607300200610      *                                                                   CAC005
607400200610      ** If CAC005 is installed, retrieve the profit centre represented   CAC005
607500200610      ** by MCBOOK.  MCBOOK in the Corporate Actions-Allocation file is   CAC005
607600200610      ** being held as a pseudo book.                                     CAC005
607700200610      *                                                                   CAC005
607800200610     C           CAC005    IFEQ 'Y'                                       CAC005
607900200610     C                     CALL 'AOBKPCR0'                                CAC005
608000200610     C                     PARM *BLANKS   PRTCD                           CAC005
608100200610     C                     PARM '*USER  ' POPTN                           CAC005
608200200610     C                     PARM           PBKCD   2                       CAC005
608300200610     C                     PARM           PPRFC   4                       CAC005
608400200610     C                     PARM MCBOOK    PPSBK   2                       CAC005
608500200610      *                                                                   CAC005
608600200610     C           PRTCD     IFEQ *BLANKS                                   CAC005
608700200610     C                     MOVELPPRFC     BPRC                            CAC005
608800200610     C                     ELSE                                           CAC005
608900200610     C                     MOVE *BLANKS   BPRC                            CAC005
609000200610     C                     ENDIF                                          CAC005
609100200610     C                     ENDIF                                          CAC005
609200200610      *
609300200610      ***  Transaction Profit Centre
609400200610      *
609500200610     C                     MOVELTCNR      WCUST
609600200610     C                     EXSR #AOSEC
609700200610      *
609800200610      ***  Default from current customer position profit centre record
609900200610      ***  if found
610000200610      *
610100200610     C           BFCLAS    IFEQ 'S'
610200200610     C           BFCLAS    OREQ 'D'
610300200610      *
610400200610     C                     MOVELTDBK      WKTDBK
610500200610     C                     MOVELTDBA      WKBRCA
610600200610     C                     MOVELTDSS      WKSESN    P
610700200610     C                     MOVELTDMI      WKMKTI
610800200610      *
610900200610     C           KWPCBD    CHAINSEPCBD               89
611000200610     C           *IN89     IFEQ *OFF
611100200610     C                     MOVE PCCU      TPRC
611200200610      *
611300200610      ***  Else default from matrix and allow amendment
611400200610      *
611500200610     C                     ELSE
611600200610     C           BKPCDU    IFEQ 'Y'
611700200610     C                     MOVE TDBK      @BOOK
611800200610     C                     MOVELTDTP      @TRTP     P
611900200610     C                     MOVE TSUB      @SUTP
612000200610     C                     MOVE TDBA      @BRAN
612100200610     C                     MOVELTCNR      WCUST
612200200610     C                     EXSR #AOPRF
612300200610     C                     MOVE WWPRFC    TPRC
612400200610     C                     ENDIF
612500200610     C                     ENDIF
612600200610     C                     ENDIF
612700200610     C                     ENDIF
612800200610      *
612900200610      ***  If no record on customer positions profit centre file
613000200610      ***  need to add one and amend the audit file
613100200610      *
613200200610     C           BKPCDU    IFEQ 'Y'
613300200610     C           CAC005    ANDEQ'N'                                       CAC005
613400200610      *
613500200610      ***  Access to Position Profit Center to retrieve the profit centre
613600200610      *
613700200610     C                     MOVELTDBK      WKTDBK
613800200610     C                     MOVELTDBA      WKBRCA
613900200610     C                     MOVELTDSS      WKSESN    P
614000200610     C                     MOVELTDMI      WKMKTI
614100200610      *
614200200610     C           KWPCBD    CHAINSEPCBD               89
614300200610      *
614400200610     C           *IN89     IFEQ *ON
614500200610     C                     MOVEL'D'       RECI
614600200610     C                     MOVELTDBK      BOKC
614700200610     C                     MOVELTDBA      BRCA
614800200610     C                     MOVELTDSS      SESN
614900200610     C                     MOVE TDMI      MKTI
615000200610     C                     MOVE TPRC      PCBK
615100200610     C                     Z-ADDBJRDNB    LCD
615200200610     C                     MOVEL'I'       CHTP
615300200610     C                     EXSR ZTNLU1
615400200610     C                     MOVELNATN      TNLU
615500200610     C                     WRITESEPCBDF
615600200610      *
615700200610     C           1         CHAINSEPCA                89
615800200610     C           *IN89     IFEQ *ON
615900200610     C           *LOCK     IN   LDA
616000200610     C                     Z-ADD32        DBASE            ***************
616100200610     C                     MOVEL*BLANKS   DBFILE           * DB ERROR 32 *
616200200610     C                     MOVEL'SEPCA   'DBFILE           ***************
616300200610     C                     MOVEL'AUDIT'   DBKEY     P
616400200610     C                     MOVEL'SE7560'  DBPGM     P
616500200610     C                     OUT  LDA
616600200610     C                     EXSR *PSSR
616700200610     C                     ELSE
616800200610     C                     ADD  1         NORE
616900200610     C                     ADD  1         SINS
617000200610     C                     UPDATSEPCAF
617100200610     C                     ENDIF
617200200610     C                     ENDIF
617300200610     C                     ENDIF
617400200610      *
617500200610      ** .. Corporate Action Flag
617600200610     C                     MOVE 'Y'       COAF
617700200610      ** .. Last Change Date
617800200610     C                     Z-ADDBJRDNB    LCD
617900200610      ** .. Type of last change
618000200610     C                     MOVE 'I'       CHTP
618100200610      ** .. Transaction number of last Update
618200200610     C                     EXSR ZTNLU1
618300200610     C                     Z-ADDNATN      TNLU
618400200610      ** .. RECI
618500200610     C                     MOVE 'D'       RECI
618600200610      ** .. Portfolio Reference
618700200610     C                     MOVE MCPTFR    PTFR
618800200610      *                                                                                       CAS006
618900200610      ** Initialise the Credit Risk Spread, Liquidity Premium,                                CAS006
619000200610      ** and New Net-Treasury Price fields.                                                   CAS006
619100200610      *                                                                                       CAS006
619200200610     C                     Z-ADD*ZERO     CRSK                                                CAS006
619300200610     C                     Z-ADD*ZERO     LQPR                                                CAS006
619400200610      *                                                                                       CAS006
619500200610     C           CAS006    IFEQ 'Y'                                                           CAS006
619600200610     C                     Z-ADDPRIC      PRICN                                               CAS006
619700200610     C                     ELSE                                                               CAS006
619800200610     C                     Z-ADD*ZERO     PRICN                                               CAS006
619900200610     C                     ENDIF                                                              CAS006
620000200610      *                                                                                       217310
620100200610      ** Default Timestamp.                                                                   217310
620200200610      *                                                                                       217310
620300200610     C                     MOVEASTAMP,1   TMST                                                217310
620400200610      *
620500200610      ***  Update Trade Details
620600200610      *
620700200610     C                     WRITETRADSDF
620800200610     C                     ADD  1         W01CNT
620900200610     C                     MOVE 'Y'       WWDATA           one Read
621000200610     C/COPY WNCPYSRC,SE7560C002
621100200610      *                                                                                       CER001
621200200610      ** When Lux Return feature is present, update extension file                            CER001
621300200610      *                                                                                       CER001
621400200610     C           BGLRIN    IFEQ 'Y'                        - B1                               CER001
621500200610      *                                                                                       CER001
621600200610     C                     MOVE *IN99     WWIN99  1                                           CER001
621700200610      *                                                                                       CER001
621800200610     C           TDRF      CHAINSETRX1PD             99                                       CER001
621900200610      *                                                                                       CER001
622000200610     C           *IN99     IFEQ *ON                        - B2                               CER001
622100200610      *                                                                                       CER001
622200200610     C                     CLEARTRADSDD6                                                      CER001
622300200610      *                                                                                       CER001
622400200610     C                     MOVELTDRF      CCTDRF                                              CER001
622500200610      *                                                                                       CER001
622600200610      ** Date is defaulted with Trade Value Date.                                             CER001
622700200610      *                                                                                       CER001
622800200610     C                     Z-ADDTDVD      CCAGSD                                              CER001
622900200610      *                                                                                       CER001
623000200610      ** If feature ULX008 is installed setup transaction time                                CER001
623100200610      ** and extract flag                                                                     CER001
623200200610      *                                                                                       CER001
623300200610     C           ULX008    IFEQ 'Y'                                                           CER001
623400200610     C                     TIME           CCTIME                                              CER001
623500200610     C                     MOVE *BLANK    CCEXFL                                              CER001
623600200610     C                     MOVE 'N'       CCCABR                                              CER001
623700200610     C                     MOVE 'N'       CCMTRD                                              CER001
623800200610     C                     ENDIF                                                              CER001
623900200610      *                                                                                       CER001
624000200610     C                     WRITETRADSDD6                                                      CER001
624100200610      *                                                                                       CER001
624200200610     C                     ENDIF                           - E2                               CER001
624300200610      *                                                                                       CER001
624400200610     C                     MOVE WWIN99    *IN99                                               CER001
624500200610      *                                                                                       CER001
624600200610     C                     ENDIF                           - E1                               CER001
624700200610      *
624800200610      *** If S01401 feature is switched 'On'
624900200610      *
625000200610     C           S01401    IFEQ 'Y'
625100200610      *
625200200610      ***  Update extension file
625300200610      *
625400200610     C                     CLEARTRADSDD1
625500200610      *
625600200610     C                     MOVELTDRF      T1TDRF
625700200610     C                     MOVE 'N'       T1CONG
625800200610     C                     MOVE 'N'       T1RCDG
625900200610     C                     MOVE 'N'       T1GMES
626000200610     C                     MOVE 'N'       T1GMEC
626100200610     C                     MOVE 'C'       T1CCID
626200200610     C                     TIME           WWTIME  60
626300200610     C                     MOVELWWTIME    T1TRTT
626400200610     C                     MOVE 'Y'       T1SCMG
626500200610     C                     MOVE 'A'       T1WHEN
626600200610     C                     MOVEASTAMP,1   T1TMST                                              217310
626700200610      *
626800200610     C                     WRITETRADSDD1
626900200610      *
627000200610     C                     MOVE 'B'       T1WHEN
627100200610     C                     WRITETRADSDD1
627200200610     C                     ENDIF
627300200610      *                                                                   CSE039
627400200610      * write to Movement Status file                                     CSE039
627500200610      *                                                                   CSE039
627600200610     C           CSE039    IFEQ 'Y'                                       CSE039
627700200610     C                     MOVELTDRF      TMTRRF                          CSE039
627800200610     C                     MOVEL'T'       TMTRTY                          CSE039
627900200610     C                     Z-ADDBJRDNB    TMNTDT                          CSE039
628000200610     C                     Z-ADD1         TMSQNR                          CSE039
628100200610     C                     MOVEL'INS'     TMSWSC                          CSE039
628200200610     C                     MOVEL*BLANKS   TMSWRC                          CSE039
628300200610     C                     MOVEL*BLANKS   TMNTMT                          CSE039
628400200610     C                     MOVEL*BLANKS   TMLCUS                          CSE039
628500200610     C                     MOVEL'MIDAS'   TMINOR                          CSE039
628600200610     C                     MOVEL*BLANKS   TMMSGK                          CSE039
628700200610     C                     MOVEL*BLANKS   TMSTMG                          CSE039
628800200610     C                     MOVELWWDNAR    TMNARR                          CSE039
628900200610     C                     MOVEL'I'       TMLCTP                          CSE039
629000200610     C                     Z-ADDBJRDNB    TMLCDT                          CSE039
629100200610     C                     MOVELTMMP,1    TMTMST                          CSE039
629200200610     C                     MOVELTDBA      TMTRBB                          CSE039
629300200610     C                     MOVE USER      TMLCUS                          CSE039
629400200610      *                                                                   CSE039
629500200610     C                     WRITESEMVTSD0                                  CSE039
629600200610     C                     ENDIF                                          CSE039
629700200610     C/COPY WNCPYSRC,SE7560C001
629800200610      *
629900200610     C                     ENDSR
630000200610      *
630100200610      *****************************************************************
630200200610      /EJECT
630300200610      *****************************************************************
630400200610      *  #ADPMV -  Access Depots Movement                             *
630500200610      *  ------                                                       *
630600200610      *  Called by : #TDRVR                                           *
630700200610      *  Calls     : Nothing                                          *
630800200610      *****************************************************************
630900200610      *
631000200610     C           #ADPMV    BEGSR
631100200610      *
631200200610      ***  Access to Depot Movement previously generated using "Transaction Reference"
631300200610      *
631400200610     C           KWDPMV    CHAINDPTMV                88
631500200610      *
631600200610     C           *IN88     IFEQ *ON
631700200610     C                     MOVE MASESN    WKSESN
631800200610     C           KWDPMV    CHAINDPTMV                88
631900200610     C                     ENDIF                           *IN88=*ON
632000200610      *
632100200610     C           *IN88     IFEQ *ON
632200200610     C                     MOVELWKSESN    WKSES1    P
632300200610     C           *LOCK     IN   LDA
632400200610     C                     Z-ADD6         DBASE            ***************
632500200610     C                     MOVEL*BLANKS   DBFILE           * DB ERROR 06 *
632600200610     C                     MOVE 'DPTMV   'DBFILE           ***************
632700200610     C                     MOVELW2DPMV    DBKEY     P
632800200610     C                     MOVEL'SE7560'  DBPGM     P
632900200610     C                     OUT  LDA
633000200610     C                     EXSR *PSSR
633100200610     C                     ENDIF                           *IN88=*ON
633200200610      *
633300200610     C                     MOVE DPSS      WDPSS  10
633400200610     C                     MOVE DPMV      WDPMV   2
633500200610     C**********           Z-ADDDPID      WDPID   60                                          CSD027
633600200610     C                     MOVE DPID      WDPID   6                                           CSD027
633700200610     C                     Z-ADDDPMD      WDPMD   50
633800200610     C**********           Z-ADDDPOD      WDPOD   60                                          CSD027
633900200610     C                     MOVE DPOD      WDPOD   6                                           CSD027
634000200610     C                     Z-ADDDPDO      WDPDO   50
634100200610     C                     MOVE DPBA      WDPBA   3
634200200610     C                     MOVE ORBR      WORBR   3
634300200610     C                     MOVE DPBK      WDPBK   2
634400200610     C                     MOVE DPMK      WDPMK   1
634500200610     C**********           Z-ADDDPBN      WDPBN   60                                          CSD027
634600200610     C                     MOVE DPBN      WDPBN   6                                           CSD027
634700200610     C                     Z-ADDDPNA      WDPNA  110
634800200610     C                     MOVE DPNR      WDPNR  35
634900200610     C                     Z-ADDMKTP      WMKTP  158
635000200610     C                     Z-ADDDPAD      WDPAD   60
635100200610     C                     MOVE SWRF      WSWRF   3
635200200610     C                     MOVE SIOI      WSIOI   1
635300200610     C                     MOVE DPMS      WDPMS   1
635400200610     C                     MOVE DCFR      WDCFR   1
635500200610     C                     MOVE TACI      WTACI   1
635600200610     C                     MOVE DPR1      WDPR1   1
635700200610     C                     MOVE DPR2      WDPR2   1
635800200610     C                     Z-ADDORED      WORED   50
635900200610     C                     MOVE RPIN      WRPIN   1
636000200610     C                     MOVE DPPC      WDPPC   4
636100200610     C                     MOVE DCHC      WDCHC   2
636200200610     C                     MOVE DCCE      WDCCE   3
636300200610     C                     Z-ADDDCHA      WDCHA  130
636400200610     C                     Z-ADDDCSE      WDCSE   20
636500200610     C                     MOVE DCAB      WDCAB   3
636600200610     C**********           MOVE DCAT      WDCAT  12                                           CGL029
636700200610     C                     MOVE DCAT      WDCAT  18                                           CGL029
636800200610     C                     Z-ADDDPVD      WDPVD   50
636900200610     C                     MOVE SPXR      WSPXR  138
637000200610     C                     MOVE SPMD      WSPMD   1
637100200610     C                     MOVE PTFR      WPTFR   4
637200200610     C                     Z-ADDCYLD      WCYLD  117
637300200610     C                     MOVE CWDI      WCWDI   1
637400200610      *                                                                                       207006
637500200610     C           CSE029    IFEQ 'Y'                                                           207006
637600200610     C**********           Z-ADDCPTY      WCPTY   60                                   207006 CSD027
637700200610     C                     MOVE CPTY      WCPTY   6                                           CSD027
637800200610     C                     MOVE MRKT      WMRKT   2                                           207006
637900200610     C                     ENDIF                                                              207006
638000200610     C*
638100200610      ***  Access DPTMVDY1 if S01401 is installed.
638200200610      *
638300200610     C           S01401    IFEQ 'Y'
638400200610     C           KWDPMV    CHAINDPTMVDY1             88
638500200610      *
638600200610      ***  Record not found, database error.
638700200610      *
638800200610     C           *IN88     IFEQ *ON
638900200610     C                     MOVELWKSESN    WKSES1    P
639000200610     C           *LOCK     IN   LDA
639100200610     C                     Z-ADD7         DBASE            ***************
639200200610     C                     MOVEL*BLANKS   DBFILE           * DB ERROR 07 *
639300200610     C                     MOVE 'DPTMVDY1'DBFILE           ***************
639400200610     C                     MOVELW2DPMV    DBKEY     P
639500200610     C                     MOVEL'SE7560'  DBPGM     P
639600200610     C                     OUT  LDA
639700200610     C                     EXSR *PSSR
639800200610     C                     ENDIF                           *IN88=*ON
639900200610     C                     ENDIF                           S01401='Y'
640000200610      *
640100200610     C                     ENDSR
640200200610      *
640300200610      *****************************************************************
640400200610      /EJECT
640500200610      *****************************************************************
640600200610      *  #DPTNB -  Retrieve next Depot reference number               *
640700200610      *  ------                                                       *
640800200610      *  Called by : #TDRVR                                           *
640900200610      *  Calls     : Nothing                                          *
641000200610      *****************************************************************
641100200610      *
641200200610     C           #DPTNB    BEGSR
641300200610     C/COPY WNCPYSRC,SE7560C009
641400200610      *
641500200610     C******     S01401    IFEQ 'Y'                                       152873
641600200610      *
641700200610     C           WKTRRF    CHAINDPTMVDF1             89
641800200610     C           *IN89     DOWEQ*OFF
641900200610     C                     ADD  1         WWNTR2
642000200610     C                     MOVE WWNTR2    WKTRRF
642100200610     C           WKTRRF    CHAINDPTMVDF1             89
642200200610     C                     ENDDO                           *IN89=*OFF
642300200610      *
642400200610     C******               ELSE                                           152873
642500200610     C******                                                              152873
642600200610     C******     KWDPMV    CHAINDPTMV                89                   152873
642700200610     C******     *IN89     DOWEQ*OFF                                      152873
642800200610     C******               ADD  1         WWNTR2                          152873
642900200610     C******               MOVE WWNTR2    WKTRRF                          152873
643000200610     C******     KWDPMV    CHAINDPTMV                89                   152873
643100200610     C******               ENDDO                           *IN89=*OFF     152873
643200200610     C******               ENDIF                                          152873
643300200610     C/COPY WNCPYSRC,SE7560C010
643400200610      *
643500200610     C                     ENDSR
643600200610      *
643700200610      *****************************************************************
643800200610      /EJECT
643900200610      *****************************************************************
644000200610      *  #WDPMV -  Write Depot Movement                               *
644100200610      *  ------                                                       *
644200200610      *  Called by : #TDRVR #SDPMV                                    *
644300200610      *  Calls     : #TOFP                                            *
644400200610      *****************************************************************
644500200610      *
644600200610     C           #WDPMV    BEGSR
644700200610      *
644800200610     C           WWDPNA    IFNE 0                                                             221751
644900200610      *                                                                                       221751
645000200610      ** .. Corporate Action Flag
645100200610     C                     MOVE 'Y'       COAF
645200200610     C                     Z-ADDBJRDNB    LCD              Last Change Date
645300200610     C                     MOVE 'I'       CHTP             Type of Last Change
645400200610     C                     EXSR ZTNLU1
645500200610     C                     Z-ADDNATN      TNLU             Trans. no. of last update
645600200610     C                     MOVE 'D'       RECI
645700200610      *
645800200610     C           WALLOC    IFEQ 'R'
645900200610     C                     MOVE WDPSS     DPSS
646000200610     C                     MOVE WDPBA     DPBA
646100200610     C                     MOVE WORBR     ORBR
646200200610     C                     MOVE WDPBK     DPBK
646300200610     C                     MOVE WDPMK     DPMK
646400200610     C**********           Z-ADDWDPBN     DPBN                                                CSD027
646500200610     C                     MOVE WDPBN     DPBN                                                CSD027
646600200610     C                     Z-ADDWDPNA     DPNA
646700200610     C                     MOVE WDPNR     DPNR
646800200610     C                     Z-ADDWMKTP     MKTP
646900200610     C                     Z-ADDWDPAD     DPAD
647000200610     C                     MOVE WSWRF     SWRF
647100200610     C                     MOVE WSIOI     SIOI
647200200610     C                     MOVE WDPMS     DPMS
647300200610     C                     MOVE WDCFR     DCFR
647400200610     C                     MOVE WTACI     TACI
647500200610     C                     MOVE WDPR1     DPR1
647600200610     C                     MOVE WDPR2     DPR2
647700200610     C                     Z-ADDWORED     ORED
647800200610     C                     MOVE WRPIN     RPIN
647900200610     C                     MOVE WDPPC     DPPC
648000200610     C                     MOVE WDCHC     DCHC
648100200610     C                     MOVE WDCCE     DCCE
648200200610     C                     Z-ADDWDCHA     DCHA
648300200610     C                     Z-ADDWDCSE     DCSE
648400200610     C                     MOVE WDCAB     DCAB
648500200610     C                     MOVE WDCAT     DCAT
648600200610     C                     Z-ADDWDPVD     DPVD
648700200610     C                     MOVE WSPXR     SPXR
648800200610     C                     MOVE WSPMD     SPMD
648900200610     C                     MOVE WPTFR     PTFR
649000200610     C                     Z-ADDWCYLD     CYLD
649100200610     C                     MOVE WCWDI     CWDI
649200200610      *                                                                                       207006
649300200610     C           CSE029    IFEQ 'Y'                                                           207006
649400200610     C**********           Z-ADDWCPTY     CPTY                                         207006 CSD027
649500200610     C                     MOVE WCPTY     CPTY                                                CSD027
649600200610     C                     MOVE WMRKT     MRKT                                                207006
649700200610     C                     ENDIF                                                              207006
649800200610      *                                                                                       207006
649900200610     C                     ENDIF
650000200610      *                                                                   CSE017
650100200610      ** If CSE017 is installed, Cum/Ex and Print Advice Indicator        CSE017
650200200610      ** should be initialised                                            CSE017
650300200610      *                                                                   CSE017
650400200610     C           CSE017    IFEQ 'Y'                                       CSE017
650500200610     C                     MOVE 'C'       DPIN                            CSE017
650600200610     C                     MOVE 'Y'       DPAP                            CSE017
650700200610     C                     ENDIF                                          CSE017
650800200610      *                                                                                       193752
650900200610      ** Access to Corporate Action Type Details to retrieve                                  193752
651000200610      ** Trade Subtype.                                                                       193752
651100200610      *                                                                                       193752
651200200610     C                     MOVE MACOAT    WKCOAT                                              193752
651300200610     C                     EXSR #ACOAT                                                        193752
651400200610      *                                                                                       193752
651500200610     C           MMTSUB    IFNE *BLANKS                                                       193752
651600200610     C                     MOVE MMTSUB    TSUB                                                193752
651700200610     C                     ELSE                                                               193752
651800200610      *                                                                                       193752
651900200610      ** Retrieve the Default Portfolio Subtype.                                              193752
652000200610      *                                                                                       193752
652100200610     C                     MOVE BVDPFS    TSUB                                                193752
652200200610     C                     ENDIF                                                              193752
652300200610     C*
652400200610      ** Initialise Movement Subtype                                      183579
652500200610      *                                                                   183579
652600200610     C                     MOVEL*BLANKS   MSTP                            183579
652700200610     C                     MOVELTSUB      MSTP                            183579
652800200610      *                                                                   183579
652900200610      ** If Private Banking (TOF) installed, subtype must not be blank    183579
653000200610      *                                                                   183579
653100200610     C           BGN4ST    IFEQ 'Y'                                       183579
653200200610     C           MSTP      ANDEQ*BLANKS                                   183579
653300200610     C           *LOCK     IN   LDA                                       183579
653400200610     C                     Z-ADD40        DBASE            ***************183579
653500200610     C                     MOVEL*BLANKS   DBFILE           * DB ERROR 40 *183579
653600200610     C                     MOVE 'MVMT S/T'DBFILE           ***************183579
653700200610     C                     MOVELMSTP      DBKEY                           183579
653800200610     C                     MOVEL'SE7560'  DBPGM     P                     183579
653900200610     C                     OUT  LDA                                       183579
654000200610     C                     EXSR *PSSR                                     183579
654100200610     C                     ENDIF                                          183579
654200200610      *                                                                   CPB001
654300200610      **  If Replication Processing required.                             CPB001
654400200610     C           WUREPL    IFEQ 'Y'                        Begin WUREPL   CPB001
654500200610     C                     EXSR REPLIC                                    CPB001
654600200610      *                                                                   CPB001
654700200610     C                     ENDIF                           End WUREPL     CPB001
654800200610      *                                                                                       234829
654900200610      ** Get Original Purchase Date                                                           234829
655000200610      *                                                                                       234829
655100200610     C           CGL031    IFEQ 'Y'                                                           234829
655200200610     C                     EXSR GOPD                                                          234829
655300200610      *                                                                                       234829
655400200610      ** Get Original Purchased Interest                                                      234829
655500200610      *                                                                                       234829
655600200610     C                     EXSR GOPI                                                          234829
655700200610      *                                                                                       234829
655800200610      ** Get Fiscal Price via SEVSEFSPR3                                                      234829
655900200610      *                                                                                       234829
656000200610     C                     EXSR GFSPR                                                         234829
656100200610      *                                                                                       234829
656200200610      ** Get latest ETCPOSND record for a name change on the WO, so data can                  234829
656300200610      ** be used to write new record for new shortname on the WI.                             234829
656400200610      *                                                                                       234829
656500200610     C           MAPTYP    IFEQ 'NC'                                                          234829
656600200610     C           DPMV      ANDEQ'WO'                                                          234829
656700200610     C                     CALL SEETRT                                                        234829
656800200610     C                     PARM *BLANKS   PRETC                                               234829
656900200610     C                     PARM           DPBA                                                234829
657000200610     C                     PARM           DPSS                                                234829
657100200610     C                     PARM           PTFR                                                234829
657200200610     C                     PARM 'S'       @MRKT   1                                           234829
657300200610     C                     PARM           DPDO                                                234829
657400200610     C                     PARM           ETCPOS                                              234829
657500200610     C                     ENDIF                                                              234829
657600200610      *                                                                                       234829
657700200610      ** Write Position details to ETCPOSND via SEETCPUPD                                     234829
657800200610      *                                                                                       234829
657900200610     C           MAPTYP    IFNE 'NC'                                                          234829
658000200610     C           DPMV      OREQ 'WO'                                                          234829
658100200610     C                     MOVE RECI      RECIV                                               234829
658200200610     C                     MOVE ORBR      ORBRV                                               234829
658300200610     C                     MOVE TACI      TACIV                                               234829
658400200610     C                     Z-ADDORED      OREDV                                               234829
658500200610     C                     Z-ADDLCD       LCDV                                                234829
658600200610     C                     MOVE CHTP      CHTPV                                               234829
658700200610     C                     Z-ADDTNLU      TNLUV                                               234829
658800200610     C                     Z-ADDSPXR      SPXRV                                               234829
658900200610     C                     MOVE SPMD      SPMDV                                               234829
659000200610     C                     MOVE PTFR      PTFRV                                               234829
659100200610     C                     MOVE COAF      COAFV                                               234829
659200200610     C                     MOVE ACIN      ACINV                                               234829
659300200610     C                     MOVE REPI      REPIV                                               234829
659400200610     C                     MOVE DPAP      DPAPV                                               234829
659500200610     C                     Z-ADDFSPR      FSPRV                                               234829
659600200610     C                     MOVE FSPP      FSPPV                                               234829
659700200610     C**********           Z-ADDDPBN      DPBNV                                       234829 CSD027A
659800200610     C                     MOVE DPBN      DPBNV                                              CSD027A
659900200610     C                     CALL SEETCP                                                        234829
660000200610     C                     PARM *BLANKS   PRETC                                               234829
660100200610     C                     PARM 'I'       @BCHTP  1                                           234829
660200200610     C                     PARM 'D'       WTYPE   1                                           234829
660300200610     C                     PARM           @TRDDS                                              234829
660400200610     C                     PARM           @SEVDP                                              234829
660500200610     C                     PARM           @SECTY                                              234829
660600200610     C                     ELSE                                                               234829
660700200610      *                                                                                       234829
660800200610      ***  For Name changes and WI, write to ETCPOSND with same details                       234829
660900200610      ***  as existed on ETCPOSND for old shortname before this action                        234829
661000200610      ***                                                                                     234829
661100200610      *                                                                                       234829
661200200610     C                     MOVE DPSS      CSSC                                                234829
661300200610     C                     MOVE DPRN      TREF                                                234829
661400200610     C                     MOVE 'D'       TTYPE                                               234829
661500200610     C**********           Z-ADDDPID      CSDA                                        234829 CSD027A
661600200610     C**********           MOVE DPID      CSDA                                        CSD027A 240016
661700200610     C                     MOVE DPMD      CSDA                                                240016
661800200610     C                     MOVEASTAMP,1   ETMST                                               234829
661900200610      *                                                                                       234829
662000200610     C                     WRITEETCPOSF                                                       234829
662100200610     C                     ENDIF                                                              234829
662200200610     C                     ENDIF                                                              234829
662300200610      *
662400200610      ***  Write depot movements details
662500200610      *
662600200610     C                     MOVEASTAMP,1   DMTMST           Default Timestamp                  CPK015
662700200610     C                     Z-ADDBJRDNB    LCD              Last Change Date                   235041
662800200610     C                     Z-ADDBJRDNB    ORED             Last Change Date                   235041
662900200610     C                     MOVE 'I'       CHTP             Type of Last Change                235041
663000200610     C                     WRITEDPTMVDF
663100200610      *
663200200610     C           WALLOC    IFNE 'R'
663300200610     C                     ADD  1         W02CNT
663400200610     C                     ELSE
663500200610     C                     ADD  1         W05CNT
663600200610     C                     ENDIF
663700200610     C                     MOVE 'Y'       WWDATA           one Read
663800200610     C/COPY WNCPYSRC,SE7560C003
663900200610      *                                                                                       CER001
664000200610      ** When Lux Return feature is present, update extension file                            CER001
664100200610      *                                                                                       CER001
664200200610     C           BGLRIN    IFEQ 'Y'                        - B1                               CER001
664300200610      *                                                                                       CER001
664400200610     C                     MOVE *IN99     WWIN99  1                                           CER001
664500200610      *                                                                                       CER001
664600200610     C           WWNKEY    KLIST                                                              CER001
664700200610     C                     KFLD           WWDPSS 10                                           CER001
664800200610     C                     KFLD           WWDPRN  6                                           CER001
664900200610      *                                                                                       CER001
665000200610     C                     MOVELDPSS      WWDPSS                                              CER001
665100200610     C                     MOVELDPRN      WWDPRN                                              CER001
665200200610      *                                                                                       CER001
665300200610     C           WWNKEY    CHAINSEDPX1PD             99                                       CER001
665400200610      *                                                                                       CER001
665500200610     C           *IN99     IFEQ *ON                        - B2                               CER001
665600200610      *                                                                                       CER001
665700200610     C                     CLEARDPTMVDF6                                                      CER001
665800200610      *                                                                                       CER001
665900200610     C                     MOVELDPSS      WNDPSS                                              CER001
666000200610     C                     MOVELDPRN      WNDPRN                                              CER001
666100200610     C                     Z-ADD*ZEROS    WNOPTP                                              CER001
666200200610     C                     Z-ADD*ZEROS    WNEXCF                                              CER001
666300200610      *                                                                                       CER001
666400200610      ** If feature ULX008 is installed setup transaction time                                CER001
666500200610      ** and extract flag                                                                     CER001
666600200610      *                                                                                       CER001
666700200610     C           ULX008    IFEQ 'Y'                                                           CER001
666800200610     C                     MOVE *BLANK    WNEXFL                                              CER001
666900200610      *                                                                                       CER001
667000200610     C           DPMV      IFEQ 'WI'                                                          CER001
667100200610     C           DPMV      OREQ 'WO'                                                          CER001
667200200610     C                     TIME           WNTIME                                              CER001
667300200610      *                                                                                       CER001
667400200610      ** Access ER ICD to retrieve "Include in CAB Reporting" Flag                            CER001
667500200610      *                                                                                       CER001
667600200610     C           *LOVAL    SETLLERLUICL1                                                      CER001
667700200610     C                     READ ERLUICL1                 99                                   CER001
667800200610     C           *IN99     IFEQ *ON                                                           CER001
667900200610     C           *LOCK     IN   LDA                                                           CER001
668000200610     C                     Z-ADD80        DBASE            ***************                    CER001
668100200610     C                     MOVEL'ERLUICL1'DBFILE           * DB ERROR 80 *                    CER001
668200200610     C                     MOVEL'*NONE'   DBKEY            ***************                    CER001
668300200610     C                     OUT  LDA                                                           CER001
668400200610     C                     EXSR *PSSR                                                         CER001
668500200610     C                     ENDIF                                                              CER001
668600200610      *                                                                                       CER001
668700200610     C           VPDMOV    IFEQ 'N'                                                           CER001
668800200610     C                     MOVE 'Y'       WNCABR                                              CER001
668900200610     C                     ELSE                                                               CER001
669000200610     C                     MOVE 'N'       WNCABR                                              CER001
669100200610     C                     ENDIF                                                              CER001
669200200610      *                                                                                       CER001
669300200610     C                     MOVEL*BLANKS   WNCNBR                                              CER001
669400200610     C                     ELSE                                                               CER001
669500200610     C                     Z-ADD0         WNTIME                                              CER001
669600200610     C                     MOVE *BLANK    WNCABR                                              CER001
669700200610     C                     MOVEL*BLANKS   WNCNBR                                              CER001
669800200610     C                     ENDIF                                                              CER001
669900200610      *                                                                                       CER001
670000200610     C                     ENDIF                                                              CER001
670100200610      *                                                                                       CER001
670200200610     C                     WRITEDPTMVDF6                                                      CER001
670300200610      *                                                                                       CER001
670400200610     C                     ENDIF                           - E2                               CER001
670500200610      *                                                                                       CER001
670600200610     C                     MOVE WWIN99    *IN99                                               CER001
670700200610      *                                                                                       CER001
670800200610     C                     ENDIF                           - E1                               CER001
670900200610      *
671000200610      ***  Update Extension files
671100200610      *
671200200610     C           S01401    IFEQ 'Y'
671300200610     C                     MOVE DPSS      DPDPSS
671400200610     C                     MOVE DPRN      DPDPRN
671500200610     C                     MOVE 'N'       DPCONG
671600200610     C                     MOVE 'N'       DPRCDG
671700200610     C                     Z-ADD0         DPLSWS
671800200610     C                     Z-ADD0         DPLSSC
671900200610     C                     Z-ADD0         DPTIME
672000200610     C                     Z-ADD0         DPLCD
672100200610     C                     MOVE 'N'       DPGMES
672200200610     C                     MOVE *BLANKS   DPINST
672300200610     C                     MOVE *BLANKS   DPINSS
672400200610     C                     MOVE *BLANKS   DPEUCL
672500200610     C                     MOVE *BLANKS   DPSAFA
672600200610     C                     MOVE *BLANKS   DPRPTY
672700200610     C                     MOVE *BLANKS   DPFIND
672800200610     C                     MOVE 'N'       DPGMEC
672900200610     C                     MOVE *BLANKS   DPTRTT
673000200610     C                     MOVE *BLANKS   DPGDEL
673100200610     C                     MOVE *BLANKS   DPFCOD
673200200610     C                     MOVE *BLANKS   DPSROL
673300200610     C                     MOVE *BLANKS   DPSCMG
673400200610     C                     MOVE 'S'       DPWHEN
673500200610     C                     Z-ADD0         DPPRIC
673600200610     C                     Z-ADD0         DPACND
673700200610     C                     Z-ADD0         DPITRA
673800200610     C                     Z-ADD0         DPTDER
673900200610      *
674000200610     C                     WRITEDPTMVDD1
674100200610     C                     ENDIF
674200200610      * write to Movement Status file                                     CSE039
674300200610      *                                                                   CSE039
674400200610     C           CSE039    IFEQ 'Y'                                       CSE039
674500200610     C                     MOVELDPRN      TMTRRF                          CSE039
674600200610     C                     MOVEL'W'       TMTRTY                          CSE039
674700200610     C                     Z-ADDBJRDNB    TMNTDT                          CSE039
674800200610     C                     Z-ADD1         TMSQNR                          CSE039
674900200610     C                     MOVEL'INS'     TMSWSC                          CSE039
675000200610     C                     MOVEL*BLANKS   TMSWRC                          CSE039
675100200610     C                     MOVEL*BLANKS   TMNTMT                          CSE039
675200200610     C                     MOVEL*BLANKS   TMLCUS                          CSE039
675300200610     C                     MOVEL'MIDAS'   TMINOR                          CSE039
675400200610     C                     MOVEL*BLANKS   TMMSGK                          CSE039
675500200610     C                     MOVEL*BLANKS   TMSTMG                          CSE039
675600200610     C                     MOVELWWDNAR    TMNARR                          CSE039
675700200610     C                     MOVEL'I'       TMLCTP                          CSE039
675800200610     C                     Z-ADDBJRDNB    TMLCDT                          CSE039
675900200610     C                     MOVELTMMP,1    TMTMST                          CSE039
676000200610     C                     MOVELDPBA      TMTRBB                          CSE039
676100200610     C                     MOVE USER      TMLCUS                          CSE039
676200200610      *                                                                   CSE039
676300200610     C                     WRITESEMVTSD0                                  CSE039
676400200610     C                     ENDIF                                          CSE039
676500200610      *                                                                   CSE039
676600200610     C/COPY WNCPYSRC,SE7560C004
676700200610      *
676800200610     C                     END                                                                221751
676900200610      *                                                                                       221751
677000200610     C                     ENDSR
677100200610      *
677200200610      *****************************************************************
677300200610      /EJECT                                                                                  216944
677400200610      *****************************************************************                       216944
677500200610      *  #UDPMV -  Write Depot Movement                               *                       216944
677600200610      *  ------                                                       *                       216944
677700200610      *  Called by : #TDRVR                                           *                       216944
677800200610      *  Calls     : None                                             *                       216944
677900200610      *****************************************************************                       216944
678000200610      *                                                                                       216944
678100200610     C           #UDPMV    BEGSR                                                              216944
678200200610      *                                                                                       216944
678300200610     C           WDPNA     IFNE 0                                         221751
678400200610      *                                                                   221751
678500200610     C           RECI      IFNE '*'                                                           216944
678600200610     C                     MOVE 'R'       RECI                                                216944
678700200610     C                     MOVEL'D'       CHTP                                                216944
678800200610     C                     Z-ADDBJRDNB    LCD                                                 216944
678900200610      *                                                                                       216944
679000200610     C           WDPMV     IFEQ 'WI'                                                          216944
679100200610     C                     Z-ADDWDPMD     DPVD                                                216944
679200200610     C                     ELSE                                                               216944
679300200610     C                     Z-ADDWDPDO     DPVD                                                216944
679400200610     C                     ENDIF                                                              216944
679500200610      *                                                                                       216944
679600200610     C                     ADD  1         WXXDEL                          219634
679700200610      *                                                                                       221680
679800200610     C           ORED      IFEQ LCD                                                           221680
679900200610     C                     MOVE '*'       RECI                                                221680
680000200610     C                     END                                                                221680
680100200610      *                                                                                       221680
680200200610     C                     UPDATDPTMVDF2                                                      216944
680300200610      *                                                                                       216944
680400200610     C                     END                                                                216944
680500200610      *                                                                                       216944
680600200610     C                     END                                            221751
680700200610      *                                                                   221751
680800200610     C                     ENDSR                                                              216944
680900200610      *                                                                                       216944
681000200610      *****************************************************************                       216944
681100200610      /EJECT
681200200610      *****************************************************************
681300200610      *  #SDPMV -  Setup Default fields for Depot Movement            *
681400200610      *  ------                                                       *
681500200610      *  Called by : #PRDV #PRFRR #PRFRO #PRFRA #PRCRR #PRCRA #PRCE   *
681600200610      *              #PROFE #PROFP #PREX #PRTGZ #PRRGM #PRRGC #PRNC   *
681700200610      *  Calls     : #WDPMV #AOPRF AOCURR0                            *
681800200610      *****************************************************************
681900200610      *
682000200610     C           #SDPMV    BEGSR
682100200610      *
682200200610      ***  Retrieve a new Depot Reference
682300200610      *
682400200610     C                     MOVE WWNTR2    WKTRRF  6        Reference
682500200610     C******     KWDPMV    CHAINDPTMV                89                   152873
682600200610     C           WKTRRF    CHAINDPTMVDF1             89                   152873
682700200610     C           *IN89     DOWEQ*OFF
682800200610     C                     ADD  1         WWNTR2
682900200610     C                     MOVE WWNTR2    WKTRRF
683000200610     C******     KWDPMV    CHAINDPTMV                89                   152873
683100200610     C           WKTRRF    CHAINDPTMVDF1             89                   152873
683200200610     C                     ENDDO                           *IN89=*OFF
683300200610     C                     ADD  1         WWNTR2
683400200610      *
683500200610     C                     CLEARDPTMVDF
683600200610      *
683700200610      ***  .. Branch Code
683800200610     C                     MOVE MCBRCD    DPBA
683900200610      ***  .. Origin. Branch
684000200610     C                     MOVE MCBRCD    ORBR
684100200610      ***  .. Beneficial Customer
684200200610     C                     MOVE MCCNUM    DPBN
684300200610      *
684400200610      ***  .. Security Shortname
684500200610     C                     MOVELWWSESN    DPSS      P
684600200610      ***  .. Depot Reference
684700200610     C                     MOVE WKTRRF    DPRN
684800200610      ***  .. Movement Type
684900200610     C                     MOVE WWDPMV    DPMV
685000200610      ***  .. In Depot, Out Depot, Movement Date In, Movement Date Out
685100200610     C**********           Z-ADD0         DPID                                                CSD027
685200200610     C                     MOVE *BLANKS   DPID                                                CSD027
685300200610     C                     Z-ADD0         DPMD
685400200610     C**********           Z-ADD0         DPOD                                                CSD027
685500200610     C                     MOVE *BLANKS   DPOD                                                CSD027
685600200610     C                     Z-ADD0         DPDO
685700200610      *
685800200610     C           DPMV      IFEQ 'WI'
685900200610     C**********           Z-ADDMSDDPT    DPID                                                CSD027
686000200610     C                     MOVE MSDDPT    DPID                                                CSD027
686100200610     C                     Z-ADDMAALEF    DPMD
686200200610     C                     ELSE
686300200610     C**********           Z-ADDMSDDPT    DPOD                                                CSD027
686400200610     C                     MOVE MSDDPT    DPOD                                                CSD027
686500200610     C                     Z-ADDMAALEF    DPDO
686600200610     C                     ENDIF
686700200610      ***  .. Book Code
686800200610     C                     MOVELBVDPBC    DPBK
686900200610      ***  .. Market Indicator
687000200610     C           WWNMCY    IFEQ WONMCY
687100200610     C                     MOVE WOMKTI    DPMK      P
687200200610     C                     ELSE
687300200610     C                     MOVE WNMKTI    DPMK      P
687400200610     C                     ENDIF
687500200610      ***  .. Nominal Amount
687600200610     C                     Z-ADDWWDPNA    DPNA
687700200610      ***  .. Narrative
687800200610     C                     MOVELDNARR     WWTEXT
687900200610     C                     MOVE MACORF    WWCROF
688000200610     C                     MOVE MACOAT    WWCOAT
688100200610     C                     MOVE WWDNAR    DPNR
688200200610      ***  .. Market Price
688300200610     C                     Z-ADDWWMKTP    MKTP
688400200610      ***  .. Assoc. deal
688500200610     C                     Z-ADD*ZERO     DPAD
688600200610      ***  .. Switch ref.
688700200610     C                     MOVE *BLANKS   SWRF
688800200610      ***  .. Switch in/on
688900200610     C                     MOVE *BLANKS   SIOI
689000200610      ***  .. Message ind.
689100200610     C                     BITOF'0'       DPMS
689200200610      ***  .. Confirmation required
689300200610     C*************        MOVE 'N'       DCFR                            150140
689400200610     C                     MOVE 'Y'       DCFR                            150140
689500200610      ***  .. Accounting ind.
689600200610     C                     BITOF'01'      TACI
689700200610      ***  .. Depot Required 1
689800200610     C                     MOVE 'N'       DPR1
689900200610      ***  .. Depot Required 2
690000200610     C                     MOVE 'N'       DPR2
690100200610      ***  .. Original Entry Date
690200200610     C                     Z-ADDBJRDNB    ORED
690300200610      ***  .. Repo/Pledge ind.
690400200610     C                     MOVE *BLANKS   RPIN
690500200610      ***  .. Profit Centre
690600200610     C                     MOVE *BLANKS   DPPC
690700200610      *
690800200610      ***  Profit Center Used is 'Y', reset profit Center
690900200610      *
691000200610     C           BKPCDU    IFEQ 'Y'
691100200610      *
691200200610      ***  Access to Position Profit Center to retrieve the profit centre
691300200610      *
691400200610     C                     MOVELDPBN      WKDPBN           Customer
691500200610     C                     MOVELDPBA      WKBRCA           Branch
691600200610     C                     MOVELMCSESN    WKDPSS           New Security
691700200610      *
691800200610     C           KWSEPC    CHAINSEPCCDF              89
691900200610     C           *IN89     IFEQ *OFF
692000200610     C                     MOVELPCCU      DPPC
692100200610     C                     ENDIF                           *IN89=OFF
692200200610      *
692300200610     C           DPPC      IFEQ *BLANKS
692400200610     C                     MOVELMASESN    WKDPSS           Event Security
692500200610     C           KWSEPC    CHAINSEPCCDF              89
692600200610     C           *IN89     IFEQ *OFF
692700200610     C                     MOVELPCCU      DPPC
692800200610     C                     ENDIF                           *IN89=OFF
692900200610     C                     ENDIF                           DPPC=' '
693000200610      *
693100200610     C           DPPC      IFEQ *BLANKS
693200200610      *
693300200610      ***  Look up default using default matrix if profit centres
693400200610      ***  default used is yes on sdgelrpd
693500200610      *
693600200610     C                     MOVE DPBK      @BOOK
693700200610     C                     MOVE *BLANKS   @TRTP
693800200610     C                     MOVE *BLANKS   @SUTP
693900200610     C                     MOVE DPBA      @BRAN
694000200610     C                     MOVELDPBN      WCUST
694100200610     C                     EXSR #AOPRF
694200200610     C                     MOVE WWPRFC    DPPC
694300200610     C                     ENDIF                           DPPC=' '
694400200610     C                     ENDIF                           BKPCDU='Y'
694500200610      *
694600200610      ***  If Analytical Accounting is installed, profit centre is
694700200610      ***  mandatory for Walk-In/Walk-out.
694800200610      *
694900200610     C           BGN0ST    IFEQ 'Y'
695000200610     C           DPPC      ANDEQ*BLANKS
695100200610     C                     MOVELBVSEPC    DPPC
695200200610     C                     ENDIF
695300200610      *                                                                   CAC005
695400200610      ** If CAC005 is installed, convert DPBK/DPPC into pseudo book       CAC005
695500200610      *                                                                   CAC005
695600200610     C           CAC005    IFEQ 'Y'                                       CAC005
695700200610     C                     CALL 'AOBKPCR0'                                CAC005
695800200610     C                     PARM *BLANKS   PRTCD                           CAC005
695900200610     C                     PARM '*PSEUDO' POPTN                           CAC005
696000200610     C                     PARM DPBK      PBKCD   2                       CAC005
696100200610     C                     PARM DPPC      PPRFC   4                       CAC005
696200200610     C                     PARM           PPSBK   2                       CAC005
696300200610      *                                                                   CAC005
696400200610     C           PRTCD     IFEQ *BLANKS                                   CAC005
696500200610     C                     MOVELPPSBK     DPBK                            CAC005
696600200610     C                     ENDIF                                          CAC005
696700200610     C                     ENDIF                                          CAC005
696800200610      *
696900200610      ***  If no record on customer positions profit centre file
697000200610      ***  need to add one and amend the audit file
697100200610      *
697200200610     C           BKPCDU    IFEQ 'Y'
697300200610      *
697400200610      ***  Access to Position Profit Center to retrieve the profit centre
697500200610      *
697600200610     C                     MOVELDPBN      WKDPBN           Customer
697700200610     C                     MOVELDPBA      WKBRCA           Branch
697800200610     C                     MOVELDPSS      WKDPSS           New Security
697900200610      *
698000200610     C           KWSEPC    CHAINSEPCCDF              89
698100200610      *
698200200610     C           *IN89     IFEQ *ON
698300200610     C                     MOVEL'D'       RECI
698400200610     C                     MOVELDPBN      CNUM
698500200610     C                     MOVELDPBA      BRCA
698600200610     C                     MOVELDPSS      SESN
698700200610     C                     MOVELDPPC      PCCU
698800200610     C                     MOVE MCPTFR    PTFRXX                          CAC003
698900200610     C                     Z-ADDBJRDNB    LCD
699000200610     C                     MOVEL'I'       CHTP
699100200610     C                     EXSR ZTNLU1
699200200610     C                     MOVELNATN      TNLU
699300200610     C                     WRITESEPCCDF
699400200610      *
699500200610     C           1         CHAINSEPCA                89
699600200610     C           *IN89     IFEQ *ON
699700200610     C           *LOCK     IN   LDA
699800200610     C                     Z-ADD8         DBASE            ***************
699900200610     C                     MOVEL*BLANKS   DBFILE           * DB ERROR 08 *
700000200610     C                     MOVEL'SEPCA   'DBFILE           ***************
700100200610     C                     MOVEL'AUDIT'   DBKEY     P
700200200610     C                     MOVEL'SE7560'  DBPGM     P
700300200610     C                     OUT  LDA
700400200610     C                     EXSR *PSSR
700500200610     C                     ELSE
700600200610     C                     ADD  1         NORE
700700200610     C                     ADD  1         SINS
700800200610     C                     UPDATSEPCAF
700900200610     C                     ENDIF
701000200610     C                     ENDIF
701100200610     C                     ENDIF
701200200610      ***  .. Charge Code
701300200610     C                     MOVE *BLANKS   DCHC
701400200610      ***  .. Charge Currency
701500200610     C                     MOVE *BLANKS   DCCE
701600200610      ***  .. Charge Amount
701700200610     C                     Z-ADD*ZERO     DCHA
701800200610      ***  .. Charge Settlement
701900200610     C                     Z-ADD*ZERO     DCSE
702000200610      ***  .. Charge acc. branch
702100200610     C                     MOVE *BLANKS   DCAB
702200200610      ***  .. Charge account
702300200610     C                     MOVE *BLANKS   DCAT
702400200610      ***  .. Value Date
702500200610     C                     Z-ADDMAALEF    DPVD
702600200610      ***  .. Echange Rate (Settle - Port)
702700200610      ***  .. Spot Rate Mult/Div Indicator
702800200610     C                     Z-ADD0         SPXR
702900200610     C                     MOVE *BLANKS   SPMD
703000200610      ***  .. Portfolio Reference
703100200610     C                     MOVE MCPTFR    PTFR
703200200610      *                                                                   CSE015
703300200610      ** Trade Date                                                       CSE015
703400200610      *                                                                   CSE015
703500200610     C           CSE015    IFEQ 'Y'                                       CSE015
703600200610     C           MACOEX    IFLT MAALEF                                    CSE015
703700200610     C                     Z-ADDMACOEX    DMTD                            CSE015
703800200610     C                     ELSE                                           CSE015
703900200610     C                     Z-ADDMAALEF    DMTD                            CSE015
704000200610     C                     ENDIF                                          CSE015
704100200610     C                     ENDIF                                          CSE015
704200200610      *
704300200610      ***  Setup Echange Rate and Spot Rate if Porfolio Management is ON
704400200610      ***  and TOF Interface is OFF
704500200610      *
704600200610     C           BGPFMG    IFEQ 'Y'
704700200610     C           BGN4ST    OREQ 'Y'                                       CPB001
704800200610     C/COPY WNCPYSRC,SE7560C005
704900200610      *
705000200610     C           PTFR      IFNE *BLANKS
705100200610     C                     Z-ADD0         ZAMTF
705200200610     C           WWNMCY    IFEQ WONMCY
705300200610     C                     MOVE WONMCY    ZCCYF
705400200610     C                     MOVE WOSPRT    ZRATEF
705500200610     C                     MOVE WOMDIN    ZMDINF
705600200610     C                     MOVE WONBDP    ZCDPF
705700200610     C                     ELSE
705800200610     C                     MOVE WNNMCY    ZCCYF
705900200610     C                     MOVE WNSPRT    ZRATEF
706000200610     C                     MOVE WNMDIN    ZMDINF
706100200610     C                     MOVE WNNBDP    ZCDPF
706200200610     C                     ENDIF
706300200610      *
706400200610     C                     MOVELDPBN      WWCNUM 10 P
706500200610     C                     MOVELDPBN      WNCNUM
706600200610     C                     MOVE PTFR      WKPTFR
706700200610      *
706800200610     C           PTFR      IFEQ '9997'
706900200610      *
707000200610     C                     CALL 'AOPLCSR0'
707100200610     C                     PARM *BLANKS   @RTCD   7
707200200610     C                     PARM '*KEY   ' @OPTN   7
707300200610     C                     PARM WWCNUM    @CUST  10
707400200610     C           SDPLCS    PARM SDPLCS    DSSDY
707500200610      *
707600200610     C           @RTCD     IFNE *BLANK
707700200610     C           *LOCK     IN   LDA
707800200610     C                     Z-ADD9         DBASE            ***************
707900200610     C                     MOVEL*BLANKS   DBFILE           * DB ERROR 09 *
708000200610     C                     MOVE 'SDPLCSPD'DBFILE           ***************
708100200610     C                     MOVELWWCNUM    DBKEY     P
708200200610     C                     MOVEL'SE7560'  DBPGM     P
708300200610     C                     OUT  LDA
708400200610     C                     EXSR *PSSR
708500200610     C                     ENDIF
708600200610     C                     MOVE QBCSBY    ZCCYT
708700200610     C                     ELSE
708800200610      *
708900200610     C           KWPTFR    CHAINPMPORTLL             89
709000200610      *
709100200610     C           *IN89     IFEQ '1'
709200200610     C           *LOCK     IN   LDA
709300200610     C                     Z-ADD10        DBASE            ***************
709400200610     C                     MOVEL*BLANKS   DBFILE           * DB ERROR 10 *
709500200610     C                     MOVE 'PMPORTLL'DBFILE           ***************
709600200610     C                     MOVELWNCNUM    DBKEY     P
709700200610     C                     MOVE WKPTFR    DBKEY
709800200610     C                     MOVEL'SE7560'  DBPGM     P
709900200610     C                     OUT  LDA
710000200610     C                     EXSR *PSSR
710100200610     C                     ENDIF
710200200610     C                     MOVE PNPTCY    ZCCYT
710300200610     C                     ENDIF
710400200610      *
710500200610     C           ZCCYF     IFEQ ZCCYT
710600200610      ***  .. Spot Rate Mult/Div Indicator
710700200610     C                     Z-ADD1         SPXR
710800200610     C                     MOVE 'M'       SPMD
710900200610     C                     ELSE
711000200610      *
711100200610      ***  Retrieve base currency spot, M/D INDICATOR, DEC.PLACES
711200200610      *
711300200610     C                     CALL 'AOCURRR0'
711400200610     C                     PARM '*MSG   ' @RTCD   7
711500200610     C                     PARM '*KEY   ' @OPTN   7
711600200610     C                     PARM ZCCYT     @CYCD   3
711700200610     C           SDCURR    PARM SDCURR    DSSDY
711800200610      *
711900200610     C           @RTCD     IFNE *BLANK
712000200610     C           *LOCK     IN   LDA
712100200610     C                     Z-ADD11        DBASE            ***************
712200200610     C                     MOVEL*BLANKS   DBFILE           * DB ERROR 11 *
712300200610     C                     MOVE 'SDCURRPD'DBFILE           ***************
712400200610     C                     MOVELZCCYT     DBKEY     P
712500200610     C                     MOVEL'SE7560'  DBPGM     P
712600200610     C                     OUT  LDA
712700200610     C                     EXSR *PSSR
712800200610     C                     ENDIF
712900200610      *
713000200610     C                     MOVE A6SPRT    ZRATET
713100200610     C                     MOVE A6MDIN    ZMDINT
713200200610     C                     MOVE A6NBDP    ZCDPT
713300200610     C                     EXSR ZCCYCN
713400200610     C                     Z-ADDZCRSRT    SPXR
713500200610     C                     MOVE ZCRSMD    SPMD
713600200610     C                     ENDIF
713700200610     C                     ENDIF                           PTFR<>*BLANKS
713800200610     C                     ENDIF                           PM=ON and TOF=OFF
713900200610      *
714000200610      ***  .. Customer Yield Rate
714100200610     C                     Z-ADD*ZEROS    CYLD
714200200610      ***  .. Customer with/deliv
714300200610     C                     MOVE 'N'       CWDI
714400200610      *                                                                                       207006
714500200610     C           CSE029    IFEQ 'Y'                                                           207006
714600200610     C                     MOVE BVCOTC    CPTY                                                207006
714700200610     C                     MOVE SMCC      MRKT                                                207006
714800200610     C                     ENDIF                                                              207006
714900200610      *
715000200610      ***  Write a new depot movement
715100200610      *
715200200610     C                     EXSR #WDPMV
715300200610      *
715400200610     C                     ENDSR
715500200610      *
715600200610      *****************************************************************
715700200610      /EJECT
715800200610      *****************************************************************
715900200610      *  #AOPRF -  Subroutine to Call Access Object:                  *
716000200610      *  ------    Default Profit Center                              *
716100200610      *  Called by : #WTRAD #SDPMV                                    *
716200200610      *  Calls     : AOPRFMR0                                         *
716300200610      *****************************************************************
716400200610      *
716500200610     C           #AOPRF    BEGSR
716600200610      *                                                                                    179732
716700200610      **  Access Customer Details by using Access Object to retrieve                       179732
716800200610      **  Account Officer                                                                  179732
716900200610     C                     MOVE *BLANKS   @CUST                                            179732
717000200610     C                     MOVELWCUST     @CUST                                            179732
717100200610     C                     CALL 'AOCUSTR1'                                                 179732
717200200610     C                     PARM *BLANKS   @RTCD   7                                        179732
717300200610     C                     PARM '*KEY   ' @OPTN   7                                        179732
717400200610     C                     PARM           @CUST  10                                        179732
717500200610     C                     PARM           @KYST   7                                        179732
717600200610     C           SDCUST    PARM SDCUST    DSLDY                                            179732
717700200610      *                                                                                    179732
717800200610     C                     MOVELBBACOC    @ACOF                                            179732
717900200610      *
718000200610      ***  Setup Book code, Branch and User to retrieve Profit Centre
718100200610      *
718200200610     C                     CALL 'AOPRFMR0'
718300200610     C                     PARM *BLANKS   @RTC1   1
718400200610     C                     PARM           @BOOK   2
718500200610     C                     PARM           @TRTP   5
718600200610     C                     PARM           @SUTP   2
718700200610     C                     PARM           @BRAN   3
718800200610     C                     PARM *BLANKS   @DEPT   3
718900200610     C                     PARM USER      @USER  10
719000200610     C*******************  PARM *BLANKS   @ACOF   2                                        179732
719100200610     C*******************  PARM           WCNUM   6                                        179732
719200200610     C                     PARM           @ACOF   2                                        179732
719300200610     C                     PARM           WCUST   6                                        179732
719400200610     C                     PARM *BLANKS   @PRFC   4
719500200610      *
719600200610     C           @RTC1     IFEQ '0'
719700200610     C                     MOVEL@PRFC     WWPRFC  4
719800200610     C                     ELSE
719900200610     C                     MOVE *BLANKS   WWPRFC
720000200610     C                     ENDIF
720100200610      *
720200200610     C                     ENDSR
720300200610      *
720400200610      *****************************************************************
720500200610      /EJECT
720600200610      *****************************************************************
720700200610      *  #AOSEC -  Subroutine to Call Access Object:                  *
720800200610      *  ------    Security Customer                                  *
720900200610      *  Called by : #WTRAD                                           *
721000200610      *  Calls     : AOSECSR0 *PSSR                                   *
721100200610      *****************************************************************
721200200610      *
721300200610     C           #AOSEC    BEGSR
721400200610      *
721500200610     C                     CALL 'AOSECSR0'
721600200610     C                     PARM *BLANKS   @RTCD   7
721700200610     C                     PARM '*KEY   ' @OPTN   7
721800200610     C                     PARM WCUST     @SCKY   6
721900200610     C           SDSECS    PARM SDSECS    DSSDY
722000200610      *
722100200610     C           @RTCD     IFNE *BLANKS
722200200610     C           *LOCK     IN   LDA
722300200610     C                     Z-ADD12        DBASE            ***************
722400200610     C                     MOVEL*BLANKS   DBFILE           * DB ERROR 12 *
722500200610     C                     MOVE 'SDSECSPD'DBFILE           ***************
722600200610     C                     MOVELWCUST     DBKEY     P
722700200610     C                     MOVEL'SE7560'  DBPGM     P
722800200610     C                     OUT  LDA
722900200610     C                     EXSR *PSSR
723000200610     C                     ENDIF
723100200610      *
723200200610     C                     ENDSR
723300200610      *
723400200610      *****************************************************************
723500200610      /EJECT
723600200610      *****************************************************************
723700200610      *  #UTRAD -  Update the trade to cancel it                      *
723800200610      *  ------                                                       *
723900200610      *  Called by : #TDRVR                                           *
724000200610      *  Calls     : Nothing                                          *
724100200610      *****************************************************************
724200200610      *
724300200610     C           #UTRAD    BEGSR
724400200610      *
724500200610      ***  Access to Trade previously generated using "Transaction Reference"
724600200610      *
724700200610     C           WKTRRF    CHAINTRADS                88
724800200610      *
724900200610     C           *IN88     IFEQ *ON
725000200610     C           RECI      OREQ '*'
725100200610     C           *LOCK     IN   LDA
725200200610     C                     Z-ADD13        DBASE            ***************
725300200610     C                     MOVEL*BLANKS   DBFILE           * DB ERROR 13 *
725400200610     C                     MOVE 'TRADS   'DBFILE           ***************
725500200610     C                     MOVELWKTRRF    DBKEY     P
725600200610     C                     MOVEL'SE7560'  DBPGM     P
725700200610     C                     OUT  LDA
725800200610     C                     EXSR *PSSR
725900200610     C                     ENDIF
726000200610      *
726100200610      ***  If feature S01401 (MT5xxx) is ON
726200200610      ***  Access to Trade details extended file
726300200610      *
726400200610     C           S01401    IFEQ 'Y'
726500200610     C           WKTRRF    CHAINTRADSDD1             88
726600200610      *
726700200610     C           *IN88     IFEQ *ON
726800200610     C           *LOCK     IN   LDA
726900200610     C                     Z-ADD14        DBASE            ***************
727000200610     C                     MOVEL*BLANKS   DBFILE           * DB ERROR 14 *
727100200610     C                     MOVE 'TRADSDY1'DBFILE           ***************
727200200610     C                     MOVELWKTRRF    DBKEY     P
727300200610     C                     MOVEL'SE7560'  DBPGM     P
727400200610     C                     OUT  LDA
727500200610     C                     EXSR *PSSR
727600200610     C                     ENDIF
727700200610     C                     ENDIF
727800200610      *
727900200610     C                     MOVE 'C'       RECI
728000200610     C                     MOVE 'D'       CHTP
728100200610     C                     Z-ADDBJRDNB    LCD
728200200610     C                     UPDATTRADSDF
728300200610      *
728400200610      ***  Add 1 into counter of reversed trades
728500200610      *
728600200610     C                     ADD  1         W04CNT
728700200610     C                     MOVE 'Y'       WWDATA           one Read
728800200610      *
728900200610      * write to Movement Status file                                     CSE039
729000200610      *                                                                   CSE039
729100200610     C           CSE039    IFEQ 'Y'                                       CSE039
729200200610      *                                                                   CSE039
729300200610      ** Check if record exists (Reference, Type, Notification)           CSE039
729400200610     C                     MOVELTDRF      KTDRF                           CSE039
729500200610     C                     MOVEL'T'       KTRTY                           CSE039
729600200610     C                     Z-ADDBJRDNB    KNTDT                           CSE039
729700200610     C                     Z-ADD0         USQNR   30                      CSE039
729800200610      *                                                                   CSE039
729900200610      ** Get Sequence Number                                              CSE039
730000200610     C           KSEMV     SETLLSEMVTSL1                                  CSE039
730100200610     C                     READ SEMVTSL1                 65               CSE039
730200200610     C           *IN65     IFEQ *OFF                                      CSE039
730300200610     C           KTDRF     ANDEQTMTRRF                                    CSE039
730400200610     C           KTRTY     ANDEQTMTRTY                                    CSE039
730500200610     C           KNTDT     ANDEQTMNTDT                                    CSE039
730600200610     C                     Z-ADDTMSQNR    USQNR                           CSE039
730700200610     C                     ENDIF                                          CSE039
730800200610     C                     MOVELTDRF      TMTRRF                          CSE039
730900200610     C                     MOVEL'T'       TMTRTY                          CSE039
731000200610     C                     Z-ADDBJRDNB    TMNTDT                          CSE039
731100200610     C           USQNR     ADD  1         TMSQNR                          CSE039
731200200610     C                     MOVEL'DEL'     TMSWSC                          CSE039
731300200610     C                     MOVEL*BLANKS   TMSWRC                          CSE039
731400200610     C                     MOVEL*BLANKS   TMNTMT                          CSE039
731500200610     C                     MOVEL*BLANKS   TMLCUS                          CSE039
731600200610     C                     MOVEL'MIDAS'   TMINOR                          CSE039
731700200610     C                     MOVEL*BLANKS   TMMSGK                          CSE039
731800200610     C                     MOVEL*BLANKS   TMSTMG                          CSE039
731900200610     C                     MOVELWWDNAR    TMNARR                          CSE039
732000200610     C                     MOVEL'I'       TMLCTP                          CSE039
732100200610     C                     Z-ADDBJRDNB    TMLCDT                          CSE039
732200200610     C                     MOVELTMMP,1    TMTMST                          CSE039
732300200610     C                     MOVELTDBA      TMTRBB                          CSE039
732400200610     C                     MOVE USER      TMLCUS                          CSE039
732500200610      *                                                                   CSE039
732600200610     C                     WRITESEMVTSD0                                  CSE039
732700200610     C                     ENDIF                                          CSE039
732800200610      *                                                                   CSE039
732900200610     C                     ENDSR
733000200610      *
733100200610      *****************************************************************
733200200610      /EJECT
733300200610      *****************************************************************
733400200610      *  #PDNCH -  Process Depot records for processing type 'NC'     *
733500200610      *  ------    (Name Change produced)                             *
733600200610      *  Called by : Main processing                                  *
733700200610      *  Calls     : Nothing                                          *
733800200610      *****************************************************************
733900200610      *
734000200610     C           #PDNCH    BEGSR
734100200610      *
734200200610      ***  Access to Corporate Action Name Changes to retrieve details
734300200610      *
734400200610     C**********           MOVE MSCORF    WKCORF                                              185017
734500200610     C                     MOVE MACORF    WKCORF                                              185017
734600200610     C           WKCORF    CHAINSECONCL0             46
734700200610      *
734800200610     C           *IN46     IFEQ *ON
734900200610     C           MLRECI    OREQ *ON
735000200610     C           *LOCK     IN   LDA
735100200610     C                     Z-ADD15        DBASE            ***************
735200200610     C                     MOVEL*BLANKS   DBFILE           * DB ERROR 15 *
735300200610     C                     MOVE 'SECONCL0'DBFILE           ***************
735400200610     C                     MOVELWKCORF    DBKEY     P
735500200610     C                     MOVEL'SE7560'  DBPGM     P
735600200610     C                     OUT  LDA
735700200610     C                     EXSR *PSSR
735800200610     C                     ENDIF                           *IN46=*ON
735900200610      *
736000200610      ***  Update already done
736100200610      *
736200200610     C           MLUPDD    IFNE 'Y'
736300200610      *
736400200610      ***  Retrieve the details from the current security
736500200610      *
736600200610     C                     MOVELMASESN    WKSESN    P
736700200610      *
736800200610     C           WKSESN    CHAINSECTY                89
736900200610      *
737000200610     C           *IN89     IFEQ *ON
737100200610     C           RECI      OREQ '*'
737200200610     C           *LOCK     IN   LDA
737300200610     C                     Z-ADD16        DBASE            ***************
737400200610     C                     MOVEL*BLANKS   DBFILE           * DB ERROR 16 *
737500200610     C                     MOVE 'SECTY   'DBFILE           ***************
737600200610     C                     MOVELWKSESN    DBKEY
737700200610     C                     MOVEL'SE7560'  DBPGM     P
737800200610     C                     OUT  LDA
737900200610     C                     EXSR *PSSR
738000200610     C                     ENDIF
738100200610      *
738200200610      ***  For each non blank field retrieved on LF/SECONCL0
738300200610      ***    - Move current value retrieved on LF/SECTY into
738400200610      ***      the old fields held on PF/SECONCPD (MLOxxxx)
738500200610      ***    - Update PF/SECONCPD with the old fields
738600200610      ***    - Move all non blank fields in fields on PF/SECTYD and
738700200610      ***      update the master file PF/SECTYD with the new values of
738800200610      ***      fields entered.
738900200610      *
739000200610     C           MLSRPN    IFNE *BLANKS
739100200610     C                     MOVE SRPN      MLOSRN    P      Old Report Name
739200200610     C                     MOVE MLSRPN    SRPN      P      Report Name
739300200610     C                     ENDIF
739400200610      *
739500200610     C           MLSFN1    IFNE *BLANKS
739600200610     C                     MOVE SFN1      MLOSF1    P      Old Full Name 1
739700200610     C                     MOVE MLSFN1    SFN1      P      Full Name 1
739800200610     C                     ENDIF
739900200610      *
740000200610     C           MLSFN2    IFNE *BLANKS
740100200610     C                     MOVE SFN2      MLOSF2    P      Old Full Name 2
740200200610     C                     MOVE MLSFN2    SFN2      P      Full Name 2
740300200610     C                     ENDIF
740400200610      *
740500200610     C           MLT2RF    IFNE *BLANKS
740600200610     C                     MOVE T2RF      MLOT2R    P      Old Telekurs
740700200610     C                     MOVE MLT2RF    T2RF      P      Telekurs
740800200610     C                     ENDIF
740900200610      *
741000200610     C           MLISNO    IFNE *BLANKS
741100200610     C                     MOVE ISNO      MLOISN    P      Old ISIN Mumber
741200200610     C                     MOVE MLISNO    ISNO      P      ISIN Number
741300200610     C                     ENDIF
741400200610      *
741500200610     C           MLCSPN    IFNE *BLANKS
741600200610     C                     MOVE CSPN      MLOCSP    P      Old Cusip Mumber
741700200610     C                     MOVE MLCSPN    CSPN      P      Cusip Number
741800200610     C                     ENDIF
741900200610      *
742000200610     C           MLSREF    IFNE *BLANKS
742100200610     C                     MOVE SREF      MLOSRE    P      Old Extel
742200200610     C                     MOVE MLSREF    SREF      P      Extel
742300200610     C                     ENDIF
742400200610      *
742500200610     C           MLSRE1    IFNE *BLANKS
742600200610     C                     MOVE DASR      MLOSR1    P      Old Security ref. 1
742700200610     C                     MOVE MLSRE1    DASR      P      Security ref. 1
742800200610     C                     ENDIF
742900200610      *
743000200610     C           MLSRE2    IFNE *BLANKS
743100200610     C                     MOVE DCSR      MLOSR2    P      Old Security ref. 2
743200200610     C                     MOVE MLSRE2    DCSR      P      Security ref. 2
743300200610     C                     ENDIF
743400200610      *
743500200610     C           MLSRE3    IFNE *BLANKS
743600200610     C                     MOVE DDSR      MLOSR3    P      Old Security ref. 3
743700200610     C                     MOVE MLSRE3    DDSR      P      Security ref. 3
743800200610     C                     ENDIF
743900200610      *
744000200610     C                     UPDATSECTYDF
744100200610      *
744200200610      ***  Update done
744300200610      *
744400200610     C                     MOVE 'Y'       MLUPDD
744500200610     C                     UPDATSECONCD0
744600200610     C                     ENDIF                           MLUDPP<>'Y'
744700200610      *
744800200610     C                     ENDSR
744900200610      *
745000200610      *****************************************************************
745100200610      /EJECT
745200200610      *****************************************************************
745300200610      *  #ACOAT -  Subroutine to Retrieve Details from PF/SECOATPD    *
745400200610      *  ------    Corporate Action Type details                      *
745500200610      *  Called by : #PRDV #PRFRR #PRFRO #PRFRA #PRCRR #PRCRA #PRCE   *
745600200610      *              #PROFE #PROFP #PREX #PRTGZ #PRRGM #PRRGC #PRNC   *
745700200610      *  Calls     : Nothing                                          *
745800200610      *****************************************************************
745900200610      *
746000200610     C           #ACOAT    BEGSR
746100200610      *
746200200610     C           WKCOAT    CHAINSECOATL0             89
746300200610      *
746400200610     C           *IN89     IFEQ *ON
746500200610     C           MMRECI    OREQ '*'
746600200610     C           *LOCK     IN   LDA
746700200610     C                     Z-ADD17        DBASE            ***************
746800200610     C                     MOVEL*BLANKS   DBFILE           * DB ERROR 17 *
746900200610     C                     MOVE 'SECOATPD'DBFILE           ***************
747000200610     C                     MOVELWKCOAT    DBKEY     P
747100200610     C                     MOVEL'SE7560'  DBPGM     P
747200200610     C                     OUT  LDA
747300200610     C                     EXSR *PSSR
747400200610     C                     ENDIF
747500200610      *
747600200610     C                     ENDSR
747700200610      *
747800200610      *****************************************************************
747900200610      /EJECT
748000200610      *****************************************************************
748100200610      *  #SECTO - Access to LF/SETY to Retrieve fields details        *
748200200610      *  ------   for the old security                                *
748300200610      *  Called by : Main processing                                  *
748400200610      *  Calls     : AOCURRR0 *PSSR                                   *
748500200610      *****************************************************************
748600200610      *
748700200610     C           #SECTO    BEGSR
748800200610      *
748900200610      ***  Chain for security record
749000200610      *
749100200610     C           WKSESN    CHAINSECTY                89
749200200610      *
749300200610     C           *IN89     IFEQ *ON
749400200610     C           RECI      OREQ '*'
749500200610     C           *LOCK     IN   LDA
749600200610     C                     Z-ADD18        DBASE            ***************
749700200610     C                     MOVEL*BLANKS   DBFILE           * DB ERROR 18 *
749800200610     C                     MOVE 'SECTY   'DBFILE           ***************
749900200610     C                     MOVELWKSESN    DBKEY
750000200610     C                     MOVEL'SE7560'  DBPGM     P
750100200610     C                     OUT  LDA
750200200610     C                     EXSR *PSSR
750300200610     C                     ENDIF
750400200610      *
750500200610      ***  Security nominal decimal places and price basis
750600200610      *
750700200610     C                     MOVELNMCY      WONMCY
750800200610     C                     MOVE MKTI      WOMKTI
750900200610     C                     Z-ADDNMDP      WONMDP
751000200610     C                     MOVE SPBS      WOSPBS
751100200610     C                     Z-ADDCFCT      WOCFCT
751200200610     C                     MOVE SMCC      WOSMCC
751300200610     C                     Z-ADDCPNR      WOCPNR
751400200610     C                     MOVE EDFT      WOEDFT
751500200610     C                     Z-ADDNDVD      WONDVD
751600200610     C                     Z-ADDMATY      WOMATY
751700200610     C                     MOVE STBS      WOSTBS
751800200610     C                     MOVE SYBS      WOSYBS
751900200610     C                     MOVE SITP      WOSITP
752000200610     C                     MOVE MLTI      WOMLTI
752100200610      *
752200200610      ***  Retrieve nomimal currency spot, m/d ind. and dec. places
752300200610      *
752400200610     C                     CALL 'AOCURRR0'
752500200610     C                     PARM *BLANKS   @RTCD   7
752600200610     C                     PARM '*KEY   ' @OPTN   7
752700200610     C                     PARM WONMCY    @CYCD   3
752800200610     C           SDCURR    PARM SDCURR    DSSDY
752900200610      *
753000200610     C           @RTCD     IFNE *BLANK
753100200610     C           *LOCK     IN   LDA
753200200610     C                     Z-ADD19        DBASE            ***************
753300200610     C                     MOVEL*BLANKS   DBFILE           * DB ERROR 19 *
753400200610     C                     MOVE 'SDCURRPD'DBFILE           ***************
753500200610     C                     MOVELWONMCY    DBKEY     P
753600200610     C                     MOVEL'SE7560'  DBPGM     P
753700200610     C                     OUT  LDA
753800200610     C                     EXSR *PSSR
753900200610     C                     ENDIF
754000200610      *
754100200610      ***  Save base currency spot, m/d indicator, dec. places for later
754200200610      *
754300200610     C                     MOVE A6SPRT    WOSPRT
754400200610     C                     MOVE A6MDIN    WOMDIN
754500200610     C                     MOVE A6NBDP    WONBDP
754600200610     C                     MOVE A6NBDP    WOERLC
754700200610      *
754800200610     C           CEU002    IFEQ 'Y'
754900200610     C                     MOVE A6INCY    WOINCY  1
755000200610     C                     Z-ADDA6EUER    WOEUER
755100200610     C                     MOVE A6EUMD    WOEUMD
755200200610     C                     ELSE
755300200610     C                     MOVE *BLANKS   WOINCY  1
755400200610     C                     Z-ADD*ZEROS    WOEUER
755500200610     C                     MOVE *BLANKS   WOEUMD
755600200610     C                     ENDIF
755700200610      *
755800200610     C                     ENDSR
755900200610      *
756000200610      *****************************************************************
756100200610      /EJECT
756200200610      *****************************************************************
756300200610      *  #SECTN - Access to LF/SECTY to Retrieve fields details       *
756400200610      *  ------   for the new security                                *
756500200610      *  Called by : #PRDV #PRFRR #PRFRO #PRFRA #PRCRR #PRCRA #PRCE   *
756600200610      *              #PROFE #PROFP #PREX #PRTGZ #PRRGM #PRRGC #PRNC   *
756700200610      *  Calls     : AOCURRR0 *PSSR                                   *
756800200610      *****************************************************************
756900200610      *
757000200610     C           #SECTN    BEGSR
757100200610      *
757200200610      ***  Chain for security record
757300200610      *
757400200610     C           WKSESN    CHAINSECTY                89
757500200610      *
757600200610     C           *IN89     IFEQ *ON
757700200610     C           RECI      OREQ '*'
757800200610     C           *LOCK     IN   LDA
757900200610     C                     Z-ADD20        DBASE            ***************
758000200610     C                     MOVEL*BLANKS   DBFILE           * DB ERROR 20 *
758100200610     C                     MOVE 'SECTY   'DBFILE           ***************
758200200610     C                     MOVELWKSESN    DBKEY
758300200610     C                     MOVEL'SE7560'  DBPGM     P
758400200610     C                     OUT  LDA
758500200610     C                     EXSR *PSSR
758600200610     C                     ENDIF
758700200610      *
758800200610      ***  Security details for new security
758900200610      *
759000200610     C                     MOVELNMCY      WNNMCY
759100200610     C                     Z-ADDMKPR      WNMKPR
759200200610     C                     Z-ADDNMDP      WNNMDP
759300200610     C                     MOVE MKTI      WNMKTI
759400200610     C                     MOVE SMCC      WNSMCC
759500200610     C                     MOVE EDFT      WNEDFT
759600200610     C                     Z-ADDCPNR      WNCPNR
759700200610     C                     MOVE STBS      WNSTBS
759800200610     C                     Z-ADDMATY      WNMATY
759900200610     C                     MOVE SYBS      WNSYBS
760000200610     C                     Z-ADDNDVD      WNNDVD
760100200610     C                     Z-ADDNMDP      WNNMDP
760200200610     C                     MOVE SPBS      WNSPBS
760300200610     C                     Z-ADDCFCT      WNCFCT
760400200610     C                     MOVE SITP      WNSITP
760500200610     C                     MOVE MLTI      WNMLTI
760600200610      *
760700200610      ***  Retrieve nomimal currency spot, m/d ind. and dec. places
760800200610      *
760900200610     C                     CALL 'AOCURRR0'
761000200610     C                     PARM *BLANKS   @RTCD   7
761100200610     C                     PARM '*KEY   ' @OPTN   7
761200200610     C                     PARM WNNMCY    @CYCD   3
761300200610     C           SDCURR    PARM SDCURR    DSSDY
761400200610      *
761500200610     C           @RTCD     IFNE *BLANK
761600200610     C           *LOCK     IN   LDA
761700200610     C                     Z-ADD21        DBASE            ***************
761800200610     C                     MOVEL*BLANKS   DBFILE           * DB ERROR 21 *
761900200610     C                     MOVE 'SDCURRPD'DBFILE           ***************
762000200610     C                     MOVELWNNMCY    DBKEY     P
762100200610     C                     MOVEL'SE7560'  DBPGM     P
762200200610     C                     OUT  LDA
762300200610     C                     EXSR *PSSR
762400200610     C                     ENDIF
762500200610      *
762600200610      ***  Save base currency spot, m/d indicator, dec. places for later
762700200610      *
762800200610     C                     Z-ADDA6SPRT    WNSPRT
762900200610     C                     MOVE A6MDIN    WNMDIN
763000200610     C                     Z-ADDA6NBDP    WNNBDP
763100200610      *
763200200610     C           CEU002    IFEQ 'Y'
763300200610     C                     MOVE A6INCY    WNINCY  1
763400200610     C                     Z-ADDA6EUER    WNEUER
763500200610     C                     MOVE A6EUMD    WNEUMD
763600200610     C                     ELSE
763700200610     C                     MOVE *BLANKS   WNINCY  1
763800200610     C                     Z-ADD*ZEROS    WNEUER
763900200610     C                     MOVE *BLANKS   WNEUMD
764000200610     C                     ENDIF
764100200610      *
764200200610     C                     ENDSR
764300200610      *
764400200610      *****************************************************************
764500200610      /EJECT
764600200610      *****************************************************************
764700200610      *  #TERPR -  Termination processing                             *
764800200610      *  ------                                                       *
764900200610      *  Called by : Main processing                                  *
765000200610      *  Calls     : *PSSR                                            *
765100200610      *****************************************************************
765200200610      *
765300200610     C           #TERPR    BEGSR
765400200610      *
765500200610      ***  Close file if S01401 is installed.
765600200610      *
765700200610     C           S01401    IFEQ 'Y'
765800200610     C                     CLOSEDPTMVDY1
765900200610     C                     CLOSETRADSDY1
766000200610     C                     ENDIF
766100200610      *
766200200610      ***  Update Trade reference range if trade generated
766300200610      *
766400200610     C/COPY WNCPYSRC,SE7560C015
766500200610     C           NTRN      IFNE WWNTR1
766600200610     C                     Z-ADDWWNTR1    NTRN
766700200610     C                     UPDATTNRANABF               89
766800200610     C                     ENDIF
766900200610     C/COPY WNCPYSRC,SE7560C006
767000200610      *                                                                                       CER001
767100200610      ** When Lux Return feature ss present, close opened files                               CER001
767200200610      *                                                                                       CER001
767300200610     C           BGLRIN    IFEQ 'Y'                                                           CER001
767400200610     C                     CLOSESETRX1PD                                                      CER001
767500200610     C                     CLOSESEDPX1PD                                                      CER001
767600200610     C                     ENDIF                                                              CER001
767700200610      *                                                                                       CER001
767800200610     C           ULX008    IFEQ 'Y'                                                           CER001
767900200610     C                     CLOSEERLUICL1                                                      CER001
768000200610     C                     ENDIF                                                              CER001
768100200610      *
768200200610      ** UPDATE TRADE AUDIT DETAILS
768300200610      *
768400200610     C           W01CNT    IFNE *ZEROS
768500200610     C           W04CNT    ORNE *ZEROS
768600200610     C           1         CHAINTRADSAF              89
768700200610      *
768800200610     C           *IN89     IFEQ *OFF
768900200610     C                     ADD  W01CNT    SINS
769000200610     C                     ADD  W01CNT    NORE
769100200610     C                     ADD  W04CNT    SDEL
769200200610     C                     UPDATTRADSAF
769300200610     C                     ELSE
769400200610     C           *LOCK     IN   LDA
769500200610     C                     Z-ADD22        DBASE            ***************
769600200610     C                     MOVEL*BLANKS   DBFILE           * DB ERROR 22 *
769700200610     C                     MOVE 'TRADSA  'DBFILE           ***************
769800200610     C                     MOVEL'AUDIT'   DBKEY
769900200610     C                     MOVEL'SE7560'  DBPGM     P
770000200610     C                     OUT  LDA
770100200610     C                     EXSR *PSSR
770200200610     C                     ENDIF
770300200610     C                     ENDIF
770400200610      *
770500200610      ***  Update depot movements audit details
770600200610      *
770700200610     C           W02CNT    IFNE *ZEROS
770800200610     C           W05CNT    ORNE *ZEROS
770900200610     C           WXXDEL    ORNE *ZEROS                                                        219634
771000200610     C           1         CHAINDPTMVAF              89
771100200610      *
771200200610     C           *IN89     IFEQ *OFF
771300200610     C                     ADD  W02CNT    SINS
771400200610     C                     ADD  W05CNT    SINS
771500200610     C                     ADD  W02CNT    NORE
771600200610     C                     ADD  W05CNT    NORE
771700200610     C                     ADD  WXXDEL    SDEL                                                219634
771800200610     C                     SUB  WXXDEL    NORE                                                219634
771900200610     C                     UPDATDPTMVAF
772000200610     C                     ELSE
772100200610     C           *LOCK     IN   LDA
772200200610     C                     Z-ADD23        DBASE            ***************
772300200610     C                     MOVEL*BLANKS   DBFILE           * DB ERROR 23 *
772400200610     C                     MOVE 'DPTMVA  'DBFILE           ***************
772500200610     C                     MOVEL'AUDIT'   DBKEY
772600200610     C                     MOVEL'SE7560'  DBPGM     P
772700200610     C                     OUT  LDA
772800200610     C                     EXSR *PSSR
772900200610     C                     ENDIF
773000200610     C                     ENDIF
773100200610      *
773200200610      ***  Update position settlement audit details
773300200610      *
773400200610     C           W03CNT    IFNE *ZEROS
773500200610     C           1         CHAINPOSETAF              89
773600200610      *
773700200610     C           *IN89     IFEQ '0'
773800200610     C                     ADD  W03CNT    NODE             *NO.DLTD TDY
773900200610     C                     SUB  W03CNT    NORE             *NO.LIVE RCS
774000200610     C                     UPDATPOSETAF                89
774100200610      *
774200200610     C           *IN89     IFEQ '1'
774300200610     C           *LOCK     IN   LDA
774400200610     C                     Z-ADD24        DBASE            ***************
774500200610     C                     MOVEL*BLANKS   DBFILE           * DB ERROR 24 *
774600200610     C                     MOVE 'POSETAF 'DBFILE           ***************
774700200610     C                     MOVEL'UPDAT'   DBKEY
774800200610     C                     MOVEL'SE7560'  DBPGM     P
774900200610     C                     OUT  LDA
775000200610     C                     EXSR *PSSR
775100200610     C                     ENDIF
775200200610      *
775300200610     C                     ELSE
775400200610     C           *LOCK     IN   LDA
775500200610     C                     Z-ADD25        DBASE            ***************
775600200610     C                     MOVEL*BLANKS   DBFILE           * DB ERROR 25 *
775700200610     C                     MOVE 'POSETA  'DBFILE           ***************
775800200610     C                     MOVEL'AUDIT'   DBKEY
775900200610     C                     MOVEL'SE7560'  DBPGM     P
776000200610     C                     OUT  LDA
776100200610     C                     EXSR *PSSR
776200200610     C                     ENDIF
776300200610     C                     ENDIF
776400200610      *
776500200610      ***  Update  print Audit
776600200610      *
776700200610     C           WWDATA    IFNE 'N'
776800200610     C                     WRITEHEADAU
776900200610     C                     WRITECONTROL
777000200610     C                     ELSE
777100200610     C                     WRITEHEADAU
777200200610     C                     WRITENODTLS                     No detail to report
777300200610     C                     ENDIF
777400200610      *
777500200610      ***  Return out of the program
777600200610      *
777700200610     C                     MOVE *ON       *INLR
777800200610     C                     RETRN
777900200610      *
778000200610     C                     ENDSR
778100200610      *
778200200610     ******************************************************************
778300200610      /EJECT
778400200610      *****************************************************************
778500200610      *   *INZSR : Program initialisation Subroutine                  *
778600200610      *  -------                                                      *
778700200610      *  Called by : Automatically at pgm start                       *
778800200610      *  Calls     : AOBANKR0 *PSSR                                   *
778900200610      *****************************************************************
779000200610      *
779100200610     C           *INZSR    BEGSR
779200200610      *
779300200610      ***  Move the copyright statement
779400200610      *
779500200610     C                     MOVEACPY@      BIS@   80
779600200610      *
779700200610      ***  Initialise key and working fields
779800200610      *
779900200610     C           *LIKE     DEFN MASESN    WOSESN           Event Security
780000200610     C           *LIKE     DEFN MASESN    WWSESN           Working Security
780100200610     C           *LIKE     DEFN MATDVD    WKTDVD           Trade/Value Pos152589
780200200610     C           *LIKE     DEFN MCSESN    WNSESN           Current Security
780300200610     C           *LIKE     DEFN MSBRCD    WSBRCD           Saved Branch
780400200610     C           *LIKE     DEFN MSDDPT    WSDDPT           Saved Depot movement
780500200610     C           *LIKE     DEFN MCCNUM    WNCNUM           Customer
780600200610     C           *LIKE     DEFN MCCNUM    WKCNUM           Customer
780700200610     C           *LIKE     DEFN MCCOTP    WKCOTP           Cust/Book ind.
780800200610      ***  From LF/SECTY
780900200610     C           *LIKE     DEFN NMDP      WNNMDP           Decimal places
781000200610     C           *LIKE     DEFN NMDP      WONMDP           Decimal places
781100200610     C           *LIKE     DEFN SPBS      WOSPBS           Price Basis
781200200610     C           *LIKE     DEFN SPBS      WNSPBS           Price Basis
781300200610     C           *LIKE     DEFN CFCT      WNCFCT           Current Factor
781400200610     C           *LIKE     DEFN CFCT      WOCFCT           Current Factor
781500200610     C           *LIKE     DEFN NMCY      WONMCY           Nominal Ccy
781600200610     C           *LIKE     DEFN NMCY      WWNMCY           Nominal Ccy
781700200610     C           *LIKE     DEFN MKTI      WNMKTI           Market ind.
781800200610     C           *LIKE     DEFN MKTI      WOMKTI           Market ind.
781900200610     C           *LIKE     DEFN NMCY      WNNMCY           Nominal Ccy
782000200610     C           *LIKE     DEFN MKPR      WNMKPR           Market Price
782100200610     C           *LIKE     DEFN SMCC      WNSMCC           Market Center
782200200610     C           *LIKE     DEFN SMCC      WOSMCC           Market Center
782300200610     C           *LIKE     DEFN EDFT      WNEDFT           Ex Date Default
782400200610     C           *LIKE     DEFN EDFT      WOEDFT           Ex Date Default
782500200610     C           *LIKE     DEFN CPNR      WNCPNR           Coupon Rate
782600200610     C           *LIKE     DEFN CPNR      WOCPNR           Coupon Rate
782700200610     C           *LIKE     DEFN STBS      WNSTBS           Trade Basis
782800200610     C           *LIKE     DEFN STBS      WOSTBS           Trade Basis
782900200610     C           *LIKE     DEFN MATY      WNMATY           Maturity Date
783000200610     C           *LIKE     DEFN MATY      WOMATY           Maturity Date
783100200610     C           *LIKE     DEFN SYBS      WNSYBS           Yield Basis
783200200610     C           *LIKE     DEFN SYBS      WOSYBS           Yield Basis
783300200610     C           *LIKE     DEFN NDVD      WNNDVD           Next Dividend Date
783400200610     C           *LIKE     DEFN NDVD      WONDVD           Next Dividend Date
783500200610     C           *LIKE     DEFN SITP      WNSITP           Invest type
783600200610     C           *LIKE     DEFN SITP      WOSITP           Invest type
783700200610     C           *LIKE     DEFN MLTI      WNMLTI           Multi Currency
783800200610     C           *LIKE     DEFN MLTI      WOMLTI           Multi Currency
783900200610      ***  From LF/SECOALL5
784000200610     C           *LIKE     DEFN MCCORF    KWCORF           CA Reference
784100200610     C           *LIKE     DEFN MCCORF    WKCORF           CA Reference
784200200610     C           *LIKE     DEFN MCCORF    WSCORF           CA Reference
784300200610     C           *LIKE     DEFN MCOPTN    WKOPTN           Option Number
784400200610     C           *LIKE     DEFN MCBRCD    WWBRCD           Branch Code
784500200610     C           *LIKE     DEFN MCDDPT    WWDDPT           Depot
784600200610      ***  From LF/DPTMV
784700200610     C           *LIKE     DEFN DPMV      WWDPMV           Movement Type
784800200610     C           *LIKE     DEFN DPNA      WWDPNA           Nominal Amount
784900200610     C           *LIKE     DEFN MKTP      WWMKTP           Market Price
785000200610      ***  From LF/TRADS
785100200610     C           *LIKE     DEFN TDBK      WKTDBK           Book
785200200610     C           *LIKE     DEFN TDBK      WKBOOK           Book
785300200610     C           *LIKE     DEFN NOML      WWNOML           Nominal
785400200610     C           *LIKE     DEFN PAYT      WWPAYT           Pay to
785500200610     C           *LIKE     DEFN PYFM      WWPYFM           Pay from branch
785600200610     C           *LIKE     DEFN TDTP      WWTDTP           Trade type
785700200610     C           *LIKE     DEFN TPDY      WWTPDY           Price/Disc/Yield
785800200610      ***  From LF/SEPCBD
785900200610     C           *LIKE     DEFN MKTI      WKMKTI           Market Ind.
786000200610      ***  From LF/SEPCCD
786100200610     C           *LIKE     DEFN CNUM      WKDPBN           Customer Number
786200200610     C           *LIKE     DEFN BRCA      WKBRCA           Branch
786300200610     C           *LIKE     DEFN SESN      WKDPSS           Security
786400200610      ***  From LF/SECOATL0
786500200610     C           *LIKE     DEFN MMTYPE    WKCOAT           CA Type
786600200610      ***  From LF/TNRAN
786700200610     C           *LIKE     DEFN RECT      WKREC            Record type
786800200610     C           *LIKE     DEFN ZZ008     WKFILL           Filler
786900200610     C           *LIKE     DEFN RANG      WKRANG           Range Number
787000200610      *
787100200610      ***  Fields for security nominal currency
787200200610      *
787300200610     C           *LIKE     DEFN A6SPRT    WNSPRT
787400200610     C           *LIKE     DEFN A6SPRT    WOSPRT
787500200610     C           *LIKE     DEFN A6SPRT    WOEUER
787600200610     C           *LIKE     DEFN A6SPRT    WNEUER
787700200610     C           *LIKE     DEFN A6MDIN    WNMDIN
787800200610     C           *LIKE     DEFN A6MDIN    WOMDIN
787900200610     C           *LIKE     DEFN A6MDIN    WOEUMD
788000200610     C           *LIKE     DEFN A6MDIN    WNEUMD
788100200610     C           *LIKE     DEFN A6NBDP    WNNBDP
788200200610     C           *LIKE     DEFN A6NBDP    WONBDP
788300200610     C           *LIKE     DEFN A6ERLC    WOERLC
788400200610      *
788500200610     C           *LIKE     DEFN ECD       WWECD
788600200610     C/COPY WNCPYSRC,SE7560C013
788700200610      *
788800200610     C                     MOVE *BLANKS   WNSESN
788900200610     C                     MOVE *BLANKS   WNMKTI
789000200610     C                     MOVE *BLANKS   WNNMCY
789100200610     C                     MOVE *BLANKS   WNNMDP
789200200610     C                     MOVE *BLANKS   WNSMCC
789300200610     C                     MOVE *BLANKS   WNEDFT
789400200610     C                     MOVE *BLANKS   WOEDFT
789500200610     C                     MOVE *BLANKS   WNCPNR
789600200610     C                     MOVE *BLANKS   WOCPNR
789700200610     C                     MOVE *BLANKS   WNSTBS
789800200610     C                     MOVE *BLANKS   WNMATY
789900200610     C                     MOVE *BLANKS   WNSYBS
790000200610     C                     MOVE *BLANKS   WNNDVD
790100200610      *
790200200610     C                     MOVE *BLANKS   WSCORF
790300200610      *
790400200610     C                     MOVE *BLANKS   WALLOC  1
790500200610     C                     MOVE *BLANKS   WCUST   6
790600200610     C********** *NAMVAR   DEFN           MPHAS                                        220219 CCB020
790700200610     C********** *LOCK     IN   MPHAS                                                  220219 CCB020
790800200610     C**********           OUT  MPHAS                                                  220219 CCB020
790900200610      *                                                                                       CCB020
791000200610      ** CBFLAGQT Phase Check                                                                 CCB020
791100200610      *                                                                                       CCB020
791200200610     C                     MOVEL'CBC00100'@CBPRM  9                                           CCB020
791300200610     C                     MOVE '1'       @CBPRM                                              CCB020
791400200610     C                     CALL @CBPRM                                                        CCB020
791500200610     C                     PARM *BLANKS   COBST   4                                           CCB020
791600200610      *
791700200610      ***   LDA initialization
791800200610      *
791900200610     C           *NAMVAR   DEFN           LDA
792000200610     C           *LOCK     IN   LDA
792100200610     C                     MOVE *BLANKS   DBFILE
792200200610     C                     MOVE *BLANKS   DBKEY
792300200610     C                     Z-ADD*ZEROS    DBASE
792400200610     C                     MOVE 'SE7560'  DBPGM     P
792500200610     C                     OUT  LDA
792501200616     C           *NAMVAR   DEFN           SDSTAT                                            AR324886
792502200616     C                     IN   SDSTAT                                                      AR324886
792600200610      *
792700200610      ***  Call ZSFILE for Audit printer file SE7560AU
792800200610      *
792900200610     C                     Z-ADDSFNUMU    ZSNUM   60
793000200610     C                     CALL 'ZSFILE'
793100200610     C                     PARM           SEQ     5
793200200610     C                     PARM *BLANKS   @PARM   3
793300200610     C                     PARM           SFILEU
793400200610     C                     PARM           ZSNUM
793500200610     C                     PARM           ZSERR   1
793600200610      *
793700200610      ***  Program Ended abnormally
793800200610      *
793900200610     C           ZSERR     IFEQ 'Y'
794000200610     C           *LOCK     IN   LDA
794100200610     C                     Z-ADD26        DBASE            ***************
794200200610     C                     MOVE 'SE7560AU'DBFILE           * DB ERROR 26 *
794300200610     C           'ZSFILE R'CAT  'OUTINE'  DBKEY     P      ***************
794400200610     C                     MOVEL'SE7560'  DBPGM     P
794500200610     C                     OUT  LDA
794600200610     C                     EXSR *PSSR
794700200610     C                     ENDIF
794800200610      *
794900200610      ***  Counts for Audit
795000200610      *
795100200610     C                     Z-ADD0         W01CNT  50
795200200610     C                     Z-ADD0         W02CNT  50
795300200610     C                     Z-ADD0         W03CNT  50
795400200610     C                     Z-ADD0         W04CNT  50
795500200610     C                     Z-ADD0         W05CNT  50
795600200610     C                     Z-ADD0         W06CNT  50
795700200610     C                     Z-ADD0         WXXDEL  50                                          219634
795800200610      *
795900200610      ***  Access bank details
796000200610      *
796100200610     C                     CALL 'AOBANKR0'
796200200610     C                     PARM *BLANKS   @RTCD   7
796300200610     C                     PARM '*FIRST  '@OPTN   7
796400200610     C           SDBANK    PARM SDBANK    DSFDY
796500200610      *
796600200610     C           @RTCD     IFNE *BLANK
796700200610     C           *LOCK     IN   LDA
796800200610     C                     Z-ADD27        DBASE            ***************
796900200610     C                     MOVEL*BLANKS   DBFILE           * DB ERROR 27 *
797000200610     C                     MOVE 'SDBANKPD'DBFILE           ***************
797100200610     C                     MOVEL'*FIRST  'DBKEY     P
797200200610     C                     MOVEL'SE7560'  DBPGM     P
797300200610     C                     OUT  LDA
797400200610     C                     EXSR *PSSR
797500200610     C                     ENDIF
797600200610      *
797700200610      ***  Access Midas Module Details
797800200610      *
797900200610     C                     CALL 'AOMMODR0'
798000200610     C                     PARM *BLANKS   @RTCD   7
798100200610     C                     PARM '*FIRST  '@OPTN   7
798200200610     C           SDMMOD    PARM SDMMOD    DSFDY
798300200610      *
798400200610     C           @RTCD     IFNE *BLANK
798500200610     C           *LOCK     IN   LDA
798600200610     C                     Z-ADD28        DBASE            ***************
798700200610     C                     MOVEL*BLANKS   DBFILE           * DB ERROR 28 *
798800200610     C                     MOVE 'SDMMODPD'DBFILE           ***************
798900200610     C                     MOVEL'*FIRST  'DBKEY     P
799000200610     C                     MOVEL'SE7560'  DBPGM     P
799100200610     C                     OUT  LDA
799200200610     C                     EXSR *PSSR
799300200610     C                     ENDIF
799400200610      *                                                                   CPB001
799500200610      ** If Private Banking Module is installed.                          CPB001
799600200610     C           BGN4ST    IFEQ 'Y'                         Begin BGN4ST  CPB001
799700200610      *                                                                   CPB001
799800200610      ** Set up Replication Processing Indicator.                         CPB001
799900200610     C                     MOVE 'Y'       WUREPL  1                       CPB001
800000200610      *                                                                   CPB001
800100200610     C                     ENDIF                            End BGN4ST    CPB001
800200200610      *
800300200610      ***  Retrieve Trade Number Range (BVCTNR)
800400200610      *
800500200610     C                     CALL 'AOSTRDR0'
800600200610     C                     PARM *BLANKS   @RTCD   7
800700200610     C                     PARM '*FIRST  '@OPTN   7
800800200610     C           SDSTRD    PARM SDSTRD    DSSDY
800900200610      *
801000200610     C           @RTCD     IFNE *BLANK
801100200610     C           *LOCK     IN   LDA
801200200610     C                     Z-ADD29        DBASE            ***************
801300200610     C                     MOVEL*BLANKS   DBFILE           * DB ERROR 29 *
801400200610     C                     MOVE 'SDSTRDPD'DBFILE           ***************
801500200610     C                     MOVEL'*FIRST'  DBKEY     P
801600200610     C                     MOVEL'SE7560'  DBPGM     P
801700200610     C                     OUT  LDA
801800200610     C                     EXSR *PSSR
801900200610     C                     ENDIF
802000200610      *
802100200610     C**********           MOVE BVERCU    WWERCU  60                                          CSD027
802200200610     C                     MOVE BVERCU    WWERCU  6                                           CSD027
802300200610     C/COPY WNCPYSRC,SE7560C016
802400200610      *
802500200610      ***  Using Trade Mumber Range, chain LF/TNRAN to retrieve
802600200610      ***  next available reference (NTRN)
802700200610      *
802800200610     C                     Z-ADD0         WKREC
802900200610     C                     MOVEL*BLANKS   WKFILL
803000200610     C                     Z-ADDBVCTNR    WKRANG
803100200610      *
803200200610     C           KWTNRA    CHAINTNRANABF             89
803300200610      *
803400200610     C           *IN89     IFEQ *ON
803500200610     C           RECI      OREQ '*'
803600200610     C           *LOCK     IN   LDA
803700200610     C                     Z-ADD30        DBASE            ***************
803800200610     C                     MOVEL*BLANKS   DBFILE           * DB ERROR 30 *
803900200610     C                     MOVE 'TNRAN   'DBFILE           ***************
804000200610     C                     MOVELBVCTNR    DBKEY     P
804100200610     C                     MOVEL'SE7560'  DBPGM     P
804200200610     C                     OUT  LDA
804300200610     C                     EXSR *PSSR
804400200610     C                     ENDIF
804500200610      *
804600200610     C                     Z-ADDNTRN      WWNTR1  60       Next Trade Number
804700200610     C                     Z-ADDNTRN      WWNTR2  60       Next Depot Number
804800200610     C/COPY WNCPYSRC,SE7560C017
804900200610      *
805000200610      ** Retrieve Accruals/Profit Date form General Leg
805100200610      *
805200200610     C**********           CALL 'AOGELRR0'                                                    CGL029
805300200610     C                     CALL 'AOGELRR1'                                                    CGL029
805400200610     C                     PARM *BLANKS   @RTCD   7
805500200610     C                     PARM '*FIRST  '@OPTN   7
805600200610     C********** SDGELR    PARM SDGELR    DSFDY                                               CGL029
805700200610     C           SDGELR    PARM SDGELR    DSSDY                                               CGL029
805800200610      *
805900200610     C           @RTCD     IFNE *BLANK
806000200610     C           *LOCK     IN   LDA
806100200610     C                     Z-ADD31        DBASE            ***************
806200200610     C                     MOVEL*BLANKS   DBFILE           * DB ERROR 31 *
806300200610     C                     MOVE 'SDGELRPD'DBFILE           ***************
806400200610     C                     MOVEL'*FIRST  'DBKEY     P
806500200610     C                     MOVEL'SE7560'  DBPGM     P
806600200610     C                     OUT  LDA
806700200610     C                     EXSR *PSSR
806800200610     C                     ENDIF
806900200610      *
807000200610      ***  Check if S01445 is installed (Depot movement charges).
807100200610      *
807200200610     C                     CALL 'AOSARDR0'
807300200610     C                     PARM *BLANKS   @RTCD
807400200610     C                     PARM '*VERIFY' @OPTN
807500200610     C                     PARM 'S01445'  @SARC   6
807600200610      *
807700200610      ***  Set indicator if installed.
807800200610      *
807900200610     C           @RTCD     IFEQ *BLANK
808000200610     C                     MOVE 'Y'       S01445  1
808100200610     C                     ELSE
808200200610     C                     MOVE 'N'       S01445
808300200610     C                     END
808400200610      *
808500200610      ***  Check if S01401 is installed.
808600200610      *
808700200610     C                     CALL 'AOSARDR0'
808800200610     C                     PARM *BLANKS   @RTCD
808900200610     C                     PARM '*VERIFY' @OPTN
809000200610     C                     PARM 'S01401'  @SARC   6
809100200610      *
809200200610      ***  Open file LF/DPTMVDY1, LF/TRADSDY1 and set indicator if installed.
809300200610      *
809400200610     C           @RTCD     IFEQ *BLANK
809500200610     C                     OPEN DPTMVDY1
809600200610     C                     OPEN TRADSDY1
809700200610     C                     MOVE 'Y'       S01401  1
809800200610     C                     ELSE
809900200610     C                     MOVE 'N'       S01401
810000200610     C                     ENDIF
810100200610      *
810200200610      ***  Check if CEU002 is installed (EMU EURO Rates).
810300200610      *
810400200610     C                     CALL 'AOSARDR0'
810500200610     C                     PARM *BLANKS   @RTCD
810600200610     C                     PARM '*VERIFY' @OPTN
810700200610     C                     PARM 'CEU002'  @SARC
810800200610      *
810900200610      ***  Set indicator if installed.
811000200610      *
811100200610     C           @RTCD     IFEQ *BLANK
811200200610     C                     MOVE 'Y'       CEU002  1
811300200610     C                     ELSE
811400200610     C                     MOVE 'N'       CEU002
811500200610     C                     END
811600200610     C/COPY WNCPYSRC,SE7560C007
811700200610      *                                                                                       CER001
811800200610      ** When Lux Return feature is present, open files                                       CER001
811900200610      *                                                                                       CER001
812000200610     C           BGLRIN    IFEQ 'Y'                                                           CER001
812100200610     C                     OPEN SETRX1PD                                                      CER001
812200200610     C                     OPEN SEDPX1PD                                                      CER001
812300200610     C                     ENDIF                                                              CER001
812400200610      *                                                                                       CER001
812500200610      ** Check if ULX008 is installed                                                         CER001
812600200610      *                                                                                       CER001
812700200610     C                     MOVE 'N'       ULX008  1                                           CER001
812800200610     C                     CALL 'AOSARDR0'                                                    CER001
812900200610     C                     PARM *BLANKS   @RTCD                                               CER001
813000200610     C                     PARM '*VERIFY' @OPTN                                               CER001
813100200610     C                     PARM 'ULX008'  @SARC                                               CER001
813200200610      *                                                                                       CER001
813300200610      ** Set indicator if installed.                                                          CER001
813400200610      *                                                                                       CER001
813500200610     C           @RTCD     IFEQ *BLANK                                                        CER001
813600200610     C                     MOVE 'Y'       ULX008                                              CER001
813700200610     C                     OPEN ERLUICL1                                                      CER001
813800200610     C                     ENDIF                                                              CER001
813900200610      *                                                                   CAC005
814000200610      ***  Check if CAC005 is installed                                   CAC005
814100200610      *                                                                   CAC005
814200200610     C                     CALL 'AOSARDR0'                                CAC005
814300200610     C                     PARM *BLANKS   PRTCD   7                       CAC005
814400200610     C                     PARM '*VERIFY' POPTN   7                       CAC005
814500200610     C                     PARM 'CAC005'  PSARD   6                       CAC005
814600200610      *                                                                   CAC005
814700200610     C           PRTCD     IFEQ *BLANK                                    CAC005
814800200610     C                     MOVE 'Y'       CAC005  1                       CAC005
814900200610     C                     ELSE                                           CAC005
815000200610     C                     MOVE 'N'       CAC005                          CAC005
815100200610     C                     END                                            CAC005
815200200610      *                                                                   CSE017
815300200610      ** Check if CSE017 is installed                                     CSE017
815400200610      *                                                                   CSE017
815500200610     C                     CALL 'AOSARDR0'                                CSE017
815600200610     C                     PARM *BLANKS   PRTCD                           CSE017
815700200610     C                     PARM '*VERIFY' POPTN                           CSE017
815800200610     C                     PARM 'CSE017'  PSARD                           CSE017
815900200610      *                                                                   CSE017
816000200610     C           PRTCD     IFEQ *BLANK                                    CSE017
816100200610     C                     MOVE 'Y'       CSE017  1                       CSE017
816200200610     C                     ELSE                                           CSE017
816300200610     C                     MOVE 'N'       CSE017                          CSE017
816400200610     C                     END                                            CSE017
816500200610      *                                                                   CSE015
816600200610      ** Check if CSE015 is installed                                     CSE015
816700200610      *                                                                   CSE015
816800200610     C                     CALL 'AOSARDR0'                                CSE015
816900200610     C                     PARM *BLANKS   PRTCD                           CSE015
817000200610     C                     PARM '*VERIFY' POPTN                           CSE015
817100200610     C                     PARM 'CSE015'  PSARD                           CSE015
817200200610      *                                                                   CSE015
817300200610     C           PRTCD     IFEQ *BLANK                                    CSE015
817400200610     C                     MOVE 'Y'       CSE015  1                       CSE015
817500200610     C                     ELSE                                           CSE015
817600200610     C                     MOVE 'N'       CSE015                          CSE015
817700200610      *                                                                   CSE015
817800200610      ** Database Error (return code other than *NRF)                     CSE015
817900200610      *                                                                   CSE015
818000200610     C           PRTCD     IFNE '*NRF   '                                 CSE015
818100200610     C                     MOVEL'SCSARDPD'DBFILE                          CSE015
818200200610     C                     MOVEL'CSE015'  DBKEY                           CSE015
818300200610     C                     Z-ADD33        DBASE                           CSE015
818400200610     C                     OUT  LDA                                       CSE015
818500200610     C                     EXSR *PSSR                                     CSE015
818600200610     C                     ENDIF                                          CSE015
818700200610     C                     END                                            CSE015
818800200610      *                                                                                       207006
818900200610      ** Check if CSE029 is installed                                                         207006
819000200610      *                                                                                       207006
819100200610     C                     CALL 'AOSARDR0'                                                    207006
819200200610     C                     PARM *BLANKS   PRTCD                                               207006
819300200610     C                     PARM '*VERIFY' POPTN                                               207006
819400200610     C                     PARM 'CSE029'  PSARD                                               207006
819500200610      *                                                                                       207006
819600200610      ** Database Error (return code other than *NRF)                                         207006
819700200610      *                                                                                       207006
819800200610     C           PRTCD     IFNE '*NRF   '                                                     207006
819900200610     C           PRTCD     ANDNE*BLANKS                                                       207006
820000200610     C                     MOVEL'SCSARDPD'DBFILE                                              207006
820100200610     C                     MOVEL'CSE029'  DBKEY                                               207006
820200200610     C                     Z-ADD41        DBASE                                               207006
820300200610     C                     OUT  LDA                                                           207006
820400200610     C                     EXSR *PSSR                                                         207006
820500200610     C                     ENDIF                                                              207006
820600200610      *                                                                                       207006
820700200610     C           PRTCD     IFEQ *BLANKS                                                       207006
820800200610     C                     MOVE 'Y'       CSE029  1                                           207006
820900200610     C                     ELSE                                                               207006
821000200610     C                     MOVE 'N'       CSE029                                              207006
821100200610     C                     ENDIF                                                              207006
821200200610      *                                                                   CSE039
821300200610      ***  Check if CSE039 is installed                                   CSE039
821400200610      *                                                                   CSE039
821500200610     C                     CALL 'AOSARDR0'                                CSE039
821600200610     C                     PARM *BLANKS   PRTCD   7                       CSE039
821700200610     C                     PARM '*VERIFY' POPTN   7                       CSE039
821800200610     C                     PARM 'CSE039'  PSARD   6                       CSE039
821900200610      *                                                                   CSE039
822000200610     C           PRTCD     IFEQ *BLANK                                    CSE039
822100200610     C                     MOVE 'Y'       CSE039  1                       CSE039
822200200610     C                     ELSE                                           CSE039
822300200610     C                     MOVE 'N'       CSE039                          CSE039
822400200610     C                     END                                            CSE039
822500200610      *                                                                                       216944
822600200610      ** Check if CSE018 is installed                                                         216944
822700200610      *                                                                                       216944
822800200610     C                     CALL 'AOSARDR0'                                                    216944
822900200610     C                     PARM *BLANKS   PRTCD                                               216944
823000200610     C                     PARM '*VERIFY' POPTN                                               216944
823100200610     C                     PARM 'CSE018'  PSARD                                               216944
823200200610      *                                                                                       216944
823300200610     C           PRTCD     IFEQ *BLANK                                                        216944
823400200610     C                     MOVE 'Y'       CSE018  1                                           216944
823500200610     C                     ELSE                                                               216944
823600200610     C                     MOVE 'N'       CSE018                                              216944
823700200610     C                     ENDIF                                                              216944
823800200610      *                                                                                       CAS006
823900200610      ** Check if CAS006 is enabled.                                                          CAS006
824000200610      *                                                                                       CAS006
824100200610     C                     CALL 'AOSARDR0'                                                    CAS006
824200200610     C                     PARM *BLANKS   PRTCD                                               CAS006
824300200610     C                     PARM '*VERIFY' POPTN                                               CAS006
824400200610     C                     PARM 'CAS006'  PSARD                                               CAS006
824500200610     C           SCSARD    PARM SCSARD    DSFDY                                               CAS006
824600200610      *                                                                                       CAS006
824700200610     C                     MOVE 'N'       CAS006  1                                           CAS006
824800200610     C           PRTCD     IFEQ *BLANKS                                                       CAS006
824900200610     C                     MOVE 'Y'       CAS006                                              CAS006
825000200610     C                     ELSE                                                               CAS006
825100200610      *                                                                                       CAS006
825200200610     C           PRTCD     IFNE '*NRF'                                                        CAS006
825300200610     C                     MOVEL'SCSARDPD'DBFILE                                              CAS006
825400200610     C                     MOVEL'CAS006'  DBKEY                                               CAS006
825500200610     C                     Z-ADD42        DBASE                                               CAS006
825600200610     C                     OUT  LDA                                                           CAS006
825700200610     C                     EXSR *PSSR                                                         CAS006
825800200610     C                     ENDIF                                                              CAS006
825900200610      *                                                                                       CAS006
826000200610     C                     ENDIF                                                              CAS006
826100200610      *                                                                                       234829
826200200610      ** Check if CGL031 is installed                                                         234829
826300200610      *                                                                                       234829
826400200610     C                     CALL 'AOSARDR0'                                                    234829
826500200610     C                     PARM *BLANKS   PRTCD   7                                           234829
826600200610     C                     PARM '*VERIFY' POPTN   7                                           234829
826700200610     C                     PARM 'CGL031'  PSARD   6                                           234829
826800200610      *                                                                                       234829
826900200610     C           PRTCD     IFEQ *BLANKS                                                       234829
827000200610     C                     MOVE 'Y'       CGL031  1                                           234829
827100200610     C                     ENDIF                                                              234829
827200200610     C/COPY WNCPYSRC,SEH00027
827300200610      *
827400200610      ***  Define necessary KLIST'S
827500200610      *
827600200610      ***  Access to LF/SECOALL5
827700200610      *
827800200610     C           KWCOAL    KLIST
827900200610     C                     KFLD           WKCORF
828000200610     C                     KFLD           WKBRCD
828100200610     C                     KFLD           WKDDPT
828200200610      *
828300200610      ***  Access to LF/SECOALL3
828400200610      *
828500200610     C           KWCOA3    KLIST
828600200610     C                     KFLD           WKCORF
828700200610     C                     KFLD           WKOPTN
828800200610     C                     KFLD           WKBRCD
828900200610     C                     KFLD           WKDDPT
829000200610     C                     KFLD           WKCOTP
829100200610     C                     KFLD           WKBOOK
829200200610     C                     KFLD           WKCNUM
829300200610     C                     KFLD           WKPTFR
829400200610      *
829500200610      ***  Access to LF/TNRAN
829600200610      *
829700200610     C           KWTNRA    KLIST
829800200610     C                     KFLD           WKREC
829900200610     C                     KFLD           WKFILL
830000200610     C                     KFLD           WKRANG
830100200610      *
830200200610      ***  Access to LF/POSET1
830300200610      *
830400200610     C           KWPOSE    KLIST
830500200610     C                     KFLD           WKBRCD
830600200610     C                     KFLD           WKSESN
830700200610     C                     KFLD           WKDDPT
830800200610     C                     KFLD           WKALEF
830900200610     C                     KFLD           WKEVTY
831000200610     C                     KFLD           WKPTFR
831100200610     C                     KFLD           WKTNLU
831101200616      *                                                                                     AR324886
831102200616     C           PSAUTH    KLIST                                                            AR324886
831103200616     C                     KFLD           PBCA                                              AR324886
831104200616     C                     KFLD           PSSH                                              AR324886
831105200616     C                     KFLD           PCPY                                              AR324886
831106200616     C                     KFLD           PDUD                                              AR324886
831107200616     C                     KFLD           PEVT                                              AR324886
831108200616     C                     KFLD           PTFR                                              AR324886
831109200616     C                     KFLD           TNLU                                              AR324886
831110200616     C                     KFLD           TXBS                                              AR324886
831111200616     C                     KFLD           BNFO                                              AR324886
831112200616     C                     KFLD           EXCD                                              AR324886
831200200610      *
831300200610      ***  Access to LF/DPTMVDY1
831400200610      *
831500200610     C           KWDPMV    KLIST
831600200610     C                     KFLD           WKSESN
831700200610     C                     KFLD           WKTRRF
831800200610      *
831900200610      ***  Access to LF/SEPCCP
832000200610      *
832100200610     C           KWSEPC    KLIST
832200200610     C                     KFLD           WKDPBN
832300200610     C                     KFLD           WKBRCA
832400200610     C                     KFLD           WKDPSS
832500200610      *
832600200610      ***  Access to LF/SEPCBD
832700200610      *
832800200610     C           KWPCBD    KLIST
832900200610     C                     KFLD           WKTDBK
833000200610     C                     KFLD           WKBRCA
833100200610     C                     KFLD           WKSESN
833200200610     C                     KFLD           WKMKTI
833300200610      *
833400200610      ***  Access to LF/PMPORTPD
833500200610      *
833600200610     C           KWPTFR    KLIST
833700200610     C                     KFLD           WNCNUM
833800200610     C                     KFLD           WKPTFR
833900200610      *
834000200610      ***  Access to LF/INVTP
834100200610      *
834200200610     C           KWINV     KLIST
834300200610     C                     KFLD           WKNMCY
834400200610     C                     KFLD           WKSITP
834500200610      *
834600200610      ***  Access to all logical file CO
834700200610      *
834800200610     C           KWCOOP    KLIST
834900200610     C                     KFLD           WKCOR2
835000200610     C                     KFLD           WKOPT2
835100200610      *
835200200610      ***  Access to LF/CPOSC
835300200610      *
835400200610     C           KWCOSC    KLIST
835500200610     C                     KFLD           WCBRCD
835600200610     C                     KFLD           WCCNUM
835700200610     C                     KFLD           WCSESN
835800200610      *
835900200610      ***  Access to LF/CPOSC
836000200610      *
836100200610     C           KWBKPH    KLIST
836200200610     C                     KFLD           WKSESN
836300200610     C                     KFLD           WKBRCA
836400200610     C                     KFLD           WKBOOK
836500200610     C                     KFLD           WKMKTI
836600200610     C                     KFLD           WKTDVD                          152589
836700200610     C*                                                                   CSE039
836800200610     C*  - MOVEMENTS STATUS FILE                                          CSE039
836900200610     C*                                                                   CSE039
837000200610     C           KSEMV     KLIST                                          CSE039
837100200610     C                     KFLD           KTDRF   6                       CSE039
837200200610     C                     KFLD           KTRTY   1                       CSE039
837300200610     C                     KFLD           KNTDT   50                      CSE039
837400200610     C/COPY WNCPYSRC,SE7560C014
837500200610      *
837600200610     C                     MOVE 'N'       WWDATA  1        Data Read Indicator
837700200610      *
837800200610      ***  Calculate ECD as per Standard Midas Processing
837900200610      *
838000200610     C                     Z-ADDBKAPDT    ZZAPDT
838100200610     C                     Z-ADDBJDNWD    ZZDNWD
838200200610     C                     EXSR ZEVCD
838300200610     C                     MOVE ECD       WWECD
838400200610      *
838500200610     C                     ENDSR
838600200610     ******************************************************************
838700200610      /EJECT
838800200610      *****************************************************************
838900200610      *  *PSSR  - Dump routine in case of error                       *
839000200610      *  ------                                                       *
839100200610      *****************************************************************
839200200610      *
839300200610     C           *PSSR     BEGSR
839400200610      *
839500200610     C           WWRUN     IFNE 'Y'
839600200610     C                     DUMP
839700200610     C                     MOVE 'Y'       WWRUN   1
839800200610     C                     ENDIF
839900200610      *
840000200610     C           DBASE     IFGT 1
840100200610     C                     WRITEHEADAU
840200200610     C                     WRITEDBERROR
840300200610     C                     ENDIF
840400200610      *
840500200610     C                     MOVE *ON       *INU7
840600200610     C                     MOVE *ON       *INU8
840700200610     C                     MOVE *ON       *INLR
840800200610     C                     RETRN
840900200610      *
841000200610     C                     ENDSR
841100200610      **********************************************************************
841200200610      *
841300200610     C********************************************************************
841400200610     C*                                                                  *
841500200610     C*  ZAVPR2 based on SR/ZAVPR standard subroutine                    *
841600200610     C*  ZAVPR- SUBROUTINE TO CALCULATE AVERAGE PRICE                    *
841700200610     C*                                                                  *
841800200610     C*  INPUT  -                   ZNOML (15,0) NOMINAL                 *
841900200610     C*                             ZAPNC (15,0) AP NUMERATOR            *
842000200610     C*           FROM CURRENCIES   ZCDP  (1,0) NOM.CCY DEC.PLS.         *
842100200610     C*           FROM SECTYD     - NMDP  (1,0) NOMINAL DEC. PLS.        *
842200200610     C*                             POWER8 ARRAY MUST BE INCLUDED IN     *
842300200610     C*                             CALLING PROGRAM                      *
842400200610     C*                                                                  *
842500200610     C*  OUTPUT - ZPRC   (16,9) AVERAGE PRICE                            *
842600200610     C*                                                                  *
842700200610     C*  CALLS - NONE                                                    *
842800200610     C**                                                                 *
842900200610     C********************************************************************
843000200610     C*
843100200610     C           ZAVPR2    BEGSR                           **ZAVPR BEGSR
843200200610     C*
843300200610     C*** Define fields
843400200610     C*
843500200610     C                     Z-ADDZPRC      ZPRC   169
843600200610     C                     Z-ADDZAPNC     ZAPNC  150
843700200610     C                     Z-ADDZWK150    ZWK150 150
843800200610     C                     Z-ADDZDF154    ZDF154 154
843900200610     C                     Z-ADDZNOML     ZNOML  150
844000200610     C                     Z-ADDDC        DC      10
844100200610     C                     Z-ADDZCDP      ZCDP    10
844200200610     C*
844300200610     C*** Put AP Numerator into Nominal ccy dec pls
844400200610     C*
844500200610     C           5         ADD  ZCDP      DC      10
844600200610     C                     SUB  NMDP      DC
844700200610     C           DC        IFLT 5
844800200610     C           ZAPNC     DIV  POWER8,DC ZAPNC
844900200610     C                     END
845000200610     C*
845100200610     C*** Price basis 'P'
845200200610     C*
845300200610     C           SPBS      IFEQ 'P'
845400200610     C                     MULT 100       ZAPNC
845500200610     C                     END
845600200610     C*
845700200610     C           ZAPNC     DIV  ZNOML     ZPRC      H
845800200610     C*
845900200610     C*** Prevent High Order Truncation
846000200610     C*
846100200610     C           ZPRC      MULT ZNOML     ZWK150    H
846200200610     C           ZAPNC     SUB  ZWK150    ZWK150
846300200610     C           ZWK150    DIV  ZNOML     ZDF154    H
846400200610     C*
846500200610      *** Calculate price and adjust figures (if needed).
846600200610      *
846700200610     C           DC        IFGE 5
846800200610     C           ZPRC      DIV  POWER8,DC ZPRC      H
846900200610     C           ZDF154    DIV  POWER8,DC ZDF154    H
847000200610     C                     END
847100200610     C*
847200200610     C                     ADD  ZDF154    ZPRC
847300200610     C*
847400200610     C                     ENDSR                           *** ENDSR    ***
847500200610     C*
847600200610     C*****************************************************************
847700200610      /EJECT                                                              CPB001
847800200610      *****************************************************************   CPB001
847900200610      *                                                               *   CPB001
848000200610      *  REPLIC - Subroutine to set up Replication Indicator.         *   CPB001
848100200610      *                                                               *   CPB001
848200200610      *  Called by : #WDPMV                                           *   CPB001
848300200610      *                                                               *   CPB001
848400200610      *  Calls     : None                                             *   CPB001
848500200610      *                                                               *   CPB001
848600200610      *****************************************************************   CPB001
848700200610     C           REPLIC    BEGSR                           ** REPLIC SR **CPB001
848800200610      *                                                                   CPB001
848900200610      **  Initialize Replication Indicator.                               CPB001
849000200610     C                     MOVE *BLANK    REPI                            CPB001
849100200610      *                                                                   CPB001
849200200610      **  Access Customer Details by using Access Object,                 CPB001
849300200610      **  to retrieve Private Banking Customer Indicator.                 CPB001
849400200610     C                     MOVE *BLANKS   @CUST                           CPB001
849500200610     C                     MOVELDPBN      @CUST                           CPB001
849600200610     C                     CALL 'AOCUSTR1'                                CPB001
849700200610     C                     PARM '*MSG   ' @RTCD   7                       CPB001
849800200610     C                     PARM '*KEY   ' @OPTN   7                       CPB001
849900200610     C                     PARM           @CUST  10                       CPB001
850000200610     C                     PARM           @KYST   7                       CPB001
850100200610     C           SDCUST    PARM SDCUST    DSLDY                           CPB001
850200200610      *                                                                   CPB001
850300200610      **  If Customer Details do not exist, handle Database Error.        CPB001
850400200610     C           @RTCD     IFNE *BLANK                     BEGIN @RTCD    CPB001
850500200610     C                     MOVEL'SDCUSTPD'DBFILE           ***************CPB001
850600200610     C                     MOVEL@CUST     DBKEY            * DB ERROR 91 *CPB001
850700200610     C                     Z-ADD21        DBASE            ***************CPB001
850800200610     C                     EXSR *PSSR                                     CPB001
850900200610      *                                                                   CPB001
851000200610     C                     ENDIF                           End @RTCD      CPB001
851100200610      *                                                                   CPB001
851200200610      **  If Customer is a Private Banking Customer, set up               CPB001
851300200610      **  Replication Indicator.                                          CPB001
851400200610     C           BBPRBA    IFEQ 'Y'                        Begin BBPRBA   CPB001
851500200610     C********** PHASE     ANDNE'A'                                                    220219 CCB020
851600200610     C           COBST     ANDEQ'*YES'                                                        CCB020
851700200610     C                     MOVE 'Y'       REPI                            CPB001
851800200610      *                                                                   CPB001
851900200610     C                     ENDIF                           End BBPRBA     CPB001
852000200610      *                                                                   CPB001
852100200610     C                     ENDSR                                          CPB001
852200200610      *****************************************************************   CPB001
852300200610     C/EJECT                                                                                  234829
852400200610      *****************************************************************                       234829
852500200610      *                                                               *                       234829
852600200610      * GOPD - Get Original Purchase Date.                            *                       234829
852700200610      *                                                               *                       234829
852800200610      *****************************************************************                       234829
852900200610      *                                                                                       234829
853000200610     C           GOPD      BEGSR                                                              234829
853100200610      *                                                                                       234829
853200200610     C           DPMV      IFEQ 'WI'                                                          234829
853300200610     C                     Z-ADDDPMD      WDPMD                                               234829
853400200610     C                     ELSE                                                               234829
853500200610     C                     Z-ADDDPDO      WDPMD                                               234829
853600200610     C                     ENDIF                                                              234829
853700200610      *                                                                                       234829
853800200610     C                     CALL 'SEVOPDT'                                                     234829
853900200610     C                     PARM *BLANKS   PRETC  10                                           234829
854000200610     C                     PARM *BLANKS   DDOPDT  7                                           234829
854100200610     C                     PARM           DPMV                                                234829
854200200610     C                     PARM           DPSS                                                234829
854300200610     C                     PARM           DPBN                                                234829
854400200610     C                     PARM           DPBA                                                234829
854500200610     C                     PARM           BJRDNB                                              234829
854600200610     C                     PARM           BJDFIN                                              234829
854700200610     C                     PARM           DPVD                                                234829
854800200610     C                     PARM           WDPMD   50                                          234829
854900200610     C                     PARM           DPNA                                                234829
855000200610     C                     PARM           PTFR                                                234829
855100200610     C                     PARM           @FNXA                                               234829
855200200610     C                     PARM           @MIXA                                               234829
855300200610     C                     PARM           @MDXA                                               234829
855400200610     C                     PARM           WOPDOK  1                                           234829
855500200610     C                     PARM           OPDT                                                234829
855600200610      *                                                                                       234829
855700200610     C                     ENDSR                                                              234829
855800200610      *****************************************************************                       234829
855900200610     C/EJECT                                                                                  234829
856000200610      *****************************************************************                       234829
856100200610      *                                                               *                       234829
856200200610      * GFSPR - Get Fiscal Price                                      *                       234829
856300200610      *                                                               *                       234829
856400200610      *****************************************************************                       234829
856500200610      *                                                                                       234829
856600200610     C           GFSPR     BEGSR                                                              234829
856700200610      *                                                                                       234829
856800200610     C                     Z-ADD0         WFSPI                                               234829
856900200610     C                     MOVE NMCY      NMCYA                                               235041
857000200610     C                     Z-ADDDPNA      WNOML                                               235041
857100200610     C                     MOVE @DPBN     XDPBN   6                                           235041
857200200610      *                                                                                       234829
857300200610     C                     CALL SEVFSP                                                        234829
857400200610     C                     PARM *BLANKS   PRETC  10                                           234829
857500200610     C                     PARM           PFSPR  16                                           234829
857600200610     C                     PARM           @SECTY                                              234829
857700200610     C                     PARM           OPDT                                                234829
857800200610     C                     PARM           BJDFIN                                              234829
857900200610     C                     PARM           WFSPI   10                                          234829
858000200610     C                     PARM 'C'       SCUMEX  1                                           234829
858100200610     C***********          PARM           DPNA                                                235041
858200200610     C                     PARM           WNOML  150                                          235041
858300200610     C                     PARM           WNNBDP                                              234829
858400200610     C                     PARM           DPMV                                                234829
858500200610     C********             PARM           @DPBN                                               235041
858600200610     C                     PARM           XDPBN                                               235041
858700200610     C                     PARM           DPBA                                                234829
858800200610     C                     PARM *BLANKS   WDOPDT  6                                           234829
858900200610     C                     PARM           PTFR                                                234829
859000200610     C                     PARM           @FNXA                                               234829
859100200610     C                     PARM           @MIXA                                               234829
859200200610     C                     PARM           @MDXA                                               234829
859300200610     C                     PARM           WFSPOK  1                                           234829
859400200610     C                     PARM           FSPR                                                234829
859500200610     C                     PARM           FSPP                                                234829
859600200610      *                                                                                       234829
859700200610     C                     ENDSR                                                              234829
859800200610      *****************************************************************                       234829
859900200610     C/EJECT                                                                                  234829
860000200610      *****************************************************************                       234829
860100200610      *                                                               *                       234829
860200200610      * GOPI - Get Original Purchase Interest                         *                       234829
860300200610      *                                                               *                       234829
860400200610      *****************************************************************                       234829
860500200610      *                                                                                       234829
860600200610     C           GOPI      BEGSR                                                              234829
860700200610      *                                                                                       234829
860800200610     C                     MOVE NMCY      NMCYA                                               235041
860900200610     C                     MOVE @DPBN     XDPBN   6                                           235041
861000200610     C                     CALL SEVOPI                                                        234829
861100200610     C                     PARM *BLANKS   PRETC  10                                           234829
861200200610     C                     PARM *BLANKS   EOPIN  14                                           234829
861300200610     C                     PARM           DPMV                                                234829
861400200610     C********             PARM           @DPBN                                               235041
861500200610     C                     PARM           XDPBN                                               235041
861600200610     C                     PARM 'C'       SCUMEX  1                                           234829
861700200610     C                     PARM *BLANKS   WDOPDT                                              234829
861800200610     C                     PARM           DPSS                                                234829
861900200610     C                     PARM           DPNA                                                234829
862000200610     C                     PARM           OPDT                                                234829
862100200610     C                     PARM           DPBA                                                234829
862200200610     C                     PARM           BJDFIN                                              234829
862300200610     C                     PARM           @SECTY                                              234829
862400200610     C                     PARM           WNNBDP                                              234829
862500200610     C                     PARM 'Y'       WDFLT   1                                           234829
862600200610     C                     PARM *BLANKS   WVALD   1                                           235041
862700200610     C                     PARM           PTFR                                                234829
862800200610     C                     PARM           @FNXA                                               234829
862900200610     C                     PARM           @MIXA                                               234829
863000200610     C                     PARM           @MDXA                                               234829
863100200610     C                     PARM           WOPIOK  1                                           234829
863200200610     C                     PARM           OPIN                                                234829
863300200610     C                     PARM           ACIN                                                234829
863400200610      *                                                                                       234829
863500200610     C                     ENDSR                                                              234829
863600200610      *****************************************************************                       234829
863601200616      /EJECT                                                                                AR324886
863602200616      *****************************************************************                     AR324886
863603200616     C           PSAUDT    BEGSR                                                            AR324886
863604200616      *                                                                                     AR324886
863605200616     C           PSAUTH    CHAINPSAUT                80                                     AR324886
863606200616     C           *IN80     IFEQ *OFF                                                        AR324886
863607200616     C                     MOVE RECI      PARECI                                            AR324886
863608200616     C                     MOVE PALUSR    PAPUSR                                            AR324886
863609200616     C                     MOVE PALCD     PAPCD                                             AR324886
863610200616     C                     MOVE PALCTP    PAPCTP                                            AR324886
863611200616     C           LIBR      CAT  'OWNER'   PALUSR                                            AR324886
863612200616     C                     MOVE LCD       PALCD                                             AR324886
863613200616     C                     MOVE CHTP      PALCTP                                            AR324886
863614200616     C                     UPDATPSAUTDF                                                     AR324886
863615200616     C                     ENDIF                                                            AR324886
863616200616      *                                                                                     AR324886
863617200616     C                     ENDSR                                                            AR324886
863618200616      *****************************************************************                     AR324886
863700200610      *
863800200610      ***  Compile with 2 Levels /COPY
863900200610     C/COPY WNCPYSRC,SE7560C008
864000200610      *
864100200610     C/COPY ZSRSRC,ZALIGNZ2
864200200610     C/COPY ZSRSRC,ZDAYSZ2
864300200610     C/COPY ZSRSRC,ZDATE1Z2
864400200610     C/COPY ZSRSRC,ZDATE2Z2
864500200610     C/COPY ZSRSRC,ZASIGNZ2
864600200610     C/COPY ZSRSRC,ZEVCDZ1
864700200610     C/COPY ZSRSRC,ZPCINTZ1
864800200610     C/COPY ZSRSRC,ZAPNUM
864900200610     C/COPY ZSRSRC,ZPRCIZ1
865000200610     C/COPY ZSRSRC,ZPRCOZ1                                                151356
865100200610     C/COPY ZSRSRC,ZYLDZ2
865200200610     C/COPY ZSRSRC,ZNCDZ3
865300200610     C/COPY ZSRSRC,ZLCDZ1
865400200610     C/COPY ZSRSRC,ZDYYRZ3
865500200610     C/COPY ZSRSRC,ZRATEZ1
865600200610     C/COPY ZSRSRC,ZXRATEZ1
865700200610     C/COPY ZSRSRC,ZCOTRZ1
865800200610     C/COPY ZSRSRC,ZYLDIZ1
865900200610     C/COPY ZSRSRC,ZYLDOZ1                                                151356
866000200610     C/COPY ZSRSRC,ZACCRZ1
866100200610     C/COPY ZSRSRC,ZACCZZ1
866200200610     C/COPY ZSRSRC,ZCNSDZ1
866300200610     C/COPY ZSRSRC,ZCALCD
866400200610     C/COPY ZSRSRC,ZBKDT
866500200610     C/COPY ZSRSRC,ZACCH
866600200610     C/COPY ZSRSRC,ZCCYCN
866700200610     C/COPY ZSRSRC,ZTNLU1Z2
866800200610      /EJECT
866900200610**  POWER8 - ARRAY OF POWERS FOR CURRENCY CONVERSION
86700020061000000001
86710020061000000010
86720020061000000100
86730020061000001000
86740020061000010000
86750020061000100000
86760020061001000000
86770020061010000000
867800200610**  POWER - ARRAY OF POWERS FOR CURRENCY CONVERSION
8679002006100000001
8680002006100000010
8681002006100000100
8682002006100001000
8683002006100010000
8684002006100100000
8685002006101000000
868600200610**   ZF29 DAY NOS OF FEB 29 TO 2096 (INCLUDING 2000)
8687002006100006001521029820444305904073650882610287117481320914670161311759219053
8688002006102051421975234362489726358278192928030741322023366335124365853804639507
86890020061040968424294389045351
869000200610**   ZYDY - YEARS IN DAYS CUMULATIVE, FOUR YEAR SPAN
8691002006100366073110961461
869200200610**   ZMDY - MONTHS IN DAYS CUMULATIVE THROUGH YEAR
869300200610000031059090120151181212243273304334365
869400200610**   ZMNM - MONTHS SHORT NAMES
869500200610JANFEBMARAPRMAYJUNJULAUGSEPOCTNOVDEC
869600200610** STAMP - Dummy timestamp                                                                    CPK015
8697002006100001-01-01-00.00.00.000000                                                                    CPK015
869800200610**  CPY@
869900200610(c) Finastra International Limited 2001
870000200610**  POWER9 - ARRAY OF POWERS FOR CURRENCY CONVERSION                      136931
870100200610000000001
870200200610000000010
870300200610000000100
870400200610000001000
870500200610000010000
870600200610000100000
870700200610001000000
870800200610010000000
870900200610100000000
871000200610**  TMMP  - Array of TIMESTAMP
8711002006100001-01-01-00.00.00.000000
