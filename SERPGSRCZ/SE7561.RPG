     H        1
      *****************************************************************
/*STD *  RPGBASE                                                      *
/*EXI *  TEXT('Midas SE CO Produce positions settl. and acc. keys')   *
      *****************************************************************
      *                                                               *
      *  Midas - Securities Trading Module                            *
      *                                                               *
      *  RPG/SE7561 - SE CO Generate Positions Settlement             *
      *               and Account Keys                                *
      *                                                               *
      *  Function:  This Program Generate Positions Settlements       *
      *  (COB)      and Account Keys                                  *
      *                                                               *
      *  Called by: SEC7561 - Generate Positions Settlements          *
      *                       and Account Keys                        *
      *                                                               *
      *  (c) Finastra International Limited 2001                      *
      *                                                               *
      *  Last Amend No. HUT105             Date 08Apr20               *
      *  Prev Amend No. CER050             Date 16Jun19               *
      *                 MD046248           Date 27Oct17               *
      *                 215959             Date 21Mar16               *
      *                 CER071             Date 01Aug16               *
      *                 CGL165             Date 17Feb15               *
      *                 CER070             Date 19Aug14               *
      *                 CLE134             Date 01Aug12               *
      *                 CLE148             Date 23Jul12               *
      *                 AR888911           Date 26Jan12               *
      *                 AR864714B          Date 28Mar12               *
      *                 AR875302           Date 09Jan12               *
      *                 AR879983           Date 21Dec11               *
      *                 AR853119           Date 24Nov11               *
      *                 CSW210             Date 04May10               *
      *                 CER059             Date 19Jul10               *
      *                 BUG26839           Date 05Jan10               *
      *                 CER045             Date 20Jul09               *
      *                 CER054             Date 07Apr09               *
      *                 BUG23123           Date 09Mar09               *
      *                 BUG22911           Date 17Feb09               *
      *                 CER048             Date 19May08               *
      *                 CER020             Date 19May08               *
      * Bank Fusion Midas 1.4 Base -----------------------------------*
      * Midas Plus 1.4 Base 04 ---------------------------------------*
      * Midas Plus 1.4 Base ------------------------------------------*
      *                 219566             Date 09Feb07               *
      * Midas Plus 1.3 ----------- Base ------------------------------*
      *                 219688             Date 11Oct06               *
      *                 CSD031             Date 10Apr06               *
      *                 CSD027A            Date 05May06               *
      *                 CSD027             Date 09Dec05               *
      *                 232543             Date 01Apr05               *
      *                 CGL035             Date 01Mar05               *
      *                 CGL031             Date 05Jul04               *
      *                 CSE071             Date 19Jul05               *
      *                 215575             Date 13Mar03               *
      *                 BUG3122            Date 17Jul04               *
      *                 CLE025             Date 20Oct03               *
      *                 CGL029             Date 01Sep03               *
      *                 CGL020             Date 12Dec02               *
      * Midas Release 4.01.02 ----------------------------------------*
      *                 173581             Date 30Apr02               *
      *                 200789             Date 11Apr02               *
      * Midas Release 4.01 -------------------------------------------*
      *                 CSE034             Date 24Apr02               *
      * Midas Release 4 --------------- Base -------------------------*
      *                 CSE028             Date 06Jun01               *
      *                 190204             Date 31May01               *
      * Midas DBA 3.04 -----------------------------------------------*
      *                 CSE023             Date 31Aug00               *
      * Midas DBA 3.03 -----------------------------------------------*
      *                 CSE020             Date 21Mar00               *
      * Midas DBA 3.02 -----------------------------------------------*
      *                 CPB001             Date 08Sep99               *
      * Midas DBA 3.01 -----------------------------------------------*
      *                 163497             Date 03Aug99               *
      *                 161746             Date 12Jul99               *
      * Midas DBA 3.00 ---------------- Base -------------------------*
      *                 153674             Date 20Jan99               *
      *                 153091             Date 11Jan99               *
      *                 151157             Date 29Dec98               *
      *                 151658             Date 28Dec98               *
      *                 150165             Date 15Dec98               *
      *                 136428             Date 15Jun98               *
      *                 135691             Date 04Feb98               *
      *                 CEU017             Date 05Mar98               *
      *                 CSE007   *CREATE   Date 19Jan98               *
      *                                                               *
      *---------------------------------------------------------------*
      *                                                               *
      *  HUT105 - Bulk Position Settlement Authorisation              *
      *           (Upgrade AR324886 to FM2.1 S22 - intrusively)       *
      *  AR324886 - Implement 4-eyes processing in Position           *
      *             Settlement Maintenance.                           *
      *  CER050 - Annualised Percentage Rate (Recompile)              *
      *  MD046248 - Finastra Rebranding                               *
      *  215959 - Truncation error on event amount in SE2450P3.       *
      *           Recompiled due to changes in PF/SEKEYD.             *
      *         - Applied for MD-37439.                               *
      *  CER071 - BAIS - Legal Form field (Recompile)                 *
      *  CGL165 - Dual Withholding Tax (Recompile)                    *
      *  CER070 - BuBa Reporting / BAIS V.1.16.0 (Recompile)          *
      *  CLE134 - Past Due Call Loan Processing (Recompile)           *
      *  CLE148 - Alpha Loan Reference (Recompile)                    *
      *  AR888911 - In reversing a deal, REV column in Stamp Tax      *
      *             Movements Enquiry is not changing from N to Y     *
      *             (Recompile)                                       *
      *           - Applied for AR944923                              *
      *  AR864714B - No movement is posted in Stamp Tax Movement      *
      *              enquiry for Position Settlements                 *
      *            - Applied for AR942839                             *
      *  AR875302 - Position settlement generated calculates Stamp    *
      *             Tax even when it is not stamp tax liable          *
      *  AR879983 - Add stamp tax exchange rate (Recompile)           *
      *  AR853119 - Position settlements generated from corporate     *
      *             action did not calculate stamp tax.               *
      *  CSW210 - SWIFT 2010 Changes                                  *
      *  CER059 - German Feature Upgrade to Delhi                     *
      *  BUG26839 - JA1_Threshold limit of the main joint customer was*
      *             utilized by the member                            *
      *  CER045 - German Features - Reporting Bundesbank (Recompile)  *
      *  CER054 - German Features - Church Tax (Recompile)            *
      *  BUG23123 - Report: Does not show Retail Account Number       *
      *                     Date is not Midas Standard Date           *
      *                     Period should be actual int. calc. period *
      *                     Secondary Tax amount is not printed       *
      *                     Added field TSSLID                        *
      *                     (Recompile)                               *
      *  BUG22911 - Changes for Correct Tax Calculation               *
      *  CER048 - German Features - Taxes                             *
      *  CER020 - Enhanced Rollover Window: Upgrade FGE089 to         *
      *           Midas Plus (Recompile)                              *
      *  219566 - Default the settlement account if no account for    *
      *           the specified portfolio. This is a LUX local fix    *
      *           so conditioned in core using new system value       *
      *           "UseDefaultSettAccnt" in SDSVALPD.                  *
      *  219688 - Settlement account not correctly retrieved          *
      *           If the customer is a portfolio one, access first    *
      *           with the account code defined as settlement in      *
      *           SDSECSPD. If not found use the PMACCNL0 account.    *
      *  CSD031 - Enhanced Centralised Static Data (Recompile)        *
      *  CSD027A - Conversion Of Customer Number to Alpha             *
      *  CSD027 - Conversion Of Customer Number to Alpha              *
      *  232543 - Fix to CGL031 (Recompile)                           *
      *  CGL035 - EUSD Upgrade to Midasplus                           *
      *  CGL031 - Taxation of Savings Income                          *
      *  CSE071 - Multiple Holidays Re Securities (recompile)         *
      *  215575 - Load Corporate Reference as parameter.              *
      *  BUG3122 - Recompiled due to changes in SDSECSPD.             *
      *  CLE025 - Credit Lines (Recompile)                            *
      *  CGL029 - Increase Account Code to 10 digits                  *
      *  CGL020 - Midas Compliance Watch - Anti-Money Laundering      *
      *  173581 - Complete 153091 : Even if trades, depots movements  *
      *           and pos settl are already generated, enter in       *
      *           S/R #PDPRD to manage status correctly               *
      *  200789 - The commission code on CA position settlement is    *
      *           generated but no commission amount calculated.      *
      *           Amended the program to calculate the charge and     *
      *           commission amounts independently.                   *
      *  CSE034 - Standard Settlement Instruction improvements        *
      *  CSE028 - Standing Settlement Instructions Enhancement.       *
      *  190204 - Recompiled due to changes in PF/SECODVPD.           *
      *  CSE023 - Treaty Withholding Tax                              *
      *  CSE020 - Corporate Actions Domino Effect Processing          *
      *           (Recompiled due to changes in PF/SECORFPD)          *
      *  CPB001 - 'Private Banking' Module                            *
      *  163497 - For customer account keys, use customer reference   *
      *           and not issuer to access securities trading customer*
      *           details. As issuer is not necessary a SE customer,  *
      *           in this case no classification is set in the key and*
      *           result in a missing account key                     *
      *  161746 - Average Price Option 'I' has been added in SE7505.  *
      *           (SECORGPD/MFAVOP)                                   *
      *           Manage it as option 'C' in this program and in      *
      *           SE7560 SE7561 SE7590 SE7591 SE7505                  *
      *           ( SEINS-BBN20520 & GBSEUSRMSG/CO00175 changed too ) *
      *  153674 - Complete Fix 151658 for other Corporate Action Type *
      *           than 'CC' (EMU - Currency Change).                  *
      *           Incorrect Pay/Receive Indicator on Position Settl.  *
      *           for Customers                                       *
      *  153091 - Review setup of Status 'C'omplete                   *
      *  151157 - Position 6 for Depot Account Keys must be 'X'       *
      *  151658 - Incorrect Pay/Receive Indicator on Position Settl.  *
      *           for Customers                                       *
      *  150165 - No Position Settlements generated for Securities    *
      *           which have Cash Compensation                        *
      *  136428 - Recompile due to addition of Days Basis and Divisor *
      *           Basis field in SECORBPD.                            *
      *  135691 - EMU SE Settlement Ccy Conversion                    *
      *  CEU017 - Securities Redenomination Euro Changes              *
      *  CSE007 - Corporate Actions                                   *
      *                                                               *
      *****************************************************************
     FSECORFL2UF  E           K        DISK         KINFSR *PSSR
      ***  CO Reference                             Prefix - MA
      *
     FSECODRL0UF  E           K        DISK         KINFSR *PSSR
      ***  CO Depots Upd Idx                        Prefix - MS
      *
     FSECODPL2UF  E           K        DISK         KINFSR *PSSR
      ***  CO Depots                                Prefix - MB
      *
     FSECOALL4UF  E           K        DISK         KINFSR *PSSR
      ***  CO Allocations                           Prefix - MC
      *
     FSECTY   IF  E           K        DISK         KINFSR *PSSR
      ***  Security Details
      *
     FSECGT   IF  E           K        DISK         KINFSR *PSSR
      ***  Charge Type - Ccy,Ccom
      *
     FSEPCCD  IF  E           K        DISK         KINFSR *PSSR
      ***  Customer Position Profit Centre File
      *
     FSESWHTL0IF  E           K        DISK         KINFSR *PSSR
      ***  Securities WHT details file
      *
     FPMPORTPDIF  E           K        DISK         KINFSR *PSSR
      ***  Portfolio Details
      *
     FCLINT   IF  E           K        DISK         KINFSR *PSSR
     F            CLINTCAF                          KIGNORE
     F            CLINTCCF                          KIGNORE
     F            CLINTC1F                          KIGNORE
      *
     FSTDSED  IF  E           K        DISK         KINFSR *PSSR
      ***  Standard Settlement Instructions
      *
     FACNUM   IF  E           K        DISK         KINFSR *PSSR
      ***  Account Numbers file
     F            ACCNTABF                          KRENAMEACCNTB2F
      *
     FACCNT   IF  E           K        DISK         KINFSR *PSSR
      ***  GL Accounts Master
     F            ACCNTAAF                          KIGNORE
     F            ACCNTABF                          KRENAMEACCNTB1F
     F            ACCNTACF                          KIGNORE
      *
     FPMACCNL0IF  E           K        DISK
     F            ACCNTABF                          KRENAMEACCNTB3F
     FPMACCNL1IF  E           K        DISK                               219688
     F            ACCNTABF                          KRENAMEACCNTL1F       219688
     F*                                                                   219688
      *
     FTABSE   IF  E           K        DISK         KINFSR *PSSR
     F            TABLETAF                          KIGNORE
     F            TABTB10F                          KIGNORE
     F            TABTB36F                          KIGNORE
     F            TABTB40F                          KIGNORE
     F            TABTE10F                          KIGNORE
     F            TABTE20F                          KIGNORE
     F            TABTG10F                          KIGNORE
     F            TABTG20F                          KIGNORE
     F            TABLETHF                          KIGNORE
     F            TABLETKF                          KIGNORE
     F            TABLETLF                          KIGNORE
     F            TABLETNF                          KIGNORE
     F            TABLETPF                          KIGNORE
     F            TABLETRF                          KIGNORE
     F            TABLETXF                          KIGNORE
     F            TABLET2F                          KIGNORE
     F            TABLET3F                          KIGNORE
     F            TABLET5F                          KIGNORE
      *
     FSECODVL0IF  E           K        DISK         KINFSR *PSSR
      ***  CO Dividends                             Prefix - MD
      *
     FSECORGL0IF  E           K        DISK         KINFSR *PSSR
      ***  CO Rights                                Prefix - MF
      *
     FSECOOFL0IF  E           K        DISK         KINFSR *PSSR
      ***  CO Exchange Offers                       Prefix - MI
      *
     FSECOCHL0IF  E           K        DISK         KINFSR *PSSR
      ***  CO Default Charges                       Prefix - MR
      *
     FSECOCHL1IF  E           K        DISK         KINFSR *PSSR
     F            SECOCHD0                          KRENAMESECOCHD1
      ***  CO Default Charges                       Prefix - MR
      *
     FINVTP   IF  E           K        DISK         KINFSR *PSSR
      ***  Investment type details
      *
     FSECOSIL1IF  E           K        DISK
     F                                              KINFSR *PSSR
      ***  Midas SE Corporate Actions Instructions by Customer.          - Prefixe MO
      *
     FSECOSIL2IF  E           K        DISK
     F            SECOSID0                          KRENAMESECOSID2
     F                                              KINFSR *PSSR
      ***  Midas SE Corporate Actions Instructions by Book.              - Prefixe MO
      *
     FSECOATL0IF  E           K        DISK         KINFSR *PSSR
      ***  Corporate Action Type                    Prefix - MM
      *
     FSECOCCL0IF  E           K        DISK         KINFSR *PSSR          CEU017
      ***  CO Currency Change                       Prefix - NA           CEU017
      *                                                                   CEU017
     FSECOCCL1IF  E           K        DISK         KINFSR *PSSR          CEU017
     F            SECOCCD0                          KRENAMESECOCCD1       CEU017
      ***  CO Currency Change                       Prefix - NA           CEU017
      *                                                                   CEU017
     FSECORBL0UF  E           K        DISK         KINFSR *PSSR          CEU017
      ***  CO Currency Change                       Prefix - NA           CEU017
      *                                                                   CEU017
     FSECORFL0IF  E           K        DISK         KINFSR *PSSR          CEU017
     F            SECORFD0                          KRENAMESECORFD1       CEU017
      ***  CO Reference                             Prefix - MA           CEU017
      *                                                                   CEU017
     FSDTXCML1IF  E           K        DISK         KINFSR *PSSR                              CGL031
      ***  SD Tax Calculation Methods                                                         CGL031
      *                                                                                       CGL031
     FSDACUSL1IF  E           K        DISK         KINFSR *PSSR                              CGL031
      ***  SD Extended Customer's Details                                                     CGL031
      *                                                                                       CGL031
     FSDNAHOL1IF  E           K        DISK         KINFSR *PSSR                              CGL031
      ***  SD Non-A/C Holder Details                                                          CGL031
      *                                                                                       CGL031
     FSDCSINL9O   E           K        DISK         KINFSR *PSSR A                            CGL031
      ***  SD Customer Income                                                                 CGL031
      *                                                                                       CGL031
     FSDJACCL1IF  E           K        DISK         KINFSR *PSSR                              CGL031
      ***  SD Joint Account Member Details                                                    CGL031
      *                                                                                       CGL031
     FSDJACCL3IF  E           K        DISK         KINFSR *PSSR                              CGL031
     F            SDJACCD0                          KRENAMESDJACCD3                           CGL031
      ***  SD Joint Account Member Details                                                    CGL031
      *                                                                                       CGL031
     FSDTXBSL1IF  E           K        DISK         KINFSR *PSSR                              CGL031
      ***  SD Tax Basket Details                                                              CGL031
      *                                                                                       CGL031
     FTRADS   IF  E           K        DISK         KINFSR *PSSR                              CGL031
      ***  SE Trades                                                                          CGL031
      *                                                                                       CGL031
     FPOSETD  O   E           K        DISK         KINFSR *PSSR
      ***  Position Settlements - Detail
      *
     FPSAUTD  O   E           K        DISK                                                 AR324886
      ** SE Position Settlement Authorisation detail                                        AR324886
      *                                                                                     AR324886
     FPOSETDY1IF  E           K        DISK         KINFSR *PSSR A
      ***  Position Settlements - Extension File
      *
     FPOSETDY2IF  E           K        DISK         KINFSR *PSSR A
      ***  Position Settlements - Extension File
      *
     FSDCUSQL0IF  E           K        DISK                                                 AR853119
      **  Midas SD Stamp Tax Customer Extension file                                        AR853119
     FPOSETDX3O   E           K        DISK         KINFSR *PSSR                            AR853119
      ***  Position Settlements - Extension File                                            AR853119
     FSDSTMDPDO   E           K        DISK         KINFSR *PSSR                            AR853119
      **  Midas SD Stamp Tax History Detail file                                            AR853119
      *                                                                                     AR853119
     FPOSETA  O   E                    DISK         KINFSR *PSSR
      ***  Position Settlements - Audit
      *
     FSEKEYD  O   E           K        DISK         KINFSR *PSSR
      ***  Generated Account Keys - Detail
      *
     FSEKEYA  O   E                    DISK         KINFSR *PSSR
      ***  Generated Account Keys - Audit
     F/COPY WNCPYSRC,SE7561F001
      *
     FSE7561AUO   E                    PRINTER      KINFSR *PSSR
      ***  Program run control report
     F                                              KINFDS SPOOLU
      *
      **********************************************************************
      /EJECT
      **********************************************************************
      *
     E/COPY ZSRSRC,ZHASHZ1
     E/COPY ZSRSRC,ZCCAL1Z1
     E/COPY ZSRSRC,ZPOWER8Z1
     E/COPY ZSRSRC,ZPOWERZ1
     E/COPY ZSRSRC,ZDATE2Z1                                                                   CGL031
     E/COPY ZSRSRC,ZDATE9Z1                                                                   CGL031
      *
     E                    CPY@    1   1 80
      ***  Copyrigth Array
      *
      **********************************************************************
      /EJECT
      **********************************************************************
      *
     IACCNTB1F
     I              CNUM                            ZRCNUM
     I              CCY                             ZRCCY
     I              ACOD                            ZRACOD
     I              ACSQ                            ZRACSQ
     I              BRCA                            ZRBRCA
     I              PTFR                            ZRPTFR
      *
     IACCNTB2F
     I              CNUM                            ZRCNUM
     I              CCY                             ZRCCY
     I              ACOD                            ZRACOD
     I              ACSQ                            ZRACSQ
     I              BRCA                            ZRBRCA
     I              PTFR                            ZRPTFR
      *                                                                                       CGL031
     ITRADSDF                                                                                 CGL031
      ***  Rename some fields of LF/TRADS                                                     CGL031
     I              EUTX                            TREUTX                                    CGL031
      *                                                                                       CSE028
      ** DS for customer/book standard settlement instruction                                 CSE028
      **  to be passed to SESSIR0                                                             CSE028
      *                                                                                       CSE028
     IPCBSTD    E DSSTDSED                    2                                               CSE028
     I              RECI                            WRECI                                     CSE028
     I              LCD                             WLCD                                      CSE028
     I              CHTP                            WCHTP                                     CSE028
     I              TNLU                            WTNLU                                     CSE028
      *                                                                                       CSE028
      ** Data structure for standard additional settlement details                            CSE028
      ** for customer/book to be passed to SESSIR0                                            CSE028
      *                                                                                       CSE028
     IPCBSAD    E DSSTDADSED                  8                                               CSE028
      *
     IWWCOOP      DS
      ***  Working DS for Database Error on Logical file
     I                                        1   6 WKCOR2
     I                                        7   80WKOPT2
      *
     IWWINV       DS
      ***  Working DS for Database Error on LF/INVTP
     I                                        1   3 WKNMCY
     I                                        4   6 WKSITP
      *
     IWACKEY      DS
      ***  Account Key Data Structure
     I                                        1   3 WACITY
     I                                        4   4 WACEVC
     I                                        5   5 WACTRT
     I                                        6   6 WACPFI
     I                                        7   8 WACBKC
     I                                        9  10 WACTST
     I                                       11  12 WACCCC
     I                                       13  13 WACMKT
     I                                       14  14 WACCON
     I                                       15  15 WACNEG
     I                                       16  18 WABLCK
     I                                       19  20 WACAMC
      *
     I***P@DATA*     DS                            128                                      AR853119
     IP@DATA      DS                            141                                         AR853119
      ** Data structure of the parameter passed to and from SEZ010
     I                                        1   1 P@CLAS
     I                                        2   2 P@PPRE
     I                                        3  150P@PAMD
     I                                       16  280P@PCHA
     I                                       29  410P@PCAM
     I                                       42  540P@TASO
     I                                       55  670P@TAUS
     I                                       68  808P@PSXR
     I                                       81  81 P@PMDI
     I                                       82  84 P@PNCY
     I                                       85  87 P@PSCU
     I                                       88 1000P@PSAT
     I                                      101 1138P@FXMR
     I                                      114 1260P@MAMT
     I                                      127 128 P@TDTP
     I                                      129 1410P@STAM                                  AR853119
      *
     I            DS                            256
     I**********                              1   60ZWCNUM                                    CSD027
     I                                        1   6 ZWCNUM                                    CSD027
     I                                        7   9 ZWCCY
     I**********                             10  130ZWACOD                                    CGL029
     I**********                             14  150ZWACSQ                                    CGL029
     I**********                             16  18 ZWBRCA                                    CGL029
     I**********                              1  18 ZKACCN                                    CGL029
     I                                       10  190ZWACOD                                    CGL029
     I                                       20  210ZWACSQ                                    CGL029
     I                                       22  24 ZWBRCA                                    CGL029
     I                                        1  24 ZKACCN                                    CGL029
     ILDA       E DSLDA
      ***  Data structure for database error
      *
     ISESTAT    E DS
      ***  Data structure for SESTAT
      *
     ISPOOLU      DS
      ***  File information data structure
     I                                       83  92 SFILEU
     I                                    B 123 1240SFNUMU
      *
     IPSDS       SDS
      ***  Program Status Data Structure
     I                                      254 263 USER
      *
     I            DS
     I**********                              1  12 PSEA1                                     CGL029
     I                                        1  18 PSEA1                                     CGL029
     I**********                              1   60CNUM                                      CSD027
     I                                        1   6 CNUM                                      CSD027
     I**********                              7  100ACOD                                      CGL029
     I**********                             11  120ACSQ                                      CGL029
     I                                        7  160ACOD                                      CGL029
     I                                       17  180ACSQ                                      CGL029
      *
     I/COPY ZSRSRC,ZTNLU1Z1
     I/COPY ZSRSRC,ZHASHZ2
     I/COPY ZSRSRC,ZDATE9Z2                                                                   CGL031
      *
     ISDMMOD    E DSSDMMODPD
      ***  External DS for Modules File                    Prefix - BG
      *
     ISDBANK    E DSSDBANKPD
      ***  Data structure for bank details                 Prefix - BJ
      *
     ISECNTR    E DSSECNTRPD
      ** SE Country tax rate details
      *
     ISECBTX    E DSSECBTXPD
      ** SE Country to Branch tax rate details
      *
     ISDSTRD    E DSSDSTRDPD
      ***  Data structure for securities trading details   Prefix - BV
      *
     ISDRETL    E DSSDRETLPD
      ***  Data structure for retail details               Prefix - BM
      *
     ISDGELR    E DSSDGELRPD
     I              QQACCD                          QQACD1                                    CGL029
      ***  Data structure for general ledger details       Prefix - BK
      *
     ISDSECS    E DSSDSECSPD
     I              QQACCD                          QQACD2                                    CGL029
      ***  Data structure for securities customer details  Prefix - BF
      *
     ISDNOST    E DSSDNOSTPD
     I              QQACCD                          QQACD3                                    CGL029
      ***  Data structure for Nostro Details               Prefix - A7
      *
     ISDPLCS    E DSSDPLCSPD
      ***  Data structure for portfolio management customer details  Prefix - QB
      *
     ISCSARD    E DSSCSARDPD
      ***  Data structure for switchable features file     Prefix - None
     I*****         LCD                             WLLCD
      *
     ISDCURR    E DSSDCURRPD
      ***  Data structure for currency details             Prefix - A6
      *
     ISDBRCH    E DSSDBRCHPD                                                                  CGL031
      ** Branch Details                                                                       CGL031
      *                                                                                       CGL031
     ISDBRCE    E DSSDBRCHEXPD                                                              AR853119
      ** Branch Details Extension                                                           AR853119
     ISDSTPD    E DSSDSTPDPD                                                                AR853119
      *                                                                                     AR853119
     ISDLOCN    E DSSDLOCNPD                                                                  CGL031
      ** Location Details                                                                     CGL031
      *                                                                                       CGL031
     ISDCUST    E DSSDCUSTPD                                                                  CGL031
      ** Customer Details                                                                     CGL031
     I              QQDFAC                          QQDFA1                                    CGL031
      *                                                                                       CGL031
     ISDCTTX    E DSSDCTTXPD                                                                  CGL031
      ** Country of Tax Details                                                               CGL031
      *                                                                                       CGL031
     ISDTXPA    E DSSDTXPAPD                                                                BUG22911
      ** Data structure for Tax Parameter File                                              BUG22911
      *                                                                                     BUG22911
     IDSFDY     E DSDSFDY
      ***   Short data structure for access objects
      *
     IDSSDY     E DSDSSDY
      ***   Long data structure for access objects
      *
     IPPOSET    E DSPOSETD                                                CSE023
     I              LCD                             PSLCD                 CSE023
     I*  Position Settlement record for calling SE2310                    CSE023
      *                                                                   CSE023
     ICPYR@#      DS
      ***  Data structure for compilation - Copyright insertion
     I                                        1  80 CPY@
     I                                        1  20 CPY@##
      *                                                                                       CGL020
     I              'ZAAMLSETSE'          C         ZAAMLP                                    CGL020
      *                                                                                       CGL020
     I**********                              1   60PCUSTN                             CGL020 CSD027
     I                                        1   6 PCUSTN                                    CSD027
      *                                                                                       CGL020
      *                                                                                       CGL031
     IDSSTRT      DS                                                                          CGL031
      ***  Data structure to format Street field                                              CGL031
     I                                        1  70 WSTRT                                     CGL031
     I                                        1  35 WADDR3                                    CGL031
     I                                       36  70 WADDR4                                    CGL031
      *                                                                                       CGL031
     IDSINST      DS                                                                          CGL031
      ***  Data structure to format Instrument Reference                                      CGL031
     I                                        1  34 WINST                                     CGL031
     I                                        1  10 WINST1                                    CGL031
     I                                       11  34 WINST2                                    CGL031
     I              ' - Dividend'         C         WCINST                                    CGL031
      *                                                                                       219566
      * Data structure for AOSVALR0 string                                                    219566
     I            DS                                                                          219566
     I                                        1 200 SVAL1                                     219566
     I                                        1   1 DEF001                                    219566
      *                                                                                       219566
      * System Value                                                                          219566
     I            DS                                                                          219566
     I I            'UseDefaultSettAccnt '    1  20 SVALK1                                    219566
      *                                                                                       219566
     ISDSTAT    E DSSDSTAT                                                                  AR324886
      ** SD Data area                                                                       AR324886
      *                                                                                     AR324886
     I/COPY WNCPYSRC,SE7561I001
      *
      *****************************************************************
      /EJECT
      *****************************************************************
      *                M A I N     P R O C E S S I N G                *
      *****************************************************************
      *
      ***  Access first record (By read) In CO Reference Rtv Idx
      *
     C           *LOVAL    SETLLSECORFL2
     C                     READ SECORFL2                 44
      *
      ***  Do while end of file is not reached
      *
     C           *IN44     DOWEQ*OFF
      *                                                                                       CGL031
      ** Initialise cumulative tax variables                                                  CGL031
      *                                                                                       CGL031
     C                     Z-ADD*ZEROS    WTTXSR                                              CGL031
     C                     Z-ADD*ZEROS    WTTXSC                                              CGL031
     C                     Z-ADD*ZEROS    WTTXSB                                              CGL031
     C                     Z-ADD*ZEROS    WTNINT                                              CGL031
     C                     Z-ADD*ZEROS    WTNINC                                              CGL031
     C                     Z-ADD*ZEROS    WTNINB                                              CGL031
      *
      ***  If "Security Shortname" is not equal to "Saved Security"
      ***  Access to Security Details
      *
     C           MASESN    IFNE WOSESN
     C                     MOVELMASESN    WOSESN    P
     C                     MOVELMASESN    WKSESN    P
     C                     EXSR #SECTO
     C                     ENDIF
      *
      ***  If Last Change Type is NOT a reversal
      *
     C           MACHTP    IFNE 'R'
      *
     C                     MOVELMACORF    KWCORF    P      CO Reference Number
      *
      ***  Access LF/SECODRL0 with reference in order to obtain
      ***  the depots linked to the Corporate Action
      *
     C           KWCORF    SETLLSECODRL0
     C           KWCORF    READESECODRL0                 45
      *
      ***  Do while end of file is not reached
      *
     C           *IN45     DOWEQ*OFF
      *
      ***  Setup working field to produce Account Keys and Positions Settlements
      *
     C                     MOVE 'N'       WWAKRI  1
     C                     MOVE 'N'       WWPSRI  1
      *
      ***  If Status Corporate Action (MSCOST) is equal to 'X'
      *
     C           MSCOST    IFEQ 'X'
      *
      ***  If Payment Date is lower or equal to next working day
      *
     C           MACOPD    IFLE ZZDNWD
      *
      ***  If "Position Settlement Indicator" is NOT 'Y'
      *
     C           MSPOSI    IFNE 'Y'
     C                     MOVE 'Y'       WWPSRI           Produce Position Settl.
     C                     ENDIF
     C                     ENDIF
      *
      ***  If Event Date is lower or equal to the Event Control Date
      *
     C           MAEVDT    IFLE WWECD
      *
      ***  If "Event Date Accounting Indicator" is NOT 'Y'
      *
     C           MSEACC    IFNE 'Y'
      *
      ***  Set indicator to produce Account Keys to 'Y'
      *
     C                     MOVE 'Y'       WWAKRI           Produce Acc. Keys
     C                     ENDIF
     C                     ENDIF
      *
      ***  If Account Key or Position Settlement must be produced
      *
     C********** WWAKRI    IFEQ 'Y'                                       173581
     C********** WWPSRI    OREQ 'Y'                                       173581
     C                     EXSR #PDPRD
     C**********           ENDIF                                          173581
     C                     ENDIF                           Status 'X'
      *
      ***  Read Next Corporate Action Reference
      *
     C           KWCORF    READESECODRL0                 45
     C                     ENDDO                           *IN45=*OFF
     C                     ENDIF                           Not Reversal
      *
      ***  If Last change type = 'R' and last change date = run date
      ***  and processing type is not 'NC'
      *
     C           MACHTP    IFEQ 'R'
     C           MALCD     ANDEQBJRDNB
     C           MAPTYP    ANDNE'NC'
      *
     C                     MOVELMACORF    KWCORF    P      CA Reference Number
      *
      ***  Access LF/SECODRL0 with reference in order to obtain
      ***  the depots linked to the Corporate Action
      *
     C           KWCORF    SETLLSECODRL0
     C           KWCORF    READESECODRL0                 45
      *
      ***  Do while end of file is not reached
      *
     C           *IN45     DOWEQ*OFF
      *
      ***  Setup working field to produce Account Keys and Positions Settlements
      *
     C                     MOVE 'N'       WWAKRI  1
     C                     MOVE 'N'       WWPSRI  1
      *
      ***  If Status Corporate Action (MSCOST) is equal to 'R'
      *
     C           MSCOST    IFEQ 'R'
      *
      ***  If "Event Date Accounting indicator" is 'Y'
      *
     C           MSEACC    IFEQ 'Y'
     C                     MOVE 'Y'       WWAKRI           Produce Account Keys
      *
      ***  Produce depot record depending on processing type
      *
     C                     EXSR #PDPRD
     C                     ENDIF
     C                     ENDIF                           status
      *
      ***  Read next record
      *
     C           KWCORF    READESECODRL0                 45
     C                     ENDDO                           *IN45=*OFF
     C                     ENDIF                           Reversal
      *
     C                     MOVELMACORF    KWCORF    P      CA Reference Number
     C                     MOVE 'Y'       WWORK   1
     C                     MOVE 'Y'       WNOREC  1
      *
      ***  Access LF/SECODRL0 with reference in order to Check the status
      *
     C           KWCORF    SETLLSECODRL0
     C           KWCORF    READESECODRL0                 45
      *
      ***  Do while end of file is not reached
      *
     C           *IN45     DOWEQ*OFF
      *
     C                     MOVE 'N'       WNOREC
      *
      ***  If status is NOT 'C'
      *
     C           MSCOST    IFNE 'C'
     C                     MOVE 'N'       WWORK
     C                     ENDIF                           status
      *
      ***  Read next record
      *
     C           KWCORF    READESECODRL0                 45
     C                     ENDDO                           *IN45=*OFF
      *
      ***  If all the record read on LF/SECODRL0 have the status (MSCOST) is 'C'
      *
     C           WWORK     IFEQ 'Y'
     C           WNOREC    ANDEQ'N'
     C                     MOVE 'C'       MASTAT
     C                     UPDATSECORFD0
     C                     ENDIF                           status
      *
      ***  Access next record in CO References file
      *
     C                     READ SECORFL2                 44
     C                     ENDDO                           *IN44=*OFF
      *                                                                   CEU017
     C           CEU017    IFEQ 'Y'                                       CEU017
      *                                                                   CEU017
      ***  Access LF/SECORBL0 with reference in order to Check the status CEU017
      *                                                                   CEU017
     C           *LOVAL    SETLLSECORBL0                                  CEU017
     C                     READ SECORBL0                 44               CEU017
      *                                                                   CEU017
      ***  Do while end of file is not reached                            CEU017
      *                                                                   CEU017
     C           *IN44     DOWEQ*OFF                                      CEU017
      *                                                                   CEU017
     C                     MOVE 'Y'       WWORK                           CEU017
      *                                                                   CEU017
      ***  If status is NOT 'C'                                           CEU017
      *                                                                   CEU017
     C***********NBSTAT    IFNE 'C'                                       CEU017
     C           NBSTAT    IFEQ 'X'                                       CEU017
      *                                                                   CEU017
     C           NBBLKR    SETLLSECOCCL1                                  CEU017
     C           NBBLKR    READESECOCCL1                 45               CEU017
      *                                                                   CEU017
      ***  Do while end of file is not reached                            CEU017
      *                                                                   CEU017
     C           *IN45     DOWEQ*OFF                                      CEU017
     C           WWORK     ANDEQ'Y'                                       CEU017
      *                                                                   CEU017
     C           NACORF    CHAINSECORFL0             89                   CEU017
      *                                                                   CEU017
     C           *IN89     IFEQ *ON                                       CEU017
     C           *LOCK     IN   LDA                                       CEU017
     C                     Z-ADD1         DBASE            ***************CEU017
     C                     MOVEL*BLANKS   DBFILE           ** DB ERROR 01 CEU017
     C                     MOVE 'SECORFL0'DBFILE           ***************CEU017
     C                     MOVELNACORF    DBKEY     P                     CEU017
     C                     MOVEL'SE7561'  DBPGM     P                     CEU017
     C                     OUT  LDA                                       CEU017
     C                     EXSR *PSSR                                     CEU017
     C                     ENDIF                                          CEU017
      *                                                                   CEU017
      ***  If status is NOT 'C'                                           CEU017
      *                                                                   CEU017
     C           MASTAT    IFNE 'C'                                       CEU017
     C           MASTAT    ANDNE'R'                                       153091
     C                     MOVE 'N'       WWORK                           CEU017
     C                     ENDIF                                          CEU017
      *                                                                   CEU017
     C           NBBLKR    READESECOCCL1                 45               CEU017
     C                     ENDDO                           *IN45=*OFF     CEU017
      *                                                                   CEU017
      ***  If all the records read on LF/SECORFL0 have the status is 'C'  CEU017
      *                                                                   CEU017
     C           WWORK     IFEQ 'Y'                                       CEU017
     C                     MOVE 'C'       NBSTAT                          CEU017
     C                     UPDATSECORBD0                                  CEU017
     C                     ENDIF                                          CEU017
      *                                                                   CEU017
     C                     ENDIF                           status         CEU017
      *                                                                   CEU017
      ***  Read next record                                               CEU017
      *                                                                   CEU017
     C                     READ SECORBL0                 44               CEU017
     C                     ENDDO                           *IN44=*OFF     CEU017
      *                                                                   CEU017
     C                     ENDIF                                          CEU017
      *
      ***  Termination processing
      *
     C                     EXSR #TERPR
      *
      *****************************************************************
      /EJECT
      *****************************************************************
      *  #PDPRD -  Process Depot records for processing types         *
      *  ------                                                       *
      *  Called by : Main processing                                  *
      *  Calls     : #SELLF #PRDV #PRFR #PRCR #PROF #PREX #PRNF       *
      *              #SACKD #SACKB #SACKC                             *
      *****************************************************************
      *
     C           #PDPRD    BEGSR
      *
      ***********************
      ***  Process Depot  ***
      ***********************
      *
     C                     MOVELMSCORF    WKCORF    P      Reference
     C                     MOVE MSBRCD    WKBRCD           Branch
     C**********           Z-ADDMSDDPT    WKDDPT           Depot                              CSD027
     C                     MOVE MSDDPT    WKDDPT           Depot                              CSD027
      *
      ***  Access first depot record for current CO Reference
      *
     C           KWCODP    SETLLSECODPL2
     C           KWCODP    READESECODPL2                 46
      *
      ***  Do while same reference, same branch and same depot
      *
     C           *IN46     DOWEQ*OFF
      *
     C                     MOVE 'D'       WWDPCU  1        Gen. Pos. Settl. for Depot
      *
      ***  Access to logical file depends on processing type
      *
     C                     EXSR #SELLF
      *
      ***  Access to Standard Instructions for Corporate Actions File
      *
     C           WWPSRI    IFEQ 'Y'
     C           WWAKRI    OREQ 'Y'
     C                     EXSR #STDIS
     C                     ENDIF
      *
      ***  If Produce Position Settlements indicator is 'Y'
      *
     C           WWPSRI    IFEQ 'Y'
      *
     C                     Z-ADD*ZERO     WWTNLU           Position Settlement TNL1
      *
      ***  Check the processing type
      *
     C                     SELEC
      *
      ***  Processing type is 'DV'
      *
     C           MAPTYP    WHEQ 'DV'
     C                     EXSR #PRDV
      *
      ***  Processing type is 'FR'
      ***  or Processing type is 'RG' (Average Price Option 'Z')
      *
     C           MAPTYP    WHEQ 'FR'
     C           MAPTYP    OREQ 'RG'
     C           MFAVOP    ANDEQ'Z'
     C                     EXSR #PRFR
      *
      ***  Processing type is 'CR'
      ***  or Processing type is 'CC'                                     CEU017
      ***  or Processing type is 'CE'
      ***  or Processing type is 'OF' Exchange Offers
      ***  or Processing type is 'RG' (Average Price Option 'M','C')
      *                                                  OR     'I'       161746
      *
     C           MAPTYP    WHEQ 'CR'
     C           MAPTYP    OREQ 'CC'                                      CEU017
     C           MAPTYP    OREQ 'CE'
     C           MAPTYP    OREQ 'OF'
     C           MIOFTY    ANDEQ'E'
     C           MAPTYP    OREQ 'RG'
     C           MFAVOP    ANDEQ'M'
     C           MAPTYP    OREQ 'RG'
     C           MFAVOP    ANDEQ'C'
     C           MAPTYP    OREQ 'RG'                                      161746
     C           MFAVOP    ANDEQ'I'                                       161746
     C                     EXSR #PRCR
      *
      ***  Processing type is 'OF' Purchase Offers
      ***  or Processing type is 'OF' Subscription Offers
      *
     C           MAPTYP    WHEQ 'OF'
     C           MIOFTY    ANDEQ'P'
     C           MAPTYP    OREQ 'OF'
     C           MIOFTY    ANDEQ'S'
     C                     EXSR #PROF
      *
      ***  Processing type is 'EX'
      *
     C           MAPTYP    WHEQ 'EX'
     C                     EXSR #PREX
      *
      ***  Processing type is 'NF'
      *
     C           MAPTYP    WHEQ 'NF'
     C                     EXSR #PRNF
     C                     ENDSL
      *
      ***  Setup the Position Settlement and update the depot file
      *
     C                     Z-ADDWWTNLU    MBTNL1
     C                     UPDATSECODPD0
     C                     ENDIF                           WWPSRI='Y'
      *
      ***  If Produce Account Keys indicator is 'Y'
      *
     C           WWAKRI    IFEQ 'Y'
      *
      ***  Write an Account Key for the DEPOT
      *
     C                     EXSR #SACKD
     C                     ENDIF                           WWAKRI='Y'
      *
      ***  Read next record with same Reference, same brach and same depot
      *
     C           KWCODP    READESECODPL2                 46
     C                     ENDDO                           *IN46=*OFF
      *
      *******************************
      ***  Process Customer/Book  ***
      *******************************
      *
     C                     MOVELMSCORF    WKCORF    P      Reference
     C                     MOVE MSBRCD    WKBRCD           Branch
     C**********           Z-ADDMSDDPT    WKDDPT           Depot                              CSD027
     C                     MOVE MSDDPT    WKDDPT           Depot                              CSD027
      *
      ***  Access first allocation record for current CO Reference
      *
     C           KWCODP    SETLLSECOALL4
     C           KWCODP    READESECOALL4                 46
      *
      ***  Do while same reference, same branch and same depot
      *
     C           *IN46     DOWEQ*OFF
      *
     C                     MOVE 'C'       WWDPCU           Gen. Pos. Settl. for Customer
      *
      ***  Access to logical file depends on processing type
      *
     C                     EXSR #SELLF
      *
      ***  Access to Standard Instructions for Corporate Actions File
      *
     C           WWPSRI    IFEQ 'Y'
     C           WWAKRI    OREQ 'Y'
     C                     EXSR #STDIS
     C                     ENDIF
      *
      ***  If Produce Position Settlements indicator is 'Y'
      ***  AND Customer/book Indicator is 'C'
      *
     C           WWPSRI    IFEQ 'Y'
     C           MCCOTP    ANDEQ'C'
      *
     C                     Z-ADD*ZERO     WWTNLU           Position Settlement TNL1
      *
      ***  Check the processing type
      *
     C                     SELEC
      *
      ***  Processing type is 'DV'
      *
     C           MAPTYP    WHEQ 'DV'
     C                     EXSR #PRDV
      *
      ***  Processing type is 'FR'
      ***  or Processing type is 'RG' (Average Price Option 'Z')
      *
     C           MAPTYP    WHEQ 'FR'
     C           MAPTYP    OREQ 'RG'
     C           MFAVOP    ANDEQ'Z'
     C                     EXSR #PRFR
      *
      ***  Processing type is 'CR'
      ***  or Processing type is 'CC'                                     CEU017
      ***  or Processing type is 'CE'
      ***  or Processing type is 'OF' Exchange Offers
      ***  or Processing type is 'RG' (Average Price Option 'M','C')
      *                                                  OR     'I'       161746
      *
     C           MAPTYP    WHEQ 'CR'
     C           MAPTYP    OREQ 'CC'                                      CEU017
     C           MAPTYP    OREQ 'CE'
     C           MAPTYP    OREQ 'OF'
     C           MIOFTY    ANDEQ'E'
     C           MAPTYP    OREQ 'RG'
     C           MFAVOP    ANDEQ'M'
     C           MAPTYP    OREQ 'RG'
     C           MFAVOP    ANDEQ'C'
     C           MAPTYP    OREQ 'RG'                                      161746
     C           MFAVOP    ANDEQ'I'                                       161746
     C                     EXSR #PRCR
      *
      ***  Processing type is 'OF' Purchase Offers
      ***  or Processing type is 'OF' Subscription Offers
      *
     C           MAPTYP    WHEQ 'OF'
     C           MIOFTY    ANDEQ'P'
     C           MAPTYP    OREQ 'OF'
     C           MIOFTY    ANDEQ'S'
     C                     EXSR #PROF
      *
      ***  Processing type is 'EX'
      *
     C           MAPTYP    WHEQ 'EX'
     C                     EXSR #PREX
      *
      ***  Processing type is 'NF'
      *
     C           MAPTYP    WHEQ 'NF'
     C                     EXSR #PRNF
     C                     ENDSL
      *
      ***  Setup the Position Settlement and update the depot file
      *
     C                     Z-ADDWWTNLU    MCTNL1
     C                     UPDATSECOALD0
     C                     ENDIF                           WWPSRI='Y'
      *
      ***  If Produce Account Keys indicator is 'Y'
      *
     C           WWAKRI    IFEQ 'Y'
      *
      ***  Check the Customer/Book
      *
     C                     SELEC
      *
      ***  Write an Account Key for the BOOK
      *
     C           MCCOTP    WHEQ 'B'
     C                     EXSR #SACKB
      *
      ***  Write an Account Key for the CUSTOMER
      *
     C           MCCOTP    WHEQ 'C'
     C                     EXSR #SACKC
      *                                                                                       CGL031
     C           BFCLAS    IFEQ 'D'                                                           CGL031
     C           BFCLAS    OREQ 'S'                                                           CGL031
     C           MAPTYP    IFEQ 'DV'                                                          CGL031
     C           CGL031    ANDEQ'Y'                                                           CGL031
     C                     EXSR SRDVTX                                                        CGL031
     C                     ENDIF                                                              CGL031
     C                     ENDIF                                                              CGL031
      *                                                                                       CGL031
     C                     ENDSL
     C                     ENDIF                           WWAKRI='Y'
      *
      ***  Read next record with same Reference, same brach and same depot
      *
     C           KWCODP    READESECOALL4                 46
     C                     ENDDO                           *IN46=*OFF
      *
      ***  If Status is not 'R' (Reversal)
      *
     C           MSCOST    IFNE 'R'
      *
     C**********           MOVE 'C'       MSCOST           Status         150165
      *
      ***  If produce position settlement indicator is 'Y'
      *
     C           WWPSRI    IFEQ 'Y'
     C                     MOVE 'Y'       MSPOSI           Position Settlement
     C                     ENDIF
      *
      ***  If produce account key indicator is 'Y'
      *
     C           WWAKRI    IFEQ 'Y'
     C                     MOVE 'Y'       MSEACC           Event Date Accounting
     C                     ENDIF
      *                                                                   150165
      ***  If Position settlement indicator and A/c Key Indicator is 'Y'  150165
      *                                                                   150165
     C           MSPOSI    IFEQ 'Y'                                       150165
     C           MSEACC    ANDEQ'Y'                                       150165
     C           MSEVNI    ANDEQ'Y'                                       153091
     C                     MOVE 'C'       MSCOST           Status         150165
     C                     ENDIF                                          150165
      *
     C                     UPDATSECODRD0
     C                     ENDIF                           MSCOST<>'R'
      *
     C                     ENDSR
      *
      *****************************************************************
      /EJECT
      *****************************************************************                       CGL031
      *  SRDVTX -  Tax Calculations                                   *                       CGL031
      *  ------                                                       *                       CGL031
      *  Called by : #PDPRD                                           *                       CGL031
      *  Calls     : SRSACK SRCALI SRTXCI SRCALJ                      *                       CGL031
      *****************************************************************                       CGL031
      *                                                                                       CGL031
     C           SRDVTX    BEGSR                                                              CGL031
      *                                                                                       CGL031
      ** Use Booking Branch to retrieve Branch Location Code                                  CGL031
      *                                                                                       CGL031
     C**********           CALL 'AOBRCHR0'                                             CGL031 CGL035
     C                     CALL 'AOBRCHR1'                                                    CGL035
     C                     PARM *BLANKS   PRTCD   7                                           CGL031
     C                     PARM '*KEY   ' POPTN   7                                           CGL031
     C                     PARM MCBRCD    PBRCA   3                                           CGL031
     C********** SDBRCH    PARM SDBRCH    DSFDY                                        CGL031 CGL035
     C           SDBRCH    PARM SDBRCH    DSSDY                                               CGL035
      *                                                                                       CGL031
     C           PRTCD     IFNE *BLANKS                                                       CGL031
     C           *LOCK     IN   LDA                                                           CGL031
     C                     MOVEL'SDBRCHPD'DBFILE                                              CGL031
     C                     MOVELMCBRCD    DBKEY                                               CGL031
     C                     Z-ADD101       DBASE                                               CGL031
     C                     OUT  LDA                                                           CGL031
     C                     EXSR *PSSR                                                         CGL031
     C                     ENDIF                                                              CGL031
      *                                                                                       CGL031
      ** Use Branch Loc Code to retrieve Country Code (Country of Tax)                        CGL031
      *                                                                                       CGL031
     C                     CALL 'AOLOCNR0'                                                    CGL031
     C                     PARM '*MSG   ' PRTCD                                               CGL031
     C                     PARM '*KEY   ' POPTN                                               CGL031
     C                     PARM A8LCCD    PLCCD   3                                           CGL031
     C           SDLOCN    PARM SDLOCN    DSFDY                                               CGL031
      *                                                                                       CGL031
     C           PRTCD     IFNE *BLANKS                                                       CGL031
     C           *LOCK     IN   LDA                                                           CGL031
     C                     MOVEL'SDLOCNPD'DBFILE                                              CGL031
     C                     MOVELA8LCCD    DBKEY                                               CGL031
     C                     Z-ADD102       DBASE                                               CGL031
     C                     OUT  LDA                                                           CGL031
     C                     EXSR *PSSR                                                         CGL031
     C                     ENDIF                                                              CGL031
      *                                                                                       CGL031
      ** Retrieve Customer's Country of Residence                                             CGL031
      *                                                                                       CGL031
     C                     MOVEL*BLANKS   PKEY   10                                           CGL031
     C                     MOVELMCCNUM    PKEY                                                CGL031
     C                     CALL 'AOCUSTR0'                                                    CGL031
     C                     PARM *BLANKS   PRTCD                                               CGL031
     C                     PARM '*KEY   ' POPTN                                               CGL031
     C                     PARM           PKEY                                                CGL031
     C                     PARM *BLANKS   PKYST   7                                           CGL031
     C           SDCUST    PARM SDCUST    DSSDY                                               CGL031
      *                                                                                       CGL031
     C           PRTCD     IFNE *BLANKS                                                       CGL031
     C           *LOCK     IN   LDA                                                           CGL031
     C                     MOVEL'SDCUSTPD'DBFILE                                              CGL031
     C                     Z-ADD103       DBASE                                               CGL031
     C                     MOVELMCCNUM    DBKEY                                               CGL031
     C                     OUT  LDA                                                           CGL031
     C                     EXSR *PSSR                                                         CGL031
     C                     ENDIF                                                              CGL031
      *                                                                                       CGL031
      ** Use retrieved Country of Tax and Country of Residence                                CGL031
      ** to retrieve the Tax Basket                                                           CGL031
      *                                                                                       CGL031
     C                     CALL 'AOCTTXR0'                                                    CGL031
     C                     PARM *BLANKS   PRTCD                                               CGL031
     C                     PARM '*KEY   ' POPTN                                               CGL031
     C                     PARM DVCNCD    PCTRT   2                                           CGL031
     C                     PARM BBCOLC    PCTRR   2                                           CGL031
     C           SDCTTX    PARM SDCTTX    DSFDY                                               CGL031
      *                                                                                       CGL031
      ** If no record is found, try blank Country of Residence                                CGL031
      *                                                                                       CGL031
     C           PRTCD     IFNE *BLANKS                                                       CGL031
     C                     CALL 'AOCTTXR0'                                                    CGL031
     C                     PARM *BLANKS   PRTCD                                               CGL031
     C                     PARM '*KEY   ' POPTN                                               CGL031
     C                     PARM DVCNCD    PCTRT                                               CGL031
     C                     PARM *BLANKS   PCTRR                                               CGL031
     C           SDCTTX    PARM SDCTTX    DSFDY                                               CGL031
      *                                                                                       CGL031
     C           PRTCD     IFNE *BLANKS                                                       CGL031
     C           *LOCK     IN   LDA                                                           CGL031
     C                     MOVEL'SDCTTXPD'DBFILE                                              CGL031
     C                     Z-ADD104       DBASE                                               CGL031
     C                     MOVELDVCNCD    DBKEY                                               CGL031
     C                     MOVE BBCOLC    DBKEY                                               CGL031
     C                     OUT  LDA                                                           CGL031
     C                     EXSR *PSSR                                                         CGL031
     C                     ENDIF                                                              CGL031
     C                     ENDIF                                                              CGL031
      *                                                                                       CGL031
     C                     MOVE 'N'       WEUTXF  1                                           CGL031
     C                     MOVE 'N'       WJOINT  1                                           CGL031
      *                                                                                       CGL031
      ** Position Tax Basket details PF/SDTXBSL1 by                                           CGL031
      ** Country of Tax, Tax Basket and Rundate                                               CGL031
      *                                                                                       CGL031
     C           KTXBS1    SETGTSDTXBSL1                                                      CGL031
     C           KTXBS2    REDPESDTXBSL1                 80                                   CGL031
      *                                                                                       CGL031
     C           *IN80     IFEQ '0'                                                           CGL031
      *                                                                                       CGL031
     C                     EXSR SRTXCI                                                        CGL031
      *                                                                                       CGL031
     C                     SELEC                                                              CGL031
      *                                                                                       CGL031
      ** If error was detected                                                                CGL031
      *                                                                                       CGL031
     C           PRTRN     WHEQ 'ERROR'                                                       CGL031
     C           *LOCK     IN   LDA                                                           CGL031
     C                     MOVELPDBFIL    DBFILE                                              CGL031
     C                     Z-ADD105       DBASE                                               CGL031
     C                     MOVELPDBKEY    DBKEY                                               CGL031
     C                     OUT  LDA                                                           CGL031
     C                     EXSR *PSSR                                                         CGL031
      *                                                                                       CGL031
      ** Calculate Withholding Tax                                                            CGL031
      *                                                                                       CGL031
     C           PRTRN     WHEQ *BLANKS                                                       CGL031
     C                     EXSR SRCALI                                                        CGL031
      *                                                                                       CGL031
      ** Calculate Withholding Tax for Joint Accounts                                         CGL031
      *                                                                                       CGL031
     C           PRTRN     WHEQ 'JOINT'                                                       CGL031
     C                     EXSR SRCALJ                                                        CGL031
      *                                                                                       CGL031
     C                     ENDSL                                                              CGL031
      *                                                                                       CGL031
     C                     ENDIF                                                              CGL031
      *                                                                                       CGL031
     C                     ENDSR                                                              CGL031
      *****************************************************************                       CGL031
      /EJECT                                                                                  CGL031
      *****************************************************************                       CGL031
      *  SRTXCI - Calculate EU Withholding Tax for Private Individual *                       CGL031
      *  ------                                                       *                       CGL031
      *  Called by : SRDVTX                                           *                       CGL031
      *  Calls     : ZATXCLPI                                         *                       CGL031
      *****************************************************************                       CGL031
      *                                                                                       CGL031
     C           SRTXCI    BEGSR                                                              CGL031
      *                                                                                       CGL031
     C                     MOVE '000000'  PCNUM                                               CGL031
     C                     MOVE MCCNUM    PCNUM                                               CGL031
      *                                                                                       CGL031
     C                     CALL 'ZATXCLPI'                                                    CGL031
      *                                                                                       CGL031
      ** Input parameters                                                                     CGL031
      *                                                                                       CGL031
     C                     PARM 'S'       PMODID  1                                           CGL031
     C**********           PARM MCSESN    PTRREF 18                                    CGL031 CGL035
     C                     PARM MCSESN    PTRREF 24                                           CGL035
     C                     PARM MCBRCD    PBRCA                                               CGL031
     C                     PARM           PCNUM   6                                           CGL031
     C                     PARM *ZEROS    PICSTR  50                                          CGL031
     C                     PARM *ZEROS    PICEND  50                                          CGL031
     C                     PARM WWEVAM    PTOTIN 150                                          CGL031
     C                     PARM TBTRAB    PTXRAB  64                                          CGL031
     C                     PARM WONMCY    POCCY   3                                           CGL031
     C                     PARM *BLANKS   PINTH   1                                           CER048
      *                                                                                       CGL031
      ** Output parameters                                                                    CGL031
      *                                                                                       CGL031
     C                     PARM           PIEDAT 150                                          CGL031
     C                     PARM           PTXAMT 150                                          CGL031
     C                     PARM           PTOTO  150                                          CGL031
     C                     PARM           PTXCCY  3                                           CGL031
     C                     PARM           PCTTX   2                                           CGL031
     C                     PARM           PTXBS   2                                           CGL031
     C**********           PARM           PEUTXC  40                                   CGL031 CGL035
     C                     PARM           PEUTXC 100                                          CGL035
     C                     PARM           PCLOC   2                                           CGL031
     C                     PARM           PCSTAT  5                                           CGL031
     C                     PARM           PTTEND  1                                           CGL031
     C                     PARM           PTXRP1  64                                          CGL031
     C**********           PARM *ZEROS    PSTXB   20                                 CER048 BUG22911
     C**********           PARM *ZEROS    PSTAC  100                                 CER048 BUG22911
     C**********           PARM *ZEROS    PSTTR   64                                 CER048 BUG22911
     C**********           PARM *BLANKS   PSTTP   1                                  CER048 BUG22911
     C**********           PARM *ZEROS    PSTXA  150                                 CER048 BUG22911
     C                     PARM           PDBKEY 10                                           CGL031
     C                     PARM           PDBFIL 10                                           CGL031
     C                     PARM           PRTRN   7                                           CGL031
     C           SDTXPA    PARM SDTXPA    DSSDY                                             BUG22911
      *                                                                                       CGL031
     C                     ENDSR                                                              CGL031
      *****************************************************************                       CGL031
      /EJECT                                                                                  CGL031
      *****************************************************************                       CGL031
      *  SRCALI - Cal Indiv Tax depending on Calculation Method       *                       CGL031
      *  ------                                                       *                       CGL031
      *  Called by : SRDVTX                                           *                       CGL031
      *  Calls     : SRETAX                                           *                       CGL031
      *****************************************************************                       CGL031
      *                                                                                       CGL031
     C           SRCALI    BEGSR                                                              CGL031
      *                                                                                       CGL031
      ** Retrieve Cal Method by DVCNCD and PCTTX                                              CGL031
      ** If no record was found, use Calc Method 1                                            CGL031
      *                                                                                       CGL031
     C           KTXCM1    CHAINSDTXCML1             80                                       CGL031
      *                                                                                       CGL031
     C           *IN80     IFEQ '0'                                                           CGL031
     C                     Z-ADDTCTXCM    WTXCM   10                                          CGL031
     C                     ELSE                                                               CGL031
     C                     Z-ADD1         WTXCM                                               CGL031
     C                     ENDIF                                                              CGL031
      *                                                                                       CGL031
      ** Retrieve Local Tax Rate S1RASO                                                       CGL031
      *                                                                                       CGL031
     C           MCSESN    CHAINSESWHTL0             80                                       CGL031
      *                                                                                       CGL031
      ** Calculate Tax according to Calculation Method                                        CGL031
      *                                                                                       CGL031
     C                     SELEC                                                              CGL031
      *                                                                                       CGL031
     C           WTXCM     WHEQ 1                                                             CGL031
     C           *IN80     OREQ '1'                                                           CGL031
     C           S1RASO    OREQ *ZEROS                                                        CGL031
     C                     Z-ADDPTXAMT    PTXAMT                                              CGL031
      *                                                                                       CGL031
     C           WTXCM     WHEQ 2                                                             CGL031
     C           URATE     MULT PTOTIN    WTOTI  150                                          CGL031
     C           PTOTIN    SUB  WTOTI     WTOTI                                               CGL031
     C           PTXRAB    MULT WTOTI     WTOTI                                               CGL031
     C           WTOTI     DIV  100       PTXAMT                                              CGL031
      *                                                                                       CGL031
     C           WTXCM     WHEQ 3                                                             CGL031
     C           URATE     MULT PTOTIN    WTOTI                                               CGL031
     C           PTXAMT    SUB  WTOTI     PTXAMT                                              CGL031
      *                                                                                       CGL031
     C           PTXAMT    IFLT 0                                                             CGL031
     C                     Z-ADD0         PTXAMT                                              CGL031
     C                     ENDIF                                                              CGL031
      *                                                                                       CGL031
     C           WTXCM     WHEQ 4                                                             CGL031
     C                     Z-ADD0         PTXAMT                                              CGL031
      *                                                                                       CGL031
     C                     ENDSL                                                              CGL031
      *                                                                                       CGL031
     C                     EXSR SRETAX                                                        CGL031
      *                                                                                       CGL031
     C                     ENDSR                                                              CGL031
      *                                                                                       CGL031
      *****************************************************************                       CGL031
      /EJECT                                                                                  CGL031
      *****************************************************************                       CGL031
      *  SRCALJ -  Cal Joint Tax depending on Calculation Method      *                       CGL031
      *  ------                                                       *                       CGL031
      *  Called by : SRDVTX                                           *                       CGL031
      *  Calls     : SRETAX                                           *                       CGL031
      *****************************************************************                       CGL031
      *                                                                                       CGL031
     C           SRCALJ    BEGSR                                                              CGL031
      *                                                                                       CGL031
     C                     MOVE 'Y'       WJOINT                                              CGL031
     C                     MOVE *BLANKS   WMCCUS  6                                           CGL031
     C                     MOVE MCCNUM    WMCCUS                                              CGL031
      *                                                                                       CGL031
      ** Process Account Holders                                                              CGL031
      *                                                                                       CGL031
     C           WMCCUS    SETLLSDJACCL1                                                      CGL031
     C           WMCCUS    READESDJACCL1                 81                                   CGL031
      *                                                                                       CGL031
     C           *IN81     DOWEQ'0'                                                           CGL031
      *                                                                                       CGL031
     C           JCCUST    IFNE *BLANKS                                                       CGL031
      *                                                                                       CGL031
     C                     MOVE *BLANKS   PRTRN                                               CGL031
      *                                                                                       CGL031
     C                     EXSR SRTXCJ                                                        CGL031
      *                                                                                       CGL031
     C                     SELEC                                                              CGL031
      *                                                                                       CGL031
     C           PRTRN     WHEQ 'ERROR'                                                       CGL031
     C           *LOCK     IN   LDA                                                           CGL031
     C                     MOVE 106       DBASE                                               CGL031
     C                     MOVE PDBFIL    DBFILE                                              CGL031
     C                     MOVE PDBKEY    DBKEY                                               CGL031
     C                     OUT  LDA                                                           CGL031
     C                     EXSR *PSSR                                                         CGL031
      *                                                                                       CGL031
     C           PRTRN     WHEQ *BLANKS                                                       CGL031
     C           PRTRN     OREQ 'LAST'                                                        CGL031
      *                                                                                       CGL031
      ** Retrieve Local Tax Rate S1RASO                                                       CGL031
      *                                                                                       CGL031
     C           MCSESN    CHAINSESWHTL0             80                                       CGL031
      *                                                                                       CGL031
      ** Calculate Tax according to Calculation Method                                        CGL031
      *                                                                                       CGL031
     C                     SELEC                                                              CGL031
      *                                                                                       CGL031
     C           WTXCM     WHEQ 1                                                             CGL031
     C           *IN80     OREQ '1'                                                           CGL031
     C           S1RASO    OREQ *ZEROS                                                        CGL031
     C                     Z-ADDPTXAMT    PTXAMT                                              CGL031
      *                                                                                       CGL031
     C           WTXCM     WHEQ 2                                                             CGL031
     C           URATE     MULT PTOTIN    WTOTI                                               CGL031
     C           PTOTIN    SUB  WTOTI     WTOTI                                               CGL031
     C           PTXRAB    MULT WTOTI     WTOTI                                               CGL031
     C           WTOTI     DIV  100       PTXAMT                                              CGL031
      *                                                                                       CGL031
     C           WTXCM     WHEQ 3                                                             CGL031
     C           URATE     MULT PTOTIN    WTOTI                                               CGL031
     C           PTXAMT    SUB  WTOTI     PTXAMT                                              CGL031
      *                                                                                       CGL031
     C           PTXAMT    IFLT 0                                                             CGL031
     C                     Z-ADD0         PTXAMT                                              CGL031
     C                     ENDIF                                                              CGL031
      *                                                                                       CGL031
     C           WTXCM     WHEQ 4                                                             CGL031
     C                     Z-ADD0         PTXAMT                                              CGL031
      *                                                                                       CGL031
     C                     ENDSL                                                              CGL031
      *                                                                                       CGL031
     C                     EXSR SRETAX                                                        CGL031
      *                                                                                       CGL031
     C                     ENDSL                                                              CGL031
      *                                                                                       CGL031
     C                     ENDIF                                                              CGL031
      *                                                                                       CGL031
     C           WMCCUS    READESDJACCL1                 81                                   CGL031
     C                     ENDDO                                                              CGL031
      *                                                                                       CGL031
      ** Process Non-Account Holders                                                          CGL031
      *                                                                                       CGL031
     C           WMCCUS    SETLLSDJACCL3                                                      CGL031
     C           WMCCUS    READESDJACCL3                 81                                   CGL031
      *                                                                                       CGL031
     C           *IN81     DOWEQ'0'                                                           CGL031
      *                                                                                       CGL031
     C           JCNAHO    IFNE *BLANKS                                                       CGL031
      *                                                                                       CGL031
     C                     MOVE *BLANKS   PRTRN                                               CGL031
      *                                                                                       CGL031
     C                     EXSR SRTXCJ                                                        CGL031
      *                                                                                       CGL031
     C                     SELEC                                                              CGL031
      *                                                                                       CGL031
     C           PRTRN     WHEQ 'ERROR'                                                       CGL031
     C           *LOCK     IN   LDA                                                           CGL031
     C                     MOVE 107       DBASE                                               CGL031
     C                     MOVE PDBFIL    DBFILE                                              CGL031
     C                     MOVE PDBKEY    DBKEY                                               CGL031
     C                     OUT  LDA                                                           CGL031
     C                     EXSR *PSSR                                                         CGL031
      *                                                                                       CGL031
     C           PRTRN     WHEQ *BLANKS                                                       CGL031
      *                                                                                       CGL031
      ** Retrieve Local Tax Rate S1RASO                                                       CGL031
      *                                                                                       CGL031
     C           MCSESN    CHAINSESWHTL0             80                                       CGL031
      *                                                                                       CGL031
      ** Calculate Tax according to Calculation Method                                        CGL031
      *                                                                                       CGL031
     C                     SELEC                                                              CGL031
      *                                                                                       CGL031
     C           WTXCM     WHEQ 1                                                             CGL031
     C           *IN80     OREQ '1'                                                           CGL031
     C           S1RASO    OREQ *ZEROS                                                        CGL031
     C                     Z-ADDPTXAMT    PTXAMT                                              CGL031
      *                                                                                       CGL031
     C           WTXCM     WHEQ 2                                                             CGL031
     C           URATE     MULT PTOTIN    WTOTI                                               CGL031
     C           PTOTIN    SUB  WTOTI     WTOTI                                               CGL031
     C           PTXRAB    MULT WTOTI     WTOTI                                               CGL031
     C           WTOTI     DIV  100       PTXAMT                                              CGL031
      *                                                                                       CGL031
     C           WTXCM     WHEQ 3                                                             CGL031
     C           URATE     MULT PTOTIN    WTOTI                                               CGL031
     C           PTXAMT    SUB  WTOTI     PTXAMT                                              CGL031
      *                                                                                       CGL031
     C           PTXAMT    IFLT 0                                                             CGL031
     C                     Z-ADD0         PTXAMT                                              CGL031
     C                     ENDIF                                                              CGL031
      *                                                                                       CGL031
     C           WTXCM     WHEQ 4                                                             CGL031
     C                     Z-ADD0         PTXAMT                                              CGL031
      *                                                                                       CGL031
     C                     ENDSL                                                              CGL031
      *                                                                                       CGL031
     C                     EXSR SRETAX                                                        CGL031
      *                                                                                       CGL031
     C                     ENDSL                                                              CGL031
      *                                                                                       CGL031
     C                     ENDIF                                                              CGL031
      *                                                                                       CGL031
     C           WMCCUS    READESDJACCL3                 81                                   CGL031
     C                     ENDDO                                                              CGL031
      *                                                                                       CGL031
     C                     ENDSR                                                              CGL031
      *                                                                                       CGL031
      *****************************************************************                       CGL031
      /EJECT                                                                                  CGL031
      *****************************************************************                       CGL031
      *  SRTXCJ -  Calculte EU Withholding Tax for Joint Account      *                       CGL031
      *  ------                                                       *                       CGL031
      *  Called by : SRCALJ                                           *                       CGL031
      *  Calls     : ZATXCLJA                                         *                       CGL031
      *****************************************************************                       CGL031
      *                                                                                       CGL031
     C           SRTXCJ    BEGSR                                                              CGL031
      *                                                                                       CGL031
     C                     MOVE '000000'  PJANO                                               CGL031
     C                     MOVE MCCNUM    PJANO                                               CGL031
      *                                                                                       CGL031
     C                     CALL 'ZATXCLJA'                                                    CGL031
      *                                                                                       CGL031
      ** Input parameters                                                                     CGL031
      *                                                                                       CGL031
     C                     PARM 'S'       PMODID                                              CGL031
     C                     PARM MCSESN    PTRREF                                              CGL031
     C                     PARM MCBRCD    PBRCA                                               CGL031
     C                     PARM           PJANO   6                                           CGL031
     C                     PARM JCCUST    PCNUM                                               CGL031
     C                     PARM JCNAHO    PNAHO  10                                           CGL031
     C                     PARM JCINVP    PINVP  10                                           CGL031
     C                     PARM JCPAHT    PPAHT   1                                         BUG26839
     C                     PARM *ZEROS    PICSTR                                              CGL031
     C                     PARM *ZEROS    PICEND                                              CGL031
     C                     PARM WWEVAM    PTOTIN                                              CGL031
     C                     PARM TBTRAB    PTXRAB                                              CGL031
     C                     PARM WONMCY    POCCY                                               CGL031
     C                     PARM *BLANKS   PINTH                                               CER048
      *                                                                                       CGL031
      ** Output parameters                                                                    CGL031
      *                                                                                       CGL031
     C                     PARM           PIEDAT                                              CGL031
     C                     PARM           PTXAMT                                              CGL031
     C                     PARM           PTOTO                                               CGL031
     C                     PARM           PTXCCY                                              CGL031
     C                     PARM           PCTTX                                               CGL031
     C                     PARM           PTXBS                                               CGL031
     C                     PARM           PEUTXC                                              CGL031
     C                     PARM           PCLOC                                               CGL031
     C                     PARM           PCSTAT                                              CGL031
     C                     PARM           PTTEND                                              CGL031
     C                     PARM           PTXRP1                                              CGL031
     C                     PARM           PJAMG   1                                           CGL031
     C**********           PARM *ZEROS    PSTXB                                      CER048 BUG22911
     C**********           PARM *ZEROS    PSTAC                                      CER048 BUG22911
     C**********           PARM *ZEROS    PSTTR                                      CER048 BUG22911
     C**********           PARM *BLANKS   PSTTP                                      CER048 BUG22911
     C**********           PARM *ZEROS    PSTXA                                      CER048 BUG22911
     C                     PARM           PDBKEY                                              CGL031
     C                     PARM           PDBFIL                                              CGL031
     C                     PARM           PRTRN                                               CGL031
     C           SDTXPA    PARM SDTXPA    DSSDY                                             BUG22911
      *                                                                                       CGL031
     C                     ENDSR                                                              CGL031
      *                                                                                       CGL031
      *****************************************************************                       CGL031
      /EJECT                                                                                  CGL031
      *****************************************************************                       CGL031
      *  SRETAX -  Generate output if Tax has been computed.          *                       CGL031
      *  ------                                                       *                       CGL031
      *  Called by : SRCALI SRCALJ                                    *                       CGL031
      *  Calls     : SRCSIN SRSACK                                    *                       CGL031
      *****************************************************************                       CGL031
      *                                                                                       CGL031
     C           SRETAX    BEGSR                                                              CGL031
      *                                                                                       CGL031
      ** If Tax was calculated and Customer Stat is 'TAXAB', 'DISCL'                          CGL031
      ** or 'SELF' create record in SDCSINPD and generate account key                         CGL031
      *                                                                                       CGL031
     C           PCSTAT    IFEQ 'TAXAB'                                                       CGL031
     C           PCSTAT    OREQ 'DISCL'                                                       CGL031
     C           PCSTAT    OREQ 'SELF'                                                        CGL031
     C                     EXSR SRCSIN                                                        CGL031
     C                     EXSR SRSACK                                                        CGL031
     C                     ENDIF                                                              CGL031
      *                                                                                       CGL031
     C                     ENDSR                                                              CGL031
      *                                                                                       CGL031
      *****************************************************************                       CGL031
      /EJECT                                                                                  CGL031
      *****************************************************************                       CGL031
      *  SRCSIN - Setup and write Customer Income details to SDCSINPD *                       CGL031
      *  ------                                                       *                       CGL031
      *  Called by : SRDVTX                                           *                       CGL031
      *  Calls     : *PSSR                                            *                       CGL031
      *****************************************************************                       CGL031
      *                                                                                       CGL031
     C           SRCSIN    BEGSR                                                              CGL031
      *                                                                                       CGL031
      ** Initialise PF/SDCSINPD fields                                                        CGL031
      *                                                                                       CGL031
     C                     MOVE '000000'  TSCUST                                              CGL031
     C**********           Z-ADD*ZEROS    TSJOIN                                      CGL031 CSD027A
     C                     MOVE *BLANKS   TSJOIN                                             CSD027A
     C                     MOVE *BLANKS   TSNAHO                                              CGL031
     C                     MOVE *BLANKS   TSINVP                                              CGL031
     C                     MOVE *BLANKS   TSFAMN                                              CGL031
     C                     MOVE *BLANKS   TSFIRN                                              CGL031
     C                     MOVE *BLANKS   WSTRT                                               CGL031
     C                     MOVE *BLANKS   TSSTRT                                              CGL031
     C                     MOVE *BLANKS   TSZIPC                                              CGL031
     C                     MOVE *BLANKS   TSCITY                                              CGL031
     C                     MOVE *BLANKS   TSRTIN                                              CGL031
     C                     MOVE *BLANKS   TSDBTH                                              CGL031
     C                     MOVE *BLANKS   TSTBTH                                              CGL031
     C                     MOVE *BLANKS   TSIPDT                                              CGL031
     C                     Z-ADD*ZEROS    TSTXBS                                              CGL031
     C                     MOVE *BLANKS   WINST1                                              CGL031
     C                     MOVE *BLANKS   TSINST                                              CGL031
     C                     MOVE *BLANKS   TSTRTP                                              CGL031
     C                     MOVE *BLANKS   TSTRST                                              CGL031
     C                     Z-ADD*ZEROS    TSDLLN                                              CGL031
     C                     Z-ADD*ZEROS    TSACOD                                              CGL031
     C                     Z-ADD*ZEROS    TSACSQ                                              CGL031
     C                     MOVE *BLANKS   TSIBAN                                              CGL031
     C                     MOVE *BLANKS   TSSESN                                              CGL031
     C                     MOVE *BLANKS   TSSRPN                                              CGL031
     C                     MOVE *BLANKS   TSISIN                                              CGL031
      *                                                                                       CER048
     C           CER048    IFEQ 'Y'                                                           CER048
      *                                                                                       CER048
     C                     MOVE *ZEROS    TSSTXB                                              CER048
     C                     MOVE *ZEROS    TSSTAC                                              CER048
     C                     MOVE *ZEROS    TSSTRT                                              CER048
     C                     MOVE *ZEROS    TSSTDO                                              CER048
     C                     MOVE *ZEROS    TSSTDS                                              CER048
     C                     MOVE *ZEROS    TSSTDT                                              CER048
     C                     MOVE *ZEROS    TSSTDB                                              CER048
     C                     MOVE *ZEROS    TSPTHU                                              CER048
     C                     MOVE *ZEROS    TSPTUT                                              CER048
      *                                                                                       CER048
     C                     ENDIF                                                              CER048
      *                                                                                       CGL031
      ** Populate fields                                                                      CGL031
      *                                                                                       CGL031
     C                     Z-ADDBJRDNB    TSRDNB                                              CGL031
     C                     Z-ADDMAEVDT    TSEDAT                                              CGL031
     C           BJDFIN    IFEQ 'D'                                                           CGL031
     C                     MOVE '0'       *IN98                                               CGL031
     C                     ELSE                                                               CGL031
     C                     MOVE '1'       *IN98                                               CGL031
     C                     ENDIF                                                              CGL031
     C                     Z-ADDMAEVDT    ZDAYNO                                              CGL031
     C                     MOVE ZDATE     TSTAXY                                              CGL031
     C                     MOVEL'20'      TSTAXY                                              CGL031
      *                                                                                       CGL031
     C           *IN98     IFEQ '0'                                                           CGL031
     C                     MOVELZDATE     WSTR4   40                                          CGL031
     C                     MOVE WSTR4     TSTAXM                                              CGL031
     C                     ELSE                                                               CGL031
     C                     MOVELZDATE     TSTAXM                                              CGL031
     C                     ENDIF                                                              CGL031
      *                                                                                       CGL031
     C                     MOVE PCTTX     TSCTRT                                              CGL031
     C                     MOVE PBRCA     TSBRCA                                              CGL031
     C                     MOVE PCNUM     TSCUST                                              CGL031
     C                     SELEC                                                              CGL031
     C           PCSTAT    WHEQ 'DISCL'                                                       CGL031
     C                     MOVE 'D'       TSSTAT                                              CGL031
     C           PCSTAT    WHEQ 'SELF'                                                        CGL031
     C                     MOVE 'S'       TSSTAT                                              CGL031
     C           PCSTAT    WHEQ 'TAXAB'                                                       CGL031
     C                     MOVE 'T'       TSSTAT                                              CGL031
     C                     ENDSL                                                              CGL031
      *                                                                                       CGL031
     C                     MOVE PCLOC     TSRCTR                                              CGL031
     C                     Z-ADDMAEVDT    @@DAYN  50                                          CGL031
     C                     EXSR ZDATE9                                                        CGL031
     C                     MOVE @@VDT     TSIPDT                                              CGL031
     C                     MOVE PTXBS     TSTXBS                                              CGL031
     C                     Z-ADDPEUTXC    TSWTAC                                              CGL031
     C                     MOVE POCCY     TSOCCY                                              CGL031
      *                                                                                       CGL031
     C                     CALL 'AOCURRR0'                                                    CGL031
     C                     PARM *BLANKS   PRTCD                                               CGL031
     C                     PARM '*KEY  '  POPTN                                               CGL031
     C                     PARM TSOCCY    PCYCD   3                                           CGL031
     C           SDCURR    PARM SDCURR    DSSDY                                               CGL031
     C           PRTCD     IFNE *BLANKS                                                       CGL031
     C           *LOCK     IN   LDA                                                           CGL031
     C                     Z-ADD108       DBASE                                               CGL031
     C                     MOVE *BLANKS   DBFILE                                              CGL031
     C                     MOVEL'SDCURRPD'DBFILE                                              CGL031
     C                     MOVELTSOCCY    DBKEY                                               CGL031
     C                     OUT  LDA                                                           CGL031
     C                     EXSR *PSSR                                                         CGL031
     C                     ENDIF                                                              CGL031
     C           A6MDIN    IFEQ 'D'                                                           CGL031
     C                     Z-ADDA6SPRT    TSOCSR                                              CGL031
     C                     ELSE                                                               CGL031
     C           1         DIV  A6SPRT    TSOCSR                                              CGL031
     C                     ENDIF                                                              CGL031
      *                                                                                       CGL031
     C                     MOVE 'D'       TSOCMD                                              CGL031
     C                     Z-ADDA6NBDP    TSOCDP                                              CGL031
     C                     MOVE TSOCCY    TSSCCY                                              CGL031
     C                     Z-ADDTSOCSR    TSSCSR                                              CGL031
     C                     MOVE TSOCMD    TSSCMD                                              CGL031
     C                     Z-ADDTSOCDP    TSSCDP                                              CGL031
     C                     MOVE PTXCCY    TSTXCY                                              CGL031
      *                                                                                       CGL031
     C                     CALL 'AOCURRR0'                                                    CGL031
     C                     PARM *BLANKS   PRTCD                                               CGL031
     C                     PARM '*KEY  '  POPTN                                               CGL031
     C                     PARM TSTXCY    PCYCD                                               CGL031
     C           SDCURR    PARM SDCURR    DSSDY                                               CGL031
     C           @RTCD     IFNE *BLANKS                                                       CGL031
     C           *LOCK     IN   LDA                                                           CGL031
     C                     Z-ADD109       DBASE                                               CGL031
     C                     MOVE *BLANKS   DBFILE                                              CGL031
     C                     MOVEL'SDCURRPD'DBFILE                                              CGL031
     C                     MOVELTSTXCY    DBKEY                                               CGL031
     C                     OUT  LDA                                                           CGL031
     C                     EXSR *PSSR                                                         CGL031
     C                     ENDIF                                                              CGL031
     C           A6MDIN    IFEQ 'D'                                                           CGL031
     C                     Z-ADDA6SPRT    TSTCSR                                              CGL031
     C                     ELSE                                                               CGL031
     C           1         DIV  A6SPRT    TSTCSR                                              CGL031
     C                     ENDIF                                                              CGL031
      *                                                                                       CGL031
     C                     MOVE 'D'       TSTCMD                                              CGL031
     C                     Z-ADDA6NBDP    TSTCDP                                              CGL031
      *                                                                                       CGL031
     C           MCTRRF    CHAINTRADS                80                                       CGL031
     C                     Z-ADDTDER      TSXROS                                              CGL031
     C                     MOVE TMDI      TSOSMD                                              CGL031
      *                                                                                       CGL031
     C                     Z-ADDTSSCSR    ZRATE1                                              CGL031
     C                     MOVE TSSCMD    ZMDI1                                               CGL031
     C                     Z-ADDTSTCSR    ZRATE2                                              CGL031
     C                     MOVE TSTCMD    ZMDI2                                               CGL031
     C                     EXSR ZXRATE                                                        CGL031
     C                     Z-ADDZRATEX    TSXRST                                              CGL031
     C                     MOVE ZMDIX     TSSTMD                                              CGL031
      *                                                                                       CGL031
     C                     MOVE 'S'       TSMODI                                              CGL031
     C                     MOVELMCSESN    WINST1                                              CGL031
     C                     MOVELWCINST    WINST2                                              CGL031
     C                     MOVELWINST     TSINST                                              CGL031
     C                     MOVE 'DV'      TSETYP                                              CGL031
      *                                                                                       CGL031
     C           MCSESN    CHAINSECTY                80                                       CGL031
     C                     MOVELSESN      TSSESN                                              CGL031
     C                     MOVELSRPN      TSSRPN                                              CGL031
     C                     MOVELISNO      TSISIN                                              CGL031
      *                                                                                       CGL031
     C                     Z-ADDPTOTO     TSPAMT                                              CGL031
     C                     Z-ADDPTOTO     TSGINT                                              CGL031
     C                     Z-ADDPTXRAB    TSTXRT                                              CGL031
     C                     Z-ADDPTXAMT    TSTXSR                                              CGL031
     C           TSGINT    SUB  TSTXSR    TSNINT                                              CGL031
      *                                                                                       CGL031
     C           TSOCCY    IFEQ TSSCCY                                                        CGL031
     C                     Z-ADDTSPAMT    TSPAMS                                              CGL031
     C                     Z-ADDPTOTO     TSGINS                                              CGL031
     C                     Z-ADDPTXAMT    TSTXSS                                              CGL031
      *                                                                                       CGL031
     C                     ELSE                                                               CGL031
     C                     Z-ADDTSPAMT    ZAMTF                                               CGL031
     C                     Z-ADDTSXROS    ZCRSRT                                              CGL031
     C                     MOVE TSOSMD    ZCRSMD                                              CGL031
     C                     Z-ADDTSOCDP    ZCDPF                                               CGL031
     C                     Z-ADDTSSCDP    ZCDPT                                               CGL031
     C                     EXSR ZCCYXR                                                        CGL031
     C                     Z-ADDZAMTT     TSPAMS                                              CGL031
      *                                                                                       CGL031
     C                     Z-ADDPTOTO     ZAMTF                                               CGL031
     C                     Z-ADDTSXROS    ZCRSRT                                              CGL031
     C                     MOVE TSOSMD    ZCRSMD                                              CGL031
     C                     Z-ADDTSOCDP    ZCDPF                                               CGL031
     C                     Z-ADDTSSCDP    ZCDPT                                               CGL031
     C                     EXSR ZCCYXR                                                        CGL031
     C                     Z-ADDZAMTT     TSGINS                                              CGL031
      *                                                                                       CGL031
     C                     Z-ADDPTXAMT    ZAMTF                                               CGL031
     C                     Z-ADDTSXROS    ZCRSRT                                              CGL031
     C                     MOVE TSOSMD    ZCRSMD                                              CGL031
     C                     Z-ADDTSOCDP    ZCDPF                                               CGL031
     C                     Z-ADDTSSCDP    ZCDPT                                               CGL031
     C                     EXSR ZCCYXR                                                        CGL031
     C                     Z-ADDZAMTT     TSTXSS                                              CGL031
     C                     ENDIF                                                              CGL031
      *                                                                                       CGL031
     C           TSGINC    SUB  TSTXSS    TSNINS                                              CGL031
      *                                                                                       CGL031
     C           TSSCCY    IFEQ TSTXCY                                                        CGL031
     C                     Z-ADDTSPAMS    TSPAMC                                              CGL031
     C                     Z-ADDTSGINS    TSGINC                                              CGL031
     C                     Z-ADDTSTXSS    TSTXSC                                              CGL031
      *                                                                                       CGL031
     C                     ELSE                                                               CGL031
     C                     Z-ADDTSPAMS    ZAMTF                                               CGL031
     C                     Z-ADDTSXRST    ZCRSRT                                              CGL031
     C                     MOVE TSSTMD    ZCRSMD                                              CGL031
     C                     Z-ADDTSSCDP    ZCDPF                                               CGL031
     C                     Z-ADDTSTCDP    ZCDPT                                               CGL031
     C                     EXSR ZCCYXR                                                        CGL031
     C                     Z-ADDZAMTT     TSPAMC                                              CGL031
      *                                                                                       CGL031
     C                     Z-ADDTSGINS    ZAMTF                                               CGL031
     C                     Z-ADDTSXRST    ZCRSRT                                              CGL031
     C                     MOVE TSSTMD    ZCRSMD                                              CGL031
     C                     Z-ADDTSSCDP    ZCDPF                                               CGL031
     C                     Z-ADDTSTCDP    ZCDPT                                               CGL031
     C                     EXSR ZCCYXR                                                        CGL031
     C                     Z-ADDZAMTT     TSGINC                                              CGL031
      *                                                                                       CGL031
     C                     Z-ADDTSTXSS    ZAMTF                                               CGL031
     C                     Z-ADDTSXRST    ZCRSRT                                              CGL031
     C                     MOVE TSSTMD    ZCRSMD                                              CGL031
     C                     Z-ADDTSSCDP    ZCDPF                                               CGL031
     C                     Z-ADDTSTCDP    ZCDPT                                               CGL031
     C                     EXSR ZCCYXR                                                        CGL031
     C                     Z-ADDZAMTT     TSTXSC                                              CGL031
     C                     ENDIF                                                              CGL031
      *                                                                                       CGL031
     C           TSGINC    SUB  TSTXSC    TSNINC                                              CGL031
      *                                                                                       CGL031
     C           TSSCCY    IFEQ BJCYCD                                                        CGL031
     C                     Z-ADDTSPAMS    TSPAMB                                              CGL031
     C                     Z-ADDTSGINS    TSGINB                                              CGL031
     C                     Z-ADDTSTXSS    TSTXSB                                              CGL031
      *                                                                                       CGL031
     C                     ELSE                                                               CGL031
     C                     Z-ADDTSPAMS    ZAMTF                                               CGL031
     C                     Z-ADDTSSCSR    ZCRSRT                                              CGL031
     C                     MOVE TSSCMD    ZCRSMD                                              CGL031
     C                     Z-ADDTSSCDP    ZCDPF                                               CGL031
     C                     Z-ADDZCDPI     ZCDPT                                               CGL031
     C                     EXSR ZCCYXR                                                        CGL031
     C                     Z-ADDZAMTT     TSPAMB                                              CGL031
      *                                                                                       CGL031
     C                     Z-ADDTSGINS    ZAMTF                                               CGL031
     C                     Z-ADDTSSCSR    ZCRSRT                                              CGL031
     C                     MOVE TSSCMD    ZCRSMD                                              CGL031
     C                     Z-ADDTSSCDP    ZCDPF                                               CGL031
     C                     Z-ADDZCDPI     ZCDPT                                               CGL031
     C                     EXSR ZCCYXR                                                        CGL031
     C                     Z-ADDZAMTT     TSGINB                                              CGL031
      *                                                                                       CGL031
     C                     Z-ADDTSTXSS    ZAMTF                                               CGL031
     C                     Z-ADDTSSCSR    ZCRSRT                                              CGL031
     C                     MOVE TSSCMD    ZCRSMD                                              CGL031
     C                     Z-ADDTSSCDP    ZCDPF                                               CGL031
     C                     Z-ADDZCDPI     ZCDPT                                               CGL031
     C                     EXSR ZCCYXR                                                        CGL031
     C                     Z-ADDZAMTT     TSTXSB                                              CGL031
     C                     ENDIF                                                              CGL031
      *                                                                                       CGL031
     C           TSGINB    SUB  TSTXSB    TSNINB                                              CGL031
     C                     MOVE 'N'       TSINPR                                              CGL031
      *                                                                                       CGL031
      ** Fields depending on whether they are Individual or Joint                             CGL031
      *                                                                                       CGL031
     C           WJOINT    IFEQ 'N'                                                           CGL031
     C           PCNUM     CHAINSDACUSL1             80                                       CGL031
     C                     MOVELE5CNA1    TSFAMN                                              CGL031
     C                     MOVELE5CNA2    TSFIRN                                              CGL031
     C                     MOVELE5CNA3    WADDR3                                              CGL031
     C                     MOVELE5CNA4    WADDR4                                              CGL031
     C                     MOVELWSTRT     TSSTRT                                              CGL031
     C                     MOVELE5ZIPC    TSZIPC                                              CGL031
     C                     MOVELE5CITY    TSCITY                                              CGL031
     C                     MOVELE5TINO    TSRTIN                                              CGL031
     C                     MOVE E5DBTH    TSDBTH                                              CGL031
     C                     MOVE E5BTHT    TSTBTH                                              CGL031
     C                     MOVE E5BTHC    TSCBTH                                              CGL031
      *                                                                                       CGL031
     C                     ELSE                                                               CGL031
     C           PNAHO     CHAINSDNAHOL1             80                                       CGL031
     C                     MOVE PJANO     TSJOIN                                              CGL031
     C                     MOVE PNAHO     TSNAHO                                              CGL031
     C                     MOVE PINVP     TSINVP                                              CGL031
     C                     MOVELNHIDE1    TSFAMN                                              CGL031
     C                     MOVELNHIDE2    TSFIRN                                              CGL031
     C                     MOVELNHIDE3    WADDR3                                              CGL031
     C                     MOVELNHIDE4    WADDR4                                              CGL031
     C                     MOVELWSTRT     TSSTRT                                              CGL031
     C                     MOVELNHZIPC    TSZIPC                                              CGL031
     C                     MOVELNHCITY    TSCITY                                              CGL031
     C                     MOVELNHTINO    TSRTIN                                              CGL031
     C                     MOVE NHDBTH    TSDBTH                                              CGL031
     C                     MOVE NHBTHT    TSTBTH                                              CGL031
     C                     MOVE NHBTHC    TSCBTH                                              CGL031
     C                     ENDIF                                                              CGL031
      *                                                                                       CGL031
      ** Write record to SDCSINPD                                                             CGL031
      *                                                                                       CGL031
     C                     WRITESDCSIND0                                                      CGL031
      *                                                                                       CGL031
      ** Accumulate relevant amounts for net total                                            CGL031
      *                                                                                       CGL031
     C           TSSTAT    IFEQ 'T'                                                           CGL031
     C                     ADD  TSTXSR    WTTXSR 150                                          CGL031
     C                     ADD  TSTXSC    WTTXSC 150                                          CGL031
     C                     ADD  TSTXSB    WTTXSB 150                                          CGL031
     C                     ADD  TSNINT    WTNINT 150                                          CGL031
     C                     ADD  TSNINC    WTNINC 150                                          CGL031
     C                     ADD  TSNINB    WTNINB 150                                          CGL031
     C                     ENDIF                                                              CGL031
      *                                                                                       CGL031
     C                     ENDSR                                                              CGL031
      *****************************************************************                       CGL031
      /EJECT                                                                                  CGL031
      *****************************************************************                       CGL031
      *  SRSACK - Setup Account Keys and Amount fields for            *                       CGL031
      *  ------   Customer Tax                                        *                       CGL031
      *  Called by : #PDPRD                                           *                       CGL031
      *  Calls     : ZHASH #AOSEC #COAT SRWACK                        *                       CGL031
      *****************************************************************                       CGL031
      *                                                                                       CGL031
     C           SRSACK    BEGSR                                                              CGL031
      *                                                                                       CGL031
      ***  Tax Account Key Generation                                                         CGL031
      *                                                                                       CGL031
      ***  Write key Cash Income Due - Customer                                               CGL031
      *                                                                                       CGL031
     C                     CLEARWACKEY                                                        CGL031
      *                                                                                       CGL031
      ** .. Event Amount = Cumulated Tax Deducted at Source in Tax CCY                        CGL031
     C                     Z-ADDWTTXSC    WWEVAM                                              CGL031
      *                                                                                       CGL031
      ***  EXECUTE HASH TOTALLING SUBROUTINE ONCE (Z=1) FOR FIRST                             CGL031
      ***  ARRAY ELEMENTS (IND,S DEC,S) SO S=1 ,ACCUMULATING ZZAMT(15/3)                      CGL031
      *                                                                                       CGL031
     C                     Z-ADD1         Z                                                   CGL031
     C                     Z-ADD1         S                                                   CGL031
     C                     Z-ADDWWEVAM    ZZAMT                                               CGL031
     C                     EXSR ZHASH                                                         CGL031
      ** .. Account Key (iiiH-d--yy--mvn---DI)             Positions                          CGL031
     C                     MOVE WOSITP    WACITY           (1 - 3)                            CGL031
     C                     MOVE 'E'       WACEVC           (4)                                CGL031
     C                     MOVE TSCTRT    WACTRT           (5)                                CGL031
      *                                                                                       CGL031
      ***  If Classification is 'S' or 'D'                                                    CGL031
      ***  Issuer is not necessary a SE client defined on PF/SDSECSPD                         CGL031
      ***  So, no DB error if record not found !!!                                            CGL031
      *                                                                                       CGL031
     C                     MOVE MCCNUM    WCUST                                               CGL031
      *                                                                                       CGL031
     C                     CALL 'AOSECSR0'                                                    CGL031
     C                     PARM *BLANKS   @RTCD                                               CGL031
     C                     PARM '*KEY   ' @OPTN                                               CGL031
     C                     PARM WCUST     @SCKY                                               CGL031
     C           SDSECS    PARM SDSECS    DSSDY                                               CGL031
      *                                                                                       CGL031
     C                     MOVE *BLANKS   WACPFI           (6)                                CGL031
     C           @RTCD     IFEQ *BLANKS                                                       CGL031
     C           BFCLAS    ANDEQ'S'                                                           CGL031
     C           @RTCD     OREQ *BLANKS                                                       CGL031
     C           BFCLAS    ANDEQ'D'                                                           CGL031
     C                     MOVE BFCLAS    WACPFI           (6)                                CGL031
     C                     ENDIF                                                              CGL031
      *                                                                                       CGL031
     C                     MOVE *BLANKS   WACBKC           (7 - 8)                            CGL031
     C           BVCOTA    IFEQ 'Y'                                                           CGL031
     C                     MOVE MCCOAT    WKCOAT                                              CGL031
     C                     EXSR #COAT                                                         CGL031
     C                     MOVE MMTSUB    WACTST           (9 - 10)                           CGL031
     C                     ELSE                                                               CGL031
     C                     MOVE *BLANKS   WACTST           (9 - 10)                           CGL031
     C                     ENDIF                                                              CGL031
     C                     MOVE *BLANKS   WACCCC           (11 - 12)                          CGL031
     C                     MOVE WOMKTI    WACMKT           (13)                               CGL031
      *                                                                                       CGL031
     C           BVCIAK    IFEQ 'Y'                                                           CGL031
     C           WOSCVI    ANDEQ'Y'                                                           CGL031
     C                     MOVE WOSCVI    WACCON           (14)                               CGL031
     C                     ELSE                                                               CGL031
     C                     MOVE *BLANKS   WACCON           (14)                               CGL031
     C                     ENDIF                                                              CGL031
      *                                                                                       CGL031
     C           BVNPAC    IFEQ 'N'                                                           CGL031
     C           WWEVAM    ORGE *ZERO                                                         CGL031
     C                     MOVE *BLANKS   WACNEG           (15)                               CGL031
     C                     ELSE                                                               CGL031
     C                     MOVE 'N'       WACNEG           (15)                               CGL031
     C                     ENDIF                                                              CGL031
      *                                                                                       CGL031
     C                     MOVE *BLANKS   WABLCK           (16 - 18)                          CGL031
     C                     MOVE 'ET'      WACAMC           (19 - 20)                          CGL031
      *                                                                                       CGL031
     C                     Z-ADD*ZEROS    WWKBCA 150                                          CGL031
     C                     Z-ADD*ZEROS    WWKNCA 150                                          CGL031
      *                                                                                       CGL031
     C           TSTXCY    IFNE TSOCCY                                                        CGL031
     C                     Z-ADDWTTXSB    WWKBCA                                              CGL031
     C                     Z-ADDWTTXSR    WWKNCA                                              CGL031
     C                     ENDIF                                                              CGL031
      *                                                                                       CGL031
      ***  Write Account Key record for The customer                                          CGL031
      *                                                                                       CGL031
     C                     EXSR SRWACK                                                        CGL031
      *                                                                                       CGL031
      ** Net Interest Amount Account Key Generation                                           CGL031
      *                                                                                       CGL031
      ***  Write key Cash Amount Due - Customer                                               CGL031
      *                                                                                       CGL031
     C                     CLEARWACKEY                                                        CGL031
      *                                                                                       CGL031
      ** .. Event Amount = Cumulated Net Interest Amount in Tax CCY                           CGL031
     C                     Z-ADDWTNINC    WWEVAM                                              CGL031
      *                                                                                       CGL031
      ***  EXECUTE HASH TOTALLING SUBROUTINE ONCE (Z=1) FOR FIRST                             CGL031
      ***  ARRAY ELEMENTS (IND,S DEC,S) SO S=1 ,ACCUMULATING ZZAMT(15/3)                      CGL031
      *                                                                                       CGL031
     C                     Z-ADD1         Z                                                   CGL031
     C                     Z-ADD1         S                                                   CGL031
     C                     Z-ADDWWEVAM    ZZAMT                                               CGL031
     C                     EXSR ZHASH                                                         CGL031
      ** .. Account Key (iiiH-d--yy--mvn---DI)             Positions                          CGL031
     C                     MOVE WOSITP    WACITY           (1 - 3)                            CGL031
     C                     MOVE 'E'       WACEVC           (4)                                CGL031
     C                     MOVE *BLANKS   WACTRT           (5)                                CGL031
      *                                                                                       CGL031
      ***  If Classification is 'S' or 'D'                                                    CGL031
      ***  Issuer is not necessary a SE client defined on PF/SDSECSPD                         CGL031
      ***  So, no DB error if record not found !!!                                            CGL031
      *                                                                                       CGL031
     C                     MOVE MCCNUM    WCUST                                               CGL031
      *                                                                                       CGL031
     C                     CALL 'AOSECSR0'                                                    CGL031
     C                     PARM *BLANKS   @RTCD                                               CGL031
     C                     PARM '*KEY   ' @OPTN                                               CGL031
     C                     PARM WCUST     @SCKY                                               CGL031
     C           SDSECS    PARM SDSECS    DSSDY                                               CGL031
      *                                                                                       CGL031
     C                     MOVE *BLANKS   WACPFI           (6)                                CGL031
     C           @RTCD     IFEQ *BLANKS                                                       CGL031
     C           BFCLAS    ANDEQ'S'                                                           CGL031
     C           @RTCD     OREQ *BLANKS                                                       CGL031
     C           BFCLAS    ANDEQ'D'                                                           CGL031
     C                     MOVE BFCLAS    WACPFI           (6)                                CGL031
     C                     ENDIF                                                              CGL031
      *                                                                                       CGL031
     C                     MOVE *BLANKS   WACBKC           (7 - 8)                            CGL031
     C           BVCOTA    IFEQ 'Y'                                                           CGL031
     C                     MOVE MCCOAT    WKCOAT                                              CGL031
     C                     EXSR #COAT                                                         CGL031
     C                     MOVE MMTSUB    WACTST           (9 - 10)                           CGL031
     C                     ELSE                                                               CGL031
     C                     MOVE *BLANKS   WACTST           (9 - 10)                           CGL031
     C                     ENDIF                                                              CGL031
     C                     MOVE *BLANKS   WACCCC           (11 - 12)                          CGL031
     C                     MOVE WOMKTI    WACMKT           (13)                               CGL031
      *                                                                                       CGL031
     C           BVCIAK    IFEQ 'Y'                                                           CGL031
     C           WOSCVI    ANDEQ'Y'                                                           CGL031
     C                     MOVE WOSCVI    WACCON           (14)                               CGL031
     C                     ELSE                                                               CGL031
     C                     MOVE *BLANKS   WACCON           (14)                               CGL031
     C                     ENDIF                                                              CGL031
      *                                                                                       CGL031
     C           BVNPAC    IFEQ 'N'                                                           CGL031
     C           WWEVAM    ORGE *ZERO                                                         CGL031
     C                     MOVE *BLANKS   WACNEG           (15)                               CGL031
     C                     ELSE                                                               CGL031
     C                     MOVE 'N'       WACNEG           (15)                               CGL031
     C                     ENDIF                                                              CGL031
      *                                                                                       CGL031
     C                     MOVE *BLANKS   WABLCK           (16 - 18)                          CGL031
     C                     MOVE 'NI'      WACAMC           (19 - 20)                          CGL031
      *                                                                                       CGL031
     C           TSTXCY    IFNE TSOCCY                                                        CGL031
     C                     Z-ADDWTNINT    WWKNCA                                              CGL031
     C                     Z-ADDWTNINB    WWKBCA                                              CGL031
     C                     ENDIF                                                              CGL031
      *                                                                                       CGL031
      ***  Write Account Key record for The customer                                          CGL031
      *                                                                                       CGL031
     C                     EXSR SRWACK                                                        CGL031
     C                     ENDSR                                                              CGL031
      *                                                                                       CGL031
      *****************************************************************                       CGL031
      /EJECT                                                                                  CGL031
      *****************************************************************                       CGL031
      *  SRWACK - Write an account key for Customer Tax               *                       CGL031
      *  ------                                                       *                       CGL031
      *  Called by : SRWACK                                           *                       CGL031
      *  Calls     : ZSETAC                                           *                       CGL031
      *****************************************************************                       CGL031
      *                                                                                       CGL031
     C           SRWACK    BEGSR                                                              CGL031
      *                                                                                       CGL031
     C                     CLEARSEKEYDF                                                       CGL031
      ** .. Account key                                                                       CGL031
     C                     MOVELWACKEY    ACKY                                                CGL031
      ** .. Trade Reference                                                                   CGL031
     C                     Z-ADD*ZERO     TRFR                                                CGL031
      ** .. Customer Number                                                                   CGL031
     C**********           Z-ADDMCCNUM    CSTN                                        CGL031 CSD027A
     C                     MOVE MCCNUM    CSTN                                               CSD027A
      ** .. Booking branch                                                                    CGL031
     C                     MOVE MCBRCD    BRHA                                                CGL031
      ** .. A/C Sequence                                                                      CGL031
     C                     Z-ADD*ZERO     ASQN                                                CGL031
      ** .. Event Date                                                                        CGL031
     C                     Z-ADDMAEVDT    EVDT                                                CGL031
      ** .. Event Amount                                                                      CGL031
     C                     Z-ADDWWEVAM    EVAM                                                CGL031
      ** .. Event Ccy                                                                         CGL031
     C           MAPTYP    IFNE 'CC'                                                          CGL031
     C                     MOVE WONMCY    EVCY                                                CGL031
     C                     ELSE                                                               CGL031
     C                     MOVE NANCCY    EVCY                                                CGL031
     C                     ENDIF                                                              CGL031
      *                                                                                       CGL031
     C           TSTXCY    IFNE TSOCCY                                                        CGL031
     C                     MOVE TSTXCY    EVCY                                                CGL031
     C                     ENDIF                                                              CGL031
      ** .. Settlement Type                                                                   CGL031
     C                     Z-ADD*ZERO     STLT                                                CGL031
      ** .. Settlement Account                                                                CGL031
     C                     MOVE *BLANKS   STLA                                                CGL031
      ** .. Settlement Branch                                                                 CGL031
     C                     MOVE *BLANKS   SEBR                                                CGL031
      *                                                                                       CGL031
     C           EXBCSI    IFEQ 'Y'                        Standard Instruction exist         CGL031
      *                                                                                       CGL031
      ** .. Settlement Type                                                                   CGL031
     C                     Z-ADDMOSMET    STLT                                                CGL031
      ** .. Settlement Account                                                                CGL031
     C                     MOVE MOSACC    STLA                                                CGL031
      ** .. Settlement Branch                                                                 CGL031
     C                     MOVE MOSBRC    SEBR                                                CGL031
      *                                                                                       CGL031
     C                     ELSE                                                               CGL031
      *                                                                                       CGL031
     C           BGPFMG    IFNE 'Y'                        Portfolio Management OFF           CGL031
     C           BGN4ST    ANDNE'Y'                                       CPB001              CGL031
      *                                                                                       CGL031
      ***  For Settlement Instruction access STDSED with key of                               CGL031
      ***  Branch and Customer,SECODPPD, Nominal CCY and Investment                           CGL031
      ***  Type,SECTYD                                                                        CGL031
      *                                                                                       CGL031
     C                     MOVE MCBRCD    WKPBCA           Branch                             CGL031
     C**********           Z-ADDMCCNUM    WKPCPY           Customer                   CGL031 CSD027A
     C                     MOVE MCCNUM    WKPCPY           Customer                          CSD027A
     C                     MOVE WONMCY    WKNMCY           Nominal Ccy                        CGL031
     C                     MOVE WOSITP    WKSITP           Sec. Inv. Type                     CGL031
     C                     MOVE WOSMCC    WKSMCC                                              CGL031
      *                                                                                       CGL031
     C           CSE028    IFEQ 'Y'                                                           CGL031
     C                     MOVE MCBOOK    WKPBCD           Book Code                          CGL031
     C                     MOVE MCPTFR    WKPTFR           Portfolio Reference                CGL031
     C                     ELSE                                                               CGL031
     C                     MOVE *BLANKS   WKPBCD           Book Code                          CGL031
     C                     MOVE *BLANKS   WKPTFR           Portfolio Reference                CGL031
     C                     ENDIF                                                              CGL031
      *                                                                                       CGL031
      ** If CSE028 is on, call SESSIR0 for default of MT5xx information                       CGL031
      *                                                                                       CGL031
     C           CSE028    IFEQ 'Y'                                                           CGL031
      *                                                                                       CGL031
     C                     EXSR SRSSIR                                                        CGL031
     C           NOTFND    IFEQ 'Y'                                                           CGL031
     C                     MOVE '1'       *IN89                                               CGL031
     C                     ELSE                                                               CGL031
     C                     MOVE '0'       *IN89                                               CGL031
     C                     ENDIF                                                              CGL031
      *                                                                                       CGL031
     C                     ELSE                                                               CGL031
      *                                                                                       CGL031
     C           KWSTDS    CHAINSTDSED               89                                       CGL031
     C           *IN89     IFEQ *ON                                                           CGL031
     C                     MOVEL*BLANKS   WKSITP                                              CGL031
     C           KWSTDS    CHAINSTDSED               89                                       CGL031
     C                     ENDIF                                                              CGL031
      *                                                                                       CGL031
     C                     ENDIF                                                              CGL031
      *                                                                                       CGL031
     C           *IN89     IFEQ *OFF                                                          CGL031
      *                                                                                       CGL031
      * CEU005 active and Settlement Ccy used on STDSED.                                      CGL031
     C           CEU005    IFEQ 'Y'                                                           CGL031
     C           SCCY      ANDNE*BLANKS                                                       CGL031
     C                     MOVE SCCY      SVSCCY  3                                           CGL031
      *                                                                                       CGL031
      * Access currencies file for EURO rate, EURO M/D indicator and                          CGL031
      * Transition Date for 'In' Ccy.                                                         CGL031
      *                                                                                       CGL031
     C           WONMCY    IFEQ BKEURO                                                        CGL031
     C                     CALL 'AOCURRR0'                                                    CGL031
     C                     PARM           PRTCD   7                                           CGL031
     C                     PARM '*KEY   ' POPTN   7                                           CGL031
     C                     PARM SCCY      PCYCD   3                                           CGL031
     C           SDCURR    PARM SDCURR    DSSDY                                               CGL031
     C           PRTCD     IFNE *BLANKS                                                       CGL031
     C           *LOCK     IN   LDA                                                           CGL031
     C                     Z-ADD110       DBASE                                               CGL031
     C                     MOVEL'SDCURRPD'DBFILE                                              CGL031
     C                     MOVELSCCY      DBKEY                                               CGL031
     C                     OUT  LDA                                                           CGL031
     C                     EXSR *PSSR                                                         CGL031
     C                     ENDIF                                                              CGL031
     C                     ELSE                                                               CGL031
     C           SCCY      IFEQ BKEURO                                                        CGL031
     C                     CALL 'AOCURRR0'                                                    CGL031
     C                     PARM           PRTCD                                               CGL031
     C                     PARM '*KEY   ' POPTN                                               CGL031
     C                     PARM WONMCY    PCYCD                                               CGL031
     C           SDCURR    PARM SDCURR    DSSDY                                               CGL031
     C           @RTCD     IFNE *BLANKS                                                       CGL031
     C           *LOCK     IN   LDA                                                           CGL031
     C                     Z-ADD111       DBASE                                               CGL031
     C                     MOVEL'SDCURRPD'DBFILE                                              CGL031
     C                     MOVELWONMCY    DBKEY                                               CGL031
     C                     OUT  LDA                                                           CGL031
     C                     EXSR *PSSR                                                         CGL031
     C                     ENDIF                                                              CGL031
     C                     ENDIF                                                              CGL031
     C                     ENDIF                                                              CGL031
      *                                                                                       CGL031
     C                     MOVE A6EUMD    SVEUMD                                              CGL031
     C                     MOVE A6EUER    SVEUER                                              CGL031
      *                                                                                       CGL031
      * Value date is later than Transition Start Date.                                       CGL031
     C           MACOPD    IFGE A6TPSD                                                        CGL031
      * Chain STDSED again.                                                                   CGL031
     C                     MOVE SCCY      WKNMCY           Nominal Ccy                        CGL031
      *                                                                                       CGL031
      ** If CSE028 is on, call SESSIR0 for default of MT5xx information                       CGL031
      *                                                                                       CGL031
     C           CSE028    IFEQ 'Y'                                                           CGL031
      *                                                                                       CGL031
     C                     EXSR SRSSIR                                                        CGL031
     C           NOTFND    IFEQ 'Y'                                                           CGL031
     C                     MOVE '1'       *IN78                                               CGL031
     C                     ELSE                                                               CGL031
     C                     MOVE '0'       *IN78                                               CGL031
     C                     ENDIF                                                              CGL031
      *                                                                                       CGL031
     C                     ELSE                                                               CGL031
      *                                                                                       CGL031
     C           KWSTDS    CHAINSTDSED               78                                       CGL031
      *                                                                                       CGL031
     C                     ENDIF                                                              CGL031
      *                                                                                       CGL031
     C                     ENDIF                                                              CGL031
     C                     ENDIF                                                              CGL031
      *                                                                                       CGL031
      * If no record found ensure fields from last chain not loaded                           CGL031
      * to output fields.                                                                     CGL031
     C           *IN78     IFEQ '0'                                                           CGL031
      ** .. Settlement Type                                                                   CGL031
     C                     Z-ADDSRSM      STLT                                                CGL031
      ** .. Settlement Account                                                                CGL031
     C                     MOVELSRAC      STLA                                                CGL031
      ** .. Settlement Branch                                                                 CGL031
     C                     MOVELSRAB      SEBR                                                CGL031
      *                                                                                       CGL031
      ***  If SRSM = 04 and SRAC = BLANKS the determine settlement A/C                        CGL031
      ***     via SR/ZSETAC  and output to field STLA                                         CGL031
      *                                                                                       CGL031
     C           SRSM      IFEQ 04                                                            CGL031
     C           SRAC      ANDEQ*BLANK                                                        CGL031
      *                                                                                       CGL031
      ***  Pass Parameters to SR/ZSETAC and execute routine                                   CGL031
      *                                                                                       CGL031
     C                     MOVE SRSM      ZMETH                                               CGL031
     C                     MOVE SRAC      ZSETI                                               CGL031
     C                     MOVE MCCNUM    ZCNUM                                               CGL031
     C           CEU005    IFEQ 'Y'                                                           CGL031
     C           SCCY      ANDNE*BLANKS                                                       CGL031
     C                     MOVE SCCY      ZCCY                                                CGL031
     C                     ELSE                                                               CGL031
     C                     MOVE WONMCY    ZCCY                                                CGL031
     C                     ENDIF                                                              CGL031
     C                     MOVE SRAB      ZBRCA                                               CGL031
     C                     EXSR ZSETAC                                                        CGL031
     C                     MOVELZSETO     STLA                                                CGL031
     C                     MOVELZWBRCA    SEBR                                                CGL031
     C                     ENDIF                                                              CGL031
     C                     ENDIF                                                              CGL031
     C                     ENDIF                                                              CGL031
      *                                                                                       CGL031
     C                     ELSE                            Portfolio Management ON            CGL031
     C                     MOVE 'N'       WALCCY  1                                           CGL031
     C                     EXSR #SETIN                                                        CGL031
      *                                                                                       CGL031
      ** If Account found in any of currencies checked                                        CGL031
     C           WSAME     IFEQ *OFF                                                          CGL031
      ** .. Settlement Type                                                                   CGL031
     C                     MOVE '05'      STLT                                                CGL031
      ** .. Settlement Account                                                                CGL031
     C                     MOVELPSEA1     STLA                                                CGL031
      ** .. Settlement Branch                                                                 CGL031
     C                     MOVE BRCA      SEBR                                                CGL031
      *                                                                                       CGL031
     C                     ELSE                                                               CGL031
      *                                                                                       CGL031
      ** .. Settlement Type                                                                   CGL031
     C                     MOVE *BLANKS   STLT                                                CGL031
      ** .. Settlement Account                                                                CGL031
     C                     MOVE *BLANKS   STLA                                                CGL031
      ** .. Settlement Branch                                                                 CGL031
     C                     MOVE *BLANKS   SEBR                                                CGL031
     C                     ENDIF                                                              CGL031
      *                                                                                       CGL031
     C                     ENDIF                                                              CGL031
      *                                                                                       CGL031
     C                     ENDIF                                                              CGL031
      *                                                                                       CGL031
      ** .. Reversal indicator                                                                CGL031
     C           MACHTP    IFEQ 'R'                                                           CGL031
     C                     MOVE '1'       RVRS                                                CGL031
     C                     ELSE                                                               CGL031
     C                     MOVE '0'       RVRS                                                CGL031
     C                     ENDIF                                                              CGL031
      ** .. Issuer                                                                            CGL031
     C**********           Z-ADDWOISSR    ISSR                                        CGL031 CSD027A
     C                     MOVE WOISSR    ISSR                                               CSD027A
      ** .. Tour depot customer                                                               CGL031
     C**********           Z-ADDMCCNUM    KCUST                                       CGL031 CSD027A
     C                     MOVE MCCNUM    KCUST                                              CSD027A
      ** .. Nominal Ccy amount                                                                CGL031
     C                     Z-ADDWWKNCA    KNCA                                                CGL031
      ** .. Nominal Ccy                                                                       CGL031
     C           MAPTYP    IFNE 'CC'                                                          CGL031
     C                     MOVE WONMCY    KCCY                                                CGL031
     C                     ELSE                                                               CGL031
     C                     MOVE NANCCY    KCCY                                                CGL031
     C                     ENDIF                                                              CGL031
      *                                                                                       CGL031
     C           TSTXCY    IFNE TSOCCY                                                        CGL031
     C                     MOVE TSOCCY    KCCY                                                CGL031
     C                     ENDIF                                                              CGL031
      ** .. Base Ccy Amount                                                                   CGL031
      *                    Z-ADDWWKBCA    KBCA                                                CGL031
      ** .. Security Shortname                                                                CGL031
     C           MCSESN    IFEQ '**CASH**'                                                    CGL031
     C                     MOVELMASESN    SESH      P                                         CGL031
     C                     ELSE                                                               CGL031
     C                     MOVELMCSESN    SESH      P                                         CGL031
     C                     ENDIF                                                              CGL031
      ** .. Profit Centre                                                                     CGL031
     C                     MOVE *BLANKS   PRFC                                                CGL031
      *                                                                                       CGL031
      ***   If Profit Centre used                                                             CGL031
      *                                                                                       CGL031
     C           BKPRCU    IFEQ 'Y'                                                           CGL031
      *                                                                                       CGL031
     C                     MOVELCSTN      WKPCPY           Customer                           CGL031
     C                     MOVELBRHA      WKPBCA           Branch                             CGL031
     C                     MOVELSESH      WKPSSH    P      Security                           CGL031
      *                                                                                       CGL031
     C           KWSEPC    CHAINSEPCCDF              89                                       CGL031
     C           *IN89     IFEQ *OFF                                                          CGL031
     C                     MOVELPCCU      PRFC                                                CGL031
     C                     ELSE                                                               CGL031
     C                     MOVELWOSESN    WKDPSS           Event Security                     CGL031
     C           KWSEPC    CHAINSEPCCDF              89                                       CGL031
     C           *IN89     IFEQ *OFF                                                          CGL031
     C                     MOVELPCCU      PRFC                                                CGL031
     C                     ENDIF                                                              CGL031
     C                     ENDIF                                                              CGL031
     C                     ENDIF                                                              CGL031
      *                                                                                       CGL031
      ***  Analytical Accounting module is ON and Profit Centre is ON                         CGL031
      *                                                                                       CGL031
     C           BGN0ST    IFEQ 'Y'                                                           CGL031
     C           PRFC      ANDEQ*BLANKS                                                       CGL031
     C                     MOVE BVSEPC    PRFC                                                CGL031
     C                     ENDIF                                                              CGL031
      ** .. Portfolio Reference                                                               CGL031
     C                     MOVE MCPTFR    PTFR                                                CGL031
      ** .. Trans. Type                                                                       CGL031
     C                     MOVE *BLANKS   PEV1                                                CGL031
      ** .. Transaction number of last update                                                 CGL031
     C                     Z-ADD*ZERO     TNLU                                                CGL031
      ** .. Record ID                                                                         CGL031
     C                     MOVE 'D'       RECI                                                CGL031
      *                                                                                       CGL031
      ***  Write account key record                                                           CGL031
      *                                                                                       CGL031
     C                     WRITESEKEYDF                                                       CGL031
      *                                                                                       CGL031
      ***  Count Records Written                                                              CGL031
      *                                                                                       CGL031
     C                     ADD  1         W01CNT                                              CGL031
     C                     MOVE 'Y'       WWDATA           one Read                           CGL031
      *                                                                                       CGL031
     C                     ENDSR                                                              CGL031
      *                                                                                       CGL031
      *****************************************************************                       CGL031
      /EJECT                                                                                  CGL031
      *****************************************************************
      *  #SELLF -  Select Logical file from the processing type       *
      *  ------                                                       *
      *  Called by : #PDPRD                                           *
      *  Calls     : *PSSR                                            *
      *****************************************************************
      *
     C           #SELLF    BEGSR
      *
     C           WWDPCU    IFEQ 'C'
     C                     MOVE MCCORF    WKCOR2
     C                     MOVE MCOPTN    WKOPT2
     C                     ELSE
     C                     MOVE MBCORF    WKCOR2
     C                     MOVE MBOPTN    WKOPT2
     C                     ENDIF
      *
     C                     SELEC
      *
      ***  Processing type 'DV'
      ***  Access to CO Dividends Events file
      *
     C           MAPTYP    WHEQ 'DV'
     C           KWCOOP    CHAINSECODVL0             47
     C                     MOVE MDRECI    WWRECI  1
     C                     MOVEL'SECODVL0'WWFILE 10
      *
      ***  Processing type 'RG'
      ***  Access to CO
      *
     C           MAPTYP    WHEQ 'RG'
     C           KWCOOP    CHAINSECORGL0             47
     C                     MOVE MFRECI    WWRECI  1
     C                     MOVEL'SECORGL0'WWFILE 10
      *
      ***  Processing type 'OF'
      ***  Access to CO
      *
     C           MAPTYP    WHEQ 'OF'
     C           KWCOOP    CHAINSECOOFL0             47
     C                     MOVE MIRECI    WWRECI  1
     C                     MOVEL'SECOOFL0'WWFILE 10
      *                                                                   CEU017
      ***  Processing type 'CC'                                           CEU017
      ***  Access to CO                                                   CEU017
      *                                                                   CEU017
     C           MAPTYP    WHEQ 'CC'                                      CEU017
     C           WKCOR2    CHAINSECOCCL0             47                   CEU017
     C                     MOVE NARECI    WWRECI  1                       CEU017
     C                     MOVEL'SECOCCL0'WWFILE 10                       CEU017
     C                     ENDSL
      *
     C           *IN47     IFEQ *ON
     C           WWRECI    OREQ '*'
     C           *LOCK     IN   LDA
     C                     Z-ADD2         DBASE            *****************
     C                     MOVEL*BLANKS   DBFILE           ** DB ERROR 02 **
     C                     MOVELWWFILE    DBFILE    P      *****************
     C           MAPTYP    IFNE 'CC'                                      CEU017
     C                     MOVELWWCOOP    DBKEY     P
     C                     ELSE                                           CEU017
     C                     MOVELWKCOR2    DBKEY     P                     CEU017
     C                     ENDIF                                          CEU017
     C                     MOVEL'SE7561'  DBPGM     P
     C                     OUT  LDA
     C                     EXSR *PSSR
     C                     ENDIF
      *
     C                     ENDSR
      *
      *****************************************************************
      /EJECT
      *****************************************************************
      *  #PRDV -  Generate Position Settlement                        *
      *  -----    for processing type 'DV'                            *
      *  Called by : #PDPRD                                           *
      *  Calls     : #WPOSS                                           *
      *****************************************************************
      *
     C           #PRDV     BEGSR
      *
      ***  Check Depot/Customer indicator
      *
     C                     SELEC
      *
      ***  If Depot/Customer indicator is 'D'
      ***  Generate a Position Settlement for the depot
      *
     C           WWDPCU    WHEQ 'D'
      *
      ***  Setup specific field for this processing type
      *
     C*****                MOVE 'R'       WWPPRE           Receive        153674
     C                     Z-ADDMBEXPO    WWEXPO           Ex-Date Position
      *
      ***  Total Cash = Actual Cash Allocation + Cash Rounding
      *
     C                     Z-ADDMBACAA    WWPAMD 170
     C                     ADD  MBACAR    WWPAMD           Total Cash
     C                     Z-ADDMBACAA    WWACAA           Actual Cash Allocation
     C                     Z-ADDMBACAR    WWACAR           Cash Rounding
      *                                                                   153674
     C           WWPAMD    IFGE *ZERO                                     153674
     C                     MOVE 'R'       WWPPRE           Receive        153674
     C                     ELSE                                           153674
     C                     Z-SUBWWPAMD    WWPAMD                          153674
     C                     MOVE 'P'       WWPPRE           Pay            153674
     C                     ENDIF                                          153674
      *
     C                     EXSR #WPOSS
      *
     C           WWDPCU    WHEQ 'C'
      *
      ***  If Depot/Customer indicator 'C'
      ***  Generate a Position Settlement for the customer
      *
      ***  Setup specific field for this processing type
      *
     C*****                MOVE 'R'       WWPPRE           Receive        153674
     C                     Z-ADDMCEXPO    WWEXPO           Ex-Date Position
      *
      ***  Total Cash = Actual Cash Allocation + Cash Rounding
      *
     C                     Z-ADDMCACAA    WWPAMD
     C                     ADD  MCACAR    WWPAMD           Total Cash
     C                     Z-ADDMCACAA    WWACAA           Actual Cash Allocation
     C                     Z-ADDMCACAR    WWACAR           Cash Rounding
      *                                                                   153674
     C           WWPAMD    IFGE *ZERO                                     153674
     C                     MOVE 'P'       WWPPRE           Pay            153674
     C                     ELSE                                           153674
     C                     Z-SUBWWPAMD    WWPAMD                          153674
     C                     MOVE 'R'       WWPPRE           Receive        153674
     C                     ENDIF                                          153674
      *
     C                     EXSR #WPOSS
     C                     ENDSL                           Check Depot/Customer ind.
      *
     C                     ENDSR
      *
      *****************************************************************
      /EJECT
      *****************************************************************
      *  #PRFR -  Generate Position Settlement                        *
      *  -----    for processing type 'FR' or 'RG' (Average Price 'Z')*
      *  Called by : #PDPRD                                           *
      *  Calls     : #WPOSS                                           *
      *****************************************************************
      *
     C           #PRFR     BEGSR
      *
      ***  Check Depot/Customer indicator
      *
     C                     SELEC
      *
      ***  If Depot/Customer indicator is 'D'
      ***  Generate a Position Settlement for the depot
      *
     C           WWDPCU    WHEQ 'D'
      *
      ***  Setup specific field for this processing type
      *
     C                     Z-ADDMBEXPO    WWEXPO           Ex-Date Position
      *
      ***  Total Cash = Actual Cash Allocation + Cash Rounding
      *
     C                     Z-ADDMBACAA    WWPAMD
     C                     ADD  MBACAR    WWPAMD           Total Cash
     C                     Z-ADDMBACAA    WWACAA           Actual Cash Allocation
     C                     Z-ADDMBACAR    WWACAR           Cash Rounding
      *
     C           WWPAMD    IFGE *ZERO
     C                     MOVE 'R'       WWPPRE           Receive
     C                     ELSE
     C                     Z-SUBWWPAMD    WWPAMD                          153674
     C                     MOVE 'P'       WWPPRE           Pay
     C                     ENDIF
      *
     C                     EXSR #WPOSS
      *
     C           WWDPCU    WHEQ 'C'
      *
      ***  If Depot/Customer indicator 'C'
      ***  Generate a Position Settlement for the customer
      *
      ***  Setup specific field for this processing type
      *
     C                     Z-ADDMCEXPO    WWEXPO           Ex-Date Position
     C                     Z-ADDMCACAA    WWACAA           Actual Cash Allocation
     C                     Z-ADDMCACAR    WWACAR           Cash Rounding
      *
      ***  Total Cash = Actual Cash Allocation + Cash Rounding
      *
     C                     Z-ADDMCACAA    WWPAMD
     C                     ADD  MCACAR    WWPAMD           Total Cash
      *
     C           WWPAMD    IFGE *ZERO
     C*****                MOVE 'R'       WWPPRE           Receive        153674
     C                     MOVE 'P'       WWPPRE           Pay            153674
     C                     ELSE
     C                     Z-SUBWWPAMD    WWPAMD                          153674
     C*****                MOVE 'P'       WWPPRE           Pay            153674
     C                     MOVE 'R'       WWPPRE           Receive        153674
     C                     ENDIF
      *
     C                     EXSR #WPOSS
     C                     ENDSL                           Check Depot/Customer ind.
      *
     C                     ENDSR
      *
      *****************************************************************
      /EJECT
      *****************************************************************
      *  #PRCR -  Generate Position Settlement                        *
      *  -----    for processing type 'CR' or 'RG' (Average Price M,C)*
      *        or for processing type 'CE' or 'OF' (Exchange Offers)  *
      *  Called by : #PDPRD                                           *
      *  Calls     : #WPOSS                                           *
      *****************************************************************
      *
     C           #PRCR     BEGSR
      *
      ***  Check Depot/Customer indicator
      *
     C                     SELEC
      *
      ***  If Depot/Customer indicator is 'D'
      ***  Generate a Position Settlement for the depot
      *
     C           WWDPCU    WHEQ 'D'
      *
      ***  Setup specific field for this processing type
      *
     C*****                MOVE 'R'       WWPPRE           Receive        153674
     C                     Z-ADDMBEXPO    WWEXPO           Ex-Date Position
     C                     Z-ADDMBACAA    WWACAA           Actual Cash Allocation
     C                     Z-ADDMBACAR    WWACAR           Cash Rounding
      *
      ***  Total Cash = Actual Cash Allocation + Cash Rounding
      *
     C                     Z-ADDMBACAA    WWPAMD
     C                     ADD  MBACAR    WWPAMD           Total Cash
      *                                                                   153674
     C           WWPAMD    IFGE *ZERO                                     153674
     C                     MOVE 'R'       WWPPRE           Receive        153674
     C                     ELSE                                           153674
     C                     Z-SUBWWPAMD    WWPAMD                          153674
     C                     MOVE 'P'       WWPPRE           Pay            153674
     C                     ENDIF                                          153674
      *
     C                     EXSR #WPOSS
      *
     C           WWDPCU    WHEQ 'C'
      *
      ***  If Depot/Customer indicator 'C'
      ***  Generate a Position Settlement for the customer
      *
      ***  Setup specific field for this processing type
      *
     C*****                MOVE 'R'       WWPPRE           Receive        151658
     C*****                MOVE 'P'       WWPPRE           Pay     151658 153674
     C                     Z-ADDMCEXPO    WWEXPO           Ex-Date Position
     C                     Z-ADDMCACAA    WWACAA           Actual Cash Allocation
     C                     Z-ADDMCACAR    WWACAR           Cash Rounding
      *
      ***  Total Cash = Actual Cash Allocation + Cash Rounding
      *
     C                     Z-ADDMCACAA    WWPAMD
     C                     ADD  MCACAR    WWPAMD           Total Cash
      *                                                                   153674
     C           WWPAMD    IFGE *ZERO                                     153674
     C                     MOVE 'P'       WWPPRE           Pay            153674
     C                     ELSE                                           153674
     C                     Z-SUBWWPAMD    WWPAMD                          153674
     C                     MOVE 'R'       WWPPRE           Receive        153674
     C                     ENDIF                                          153674
      *
     C                     EXSR #WPOSS
     C                     ENDSL                           Check Depot/Customer ind.
      *
     C                     ENDSR
      *
      *****************************************************************
      /EJECT
      *****************************************************************
      *  #PROF -  Generate Position Settlement                        *
      *  -----    for processing type 'OF' (Purchase Offers)          *
      *        or for processing type 'OF' (Subscription Offers)      *
      *  Called by : #PDPRD                                           *
      *  Calls     : #WPOSS                                           *
      *****************************************************************
      *
     C           #PROF     BEGSR
      *
      ***  Check Depot/Customer indicator
      *
     C                     SELEC
      *
      ***  If Depot/Customer indicator is 'D'
      ***  Generate a Position Settlement for the depot
      *
     C           WWDPCU    WHEQ 'D'
      *
      ***  Setup specific field for this processing type
      *
     C*****                MOVE 'R'       WWPPRE           Receive        153674
     C                     Z-ADDMBEXPO    WWEXPO           Ex-Date Position
     C                     Z-ADDMBACAA    WWACAA           Actual Cash Allocation
     C                     Z-ADDMBACAR    WWACAR           Cash Rounding
      *
      ***  Total Cash = Actual Cash Allocation + Cash Rounding
      *
     C                     Z-ADDMBACAA    WWPAMD
     C                     ADD  MBACAR    WWPAMD           Total Cash
      *                                                                   153674
     C           MIOFTY    IFEQ 'P'                                       153674
     C           MIOFTY    OREQ 'E'                                       153674
      *                                                                   153674
     C           WWPAMD    IFGE *ZERO                                     153674
     C                     MOVE 'R'       WWPPRE           Receive        153674
     C                     ELSE                                           153674
     C                     Z-SUBWWPAMD    WWPAMD                          153674
     C                     MOVE 'P'       WWPPRE           Pay            153674
     C                     ENDIF                                          153674
      *                                                                   153674
     C                     ELSE                                           153674
      *                                                                   153674
     C           WWPAMD    IFGE *ZERO                                     153674
     C                     MOVE 'P'       WWPPRE           Pay            153674
     C                     ELSE                                           153674
     C                     Z-SUBWWPAMD    WWPAMD                          153674
     C                     MOVE 'R'       WWPPRE           Receive        153674
     C                     ENDIF                                          153674
      *                                                                   153674
     C                     ENDIF                                          153674
      *
     C                     EXSR #WPOSS
      *
     C           WWDPCU    WHEQ 'C'
      *
      ***  If Depot/Customer indicator 'C'
      ***  Generate a Position Settlement for the customer
      *
      ***  Setup specific field for this processing type
      *
     C                     Z-ADDMCEXPO    WWEXPO           Ex-Date Position
     C                     Z-ADDMCACAA    WWACAA           Actual Cash Allocation
     C                     Z-ADDMCACAR    WWACAR           Cash Rounding
      *
      ***  Total Cash = Actual Cash Allocation + Cash Rounding
      *
     C                     Z-ADDMCACAA    WWPAMD
     C                     ADD  MCACAR    WWPAMD           Total Cash
      *
     C           MIOFTY    IFEQ 'P'
     C           MIOFTY    OREQ 'E'                                       153674
      *
     C           WWPAMD    IFGE *ZERO
     C                     MOVE 'P'       WWPPRE           Pay
     C                     ELSE
     C                     MOVE 'R'       WWPPRE           Receive
     C                     Z-SUBWWPAMD    WWPAMD                          153674
     C                     ENDIF
      *
     C                     ELSE
      *
     C           WWPAMD    IFGE *ZERO
     C*****                MOVE 'R'       WWPPRE           Pay            153674
     C                     MOVE 'R'       WWPPRE           Receive        153674
     C                     ELSE
     C*****                MOVE 'P'       WWPPRE           Receive        153674
     C                     MOVE 'P'       WWPPRE           Pay            153674
     C                     Z-SUBWWPAMD    WWPAMD                          153674
     C                     ENDIF
      *
     C                     ENDIF
      *
     C                     EXSR #WPOSS
     C                     ENDSL                           Check Depot/Customer ind.
      *
     C                     ENDSR
      *
      *****************************************************************
      /EJECT
      *****************************************************************
      *  #PREX -  Generate Position Settlement                        *
      *  -----    for processing type 'EX'                            *
      *  Called by : #PDPRD                                           *
      *  Calls     : #WPOSS                                           *
      *****************************************************************
      *
     C           #PREX     BEGSR
      *
      ***  Check Depot/Customer indicator
      *
     C                     SELEC
      *
      ***  If Depot/Customer indicator is 'D'
      ***  Generate a Position Settlement for the depot
      *
     C           WWDPCU    WHEQ 'D'
      *
      ***  Setup specific field for this processing type
      *
     C*****                MOVE 'P'       WWPPRE           Pay            153674
     C                     Z-ADDMBEXPO    WWEXPO           Ex-Date Position
     C                     Z-ADDMBACAA    WWACAA           Actual Cash Allocation
     C                     Z-ADDMBACAR    WWACAR           Cash Rounding
      *
      ***  Total Cash = Actual Cash Allocation + Cash Rounding
      *
     C                     Z-ADDMBACAA    WWPAMD
     C                     ADD  MBACAR    WWPAMD           Total Cash
      *                                                                   153674
     C           WWPAMD    IFGE *ZERO                                     153674
     C                     MOVE 'P'       WWPPRE           Pay            153674
     C                     ELSE                                           153674
     C                     MOVE 'R'       WWPPRE           Receive        153674
     C                     Z-SUBWWPAMD    WWPAMD                          153674
     C                     ENDIF                                          153674
      *
     C                     EXSR #WPOSS
      *
     C           WWDPCU    WHEQ 'C'
      *
      ***  If Depot/Customer indicator 'C'
      ***  Generate a Position Settlement for the customer
      *
      ***  Setup specific field for this processing type
      *
     C*****                MOVE 'P'       WWPPRE           Pay            153674
     C                     Z-ADDMCEXPO    WWEXPO           Ex-Date Position
     C                     Z-ADDMCACAA    WWACAA           Actual Cash Allocation
     C                     Z-ADDMCACAR    WWACAR           Cash Rounding
      *
      ***  Total Cash = Actual Cash Allocation + Cash Rounding
      *
     C                     Z-ADDMCACAA    WWPAMD
     C                     ADD  MCACAR    WWPAMD           Total Cash
      *                                                                   153674
     C           WWPAMD    IFGE *ZERO                                     153674
     C                     MOVE 'R'       WWPPRE           Receive        153674
     C                     ELSE                                           153674
     C                     Z-SUBWWPAMD    WWPAMD                          153674
     C                     MOVE 'P'       WWPPRE           Pay            153674
     C                     ENDIF                                          153674
      *
     C                     EXSR #WPOSS
     C                     ENDSL                           Check Depot/Customer ind.
      *
     C                     ENDSR
      *
      *****************************************************************
      /EJECT
      *****************************************************************
      *  #PRNF -  Generate Position Settlement                        *
      *  -----    for processing type 'NF'                            *
      *  Called by : #PDPRD                                           *
      *  Calls     : #WPOSS                                           *
      *****************************************************************
      *
     C           #PRNF     BEGSR
      *
      ***  Check Depot/Customer indicator
      *
     C                     SELEC
      *
     C           WWDPCU    WHEQ 'C'
      *
      ***  If Depot/Customer indicator 'C'
      ***  Generate a Position Settlement for the customer
      *
      ***  Setup specific field for this processing type
      *
     C                     MOVE 'P'       WWPPRE           Pay
     C                     Z-ADDMCEXPO    WWEXPO           Ex-Date Position
     C                     Z-ADD*ZERO     WWPAMD           PAMD=*zero
      *
     C                     EXSR #WPOSS
     C                     ENDSL                           Check Depot/Customer ind.
      *
     C                     ENDSR
      *
      *****************************************************************
      /EJECT
      *****************************************************************
      *  #WPOSS - Write a Position Settlement                         *
      *  ------                                                       *
      *  Called by : #PRDV #PRFR #PRCR #PROF #PREX #PRNF              *
      *  Calls     : ZSETAC #AOSEC CALAM2 CALCTX *PSSR ZTNLU1         *
      *****************************************************************
      *
     C           #WPOSS    BEGSR
      *
     C                     CLEARPOSETDF
      *
      ***  Check Depot/Customer indicator
      *
     C                     SELEC
      *
      ***  If Depot/Customer indicator is 'D'
      ***  Generate a Position Settlement for the depot
      *
     C           WWDPCU    WHEQ 'D'
      *
      ** .. Booking branch
     C                     MOVE MBBRCD    PBCA
      ** .. Counterparty
     C                     MOVELMBDDPT    PCPY
      ** .. Counterparty type                                             CSE023
     C                     MOVE 'D'       CTYP                            CSE023
      ** .. Event Type
     C                     MOVE MBCOAT    PEVT
      ** .. Nominal Position
     C                     Z-ADDMBEXPO    PNMP
      ** .. Book Code
     C                     MOVELBVDMBC    PBCD
      *
      ***  If Depot/Customer indicator is 'C'
      ***  Generate a Position Settlement for the customer
      *
     C           WWDPCU    WHEQ 'C'
      *
      ** .. Booking branch
     C                     MOVE MCBRCD    PBCA
      ** .. Counterparty
     C                     MOVELMCCNUM    PCPY
      ** .. Counterparty type                                             CSE023
     C                     MOVE 'C'       CTYP                            CSE023
      ** .. Event Type
     C                     MOVE MCCOAT    PEVT
      ** .. Nominal Position
     C                     Z-ADDMCEXPO    PNMP
      ** .. Book Code
     C                     MOVELBVDMBC    PBCD
     C                     ENDSL
      *
     C                     MOVE WONMCY    WKNMCY
     C                     MOVE WOSITP    WKSITP
      ***  Retrieve the processing type
     C           KWINV     CHAININVTP                89
     C           *IN89     IFEQ *ON
     C           RECI      OREQ '*'
     C           *LOCK     IN   LDA
     C                     Z-ADD3         DBASE            *****************
     C                     MOVEL*BLANKS   DBFILE           ** DB ERROR 03 **
     C                     MOVE 'INVTP   'DBFILE           *****************
     C                     MOVELWWINV     DBKEY     P
     C                     MOVEL'SE7561'  DBPGM     P
     C                     OUT  LDA
     C                     EXSR *PSSR
     C                     ENDIF
      *
      ** .. Security short name
     C                     MOVELMASESN    PSSH      P
      ** .. Market
     C                     MOVELWOMKTI    PMAR
      ** .. Due Date
     C                     Z-ADDMACOPD    PDUD
      ** .. Value Currency
     C           MAPTYP    IFNE 'CC'                                      CEU017
     C                     MOVE WONMCY    PNCY
     C                     ELSE                                           CEU017
     C                     MOVE NANCCY    PNCY                            CEU017
     C                     ENDIF                                          CEU017
      ** .. Amount Due
     C                     Z-ADDWWPAMD    PAMD
      ** .. Pay/Receive Indicator
     C                     MOVE WWPPRE    PPRE
      *
      ** .. Settlement Method
     C                     Z-ADD0         PSMT
      ** .. Settlement Account
     C                     MOVEL*BLANKS   PSEA
      ** .. Settlement Branch
     C                     MOVEL*BLANKS   PSEB
      *
     C           EXBCSI    IFEQ 'Y'
      ** .. Settlement Currency
     C                     MOVE MOSCCY    PSCU
      ** .. Settlement Method
     C                     Z-ADDMOSMET    PSMT
      ** .. Settlement Account
     C                     MOVELMOSACC    PSEA
      ** .. Settlement Branch
     C                     MOVELMOSBRC    PSEB
      *
     C                     ELSE
      *
     C           BGPFMG    IFNE 'Y'                        Portfolio Management OFF
     C           BGN4ST    ANDNE'Y'                                       CPB001
     C           BGPFMG    OREQ 'Y'
     C           WWDPCU    ANDEQ'D'
     C           BGN4ST    OREQ 'Y'                                       CPB001
     C           WWDPCU    ANDEQ'D'                                       CPB001
      *
      ***  For Settlement Instruction access STDSED with key of
      ***  Branch and Customer,SECODPPD, Nominal CCY and Investment
      ***  Type,SECTYD
      *
     C                     MOVE PBCA      WKPBCA           Branch
     C**********           Z-ADDPCPY      WKPCPY           Customer                           CSD027
     C                     MOVE PCPY      WKPCPY           Customer                           CSD027
     C                     MOVE WONMCY    WKNMCY           Nominal Ccy
     C                     MOVE WOSITP    WKSITP           Sec. Inv. Type
     C                     MOVE WOSMCC    WKSMCC                                              CSE034
      *                                                                                       CSE028
     C           CSE028    IFEQ 'Y'                                                           CSE028
     C                     MOVE PBCD      WKPBCD           Book Code                          CSE028
     C                     MOVE *BLANKS   WKPTFR           Portfolio Reference                CSE028
     C                     ELSE                                                               CSE028
     C                     MOVE *BLANKS   WKPBCD           Book Code                          CSE028
     C                     MOVE *BLANKS   WKPTFR           Portfolio Reference                CSE028
     C                     ENDIF                                                              CSE028
      *                                                                                       CSE028
      ** If CSE028 is on, call SESSIR0 for default of MT5xx information                       CSE028
      *                                                                                       CSE028
     C           CSE028    IFEQ 'Y'                                                           CSE028
      *                                                                                       CSE028
     C                     EXSR SRSSIR                                                        CSE028
     C           NOTFND    IFEQ 'Y'                                                           CSE028
     C                     MOVE '1'       *IN89                                               CSE028
     C                     ELSE                                                               CSE028
     C                     MOVE '0'       *IN89                                               CSE028
     C                     ENDIF                                                              CSE028
      *                                                                                       CSE028
     C                     ELSE                                                               CSE028
      *                                                                                       CSE028
     C           KWSTDS    CHAINSTDSED               89
     C           *IN89     IFEQ *ON
     C                     MOVEL*BLANKS   WKSITP
     C           KWSTDS    CHAINSTDSED               89
     C                     ENDIF
      *                                                                                       CSE028
     C                     ENDIF                                                              CSE028
      *                                                                                       CSE028
     C/COPY WNCPYSRC,SE7561C005
     C           *IN89     IFEQ *OFF
      *                                                                   135691
      * CEU005 active and Settlement Ccy used on STDSED.                  135691
     C           CEU005    IFEQ 'Y'                                       135691
     C           SCCY      ANDNE*BLANKS                                   135691
     C                     MOVE SCCY      SVSCCY  3                       135691
      *                                                                   135691
      * Access currencies file for EURO rate, EURO M/D indicator and      135691
      * Transition Date for 'In' Ccy.                                     135691
      *                                                                   135691
     C           WONMCY    IFEQ BKEURO                                    135691
     C                     CALL 'AOCURRR0'                                135691
     C                     PARM           @RTCD   7                       135691
     C                     PARM '*KEY   ' @OPTN   7                       135691
     C                     PARM SCCY      @AJCD   3                       135691
     C           SDCURR    PARM SDCURR    DSSDY                           135691
     C           @RTCD     IFNE *BLANKS                                   135691
     C                     Z-ADD44        DBASE             ************  135691
     C                     MOVEL'SDCURRPD'DBFILE            * DATABASE *  135691
     C                     MOVELSCCY      DBKEY             * ERROR 44 *  135691
     C                     EXSR *PSSR                       ************  135691
     C                     ENDIF                                          135691
     C                     ELSE                                           135691
     C           SCCY      IFEQ BKEURO                                    135691
     C                     CALL 'AOCURRR0'                                135691
     C                     PARM           @RTCD   7                       135691
     C                     PARM '*KEY   ' @OPTN   7                       135691
     C                     PARM WONMCY    @AJCD   3                       135691
     C           SDCURR    PARM SDCURR    DSSDY                           135691
     C           @RTCD     IFNE *BLANKS                                   135691
     C                     Z-ADD45        DBASE             ************  135691
     C                     MOVEL'SDCURRPD'DBFILE            * DATABASE *  135691
     C                     MOVELWONMCY    DBKEY             * ERROR 45 *  135691
     C                     EXSR *PSSR                       ************  135691
     C                     ENDIF                                          135691
     C                     ENDIF                                          135691
     C                     ENDIF                                          135691
      *                                                                   135691
     C                     MOVE A6EUMD    SVEUMD                          135691
     C                     MOVE A6EUER    SVEUER                          135691
      *                                                                   135691
      * Value date is later than Transition Start Date.                   135691
     C           MACOPD    IFGE A6TPSD                                    135691
      * Chain STDSED again.                                               135691
     C                     MOVE SCCY      WKNMCY           Nominal Ccy    135691
      *                                                                                       CSE028
      ** If CSE028 is on, call SESSIR0 for default of MT5xx information                       CSE028
      *                                                                                       CSE028
     C           CSE028    IFEQ 'Y'                                                           CSE028
      *                                                                                       CSE028
     C                     EXSR SRSSIR                                                        CSE028
     C           NOTFND    IFEQ 'Y'                                                           CSE028
     C                     MOVE '1'       *IN78                                               CSE028
     C                     ELSE                                                               CSE028
     C                     MOVE '0'       *IN78                                               CSE028
     C                     ENDIF                                                              CSE028
      *                                                                                       CSE028
     C                     ELSE                                                               CSE028
      *                                                                                       CSE028
     C           KWSTDS    CHAINSTDSED               78                   135691
      *                                                                                       CSE028
     C                     ENDIF                                                              CSE028
      *                                                                                       CSE028
     C/COPY WNCPYSRC,SE7561C006
     C                     ENDIF                                          135691
     C                     ENDIF                                          135691
      *                                                                   135691
      * If no record found ensure fields from last chain not loaded       135691
      * to output fields.                                                 135691
     C           *IN78     IFEQ '0'                                       135691
      ** .. Settlement Type
     C                     Z-ADDSRSM      PSMT
      ** .. Settlement Account
     C                     MOVELSRAC      PSEA
      ** .. Settlement Branch
     C                     MOVELSRAB      PSEB
      *
      ***  If SRSM = 04 and SRAC = BLANKS the determine settlement A/C
      ***     via SR/ZSETAC  and output to field PSEA
      *
     C           SRSM      IFEQ 04
     C           SRAC      ANDEQ*BLANK
      *
      ***  Pass Parameters to SR/ZSETAC and execute routine
      *
     C                     MOVE SRSM      ZMETH
     C                     MOVE SRAC      ZSETI
     C                     MOVE PCPY      ZCNUM
     C           CEU005    IFEQ 'Y'                                       135691
     C           SCCY      ANDNE*BLANKS                                   135691
     C                     MOVE SCCY      ZCCY                            135691
     C                     ELSE                                           135691
     C                     MOVE WONMCY    ZCCY
     C                     ENDIF                                          135691
     C                     MOVE SRAB      ZBRCA
     C                     EXSR ZSETAC
     C                     MOVELZSETO     PSEA
     C                     MOVELZWBRCA    PSEB
     C                     ENDIF
     C                     ENDIF
     C                     ENDIF                                          135691
      *
     C                     ELSE
     C           BGPFMG    IFEQ 'Y'
     C           WWDPCU    ANDEQ'C'
     C           BGN4ST    OREQ 'Y'                                       CPB001
     C           WWDPCU    ANDEQ'C'                                       CPB001
     C                     MOVE 'Y'       WALCCY  1
     C                     EXSR #SETIN
      *
      ** If Account found in any of currencies checked
     C           WSAME     IFEQ *OFF
      ** .. Settlement Currency
     C                     MOVELCCY       PSCU
      ** .. Settlement Type
     C                     Z-ADD05        PSMT
      ** .. Settlement Account
     C                     MOVELPSEA1     PSEA
      ** .. Settlement Branch
     C                     MOVE BRCA      PSEB
      *
      ** ELSE
     C                     ELSE
      *
     C           MAPTYP    IFNE 'CC'                                      CEU017
     C                     MOVELWONMCY    PSCU
     C                     ELSE                                           CEU017
     C                     MOVELPNCY      PSCU                            CEU017
     C                     ENDIF                                          CEU017
      ** .. Settlement Type
     C                     Z-ADD*ZEROS    PSMT
      ** .. Settlement Account
     C                     MOVEL*BLANKS   PSEA
      ** .. Settlement Branch
     C                     MOVE *BLANKS   PSEB
     C                     ENDIF
     C                     ENDIF
     C                     ENDIF
      *
     C                     ENDIF
      ** .. Settlement Currency
     C           PSCU      IFEQ *BLANKS
     C                     MOVE PNCY      PSCU
     C                     ENDIF
      ** .. Settlement Branch
     C           PSEB      IFEQ *BLANKS
     C                     MOVE PBCA      PSEB
     C                     ENDIF
      *
      ** .. Settlement Exchange Rate between Nominal and Settlement Currency
      ** .. Multiply/Divide Indicator
     C           PNCY      IFNE PSCU
      *
     C                     CALL 'AOCURRR0'
     C                     PARM *BLANKS   @RTCD
     C                     PARM '*KEY  '  @OPTN
     C                     PARM PNCY      @CYCD
     C           SDCURR    PARM SDCURR    DSSDY
      *
     C                     Z-ADD1         ZAMTF
     C                     MOVE PNCY      ZCCYF
     C                     Z-ADDA6SPRT    ZRATEF
     C                     MOVE A6MDIN    ZMDINF
     C                     Z-ADDA6NBDP    ZCDPF
      *
     C                     CALL 'AOCURRR0'
     C                     PARM *BLANKS   @RTCD
     C                     PARM '*KEY  '  @OPTN
     C                     PARM PSCU      @CYCD
     C           SDCURR    PARM SDCURR    DSSDY
      *
     C                     MOVE PSCU      ZCCYT
     C                     MOVE A6SPRT    ZRATET
     C                     MOVE A6MDIN    ZMDINT
     C                     MOVE A6NBDP    ZCDPT
      *
     C                     EXSR ZCCYCN
     C                     Z-ADDZCRSRT    PSXR
     C                     MOVE ZCRSMD    PMDI
     C                     ELSE
     C                     Z-ADD1         PSXR
     C                     MOVEL'M'       PMDI
     C                     ENDIF
      *
      ** .. Base Currency Exchange Rate
     C           MAPTYP    IFNE 'CC'                                      CEU017
     C                     Z-ADDWOSPRT    PBRX
     C                     ELSE                                           CEU017
     C                     CALL 'AOCURRR0'                                CEU017
     C                     PARM *BLANKS   @RTCD                           CEU017
     C                     PARM '*KEY  '  @OPTN                           CEU017
     C                     PARM PNCY      @CYCD                           CEU017
     C           SDCURR    PARM SDCURR    DSSDY                           CEU017
     C                     Z-ADDA6SPRT    PBRX                            CEU017
     C                     ENDIF                                          CEU017
      *
      ** .. Authorized Indicator
     C           BVAPST    IFEQ 'Y'
      *
     C           EXBCSI    IFEQ 'Y'
     C                     MOVE 'Y'       PAUI
     C                     ELSE
     C                     MOVE *BLANKS   PAUI
     C                     ENDIF
      *
     C                     ELSE
     C                     MOVE *BLANKS   PAUI
     C                     ENDIF
      *
      ** .. Counterparty Bank
     C                     MOVEL*BLANKS   PCPN
      ** .. For Account Of
     C                     MOVEL*BLANKS   PFAC
      ** .. Special Instructions
     C                     MOVEL*BLANKS   PSPI
      *
      ***  Call Access Program for Security Customer Details to retrieve Customer Group.
      *
     C                     MOVE PCPY      WCUST   6
     C                     EXSR #AOSEC
      *
     C           S01496    IFEQ 'Y'
     C           BVACOP    ANDEQ'Y'
     C                     MOVE BFPSCG    WKCUGR
     C                     MOVE *BLANKS   WKCLAS
     C                     ELSE
     C                     MOVE *BLANKS   WKCUGR
     C                     MOVE BFCLAS    WKCLAS
     C                     ENDIF
      *                                                                   CEU017
      ***  If processing type is 'CC' than Charges/Commissions amount is  CEU017
      ***  not calculated and Charges/Commissions Code is blanks          CEU017
      *                                                                   CEU017
     C           MAPTYP    IFEQ 'CC'                                      CEU017
     C                     MOVE *BLANKS   PCHC                            CEU017
     C                     Z-ADD*ZERO     PCHA                            CEU017
     C                     MOVE *BLANKS   PCCD                            CEU017
     C                     Z-ADD*ZERO     PCAM                            CEU017
     C                     ELSE                                           CEU017
      *
     C           S01496    IFEQ 'Y'
     C           BVACOP    ANDEQ'Y'
      *
      ***  Retrieve the Commission and the Charge Code on the Corporate Actions Default Charges
      ***  file with Customer Group, Customer, Investment Type and Corporate Action Type
      *
     C                     MOVE PCPY      WKPCPY           Customer
     C                     MOVE WOSITP    WKSITP           Investment Type
     C                     MOVE PEVT      WKPEVT           Event Type
     C           KWCOH1    CHAINSECOCHL0             89
      *
      ***  If record not found, access with Customer Group, Customer, Investment type
      *
     C           *IN89     IFEQ *ON
     C                     MOVE *BLANKS   WKPEVT           Event Type
     C           KWCOH1    CHAINSECOCHL0             89
      *
      ***  If record not found, access with Customer Group, Customer
      *
     C           *IN89     IFEQ *ON
     C                     MOVE *BLANKS   WKSITP           Investment Type
     C           KWCOH1    CHAINSECOCHL0             89
      *
      ***  If record not found, access with Customer Group.
      *
     C           *IN89     IFEQ *ON
     C                     MOVE *BLANKS   WKPCPY           Customer
     C           KWCOH1    CHAINSECOCHL0             89
     C                     ENDIF
     C                     ENDIF
     C                     ENDIF
      *
     C                     ELSE
      *
      ***  Retrieve the Commission and the Charge Code on the Corporate Actions Default Charges
      ***  file with Classification, Customer, Investment Type, and Corporate Action Type
      *
     C                     MOVE PCPY      WKPCPY           Customer
     C                     MOVE WOSITP    WKSITP           Investment Type
     C                     MOVE PEVT      WKPEVT           Event Type
     C           KWCOH2    CHAINSECOCHL1             89
      *
      ***  If record not found, access with Classification, Customer, Investment type
      *
     C           *IN89     IFEQ *ON
     C                     MOVE *BLANKS   WKPEVT           Event Type
     C           KWCOH2    CHAINSECOCHL1             89
      *
      ***  If record not found, access with Classification, Customer
      *
     C           *IN89     IFEQ *ON
     C                     MOVE *BLANKS   WKSITP           Investment Type
     C           KWCOH2    CHAINSECOCHL1             89
      *
      ***  If record not found, access with Classification.
      *
     C           *IN89     IFEQ *ON
     C                     MOVE *BLANKS   WKPCPY           Customer
     C           KWCOH2    CHAINSECOCHL1             89
     C                     ENDIF
     C                     ENDIF
     C                     ENDIF
     C                     ENDIF
      *
      ***  If record not found with one access
      *
     C           *IN89     IFEQ *OFF
      *
      ***  Retrieve Charge Basis Indicator on Charge Types file with Charge Code retrieve above
      ***  and Event Nominal Currency.
      *
      ** ..  Charge Code
     C                     MOVE MRCOCH    PCHC
      ** .. Commission Code
     C                     MOVE MRCOCO    PCCD
      *
     C                     MOVE MRCOCH    WKCCOM
     C           KWSECG    CHAINSECGT                89
      *
      ***  If no live record found
      *
     C           *IN89     IFEQ *OFF
     C                     Z-ADD0         ZTCON
     C                     Z-ADD0         ZNOML
      *
      ***  If Processing Type = 'NF', set field ZNOML to Ex-Date Position for Corporate Action
      *
     C           MAPTYP    IFEQ 'NF'
     C                     Z-ADDWWEXPO    ZNOML
      *
      ***  Else, if Processing Type not = 'NF'.
      *
     C                     ELSE
      *
      ***  If Charge Basis Indicator = 'C', set field ZTCON to (Actual Cash Allocation + Actual
      ***  Cash Rounding).
      *
     C           CHGB      IFEQ 'C'
     C           WWACAA    ADD  WWACAR    ZTCON
      *
      ***  Else, if Processing Type not = 'NF' and Charge Basis Indicator not = 'C'.
      *
     C                     ELSE
      *
      ***  If Charge Basis Indicator = 'N', set field ZNOML to Ex-Date.
      *
     C           CHGB      IFEQ 'N'
     C                     Z-ADDWWEXPO    ZNOML
     C                     ENDIF
     C                     ENDIF
     C                     ENDIF
      *
      ***  Calculate Charge Amount.
      *
     C                     EXSR CALAM2
      **  .. Charge Amount
     C                     Z-ADDZCHGA     PCHA
     C                     ENDIF                                                              200789
      *                                                                                       200789
      *
     C                     Z-ADD0         ZTCON
     C                     Z-ADD0         ZNOML
      *
      ***  Retrieve Charge Basis Indicator on Charge Types file with Commission Code retrieve
      ***  above and Event Nominal Currency.
      *
     C                     MOVE WONMCY    WKNMCY           Event Nominal Currency
     C                     MOVE MRCOCO    WKCCOM           Commission Code
     C           KWSECG    CHAINSECGT                89
      *
      ***  If no live record found
      *
     C           *IN89     IFEQ *OFF
      *
      ***  If Processing Type = 'NF', set field ZNOML to Ex-Date Position for Corporate Action
      *
     C           MAPTYP    IFEQ 'NF'
     C                     Z-ADDWWEXPO    ZNOML
      *
      ***  Else, if Processing Type not = 'NF'.
      *
     C                     ELSE
      *
      ***  If Charge Basis Indicator = 'C', set field ZTCON to (Actual Cash Allocation + Actual
      ***  Cash Rounding).
      *
     C           CHGB      IFEQ 'C'
     C           WWACAA    ADD  WWACAR    ZTCON
      *
      ***  Else, if Processing Type not = 'NF' and Charge Basis Indicator not = 'C'.
      *
     C                     ELSE
      *
      ***  If Charge Basis Indicator = 'N', set field ZNOML to Ex-Date.
      *
     C           CHGB      IFEQ 'N'
     C                     Z-ADDWWEXPO    ZNOML
     C                     ENDIF
     C                     ENDIF
     C                     ENDIF
      *
      ***  Calculate Commission Amount.
      *
     C                     EXSR CALAM2
     C                     Z-ADDZCHGA     PCAM
     C                     ENDIF
     C**********           ENDIF                                                              200789
     C                     ENDIF
     C                     ENDIF                           Proc. Type 'CC'CEU017
      *
      *** Access security WHT details file
      *
     C           MASESN    CHAINSESWHTL0             89
      *
     C           S01447    IFEQ 'N'
     C           *IN89     OREQ '1'
     C           PPRE      OREQ 'R'
     C           MAPTYP    ORNE 'DV'
      ** Tax ded source
     C                     Z-ADD0         TASO
      ** Tax ded src ref
     C                     Z-ADD0         TASR
      ** Tax ded user
     C                     Z-ADD0         TAUS
     C                     ELSE
      *
      ***  If Depot/Customer Indicator = 'C' and Stock Dividend Type = 'R' as Reinvestment of
      ***  Dividend, calculate Withholding Tax based on Original Cash Option, else calculate
      ***  Withholding Tax based on Actual Cash Allocation + Rounding.
      *
     C           WWDPCU    IFEQ 'C'
     C           MDSDIT    ANDEQ'R'
     C                     Z-ADDMCCAOP    WUPAMD
     C                     ELSE
     C                     Z-ADDPAMD      WUPAMD 150
     C                     ENDIF
     C                     EXSR CALCTX
     C                     ENDIF
      *                                                                                     AR853119
     C           CER049    IFEQ 'Y'                                                         AR853119
     C                     EXSR SRPOST                                                      AR853119
     C                     ENDIF                                                            AR853119
      *
      ***  Retrieve the settlement amount
      ***  Set up parameter for call to SEZ010
      *
     C                     MOVELBFCLAS    P@CLAS
     C                     MOVE PPRE      P@PPRE
     C                     Z-ADDPAMD      P@PAMD
     C                     Z-ADDPCHA      P@PCHA
     C                     Z-ADDPCAM      P@PCAM
     C                     Z-ADDTASO      P@TASO
     C                     Z-ADDTAUS      P@TAUS
     C                     Z-ADDPSXR      P@PSXR
     C                     MOVELPMDI      P@PMDI
     C                     MOVELPNCY      P@PNCY
     C                     MOVELPSCU      P@PSCU
     C           PPRE      IFEQ 'R'
     C                     MOVE 'TS'      P@TDTP
     C                     ELSE
     C                     MOVE 'TP'      P@TDTP
     C                     ENDIF
     C                     Z-ADD0         P@FXMR
     C                     Z-ADD0         P@MAMT
     C                     MOVELWTAXA     P@STAM                                            AR853119
      *
      ***  Call SEZ010 to calculate the settlement amount in settle ccy
      *
     C                     CALL 'SEZ010'
     C                     PARM *BLANKS   P@RCDE  7
     C                     PARM           P@DATA
     C           P@RCDE    IFEQ *BLANKS
     C                     Z-ADDP@PSAT    PSAT
     C                     ELSE
     C           *LOCK     IN   LDA
     C                     Z-ADD4         DBASE            ***************
     C                     MOVEL'SEZ010  'DBFILE    P      * DB ERROR 04 *
     C                     MOVELP@DATA    DBKEY     P      ***************
     C                     MOVEL'SE7561'  DBPGM     P
     C                     OUT  LDA
     C                     EXSR *PSSR
     C                     ENDIF
      ** .. Message Indicator
     C                     MOVEL*BLANKS   PSMI
      ** .. Date Generated
     C                     MOVE BJRDNB    PDTG
      ** .. Last Change Date         Run Date
     C                     MOVE BJRDNB    LCD
      ** .. Type of last change
     C                     MOVEL'I'       CHTP
      ** .. Position Settl. Value Date
     C                     MOVE MACOPD    PSVL
      ** .. Settlement Reversal Postings Gen
     C                     MOVEL*BLANKS   SRPG
      ** .. Profit Centre
     C                     MOVE *BLANKS   PPFC
      *
      ***   If Profit Centre used
      *
     C           BKPRCU    IFEQ 'Y'
      *
      ***  If Classification of counterpaty is 'S' or 'D'
      *
     C           BFCLAS    IFEQ 'S'
     C           BFCLAS    OREQ 'D'
      *
     C                     MOVELPCPY      WKPCPY           Customer
     C                     MOVELPBCA      WKPBCA           Branch
     C                     MOVELPSSH      WKPSSH    P      Security
      *
     C           KWSEPC    CHAINSEPCCDF              89
     C           *IN89     IFEQ *OFF
     C                     MOVELPCCU      PPFC
     C                     ELSE
     C                     MOVELWOSESN    WKPSSH           Event Security
     C           KWSEPC    CHAINSEPCCDF              89
     C           *IN89     IFEQ *OFF
     C                     MOVELPCCU      PPFC
     C                     ENDIF
     C                     ENDIF
     C                     ENDIF
     C                     ENDIF
      *
      ***  Analytical Accounting Module is ON and PPFC is *BLANKS
      *
     C           BGN0ST    IFEQ 'Y'
     C           PPFC      ANDEQ*BLANKS
     C                     MOVE BVSEPC    PPFC
     C                     ENDIF
      *
      ** Settl. amount base
     C                     Z-ADD0         SABC
      ** Base ccy eq.
     C                     Z-ADD0         BAUS
      ** conf. produced blank
     C                     MOVE *BLANKS   PSCF
      *
      ***  Initialise FXMP, FXMR, and MAMT to zero
      *
     C                     Z-ADD0         FXMP
     C                     Z-ADD0         FXMR
     C                     Z-ADD0         MAMT
      ** Transaction number of last update
     C                     EXSR ZTNLU1
     C                     MOVELFNATN     TNLU
     C                     MOVELFNATN     WWTNLU
      ** Record ID
     C                     MOVE 'D'       RECI
      *
     C           WWDPCU    IFEQ 'C'
      ** .. Portfolio Reference
     C                     MOVELMCPTFR    PTFR
     C                     ELSE
     C                     MOVE *BLANKS   PTFR
     C                     ENDIF
     C*                                                                   135691
     C** If CEU005 active, use 'In' ccy values for settlement details     135691
     C*                                                                   135691
     C           CEU005    IFEQ 'Y'                                       135691
     C           SVSCCY    ANDNE*BLANKS                                   135691
     C                     MOVE SVEUER    PSXR                            135691
     C           SVSCCY    IFEQ BKEURO                                    135691
     C           SVEUMD    IFEQ 'M'                                       135691
     C                     MOVE 'D'       PMDI                            135691
     C                     ELSE                                           135691
     C                     MOVE 'M'       PMDI                            135691
     C                     ENDIF                                          135691
      *                                                                   135691
      * Settlement ccy not Euro ccy, use Euro M/D indicator.              135691
     C                     ELSE                                           135691
     C                     MOVE SVEUMD    PMDI                            135691
     C                     ENDIF                                          135691
      * Use standard settlement ccy for position settlement ccy           135691
     C                     MOVE SVSCCY    PSCU                            135691
     C                     ENDIF                                          135691
      *
      ***  Write position settlement record
     C/COPY WNCPYSRC,SE7561C003
      *
     C** If CSE023 is not installed or if CSE023 is installed and         CSE023
     C** the events is not for Coupon, Dividend or Maturity then          CSE023
     C** use the normal processing.                                       CSE023
     C*                                                                   CSE023
     C           CSE023    IFEQ 'N'                                       CSE023
     C*                                                                   CSE023
     C           CSE023    OREQ 'Y'                                       CSE023
     C           MAPTYP    ANDNE'DV'                                      CSE023
      *                                                                   CSE023
     C                     WRITEPOSETDF
     C                     EXSR PSAUDT                                                      AR324886
      *
      ***  Count Records Written
      *
     C                     ADD  1         W02CNT
      *                                                                                     AR853119
     C           CER049    IFEQ 'Y'                                                         AR853119
     C                     WRITEPOSETDD3                                                    AR853119
     C           P3TAX     IFEQ 'Y'                                                        AR864714B
     C                     WRITE@STMDP0                                                     AR853119
     C                     ENDIF                                                           AR864714B
     C                     ENDIF                                                            AR853119
      *                                                                   CSE023
     C                     ELSE                                           CSE023
      *                                                                   CSE023
      ** If Treaty Withholding Tax is installed, then set up fields       CSE023
      ** for SE2310.                                                      CSE023
      *                                                                   CSE023
      ** For Dividend Event, @DIVDT is equal to the dividend date.        CSE023
      *                                                                   CSE023
     C                     MOVE MATDVD    @TVBAS                          CSE023
     C                     MOVE LCD       PSLCD                           CSE023
      *                                                                   CSE023
     C                     Z-ADDMACOEX    @DIVDT                          CSE023
     C                     MOVE MACORF    PSPI                            215575
      *                                                                   CSE023
     C                     CALL 'SE2310'                                  CSE023
     C                     PARM           PPOSET                          CSE023
     C                     PARM           @TVBAS  1                       CSE023
     C                     PARM           @DIVDT  50                      CSE023
     C                     PARM           @NREC   30                      CSE023
     C                     PARM           @ERR    1                       CSE023
      *                                                                   CSE023
     C           @ERR      IFEQ 'N'                                       CSE023
     C                     ADD  @NREC     W02CNT                          CSE023
     C                     ELSE                                           CSE023
     C                     EXSR *PSSR                                     CSE023
     C                     MOVE '1'       *INLR                           CSE023
     C                     END                                            CSE023
     C                     END                                            CSE023
      *                                                                   CSE023
     C                     MOVE 'Y'       WWDATA           one Read
     C/COPY WNCPYSRC,SE7561C001
      *
      ***  If Portfolio Management is licensed in the System (from SESTAT) and the
      ***  MT5xx Feature is present, then for Portfolio Customers, for
      ***  Coupon and Dividend Position Settlements, ensure that a
      ***  corresponding Extension record is present.
      *
     C           PFPL      IFEQ 'Y'
     C           S01401    ANDEQ'Y'
      *
      ***  Select only Coupons and Dividends.
      *
     C           PEVT      IFEQ 'CP'
     C           PEVT      OREQ 'DV'
      *
      ***  Ascertain if Customer is Safe Custody or Discretionary.
      *
     C                     MOVE PCPY      WCUST   6
     C                     EXSR #AOSEC
      *
     C           BFCLAS    IFEQ 'S'
     C           BFCLAS    OREQ 'D'
      *
      ***  Check if record exists on Extension File.
      *
     C           KPOSET    CHAINPOSETDY1             89
      *
      ***  If it doesn't, set one up and Write it.
      *
     C           *IN89     IFEQ *ON
     C                     CLEARPOSETDD1
     C                     MOVE PBCA      POPBCA
     C                     MOVE PSSH      POPSSH
     C                     MOVE PCPY      POPCPY
     C                     MOVE PDUD      POPDUD
     C                     MOVE PEVT      POPEVT
     C                     MOVE LCD       POLCD
     C                     MOVE 'N'       PORCDG
     C                     MOVE *ZEROS    POSEQN
     C                     MOVE 'N'       POGMES
      *
     C                     WRITEPOSETDD1               88
      *
      ***  If the Write fails, then process a database error
      *
     C           *IN88     IFEQ *ON
     C           *LOCK     IN   LDA
     C                     Z-ADD5         DBASE            ***************
     C                     MOVEL'POSETDY1'DBFILE    P      * DB ERROR 05 *
     C                     MOVELPCPY      DBKEY     P      ***************
     C                     MOVEL'SE7561'  DBPGM     P
     C                     OUT  LDA
     C                     EXSR *PSSR
     C                     ENDIF
      *
      ***  End of Position Settlement Extension record not on file.
      *
     C                     ENDIF
      *
      ***  Check if record exists on Extension File.
      *
     C           KPOSET    CHAINPOSETDY2             89
      *
      ***  If it doesn't, set one up and Write it.
      *
     C           *IN89     IFEQ *ON
     C                     CLEARPOSETDD2
     C                     MOVE PBCA      P2PBCA
     C                     MOVE PSSH      P2PSSH
     C                     MOVE PCPY      P2PCPY
     C                     MOVE PDUD      P2PDUD
     C                     MOVE PEVT      P2PEVT
      *
     C                     WRITEPOSETDD2               88
      *
      ***  If the Write fails, then process a database error
      *
     C           *IN88     IFEQ *ON
     C           *LOCK     IN   LDA
     C                     Z-ADD6         DBASE            ***************
     C                     MOVEL'POSETDY2'DBFILE    P      * DB ERROR 06 *
     C                     MOVELPCPY      DBKEY     P      ***************
     C                     MOVEL'SE7561'  DBPGM     P
     C                     OUT  LDA
     C                     EXSR *PSSR
     C                     ENDIF
     C                     ENDIF
      ***  End of Portfolio Customers.
     C                     ENDIF
      ***  End of only Coupons and Dividends.
     C                     ENDIF
      ***  End of Portfolio Management licensed and MT5xx present.
     C                     ENDIF
      *
     C                     ENDSR
      *
      *****************************************************************
      /EJECT
      *****************************************************************
      *  #STDIS - Retrieve Standard Instructions for Corporate Actions*
      *  ------                                                       *
      *  Called by :                                                  *
      *  Calls     :                                                  *
      *****************************************************************
      *
     C           #STDIS    BEGSR
      *
      ***  If Depot/Customer indicator is 'C'
      *
     C           WWDPCU    IFEQ 'C'
     C           MCCOTP    ANDEQ'B'
      *
      ***  Retrieve the Standard Instructions for Books by accessing LF/SECOSIL2 with Branch,
      ***  Book, Corporate Action Type and Security Shortname
      *
     C                     MOVE MCBRCD    KBRCD   3        Branch
     C                     MOVE MCBOOK    KBOOK   2        Book
     C                     MOVE MCCOAT    KCOAT   2        Corporate Action Type
     C                     MOVE MCSESN    KSESN  10        Security
      *
     C           KSECO2    SETGTSECOSIL2
     C           KSECO2    REDPESECOSIL2                 89
      *
      ***  If no record found, access with Branch, Book, Corporate Action Type
      *
     C           *IN89     IFEQ '1'
     C           MORECI    ORNE 'D'
     C                     MOVE *BLANKS   KSESN
     C           KSECO2    SETGTSECOSIL2
     C           KSECO2    REDPESECOSIL2                 89
      *
      ***  If no record found, access with Branch, Book
      *
     C           *IN89     IFEQ '1'
     C           MORECI    ORNE 'D'
     C                     MOVE *BLANKS   KCOAT
     C           KSECO2    SETGTSECOSIL2
     C           KSECO2    REDPESECOSIL2                 89
      *
      ***  If no record found, access with Branch
      *
     C           *IN89     IFEQ '1'
     C           MORECI    ORNE 'D'
     C                     MOVE *BLANKS   KBOOK
     C           KSECO2    SETGTSECOSIL2
     C           KSECO2    REDPESECOSIL2                 89
     C                     ENDIF
     C                     ENDIF
     C                     ENDIF
      *
     C                     ELSE
      *
      ***  Retrieve the Standard Instructions for Customer by accessing LF/SECOSIL1 with Branch,
      ***  Customer and Portfolio Reference, Corporate Action Type and Security Shortname
      *
     C           WWDPCU    IFEQ 'C'
     C           MCCOTP    ANDEQ'C'
     C                     MOVE MCBRCD    KBRCD            Branch
     C**********           Z-ADDMCCNUM    KCNUM            Customer                           CSD027
     C                     MOVE MCCNUM    KCNUM            Customer                           CSD027
     C                     MOVE MCPTFR    KPTFR            Portfolio Reference
     C                     MOVE MCCOAT    KCOAT            Corporate Action Type
     C                     MOVE MCSESN    KSESN            Security
     C                     ELSE
     C           WWDPCU    IFEQ 'D'
     C                     MOVE MBBRCD    KBRCD            Branch
     C**********           Z-ADDMBDDPT    KCNUM            Customer                           CSD027
     C                     MOVE MBDDPT    KCNUM            Customer                           CSD027
     C                     MOVE *BLANKS   KPTFR            Portfolio Reference
     C                     MOVE MBCOAT    KCOAT            Corporate Action Type
     C                     MOVE MBSESN    KSESN            Security
     C                     ENDIF
     C                     ENDIF
      *
     C           KSECO1    SETGTSECOSIL1
     C           KSECO1    REDPESECOSIL1                 89
      *
      ***  If no record found, access with Branch, Customer and Portfolio Reference,
      ***  Corporate Action Type
      *
     C           *IN89     IFEQ '1'
     C           MORECI    ORNE 'D'
     C                     MOVE *BLANKS   KSESN
     C           KSECO1    SETGTSECOSIL1
     C           KSECO1    REDPESECOSIL1                 89
      *
      ***  If no record found, access with Branch, Customer
      *
     C           *IN89     IFEQ '1'
     C           MORECI    ORNE 'D'
     C                     MOVE *BLANKS   KCOAT
     C           KSECO1    SETGTSECOSIL1
     C           KSECO1    REDPESECOSIL1                 89
      *
      ***  If no record found, access with Branch
      *
     C           *IN89     IFEQ '1'
     C           MORECI    ORNE 'D'
     C**********           Z-ADD*ZEROS    KCNUM                                               CSD027
     C                     MOVE *BLANKS   KCNUM                                               CSD027
     C           KSECO1    SETGTSECOSIL1
     C           KSECO1    REDPESECOSIL1                 89
     C                     ENDIF
     C                     ENDIF
     C                     ENDIF
     C                     ENDIF
      *
      ***  If Standard Corporate Actions Instruction exists (record found with one of the access).
      *
     C                     MOVE 'N'       EXBCSI  1        Standard Instruction exist
     C           *IN89     IFEQ '0'
     C           MORECI    ANDEQ'D'
      *
      ***  Set 'Customer/Booh Standard Instruction Exists' work field to 'Y'.
      *
     C                     MOVE 'Y'       EXBCSI
     C                     ENDIF
      *
     C                     ENDSR
      *****************************************************************
      /EJECT
      *****************************************************************
      *  #SETIN - Retrieve Settlement Instructions for Customers      *
      *  ------                                                       *
      *  Called by :                                                  *
      *  Calls     :                                                  *
      *****************************************************************
      *
     C           #SETIN    BEGSR
      *
      ** Set Currency 1 to Event Currency
     C                     MOVELEVCY      W1CURR  3
      *
      ** Access SDSECSL0 for Customer Settlement Currency
     C                     MOVE MCCNUM    WCUST   6
     C                     EXSR #AOSEC
      *
     C           WALCCY    IFEQ 'Y'
      *
      ** Portfolio Reference not blank and not '9997'
     C           MCPTFR    IFNE *BLANKS
     C           MCPTFR    ANDNE'9997'
      *
      ** Access PMPORTPD for Portfolio Currency
      *
     C           KPMPRT    CHAINPMPORTPD             89
      *
     C           *IN89     IFEQ *ON
     C           *LOCK     IN   LDA
     C                     Z-ADD7         DBASE            *****************
     C                     MOVEL*BLANKS   DBFILE           ** DB ERROR 07 **
     C                     MOVEL'PMPORTPD'DBFILE    P      *****************
     C                     MOVELMCCNUM    DBKEY     P
     C                     MOVE MCPTFR    DBKEY
     C                     MOVEL'SE7561'  DBPGM     P
     C                     OUT  LDA
     C                     EXSR *PSSR
     C                     ENDIF
      *
      ** Set Currency 2 to PTFR Currency
     C                     MOVELPNPTCY    W2CURR  3
     C                     ENDIF
      *
      ** Portfolio reference not blank
     C           MCPTFR    IFNE *BLANKS
     C           BGPFMG    ANDEQ'Y'                                       CPB001
      *
      ** Access SDPLCSPD for Customer Base Currency
     C                     CALL 'AOPLCSR0'
     C                     PARM *BLANKS   @RTCD   7
     C                     PARM '*KEY   ' @OPTN   7
     C                     PARM WCUST     WLCUST 10
     C           SDPLCS    PARM SDPLCS    DSSDY
      *
     C           @RTCD     IFNE *BLANKS
     C           *LOCK     IN   LDA
     C                     Z-ADD8         DBASE            *****************
     C                     MOVEL*BLANKS   DBFILE           ** DB ERROR 08 **
     C                     MOVE 'SDPLCSPD'DBFILE           *****************
     C                     MOVELWCUST     DBKEY     P
     C                     MOVEL'SE7561'  DBPGM     P
     C                     OUT  LDA
     C                     EXSR *PSSR
     C                     ENDIF
      *
      ** Set Currency 3 to Customer Currency
     C                     MOVELQBCSBY    W3CURR  3
      *
      ** If PTFR = '9997', set Currency 2 to Customer Currency
     C           MCPTFR    IFEQ '9997'
     C           BGN4ST    ANDNE'Y'                                       CPB001
     C                     MOVELQBCSBY    W2CURR
     C                     ENDIF
      *
      ** else = Portfolio reference blank
     C                     ELSE
      *
      ** Set Currency 2 and Currency 3 to Customer Settlement CCY
     C                     MOVELBFPCYC    W2CURR
     C                     MOVELBFPCYC    W3CURR
     C                     ENDIF
     C                     ELSE
     C                     MOVE *BLANKS   W2CURR
     C                     MOVE *BLANKS   W3CURR
     C                     ENDIF
      *
      ** Check for Customer Account in Currency 1 & same Portfolio.
      ** If found, use this account otherwise check for Account in
      ** Currency 2 and 3.
     C           ZWACC1    KLIST
     C                     KFLD           KCNUM
     C                     KFLD           KCCY
     C                     KFLD           KPTFR
     C                     KFLD           KACSQ   20
     C*                                                                   219688
     C** ACCOUNT DETAILS PMACCNL1                                         219688
     C           ACCNTL    KLIST                                          219688
     C                     KFLD           KCNUM                           219688
     C                     KFLD           KPTFR                           219688
     C                     KFLD           KCCY                            219688
     C                     KFLD           WZACOD                          219688
     C                     KFLD           KACSQ                           219688
     C*                                                                   219688
      *
      ** Preset Key ZWACC1
     C                     MOVELMCCNUM    KCNUM
     C                     MOVELW1CURR    KCCY
     C                     MOVELMCPTFR    KPTFR
     C                     Z-ADD0         KACSQ
      *
      ** CURRENCY 1
     C** READ FIRST RECORD FOR ACCOUNT FOR THE SDSECSPD ACCOUNT CODE      219688
     C           ACCNTL    SETLLPMACCNL1                                  219688
     C                     READ PMACCNL1                 89               219688
      *                                                                   219688
     C                     MOVEL*IN89     WSAME   1                       219688
      *                                                                   219688
     C           *IN89     IFEQ '0'                                       219688
     C           CNUM      IFNE KCNUM                                     219688
     C           CCY       ORNE KCCY                                      219688
     C           PTFR      ORNE KPTFR                                     219688
     C           ACOD      ORNE WZACOD                                    219688
     C*                                                                   219688
     C           ZWACC1    SETLLPMACCNL0
     C                     READ PMACCNL0                 89
      *
     C                     MOVEL*IN89     WSAME   1
      *
     C           *IN89     IFEQ *OFF
     C           CNUM      IFNE KCNUM
     C           CCY       ORNE KCCY
     C           PTFR      ORNE KPTFR
     C*                                                                   219566
     C** IF system value 'UseDefaultSettAccnt' is 'Y' then                219566
     C**    get first record of same account and currency                 219566
     C           DEF001    IFEQ 'Y'                                       219566
     C                     MOVE *BLANKS   KPTFR                           219566
     C           ZWACC1    SETLLPMACCNL0                                  219566
     C                     READ PMACCNL0                 89               219566
      *                                                                   219566
     C           *IN89     IFEQ *OFF                                      219566
     C           CNUM      IFNE KCNUM                                     219566
     C           CCY       ORNE KCCY                                      219566
     C                     MOVEL*ON       WSAME                           219566
     C                     ENDIF                                          219566
     C                     ENDIF                                          219566
     C*                                                                   219566
     C                     ELSE                                           219566
     C                     MOVEL*ON       WSAME   1
     C                     ENDIF                           Endif DEF001=Y 219566
     C*                                                                   219566
     C                     ENDIF
     C                     ENDIF
      *
     C                     END                                            219688
     C                     END                                            219688
      *                                                                   219688
     C           WALCCY    IFEQ 'Y'
      *
      ** CURRENCY 2
     C           WSAME     IFEQ *ON
     C                     MOVELW2CURR    KCCY
      *
     C** READ FIRST RECORD FOR ACCOUNT FOR THE SDSECSPD ACCOUNT CODE      219688
     C           ACCNTL    SETLLPMACCNL1                                  219688
     C                     READ PMACCNL1                 89               219688
      *                                                                   219688
     C                     MOVEL*IN89     WSAME   1                       219688
      *                                                                   219688
     C           *IN89     IFEQ '0'                                       219688
     C           CNUM      IFNE KCNUM                                     219688
     C           CCY       ORNE KCCY                                      219688
     C           PTFR      ORNE KPTFR                                     219688
     C           ACOD      ORNE WZACOD                                    219688
     C*                                                                   219688
     C           ZWACC1    SETLLPMACCNL0
     C                     READ PMACCNL0                 89
      *
     C                     MOVEL*IN89     WSAME
      *
     C           *IN89     IFEQ *OFF
     C           CNUM      IFNE KCNUM
     C           CCY       ORNE KCCY
     C           PTFR      ORNE KPTFR
     C*                                                                   219566
     C** IF system value 'UseDefaultSettAccnt' is 'Y' then                219566
     C**    get first record of same account and currency                 219566
     C           DEF001    IFEQ 'Y'                                       219566
     C                     MOVE *BLANKS   KPTFR                           219566
     C           ZWACC1    SETLLPMACCNL0                                  219566
     C                     READ PMACCNL0                 89               219566
      *                                                                   219566
     C           *IN89     IFEQ *OFF                                      219566
     C           CNUM      IFNE KCNUM                                     219566
     C           CCY       ORNE KCCY                                      219566
     C                     MOVEL*ON       WSAME                           219566
     C                     ENDIF                                          219566
     C                     ENDIF                                          219566
     C*                                                                   219566
     C                     ELSE                                           219566
     C                     MOVEL*ON       WSAME
     C                     ENDIF                           Endif DEF001=Y 219566
     C*                                                                   219566
     C                     ENDIF
     C                     ENDIF
     C                     END                                            219688
     C                     END                                            219688
      *                                                                   219688
     C                     ENDIF
      *
      ** CURRENCY 3
     C           WSAME     IFEQ *ON
     C                     MOVELW3CURR    KCCY
     C*                                                                   219688
     C** READ FIRST RECORD FOR ACCOUNT FOR THE SDSECSPD ACCOUNT CODE      219688
     C           ACCNTL    SETLLPMACCNL1                                  219688
     C                     READ PMACCNL1                 89               219688
      *                                                                   219688
     C                     MOVEL*IN89     WSAME   1                       219688
      *                                                                   219688
     C           *IN89     IFEQ '0'                                       219688
     C           CNUM      IFNE KCNUM                                     219688
     C           CCY       ORNE KCCY                                      219688
     C           PTFR      ORNE KPTFR                                     219688
     C           ACOD      ORNE WZACOD                                    219688
     C*                                                                   219688
      *
     C           ZWACC1    SETLLPMACCNL0
     C                     READ PMACCNL0                 89
      *
     C                     MOVEL*IN89     WSAME
      *
     C           *IN89     IFEQ *OFF
     C           CNUM      IFNE KCNUM
     C           CCY       ORNE KCCY
     C           PTFR      ORNE KPTFR
     C*                                                                   219566
     C** IF system value 'UseDefaultSettAccnt' is 'Y' then                219566
     C**    get first record of same account and currency                 219566
     C           DEF001    IFEQ 'Y'                                       219566
     C                     MOVE *BLANKS   KPTFR                           219566
     C           ZWACC1    SETLLPMACCNL0                                  219566
     C                     READ PMACCNL0                 89               219566
      *                                                                   219566
     C           *IN89     IFEQ *OFF                                      219566
     C           CNUM      IFNE KCNUM                                     219566
     C           CCY       ORNE KCCY                                      219566
     C                     MOVEL*ON       WSAME                           219566
     C                     ENDIF                                          219566
     C                     ENDIF                                          219566
     C*                                                                   219566
     C                     ELSE                                           219566
     C                     MOVEL*ON       WSAME
     C                     ENDIF                           Endif DEF001=Y 219566
      *                                                                   219566
     C                     ENDIF
     C                     ENDIF
     C                     ENDIF
     C                     END                                            219688
     C                     END                                            219688
      *                                                                   219688
     C                     ENDIF
      *
     C                     ENDSR
      *****************************************************************
      /EJECT
      *****************************************************************
      *  #SACKB - Setup Account Keys and Amount fields                *
      *  ------   Book Account Keys                                   *
      *  Called by : #PDPRD                                           *
      *  Calls     : ZHASH #COAT #WACKB                               *
      *****************************************************************
      *
     C           #SACKB    BEGSR
      *
      ***  Check the processing type
      *
     C                     SELEC
      *
      ***  If the processing type is 'DV' (Income Events)
      ***     2 account keys generated on PF/SEKEYD
      *
     C           MAPTYP    WHEQ 'DV'
      *
      ***  Write key Cash Income Due - User
      *
     C                     CLEARWACKEY
      *
      ** .. Event Amount = Actual Cash Allocation + Cash Rounding
     C                     Z-ADDMCACAA    WWEVAM 170
     C                     ADD  MCACAR    WWEVAM           Book Total Cash
      *
      ***  EXECUTE HASH TOTALLING SUBROUTINE ONCE (Z=1) FOR FIRST
      ***  ARRAY ELEMENTS (IND,S DEC,S) SO S=1 ,ACCUMULATING ZZAMT(15/3)
      *
     C                     Z-ADD1         Z
     C                     Z-ADD1         S
     C                     Z-ADDWWEVAM    ZZAMT
     C                     EXSR ZHASH
      ** .. Account Key (iiiH--bbyy--mvn---DI)             Positions
     C                     MOVE WOSITP    WACITY           (1 - 3)
     C                     MOVE 'H'       WACEVC           (4)
     C                     MOVE *BLANKS   WACTRT           (5)
     C                     MOVE *BLANKS   WACPFI           (6)
     C                     MOVE MCBOOK    WACBKC           (7 - 8)
     C           BVCOTA    IFEQ 'Y'
     C                     MOVE MCCOAT    WKCOAT
     C                     EXSR #COAT
     C                     MOVE MMTSUB    WACTST           (9 - 10)
     C                     ELSE
     C                     MOVE *BLANKS   WACTST           (9 - 10)
     C                     ENDIF
     C                     MOVE *BLANKS   WACCCC           (11 - 12)
     C                     MOVE WOMKTI    WACMKT           (13)
      *
     C           BVCIAK    IFEQ 'Y'
     C           WOSCVI    ANDEQ'Y'
     C                     MOVE WOSCVI    WACCON           (14)
     C                     ELSE
     C                     MOVE *BLANKS   WACCON           (14)
     C                     ENDIF
      *
     C           BVNPAC    IFEQ 'N'
     C           WWEVAM    ORGE *ZERO
     C                     MOVE *BLANKS   WACNEG           (15)
     C                     ELSE
     C                     MOVE 'N'       WACNEG           (15)
     C                     ENDIF
      *
     C                     MOVE *BLANKS   WABLCK           (16 - 18)
     C                     MOVE 'DI'      WACAMC           (19 - 20)
      *
      ***  Write Account Key record for The book
      *
     C                     EXSR #WACKB
      *
      ***  Write key Stock Income Due - User
      *
     C                     CLEARWACKEY
      *
      ***  If subscription price is different than zero
      ** .. Event Amount = Actual stock Allocation * Subcription price
      ***  else
      ** .. Event Amount = Actual stock Allocation * maket price ex-date
     C           MDSBPR    IFNE *ZERO
     C                     Z-ADDMCASTA    WWEVAM
     C                     MULT MDSBPR    WWEVAM           Subscr. price has entered
     C                     ELSE
     C                     Z-ADDMCASTA    WWEVAM
     C                     MULT MAEXPC    WWEVAM           Subscr. price has not be entered
     C                     ENDIF
      *
      ***  If price basis is P, divide Event Amount by 100
      *
     C           WOSPBS    IFEQ 'P'
     C           WWEVAM    DIV  100       WWEVAM    H
     C                     END
      *
      ***  EXECUTE HASH TOTALLING SUBROUTINE ONCE (Z=1) FOR FIRST
      ***  ARRAY ELEMENTS (IND,S DEC,S) SO S=1 ,ACCUMULATING ZZAMT(15/3)
      *
     C                     Z-ADD1         Z
     C                     Z-ADD1         S
     C                     Z-ADDWWEVAM    ZZAMT
     C                     EXSR ZHASH
      ** .. Account Key (iiiH--bbyy--mvn---SD)             Positions
     C                     MOVE WOSITP    WACITY           (1 - 3)
     C                     MOVE 'H'       WACEVC           (4)
     C                     MOVE *BLANKS   WACTRT           (5)
     C                     MOVE *BLANKS   WACPFI           (6)
     C                     MOVE MCBOOK    WACBKC           (7 - 8)
     C           BVCOTA    IFEQ 'Y'
     C                     MOVE MCCOAT    WKCOAT
     C                     EXSR #COAT
     C                     MOVE MMTSUB    WACTST           (9 - 10)
     C                     ELSE
     C                     MOVE *BLANKS   WACTST           (9 - 10)
     C                     ENDIF
     C                     MOVE *BLANKS   WACCCC           (11 - 12)
     C                     MOVE WOMKTI    WACMKT           (13)
      *
     C           BVCIAK    IFEQ 'Y'
     C           WOSCVI    ANDEQ'Y'
     C                     MOVE WOSCVI    WACCON           (14)
     C                     ELSE
     C                     MOVE *BLANKS   WACCON           (14)
     C                     ENDIF
      *
     C           BVNPAC    IFEQ 'N'
     C           WWEVAM    ORGE *ZERO
     C                     MOVE *BLANKS   WACNEG           (15)
     C                     ELSE
     C                     MOVE 'N'       WACNEG           (15)
     C                     ENDIF
      *
     C                     MOVE *BLANKS   WABLCK           (16 - 18)
     C                     MOVE 'SD'      WACAMC           (19 - 20)
      *
      ***  Write Account Key record for The book
      *
     C                     EXSR #WACKB
      *
     C                     OTHER
      *
      ***  For all the other processing type (<> 'DV')
      *
      ***  Write key Cash Amount Due - User
      *
     C                     CLEARWACKEY
      *
      ** .. Event Amount = Actual Cash Allocation + actual cash rounding
     C                     Z-ADDMCACAA    WWEVAM
     C                     ADD  MCACAR    WWEVAM           Book Total Cash
      *
      ***  EXECUTE HASH TOTALLING SUBROUTINE ONCE (Z=1) FOR FIRST
      ***  ARRAY ELEMENTS (IND,S DEC,S) SO S=1 ,ACCUMULATING ZZAMT(15/3)
      *
     C                     Z-ADD1         Z
     C                     Z-ADD1         S
     C                     Z-ADDWWEVAM    ZZAMT
     C                     EXSR ZHASH
      ** .. Account Key (iiiX--bbyy--mvn---CD)             Positions
     C                     MOVE WOSITP    WACITY           (1 - 3)
     C                     MOVE 'X'       WACEVC           (4)
     C                     MOVE *BLANKS   WACTRT           (5)
     C                     MOVE *BLANKS   WACPFI           (6)
     C                     MOVE MCBOOK    WACBKC           (7 - 8)
     C           BVCOTA    IFEQ 'Y'
     C                     MOVE MCCOAT    WKCOAT
     C                     EXSR #COAT
     C                     MOVE MMTSUB    WACTST           (9 - 10)
     C                     ELSE
     C                     MOVE *BLANKS   WACTST           (9 - 10)
     C                     ENDIF
     C                     MOVE *BLANKS   WACCCC           (11 - 12)
     C                     MOVE WOMKTI    WACMKT           (13)
      *
     C           BVCIAK    IFEQ 'Y'
     C           WOSCVI    ANDEQ'Y'
     C                     MOVE WOSCVI    WACCON           (14)
     C                     ELSE
     C                     MOVE *BLANKS   WACCON           (14)
     C                     ENDIF
      *
     C           BVNPAC    IFEQ 'N'
     C           WWEVAM    ORGE *ZERO
     C                     MOVE *BLANKS   WACNEG           (15)
     C                     ELSE
     C                     MOVE 'N'       WACNEG           (15)
     C                     ENDIF
      *
     C                     MOVE *BLANKS   WABLCK           (16 - 18)
     C                     MOVE 'CD'      WACAMC           (19 - 20)
      *
      ***  Write Account Key record for The book
      *
     C                     EXSR #WACKB
      *
     C                     ENDSL
      *
     C                     ENDSR
      *
      *****************************************************************
      /EJECT
      *****************************************************************
      *  #SACKC - Setup Account Keys and Amount fields                *
      *  ------   Customer Account Keys                               *
      *  Called by : #PDPRD                                           *
      *  Calls     : ZHASH #AOSEC #COAT #WACKC                        *
      *****************************************************************
      *
     C           #SACKC    BEGSR
      *
      ***  Check the processing type
      *
     C                     SELEC
      *
      ***  If the processing type is 'DV' (Income Events)
      *
     C           MAPTYP    WHEQ 'DV'
      *
      ***  Write key Cash Income Due - Customer
      *
     C                     CLEARWACKEY
      *
      ** .. Event Amount = Actual Cash Allocation + Cash Rounding
     C                     Z-ADDMCACAA    WWEVAM
     C                     ADD  MCACAR    WWEVAM           Customer Total Cash
      *
      ***  EXECUTE HASH TOTALLING SUBROUTINE ONCE (Z=1) FOR FIRST
      ***  ARRAY ELEMENTS (IND,S DEC,S) SO S=1 ,ACCUMULATING ZZAMT(15/3)
      *
     C                     Z-ADD1         Z
     C                     Z-ADD1         S
     C                     Z-ADDWWEVAM    ZZAMT
     C                     EXSR ZHASH
      ** .. Account Key (iiiH-d--yy--mvn---DI)             Positions
     C                     MOVE WOSITP    WACITY           (1 - 3)
     C                     MOVE 'H'       WACEVC           (4)
     C                     MOVE *BLANKS   WACTRT           (5)
      *
      ***  If Classification is 'S' or 'D'
      ***  Issuer is not necessary a SE client defined on PF/SDSECSPD
      ***  So, no DB error if record not found !!!
      *
     C**********           MOVE WOISSR    WCUST                           163497
     C                     MOVE MCCNUM    WCUST                           163497
      *
     C                     MOVE *BLANKS   WZACOD 100                      219688
     C                     CALL 'AOSECSR0'
     C                     PARM *BLANKS   @RTCD   7
     C                     PARM '*KEY   ' @OPTN   7
     C                     PARM WCUST     @SCKY   6
     C           SDSECS    PARM SDSECS    DSSDY
      *
     C                     MOVE *BLANKS   WACPFI           (6)
     C           @RTCD     IFEQ *BLANKS
     C           BFCLAS    ANDEQ'S'
     C           @RTCD     OREQ *BLANKS
     C           BFCLAS    ANDEQ'D'
     C                     MOVE BFCLAS    WACPFI           (6)
     C                     ENDIF
      *
     C                     MOVE *BLANKS   WACBKC           (7 - 8)
      *                                                                   219688
     C                     MOVE BFACCD    WZACOD                          219688
      *                                                                   219688
     C           BVCOTA    IFEQ 'Y'
     C                     MOVE MCCOAT    WKCOAT
     C                     EXSR #COAT
     C                     MOVE MMTSUB    WACTST           (9 - 10)
     C                     ELSE
     C                     MOVE *BLANKS   WACTST           (9 - 10)
     C                     ENDIF
     C                     MOVE *BLANKS   WACCCC           (11 - 12)
     C                     MOVE WOMKTI    WACMKT           (13)
      *
     C           BVCIAK    IFEQ 'Y'
     C           WOSCVI    ANDEQ'Y'
     C                     MOVE WOSCVI    WACCON           (14)
     C                     ELSE
     C                     MOVE *BLANKS   WACCON           (14)
     C                     ENDIF
      *
     C           BVNPAC    IFEQ 'N'
     C           WWEVAM    ORGE *ZERO
     C                     MOVE *BLANKS   WACNEG           (15)
     C                     ELSE
     C                     MOVE 'N'       WACNEG           (15)
     C                     ENDIF
      *
     C                     MOVE *BLANKS   WABLCK           (16 - 18)
     C                     MOVE 'DI'      WACAMC           (19 - 20)
      *
      ***  Write Account Key record for The customer
      *
     C                     EXSR #WACKC
      *
     C                     OTHER
      *
      ***  For all the other processing type (<> 'DV')
      *
      ***  Write key Cash Amount Due - Customer
      *
     C                     CLEARWACKEY
      *
      ** .. Event Amount = Actual Cash Allocation + actual cash rounding
     C                     Z-ADDMCACAA    WWEVAM
     C                     ADD  MCACAR    WWEVAM           Customer Total Cash
      *
      ***  EXECUTE HASH TOTALLING SUBROUTINE ONCE (Z=1) FOR FIRST
      ***  ARRAY ELEMENTS (IND,S DEC,S) SO S=1 ,ACCUMULATING ZZAMT(15/3)
      *
     C                     Z-ADD1         Z
     C                     Z-ADD1         S
     C                     Z-ADDWWEVAM    ZZAMT
     C                     EXSR ZHASH
      ** .. Account Key (iiiX-d--yy--mvn---CD)             Positions
     C                     MOVE WOSITP    WACITY           (1 - 3)
     C                     MOVE 'X'       WACEVC           (4)
     C                     MOVE *BLANKS   WACTRT           (5)
      *
      ***  If Classification is 'S' or 'D'
      ***  Issuer is not necessary a SE client defined on PF/SDSECSPD
      ***  So, no DB error if record not found !!!
      *
     C                     MOVE WOISSR    WCUST
      *
     C                     MOVE *BLANKS   WZACOD                          219688
     C                     CALL 'AOSECSR0'
     C                     PARM *BLANKS   @RTCD   7
     C                     PARM '*KEY   ' @OPTN   7
     C                     PARM WCUST     @SCKY   6
     C           SDSECS    PARM SDSECS    DSSDY
      *
     C                     MOVE *BLANKS   WACPFI           (6)
     C           @RTCD     IFEQ *BLANKS
     C           BFCLAS    ANDEQ'S'
     C           @RTCD     OREQ *BLANKS
     C           BFCLAS    ANDEQ'D'
     C                     MOVE BFCLAS    WACPFI           (6)
     C                     ENDIF
      *
     C                     MOVE *BLANKS   WACBKC           (7 - 8)
      *                                                                   219688
     C                     MOVE BFACCD    WZACOD                          219688
      *                                                                   219688
     C           BVCOTA    IFEQ 'Y'
     C                     MOVE MCCOAT    WKCOAT
     C                     EXSR #COAT
     C                     MOVE MMTSUB    WACTST           (9 - 10)
     C                     ELSE
     C                     MOVE *BLANKS   WACTST           (9 - 10)
     C                     ENDIF
     C                     MOVE *BLANKS   WACCCC           (11 - 12)
     C                     MOVE WOMKTI    WACMKT           (13)
      *
     C           BVCIAK    IFEQ 'Y'
     C           WOSCVI    ANDEQ'Y'
     C                     MOVE WOSCVI    WACCON           (14)
     C                     ELSE
     C                     MOVE *BLANKS   WACCON           (14)
     C                     ENDIF
      *
     C           BVNPAC    IFEQ 'N'
     C           WWEVAM    ORGE *ZERO
     C                     MOVE *BLANKS   WACNEG           (15)
     C                     ELSE
     C                     MOVE 'N'       WACNEG           (15)
     C                     ENDIF
      *
     C                     MOVE *BLANKS   WABLCK           (16 - 18)
     C                     MOVE 'CD'      WACAMC           (19 - 20)
      *
      ***  Write Account Key record for The customer
      *
     C                     EXSR #WACKC
      *
     C                     ENDSL
      *
     C                     ENDSR
      *
      *****************************************************************
      /EJECT
      *****************************************************************
      *  #SACKD - Setup Account Keys and Amount fields                *
      *  ------   Depot Account Keys                                  *
      *  Called by : #PDPRD                                           *
      *  Calls     : ZHASH #AOSEC #COAT #WACKD                        *
      *****************************************************************
      *
     C           #SACKD    BEGSR
      *
      ***  Check the processing type
      *
     C                     SELEC
      *
      ***  If the processing type is 'DV' (Income Events)
      *
     C           MAPTYP    WHEQ 'DV'
      *
      ***  Write key Cash Income Due - Depot
      *
     C                     CLEARWACKEY
      *
      ** .. Event Amount = Actual Cash Allocation + Cash Rounding
     C                     Z-ADDMBACAA    WWEVAM
     C                     ADD  MBACAR    WWEVAM           Depot Total Cash
      *
      ***  EXECUTE HASH TOTALLING SUBROUTINE ONCE (Z=1) FOR FIRST
      ***  ARRAY ELEMENTS (IND,S DEC,S) SO S=1 ,ACCUMULATING ZZAMT(15/3)
      *
     C                     Z-ADD1         Z
     C                     Z-ADD1         S
     C                     Z-ADDWWEVAM    ZZAMT
     C                     EXSR ZHASH
      ** .. Account Key (iiiH-d--yy--mvn---DI)             Positions
     C                     MOVE WOSITP    WACITY           (1 - 3)
     C                     MOVE 'H'       WACEVC           (4)
     C                     MOVE *BLANKS   WACTRT           (5)
      *
      ***  If Classification is 'S' or 'D'
      *
     C                     MOVE MBDDPT    WCUST
     C                     EXSR #AOSEC
     C           BFCLAS    IFEQ 'S'
     C           BFCLAS    OREQ 'D'
     C                     MOVE BFCLAS    WACPFI           (6)
     C                     ELSE
     C                     MOVE *BLANKS   WACPFI           (6)
     C                     ENDIF
     C                     MOVE *BLANKS   WACBKC           (7 - 8)
     C           BVCOTA    IFEQ 'Y'
     C                     MOVE MBCOAT    WKCOAT
     C                     EXSR #COAT
     C                     MOVE MMTSUB    WACTST           (9 - 10)
     C                     ELSE
     C                     MOVE *BLANKS   WACTST           (9 - 10)
     C                     ENDIF
     C                     MOVE *BLANKS   WACCCC           (11 - 12)
     C                     MOVE WOMKTI    WACMKT           (13)
      *
     C           BVCIAK    IFEQ 'Y'
     C           WOSCVI    ANDEQ'Y'
     C                     MOVE WOSCVI    WACCON           (14)
     C                     ELSE
     C                     MOVE *BLANKS   WACCON           (14)
     C                     ENDIF
      *
     C           BVNPAC    IFEQ 'N'
     C           WWEVAM    ORGE *ZERO
     C                     MOVE *BLANKS   WACNEG           (15)
     C                     ELSE
     C                     MOVE 'N'       WACNEG           (15)
     C                     ENDIF
      *
     C                     MOVE *BLANKS   WABLCK           (16 - 18)
     C                     MOVE 'DI'      WACAMC           (19 - 20)
      *
      ***  Write Account Key record for The depot
      *
     C                     EXSR #WACKD
      *
     C                     OTHER
      *
      ***  For all the other processing type (<> 'DV')
      *
      ***  Write key Cash Amount Due - Depot
      *
     C                     CLEARWACKEY
      *
      ** .. Event Amount = Actual Cash Allocation + actual cash rounding
     C                     Z-ADDMBACAA    WWEVAM
     C                     ADD  MBACAR    WWEVAM           Depot Total Cash
      *
      ***  EXECUTE HASH TOTALLING SUBROUTINE ONCE (Z=1) FOR FIRST
      ***  ARRAY ELEMENTS (IND,S DEC,S) SO S=1 ,ACCUMULATING ZZAMT(15/3)
      *
     C                     Z-ADD1         Z
     C                     Z-ADD1         S
     C                     Z-ADDWWEVAM    ZZAMT
     C                     EXSR ZHASH
      ** .. Account Key (iiiX-d--yy--mvn---CD)             Positions
     C                     MOVE WOSITP    WACITY           (1 - 3)
     C                     MOVE 'X'       WACEVC           (4)
     C                     MOVE *BLANKS   WACTRT           (5)
      *
      ***  If Classification is 'S' or 'D'
      *
     C                     MOVE MBDDPT    WCUST
     C                     EXSR #AOSEC
     C*****      BFCLAS    IFEQ 'S'                                       151157
     C*****      BFCLAS    OREQ 'D'                                       151157
     C*****                MOVE BFCLAS    WACPFI           (6)            151157
     C*****                ELSE                                           151157
     C*****                MOVE *BLANKS   WACPFI           (6)            151157
     C*****                ENDIF                                          151157
     C                     MOVE 'X'       WACPFI           (6)            151157
     C                     MOVE *BLANKS   WACBKC           (7 - 8)
     C           BVCOTA    IFEQ 'Y'
     C                     MOVE MBCOAT    WKCOAT
     C                     EXSR #COAT
     C                     MOVE MMTSUB    WACTST           (9 - 10)
     C                     ELSE
     C                     MOVE *BLANKS   WACTST           (9 - 10)
     C                     ENDIF
     C                     MOVE *BLANKS   WACCCC           (11 - 12)
     C                     MOVE WOMKTI    WACMKT           (13)
      *
     C           BVCIAK    IFEQ 'Y'
     C           WOSCVI    ANDEQ'Y'
     C                     MOVE WOSCVI    WACCON           (14)
     C                     ELSE
     C                     MOVE *BLANKS   WACCON           (14)
     C                     ENDIF
      *
     C           BVNPAC    IFEQ 'N'
     C           WWEVAM    ORGE *ZERO
     C                     MOVE *BLANKS   WACNEG           (15)
     C                     ELSE
     C                     MOVE 'N'       WACNEG           (15)
     C                     ENDIF
      *
     C                     MOVE *BLANKS   WABLCK           (16 - 18)
     C                     MOVE 'CD'      WACAMC           (19 - 20)
      *
      ***  Write Account Key record for The depot
      *
     C                     EXSR #WACKD
      *
     C                     ENDSL
      *
     C                     ENDSR
      *
      *****************************************************************
      /EJECT
      *****************************************************************
      *  #WACKB - Write an account key for BOOK                       *
      *  ------                                                       *
      *  Called by : #SACKB                                           *
      *  Calls     : None                                             *
      *****************************************************************
      *
     C           #WACKB    BEGSR
      *
     C                     CLEARSEKEYDF
      *
      ** .. Account key
     C                     MOVELWACKEY    ACKY
      ** .. Trade Reference
     C                     Z-ADD*ZERO     TRFR
      ** .. Customer Number
     C**********           Z-ADDWOISSR    CSTN                                                CSD027
     C                     MOVE WOISSR    CSTN                                                CSD027
      ** .. Booking branch
     C                     MOVE MCBRCD    BRHA
      ** .. A/C Sequence
     C                     Z-ADD*ZERO     ASQN
      ** .. Event amount
     C                     Z-ADDWWEVAM    EVAM
      ** .. Event Date
     C                     Z-ADDMAEVDT    EVDT
      ** .. Event Ccy
     C           MAPTYP    IFNE 'CC'                                      CEU017
     C                     MOVE WONMCY    EVCY
     C                     ELSE                                           CEU017
     C                     MOVE NANCCY    EVCY                            CEU017
     C                     ENDIF                                          CEU017
      ** .. Settlement Type
     C                     Z-ADD*ZERO     STLT
      ** .. Settlement Account
     C                     MOVE *BLANKS   STLA
      ** .. Settlement Branch
     C                     MOVE *BLANKS   SEBR
      ** .. Reversal indicator
     C           MACHTP    IFEQ 'R'
     C                     MOVE '1'       RVRS
     C                     ELSE
     C                     MOVE '0'       RVRS
     C                     ENDIF
      ** .. Issuer
     C**********           Z-ADDWOISSR    ISSR                                                CSD027
     C                     MOVE WOISSR    ISSR                                                CSD027
      ** .. Tour depot customer
     C**********           Z-ADD*ZEROS    KCUST                                               CSD027
     C                     MOVE *BLANKS   KCUST                                               CSD027
      ** .. Nominal Ccy amount
     C                     Z-ADD*ZEROS    KNCA
      ** .. Nominal Ccy
     C           MAPTYP    IFNE 'CC'                                      CEU017
     C                     MOVE WONMCY    KCCY
     C                     ELSE                                           CEU017
     C                     MOVE NANCCY    KCCY                            CEU017
     C                     ENDIF                                          CEU017
      ** .. Base Ccy Amount
     C                     Z-ADD*ZEROS    KBCA
      ** .. Security Shortname
     C           MCSESN    IFEQ '**CASH**'
     C                     MOVELMASESN    SESH      P
     C                     ELSE
     C                     MOVELMCSESN    SESH      P
     C                     ENDIF
      ** .. Profit Centre
     C                     MOVE *BLANKS   PRFC
      *
      ***   If Profit Centre used
      *
     C           BKPRCU    IFEQ 'Y'
      *
     C                     MOVELCSTN      WKPCPY           Customer
     C                     MOVELBRHA      WKPBCA           Branch
     C                     MOVELSESH      WKPSSH    P      Security
      *
     C           KWSEPC    CHAINSEPCCDF              89
     C           *IN89     IFEQ *OFF
     C                     MOVELPCCU      PRFC
     C                     ELSE
     C                     MOVELWOSESN    WKDPSS           Event Security
     C           KWSEPC    CHAINSEPCCDF              89
     C           *IN89     IFEQ *OFF
     C                     MOVELPCCU      PRFC
     C                     ENDIF
     C                     ENDIF
     C                     ENDIF
      *
      ***  Analytical Accounting module is ON and Profit Centre is ON
      *
     C           BGN0ST    IFEQ 'Y'
     C           PRFC      ANDEQ*BLANKS
     C                     MOVE BVSEPC    PRFC
     C                     ENDIF
      ** .. Portfolio Reference
     C                     MOVE *BLANKS   PTFR
      ** .. Trans. Type
     C                     MOVE *BLANKS   PEV1
      ** .. Transaction number of last update
     C                     Z-ADD*ZERO     TNLU
      ** .. Record ID
     C                     MOVE 'D'       RECI
      *                                                                                       CGL020
      ** If Midas Compliance Watch is installed                                               CGL020
      *                                                                                       CGL020
     C           CGL020    IFEQ 'Y'                                                           CGL020
     C                     EXSR SRAMPR                                                        CGL020
     C                     ENDIF                                                              CGL020
      *
      ***  Write account key record
      *
     C                     WRITESEKEYDF
      *
      ***  Count Records Written
      *
     C                     ADD  1         W01CNT
     C                     MOVE 'Y'       WWDATA           one Read
      *
     C                     ENDSR
      *
      *****************************************************************
      /EJECT
      *****************************************************************
      *  #WACKC - Write an account key for CUSTOMER                   *
      *  ------                                                       *
      *  Called by : #SACKC                                           *
      *  Calls     : ZSETAC                                           *
      *****************************************************************
      *
     C           #WACKC    BEGSR
      *
     C                     CLEARSEKEYDF
      ** .. Account key
     C                     MOVELWACKEY    ACKY
      ** .. Trade Reference
     C                     Z-ADD*ZERO     TRFR
      ** .. Customer Number
     C**********           Z-ADDMCCNUM    CSTN                                                CSD027
     C                     MOVE MCCNUM    CSTN                                                CSD027
      ** .. Booking branch
     C                     MOVE MCBRCD    BRHA
      ** .. A/C Sequence
     C                     Z-ADD*ZERO     ASQN
      ** .. Event Date
     C                     Z-ADDMAEVDT    EVDT
      ** .. Event Amount
     C                     Z-ADDWWEVAM    EVAM
      ** .. Event Ccy
     C           MAPTYP    IFNE 'CC'                                      CEU017
     C                     MOVE WONMCY    EVCY
     C                     ELSE                                           CEU017
     C                     MOVE NANCCY    EVCY                            CEU017
     C                     ENDIF                                          CEU017
      ** .. Settlement Type
     C                     Z-ADD*ZERO     STLT
      ** .. Settlement Account
     C                     MOVE *BLANKS   STLA
      ** .. Settlement Branch
     C                     MOVE *BLANKS   SEBR
      *
     C           EXBCSI    IFEQ 'Y'                        Standard Instruction exist
      *
      ** .. Settlement Type
     C                     Z-ADDMOSMET    STLT
      ** .. Settlement Account
     C                     MOVE MOSACC    STLA
      ** .. Settlement Branch
     C                     MOVE MOSBRC    SEBR
      *
     C                     ELSE
      *
     C           BGPFMG    IFNE 'Y'                        Portfolio Management OFF
     C           BGN4ST    ANDNE'Y'                                       CPB001
      *
      ***  For Settlement Instruction access STDSED with key of
      ***  Branch and Customer,SECODPPD, Nominal CCY and Investment
      ***  Type,SECTYD
      *
     C                     MOVE MCBRCD    WKPBCA           Branch
     C**********           Z-ADDMCCNUM    WKPCPY           Customer                           CSD027
     C                     MOVE MCCNUM    WKPCPY           Customer                           CSD027
     C                     MOVE WONMCY    WKNMCY           Nominal Ccy
     C                     MOVE WOSITP    WKSITP           Sec. Inv. Type
     C                     MOVE WOSMCC    WKSMCC                                              CSE034
      *                                                                                       CSE028
     C           CSE028    IFEQ 'Y'                                                           CSE028
     C                     MOVE MCBOOK    WKPBCD           Book Code                          CSE028
     C                     MOVE MCPTFR    WKPTFR           Portfolio Reference                CSE028
     C                     ELSE                                                               CSE028
     C                     MOVE *BLANKS   WKPBCD           Book Code                          CSE028
     C                     MOVE *BLANKS   WKPTFR           Portfolio Reference                CSE028
     C                     ENDIF                                                              CSE028
      *                                                                                       CSE028
      ** If CSE028 is on, call SESSIR0 for default of MT5xx information                       CSE028
      *                                                                                       CSE028
     C           CSE028    IFEQ 'Y'                                                           CSE028
      *                                                                                       CSE028
     C                     EXSR SRSSIR                                                        CSE028
     C           NOTFND    IFEQ 'Y'                                                           CSE028
     C                     MOVE '1'       *IN89                                               CSE028
     C                     ELSE                                                               CSE028
     C                     MOVE '0'       *IN89                                               CSE028
     C                     ENDIF                                                              CSE028
      *                                                                                       CSE028
     C                     ELSE                                                               CSE028
      *                                                                                       CSE028
     C           KWSTDS    CHAINSTDSED               89
     C           *IN89     IFEQ *ON
     C                     MOVEL*BLANKS   WKSITP
     C           KWSTDS    CHAINSTDSED               89
     C                     ENDIF
      *                                                                                       CSE028
     C                     ENDIF                                                              CSE028
      *                                                                                       CSE028
     C/COPY WNCPYSRC,SE7561C007
     C           *IN89     IFEQ *OFF
      *                                                                   135691
      * CEU005 active and Settlement Ccy used on STDSED.                  135691
     C           CEU005    IFEQ 'Y'                                       135691
     C           SCCY      ANDNE*BLANKS                                   135691
     C                     MOVE SCCY      SVSCCY  3                       135691
      *                                                                   135691
      * Access currencies file for EURO rate, EURO M/D indicator and      135691
      * Transition Date for 'In' Ccy.                                     135691
      *                                                                   135691
     C           WONMCY    IFEQ BKEURO                                    135691
     C                     CALL 'AOCURRR0'                                135691
     C                     PARM           @RTCD   7                       135691
     C                     PARM '*KEY   ' @OPTN   7                       135691
     C                     PARM SCCY      @AJCD   3                       135691
     C           SDCURR    PARM SDCURR    DSSDY                           135691
     C           @RTCD     IFNE *BLANKS                                   135691
     C                     Z-ADD44        DBASE             ************  135691
     C                     MOVEL'SDCURRPD'DBFILE            * DATABASE *  135691
     C                     MOVELSCCY      DBKEY             * ERROR 44 *  135691
     C                     EXSR *PSSR                       ************  135691
     C                     ENDIF                                          135691
     C                     ELSE                                           135691
     C           SCCY      IFEQ BKEURO                                    135691
     C                     CALL 'AOCURRR0'                                135691
     C                     PARM           @RTCD   7                       135691
     C                     PARM '*KEY   ' @OPTN   7                       135691
     C                     PARM WONMCY    @AJCD   3                       135691
     C           SDCURR    PARM SDCURR    DSSDY                           135691
     C           @RTCD     IFNE *BLANKS                                   135691
     C                     Z-ADD45        DBASE             ************  135691
     C                     MOVEL'SDCURRPD'DBFILE            * DATABASE *  135691
     C                     MOVELWONMCY    DBKEY             * ERROR 45 *  135691
     C                     EXSR *PSSR                       ************  135691
     C                     ENDIF                                          135691
     C                     ENDIF                                          135691
     C                     ENDIF                                          135691
      *                                                                   135691
     C                     MOVE A6EUMD    SVEUMD                          135691
     C                     MOVE A6EUER    SVEUER                          135691
      *                                                                   135691
      * Value date is later than Transition Start Date.                   135691
     C           MACOPD    IFGE A6TPSD                                    135691
      * Chain STDSED again.                                               135691
     C                     MOVE SCCY      WKNMCY           Nominal Ccy    135691
      *                                                                                       CSE028
      ** If CSE028 is on, call SESSIR0 for default of MT5xx information                       CSE028
      *                                                                                       CSE028
     C           CSE028    IFEQ 'Y'                                                           CSE028
      *                                                                                       CSE028
     C                     EXSR SRSSIR                                                        CSE028
     C           NOTFND    IFEQ 'Y'                                                           CSE028
     C                     MOVE '1'       *IN78                                               CSE028
     C                     ELSE                                                               CSE028
     C                     MOVE '0'       *IN78                                               CSE028
     C                     ENDIF                                                              CSE028
      *                                                                                       CSE028
     C                     ELSE                                                               CSE028
      *                                                                                       CSE028
     C           KWSTDS    CHAINSTDSED               78                   135691
      *                                                                                       CSE028
     C                     ENDIF                                                              CSE028
      *                                                                                       CSE028
     C/COPY WNCPYSRC,SE7561C008
     C                     ENDIF                                          135691
     C                     ENDIF                                          135691
      *                                                                   135691
      * If no record found ensure fields from last chain not loaded       135691
      * to output fields.                                                 135691
     C           *IN78     IFEQ '0'                                       135691
      ** .. Settlement Type
     C                     Z-ADDSRSM      STLT
      ** .. Settlement Account
     C                     MOVELSRAC      STLA
      ** .. Settlement Branch
     C                     MOVELSRAB      SEBR
      *
      ***  If SRSM = 04 and SRAC = BLANKS the determine settlement A/C
      ***     via SR/ZSETAC  and output to field STLA
      *
     C           SRSM      IFEQ 04
     C           SRAC      ANDEQ*BLANK
      *
      ***  Pass Parameters to SR/ZSETAC and execute routine
      *
     C                     MOVE SRSM      ZMETH
     C                     MOVE SRAC      ZSETI
     C                     MOVE MCCNUM    ZCNUM
     C           CEU005    IFEQ 'Y'                                       135691
     C           SCCY      ANDNE*BLANKS                                   135691
     C                     MOVE SCCY      ZCCY                            135691
     C                     ELSE                                           135691
     C                     MOVE WONMCY    ZCCY
     C                     ENDIF                                          135691
     C                     MOVE SRAB      ZBRCA
     C                     EXSR ZSETAC
     C                     MOVELZSETO     STLA
     C                     MOVELZWBRCA    SEBR
     C                     ENDIF
     C                     ENDIF
     C                     ENDIF                                          135691
      *
     C                     ELSE                            Portfolio Management ON
     C                     MOVE 'N'       WALCCY  1
     C                     EXSR #SETIN
      *
      ** If Account found in any of currencies checked
     C           WSAME     IFEQ *OFF
      ** .. Settlement Type
     C                     MOVE '05'      STLT
      ** .. Settlement Account
     C                     MOVELPSEA1     STLA
      ** .. Settlement Branch
     C                     MOVE BRCA      SEBR
      *
     C                     ELSE
      *
      ** .. Settlement Type
     C                     MOVE *BLANKS   STLT
      ** .. Settlement Account
     C                     MOVE *BLANKS   STLA
      ** .. Settlement Branch
     C                     MOVE *BLANKS   SEBR
     C                     ENDIF
      *
     C                     ENDIF
      *
     C                     ENDIF
      *
      ** .. Reversal indicator
     C           MACHTP    IFEQ 'R'
     C                     MOVE '1'       RVRS
     C                     ELSE
     C                     MOVE '0'       RVRS
     C                     ENDIF
      ** .. Issuer
     C**********           Z-ADDWOISSR    ISSR                                                CSD027
     C                     MOVE WOISSR    ISSR                                                CSD027
      ** .. Tour depot customer
     C**********           Z-ADDMCCNUM    KCUST                                               CSD027
     C                     MOVE MCCNUM    KCUST                                               CSD027
      ** .. Nominal Ccy amount
     C                     Z-ADD*ZEROS    KNCA
      ** .. Nominal Ccy
     C           MAPTYP    IFNE 'CC'                                      CEU017
     C                     MOVE WONMCY    KCCY
     C                     ELSE                                           CEU017
     C                     MOVE NANCCY    KCCY                            CEU017
     C                     ENDIF                                          CEU017
      ** .. Base Ccy Amount
     C                     Z-ADD*ZEROS    KBCA
      ** .. Security Shortname
     C           MCSESN    IFEQ '**CASH**'
     C                     MOVELMASESN    SESH      P
     C                     ELSE
     C                     MOVELMCSESN    SESH      P
     C                     ENDIF
      ** .. Profit Centre
     C                     MOVE *BLANKS   PRFC
      *
      ***   If Profit Centre used
      *
     C           BKPRCU    IFEQ 'Y'
      *
     C                     MOVELCSTN      WKPCPY           Customer
     C                     MOVELBRHA      WKPBCA           Branch
     C                     MOVELSESH      WKPSSH    P      Security
      *
     C           KWSEPC    CHAINSEPCCDF              89
     C           *IN89     IFEQ *OFF
     C                     MOVELPCCU      PRFC
     C                     ELSE
     C                     MOVELWOSESN    WKDPSS           Event Security
     C           KWSEPC    CHAINSEPCCDF              89
     C           *IN89     IFEQ *OFF
     C                     MOVELPCCU      PRFC
     C                     ENDIF
     C                     ENDIF
     C                     ENDIF
      *
      ***  Analytical Accounting module is ON and Profit Centre is ON
      *
     C           BGN0ST    IFEQ 'Y'
     C           PRFC      ANDEQ*BLANKS
     C                     MOVE BVSEPC    PRFC
     C                     ENDIF
      ** .. Portfolio Reference
     C                     MOVE MCPTFR    PTFR
      ** .. Trans. Type
     C                     MOVE *BLANKS   PEV1
      ** .. Transaction number of last update
     C                     Z-ADD*ZERO     TNLU
      ** .. Record ID
     C                     MOVE 'D'       RECI
      *                                                                                       CGL020
      ** If Midas Compliance Watch is installed                                               CGL020
      *                                                                                       CGL020
     C           CGL020    IFEQ 'Y'                                                           CGL020
     C                     EXSR SRAMPR                                                        CGL020
     C                     ENDIF                                                              CGL020
      *
      ***  Write account key record
      *
     C                     WRITESEKEYDF
      *
      ***  Count Records Written
      *
     C                     ADD  1         W01CNT
     C                     MOVE 'Y'       WWDATA           one Read
      *
     C                     ENDSR
      *
      *****************************************************************
      /EJECT
      *****************************************************************
      *  #WACKD - Write an account key for DEPOT                      *
      *  ------                                                       *
      *  Called by : #SACKD                                           *
      *  Calls     : ZSETAC                                           *
      *****************************************************************
      *
     C           #WACKD    BEGSR
      *
     C                     CLEARSEKEYDF
      ** .. Account key
     C                     MOVELWACKEY    ACKY
      ** .. Trade Reference
     C                     Z-ADD*ZERO     TRFR
      ** .. Customer Number
     C**********           Z-ADDMBDDPT    CSTN                                                CSD027
     C                     MOVE MBDDPT    CSTN                                                CSD027
      ** .. Booking branch
     C                     MOVE MBBRCD    BRHA
      ** .. A/C Sequence
     C                     Z-ADD*ZERO     ASQN
      ** .. Event Date
     C                     Z-ADDMAEVDT    EVDT
      ** .. Event Amount
     C                     Z-ADDWWEVAM    EVAM
      ** .. Event Ccy
     C           MAPTYP    IFNE 'CC'                                      CEU017
     C                     MOVE WONMCY    EVCY
     C                     ELSE                                           CEU017
     C                     MOVE NANCCY    EVCY                            CEU017
     C                     ENDIF                                          CEU017
      ** .. Settlement Type
     C                     Z-ADD*ZERO     STLT
      ** .. Settlement Account
     C                     MOVE *BLANKS   STLA
      ** .. Settlement Branch
     C                     MOVE *BLANKS   SEBR
      *
     C           EXBCSI    IFEQ 'Y'                        Standard Instruction exist
      *
      ** .. Settlement Type
     C                     Z-ADDMOSMET    STLT
      ** .. Settlement Account
     C                     MOVE MOSACC    STLA
      ** .. Settlement Branch
     C                     MOVE MOSBRC    SEBR
      *
     C                     ELSE
      *
      ***  For Settlement Instruction access STDSED with key of
      ***  Branch and Customer,SECODPPD, Nominal CCY and Investment
      ***  Type,SECTYD
      *
     C                     MOVE MBBRCD    WKPBCA           Branch
     C**********           Z-ADDMBDDPT    WKPCPY           Customer                           CSD027
     C                     MOVE MBDDPT    WKPCPY           Customer                           CSD027
     C                     MOVE WONMCY    WKNMCY           Nominal Ccy
     C                     MOVE WOSITP    WKSITP           Sec. Inv. Type
     C                     MOVE WOSMCC    WKSMCC                                              CSE034
      *                                                                                       CSE028
     C           CSE028    IFEQ 'Y'                                                           CSE028
     C                     MOVE BVDMBC    WKPBCD           Book Code                          CSE028
     C                     MOVE *BLANKS   WKPTFR           Portfolio Reference                CSE028
     C                     ELSE                                                               CSE028
     C                     MOVE *BLANKS   WKPBCD           Book Code                          CSE028
     C                     MOVE *BLANKS   WKPTFR           Portfolio Reference                CSE028
     C                     ENDIF                                                              CSE028
      *                                                                                       CSE028
      ** If CSE028 is on, call SESSIR0 for default of MT5xx information                       CSE028
      *                                                                                       CSE028
     C           CSE028    IFEQ 'Y'                                                           CSE028
      *                                                                                       CSE028
     C                     EXSR SRSSIR                                                        CSE028
     C           NOTFND    IFEQ 'Y'                                                           CSE028
     C                     MOVE '1'       *IN89                                               CSE028
     C                     ELSE                                                               CSE028
     C                     MOVE '0'       *IN89                                               CSE028
     C                     ENDIF                                                              CSE028
      *                                                                                       CSE028
     C                     ELSE                                                               CSE028
      *                                                                                       CSE028
     C           KWSTDS    CHAINSTDSED               89
     C           *IN89     IFEQ *ON
     C                     MOVEL*BLANKS   WKSITP
     C           KWSTDS    CHAINSTDSED               89
     C                     ENDIF
      *                                                                                       CSE028
     C                     ENDIF                                                              CSE028
      *                                                                                       CSE028
     C/COPY WNCPYSRC,SE7561C009
     C           *IN89     IFEQ *OFF
      *                                                                   135691
      * CEU005 active and Settlement Ccy used on STDSED.                  135691
     C           CEU005    IFEQ 'Y'                                       135691
     C           SCCY      ANDNE*BLANKS                                   135691
     C                     MOVE SCCY      SVSCCY  3                       135691
      *                                                                   135691
      * Access currencies file for EURO rate, EURO M/D indicator and      135691
      * Transition Date for 'In' Ccy.                                     135691
      *                                                                   135691
     C           WONMCY    IFEQ BKEURO                                    135691
     C                     CALL 'AOCURRR0'                                135691
     C                     PARM           @RTCD   7                       135691
     C                     PARM '*KEY   ' @OPTN   7                       135691
     C                     PARM SCCY      @AJCD   3                       135691
     C           SDCURR    PARM SDCURR    DSSDY                           135691
     C           @RTCD     IFNE *BLANKS                                   135691
     C                     Z-ADD44        DBASE             ************  135691
     C                     MOVEL'SDCURRPD'DBFILE            * DATABASE *  135691
     C                     MOVELSCCY      DBKEY             * ERROR 44 *  135691
     C                     EXSR *PSSR                       ************  135691
     C                     ENDIF                                          135691
     C                     ELSE                                           135691
     C           SCCY      IFEQ BKEURO                                    135691
     C                     CALL 'AOCURRR0'                                135691
     C                     PARM           @RTCD   7                       135691
     C                     PARM '*KEY   ' @OPTN   7                       135691
     C                     PARM WONMCY    @AJCD   3                       135691
     C           SDCURR    PARM SDCURR    DSSDY                           135691
     C           @RTCD     IFNE *BLANKS                                   135691
     C                     Z-ADD45        DBASE             ************  135691
     C                     MOVEL'SDCURRPD'DBFILE            * DATABASE *  135691
     C                     MOVELWONMCY    DBKEY             * ERROR 45 *  135691
     C                     EXSR *PSSR                       ************  135691
     C                     ENDIF                                          135691
     C                     ENDIF                                          135691
     C                     ENDIF                                          135691
      *                                                                   135691
     C                     MOVE A6EUMD    SVEUMD                          135691
     C                     MOVE A6EUER    SVEUER                          135691
      *                                                                   135691
      * Value date is later than Transition Start Date.                   135691
     C           MACOPD    IFGE A6TPSD                                    135691
      * Chain STDSED again.                                               135691
     C                     MOVE SCCY      WKNMCY           Nominal Ccy    135691
      *                                                                                       CSE028
      ** If CSE028 is on, call SESSIR0 for default of MT5xx information                       CSE028
      *                                                                                       CSE028
     C           CSE028    IFEQ 'Y'                                                           CSE028
      *                                                                                       CSE028
     C                     EXSR SRSSIR                                                        CSE028
     C           NOTFND    IFEQ 'Y'                                                           CSE028
     C                     MOVE '1'       *IN78                                               CSE028
     C                     ELSE                                                               CSE028
     C                     MOVE '0'       *IN78                                               CSE028
     C                     ENDIF                                                              CSE028
      *                                                                                       CSE028
     C                     ELSE                                                               CSE028
      *                                                                                       CSE028
     C           KWSTDS    CHAINSTDSED               78                   135691
      *                                                                                       CSE028
     C                     ENDIF                                                              CSE028
      *                                                                                       CSE028
     C/COPY WNCPYSRC,SE7561C010
     C                     ENDIF                                          135691
     C                     ENDIF                                          135691
      *                                                                   135691
      * If no record found ensure fields from last chain not loaded       135691
      * to output fields.                                                 135691
     C           *IN78     IFEQ '0'                                       135691
      ** .. Settlement Type
     C                     Z-ADDSRSM      STLT
      ** .. Settlement Account
     C                     MOVELSRAC      STLA
      ** .. Settlement Branch
     C                     MOVELSRAB      SEBR
      *
      ***  If SRSM = 04 and SRAC = BLANKS the determine settlement A/C
      ***     via SR/ZSETAC  and output to field STLA
      *
     C           SRSM      IFEQ 04
     C           SRAC      ANDEQ*BLANK
      *
      ***  Pass Parameters to SR/ZSETAC and execute routine
      *
     C                     MOVE SRSM      ZMETH
     C                     MOVE SRAC      ZSETI
     C                     MOVE MBDDPT    ZCNUM
     C           CEU005    IFEQ 'Y'                                       135691
     C           SCCY      ANDNE*BLANKS                                   135691
     C                     MOVE SCCY      ZCCY                            135691
     C                     ELSE                                           135691
     C                     MOVE WONMCY    ZCCY
     C                     ENDIF                                          135691
     C                     MOVE SRAB      ZBRCA
     C                     EXSR ZSETAC
     C                     MOVELZSETO     STLA
     C                     MOVELZWBRCA    SEBR
     C                     ENDIF
     C                     ENDIF
     C                     ENDIF                                          135691
      *
     C                     ENDIF
      ** .. Reversal indicator
     C           MACHTP    IFEQ 'R'
     C                     MOVE '1'       RVRS
     C                     ELSE
     C                     MOVE '0'       RVRS
     C                     ENDIF
      ** .. Issuer
     C**********           Z-ADDWOISSR    ISSR                                                CSD027
     C                     MOVE WOISSR    ISSR                                                CSD027
      ** .. Tour depot customer
     C**********           Z-ADDMBDDPT    KCUST                                               CSD027
     C                     MOVE MBDDPT    KCUST                                               CSD027
      ** .. Nominal Ccy amount
     C                     Z-ADD*ZEROS    KNCA
      ** .. Nominal Ccy
     C           MAPTYP    IFNE 'CC'                                      CEU017
     C                     MOVE WONMCY    KCCY
     C                     ELSE                                           CEU017
     C                     MOVE NANCCY    KCCY                            CEU017
     C                     ENDIF                                          CEU017
      ** .. Base Ccy Amount
     C                     Z-ADD*ZEROS    KBCA
      ** .. Security Shortname
     C           MBSESN    IFEQ '**CASH**'
     C                     MOVELMASESN    SESH      P
     C                     ELSE
     C                     MOVELMBSESN    SESH      P
     C                     ENDIF
      ** .. Profit Centre
     C                     MOVE *BLANKS   PRFC
      *
      ***  Analytical Accounting module is ON
      *
     C           BGN0ST    IFEQ 'Y'
     C                     MOVE BVSEPC    PRFC
     C                     ENDIF
      ** .. Portfolio Reference
     C                     MOVE *BLANKS   PTFR
      ** .. Trans. Type
     C                     MOVE *BLANKS   PEV1
      ** .. Transaction number of last update
     C                     Z-ADD*ZERO     TNLU
      ** .. Record ID
     C                     MOVE 'D'       RECI
      *                                                                                       CGL020
      ** If Midas Compliance Watch is installed                                               CGL020
      *                                                                                       CGL020
     C           CGL020    IFEQ 'Y'                                                           CGL020
     C                     EXSR SRAMPR                                                        CGL020
     C                     ENDIF                                                              CGL020
      *
      ***  Write account key record
      *
     C                     WRITESEKEYDF
      *
      ***  Count Records Written
      *
     C                     ADD  1         W01CNT
     C                     MOVE 'Y'       WWDATA           one Read
      *
     C                     ENDSR
      *
      *****************************************************************
      /EJECT
      *****************************************************************
      *  #AOSEC -  Subroutine to Call Access Object:                  *
      *  ------    Security Customer                                  *
      *  Called by : #WPOSS #SACKD #SACKC                             *
      *  Calls     : AOSECSR0 *PSSR                                   *
      *****************************************************************
      *
     C           #AOSEC    BEGSR
      *
     C                     CALL 'AOSECSR0'
     C                     PARM *BLANKS   @RTCD   7
     C                     PARM '*KEY   ' @OPTN   7
     C                     PARM WCUST     @SCKY   6
     C           SDSECS    PARM SDSECS    DSSDY
      *
     C           @RTCD     IFNE *BLANKS
     C           *LOCK     IN   LDA
     C                     Z-ADD9         DBASE            ***************
     C                     MOVE *BLANKS   DBFILE           * DB ERROR 09 *
     C                     MOVEL'SDSECSPD'DBFILE    P      ***************
     C                     MOVELWCUST     DBKEY     P
     C                     MOVEL'SE7561'  DBPGM     P
     C                     OUT  LDA
     C                     EXSR *PSSR
     C                     ENDIF
      *
      *                                                                   219688
     C                     MOVE BFACCD    WZACOD                          219688
      *                                                                   219688
     C                     ENDSR
      *
      *****************************************************************
      /EJECT
      *****************************************************************
      *  #COAT -  Subroutine to Retrieve the Trade Sub-Type           *
      *  -----    Corporate Action Type                               *
      *  Called by : #SACKB #SACKC #SACKD                             *
      *  Calls     : *PSSR                                            *
      *****************************************************************
      *
     C           #COAT     BEGSR
      *
     C           WKCOAT    CHAINSECOATL0             89
      *
     C           *IN89     IFEQ *ON
     C           *LOCK     IN   LDA
     C                     Z-ADD10        DBASE            ***************
     C                     MOVE *BLANKS   DBFILE           * DB ERROR 10 *
     C                     MOVEL'SECOATL0'DBFILE    P      ***************
     C                     MOVELWKCOAT    DBKEY     P
     C                     MOVEL'SE7561'  DBPGM     P
     C                     OUT  LDA
     C                     EXSR *PSSR
     C                     ENDIF
      *
     C                     ENDSR
      *
      *****************************************************************
      /EJECT
      *****************************************************************
      *  CALAM2 - Calculate Charge amounts                            *
      *  ------                                                       *
      *  Called by : #WPOSS                                           *
      *  Calls     : *PSSR ZXRATE ZCCAL1                              *
      *****************************************************************
      *
     C           CALAM2    BEGSR
      *
      ***  Charge details
      *
     C                     MOVE CHGB      ZCHGB
     C                     MOVE THRI      ZTHRI
     C                     Z-ADDMNCH      ZMNCH
     C                     Z-ADDMXCH      ZMXCH
      *
      ***  Set up array for upper range limits
      *
     C                     Z-ADDSTU1      ZRA,1
     C                     Z-ADDSTU2      ZRA,2
     C                     Z-ADDSTU3      ZRA,3
     C                     Z-ADDSTU4      ZRA,4
     C                     Z-ADDSTU5      ZRA,5
     C                     Z-ADDSTU6      ZRA,6
     C                     Z-ADDSTU7      ZRA,7
     C                     Z-ADDSTU8      ZRA,8
     C                     Z-ADDSTU9      ZRA,9
     C                     Z-ADDST10      ZRA,10
     C                     Z-ADDST11      ZRA,11
     C                     Z-ADDST12      ZRA,12
     C                     Z-ADDST13      ZRA,13
     C                     Z-ADDST14      ZRA,14
      *
      ***  Set up array for percentage levels
      *
     C                     Z-ADDPL01      ZPC,1
     C                     Z-ADDPL02      ZPC,2
     C                     Z-ADDPL03      ZPC,3
     C                     Z-ADDPL04      ZPC,4
     C                     Z-ADDPL05      ZPC,5
     C                     Z-ADDPL06      ZPC,6
     C                     Z-ADDPL07      ZPC,7
     C                     Z-ADDPL08      ZPC,8
     C                     Z-ADDPL09      ZPC,9
     C                     Z-ADDPL10      ZPC,10
     C                     Z-ADDPL11      ZPC,11
     C                     Z-ADDPL12      ZPC,12
     C                     Z-ADDPL13      ZPC,13
     C                     Z-ADDPL14      ZPC,14
     C                     Z-ADDPL15      ZPC,15
      *
      ***  Set up array for flat charges
      *
     C                     Z-ADDFC01      ZCG,1
     C                     Z-ADDFC02      ZCG,2
     C                     Z-ADDFC03      ZCG,3
     C                     Z-ADDFC04      ZCG,4
     C                     Z-ADDFC05      ZCG,5
     C                     Z-ADDFC06      ZCG,6
     C                     Z-ADDFC07      ZCG,7
     C                     Z-ADDFC08      ZCG,8
     C                     Z-ADDFC09      ZCG,9
     C                     Z-ADDFC10      ZCG,10
     C                     Z-ADDFC11      ZCG,11
     C                     Z-ADDFC12      ZCG,12
     C                     Z-ADDFC13      ZCG,13
     C                     Z-ADDFC14      ZCG,14
     C                     Z-ADDFC15      ZCG,15
      *
     C                     CALL 'AOCURRR0'
     C                     PARM *BLANKS   @RTCD
     C                     PARM '*KEY  '  @OPTN
     C                     PARM PNCY      @CYCD   3
     C           SDCURR    PARM SDCURR    DSSDY
      *
     C           @RTCD     IFNE *BLANKS
     C           *LOCK     IN   LDA
     C                     Z-ADD11        DBASE            ***************
     C                     MOVE *BLANKS   DBFILE           * DB ERROR 11 *
     C                     MOVEL'SDCURRPD'DBFILE    P      ***************
     C                     MOVELPNCY      DBKEY     P
     C                     MOVEL'SE7561'  DBPGM     P
     C                     OUT  LDA
     C                     EXSR *PSSR
     C                     ENDIF
      *
     C                     MOVE A6NBDP    ZDECS
      *
      ***  Nominal decimal places
      *
     C                     Z-ADD0         ZNMDP
      *
      ***  Security details
      *
     C                     Z-ADD1         ZPRICE
     C                     Z-ADDPAMD      ZNOML
     C                     Z-ADD0         ZTCFC
     C                     MOVE 'P'       ZPROT
     C                     MOVE *BLANKS   ZSPBS
      *
     C           S01446    IFEQ 'Y'
      ***  Purchase interest
     C                     Z-ADD*ZEROS    ZTPI
      *
      ***  Access currencies file to get value currency decimal places
      *
     C                     CALL 'AOCURRR0'
     C                     PARM *BLANKS   @RTCD
     C                     PARM '*KEY  '  @OPTN
     C                     PARM VLCY      @CYCD
     C           SDCURR    PARM SDCURR    DSSDY
      *
     C           @RTCD     IFNE *BLANKS
     C           *LOCK     IN   LDA
     C                     Z-ADD12        DBASE            ***************
     C                     MOVE 'SDCURRPD'DBFILE    P      * DB ERROR 12 *
     C                     MOVELVLCY      DBKEY     P      ***************
     C                     MOVEL'SE7561'  DBPGM     P
     C                     OUT  LDA
     C                     EXSR *PSSR
     C                     END
      *
     C                     Z-ADDA6NBDP    WLVDCP  10
      *
     C           BVCHRC    IFNE *BLANKS
     C                     MOVE BVCHRC    ZCCYI
     C                     Z-ADDWLNBDP    ZCDPI   10
     C                     MOVE VLCY      ZCCYO
     C                     Z-ADDWLVDCP    ZCDPO   10
     C                     Z-ADDWOSPRT    ZRATE2 138
     C                     MOVE WOMDIN    ZMDI2   1
     C                     Z-ADDWLSPRT    ZRATE1 138
     C                     MOVE WLMDIN    ZMDI1   1
     C                     EXSR ZXRATE
     C                     MOVE ZRATEX    TRATEX 138
     C                     MOVE ZMDIX     TMDIX   1
     C                     MOVE TRATEX    ZEXCH
     C                     MOVE TMDIX     ZMD
      *
     C                     ELSE
      *
      ***  Total consideration
      *
     C                     Z-ADD*ZEROS    ZTCON
     C                     MOVE *BLANKS   ZCCYI
     C                     MOVE *BLANKS   ZCCYO
     C                     MOVE *BLANKS   ZEXCH
     C                     MOVE *BLANKS   ZMD
      *
     C                     END
      *                    END
     C                     END
      *
      ***   Total nominal
      *
     C                     Z-ADD*ZEROS    ZTNOM  150
      *
     C                     EXSR ZCCAL1
      *
     C                     ENDSR
      *
      *****************************************************************
      /EJECT
      *****************************************************************
      *  CALCTX - Subroutine to calculate tax amounts for dividends   *
      *           and Coupons                                         *
      *  ------                                                       *
      *  Called by : #WPOSS                                           *
      *  Calls     : *PSSR                                            *
      *****************************************************************
      *
     C           CALCTX    BEGSR
      *
     C           *LIKE     DEFN CLOC      UBRLOC           brch ctry
     C           *LIKE     DEFN S1RASO    UTXRSR           src tax rate
     C           *LIKE     DEFN TBRASR    UTXRRF           ref tax rate
     C           *LIKE     DEFN TBRAUS    UTXRUS           usr tax rate
     C           *LIKE     DEFN TBDLOR    UDLOR            ded.tax local
      *
      *** Initialise work tax rate and amount fields
      *
     C                     CLEARUTXRSR
     C                     CLEARUTXRRF
     C                     CLEARUTXRUS
     C                     CLEARUDLOR
      *
      *** If tax band at source is zero, then take rate from security
      *** WHT file; Otherwise access SEcountry tax rate file to
      *** get tax rate at source
      *
     C           S1TABD    IFEQ *ZERO                      *B1
     C                     Z-ADDS1RASO    UTXRSR
     C                     ELSE                            *X1
      *
     C                     MOVELS1CTTA    UKEY    3
     C                     MOVE S1TABD    UKEY
      *
     C                     CALL 'AOSCTXR0'
     C                     PARM *BLANKS   @RTCD
     C                     PARM '*KEY   ' @OPTN
     C                     PARM S1CTTA    @CTTA   2
     C                     PARM S1TABD    @TABD   10
     C           SECNTR    PARM SECNTR    DSSDY
     C*
     C           @RTCD     IFNE *BLANKS                    *B2
     C           TXRECI    ORNE 'D'
     C           *LOCK     IN   LDA
     C                     Z-ADD13        DBASE            ***************
     C                     MOVEL'SECNTRL0'DBFILE    P      * DB ERROR 13 *
     C                     MOVELUKEY      DBKEY     P      ***************
     C                     MOVEL'SE7561'  DBPGM     P
     C                     OUT  LDA
     C                     EXSR *PSSR
     C                     ELSE                            *X2
     C                     Z-ADDTXRASO    UTXRSR
     C                     END                             *E2
     C                     END                             *E1
      *
      *** If tax band by user is not zero, then access country to
      *** branch tax rate file to get tax rate by user
      *** Otherwise set to zero.
      *
     C           S1TABU    IFNE *ZERO                      *B1
     C                     CALL 'AOCBTXR0'
     C                     PARM *BLANKS   @RTCD
     C                     PARM '*KEY   ' @OPTN
     C                     PARM PBCA      @BRCA   3
     C                     PARM S1CTTA    @CTTA
     C                     PARM S1TABU    @TABU   10
     C           SECBTX    PARM SECBTX    DSFDY
     C*
     C           @RTCD     IFEQ *BLANKS                    *B2
     C           TBRECI    ANDEQ'D'
     C                     Z-ADDTBRASR    UTXRRF
     C                     Z-ADDTBRAUS    UTXRUS
     C                     MOVE TBDLOR    UDLOR
     C                     END                             *E2
     C                     END                             *E1
      *
      *** calculate amount deducted at source
      *
     C           UTXRSR    DIV  100       URATE   54
     C******     PAMD      MULT URATE     TASO      H
     C           WUPAMD    MULT URATE     TASO      H
      *
      *** calculate amount deducted refundable
      *
     C           UTXRRF    DIV  100       URATE
     C******     PAMD      MULT URATE     TASR      H
     C           WUPAMD    MULT URATE     TASR      H
      *
      *** calculate amount deducted by user
      *
     C                     CLEARTAUS
      *
     C           UTXRUS    IFGT *ZERO                      *B1
      *
     C           UDLOR     IFEQ 'N'                        *B2
     C                     MOVE PCPY      WCNUM
     C           CLKYCB    CHAINCLINT                89
     C           *IN89     IFEQ '1'                        *B3
     C           RECI      OREQ '*'
     C           *LOCK     IN   LDA
     C                     Z-ADD14        DBASE            ***************
     C                     MOVEL'CLINTCB 'DBFILE    P      * DB ERROR 14 *
     C                     MOVELPCPY      DBKEY     P      ***************
     C                     MOVEL'SE7561'  DBPGM     P
     C                     OUT  LDA
     C                     EXSR *PSSR
     C                     END                             *E3
     C                     END                             *E2
      *
     C           UDLOR     IFEQ 'Y'                        *B2
     C           UDLOR     OREQ 'N'
     C           CLOC      ANDNEUBRLOC
      *
     C           UTXRUS    DIV  100       URATE
     C******     PAMD      MULT URATE     TAUS      H
     C           WUPAMD    MULT URATE     TAUS      H
     C                     END                             *E2
      *
     C                     END                             *E1
      *
     C                     ENDSR
      *
      *****************************************************************
      /EJECT
      *****************************************************************
      *  #SECTO - Access to LF/SECTY to Retrieve fields details       *
      *  ------   for the old security                                *
      *  Called by : Main processing                                  *
      *  Calls     : AOCURRR0 *PSSR                                   *
      *****************************************************************
      *
     C           #SECTO    BEGSR
      *
      ***  Chain for security record
      *
     C           WKSESN    CHAINSECTY                89
      *
     C           *IN89     IFEQ *ON
     C           RECI      OREQ '*'
     C           *LOCK     IN   LDA
     C                     Z-ADD15        DBASE            ***************
     C                     MOVE *BLANKS   DBFILE           * DB ERROR 15 *
     C                     MOVEL'SECTY   'DBFILE    P      ***************
     C                     MOVELWKSESN    DBKEY     P
     C                     MOVEL'SE7561'  DBPGM     P
     C                     OUT  LDA
     C                     EXSR *PSSR
     C                     ENDIF
      *
      ***  Security nominal decimal places and price basis
      *
     C                     MOVELNMCY      WONMCY
     C                     MOVE MKTI      WOMKTI
     C**********           Z-ADDISSR      WOISSR                                              CSD027
     C                     MOVE ISSR      WOISSR                                              CSD027
     C                     MOVE SITP      WOSITP
     C                     MOVE SCVI      WOSCVI
     C                     MOVE SPBS      WOSPBS
     C                     MOVE SITP      WOSITP
     C                     MOVE SMCC      WOSMCC                                              CSE034
      *
      ***  Retrieve nomimal currency spot, m/d ind. and dec. places
      *
     C                     CALL 'AOCURRR0'
     C                     PARM *BLANKS   @RTCD   7
     C                     PARM '*KEY   ' @OPTN   7
     C                     PARM WONMCY    @CYCD   3
     C           SDCURR    PARM SDCURR    DSSDY
      *
     C           @RTCD     IFNE *BLANK
     C                     Z-ADD16        DBASE            *****************
     C                     MOVE *BLANKS   DBFILE           ** DB ERROR 16 **
     C                     MOVEL'SDCURRPD'DBFILE    P      *****************
     C                     MOVELWONMCY    DBKEY     P
     C                     MOVEL'SE7561'  DBPGM     P
     C                     EXSR *PSSR
     C                     ENDIF
      *
      ***  Save base currency spot, m/d indicator, dec. places for later
      *
     C                     Z-ADDA6SPRT    WOSPRT
     C                     MOVE A6MDIN    WOMDIN
     C                     Z-ADDA6NBDP    WONBDP
      *
     C                     ENDSR
     ******************************************************************
      /EJECT
      *****************************************************************
      *  #TERPR -  Termination processing                             *
      *  ------                                                       *
      *  Called by : Main processing                                  *
      *  Calls     : None                                             *
      *****************************************************************
      *
     C           #TERPR    BEGSR
      *
      ***  Update Gen A/C Keys audit and Position Settlement audit file
      *
     C                     Z-ADDW01CNT    NORE
     C                     Z-ADDINT,1     HRWN
     C                     Z-ADDDEC,1     HRDC
     C                     WRITESEKEYAF
      *
     C                     Z-ADDW02CNT    NORE
     C                     Z-ADD*ZEROS    TNLU
     C                     WRITEPOSETAF
      *
      ***  Output control report
      *
     C           WWDATA    IFEQ 'N'
     C                     WRITEHEADAU
     C                     WRITENODTLS                     No detail to report
     C                     ELSE
     C                     WRITEHEADAU
     C                     Z-ADDINT,1     WHASHT
     C                     Z-ADDDEC,1     WHASHD
     C                     WRITECONTROL
     C                     ENDIF
     C/COPY WNCPYSRC,SE7561C004
      *
     C                     MOVE *ON       *INLR
      *
      ***  Return out of the program
      *
     C                     RETRN
      *
     C                     ENDSR
      *
     ******************************************************************
      /EJECT
      *****************************************************************
      *   *INZSR : Program initialisation Subroutine                  *
      *  -------                                                      *
      *  Called by : Automatically at pgm start                       *
      *  Calls     : AOBANKR0 *PSSR                                   *
      *****************************************************************
      *
     C           *INZSR    BEGSR
      *
      ***  Copyright statement
      *
     C                     MOVEACPY@      BIS@   80
      *
     C           *ENTRY    PLIST
     C                     PARM           ACRLRN  1
      *
      ***  Initialise key and working fields
      *
      ***  PF/SECTYD
     C           *LIKE     DEFN SESN      WOSESN           Event Security
     C           *LIKE     DEFN SESN      WKDPSS           Security
     C           *LIKE     DEFN SESN      WKSESN           Security
     C           *LIKE     DEFN SITP      WOSITP           Inv. Type
     C           *LIKE     DEFN SMCC      WOSMCC                                              CSE034
     C           *LIKE     DEFN ISSR      WOISSR           Issuer
     C           *LIKE     DEFN NMCY      WONMCY           Nominal Ccy
     C           *LIKE     DEFN MKTI      WOMKTI           Market Indicator
     C           *LIKE     DEFN SCVI      WOSCVI           Convertible Indicator
     C           *LIKE     DEFN SPBS      WOSPBS           Price Basis
     C           *LIKE     DEFN SITP      WNSITP           Invest type
      ***  PF/POSETD
     C           *LIKE     DEFN PPRE      WWPPRE           Pay/Reversal
      ***  PF/SEKEYD
     C           *LIKE     DEFN PRFC      WWPRFC           Profit Centre
      ***  PF/SDCURRPD
     C           *LIKE     DEFN A6SPRT    WLSPRT           Spot Rate
     C           *LIKE     DEFN A6SPRT    WOSPRT           Spot Rate
     C           *LIKE     DEFN A6NBDP    WONBDP           Num. of Dec. Places
     C           *LIKE     DEFN A6NBDP    WLNBDP           Num. of Dec. Places
     C           *LIKE     DEFN A6MDIN    WLMDIN           Mult/Div. ind.
     C           *LIKE     DEFN A6MDIN    WOMDIN           Mult/Div. ind.
      ***  PF/
     C           *LIKE     DEFN MRTYPE    WKPEVT           Corporate Action Type
      ***  PF/SECODPPD
     C           *LIKE     DEFN MBCORF    WKCORF           CO Reference
     C           *LIKE     DEFN MBBRCD    WKBRCD           Branch
     C           *LIKE     DEFN MBDDPT    WKDDPT           Depot
     C           *LIKE     DEFN MBACAA    WWACAA           Actual Cash Allocation
     C           *LIKE     DEFN MBACAR    WWACAR           Cash Rounding
     C           *LIKE     DEFN MBEXPO    WWEXPO
     C           *LIKE     DEFN MBTNL1    WWTNLU           Last Trans. Num.
      ***  PF/
     C           *LIKE     DEFN MDCORF    KWCORF           CO Reference
      ***  PF/
     C           *LIKE     DEFN CNUM      WKPCPY           Customer Number
     C           *LIKE     DEFN BRCA      WKPBCA           Branch
     C           *LIKE     DEFN SESN      WKPSSH           Security
      ***  PF/SECOATPD
     C           *LIKE     DEFN MMTYPE    WKCOAT           Corporate Action Type
      ***  LF/SECGT
     C           *LIKE     DEFN CCOM      WKCCOM           Charge/Commission Nar.
      ***  SR/ZEVCD
     C           *LIKE     DEFN ECD       WWECD            Event Control Date
     C** EMU Currency fields                                              135691
     C           *LIKE     DEFN A6EUER    SVEUER                          135691
     C           *LIKE     DEFN A6EUMD    SVEUMD                          135691
      *
      ***   LDA initialization
      *
     C           *NAMVAR   DEFN           LDA
     C           *LOCK     IN   LDA
     C                     MOVE *BLANKS   DBFILE
     C                     MOVE *BLANKS   DBKEY
     C                     Z-ADD*ZEROS    DBASE
     C                     MOVE 'SE7561'  DBPGM     P
     C                     OUT  LDA
      *                                                                                     AR324886
      **  Define data area SDSTAT                                                           AR324886
      *                                                                                     AR324886
     C           *NAMVAR   DEFN           SDSTAT                                            AR324886
     C                     IN   SDSTAT                                                      AR324886
      *
      ***  Define data area SESTAT
      *
     C           *NAMVAR   DEFN           SESTAT
     C                     IN   SESTAT
      *
      ***  Call ZSFILE for Audit printer file SE7561AU
      *
     C                     Z-ADDSFNUMU    ZSNUM   60
     C                     CALL 'ZSFILE'
     C                     PARM           SEQ     5
     C                     PARM *BLANKS   @PARM   3
     C                     PARM           SFILEU
     C                     PARM           ZSNUM
     C                     PARM           ZSERR   1
      *
      ***  Program Ended abnormally
      *
     C           ZSERR     IFEQ 'Y'
     C           *LOCK     IN   LDA
     C                     Z-ADD17        DBASE            *****************
     C                     MOVE *BLANKS   DBFILE           ** DB ERROR 17 **
     C                     MOVEL'SE7561AU'DBFILE    P      *****************
     C           'ZSFILE R'CAT  'OUTINE'  DBKEY     P
     C                     MOVEL'SE7561'  DBPGM     P
     C                     OUT  LDA
     C                     EXSR *PSSR
     C                     ENDIF
      *
      ***  Access bank details
      *
     C                     CALL 'AOBANKR0'
     C                     PARM *BLANKS   @RTCD   7
     C                     PARM '*FIRST  '@OPTN   7
     C           SDBANK    PARM SDBANK    DSFDY
      *
     C           @RTCD     IFNE *BLANK
     C           *LOCK     IN   LDA
     C                     Z-ADD18        DBASE            *****************
     C                     MOVE *BLANKS   DBFILE           ** DB ERROR 18 **
     C                     MOVEL'SDBANKPD'DBFILE    P      *****************
     C                     MOVEL'*FIRST  'DBKEY     P
     C                     MOVEL'SE7561'  DBPGM     P
     C                     OUT  LDA
     C                     EXSR *PSSR
     C                     ENDIF
      *
      ** Retrieve Accruals/Profit Date form General Leg
      *
     C**********           CALL 'AOGELRR0'                                                    CGL029
     C                     CALL 'AOGELRR1'                                                    CGL029
     C                     PARM *BLANKS   @RTCD   7
     C                     PARM '*FIRST  '@OPTN   7
     C********** SDGELR    PARM SDGELR    DSFDY                                               CGL029
     C           SDGELR    PARM SDGELR    DSSDY                                               CGL029
      *
     C           @RTCD     IFNE *BLANK
     C           *LOCK     IN   LDA
     C                     Z-ADD19        DBASE            *****************
     C                     MOVE *BLANKS   DBFILE           ** DB ERROR 19 **
     C                     MOVEL'SDGELRPD'DBFILE    P      *****************
     C                     MOVEL'*FIRST  'DBKEY     P
     C                     MOVEL'SE7561'  DBPGM     P
     C                     OUT  LDA
     C                     EXSR *PSSR
     C                     ENDIF
      *
      ***  Access SE ICD
      *
     C                     CALL 'AOSTRDR0'
     C                     PARM *BLANKS   @RTCD   7
     C                     PARM '*FIRST  '@OPTN   7
     C           SDSTRD    PARM SDSTRD    DSSDY
      *
     C           @RTCD     IFNE *BLANK
     C           *LOCK     IN   LDA
     C                     Z-ADD20        DBASE            *****************
     C                     MOVE *BLANKS   DBFILE           ** DB ERROR 20 **
     C                     MOVEL'SDSTRDPD'DBFILE    P      *****************
     C                     MOVEL'*FIRST'  DBKEY     P
     C                     MOVEL'SE7561'  DBPGM     P
     C                     OUT  LDA
     C                     EXSR *PSSR
     C                     ENDIF
      *
      ***  Access Midas Module Details
      *
     C                     CALL 'AOMMODR0'
     C                     PARM *BLANKS   @RTCD   7
     C                     PARM '*FIRST  '@OPTN   7
     C           SDMMOD    PARM SDMMOD    DSFDY
      *
     C           @RTCD     IFNE *BLANK
     C           *LOCK     IN   LDA
     C                     Z-ADD21        DBASE            *****************
     C                     MOVE *BLANKS   DBFILE           ** DB ERROR 21 **
     C                     MOVEL'SDBANKPD'DBFILE    P      *****************
     C                     MOVEL'*FIRST  'DBKEY     P
     C                     MOVEL'SE7561'  DBPGM     P
     C                     OUT  LDA
     C                     EXSR *PSSR
     C                     ENDIF
      *                                                                   135691
      **  Check if feature EMU Settlement Ccy Conversion is on.           135691
      *                                                                   135691
     C                     CALL 'AOSARDR0'                                135691
     C                     PARM *BLANKS   @RTCD                           135691
     C                     PARM '*VERIFY' @OPTN                           135691
     C                     PARM 'CEU005'  @SARD                           135691
     C           SCSARD    PARM SCSARD    DSSDY                           135691
      *                                                                   135691
     C           @RTCD     IFEQ *BLANKS                                   135691
     C                     MOVE 'Y'       CEU005  1                       135691
     C                     ELSE                                           135691
     C                     MOVE 'N'       CEU005                          135691
     C                     ENDIF                                          135691
      *
      **  Access Switchable features file for MT5xx processing - S01401
      *
     C                     CALL 'AOSARDR0'
     C                     PARM *BLANKS   @RTCD
     C                     PARM '*VERIFY' @OPTN
     C                     PARM 'S01401'  @SARD   6
     C           SCSARD    PARM SCSARD    DSSDY
      *
     C           @RTCD     IFEQ *BLANKS
     C                     MOVE 'Y'       S01401
     C                     ELSE
     C                     MOVE 'N'       S01401  1
     C                     ENDIF
      *                                                                   CSE023
      ** Check if CSE023 - Treaty withholding Tax is switched ON          CSE023
      *                                                                   CSE023
     C                     CALL 'AOSARDR0'                                CSE023
     C                     PARM *BLANKS   @RTCD                           CSE023
     C                     PARM '*VERIFY' @OPTN                           CSE023
     C                     PARM 'CSE023'  @SARD   6                       CSE023
      *                                                                   CSE023
     C           @RTCD     IFEQ *BLANK                                    CSE023
     C                     MOVE 'Y'       CSE023  1                       CSE023
     C                     ELSE                                           CSE023
     C                     MOVE 'N'       CSE023                          CSE023
     C                     END                                            CSE023
      *
      ***  Check if feature "Customer Commissions/Courtage" is on
      *
     C                     CALL 'AOSARDR0'
     C                     PARM *BLANKS   @RTCD
     C                     PARM '*VERIFY' @OPTN
     C                     PARM 'S01446'  @SARD   6
     C           SCSARD    PARM SCSARD    DSSDY
      *
     C           @RTCD     IFEQ *BLANKS
     C                     MOVE 'Y'       S01446
     C                     ELSE
     C                     MOVE 'N'       S01446  1
     C                     ENDIF
      *                                                                                       CER048
     C                     CALL 'AOSARDR0'                                                    CER048
     C                     PARM *BLANKS   @RTCD                                               CER048
     C                     PARM '*VERIFY' @OPTN                                               CER048
     C                     PARM 'CER048'  @SARD                                               CER048
     C           SCSARD    PARM SCSARD    DSSDY                                               CER048
      *                                                                                       CER048
     C           @RTCD     IFEQ *BLANKS                                                       CER048
     C                     MOVE 'Y'       CER048                                              CER048
     C                     ELSE                                                               CER048
     C                     MOVE 'N'       CER048  1                                           CER048
     C                     ENDIF                                                              CER048
      *
      ***  If feature "Customer Commissions/Courtage" is on and
      ***  securities charges currency is not blank, access currencies
      ***  file to get spot rate, mult/div ind. & no. of decimal places
      *
     C           S01446    IFEQ 'Y'
     C           BVCHRC    ANDNE*BLANKS
      *
     C                     CALL 'AOCURRR0'
     C                     PARM *BLANKS   @RTCD
     C                     PARM '*KEY  '  @OPTN
     C                     PARM BVCHRC    @CYCD
     C           SDCURR    PARM SDCURR    DSSDY
      *
     C           @RTCD     IFNE *BLANKS
     C           *LOCK     IN   LDA
     C                     Z-ADD22        DBASE            *****************
     C                     MOVE *BLANKS   DBFILE           ** DB ERROR 22 **
     C                     MOVEL'SDCURRPD'DBFILE    P      *****************
     C                     MOVELBVCHRC    DBKEY     P
     C                     MOVEL'SE7561'  DBPGM     P
     C                     OUT  LDA
     C                     EXSR *PSSR
     C                     ENDIF
      *
     C                     Z-ADDA6SPRT    WLSPRT
     C                     Z-ADDA6NBDP    WLNBDP
     C                     MOVE A6MDIN    WLMDIN
     C                     ENDIF
      *
      ***  Check if feature "Jyske Enhancements" is on
      *
     C                     CALL 'AOSARDR0'
     C                     PARM *BLANKS   @RTCD
     C                     PARM '*VERIFY' @OPTN
     C                     PARM 'S01496'  @SARD
     C           SCSARD    PARM SCSARD    DSSDY
      *
     C           @RTCD     IFEQ *BLANKS
     C                     MOVE 'Y'       S01496
     C                     ELSE
     C                     MOVE 'N'       S01496  1
     C                     ENDIF
      *
      ***  Check if feature "Withholding Tax" is on
      *
     C                     CALL 'AOSARDR0'
     C                     PARM *BLANKS   @RTCD
     C                     PARM '*VERIFY' @OPTN
     C                     PARM 'S01447'  @SARD
     C           SCSARD    PARM SCSARD    DSSDY
      *
     C           @RTCD     IFEQ *BLANKS
     C                     MOVE 'Y'       S01447
     C                     ELSE
     C                     MOVE 'N'       S01447  1
     C                     ENDIF
      *
      ***  Check if feature "Position Settlements Autocharges" is on
      *
     C                     CALL 'AOSARDR0'
     C                     PARM *BLANKS   @RTCD
     C                     PARM '*VERIFY' @OPTN
     C                     PARM 'S01519'  @SARD
     C           SCSARD    PARM SCSARD    DSSDY
      *
     C           @RTCD     IFEQ *BLANKS
     C                     MOVE 'Y'       S01519
     C                     ELSE
     C                     MOVE 'N'       S01519  1
     C                     ENDIF
      *                                                                   CEU017
      ***  Check feature "Securities Redenomination Euro Changes" is on   CEU017
      *                                                                   CEU017
     C                     CALL 'AOSARDR0'                                CEU017
     C                     PARM *BLANKS   @RTCD                           CEU017
     C                     PARM '*VERIFY' @OPTN                           CEU017
     C                     PARM 'CEU017'  @SARD                           CEU017
     C           SCSARD    PARM SCSARD    DSSDY                           CEU017
      *                                                                   CEU017
     C           @RTCD     IFEQ *BLANKS                                   CEU017
     C                     MOVE 'Y'       CEU017                          CEU017
     C                     ELSE                                           CEU017
     C                     MOVE 'N'       CEU017  1                       CEU017
     C                     ENDIF                                          CEU017
      *                                                                                       CSE028
      ** Check if CSE028 - MT5xx Standing Settlements Instructions is                         CSE028
      **   is switched on.                                                                    CSE028
      *                                                                                       CSE028
     C                     CALL 'AOSARDR0'                                                    CSE028
     C                     PARM *BLANKS   @RTCD                                               CSE028
     C                     PARM '*VERIFY' @OPTN                                               CSE028
     C                     PARM 'CSE028'  @SARD                                               CSE028
     C           SCSARD    PARM SCSARD    DSSDY                                               CSE028
      *                                                                                       CSE028
     C           @RTCD     IFEQ *BLANK                                                        CSE028
     C                     MOVE 'Y'       CSE028  1                                           CSE028
     C                     ELSE                                                               CSE028
     C                     MOVE 'N'       CSE028                                              CSE028
     C                     ENDIF                                                              CSE028
      *                                                                                       CGL031
     C                     CALL 'AOSARDR0'                                                    CGL031
     C                     PARM *BLANKS   @RTCD                                               CGL031
     C                     PARM '*VERIFY' @OPTN                                               CGL031
     C                     PARM 'CGL031'  @SARD                                               CGL031
     C           SCSARD    PARM SCSARD    DSSDY                                               CGL031
      *                                                                                       CGL031
     C           @RTCD     IFEQ *BLANK                                                        CGL031
     C                     MOVE 'Y'       CGL031  1                                           CGL031
     C                     ELSE                                                               CGL031
     C                     MOVE 'N'       CGL031                                              CGL031
     C                     ENDIF                                                              CGL031
     C/COPY WNCPYSRC,SE7561C002
      *
     C                     EXSR ZICD2
      *
      *  ERROR IN ZICD2
      *
     C           *INU8     IFEQ *ON
     C           *LOCK     IN   LDA
     C                     Z-ADD23        DBASE            *****************
     C                     MOVE *BLANKS   DBFILE           ** DB ERROR 23 **
     C                     MOVEL'TABSE'   DBFILE    P      *****************
     C                     MOVELZTABKY    DBKEY     P
     C                     MOVEL'SE7561'  DBPGM     P
     C                     OUT  LDA
     C                     EXSR *PSSR
     C                     ENDIF
      *
      ** Determine if Midas Compliance Watch is installed                                     CGL020
      *                                                                                       CGL020
     C                     MOVE 'N'       CGL020  1                                           CGL020
     C                     CALL 'AOSARDR0'                                                    CGL020
     C                     PARM '       ' @RTCD                                               CGL020
     C                     PARM '*VERIFY' @OPTN                                               CGL020
     C                     PARM 'CGL020'  @SARD                                               CGL020
     C           SCSARD    PARM SCSARD    DSFDY                                               CGL020
      *                                                                                       CGL020
     C           @RTCD     IFNE *BLANK                                                        CGL020
     C           @RTCD     ANDNE'*NRF   '                                                     CGL020
     C           *LOCK     IN   LDA                                                           CGL020
     C                     MOVEL'SCSARDPD'DBFILE                                              CGL020
     C                     Z-ADD24        DBASE                                               CGL020
     C                     MOVEL@SARD     DBKEY                                               CGL020
     C                     OUT  LDA                                                           CGL020
     C                     EXSR *PSSR                                                         CGL020
      *                                                                                       CGL020
     C                     ELSE                                                               CGL020
     C                     MOVE 'Y'       CGL020                                              CGL020
     C                     ENDIF                                                              CGL020
      *                                                                                       CGL020
      *                                                                                     AR853119
      ** Check if CER049 - Stamp Tax is switch on                                           AR853119
      *                                                                                     AR853119
     C                     CALL 'AOSARDR0'                                                  AR853119
     C                     PARM *BLANKS   @RTCD                                             AR853119
     C                     PARM '*VERIFY' @OPTN                                             AR853119
     C                     PARM 'CER049'  @SARD                                             AR853119
      *                                                                                     AR853119
     C           @RTCD     IFEQ *BLANK                                                      AR853119
     C                     MOVE 'Y'       CER049  1                                         AR853119
     C                     ELSE                                                             AR853119
     C                     MOVE 'N'       CER049                                            AR853119
     C                     ENDIF                                                            AR853119
      *                                                                                     AR853119
      **  Access SDSAVLPD for Default settlement account to portfolio 001 indicator (Y/N)     219566
     C                     CALL 'AOSVALR0'                                                    219566
     C                     PARM *BLANKS   RTNCDE  7                                           219566
     C                     PARM           SVALK1 20                                           219566
     C                     PARM           SVAL1 200                                           219566
     C                     PARM           SVALK2 20                                           219566
     C                     PARM           SVAL2 200                                           219566
     C                     PARM           SVALK3 20                                           219566
     C                     PARM           SVAL3 200                                           219566
     C                     PARM           SVALK4 20                                           219566
     C                     PARM           SVAL4 200                                           219566
     C                     PARM           SVALK5 20                                           219566
     C                     PARM           SVAL5 200                                           219566
     C                     PARM           SVALK6 20                                           219566
     C                     PARM           SVAL6 200                                           219566
     C                     PARM           SVALK7 20                                           219566
     C                     PARM           SVAL7 200                                           219566
     C                     PARM           SVALK8 20                                           219566
     C                     PARM           SVAL8 200                                           219566
     C                     PARM           SVALK9 20                                           219566
     C                     PARM           SVAL9 200                                           219566
     C                     PARM           SVALK0 20                                           219566
     C                     PARM           SVAL10200                                           219566
      *                                                                                       219566
     C           RTNCDE    IFNE *BLANKS                                                       219566
     C           *LOCK     IN   LDA                                                           219566
     C                     MOVE SVALK1    DBKEY            * DB ERROR 50 *                    219566
     C                     Z-ADD50        DBASE                                               219566
     C                     MOVE 'SDSVALPD'DBFILE                                              219566
     C                     MOVEL'SE7561'  DBPGM                                               219566
     C                     OUT  LDA                                                           219566
     C                     EXSR *PSSR                                                         219566
     C                     ENDIF                                                              219566
      *                                                                                       219566
      ***  Klist for ACCNT
      *
     C           ZWACCN    KLIST
     C                     KFLD           ZWCNUM
     C                     KFLD           ZWCCY
     C                     KFLD           ZWACOD
     C                     KFLD           ZWACSQ
     C                     KFLD           ZWBRCA
      *
     C           KWCODP    KLIST
     C                     KFLD           WKCORF           Reference
     C                     KFLD           WKBRCD           Branch
     C                     KFLD           WKDDPT           Depot
      *
     C           KWINV     KLIST
     C                     KFLD           WKNMCY
     C                     KFLD           WKSITP
      *
     C           KWCOOP    KLIST
     C                     KFLD           WKCOR2           Reference
     C                     KFLD           WKOPT2           Branch
      *
     C           KWSEPC    KLIST
     C                     KFLD           WKPCPY           Customer
     C                     KFLD           WKPBCA           Branch
     C                     KFLD           WKPSSH           Security
      *
     C           KWSTDS    KLIST
     C                     KFLD           WKPBCA           Branch
     C                     KFLD           WKPCPY           Customer
     C                     KFLD           WKPBCD  2        Book Code                          CSE028
     C                     KFLD           WKNMCY           Nominal Ccy
     C                     KFLD           WKSITP           Sec. Inv. Type
     C                     KFLD           WKPTFR  4        Portfolio Reference                CSE028
      *
     C           KWCOH1    KLIST                           Long key for file SEC
     C                     KFLD           WKCUGR  2        Customer Group
     C                     KFLD           WKPCPY           Customer
     C                     KFLD           WKSITP           Investment Type
     C                     KFLD           WKPEVT           Event Type
      *
     C           KWCOH2    KLIST                           Long key for file SEC
     C                     KFLD           WKCLAS  1        Classification
     C                     KFLD           WKPCPY           Customer
     C                     KFLD           WKSITP           Investment Type
     C                     KFLD           WKPEVT           Event Type
      *
     C           KWSECG    KLIST
     C                     KFLD           WKNMCY           Event Nominal Currency
     C                     KFLD           WKCCOM           Commission Code
      *
      ***  Access to LF/POSETDY1 et LF/POSETDY2
      *
     C           KPOSET    KLIST
     C                     KFLD           PBCA
     C                     KFLD           PSSH
     C                     KFLD           PCPY
     C                     KFLD           PDUD
     C                     KFLD           PEVT
      *
      ***  Get Country Location - LF/CLINT (PF/CLINTCB)
      *
     C           CLKYCB    KLIST
     C**********           KFLD           WCNUM   60                                          CSD027
     C                     KFLD           WCNUM   6                                           CSD027
     C                     KFLD           WRTYP   1
      *
     C           KSECO1    KLIST                           Key for file SECOSIL1
     C                     KFLD           KBRCD   3        Branch
     C**********           KFLD           KCNUM   60       Customer                           CSD027
     C                     KFLD           KCNUM   6        Customer                           CSD027
     C                     KFLD           KPTFR   4        Portfolio Reference
     C                     KFLD           KCOAT   2        Corporate Action Type
     C                     KFLD           KSESN  10        Security
      *
     C           KSECO2    KLIST                           Key for file SECOSIL2
     C                     KFLD           KBRCD   3        Branch
     C                     KFLD           KBOOK   2        Book
     C                     KFLD           KCOAT   2        Corporate Action Type
     C                     KFLD           KSESN  10        Security
      *
     C           KPMPRT    KLIST
     C                     KFLD           MCCNUM
     C                     KFLD           MCPTFR
      *                                                                                       CGL031
     C           KTXBS1    KLIST                                                              CGL031
     C                     KFLD           DVCNCD                                              CGL031
     C                     KFLD           EWCTRT                                              CGL031
     C                     KFLD           BJRDNB                                              CGL031
      *                                                                                       CGL031
     C           KTXBS2    KLIST                                                              CGL031
     C                     KFLD           DVCNCD                                              CGL031
     C                     KFLD           EWCTRT                                              CGL031
      *                                                                                       CGL031
     C           KTXCM1    KLIST                                                              CGL031
     C                     KFLD           DVCNCD                                              CGL031
     C                     KFLD           PCTTX                                               CGL031
      *
     C                     MOVE 'A'       WRTYP
      *
      ***  Calculate "Event Control Date" (ECD)
      *
     C                     MOVE BKAPDT    ZZAPDT
     C                     MOVE BJDNWD    ZZDNWD
     C                     EXSR ZEVCD
      *
      ***  On accrual date followed by a non working day -
      ***    SE7561 is run twice:
      ***        - 1St Time processes events up to APDA
      ***          (ACRLRN set according to RUN,IE 3)
      ***        - 2Nd Time processes events up to DNWD
      ***          (ACRLRN set to 4)
      ***  Otherwise -
      ***    SE7561 is run once processes events up to DNWD
      ***              (ACRLRN set according to RUN,IE 1 OR 2)
     C           ACRLRN    IFNE '3'
     C                     Z-ADDDNWD      WWECD
     C                     ELSE
     C                     Z-ADDAPDA      WWECD
     C                     ENDIF
      *
     C                     MOVE 'N'       WWDATA  1        Data Read Indicator
      *
     C                     ENDSR
      *
     ******************************************************************
      /EJECT                                                                                  CSE028
      *****************************************************************                       CSE028
      *                                                               *                       CSE028
      * SRSSIR - Sub-routine to call SESSIR0.                         *                       CSE028
      *                                                               *                       CSE028
      * Called by: DEFLTS                                             *                       CSE028
      *                                                               *                       CSE028
      * Calls:                                                        *                       CSE028
      *                                                               *                       CSE028
      *****************************************************************                       CSE028
     C           SRSSIR    BEGSR                                                              CSE028
      *                                                                                       CSE028
     C                     MOVE 'N'       NOTFND                                              CSE028
     C                     MOVE WKPCPY    WCUST2  6                                           CSE028
     C                     CALL 'SESSIR0'                                                     CSE028
     C                     PARM 'D'       POTYP   1                                           CSE028
     C                     PARM           WKPBCA                                              CSE028
     C                     PARM           WCUST2                                              CSE028
     C                     PARM           WKPBCD                                              CSE028
     C                     PARM           WKNMCY                                              CSE028
     C                     PARM           WKSMCC  2                                           CSE034
     C                     PARM           WKSITP                                              CSE028
     C                     PARM           WKPTFR                                              CSE028
     C                     PARM           PCBSTD                                              CSE028
     C                     PARM           PCBSAD                                              CSE028
     C                     PARM *BLANKS   PRETCD  5                                           CSE028
      *                                                                                       CSE028
     C           PRETCD    IFNE '*NCRF'                                                       CSE028
     C           PRETCD    ANDNE'*NRF '                                                       CSE028
     C           2         OCUR PCBSTD                                                        CSE028
     C                     ELSE                                                               CSE028
     C           PRETCD    IFNE '*NBRF'                                                       CSE028
     C           PRETCD    ANDNE'*NRF '                                                       CSE028
     C           1         OCUR PCBSTD                                                        CSE028
     C                     ELSE                                                               CSE028
     C                     MOVE 'Y'       NOTFND  1                                           CSE028
     C                     ENDIF                                                              CSE028
     C                     ENDIF                                                              CSE028
      *                                                                                       CSE028
     C                     ENDSR                                                              CSE028
      *****************************************************************                       CSE028
      /EJECT                                                                                  CGL020
      *****************************************************************                       CGL020
      *                                                               *                       CGL020
      * SRAMPR - Determine AML Pay/Receive Instructions               *                       CGL020
      *                                                               *                       CGL020
      * Called by: #WACKB, #WACKC, #WACKD                             *                       CGL020
      *                                                               *                       CGL020
      * Calls: ZAAMLSETSE                                             *                       CGL020
      *                                                               *                       CGL020
      *****************************************************************                       CGL020
      *                                                                                       CGL020
     C           SRAMPR    BEGSR                           ** SRAMPR **                       CGL020
      *                                                                                       CGL020
     C           STLA      IFEQ *BLANKS                                                       CGL020
     C                     MOVE *BLANKS   F1RACT                                              CGL020
     C                     MOVE *BLANKS   F1RCTY                                              CGL020
     C                     MOVE *BLANKS   F1RBNK                                              CGL020
     C                     MOVE *BLANKS   F1RCDE                                              CGL020
     C                     MOVE *BLANKS   F1PACT                                              CGL020
     C                     MOVE *BLANKS   F1PCTY                                              CGL020
     C                     MOVE *BLANKS   F1PBNK                                              CGL020
     C                     MOVE *BLANKS   F1PCDE                                              CGL020
     C                     MOVE *BLANKS   F1DACT                                              CGL020
     C                     MOVE *BLANKS   F1DCTY                                              CGL020
     C                     MOVE *BLANKS   F1DBNK                                              CGL020
     C                     Z-ADD*ZEROS    F1SDAT                                              CGL020
      *                                                                                       CGL020
     C                     ELSE                                                               CGL020
     C                     MOVE *BLANKS   PINTG                                               CGL020
     C                     MOVE *BLANKS   PINTGA                                              CGL020
     C                     MOVE *BLANKS   PINST                                               CGL020
     C                     MOVE *BLANKS   PINSTA                                              CGL020
     C                     MOVE *BLANKS   PBENM                                               CGL020
     C                     MOVE *BLANKS   PBENMA                                              CGL020
     C**********           Z-ADDCSTN      PCUSTN                                       CGL020 CSD027
     C                     MOVE CSTN      PCUSTN                                              CSD027
      *                                                                                       CGL020
     C                     CALL ZAAMLP                                                        CGL020
     C                     PARM           PINTG  10                                           CGL020
     C                     PARM           PINTGA 35                                           CGL020
     C                     PARM           PINST  10                                           CGL020
     C                     PARM           PINSTA 35                                           CGL020
     C                     PARM           PBENM  10                                           CGL020
     C                     PARM           PBENMA 35                                           CGL020
     C                     PARM           PDEBT  10                                           CSW210
     C                     PARM           PDEBTA 35                                           CSW210
     C                     PARM           PCUSTN                                              CGL020
     C                     PARM *BLANKS   PBLANK  8                                           CGL020
     C                     PARM           STLA                                                CGL020
     C                     PARM           SEBR                                                CGL020
     C                     PARM           EVCY                                                CGL020
     C                     PARM           F1RACT                                              CGL020
     C                     PARM           F1RCTY                                              CGL020
     C                     PARM           F1RBNK                                              CGL020
     C                     PARM           F1RCDE                                              CGL020
     C                     PARM           F1PACT                                              CGL020
     C                     PARM           F1PCTY                                              CGL020
     C                     PARM           F1PBNK                                              CGL020
     C                     PARM           F1PCDE                                              CGL020
     C                     PARM           F1DACT                                              CGL020
     C                     PARM           F1DCTY                                              CGL020
     C                     PARM           F1DBNK                                              CGL020
      *                                                                                       CGL020
     C                     Z-ADDEVDT      F1SDAT                                              CGL020
     C                     ENDIF                                                              CGL020
      *                                                                                       CGL020
     C                     MOVE *BLANKS   F1TICK                                              CGL020
     C                     MOVE *BLANKS   F1EXCH                                              CGL020
     C                     MOVE *ZEROS    F1NOML                                              CGL020
      *                                                                                       CGL020
     C                     ENDSR                                                              CGL020
      *                                                                                       CGL020
      ********************************************************************                    CGL020
      /EJECT
      *****************************************************************                     AR853119
      *                                                               *                     AR853119
      * SRPOST - Create Position Settlement extension                 *                     AR853119
      *                                                               *                     AR853119
      *****************************************************************                     AR853119
     C           SRPOST    BEGSR                                                            AR853119
      *                                                                                     AR853119
     C                     MOVE *BLANK    WSTAX   1                                         AR853119
     C                     MOVE *BLANK    WCTAX   1                                         AR853119
     C                     MOVE *ZERO     WTAXA                                             AR875302
     C                     Z-ADD0         P3STAF                                           AR864714B
     C                     MOVE 'N'       P3TAX                                             AR853119
     C                     MOVELBJRDNB    P3CDTE                                            AR853119
     C                     MOVELPBCA      P3PBCA                                            AR853119
     C                     MOVELPSSH      P3PSSH                                            AR853119
     C                     MOVELPCPY      P3PCPY                                            AR853119
     C                     MOVELPDUD      P3PDUD                                            AR853119
     C                     MOVELPEVT      P3PEVT                                            AR853119
      *                                                                                     AR853119
     C                     CALL 'AOBRCHR2'                                                  AR853119
     C                     PARM *BLANKS   @RTCD                                             AR853119
     C                     PARM '*KEY   ' @OPTN                                             AR853119
     C                     PARM PBCA      @DSNB   3                                         AR853119
     C           SDBRCE    PARM SDBRCE    DSSDY                                             AR853119
     C           @RTCD     IFEQ *BLANKS                                                     AR853119
     C                     MOVE BXTAX     WSTAX                                             AR853119
     C                     ENDIF                                                            AR853119
      *                                                                                     AR853119
     C           PCPY      CHAINSDCUSQL0             99                                     AR853119
     C           *IN99     IFEQ '0'                                                         AR853119
     C                     MOVE CQTAX     WCTAX                                             AR853119
     C                     ENDIF                                                            AR853119
      *                                                                                     AR853119
      ** Calculate Stamp tax                                                                AR853119
      *                                                                                     AR853119
     C           WSTAX     IFEQ 'Y'                                                         AR853119
     C           WCTAX     ANDEQ'Y'                                                         AR853119
     C                     CALL 'SD008141'                                                  AR853119
     C                     PARM BJRDNB    U#DATE  50                                        AR853119
     C                     PARM 'POSSET  'U#ORGN 10                                         AR853119
     C                     PARM           ##TYPE  4                                         AR853119
     C                     PARM           U#CTAX 138                                        AR853119
     C                     PARM           U#MTAX 138                                        AR853119
     C                     PARM           U#CCCY  3                                         AR853119
     C                     PARM           U#MCCY  3                                         AR853119
     C                     PARM           U#CSCC  2                                         AR853119
     C                     PARM           U#MSCC  2                                         AR853119
     C                     PARM           U#TXTY  1                                         AR853119
     C                     PARM           SDSTPD                                            AR853119
      *                                                                                     AR853119
      ** If there is a default for the Module use this tax rate and ccy                     AR853119
      ** otherwise use the ICD Control defaults.                                            AR853119
      *                                                                                     AR853119
     C           U#MTAX    IFNE *ZEROS                                                      AR853119
     C                     Z-ADDU#MTAX    U#TAXR 138                                        AR853119
     C                     MOVE U#MCCY    U#SCCY  3                                         AR853119
     C                     ELSE                                                             AR853119
     C                     MOVE U#CCCY    U#SCCY                                            AR853119
     C                     Z-ADDU#CTAX    U#TAXR                                            AR853119
     C                     ENDIF                                                            AR853119
      *                                                                                     AR853119
     C                     MOVELPCHA      WTAXA  130                                        AR853119
     C                     ADD  PCAM      WTAXA                                             AR853119
     C                     MULT U#TAXR    WTAXA     H                                       AR853119
     C                     Z-ADDWTAXA     P3STAF                                            AR853119
     C                     MOVE 'Y'       P3TAX                                             AR853119
     C                     EXSR SRSTMD                                                      AR853119
     C                     ENDIF                                                            AR853119
      *                                                                                     AR853119
     C                     ENDSR                                                            AR853119
      *****************************************************************                     AR853119
      /EJECT                                                                                AR853119
      *****************************************************************                     AR853119
      * Subroutine  :  SRSTMD                                         *                     AR853119
      * Function    :  This subroutine will write/update records in   *                     AR853119
      *                Stamp Tax Historic/Details (SDSTMDPD)          *                     AR853119
      *****************************************************************                     AR853119
      *                                                                                     AR853119
     C           SRSTMD    BEGSR                                                            AR853119
      *                                                                                     AR853119
     C                     MOVE PBCA      T2PBRC                                            AR853119
     C                     MOVE PSSH      T2PSSH                                            AR853119
     C                     MOVE PCPY      T2PCPY                                            AR853119
     C                     MOVE PDUD      T2PDUD                                            AR853119
     C                     MOVE PEVT      T2PEVT                                            AR853119
     C                     MOVEL'POSSET'  T2KEY                                             AR853119
     C                     MOVE 'T'       T2RCTP                                            AR853119
     C                     MOVE U#SCCY    T2SCCY                                            AR853119
     C                     MOVE PSCU      T2ECCY                                            AR853119
     C                     MOVE 'Y'       T2TCAL                                            AR853119
     C                     MOVE U#TAXR    T2TXRT                                            AR853119
     C                     Z-ADDWTAXA     T2TATC                                            AR853119
     C                     MOVE 'Y'       T2STFF                                            AR853119
     C                     Z-ADDBJRDNB    T2LCD                                             AR853119
     C                     MOVE 'I'       T2TYLC                                            AR853119
     C           PCHA      ADD  PCAM      T2GROS                                           AR864714B
      *                                                                                     AR853119
     C                     ENDSR                                                            AR853119
      *****************************************************************                     AR853119
      /EJECT                                                                                AR324886
      *****************************************************************                     AR324886
     C           PSAUDT    BEGSR                                                            AR324886
      *                                                                                     AR324886
     C                     MOVE RECI      PARECI                                            AR324886
     C                     MOVE PBCA      PAPBCA                                            AR324886
     C                     MOVE PSSH      PAPSSH                                            AR324886
     C                     MOVE PCPY      PAPCPY                                            AR324886
     C                     MOVE PDUD      PAPDUD                                            AR324886
     C                     MOVE PEVT      PAPEVT                                            AR324886
     C                     MOVE PTFR      PAPTFR                                            AR324886
     C                     MOVE TNLU      PATNLU                                            AR324886
     C                     MOVE TXBS      PATXBS                                            AR324886
     C                     MOVE BNFO      PABNFO                                            AR324886
     C                     MOVE EXCD      PAEXCD                                            AR324886
     C           LIBR      CAT  'OWNER'   PALUSR                                            AR324886
     C                     MOVE LCD       PALCD                                             AR324886
     C                     MOVE CHTP      PALCTP                                            AR324886
     C                     WRITEPSAUTDF                                                     AR324886
      *                                                                                     AR324886
     C                     ENDSR                                                            AR324886
      *****************************************************************                     AR324886
      /EJECT                                                                                AR853119
      *****************************************************************
      *  *PSSR  - Dump routine in case of error                       *
      *  ------                                                       *
      *****************************************************************
      *
     C           *PSSR     BEGSR
      *
     C           WWRUN     IFNE 'Y'
     C                     DUMP
     C                     MOVE 'Y'       WWRUN   1
     C                     ENDIF
      *
     C           DBASE     IFGT 1
     C                     WRITEHEADAU
     C                     WRITEDBERROR
     C                     ENDIF
      *
     C                     MOVE *ON       *INU7
     C                     MOVE *ON       *INU8
     C                     MOVE *ON       *INLR
     C                     RETRN
      *
     C                     ENDSR
      *****************************************************************
      /EJECT
      *****************************************************************
     C/COPY ZSRSRC,ZSETAC
     C/COPY ZSRSRC,ZCONVZ1
     C/COPY ZSRSRC,ZCCAL1Z2
     C/COPY ZSRSRC,ZCCAL2Z1
     C/COPY ZSRSRC,ZHASHZ3
     C/COPY ZSRSRC,ZTNLU1Z2
     C/COPY ZSRSRC,ZEVCDZ1
     C/COPY ZSRSRC,ZXRATEZ1
     C/COPY ZSRSRC,ZICD2Z1
     C/COPY ZSRSRC,ZCCYCN
     C/COPY ZSRSRC,ZDATE2Z2                                                                   CGL031
     C/COPY ZSRSRC,ZDATE9Z3                                                                   CGL031
     C/COPY ZSRSRC,ZCCYXR                                                                     CGL031
**  POWER8 - ARRAY OF POWERS FOR CURRENCY CONVERSION
00000001
00000010
00000100
00001000
00010000
00100000
01000000
10000000
**  POWER - ARRAY OF POWERS FOR CURRENCY CONVERSION
0000001
0000010
0000100
0001000
0010000
0100000
1000000
**   ZYDY - YEARS IN DAYS CUMULATIVE, FOUR YEAR SPAN                                          CGL031
0366073110961461
**   ZMDY - MONTHS IN DAYS CUMULATIVE THROUGH YEAR                                            CGL031
000031059090120151181212243273304334365
**   ZMNM - MONTHS SHORT NAMES                                                                CGL031
JANFEBMARAPRMAYJUNJULAUGSEPOCTNOVDEC
** @YD  USED BY SR. ZDATE9 - YEARS, IN DAYS, CUMULATIVE IN 4 YEAR SPAN                        CGL031
00366007310109601461
** @MD  USED BY SR. ZDATE9 - MONTHS IN DAYS CUMULATIVE THROUGH YEAR                           CGL031
00000000310005900090001200015100181002120024300273003040033400365
**  CPY@
(c) Finastra International Limited 2001
