000100200616     H        1
000200200616      *****************************************************************
000300200616/*STD *  RPGBASE                                                      *
000400200616/*EXI *  TEXT('Midas SE CO Produce positions settl. and acc. keys')   *
000500200616      *****************************************************************
000600200616      *                                                               *
000700200616      *  Midas - Securities Trading Module                            *
000800200616      *                                                               *
000900200616      *  RPG/SE7561 - SE CO Generate Positions Settlement             *
001000200616      *               and Account Keys                                *
001100200616      *                                                               *
001200200616      *  Function:  This Program Generate Positions Settlements       *
001300200616      *  (COB)      and Account Keys                                  *
001400200616      *                                                               *
001500200616      *  Called by: SEC7561 - Generate Positions Settlements          *
001600200616      *                       and Account Keys                        *
001700200616      *                                                               *
001800200616      *  (c) Finastra International Limited 2001                      *
001900200616      *                                                               *
001901200616      *  LAST Amend No. AR324886           Date 01JUN20               *
002000200616      *  PREV Amend No. CER050             Date 16Jun19               *
002100200616      *                 MD046248           Date 27Oct17               *
002200200616      *                 215959             Date 21Mar16               *
002300200616      *                 CER071             Date 01Aug16               *
002400200616      *                 CGL165             Date 17Feb15               *
002500200616      *                 CER070             Date 19Aug14               *
002600200616      *                 CLE134             Date 01Aug12               *
002700200616      *                 CLE148             Date 23Jul12               *
002800200616      *                 AR888911           Date 26Jan12               *
002900200616      *                 AR864714B          Date 28Mar12               *
003000200616      *                 AR875302           Date 09Jan12               *
003100200616      *                 AR879983           Date 21Dec11               *
003200200616      *                 AR853119           Date 24Nov11               *
003300200616      *                 CSW210             Date 04May10               *
003400200616      *                 CER059             Date 19Jul10               *
003500200616      *                 BUG26839           Date 05Jan10               *
003600200616      *                 CER045             Date 20Jul09               *
003700200616      *                 CER054             Date 07Apr09               *
003800200616      *                 BUG23123           Date 09Mar09               *
003900200616      *                 BUG22911           Date 17Feb09               *
004000200616      *                 CER048             Date 19May08               *
004100200616      *                 CER020             Date 19May08               *
004200200616      * Bank Fusion Midas 1.4 Base -----------------------------------*
004300200616      * Midas Plus 1.4 Base 04 ---------------------------------------*
004400200616      * Midas Plus 1.4 Base ------------------------------------------*
004500200616      *                 219566             Date 09Feb07               *
004600200616      * Midas Plus 1.3 ----------- Base ------------------------------*
004700200616      *                 219688             Date 11Oct06               *
004800200616      *                 CSD031             Date 10Apr06               *
004900200616      *                 CSD027A            Date 05May06               *
005000200616      *                 CSD027             Date 09Dec05               *
005100200616      *                 232543             Date 01Apr05               *
005200200616      *                 CGL035             Date 01Mar05               *
005300200616      *                 CGL031             Date 05Jul04               *
005400200616      *                 CSE071             Date 19Jul05               *
005500200616      *                 215575             Date 13Mar03               *
005600200616      *                 BUG3122            Date 17Jul04               *
005700200616      *                 CLE025             Date 20Oct03               *
005800200616      *                 CGL029             Date 01Sep03               *
005900200616      *                 CGL020             Date 12Dec02               *
006000200616      * Midas Release 4.01.02 ----------------------------------------*
006100200616      *                 173581             Date 30Apr02               *
006200200616      *                 200789             Date 11Apr02               *
006300200616      * Midas Release 4.01 -------------------------------------------*
006400200616      *                 CSE034             Date 24Apr02               *
006500200616      * Midas Release 4 --------------- Base -------------------------*
006600200616      *                 CSE028             Date 06Jun01               *
006700200616      *                 190204             Date 31May01               *
006800200616      * Midas DBA 3.04 -----------------------------------------------*
006900200616      *                 CSE023             Date 31Aug00               *
007000200616      * Midas DBA 3.03 -----------------------------------------------*
007100200616      *                 CSE020             Date 21Mar00               *
007200200616      * Midas DBA 3.02 -----------------------------------------------*
007300200616      *                 CPB001             Date 08Sep99               *
007400200616      * Midas DBA 3.01 -----------------------------------------------*
007500200616      *                 163497             Date 03Aug99               *
007600200616      *                 161746             Date 12Jul99               *
007700200616      * Midas DBA 3.00 ---------------- Base -------------------------*
007800200616      *                 153674             Date 20Jan99               *
007900200616      *                 153091             Date 11Jan99               *
008000200616      *                 151157             Date 29Dec98               *
008100200616      *                 151658             Date 28Dec98               *
008200200616      *                 150165             Date 15Dec98               *
008300200616      *                 136428             Date 15Jun98               *
008400200616      *                 135691             Date 04Feb98               *
008500200616      *                 CEU017             Date 05Mar98               *
008600200616      *                 CSE007   *CREATE   Date 19Jan98               *
008700200616      *                                                               *
008800200616      *---------------------------------------------------------------*
008900200616      *                                                               *
008901200616      *  AR324886 - Implement 4-eyes processing in Position           *
008902200616      *             Settlement Maintenance.                           *
009000200616      *  CER050 - Annualised Percentage Rate (Recompile)              *
009100200616      *  MD046248 - Finastra Rebranding                               *
009200200616      *  215959 - Truncation error on event amount in SE2450P3.       *
009300200616      *           Recompiled due to changes in PF/SEKEYD.             *
009400200616      *         - Applied for MD-37439.                               *
009500200616      *  CER071 - BAIS - Legal Form field (Recompile)                 *
009600200616      *  CGL165 - Dual Withholding Tax (Recompile)                    *
009700200616      *  CER070 - BuBa Reporting / BAIS V.1.16.0 (Recompile)          *
009800200616      *  CLE134 - Past Due Call Loan Processing (Recompile)           *
009900200616      *  CLE148 - Alpha Loan Reference (Recompile)                    *
010000200616      *  AR888911 - In reversing a deal, REV column in Stamp Tax      *
010100200616      *             Movements Enquiry is not changing from N to Y     *
010200200616      *             (Recompile)                                       *
010300200616      *           - Applied for AR944923                              *
010400200616      *  AR864714B - No movement is posted in Stamp Tax Movement      *
010500200616      *              enquiry for Position Settlements                 *
010600200616      *            - Applied for AR942839                             *
010700200616      *  AR875302 - Position settlement generated calculates Stamp    *
010800200616      *             Tax even when it is not stamp tax liable          *
010900200616      *  AR879983 - Add stamp tax exchange rate (Recompile)           *
011000200616      *  AR853119 - Position settlements generated from corporate     *
011100200616      *             action did not calculate stamp tax.               *
011200200616      *  CSW210 - SWIFT 2010 Changes                                  *
011300200616      *  CER059 - German Feature Upgrade to Delhi                     *
011400200616      *  BUG26839 - JA1_Threshold limit of the main joint customer was*
011500200616      *             utilized by the member                            *
011600200616      *  CER045 - German Features - Reporting Bundesbank (Recompile)  *
011700200616      *  CER054 - German Features - Church Tax (Recompile)            *
011800200616      *  BUG23123 - Report: Does not show Retail Account Number       *
011900200616      *                     Date is not Midas Standard Date           *
012000200616      *                     Period should be actual int. calc. period *
012100200616      *                     Secondary Tax amount is not printed       *
012200200616      *                     Added field TSSLID                        *
012300200616      *                     (Recompile)                               *
012400200616      *  BUG22911 - Changes for Correct Tax Calculation               *
012500200616      *  CER048 - German Features - Taxes                             *
012600200616      *  CER020 - Enhanced Rollover Window: Upgrade FGE089 to         *
012700200616      *           Midas Plus (Recompile)                              *
012800200616      *  219566 - Default the settlement account if no account for    *
012900200616      *           the specified portfolio. This is a LUX local fix    *
013000200616      *           so conditioned in core using new system value       *
013100200616      *           "UseDefaultSettAccnt" in SDSVALPD.                  *
013200200616      *  219688 - Settlement account not correctly retrieved          *
013300200616      *           If the customer is a portfolio one, access first    *
013400200616      *           with the account code defined as settlement in      *
013500200616      *           SDSECSPD. If not found use the PMACCNL0 account.    *
013600200616      *  CSD031 - Enhanced Centralised Static Data (Recompile)        *
013700200616      *  CSD027A - Conversion Of Customer Number to Alpha             *
013800200616      *  CSD027 - Conversion Of Customer Number to Alpha              *
013900200616      *  232543 - Fix to CGL031 (Recompile)                           *
014000200616      *  CGL035 - EUSD Upgrade to Midasplus                           *
014100200616      *  CGL031 - Taxation of Savings Income                          *
014200200616      *  CSE071 - Multiple Holidays Re Securities (recompile)         *
014300200616      *  215575 - Load Corporate Reference as parameter.              *
014400200616      *  BUG3122 - Recompiled due to changes in SDSECSPD.             *
014500200616      *  CLE025 - Credit Lines (Recompile)                            *
014600200616      *  CGL029 - Increase Account Code to 10 digits                  *
014700200616      *  CGL020 - Midas Compliance Watch - Anti-Money Laundering      *
014800200616      *  173581 - Complete 153091 : Even if trades, depots movements  *
014900200616      *           and pos settl are already generated, enter in       *
015000200616      *           S/R #PDPRD to manage status correctly               *
015100200616      *  200789 - The commission code on CA position settlement is    *
015200200616      *           generated but no commission amount calculated.      *
015300200616      *           Amended the program to calculate the charge and     *
015400200616      *           commission amounts independently.                   *
015500200616      *  CSE034 - Standard Settlement Instruction improvements        *
015600200616      *  CSE028 - Standing Settlement Instructions Enhancement.       *
015700200616      *  190204 - Recompiled due to changes in PF/SECODVPD.           *
015800200616      *  CSE023 - Treaty Withholding Tax                              *
015900200616      *  CSE020 - Corporate Actions Domino Effect Processing          *
016000200616      *           (Recompiled due to changes in PF/SECORFPD)          *
016100200616      *  CPB001 - 'Private Banking' Module                            *
016200200616      *  163497 - For customer account keys, use customer reference   *
016300200616      *           and not issuer to access securities trading customer*
016400200616      *           details. As issuer is not necessary a SE customer,  *
016500200616      *           in this case no classification is set in the key and*
016600200616      *           result in a missing account key                     *
016700200616      *  161746 - Average Price Option 'I' has been added in SE7505.  *
016800200616      *           (SECORGPD/MFAVOP)                                   *
016900200616      *           Manage it as option 'C' in this program and in      *
017000200616      *           SE7560 SE7561 SE7590 SE7591 SE7505                  *
017100200616      *           ( SEINS-BBN20520 & GBSEUSRMSG/CO00175 changed too ) *
017200200616      *  153674 - Complete Fix 151658 for other Corporate Action Type *
017300200616      *           than 'CC' (EMU - Currency Change).                  *
017400200616      *           Incorrect Pay/Receive Indicator on Position Settl.  *
017500200616      *           for Customers                                       *
017600200616      *  153091 - Review setup of Status 'C'omplete                   *
017700200616      *  151157 - Position 6 for Depot Account Keys must be 'X'       *
017800200616      *  151658 - Incorrect Pay/Receive Indicator on Position Settl.  *
017900200616      *           for Customers                                       *
018000200616      *  150165 - No Position Settlements generated for Securities    *
018100200616      *           which have Cash Compensation                        *
018200200616      *  136428 - Recompile due to addition of Days Basis and Divisor *
018300200616      *           Basis field in SECORBPD.                            *
018400200616      *  135691 - EMU SE Settlement Ccy Conversion                    *
018500200616      *  CEU017 - Securities Redenomination Euro Changes              *
018600200616      *  CSE007 - Corporate Actions                                   *
018700200616      *                                                               *
018800200616      *****************************************************************
018900200616     FSECORFL2UF  E           K        DISK         KINFSR *PSSR
019000200616      ***  CO Reference                             Prefix - MA
019100200616      *
019200200616     FSECODRL0UF  E           K        DISK         KINFSR *PSSR
019300200616      ***  CO Depots Upd Idx                        Prefix - MS
019400200616      *
019500200616     FSECODPL2UF  E           K        DISK         KINFSR *PSSR
019600200616      ***  CO Depots                                Prefix - MB
019700200616      *
019800200616     FSECOALL4UF  E           K        DISK         KINFSR *PSSR
019900200616      ***  CO Allocations                           Prefix - MC
020000200616      *
020100200616     FSECTY   IF  E           K        DISK         KINFSR *PSSR
020200200616      ***  Security Details
020300200616      *
020400200616     FSECGT   IF  E           K        DISK         KINFSR *PSSR
020500200616      ***  Charge Type - Ccy,Ccom
020600200616      *
020700200616     FSEPCCD  IF  E           K        DISK         KINFSR *PSSR
020800200616      ***  Customer Position Profit Centre File
020900200616      *
021000200616     FSESWHTL0IF  E           K        DISK         KINFSR *PSSR
021100200616      ***  Securities WHT details file
021200200616      *
021300200616     FPMPORTPDIF  E           K        DISK         KINFSR *PSSR
021400200616      ***  Portfolio Details
021500200616      *
021600200616     FCLINT   IF  E           K        DISK         KINFSR *PSSR
021700200616     F            CLINTCAF                          KIGNORE
021800200616     F            CLINTCCF                          KIGNORE
021900200616     F            CLINTC1F                          KIGNORE
022000200616      *
022100200616     FSTDSED  IF  E           K        DISK         KINFSR *PSSR
022200200616      ***  Standard Settlement Instructions
022300200616      *
022400200616     FACNUM   IF  E           K        DISK         KINFSR *PSSR
022500200616      ***  Account Numbers file
022600200616     F            ACCNTABF                          KRENAMEACCNTB2F
022700200616      *
022800200616     FACCNT   IF  E           K        DISK         KINFSR *PSSR
022900200616      ***  GL Accounts Master
023000200616     F            ACCNTAAF                          KIGNORE
023100200616     F            ACCNTABF                          KRENAMEACCNTB1F
023200200616     F            ACCNTACF                          KIGNORE
023300200616      *
023400200616     FPMACCNL0IF  E           K        DISK
023500200616     F            ACCNTABF                          KRENAMEACCNTB3F
023600200616     FPMACCNL1IF  E           K        DISK                               219688
023700200616     F            ACCNTABF                          KRENAMEACCNTL1F       219688
023800200616     F*                                                                   219688
023900200616      *
024000200616     FTABSE   IF  E           K        DISK         KINFSR *PSSR
024100200616     F            TABLETAF                          KIGNORE
024200200616     F            TABTB10F                          KIGNORE
024300200616     F            TABTB36F                          KIGNORE
024400200616     F            TABTB40F                          KIGNORE
024500200616     F            TABTE10F                          KIGNORE
024600200616     F            TABTE20F                          KIGNORE
024700200616     F            TABTG10F                          KIGNORE
024800200616     F            TABTG20F                          KIGNORE
024900200616     F            TABLETHF                          KIGNORE
025000200616     F            TABLETKF                          KIGNORE
025100200616     F            TABLETLF                          KIGNORE
025200200616     F            TABLETNF                          KIGNORE
025300200616     F            TABLETPF                          KIGNORE
025400200616     F            TABLETRF                          KIGNORE
025500200616     F            TABLETXF                          KIGNORE
025600200616     F            TABLET2F                          KIGNORE
025700200616     F            TABLET3F                          KIGNORE
025800200616     F            TABLET5F                          KIGNORE
025900200616      *
026000200616     FSECODVL0IF  E           K        DISK         KINFSR *PSSR
026100200616      ***  CO Dividends                             Prefix - MD
026200200616      *
026300200616     FSECORGL0IF  E           K        DISK         KINFSR *PSSR
026400200616      ***  CO Rights                                Prefix - MF
026500200616      *
026600200616     FSECOOFL0IF  E           K        DISK         KINFSR *PSSR
026700200616      ***  CO Exchange Offers                       Prefix - MI
026800200616      *
026900200616     FSECOCHL0IF  E           K        DISK         KINFSR *PSSR
027000200616      ***  CO Default Charges                       Prefix - MR
027100200616      *
027200200616     FSECOCHL1IF  E           K        DISK         KINFSR *PSSR
027300200616     F            SECOCHD0                          KRENAMESECOCHD1
027400200616      ***  CO Default Charges                       Prefix - MR
027500200616      *
027600200616     FINVTP   IF  E           K        DISK         KINFSR *PSSR
027700200616      ***  Investment type details
027800200616      *
027900200616     FSECOSIL1IF  E           K        DISK
028000200616     F                                              KINFSR *PSSR
028100200616      ***  Midas SE Corporate Actions Instructions by Customer.          - Prefixe MO
028200200616      *
028300200616     FSECOSIL2IF  E           K        DISK
028400200616     F            SECOSID0                          KRENAMESECOSID2
028500200616     F                                              KINFSR *PSSR
028600200616      ***  Midas SE Corporate Actions Instructions by Book.              - Prefixe MO
028700200616      *
028800200616     FSECOATL0IF  E           K        DISK         KINFSR *PSSR
028900200616      ***  Corporate Action Type                    Prefix - MM
029000200616      *
029100200616     FSECOCCL0IF  E           K        DISK         KINFSR *PSSR          CEU017
029200200616      ***  CO Currency Change                       Prefix - NA           CEU017
029300200616      *                                                                   CEU017
029400200616     FSECOCCL1IF  E           K        DISK         KINFSR *PSSR          CEU017
029500200616     F            SECOCCD0                          KRENAMESECOCCD1       CEU017
029600200616      ***  CO Currency Change                       Prefix - NA           CEU017
029700200616      *                                                                   CEU017
029800200616     FSECORBL0UF  E           K        DISK         KINFSR *PSSR          CEU017
029900200616      ***  CO Currency Change                       Prefix - NA           CEU017
030000200616      *                                                                   CEU017
030100200616     FSECORFL0IF  E           K        DISK         KINFSR *PSSR          CEU017
030200200616     F            SECORFD0                          KRENAMESECORFD1       CEU017
030300200616      ***  CO Reference                             Prefix - MA           CEU017
030400200616      *                                                                   CEU017
030500200616     FSDTXCML1IF  E           K        DISK         KINFSR *PSSR                              CGL031
030600200616      ***  SD Tax Calculation Methods                                                         CGL031
030700200616      *                                                                                       CGL031
030800200616     FSDACUSL1IF  E           K        DISK         KINFSR *PSSR                              CGL031
030900200616      ***  SD Extended Customer's Details                                                     CGL031
031000200616      *                                                                                       CGL031
031100200616     FSDNAHOL1IF  E           K        DISK         KINFSR *PSSR                              CGL031
031200200616      ***  SD Non-A/C Holder Details                                                          CGL031
031300200616      *                                                                                       CGL031
031400200616     FSDCSINL9O   E           K        DISK         KINFSR *PSSR A                            CGL031
031500200616      ***  SD Customer Income                                                                 CGL031
031600200616      *                                                                                       CGL031
031700200616     FSDJACCL1IF  E           K        DISK         KINFSR *PSSR                              CGL031
031800200616      ***  SD Joint Account Member Details                                                    CGL031
031900200616      *                                                                                       CGL031
032000200616     FSDJACCL3IF  E           K        DISK         KINFSR *PSSR                              CGL031
032100200616     F            SDJACCD0                          KRENAMESDJACCD3                           CGL031
032200200616      ***  SD Joint Account Member Details                                                    CGL031
032300200616      *                                                                                       CGL031
032400200616     FSDTXBSL1IF  E           K        DISK         KINFSR *PSSR                              CGL031
032500200616      ***  SD Tax Basket Details                                                              CGL031
032600200616      *                                                                                       CGL031
032700200616     FTRADS   IF  E           K        DISK         KINFSR *PSSR                              CGL031
032800200616      ***  SE Trades                                                                          CGL031
032900200616      *                                                                                       CGL031
033000200616     FPOSETD  O   E           K        DISK         KINFSR *PSSR
033100200616      ***  Position Settlements - Detail
033200200616      *
033201200616     FPSAUTD  O   E           K        DISK                                                 AR324886
033202200616      ** SE Position Settlement Authorisation detail                                        AR324886
033203200616      *                                                                                     AR324886
033300200616     FPOSETDY1IF  E           K        DISK         KINFSR *PSSR A
033400200616      ***  Position Settlements - Extension File
033500200616      *
033600200616     FPOSETDY2IF  E           K        DISK         KINFSR *PSSR A
033700200616      ***  Position Settlements - Extension File
033800200616      *
033900200616     FSDCUSQL0IF  E           K        DISK                                                 AR853119
034000200616      **  Midas SD Stamp Tax Customer Extension file                                        AR853119
034100200616     FPOSETDX3O   E           K        DISK         KINFSR *PSSR                            AR853119
034200200616      ***  Position Settlements - Extension File                                            AR853119
034300200616     FSDSTMDPDO   E           K        DISK         KINFSR *PSSR                            AR853119
034400200616      **  Midas SD Stamp Tax History Detail file                                            AR853119
034500200616      *                                                                                     AR853119
034600200616     FPOSETA  O   E                    DISK         KINFSR *PSSR
034700200616      ***  Position Settlements - Audit
034800200616      *
034900200616     FSEKEYD  O   E           K        DISK         KINFSR *PSSR
035000200616      ***  Generated Account Keys - Detail
035100200616      *
035200200616     FSEKEYA  O   E                    DISK         KINFSR *PSSR
035300200616      ***  Generated Account Keys - Audit
035400200616     F/COPY WNCPYSRC,SE7561F001
035500200616      *
035600200616     FSE7561AUO   E                    PRINTER      KINFSR *PSSR
035700200616      ***  Program run control report
035800200616     F                                              KINFDS SPOOLU
035900200616      *
036000200616      **********************************************************************
036100200616      /EJECT
036200200616      **********************************************************************
036300200616      *
036400200616     E/COPY ZSRSRC,ZHASHZ1
036500200616     E/COPY ZSRSRC,ZCCAL1Z1
036600200616     E/COPY ZSRSRC,ZPOWER8Z1
036700200616     E/COPY ZSRSRC,ZPOWERZ1
036800200616     E/COPY ZSRSRC,ZDATE2Z1                                                                   CGL031
036900200616     E/COPY ZSRSRC,ZDATE9Z1                                                                   CGL031
037000200616      *
037100200616     E                    CPY@    1   1 80
037200200616      ***  Copyrigth Array
037300200616      *
037400200616      **********************************************************************
037500200616      /EJECT
037600200616      **********************************************************************
037700200616      *
037800200616     IACCNTB1F
037900200616     I              CNUM                            ZRCNUM
038000200616     I              CCY                             ZRCCY
038100200616     I              ACOD                            ZRACOD
038200200616     I              ACSQ                            ZRACSQ
038300200616     I              BRCA                            ZRBRCA
038400200616     I              PTFR                            ZRPTFR
038500200616      *
038600200616     IACCNTB2F
038700200616     I              CNUM                            ZRCNUM
038800200616     I              CCY                             ZRCCY
038900200616     I              ACOD                            ZRACOD
039000200616     I              ACSQ                            ZRACSQ
039100200616     I              BRCA                            ZRBRCA
039200200616     I              PTFR                            ZRPTFR
039300200616      *                                                                                       CGL031
039400200616     ITRADSDF                                                                                 CGL031
039500200616      ***  Rename some fields of LF/TRADS                                                     CGL031
039600200616     I              EUTX                            TREUTX                                    CGL031
039700200616      *                                                                                       CSE028
039800200616      ** DS for customer/book standard settlement instruction                                 CSE028
039900200616      **  to be passed to SESSIR0                                                             CSE028
040000200616      *                                                                                       CSE028
040100200616     IPCBSTD    E DSSTDSED                    2                                               CSE028
040200200616     I              RECI                            WRECI                                     CSE028
040300200616     I              LCD                             WLCD                                      CSE028
040400200616     I              CHTP                            WCHTP                                     CSE028
040500200616     I              TNLU                            WTNLU                                     CSE028
040600200616      *                                                                                       CSE028
040700200616      ** Data structure for standard additional settlement details                            CSE028
040800200616      ** for customer/book to be passed to SESSIR0                                            CSE028
040900200616      *                                                                                       CSE028
041000200616     IPCBSAD    E DSSTDADSED                  8                                               CSE028
041100200616      *
041200200616     IWWCOOP      DS
041300200616      ***  Working DS for Database Error on Logical file
041400200616     I                                        1   6 WKCOR2
041500200616     I                                        7   80WKOPT2
041600200616      *
041700200616     IWWINV       DS
041800200616      ***  Working DS for Database Error on LF/INVTP
041900200616     I                                        1   3 WKNMCY
042000200616     I                                        4   6 WKSITP
042100200616      *
042200200616     IWACKEY      DS
042300200616      ***  Account Key Data Structure
042400200616     I                                        1   3 WACITY
042500200616     I                                        4   4 WACEVC
042600200616     I                                        5   5 WACTRT
042700200616     I                                        6   6 WACPFI
042800200616     I                                        7   8 WACBKC
042900200616     I                                        9  10 WACTST
043000200616     I                                       11  12 WACCCC
043100200616     I                                       13  13 WACMKT
043200200616     I                                       14  14 WACCON
043300200616     I                                       15  15 WACNEG
043400200616     I                                       16  18 WABLCK
043500200616     I                                       19  20 WACAMC
043600200616      *
043700200616     I***P@DATA*     DS                            128                                      AR853119
043800200616     IP@DATA      DS                            141                                         AR853119
043900200616      ** Data structure of the parameter passed to and from SEZ010
044000200616     I                                        1   1 P@CLAS
044100200616     I                                        2   2 P@PPRE
044200200616     I                                        3  150P@PAMD
044300200616     I                                       16  280P@PCHA
044400200616     I                                       29  410P@PCAM
044500200616     I                                       42  540P@TASO
044600200616     I                                       55  670P@TAUS
044700200616     I                                       68  808P@PSXR
044800200616     I                                       81  81 P@PMDI
044900200616     I                                       82  84 P@PNCY
045000200616     I                                       85  87 P@PSCU
045100200616     I                                       88 1000P@PSAT
045200200616     I                                      101 1138P@FXMR
045300200616     I                                      114 1260P@MAMT
045400200616     I                                      127 128 P@TDTP
045500200616     I                                      129 1410P@STAM                                  AR853119
045600200616      *
045700200616     I            DS                            256
045800200616     I**********                              1   60ZWCNUM                                    CSD027
045900200616     I                                        1   6 ZWCNUM                                    CSD027
046000200616     I                                        7   9 ZWCCY
046100200616     I**********                             10  130ZWACOD                                    CGL029
046200200616     I**********                             14  150ZWACSQ                                    CGL029
046300200616     I**********                             16  18 ZWBRCA                                    CGL029
046400200616     I**********                              1  18 ZKACCN                                    CGL029
046500200616     I                                       10  190ZWACOD                                    CGL029
046600200616     I                                       20  210ZWACSQ                                    CGL029
046700200616     I                                       22  24 ZWBRCA                                    CGL029
046800200616     I                                        1  24 ZKACCN                                    CGL029
046900200616     ILDA       E DSLDA
047000200616      ***  Data structure for database error
047100200616      *
047200200616     ISESTAT    E DS
047300200616      ***  Data structure for SESTAT
047400200616      *
047500200616     ISPOOLU      DS
047600200616      ***  File information data structure
047700200616     I                                       83  92 SFILEU
047800200616     I                                    B 123 1240SFNUMU
047900200616      *
048000200616     IPSDS       SDS
048100200616      ***  Program Status Data Structure
048200200616     I                                      254 263 USER
048300200616      *
048400200616     I            DS
048500200616     I**********                              1  12 PSEA1                                     CGL029
048600200616     I                                        1  18 PSEA1                                     CGL029
048700200616     I**********                              1   60CNUM                                      CSD027
048800200616     I                                        1   6 CNUM                                      CSD027
048900200616     I**********                              7  100ACOD                                      CGL029
049000200616     I**********                             11  120ACSQ                                      CGL029
049100200616     I                                        7  160ACOD                                      CGL029
049200200616     I                                       17  180ACSQ                                      CGL029
049300200616      *
049400200616     I/COPY ZSRSRC,ZTNLU1Z1
049500200616     I/COPY ZSRSRC,ZHASHZ2
049600200616     I/COPY ZSRSRC,ZDATE9Z2                                                                   CGL031
049700200616      *
049800200616     ISDMMOD    E DSSDMMODPD
049900200616      ***  External DS for Modules File                    Prefix - BG
050000200616      *
050100200616     ISDBANK    E DSSDBANKPD
050200200616      ***  Data structure for bank details                 Prefix - BJ
050300200616      *
050400200616     ISECNTR    E DSSECNTRPD
050500200616      ** SE Country tax rate details
050600200616      *
050700200616     ISECBTX    E DSSECBTXPD
050800200616      ** SE Country to Branch tax rate details
050900200616      *
051000200616     ISDSTRD    E DSSDSTRDPD
051100200616      ***  Data structure for securities trading details   Prefix - BV
051200200616      *
051300200616     ISDRETL    E DSSDRETLPD
051400200616      ***  Data structure for retail details               Prefix - BM
051500200616      *
051600200616     ISDGELR    E DSSDGELRPD
051700200616     I              QQACCD                          QQACD1                                    CGL029
051800200616      ***  Data structure for general ledger details       Prefix - BK
051900200616      *
052000200616     ISDSECS    E DSSDSECSPD
052100200616     I              QQACCD                          QQACD2                                    CGL029
052200200616      ***  Data structure for securities customer details  Prefix - BF
052300200616      *
052400200616     ISDNOST    E DSSDNOSTPD
052500200616     I              QQACCD                          QQACD3                                    CGL029
052600200616      ***  Data structure for Nostro Details               Prefix - A7
052700200616      *
052800200616     ISDPLCS    E DSSDPLCSPD
052900200616      ***  Data structure for portfolio management customer details  Prefix - QB
053000200616      *
053100200616     ISCSARD    E DSSCSARDPD
053200200616      ***  Data structure for switchable features file     Prefix - None
053300200616     I*****         LCD                             WLLCD
053400200616      *
053500200616     ISDCURR    E DSSDCURRPD
053600200616      ***  Data structure for currency details             Prefix - A6
053700200616      *
053800200616     ISDBRCH    E DSSDBRCHPD                                                                  CGL031
053900200616      ** Branch Details                                                                       CGL031
054000200616      *                                                                                       CGL031
054100200616     ISDBRCE    E DSSDBRCHEXPD                                                              AR853119
054200200616      ** Branch Details Extension                                                           AR853119
054300200616     ISDSTPD    E DSSDSTPDPD                                                                AR853119
054400200616      *                                                                                     AR853119
054500200616     ISDLOCN    E DSSDLOCNPD                                                                  CGL031
054600200616      ** Location Details                                                                     CGL031
054700200616      *                                                                                       CGL031
054800200616     ISDCUST    E DSSDCUSTPD                                                                  CGL031
054900200616      ** Customer Details                                                                     CGL031
055000200616     I              QQDFAC                          QQDFA1                                    CGL031
055100200616      *                                                                                       CGL031
055200200616     ISDCTTX    E DSSDCTTXPD                                                                  CGL031
055300200616      ** Country of Tax Details                                                               CGL031
055400200616      *                                                                                       CGL031
055500200616     ISDTXPA    E DSSDTXPAPD                                                                BUG22911
055600200616      ** Data structure for Tax Parameter File                                              BUG22911
055700200616      *                                                                                     BUG22911
055800200616     IDSFDY     E DSDSFDY
055900200616      ***   Short data structure for access objects
056000200616      *
056100200616     IDSSDY     E DSDSSDY
056200200616      ***   Long data structure for access objects
056300200616      *
056400200616     IPPOSET    E DSPOSETD                                                CSE023
056500200616     I              LCD                             PSLCD                 CSE023
056600200616     I*  Position Settlement record for calling SE2310                    CSE023
056700200616      *                                                                   CSE023
056800200616     ICPYR@#      DS
056900200616      ***  Data structure for compilation - Copyright insertion
057000200616     I                                        1  80 CPY@
057100200616     I                                        1  20 CPY@##
057200200616      *                                                                                       CGL020
057300200616     I              'ZAAMLSETSE'          C         ZAAMLP                                    CGL020
057400200616      *                                                                                       CGL020
057500200616     I**********                              1   60PCUSTN                             CGL020 CSD027
057600200616     I                                        1   6 PCUSTN                                    CSD027
057700200616      *                                                                                       CGL020
057800200616      *                                                                                       CGL031
057900200616     IDSSTRT      DS                                                                          CGL031
058000200616      ***  Data structure to format Street field                                              CGL031
058100200616     I                                        1  70 WSTRT                                     CGL031
058200200616     I                                        1  35 WADDR3                                    CGL031
058300200616     I                                       36  70 WADDR4                                    CGL031
058400200616      *                                                                                       CGL031
058500200616     IDSINST      DS                                                                          CGL031
058600200616      ***  Data structure to format Instrument Reference                                      CGL031
058700200616     I                                        1  34 WINST                                     CGL031
058800200616     I                                        1  10 WINST1                                    CGL031
058900200616     I                                       11  34 WINST2                                    CGL031
059000200616     I              ' - Dividend'         C         WCINST                                    CGL031
059100200616      *                                                                                       219566
059200200616      * Data structure for AOSVALR0 string                                                    219566
059300200616     I            DS                                                                          219566
059400200616     I                                        1 200 SVAL1                                     219566
059500200616     I                                        1   1 DEF001                                    219566
059600200616      *                                                                                       219566
059700200616      * System Value                                                                          219566
059800200616     I            DS                                                                          219566
059900200616     I I            'UseDefaultSettAccnt '    1  20 SVALK1                                    219566
060000200616      *                                                                                       219566
060001200616     ISDSTAT    E DSSDSTAT                                                                  AR324886
060002200616      ** SD Data area                                                                       AR324886
060003200616      *                                                                                     AR324886
060100200616     I/COPY WNCPYSRC,SE7561I001
060200200616      *
060300200616      *****************************************************************
060400200616      /EJECT
060500200616      *****************************************************************
060600200616      *                M A I N     P R O C E S S I N G                *
060700200616      *****************************************************************
060800200616      *
060900200616      ***  Access first record (By read) In CO Reference Rtv Idx
061000200616      *
061100200616     C           *LOVAL    SETLLSECORFL2
061200200616     C                     READ SECORFL2                 44
061300200616      *
061400200616      ***  Do while end of file is not reached
061500200616      *
061600200616     C           *IN44     DOWEQ*OFF
061700200616      *                                                                                       CGL031
061800200616      ** Initialise cumulative tax variables                                                  CGL031
061900200616      *                                                                                       CGL031
062000200616     C                     Z-ADD*ZEROS    WTTXSR                                              CGL031
062100200616     C                     Z-ADD*ZEROS    WTTXSC                                              CGL031
062200200616     C                     Z-ADD*ZEROS    WTTXSB                                              CGL031
062300200616     C                     Z-ADD*ZEROS    WTNINT                                              CGL031
062400200616     C                     Z-ADD*ZEROS    WTNINC                                              CGL031
062500200616     C                     Z-ADD*ZEROS    WTNINB                                              CGL031
062600200616      *
062700200616      ***  If "Security Shortname" is not equal to "Saved Security"
062800200616      ***  Access to Security Details
062900200616      *
063000200616     C           MASESN    IFNE WOSESN
063100200616     C                     MOVELMASESN    WOSESN    P
063200200616     C                     MOVELMASESN    WKSESN    P
063300200616     C                     EXSR #SECTO
063400200616     C                     ENDIF
063500200616      *
063600200616      ***  If Last Change Type is NOT a reversal
063700200616      *
063800200616     C           MACHTP    IFNE 'R'
063900200616      *
064000200616     C                     MOVELMACORF    KWCORF    P      CO Reference Number
064100200616      *
064200200616      ***  Access LF/SECODRL0 with reference in order to obtain
064300200616      ***  the depots linked to the Corporate Action
064400200616      *
064500200616     C           KWCORF    SETLLSECODRL0
064600200616     C           KWCORF    READESECODRL0                 45
064700200616      *
064800200616      ***  Do while end of file is not reached
064900200616      *
065000200616     C           *IN45     DOWEQ*OFF
065100200616      *
065200200616      ***  Setup working field to produce Account Keys and Positions Settlements
065300200616      *
065400200616     C                     MOVE 'N'       WWAKRI  1
065500200616     C                     MOVE 'N'       WWPSRI  1
065600200616      *
065700200616      ***  If Status Corporate Action (MSCOST) is equal to 'X'
065800200616      *
065900200616     C           MSCOST    IFEQ 'X'
066000200616      *
066100200616      ***  If Payment Date is lower or equal to next working day
066200200616      *
066300200616     C           MACOPD    IFLE ZZDNWD
066400200616      *
066500200616      ***  If "Position Settlement Indicator" is NOT 'Y'
066600200616      *
066700200616     C           MSPOSI    IFNE 'Y'
066800200616     C                     MOVE 'Y'       WWPSRI           Produce Position Settl.
066900200616     C                     ENDIF
067000200616     C                     ENDIF
067100200616      *
067200200616      ***  If Event Date is lower or equal to the Event Control Date
067300200616      *
067400200616     C           MAEVDT    IFLE WWECD
067500200616      *
067600200616      ***  If "Event Date Accounting Indicator" is NOT 'Y'
067700200616      *
067800200616     C           MSEACC    IFNE 'Y'
067900200616      *
068000200616      ***  Set indicator to produce Account Keys to 'Y'
068100200616      *
068200200616     C                     MOVE 'Y'       WWAKRI           Produce Acc. Keys
068300200616     C                     ENDIF
068400200616     C                     ENDIF
068500200616      *
068600200616      ***  If Account Key or Position Settlement must be produced
068700200616      *
068800200616     C********** WWAKRI    IFEQ 'Y'                                       173581
068900200616     C********** WWPSRI    OREQ 'Y'                                       173581
069000200616     C                     EXSR #PDPRD
069100200616     C**********           ENDIF                                          173581
069200200616     C                     ENDIF                           Status 'X'
069300200616      *
069400200616      ***  Read Next Corporate Action Reference
069500200616      *
069600200616     C           KWCORF    READESECODRL0                 45
069700200616     C                     ENDDO                           *IN45=*OFF
069800200616     C                     ENDIF                           Not Reversal
069900200616      *
070000200616      ***  If Last change type = 'R' and last change date = run date
070100200616      ***  and processing type is not 'NC'
070200200616      *
070300200616     C           MACHTP    IFEQ 'R'
070400200616     C           MALCD     ANDEQBJRDNB
070500200616     C           MAPTYP    ANDNE'NC'
070600200616      *
070700200616     C                     MOVELMACORF    KWCORF    P      CA Reference Number
070800200616      *
070900200616      ***  Access LF/SECODRL0 with reference in order to obtain
071000200616      ***  the depots linked to the Corporate Action
071100200616      *
071200200616     C           KWCORF    SETLLSECODRL0
071300200616     C           KWCORF    READESECODRL0                 45
071400200616      *
071500200616      ***  Do while end of file is not reached
071600200616      *
071700200616     C           *IN45     DOWEQ*OFF
071800200616      *
071900200616      ***  Setup working field to produce Account Keys and Positions Settlements
072000200616      *
072100200616     C                     MOVE 'N'       WWAKRI  1
072200200616     C                     MOVE 'N'       WWPSRI  1
072300200616      *
072400200616      ***  If Status Corporate Action (MSCOST) is equal to 'R'
072500200616      *
072600200616     C           MSCOST    IFEQ 'R'
072700200616      *
072800200616      ***  If "Event Date Accounting indicator" is 'Y'
072900200616      *
073000200616     C           MSEACC    IFEQ 'Y'
073100200616     C                     MOVE 'Y'       WWAKRI           Produce Account Keys
073200200616      *
073300200616      ***  Produce depot record depending on processing type
073400200616      *
073500200616     C                     EXSR #PDPRD
073600200616     C                     ENDIF
073700200616     C                     ENDIF                           status
073800200616      *
073900200616      ***  Read next record
074000200616      *
074100200616     C           KWCORF    READESECODRL0                 45
074200200616     C                     ENDDO                           *IN45=*OFF
074300200616     C                     ENDIF                           Reversal
074400200616      *
074500200616     C                     MOVELMACORF    KWCORF    P      CA Reference Number
074600200616     C                     MOVE 'Y'       WWORK   1
074700200616     C                     MOVE 'Y'       WNOREC  1
074800200616      *
074900200616      ***  Access LF/SECODRL0 with reference in order to Check the status
075000200616      *
075100200616     C           KWCORF    SETLLSECODRL0
075200200616     C           KWCORF    READESECODRL0                 45
075300200616      *
075400200616      ***  Do while end of file is not reached
075500200616      *
075600200616     C           *IN45     DOWEQ*OFF
075700200616      *
075800200616     C                     MOVE 'N'       WNOREC
075900200616      *
076000200616      ***  If status is NOT 'C'
076100200616      *
076200200616     C           MSCOST    IFNE 'C'
076300200616     C                     MOVE 'N'       WWORK
076400200616     C                     ENDIF                           status
076500200616      *
076600200616      ***  Read next record
076700200616      *
076800200616     C           KWCORF    READESECODRL0                 45
076900200616     C                     ENDDO                           *IN45=*OFF
077000200616      *
077100200616      ***  If all the record read on LF/SECODRL0 have the status (MSCOST) is 'C'
077200200616      *
077300200616     C           WWORK     IFEQ 'Y'
077400200616     C           WNOREC    ANDEQ'N'
077500200616     C                     MOVE 'C'       MASTAT
077600200616     C                     UPDATSECORFD0
077700200616     C                     ENDIF                           status
077800200616      *
077900200616      ***  Access next record in CO References file
078000200616      *
078100200616     C                     READ SECORFL2                 44
078200200616     C                     ENDDO                           *IN44=*OFF
078300200616      *                                                                   CEU017
078400200616     C           CEU017    IFEQ 'Y'                                       CEU017
078500200616      *                                                                   CEU017
078600200616      ***  Access LF/SECORBL0 with reference in order to Check the status CEU017
078700200616      *                                                                   CEU017
078800200616     C           *LOVAL    SETLLSECORBL0                                  CEU017
078900200616     C                     READ SECORBL0                 44               CEU017
079000200616      *                                                                   CEU017
079100200616      ***  Do while end of file is not reached                            CEU017
079200200616      *                                                                   CEU017
079300200616     C           *IN44     DOWEQ*OFF                                      CEU017
079400200616      *                                                                   CEU017
079500200616     C                     MOVE 'Y'       WWORK                           CEU017
079600200616      *                                                                   CEU017
079700200616      ***  If status is NOT 'C'                                           CEU017
079800200616      *                                                                   CEU017
079900200616     C***********NBSTAT    IFNE 'C'                                       CEU017
080000200616     C           NBSTAT    IFEQ 'X'                                       CEU017
080100200616      *                                                                   CEU017
080200200616     C           NBBLKR    SETLLSECOCCL1                                  CEU017
080300200616     C           NBBLKR    READESECOCCL1                 45               CEU017
080400200616      *                                                                   CEU017
080500200616      ***  Do while end of file is not reached                            CEU017
080600200616      *                                                                   CEU017
080700200616     C           *IN45     DOWEQ*OFF                                      CEU017
080800200616     C           WWORK     ANDEQ'Y'                                       CEU017
080900200616      *                                                                   CEU017
081000200616     C           NACORF    CHAINSECORFL0             89                   CEU017
081100200616      *                                                                   CEU017
081200200616     C           *IN89     IFEQ *ON                                       CEU017
081300200616     C           *LOCK     IN   LDA                                       CEU017
081400200616     C                     Z-ADD1         DBASE            ***************CEU017
081500200616     C                     MOVEL*BLANKS   DBFILE           ** DB ERROR 01 CEU017
081600200616     C                     MOVE 'SECORFL0'DBFILE           ***************CEU017
081700200616     C                     MOVELNACORF    DBKEY     P                     CEU017
081800200616     C                     MOVEL'SE7561'  DBPGM     P                     CEU017
081900200616     C                     OUT  LDA                                       CEU017
082000200616     C                     EXSR *PSSR                                     CEU017
082100200616     C                     ENDIF                                          CEU017
082200200616      *                                                                   CEU017
082300200616      ***  If status is NOT 'C'                                           CEU017
082400200616      *                                                                   CEU017
082500200616     C           MASTAT    IFNE 'C'                                       CEU017
082600200616     C           MASTAT    ANDNE'R'                                       153091
082700200616     C                     MOVE 'N'       WWORK                           CEU017
082800200616     C                     ENDIF                                          CEU017
082900200616      *                                                                   CEU017
083000200616     C           NBBLKR    READESECOCCL1                 45               CEU017
083100200616     C                     ENDDO                           *IN45=*OFF     CEU017
083200200616      *                                                                   CEU017
083300200616      ***  If all the records read on LF/SECORFL0 have the status is 'C'  CEU017
083400200616      *                                                                   CEU017
083500200616     C           WWORK     IFEQ 'Y'                                       CEU017
083600200616     C                     MOVE 'C'       NBSTAT                          CEU017
083700200616     C                     UPDATSECORBD0                                  CEU017
083800200616     C                     ENDIF                                          CEU017
083900200616      *                                                                   CEU017
084000200616     C                     ENDIF                           status         CEU017
084100200616      *                                                                   CEU017
084200200616      ***  Read next record                                               CEU017
084300200616      *                                                                   CEU017
084400200616     C                     READ SECORBL0                 44               CEU017
084500200616     C                     ENDDO                           *IN44=*OFF     CEU017
084600200616      *                                                                   CEU017
084700200616     C                     ENDIF                                          CEU017
084800200616      *
084900200616      ***  Termination processing
085000200616      *
085100200616     C                     EXSR #TERPR
085200200616      *
085300200616      *****************************************************************
085400200616      /EJECT
085500200616      *****************************************************************
085600200616      *  #PDPRD -  Process Depot records for processing types         *
085700200616      *  ------                                                       *
085800200616      *  Called by : Main processing                                  *
085900200616      *  Calls     : #SELLF #PRDV #PRFR #PRCR #PROF #PREX #PRNF       *
086000200616      *              #SACKD #SACKB #SACKC                             *
086100200616      *****************************************************************
086200200616      *
086300200616     C           #PDPRD    BEGSR
086400200616      *
086500200616      ***********************
086600200616      ***  Process Depot  ***
086700200616      ***********************
086800200616      *
086900200616     C                     MOVELMSCORF    WKCORF    P      Reference
087000200616     C                     MOVE MSBRCD    WKBRCD           Branch
087100200616     C**********           Z-ADDMSDDPT    WKDDPT           Depot                              CSD027
087200200616     C                     MOVE MSDDPT    WKDDPT           Depot                              CSD027
087300200616      *
087400200616      ***  Access first depot record for current CO Reference
087500200616      *
087600200616     C           KWCODP    SETLLSECODPL2
087700200616     C           KWCODP    READESECODPL2                 46
087800200616      *
087900200616      ***  Do while same reference, same branch and same depot
088000200616      *
088100200616     C           *IN46     DOWEQ*OFF
088200200616      *
088300200616     C                     MOVE 'D'       WWDPCU  1        Gen. Pos. Settl. for Depot
088400200616      *
088500200616      ***  Access to logical file depends on processing type
088600200616      *
088700200616     C                     EXSR #SELLF
088800200616      *
088900200616      ***  Access to Standard Instructions for Corporate Actions File
089000200616      *
089100200616     C           WWPSRI    IFEQ 'Y'
089200200616     C           WWAKRI    OREQ 'Y'
089300200616     C                     EXSR #STDIS
089400200616     C                     ENDIF
089500200616      *
089600200616      ***  If Produce Position Settlements indicator is 'Y'
089700200616      *
089800200616     C           WWPSRI    IFEQ 'Y'
089900200616      *
090000200616     C                     Z-ADD*ZERO     WWTNLU           Position Settlement TNL1
090100200616      *
090200200616      ***  Check the processing type
090300200616      *
090400200616     C                     SELEC
090500200616      *
090600200616      ***  Processing type is 'DV'
090700200616      *
090800200616     C           MAPTYP    WHEQ 'DV'
090900200616     C                     EXSR #PRDV
091000200616      *
091100200616      ***  Processing type is 'FR'
091200200616      ***  or Processing type is 'RG' (Average Price Option 'Z')
091300200616      *
091400200616     C           MAPTYP    WHEQ 'FR'
091500200616     C           MAPTYP    OREQ 'RG'
091600200616     C           MFAVOP    ANDEQ'Z'
091700200616     C                     EXSR #PRFR
091800200616      *
091900200616      ***  Processing type is 'CR'
092000200616      ***  or Processing type is 'CC'                                     CEU017
092100200616      ***  or Processing type is 'CE'
092200200616      ***  or Processing type is 'OF' Exchange Offers
092300200616      ***  or Processing type is 'RG' (Average Price Option 'M','C')
092400200616      *                                                  OR     'I'       161746
092500200616      *
092600200616     C           MAPTYP    WHEQ 'CR'
092700200616     C           MAPTYP    OREQ 'CC'                                      CEU017
092800200616     C           MAPTYP    OREQ 'CE'
092900200616     C           MAPTYP    OREQ 'OF'
093000200616     C           MIOFTY    ANDEQ'E'
093100200616     C           MAPTYP    OREQ 'RG'
093200200616     C           MFAVOP    ANDEQ'M'
093300200616     C           MAPTYP    OREQ 'RG'
093400200616     C           MFAVOP    ANDEQ'C'
093500200616     C           MAPTYP    OREQ 'RG'                                      161746
093600200616     C           MFAVOP    ANDEQ'I'                                       161746
093700200616     C                     EXSR #PRCR
093800200616      *
093900200616      ***  Processing type is 'OF' Purchase Offers
094000200616      ***  or Processing type is 'OF' Subscription Offers
094100200616      *
094200200616     C           MAPTYP    WHEQ 'OF'
094300200616     C           MIOFTY    ANDEQ'P'
094400200616     C           MAPTYP    OREQ 'OF'
094500200616     C           MIOFTY    ANDEQ'S'
094600200616     C                     EXSR #PROF
094700200616      *
094800200616      ***  Processing type is 'EX'
094900200616      *
095000200616     C           MAPTYP    WHEQ 'EX'
095100200616     C                     EXSR #PREX
095200200616      *
095300200616      ***  Processing type is 'NF'
095400200616      *
095500200616     C           MAPTYP    WHEQ 'NF'
095600200616     C                     EXSR #PRNF
095700200616     C                     ENDSL
095800200616      *
095900200616      ***  Setup the Position Settlement and update the depot file
096000200616      *
096100200616     C                     Z-ADDWWTNLU    MBTNL1
096200200616     C                     UPDATSECODPD0
096300200616     C                     ENDIF                           WWPSRI='Y'
096400200616      *
096500200616      ***  If Produce Account Keys indicator is 'Y'
096600200616      *
096700200616     C           WWAKRI    IFEQ 'Y'
096800200616      *
096900200616      ***  Write an Account Key for the DEPOT
097000200616      *
097100200616     C                     EXSR #SACKD
097200200616     C                     ENDIF                           WWAKRI='Y'
097300200616      *
097400200616      ***  Read next record with same Reference, same brach and same depot
097500200616      *
097600200616     C           KWCODP    READESECODPL2                 46
097700200616     C                     ENDDO                           *IN46=*OFF
097800200616      *
097900200616      *******************************
098000200616      ***  Process Customer/Book  ***
098100200616      *******************************
098200200616      *
098300200616     C                     MOVELMSCORF    WKCORF    P      Reference
098400200616     C                     MOVE MSBRCD    WKBRCD           Branch
098500200616     C**********           Z-ADDMSDDPT    WKDDPT           Depot                              CSD027
098600200616     C                     MOVE MSDDPT    WKDDPT           Depot                              CSD027
098700200616      *
098800200616      ***  Access first allocation record for current CO Reference
098900200616      *
099000200616     C           KWCODP    SETLLSECOALL4
099100200616     C           KWCODP    READESECOALL4                 46
099200200616      *
099300200616      ***  Do while same reference, same branch and same depot
099400200616      *
099500200616     C           *IN46     DOWEQ*OFF
099600200616      *
099700200616     C                     MOVE 'C'       WWDPCU           Gen. Pos. Settl. for Customer
099800200616      *
099900200616      ***  Access to logical file depends on processing type
100000200616      *
100100200616     C                     EXSR #SELLF
100200200616      *
100300200616      ***  Access to Standard Instructions for Corporate Actions File
100400200616      *
100500200616     C           WWPSRI    IFEQ 'Y'
100600200616     C           WWAKRI    OREQ 'Y'
100700200616     C                     EXSR #STDIS
100800200616     C                     ENDIF
100900200616      *
101000200616      ***  If Produce Position Settlements indicator is 'Y'
101100200616      ***  AND Customer/book Indicator is 'C'
101200200616      *
101300200616     C           WWPSRI    IFEQ 'Y'
101400200616     C           MCCOTP    ANDEQ'C'
101500200616      *
101600200616     C                     Z-ADD*ZERO     WWTNLU           Position Settlement TNL1
101700200616      *
101800200616      ***  Check the processing type
101900200616      *
102000200616     C                     SELEC
102100200616      *
102200200616      ***  Processing type is 'DV'
102300200616      *
102400200616     C           MAPTYP    WHEQ 'DV'
102500200616     C                     EXSR #PRDV
102600200616      *
102700200616      ***  Processing type is 'FR'
102800200616      ***  or Processing type is 'RG' (Average Price Option 'Z')
102900200616      *
103000200616     C           MAPTYP    WHEQ 'FR'
103100200616     C           MAPTYP    OREQ 'RG'
103200200616     C           MFAVOP    ANDEQ'Z'
103300200616     C                     EXSR #PRFR
103400200616      *
103500200616      ***  Processing type is 'CR'
103600200616      ***  or Processing type is 'CC'                                     CEU017
103700200616      ***  or Processing type is 'CE'
103800200616      ***  or Processing type is 'OF' Exchange Offers
103900200616      ***  or Processing type is 'RG' (Average Price Option 'M','C')
104000200616      *                                                  OR     'I'       161746
104100200616      *
104200200616     C           MAPTYP    WHEQ 'CR'
104300200616     C           MAPTYP    OREQ 'CC'                                      CEU017
104400200616     C           MAPTYP    OREQ 'CE'
104500200616     C           MAPTYP    OREQ 'OF'
104600200616     C           MIOFTY    ANDEQ'E'
104700200616     C           MAPTYP    OREQ 'RG'
104800200616     C           MFAVOP    ANDEQ'M'
104900200616     C           MAPTYP    OREQ 'RG'
105000200616     C           MFAVOP    ANDEQ'C'
105100200616     C           MAPTYP    OREQ 'RG'                                      161746
105200200616     C           MFAVOP    ANDEQ'I'                                       161746
105300200616     C                     EXSR #PRCR
105400200616      *
105500200616      ***  Processing type is 'OF' Purchase Offers
105600200616      ***  or Processing type is 'OF' Subscription Offers
105700200616      *
105800200616     C           MAPTYP    WHEQ 'OF'
105900200616     C           MIOFTY    ANDEQ'P'
106000200616     C           MAPTYP    OREQ 'OF'
106100200616     C           MIOFTY    ANDEQ'S'
106200200616     C                     EXSR #PROF
106300200616      *
106400200616      ***  Processing type is 'EX'
106500200616      *
106600200616     C           MAPTYP    WHEQ 'EX'
106700200616     C                     EXSR #PREX
106800200616      *
106900200616      ***  Processing type is 'NF'
107000200616      *
107100200616     C           MAPTYP    WHEQ 'NF'
107200200616     C                     EXSR #PRNF
107300200616     C                     ENDSL
107400200616      *
107500200616      ***  Setup the Position Settlement and update the depot file
107600200616      *
107700200616     C                     Z-ADDWWTNLU    MCTNL1
107800200616     C                     UPDATSECOALD0
107900200616     C                     ENDIF                           WWPSRI='Y'
108000200616      *
108100200616      ***  If Produce Account Keys indicator is 'Y'
108200200616      *
108300200616     C           WWAKRI    IFEQ 'Y'
108400200616      *
108500200616      ***  Check the Customer/Book
108600200616      *
108700200616     C                     SELEC
108800200616      *
108900200616      ***  Write an Account Key for the BOOK
109000200616      *
109100200616     C           MCCOTP    WHEQ 'B'
109200200616     C                     EXSR #SACKB
109300200616      *
109400200616      ***  Write an Account Key for the CUSTOMER
109500200616      *
109600200616     C           MCCOTP    WHEQ 'C'
109700200616     C                     EXSR #SACKC
109800200616      *                                                                                       CGL031
109900200616     C           BFCLAS    IFEQ 'D'                                                           CGL031
110000200616     C           BFCLAS    OREQ 'S'                                                           CGL031
110100200616     C           MAPTYP    IFEQ 'DV'                                                          CGL031
110200200616     C           CGL031    ANDEQ'Y'                                                           CGL031
110300200616     C                     EXSR SRDVTX                                                        CGL031
110400200616     C                     ENDIF                                                              CGL031
110500200616     C                     ENDIF                                                              CGL031
110600200616      *                                                                                       CGL031
110700200616     C                     ENDSL
110800200616     C                     ENDIF                           WWAKRI='Y'
110900200616      *
111000200616      ***  Read next record with same Reference, same brach and same depot
111100200616      *
111200200616     C           KWCODP    READESECOALL4                 46
111300200616     C                     ENDDO                           *IN46=*OFF
111400200616      *
111500200616      ***  If Status is not 'R' (Reversal)
111600200616      *
111700200616     C           MSCOST    IFNE 'R'
111800200616      *
111900200616     C**********           MOVE 'C'       MSCOST           Status         150165
112000200616      *
112100200616      ***  If produce position settlement indicator is 'Y'
112200200616      *
112300200616     C           WWPSRI    IFEQ 'Y'
112400200616     C                     MOVE 'Y'       MSPOSI           Position Settlement
112500200616     C                     ENDIF
112600200616      *
112700200616      ***  If produce account key indicator is 'Y'
112800200616      *
112900200616     C           WWAKRI    IFEQ 'Y'
113000200616     C                     MOVE 'Y'       MSEACC           Event Date Accounting
113100200616     C                     ENDIF
113200200616      *                                                                   150165
113300200616      ***  If Position settlement indicator and A/c Key Indicator is 'Y'  150165
113400200616      *                                                                   150165
113500200616     C           MSPOSI    IFEQ 'Y'                                       150165
113600200616     C           MSEACC    ANDEQ'Y'                                       150165
113700200616     C           MSEVNI    ANDEQ'Y'                                       153091
113800200616     C                     MOVE 'C'       MSCOST           Status         150165
113900200616     C                     ENDIF                                          150165
114000200616      *
114100200616     C                     UPDATSECODRD0
114200200616     C                     ENDIF                           MSCOST<>'R'
114300200616      *
114400200616     C                     ENDSR
114500200616      *
114600200616      *****************************************************************
114700200616      /EJECT
114800200616      *****************************************************************                       CGL031
114900200616      *  SRDVTX -  Tax Calculations                                   *                       CGL031
115000200616      *  ------                                                       *                       CGL031
115100200616      *  Called by : #PDPRD                                           *                       CGL031
115200200616      *  Calls     : SRSACK SRCALI SRTXCI SRCALJ                      *                       CGL031
115300200616      *****************************************************************                       CGL031
115400200616      *                                                                                       CGL031
115500200616     C           SRDVTX    BEGSR                                                              CGL031
115600200616      *                                                                                       CGL031
115700200616      ** Use Booking Branch to retrieve Branch Location Code                                  CGL031
115800200616      *                                                                                       CGL031
115900200616     C**********           CALL 'AOBRCHR0'                                             CGL031 CGL035
116000200616     C                     CALL 'AOBRCHR1'                                                    CGL035
116100200616     C                     PARM *BLANKS   PRTCD   7                                           CGL031
116200200616     C                     PARM '*KEY   ' POPTN   7                                           CGL031
116300200616     C                     PARM MCBRCD    PBRCA   3                                           CGL031
116400200616     C********** SDBRCH    PARM SDBRCH    DSFDY                                        CGL031 CGL035
116500200616     C           SDBRCH    PARM SDBRCH    DSSDY                                               CGL035
116600200616      *                                                                                       CGL031
116700200616     C           PRTCD     IFNE *BLANKS                                                       CGL031
116800200616     C           *LOCK     IN   LDA                                                           CGL031
116900200616     C                     MOVEL'SDBRCHPD'DBFILE                                              CGL031
117000200616     C                     MOVELMCBRCD    DBKEY                                               CGL031
117100200616     C                     Z-ADD101       DBASE                                               CGL031
117200200616     C                     OUT  LDA                                                           CGL031
117300200616     C                     EXSR *PSSR                                                         CGL031
117400200616     C                     ENDIF                                                              CGL031
117500200616      *                                                                                       CGL031
117600200616      ** Use Branch Loc Code to retrieve Country Code (Country of Tax)                        CGL031
117700200616      *                                                                                       CGL031
117800200616     C                     CALL 'AOLOCNR0'                                                    CGL031
117900200616     C                     PARM '*MSG   ' PRTCD                                               CGL031
118000200616     C                     PARM '*KEY   ' POPTN                                               CGL031
118100200616     C                     PARM A8LCCD    PLCCD   3                                           CGL031
118200200616     C           SDLOCN    PARM SDLOCN    DSFDY                                               CGL031
118300200616      *                                                                                       CGL031
118400200616     C           PRTCD     IFNE *BLANKS                                                       CGL031
118500200616     C           *LOCK     IN   LDA                                                           CGL031
118600200616     C                     MOVEL'SDLOCNPD'DBFILE                                              CGL031
118700200616     C                     MOVELA8LCCD    DBKEY                                               CGL031
118800200616     C                     Z-ADD102       DBASE                                               CGL031
118900200616     C                     OUT  LDA                                                           CGL031
119000200616     C                     EXSR *PSSR                                                         CGL031
119100200616     C                     ENDIF                                                              CGL031
119200200616      *                                                                                       CGL031
119300200616      ** Retrieve Customer's Country of Residence                                             CGL031
119400200616      *                                                                                       CGL031
119500200616     C                     MOVEL*BLANKS   PKEY   10                                           CGL031
119600200616     C                     MOVELMCCNUM    PKEY                                                CGL031
119700200616     C                     CALL 'AOCUSTR0'                                                    CGL031
119800200616     C                     PARM *BLANKS   PRTCD                                               CGL031
119900200616     C                     PARM '*KEY   ' POPTN                                               CGL031
120000200616     C                     PARM           PKEY                                                CGL031
120100200616     C                     PARM *BLANKS   PKYST   7                                           CGL031
120200200616     C           SDCUST    PARM SDCUST    DSSDY                                               CGL031
120300200616      *                                                                                       CGL031
120400200616     C           PRTCD     IFNE *BLANKS                                                       CGL031
120500200616     C           *LOCK     IN   LDA                                                           CGL031
120600200616     C                     MOVEL'SDCUSTPD'DBFILE                                              CGL031
120700200616     C                     Z-ADD103       DBASE                                               CGL031
120800200616     C                     MOVELMCCNUM    DBKEY                                               CGL031
120900200616     C                     OUT  LDA                                                           CGL031
121000200616     C                     EXSR *PSSR                                                         CGL031
121100200616     C                     ENDIF                                                              CGL031
121200200616      *                                                                                       CGL031
121300200616      ** Use retrieved Country of Tax and Country of Residence                                CGL031
121400200616      ** to retrieve the Tax Basket                                                           CGL031
121500200616      *                                                                                       CGL031
121600200616     C                     CALL 'AOCTTXR0'                                                    CGL031
121700200616     C                     PARM *BLANKS   PRTCD                                               CGL031
121800200616     C                     PARM '*KEY   ' POPTN                                               CGL031
121900200616     C                     PARM DVCNCD    PCTRT   2                                           CGL031
122000200616     C                     PARM BBCOLC    PCTRR   2                                           CGL031
122100200616     C           SDCTTX    PARM SDCTTX    DSFDY                                               CGL031
122200200616      *                                                                                       CGL031
122300200616      ** If no record is found, try blank Country of Residence                                CGL031
122400200616      *                                                                                       CGL031
122500200616     C           PRTCD     IFNE *BLANKS                                                       CGL031
122600200616     C                     CALL 'AOCTTXR0'                                                    CGL031
122700200616     C                     PARM *BLANKS   PRTCD                                               CGL031
122800200616     C                     PARM '*KEY   ' POPTN                                               CGL031
122900200616     C                     PARM DVCNCD    PCTRT                                               CGL031
123000200616     C                     PARM *BLANKS   PCTRR                                               CGL031
123100200616     C           SDCTTX    PARM SDCTTX    DSFDY                                               CGL031
123200200616      *                                                                                       CGL031
123300200616     C           PRTCD     IFNE *BLANKS                                                       CGL031
123400200616     C           *LOCK     IN   LDA                                                           CGL031
123500200616     C                     MOVEL'SDCTTXPD'DBFILE                                              CGL031
123600200616     C                     Z-ADD104       DBASE                                               CGL031
123700200616     C                     MOVELDVCNCD    DBKEY                                               CGL031
123800200616     C                     MOVE BBCOLC    DBKEY                                               CGL031
123900200616     C                     OUT  LDA                                                           CGL031
124000200616     C                     EXSR *PSSR                                                         CGL031
124100200616     C                     ENDIF                                                              CGL031
124200200616     C                     ENDIF                                                              CGL031
124300200616      *                                                                                       CGL031
124400200616     C                     MOVE 'N'       WEUTXF  1                                           CGL031
124500200616     C                     MOVE 'N'       WJOINT  1                                           CGL031
124600200616      *                                                                                       CGL031
124700200616      ** Position Tax Basket details PF/SDTXBSL1 by                                           CGL031
124800200616      ** Country of Tax, Tax Basket and Rundate                                               CGL031
124900200616      *                                                                                       CGL031
125000200616     C           KTXBS1    SETGTSDTXBSL1                                                      CGL031
125100200616     C           KTXBS2    REDPESDTXBSL1                 80                                   CGL031
125200200616      *                                                                                       CGL031
125300200616     C           *IN80     IFEQ '0'                                                           CGL031
125400200616      *                                                                                       CGL031
125500200616     C                     EXSR SRTXCI                                                        CGL031
125600200616      *                                                                                       CGL031
125700200616     C                     SELEC                                                              CGL031
125800200616      *                                                                                       CGL031
125900200616      ** If error was detected                                                                CGL031
126000200616      *                                                                                       CGL031
126100200616     C           PRTRN     WHEQ 'ERROR'                                                       CGL031
126200200616     C           *LOCK     IN   LDA                                                           CGL031
126300200616     C                     MOVELPDBFIL    DBFILE                                              CGL031
126400200616     C                     Z-ADD105       DBASE                                               CGL031
126500200616     C                     MOVELPDBKEY    DBKEY                                               CGL031
126600200616     C                     OUT  LDA                                                           CGL031
126700200616     C                     EXSR *PSSR                                                         CGL031
126800200616      *                                                                                       CGL031
126900200616      ** Calculate Withholding Tax                                                            CGL031
127000200616      *                                                                                       CGL031
127100200616     C           PRTRN     WHEQ *BLANKS                                                       CGL031
127200200616     C                     EXSR SRCALI                                                        CGL031
127300200616      *                                                                                       CGL031
127400200616      ** Calculate Withholding Tax for Joint Accounts                                         CGL031
127500200616      *                                                                                       CGL031
127600200616     C           PRTRN     WHEQ 'JOINT'                                                       CGL031
127700200616     C                     EXSR SRCALJ                                                        CGL031
127800200616      *                                                                                       CGL031
127900200616     C                     ENDSL                                                              CGL031
128000200616      *                                                                                       CGL031
128100200616     C                     ENDIF                                                              CGL031
128200200616      *                                                                                       CGL031
128300200616     C                     ENDSR                                                              CGL031
128400200616      *****************************************************************                       CGL031
128500200616      /EJECT                                                                                  CGL031
128600200616      *****************************************************************                       CGL031
128700200616      *  SRTXCI - Calculate EU Withholding Tax for Private Individual *                       CGL031
128800200616      *  ------                                                       *                       CGL031
128900200616      *  Called by : SRDVTX                                           *                       CGL031
129000200616      *  Calls     : ZATXCLPI                                         *                       CGL031
129100200616      *****************************************************************                       CGL031
129200200616      *                                                                                       CGL031
129300200616     C           SRTXCI    BEGSR                                                              CGL031
129400200616      *                                                                                       CGL031
129500200616     C                     MOVE '000000'  PCNUM                                               CGL031
129600200616     C                     MOVE MCCNUM    PCNUM                                               CGL031
129700200616      *                                                                                       CGL031
129800200616     C                     CALL 'ZATXCLPI'                                                    CGL031
129900200616      *                                                                                       CGL031
130000200616      ** Input parameters                                                                     CGL031
130100200616      *                                                                                       CGL031
130200200616     C                     PARM 'S'       PMODID  1                                           CGL031
130300200616     C**********           PARM MCSESN    PTRREF 18                                    CGL031 CGL035
130400200616     C                     PARM MCSESN    PTRREF 24                                           CGL035
130500200616     C                     PARM MCBRCD    PBRCA                                               CGL031
130600200616     C                     PARM           PCNUM   6                                           CGL031
130700200616     C                     PARM *ZEROS    PICSTR  50                                          CGL031
130800200616     C                     PARM *ZEROS    PICEND  50                                          CGL031
130900200616     C                     PARM WWEVAM    PTOTIN 150                                          CGL031
131000200616     C                     PARM TBTRAB    PTXRAB  64                                          CGL031
131100200616     C                     PARM WONMCY    POCCY   3                                           CGL031
131200200616     C                     PARM *BLANKS   PINTH   1                                           CER048
131300200616      *                                                                                       CGL031
131400200616      ** Output parameters                                                                    CGL031
131500200616      *                                                                                       CGL031
131600200616     C                     PARM           PIEDAT 150                                          CGL031
131700200616     C                     PARM           PTXAMT 150                                          CGL031
131800200616     C                     PARM           PTOTO  150                                          CGL031
131900200616     C                     PARM           PTXCCY  3                                           CGL031
132000200616     C                     PARM           PCTTX   2                                           CGL031
132100200616     C                     PARM           PTXBS   2                                           CGL031
132200200616     C**********           PARM           PEUTXC  40                                   CGL031 CGL035
132300200616     C                     PARM           PEUTXC 100                                          CGL035
132400200616     C                     PARM           PCLOC   2                                           CGL031
132500200616     C                     PARM           PCSTAT  5                                           CGL031
132600200616     C                     PARM           PTTEND  1                                           CGL031
132700200616     C                     PARM           PTXRP1  64                                          CGL031
132800200616     C**********           PARM *ZEROS    PSTXB   20                                 CER048 BUG22911
132900200616     C**********           PARM *ZEROS    PSTAC  100                                 CER048 BUG22911
133000200616     C**********           PARM *ZEROS    PSTTR   64                                 CER048 BUG22911
133100200616     C**********           PARM *BLANKS   PSTTP   1                                  CER048 BUG22911
133200200616     C**********           PARM *ZEROS    PSTXA  150                                 CER048 BUG22911
133300200616     C                     PARM           PDBKEY 10                                           CGL031
133400200616     C                     PARM           PDBFIL 10                                           CGL031
133500200616     C                     PARM           PRTRN   7                                           CGL031
133600200616     C           SDTXPA    PARM SDTXPA    DSSDY                                             BUG22911
133700200616      *                                                                                       CGL031
133800200616     C                     ENDSR                                                              CGL031
133900200616      *****************************************************************                       CGL031
134000200616      /EJECT                                                                                  CGL031
134100200616      *****************************************************************                       CGL031
134200200616      *  SRCALI - Cal Indiv Tax depending on Calculation Method       *                       CGL031
134300200616      *  ------                                                       *                       CGL031
134400200616      *  Called by : SRDVTX                                           *                       CGL031
134500200616      *  Calls     : SRETAX                                           *                       CGL031
134600200616      *****************************************************************                       CGL031
134700200616      *                                                                                       CGL031
134800200616     C           SRCALI    BEGSR                                                              CGL031
134900200616      *                                                                                       CGL031
135000200616      ** Retrieve Cal Method by DVCNCD and PCTTX                                              CGL031
135100200616      ** If no record was found, use Calc Method 1                                            CGL031
135200200616      *                                                                                       CGL031
135300200616     C           KTXCM1    CHAINSDTXCML1             80                                       CGL031
135400200616      *                                                                                       CGL031
135500200616     C           *IN80     IFEQ '0'                                                           CGL031
135600200616     C                     Z-ADDTCTXCM    WTXCM   10                                          CGL031
135700200616     C                     ELSE                                                               CGL031
135800200616     C                     Z-ADD1         WTXCM                                               CGL031
135900200616     C                     ENDIF                                                              CGL031
136000200616      *                                                                                       CGL031
136100200616      ** Retrieve Local Tax Rate S1RASO                                                       CGL031
136200200616      *                                                                                       CGL031
136300200616     C           MCSESN    CHAINSESWHTL0             80                                       CGL031
136400200616      *                                                                                       CGL031
136500200616      ** Calculate Tax according to Calculation Method                                        CGL031
136600200616      *                                                                                       CGL031
136700200616     C                     SELEC                                                              CGL031
136800200616      *                                                                                       CGL031
136900200616     C           WTXCM     WHEQ 1                                                             CGL031
137000200616     C           *IN80     OREQ '1'                                                           CGL031
137100200616     C           S1RASO    OREQ *ZEROS                                                        CGL031
137200200616     C                     Z-ADDPTXAMT    PTXAMT                                              CGL031
137300200616      *                                                                                       CGL031
137400200616     C           WTXCM     WHEQ 2                                                             CGL031
137500200616     C           URATE     MULT PTOTIN    WTOTI  150                                          CGL031
137600200616     C           PTOTIN    SUB  WTOTI     WTOTI                                               CGL031
137700200616     C           PTXRAB    MULT WTOTI     WTOTI                                               CGL031
137800200616     C           WTOTI     DIV  100       PTXAMT                                              CGL031
137900200616      *                                                                                       CGL031
138000200616     C           WTXCM     WHEQ 3                                                             CGL031
138100200616     C           URATE     MULT PTOTIN    WTOTI                                               CGL031
138200200616     C           PTXAMT    SUB  WTOTI     PTXAMT                                              CGL031
138300200616      *                                                                                       CGL031
138400200616     C           PTXAMT    IFLT 0                                                             CGL031
138500200616     C                     Z-ADD0         PTXAMT                                              CGL031
138600200616     C                     ENDIF                                                              CGL031
138700200616      *                                                                                       CGL031
138800200616     C           WTXCM     WHEQ 4                                                             CGL031
138900200616     C                     Z-ADD0         PTXAMT                                              CGL031
139000200616      *                                                                                       CGL031
139100200616     C                     ENDSL                                                              CGL031
139200200616      *                                                                                       CGL031
139300200616     C                     EXSR SRETAX                                                        CGL031
139400200616      *                                                                                       CGL031
139500200616     C                     ENDSR                                                              CGL031
139600200616      *                                                                                       CGL031
139700200616      *****************************************************************                       CGL031
139800200616      /EJECT                                                                                  CGL031
139900200616      *****************************************************************                       CGL031
140000200616      *  SRCALJ -  Cal Joint Tax depending on Calculation Method      *                       CGL031
140100200616      *  ------                                                       *                       CGL031
140200200616      *  Called by : SRDVTX                                           *                       CGL031
140300200616      *  Calls     : SRETAX                                           *                       CGL031
140400200616      *****************************************************************                       CGL031
140500200616      *                                                                                       CGL031
140600200616     C           SRCALJ    BEGSR                                                              CGL031
140700200616      *                                                                                       CGL031
140800200616     C                     MOVE 'Y'       WJOINT                                              CGL031
140900200616     C                     MOVE *BLANKS   WMCCUS  6                                           CGL031
141000200616     C                     MOVE MCCNUM    WMCCUS                                              CGL031
141100200616      *                                                                                       CGL031
141200200616      ** Process Account Holders                                                              CGL031
141300200616      *                                                                                       CGL031
141400200616     C           WMCCUS    SETLLSDJACCL1                                                      CGL031
141500200616     C           WMCCUS    READESDJACCL1                 81                                   CGL031
141600200616      *                                                                                       CGL031
141700200616     C           *IN81     DOWEQ'0'                                                           CGL031
141800200616      *                                                                                       CGL031
141900200616     C           JCCUST    IFNE *BLANKS                                                       CGL031
142000200616      *                                                                                       CGL031
142100200616     C                     MOVE *BLANKS   PRTRN                                               CGL031
142200200616      *                                                                                       CGL031
142300200616     C                     EXSR SRTXCJ                                                        CGL031
142400200616      *                                                                                       CGL031
142500200616     C                     SELEC                                                              CGL031
142600200616      *                                                                                       CGL031
142700200616     C           PRTRN     WHEQ 'ERROR'                                                       CGL031
142800200616     C           *LOCK     IN   LDA                                                           CGL031
142900200616     C                     MOVE 106       DBASE                                               CGL031
143000200616     C                     MOVE PDBFIL    DBFILE                                              CGL031
143100200616     C                     MOVE PDBKEY    DBKEY                                               CGL031
143200200616     C                     OUT  LDA                                                           CGL031
143300200616     C                     EXSR *PSSR                                                         CGL031
143400200616      *                                                                                       CGL031
143500200616     C           PRTRN     WHEQ *BLANKS                                                       CGL031
143600200616     C           PRTRN     OREQ 'LAST'                                                        CGL031
143700200616      *                                                                                       CGL031
143800200616      ** Retrieve Local Tax Rate S1RASO                                                       CGL031
143900200616      *                                                                                       CGL031
144000200616     C           MCSESN    CHAINSESWHTL0             80                                       CGL031
144100200616      *                                                                                       CGL031
144200200616      ** Calculate Tax according to Calculation Method                                        CGL031
144300200616      *                                                                                       CGL031
144400200616     C                     SELEC                                                              CGL031
144500200616      *                                                                                       CGL031
144600200616     C           WTXCM     WHEQ 1                                                             CGL031
144700200616     C           *IN80     OREQ '1'                                                           CGL031
144800200616     C           S1RASO    OREQ *ZEROS                                                        CGL031
144900200616     C                     Z-ADDPTXAMT    PTXAMT                                              CGL031
145000200616      *                                                                                       CGL031
145100200616     C           WTXCM     WHEQ 2                                                             CGL031
145200200616     C           URATE     MULT PTOTIN    WTOTI                                               CGL031
145300200616     C           PTOTIN    SUB  WTOTI     WTOTI                                               CGL031
145400200616     C           PTXRAB    MULT WTOTI     WTOTI                                               CGL031
145500200616     C           WTOTI     DIV  100       PTXAMT                                              CGL031
145600200616      *                                                                                       CGL031
145700200616     C           WTXCM     WHEQ 3                                                             CGL031
145800200616     C           URATE     MULT PTOTIN    WTOTI                                               CGL031
145900200616     C           PTXAMT    SUB  WTOTI     PTXAMT                                              CGL031
146000200616      *                                                                                       CGL031
146100200616     C           PTXAMT    IFLT 0                                                             CGL031
146200200616     C                     Z-ADD0         PTXAMT                                              CGL031
146300200616     C                     ENDIF                                                              CGL031
146400200616      *                                                                                       CGL031
146500200616     C           WTXCM     WHEQ 4                                                             CGL031
146600200616     C                     Z-ADD0         PTXAMT                                              CGL031
146700200616      *                                                                                       CGL031
146800200616     C                     ENDSL                                                              CGL031
146900200616      *                                                                                       CGL031
147000200616     C                     EXSR SRETAX                                                        CGL031
147100200616      *                                                                                       CGL031
147200200616     C                     ENDSL                                                              CGL031
147300200616      *                                                                                       CGL031
147400200616     C                     ENDIF                                                              CGL031
147500200616      *                                                                                       CGL031
147600200616     C           WMCCUS    READESDJACCL1                 81                                   CGL031
147700200616     C                     ENDDO                                                              CGL031
147800200616      *                                                                                       CGL031
147900200616      ** Process Non-Account Holders                                                          CGL031
148000200616      *                                                                                       CGL031
148100200616     C           WMCCUS    SETLLSDJACCL3                                                      CGL031
148200200616     C           WMCCUS    READESDJACCL3                 81                                   CGL031
148300200616      *                                                                                       CGL031
148400200616     C           *IN81     DOWEQ'0'                                                           CGL031
148500200616      *                                                                                       CGL031
148600200616     C           JCNAHO    IFNE *BLANKS                                                       CGL031
148700200616      *                                                                                       CGL031
148800200616     C                     MOVE *BLANKS   PRTRN                                               CGL031
148900200616      *                                                                                       CGL031
149000200616     C                     EXSR SRTXCJ                                                        CGL031
149100200616      *                                                                                       CGL031
149200200616     C                     SELEC                                                              CGL031
149300200616      *                                                                                       CGL031
149400200616     C           PRTRN     WHEQ 'ERROR'                                                       CGL031
149500200616     C           *LOCK     IN   LDA                                                           CGL031
149600200616     C                     MOVE 107       DBASE                                               CGL031
149700200616     C                     MOVE PDBFIL    DBFILE                                              CGL031
149800200616     C                     MOVE PDBKEY    DBKEY                                               CGL031
149900200616     C                     OUT  LDA                                                           CGL031
150000200616     C                     EXSR *PSSR                                                         CGL031
150100200616      *                                                                                       CGL031
150200200616     C           PRTRN     WHEQ *BLANKS                                                       CGL031
150300200616      *                                                                                       CGL031
150400200616      ** Retrieve Local Tax Rate S1RASO                                                       CGL031
150500200616      *                                                                                       CGL031
150600200616     C           MCSESN    CHAINSESWHTL0             80                                       CGL031
150700200616      *                                                                                       CGL031
150800200616      ** Calculate Tax according to Calculation Method                                        CGL031
150900200616      *                                                                                       CGL031
151000200616     C                     SELEC                                                              CGL031
151100200616      *                                                                                       CGL031
151200200616     C           WTXCM     WHEQ 1                                                             CGL031
151300200616     C           *IN80     OREQ '1'                                                           CGL031
151400200616     C           S1RASO    OREQ *ZEROS                                                        CGL031
151500200616     C                     Z-ADDPTXAMT    PTXAMT                                              CGL031
151600200616      *                                                                                       CGL031
151700200616     C           WTXCM     WHEQ 2                                                             CGL031
151800200616     C           URATE     MULT PTOTIN    WTOTI                                               CGL031
151900200616     C           PTOTIN    SUB  WTOTI     WTOTI                                               CGL031
152000200616     C           PTXRAB    MULT WTOTI     WTOTI                                               CGL031
152100200616     C           WTOTI     DIV  100       PTXAMT                                              CGL031
152200200616      *                                                                                       CGL031
152300200616     C           WTXCM     WHEQ 3                                                             CGL031
152400200616     C           URATE     MULT PTOTIN    WTOTI                                               CGL031
152500200616     C           PTXAMT    SUB  WTOTI     PTXAMT                                              CGL031
152600200616      *                                                                                       CGL031
152700200616     C           PTXAMT    IFLT 0                                                             CGL031
152800200616     C                     Z-ADD0         PTXAMT                                              CGL031
152900200616     C                     ENDIF                                                              CGL031
153000200616      *                                                                                       CGL031
153100200616     C           WTXCM     WHEQ 4                                                             CGL031
153200200616     C                     Z-ADD0         PTXAMT                                              CGL031
153300200616      *                                                                                       CGL031
153400200616     C                     ENDSL                                                              CGL031
153500200616      *                                                                                       CGL031
153600200616     C                     EXSR SRETAX                                                        CGL031
153700200616      *                                                                                       CGL031
153800200616     C                     ENDSL                                                              CGL031
153900200616      *                                                                                       CGL031
154000200616     C                     ENDIF                                                              CGL031
154100200616      *                                                                                       CGL031
154200200616     C           WMCCUS    READESDJACCL3                 81                                   CGL031
154300200616     C                     ENDDO                                                              CGL031
154400200616      *                                                                                       CGL031
154500200616     C                     ENDSR                                                              CGL031
154600200616      *                                                                                       CGL031
154700200616      *****************************************************************                       CGL031
154800200616      /EJECT                                                                                  CGL031
154900200616      *****************************************************************                       CGL031
155000200616      *  SRTXCJ -  Calculte EU Withholding Tax for Joint Account      *                       CGL031
155100200616      *  ------                                                       *                       CGL031
155200200616      *  Called by : SRCALJ                                           *                       CGL031
155300200616      *  Calls     : ZATXCLJA                                         *                       CGL031
155400200616      *****************************************************************                       CGL031
155500200616      *                                                                                       CGL031
155600200616     C           SRTXCJ    BEGSR                                                              CGL031
155700200616      *                                                                                       CGL031
155800200616     C                     MOVE '000000'  PJANO                                               CGL031
155900200616     C                     MOVE MCCNUM    PJANO                                               CGL031
156000200616      *                                                                                       CGL031
156100200616     C                     CALL 'ZATXCLJA'                                                    CGL031
156200200616      *                                                                                       CGL031
156300200616      ** Input parameters                                                                     CGL031
156400200616      *                                                                                       CGL031
156500200616     C                     PARM 'S'       PMODID                                              CGL031
156600200616     C                     PARM MCSESN    PTRREF                                              CGL031
156700200616     C                     PARM MCBRCD    PBRCA                                               CGL031
156800200616     C                     PARM           PJANO   6                                           CGL031
156900200616     C                     PARM JCCUST    PCNUM                                               CGL031
157000200616     C                     PARM JCNAHO    PNAHO  10                                           CGL031
157100200616     C                     PARM JCINVP    PINVP  10                                           CGL031
157200200616     C                     PARM JCPAHT    PPAHT   1                                         BUG26839
157300200616     C                     PARM *ZEROS    PICSTR                                              CGL031
157400200616     C                     PARM *ZEROS    PICEND                                              CGL031
157500200616     C                     PARM WWEVAM    PTOTIN                                              CGL031
157600200616     C                     PARM TBTRAB    PTXRAB                                              CGL031
157700200616     C                     PARM WONMCY    POCCY                                               CGL031
157800200616     C                     PARM *BLANKS   PINTH                                               CER048
157900200616      *                                                                                       CGL031
158000200616      ** Output parameters                                                                    CGL031
158100200616      *                                                                                       CGL031
158200200616     C                     PARM           PIEDAT                                              CGL031
158300200616     C                     PARM           PTXAMT                                              CGL031
158400200616     C                     PARM           PTOTO                                               CGL031
158500200616     C                     PARM           PTXCCY                                              CGL031
158600200616     C                     PARM           PCTTX                                               CGL031
158700200616     C                     PARM           PTXBS                                               CGL031
158800200616     C                     PARM           PEUTXC                                              CGL031
158900200616     C                     PARM           PCLOC                                               CGL031
159000200616     C                     PARM           PCSTAT                                              CGL031
159100200616     C                     PARM           PTTEND                                              CGL031
159200200616     C                     PARM           PTXRP1                                              CGL031
159300200616     C                     PARM           PJAMG   1                                           CGL031
159400200616     C**********           PARM *ZEROS    PSTXB                                      CER048 BUG22911
159500200616     C**********           PARM *ZEROS    PSTAC                                      CER048 BUG22911
159600200616     C**********           PARM *ZEROS    PSTTR                                      CER048 BUG22911
159700200616     C**********           PARM *BLANKS   PSTTP                                      CER048 BUG22911
159800200616     C**********           PARM *ZEROS    PSTXA                                      CER048 BUG22911
159900200616     C                     PARM           PDBKEY                                              CGL031
160000200616     C                     PARM           PDBFIL                                              CGL031
160100200616     C                     PARM           PRTRN                                               CGL031
160200200616     C           SDTXPA    PARM SDTXPA    DSSDY                                             BUG22911
160300200616      *                                                                                       CGL031
160400200616     C                     ENDSR                                                              CGL031
160500200616      *                                                                                       CGL031
160600200616      *****************************************************************                       CGL031
160700200616      /EJECT                                                                                  CGL031
160800200616      *****************************************************************                       CGL031
160900200616      *  SRETAX -  Generate output if Tax has been computed.          *                       CGL031
161000200616      *  ------                                                       *                       CGL031
161100200616      *  Called by : SRCALI SRCALJ                                    *                       CGL031
161200200616      *  Calls     : SRCSIN SRSACK                                    *                       CGL031
161300200616      *****************************************************************                       CGL031
161400200616      *                                                                                       CGL031
161500200616     C           SRETAX    BEGSR                                                              CGL031
161600200616      *                                                                                       CGL031
161700200616      ** If Tax was calculated and Customer Stat is 'TAXAB', 'DISCL'                          CGL031
161800200616      ** or 'SELF' create record in SDCSINPD and generate account key                         CGL031
161900200616      *                                                                                       CGL031
162000200616     C           PCSTAT    IFEQ 'TAXAB'                                                       CGL031
162100200616     C           PCSTAT    OREQ 'DISCL'                                                       CGL031
162200200616     C           PCSTAT    OREQ 'SELF'                                                        CGL031
162300200616     C                     EXSR SRCSIN                                                        CGL031
162400200616     C                     EXSR SRSACK                                                        CGL031
162500200616     C                     ENDIF                                                              CGL031
162600200616      *                                                                                       CGL031
162700200616     C                     ENDSR                                                              CGL031
162800200616      *                                                                                       CGL031
162900200616      *****************************************************************                       CGL031
163000200616      /EJECT                                                                                  CGL031
163100200616      *****************************************************************                       CGL031
163200200616      *  SRCSIN - Setup and write Customer Income details to SDCSINPD *                       CGL031
163300200616      *  ------                                                       *                       CGL031
163400200616      *  Called by : SRDVTX                                           *                       CGL031
163500200616      *  Calls     : *PSSR                                            *                       CGL031
163600200616      *****************************************************************                       CGL031
163700200616      *                                                                                       CGL031
163800200616     C           SRCSIN    BEGSR                                                              CGL031
163900200616      *                                                                                       CGL031
164000200616      ** Initialise PF/SDCSINPD fields                                                        CGL031
164100200616      *                                                                                       CGL031
164200200616     C                     MOVE '000000'  TSCUST                                              CGL031
164300200616     C**********           Z-ADD*ZEROS    TSJOIN                                      CGL031 CSD027A
164400200616     C                     MOVE *BLANKS   TSJOIN                                             CSD027A
164500200616     C                     MOVE *BLANKS   TSNAHO                                              CGL031
164600200616     C                     MOVE *BLANKS   TSINVP                                              CGL031
164700200616     C                     MOVE *BLANKS   TSFAMN                                              CGL031
164800200616     C                     MOVE *BLANKS   TSFIRN                                              CGL031
164900200616     C                     MOVE *BLANKS   WSTRT                                               CGL031
165000200616     C                     MOVE *BLANKS   TSSTRT                                              CGL031
165100200616     C                     MOVE *BLANKS   TSZIPC                                              CGL031
165200200616     C                     MOVE *BLANKS   TSCITY                                              CGL031
165300200616     C                     MOVE *BLANKS   TSRTIN                                              CGL031
165400200616     C                     MOVE *BLANKS   TSDBTH                                              CGL031
165500200616     C                     MOVE *BLANKS   TSTBTH                                              CGL031
165600200616     C                     MOVE *BLANKS   TSIPDT                                              CGL031
165700200616     C                     Z-ADD*ZEROS    TSTXBS                                              CGL031
165800200616     C                     MOVE *BLANKS   WINST1                                              CGL031
165900200616     C                     MOVE *BLANKS   TSINST                                              CGL031
166000200616     C                     MOVE *BLANKS   TSTRTP                                              CGL031
166100200616     C                     MOVE *BLANKS   TSTRST                                              CGL031
166200200616     C                     Z-ADD*ZEROS    TSDLLN                                              CGL031
166300200616     C                     Z-ADD*ZEROS    TSACOD                                              CGL031
166400200616     C                     Z-ADD*ZEROS    TSACSQ                                              CGL031
166500200616     C                     MOVE *BLANKS   TSIBAN                                              CGL031
166600200616     C                     MOVE *BLANKS   TSSESN                                              CGL031
166700200616     C                     MOVE *BLANKS   TSSRPN                                              CGL031
166800200616     C                     MOVE *BLANKS   TSISIN                                              CGL031
166900200616      *                                                                                       CER048
167000200616     C           CER048    IFEQ 'Y'                                                           CER048
167100200616      *                                                                                       CER048
167200200616     C                     MOVE *ZEROS    TSSTXB                                              CER048
167300200616     C                     MOVE *ZEROS    TSSTAC                                              CER048
167400200616     C                     MOVE *ZEROS    TSSTRT                                              CER048
167500200616     C                     MOVE *ZEROS    TSSTDO                                              CER048
167600200616     C                     MOVE *ZEROS    TSSTDS                                              CER048
167700200616     C                     MOVE *ZEROS    TSSTDT                                              CER048
167800200616     C                     MOVE *ZEROS    TSSTDB                                              CER048
167900200616     C                     MOVE *ZEROS    TSPTHU                                              CER048
168000200616     C                     MOVE *ZEROS    TSPTUT                                              CER048
168100200616      *                                                                                       CER048
168200200616     C                     ENDIF                                                              CER048
168300200616      *                                                                                       CGL031
168400200616      ** Populate fields                                                                      CGL031
168500200616      *                                                                                       CGL031
168600200616     C                     Z-ADDBJRDNB    TSRDNB                                              CGL031
168700200616     C                     Z-ADDMAEVDT    TSEDAT                                              CGL031
168800200616     C           BJDFIN    IFEQ 'D'                                                           CGL031
168900200616     C                     MOVE '0'       *IN98                                               CGL031
169000200616     C                     ELSE                                                               CGL031
169100200616     C                     MOVE '1'       *IN98                                               CGL031
169200200616     C                     ENDIF                                                              CGL031
169300200616     C                     Z-ADDMAEVDT    ZDAYNO                                              CGL031
169400200616     C                     MOVE ZDATE     TSTAXY                                              CGL031
169500200616     C                     MOVEL'20'      TSTAXY                                              CGL031
169600200616      *                                                                                       CGL031
169700200616     C           *IN98     IFEQ '0'                                                           CGL031
169800200616     C                     MOVELZDATE     WSTR4   40                                          CGL031
169900200616     C                     MOVE WSTR4     TSTAXM                                              CGL031
170000200616     C                     ELSE                                                               CGL031
170100200616     C                     MOVELZDATE     TSTAXM                                              CGL031
170200200616     C                     ENDIF                                                              CGL031
170300200616      *                                                                                       CGL031
170400200616     C                     MOVE PCTTX     TSCTRT                                              CGL031
170500200616     C                     MOVE PBRCA     TSBRCA                                              CGL031
170600200616     C                     MOVE PCNUM     TSCUST                                              CGL031
170700200616     C                     SELEC                                                              CGL031
170800200616     C           PCSTAT    WHEQ 'DISCL'                                                       CGL031
170900200616     C                     MOVE 'D'       TSSTAT                                              CGL031
171000200616     C           PCSTAT    WHEQ 'SELF'                                                        CGL031
171100200616     C                     MOVE 'S'       TSSTAT                                              CGL031
171200200616     C           PCSTAT    WHEQ 'TAXAB'                                                       CGL031
171300200616     C                     MOVE 'T'       TSSTAT                                              CGL031
171400200616     C                     ENDSL                                                              CGL031
171500200616      *                                                                                       CGL031
171600200616     C                     MOVE PCLOC     TSRCTR                                              CGL031
171700200616     C                     Z-ADDMAEVDT    @@DAYN  50                                          CGL031
171800200616     C                     EXSR ZDATE9                                                        CGL031
171900200616     C                     MOVE @@VDT     TSIPDT                                              CGL031
172000200616     C                     MOVE PTXBS     TSTXBS                                              CGL031
172100200616     C                     Z-ADDPEUTXC    TSWTAC                                              CGL031
172200200616     C                     MOVE POCCY     TSOCCY                                              CGL031
172300200616      *                                                                                       CGL031
172400200616     C                     CALL 'AOCURRR0'                                                    CGL031
172500200616     C                     PARM *BLANKS   PRTCD                                               CGL031
172600200616     C                     PARM '*KEY  '  POPTN                                               CGL031
172700200616     C                     PARM TSOCCY    PCYCD   3                                           CGL031
172800200616     C           SDCURR    PARM SDCURR    DSSDY                                               CGL031
172900200616     C           PRTCD     IFNE *BLANKS                                                       CGL031
173000200616     C           *LOCK     IN   LDA                                                           CGL031
173100200616     C                     Z-ADD108       DBASE                                               CGL031
173200200616     C                     MOVE *BLANKS   DBFILE                                              CGL031
173300200616     C                     MOVEL'SDCURRPD'DBFILE                                              CGL031
173400200616     C                     MOVELTSOCCY    DBKEY                                               CGL031
173500200616     C                     OUT  LDA                                                           CGL031
173600200616     C                     EXSR *PSSR                                                         CGL031
173700200616     C                     ENDIF                                                              CGL031
173800200616     C           A6MDIN    IFEQ 'D'                                                           CGL031
173900200616     C                     Z-ADDA6SPRT    TSOCSR                                              CGL031
174000200616     C                     ELSE                                                               CGL031
174100200616     C           1         DIV  A6SPRT    TSOCSR                                              CGL031
174200200616     C                     ENDIF                                                              CGL031
174300200616      *                                                                                       CGL031
174400200616     C                     MOVE 'D'       TSOCMD                                              CGL031
174500200616     C                     Z-ADDA6NBDP    TSOCDP                                              CGL031
174600200616     C                     MOVE TSOCCY    TSSCCY                                              CGL031
174700200616     C                     Z-ADDTSOCSR    TSSCSR                                              CGL031
174800200616     C                     MOVE TSOCMD    TSSCMD                                              CGL031
174900200616     C                     Z-ADDTSOCDP    TSSCDP                                              CGL031
175000200616     C                     MOVE PTXCCY    TSTXCY                                              CGL031
175100200616      *                                                                                       CGL031
175200200616     C                     CALL 'AOCURRR0'                                                    CGL031
175300200616     C                     PARM *BLANKS   PRTCD                                               CGL031
175400200616     C                     PARM '*KEY  '  POPTN                                               CGL031
175500200616     C                     PARM TSTXCY    PCYCD                                               CGL031
175600200616     C           SDCURR    PARM SDCURR    DSSDY                                               CGL031
175700200616     C           @RTCD     IFNE *BLANKS                                                       CGL031
175800200616     C           *LOCK     IN   LDA                                                           CGL031
175900200616     C                     Z-ADD109       DBASE                                               CGL031
176000200616     C                     MOVE *BLANKS   DBFILE                                              CGL031
176100200616     C                     MOVEL'SDCURRPD'DBFILE                                              CGL031
176200200616     C                     MOVELTSTXCY    DBKEY                                               CGL031
176300200616     C                     OUT  LDA                                                           CGL031
176400200616     C                     EXSR *PSSR                                                         CGL031
176500200616     C                     ENDIF                                                              CGL031
176600200616     C           A6MDIN    IFEQ 'D'                                                           CGL031
176700200616     C                     Z-ADDA6SPRT    TSTCSR                                              CGL031
176800200616     C                     ELSE                                                               CGL031
176900200616     C           1         DIV  A6SPRT    TSTCSR                                              CGL031
177000200616     C                     ENDIF                                                              CGL031
177100200616      *                                                                                       CGL031
177200200616     C                     MOVE 'D'       TSTCMD                                              CGL031
177300200616     C                     Z-ADDA6NBDP    TSTCDP                                              CGL031
177400200616      *                                                                                       CGL031
177500200616     C           MCTRRF    CHAINTRADS                80                                       CGL031
177600200616     C                     Z-ADDTDER      TSXROS                                              CGL031
177700200616     C                     MOVE TMDI      TSOSMD                                              CGL031
177800200616      *                                                                                       CGL031
177900200616     C                     Z-ADDTSSCSR    ZRATE1                                              CGL031
178000200616     C                     MOVE TSSCMD    ZMDI1                                               CGL031
178100200616     C                     Z-ADDTSTCSR    ZRATE2                                              CGL031
178200200616     C                     MOVE TSTCMD    ZMDI2                                               CGL031
178300200616     C                     EXSR ZXRATE                                                        CGL031
178400200616     C                     Z-ADDZRATEX    TSXRST                                              CGL031
178500200616     C                     MOVE ZMDIX     TSSTMD                                              CGL031
178600200616      *                                                                                       CGL031
178700200616     C                     MOVE 'S'       TSMODI                                              CGL031
178800200616     C                     MOVELMCSESN    WINST1                                              CGL031
178900200616     C                     MOVELWCINST    WINST2                                              CGL031
179000200616     C                     MOVELWINST     TSINST                                              CGL031
179100200616     C                     MOVE 'DV'      TSETYP                                              CGL031
179200200616      *                                                                                       CGL031
179300200616     C           MCSESN    CHAINSECTY                80                                       CGL031
179400200616     C                     MOVELSESN      TSSESN                                              CGL031
179500200616     C                     MOVELSRPN      TSSRPN                                              CGL031
179600200616     C                     MOVELISNO      TSISIN                                              CGL031
179700200616      *                                                                                       CGL031
179800200616     C                     Z-ADDPTOTO     TSPAMT                                              CGL031
179900200616     C                     Z-ADDPTOTO     TSGINT                                              CGL031
180000200616     C                     Z-ADDPTXRAB    TSTXRT                                              CGL031
180100200616     C                     Z-ADDPTXAMT    TSTXSR                                              CGL031
180200200616     C           TSGINT    SUB  TSTXSR    TSNINT                                              CGL031
180300200616      *                                                                                       CGL031
180400200616     C           TSOCCY    IFEQ TSSCCY                                                        CGL031
180500200616     C                     Z-ADDTSPAMT    TSPAMS                                              CGL031
180600200616     C                     Z-ADDPTOTO     TSGINS                                              CGL031
180700200616     C                     Z-ADDPTXAMT    TSTXSS                                              CGL031
180800200616      *                                                                                       CGL031
180900200616     C                     ELSE                                                               CGL031
181000200616     C                     Z-ADDTSPAMT    ZAMTF                                               CGL031
181100200616     C                     Z-ADDTSXROS    ZCRSRT                                              CGL031
181200200616     C                     MOVE TSOSMD    ZCRSMD                                              CGL031
181300200616     C                     Z-ADDTSOCDP    ZCDPF                                               CGL031
181400200616     C                     Z-ADDTSSCDP    ZCDPT                                               CGL031
181500200616     C                     EXSR ZCCYXR                                                        CGL031
181600200616     C                     Z-ADDZAMTT     TSPAMS                                              CGL031
181700200616      *                                                                                       CGL031
181800200616     C                     Z-ADDPTOTO     ZAMTF                                               CGL031
181900200616     C                     Z-ADDTSXROS    ZCRSRT                                              CGL031
182000200616     C                     MOVE TSOSMD    ZCRSMD                                              CGL031
182100200616     C                     Z-ADDTSOCDP    ZCDPF                                               CGL031
182200200616     C                     Z-ADDTSSCDP    ZCDPT                                               CGL031
182300200616     C                     EXSR ZCCYXR                                                        CGL031
182400200616     C                     Z-ADDZAMTT     TSGINS                                              CGL031
182500200616      *                                                                                       CGL031
182600200616     C                     Z-ADDPTXAMT    ZAMTF                                               CGL031
182700200616     C                     Z-ADDTSXROS    ZCRSRT                                              CGL031
182800200616     C                     MOVE TSOSMD    ZCRSMD                                              CGL031
182900200616     C                     Z-ADDTSOCDP    ZCDPF                                               CGL031
183000200616     C                     Z-ADDTSSCDP    ZCDPT                                               CGL031
183100200616     C                     EXSR ZCCYXR                                                        CGL031
183200200616     C                     Z-ADDZAMTT     TSTXSS                                              CGL031
183300200616     C                     ENDIF                                                              CGL031
183400200616      *                                                                                       CGL031
183500200616     C           TSGINC    SUB  TSTXSS    TSNINS                                              CGL031
183600200616      *                                                                                       CGL031
183700200616     C           TSSCCY    IFEQ TSTXCY                                                        CGL031
183800200616     C                     Z-ADDTSPAMS    TSPAMC                                              CGL031
183900200616     C                     Z-ADDTSGINS    TSGINC                                              CGL031
184000200616     C                     Z-ADDTSTXSS    TSTXSC                                              CGL031
184100200616      *                                                                                       CGL031
184200200616     C                     ELSE                                                               CGL031
184300200616     C                     Z-ADDTSPAMS    ZAMTF                                               CGL031
184400200616     C                     Z-ADDTSXRST    ZCRSRT                                              CGL031
184500200616     C                     MOVE TSSTMD    ZCRSMD                                              CGL031
184600200616     C                     Z-ADDTSSCDP    ZCDPF                                               CGL031
184700200616     C                     Z-ADDTSTCDP    ZCDPT                                               CGL031
184800200616     C                     EXSR ZCCYXR                                                        CGL031
184900200616     C                     Z-ADDZAMTT     TSPAMC                                              CGL031
185000200616      *                                                                                       CGL031
185100200616     C                     Z-ADDTSGINS    ZAMTF                                               CGL031
185200200616     C                     Z-ADDTSXRST    ZCRSRT                                              CGL031
185300200616     C                     MOVE TSSTMD    ZCRSMD                                              CGL031
185400200616     C                     Z-ADDTSSCDP    ZCDPF                                               CGL031
185500200616     C                     Z-ADDTSTCDP    ZCDPT                                               CGL031
185600200616     C                     EXSR ZCCYXR                                                        CGL031
185700200616     C                     Z-ADDZAMTT     TSGINC                                              CGL031
185800200616      *                                                                                       CGL031
185900200616     C                     Z-ADDTSTXSS    ZAMTF                                               CGL031
186000200616     C                     Z-ADDTSXRST    ZCRSRT                                              CGL031
186100200616     C                     MOVE TSSTMD    ZCRSMD                                              CGL031
186200200616     C                     Z-ADDTSSCDP    ZCDPF                                               CGL031
186300200616     C                     Z-ADDTSTCDP    ZCDPT                                               CGL031
186400200616     C                     EXSR ZCCYXR                                                        CGL031
186500200616     C                     Z-ADDZAMTT     TSTXSC                                              CGL031
186600200616     C                     ENDIF                                                              CGL031
186700200616      *                                                                                       CGL031
186800200616     C           TSGINC    SUB  TSTXSC    TSNINC                                              CGL031
186900200616      *                                                                                       CGL031
187000200616     C           TSSCCY    IFEQ BJCYCD                                                        CGL031
187100200616     C                     Z-ADDTSPAMS    TSPAMB                                              CGL031
187200200616     C                     Z-ADDTSGINS    TSGINB                                              CGL031
187300200616     C                     Z-ADDTSTXSS    TSTXSB                                              CGL031
187400200616      *                                                                                       CGL031
187500200616     C                     ELSE                                                               CGL031
187600200616     C                     Z-ADDTSPAMS    ZAMTF                                               CGL031
187700200616     C                     Z-ADDTSSCSR    ZCRSRT                                              CGL031
187800200616     C                     MOVE TSSCMD    ZCRSMD                                              CGL031
187900200616     C                     Z-ADDTSSCDP    ZCDPF                                               CGL031
188000200616     C                     Z-ADDZCDPI     ZCDPT                                               CGL031
188100200616     C                     EXSR ZCCYXR                                                        CGL031
188200200616     C                     Z-ADDZAMTT     TSPAMB                                              CGL031
188300200616      *                                                                                       CGL031
188400200616     C                     Z-ADDTSGINS    ZAMTF                                               CGL031
188500200616     C                     Z-ADDTSSCSR    ZCRSRT                                              CGL031
188600200616     C                     MOVE TSSCMD    ZCRSMD                                              CGL031
188700200616     C                     Z-ADDTSSCDP    ZCDPF                                               CGL031
188800200616     C                     Z-ADDZCDPI     ZCDPT                                               CGL031
188900200616     C                     EXSR ZCCYXR                                                        CGL031
189000200616     C                     Z-ADDZAMTT     TSGINB                                              CGL031
189100200616      *                                                                                       CGL031
189200200616     C                     Z-ADDTSTXSS    ZAMTF                                               CGL031
189300200616     C                     Z-ADDTSSCSR    ZCRSRT                                              CGL031
189400200616     C                     MOVE TSSCMD    ZCRSMD                                              CGL031
189500200616     C                     Z-ADDTSSCDP    ZCDPF                                               CGL031
189600200616     C                     Z-ADDZCDPI     ZCDPT                                               CGL031
189700200616     C                     EXSR ZCCYXR                                                        CGL031
189800200616     C                     Z-ADDZAMTT     TSTXSB                                              CGL031
189900200616     C                     ENDIF                                                              CGL031
190000200616      *                                                                                       CGL031
190100200616     C           TSGINB    SUB  TSTXSB    TSNINB                                              CGL031
190200200616     C                     MOVE 'N'       TSINPR                                              CGL031
190300200616      *                                                                                       CGL031
190400200616      ** Fields depending on whether they are Individual or Joint                             CGL031
190500200616      *                                                                                       CGL031
190600200616     C           WJOINT    IFEQ 'N'                                                           CGL031
190700200616     C           PCNUM     CHAINSDACUSL1             80                                       CGL031
190800200616     C                     MOVELE5CNA1    TSFAMN                                              CGL031
190900200616     C                     MOVELE5CNA2    TSFIRN                                              CGL031
191000200616     C                     MOVELE5CNA3    WADDR3                                              CGL031
191100200616     C                     MOVELE5CNA4    WADDR4                                              CGL031
191200200616     C                     MOVELWSTRT     TSSTRT                                              CGL031
191300200616     C                     MOVELE5ZIPC    TSZIPC                                              CGL031
191400200616     C                     MOVELE5CITY    TSCITY                                              CGL031
191500200616     C                     MOVELE5TINO    TSRTIN                                              CGL031
191600200616     C                     MOVE E5DBTH    TSDBTH                                              CGL031
191700200616     C                     MOVE E5BTHT    TSTBTH                                              CGL031
191800200616     C                     MOVE E5BTHC    TSCBTH                                              CGL031
191900200616      *                                                                                       CGL031
192000200616     C                     ELSE                                                               CGL031
192100200616     C           PNAHO     CHAINSDNAHOL1             80                                       CGL031
192200200616     C                     MOVE PJANO     TSJOIN                                              CGL031
192300200616     C                     MOVE PNAHO     TSNAHO                                              CGL031
192400200616     C                     MOVE PINVP     TSINVP                                              CGL031
192500200616     C                     MOVELNHIDE1    TSFAMN                                              CGL031
192600200616     C                     MOVELNHIDE2    TSFIRN                                              CGL031
192700200616     C                     MOVELNHIDE3    WADDR3                                              CGL031
192800200616     C                     MOVELNHIDE4    WADDR4                                              CGL031
192900200616     C                     MOVELWSTRT     TSSTRT                                              CGL031
193000200616     C                     MOVELNHZIPC    TSZIPC                                              CGL031
193100200616     C                     MOVELNHCITY    TSCITY                                              CGL031
193200200616     C                     MOVELNHTINO    TSRTIN                                              CGL031
193300200616     C                     MOVE NHDBTH    TSDBTH                                              CGL031
193400200616     C                     MOVE NHBTHT    TSTBTH                                              CGL031
193500200616     C                     MOVE NHBTHC    TSCBTH                                              CGL031
193600200616     C                     ENDIF                                                              CGL031
193700200616      *                                                                                       CGL031
193800200616      ** Write record to SDCSINPD                                                             CGL031
193900200616      *                                                                                       CGL031
194000200616     C                     WRITESDCSIND0                                                      CGL031
194100200616      *                                                                                       CGL031
194200200616      ** Accumulate relevant amounts for net total                                            CGL031
194300200616      *                                                                                       CGL031
194400200616     C           TSSTAT    IFEQ 'T'                                                           CGL031
194500200616     C                     ADD  TSTXSR    WTTXSR 150                                          CGL031
194600200616     C                     ADD  TSTXSC    WTTXSC 150                                          CGL031
194700200616     C                     ADD  TSTXSB    WTTXSB 150                                          CGL031
194800200616     C                     ADD  TSNINT    WTNINT 150                                          CGL031
194900200616     C                     ADD  TSNINC    WTNINC 150                                          CGL031
195000200616     C                     ADD  TSNINB    WTNINB 150                                          CGL031
195100200616     C                     ENDIF                                                              CGL031
195200200616      *                                                                                       CGL031
195300200616     C                     ENDSR                                                              CGL031
195400200616      *****************************************************************                       CGL031
195500200616      /EJECT                                                                                  CGL031
195600200616      *****************************************************************                       CGL031
195700200616      *  SRSACK - Setup Account Keys and Amount fields for            *                       CGL031
195800200616      *  ------   Customer Tax                                        *                       CGL031
195900200616      *  Called by : #PDPRD                                           *                       CGL031
196000200616      *  Calls     : ZHASH #AOSEC #COAT SRWACK                        *                       CGL031
196100200616      *****************************************************************                       CGL031
196200200616      *                                                                                       CGL031
196300200616     C           SRSACK    BEGSR                                                              CGL031
196400200616      *                                                                                       CGL031
196500200616      ***  Tax Account Key Generation                                                         CGL031
196600200616      *                                                                                       CGL031
196700200616      ***  Write key Cash Income Due - Customer                                               CGL031
196800200616      *                                                                                       CGL031
196900200616     C                     CLEARWACKEY                                                        CGL031
197000200616      *                                                                                       CGL031
197100200616      ** .. Event Amount = Cumulated Tax Deducted at Source in Tax CCY                        CGL031
197200200616     C                     Z-ADDWTTXSC    WWEVAM                                              CGL031
197300200616      *                                                                                       CGL031
197400200616      ***  EXECUTE HASH TOTALLING SUBROUTINE ONCE (Z=1) FOR FIRST                             CGL031
197500200616      ***  ARRAY ELEMENTS (IND,S DEC,S) SO S=1 ,ACCUMULATING ZZAMT(15/3)                      CGL031
197600200616      *                                                                                       CGL031
197700200616     C                     Z-ADD1         Z                                                   CGL031
197800200616     C                     Z-ADD1         S                                                   CGL031
197900200616     C                     Z-ADDWWEVAM    ZZAMT                                               CGL031
198000200616     C                     EXSR ZHASH                                                         CGL031
198100200616      ** .. Account Key (iiiH-d--yy--mvn---DI)             Positions                          CGL031
198200200616     C                     MOVE WOSITP    WACITY           (1 - 3)                            CGL031
198300200616     C                     MOVE 'E'       WACEVC           (4)                                CGL031
198400200616     C                     MOVE TSCTRT    WACTRT           (5)                                CGL031
198500200616      *                                                                                       CGL031
198600200616      ***  If Classification is 'S' or 'D'                                                    CGL031
198700200616      ***  Issuer is not necessary a SE client defined on PF/SDSECSPD                         CGL031
198800200616      ***  So, no DB error if record not found !!!                                            CGL031
198900200616      *                                                                                       CGL031
199000200616     C                     MOVE MCCNUM    WCUST                                               CGL031
199100200616      *                                                                                       CGL031
199200200616     C                     CALL 'AOSECSR0'                                                    CGL031
199300200616     C                     PARM *BLANKS   @RTCD                                               CGL031
199400200616     C                     PARM '*KEY   ' @OPTN                                               CGL031
199500200616     C                     PARM WCUST     @SCKY                                               CGL031
199600200616     C           SDSECS    PARM SDSECS    DSSDY                                               CGL031
199700200616      *                                                                                       CGL031
199800200616     C                     MOVE *BLANKS   WACPFI           (6)                                CGL031
199900200616     C           @RTCD     IFEQ *BLANKS                                                       CGL031
200000200616     C           BFCLAS    ANDEQ'S'                                                           CGL031
200100200616     C           @RTCD     OREQ *BLANKS                                                       CGL031
200200200616     C           BFCLAS    ANDEQ'D'                                                           CGL031
200300200616     C                     MOVE BFCLAS    WACPFI           (6)                                CGL031
200400200616     C                     ENDIF                                                              CGL031
200500200616      *                                                                                       CGL031
200600200616     C                     MOVE *BLANKS   WACBKC           (7 - 8)                            CGL031
200700200616     C           BVCOTA    IFEQ 'Y'                                                           CGL031
200800200616     C                     MOVE MCCOAT    WKCOAT                                              CGL031
200900200616     C                     EXSR #COAT                                                         CGL031
201000200616     C                     MOVE MMTSUB    WACTST           (9 - 10)                           CGL031
201100200616     C                     ELSE                                                               CGL031
201200200616     C                     MOVE *BLANKS   WACTST           (9 - 10)                           CGL031
201300200616     C                     ENDIF                                                              CGL031
201400200616     C                     MOVE *BLANKS   WACCCC           (11 - 12)                          CGL031
201500200616     C                     MOVE WOMKTI    WACMKT           (13)                               CGL031
201600200616      *                                                                                       CGL031
201700200616     C           BVCIAK    IFEQ 'Y'                                                           CGL031
201800200616     C           WOSCVI    ANDEQ'Y'                                                           CGL031
201900200616     C                     MOVE WOSCVI    WACCON           (14)                               CGL031
202000200616     C                     ELSE                                                               CGL031
202100200616     C                     MOVE *BLANKS   WACCON           (14)                               CGL031
202200200616     C                     ENDIF                                                              CGL031
202300200616      *                                                                                       CGL031
202400200616     C           BVNPAC    IFEQ 'N'                                                           CGL031
202500200616     C           WWEVAM    ORGE *ZERO                                                         CGL031
202600200616     C                     MOVE *BLANKS   WACNEG           (15)                               CGL031
202700200616     C                     ELSE                                                               CGL031
202800200616     C                     MOVE 'N'       WACNEG           (15)                               CGL031
202900200616     C                     ENDIF                                                              CGL031
203000200616      *                                                                                       CGL031
203100200616     C                     MOVE *BLANKS   WABLCK           (16 - 18)                          CGL031
203200200616     C                     MOVE 'ET'      WACAMC           (19 - 20)                          CGL031
203300200616      *                                                                                       CGL031
203400200616     C                     Z-ADD*ZEROS    WWKBCA 150                                          CGL031
203500200616     C                     Z-ADD*ZEROS    WWKNCA 150                                          CGL031
203600200616      *                                                                                       CGL031
203700200616     C           TSTXCY    IFNE TSOCCY                                                        CGL031
203800200616     C                     Z-ADDWTTXSB    WWKBCA                                              CGL031
203900200616     C                     Z-ADDWTTXSR    WWKNCA                                              CGL031
204000200616     C                     ENDIF                                                              CGL031
204100200616      *                                                                                       CGL031
204200200616      ***  Write Account Key record for The customer                                          CGL031
204300200616      *                                                                                       CGL031
204400200616     C                     EXSR SRWACK                                                        CGL031
204500200616      *                                                                                       CGL031
204600200616      ** Net Interest Amount Account Key Generation                                           CGL031
204700200616      *                                                                                       CGL031
204800200616      ***  Write key Cash Amount Due - Customer                                               CGL031
204900200616      *                                                                                       CGL031
205000200616     C                     CLEARWACKEY                                                        CGL031
205100200616      *                                                                                       CGL031
205200200616      ** .. Event Amount = Cumulated Net Interest Amount in Tax CCY                           CGL031
205300200616     C                     Z-ADDWTNINC    WWEVAM                                              CGL031
205400200616      *                                                                                       CGL031
205500200616      ***  EXECUTE HASH TOTALLING SUBROUTINE ONCE (Z=1) FOR FIRST                             CGL031
205600200616      ***  ARRAY ELEMENTS (IND,S DEC,S) SO S=1 ,ACCUMULATING ZZAMT(15/3)                      CGL031
205700200616      *                                                                                       CGL031
205800200616     C                     Z-ADD1         Z                                                   CGL031
205900200616     C                     Z-ADD1         S                                                   CGL031
206000200616     C                     Z-ADDWWEVAM    ZZAMT                                               CGL031
206100200616     C                     EXSR ZHASH                                                         CGL031
206200200616      ** .. Account Key (iiiH-d--yy--mvn---DI)             Positions                          CGL031
206300200616     C                     MOVE WOSITP    WACITY           (1 - 3)                            CGL031
206400200616     C                     MOVE 'E'       WACEVC           (4)                                CGL031
206500200616     C                     MOVE *BLANKS   WACTRT           (5)                                CGL031
206600200616      *                                                                                       CGL031
206700200616      ***  If Classification is 'S' or 'D'                                                    CGL031
206800200616      ***  Issuer is not necessary a SE client defined on PF/SDSECSPD                         CGL031
206900200616      ***  So, no DB error if record not found !!!                                            CGL031
207000200616      *                                                                                       CGL031
207100200616     C                     MOVE MCCNUM    WCUST                                               CGL031
207200200616      *                                                                                       CGL031
207300200616     C                     CALL 'AOSECSR0'                                                    CGL031
207400200616     C                     PARM *BLANKS   @RTCD                                               CGL031
207500200616     C                     PARM '*KEY   ' @OPTN                                               CGL031
207600200616     C                     PARM WCUST     @SCKY                                               CGL031
207700200616     C           SDSECS    PARM SDSECS    DSSDY                                               CGL031
207800200616      *                                                                                       CGL031
207900200616     C                     MOVE *BLANKS   WACPFI           (6)                                CGL031
208000200616     C           @RTCD     IFEQ *BLANKS                                                       CGL031
208100200616     C           BFCLAS    ANDEQ'S'                                                           CGL031
208200200616     C           @RTCD     OREQ *BLANKS                                                       CGL031
208300200616     C           BFCLAS    ANDEQ'D'                                                           CGL031
208400200616     C                     MOVE BFCLAS    WACPFI           (6)                                CGL031
208500200616     C                     ENDIF                                                              CGL031
208600200616      *                                                                                       CGL031
208700200616     C                     MOVE *BLANKS   WACBKC           (7 - 8)                            CGL031
208800200616     C           BVCOTA    IFEQ 'Y'                                                           CGL031
208900200616     C                     MOVE MCCOAT    WKCOAT                                              CGL031
209000200616     C                     EXSR #COAT                                                         CGL031
209100200616     C                     MOVE MMTSUB    WACTST           (9 - 10)                           CGL031
209200200616     C                     ELSE                                                               CGL031
209300200616     C                     MOVE *BLANKS   WACTST           (9 - 10)                           CGL031
209400200616     C                     ENDIF                                                              CGL031
209500200616     C                     MOVE *BLANKS   WACCCC           (11 - 12)                          CGL031
209600200616     C                     MOVE WOMKTI    WACMKT           (13)                               CGL031
209700200616      *                                                                                       CGL031
209800200616     C           BVCIAK    IFEQ 'Y'                                                           CGL031
209900200616     C           WOSCVI    ANDEQ'Y'                                                           CGL031
210000200616     C                     MOVE WOSCVI    WACCON           (14)                               CGL031
210100200616     C                     ELSE                                                               CGL031
210200200616     C                     MOVE *BLANKS   WACCON           (14)                               CGL031
210300200616     C                     ENDIF                                                              CGL031
210400200616      *                                                                                       CGL031
210500200616     C           BVNPAC    IFEQ 'N'                                                           CGL031
210600200616     C           WWEVAM    ORGE *ZERO                                                         CGL031
210700200616     C                     MOVE *BLANKS   WACNEG           (15)                               CGL031
210800200616     C                     ELSE                                                               CGL031
210900200616     C                     MOVE 'N'       WACNEG           (15)                               CGL031
211000200616     C                     ENDIF                                                              CGL031
211100200616      *                                                                                       CGL031
211200200616     C                     MOVE *BLANKS   WABLCK           (16 - 18)                          CGL031
211300200616     C                     MOVE 'NI'      WACAMC           (19 - 20)                          CGL031
211400200616      *                                                                                       CGL031
211500200616     C           TSTXCY    IFNE TSOCCY                                                        CGL031
211600200616     C                     Z-ADDWTNINT    WWKNCA                                              CGL031
211700200616     C                     Z-ADDWTNINB    WWKBCA                                              CGL031
211800200616     C                     ENDIF                                                              CGL031
211900200616      *                                                                                       CGL031
212000200616      ***  Write Account Key record for The customer                                          CGL031
212100200616      *                                                                                       CGL031
212200200616     C                     EXSR SRWACK                                                        CGL031
212300200616     C                     ENDSR                                                              CGL031
212400200616      *                                                                                       CGL031
212500200616      *****************************************************************                       CGL031
212600200616      /EJECT                                                                                  CGL031
212700200616      *****************************************************************                       CGL031
212800200616      *  SRWACK - Write an account key for Customer Tax               *                       CGL031
212900200616      *  ------                                                       *                       CGL031
213000200616      *  Called by : SRWACK                                           *                       CGL031
213100200616      *  Calls     : ZSETAC                                           *                       CGL031
213200200616      *****************************************************************                       CGL031
213300200616      *                                                                                       CGL031
213400200616     C           SRWACK    BEGSR                                                              CGL031
213500200616      *                                                                                       CGL031
213600200616     C                     CLEARSEKEYDF                                                       CGL031
213700200616      ** .. Account key                                                                       CGL031
213800200616     C                     MOVELWACKEY    ACKY                                                CGL031
213900200616      ** .. Trade Reference                                                                   CGL031
214000200616     C                     Z-ADD*ZERO     TRFR                                                CGL031
214100200616      ** .. Customer Number                                                                   CGL031
214200200616     C**********           Z-ADDMCCNUM    CSTN                                        CGL031 CSD027A
214300200616     C                     MOVE MCCNUM    CSTN                                               CSD027A
214400200616      ** .. Booking branch                                                                    CGL031
214500200616     C                     MOVE MCBRCD    BRHA                                                CGL031
214600200616      ** .. A/C Sequence                                                                      CGL031
214700200616     C                     Z-ADD*ZERO     ASQN                                                CGL031
214800200616      ** .. Event Date                                                                        CGL031
214900200616     C                     Z-ADDMAEVDT    EVDT                                                CGL031
215000200616      ** .. Event Amount                                                                      CGL031
215100200616     C                     Z-ADDWWEVAM    EVAM                                                CGL031
215200200616      ** .. Event Ccy                                                                         CGL031
215300200616     C           MAPTYP    IFNE 'CC'                                                          CGL031
215400200616     C                     MOVE WONMCY    EVCY                                                CGL031
215500200616     C                     ELSE                                                               CGL031
215600200616     C                     MOVE NANCCY    EVCY                                                CGL031
215700200616     C                     ENDIF                                                              CGL031
215800200616      *                                                                                       CGL031
215900200616     C           TSTXCY    IFNE TSOCCY                                                        CGL031
216000200616     C                     MOVE TSTXCY    EVCY                                                CGL031
216100200616     C                     ENDIF                                                              CGL031
216200200616      ** .. Settlement Type                                                                   CGL031
216300200616     C                     Z-ADD*ZERO     STLT                                                CGL031
216400200616      ** .. Settlement Account                                                                CGL031
216500200616     C                     MOVE *BLANKS   STLA                                                CGL031
216600200616      ** .. Settlement Branch                                                                 CGL031
216700200616     C                     MOVE *BLANKS   SEBR                                                CGL031
216800200616      *                                                                                       CGL031
216900200616     C           EXBCSI    IFEQ 'Y'                        Standard Instruction exist         CGL031
217000200616      *                                                                                       CGL031
217100200616      ** .. Settlement Type                                                                   CGL031
217200200616     C                     Z-ADDMOSMET    STLT                                                CGL031
217300200616      ** .. Settlement Account                                                                CGL031
217400200616     C                     MOVE MOSACC    STLA                                                CGL031
217500200616      ** .. Settlement Branch                                                                 CGL031
217600200616     C                     MOVE MOSBRC    SEBR                                                CGL031
217700200616      *                                                                                       CGL031
217800200616     C                     ELSE                                                               CGL031
217900200616      *                                                                                       CGL031
218000200616     C           BGPFMG    IFNE 'Y'                        Portfolio Management OFF           CGL031
218100200616     C           BGN4ST    ANDNE'Y'                                       CPB001              CGL031
218200200616      *                                                                                       CGL031
218300200616      ***  For Settlement Instruction access STDSED with key of                               CGL031
218400200616      ***  Branch and Customer,SECODPPD, Nominal CCY and Investment                           CGL031
218500200616      ***  Type,SECTYD                                                                        CGL031
218600200616      *                                                                                       CGL031
218700200616     C                     MOVE MCBRCD    WKPBCA           Branch                             CGL031
218800200616     C**********           Z-ADDMCCNUM    WKPCPY           Customer                   CGL031 CSD027A
218900200616     C                     MOVE MCCNUM    WKPCPY           Customer                          CSD027A
219000200616     C                     MOVE WONMCY    WKNMCY           Nominal Ccy                        CGL031
219100200616     C                     MOVE WOSITP    WKSITP           Sec. Inv. Type                     CGL031
219200200616     C                     MOVE WOSMCC    WKSMCC                                              CGL031
219300200616      *                                                                                       CGL031
219400200616     C           CSE028    IFEQ 'Y'                                                           CGL031
219500200616     C                     MOVE MCBOOK    WKPBCD           Book Code                          CGL031
219600200616     C                     MOVE MCPTFR    WKPTFR           Portfolio Reference                CGL031
219700200616     C                     ELSE                                                               CGL031
219800200616     C                     MOVE *BLANKS   WKPBCD           Book Code                          CGL031
219900200616     C                     MOVE *BLANKS   WKPTFR           Portfolio Reference                CGL031
220000200616     C                     ENDIF                                                              CGL031
220100200616      *                                                                                       CGL031
220200200616      ** If CSE028 is on, call SESSIR0 for default of MT5xx information                       CGL031
220300200616      *                                                                                       CGL031
220400200616     C           CSE028    IFEQ 'Y'                                                           CGL031
220500200616      *                                                                                       CGL031
220600200616     C                     EXSR SRSSIR                                                        CGL031
220700200616     C           NOTFND    IFEQ 'Y'                                                           CGL031
220800200616     C                     MOVE '1'       *IN89                                               CGL031
220900200616     C                     ELSE                                                               CGL031
221000200616     C                     MOVE '0'       *IN89                                               CGL031
221100200616     C                     ENDIF                                                              CGL031
221200200616      *                                                                                       CGL031
221300200616     C                     ELSE                                                               CGL031
221400200616      *                                                                                       CGL031
221500200616     C           KWSTDS    CHAINSTDSED               89                                       CGL031
221600200616     C           *IN89     IFEQ *ON                                                           CGL031
221700200616     C                     MOVEL*BLANKS   WKSITP                                              CGL031
221800200616     C           KWSTDS    CHAINSTDSED               89                                       CGL031
221900200616     C                     ENDIF                                                              CGL031
222000200616      *                                                                                       CGL031
222100200616     C                     ENDIF                                                              CGL031
222200200616      *                                                                                       CGL031
222300200616     C           *IN89     IFEQ *OFF                                                          CGL031
222400200616      *                                                                                       CGL031
222500200616      * CEU005 active and Settlement Ccy used on STDSED.                                      CGL031
222600200616     C           CEU005    IFEQ 'Y'                                                           CGL031
222700200616     C           SCCY      ANDNE*BLANKS                                                       CGL031
222800200616     C                     MOVE SCCY      SVSCCY  3                                           CGL031
222900200616      *                                                                                       CGL031
223000200616      * Access currencies file for EURO rate, EURO M/D indicator and                          CGL031
223100200616      * Transition Date for 'In' Ccy.                                                         CGL031
223200200616      *                                                                                       CGL031
223300200616     C           WONMCY    IFEQ BKEURO                                                        CGL031
223400200616     C                     CALL 'AOCURRR0'                                                    CGL031
223500200616     C                     PARM           PRTCD   7                                           CGL031
223600200616     C                     PARM '*KEY   ' POPTN   7                                           CGL031
223700200616     C                     PARM SCCY      PCYCD   3                                           CGL031
223800200616     C           SDCURR    PARM SDCURR    DSSDY                                               CGL031
223900200616     C           PRTCD     IFNE *BLANKS                                                       CGL031
224000200616     C           *LOCK     IN   LDA                                                           CGL031
224100200616     C                     Z-ADD110       DBASE                                               CGL031
224200200616     C                     MOVEL'SDCURRPD'DBFILE                                              CGL031
224300200616     C                     MOVELSCCY      DBKEY                                               CGL031
224400200616     C                     OUT  LDA                                                           CGL031
224500200616     C                     EXSR *PSSR                                                         CGL031
224600200616     C                     ENDIF                                                              CGL031
224700200616     C                     ELSE                                                               CGL031
224800200616     C           SCCY      IFEQ BKEURO                                                        CGL031
224900200616     C                     CALL 'AOCURRR0'                                                    CGL031
225000200616     C                     PARM           PRTCD                                               CGL031
225100200616     C                     PARM '*KEY   ' POPTN                                               CGL031
225200200616     C                     PARM WONMCY    PCYCD                                               CGL031
225300200616     C           SDCURR    PARM SDCURR    DSSDY                                               CGL031
225400200616     C           @RTCD     IFNE *BLANKS                                                       CGL031
225500200616     C           *LOCK     IN   LDA                                                           CGL031
225600200616     C                     Z-ADD111       DBASE                                               CGL031
225700200616     C                     MOVEL'SDCURRPD'DBFILE                                              CGL031
225800200616     C                     MOVELWONMCY    DBKEY                                               CGL031
225900200616     C                     OUT  LDA                                                           CGL031
226000200616     C                     EXSR *PSSR                                                         CGL031
226100200616     C                     ENDIF                                                              CGL031
226200200616     C                     ENDIF                                                              CGL031
226300200616     C                     ENDIF                                                              CGL031
226400200616      *                                                                                       CGL031
226500200616     C                     MOVE A6EUMD    SVEUMD                                              CGL031
226600200616     C                     MOVE A6EUER    SVEUER                                              CGL031
226700200616      *                                                                                       CGL031
226800200616      * Value date is later than Transition Start Date.                                       CGL031
226900200616     C           MACOPD    IFGE A6TPSD                                                        CGL031
227000200616      * Chain STDSED again.                                                                   CGL031
227100200616     C                     MOVE SCCY      WKNMCY           Nominal Ccy                        CGL031
227200200616      *                                                                                       CGL031
227300200616      ** If CSE028 is on, call SESSIR0 for default of MT5xx information                       CGL031
227400200616      *                                                                                       CGL031
227500200616     C           CSE028    IFEQ 'Y'                                                           CGL031
227600200616      *                                                                                       CGL031
227700200616     C                     EXSR SRSSIR                                                        CGL031
227800200616     C           NOTFND    IFEQ 'Y'                                                           CGL031
227900200616     C                     MOVE '1'       *IN78                                               CGL031
228000200616     C                     ELSE                                                               CGL031
228100200616     C                     MOVE '0'       *IN78                                               CGL031
228200200616     C                     ENDIF                                                              CGL031
228300200616      *                                                                                       CGL031
228400200616     C                     ELSE                                                               CGL031
228500200616      *                                                                                       CGL031
228600200616     C           KWSTDS    CHAINSTDSED               78                                       CGL031
228700200616      *                                                                                       CGL031
228800200616     C                     ENDIF                                                              CGL031
228900200616      *                                                                                       CGL031
229000200616     C                     ENDIF                                                              CGL031
229100200616     C                     ENDIF                                                              CGL031
229200200616      *                                                                                       CGL031
229300200616      * If no record found ensure fields from last chain not loaded                           CGL031
229400200616      * to output fields.                                                                     CGL031
229500200616     C           *IN78     IFEQ '0'                                                           CGL031
229600200616      ** .. Settlement Type                                                                   CGL031
229700200616     C                     Z-ADDSRSM      STLT                                                CGL031
229800200616      ** .. Settlement Account                                                                CGL031
229900200616     C                     MOVELSRAC      STLA                                                CGL031
230000200616      ** .. Settlement Branch                                                                 CGL031
230100200616     C                     MOVELSRAB      SEBR                                                CGL031
230200200616      *                                                                                       CGL031
230300200616      ***  If SRSM = 04 and SRAC = BLANKS the determine settlement A/C                        CGL031
230400200616      ***     via SR/ZSETAC  and output to field STLA                                         CGL031
230500200616      *                                                                                       CGL031
230600200616     C           SRSM      IFEQ 04                                                            CGL031
230700200616     C           SRAC      ANDEQ*BLANK                                                        CGL031
230800200616      *                                                                                       CGL031
230900200616      ***  Pass Parameters to SR/ZSETAC and execute routine                                   CGL031
231000200616      *                                                                                       CGL031
231100200616     C                     MOVE SRSM      ZMETH                                               CGL031
231200200616     C                     MOVE SRAC      ZSETI                                               CGL031
231300200616     C                     MOVE MCCNUM    ZCNUM                                               CGL031
231400200616     C           CEU005    IFEQ 'Y'                                                           CGL031
231500200616     C           SCCY      ANDNE*BLANKS                                                       CGL031
231600200616     C                     MOVE SCCY      ZCCY                                                CGL031
231700200616     C                     ELSE                                                               CGL031
231800200616     C                     MOVE WONMCY    ZCCY                                                CGL031
231900200616     C                     ENDIF                                                              CGL031
232000200616     C                     MOVE SRAB      ZBRCA                                               CGL031
232100200616     C                     EXSR ZSETAC                                                        CGL031
232200200616     C                     MOVELZSETO     STLA                                                CGL031
232300200616     C                     MOVELZWBRCA    SEBR                                                CGL031
232400200616     C                     ENDIF                                                              CGL031
232500200616     C                     ENDIF                                                              CGL031
232600200616     C                     ENDIF                                                              CGL031
232700200616      *                                                                                       CGL031
232800200616     C                     ELSE                            Portfolio Management ON            CGL031
232900200616     C                     MOVE 'N'       WALCCY  1                                           CGL031
233000200616     C                     EXSR #SETIN                                                        CGL031
233100200616      *                                                                                       CGL031
233200200616      ** If Account found in any of currencies checked                                        CGL031
233300200616     C           WSAME     IFEQ *OFF                                                          CGL031
233400200616      ** .. Settlement Type                                                                   CGL031
233500200616     C                     MOVE '05'      STLT                                                CGL031
233600200616      ** .. Settlement Account                                                                CGL031
233700200616     C                     MOVELPSEA1     STLA                                                CGL031
233800200616      ** .. Settlement Branch                                                                 CGL031
233900200616     C                     MOVE BRCA      SEBR                                                CGL031
234000200616      *                                                                                       CGL031
234100200616     C                     ELSE                                                               CGL031
234200200616      *                                                                                       CGL031
234300200616      ** .. Settlement Type                                                                   CGL031
234400200616     C                     MOVE *BLANKS   STLT                                                CGL031
234500200616      ** .. Settlement Account                                                                CGL031
234600200616     C                     MOVE *BLANKS   STLA                                                CGL031
234700200616      ** .. Settlement Branch                                                                 CGL031
234800200616     C                     MOVE *BLANKS   SEBR                                                CGL031
234900200616     C                     ENDIF                                                              CGL031
235000200616      *                                                                                       CGL031
235100200616     C                     ENDIF                                                              CGL031
235200200616      *                                                                                       CGL031
235300200616     C                     ENDIF                                                              CGL031
235400200616      *                                                                                       CGL031
235500200616      ** .. Reversal indicator                                                                CGL031
235600200616     C           MACHTP    IFEQ 'R'                                                           CGL031
235700200616     C                     MOVE '1'       RVRS                                                CGL031
235800200616     C                     ELSE                                                               CGL031
235900200616     C                     MOVE '0'       RVRS                                                CGL031
236000200616     C                     ENDIF                                                              CGL031
236100200616      ** .. Issuer                                                                            CGL031
236200200616     C**********           Z-ADDWOISSR    ISSR                                        CGL031 CSD027A
236300200616     C                     MOVE WOISSR    ISSR                                               CSD027A
236400200616      ** .. Tour depot customer                                                               CGL031
236500200616     C**********           Z-ADDMCCNUM    KCUST                                       CGL031 CSD027A
236600200616     C                     MOVE MCCNUM    KCUST                                              CSD027A
236700200616      ** .. Nominal Ccy amount                                                                CGL031
236800200616     C                     Z-ADDWWKNCA    KNCA                                                CGL031
236900200616      ** .. Nominal Ccy                                                                       CGL031
237000200616     C           MAPTYP    IFNE 'CC'                                                          CGL031
237100200616     C                     MOVE WONMCY    KCCY                                                CGL031
237200200616     C                     ELSE                                                               CGL031
237300200616     C                     MOVE NANCCY    KCCY                                                CGL031
237400200616     C                     ENDIF                                                              CGL031
237500200616      *                                                                                       CGL031
237600200616     C           TSTXCY    IFNE TSOCCY                                                        CGL031
237700200616     C                     MOVE TSOCCY    KCCY                                                CGL031
237800200616     C                     ENDIF                                                              CGL031
237900200616      ** .. Base Ccy Amount                                                                   CGL031
238000200616      *                    Z-ADDWWKBCA    KBCA                                                CGL031
238100200616      ** .. Security Shortname                                                                CGL031
238200200616     C           MCSESN    IFEQ '**CASH**'                                                    CGL031
238300200616     C                     MOVELMASESN    SESH      P                                         CGL031
238400200616     C                     ELSE                                                               CGL031
238500200616     C                     MOVELMCSESN    SESH      P                                         CGL031
238600200616     C                     ENDIF                                                              CGL031
238700200616      ** .. Profit Centre                                                                     CGL031
238800200616     C                     MOVE *BLANKS   PRFC                                                CGL031
238900200616      *                                                                                       CGL031
239000200616      ***   If Profit Centre used                                                             CGL031
239100200616      *                                                                                       CGL031
239200200616     C           BKPRCU    IFEQ 'Y'                                                           CGL031
239300200616      *                                                                                       CGL031
239400200616     C                     MOVELCSTN      WKPCPY           Customer                           CGL031
239500200616     C                     MOVELBRHA      WKPBCA           Branch                             CGL031
239600200616     C                     MOVELSESH      WKPSSH    P      Security                           CGL031
239700200616      *                                                                                       CGL031
239800200616     C           KWSEPC    CHAINSEPCCDF              89                                       CGL031
239900200616     C           *IN89     IFEQ *OFF                                                          CGL031
240000200616     C                     MOVELPCCU      PRFC                                                CGL031
240100200616     C                     ELSE                                                               CGL031
240200200616     C                     MOVELWOSESN    WKDPSS           Event Security                     CGL031
240300200616     C           KWSEPC    CHAINSEPCCDF              89                                       CGL031
240400200616     C           *IN89     IFEQ *OFF                                                          CGL031
240500200616     C                     MOVELPCCU      PRFC                                                CGL031
240600200616     C                     ENDIF                                                              CGL031
240700200616     C                     ENDIF                                                              CGL031
240800200616     C                     ENDIF                                                              CGL031
240900200616      *                                                                                       CGL031
241000200616      ***  Analytical Accounting module is ON and Profit Centre is ON                         CGL031
241100200616      *                                                                                       CGL031
241200200616     C           BGN0ST    IFEQ 'Y'                                                           CGL031
241300200616     C           PRFC      ANDEQ*BLANKS                                                       CGL031
241400200616     C                     MOVE BVSEPC    PRFC                                                CGL031
241500200616     C                     ENDIF                                                              CGL031
241600200616      ** .. Portfolio Reference                                                               CGL031
241700200616     C                     MOVE MCPTFR    PTFR                                                CGL031
241800200616      ** .. Trans. Type                                                                       CGL031
241900200616     C                     MOVE *BLANKS   PEV1                                                CGL031
242000200616      ** .. Transaction number of last update                                                 CGL031
242100200616     C                     Z-ADD*ZERO     TNLU                                                CGL031
242200200616      ** .. Record ID                                                                         CGL031
242300200616     C                     MOVE 'D'       RECI                                                CGL031
242400200616      *                                                                                       CGL031
242500200616      ***  Write account key record                                                           CGL031
242600200616      *                                                                                       CGL031
242700200616     C                     WRITESEKEYDF                                                       CGL031
242800200616      *                                                                                       CGL031
242900200616      ***  Count Records Written                                                              CGL031
243000200616      *                                                                                       CGL031
243100200616     C                     ADD  1         W01CNT                                              CGL031
243200200616     C                     MOVE 'Y'       WWDATA           one Read                           CGL031
243300200616      *                                                                                       CGL031
243400200616     C                     ENDSR                                                              CGL031
243500200616      *                                                                                       CGL031
243600200616      *****************************************************************                       CGL031
243700200616      /EJECT                                                                                  CGL031
243800200616      *****************************************************************
243900200616      *  #SELLF -  Select Logical file from the processing type       *
244000200616      *  ------                                                       *
244100200616      *  Called by : #PDPRD                                           *
244200200616      *  Calls     : *PSSR                                            *
244300200616      *****************************************************************
244400200616      *
244500200616     C           #SELLF    BEGSR
244600200616      *
244700200616     C           WWDPCU    IFEQ 'C'
244800200616     C                     MOVE MCCORF    WKCOR2
244900200616     C                     MOVE MCOPTN    WKOPT2
245000200616     C                     ELSE
245100200616     C                     MOVE MBCORF    WKCOR2
245200200616     C                     MOVE MBOPTN    WKOPT2
245300200616     C                     ENDIF
245400200616      *
245500200616     C                     SELEC
245600200616      *
245700200616      ***  Processing type 'DV'
245800200616      ***  Access to CO Dividends Events file
245900200616      *
246000200616     C           MAPTYP    WHEQ 'DV'
246100200616     C           KWCOOP    CHAINSECODVL0             47
246200200616     C                     MOVE MDRECI    WWRECI  1
246300200616     C                     MOVEL'SECODVL0'WWFILE 10
246400200616      *
246500200616      ***  Processing type 'RG'
246600200616      ***  Access to CO
246700200616      *
246800200616     C           MAPTYP    WHEQ 'RG'
246900200616     C           KWCOOP    CHAINSECORGL0             47
247000200616     C                     MOVE MFRECI    WWRECI  1
247100200616     C                     MOVEL'SECORGL0'WWFILE 10
247200200616      *
247300200616      ***  Processing type 'OF'
247400200616      ***  Access to CO
247500200616      *
247600200616     C           MAPTYP    WHEQ 'OF'
247700200616     C           KWCOOP    CHAINSECOOFL0             47
247800200616     C                     MOVE MIRECI    WWRECI  1
247900200616     C                     MOVEL'SECOOFL0'WWFILE 10
248000200616      *                                                                   CEU017
248100200616      ***  Processing type 'CC'                                           CEU017
248200200616      ***  Access to CO                                                   CEU017
248300200616      *                                                                   CEU017
248400200616     C           MAPTYP    WHEQ 'CC'                                      CEU017
248500200616     C           WKCOR2    CHAINSECOCCL0             47                   CEU017
248600200616     C                     MOVE NARECI    WWRECI  1                       CEU017
248700200616     C                     MOVEL'SECOCCL0'WWFILE 10                       CEU017
248800200616     C                     ENDSL
248900200616      *
249000200616     C           *IN47     IFEQ *ON
249100200616     C           WWRECI    OREQ '*'
249200200616     C           *LOCK     IN   LDA
249300200616     C                     Z-ADD2         DBASE            *****************
249400200616     C                     MOVEL*BLANKS   DBFILE           ** DB ERROR 02 **
249500200616     C                     MOVELWWFILE    DBFILE    P      *****************
249600200616     C           MAPTYP    IFNE 'CC'                                      CEU017
249700200616     C                     MOVELWWCOOP    DBKEY     P
249800200616     C                     ELSE                                           CEU017
249900200616     C                     MOVELWKCOR2    DBKEY     P                     CEU017
250000200616     C                     ENDIF                                          CEU017
250100200616     C                     MOVEL'SE7561'  DBPGM     P
250200200616     C                     OUT  LDA
250300200616     C                     EXSR *PSSR
250400200616     C                     ENDIF
250500200616      *
250600200616     C                     ENDSR
250700200616      *
250800200616      *****************************************************************
250900200616      /EJECT
251000200616      *****************************************************************
251100200616      *  #PRDV -  Generate Position Settlement                        *
251200200616      *  -----    for processing type 'DV'                            *
251300200616      *  Called by : #PDPRD                                           *
251400200616      *  Calls     : #WPOSS                                           *
251500200616      *****************************************************************
251600200616      *
251700200616     C           #PRDV     BEGSR
251800200616      *
251900200616      ***  Check Depot/Customer indicator
252000200616      *
252100200616     C                     SELEC
252200200616      *
252300200616      ***  If Depot/Customer indicator is 'D'
252400200616      ***  Generate a Position Settlement for the depot
252500200616      *
252600200616     C           WWDPCU    WHEQ 'D'
252700200616      *
252800200616      ***  Setup specific field for this processing type
252900200616      *
253000200616     C*****                MOVE 'R'       WWPPRE           Receive        153674
253100200616     C                     Z-ADDMBEXPO    WWEXPO           Ex-Date Position
253200200616      *
253300200616      ***  Total Cash = Actual Cash Allocation + Cash Rounding
253400200616      *
253500200616     C                     Z-ADDMBACAA    WWPAMD 170
253600200616     C                     ADD  MBACAR    WWPAMD           Total Cash
253700200616     C                     Z-ADDMBACAA    WWACAA           Actual Cash Allocation
253800200616     C                     Z-ADDMBACAR    WWACAR           Cash Rounding
253900200616      *                                                                   153674
254000200616     C           WWPAMD    IFGE *ZERO                                     153674
254100200616     C                     MOVE 'R'       WWPPRE           Receive        153674
254200200616     C                     ELSE                                           153674
254300200616     C                     Z-SUBWWPAMD    WWPAMD                          153674
254400200616     C                     MOVE 'P'       WWPPRE           Pay            153674
254500200616     C                     ENDIF                                          153674
254600200616      *
254700200616     C                     EXSR #WPOSS
254800200616      *
254900200616     C           WWDPCU    WHEQ 'C'
255000200616      *
255100200616      ***  If Depot/Customer indicator 'C'
255200200616      ***  Generate a Position Settlement for the customer
255300200616      *
255400200616      ***  Setup specific field for this processing type
255500200616      *
255600200616     C*****                MOVE 'R'       WWPPRE           Receive        153674
255700200616     C                     Z-ADDMCEXPO    WWEXPO           Ex-Date Position
255800200616      *
255900200616      ***  Total Cash = Actual Cash Allocation + Cash Rounding
256000200616      *
256100200616     C                     Z-ADDMCACAA    WWPAMD
256200200616     C                     ADD  MCACAR    WWPAMD           Total Cash
256300200616     C                     Z-ADDMCACAA    WWACAA           Actual Cash Allocation
256400200616     C                     Z-ADDMCACAR    WWACAR           Cash Rounding
256500200616      *                                                                   153674
256600200616     C           WWPAMD    IFGE *ZERO                                     153674
256700200616     C                     MOVE 'P'       WWPPRE           Pay            153674
256800200616     C                     ELSE                                           153674
256900200616     C                     Z-SUBWWPAMD    WWPAMD                          153674
257000200616     C                     MOVE 'R'       WWPPRE           Receive        153674
257100200616     C                     ENDIF                                          153674
257200200616      *
257300200616     C                     EXSR #WPOSS
257400200616     C                     ENDSL                           Check Depot/Customer ind.
257500200616      *
257600200616     C                     ENDSR
257700200616      *
257800200616      *****************************************************************
257900200616      /EJECT
258000200616      *****************************************************************
258100200616      *  #PRFR -  Generate Position Settlement                        *
258200200616      *  -----    for processing type 'FR' or 'RG' (Average Price 'Z')*
258300200616      *  Called by : #PDPRD                                           *
258400200616      *  Calls     : #WPOSS                                           *
258500200616      *****************************************************************
258600200616      *
258700200616     C           #PRFR     BEGSR
258800200616      *
258900200616      ***  Check Depot/Customer indicator
259000200616      *
259100200616     C                     SELEC
259200200616      *
259300200616      ***  If Depot/Customer indicator is 'D'
259400200616      ***  Generate a Position Settlement for the depot
259500200616      *
259600200616     C           WWDPCU    WHEQ 'D'
259700200616      *
259800200616      ***  Setup specific field for this processing type
259900200616      *
260000200616     C                     Z-ADDMBEXPO    WWEXPO           Ex-Date Position
260100200616      *
260200200616      ***  Total Cash = Actual Cash Allocation + Cash Rounding
260300200616      *
260400200616     C                     Z-ADDMBACAA    WWPAMD
260500200616     C                     ADD  MBACAR    WWPAMD           Total Cash
260600200616     C                     Z-ADDMBACAA    WWACAA           Actual Cash Allocation
260700200616     C                     Z-ADDMBACAR    WWACAR           Cash Rounding
260800200616      *
260900200616     C           WWPAMD    IFGE *ZERO
261000200616     C                     MOVE 'R'       WWPPRE           Receive
261100200616     C                     ELSE
261200200616     C                     Z-SUBWWPAMD    WWPAMD                          153674
261300200616     C                     MOVE 'P'       WWPPRE           Pay
261400200616     C                     ENDIF
261500200616      *
261600200616     C                     EXSR #WPOSS
261700200616      *
261800200616     C           WWDPCU    WHEQ 'C'
261900200616      *
262000200616      ***  If Depot/Customer indicator 'C'
262100200616      ***  Generate a Position Settlement for the customer
262200200616      *
262300200616      ***  Setup specific field for this processing type
262400200616      *
262500200616     C                     Z-ADDMCEXPO    WWEXPO           Ex-Date Position
262600200616     C                     Z-ADDMCACAA    WWACAA           Actual Cash Allocation
262700200616     C                     Z-ADDMCACAR    WWACAR           Cash Rounding
262800200616      *
262900200616      ***  Total Cash = Actual Cash Allocation + Cash Rounding
263000200616      *
263100200616     C                     Z-ADDMCACAA    WWPAMD
263200200616     C                     ADD  MCACAR    WWPAMD           Total Cash
263300200616      *
263400200616     C           WWPAMD    IFGE *ZERO
263500200616     C*****                MOVE 'R'       WWPPRE           Receive        153674
263600200616     C                     MOVE 'P'       WWPPRE           Pay            153674
263700200616     C                     ELSE
263800200616     C                     Z-SUBWWPAMD    WWPAMD                          153674
263900200616     C*****                MOVE 'P'       WWPPRE           Pay            153674
264000200616     C                     MOVE 'R'       WWPPRE           Receive        153674
264100200616     C                     ENDIF
264200200616      *
264300200616     C                     EXSR #WPOSS
264400200616     C                     ENDSL                           Check Depot/Customer ind.
264500200616      *
264600200616     C                     ENDSR
264700200616      *
264800200616      *****************************************************************
264900200616      /EJECT
265000200616      *****************************************************************
265100200616      *  #PRCR -  Generate Position Settlement                        *
265200200616      *  -----    for processing type 'CR' or 'RG' (Average Price M,C)*
265300200616      *        or for processing type 'CE' or 'OF' (Exchange Offers)  *
265400200616      *  Called by : #PDPRD                                           *
265500200616      *  Calls     : #WPOSS                                           *
265600200616      *****************************************************************
265700200616      *
265800200616     C           #PRCR     BEGSR
265900200616      *
266000200616      ***  Check Depot/Customer indicator
266100200616      *
266200200616     C                     SELEC
266300200616      *
266400200616      ***  If Depot/Customer indicator is 'D'
266500200616      ***  Generate a Position Settlement for the depot
266600200616      *
266700200616     C           WWDPCU    WHEQ 'D'
266800200616      *
266900200616      ***  Setup specific field for this processing type
267000200616      *
267100200616     C*****                MOVE 'R'       WWPPRE           Receive        153674
267200200616     C                     Z-ADDMBEXPO    WWEXPO           Ex-Date Position
267300200616     C                     Z-ADDMBACAA    WWACAA           Actual Cash Allocation
267400200616     C                     Z-ADDMBACAR    WWACAR           Cash Rounding
267500200616      *
267600200616      ***  Total Cash = Actual Cash Allocation + Cash Rounding
267700200616      *
267800200616     C                     Z-ADDMBACAA    WWPAMD
267900200616     C                     ADD  MBACAR    WWPAMD           Total Cash
268000200616      *                                                                   153674
268100200616     C           WWPAMD    IFGE *ZERO                                     153674
268200200616     C                     MOVE 'R'       WWPPRE           Receive        153674
268300200616     C                     ELSE                                           153674
268400200616     C                     Z-SUBWWPAMD    WWPAMD                          153674
268500200616     C                     MOVE 'P'       WWPPRE           Pay            153674
268600200616     C                     ENDIF                                          153674
268700200616      *
268800200616     C                     EXSR #WPOSS
268900200616      *
269000200616     C           WWDPCU    WHEQ 'C'
269100200616      *
269200200616      ***  If Depot/Customer indicator 'C'
269300200616      ***  Generate a Position Settlement for the customer
269400200616      *
269500200616      ***  Setup specific field for this processing type
269600200616      *
269700200616     C*****                MOVE 'R'       WWPPRE           Receive        151658
269800200616     C*****                MOVE 'P'       WWPPRE           Pay     151658 153674
269900200616     C                     Z-ADDMCEXPO    WWEXPO           Ex-Date Position
270000200616     C                     Z-ADDMCACAA    WWACAA           Actual Cash Allocation
270100200616     C                     Z-ADDMCACAR    WWACAR           Cash Rounding
270200200616      *
270300200616      ***  Total Cash = Actual Cash Allocation + Cash Rounding
270400200616      *
270500200616     C                     Z-ADDMCACAA    WWPAMD
270600200616     C                     ADD  MCACAR    WWPAMD           Total Cash
270700200616      *                                                                   153674
270800200616     C           WWPAMD    IFGE *ZERO                                     153674
270900200616     C                     MOVE 'P'       WWPPRE           Pay            153674
271000200616     C                     ELSE                                           153674
271100200616     C                     Z-SUBWWPAMD    WWPAMD                          153674
271200200616     C                     MOVE 'R'       WWPPRE           Receive        153674
271300200616     C                     ENDIF                                          153674
271400200616      *
271500200616     C                     EXSR #WPOSS
271600200616     C                     ENDSL                           Check Depot/Customer ind.
271700200616      *
271800200616     C                     ENDSR
271900200616      *
272000200616      *****************************************************************
272100200616      /EJECT
272200200616      *****************************************************************
272300200616      *  #PROF -  Generate Position Settlement                        *
272400200616      *  -----    for processing type 'OF' (Purchase Offers)          *
272500200616      *        or for processing type 'OF' (Subscription Offers)      *
272600200616      *  Called by : #PDPRD                                           *
272700200616      *  Calls     : #WPOSS                                           *
272800200616      *****************************************************************
272900200616      *
273000200616     C           #PROF     BEGSR
273100200616      *
273200200616      ***  Check Depot/Customer indicator
273300200616      *
273400200616     C                     SELEC
273500200616      *
273600200616      ***  If Depot/Customer indicator is 'D'
273700200616      ***  Generate a Position Settlement for the depot
273800200616      *
273900200616     C           WWDPCU    WHEQ 'D'
274000200616      *
274100200616      ***  Setup specific field for this processing type
274200200616      *
274300200616     C*****                MOVE 'R'       WWPPRE           Receive        153674
274400200616     C                     Z-ADDMBEXPO    WWEXPO           Ex-Date Position
274500200616     C                     Z-ADDMBACAA    WWACAA           Actual Cash Allocation
274600200616     C                     Z-ADDMBACAR    WWACAR           Cash Rounding
274700200616      *
274800200616      ***  Total Cash = Actual Cash Allocation + Cash Rounding
274900200616      *
275000200616     C                     Z-ADDMBACAA    WWPAMD
275100200616     C                     ADD  MBACAR    WWPAMD           Total Cash
275200200616      *                                                                   153674
275300200616     C           MIOFTY    IFEQ 'P'                                       153674
275400200616     C           MIOFTY    OREQ 'E'                                       153674
275500200616      *                                                                   153674
275600200616     C           WWPAMD    IFGE *ZERO                                     153674
275700200616     C                     MOVE 'R'       WWPPRE           Receive        153674
275800200616     C                     ELSE                                           153674
275900200616     C                     Z-SUBWWPAMD    WWPAMD                          153674
276000200616     C                     MOVE 'P'       WWPPRE           Pay            153674
276100200616     C                     ENDIF                                          153674
276200200616      *                                                                   153674
276300200616     C                     ELSE                                           153674
276400200616      *                                                                   153674
276500200616     C           WWPAMD    IFGE *ZERO                                     153674
276600200616     C                     MOVE 'P'       WWPPRE           Pay            153674
276700200616     C                     ELSE                                           153674
276800200616     C                     Z-SUBWWPAMD    WWPAMD                          153674
276900200616     C                     MOVE 'R'       WWPPRE           Receive        153674
277000200616     C                     ENDIF                                          153674
277100200616      *                                                                   153674
277200200616     C                     ENDIF                                          153674
277300200616      *
277400200616     C                     EXSR #WPOSS
277500200616      *
277600200616     C           WWDPCU    WHEQ 'C'
277700200616      *
277800200616      ***  If Depot/Customer indicator 'C'
277900200616      ***  Generate a Position Settlement for the customer
278000200616      *
278100200616      ***  Setup specific field for this processing type
278200200616      *
278300200616     C                     Z-ADDMCEXPO    WWEXPO           Ex-Date Position
278400200616     C                     Z-ADDMCACAA    WWACAA           Actual Cash Allocation
278500200616     C                     Z-ADDMCACAR    WWACAR           Cash Rounding
278600200616      *
278700200616      ***  Total Cash = Actual Cash Allocation + Cash Rounding
278800200616      *
278900200616     C                     Z-ADDMCACAA    WWPAMD
279000200616     C                     ADD  MCACAR    WWPAMD           Total Cash
279100200616      *
279200200616     C           MIOFTY    IFEQ 'P'
279300200616     C           MIOFTY    OREQ 'E'                                       153674
279400200616      *
279500200616     C           WWPAMD    IFGE *ZERO
279600200616     C                     MOVE 'P'       WWPPRE           Pay
279700200616     C                     ELSE
279800200616     C                     MOVE 'R'       WWPPRE           Receive
279900200616     C                     Z-SUBWWPAMD    WWPAMD                          153674
280000200616     C                     ENDIF
280100200616      *
280200200616     C                     ELSE
280300200616      *
280400200616     C           WWPAMD    IFGE *ZERO
280500200616     C*****                MOVE 'R'       WWPPRE           Pay            153674
280600200616     C                     MOVE 'R'       WWPPRE           Receive        153674
280700200616     C                     ELSE
280800200616     C*****                MOVE 'P'       WWPPRE           Receive        153674
280900200616     C                     MOVE 'P'       WWPPRE           Pay            153674
281000200616     C                     Z-SUBWWPAMD    WWPAMD                          153674
281100200616     C                     ENDIF
281200200616      *
281300200616     C                     ENDIF
281400200616      *
281500200616     C                     EXSR #WPOSS
281600200616     C                     ENDSL                           Check Depot/Customer ind.
281700200616      *
281800200616     C                     ENDSR
281900200616      *
282000200616      *****************************************************************
282100200616      /EJECT
282200200616      *****************************************************************
282300200616      *  #PREX -  Generate Position Settlement                        *
282400200616      *  -----    for processing type 'EX'                            *
282500200616      *  Called by : #PDPRD                                           *
282600200616      *  Calls     : #WPOSS                                           *
282700200616      *****************************************************************
282800200616      *
282900200616     C           #PREX     BEGSR
283000200616      *
283100200616      ***  Check Depot/Customer indicator
283200200616      *
283300200616     C                     SELEC
283400200616      *
283500200616      ***  If Depot/Customer indicator is 'D'
283600200616      ***  Generate a Position Settlement for the depot
283700200616      *
283800200616     C           WWDPCU    WHEQ 'D'
283900200616      *
284000200616      ***  Setup specific field for this processing type
284100200616      *
284200200616     C*****                MOVE 'P'       WWPPRE           Pay            153674
284300200616     C                     Z-ADDMBEXPO    WWEXPO           Ex-Date Position
284400200616     C                     Z-ADDMBACAA    WWACAA           Actual Cash Allocation
284500200616     C                     Z-ADDMBACAR    WWACAR           Cash Rounding
284600200616      *
284700200616      ***  Total Cash = Actual Cash Allocation + Cash Rounding
284800200616      *
284900200616     C                     Z-ADDMBACAA    WWPAMD
285000200616     C                     ADD  MBACAR    WWPAMD           Total Cash
285100200616      *                                                                   153674
285200200616     C           WWPAMD    IFGE *ZERO                                     153674
285300200616     C                     MOVE 'P'       WWPPRE           Pay            153674
285400200616     C                     ELSE                                           153674
285500200616     C                     MOVE 'R'       WWPPRE           Receive        153674
285600200616     C                     Z-SUBWWPAMD    WWPAMD                          153674
285700200616     C                     ENDIF                                          153674
285800200616      *
285900200616     C                     EXSR #WPOSS
286000200616      *
286100200616     C           WWDPCU    WHEQ 'C'
286200200616      *
286300200616      ***  If Depot/Customer indicator 'C'
286400200616      ***  Generate a Position Settlement for the customer
286500200616      *
286600200616      ***  Setup specific field for this processing type
286700200616      *
286800200616     C*****                MOVE 'P'       WWPPRE           Pay            153674
286900200616     C                     Z-ADDMCEXPO    WWEXPO           Ex-Date Position
287000200616     C                     Z-ADDMCACAA    WWACAA           Actual Cash Allocation
287100200616     C                     Z-ADDMCACAR    WWACAR           Cash Rounding
287200200616      *
287300200616      ***  Total Cash = Actual Cash Allocation + Cash Rounding
287400200616      *
287500200616     C                     Z-ADDMCACAA    WWPAMD
287600200616     C                     ADD  MCACAR    WWPAMD           Total Cash
287700200616      *                                                                   153674
287800200616     C           WWPAMD    IFGE *ZERO                                     153674
287900200616     C                     MOVE 'R'       WWPPRE           Receive        153674
288000200616     C                     ELSE                                           153674
288100200616     C                     Z-SUBWWPAMD    WWPAMD                          153674
288200200616     C                     MOVE 'P'       WWPPRE           Pay            153674
288300200616     C                     ENDIF                                          153674
288400200616      *
288500200616     C                     EXSR #WPOSS
288600200616     C                     ENDSL                           Check Depot/Customer ind.
288700200616      *
288800200616     C                     ENDSR
288900200616      *
289000200616      *****************************************************************
289100200616      /EJECT
289200200616      *****************************************************************
289300200616      *  #PRNF -  Generate Position Settlement                        *
289400200616      *  -----    for processing type 'NF'                            *
289500200616      *  Called by : #PDPRD                                           *
289600200616      *  Calls     : #WPOSS                                           *
289700200616      *****************************************************************
289800200616      *
289900200616     C           #PRNF     BEGSR
290000200616      *
290100200616      ***  Check Depot/Customer indicator
290200200616      *
290300200616     C                     SELEC
290400200616      *
290500200616     C           WWDPCU    WHEQ 'C'
290600200616      *
290700200616      ***  If Depot/Customer indicator 'C'
290800200616      ***  Generate a Position Settlement for the customer
290900200616      *
291000200616      ***  Setup specific field for this processing type
291100200616      *
291200200616     C                     MOVE 'P'       WWPPRE           Pay
291300200616     C                     Z-ADDMCEXPO    WWEXPO           Ex-Date Position
291400200616     C                     Z-ADD*ZERO     WWPAMD           PAMD=*zero
291500200616      *
291600200616     C                     EXSR #WPOSS
291700200616     C                     ENDSL                           Check Depot/Customer ind.
291800200616      *
291900200616     C                     ENDSR
292000200616      *
292100200616      *****************************************************************
292200200616      /EJECT
292300200616      *****************************************************************
292400200616      *  #WPOSS - Write a Position Settlement                         *
292500200616      *  ------                                                       *
292600200616      *  Called by : #PRDV #PRFR #PRCR #PROF #PREX #PRNF              *
292700200616      *  Calls     : ZSETAC #AOSEC CALAM2 CALCTX *PSSR ZTNLU1         *
292800200616      *****************************************************************
292900200616      *
293000200616     C           #WPOSS    BEGSR
293100200616      *
293200200616     C                     CLEARPOSETDF
293300200616      *
293400200616      ***  Check Depot/Customer indicator
293500200616      *
293600200616     C                     SELEC
293700200616      *
293800200616      ***  If Depot/Customer indicator is 'D'
293900200616      ***  Generate a Position Settlement for the depot
294000200616      *
294100200616     C           WWDPCU    WHEQ 'D'
294200200616      *
294300200616      ** .. Booking branch
294400200616     C                     MOVE MBBRCD    PBCA
294500200616      ** .. Counterparty
294600200616     C                     MOVELMBDDPT    PCPY
294700200616      ** .. Counterparty type                                             CSE023
294800200616     C                     MOVE 'D'       CTYP                            CSE023
294900200616      ** .. Event Type
295000200616     C                     MOVE MBCOAT    PEVT
295100200616      ** .. Nominal Position
295200200616     C                     Z-ADDMBEXPO    PNMP
295300200616      ** .. Book Code
295400200616     C                     MOVELBVDMBC    PBCD
295500200616      *
295600200616      ***  If Depot/Customer indicator is 'C'
295700200616      ***  Generate a Position Settlement for the customer
295800200616      *
295900200616     C           WWDPCU    WHEQ 'C'
296000200616      *
296100200616      ** .. Booking branch
296200200616     C                     MOVE MCBRCD    PBCA
296300200616      ** .. Counterparty
296400200616     C                     MOVELMCCNUM    PCPY
296500200616      ** .. Counterparty type                                             CSE023
296600200616     C                     MOVE 'C'       CTYP                            CSE023
296700200616      ** .. Event Type
296800200616     C                     MOVE MCCOAT    PEVT
296900200616      ** .. Nominal Position
297000200616     C                     Z-ADDMCEXPO    PNMP
297100200616      ** .. Book Code
297200200616     C                     MOVELBVDMBC    PBCD
297300200616     C                     ENDSL
297400200616      *
297500200616     C                     MOVE WONMCY    WKNMCY
297600200616     C                     MOVE WOSITP    WKSITP
297700200616      ***  Retrieve the processing type
297800200616     C           KWINV     CHAININVTP                89
297900200616     C           *IN89     IFEQ *ON
298000200616     C           RECI      OREQ '*'
298100200616     C           *LOCK     IN   LDA
298200200616     C                     Z-ADD3         DBASE            *****************
298300200616     C                     MOVEL*BLANKS   DBFILE           ** DB ERROR 03 **
298400200616     C                     MOVE 'INVTP   'DBFILE           *****************
298500200616     C                     MOVELWWINV     DBKEY     P
298600200616     C                     MOVEL'SE7561'  DBPGM     P
298700200616     C                     OUT  LDA
298800200616     C                     EXSR *PSSR
298900200616     C                     ENDIF
299000200616      *
299100200616      ** .. Security short name
299200200616     C                     MOVELMASESN    PSSH      P
299300200616      ** .. Market
299400200616     C                     MOVELWOMKTI    PMAR
299500200616      ** .. Due Date
299600200616     C                     Z-ADDMACOPD    PDUD
299700200616      ** .. Value Currency
299800200616     C           MAPTYP    IFNE 'CC'                                      CEU017
299900200616     C                     MOVE WONMCY    PNCY
300000200616     C                     ELSE                                           CEU017
300100200616     C                     MOVE NANCCY    PNCY                            CEU017
300200200616     C                     ENDIF                                          CEU017
300300200616      ** .. Amount Due
300400200616     C                     Z-ADDWWPAMD    PAMD
300500200616      ** .. Pay/Receive Indicator
300600200616     C                     MOVE WWPPRE    PPRE
300700200616      *
300800200616      ** .. Settlement Method
300900200616     C                     Z-ADD0         PSMT
301000200616      ** .. Settlement Account
301100200616     C                     MOVEL*BLANKS   PSEA
301200200616      ** .. Settlement Branch
301300200616     C                     MOVEL*BLANKS   PSEB
301400200616      *
301500200616     C           EXBCSI    IFEQ 'Y'
301600200616      ** .. Settlement Currency
301700200616     C                     MOVE MOSCCY    PSCU
301800200616      ** .. Settlement Method
301900200616     C                     Z-ADDMOSMET    PSMT
302000200616      ** .. Settlement Account
302100200616     C                     MOVELMOSACC    PSEA
302200200616      ** .. Settlement Branch
302300200616     C                     MOVELMOSBRC    PSEB
302400200616      *
302500200616     C                     ELSE
302600200616      *
302700200616     C           BGPFMG    IFNE 'Y'                        Portfolio Management OFF
302800200616     C           BGN4ST    ANDNE'Y'                                       CPB001
302900200616     C           BGPFMG    OREQ 'Y'
303000200616     C           WWDPCU    ANDEQ'D'
303100200616     C           BGN4ST    OREQ 'Y'                                       CPB001
303200200616     C           WWDPCU    ANDEQ'D'                                       CPB001
303300200616      *
303400200616      ***  For Settlement Instruction access STDSED with key of
303500200616      ***  Branch and Customer,SECODPPD, Nominal CCY and Investment
303600200616      ***  Type,SECTYD
303700200616      *
303800200616     C                     MOVE PBCA      WKPBCA           Branch
303900200616     C**********           Z-ADDPCPY      WKPCPY           Customer                           CSD027
304000200616     C                     MOVE PCPY      WKPCPY           Customer                           CSD027
304100200616     C                     MOVE WONMCY    WKNMCY           Nominal Ccy
304200200616     C                     MOVE WOSITP    WKSITP           Sec. Inv. Type
304300200616     C                     MOVE WOSMCC    WKSMCC                                              CSE034
304400200616      *                                                                                       CSE028
304500200616     C           CSE028    IFEQ 'Y'                                                           CSE028
304600200616     C                     MOVE PBCD      WKPBCD           Book Code                          CSE028
304700200616     C                     MOVE *BLANKS   WKPTFR           Portfolio Reference                CSE028
304800200616     C                     ELSE                                                               CSE028
304900200616     C                     MOVE *BLANKS   WKPBCD           Book Code                          CSE028
305000200616     C                     MOVE *BLANKS   WKPTFR           Portfolio Reference                CSE028
305100200616     C                     ENDIF                                                              CSE028
305200200616      *                                                                                       CSE028
305300200616      ** If CSE028 is on, call SESSIR0 for default of MT5xx information                       CSE028
305400200616      *                                                                                       CSE028
305500200616     C           CSE028    IFEQ 'Y'                                                           CSE028
305600200616      *                                                                                       CSE028
305700200616     C                     EXSR SRSSIR                                                        CSE028
305800200616     C           NOTFND    IFEQ 'Y'                                                           CSE028
305900200616     C                     MOVE '1'       *IN89                                               CSE028
306000200616     C                     ELSE                                                               CSE028
306100200616     C                     MOVE '0'       *IN89                                               CSE028
306200200616     C                     ENDIF                                                              CSE028
306300200616      *                                                                                       CSE028
306400200616     C                     ELSE                                                               CSE028
306500200616      *                                                                                       CSE028
306600200616     C           KWSTDS    CHAINSTDSED               89
306700200616     C           *IN89     IFEQ *ON
306800200616     C                     MOVEL*BLANKS   WKSITP
306900200616     C           KWSTDS    CHAINSTDSED               89
307000200616     C                     ENDIF
307100200616      *                                                                                       CSE028
307200200616     C                     ENDIF                                                              CSE028
307300200616      *                                                                                       CSE028
307400200616     C/COPY WNCPYSRC,SE7561C005
307500200616     C           *IN89     IFEQ *OFF
307600200616      *                                                                   135691
307700200616      * CEU005 active and Settlement Ccy used on STDSED.                  135691
307800200616     C           CEU005    IFEQ 'Y'                                       135691
307900200616     C           SCCY      ANDNE*BLANKS                                   135691
308000200616     C                     MOVE SCCY      SVSCCY  3                       135691
308100200616      *                                                                   135691
308200200616      * Access currencies file for EURO rate, EURO M/D indicator and      135691
308300200616      * Transition Date for 'In' Ccy.                                     135691
308400200616      *                                                                   135691
308500200616     C           WONMCY    IFEQ BKEURO                                    135691
308600200616     C                     CALL 'AOCURRR0'                                135691
308700200616     C                     PARM           @RTCD   7                       135691
308800200616     C                     PARM '*KEY   ' @OPTN   7                       135691
308900200616     C                     PARM SCCY      @AJCD   3                       135691
309000200616     C           SDCURR    PARM SDCURR    DSSDY                           135691
309100200616     C           @RTCD     IFNE *BLANKS                                   135691
309200200616     C                     Z-ADD44        DBASE             ************  135691
309300200616     C                     MOVEL'SDCURRPD'DBFILE            * DATABASE *  135691
309400200616     C                     MOVELSCCY      DBKEY             * ERROR 44 *  135691
309500200616     C                     EXSR *PSSR                       ************  135691
309600200616     C                     ENDIF                                          135691
309700200616     C                     ELSE                                           135691
309800200616     C           SCCY      IFEQ BKEURO                                    135691
309900200616     C                     CALL 'AOCURRR0'                                135691
310000200616     C                     PARM           @RTCD   7                       135691
310100200616     C                     PARM '*KEY   ' @OPTN   7                       135691
310200200616     C                     PARM WONMCY    @AJCD   3                       135691
310300200616     C           SDCURR    PARM SDCURR    DSSDY                           135691
310400200616     C           @RTCD     IFNE *BLANKS                                   135691
310500200616     C                     Z-ADD45        DBASE             ************  135691
310600200616     C                     MOVEL'SDCURRPD'DBFILE            * DATABASE *  135691
310700200616     C                     MOVELWONMCY    DBKEY             * ERROR 45 *  135691
310800200616     C                     EXSR *PSSR                       ************  135691
310900200616     C                     ENDIF                                          135691
311000200616     C                     ENDIF                                          135691
311100200616     C                     ENDIF                                          135691
311200200616      *                                                                   135691
311300200616     C                     MOVE A6EUMD    SVEUMD                          135691
311400200616     C                     MOVE A6EUER    SVEUER                          135691
311500200616      *                                                                   135691
311600200616      * Value date is later than Transition Start Date.                   135691
311700200616     C           MACOPD    IFGE A6TPSD                                    135691
311800200616      * Chain STDSED again.                                               135691
311900200616     C                     MOVE SCCY      WKNMCY           Nominal Ccy    135691
312000200616      *                                                                                       CSE028
312100200616      ** If CSE028 is on, call SESSIR0 for default of MT5xx information                       CSE028
312200200616      *                                                                                       CSE028
312300200616     C           CSE028    IFEQ 'Y'                                                           CSE028
312400200616      *                                                                                       CSE028
312500200616     C                     EXSR SRSSIR                                                        CSE028
312600200616     C           NOTFND    IFEQ 'Y'                                                           CSE028
312700200616     C                     MOVE '1'       *IN78                                               CSE028
312800200616     C                     ELSE                                                               CSE028
312900200616     C                     MOVE '0'       *IN78                                               CSE028
313000200616     C                     ENDIF                                                              CSE028
313100200616      *                                                                                       CSE028
313200200616     C                     ELSE                                                               CSE028
313300200616      *                                                                                       CSE028
313400200616     C           KWSTDS    CHAINSTDSED               78                   135691
313500200616      *                                                                                       CSE028
313600200616     C                     ENDIF                                                              CSE028
313700200616      *                                                                                       CSE028
313800200616     C/COPY WNCPYSRC,SE7561C006
313900200616     C                     ENDIF                                          135691
314000200616     C                     ENDIF                                          135691
314100200616      *                                                                   135691
314200200616      * If no record found ensure fields from last chain not loaded       135691
314300200616      * to output fields.                                                 135691
314400200616     C           *IN78     IFEQ '0'                                       135691
314500200616      ** .. Settlement Type
314600200616     C                     Z-ADDSRSM      PSMT
314700200616      ** .. Settlement Account
314800200616     C                     MOVELSRAC      PSEA
314900200616      ** .. Settlement Branch
315000200616     C                     MOVELSRAB      PSEB
315100200616      *
315200200616      ***  If SRSM = 04 and SRAC = BLANKS the determine settlement A/C
315300200616      ***     via SR/ZSETAC  and output to field PSEA
315400200616      *
315500200616     C           SRSM      IFEQ 04
315600200616     C           SRAC      ANDEQ*BLANK
315700200616      *
315800200616      ***  Pass Parameters to SR/ZSETAC and execute routine
315900200616      *
316000200616     C                     MOVE SRSM      ZMETH
316100200616     C                     MOVE SRAC      ZSETI
316200200616     C                     MOVE PCPY      ZCNUM
316300200616     C           CEU005    IFEQ 'Y'                                       135691
316400200616     C           SCCY      ANDNE*BLANKS                                   135691
316500200616     C                     MOVE SCCY      ZCCY                            135691
316600200616     C                     ELSE                                           135691
316700200616     C                     MOVE WONMCY    ZCCY
316800200616     C                     ENDIF                                          135691
316900200616     C                     MOVE SRAB      ZBRCA
317000200616     C                     EXSR ZSETAC
317100200616     C                     MOVELZSETO     PSEA
317200200616     C                     MOVELZWBRCA    PSEB
317300200616     C                     ENDIF
317400200616     C                     ENDIF
317500200616     C                     ENDIF                                          135691
317600200616      *
317700200616     C                     ELSE
317800200616     C           BGPFMG    IFEQ 'Y'
317900200616     C           WWDPCU    ANDEQ'C'
318000200616     C           BGN4ST    OREQ 'Y'                                       CPB001
318100200616     C           WWDPCU    ANDEQ'C'                                       CPB001
318200200616     C                     MOVE 'Y'       WALCCY  1
318300200616     C                     EXSR #SETIN
318400200616      *
318500200616      ** If Account found in any of currencies checked
318600200616     C           WSAME     IFEQ *OFF
318700200616      ** .. Settlement Currency
318800200616     C                     MOVELCCY       PSCU
318900200616      ** .. Settlement Type
319000200616     C                     Z-ADD05        PSMT
319100200616      ** .. Settlement Account
319200200616     C                     MOVELPSEA1     PSEA
319300200616      ** .. Settlement Branch
319400200616     C                     MOVE BRCA      PSEB
319500200616      *
319600200616      ** ELSE
319700200616     C                     ELSE
319800200616      *
319900200616     C           MAPTYP    IFNE 'CC'                                      CEU017
320000200616     C                     MOVELWONMCY    PSCU
320100200616     C                     ELSE                                           CEU017
320200200616     C                     MOVELPNCY      PSCU                            CEU017
320300200616     C                     ENDIF                                          CEU017
320400200616      ** .. Settlement Type
320500200616     C                     Z-ADD*ZEROS    PSMT
320600200616      ** .. Settlement Account
320700200616     C                     MOVEL*BLANKS   PSEA
320800200616      ** .. Settlement Branch
320900200616     C                     MOVE *BLANKS   PSEB
321000200616     C                     ENDIF
321100200616     C                     ENDIF
321200200616     C                     ENDIF
321300200616      *
321400200616     C                     ENDIF
321500200616      ** .. Settlement Currency
321600200616     C           PSCU      IFEQ *BLANKS
321700200616     C                     MOVE PNCY      PSCU
321800200616     C                     ENDIF
321900200616      ** .. Settlement Branch
322000200616     C           PSEB      IFEQ *BLANKS
322100200616     C                     MOVE PBCA      PSEB
322200200616     C                     ENDIF
322300200616      *
322400200616      ** .. Settlement Exchange Rate between Nominal and Settlement Currency
322500200616      ** .. Multiply/Divide Indicator
322600200616     C           PNCY      IFNE PSCU
322700200616      *
322800200616     C                     CALL 'AOCURRR0'
322900200616     C                     PARM *BLANKS   @RTCD
323000200616     C                     PARM '*KEY  '  @OPTN
323100200616     C                     PARM PNCY      @CYCD
323200200616     C           SDCURR    PARM SDCURR    DSSDY
323300200616      *
323400200616     C                     Z-ADD1         ZAMTF
323500200616     C                     MOVE PNCY      ZCCYF
323600200616     C                     Z-ADDA6SPRT    ZRATEF
323700200616     C                     MOVE A6MDIN    ZMDINF
323800200616     C                     Z-ADDA6NBDP    ZCDPF
323900200616      *
324000200616     C                     CALL 'AOCURRR0'
324100200616     C                     PARM *BLANKS   @RTCD
324200200616     C                     PARM '*KEY  '  @OPTN
324300200616     C                     PARM PSCU      @CYCD
324400200616     C           SDCURR    PARM SDCURR    DSSDY
324500200616      *
324600200616     C                     MOVE PSCU      ZCCYT
324700200616     C                     MOVE A6SPRT    ZRATET
324800200616     C                     MOVE A6MDIN    ZMDINT
324900200616     C                     MOVE A6NBDP    ZCDPT
325000200616      *
325100200616     C                     EXSR ZCCYCN
325200200616     C                     Z-ADDZCRSRT    PSXR
325300200616     C                     MOVE ZCRSMD    PMDI
325400200616     C                     ELSE
325500200616     C                     Z-ADD1         PSXR
325600200616     C                     MOVEL'M'       PMDI
325700200616     C                     ENDIF
325800200616      *
325900200616      ** .. Base Currency Exchange Rate
326000200616     C           MAPTYP    IFNE 'CC'                                      CEU017
326100200616     C                     Z-ADDWOSPRT    PBRX
326200200616     C                     ELSE                                           CEU017
326300200616     C                     CALL 'AOCURRR0'                                CEU017
326400200616     C                     PARM *BLANKS   @RTCD                           CEU017
326500200616     C                     PARM '*KEY  '  @OPTN                           CEU017
326600200616     C                     PARM PNCY      @CYCD                           CEU017
326700200616     C           SDCURR    PARM SDCURR    DSSDY                           CEU017
326800200616     C                     Z-ADDA6SPRT    PBRX                            CEU017
326900200616     C                     ENDIF                                          CEU017
327000200616      *
327100200616      ** .. Authorized Indicator
327200200616     C           BVAPST    IFEQ 'Y'
327300200616      *
327400200616     C           EXBCSI    IFEQ 'Y'
327500200616     C                     MOVE 'Y'       PAUI
327600200616     C                     ELSE
327700200616     C                     MOVE *BLANKS   PAUI
327800200616     C                     ENDIF
327900200616      *
328000200616     C                     ELSE
328100200616     C                     MOVE *BLANKS   PAUI
328200200616     C                     ENDIF
328300200616      *
328400200616      ** .. Counterparty Bank
328500200616     C                     MOVEL*BLANKS   PCPN
328600200616      ** .. For Account Of
328700200616     C                     MOVEL*BLANKS   PFAC
328800200616      ** .. Special Instructions
328900200616     C                     MOVEL*BLANKS   PSPI
329000200616      *
329100200616      ***  Call Access Program for Security Customer Details to retrieve Customer Group.
329200200616      *
329300200616     C                     MOVE PCPY      WCUST   6
329400200616     C                     EXSR #AOSEC
329500200616      *
329600200616     C           S01496    IFEQ 'Y'
329700200616     C           BVACOP    ANDEQ'Y'
329800200616     C                     MOVE BFPSCG    WKCUGR
329900200616     C                     MOVE *BLANKS   WKCLAS
330000200616     C                     ELSE
330100200616     C                     MOVE *BLANKS   WKCUGR
330200200616     C                     MOVE BFCLAS    WKCLAS
330300200616     C                     ENDIF
330400200616      *                                                                   CEU017
330500200616      ***  If processing type is 'CC' than Charges/Commissions amount is  CEU017
330600200616      ***  not calculated and Charges/Commissions Code is blanks          CEU017
330700200616      *                                                                   CEU017
330800200616     C           MAPTYP    IFEQ 'CC'                                      CEU017
330900200616     C                     MOVE *BLANKS   PCHC                            CEU017
331000200616     C                     Z-ADD*ZERO     PCHA                            CEU017
331100200616     C                     MOVE *BLANKS   PCCD                            CEU017
331200200616     C                     Z-ADD*ZERO     PCAM                            CEU017
331300200616     C                     ELSE                                           CEU017
331400200616      *
331500200616     C           S01496    IFEQ 'Y'
331600200616     C           BVACOP    ANDEQ'Y'
331700200616      *
331800200616      ***  Retrieve the Commission and the Charge Code on the Corporate Actions Default Charges
331900200616      ***  file with Customer Group, Customer, Investment Type and Corporate Action Type
332000200616      *
332100200616     C                     MOVE PCPY      WKPCPY           Customer
332200200616     C                     MOVE WOSITP    WKSITP           Investment Type
332300200616     C                     MOVE PEVT      WKPEVT           Event Type
332400200616     C           KWCOH1    CHAINSECOCHL0             89
332500200616      *
332600200616      ***  If record not found, access with Customer Group, Customer, Investment type
332700200616      *
332800200616     C           *IN89     IFEQ *ON
332900200616     C                     MOVE *BLANKS   WKPEVT           Event Type
333000200616     C           KWCOH1    CHAINSECOCHL0             89
333100200616      *
333200200616      ***  If record not found, access with Customer Group, Customer
333300200616      *
333400200616     C           *IN89     IFEQ *ON
333500200616     C                     MOVE *BLANKS   WKSITP           Investment Type
333600200616     C           KWCOH1    CHAINSECOCHL0             89
333700200616      *
333800200616      ***  If record not found, access with Customer Group.
333900200616      *
334000200616     C           *IN89     IFEQ *ON
334100200616     C                     MOVE *BLANKS   WKPCPY           Customer
334200200616     C           KWCOH1    CHAINSECOCHL0             89
334300200616     C                     ENDIF
334400200616     C                     ENDIF
334500200616     C                     ENDIF
334600200616      *
334700200616     C                     ELSE
334800200616      *
334900200616      ***  Retrieve the Commission and the Charge Code on the Corporate Actions Default Charges
335000200616      ***  file with Classification, Customer, Investment Type, and Corporate Action Type
335100200616      *
335200200616     C                     MOVE PCPY      WKPCPY           Customer
335300200616     C                     MOVE WOSITP    WKSITP           Investment Type
335400200616     C                     MOVE PEVT      WKPEVT           Event Type
335500200616     C           KWCOH2    CHAINSECOCHL1             89
335600200616      *
335700200616      ***  If record not found, access with Classification, Customer, Investment type
335800200616      *
335900200616     C           *IN89     IFEQ *ON
336000200616     C                     MOVE *BLANKS   WKPEVT           Event Type
336100200616     C           KWCOH2    CHAINSECOCHL1             89
336200200616      *
336300200616      ***  If record not found, access with Classification, Customer
336400200616      *
336500200616     C           *IN89     IFEQ *ON
336600200616     C                     MOVE *BLANKS   WKSITP           Investment Type
336700200616     C           KWCOH2    CHAINSECOCHL1             89
336800200616      *
336900200616      ***  If record not found, access with Classification.
337000200616      *
337100200616     C           *IN89     IFEQ *ON
337200200616     C                     MOVE *BLANKS   WKPCPY           Customer
337300200616     C           KWCOH2    CHAINSECOCHL1             89
337400200616     C                     ENDIF
337500200616     C                     ENDIF
337600200616     C                     ENDIF
337700200616     C                     ENDIF
337800200616      *
337900200616      ***  If record not found with one access
338000200616      *
338100200616     C           *IN89     IFEQ *OFF
338200200616      *
338300200616      ***  Retrieve Charge Basis Indicator on Charge Types file with Charge Code retrieve above
338400200616      ***  and Event Nominal Currency.
338500200616      *
338600200616      ** ..  Charge Code
338700200616     C                     MOVE MRCOCH    PCHC
338800200616      ** .. Commission Code
338900200616     C                     MOVE MRCOCO    PCCD
339000200616      *
339100200616     C                     MOVE MRCOCH    WKCCOM
339200200616     C           KWSECG    CHAINSECGT                89
339300200616      *
339400200616      ***  If no live record found
339500200616      *
339600200616     C           *IN89     IFEQ *OFF
339700200616     C                     Z-ADD0         ZTCON
339800200616     C                     Z-ADD0         ZNOML
339900200616      *
340000200616      ***  If Processing Type = 'NF', set field ZNOML to Ex-Date Position for Corporate Action
340100200616      *
340200200616     C           MAPTYP    IFEQ 'NF'
340300200616     C                     Z-ADDWWEXPO    ZNOML
340400200616      *
340500200616      ***  Else, if Processing Type not = 'NF'.
340600200616      *
340700200616     C                     ELSE
340800200616      *
340900200616      ***  If Charge Basis Indicator = 'C', set field ZTCON to (Actual Cash Allocation + Actual
341000200616      ***  Cash Rounding).
341100200616      *
341200200616     C           CHGB      IFEQ 'C'
341300200616     C           WWACAA    ADD  WWACAR    ZTCON
341400200616      *
341500200616      ***  Else, if Processing Type not = 'NF' and Charge Basis Indicator not = 'C'.
341600200616      *
341700200616     C                     ELSE
341800200616      *
341900200616      ***  If Charge Basis Indicator = 'N', set field ZNOML to Ex-Date.
342000200616      *
342100200616     C           CHGB      IFEQ 'N'
342200200616     C                     Z-ADDWWEXPO    ZNOML
342300200616     C                     ENDIF
342400200616     C                     ENDIF
342500200616     C                     ENDIF
342600200616      *
342700200616      ***  Calculate Charge Amount.
342800200616      *
342900200616     C                     EXSR CALAM2
343000200616      **  .. Charge Amount
343100200616     C                     Z-ADDZCHGA     PCHA
343200200616     C                     ENDIF                                                              200789
343300200616      *                                                                                       200789
343400200616      *
343500200616     C                     Z-ADD0         ZTCON
343600200616     C                     Z-ADD0         ZNOML
343700200616      *
343800200616      ***  Retrieve Charge Basis Indicator on Charge Types file with Commission Code retrieve
343900200616      ***  above and Event Nominal Currency.
344000200616      *
344100200616     C                     MOVE WONMCY    WKNMCY           Event Nominal Currency
344200200616     C                     MOVE MRCOCO    WKCCOM           Commission Code
344300200616     C           KWSECG    CHAINSECGT                89
344400200616      *
344500200616      ***  If no live record found
344600200616      *
344700200616     C           *IN89     IFEQ *OFF
344800200616      *
344900200616      ***  If Processing Type = 'NF', set field ZNOML to Ex-Date Position for Corporate Action
345000200616      *
345100200616     C           MAPTYP    IFEQ 'NF'
345200200616     C                     Z-ADDWWEXPO    ZNOML
345300200616      *
345400200616      ***  Else, if Processing Type not = 'NF'.
345500200616      *
345600200616     C                     ELSE
345700200616      *
345800200616      ***  If Charge Basis Indicator = 'C', set field ZTCON to (Actual Cash Allocation + Actual
345900200616      ***  Cash Rounding).
346000200616      *
346100200616     C           CHGB      IFEQ 'C'
346200200616     C           WWACAA    ADD  WWACAR    ZTCON
346300200616      *
346400200616      ***  Else, if Processing Type not = 'NF' and Charge Basis Indicator not = 'C'.
346500200616      *
346600200616     C                     ELSE
346700200616      *
346800200616      ***  If Charge Basis Indicator = 'N', set field ZNOML to Ex-Date.
346900200616      *
347000200616     C           CHGB      IFEQ 'N'
347100200616     C                     Z-ADDWWEXPO    ZNOML
347200200616     C                     ENDIF
347300200616     C                     ENDIF
347400200616     C                     ENDIF
347500200616      *
347600200616      ***  Calculate Commission Amount.
347700200616      *
347800200616     C                     EXSR CALAM2
347900200616     C                     Z-ADDZCHGA     PCAM
348000200616     C                     ENDIF
348100200616     C**********           ENDIF                                                              200789
348200200616     C                     ENDIF
348300200616     C                     ENDIF                           Proc. Type 'CC'CEU017
348400200616      *
348500200616      *** Access security WHT details file
348600200616      *
348700200616     C           MASESN    CHAINSESWHTL0             89
348800200616      *
348900200616     C           S01447    IFEQ 'N'
349000200616     C           *IN89     OREQ '1'
349100200616     C           PPRE      OREQ 'R'
349200200616     C           MAPTYP    ORNE 'DV'
349300200616      ** Tax ded source
349400200616     C                     Z-ADD0         TASO
349500200616      ** Tax ded src ref
349600200616     C                     Z-ADD0         TASR
349700200616      ** Tax ded user
349800200616     C                     Z-ADD0         TAUS
349900200616     C                     ELSE
350000200616      *
350100200616      ***  If Depot/Customer Indicator = 'C' and Stock Dividend Type = 'R' as Reinvestment of
350200200616      ***  Dividend, calculate Withholding Tax based on Original Cash Option, else calculate
350300200616      ***  Withholding Tax based on Actual Cash Allocation + Rounding.
350400200616      *
350500200616     C           WWDPCU    IFEQ 'C'
350600200616     C           MDSDIT    ANDEQ'R'
350700200616     C                     Z-ADDMCCAOP    WUPAMD
350800200616     C                     ELSE
350900200616     C                     Z-ADDPAMD      WUPAMD 150
351000200616     C                     ENDIF
351100200616     C                     EXSR CALCTX
351200200616     C                     ENDIF
351300200616      *                                                                                     AR853119
351400200616     C           CER049    IFEQ 'Y'                                                         AR853119
351500200616     C                     EXSR SRPOST                                                      AR853119
351600200616     C                     ENDIF                                                            AR853119
351700200616      *
351800200616      ***  Retrieve the settlement amount
351900200616      ***  Set up parameter for call to SEZ010
352000200616      *
352100200616     C                     MOVELBFCLAS    P@CLAS
352200200616     C                     MOVE PPRE      P@PPRE
352300200616     C                     Z-ADDPAMD      P@PAMD
352400200616     C                     Z-ADDPCHA      P@PCHA
352500200616     C                     Z-ADDPCAM      P@PCAM
352600200616     C                     Z-ADDTASO      P@TASO
352700200616     C                     Z-ADDTAUS      P@TAUS
352800200616     C                     Z-ADDPSXR      P@PSXR
352900200616     C                     MOVELPMDI      P@PMDI
353000200616     C                     MOVELPNCY      P@PNCY
353100200616     C                     MOVELPSCU      P@PSCU
353200200616     C           PPRE      IFEQ 'R'
353300200616     C                     MOVE 'TS'      P@TDTP
353400200616     C                     ELSE
353500200616     C                     MOVE 'TP'      P@TDTP
353600200616     C                     ENDIF
353700200616     C                     Z-ADD0         P@FXMR
353800200616     C                     Z-ADD0         P@MAMT
353900200616     C                     MOVELWTAXA     P@STAM                                            AR853119
354000200616      *
354100200616      ***  Call SEZ010 to calculate the settlement amount in settle ccy
354200200616      *
354300200616     C                     CALL 'SEZ010'
354400200616     C                     PARM *BLANKS   P@RCDE  7
354500200616     C                     PARM           P@DATA
354600200616     C           P@RCDE    IFEQ *BLANKS
354700200616     C                     Z-ADDP@PSAT    PSAT
354800200616     C                     ELSE
354900200616     C           *LOCK     IN   LDA
355000200616     C                     Z-ADD4         DBASE            ***************
355100200616     C                     MOVEL'SEZ010  'DBFILE    P      * DB ERROR 04 *
355200200616     C                     MOVELP@DATA    DBKEY     P      ***************
355300200616     C                     MOVEL'SE7561'  DBPGM     P
355400200616     C                     OUT  LDA
355500200616     C                     EXSR *PSSR
355600200616     C                     ENDIF
355700200616      ** .. Message Indicator
355800200616     C                     MOVEL*BLANKS   PSMI
355900200616      ** .. Date Generated
356000200616     C                     MOVE BJRDNB    PDTG
356100200616      ** .. Last Change Date         Run Date
356200200616     C                     MOVE BJRDNB    LCD
356300200616      ** .. Type of last change
356400200616     C                     MOVEL'I'       CHTP
356500200616      ** .. Position Settl. Value Date
356600200616     C                     MOVE MACOPD    PSVL
356700200616      ** .. Settlement Reversal Postings Gen
356800200616     C                     MOVEL*BLANKS   SRPG
356900200616      ** .. Profit Centre
357000200616     C                     MOVE *BLANKS   PPFC
357100200616      *
357200200616      ***   If Profit Centre used
357300200616      *
357400200616     C           BKPRCU    IFEQ 'Y'
357500200616      *
357600200616      ***  If Classification of counterpaty is 'S' or 'D'
357700200616      *
357800200616     C           BFCLAS    IFEQ 'S'
357900200616     C           BFCLAS    OREQ 'D'
358000200616      *
358100200616     C                     MOVELPCPY      WKPCPY           Customer
358200200616     C                     MOVELPBCA      WKPBCA           Branch
358300200616     C                     MOVELPSSH      WKPSSH    P      Security
358400200616      *
358500200616     C           KWSEPC    CHAINSEPCCDF              89
358600200616     C           *IN89     IFEQ *OFF
358700200616     C                     MOVELPCCU      PPFC
358800200616     C                     ELSE
358900200616     C                     MOVELWOSESN    WKPSSH           Event Security
359000200616     C           KWSEPC    CHAINSEPCCDF              89
359100200616     C           *IN89     IFEQ *OFF
359200200616     C                     MOVELPCCU      PPFC
359300200616     C                     ENDIF
359400200616     C                     ENDIF
359500200616     C                     ENDIF
359600200616     C                     ENDIF
359700200616      *
359800200616      ***  Analytical Accounting Module is ON and PPFC is *BLANKS
359900200616      *
360000200616     C           BGN0ST    IFEQ 'Y'
360100200616     C           PPFC      ANDEQ*BLANKS
360200200616     C                     MOVE BVSEPC    PPFC
360300200616     C                     ENDIF
360400200616      *
360500200616      ** Settl. amount base
360600200616     C                     Z-ADD0         SABC
360700200616      ** Base ccy eq.
360800200616     C                     Z-ADD0         BAUS
360900200616      ** conf. produced blank
361000200616     C                     MOVE *BLANKS   PSCF
361100200616      *
361200200616      ***  Initialise FXMP, FXMR, and MAMT to zero
361300200616      *
361400200616     C                     Z-ADD0         FXMP
361500200616     C                     Z-ADD0         FXMR
361600200616     C                     Z-ADD0         MAMT
361700200616      ** Transaction number of last update
361800200616     C                     EXSR ZTNLU1
361900200616     C                     MOVELFNATN     TNLU
362000200616     C                     MOVELFNATN     WWTNLU
362100200616      ** Record ID
362200200616     C                     MOVE 'D'       RECI
362300200616      *
362400200616     C           WWDPCU    IFEQ 'C'
362500200616      ** .. Portfolio Reference
362600200616     C                     MOVELMCPTFR    PTFR
362700200616     C                     ELSE
362800200616     C                     MOVE *BLANKS   PTFR
362900200616     C                     ENDIF
363000200616     C*                                                                   135691
363100200616     C** If CEU005 active, use 'In' ccy values for settlement details     135691
363200200616     C*                                                                   135691
363300200616     C           CEU005    IFEQ 'Y'                                       135691
363400200616     C           SVSCCY    ANDNE*BLANKS                                   135691
363500200616     C                     MOVE SVEUER    PSXR                            135691
363600200616     C           SVSCCY    IFEQ BKEURO                                    135691
363700200616     C           SVEUMD    IFEQ 'M'                                       135691
363800200616     C                     MOVE 'D'       PMDI                            135691
363900200616     C                     ELSE                                           135691
364000200616     C                     MOVE 'M'       PMDI                            135691
364100200616     C                     ENDIF                                          135691
364200200616      *                                                                   135691
364300200616      * Settlement ccy not Euro ccy, use Euro M/D indicator.              135691
364400200616     C                     ELSE                                           135691
364500200616     C                     MOVE SVEUMD    PMDI                            135691
364600200616     C                     ENDIF                                          135691
364700200616      * Use standard settlement ccy for position settlement ccy           135691
364800200616     C                     MOVE SVSCCY    PSCU                            135691
364900200616     C                     ENDIF                                          135691
365000200616      *
365100200616      ***  Write position settlement record
365200200616     C/COPY WNCPYSRC,SE7561C003
365300200616      *
365400200616     C** If CSE023 is not installed or if CSE023 is installed and         CSE023
365500200616     C** the events is not for Coupon, Dividend or Maturity then          CSE023
365600200616     C** use the normal processing.                                       CSE023
365700200616     C*                                                                   CSE023
365800200616     C           CSE023    IFEQ 'N'                                       CSE023
365900200616     C*                                                                   CSE023
366000200616     C           CSE023    OREQ 'Y'                                       CSE023
366100200616     C           MAPTYP    ANDNE'DV'                                      CSE023
366200200616      *                                                                   CSE023
366300200616     C                     WRITEPOSETDF
366301200616     C                     EXSR PSAUDT                                                      AR324886
366400200616      *
366500200616      ***  Count Records Written
366600200616      *
366700200616     C                     ADD  1         W02CNT
366800200616      *                                                                                     AR853119
366900200616     C           CER049    IFEQ 'Y'                                                         AR853119
367000200616     C                     WRITEPOSETDD3                                                    AR853119
367100200616     C           P3TAX     IFEQ 'Y'                                                        AR864714B
367200200616     C                     WRITE@STMDP0                                                     AR853119
367300200616     C                     ENDIF                                                           AR864714B
367400200616     C                     ENDIF                                                            AR853119
367500200616      *                                                                   CSE023
367600200616     C                     ELSE                                           CSE023
367700200616      *                                                                   CSE023
367800200616      ** If Treaty Withholding Tax is installed, then set up fields       CSE023
367900200616      ** for SE2310.                                                      CSE023
368000200616      *                                                                   CSE023
368100200616      ** For Dividend Event, @DIVDT is equal to the dividend date.        CSE023
368200200616      *                                                                   CSE023
368300200616     C                     MOVE MATDVD    @TVBAS                          CSE023
368400200616     C                     MOVE LCD       PSLCD                           CSE023
368500200616      *                                                                   CSE023
368600200616     C                     Z-ADDMACOEX    @DIVDT                          CSE023
368700200616     C                     MOVE MACORF    PSPI                            215575
368800200616      *                                                                   CSE023
368900200616     C                     CALL 'SE2310'                                  CSE023
369000200616     C                     PARM           PPOSET                          CSE023
369100200616     C                     PARM           @TVBAS  1                       CSE023
369200200616     C                     PARM           @DIVDT  50                      CSE023
369300200616     C                     PARM           @NREC   30                      CSE023
369400200616     C                     PARM           @ERR    1                       CSE023
369500200616      *                                                                   CSE023
369600200616     C           @ERR      IFEQ 'N'                                       CSE023
369700200616     C                     ADD  @NREC     W02CNT                          CSE023
369800200616     C                     ELSE                                           CSE023
369900200616     C                     EXSR *PSSR                                     CSE023
370000200616     C                     MOVE '1'       *INLR                           CSE023
370100200616     C                     END                                            CSE023
370200200616     C                     END                                            CSE023
370300200616      *                                                                   CSE023
370400200616     C                     MOVE 'Y'       WWDATA           one Read
370500200616     C/COPY WNCPYSRC,SE7561C001
370600200616      *
370700200616      ***  If Portfolio Management is licensed in the System (from SESTAT) and the
370800200616      ***  MT5xx Feature is present, then for Portfolio Customers, for
370900200616      ***  Coupon and Dividend Position Settlements, ensure that a
371000200616      ***  corresponding Extension record is present.
371100200616      *
371200200616     C           PFPL      IFEQ 'Y'
371300200616     C           S01401    ANDEQ'Y'
371400200616      *
371500200616      ***  Select only Coupons and Dividends.
371600200616      *
371700200616     C           PEVT      IFEQ 'CP'
371800200616     C           PEVT      OREQ 'DV'
371900200616      *
372000200616      ***  Ascertain if Customer is Safe Custody or Discretionary.
372100200616      *
372200200616     C                     MOVE PCPY      WCUST   6
372300200616     C                     EXSR #AOSEC
372400200616      *
372500200616     C           BFCLAS    IFEQ 'S'
372600200616     C           BFCLAS    OREQ 'D'
372700200616      *
372800200616      ***  Check if record exists on Extension File.
372900200616      *
373000200616     C           KPOSET    CHAINPOSETDY1             89
373100200616      *
373200200616      ***  If it doesn't, set one up and Write it.
373300200616      *
373400200616     C           *IN89     IFEQ *ON
373500200616     C                     CLEARPOSETDD1
373600200616     C                     MOVE PBCA      POPBCA
373700200616     C                     MOVE PSSH      POPSSH
373800200616     C                     MOVE PCPY      POPCPY
373900200616     C                     MOVE PDUD      POPDUD
374000200616     C                     MOVE PEVT      POPEVT
374100200616     C                     MOVE LCD       POLCD
374200200616     C                     MOVE 'N'       PORCDG
374300200616     C                     MOVE *ZEROS    POSEQN
374400200616     C                     MOVE 'N'       POGMES
374500200616      *
374600200616     C                     WRITEPOSETDD1               88
374700200616      *
374800200616      ***  If the Write fails, then process a database error
374900200616      *
375000200616     C           *IN88     IFEQ *ON
375100200616     C           *LOCK     IN   LDA
375200200616     C                     Z-ADD5         DBASE            ***************
375300200616     C                     MOVEL'POSETDY1'DBFILE    P      * DB ERROR 05 *
375400200616     C                     MOVELPCPY      DBKEY     P      ***************
375500200616     C                     MOVEL'SE7561'  DBPGM     P
375600200616     C                     OUT  LDA
375700200616     C                     EXSR *PSSR
375800200616     C                     ENDIF
375900200616      *
376000200616      ***  End of Position Settlement Extension record not on file.
376100200616      *
376200200616     C                     ENDIF
376300200616      *
376400200616      ***  Check if record exists on Extension File.
376500200616      *
376600200616     C           KPOSET    CHAINPOSETDY2             89
376700200616      *
376800200616      ***  If it doesn't, set one up and Write it.
376900200616      *
377000200616     C           *IN89     IFEQ *ON
377100200616     C                     CLEARPOSETDD2
377200200616     C                     MOVE PBCA      P2PBCA
377300200616     C                     MOVE PSSH      P2PSSH
377400200616     C                     MOVE PCPY      P2PCPY
377500200616     C                     MOVE PDUD      P2PDUD
377600200616     C                     MOVE PEVT      P2PEVT
377700200616      *
377800200616     C                     WRITEPOSETDD2               88
377900200616      *
378000200616      ***  If the Write fails, then process a database error
378100200616      *
378200200616     C           *IN88     IFEQ *ON
378300200616     C           *LOCK     IN   LDA
378400200616     C                     Z-ADD6         DBASE            ***************
378500200616     C                     MOVEL'POSETDY2'DBFILE    P      * DB ERROR 06 *
378600200616     C                     MOVELPCPY      DBKEY     P      ***************
378700200616     C                     MOVEL'SE7561'  DBPGM     P
378800200616     C                     OUT  LDA
378900200616     C                     EXSR *PSSR
379000200616     C                     ENDIF
379100200616     C                     ENDIF
379200200616      ***  End of Portfolio Customers.
379300200616     C                     ENDIF
379400200616      ***  End of only Coupons and Dividends.
379500200616     C                     ENDIF
379600200616      ***  End of Portfolio Management licensed and MT5xx present.
379700200616     C                     ENDIF
379800200616      *
379900200616     C                     ENDSR
380000200616      *
380100200616      *****************************************************************
380200200616      /EJECT
380300200616      *****************************************************************
380400200616      *  #STDIS - Retrieve Standard Instructions for Corporate Actions*
380500200616      *  ------                                                       *
380600200616      *  Called by :                                                  *
380700200616      *  Calls     :                                                  *
380800200616      *****************************************************************
380900200616      *
381000200616     C           #STDIS    BEGSR
381100200616      *
381200200616      ***  If Depot/Customer indicator is 'C'
381300200616      *
381400200616     C           WWDPCU    IFEQ 'C'
381500200616     C           MCCOTP    ANDEQ'B'
381600200616      *
381700200616      ***  Retrieve the Standard Instructions for Books by accessing LF/SECOSIL2 with Branch,
381800200616      ***  Book, Corporate Action Type and Security Shortname
381900200616      *
382000200616     C                     MOVE MCBRCD    KBRCD   3        Branch
382100200616     C                     MOVE MCBOOK    KBOOK   2        Book
382200200616     C                     MOVE MCCOAT    KCOAT   2        Corporate Action Type
382300200616     C                     MOVE MCSESN    KSESN  10        Security
382400200616      *
382500200616     C           KSECO2    SETGTSECOSIL2
382600200616     C           KSECO2    REDPESECOSIL2                 89
382700200616      *
382800200616      ***  If no record found, access with Branch, Book, Corporate Action Type
382900200616      *
383000200616     C           *IN89     IFEQ '1'
383100200616     C           MORECI    ORNE 'D'
383200200616     C                     MOVE *BLANKS   KSESN
383300200616     C           KSECO2    SETGTSECOSIL2
383400200616     C           KSECO2    REDPESECOSIL2                 89
383500200616      *
383600200616      ***  If no record found, access with Branch, Book
383700200616      *
383800200616     C           *IN89     IFEQ '1'
383900200616     C           MORECI    ORNE 'D'
384000200616     C                     MOVE *BLANKS   KCOAT
384100200616     C           KSECO2    SETGTSECOSIL2
384200200616     C           KSECO2    REDPESECOSIL2                 89
384300200616      *
384400200616      ***  If no record found, access with Branch
384500200616      *
384600200616     C           *IN89     IFEQ '1'
384700200616     C           MORECI    ORNE 'D'
384800200616     C                     MOVE *BLANKS   KBOOK
384900200616     C           KSECO2    SETGTSECOSIL2
385000200616     C           KSECO2    REDPESECOSIL2                 89
385100200616     C                     ENDIF
385200200616     C                     ENDIF
385300200616     C                     ENDIF
385400200616      *
385500200616     C                     ELSE
385600200616      *
385700200616      ***  Retrieve the Standard Instructions for Customer by accessing LF/SECOSIL1 with Branch,
385800200616      ***  Customer and Portfolio Reference, Corporate Action Type and Security Shortname
385900200616      *
386000200616     C           WWDPCU    IFEQ 'C'
386100200616     C           MCCOTP    ANDEQ'C'
386200200616     C                     MOVE MCBRCD    KBRCD            Branch
386300200616     C**********           Z-ADDMCCNUM    KCNUM            Customer                           CSD027
386400200616     C                     MOVE MCCNUM    KCNUM            Customer                           CSD027
386500200616     C                     MOVE MCPTFR    KPTFR            Portfolio Reference
386600200616     C                     MOVE MCCOAT    KCOAT            Corporate Action Type
386700200616     C                     MOVE MCSESN    KSESN            Security
386800200616     C                     ELSE
386900200616     C           WWDPCU    IFEQ 'D'
387000200616     C                     MOVE MBBRCD    KBRCD            Branch
387100200616     C**********           Z-ADDMBDDPT    KCNUM            Customer                           CSD027
387200200616     C                     MOVE MBDDPT    KCNUM            Customer                           CSD027
387300200616     C                     MOVE *BLANKS   KPTFR            Portfolio Reference
387400200616     C                     MOVE MBCOAT    KCOAT            Corporate Action Type
387500200616     C                     MOVE MBSESN    KSESN            Security
387600200616     C                     ENDIF
387700200616     C                     ENDIF
387800200616      *
387900200616     C           KSECO1    SETGTSECOSIL1
388000200616     C           KSECO1    REDPESECOSIL1                 89
388100200616      *
388200200616      ***  If no record found, access with Branch, Customer and Portfolio Reference,
388300200616      ***  Corporate Action Type
388400200616      *
388500200616     C           *IN89     IFEQ '1'
388600200616     C           MORECI    ORNE 'D'
388700200616     C                     MOVE *BLANKS   KSESN
388800200616     C           KSECO1    SETGTSECOSIL1
388900200616     C           KSECO1    REDPESECOSIL1                 89
389000200616      *
389100200616      ***  If no record found, access with Branch, Customer
389200200616      *
389300200616     C           *IN89     IFEQ '1'
389400200616     C           MORECI    ORNE 'D'
389500200616     C                     MOVE *BLANKS   KCOAT
389600200616     C           KSECO1    SETGTSECOSIL1
389700200616     C           KSECO1    REDPESECOSIL1                 89
389800200616      *
389900200616      ***  If no record found, access with Branch
390000200616      *
390100200616     C           *IN89     IFEQ '1'
390200200616     C           MORECI    ORNE 'D'
390300200616     C**********           Z-ADD*ZEROS    KCNUM                                               CSD027
390400200616     C                     MOVE *BLANKS   KCNUM                                               CSD027
390500200616     C           KSECO1    SETGTSECOSIL1
390600200616     C           KSECO1    REDPESECOSIL1                 89
390700200616     C                     ENDIF
390800200616     C                     ENDIF
390900200616     C                     ENDIF
391000200616     C                     ENDIF
391100200616      *
391200200616      ***  If Standard Corporate Actions Instruction exists (record found with one of the access).
391300200616      *
391400200616     C                     MOVE 'N'       EXBCSI  1        Standard Instruction exist
391500200616     C           *IN89     IFEQ '0'
391600200616     C           MORECI    ANDEQ'D'
391700200616      *
391800200616      ***  Set 'Customer/Booh Standard Instruction Exists' work field to 'Y'.
391900200616      *
392000200616     C                     MOVE 'Y'       EXBCSI
392100200616     C                     ENDIF
392200200616      *
392300200616     C                     ENDSR
392400200616      *****************************************************************
392500200616      /EJECT
392600200616      *****************************************************************
392700200616      *  #SETIN - Retrieve Settlement Instructions for Customers      *
392800200616      *  ------                                                       *
392900200616      *  Called by :                                                  *
393000200616      *  Calls     :                                                  *
393100200616      *****************************************************************
393200200616      *
393300200616     C           #SETIN    BEGSR
393400200616      *
393500200616      ** Set Currency 1 to Event Currency
393600200616     C                     MOVELEVCY      W1CURR  3
393700200616      *
393800200616      ** Access SDSECSL0 for Customer Settlement Currency
393900200616     C                     MOVE MCCNUM    WCUST   6
394000200616     C                     EXSR #AOSEC
394100200616      *
394200200616     C           WALCCY    IFEQ 'Y'
394300200616      *
394400200616      ** Portfolio Reference not blank and not '9997'
394500200616     C           MCPTFR    IFNE *BLANKS
394600200616     C           MCPTFR    ANDNE'9997'
394700200616      *
394800200616      ** Access PMPORTPD for Portfolio Currency
394900200616      *
395000200616     C           KPMPRT    CHAINPMPORTPD             89
395100200616      *
395200200616     C           *IN89     IFEQ *ON
395300200616     C           *LOCK     IN   LDA
395400200616     C                     Z-ADD7         DBASE            *****************
395500200616     C                     MOVEL*BLANKS   DBFILE           ** DB ERROR 07 **
395600200616     C                     MOVEL'PMPORTPD'DBFILE    P      *****************
395700200616     C                     MOVELMCCNUM    DBKEY     P
395800200616     C                     MOVE MCPTFR    DBKEY
395900200616     C                     MOVEL'SE7561'  DBPGM     P
396000200616     C                     OUT  LDA
396100200616     C                     EXSR *PSSR
396200200616     C                     ENDIF
396300200616      *
396400200616      ** Set Currency 2 to PTFR Currency
396500200616     C                     MOVELPNPTCY    W2CURR  3
396600200616     C                     ENDIF
396700200616      *
396800200616      ** Portfolio reference not blank
396900200616     C           MCPTFR    IFNE *BLANKS
397000200616     C           BGPFMG    ANDEQ'Y'                                       CPB001
397100200616      *
397200200616      ** Access SDPLCSPD for Customer Base Currency
397300200616     C                     CALL 'AOPLCSR0'
397400200616     C                     PARM *BLANKS   @RTCD   7
397500200616     C                     PARM '*KEY   ' @OPTN   7
397600200616     C                     PARM WCUST     WLCUST 10
397700200616     C           SDPLCS    PARM SDPLCS    DSSDY
397800200616      *
397900200616     C           @RTCD     IFNE *BLANKS
398000200616     C           *LOCK     IN   LDA
398100200616     C                     Z-ADD8         DBASE            *****************
398200200616     C                     MOVEL*BLANKS   DBFILE           ** DB ERROR 08 **
398300200616     C                     MOVE 'SDPLCSPD'DBFILE           *****************
398400200616     C                     MOVELWCUST     DBKEY     P
398500200616     C                     MOVEL'SE7561'  DBPGM     P
398600200616     C                     OUT  LDA
398700200616     C                     EXSR *PSSR
398800200616     C                     ENDIF
398900200616      *
399000200616      ** Set Currency 3 to Customer Currency
399100200616     C                     MOVELQBCSBY    W3CURR  3
399200200616      *
399300200616      ** If PTFR = '9997', set Currency 2 to Customer Currency
399400200616     C           MCPTFR    IFEQ '9997'
399500200616     C           BGN4ST    ANDNE'Y'                                       CPB001
399600200616     C                     MOVELQBCSBY    W2CURR
399700200616     C                     ENDIF
399800200616      *
399900200616      ** else = Portfolio reference blank
400000200616     C                     ELSE
400100200616      *
400200200616      ** Set Currency 2 and Currency 3 to Customer Settlement CCY
400300200616     C                     MOVELBFPCYC    W2CURR
400400200616     C                     MOVELBFPCYC    W3CURR
400500200616     C                     ENDIF
400600200616     C                     ELSE
400700200616     C                     MOVE *BLANKS   W2CURR
400800200616     C                     MOVE *BLANKS   W3CURR
400900200616     C                     ENDIF
401000200616      *
401100200616      ** Check for Customer Account in Currency 1 & same Portfolio.
401200200616      ** If found, use this account otherwise check for Account in
401300200616      ** Currency 2 and 3.
401400200616     C           ZWACC1    KLIST
401500200616     C                     KFLD           KCNUM
401600200616     C                     KFLD           KCCY
401700200616     C                     KFLD           KPTFR
401800200616     C                     KFLD           KACSQ   20
401900200616     C*                                                                   219688
402000200616     C** ACCOUNT DETAILS PMACCNL1                                         219688
402100200616     C           ACCNTL    KLIST                                          219688
402200200616     C                     KFLD           KCNUM                           219688
402300200616     C                     KFLD           KPTFR                           219688
402400200616     C                     KFLD           KCCY                            219688
402500200616     C                     KFLD           WZACOD                          219688
402600200616     C                     KFLD           KACSQ                           219688
402700200616     C*                                                                   219688
402800200616      *
402900200616      ** Preset Key ZWACC1
403000200616     C                     MOVELMCCNUM    KCNUM
403100200616     C                     MOVELW1CURR    KCCY
403200200616     C                     MOVELMCPTFR    KPTFR
403300200616     C                     Z-ADD0         KACSQ
403400200616      *
403500200616      ** CURRENCY 1
403600200616     C** READ FIRST RECORD FOR ACCOUNT FOR THE SDSECSPD ACCOUNT CODE      219688
403700200616     C           ACCNTL    SETLLPMACCNL1                                  219688
403800200616     C                     READ PMACCNL1                 89               219688
403900200616      *                                                                   219688
404000200616     C                     MOVEL*IN89     WSAME   1                       219688
404100200616      *                                                                   219688
404200200616     C           *IN89     IFEQ '0'                                       219688
404300200616     C           CNUM      IFNE KCNUM                                     219688
404400200616     C           CCY       ORNE KCCY                                      219688
404500200616     C           PTFR      ORNE KPTFR                                     219688
404600200616     C           ACOD      ORNE WZACOD                                    219688
404700200616     C*                                                                   219688
404800200616     C           ZWACC1    SETLLPMACCNL0
404900200616     C                     READ PMACCNL0                 89
405000200616      *
405100200616     C                     MOVEL*IN89     WSAME   1
405200200616      *
405300200616     C           *IN89     IFEQ *OFF
405400200616     C           CNUM      IFNE KCNUM
405500200616     C           CCY       ORNE KCCY
405600200616     C           PTFR      ORNE KPTFR
405700200616     C*                                                                   219566
405800200616     C** IF system value 'UseDefaultSettAccnt' is 'Y' then                219566
405900200616     C**    get first record of same account and currency                 219566
406000200616     C           DEF001    IFEQ 'Y'                                       219566
406100200616     C                     MOVE *BLANKS   KPTFR                           219566
406200200616     C           ZWACC1    SETLLPMACCNL0                                  219566
406300200616     C                     READ PMACCNL0                 89               219566
406400200616      *                                                                   219566
406500200616     C           *IN89     IFEQ *OFF                                      219566
406600200616     C           CNUM      IFNE KCNUM                                     219566
406700200616     C           CCY       ORNE KCCY                                      219566
406800200616     C                     MOVEL*ON       WSAME                           219566
406900200616     C                     ENDIF                                          219566
407000200616     C                     ENDIF                                          219566
407100200616     C*                                                                   219566
407200200616     C                     ELSE                                           219566
407300200616     C                     MOVEL*ON       WSAME   1
407400200616     C                     ENDIF                           Endif DEF001=Y 219566
407500200616     C*                                                                   219566
407600200616     C                     ENDIF
407700200616     C                     ENDIF
407800200616      *
407900200616     C                     END                                            219688
408000200616     C                     END                                            219688
408100200616      *                                                                   219688
408200200616     C           WALCCY    IFEQ 'Y'
408300200616      *
408400200616      ** CURRENCY 2
408500200616     C           WSAME     IFEQ *ON
408600200616     C                     MOVELW2CURR    KCCY
408700200616      *
408800200616     C** READ FIRST RECORD FOR ACCOUNT FOR THE SDSECSPD ACCOUNT CODE      219688
408900200616     C           ACCNTL    SETLLPMACCNL1                                  219688
409000200616     C                     READ PMACCNL1                 89               219688
409100200616      *                                                                   219688
409200200616     C                     MOVEL*IN89     WSAME   1                       219688
409300200616      *                                                                   219688
409400200616     C           *IN89     IFEQ '0'                                       219688
409500200616     C           CNUM      IFNE KCNUM                                     219688
409600200616     C           CCY       ORNE KCCY                                      219688
409700200616     C           PTFR      ORNE KPTFR                                     219688
409800200616     C           ACOD      ORNE WZACOD                                    219688
409900200616     C*                                                                   219688
410000200616     C           ZWACC1    SETLLPMACCNL0
410100200616     C                     READ PMACCNL0                 89
410200200616      *
410300200616     C                     MOVEL*IN89     WSAME
410400200616      *
410500200616     C           *IN89     IFEQ *OFF
410600200616     C           CNUM      IFNE KCNUM
410700200616     C           CCY       ORNE KCCY
410800200616     C           PTFR      ORNE KPTFR
410900200616     C*                                                                   219566
411000200616     C** IF system value 'UseDefaultSettAccnt' is 'Y' then                219566
411100200616     C**    get first record of same account and currency                 219566
411200200616     C           DEF001    IFEQ 'Y'                                       219566
411300200616     C                     MOVE *BLANKS   KPTFR                           219566
411400200616     C           ZWACC1    SETLLPMACCNL0                                  219566
411500200616     C                     READ PMACCNL0                 89               219566
411600200616      *                                                                   219566
411700200616     C           *IN89     IFEQ *OFF                                      219566
411800200616     C           CNUM      IFNE KCNUM                                     219566
411900200616     C           CCY       ORNE KCCY                                      219566
412000200616     C                     MOVEL*ON       WSAME                           219566
412100200616     C                     ENDIF                                          219566
412200200616     C                     ENDIF                                          219566
412300200616     C*                                                                   219566
412400200616     C                     ELSE                                           219566
412500200616     C                     MOVEL*ON       WSAME
412600200616     C                     ENDIF                           Endif DEF001=Y 219566
412700200616     C*                                                                   219566
412800200616     C                     ENDIF
412900200616     C                     ENDIF
413000200616     C                     END                                            219688
413100200616     C                     END                                            219688
413200200616      *                                                                   219688
413300200616     C                     ENDIF
413400200616      *
413500200616      ** CURRENCY 3
413600200616     C           WSAME     IFEQ *ON
413700200616     C                     MOVELW3CURR    KCCY
413800200616     C*                                                                   219688
413900200616     C** READ FIRST RECORD FOR ACCOUNT FOR THE SDSECSPD ACCOUNT CODE      219688
414000200616     C           ACCNTL    SETLLPMACCNL1                                  219688
414100200616     C                     READ PMACCNL1                 89               219688
414200200616      *                                                                   219688
414300200616     C                     MOVEL*IN89     WSAME   1                       219688
414400200616      *                                                                   219688
414500200616     C           *IN89     IFEQ '0'                                       219688
414600200616     C           CNUM      IFNE KCNUM                                     219688
414700200616     C           CCY       ORNE KCCY                                      219688
414800200616     C           PTFR      ORNE KPTFR                                     219688
414900200616     C           ACOD      ORNE WZACOD                                    219688
415000200616     C*                                                                   219688
415100200616      *
415200200616     C           ZWACC1    SETLLPMACCNL0
415300200616     C                     READ PMACCNL0                 89
415400200616      *
415500200616     C                     MOVEL*IN89     WSAME
415600200616      *
415700200616     C           *IN89     IFEQ *OFF
415800200616     C           CNUM      IFNE KCNUM
415900200616     C           CCY       ORNE KCCY
416000200616     C           PTFR      ORNE KPTFR
416100200616     C*                                                                   219566
416200200616     C** IF system value 'UseDefaultSettAccnt' is 'Y' then                219566
416300200616     C**    get first record of same account and currency                 219566
416400200616     C           DEF001    IFEQ 'Y'                                       219566
416500200616     C                     MOVE *BLANKS   KPTFR                           219566
416600200616     C           ZWACC1    SETLLPMACCNL0                                  219566
416700200616     C                     READ PMACCNL0                 89               219566
416800200616      *                                                                   219566
416900200616     C           *IN89     IFEQ *OFF                                      219566
417000200616     C           CNUM      IFNE KCNUM                                     219566
417100200616     C           CCY       ORNE KCCY                                      219566
417200200616     C                     MOVEL*ON       WSAME                           219566
417300200616     C                     ENDIF                                          219566
417400200616     C                     ENDIF                                          219566
417500200616     C*                                                                   219566
417600200616     C                     ELSE                                           219566
417700200616     C                     MOVEL*ON       WSAME
417800200616     C                     ENDIF                           Endif DEF001=Y 219566
417900200616      *                                                                   219566
418000200616     C                     ENDIF
418100200616     C                     ENDIF
418200200616     C                     ENDIF
418300200616     C                     END                                            219688
418400200616     C                     END                                            219688
418500200616      *                                                                   219688
418600200616     C                     ENDIF
418700200616      *
418800200616     C                     ENDSR
418900200616      *****************************************************************
419000200616      /EJECT
419100200616      *****************************************************************
419200200616      *  #SACKB - Setup Account Keys and Amount fields                *
419300200616      *  ------   Book Account Keys                                   *
419400200616      *  Called by : #PDPRD                                           *
419500200616      *  Calls     : ZHASH #COAT #WACKB                               *
419600200616      *****************************************************************
419700200616      *
419800200616     C           #SACKB    BEGSR
419900200616      *
420000200616      ***  Check the processing type
420100200616      *
420200200616     C                     SELEC
420300200616      *
420400200616      ***  If the processing type is 'DV' (Income Events)
420500200616      ***     2 account keys generated on PF/SEKEYD
420600200616      *
420700200616     C           MAPTYP    WHEQ 'DV'
420800200616      *
420900200616      ***  Write key Cash Income Due - User
421000200616      *
421100200616     C                     CLEARWACKEY
421200200616      *
421300200616      ** .. Event Amount = Actual Cash Allocation + Cash Rounding
421400200616     C                     Z-ADDMCACAA    WWEVAM 170
421500200616     C                     ADD  MCACAR    WWEVAM           Book Total Cash
421600200616      *
421700200616      ***  EXECUTE HASH TOTALLING SUBROUTINE ONCE (Z=1) FOR FIRST
421800200616      ***  ARRAY ELEMENTS (IND,S DEC,S) SO S=1 ,ACCUMULATING ZZAMT(15/3)
421900200616      *
422000200616     C                     Z-ADD1         Z
422100200616     C                     Z-ADD1         S
422200200616     C                     Z-ADDWWEVAM    ZZAMT
422300200616     C                     EXSR ZHASH
422400200616      ** .. Account Key (iiiH--bbyy--mvn---DI)             Positions
422500200616     C                     MOVE WOSITP    WACITY           (1 - 3)
422600200616     C                     MOVE 'H'       WACEVC           (4)
422700200616     C                     MOVE *BLANKS   WACTRT           (5)
422800200616     C                     MOVE *BLANKS   WACPFI           (6)
422900200616     C                     MOVE MCBOOK    WACBKC           (7 - 8)
423000200616     C           BVCOTA    IFEQ 'Y'
423100200616     C                     MOVE MCCOAT    WKCOAT
423200200616     C                     EXSR #COAT
423300200616     C                     MOVE MMTSUB    WACTST           (9 - 10)
423400200616     C                     ELSE
423500200616     C                     MOVE *BLANKS   WACTST           (9 - 10)
423600200616     C                     ENDIF
423700200616     C                     MOVE *BLANKS   WACCCC           (11 - 12)
423800200616     C                     MOVE WOMKTI    WACMKT           (13)
423900200616      *
424000200616     C           BVCIAK    IFEQ 'Y'
424100200616     C           WOSCVI    ANDEQ'Y'
424200200616     C                     MOVE WOSCVI    WACCON           (14)
424300200616     C                     ELSE
424400200616     C                     MOVE *BLANKS   WACCON           (14)
424500200616     C                     ENDIF
424600200616      *
424700200616     C           BVNPAC    IFEQ 'N'
424800200616     C           WWEVAM    ORGE *ZERO
424900200616     C                     MOVE *BLANKS   WACNEG           (15)
425000200616     C                     ELSE
425100200616     C                     MOVE 'N'       WACNEG           (15)
425200200616     C                     ENDIF
425300200616      *
425400200616     C                     MOVE *BLANKS   WABLCK           (16 - 18)
425500200616     C                     MOVE 'DI'      WACAMC           (19 - 20)
425600200616      *
425700200616      ***  Write Account Key record for The book
425800200616      *
425900200616     C                     EXSR #WACKB
426000200616      *
426100200616      ***  Write key Stock Income Due - User
426200200616      *
426300200616     C                     CLEARWACKEY
426400200616      *
426500200616      ***  If subscription price is different than zero
426600200616      ** .. Event Amount = Actual stock Allocation * Subcription price
426700200616      ***  else
426800200616      ** .. Event Amount = Actual stock Allocation * maket price ex-date
426900200616     C           MDSBPR    IFNE *ZERO
427000200616     C                     Z-ADDMCASTA    WWEVAM
427100200616     C                     MULT MDSBPR    WWEVAM           Subscr. price has entered
427200200616     C                     ELSE
427300200616     C                     Z-ADDMCASTA    WWEVAM
427400200616     C                     MULT MAEXPC    WWEVAM           Subscr. price has not be entered
427500200616     C                     ENDIF
427600200616      *
427700200616      ***  If price basis is P, divide Event Amount by 100
427800200616      *
427900200616     C           WOSPBS    IFEQ 'P'
428000200616     C           WWEVAM    DIV  100       WWEVAM    H
428100200616     C                     END
428200200616      *
428300200616      ***  EXECUTE HASH TOTALLING SUBROUTINE ONCE (Z=1) FOR FIRST
428400200616      ***  ARRAY ELEMENTS (IND,S DEC,S) SO S=1 ,ACCUMULATING ZZAMT(15/3)
428500200616      *
428600200616     C                     Z-ADD1         Z
428700200616     C                     Z-ADD1         S
428800200616     C                     Z-ADDWWEVAM    ZZAMT
428900200616     C                     EXSR ZHASH
429000200616      ** .. Account Key (iiiH--bbyy--mvn---SD)             Positions
429100200616     C                     MOVE WOSITP    WACITY           (1 - 3)
429200200616     C                     MOVE 'H'       WACEVC           (4)
429300200616     C                     MOVE *BLANKS   WACTRT           (5)
429400200616     C                     MOVE *BLANKS   WACPFI           (6)
429500200616     C                     MOVE MCBOOK    WACBKC           (7 - 8)
429600200616     C           BVCOTA    IFEQ 'Y'
429700200616     C                     MOVE MCCOAT    WKCOAT
429800200616     C                     EXSR #COAT
429900200616     C                     MOVE MMTSUB    WACTST           (9 - 10)
430000200616     C                     ELSE
430100200616     C                     MOVE *BLANKS   WACTST           (9 - 10)
430200200616     C                     ENDIF
430300200616     C                     MOVE *BLANKS   WACCCC           (11 - 12)
430400200616     C                     MOVE WOMKTI    WACMKT           (13)
430500200616      *
430600200616     C           BVCIAK    IFEQ 'Y'
430700200616     C           WOSCVI    ANDEQ'Y'
430800200616     C                     MOVE WOSCVI    WACCON           (14)
430900200616     C                     ELSE
431000200616     C                     MOVE *BLANKS   WACCON           (14)
431100200616     C                     ENDIF
431200200616      *
431300200616     C           BVNPAC    IFEQ 'N'
431400200616     C           WWEVAM    ORGE *ZERO
431500200616     C                     MOVE *BLANKS   WACNEG           (15)
431600200616     C                     ELSE
431700200616     C                     MOVE 'N'       WACNEG           (15)
431800200616     C                     ENDIF
431900200616      *
432000200616     C                     MOVE *BLANKS   WABLCK           (16 - 18)
432100200616     C                     MOVE 'SD'      WACAMC           (19 - 20)
432200200616      *
432300200616      ***  Write Account Key record for The book
432400200616      *
432500200616     C                     EXSR #WACKB
432600200616      *
432700200616     C                     OTHER
432800200616      *
432900200616      ***  For all the other processing type (<> 'DV')
433000200616      *
433100200616      ***  Write key Cash Amount Due - User
433200200616      *
433300200616     C                     CLEARWACKEY
433400200616      *
433500200616      ** .. Event Amount = Actual Cash Allocation + actual cash rounding
433600200616     C                     Z-ADDMCACAA    WWEVAM
433700200616     C                     ADD  MCACAR    WWEVAM           Book Total Cash
433800200616      *
433900200616      ***  EXECUTE HASH TOTALLING SUBROUTINE ONCE (Z=1) FOR FIRST
434000200616      ***  ARRAY ELEMENTS (IND,S DEC,S) SO S=1 ,ACCUMULATING ZZAMT(15/3)
434100200616      *
434200200616     C                     Z-ADD1         Z
434300200616     C                     Z-ADD1         S
434400200616     C                     Z-ADDWWEVAM    ZZAMT
434500200616     C                     EXSR ZHASH
434600200616      ** .. Account Key (iiiX--bbyy--mvn---CD)             Positions
434700200616     C                     MOVE WOSITP    WACITY           (1 - 3)
434800200616     C                     MOVE 'X'       WACEVC           (4)
434900200616     C                     MOVE *BLANKS   WACTRT           (5)
435000200616     C                     MOVE *BLANKS   WACPFI           (6)
435100200616     C                     MOVE MCBOOK    WACBKC           (7 - 8)
435200200616     C           BVCOTA    IFEQ 'Y'
435300200616     C                     MOVE MCCOAT    WKCOAT
435400200616     C                     EXSR #COAT
435500200616     C                     MOVE MMTSUB    WACTST           (9 - 10)
435600200616     C                     ELSE
435700200616     C                     MOVE *BLANKS   WACTST           (9 - 10)
435800200616     C                     ENDIF
435900200616     C                     MOVE *BLANKS   WACCCC           (11 - 12)
436000200616     C                     MOVE WOMKTI    WACMKT           (13)
436100200616      *
436200200616     C           BVCIAK    IFEQ 'Y'
436300200616     C           WOSCVI    ANDEQ'Y'
436400200616     C                     MOVE WOSCVI    WACCON           (14)
436500200616     C                     ELSE
436600200616     C                     MOVE *BLANKS   WACCON           (14)
436700200616     C                     ENDIF
436800200616      *
436900200616     C           BVNPAC    IFEQ 'N'
437000200616     C           WWEVAM    ORGE *ZERO
437100200616     C                     MOVE *BLANKS   WACNEG           (15)
437200200616     C                     ELSE
437300200616     C                     MOVE 'N'       WACNEG           (15)
437400200616     C                     ENDIF
437500200616      *
437600200616     C                     MOVE *BLANKS   WABLCK           (16 - 18)
437700200616     C                     MOVE 'CD'      WACAMC           (19 - 20)
437800200616      *
437900200616      ***  Write Account Key record for The book
438000200616      *
438100200616     C                     EXSR #WACKB
438200200616      *
438300200616     C                     ENDSL
438400200616      *
438500200616     C                     ENDSR
438600200616      *
438700200616      *****************************************************************
438800200616      /EJECT
438900200616      *****************************************************************
439000200616      *  #SACKC - Setup Account Keys and Amount fields                *
439100200616      *  ------   Customer Account Keys                               *
439200200616      *  Called by : #PDPRD                                           *
439300200616      *  Calls     : ZHASH #AOSEC #COAT #WACKC                        *
439400200616      *****************************************************************
439500200616      *
439600200616     C           #SACKC    BEGSR
439700200616      *
439800200616      ***  Check the processing type
439900200616      *
440000200616     C                     SELEC
440100200616      *
440200200616      ***  If the processing type is 'DV' (Income Events)
440300200616      *
440400200616     C           MAPTYP    WHEQ 'DV'
440500200616      *
440600200616      ***  Write key Cash Income Due - Customer
440700200616      *
440800200616     C                     CLEARWACKEY
440900200616      *
441000200616      ** .. Event Amount = Actual Cash Allocation + Cash Rounding
441100200616     C                     Z-ADDMCACAA    WWEVAM
441200200616     C                     ADD  MCACAR    WWEVAM           Customer Total Cash
441300200616      *
441400200616      ***  EXECUTE HASH TOTALLING SUBROUTINE ONCE (Z=1) FOR FIRST
441500200616      ***  ARRAY ELEMENTS (IND,S DEC,S) SO S=1 ,ACCUMULATING ZZAMT(15/3)
441600200616      *
441700200616     C                     Z-ADD1         Z
441800200616     C                     Z-ADD1         S
441900200616     C                     Z-ADDWWEVAM    ZZAMT
442000200616     C                     EXSR ZHASH
442100200616      ** .. Account Key (iiiH-d--yy--mvn---DI)             Positions
442200200616     C                     MOVE WOSITP    WACITY           (1 - 3)
442300200616     C                     MOVE 'H'       WACEVC           (4)
442400200616     C                     MOVE *BLANKS   WACTRT           (5)
442500200616      *
442600200616      ***  If Classification is 'S' or 'D'
442700200616      ***  Issuer is not necessary a SE client defined on PF/SDSECSPD
442800200616      ***  So, no DB error if record not found !!!
442900200616      *
443000200616     C**********           MOVE WOISSR    WCUST                           163497
443100200616     C                     MOVE MCCNUM    WCUST                           163497
443200200616      *
443300200616     C                     MOVE *BLANKS   WZACOD 100                      219688
443400200616     C                     CALL 'AOSECSR0'
443500200616     C                     PARM *BLANKS   @RTCD   7
443600200616     C                     PARM '*KEY   ' @OPTN   7
443700200616     C                     PARM WCUST     @SCKY   6
443800200616     C           SDSECS    PARM SDSECS    DSSDY
443900200616      *
444000200616     C                     MOVE *BLANKS   WACPFI           (6)
444100200616     C           @RTCD     IFEQ *BLANKS
444200200616     C           BFCLAS    ANDEQ'S'
444300200616     C           @RTCD     OREQ *BLANKS
444400200616     C           BFCLAS    ANDEQ'D'
444500200616     C                     MOVE BFCLAS    WACPFI           (6)
444600200616     C                     ENDIF
444700200616      *
444800200616     C                     MOVE *BLANKS   WACBKC           (7 - 8)
444900200616      *                                                                   219688
445000200616     C                     MOVE BFACCD    WZACOD                          219688
445100200616      *                                                                   219688
445200200616     C           BVCOTA    IFEQ 'Y'
445300200616     C                     MOVE MCCOAT    WKCOAT
445400200616     C                     EXSR #COAT
445500200616     C                     MOVE MMTSUB    WACTST           (9 - 10)
445600200616     C                     ELSE
445700200616     C                     MOVE *BLANKS   WACTST           (9 - 10)
445800200616     C                     ENDIF
445900200616     C                     MOVE *BLANKS   WACCCC           (11 - 12)
446000200616     C                     MOVE WOMKTI    WACMKT           (13)
446100200616      *
446200200616     C           BVCIAK    IFEQ 'Y'
446300200616     C           WOSCVI    ANDEQ'Y'
446400200616     C                     MOVE WOSCVI    WACCON           (14)
446500200616     C                     ELSE
446600200616     C                     MOVE *BLANKS   WACCON           (14)
446700200616     C                     ENDIF
446800200616      *
446900200616     C           BVNPAC    IFEQ 'N'
447000200616     C           WWEVAM    ORGE *ZERO
447100200616     C                     MOVE *BLANKS   WACNEG           (15)
447200200616     C                     ELSE
447300200616     C                     MOVE 'N'       WACNEG           (15)
447400200616     C                     ENDIF
447500200616      *
447600200616     C                     MOVE *BLANKS   WABLCK           (16 - 18)
447700200616     C                     MOVE 'DI'      WACAMC           (19 - 20)
447800200616      *
447900200616      ***  Write Account Key record for The customer
448000200616      *
448100200616     C                     EXSR #WACKC
448200200616      *
448300200616     C                     OTHER
448400200616      *
448500200616      ***  For all the other processing type (<> 'DV')
448600200616      *
448700200616      ***  Write key Cash Amount Due - Customer
448800200616      *
448900200616     C                     CLEARWACKEY
449000200616      *
449100200616      ** .. Event Amount = Actual Cash Allocation + actual cash rounding
449200200616     C                     Z-ADDMCACAA    WWEVAM
449300200616     C                     ADD  MCACAR    WWEVAM           Customer Total Cash
449400200616      *
449500200616      ***  EXECUTE HASH TOTALLING SUBROUTINE ONCE (Z=1) FOR FIRST
449600200616      ***  ARRAY ELEMENTS (IND,S DEC,S) SO S=1 ,ACCUMULATING ZZAMT(15/3)
449700200616      *
449800200616     C                     Z-ADD1         Z
449900200616     C                     Z-ADD1         S
450000200616     C                     Z-ADDWWEVAM    ZZAMT
450100200616     C                     EXSR ZHASH
450200200616      ** .. Account Key (iiiX-d--yy--mvn---CD)             Positions
450300200616     C                     MOVE WOSITP    WACITY           (1 - 3)
450400200616     C                     MOVE 'X'       WACEVC           (4)
450500200616     C                     MOVE *BLANKS   WACTRT           (5)
450600200616      *
450700200616      ***  If Classification is 'S' or 'D'
450800200616      ***  Issuer is not necessary a SE client defined on PF/SDSECSPD
450900200616      ***  So, no DB error if record not found !!!
451000200616      *
451100200616     C                     MOVE WOISSR    WCUST
451200200616      *
451300200616     C                     MOVE *BLANKS   WZACOD                          219688
451400200616     C                     CALL 'AOSECSR0'
451500200616     C                     PARM *BLANKS   @RTCD   7
451600200616     C                     PARM '*KEY   ' @OPTN   7
451700200616     C                     PARM WCUST     @SCKY   6
451800200616     C           SDSECS    PARM SDSECS    DSSDY
451900200616      *
452000200616     C                     MOVE *BLANKS   WACPFI           (6)
452100200616     C           @RTCD     IFEQ *BLANKS
452200200616     C           BFCLAS    ANDEQ'S'
452300200616     C           @RTCD     OREQ *BLANKS
452400200616     C           BFCLAS    ANDEQ'D'
452500200616     C                     MOVE BFCLAS    WACPFI           (6)
452600200616     C                     ENDIF
452700200616      *
452800200616     C                     MOVE *BLANKS   WACBKC           (7 - 8)
452900200616      *                                                                   219688
453000200616     C                     MOVE BFACCD    WZACOD                          219688
453100200616      *                                                                   219688
453200200616     C           BVCOTA    IFEQ 'Y'
453300200616     C                     MOVE MCCOAT    WKCOAT
453400200616     C                     EXSR #COAT
453500200616     C                     MOVE MMTSUB    WACTST           (9 - 10)
453600200616     C                     ELSE
453700200616     C                     MOVE *BLANKS   WACTST           (9 - 10)
453800200616     C                     ENDIF
453900200616     C                     MOVE *BLANKS   WACCCC           (11 - 12)
454000200616     C                     MOVE WOMKTI    WACMKT           (13)
454100200616      *
454200200616     C           BVCIAK    IFEQ 'Y'
454300200616     C           WOSCVI    ANDEQ'Y'
454400200616     C                     MOVE WOSCVI    WACCON           (14)
454500200616     C                     ELSE
454600200616     C                     MOVE *BLANKS   WACCON           (14)
454700200616     C                     ENDIF
454800200616      *
454900200616     C           BVNPAC    IFEQ 'N'
455000200616     C           WWEVAM    ORGE *ZERO
455100200616     C                     MOVE *BLANKS   WACNEG           (15)
455200200616     C                     ELSE
455300200616     C                     MOVE 'N'       WACNEG           (15)
455400200616     C                     ENDIF
455500200616      *
455600200616     C                     MOVE *BLANKS   WABLCK           (16 - 18)
455700200616     C                     MOVE 'CD'      WACAMC           (19 - 20)
455800200616      *
455900200616      ***  Write Account Key record for The customer
456000200616      *
456100200616     C                     EXSR #WACKC
456200200616      *
456300200616     C                     ENDSL
456400200616      *
456500200616     C                     ENDSR
456600200616      *
456700200616      *****************************************************************
456800200616      /EJECT
456900200616      *****************************************************************
457000200616      *  #SACKD - Setup Account Keys and Amount fields                *
457100200616      *  ------   Depot Account Keys                                  *
457200200616      *  Called by : #PDPRD                                           *
457300200616      *  Calls     : ZHASH #AOSEC #COAT #WACKD                        *
457400200616      *****************************************************************
457500200616      *
457600200616     C           #SACKD    BEGSR
457700200616      *
457800200616      ***  Check the processing type
457900200616      *
458000200616     C                     SELEC
458100200616      *
458200200616      ***  If the processing type is 'DV' (Income Events)
458300200616      *
458400200616     C           MAPTYP    WHEQ 'DV'
458500200616      *
458600200616      ***  Write key Cash Income Due - Depot
458700200616      *
458800200616     C                     CLEARWACKEY
458900200616      *
459000200616      ** .. Event Amount = Actual Cash Allocation + Cash Rounding
459100200616     C                     Z-ADDMBACAA    WWEVAM
459200200616     C                     ADD  MBACAR    WWEVAM           Depot Total Cash
459300200616      *
459400200616      ***  EXECUTE HASH TOTALLING SUBROUTINE ONCE (Z=1) FOR FIRST
459500200616      ***  ARRAY ELEMENTS (IND,S DEC,S) SO S=1 ,ACCUMULATING ZZAMT(15/3)
459600200616      *
459700200616     C                     Z-ADD1         Z
459800200616     C                     Z-ADD1         S
459900200616     C                     Z-ADDWWEVAM    ZZAMT
460000200616     C                     EXSR ZHASH
460100200616      ** .. Account Key (iiiH-d--yy--mvn---DI)             Positions
460200200616     C                     MOVE WOSITP    WACITY           (1 - 3)
460300200616     C                     MOVE 'H'       WACEVC           (4)
460400200616     C                     MOVE *BLANKS   WACTRT           (5)
460500200616      *
460600200616      ***  If Classification is 'S' or 'D'
460700200616      *
460800200616     C                     MOVE MBDDPT    WCUST
460900200616     C                     EXSR #AOSEC
461000200616     C           BFCLAS    IFEQ 'S'
461100200616     C           BFCLAS    OREQ 'D'
461200200616     C                     MOVE BFCLAS    WACPFI           (6)
461300200616     C                     ELSE
461400200616     C                     MOVE *BLANKS   WACPFI           (6)
461500200616     C                     ENDIF
461600200616     C                     MOVE *BLANKS   WACBKC           (7 - 8)
461700200616     C           BVCOTA    IFEQ 'Y'
461800200616     C                     MOVE MBCOAT    WKCOAT
461900200616     C                     EXSR #COAT
462000200616     C                     MOVE MMTSUB    WACTST           (9 - 10)
462100200616     C                     ELSE
462200200616     C                     MOVE *BLANKS   WACTST           (9 - 10)
462300200616     C                     ENDIF
462400200616     C                     MOVE *BLANKS   WACCCC           (11 - 12)
462500200616     C                     MOVE WOMKTI    WACMKT           (13)
462600200616      *
462700200616     C           BVCIAK    IFEQ 'Y'
462800200616     C           WOSCVI    ANDEQ'Y'
462900200616     C                     MOVE WOSCVI    WACCON           (14)
463000200616     C                     ELSE
463100200616     C                     MOVE *BLANKS   WACCON           (14)
463200200616     C                     ENDIF
463300200616      *
463400200616     C           BVNPAC    IFEQ 'N'
463500200616     C           WWEVAM    ORGE *ZERO
463600200616     C                     MOVE *BLANKS   WACNEG           (15)
463700200616     C                     ELSE
463800200616     C                     MOVE 'N'       WACNEG           (15)
463900200616     C                     ENDIF
464000200616      *
464100200616     C                     MOVE *BLANKS   WABLCK           (16 - 18)
464200200616     C                     MOVE 'DI'      WACAMC           (19 - 20)
464300200616      *
464400200616      ***  Write Account Key record for The depot
464500200616      *
464600200616     C                     EXSR #WACKD
464700200616      *
464800200616     C                     OTHER
464900200616      *
465000200616      ***  For all the other processing type (<> 'DV')
465100200616      *
465200200616      ***  Write key Cash Amount Due - Depot
465300200616      *
465400200616     C                     CLEARWACKEY
465500200616      *
465600200616      ** .. Event Amount = Actual Cash Allocation + actual cash rounding
465700200616     C                     Z-ADDMBACAA    WWEVAM
465800200616     C                     ADD  MBACAR    WWEVAM           Depot Total Cash
465900200616      *
466000200616      ***  EXECUTE HASH TOTALLING SUBROUTINE ONCE (Z=1) FOR FIRST
466100200616      ***  ARRAY ELEMENTS (IND,S DEC,S) SO S=1 ,ACCUMULATING ZZAMT(15/3)
466200200616      *
466300200616     C                     Z-ADD1         Z
466400200616     C                     Z-ADD1         S
466500200616     C                     Z-ADDWWEVAM    ZZAMT
466600200616     C                     EXSR ZHASH
466700200616      ** .. Account Key (iiiX-d--yy--mvn---CD)             Positions
466800200616     C                     MOVE WOSITP    WACITY           (1 - 3)
466900200616     C                     MOVE 'X'       WACEVC           (4)
467000200616     C                     MOVE *BLANKS   WACTRT           (5)
467100200616      *
467200200616      ***  If Classification is 'S' or 'D'
467300200616      *
467400200616     C                     MOVE MBDDPT    WCUST
467500200616     C                     EXSR #AOSEC
467600200616     C*****      BFCLAS    IFEQ 'S'                                       151157
467700200616     C*****      BFCLAS    OREQ 'D'                                       151157
467800200616     C*****                MOVE BFCLAS    WACPFI           (6)            151157
467900200616     C*****                ELSE                                           151157
468000200616     C*****                MOVE *BLANKS   WACPFI           (6)            151157
468100200616     C*****                ENDIF                                          151157
468200200616     C                     MOVE 'X'       WACPFI           (6)            151157
468300200616     C                     MOVE *BLANKS   WACBKC           (7 - 8)
468400200616     C           BVCOTA    IFEQ 'Y'
468500200616     C                     MOVE MBCOAT    WKCOAT
468600200616     C                     EXSR #COAT
468700200616     C                     MOVE MMTSUB    WACTST           (9 - 10)
468800200616     C                     ELSE
468900200616     C                     MOVE *BLANKS   WACTST           (9 - 10)
469000200616     C                     ENDIF
469100200616     C                     MOVE *BLANKS   WACCCC           (11 - 12)
469200200616     C                     MOVE WOMKTI    WACMKT           (13)
469300200616      *
469400200616     C           BVCIAK    IFEQ 'Y'
469500200616     C           WOSCVI    ANDEQ'Y'
469600200616     C                     MOVE WOSCVI    WACCON           (14)
469700200616     C                     ELSE
469800200616     C                     MOVE *BLANKS   WACCON           (14)
469900200616     C                     ENDIF
470000200616      *
470100200616     C           BVNPAC    IFEQ 'N'
470200200616     C           WWEVAM    ORGE *ZERO
470300200616     C                     MOVE *BLANKS   WACNEG           (15)
470400200616     C                     ELSE
470500200616     C                     MOVE 'N'       WACNEG           (15)
470600200616     C                     ENDIF
470700200616      *
470800200616     C                     MOVE *BLANKS   WABLCK           (16 - 18)
470900200616     C                     MOVE 'CD'      WACAMC           (19 - 20)
471000200616      *
471100200616      ***  Write Account Key record for The depot
471200200616      *
471300200616     C                     EXSR #WACKD
471400200616      *
471500200616     C                     ENDSL
471600200616      *
471700200616     C                     ENDSR
471800200616      *
471900200616      *****************************************************************
472000200616      /EJECT
472100200616      *****************************************************************
472200200616      *  #WACKB - Write an account key for BOOK                       *
472300200616      *  ------                                                       *
472400200616      *  Called by : #SACKB                                           *
472500200616      *  Calls     : None                                             *
472600200616      *****************************************************************
472700200616      *
472800200616     C           #WACKB    BEGSR
472900200616      *
473000200616     C                     CLEARSEKEYDF
473100200616      *
473200200616      ** .. Account key
473300200616     C                     MOVELWACKEY    ACKY
473400200616      ** .. Trade Reference
473500200616     C                     Z-ADD*ZERO     TRFR
473600200616      ** .. Customer Number
473700200616     C**********           Z-ADDWOISSR    CSTN                                                CSD027
473800200616     C                     MOVE WOISSR    CSTN                                                CSD027
473900200616      ** .. Booking branch
474000200616     C                     MOVE MCBRCD    BRHA
474100200616      ** .. A/C Sequence
474200200616     C                     Z-ADD*ZERO     ASQN
474300200616      ** .. Event amount
474400200616     C                     Z-ADDWWEVAM    EVAM
474500200616      ** .. Event Date
474600200616     C                     Z-ADDMAEVDT    EVDT
474700200616      ** .. Event Ccy
474800200616     C           MAPTYP    IFNE 'CC'                                      CEU017
474900200616     C                     MOVE WONMCY    EVCY
475000200616     C                     ELSE                                           CEU017
475100200616     C                     MOVE NANCCY    EVCY                            CEU017
475200200616     C                     ENDIF                                          CEU017
475300200616      ** .. Settlement Type
475400200616     C                     Z-ADD*ZERO     STLT
475500200616      ** .. Settlement Account
475600200616     C                     MOVE *BLANKS   STLA
475700200616      ** .. Settlement Branch
475800200616     C                     MOVE *BLANKS   SEBR
475900200616      ** .. Reversal indicator
476000200616     C           MACHTP    IFEQ 'R'
476100200616     C                     MOVE '1'       RVRS
476200200616     C                     ELSE
476300200616     C                     MOVE '0'       RVRS
476400200616     C                     ENDIF
476500200616      ** .. Issuer
476600200616     C**********           Z-ADDWOISSR    ISSR                                                CSD027
476700200616     C                     MOVE WOISSR    ISSR                                                CSD027
476800200616      ** .. Tour depot customer
476900200616     C**********           Z-ADD*ZEROS    KCUST                                               CSD027
477000200616     C                     MOVE *BLANKS   KCUST                                               CSD027
477100200616      ** .. Nominal Ccy amount
477200200616     C                     Z-ADD*ZEROS    KNCA
477300200616      ** .. Nominal Ccy
477400200616     C           MAPTYP    IFNE 'CC'                                      CEU017
477500200616     C                     MOVE WONMCY    KCCY
477600200616     C                     ELSE                                           CEU017
477700200616     C                     MOVE NANCCY    KCCY                            CEU017
477800200616     C                     ENDIF                                          CEU017
477900200616      ** .. Base Ccy Amount
478000200616     C                     Z-ADD*ZEROS    KBCA
478100200616      ** .. Security Shortname
478200200616     C           MCSESN    IFEQ '**CASH**'
478300200616     C                     MOVELMASESN    SESH      P
478400200616     C                     ELSE
478500200616     C                     MOVELMCSESN    SESH      P
478600200616     C                     ENDIF
478700200616      ** .. Profit Centre
478800200616     C                     MOVE *BLANKS   PRFC
478900200616      *
479000200616      ***   If Profit Centre used
479100200616      *
479200200616     C           BKPRCU    IFEQ 'Y'
479300200616      *
479400200616     C                     MOVELCSTN      WKPCPY           Customer
479500200616     C                     MOVELBRHA      WKPBCA           Branch
479600200616     C                     MOVELSESH      WKPSSH    P      Security
479700200616      *
479800200616     C           KWSEPC    CHAINSEPCCDF              89
479900200616     C           *IN89     IFEQ *OFF
480000200616     C                     MOVELPCCU      PRFC
480100200616     C                     ELSE
480200200616     C                     MOVELWOSESN    WKDPSS           Event Security
480300200616     C           KWSEPC    CHAINSEPCCDF              89
480400200616     C           *IN89     IFEQ *OFF
480500200616     C                     MOVELPCCU      PRFC
480600200616     C                     ENDIF
480700200616     C                     ENDIF
480800200616     C                     ENDIF
480900200616      *
481000200616      ***  Analytical Accounting module is ON and Profit Centre is ON
481100200616      *
481200200616     C           BGN0ST    IFEQ 'Y'
481300200616     C           PRFC      ANDEQ*BLANKS
481400200616     C                     MOVE BVSEPC    PRFC
481500200616     C                     ENDIF
481600200616      ** .. Portfolio Reference
481700200616     C                     MOVE *BLANKS   PTFR
481800200616      ** .. Trans. Type
481900200616     C                     MOVE *BLANKS   PEV1
482000200616      ** .. Transaction number of last update
482100200616     C                     Z-ADD*ZERO     TNLU
482200200616      ** .. Record ID
482300200616     C                     MOVE 'D'       RECI
482400200616      *                                                                                       CGL020
482500200616      ** If Midas Compliance Watch is installed                                               CGL020
482600200616      *                                                                                       CGL020
482700200616     C           CGL020    IFEQ 'Y'                                                           CGL020
482800200616     C                     EXSR SRAMPR                                                        CGL020
482900200616     C                     ENDIF                                                              CGL020
483000200616      *
483100200616      ***  Write account key record
483200200616      *
483300200616     C                     WRITESEKEYDF
483400200616      *
483500200616      ***  Count Records Written
483600200616      *
483700200616     C                     ADD  1         W01CNT
483800200616     C                     MOVE 'Y'       WWDATA           one Read
483900200616      *
484000200616     C                     ENDSR
484100200616      *
484200200616      *****************************************************************
484300200616      /EJECT
484400200616      *****************************************************************
484500200616      *  #WACKC - Write an account key for CUSTOMER                   *
484600200616      *  ------                                                       *
484700200616      *  Called by : #SACKC                                           *
484800200616      *  Calls     : ZSETAC                                           *
484900200616      *****************************************************************
485000200616      *
485100200616     C           #WACKC    BEGSR
485200200616      *
485300200616     C                     CLEARSEKEYDF
485400200616      ** .. Account key
485500200616     C                     MOVELWACKEY    ACKY
485600200616      ** .. Trade Reference
485700200616     C                     Z-ADD*ZERO     TRFR
485800200616      ** .. Customer Number
485900200616     C**********           Z-ADDMCCNUM    CSTN                                                CSD027
486000200616     C                     MOVE MCCNUM    CSTN                                                CSD027
486100200616      ** .. Booking branch
486200200616     C                     MOVE MCBRCD    BRHA
486300200616      ** .. A/C Sequence
486400200616     C                     Z-ADD*ZERO     ASQN
486500200616      ** .. Event Date
486600200616     C                     Z-ADDMAEVDT    EVDT
486700200616      ** .. Event Amount
486800200616     C                     Z-ADDWWEVAM    EVAM
486900200616      ** .. Event Ccy
487000200616     C           MAPTYP    IFNE 'CC'                                      CEU017
487100200616     C                     MOVE WONMCY    EVCY
487200200616     C                     ELSE                                           CEU017
487300200616     C                     MOVE NANCCY    EVCY                            CEU017
487400200616     C                     ENDIF                                          CEU017
487500200616      ** .. Settlement Type
487600200616     C                     Z-ADD*ZERO     STLT
487700200616      ** .. Settlement Account
487800200616     C                     MOVE *BLANKS   STLA
487900200616      ** .. Settlement Branch
488000200616     C                     MOVE *BLANKS   SEBR
488100200616      *
488200200616     C           EXBCSI    IFEQ 'Y'                        Standard Instruction exist
488300200616      *
488400200616      ** .. Settlement Type
488500200616     C                     Z-ADDMOSMET    STLT
488600200616      ** .. Settlement Account
488700200616     C                     MOVE MOSACC    STLA
488800200616      ** .. Settlement Branch
488900200616     C                     MOVE MOSBRC    SEBR
489000200616      *
489100200616     C                     ELSE
489200200616      *
489300200616     C           BGPFMG    IFNE 'Y'                        Portfolio Management OFF
489400200616     C           BGN4ST    ANDNE'Y'                                       CPB001
489500200616      *
489600200616      ***  For Settlement Instruction access STDSED with key of
489700200616      ***  Branch and Customer,SECODPPD, Nominal CCY and Investment
489800200616      ***  Type,SECTYD
489900200616      *
490000200616     C                     MOVE MCBRCD    WKPBCA           Branch
490100200616     C**********           Z-ADDMCCNUM    WKPCPY           Customer                           CSD027
490200200616     C                     MOVE MCCNUM    WKPCPY           Customer                           CSD027
490300200616     C                     MOVE WONMCY    WKNMCY           Nominal Ccy
490400200616     C                     MOVE WOSITP    WKSITP           Sec. Inv. Type
490500200616     C                     MOVE WOSMCC    WKSMCC                                              CSE034
490600200616      *                                                                                       CSE028
490700200616     C           CSE028    IFEQ 'Y'                                                           CSE028
490800200616     C                     MOVE MCBOOK    WKPBCD           Book Code                          CSE028
490900200616     C                     MOVE MCPTFR    WKPTFR           Portfolio Reference                CSE028
491000200616     C                     ELSE                                                               CSE028
491100200616     C                     MOVE *BLANKS   WKPBCD           Book Code                          CSE028
491200200616     C                     MOVE *BLANKS   WKPTFR           Portfolio Reference                CSE028
491300200616     C                     ENDIF                                                              CSE028
491400200616      *                                                                                       CSE028
491500200616      ** If CSE028 is on, call SESSIR0 for default of MT5xx information                       CSE028
491600200616      *                                                                                       CSE028
491700200616     C           CSE028    IFEQ 'Y'                                                           CSE028
491800200616      *                                                                                       CSE028
491900200616     C                     EXSR SRSSIR                                                        CSE028
492000200616     C           NOTFND    IFEQ 'Y'                                                           CSE028
492100200616     C                     MOVE '1'       *IN89                                               CSE028
492200200616     C                     ELSE                                                               CSE028
492300200616     C                     MOVE '0'       *IN89                                               CSE028
492400200616     C                     ENDIF                                                              CSE028
492500200616      *                                                                                       CSE028
492600200616     C                     ELSE                                                               CSE028
492700200616      *                                                                                       CSE028
492800200616     C           KWSTDS    CHAINSTDSED               89
492900200616     C           *IN89     IFEQ *ON
493000200616     C                     MOVEL*BLANKS   WKSITP
493100200616     C           KWSTDS    CHAINSTDSED               89
493200200616     C                     ENDIF
493300200616      *                                                                                       CSE028
493400200616     C                     ENDIF                                                              CSE028
493500200616      *                                                                                       CSE028
493600200616     C/COPY WNCPYSRC,SE7561C007
493700200616     C           *IN89     IFEQ *OFF
493800200616      *                                                                   135691
493900200616      * CEU005 active and Settlement Ccy used on STDSED.                  135691
494000200616     C           CEU005    IFEQ 'Y'                                       135691
494100200616     C           SCCY      ANDNE*BLANKS                                   135691
494200200616     C                     MOVE SCCY      SVSCCY  3                       135691
494300200616      *                                                                   135691
494400200616      * Access currencies file for EURO rate, EURO M/D indicator and      135691
494500200616      * Transition Date for 'In' Ccy.                                     135691
494600200616      *                                                                   135691
494700200616     C           WONMCY    IFEQ BKEURO                                    135691
494800200616     C                     CALL 'AOCURRR0'                                135691
494900200616     C                     PARM           @RTCD   7                       135691
495000200616     C                     PARM '*KEY   ' @OPTN   7                       135691
495100200616     C                     PARM SCCY      @AJCD   3                       135691
495200200616     C           SDCURR    PARM SDCURR    DSSDY                           135691
495300200616     C           @RTCD     IFNE *BLANKS                                   135691
495400200616     C                     Z-ADD44        DBASE             ************  135691
495500200616     C                     MOVEL'SDCURRPD'DBFILE            * DATABASE *  135691
495600200616     C                     MOVELSCCY      DBKEY             * ERROR 44 *  135691
495700200616     C                     EXSR *PSSR                       ************  135691
495800200616     C                     ENDIF                                          135691
495900200616     C                     ELSE                                           135691
496000200616     C           SCCY      IFEQ BKEURO                                    135691
496100200616     C                     CALL 'AOCURRR0'                                135691
496200200616     C                     PARM           @RTCD   7                       135691
496300200616     C                     PARM '*KEY   ' @OPTN   7                       135691
496400200616     C                     PARM WONMCY    @AJCD   3                       135691
496500200616     C           SDCURR    PARM SDCURR    DSSDY                           135691
496600200616     C           @RTCD     IFNE *BLANKS                                   135691
496700200616     C                     Z-ADD45        DBASE             ************  135691
496800200616     C                     MOVEL'SDCURRPD'DBFILE            * DATABASE *  135691
496900200616     C                     MOVELWONMCY    DBKEY             * ERROR 45 *  135691
497000200616     C                     EXSR *PSSR                       ************  135691
497100200616     C                     ENDIF                                          135691
497200200616     C                     ENDIF                                          135691
497300200616     C                     ENDIF                                          135691
497400200616      *                                                                   135691
497500200616     C                     MOVE A6EUMD    SVEUMD                          135691
497600200616     C                     MOVE A6EUER    SVEUER                          135691
497700200616      *                                                                   135691
497800200616      * Value date is later than Transition Start Date.                   135691
497900200616     C           MACOPD    IFGE A6TPSD                                    135691
498000200616      * Chain STDSED again.                                               135691
498100200616     C                     MOVE SCCY      WKNMCY           Nominal Ccy    135691
498200200616      *                                                                                       CSE028
498300200616      ** If CSE028 is on, call SESSIR0 for default of MT5xx information                       CSE028
498400200616      *                                                                                       CSE028
498500200616     C           CSE028    IFEQ 'Y'                                                           CSE028
498600200616      *                                                                                       CSE028
498700200616     C                     EXSR SRSSIR                                                        CSE028
498800200616     C           NOTFND    IFEQ 'Y'                                                           CSE028
498900200616     C                     MOVE '1'       *IN78                                               CSE028
499000200616     C                     ELSE                                                               CSE028
499100200616     C                     MOVE '0'       *IN78                                               CSE028
499200200616     C                     ENDIF                                                              CSE028
499300200616      *                                                                                       CSE028
499400200616     C                     ELSE                                                               CSE028
499500200616      *                                                                                       CSE028
499600200616     C           KWSTDS    CHAINSTDSED               78                   135691
499700200616      *                                                                                       CSE028
499800200616     C                     ENDIF                                                              CSE028
499900200616      *                                                                                       CSE028
500000200616     C/COPY WNCPYSRC,SE7561C008
500100200616     C                     ENDIF                                          135691
500200200616     C                     ENDIF                                          135691
500300200616      *                                                                   135691
500400200616      * If no record found ensure fields from last chain not loaded       135691
500500200616      * to output fields.                                                 135691
500600200616     C           *IN78     IFEQ '0'                                       135691
500700200616      ** .. Settlement Type
500800200616     C                     Z-ADDSRSM      STLT
500900200616      ** .. Settlement Account
501000200616     C                     MOVELSRAC      STLA
501100200616      ** .. Settlement Branch
501200200616     C                     MOVELSRAB      SEBR
501300200616      *
501400200616      ***  If SRSM = 04 and SRAC = BLANKS the determine settlement A/C
501500200616      ***     via SR/ZSETAC  and output to field STLA
501600200616      *
501700200616     C           SRSM      IFEQ 04
501800200616     C           SRAC      ANDEQ*BLANK
501900200616      *
502000200616      ***  Pass Parameters to SR/ZSETAC and execute routine
502100200616      *
502200200616     C                     MOVE SRSM      ZMETH
502300200616     C                     MOVE SRAC      ZSETI
502400200616     C                     MOVE MCCNUM    ZCNUM
502500200616     C           CEU005    IFEQ 'Y'                                       135691
502600200616     C           SCCY      ANDNE*BLANKS                                   135691
502700200616     C                     MOVE SCCY      ZCCY                            135691
502800200616     C                     ELSE                                           135691
502900200616     C                     MOVE WONMCY    ZCCY
503000200616     C                     ENDIF                                          135691
503100200616     C                     MOVE SRAB      ZBRCA
503200200616     C                     EXSR ZSETAC
503300200616     C                     MOVELZSETO     STLA
503400200616     C                     MOVELZWBRCA    SEBR
503500200616     C                     ENDIF
503600200616     C                     ENDIF
503700200616     C                     ENDIF                                          135691
503800200616      *
503900200616     C                     ELSE                            Portfolio Management ON
504000200616     C                     MOVE 'N'       WALCCY  1
504100200616     C                     EXSR #SETIN
504200200616      *
504300200616      ** If Account found in any of currencies checked
504400200616     C           WSAME     IFEQ *OFF
504500200616      ** .. Settlement Type
504600200616     C                     MOVE '05'      STLT
504700200616      ** .. Settlement Account
504800200616     C                     MOVELPSEA1     STLA
504900200616      ** .. Settlement Branch
505000200616     C                     MOVE BRCA      SEBR
505100200616      *
505200200616     C                     ELSE
505300200616      *
505400200616      ** .. Settlement Type
505500200616     C                     MOVE *BLANKS   STLT
505600200616      ** .. Settlement Account
505700200616     C                     MOVE *BLANKS   STLA
505800200616      ** .. Settlement Branch
505900200616     C                     MOVE *BLANKS   SEBR
506000200616     C                     ENDIF
506100200616      *
506200200616     C                     ENDIF
506300200616      *
506400200616     C                     ENDIF
506500200616      *
506600200616      ** .. Reversal indicator
506700200616     C           MACHTP    IFEQ 'R'
506800200616     C                     MOVE '1'       RVRS
506900200616     C                     ELSE
507000200616     C                     MOVE '0'       RVRS
507100200616     C                     ENDIF
507200200616      ** .. Issuer
507300200616     C**********           Z-ADDWOISSR    ISSR                                                CSD027
507400200616     C                     MOVE WOISSR    ISSR                                                CSD027
507500200616      ** .. Tour depot customer
507600200616     C**********           Z-ADDMCCNUM    KCUST                                               CSD027
507700200616     C                     MOVE MCCNUM    KCUST                                               CSD027
507800200616      ** .. Nominal Ccy amount
507900200616     C                     Z-ADD*ZEROS    KNCA
508000200616      ** .. Nominal Ccy
508100200616     C           MAPTYP    IFNE 'CC'                                      CEU017
508200200616     C                     MOVE WONMCY    KCCY
508300200616     C                     ELSE                                           CEU017
508400200616     C                     MOVE NANCCY    KCCY                            CEU017
508500200616     C                     ENDIF                                          CEU017
508600200616      ** .. Base Ccy Amount
508700200616     C                     Z-ADD*ZEROS    KBCA
508800200616      ** .. Security Shortname
508900200616     C           MCSESN    IFEQ '**CASH**'
509000200616     C                     MOVELMASESN    SESH      P
509100200616     C                     ELSE
509200200616     C                     MOVELMCSESN    SESH      P
509300200616     C                     ENDIF
509400200616      ** .. Profit Centre
509500200616     C                     MOVE *BLANKS   PRFC
509600200616      *
509700200616      ***   If Profit Centre used
509800200616      *
509900200616     C           BKPRCU    IFEQ 'Y'
510000200616      *
510100200616     C                     MOVELCSTN      WKPCPY           Customer
510200200616     C                     MOVELBRHA      WKPBCA           Branch
510300200616     C                     MOVELSESH      WKPSSH    P      Security
510400200616      *
510500200616     C           KWSEPC    CHAINSEPCCDF              89
510600200616     C           *IN89     IFEQ *OFF
510700200616     C                     MOVELPCCU      PRFC
510800200616     C                     ELSE
510900200616     C                     MOVELWOSESN    WKDPSS           Event Security
511000200616     C           KWSEPC    CHAINSEPCCDF              89
511100200616     C           *IN89     IFEQ *OFF
511200200616     C                     MOVELPCCU      PRFC
511300200616     C                     ENDIF
511400200616     C                     ENDIF
511500200616     C                     ENDIF
511600200616      *
511700200616      ***  Analytical Accounting module is ON and Profit Centre is ON
511800200616      *
511900200616     C           BGN0ST    IFEQ 'Y'
512000200616     C           PRFC      ANDEQ*BLANKS
512100200616     C                     MOVE BVSEPC    PRFC
512200200616     C                     ENDIF
512300200616      ** .. Portfolio Reference
512400200616     C                     MOVE MCPTFR    PTFR
512500200616      ** .. Trans. Type
512600200616     C                     MOVE *BLANKS   PEV1
512700200616      ** .. Transaction number of last update
512800200616     C                     Z-ADD*ZERO     TNLU
512900200616      ** .. Record ID
513000200616     C                     MOVE 'D'       RECI
513100200616      *                                                                                       CGL020
513200200616      ** If Midas Compliance Watch is installed                                               CGL020
513300200616      *                                                                                       CGL020
513400200616     C           CGL020    IFEQ 'Y'                                                           CGL020
513500200616     C                     EXSR SRAMPR                                                        CGL020
513600200616     C                     ENDIF                                                              CGL020
513700200616      *
513800200616      ***  Write account key record
513900200616      *
514000200616     C                     WRITESEKEYDF
514100200616      *
514200200616      ***  Count Records Written
514300200616      *
514400200616     C                     ADD  1         W01CNT
514500200616     C                     MOVE 'Y'       WWDATA           one Read
514600200616      *
514700200616     C                     ENDSR
514800200616      *
514900200616      *****************************************************************
515000200616      /EJECT
515100200616      *****************************************************************
515200200616      *  #WACKD - Write an account key for DEPOT                      *
515300200616      *  ------                                                       *
515400200616      *  Called by : #SACKD                                           *
515500200616      *  Calls     : ZSETAC                                           *
515600200616      *****************************************************************
515700200616      *
515800200616     C           #WACKD    BEGSR
515900200616      *
516000200616     C                     CLEARSEKEYDF
516100200616      ** .. Account key
516200200616     C                     MOVELWACKEY    ACKY
516300200616      ** .. Trade Reference
516400200616     C                     Z-ADD*ZERO     TRFR
516500200616      ** .. Customer Number
516600200616     C**********           Z-ADDMBDDPT    CSTN                                                CSD027
516700200616     C                     MOVE MBDDPT    CSTN                                                CSD027
516800200616      ** .. Booking branch
516900200616     C                     MOVE MBBRCD    BRHA
517000200616      ** .. A/C Sequence
517100200616     C                     Z-ADD*ZERO     ASQN
517200200616      ** .. Event Date
517300200616     C                     Z-ADDMAEVDT    EVDT
517400200616      ** .. Event Amount
517500200616     C                     Z-ADDWWEVAM    EVAM
517600200616      ** .. Event Ccy
517700200616     C           MAPTYP    IFNE 'CC'                                      CEU017
517800200616     C                     MOVE WONMCY    EVCY
517900200616     C                     ELSE                                           CEU017
518000200616     C                     MOVE NANCCY    EVCY                            CEU017
518100200616     C                     ENDIF                                          CEU017
518200200616      ** .. Settlement Type
518300200616     C                     Z-ADD*ZERO     STLT
518400200616      ** .. Settlement Account
518500200616     C                     MOVE *BLANKS   STLA
518600200616      ** .. Settlement Branch
518700200616     C                     MOVE *BLANKS   SEBR
518800200616      *
518900200616     C           EXBCSI    IFEQ 'Y'                        Standard Instruction exist
519000200616      *
519100200616      ** .. Settlement Type
519200200616     C                     Z-ADDMOSMET    STLT
519300200616      ** .. Settlement Account
519400200616     C                     MOVE MOSACC    STLA
519500200616      ** .. Settlement Branch
519600200616     C                     MOVE MOSBRC    SEBR
519700200616      *
519800200616     C                     ELSE
519900200616      *
520000200616      ***  For Settlement Instruction access STDSED with key of
520100200616      ***  Branch and Customer,SECODPPD, Nominal CCY and Investment
520200200616      ***  Type,SECTYD
520300200616      *
520400200616     C                     MOVE MBBRCD    WKPBCA           Branch
520500200616     C**********           Z-ADDMBDDPT    WKPCPY           Customer                           CSD027
520600200616     C                     MOVE MBDDPT    WKPCPY           Customer                           CSD027
520700200616     C                     MOVE WONMCY    WKNMCY           Nominal Ccy
520800200616     C                     MOVE WOSITP    WKSITP           Sec. Inv. Type
520900200616     C                     MOVE WOSMCC    WKSMCC                                              CSE034
521000200616      *                                                                                       CSE028
521100200616     C           CSE028    IFEQ 'Y'                                                           CSE028
521200200616     C                     MOVE BVDMBC    WKPBCD           Book Code                          CSE028
521300200616     C                     MOVE *BLANKS   WKPTFR           Portfolio Reference                CSE028
521400200616     C                     ELSE                                                               CSE028
521500200616     C                     MOVE *BLANKS   WKPBCD           Book Code                          CSE028
521600200616     C                     MOVE *BLANKS   WKPTFR           Portfolio Reference                CSE028
521700200616     C                     ENDIF                                                              CSE028
521800200616      *                                                                                       CSE028
521900200616      ** If CSE028 is on, call SESSIR0 for default of MT5xx information                       CSE028
522000200616      *                                                                                       CSE028
522100200616     C           CSE028    IFEQ 'Y'                                                           CSE028
522200200616      *                                                                                       CSE028
522300200616     C                     EXSR SRSSIR                                                        CSE028
522400200616     C           NOTFND    IFEQ 'Y'                                                           CSE028
522500200616     C                     MOVE '1'       *IN89                                               CSE028
522600200616     C                     ELSE                                                               CSE028
522700200616     C                     MOVE '0'       *IN89                                               CSE028
522800200616     C                     ENDIF                                                              CSE028
522900200616      *                                                                                       CSE028
523000200616     C                     ELSE                                                               CSE028
523100200616      *                                                                                       CSE028
523200200616     C           KWSTDS    CHAINSTDSED               89
523300200616     C           *IN89     IFEQ *ON
523400200616     C                     MOVEL*BLANKS   WKSITP
523500200616     C           KWSTDS    CHAINSTDSED               89
523600200616     C                     ENDIF
523700200616      *                                                                                       CSE028
523800200616     C                     ENDIF                                                              CSE028
523900200616      *                                                                                       CSE028
524000200616     C/COPY WNCPYSRC,SE7561C009
524100200616     C           *IN89     IFEQ *OFF
524200200616      *                                                                   135691
524300200616      * CEU005 active and Settlement Ccy used on STDSED.                  135691
524400200616     C           CEU005    IFEQ 'Y'                                       135691
524500200616     C           SCCY      ANDNE*BLANKS                                   135691
524600200616     C                     MOVE SCCY      SVSCCY  3                       135691
524700200616      *                                                                   135691
524800200616      * Access currencies file for EURO rate, EURO M/D indicator and      135691
524900200616      * Transition Date for 'In' Ccy.                                     135691
525000200616      *                                                                   135691
525100200616     C           WONMCY    IFEQ BKEURO                                    135691
525200200616     C                     CALL 'AOCURRR0'                                135691
525300200616     C                     PARM           @RTCD   7                       135691
525400200616     C                     PARM '*KEY   ' @OPTN   7                       135691
525500200616     C                     PARM SCCY      @AJCD   3                       135691
525600200616     C           SDCURR    PARM SDCURR    DSSDY                           135691
525700200616     C           @RTCD     IFNE *BLANKS                                   135691
525800200616     C                     Z-ADD44        DBASE             ************  135691
525900200616     C                     MOVEL'SDCURRPD'DBFILE            * DATABASE *  135691
526000200616     C                     MOVELSCCY      DBKEY             * ERROR 44 *  135691
526100200616     C                     EXSR *PSSR                       ************  135691
526200200616     C                     ENDIF                                          135691
526300200616     C                     ELSE                                           135691
526400200616     C           SCCY      IFEQ BKEURO                                    135691
526500200616     C                     CALL 'AOCURRR0'                                135691
526600200616     C                     PARM           @RTCD   7                       135691
526700200616     C                     PARM '*KEY   ' @OPTN   7                       135691
526800200616     C                     PARM WONMCY    @AJCD   3                       135691
526900200616     C           SDCURR    PARM SDCURR    DSSDY                           135691
527000200616     C           @RTCD     IFNE *BLANKS                                   135691
527100200616     C                     Z-ADD45        DBASE             ************  135691
527200200616     C                     MOVEL'SDCURRPD'DBFILE            * DATABASE *  135691
527300200616     C                     MOVELWONMCY    DBKEY             * ERROR 45 *  135691
527400200616     C                     EXSR *PSSR                       ************  135691
527500200616     C                     ENDIF                                          135691
527600200616     C                     ENDIF                                          135691
527700200616     C                     ENDIF                                          135691
527800200616      *                                                                   135691
527900200616     C                     MOVE A6EUMD    SVEUMD                          135691
528000200616     C                     MOVE A6EUER    SVEUER                          135691
528100200616      *                                                                   135691
528200200616      * Value date is later than Transition Start Date.                   135691
528300200616     C           MACOPD    IFGE A6TPSD                                    135691
528400200616      * Chain STDSED again.                                               135691
528500200616     C                     MOVE SCCY      WKNMCY           Nominal Ccy    135691
528600200616      *                                                                                       CSE028
528700200616      ** If CSE028 is on, call SESSIR0 for default of MT5xx information                       CSE028
528800200616      *                                                                                       CSE028
528900200616     C           CSE028    IFEQ 'Y'                                                           CSE028
529000200616      *                                                                                       CSE028
529100200616     C                     EXSR SRSSIR                                                        CSE028
529200200616     C           NOTFND    IFEQ 'Y'                                                           CSE028
529300200616     C                     MOVE '1'       *IN78                                               CSE028
529400200616     C                     ELSE                                                               CSE028
529500200616     C                     MOVE '0'       *IN78                                               CSE028
529600200616     C                     ENDIF                                                              CSE028
529700200616      *                                                                                       CSE028
529800200616     C                     ELSE                                                               CSE028
529900200616      *                                                                                       CSE028
530000200616     C           KWSTDS    CHAINSTDSED               78                   135691
530100200616      *                                                                                       CSE028
530200200616     C                     ENDIF                                                              CSE028
530300200616      *                                                                                       CSE028
530400200616     C/COPY WNCPYSRC,SE7561C010
530500200616     C                     ENDIF                                          135691
530600200616     C                     ENDIF                                          135691
530700200616      *                                                                   135691
530800200616      * If no record found ensure fields from last chain not loaded       135691
530900200616      * to output fields.                                                 135691
531000200616     C           *IN78     IFEQ '0'                                       135691
531100200616      ** .. Settlement Type
531200200616     C                     Z-ADDSRSM      STLT
531300200616      ** .. Settlement Account
531400200616     C                     MOVELSRAC      STLA
531500200616      ** .. Settlement Branch
531600200616     C                     MOVELSRAB      SEBR
531700200616      *
531800200616      ***  If SRSM = 04 and SRAC = BLANKS the determine settlement A/C
531900200616      ***     via SR/ZSETAC  and output to field STLA
532000200616      *
532100200616     C           SRSM      IFEQ 04
532200200616     C           SRAC      ANDEQ*BLANK
532300200616      *
532400200616      ***  Pass Parameters to SR/ZSETAC and execute routine
532500200616      *
532600200616     C                     MOVE SRSM      ZMETH
532700200616     C                     MOVE SRAC      ZSETI
532800200616     C                     MOVE MBDDPT    ZCNUM
532900200616     C           CEU005    IFEQ 'Y'                                       135691
533000200616     C           SCCY      ANDNE*BLANKS                                   135691
533100200616     C                     MOVE SCCY      ZCCY                            135691
533200200616     C                     ELSE                                           135691
533300200616     C                     MOVE WONMCY    ZCCY
533400200616     C                     ENDIF                                          135691
533500200616     C                     MOVE SRAB      ZBRCA
533600200616     C                     EXSR ZSETAC
533700200616     C                     MOVELZSETO     STLA
533800200616     C                     MOVELZWBRCA    SEBR
533900200616     C                     ENDIF
534000200616     C                     ENDIF
534100200616     C                     ENDIF                                          135691
534200200616      *
534300200616     C                     ENDIF
534400200616      ** .. Reversal indicator
534500200616     C           MACHTP    IFEQ 'R'
534600200616     C                     MOVE '1'       RVRS
534700200616     C                     ELSE
534800200616     C                     MOVE '0'       RVRS
534900200616     C                     ENDIF
535000200616      ** .. Issuer
535100200616     C**********           Z-ADDWOISSR    ISSR                                                CSD027
535200200616     C                     MOVE WOISSR    ISSR                                                CSD027
535300200616      ** .. Tour depot customer
535400200616     C**********           Z-ADDMBDDPT    KCUST                                               CSD027
535500200616     C                     MOVE MBDDPT    KCUST                                               CSD027
535600200616      ** .. Nominal Ccy amount
535700200616     C                     Z-ADD*ZEROS    KNCA
535800200616      ** .. Nominal Ccy
535900200616     C           MAPTYP    IFNE 'CC'                                      CEU017
536000200616     C                     MOVE WONMCY    KCCY
536100200616     C                     ELSE                                           CEU017
536200200616     C                     MOVE NANCCY    KCCY                            CEU017
536300200616     C                     ENDIF                                          CEU017
536400200616      ** .. Base Ccy Amount
536500200616     C                     Z-ADD*ZEROS    KBCA
536600200616      ** .. Security Shortname
536700200616     C           MBSESN    IFEQ '**CASH**'
536800200616     C                     MOVELMASESN    SESH      P
536900200616     C                     ELSE
537000200616     C                     MOVELMBSESN    SESH      P
537100200616     C                     ENDIF
537200200616      ** .. Profit Centre
537300200616     C                     MOVE *BLANKS   PRFC
537400200616      *
537500200616      ***  Analytical Accounting module is ON
537600200616      *
537700200616     C           BGN0ST    IFEQ 'Y'
537800200616     C                     MOVE BVSEPC    PRFC
537900200616     C                     ENDIF
538000200616      ** .. Portfolio Reference
538100200616     C                     MOVE *BLANKS   PTFR
538200200616      ** .. Trans. Type
538300200616     C                     MOVE *BLANKS   PEV1
538400200616      ** .. Transaction number of last update
538500200616     C                     Z-ADD*ZERO     TNLU
538600200616      ** .. Record ID
538700200616     C                     MOVE 'D'       RECI
538800200616      *                                                                                       CGL020
538900200616      ** If Midas Compliance Watch is installed                                               CGL020
539000200616      *                                                                                       CGL020
539100200616     C           CGL020    IFEQ 'Y'                                                           CGL020
539200200616     C                     EXSR SRAMPR                                                        CGL020
539300200616     C                     ENDIF                                                              CGL020
539400200616      *
539500200616      ***  Write account key record
539600200616      *
539700200616     C                     WRITESEKEYDF
539800200616      *
539900200616      ***  Count Records Written
540000200616      *
540100200616     C                     ADD  1         W01CNT
540200200616     C                     MOVE 'Y'       WWDATA           one Read
540300200616      *
540400200616     C                     ENDSR
540500200616      *
540600200616      *****************************************************************
540700200616      /EJECT
540800200616      *****************************************************************
540900200616      *  #AOSEC -  Subroutine to Call Access Object:                  *
541000200616      *  ------    Security Customer                                  *
541100200616      *  Called by : #WPOSS #SACKD #SACKC                             *
541200200616      *  Calls     : AOSECSR0 *PSSR                                   *
541300200616      *****************************************************************
541400200616      *
541500200616     C           #AOSEC    BEGSR
541600200616      *
541700200616     C                     CALL 'AOSECSR0'
541800200616     C                     PARM *BLANKS   @RTCD   7
541900200616     C                     PARM '*KEY   ' @OPTN   7
542000200616     C                     PARM WCUST     @SCKY   6
542100200616     C           SDSECS    PARM SDSECS    DSSDY
542200200616      *
542300200616     C           @RTCD     IFNE *BLANKS
542400200616     C           *LOCK     IN   LDA
542500200616     C                     Z-ADD9         DBASE            ***************
542600200616     C                     MOVE *BLANKS   DBFILE           * DB ERROR 09 *
542700200616     C                     MOVEL'SDSECSPD'DBFILE    P      ***************
542800200616     C                     MOVELWCUST     DBKEY     P
542900200616     C                     MOVEL'SE7561'  DBPGM     P
543000200616     C                     OUT  LDA
543100200616     C                     EXSR *PSSR
543200200616     C                     ENDIF
543300200616      *
543400200616      *                                                                   219688
543500200616     C                     MOVE BFACCD    WZACOD                          219688
543600200616      *                                                                   219688
543700200616     C                     ENDSR
543800200616      *
543900200616      *****************************************************************
544000200616      /EJECT
544100200616      *****************************************************************
544200200616      *  #COAT -  Subroutine to Retrieve the Trade Sub-Type           *
544300200616      *  -----    Corporate Action Type                               *
544400200616      *  Called by : #SACKB #SACKC #SACKD                             *
544500200616      *  Calls     : *PSSR                                            *
544600200616      *****************************************************************
544700200616      *
544800200616     C           #COAT     BEGSR
544900200616      *
545000200616     C           WKCOAT    CHAINSECOATL0             89
545100200616      *
545200200616     C           *IN89     IFEQ *ON
545300200616     C           *LOCK     IN   LDA
545400200616     C                     Z-ADD10        DBASE            ***************
545500200616     C                     MOVE *BLANKS   DBFILE           * DB ERROR 10 *
545600200616     C                     MOVEL'SECOATL0'DBFILE    P      ***************
545700200616     C                     MOVELWKCOAT    DBKEY     P
545800200616     C                     MOVEL'SE7561'  DBPGM     P
545900200616     C                     OUT  LDA
546000200616     C                     EXSR *PSSR
546100200616     C                     ENDIF
546200200616      *
546300200616     C                     ENDSR
546400200616      *
546500200616      *****************************************************************
546600200616      /EJECT
546700200616      *****************************************************************
546800200616      *  CALAM2 - Calculate Charge amounts                            *
546900200616      *  ------                                                       *
547000200616      *  Called by : #WPOSS                                           *
547100200616      *  Calls     : *PSSR ZXRATE ZCCAL1                              *
547200200616      *****************************************************************
547300200616      *
547400200616     C           CALAM2    BEGSR
547500200616      *
547600200616      ***  Charge details
547700200616      *
547800200616     C                     MOVE CHGB      ZCHGB
547900200616     C                     MOVE THRI      ZTHRI
548000200616     C                     Z-ADDMNCH      ZMNCH
548100200616     C                     Z-ADDMXCH      ZMXCH
548200200616      *
548300200616      ***  Set up array for upper range limits
548400200616      *
548500200616     C                     Z-ADDSTU1      ZRA,1
548600200616     C                     Z-ADDSTU2      ZRA,2
548700200616     C                     Z-ADDSTU3      ZRA,3
548800200616     C                     Z-ADDSTU4      ZRA,4
548900200616     C                     Z-ADDSTU5      ZRA,5
549000200616     C                     Z-ADDSTU6      ZRA,6
549100200616     C                     Z-ADDSTU7      ZRA,7
549200200616     C                     Z-ADDSTU8      ZRA,8
549300200616     C                     Z-ADDSTU9      ZRA,9
549400200616     C                     Z-ADDST10      ZRA,10
549500200616     C                     Z-ADDST11      ZRA,11
549600200616     C                     Z-ADDST12      ZRA,12
549700200616     C                     Z-ADDST13      ZRA,13
549800200616     C                     Z-ADDST14      ZRA,14
549900200616      *
550000200616      ***  Set up array for percentage levels
550100200616      *
550200200616     C                     Z-ADDPL01      ZPC,1
550300200616     C                     Z-ADDPL02      ZPC,2
550400200616     C                     Z-ADDPL03      ZPC,3
550500200616     C                     Z-ADDPL04      ZPC,4
550600200616     C                     Z-ADDPL05      ZPC,5
550700200616     C                     Z-ADDPL06      ZPC,6
550800200616     C                     Z-ADDPL07      ZPC,7
550900200616     C                     Z-ADDPL08      ZPC,8
551000200616     C                     Z-ADDPL09      ZPC,9
551100200616     C                     Z-ADDPL10      ZPC,10
551200200616     C                     Z-ADDPL11      ZPC,11
551300200616     C                     Z-ADDPL12      ZPC,12
551400200616     C                     Z-ADDPL13      ZPC,13
551500200616     C                     Z-ADDPL14      ZPC,14
551600200616     C                     Z-ADDPL15      ZPC,15
551700200616      *
551800200616      ***  Set up array for flat charges
551900200616      *
552000200616     C                     Z-ADDFC01      ZCG,1
552100200616     C                     Z-ADDFC02      ZCG,2
552200200616     C                     Z-ADDFC03      ZCG,3
552300200616     C                     Z-ADDFC04      ZCG,4
552400200616     C                     Z-ADDFC05      ZCG,5
552500200616     C                     Z-ADDFC06      ZCG,6
552600200616     C                     Z-ADDFC07      ZCG,7
552700200616     C                     Z-ADDFC08      ZCG,8
552800200616     C                     Z-ADDFC09      ZCG,9
552900200616     C                     Z-ADDFC10      ZCG,10
553000200616     C                     Z-ADDFC11      ZCG,11
553100200616     C                     Z-ADDFC12      ZCG,12
553200200616     C                     Z-ADDFC13      ZCG,13
553300200616     C                     Z-ADDFC14      ZCG,14
553400200616     C                     Z-ADDFC15      ZCG,15
553500200616      *
553600200616     C                     CALL 'AOCURRR0'
553700200616     C                     PARM *BLANKS   @RTCD
553800200616     C                     PARM '*KEY  '  @OPTN
553900200616     C                     PARM PNCY      @CYCD   3
554000200616     C           SDCURR    PARM SDCURR    DSSDY
554100200616      *
554200200616     C           @RTCD     IFNE *BLANKS
554300200616     C           *LOCK     IN   LDA
554400200616     C                     Z-ADD11        DBASE            ***************
554500200616     C                     MOVE *BLANKS   DBFILE           * DB ERROR 11 *
554600200616     C                     MOVEL'SDCURRPD'DBFILE    P      ***************
554700200616     C                     MOVELPNCY      DBKEY     P
554800200616     C                     MOVEL'SE7561'  DBPGM     P
554900200616     C                     OUT  LDA
555000200616     C                     EXSR *PSSR
555100200616     C                     ENDIF
555200200616      *
555300200616     C                     MOVE A6NBDP    ZDECS
555400200616      *
555500200616      ***  Nominal decimal places
555600200616      *
555700200616     C                     Z-ADD0         ZNMDP
555800200616      *
555900200616      ***  Security details
556000200616      *
556100200616     C                     Z-ADD1         ZPRICE
556200200616     C                     Z-ADDPAMD      ZNOML
556300200616     C                     Z-ADD0         ZTCFC
556400200616     C                     MOVE 'P'       ZPROT
556500200616     C                     MOVE *BLANKS   ZSPBS
556600200616      *
556700200616     C           S01446    IFEQ 'Y'
556800200616      ***  Purchase interest
556900200616     C                     Z-ADD*ZEROS    ZTPI
557000200616      *
557100200616      ***  Access currencies file to get value currency decimal places
557200200616      *
557300200616     C                     CALL 'AOCURRR0'
557400200616     C                     PARM *BLANKS   @RTCD
557500200616     C                     PARM '*KEY  '  @OPTN
557600200616     C                     PARM VLCY      @CYCD
557700200616     C           SDCURR    PARM SDCURR    DSSDY
557800200616      *
557900200616     C           @RTCD     IFNE *BLANKS
558000200616     C           *LOCK     IN   LDA
558100200616     C                     Z-ADD12        DBASE            ***************
558200200616     C                     MOVE 'SDCURRPD'DBFILE    P      * DB ERROR 12 *
558300200616     C                     MOVELVLCY      DBKEY     P      ***************
558400200616     C                     MOVEL'SE7561'  DBPGM     P
558500200616     C                     OUT  LDA
558600200616     C                     EXSR *PSSR
558700200616     C                     END
558800200616      *
558900200616     C                     Z-ADDA6NBDP    WLVDCP  10
559000200616      *
559100200616     C           BVCHRC    IFNE *BLANKS
559200200616     C                     MOVE BVCHRC    ZCCYI
559300200616     C                     Z-ADDWLNBDP    ZCDPI   10
559400200616     C                     MOVE VLCY      ZCCYO
559500200616     C                     Z-ADDWLVDCP    ZCDPO   10
559600200616     C                     Z-ADDWOSPRT    ZRATE2 138
559700200616     C                     MOVE WOMDIN    ZMDI2   1
559800200616     C                     Z-ADDWLSPRT    ZRATE1 138
559900200616     C                     MOVE WLMDIN    ZMDI1   1
560000200616     C                     EXSR ZXRATE
560100200616     C                     MOVE ZRATEX    TRATEX 138
560200200616     C                     MOVE ZMDIX     TMDIX   1
560300200616     C                     MOVE TRATEX    ZEXCH
560400200616     C                     MOVE TMDIX     ZMD
560500200616      *
560600200616     C                     ELSE
560700200616      *
560800200616      ***  Total consideration
560900200616      *
561000200616     C                     Z-ADD*ZEROS    ZTCON
561100200616     C                     MOVE *BLANKS   ZCCYI
561200200616     C                     MOVE *BLANKS   ZCCYO
561300200616     C                     MOVE *BLANKS   ZEXCH
561400200616     C                     MOVE *BLANKS   ZMD
561500200616      *
561600200616     C                     END
561700200616      *                    END
561800200616     C                     END
561900200616      *
562000200616      ***   Total nominal
562100200616      *
562200200616     C                     Z-ADD*ZEROS    ZTNOM  150
562300200616      *
562400200616     C                     EXSR ZCCAL1
562500200616      *
562600200616     C                     ENDSR
562700200616      *
562800200616      *****************************************************************
562900200616      /EJECT
563000200616      *****************************************************************
563100200616      *  CALCTX - Subroutine to calculate tax amounts for dividends   *
563200200616      *           and Coupons                                         *
563300200616      *  ------                                                       *
563400200616      *  Called by : #WPOSS                                           *
563500200616      *  Calls     : *PSSR                                            *
563600200616      *****************************************************************
563700200616      *
563800200616     C           CALCTX    BEGSR
563900200616      *
564000200616     C           *LIKE     DEFN CLOC      UBRLOC           brch ctry
564100200616     C           *LIKE     DEFN S1RASO    UTXRSR           src tax rate
564200200616     C           *LIKE     DEFN TBRASR    UTXRRF           ref tax rate
564300200616     C           *LIKE     DEFN TBRAUS    UTXRUS           usr tax rate
564400200616     C           *LIKE     DEFN TBDLOR    UDLOR            ded.tax local
564500200616      *
564600200616      *** Initialise work tax rate and amount fields
564700200616      *
564800200616     C                     CLEARUTXRSR
564900200616     C                     CLEARUTXRRF
565000200616     C                     CLEARUTXRUS
565100200616     C                     CLEARUDLOR
565200200616      *
565300200616      *** If tax band at source is zero, then take rate from security
565400200616      *** WHT file; Otherwise access SEcountry tax rate file to
565500200616      *** get tax rate at source
565600200616      *
565700200616     C           S1TABD    IFEQ *ZERO                      *B1
565800200616     C                     Z-ADDS1RASO    UTXRSR
565900200616     C                     ELSE                            *X1
566000200616      *
566100200616     C                     MOVELS1CTTA    UKEY    3
566200200616     C                     MOVE S1TABD    UKEY
566300200616      *
566400200616     C                     CALL 'AOSCTXR0'
566500200616     C                     PARM *BLANKS   @RTCD
566600200616     C                     PARM '*KEY   ' @OPTN
566700200616     C                     PARM S1CTTA    @CTTA   2
566800200616     C                     PARM S1TABD    @TABD   10
566900200616     C           SECNTR    PARM SECNTR    DSSDY
567000200616     C*
567100200616     C           @RTCD     IFNE *BLANKS                    *B2
567200200616     C           TXRECI    ORNE 'D'
567300200616     C           *LOCK     IN   LDA
567400200616     C                     Z-ADD13        DBASE            ***************
567500200616     C                     MOVEL'SECNTRL0'DBFILE    P      * DB ERROR 13 *
567600200616     C                     MOVELUKEY      DBKEY     P      ***************
567700200616     C                     MOVEL'SE7561'  DBPGM     P
567800200616     C                     OUT  LDA
567900200616     C                     EXSR *PSSR
568000200616     C                     ELSE                            *X2
568100200616     C                     Z-ADDTXRASO    UTXRSR
568200200616     C                     END                             *E2
568300200616     C                     END                             *E1
568400200616      *
568500200616      *** If tax band by user is not zero, then access country to
568600200616      *** branch tax rate file to get tax rate by user
568700200616      *** Otherwise set to zero.
568800200616      *
568900200616     C           S1TABU    IFNE *ZERO                      *B1
569000200616     C                     CALL 'AOCBTXR0'
569100200616     C                     PARM *BLANKS   @RTCD
569200200616     C                     PARM '*KEY   ' @OPTN
569300200616     C                     PARM PBCA      @BRCA   3
569400200616     C                     PARM S1CTTA    @CTTA
569500200616     C                     PARM S1TABU    @TABU   10
569600200616     C           SECBTX    PARM SECBTX    DSFDY
569700200616     C*
569800200616     C           @RTCD     IFEQ *BLANKS                    *B2
569900200616     C           TBRECI    ANDEQ'D'
570000200616     C                     Z-ADDTBRASR    UTXRRF
570100200616     C                     Z-ADDTBRAUS    UTXRUS
570200200616     C                     MOVE TBDLOR    UDLOR
570300200616     C                     END                             *E2
570400200616     C                     END                             *E1
570500200616      *
570600200616      *** calculate amount deducted at source
570700200616      *
570800200616     C           UTXRSR    DIV  100       URATE   54
570900200616     C******     PAMD      MULT URATE     TASO      H
571000200616     C           WUPAMD    MULT URATE     TASO      H
571100200616      *
571200200616      *** calculate amount deducted refundable
571300200616      *
571400200616     C           UTXRRF    DIV  100       URATE
571500200616     C******     PAMD      MULT URATE     TASR      H
571600200616     C           WUPAMD    MULT URATE     TASR      H
571700200616      *
571800200616      *** calculate amount deducted by user
571900200616      *
572000200616     C                     CLEARTAUS
572100200616      *
572200200616     C           UTXRUS    IFGT *ZERO                      *B1
572300200616      *
572400200616     C           UDLOR     IFEQ 'N'                        *B2
572500200616     C                     MOVE PCPY      WCNUM
572600200616     C           CLKYCB    CHAINCLINT                89
572700200616     C           *IN89     IFEQ '1'                        *B3
572800200616     C           RECI      OREQ '*'
572900200616     C           *LOCK     IN   LDA
573000200616     C                     Z-ADD14        DBASE            ***************
573100200616     C                     MOVEL'CLINTCB 'DBFILE    P      * DB ERROR 14 *
573200200616     C                     MOVELPCPY      DBKEY     P      ***************
573300200616     C                     MOVEL'SE7561'  DBPGM     P
573400200616     C                     OUT  LDA
573500200616     C                     EXSR *PSSR
573600200616     C                     END                             *E3
573700200616     C                     END                             *E2
573800200616      *
573900200616     C           UDLOR     IFEQ 'Y'                        *B2
574000200616     C           UDLOR     OREQ 'N'
574100200616     C           CLOC      ANDNEUBRLOC
574200200616      *
574300200616     C           UTXRUS    DIV  100       URATE
574400200616     C******     PAMD      MULT URATE     TAUS      H
574500200616     C           WUPAMD    MULT URATE     TAUS      H
574600200616     C                     END                             *E2
574700200616      *
574800200616     C                     END                             *E1
574900200616      *
575000200616     C                     ENDSR
575100200616      *
575200200616      *****************************************************************
575300200616      /EJECT
575400200616      *****************************************************************
575500200616      *  #SECTO - Access to LF/SECTY to Retrieve fields details       *
575600200616      *  ------   for the old security                                *
575700200616      *  Called by : Main processing                                  *
575800200616      *  Calls     : AOCURRR0 *PSSR                                   *
575900200616      *****************************************************************
576000200616      *
576100200616     C           #SECTO    BEGSR
576200200616      *
576300200616      ***  Chain for security record
576400200616      *
576500200616     C           WKSESN    CHAINSECTY                89
576600200616      *
576700200616     C           *IN89     IFEQ *ON
576800200616     C           RECI      OREQ '*'
576900200616     C           *LOCK     IN   LDA
577000200616     C                     Z-ADD15        DBASE            ***************
577100200616     C                     MOVE *BLANKS   DBFILE           * DB ERROR 15 *
577200200616     C                     MOVEL'SECTY   'DBFILE    P      ***************
577300200616     C                     MOVELWKSESN    DBKEY     P
577400200616     C                     MOVEL'SE7561'  DBPGM     P
577500200616     C                     OUT  LDA
577600200616     C                     EXSR *PSSR
577700200616     C                     ENDIF
577800200616      *
577900200616      ***  Security nominal decimal places and price basis
578000200616      *
578100200616     C                     MOVELNMCY      WONMCY
578200200616     C                     MOVE MKTI      WOMKTI
578300200616     C**********           Z-ADDISSR      WOISSR                                              CSD027
578400200616     C                     MOVE ISSR      WOISSR                                              CSD027
578500200616     C                     MOVE SITP      WOSITP
578600200616     C                     MOVE SCVI      WOSCVI
578700200616     C                     MOVE SPBS      WOSPBS
578800200616     C                     MOVE SITP      WOSITP
578900200616     C                     MOVE SMCC      WOSMCC                                              CSE034
579000200616      *
579100200616      ***  Retrieve nomimal currency spot, m/d ind. and dec. places
579200200616      *
579300200616     C                     CALL 'AOCURRR0'
579400200616     C                     PARM *BLANKS   @RTCD   7
579500200616     C                     PARM '*KEY   ' @OPTN   7
579600200616     C                     PARM WONMCY    @CYCD   3
579700200616     C           SDCURR    PARM SDCURR    DSSDY
579800200616      *
579900200616     C           @RTCD     IFNE *BLANK
580000200616     C                     Z-ADD16        DBASE            *****************
580100200616     C                     MOVE *BLANKS   DBFILE           ** DB ERROR 16 **
580200200616     C                     MOVEL'SDCURRPD'DBFILE    P      *****************
580300200616     C                     MOVELWONMCY    DBKEY     P
580400200616     C                     MOVEL'SE7561'  DBPGM     P
580500200616     C                     EXSR *PSSR
580600200616     C                     ENDIF
580700200616      *
580800200616      ***  Save base currency spot, m/d indicator, dec. places for later
580900200616      *
581000200616     C                     Z-ADDA6SPRT    WOSPRT
581100200616     C                     MOVE A6MDIN    WOMDIN
581200200616     C                     Z-ADDA6NBDP    WONBDP
581300200616      *
581400200616     C                     ENDSR
581500200616     ******************************************************************
581600200616      /EJECT
581700200616      *****************************************************************
581800200616      *  #TERPR -  Termination processing                             *
581900200616      *  ------                                                       *
582000200616      *  Called by : Main processing                                  *
582100200616      *  Calls     : None                                             *
582200200616      *****************************************************************
582300200616      *
582400200616     C           #TERPR    BEGSR
582500200616      *
582600200616      ***  Update Gen A/C Keys audit and Position Settlement audit file
582700200616      *
582800200616     C                     Z-ADDW01CNT    NORE
582900200616     C                     Z-ADDINT,1     HRWN
583000200616     C                     Z-ADDDEC,1     HRDC
583100200616     C                     WRITESEKEYAF
583200200616      *
583300200616     C                     Z-ADDW02CNT    NORE
583400200616     C                     Z-ADD*ZEROS    TNLU
583500200616     C                     WRITEPOSETAF
583600200616      *
583700200616      ***  Output control report
583800200616      *
583900200616     C           WWDATA    IFEQ 'N'
584000200616     C                     WRITEHEADAU
584100200616     C                     WRITENODTLS                     No detail to report
584200200616     C                     ELSE
584300200616     C                     WRITEHEADAU
584400200616     C                     Z-ADDINT,1     WHASHT
584500200616     C                     Z-ADDDEC,1     WHASHD
584600200616     C                     WRITECONTROL
584700200616     C                     ENDIF
584800200616     C/COPY WNCPYSRC,SE7561C004
584900200616      *
585000200616     C                     MOVE *ON       *INLR
585100200616      *
585200200616      ***  Return out of the program
585300200616      *
585400200616     C                     RETRN
585500200616      *
585600200616     C                     ENDSR
585700200616      *
585800200616     ******************************************************************
585900200616      /EJECT
586000200616      *****************************************************************
586100200616      *   *INZSR : Program initialisation Subroutine                  *
586200200616      *  -------                                                      *
586300200616      *  Called by : Automatically at pgm start                       *
586400200616      *  Calls     : AOBANKR0 *PSSR                                   *
586500200616      *****************************************************************
586600200616      *
586700200616     C           *INZSR    BEGSR
586800200616      *
586900200616      ***  Copyright statement
587000200616      *
587100200616     C                     MOVEACPY@      BIS@   80
587200200616      *
587300200616     C           *ENTRY    PLIST
587400200616     C                     PARM           ACRLRN  1
587500200616      *
587600200616      ***  Initialise key and working fields
587700200616      *
587800200616      ***  PF/SECTYD
587900200616     C           *LIKE     DEFN SESN      WOSESN           Event Security
588000200616     C           *LIKE     DEFN SESN      WKDPSS           Security
588100200616     C           *LIKE     DEFN SESN      WKSESN           Security
588200200616     C           *LIKE     DEFN SITP      WOSITP           Inv. Type
588300200616     C           *LIKE     DEFN SMCC      WOSMCC                                              CSE034
588400200616     C           *LIKE     DEFN ISSR      WOISSR           Issuer
588500200616     C           *LIKE     DEFN NMCY      WONMCY           Nominal Ccy
588600200616     C           *LIKE     DEFN MKTI      WOMKTI           Market Indicator
588700200616     C           *LIKE     DEFN SCVI      WOSCVI           Convertible Indicator
588800200616     C           *LIKE     DEFN SPBS      WOSPBS           Price Basis
588900200616     C           *LIKE     DEFN SITP      WNSITP           Invest type
589000200616      ***  PF/POSETD
589100200616     C           *LIKE     DEFN PPRE      WWPPRE           Pay/Reversal
589200200616      ***  PF/SEKEYD
589300200616     C           *LIKE     DEFN PRFC      WWPRFC           Profit Centre
589400200616      ***  PF/SDCURRPD
589500200616     C           *LIKE     DEFN A6SPRT    WLSPRT           Spot Rate
589600200616     C           *LIKE     DEFN A6SPRT    WOSPRT           Spot Rate
589700200616     C           *LIKE     DEFN A6NBDP    WONBDP           Num. of Dec. Places
589800200616     C           *LIKE     DEFN A6NBDP    WLNBDP           Num. of Dec. Places
589900200616     C           *LIKE     DEFN A6MDIN    WLMDIN           Mult/Div. ind.
590000200616     C           *LIKE     DEFN A6MDIN    WOMDIN           Mult/Div. ind.
590100200616      ***  PF/
590200200616     C           *LIKE     DEFN MRTYPE    WKPEVT           Corporate Action Type
590300200616      ***  PF/SECODPPD
590400200616     C           *LIKE     DEFN MBCORF    WKCORF           CO Reference
590500200616     C           *LIKE     DEFN MBBRCD    WKBRCD           Branch
590600200616     C           *LIKE     DEFN MBDDPT    WKDDPT           Depot
590700200616     C           *LIKE     DEFN MBACAA    WWACAA           Actual Cash Allocation
590800200616     C           *LIKE     DEFN MBACAR    WWACAR           Cash Rounding
590900200616     C           *LIKE     DEFN MBEXPO    WWEXPO
591000200616     C           *LIKE     DEFN MBTNL1    WWTNLU           Last Trans. Num.
591100200616      ***  PF/
591200200616     C           *LIKE     DEFN MDCORF    KWCORF           CO Reference
591300200616      ***  PF/
591400200616     C           *LIKE     DEFN CNUM      WKPCPY           Customer Number
591500200616     C           *LIKE     DEFN BRCA      WKPBCA           Branch
591600200616     C           *LIKE     DEFN SESN      WKPSSH           Security
591700200616      ***  PF/SECOATPD
591800200616     C           *LIKE     DEFN MMTYPE    WKCOAT           Corporate Action Type
591900200616      ***  LF/SECGT
592000200616     C           *LIKE     DEFN CCOM      WKCCOM           Charge/Commission Nar.
592100200616      ***  SR/ZEVCD
592200200616     C           *LIKE     DEFN ECD       WWECD            Event Control Date
592300200616     C** EMU Currency fields                                              135691
592400200616     C           *LIKE     DEFN A6EUER    SVEUER                          135691
592500200616     C           *LIKE     DEFN A6EUMD    SVEUMD                          135691
592600200616      *
592700200616      ***   LDA initialization
592800200616      *
592900200616     C           *NAMVAR   DEFN           LDA
593000200616     C           *LOCK     IN   LDA
593100200616     C                     MOVE *BLANKS   DBFILE
593200200616     C                     MOVE *BLANKS   DBKEY
593300200616     C                     Z-ADD*ZEROS    DBASE
593400200616     C                     MOVE 'SE7561'  DBPGM     P
593500200616     C                     OUT  LDA
593501200616      *                                                                                     AR324886
593502200616      **  Define data area SDSTAT                                                           AR324886
593503200616      *                                                                                     AR324886
593504200616     C           *NAMVAR   DEFN           SDSTAT                                            AR324886
593505200616     C                     IN   SDSTAT                                                      AR324886
593600200616      *
593700200616      ***  Define data area SESTAT
593800200616      *
593900200616     C           *NAMVAR   DEFN           SESTAT
594000200616     C                     IN   SESTAT
594100200616      *
594200200616      ***  Call ZSFILE for Audit printer file SE7561AU
594300200616      *
594400200616     C                     Z-ADDSFNUMU    ZSNUM   60
594500200616     C                     CALL 'ZSFILE'
594600200616     C                     PARM           SEQ     5
594700200616     C                     PARM *BLANKS   @PARM   3
594800200616     C                     PARM           SFILEU
594900200616     C                     PARM           ZSNUM
595000200616     C                     PARM           ZSERR   1
595100200616      *
595200200616      ***  Program Ended abnormally
595300200616      *
595400200616     C           ZSERR     IFEQ 'Y'
595500200616     C           *LOCK     IN   LDA
595600200616     C                     Z-ADD17        DBASE            *****************
595700200616     C                     MOVE *BLANKS   DBFILE           ** DB ERROR 17 **
595800200616     C                     MOVEL'SE7561AU'DBFILE    P      *****************
595900200616     C           'ZSFILE R'CAT  'OUTINE'  DBKEY     P
596000200616     C                     MOVEL'SE7561'  DBPGM     P
596100200616     C                     OUT  LDA
596200200616     C                     EXSR *PSSR
596300200616     C                     ENDIF
596400200616      *
596500200616      ***  Access bank details
596600200616      *
596700200616     C                     CALL 'AOBANKR0'
596800200616     C                     PARM *BLANKS   @RTCD   7
596900200616     C                     PARM '*FIRST  '@OPTN   7
597000200616     C           SDBANK    PARM SDBANK    DSFDY
597100200616      *
597200200616     C           @RTCD     IFNE *BLANK
597300200616     C           *LOCK     IN   LDA
597400200616     C                     Z-ADD18        DBASE            *****************
597500200616     C                     MOVE *BLANKS   DBFILE           ** DB ERROR 18 **
597600200616     C                     MOVEL'SDBANKPD'DBFILE    P      *****************
597700200616     C                     MOVEL'*FIRST  'DBKEY     P
597800200616     C                     MOVEL'SE7561'  DBPGM     P
597900200616     C                     OUT  LDA
598000200616     C                     EXSR *PSSR
598100200616     C                     ENDIF
598200200616      *
598300200616      ** Retrieve Accruals/Profit Date form General Leg
598400200616      *
598500200616     C**********           CALL 'AOGELRR0'                                                    CGL029
598600200616     C                     CALL 'AOGELRR1'                                                    CGL029
598700200616     C                     PARM *BLANKS   @RTCD   7
598800200616     C                     PARM '*FIRST  '@OPTN   7
598900200616     C********** SDGELR    PARM SDGELR    DSFDY                                               CGL029
599000200616     C           SDGELR    PARM SDGELR    DSSDY                                               CGL029
599100200616      *
599200200616     C           @RTCD     IFNE *BLANK
599300200616     C           *LOCK     IN   LDA
599400200616     C                     Z-ADD19        DBASE            *****************
599500200616     C                     MOVE *BLANKS   DBFILE           ** DB ERROR 19 **
599600200616     C                     MOVEL'SDGELRPD'DBFILE    P      *****************
599700200616     C                     MOVEL'*FIRST  'DBKEY     P
599800200616     C                     MOVEL'SE7561'  DBPGM     P
599900200616     C                     OUT  LDA
600000200616     C                     EXSR *PSSR
600100200616     C                     ENDIF
600200200616      *
600300200616      ***  Access SE ICD
600400200616      *
600500200616     C                     CALL 'AOSTRDR0'
600600200616     C                     PARM *BLANKS   @RTCD   7
600700200616     C                     PARM '*FIRST  '@OPTN   7
600800200616     C           SDSTRD    PARM SDSTRD    DSSDY
600900200616      *
601000200616     C           @RTCD     IFNE *BLANK
601100200616     C           *LOCK     IN   LDA
601200200616     C                     Z-ADD20        DBASE            *****************
601300200616     C                     MOVE *BLANKS   DBFILE           ** DB ERROR 20 **
601400200616     C                     MOVEL'SDSTRDPD'DBFILE    P      *****************
601500200616     C                     MOVEL'*FIRST'  DBKEY     P
601600200616     C                     MOVEL'SE7561'  DBPGM     P
601700200616     C                     OUT  LDA
601800200616     C                     EXSR *PSSR
601900200616     C                     ENDIF
602000200616      *
602100200616      ***  Access Midas Module Details
602200200616      *
602300200616     C                     CALL 'AOMMODR0'
602400200616     C                     PARM *BLANKS   @RTCD   7
602500200616     C                     PARM '*FIRST  '@OPTN   7
602600200616     C           SDMMOD    PARM SDMMOD    DSFDY
602700200616      *
602800200616     C           @RTCD     IFNE *BLANK
602900200616     C           *LOCK     IN   LDA
603000200616     C                     Z-ADD21        DBASE            *****************
603100200616     C                     MOVE *BLANKS   DBFILE           ** DB ERROR 21 **
603200200616     C                     MOVEL'SDBANKPD'DBFILE    P      *****************
603300200616     C                     MOVEL'*FIRST  'DBKEY     P
603400200616     C                     MOVEL'SE7561'  DBPGM     P
603500200616     C                     OUT  LDA
603600200616     C                     EXSR *PSSR
603700200616     C                     ENDIF
603800200616      *                                                                   135691
603900200616      **  Check if feature EMU Settlement Ccy Conversion is on.           135691
604000200616      *                                                                   135691
604100200616     C                     CALL 'AOSARDR0'                                135691
604200200616     C                     PARM *BLANKS   @RTCD                           135691
604300200616     C                     PARM '*VERIFY' @OPTN                           135691
604400200616     C                     PARM 'CEU005'  @SARD                           135691
604500200616     C           SCSARD    PARM SCSARD    DSSDY                           135691
604600200616      *                                                                   135691
604700200616     C           @RTCD     IFEQ *BLANKS                                   135691
604800200616     C                     MOVE 'Y'       CEU005  1                       135691
604900200616     C                     ELSE                                           135691
605000200616     C                     MOVE 'N'       CEU005                          135691
605100200616     C                     ENDIF                                          135691
605200200616      *
605300200616      **  Access Switchable features file for MT5xx processing - S01401
605400200616      *
605500200616     C                     CALL 'AOSARDR0'
605600200616     C                     PARM *BLANKS   @RTCD
605700200616     C                     PARM '*VERIFY' @OPTN
605800200616     C                     PARM 'S01401'  @SARD   6
605900200616     C           SCSARD    PARM SCSARD    DSSDY
606000200616      *
606100200616     C           @RTCD     IFEQ *BLANKS
606200200616     C                     MOVE 'Y'       S01401
606300200616     C                     ELSE
606400200616     C                     MOVE 'N'       S01401  1
606500200616     C                     ENDIF
606600200616      *                                                                   CSE023
606700200616      ** Check if CSE023 - Treaty withholding Tax is switched ON          CSE023
606800200616      *                                                                   CSE023
606900200616     C                     CALL 'AOSARDR0'                                CSE023
607000200616     C                     PARM *BLANKS   @RTCD                           CSE023
607100200616     C                     PARM '*VERIFY' @OPTN                           CSE023
607200200616     C                     PARM 'CSE023'  @SARD   6                       CSE023
607300200616      *                                                                   CSE023
607400200616     C           @RTCD     IFEQ *BLANK                                    CSE023
607500200616     C                     MOVE 'Y'       CSE023  1                       CSE023
607600200616     C                     ELSE                                           CSE023
607700200616     C                     MOVE 'N'       CSE023                          CSE023
607800200616     C                     END                                            CSE023
607900200616      *
608000200616      ***  Check if feature "Customer Commissions/Courtage" is on
608100200616      *
608200200616     C                     CALL 'AOSARDR0'
608300200616     C                     PARM *BLANKS   @RTCD
608400200616     C                     PARM '*VERIFY' @OPTN
608500200616     C                     PARM 'S01446'  @SARD   6
608600200616     C           SCSARD    PARM SCSARD    DSSDY
608700200616      *
608800200616     C           @RTCD     IFEQ *BLANKS
608900200616     C                     MOVE 'Y'       S01446
609000200616     C                     ELSE
609100200616     C                     MOVE 'N'       S01446  1
609200200616     C                     ENDIF
609300200616      *                                                                                       CER048
609400200616     C                     CALL 'AOSARDR0'                                                    CER048
609500200616     C                     PARM *BLANKS   @RTCD                                               CER048
609600200616     C                     PARM '*VERIFY' @OPTN                                               CER048
609700200616     C                     PARM 'CER048'  @SARD                                               CER048
609800200616     C           SCSARD    PARM SCSARD    DSSDY                                               CER048
609900200616      *                                                                                       CER048
610000200616     C           @RTCD     IFEQ *BLANKS                                                       CER048
610100200616     C                     MOVE 'Y'       CER048                                              CER048
610200200616     C                     ELSE                                                               CER048
610300200616     C                     MOVE 'N'       CER048  1                                           CER048
610400200616     C                     ENDIF                                                              CER048
610500200616      *
610600200616      ***  If feature "Customer Commissions/Courtage" is on and
610700200616      ***  securities charges currency is not blank, access currencies
610800200616      ***  file to get spot rate, mult/div ind. & no. of decimal places
610900200616      *
611000200616     C           S01446    IFEQ 'Y'
611100200616     C           BVCHRC    ANDNE*BLANKS
611200200616      *
611300200616     C                     CALL 'AOCURRR0'
611400200616     C                     PARM *BLANKS   @RTCD
611500200616     C                     PARM '*KEY  '  @OPTN
611600200616     C                     PARM BVCHRC    @CYCD
611700200616     C           SDCURR    PARM SDCURR    DSSDY
611800200616      *
611900200616     C           @RTCD     IFNE *BLANKS
612000200616     C           *LOCK     IN   LDA
612100200616     C                     Z-ADD22        DBASE            *****************
612200200616     C                     MOVE *BLANKS   DBFILE           ** DB ERROR 22 **
612300200616     C                     MOVEL'SDCURRPD'DBFILE    P      *****************
612400200616     C                     MOVELBVCHRC    DBKEY     P
612500200616     C                     MOVEL'SE7561'  DBPGM     P
612600200616     C                     OUT  LDA
612700200616     C                     EXSR *PSSR
612800200616     C                     ENDIF
612900200616      *
613000200616     C                     Z-ADDA6SPRT    WLSPRT
613100200616     C                     Z-ADDA6NBDP    WLNBDP
613200200616     C                     MOVE A6MDIN    WLMDIN
613300200616     C                     ENDIF
613400200616      *
613500200616      ***  Check if feature "Jyske Enhancements" is on
613600200616      *
613700200616     C                     CALL 'AOSARDR0'
613800200616     C                     PARM *BLANKS   @RTCD
613900200616     C                     PARM '*VERIFY' @OPTN
614000200616     C                     PARM 'S01496'  @SARD
614100200616     C           SCSARD    PARM SCSARD    DSSDY
614200200616      *
614300200616     C           @RTCD     IFEQ *BLANKS
614400200616     C                     MOVE 'Y'       S01496
614500200616     C                     ELSE
614600200616     C                     MOVE 'N'       S01496  1
614700200616     C                     ENDIF
614800200616      *
614900200616      ***  Check if feature "Withholding Tax" is on
615000200616      *
615100200616     C                     CALL 'AOSARDR0'
615200200616     C                     PARM *BLANKS   @RTCD
615300200616     C                     PARM '*VERIFY' @OPTN
615400200616     C                     PARM 'S01447'  @SARD
615500200616     C           SCSARD    PARM SCSARD    DSSDY
615600200616      *
615700200616     C           @RTCD     IFEQ *BLANKS
615800200616     C                     MOVE 'Y'       S01447
615900200616     C                     ELSE
616000200616     C                     MOVE 'N'       S01447  1
616100200616     C                     ENDIF
616200200616      *
616300200616      ***  Check if feature "Position Settlements Autocharges" is on
616400200616      *
616500200616     C                     CALL 'AOSARDR0'
616600200616     C                     PARM *BLANKS   @RTCD
616700200616     C                     PARM '*VERIFY' @OPTN
616800200616     C                     PARM 'S01519'  @SARD
616900200616     C           SCSARD    PARM SCSARD    DSSDY
617000200616      *
617100200616     C           @RTCD     IFEQ *BLANKS
617200200616     C                     MOVE 'Y'       S01519
617300200616     C                     ELSE
617400200616     C                     MOVE 'N'       S01519  1
617500200616     C                     ENDIF
617600200616      *                                                                   CEU017
617700200616      ***  Check feature "Securities Redenomination Euro Changes" is on   CEU017
617800200616      *                                                                   CEU017
617900200616     C                     CALL 'AOSARDR0'                                CEU017
618000200616     C                     PARM *BLANKS   @RTCD                           CEU017
618100200616     C                     PARM '*VERIFY' @OPTN                           CEU017
618200200616     C                     PARM 'CEU017'  @SARD                           CEU017
618300200616     C           SCSARD    PARM SCSARD    DSSDY                           CEU017
618400200616      *                                                                   CEU017
618500200616     C           @RTCD     IFEQ *BLANKS                                   CEU017
618600200616     C                     MOVE 'Y'       CEU017                          CEU017
618700200616     C                     ELSE                                           CEU017
618800200616     C                     MOVE 'N'       CEU017  1                       CEU017
618900200616     C                     ENDIF                                          CEU017
619000200616      *                                                                                       CSE028
619100200616      ** Check if CSE028 - MT5xx Standing Settlements Instructions is                         CSE028
619200200616      **   is switched on.                                                                    CSE028
619300200616      *                                                                                       CSE028
619400200616     C                     CALL 'AOSARDR0'                                                    CSE028
619500200616     C                     PARM *BLANKS   @RTCD                                               CSE028
619600200616     C                     PARM '*VERIFY' @OPTN                                               CSE028
619700200616     C                     PARM 'CSE028'  @SARD                                               CSE028
619800200616     C           SCSARD    PARM SCSARD    DSSDY                                               CSE028
619900200616      *                                                                                       CSE028
620000200616     C           @RTCD     IFEQ *BLANK                                                        CSE028
620100200616     C                     MOVE 'Y'       CSE028  1                                           CSE028
620200200616     C                     ELSE                                                               CSE028
620300200616     C                     MOVE 'N'       CSE028                                              CSE028
620400200616     C                     ENDIF                                                              CSE028
620500200616      *                                                                                       CGL031
620600200616     C                     CALL 'AOSARDR0'                                                    CGL031
620700200616     C                     PARM *BLANKS   @RTCD                                               CGL031
620800200616     C                     PARM '*VERIFY' @OPTN                                               CGL031
620900200616     C                     PARM 'CGL031'  @SARD                                               CGL031
621000200616     C           SCSARD    PARM SCSARD    DSSDY                                               CGL031
621100200616      *                                                                                       CGL031
621200200616     C           @RTCD     IFEQ *BLANK                                                        CGL031
621300200616     C                     MOVE 'Y'       CGL031  1                                           CGL031
621400200616     C                     ELSE                                                               CGL031
621500200616     C                     MOVE 'N'       CGL031                                              CGL031
621600200616     C                     ENDIF                                                              CGL031
621700200616     C/COPY WNCPYSRC,SE7561C002
621800200616      *
621900200616     C                     EXSR ZICD2
622000200616      *
622100200616      *  ERROR IN ZICD2
622200200616      *
622300200616     C           *INU8     IFEQ *ON
622400200616     C           *LOCK     IN   LDA
622500200616     C                     Z-ADD23        DBASE            *****************
622600200616     C                     MOVE *BLANKS   DBFILE           ** DB ERROR 23 **
622700200616     C                     MOVEL'TABSE'   DBFILE    P      *****************
622800200616     C                     MOVELZTABKY    DBKEY     P
622900200616     C                     MOVEL'SE7561'  DBPGM     P
623000200616     C                     OUT  LDA
623100200616     C                     EXSR *PSSR
623200200616     C                     ENDIF
623300200616      *
623400200616      ** Determine if Midas Compliance Watch is installed                                     CGL020
623500200616      *                                                                                       CGL020
623600200616     C                     MOVE 'N'       CGL020  1                                           CGL020
623700200616     C                     CALL 'AOSARDR0'                                                    CGL020
623800200616     C                     PARM '       ' @RTCD                                               CGL020
623900200616     C                     PARM '*VERIFY' @OPTN                                               CGL020
624000200616     C                     PARM 'CGL020'  @SARD                                               CGL020
624100200616     C           SCSARD    PARM SCSARD    DSFDY                                               CGL020
624200200616      *                                                                                       CGL020
624300200616     C           @RTCD     IFNE *BLANK                                                        CGL020
624400200616     C           @RTCD     ANDNE'*NRF   '                                                     CGL020
624500200616     C           *LOCK     IN   LDA                                                           CGL020
624600200616     C                     MOVEL'SCSARDPD'DBFILE                                              CGL020
624700200616     C                     Z-ADD24        DBASE                                               CGL020
624800200616     C                     MOVEL@SARD     DBKEY                                               CGL020
624900200616     C                     OUT  LDA                                                           CGL020
625000200616     C                     EXSR *PSSR                                                         CGL020
625100200616      *                                                                                       CGL020
625200200616     C                     ELSE                                                               CGL020
625300200616     C                     MOVE 'Y'       CGL020                                              CGL020
625400200616     C                     ENDIF                                                              CGL020
625500200616      *                                                                                       CGL020
625600200616      *                                                                                     AR853119
625700200616      ** Check if CER049 - Stamp Tax is switch on                                           AR853119
625800200616      *                                                                                     AR853119
625900200616     C                     CALL 'AOSARDR0'                                                  AR853119
626000200616     C                     PARM *BLANKS   @RTCD                                             AR853119
626100200616     C                     PARM '*VERIFY' @OPTN                                             AR853119
626200200616     C                     PARM 'CER049'  @SARD                                             AR853119
626300200616      *                                                                                     AR853119
626400200616     C           @RTCD     IFEQ *BLANK                                                      AR853119
626500200616     C                     MOVE 'Y'       CER049  1                                         AR853119
626600200616     C                     ELSE                                                             AR853119
626700200616     C                     MOVE 'N'       CER049                                            AR853119
626800200616     C                     ENDIF                                                            AR853119
626900200616      *                                                                                     AR853119
627000200616      **  Access SDSAVLPD for Default settlement account to portfolio 001 indicator (Y/N)     219566
627100200616     C                     CALL 'AOSVALR0'                                                    219566
627200200616     C                     PARM *BLANKS   RTNCDE  7                                           219566
627300200616     C                     PARM           SVALK1 20                                           219566
627400200616     C                     PARM           SVAL1 200                                           219566
627500200616     C                     PARM           SVALK2 20                                           219566
627600200616     C                     PARM           SVAL2 200                                           219566
627700200616     C                     PARM           SVALK3 20                                           219566
627800200616     C                     PARM           SVAL3 200                                           219566
627900200616     C                     PARM           SVALK4 20                                           219566
628000200616     C                     PARM           SVAL4 200                                           219566
628100200616     C                     PARM           SVALK5 20                                           219566
628200200616     C                     PARM           SVAL5 200                                           219566
628300200616     C                     PARM           SVALK6 20                                           219566
628400200616     C                     PARM           SVAL6 200                                           219566
628500200616     C                     PARM           SVALK7 20                                           219566
628600200616     C                     PARM           SVAL7 200                                           219566
628700200616     C                     PARM           SVALK8 20                                           219566
628800200616     C                     PARM           SVAL8 200                                           219566
628900200616     C                     PARM           SVALK9 20                                           219566
629000200616     C                     PARM           SVAL9 200                                           219566
629100200616     C                     PARM           SVALK0 20                                           219566
629200200616     C                     PARM           SVAL10200                                           219566
629300200616      *                                                                                       219566
629400200616     C           RTNCDE    IFNE *BLANKS                                                       219566
629500200616     C           *LOCK     IN   LDA                                                           219566
629600200616     C                     MOVE SVALK1    DBKEY            * DB ERROR 50 *                    219566
629700200616     C                     Z-ADD50        DBASE                                               219566
629800200616     C                     MOVE 'SDSVALPD'DBFILE                                              219566
629900200616     C                     MOVEL'SE7561'  DBPGM                                               219566
630000200616     C                     OUT  LDA                                                           219566
630100200616     C                     EXSR *PSSR                                                         219566
630200200616     C                     ENDIF                                                              219566
630300200616      *                                                                                       219566
630400200616      ***  Klist for ACCNT
630500200616      *
630600200616     C           ZWACCN    KLIST
630700200616     C                     KFLD           ZWCNUM
630800200616     C                     KFLD           ZWCCY
630900200616     C                     KFLD           ZWACOD
631000200616     C                     KFLD           ZWACSQ
631100200616     C                     KFLD           ZWBRCA
631200200616      *
631300200616     C           KWCODP    KLIST
631400200616     C                     KFLD           WKCORF           Reference
631500200616     C                     KFLD           WKBRCD           Branch
631600200616     C                     KFLD           WKDDPT           Depot
631700200616      *
631800200616     C           KWINV     KLIST
631900200616     C                     KFLD           WKNMCY
632000200616     C                     KFLD           WKSITP
632100200616      *
632200200616     C           KWCOOP    KLIST
632300200616     C                     KFLD           WKCOR2           Reference
632400200616     C                     KFLD           WKOPT2           Branch
632500200616      *
632600200616     C           KWSEPC    KLIST
632700200616     C                     KFLD           WKPCPY           Customer
632800200616     C                     KFLD           WKPBCA           Branch
632900200616     C                     KFLD           WKPSSH           Security
633000200616      *
633100200616     C           KWSTDS    KLIST
633200200616     C                     KFLD           WKPBCA           Branch
633300200616     C                     KFLD           WKPCPY           Customer
633400200616     C                     KFLD           WKPBCD  2        Book Code                          CSE028
633500200616     C                     KFLD           WKNMCY           Nominal Ccy
633600200616     C                     KFLD           WKSITP           Sec. Inv. Type
633700200616     C                     KFLD           WKPTFR  4        Portfolio Reference                CSE028
633800200616      *
633900200616     C           KWCOH1    KLIST                           Long key for file SEC
634000200616     C                     KFLD           WKCUGR  2        Customer Group
634100200616     C                     KFLD           WKPCPY           Customer
634200200616     C                     KFLD           WKSITP           Investment Type
634300200616     C                     KFLD           WKPEVT           Event Type
634400200616      *
634500200616     C           KWCOH2    KLIST                           Long key for file SEC
634600200616     C                     KFLD           WKCLAS  1        Classification
634700200616     C                     KFLD           WKPCPY           Customer
634800200616     C                     KFLD           WKSITP           Investment Type
634900200616     C                     KFLD           WKPEVT           Event Type
635000200616      *
635100200616     C           KWSECG    KLIST
635200200616     C                     KFLD           WKNMCY           Event Nominal Currency
635300200616     C                     KFLD           WKCCOM           Commission Code
635400200616      *
635500200616      ***  Access to LF/POSETDY1 et LF/POSETDY2
635600200616      *
635700200616     C           KPOSET    KLIST
635800200616     C                     KFLD           PBCA
635900200616     C                     KFLD           PSSH
636000200616     C                     KFLD           PCPY
636100200616     C                     KFLD           PDUD
636200200616     C                     KFLD           PEVT
636300200616      *
636400200616      ***  Get Country Location - LF/CLINT (PF/CLINTCB)
636500200616      *
636600200616     C           CLKYCB    KLIST
636700200616     C**********           KFLD           WCNUM   60                                          CSD027
636800200616     C                     KFLD           WCNUM   6                                           CSD027
636900200616     C                     KFLD           WRTYP   1
637000200616      *
637100200616     C           KSECO1    KLIST                           Key for file SECOSIL1
637200200616     C                     KFLD           KBRCD   3        Branch
637300200616     C**********           KFLD           KCNUM   60       Customer                           CSD027
637400200616     C                     KFLD           KCNUM   6        Customer                           CSD027
637500200616     C                     KFLD           KPTFR   4        Portfolio Reference
637600200616     C                     KFLD           KCOAT   2        Corporate Action Type
637700200616     C                     KFLD           KSESN  10        Security
637800200616      *
637900200616     C           KSECO2    KLIST                           Key for file SECOSIL2
638000200616     C                     KFLD           KBRCD   3        Branch
638100200616     C                     KFLD           KBOOK   2        Book
638200200616     C                     KFLD           KCOAT   2        Corporate Action Type
638300200616     C                     KFLD           KSESN  10        Security
638400200616      *
638500200616     C           KPMPRT    KLIST
638600200616     C                     KFLD           MCCNUM
638700200616     C                     KFLD           MCPTFR
638800200616      *                                                                                       CGL031
638900200616     C           KTXBS1    KLIST                                                              CGL031
639000200616     C                     KFLD           DVCNCD                                              CGL031
639100200616     C                     KFLD           EWCTRT                                              CGL031
639200200616     C                     KFLD           BJRDNB                                              CGL031
639300200616      *                                                                                       CGL031
639400200616     C           KTXBS2    KLIST                                                              CGL031
639500200616     C                     KFLD           DVCNCD                                              CGL031
639600200616     C                     KFLD           EWCTRT                                              CGL031
639700200616      *                                                                                       CGL031
639800200616     C           KTXCM1    KLIST                                                              CGL031
639900200616     C                     KFLD           DVCNCD                                              CGL031
640000200616     C                     KFLD           PCTTX                                               CGL031
640100200616      *
640200200616     C                     MOVE 'A'       WRTYP
640300200616      *
640400200616      ***  Calculate "Event Control Date" (ECD)
640500200616      *
640600200616     C                     MOVE BKAPDT    ZZAPDT
640700200616     C                     MOVE BJDNWD    ZZDNWD
640800200616     C                     EXSR ZEVCD
640900200616      *
641000200616      ***  On accrual date followed by a non working day -
641100200616      ***    SE7561 is run twice:
641200200616      ***        - 1St Time processes events up to APDA
641300200616      ***          (ACRLRN set according to RUN,IE 3)
641400200616      ***        - 2Nd Time processes events up to DNWD
641500200616      ***          (ACRLRN set to 4)
641600200616      ***  Otherwise -
641700200616      ***    SE7561 is run once processes events up to DNWD
641800200616      ***              (ACRLRN set according to RUN,IE 1 OR 2)
641900200616     C           ACRLRN    IFNE '3'
642000200616     C                     Z-ADDDNWD      WWECD
642100200616     C                     ELSE
642200200616     C                     Z-ADDAPDA      WWECD
642300200616     C                     ENDIF
642400200616      *
642500200616     C                     MOVE 'N'       WWDATA  1        Data Read Indicator
642600200616      *
642700200616     C                     ENDSR
642800200616      *
642900200616     ******************************************************************
643000200616      /EJECT                                                                                  CSE028
643100200616      *****************************************************************                       CSE028
643200200616      *                                                               *                       CSE028
643300200616      * SRSSIR - Sub-routine to call SESSIR0.                         *                       CSE028
643400200616      *                                                               *                       CSE028
643500200616      * Called by: DEFLTS                                             *                       CSE028
643600200616      *                                                               *                       CSE028
643700200616      * Calls:                                                        *                       CSE028
643800200616      *                                                               *                       CSE028
643900200616      *****************************************************************                       CSE028
644000200616     C           SRSSIR    BEGSR                                                              CSE028
644100200616      *                                                                                       CSE028
644200200616     C                     MOVE 'N'       NOTFND                                              CSE028
644300200616     C                     MOVE WKPCPY    WCUST2  6                                           CSE028
644400200616     C                     CALL 'SESSIR0'                                                     CSE028
644500200616     C                     PARM 'D'       POTYP   1                                           CSE028
644600200616     C                     PARM           WKPBCA                                              CSE028
644700200616     C                     PARM           WCUST2                                              CSE028
644800200616     C                     PARM           WKPBCD                                              CSE028
644900200616     C                     PARM           WKNMCY                                              CSE028
645000200616     C                     PARM           WKSMCC  2                                           CSE034
645100200616     C                     PARM           WKSITP                                              CSE028
645200200616     C                     PARM           WKPTFR                                              CSE028
645300200616     C                     PARM           PCBSTD                                              CSE028
645400200616     C                     PARM           PCBSAD                                              CSE028
645500200616     C                     PARM *BLANKS   PRETCD  5                                           CSE028
645600200616      *                                                                                       CSE028
645700200616     C           PRETCD    IFNE '*NCRF'                                                       CSE028
645800200616     C           PRETCD    ANDNE'*NRF '                                                       CSE028
645900200616     C           2         OCUR PCBSTD                                                        CSE028
646000200616     C                     ELSE                                                               CSE028
646100200616     C           PRETCD    IFNE '*NBRF'                                                       CSE028
646200200616     C           PRETCD    ANDNE'*NRF '                                                       CSE028
646300200616     C           1         OCUR PCBSTD                                                        CSE028
646400200616     C                     ELSE                                                               CSE028
646500200616     C                     MOVE 'Y'       NOTFND  1                                           CSE028
646600200616     C                     ENDIF                                                              CSE028
646700200616     C                     ENDIF                                                              CSE028
646800200616      *                                                                                       CSE028
646900200616     C                     ENDSR                                                              CSE028
647000200616      *****************************************************************                       CSE028
647100200616      /EJECT                                                                                  CGL020
647200200616      *****************************************************************                       CGL020
647300200616      *                                                               *                       CGL020
647400200616      * SRAMPR - Determine AML Pay/Receive Instructions               *                       CGL020
647500200616      *                                                               *                       CGL020
647600200616      * Called by: #WACKB, #WACKC, #WACKD                             *                       CGL020
647700200616      *                                                               *                       CGL020
647800200616      * Calls: ZAAMLSETSE                                             *                       CGL020
647900200616      *                                                               *                       CGL020
648000200616      *****************************************************************                       CGL020
648100200616      *                                                                                       CGL020
648200200616     C           SRAMPR    BEGSR                           ** SRAMPR **                       CGL020
648300200616      *                                                                                       CGL020
648400200616     C           STLA      IFEQ *BLANKS                                                       CGL020
648500200616     C                     MOVE *BLANKS   F1RACT                                              CGL020
648600200616     C                     MOVE *BLANKS   F1RCTY                                              CGL020
648700200616     C                     MOVE *BLANKS   F1RBNK                                              CGL020
648800200616     C                     MOVE *BLANKS   F1RCDE                                              CGL020
648900200616     C                     MOVE *BLANKS   F1PACT                                              CGL020
649000200616     C                     MOVE *BLANKS   F1PCTY                                              CGL020
649100200616     C                     MOVE *BLANKS   F1PBNK                                              CGL020
649200200616     C                     MOVE *BLANKS   F1PCDE                                              CGL020
649300200616     C                     MOVE *BLANKS   F1DACT                                              CGL020
649400200616     C                     MOVE *BLANKS   F1DCTY                                              CGL020
649500200616     C                     MOVE *BLANKS   F1DBNK                                              CGL020
649600200616     C                     Z-ADD*ZEROS    F1SDAT                                              CGL020
649700200616      *                                                                                       CGL020
649800200616     C                     ELSE                                                               CGL020
649900200616     C                     MOVE *BLANKS   PINTG                                               CGL020
650000200616     C                     MOVE *BLANKS   PINTGA                                              CGL020
650100200616     C                     MOVE *BLANKS   PINST                                               CGL020
650200200616     C                     MOVE *BLANKS   PINSTA                                              CGL020
650300200616     C                     MOVE *BLANKS   PBENM                                               CGL020
650400200616     C                     MOVE *BLANKS   PBENMA                                              CGL020
650500200616     C**********           Z-ADDCSTN      PCUSTN                                       CGL020 CSD027
650600200616     C                     MOVE CSTN      PCUSTN                                              CSD027
650700200616      *                                                                                       CGL020
650800200616     C                     CALL ZAAMLP                                                        CGL020
650900200616     C                     PARM           PINTG  10                                           CGL020
651000200616     C                     PARM           PINTGA 35                                           CGL020
651100200616     C                     PARM           PINST  10                                           CGL020
651200200616     C                     PARM           PINSTA 35                                           CGL020
651300200616     C                     PARM           PBENM  10                                           CGL020
651400200616     C                     PARM           PBENMA 35                                           CGL020
651500200616     C                     PARM           PDEBT  10                                           CSW210
651600200616     C                     PARM           PDEBTA 35                                           CSW210
651700200616     C                     PARM           PCUSTN                                              CGL020
651800200616     C                     PARM *BLANKS   PBLANK  8                                           CGL020
651900200616     C                     PARM           STLA                                                CGL020
652000200616     C                     PARM           SEBR                                                CGL020
652100200616     C                     PARM           EVCY                                                CGL020
652200200616     C                     PARM           F1RACT                                              CGL020
652300200616     C                     PARM           F1RCTY                                              CGL020
652400200616     C                     PARM           F1RBNK                                              CGL020
652500200616     C                     PARM           F1RCDE                                              CGL020
652600200616     C                     PARM           F1PACT                                              CGL020
652700200616     C                     PARM           F1PCTY                                              CGL020
652800200616     C                     PARM           F1PBNK                                              CGL020
652900200616     C                     PARM           F1PCDE                                              CGL020
653000200616     C                     PARM           F1DACT                                              CGL020
653100200616     C                     PARM           F1DCTY                                              CGL020
653200200616     C                     PARM           F1DBNK                                              CGL020
653300200616      *                                                                                       CGL020
653400200616     C                     Z-ADDEVDT      F1SDAT                                              CGL020
653500200616     C                     ENDIF                                                              CGL020
653600200616      *                                                                                       CGL020
653700200616     C                     MOVE *BLANKS   F1TICK                                              CGL020
653800200616     C                     MOVE *BLANKS   F1EXCH                                              CGL020
653900200616     C                     MOVE *ZEROS    F1NOML                                              CGL020
654000200616      *                                                                                       CGL020
654100200616     C                     ENDSR                                                              CGL020
654200200616      *                                                                                       CGL020
654300200616      ********************************************************************                    CGL020
654400200616      /EJECT
654500200616      *****************************************************************                     AR853119
654600200616      *                                                               *                     AR853119
654700200616      * SRPOST - Create Position Settlement extension                 *                     AR853119
654800200616      *                                                               *                     AR853119
654900200616      *****************************************************************                     AR853119
655000200616     C           SRPOST    BEGSR                                                            AR853119
655100200616      *                                                                                     AR853119
655200200616     C                     MOVE *BLANK    WSTAX   1                                         AR853119
655300200616     C                     MOVE *BLANK    WCTAX   1                                         AR853119
655400200616     C                     MOVE *ZERO     WTAXA                                             AR875302
655500200616     C                     Z-ADD0         P3STAF                                           AR864714B
655600200616     C                     MOVE 'N'       P3TAX                                             AR853119
655700200616     C                     MOVELBJRDNB    P3CDTE                                            AR853119
655800200616     C                     MOVELPBCA      P3PBCA                                            AR853119
655900200616     C                     MOVELPSSH      P3PSSH                                            AR853119
656000200616     C                     MOVELPCPY      P3PCPY                                            AR853119
656100200616     C                     MOVELPDUD      P3PDUD                                            AR853119
656200200616     C                     MOVELPEVT      P3PEVT                                            AR853119
656300200616      *                                                                                     AR853119
656400200616     C                     CALL 'AOBRCHR2'                                                  AR853119
656500200616     C                     PARM *BLANKS   @RTCD                                             AR853119
656600200616     C                     PARM '*KEY   ' @OPTN                                             AR853119
656700200616     C                     PARM PBCA      @DSNB   3                                         AR853119
656800200616     C           SDBRCE    PARM SDBRCE    DSSDY                                             AR853119
656900200616     C           @RTCD     IFEQ *BLANKS                                                     AR853119
657000200616     C                     MOVE BXTAX     WSTAX                                             AR853119
657100200616     C                     ENDIF                                                            AR853119
657200200616      *                                                                                     AR853119
657300200616     C           PCPY      CHAINSDCUSQL0             99                                     AR853119
657400200616     C           *IN99     IFEQ '0'                                                         AR853119
657500200616     C                     MOVE CQTAX     WCTAX                                             AR853119
657600200616     C                     ENDIF                                                            AR853119
657700200616      *                                                                                     AR853119
657800200616      ** Calculate Stamp tax                                                                AR853119
657900200616      *                                                                                     AR853119
658000200616     C           WSTAX     IFEQ 'Y'                                                         AR853119
658100200616     C           WCTAX     ANDEQ'Y'                                                         AR853119
658200200616     C                     CALL 'SD008141'                                                  AR853119
658300200616     C                     PARM BJRDNB    U#DATE  50                                        AR853119
658400200616     C                     PARM 'POSSET  'U#ORGN 10                                         AR853119
658500200616     C                     PARM           ##TYPE  4                                         AR853119
658600200616     C                     PARM           U#CTAX 138                                        AR853119
658700200616     C                     PARM           U#MTAX 138                                        AR853119
658800200616     C                     PARM           U#CCCY  3                                         AR853119
658900200616     C                     PARM           U#MCCY  3                                         AR853119
659000200616     C                     PARM           U#CSCC  2                                         AR853119
659100200616     C                     PARM           U#MSCC  2                                         AR853119
659200200616     C                     PARM           U#TXTY  1                                         AR853119
659300200616     C                     PARM           SDSTPD                                            AR853119
659400200616      *                                                                                     AR853119
659500200616      ** If there is a default for the Module use this tax rate and ccy                     AR853119
659600200616      ** otherwise use the ICD Control defaults.                                            AR853119
659700200616      *                                                                                     AR853119
659800200616     C           U#MTAX    IFNE *ZEROS                                                      AR853119
659900200616     C                     Z-ADDU#MTAX    U#TAXR 138                                        AR853119
660000200616     C                     MOVE U#MCCY    U#SCCY  3                                         AR853119
660100200616     C                     ELSE                                                             AR853119
660200200616     C                     MOVE U#CCCY    U#SCCY                                            AR853119
660300200616     C                     Z-ADDU#CTAX    U#TAXR                                            AR853119
660400200616     C                     ENDIF                                                            AR853119
660500200616      *                                                                                     AR853119
660600200616     C                     MOVELPCHA      WTAXA  130                                        AR853119
660700200616     C                     ADD  PCAM      WTAXA                                             AR853119
660800200616     C                     MULT U#TAXR    WTAXA     H                                       AR853119
660900200616     C                     Z-ADDWTAXA     P3STAF                                            AR853119
661000200616     C                     MOVE 'Y'       P3TAX                                             AR853119
661100200616     C                     EXSR SRSTMD                                                      AR853119
661200200616     C                     ENDIF                                                            AR853119
661300200616      *                                                                                     AR853119
661400200616     C                     ENDSR                                                            AR853119
661500200616      *****************************************************************                     AR853119
661600200616      /EJECT                                                                                AR853119
661700200616      *****************************************************************                     AR853119
661800200616      * Subroutine  :  SRSTMD                                         *                     AR853119
661900200616      * Function    :  This subroutine will write/update records in   *                     AR853119
662000200616      *                Stamp Tax Historic/Details (SDSTMDPD)          *                     AR853119
662100200616      *****************************************************************                     AR853119
662200200616      *                                                                                     AR853119
662300200616     C           SRSTMD    BEGSR                                                            AR853119
662400200616      *                                                                                     AR853119
662500200616     C                     MOVE PBCA      T2PBRC                                            AR853119
662600200616     C                     MOVE PSSH      T2PSSH                                            AR853119
662700200616     C                     MOVE PCPY      T2PCPY                                            AR853119
662800200616     C                     MOVE PDUD      T2PDUD                                            AR853119
662900200616     C                     MOVE PEVT      T2PEVT                                            AR853119
663000200616     C                     MOVEL'POSSET'  T2KEY                                             AR853119
663100200616     C                     MOVE 'T'       T2RCTP                                            AR853119
663200200616     C                     MOVE U#SCCY    T2SCCY                                            AR853119
663300200616     C                     MOVE PSCU      T2ECCY                                            AR853119
663400200616     C                     MOVE 'Y'       T2TCAL                                            AR853119
663500200616     C                     MOVE U#TAXR    T2TXRT                                            AR853119
663600200616     C                     Z-ADDWTAXA     T2TATC                                            AR853119
663700200616     C                     MOVE 'Y'       T2STFF                                            AR853119
663800200616     C                     Z-ADDBJRDNB    T2LCD                                             AR853119
663900200616     C                     MOVE 'I'       T2TYLC                                            AR853119
664000200616     C           PCHA      ADD  PCAM      T2GROS                                           AR864714B
664100200616      *                                                                                     AR853119
664200200616     C                     ENDSR                                                            AR853119
664300200616      *****************************************************************                     AR853119
664501200616      /EJECT                                                                                AR324886
664502200616      *****************************************************************                     AR324886
664503200616     C           PSAUDT    BEGSR                                                            AR324886
664504200616      *                                                                                     AR324886
664505200616     C                     MOVE RECI      PARECI                                            AR324886
664506200616     C                     MOVE PBCA      PAPBCA                                            AR324886
664507200616     C                     MOVE PSSH      PAPSSH                                            AR324886
664508200616     C                     MOVE PCPY      PAPCPY                                            AR324886
664509200616     C                     MOVE PDUD      PAPDUD                                            AR324886
664510200616     C                     MOVE PEVT      PAPEVT                                            AR324886
664511200616     C                     MOVE PTFR      PAPTFR                                            AR324886
664512200616     C                     MOVE TNLU      PATNLU                                            AR324886
664513200616     C                     MOVE TXBS      PATXBS                                            AR324886
664514200616     C                     MOVE BNFO      PABNFO                                            AR324886
664515200616     C                     MOVE EXCD      PAEXCD                                            AR324886
664516200616     C           LIBR      CAT  'OWNER'   PALUSR                                            AR324886
664517200616     C                     MOVE LCD       PALCD                                             AR324886
664518200616     C                     MOVE CHTP      PALCTP                                            AR324886
664519200616     C                     WRITEPSAUTDF                                                     AR324886
664520200616      *                                                                                     AR324886
664521200616     C                     ENDSR                                                            AR324886
664522200616      *****************************************************************                     AR324886
664523200616      /EJECT
664600200616      *  *PSSR  - Dump routine in case of error                       *
664700200616      *  ------                                                       *
664800200616      *****************************************************************
664900200616      *
665000200616     C           *PSSR     BEGSR
665100200616      *
665200200616     C           WWRUN     IFNE 'Y'
665300200616     C                     DUMP
665400200616     C                     MOVE 'Y'       WWRUN   1
665500200616     C                     ENDIF
665600200616      *
665700200616     C           DBASE     IFGT 1
665800200616     C                     WRITEHEADAU
665900200616     C                     WRITEDBERROR
666000200616     C                     ENDIF
666100200616      *
666200200616     C                     MOVE *ON       *INU7
666300200616     C                     MOVE *ON       *INU8
666400200616     C                     MOVE *ON       *INLR
666500200616     C                     RETRN
666600200616      *
666700200616     C                     ENDSR
666800200616      *****************************************************************
666900200616      /EJECT
667000200616      *****************************************************************
667100200616     C/COPY ZSRSRC,ZSETAC
667200200616     C/COPY ZSRSRC,ZCONVZ1
667300200616     C/COPY ZSRSRC,ZCCAL1Z2
667400200616     C/COPY ZSRSRC,ZCCAL2Z1
667500200616     C/COPY ZSRSRC,ZHASHZ3
667600200616     C/COPY ZSRSRC,ZTNLU1Z2
667700200616     C/COPY ZSRSRC,ZEVCDZ1
667800200616     C/COPY ZSRSRC,ZXRATEZ1
667900200616     C/COPY ZSRSRC,ZICD2Z1
668000200616     C/COPY ZSRSRC,ZCCYCN
668100200616     C/COPY ZSRSRC,ZDATE2Z2                                                                   CGL031
668200200616     C/COPY ZSRSRC,ZDATE9Z3                                                                   CGL031
668300200616     C/COPY ZSRSRC,ZCCYXR                                                                     CGL031
668400200616**  POWER8 - ARRAY OF POWERS FOR CURRENCY CONVERSION
66850020061600000001
66860020061600000010
66870020061600000100
66880020061600001000
66890020061600010000
66900020061600100000
66910020061601000000
66920020061610000000
669300200616**  POWER - ARRAY OF POWERS FOR CURRENCY CONVERSION
6694002006160000001
6695002006160000010
6696002006160000100
6697002006160001000
6698002006160010000
6699002006160100000
6700002006161000000
670100200616**   ZYDY - YEARS IN DAYS CUMULATIVE, FOUR YEAR SPAN                                          CGL031
6702002006160366073110961461
670300200616**   ZMDY - MONTHS IN DAYS CUMULATIVE THROUGH YEAR                                            CGL031
670400200616000031059090120151181212243273304334365
670500200616**   ZMNM - MONTHS SHORT NAMES                                                                CGL031
670600200616JANFEBMARAPRMAYJUNJULAUGSEPOCTNOVDEC
670700200616** @YD  USED BY SR. ZDATE9 - YEARS, IN DAYS, CUMULATIVE IN 4 YEAR SPAN                        CGL031
67080020061600366007310109601461
670900200616** @MD  USED BY SR. ZDATE9 - MONTHS IN DAYS CUMULATIVE THROUGH YEAR                           CGL031
67100020061600000000310005900090001200015100181002120024300273003040033400365
671100200616**  CPY@
671200200616(c) Finastra International Limited 2001
