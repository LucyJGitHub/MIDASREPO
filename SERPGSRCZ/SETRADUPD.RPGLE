000100200529     H DEBUG
000200200529     H COPYRIGHT('(c) Finastra International Limited 2002')
000300200529      *****************************************************************
000400200529/*STD *  RPGBASEMOD                                                   *
000500200529/*EXI *  TEXT('Midas SE Trade database update')                       *
000600200529      *****************************************************************
000700200529      *                                                               *
000800200529      *  Midas - Securities Trading Module                            *
000900200529      *                                                               *
001000200529      *  SETRADUPD - SECURITIES TRADES DATABASE UPDATE                *
001100200529      *                                                               *
001200200529      *  (c) Finastra International Limited 2001                      *
001300200529      *                                                               *
001400200604      *  Last Amend No. 258848             Date 22May20               *
001500200604      *  Prev Amend No. 248683             Date 22May20               *
001600200604      *                 CSD102             Date 08Jan19               *
001700200529      *                 MD046248           Date 27Oct17               *
001800200529      *                 MD020922           Date 26Jun13               *
001900200529      *                 AR1092084          Date 03Apr13               *
002000200529      *                 AR632291           Date 24Aug10               *
002100200529      *                 CSW210             Date 04May10               *
002200200529      *                 CER059             Date 19Jul10               *
002300200529      *                 CER054             Date 07Apr09               *
002400200529      *                 BUG23123           Date 09Mar09               *
002500200529      *                 BUG22911           Date 17Feb09               *
002600200529      *                 CER048             Date 19May08               *
002700200529      *                 CSD083             Date 27May10               *
002800200529      * Bank Fusion Midas 1.4 Base -----------------------------------*
002900200529      *                 BUG25979           Date 11Sep09               *
003000200529      *                 BUG24775           Date 10Jul09               *
003100200529      * Midas Plus 1.4 Base 04 ---------------------------------------*
003200200529      *                 256564             Date 17Sep08               *
003300200529      *                 240736A            Date 15Jun07               *
003400200529      *                 BUG14514           Date 02Aug07               *
003500200529      * Midas Plus 1.4 Base ------------------------------------------*
003600200529      *                 245970             Date 01Mar07               *
003700200529      *                 243774A            Date 16Jan07               *
003800200529      *                 223022             Date 04Dec06               *
003900200529      *                 230335             Date 01Dec06               *
004000200529      *                 243774             Date 02Aug06               *
004100200529      * Midas Plus 1.3 ----------- Base ------------------------------*
004200200529      *                 BUG12938           Date 20Dec06               *
004300200529      *                 BUG12372           Date 28Oct06               *
004400200529      *                 CPK025             Date 29Aug06               *
004500200529      *                 240736             Date 12Jul06               *
004600200529      *                 CSD031             Date 10Apr06               *
004700200529      *                 238859             Date 21Apr06               *
004800200529      *                 BUG11114           Date 06Apr06               *
004900200529      *                 CSD027             Date 09Dec05               *
005000200529      *                 CAP087             Date 09Sep05               *
005100200529      *                 BUG7975            Date 20Jul05               *
005200200529      *                 CSE075             Date 17Nov05               *
005300200529      *                 236679             Date 26Oct05               *
005400200529      *                 235453             Date 12Aug05               *
005500200529      *                 235112             Date 16Sep05               *
005600200529      *                 236073             Date 16Sep05               *
005700200529      *                 235546             Date 27Jul05               *
005800200529      *                 234440             Date 22Jun05               *
005900200529      *                 236705             Date 18Jun05               *
006000200529      *                 233615             Date 16May05               *
006100200529      *                 233566             Date 17May05               *
006200200529      *                 CGL031             Date 05Jul04               *
006300200529      *                 BUG8102R           Date 17Aug05               *
006400200529      *                 BUG7703            Date 09Sep05               *
006500200529      *                 BUG8102            Date 04Aug05               *
006600200529      *                 CSE065             Date 08Nov04               *
006700200529      *                 BUG8260            Date 26Aug05               *
006800200529      *                 CSE071             Date 26May05               *
006900200529      *                 BUG7029            Date 10Jun05               *
007000200529      *                 223870             Date 18Jan04               *
007100200529      *                 215727             Date 12Aug03               *
007200200529      *                 CSW037A            Date 02May05               *
007300200529      *                 CSD025             Date 11Jan05               *
007400200529      *                 CSW037             Date 15Dec04               *
007500200529      *                 CSW036             Date 15Dec04               *
007600200529      *                 BUG3947            Date 18Aug04               *
007700200529      *                 BUG3122            Date 17Jul04               *
007800200529      *                 CLE025             Date 20Oct03               *
007900200529      *                 227015  (BUG2501)  Date 11May04               *
008000200529      *                 TDA035             Date 02Apr04               *
008100200529      *                 CRE020             Date 20Jan04               *
008200200529      *                 CGL029             Date 01Sep03               *
008300200529      *                 CSE045             Date 24Mar03               *
008400200529      *                 CAP084             Date 07Jul03               *
008500200529      *                 CDE005             Date 20Aug02               *
008600200529      *                 CAS006             Date 21Jan03               *
008700200529      *                 CSE039             Date 31Mar03               *
008800200529      *                 CSD015             Date 14Oct02               *
008900200529      * Midas Release 4.01.03 ----------------------------------------*
009000200529      *                 210517             Date 21Nov02               *
009100200529      * Midas Release 4.01.02 ----------------------------------------*
009200200529      *                 208195             Date 12Aug02               *
009300200529      *                 203470             Date 14May02               *
009400200529      *                 196449             Date 19Apr02               *
009500200529      * Midas Release 4.01 -------------------------------------------*
009600200529      *                 CSE031             Date 13Dec01               *
009700200529      *                 CSC011             Date 18Sep01               *
009800200529      *                 CAP067             Date 24Sep01               *
009900200529      * Midas Release 4 --------------- Base -------------------------*
010000200529      *                 CSE028             Date 06Jun01               *
010100200529      *                 CSE022             Date 29Mar01               *
010200200529      * Midas DBA 3.05 -----------------------------------------------*
010300200529      *                 191691             Date 02Apr01               *
010400200529      * Midas DBA 3.04 -----------------------------------------------*
010500200529      *                 CSE023             Date 12Jul00               *
010600200529      *                 179084             Date 27Oct00               *
010700200529      * Midas DBA 3.03 -----------------------------------------------*
010800200529      *                 CAP137             Date 07Feb00               *
010900200529      *                 CDE001             Date 13Apr00               *
011000200529      * Midas DBA 3.02 -----------------------------------------------*
011100200529      *                 CAP051             Date 16Nov99               *
011200200529      *                 CPB001             Date 01Jun99               *
011300200529      *                 CAP013             Date 07Sep99               *
011400200529      *                 168345             Date 14Oct99               *
011500200529      *                 168532             Date 04Oct99               *
011600200529      * Midas DBA 3.00 ---------------- Base -------------------------*
011700200529      *                 CPL002             Date 08Mar99               *
011800200529      *                 CAP006             Date 18Mar99               *
011900200529      *                 154562             Date 01Feb99               *
012000200529      *                 149162             Date  7Dec98               *
012100200529      *                 CAP003  *CREATE    Date 01Apr98               *
012200200529      *                                                               *
012300200529      *---------------------------------------------------------------*
012400200529      *                                                               *
012500200529      *  258848 - Corrected incorporation of fix 230335.              *
012600200529      *  248683 - 'B' record in TRADSDX2 is not being written during  *
012700200529      *           TRADE REPAIR. Amended program to write 'B' record to*
012800200529      *           said file as it does to TRADSDX1. Amended program to*
012900200529      *           check whether TRADSDX2 was already written by SE1806*
013000200529      *  CSD102 - Password Length Extension (Recompile)               *
013100200529      *  MD046248 - Finastra Rebranding                               *
013200200529      *  MD020922 - Serious Midas error encountered when authorising  *
013300200529      *             trade. Removed the condition of checking Trade &  *
013400200529      *             Book Position Reconcilable field (BVTBRC) as this *
013500200529      *             applies to Book positions which has a validation  *
013600200529      *             in SETSETIVAL.                                    *
013700200529      *  AR1092084 - A serious midas error has occurred upon hitting  *
013800200529      *           Confirm Authorised Input an Auto Settle TRAD.       *
013900200529      *  AR632291 - BULK MT515-518 messages are not generated when    *
014000200529      *             Deliver To and Deliver From are not the same      *
014100200529      *  CSW210 - SWIFT 2010 Changes                                  *
014200200529      *  CER059 - German Feature Upgrade to Delhi                     *
014300200529      *  CER054 - German Features - Church Tax (Recompile)            *
014400200529      *  BUG23123 - Report: Does not show Retail Account Number       *
014500200529      *                     Date is not Midas Standard Date           *
014600200529      *                     Period should be actual int. calc. period *
014700200529      *                     Secondary Tax amount is not printed       *
014800200529      *                     Added field TSSLID                        *
014900200529      *                     (Recompile)                               *
015000200529      *  BUG22911 - Changes for Correct Tax Calculation (Recompile)   *
015100200529      *  CER048 - German Features - Taxes (Recompile)                 *
015200200529      *  CSD083 - Watch List Compliance Upgrade                       *
015300200529      *  BUG25979 - Apply fix bug20458                                *
015400200529      *  BUG20458 - Remove some validation that limits the population *
015500200529      *             of Z#ASTS variable in AMEND/SR                    *
015600200529      *  BUG24775 - Apply fix BUG21255                                *
015700200529      *  BUG21255 - DB error in MG051N when processing MT51x          *
015800200529      *  256564 - Recompile due to PF changes done by fix 256330      *
015900200529      *  240736A -Additional condition to update TRADSDX2 with input  *
016000200529      *           details.                                            *
016100200529      *  BUG14514 - serious midas error on trade authorisation        *
016200200529      *  245970 - Securities trade was amended but there was no MT518 *
016300200529      *           message generated. In subroutine SETAMD, always set *
016400200529      *           flag TCFR to 'Y' without conditions.                *
016500200529      *  243774A- Missing TRADSDX2 record from repair function.       *
016600200529      *  223022 - MT2xx not generated as PRPC is already 'Y' during   *
016700200529      *           authorisation.  Reset PRPC indicator to 'N'.        *
016800200529      *  230335 - Trade deletion not reflected in projected nostro a/c*
016900200529      *           movement. Fix is to perform on-line update if trade *
017000200529      *           is authorized not on its last change date. Applied  *
017100200529      *           fix 218476.                                         *
017200200529      *  243774 - Only 1 record is needed on TRADSDX2 if CSW003 is off*
017300200529      *  BUG12938 - Update BSPOSD in change mode                      *
017400200529      *  BUG12372 - Serious Midas Error in Securities Trade Input     *
017500200529      *  CPK025 - MidasPlus 1.3 packaging.  Bug 7975 and SC 240736    *
017600200529      *           overlap.                                            *
017700200529      *  240736 - Change fix 238859 to still consider CSE045.         *
017800200529      *  CSD031 - Enhanced Centralised Static Data (Recompile)        *
017900200529      *  238859 - Update extension file TRADSDX2 based on the current *
018000200529      *           action done to the security than just checking it   *
018100200529      *           against feature CSE045.                             *
018200200529      * BUG11114- Applied Gems fix 234927                             *
018300200529      *  CSD027 - Conversion Of Customer Number to Alpha              *
018400200529      *  234927 - Do not process SETLED record if action on Trade is  *
018500200529      *           deletion and BVAUTH is '10'. Patterned after SE0050.*
018600200529      *  CAP087  - Enable API can be used for Buy/Sell back trades.   *
018700200529      *  BUG7975- Get the user define entry for TRADSDX2 instead of   *
018800200529      *           the default.                                        *
018900200529      *  CSE075 - US Enhanced Treasury Upgrade to MidasPlus           *
019000200529      *           (Recompile)                                         *
019100200529      *  236679 - For CHANGE action, only invoke SEVTRADTAX once.     *
019200200529      *  235453 - Incorrect update of CDEPPD. Incorrect Nominals.     *
019300200529      *  235112 - During trade deletion, save initial value of EU Tax *
019400200529      *  236073 - Fiscal Price in percentages should be updated on    *
019500200529      *           amend                                               *
019600200529      *  235546 - EU Tax backvaluations                               *
019700200529      *           overwrite of data from SE006680                     *
019800200529      *  234440 - Purchase Interest Management                        *
019900200529      *           including removing 236758 and most of 236705        *
020000200529      *         - Purchase Interest should be maintained during input *
020100200529      *           cycle                                               *
020200200529      *  236705 - original purchase date should default to average    *
020300200529      *           purchase date                                       *
020400200529      *  233615 - Takeon programs for CGL031 (Recompile)              *
020500200529      *  233566 - Add field to CDEPPD                                 *
020600200529      *  CGL031 - Taxation of Savings Income                          *
020700200529      *  BUG8102R - Line was missing which sets up PSUser.            *
020800200529      *             Fix included by Bug 7703 already, so no codings.  *
020900200529      *  BUG7703 - Serious Midas error occurred during INSERT         *
021000200529      *            Applied fix as BUG8260.                            *
021100200529      *  BUG8102 - Move other processing dependent on ZMUSER.         *
021200200529      *  CSE065 - Cost Yield Amort. on Mortgage Backed Assets         *
021300200529      *  BUG8260 - Serious Midas Error occurred                       *
021400200529      *  CSE071 - Multiple Holidays Re Securities                     *
021500200529      *  BUG7029 - Ensure ZMUSER is re-checked on every call,         *
021600200529      *            move out of *INZSR.                                *
021700200529      *  223870 - CPOSNA lock conflict between DBU_TRAD and SEDPMVUPD.*
021800200529      *           The fix is to delay the job if locked by another    *
021900200529      *           user. Patterned after core fix 213720.              *
022000200529      *  215727 - Do not allow authorisation of incomplete trades.    *
022100200529      *           Upgrade fix 114713 to API version.                  *
022200200529      *  CSW037A- Additional Field extended to 40 chars (recompile)   *
022300200529      *  CSD025 - Customer De-Activation                              *
022400200529      *  CSW037 - Additional Field Data on MT300/MT320                *
022500200529      *  CSW036 - Dual SWIFT BIC held on Client Details               *
022600200529      *  BUG3947 - Timestamp field in TRADSDX2 not being initiallised *
022700200529      *            when CSE045 is OFF.                                *
022800200529      *  BUG3122 - Renamed the field SEZONE in SDSECS data structure  *
022900200529      *            to avoid compilation error.                        *
023000200529      *  CLE025 - Credit Lines (Recompile)                            *
023100200529      *  227015 - Remove fix 196449 because it stop the update of     *
023200200529      *           value day position for trade value today.           *
023300200529      *           This cause incorrect value date position in Client's*
023400200529      *           Holding Enquiry.                                    *
023500200529      *  TDA035 - RTS Signon changes for MidasPlus. (Recompile)       *
023600200529      *  CRE020 - Midas Plus Online Printing of Advices (GE7)         *
023700200529      *  CGL029 - Increase Account Code to 10 digits                  *
023800200529      *  CSE045 - API for Extended Settlement for Trade Input and     *
023900200529      *           Depot Movement                                      *
024000200529      *  CAP084 - Synchronous calling of APIs                         *
024100200529      *           Get user from ZMUSER DTAARA                         *
024200200529      *  CDE005 - Data Export - Reservation ID                        *
024300200529      *  CAS006 - Hedge Accounting Phase B                            *
024400200529      *  CSE039 - Auto-settle of trades.                              *
024500200529      *  CSD015 - Midas Compliance Watch - Watch List Checking        *
024600200529      *  210517 - Missing TRADSDX2 record from the API                *
024700200529      *  208195 - Database Error occured when client number is blank. *
024800200529      *  203470 - Reinstate part of fix 179084 which was removed by   *
024900200529      *           191691, but instead of '*', move 'C' to RECI.       *
025000200529      *  196449 - Position is wrongly calculated in SE0220 when Depot *
025100200529      *           and Price changed on value date using action code   *
025200200529      *           'C'. in Trades Input Maintenance. Update Sum        *
025300200529      *           Nominals (Value Date Basis) only after value date   *
025400200529      *           have passed.                                        *
025500200529      *  CSE031 - Coupon Fixing for Floating Rate Notes.              *
025600200529      *           Recompiled due to changes in SECTYD.                *
025700200529      *  CSC011 - 24x7 Midas Availability                             *
025800200529      *  CAP067 - Repurchase Agreements API.                          *
025900200529      *  CSE028 - Standing Settlement Instructions Enhancement.       *
026000200529      *           (Recompiled).                                       *
026100200529      *  CSE022 - Depository Definition Enhancement (Recompile)       *
026200200529      *  191691 - Deletion of Trade is not updating the record id     *
026300200529      *           correctly.  This is caused by fix 179084 which      *
026400200529      *           amended SR/SETDEL to move '*' instead of 'C' into   *
026500200529      *           RECI.  Remove all the code changes introduced by    *
026600200529      *           fix 179084 in SR/SETDEL.                            *
026700200529      *  CSE023 - Treaty Withholding Tax.                             *
026800200529      *  179084 - Previous RECI not being used to update TRAUTD.      *
026900200529      *  CAP137 - Conversion of SE Security inputs into modular       *
027000200529      *           structure to use as APIs.                           *
027100200529      *  CDE001 - Data Export - CCRM Limits                           *
027200200529      *  CAP051 - Automatic Authorisation (SE Trades Part)            *
027300200529      *  CPB001 - Meridian DBA Middleware Replication Customization.  *
027400200529      *           Recompiled due to database changes                  *
027500200529      *         - 'Private Banking' Module                            *
027600200529      *  CAP013 - Allow access by Midas transaction ID if not insert  *
027700200529      *  168345 - Prevent two users from accessing same transaction   *
027800200529      *           in repair screen at the same cycle, and converting  *
027900200529      *           it into two different Midas Deal No.s  .            *
028000200529      *           Second user should not be allowed to repair the tran-
028100200529      *           saction and convert it into a  another Midas Deal . *
028200200529      *  168532 - DB error 082 in trades input with profit centre     *
028300200529      *           defaulting                                          *
028400200529      *  CPL002 - Midas-Plato Interface (Recompiled)                  *
028500200529      *  CAP006 - Check for Trade being updated by another workstation*
028600200529      *  154562 - Only 1 record is needed on TRADSDX1 if CSW003 is off*
028700200529      *  149162 - Int. calc. incorrect at end of Feb for 30 day method*
028800200529      *           (core fix 102506 changes ZDAYS and ZDYYR)           *
028900200529      *  CAP003 - Conversion of MM inputs into modular structure to   *
029000200529      *           use as APIs.                                        *
029100200529      *                                                               *
029200200529      *****************************************************************
029300200529
029400200529     FSECTY     IF   E           K DISK
029500200529     FINVTP     IF   E           K DISK
029600200529     FMUSER     IF   E           K DISK
029700200529     FSOBTR     IF   E           K DISK
029800200529     F                                     RENAME(TRADSDF:SOBTRSO)
029900200529
030000200529     FTRADS     UF A E           K DISK    COMMIT
030100200529     FTRADSDY1  UF A E           K DISK    COMMIT
030200200529     FTRADSDY2  UF A E           K DISK    COMMIT                                             210517
030300200529
030400200529     FTRAUT     IF A E           K DISK    COMMIT
030500200529
030600200529     FSETLE     UF   E           K DISK    COMMIT
030700200529
030800200529     FBKPOS     UF A E           K DISK    COMMIT
030900200529     FBKPHD     IF A E           K DISK    COMMIT
031000200529     FCPOSN     UF A E           K DISK    COMMIT
031100200529     FUDEPP     UF A E           K DISK    COMMIT
031200200529     FCDEPP     UF A E           K DISK    COMMIT
031300200529     FBSPOSDL0  UF A E           K DISK    COMMIT                                             CAP067
031400200529
031500200529     FSETLEA    UF   E             DISK    COMMIT
031600200529     FTRADSA    UF   E             DISK    COMMIT
031700200529     FBKPHDA    UF   E             DISK    COMMIT
031800200529     FBKPOSA    UF   E             DISK    COMMIT
031900200529     FCPOSNA    UF   E             DISK    COMMIT
032000200529     FCDEPPA    UF   E             DISK    COMMIT
032100200529     FUDEPPA    UF   E             DISK    COMMIT
032200200529
032300200529     FSEPCBD    IF A E           K DISK    COMMIT
032400200529     FSEPCCD    IF A E           K DISK    COMMIT
032500200529     FSEPCA     UF   E             DISK    COMMIT
032600200529      *                                                                                       CSE039
032700200529      ** Security Trade Movments Status                                                       CSE039
032800200529     FSEMVTSL6  O  A E           K DISK    RENAME(SEMVTSD0:SEMVTSD06)                         CSE039
032900200529     F                                     COMMIT                                             CSE039
033000200529      *                                                                                       CSE039
033100200529      ** Security Trade Movments Status                                                       CSE039
033200200529     FSEMVTSL0  IF   E           K DISK    PREFIX(MV_)                                        CSE039
033300200529      *                                                                                       CSE039
033400200529     FTRADSDY3  IF   E           K DISK                                                       CSE039
033500200529      *                                                                                       CSE039
033600200529
033700200529     FSDCWHTL1  IF   E           K DISK                                                       CSD015
033800200529      ** Compliance Watch Hit List by Function                                                CSD015
033900200529                                                                                              CSD015
034000200529     FREADVCL1  UF A E           K DISK    COMMIT                                             CRE020
034100200529     F                                     USROPN                                             CRE020
034200200529      ** Midas RE Settled Transaction Index File by Ref No/Pgm Ref                            CRE020
034300200529                                                                                              CRE020
034400200529     F/COPY WNCPYSRC,SETRADDF01
034500200529      *****************************************************************
034600200529      ** +--------------------------------------+
034700200529      ** ¦ Automatically included D-specs       ¦
034800200529      ** ¦ ==============================       ¦
034900200529      ** +--------------------------------------+
035000200529      **
035100200529      **--------------------------------------------------------------------------------------------
035200200529      ** The following /COPY line includes (among others) the LDA layout
035300200529      ** and the copyright array definition:
035400200529     D/COPY ZACPYSRC,STD_D_SPEC
035500200529      **--------------------------------------------------------------------------------------------
035600200529
035700200529      **--------------------------------------------------------------------------------------------
035800200529      ** The following /COPY includes the MM standard declares:
035900200529     D/COPY ZACPYSRC,STDDECLARE
036000200529      **--------------------------------------------------------------------------------------------
036100200529
036200200529      **--------------------------------------------------------------------------------------------
036300200529      ** The following /COPY line includes all the defined fields in the
036400200529      ** Program Status Data Structures.  They have meaningful
036500200529      ** names, prefixed by 'PS'.
036600200529     D/COPY ZACPYSRC,PSDS
036700200529      **--------------------------------------------------------------------------------------------
036800200529      ** The following /COPY line includes the definitions for error and        CAP006
036900200529      ** warning message arrays.                                                CAP006
037000200529     D/COPY ZACPYSRC,ERR_ARRAYS                                                 CAP006
037100200529      **------------------------------------------------------------------------CAP006--------------
037200200529                                                                                CAP006
037300200529
037400200529      ** +--------------------------------------+
037500200529      ** ¦ End of automatically included D-specs¦
037600200529      ** ¦ =====================================¦
037700200529      ** +--------------------------------------+
037800200529
037900200529      *****************************************************************
038000200529
038100200529      ** Timestamp for the transaction                                          CAP006
038200200529     D TimeStamp       S               Z                                        CAP006
038300200529                                                                                CAP006
038400200529     D BYESEL          S              1A   INZ(*BLANK)                                        CAP067
038500200529                                                                                              CAP067
038600200529     D ChkTradFmt    E DS                  EXTNAME(TRADSD)                      CAP006
038700200529      ** Rename fields for Timestamp checking                                   CAP006
038800200529     D                                     PREFIX(CH)                           CAP006
038900200529      * Current Trade in File Format (Extension File)                           CAP006
039000200529     D CT1AFilFmt    E DS                  EXTNAME(TRADSDX1)                    CAP006
039100200529     D                                     PREFIX(CA_)                          CAP006
039200200529      * Current Trade in File Format (Extension File)                           CAP006
039300200529     D CT1BFilFmt    E DS                  EXTNAME(TRADSDX1)                    CAP006
039400200529     D                                     PREFIX(CB_)                          CAP006
039500200529                                                                                CAP006
039600200529      ** Current Trade in File Format Before Update                                           CSC011
039700200529     D CT2AFilFmt    E DS                  EXTNAME(TRADSDX1)                                  CSC011
039800200529     D                                     PREFIX(SA_)                                        CSC011
039900200529      ** Current Trade in File Format Before Update                                           CSC011
040000200529     D CT2BFilFmt    E DS                  EXTNAME(TRADSDX1)                                  CSC011
040100200529     D                                     PREFIX(SB_)                                        CSC011
040200200529                                                                                              CSC011
040300200529     D SEETRAD       E DS                  EXTNAME(SEETRPRPD)                   CAP006
040400200529      * Error indicators                                                        CAP006
040500200529                                                                                CAP006
040600200529      **  EXTERNALLY DESCRIBED DATA STRUCTURE FOR VALID TRADE
040700200529     D SEVTRD        E DS                  EXTNAME(SEVTRADPD)
040800200529     D                                     PREFIX(A_)
040900200529
041000200529      **  EXTERNALLY DESCRIBED DATA STRUCTURE FOR VALID DEPOT MOVEMENT                        234440
041100200529     D SEVDPM        E DS                  EXTNAME(SEVDPMVPD)                                 234440
041200200529     D                                     PREFIX(D_)                                         234440
041300200529                                                                                              234440
041400200529      **  EXTERNALLY DESCRIBED DATA STRUCTURE FOR 'BEFORE UPDATE' TRADE
041500200529     D B_TRADS       E DS                  EXTNAME(TRADSD)
041600200529     D                                     PREFIX(B_)
041700200529
041800200529      **  TRADES FILE
041900200529     D TRADSF        E DS                  EXTNAME(TRADSD)
042000200529
042100200529
042200200529      **  EXTERNALLY DESCRIBED DATA STRUCTURE FOR VALID TRADE EXTENSION 1
042300200529     D SEVTRDX1A     E DS                  EXTNAME(SEVTRX1PD)
042400200529     D                                     PREFIX(AA_)
042500200529      **  EXTERNALLY DESCRIBED DATA STRUCTURE FOR VALID TRADE EXTENSION 1
042600200529     D SEVTRDX1B     E DS                  EXTNAME(SEVTRX1PD)
042700200529     D                                     PREFIX(AB_)
042800200529
042900200529      **  EXTERNALLY DESCRIBED DATA STRUCTURE FOR VALID TRADE EXTENSION 1                     CSE045
043000200529     D SEVTRDX2A     E DS                  EXTNAME(SEVTRX2PD)                                 CSE045
043100200529     D                                     PREFIX(AA_)                                        CSE045
043200200529      **  EXTERNALLY DESCRIBED DATA STRUCTURE FOR VALID TRADE EXTENSION 1                     CSE045
043300200529     D SEVTRDX2B     E DS                  EXTNAME(SEVTRX2PD)                                 CSE045
043400200529     D                                     PREFIX(AB_)                                        CSE045
043500200529                                                                                              CSE045
043600200529      **  TRADE EXTENSION 1 FILE
043700200529     D TRADSX1F      E DS                  EXTNAME(TRADSDX1)
043800200529
043900200529     D A_TradX2      E DS                  EXTNAME(TRADSDX2)                                  210517
044000200529     D                                     PREFIX(A_)                                         210517
044100200529                                                                                              210517
044200200529     D B_TradX2      E DS                  EXTNAME(TRADSDX2)                                  210517
044300200529     D                                     PREFIX(B_)                                         210517
044400200529                                                                                              210517
044500200529     D TradX2Rec     E DS                  EXTNAME(TRADSDX2)                                  210517
044600200529
044700200529      ** SECURITY FILE
044800200529     D SECTYF        E DS                  EXTNAME(SECTYD)
044900200529     D SEC_RECI      E                     EXTFLD(RECI)
045000200529     D SEC_ZZ005     E                     EXTFLD(ZZ005)
045100200529     D SEC_LCD       E                     EXTFLD(LCD)
045200200529     D SEC_CHTP      E                     EXTFLD(CHTP)
045300200529     D SEC_TNLU      E                     EXTFLD(TNLU)
045400200529     D SEC_REPI      E                     EXTFLD(REPI)                         CPB001
045500200529     D SEC_FRNT      E                     EXTFLD(FRNT)                                       CAP137
045600200529     D SEC_REPA      E                     EXTFLD(REPA)                                       CAP137
045700200529     D SEC_TMST      E                     EXTFLD(TMST)                                       CAP137
045800200529     D CDArr                 183    230
045900200529     D CRArr                 231    242
046000200529
046100200529
046200200529
046300200529      **  EXTERNALLY DESCRIBED DATA STRUCTURES FOR TEMPLATE FILES FOR
046400200529      **  PROJECTED ACCOUNT MOVEMENTS UPDATES
046500200529     D Z#BSTS        E DS                  EXTNAME(Z#BST)
046600200529     D Z#ASTS        E DS                  EXTNAME(Z#AST)
046700200529
046800200529     D                 DS                                                       CDE001
046900200529     D**W#POSID*               1     20                                                CDE001 CGL029
047000200529     D  W#POSID                1     26                                                       CGL029
047100200529     D  W#TDSS                 1     10                                         CDE001
047200200529     D  W#TDBK                12     13                                         CDE001
047300200529     D  W#TDBA                15     17                                         CDE001
047400200529     D  W#TDMI                19     19                                         CDE001
047500200529     D/COPY WNCPYSRC,SETRADDD01
047600200529
047700200529      * DATA STRUCTURES FOR USE WITH ACCESS PROGRAMS
047800200529
047900200529     D SDBANK        E DS                  EXTNAME(SDBANKPD)
048000200529      * DATA STRUCTURE FOR BANK DETAILS
048100200529
048200200529     D SDGELR        E DS                  EXTNAME(SDGELRPD)
048300200529      * DATA STRUCTURE FOR BANK DETAILS
048400200529
048500200529     D SDMMOD        E DS                  EXTNAME(SDMMODPD)
048600200529      * DATA STRUCTURE FOR BANK DETAILS
048700200529
048800200529     D SDSTRD        E DS                  EXTNAME(SDSTRDPD)
048900200529      * DATA STRUCTURE FOR SECURITIES TRADING DETAILS
049000200529
049100200529     D SDPORT        E DS                  EXTNAME(SDPORTPD)
049200200529      * DATA STRUCTURE FOR PORTOLIO MANAGEMENT DETAILS
049300200529
049400200529     D SDSECS        E DS                  EXTNAME(SDSECSPD)
049500200529     D QQACC1        E                     EXTFLD(QQACCD)                                     CGL029
049600200529     D BFZONE        E                     EXTFLD(SEZONE)                                    BUG3122
049700200529      * DATA STRUCTURE FOR SECURITIES CUSTOMER DETAILS
049800200529
049900200529     D SDCURR        E DS                  EXTNAME(SDCURRPD)
050000200529      * DATA STRUCTURE FOR CURRENCY DETAILS
050100200529
050200200529     D DSFDY         E DS                  EXTNAME(DSFDY)
050300200529      * FIRST DS FOR ACCESS PROGRAMS, SHORT DATA STRUCTURE
050400200529
050500200529     D DSSDY         E DS                  EXTNAME(DSSDY)
050600200529      * SECOND DS FOR ACCESS PROGRAMS, LONG DATA STRUCTURE
050700200529
050800200529      ** 24X7 status data area                                                                CSC011
050900200529     D SC24X7        E DS                  EXTNAME(SC24X7) DTAARA(SC24X7)                     CSC011
051000200529                                                                                              CSC011
051100200529      ** SDSTAT data area                                                                     CSC011
051200200529     D SDSTAT        E DS                  EXTNAME(SDSTAT) DTAARA(SDSTAT)                     CSC011
051300200529      *                                                                                       CAP084
051400200529      ** DS for ZMUSER details                                                                CAP084
051500200529     D ZMUSER          DS            17                                                       CAP084
051600200529     D  PUSRID                 1     10                                                       CAP084
051700200529     D  PDBRN                 11     13                                                       CAP084
051800200529     D  PDPPT                 14     16                                                       CAP084
051900200529                                                                                              CSC011
052000200529      ** Midas API Message Header Format Definition                                           CSC011
052100200529     D APHEAD        E DS                  EXTNAME(APHEADPD)                                  CSC011
052200200529                                                                                              CSC011
052300200529      ** External DS for SAR Details                                                          CSC011
052400200529     D SCSARD        E DS                  EXTNAME(SCSARDPD)                                  CSC011
052500200529     D  SCA_LCD      E                     EXTFLD(LCD)                                        CSC011
052600200529      *                                                                                       CSC011
052700200529      ** Dummy message ID and message file fields for use on the calls to       CAP006
052800200529      ** ZAMSGTOOPR                                                             CAP006
052900200529     D DummyMsgID      S                   LIKE(#MsgID)                         CAP006
053000200529     D DummyMsgF       S             10A                                        CAP006
053100200529                                                                                CAP006
053200200529     D CSC011          S              1A                                                      CSC011
053300200529     D TRANSDTL        S           5800A                                                      CSC011
053400200529     D*PDealNo**       S             18A                                               CSC011 CGL029
053500200529     D*PADealNo*       S             18A                                               CSC011 CGL029
053600200529     D PDealNo         S             24A                                                      CGL029
053700200529     D PADealNo        S             24A                                                      CGL029
053800200529     D PTimeStamp      S             26A                                                      CSC011
053900200529     D PRTCD           S              7A                                                      CSC011
054000200529     D POPTN           S              7A                                                      CSC011
054100200529     D PSARD           S              6A                                                      CSC011
054200200529     D PAction         S              1A                                                      CSC011
054300200529     D WTRTP           S             20A                                                      CSC011
054400200529                                                                                              CSC011
054500200529     D PMODE           S              3A                                                      210517
054600200529     D PScreen         S              1A                                                      210517
054700200529                                                                                              210517
054800200529      ** Array for enhancement CSD015                                                         CSD015
054900200529     D***OPTAG**         S             40    DIM(22) CTDATA                            CSD015 CSW210
055000200529     D***CLTAG**         S             40    DIM(22) CTDATA                            CSD015 CSW210
055100200529     D OPTAG           S             40    DIM(24) CTDATA                                     CSW210
055200200529     D CLTAG           S             40    DIM(24) CTDATA                                     CSW210
055300200529                                                                                              CSD015
055400200529      ** Data Structure for Watch List Details Transactions File                              CSD015
055500200529     D SEFirstParm   E DS                  EXTNAME(SDWLTDPD)                                  CSD015
055600200529                                                                                              CSD015
055700200529      ** Data structure for 2nd parameter of SDCWLCHK                                         CSD015
055800200529     D SESecondParm    DS         30000                                                       CSD015
055900200529                                                                                              CSD015
056000200529      ** Additional entry parameter for Midas Compliance Watch                                CSD015
056100200529     D PMCWL           DS          9999                                                       CSD015
056200200529                                                                                              CSD015
056300200529      ** Temporary Data Structur for Midas Compliance Watch                                   CSD015
056400200529     D TEMPDS          DS          3000                                                       CSD015
056500200529                                                                                              CSD015
056600200529      ** Midas Functions for Watch List Checking Details File                                 CSD015
056700200529     D SDWLCC        E DS                  EXTNAME(SDWLCCPD)                                  CSD015
056800200529                                                                                              CSD015
056900200529      ** DS For Watch List Configuration Data File                                            CSD015
057000200529     D SDCWCD        E DS                  EXTNAME(SDCWCDPD)                                  CSD015
057100200529                                                                                              CSD015
057200200529      ** Midas Functions for Watch List Checking Details File                                 CSD015
057300200529     D SDCUST        E DS                  EXTNAME(SDCUSTPD)                                  CSD015
057400200529                                                                                              CSD015
057500200529      ** Declared Variables                                                                   CSD015
057600200529     D PFunc           S              8A                                                      CSD015
057700200529     D PKEY            S             10A                                                      CSD015
057800200529     D PKYSTS          S              7A                                                      CSD015
057900200529     D CSD015          S              1A                                                      CSD015
058000200529     D CCF001          S              1A                                                      CSD015
058100200529     D PDATE           S              5A                                                      CSD015
058200200529     D WFunction       S              8A                                                      CSD015
058300200529     D WIdentifier     S             40A                                                      CSD015
058400200529     D WBranch         S              3A                                                      CSD015
058500200529     D WNotBlank       S              1A                                                      CSD015
058600200529     D WChanged        S              1A                                                      CSD015
058700200529     D WInsert         S              1A                                                      CSD015
058800200529     D WAmend1         S              1A                                                      CSD015
058900200529     D WAmend2         S              1A                                                      CSD015
059000200529     D WAmend3         S              1A                                                      CSD015
059100200529     D WAmend4         S              1A                                                      CSD015
059200200529     D WAmend5         S              1A                                                      CSD015
059300200529     D WAmend6         S              1A                                                      CSD015
059400200529     D WAmend7         S              1A                                                      CSD015
059500200529     D WTradeRef       S              6A                                                      CSD015
059600200529     D WToFromInd      S              1A                                                      CSD015
059700200529     D WByesel         S              1A                                                    BUG12938
059800200529     D ConvertedDate   S               D                                                      CSD015
059900200529     D ConvertedAmt    S             18P 3                                                    CSD015
060000200529     D PDummy10        S             10                                                       CSD015
060100200529     D PDummy16        S             16                                                       CSD015
060200200529                                                                                              CSD015
060300200529      ** Parameters for call to SDWCWLFMT                                                     CSD015
060400200529     D PINP1           S             35A                                                      CSD015
060500200529     D PINP2           S             35A                                                      CSD015
060600200529     D PINP3           S             35A                                                      CSD015
060700200529     D PINP4           S             35A                                                      CSD015
060800200529     D PINP5           S             35A                                                      CSD015
060900200529     D PINP6           S             35A                                                      CSD015
061000200529     D PCCY            S              3A                                                      CSD015
061100200529     D POUT            S            216A                                                      CSD015
061200200529     D PCUST           S              6A                                                      CSD015
061300200529                                                                                              CGL029
061400200529      ** Define fields used in CRE020                                                         CRE020
061500200529     D CRE020          S              1A                                                      CRE020
061600200529     D KRefNo          S             30A                                                      CRE020
061700200529     D KPrgMn          S             10A   INZ('SETRADUPD ')                                  CRE020
061800200529     D PSysVal01       S             20A   INZ('SecuritiesTrades    ')                        CRE020
061900200529     D PCurSet01       S            200A                                                      CRE020
062000200529     D PSysVal02       S             20A                                                      CRE020
062100200529     D PCurSet02       S            200A                                                      CRE020
062200200529     D PSysVal03       S             20A                                                      CRE020
062300200529     D PCurSet03       S            200A                                                      CRE020
062400200529     D PSysVal04       S             20A                                                      CRE020
062500200529     D PCurSet04       S            200A                                                      CRE020
062600200529     D PSysVal05       S             20A                                                      CRE020
062700200529     D PCurSet05       S            200A                                                      CRE020
062800200529     D PSysVal06       S             20A                                                      CRE020
062900200529     D PCurSet06       S            200A                                                      CRE020
063000200529     D PSysVal07       S             20A                                                      CRE020
063100200529     D PCurSet07       S            200A                                                      CRE020
063200200529     D PSysVal08       S             20A                                                      CRE020
063300200529     D PCurSet08       S            200A                                                      CRE020
063400200529     D PSysVal09       S             20A                                                      CRE020
063500200529     D PCurSet09       S            200A                                                      CRE020
063600200529     D PSysVal10       S             20A                                                      CRE020
063700200529     D PCurSet10       S            200A                                                      CRE020
063800200529     D WSysVal01       S              1A                                                      CRE020
063900200529     D WOrgCHTP        S              1A                                                      CRE020
064000200529                                                                                              CRE020
064100200529     D T#TREF          S             26A                                                      CGL029
064200200529                                                                                              CSD015
064300200529     D CAS006          S              1                                                       CAS006
064400200529                                                                                              CAS006
064500200529      ** Array of QCMDEXC command to edit                                                     223870
064600200529      *                                                                                       223870
064700200529     D CMDDLY          S             80    DIM(1) CTDATA PERRCD(1)                            223870
064800200529      *                                                                                       223870
064900200529      ** CGL031 flag                                                                          CGL031
065000200529     D CGL031          S              1A                                                      CGL031
065100200529     D ProcFlag        S              1A                                                      CGL031
065200200529     D RetCode         S             10A                                                      CGL031
065300200529     D DDEUTX          S             16A                                                      CGL031
065400200529     D*WCust****       S              6S 0                                             236705 234440
065500200529      *                                                                                       235112
065600200529      ** Variables for initial value of EU Tax                                                235112
065700200529      *                                                                                       235112
065800200529     D XDDEUTX         S             16A                                                      235112
065900200529     D XEUTX           S             13P 0                                                    235112
066000200529     D XEUTS           S             13P 0                                                    235112
066100200529      *                                                                                       248683
066200200529      ** Flag for Writing to the TRADSDX2 File                                                248683
066300200529      *                                                                                       248683
066400200529     D FLAG2XA         S              1A                                                      248683
066500200529     D FLAG2XB         S              1A                                                      248683
066600200529                                                                                              CGL031
066700200529     IMUSERDDF
066800200529     I              RECI                        MUSR_RECI
066900200529     ITRAUTDF
067000200529     I              RECI                        TRAU_RECI
067100200529     ISEPCCDF
067200200529     I              PTFR                        SEPC_PTFR
067300200529     I/COPY WNCPYSRC,SETRADDI01
067400200529                                                                                CAP006
067500200529
067600200529      /EJECT
067700200529     C*****************************************************************
067800200529     C*                                                               *
067900200529     C* MAIN - MAIN BODY                                              *
068000200529     C*                                                               *
068100200529     C*****************************************************************
068200200529      *                                                                                      BUG7029
068300200529      ** Retrieve ZMUSER details.                                                            BUG7029
068400200529      *                                                                                      BUG7029
068500200529     C     *DTAARA       DEFINE                  ZMUSER                                      BUG7029
068600200529     C                   IN        ZMUSER                                                    BUG7029
068700200529                                                                                             BUG8260
068800200529      ** Access Midas User Details                                                           BUG8260
068900200529                                                                                             BUG8260
069000200529     C                   EVAL      PSUser = PUSRID                                           BUG8260
069100200529     C     PSUser        CHAIN     MUSER                              99                     BUG8260
069200200529                                                                                             BUG8260
069300200529      ** Database error                                                                      BUG8260
069400200529                                                                                             BUG8260
069500200529     C                   IF        *IN99 = *ON                                               BUG8260
069600200529     C                             OR MUSR_RECI <> 'D'                                       BUG8260
069700200529     C                   EVAL      DBFILE = 'MUSER   '                                       BUG8260
069800200529     C                   EVAL      DBASE  = 905                                              BUG8260
069900200529     C                   EVAL      DBKEY  = PSUser                                           BUG8260
070000200529     C                   EXSR      SRERR                                                     BUG8260
070100200529     C                   ENDIF                                                               BUG8260
070200200529
070300200529      ** INITIALIZE WORK FIELDS
070400200529
070500200529     C                   MOVEL     *BLANK        Z#BSTS
070600200529     C                   MOVEL     *BLANK        Z#ASTS
070700200529     C                   Z-ADD     0             NMDP                                         208195
070800200529     C                   EVAL      ByeSel = *Blanks                                           CSC011
070900200529     C/COPY WNCPYSRC,SETRADDC09
071000200529      *                                                                         CAP051
071100200529     C     CAP051        IFEQ      'Y'                                          CAP051
071200200529     C     A_AUTH        ANDEQ     'Y'                                          CAP051
071300200529     C                   MOVE      '00'          BVAUTH                         CAP051
071400200529     C                   ELSE                                                   CAP051
071500200529     C                   MOVE      SAVAUTH       BVAUTH                         CAP051
071600200529     C                   ENDIF                                                  CAP051
071700200529
071800200529      ** Get customer and security details
071900200529
072000200529     C                   EXSR      GETCSSED
072100200529
072200200529      ** Ensure transaction has not been updated by another workstation         CAP006
072300200529      ** - if so, bypass updating and return to calling program.                CAP006
072400200529     C                   EXSR      CHKOTHUPD                                    CAP006
072500200529                                                                                CAP006
072600200529     C     @@RTCD        IFNE      *BLANKS                                      CAP006
072700200529     C                   GOTO      EXIT                                         CAP006
072800200529     C                   END                                                    CAP006
072900200529                                                                                CAP006
073000200529      ** INSERT, AMEND, CHANGE, DELETE, APPROVE OR AUTHORIZE THE TRADE
073100200529
073200200529     C     A_CHTP        CASEQ     'I'           INSERT
073300200529     C     A_CHTP        CASEQ     'A'           AMEND
073400200529     C     A_CHTP        CASEQ     'C'           CHANGE
073500200529     C     A_CHTP        CASEQ     'D'           DELETE
073600200529     C     A_CHTP        CASEQ     'P'           APPROV
073700200529     C     A_CHTP        CASEQ     'Y'           AUTHOR
073800200529     C                   END
073900200529                                                                                              CRE020
074000200529      ** Handle the advice index of this transaction if CRE020 is enabled.                    CRE020
074100200529                                                                                              CRE020
074200200529     C                   IF        CRE020 = 'Y' and                                           CRE020
074300200529     C                             WSysVal01 = 'Y'                                            CRE020
074400200529     C                   EXSR      SRIdxTrn                                                   CRE020
074500200529     C                   ENDIF                                                                CRE020
074600200529
074700200529      ** UPDATE TRADE EXTENSION 1 A & B RECORD
074800200529      ** (B RECORD ONLY IF PORTFOLIO CUSTOMER)
074900200529      ** (         AND IF MT5XX PHASE II IS ON)                                 154562
075000200529
075100200529     C     S01401        IFEQ      'Y'
075200200529     C                   EXSR      UTRADSX1A
075300200529     C     CustClass     IFEQ      'S'
075400200529     C     CustClass     OREQ      'D'
075500200529     C     CSW003        IFEQ      'Y'                                          154562
075600200529     C                   EXSR      UTRADSX1B
075700200529     C                   END                                                    154562
075800200529     C                   END
075900200529     C                   END
076000200529      ** Write a record to the Trade Movement Status File for the                             CSE039
076100200529      *  processed trade.                                                                     CSE039
076200200529     C     CSE039        IFEQ      'Y'                                                        CSE039
076300200529     C                   EXSR      SrMovement                                                 CSE039
076400200529     C                   ENDIF                                                                CSE039
076500200529      *                                                                                       CSE039
076600200529
076700200529      ** If action is insert, amend, change or delete ...
076800200529
076900200529     C     A_CHTP        IFEQ      'I'
077000200529     C     A_CHTP        OREQ      'A'
077100200529     C     A_CHTP        OREQ      'C'
077200200529     C     A_CHTP        OREQ      'D'
077300200529     C     A_CHTP        OREQ      'Y'                                                        230335
077400200529     C     B_LCD         ANDNE     BJRDNB                                                     230335
077500200529
077600200529      ** and if trade is now complete ...
077700200529
077800200529     C     A_TINC        IFEQ      'C'
077900200529
078000200529      **  ... update on-line balances
078100200529
078200200529     C                   EXSR      ONLNUP
078300200529
078400200529      *   ... update book positions
078500200529
078600200529     C                   EXSR      WBKPOS
078700200529
078800200529      *   ... update client depot positions if portfolio client
078900200529
079000200529     C     CustClass     IFEQ      'S'
079100200529     C     CustClass     OREQ      'D'
079200200529     C                   EXSR      WCPOSN
079300200529     C                   END
079400200529
079500200529      *   ... update user depot positions
079600200529
079700200529     C                   EXSR      WUDEPP
079800200529     C                   END
079900200529     C                   END
080000200529
080100200529      *  If action is not insert and settlement data has changed
080200200529
080300200529     C     A_CHTP        IFNE      'I'
080400200529     C     TNSN          IFNE      B_TNSN
080500200529     C     A_CHTP        ANDEQ     'C'                                                        234927
080600200529     C     TNSP          ORNE      B_TNSP
080700200529     C     A_CHTP        ANDEQ     'C'                                                        234927
080800200529     C     A_CHTP        OREQ      'D'                                                        234927
080900200529     C     BVAUTH        ANDEQ     '00'                                                       234927
081000200529     C     RECI          OREQ      'A'                                                        234927
081100200529     C     BVAUTH        ANDEQ     '00'                                                       234927
081200200529     C     RECI          OREQ      'P'                                                        234927
081300200529     C     A_CHTP        OREQ      'Y'                                                        234927
081400200529     C     B_CHTP        ANDEQ     'D'                                                        234927
081500200529
081600200529      *   ... update Trade settlement details
081700200529
081800200529     C                   EXSR      WSETTL
081900200529     C                   END
082000200529     C                   END
082100200529
082200200529      *  Write to authorisation file if necessary
082300200529
082400200529     C     BVAUTH        IFNE      '00'
082500200529      *                                                                         CAP051
082600200529      ** If Authorisation level on SE I.C.D. is > 00,                           CAP051
082700200529      ** Then a record must be created in PF/TRAUTD to send a confirmation      CAP051
082800200529      ** to Meridian                                                            CAP051
082900200529     C     SAVAUTH       ORNE      '00'                                         CAP051
083000200529     C     CAP051        ANDEQ     'Y'                                          CAP051
083100200529     C     A_AUTH        ANDEQ     'Y'                                          CAP051
083200200529                                                                                CAP051
083300200529     C                   EXSR      WTRAUT
083400200529     C                   END
083500200529
083600200529      *  If Profit Centres are used
083700200529      *  Write to Profit Centre position files, if new book or customer
083800200529      *  position and trade is now complete
083900200529
084000200529     C     BKPRCU        IFEQ      'Y'
084100200529     C     A_TINC        ANDEQ     'C'
084200200529     C                   EXSR      WPRFC
084300200529     C                   END
084400200529
084500200529      *    Update audit files
084600200529
084700200529     C                   EXSR      WAUDIT
084800200529
084900200529      ** If 24x7 Midas Availability is installed                                              CSC011
085000200529      ** and Support System is active                                                         CSC011
085100200529                                                                                              CSC011
085200200529     C                   IF        (CSC011 = 'Y') AND (LIBR = S1SUPP)                         CSC011
085300200529                                                                                              CSC011
085400200529     C                   CALLB     'SETRADLOG'                                                CSC011
085500200529     C                   PARM      *BLANKS       RetCodeOut                                   CSC011
085600200529     C                   PARM      A_CHTP        PAction                                      CSC011
085700200529     C                   PARM                    CAS006                                       CAS006
085800200529     C                   PARM                    TRADSF                                       CSC011
085900200529     C                   PARM                    CT2AFilFmt                                   CSC011
086000200529     C                   PARM                    CT2BFilFmt                                   CSC011
086100200529     C                   PARM                    TRANSDTL                                     CSC011
086200200529                                                                                              CSC011
086300200529      ** Write to support database log file                                                   CSC011
086400200529                                                                                              CSC011
086500200529     C                   IF        RetCodeOut = *Blanks                                       CSC011
086600200529                                                                                              CSC011
086700200529     C                   IF        ByeSel = *Blanks                                           CSC011
086800200529                                                                                              CSC011
086900200529     C                   EVAL      APTGTTYPE = 'SETRAD'                                       CSC011
087000200529                                                                                              CSC011
087100200529     C                   ELSE                                                                 CSC011
087200200529                                                                                              CSC011
087300200529     C                   EVAL      APTGTTYPE = 'SEBYSL'                                       CSC011
087400200529                                                                                              CSC011
087500200529     C                   IF        BYESEL = 'Y'                                               CSC011
087600200529     C                   MOVEL     'SEBYS2'      WTRTP                                        CSC011
087700200529     C                   EVAL      TRANSDTL = WTRTP + TRANSDTL                                CSC011
087800200529     C                   ELSE                                                                 CSC011
087900200529     C                   MOVEL     'SEBYS1'      WTRTP                                        CSC011
088000200529     C                   EVAL      TRANSDTL = WTRTP + TRANSDTL                                CSC011
088100200529     C                   ENDIF                                                                CSC011
088200200529                                                                                              CSC011
088300200529     C                   ENDIF                                                                CSC011
088400200529                                                                                              CSC011
088500200529     C                   EVAL      APUSERID = PSUser                                          CSC011
088600200529     C                   EVAL      APRPRLOCN = A_REPA                                         CSC011
088700200529     C                   MOVEL     A_FRNT        APFOTRANID                                   CSC011
088800200529     C                   MOVEL     A_AFRT        APFOASOCID                                   CSC011
088900200529     C                   MOVEL     A_TDRF        PDealNo                                      CSC011
089000200529                                                                                              CSC011
089100200529     C                   CALLB     'APLOGTRAN'                                                CSC011
089200200529     C                   PARM      *BLANKS       RetCodeOut                                   CSC011
089300200529     C                   PARM                    APHEAD                                       CSC011
089400200529     C                   PARM                    TRANSDTL                                     CSC011
089500200529     C                   PARM      *BLANKS       PTimeStamp                                   CSC011
089600200529     C                   PARM                    PDealNo                                      CSC011
089700200529     C                   PARM      *BLANKS       PADealNo                                     CSC011
089800200529                                                                                              CSC011
089900200529     C                   ENDIF                                                                CSC011
090000200529                                                                                              CSC011
090100200529      ** If error occured,                                                                    CSC011
090200200529                                                                                              CSC011
090300200529     C                   IF        RetCodeOut <> *Blanks                                      CSC011
090400200529     C                   EVAL      @@RTCD = '*ERROR'                                          CSC011
090500200529     C                   ENDIF                                                                CSC011
090600200529                                                                                              CSC011
090700200529     C                   ENDIF                                                                CSC011
090800200529                                                                                              CSC011
090900200529      * EXIT FROM PROGRAM
091000200529     C     EXIT          TAG                                                    CAP006
091100200529
091200200529     C/COPY WNCPYSRC,SETRADDC10
091300200529     C                   RETURN
091400200529     C****************************************************************
091500200529      /EJECT
091600200529     C*****************************************************************         CAP006
091700200529     C*                                                               *         CAP006
091800200529     C* CHKOTHUPD - Check for update by another workstation           *         CAP006
091900200529     C*                                                               *         CAP006
092000200529     C*****************************************************************         CAP006
092100200529     C     CHKOTHUPD     BEGSR                                                  CAP006
092200200529                                                                                CAP006
092300200529      ** Retrieve current Trade details                                         CAP006
092400200529                                                                                CAP006
092500200529     C                   MOVE      A_TDRF        MidasTrNum        6            CAP006
092600200529                                                                                CAP006
092700200529      ** Determine whether program is running interactively or in batch         CAP006
092800200529      **  ( 0 = batch   1 = interactive)                                        CAP006
092900200529      *                                                                         CAP006
093000200529     C                   CALLB     'ZARTVJOBA'                                  CAP006
093100200529     C                   PARM                    @Return           6            CAP006
093200200529     C                   PARM                    @type             1            CAP006
093300200529      *                                                                         CAP006
093400200529      * Allow access to transaction record by Front-Office ID when in Repair    168345
093500200529      * mode for inserts .Set  *RTV module  parameter  @@MODE  to   *FRONT      168345
093600200529      * if the pgm is:  a) running in Interactive mode - @Type= 1   ~~~~~~      168345
093700200529      * and             b) action code is Insert - 'I'                          168345
093800200529      * and             c) Front-Office Id is NOT Blank                         168345
093900200529      *                                                                         168345
094000200529     C     @Type         IFEQ      '1'                                          168345
094100200529     C     A_CHTP        ANDEQ     'I'                                          168345
094200200529     C     A_FRNT        ANDNE     *BLANKS                                      168345
094300200529      *                                                                         168345
094400200529     C                   MOVE      '*FRONT'      @@MODE                         168345
094500200529      *                                                                         168345
094600200529     C                   ELSE                                                   168345
094700200529      *                                                                         168345
094800200529      * Otherwise, if running in batch use Front-Office ID                      168345
094900200529      *            (if insert)                                                  CAP013
095000200529      *            else, use Midas Deal Number                                  168345
095100200529      *                                                                         168345
095200200529     C     @Type         IFEQ      '0'                                          CAP006
095300200529     C     A_CHTP        ANDEQ     'I'                                          CAP013
095400200529     C                   MOVE      '*FRONT'      @@MODE                         CAP006
095500200529     C                   ELSE                                                   CAP006
095600200529     C                   MOVE      *BLANKS       @@MODE                         CAP006
095700200529     C                   END                                                    CAP006
095800200529      *                                                                         168345
095900200529     C                   END                                                    168345
096000200529                                                                                CAP006
096100200529     C                   CALLB     'SETRADRTV'                                  CAP006
096200200529      * INPUTS                                                                  CAP006
096300200529      *                                                                         CAP006
096400200529      * Return code                                                             CAP006
096500200529     C                   PARM      *BLANK        RetCodeOut                     CAP006
096600200529      *                                                                         CAP006
096700200529      * Mode = '*FRONT' (FRONT OFFICE TRANSACTION INTERFACE)                    CAP006
096800200529      * MODE = '      ' (NOT FRONT OFFICE TRANSACTION INTERFACE)                CAP006
096900200529      *                                                                         CAP006
097000200529     C                   PARM                    @@MODE            6            CAP006
097100200529      *                                                                         CAP006
097200200529      * Response mode                                                           CAP006
097300200529     C                   PARM      ' '           @@RSMD            1            CAP006
097400200529      *                                                                         CAP006
097500200529      * Action Code                                                             CAP006
097600200529     C                   PARM      A_CHTP        ACTN              1            CAP006
097700200529      *                                                                         CAP006
097800200529      * Front Office Transaction ID                                             CAP006
097900200529     C                   PARM      A_FRNT        FOTRID           20            CAP006
098000200529      *                                                                         CAP006
098100200529      * (Midas) Trade Reference                                                 CAP006
098200200529     C                   PARM                    MidasTrNum                     CAP006
098300200529      *                                                                         CAP006
098400200529      * (CSW003) MT5XX - Phase 2 Message Generation
098500200529     C                   PARM                    CSW003            1
098600200529      *                                                                                       CAP067
098700200529      * Buy-sell back                                                                         CAP067
098800200529     C                   PARM                    PFBYSL            1                          CAP067
098900200529      *                                                                                       CAP067
099000200529      * Trade Reference                                                                       CAP067
099100200529     C                   PARM                    PFTDRF            6                          CAP067
099200200529      *
099300200529      * OUTPUTS                                                                 CAP006
099400200529      *                                                                         CAP006
099500200529      * (Current) TRADE in file format
099600200529     C                   PARM                    ChkTradFmt                     CAP006
099700200529     C                   PARM                    CT1AFilFmt
099800200529     C                   PARM                    CT1BFilFmt
099900200529      *                                                                         CAP006
100000200529      * OK - Action code                                                        CAP006
100100200529     C                   PARM      *BLANK        DDACTNOK                          CAP006
100200200529      *                                                                         CAP006
100300200529      * OK - Trade Reference                                                    CAP006
100400200529     C                   PARM      *BLANK        DDTDRFOK                         CAP006
100500200529      *                                                                         CAP006
100600200529      * Error fields/message IDs/message data (arrays) from/to caller           CAP006
100700200529     C                   PARM      *BLANK        FldNameArr                     CAP006
100800200529     C                   PARM      *BLANK        MsgIdArr                       CAP006
100900200529     C                   PARM      *BLANK        MsgDtaArr                      CAP006
101000200529      *                                                                         CAP006
101100200529      * Array index (3P0) from/to caller                                        CAP006
101200200529     C                   PARM      *ZERO         Idx               3 0          CAP006
101300200529      *                                                                         CAP006
101400200529      *                                                                         CAP006
101500200529      ** Error if Timestamp is not the same (record has been changed            CAP006
101600200529      **  by another workstation)                                               CAP006
101700200529                                                                                CAP006
101800200529      ** Processing varies according to mode program is running in.             CAP006
101900200529      ** In interacive mode simply check whether the timestamp field            CAP006
102000200529      ** has been updated since the original Trade was fetched by this          CAP006
102100200529      ** program.                                                               CAP006
102200200529      ** In batch (API input) check return parameters from Retrieve             CAP006
102300200529      ** module for errors, and send message to system operator.                CAP006
102400200529                                                                                CAP006
102500200529      ** Interactive mode:                                                      CAP006
102600200529                                                                                CAP006
102700200529     C     @TYPE         IFEQ      '1'                                          CAP006
102800200529                                                                                CAP006
102900200529     C     CHTMST        IFNE      A_TMST                                       CAP006
103000200529     C     ACTN          ANDNE     'I'                                                        CAP087
103100200529     C                   MOVEL     '*RECUPD'     @@RTCD                         CAP006
103200200529     C                   END                                                    CAP006
103300200529                                                                                CAP006
103400200529      ** Batch mode:                                                            CAP006
103500200529     C                   ELSE                                                   CAP006
103600200529     C     DDACTNOK      IFEQ      'N'                                             CAP006
103700200529     C     DDTDRFOK      OREQ      'N'                                            CAP006
103800200529     C                   MOVEL     '*RECUPD'     @@RTCD                         CAP006
103900200529     C                   Z-ADD     1             C                 2 0          CAP006
104000200529                                                                                CAP006
104100200529     C     C             DOWLE     ArrayMax                                     CAP006
104200200529     C     FldNameArr(C) ANDNE     *BLANKS                                      CAP006
104300200529     C*******************MOVEL     *BLANKS       DBError          28     CAP006 CAP013
104400200529     C*******************MOVEL     MsgIDArr(C)   DBError                 CAP006 CAP013
104500200529     C                   CLEAR                   DBError         132            CAP013
104600200529     C                   EVAL      DBerror = 'Update error: ' + FOTRID          CAP013
104700200529     C                   CALLB     'ZAMSGTOOPR'                                 CAP006
104800200529     C                   PARM                    MsgSndRtn        10            CAP006
104900200529     C                   PARM                    DBError                        CAP006
105000200529     C                   PARM                    DummyMsgID                     CAP006
105100200529     C                   PARM                    DummyMsgF                      CAP006
105200200529     C                   ADD       1             C                              CAP006
105300200529     C                   END                                                    CAP006
105400200529                                                                                CAP006
105500200529     C                   END                                                    CAP006
105600200529                                                                                CAP006
105700200529     C                   END                                                    CAP006
105800200529                                                                                CAP006
105900200529     C                   ENDSR                                                  CAP006
106000200529     C*****************************************************************         CAP006
106100200529      /EJECT                                                                    CAP006
106200200529     C****************************************************************
106300200529     C*                                                              *
106400200529     C* INSERT - INSERT A TRADE                                      *
106500200529     C*                                                              *
106600200529     C****************************************************************
106700200529     C     INSERT        BEGSR
106800200529
106900200529      ** ACCESS TRADE
107000200529
107100200529     C     A_TDRF        CHAIN     TRADSDF                            99
107200200529
107300200529      ** DATABASE ERROR
107400200529
107500200529     C     *IN99         IFEQ      '0'
107600200529     C                   MOVEL     A_TDRF        DBKEY
107700200529     C                   MOVEL     'TRADSD'      DBFILE                         ************
107800200529     C                   MOVEL     '001'         DBASE                          * DBERR 002*
107900200529     C                   EXSR      SRERR                                        ************
108000200529     C                   END
108100200529                                                                                              CAP067
108200200529      ** Setup BSPOSD details before update if trade is Buy-Sell                              CAP067
108300200529                                                                                              CAP067
108400200529     C                   IF        A_LKRF <> *BLANKS                                          CAP067
108500200529     C                   EXSR      SHRECK                                                     CAP067
108600200529     C                   ENDIF                                                                CAP067
108700200529
108800200529      ** INITIALIZE TRADE
108900200529
109000200529     C                   CLEAR                   TRADSF
109100200529
109200200529      ** UPDATE 'BEFORE' STATUS
109300200529
109400200529     C                   MOVEL     TRADSF        Z#BSTS
109500200529     C                   MOVEL     TRADSF        B_TRADS
109600200529     C                   MOVEL     RECI          PREVREC           1                          179084
109700200529     C*****B_RECI        IFNE      'R'                                                 230335 258848
109800200529     C*****B_LCD         ANDNE     BJRDNB                                              230335 258848
109900200529     C**********         MOVEL     *BLANK        Z#BSTS                                230335 258848
110000200529     C**********         ENDIF                                                         230335 258848
110100200529
110200200529      ** SET TRADE FIELDS ON INSERT
110300200529
110400200529     C                   EXSR      SETINS
110500200529                                                                                              CSC011
110600200529      ** If CSC011 is installed, supply a Front Office ID for the                             CSC011
110700200529      ** transaction even if it originated from SIN module.                                   CSC011
110800200529                                                                                              CSC011
110900200529     C                   IF        CSC011 = 'Y'                                               CSC011
111000200529     C                   IF        FRNT = *BLANKS                                             CSC011
111100200529     C                   EVAL      FRNT = 'MD' + TDRF                                         CSC011
111200200529     C                   ENDIF                                                                CSC011
111300200529     C                   ENDIF                                                                CSC011
111400200529                                                                                              CSC011
111500200529      ** If compliance watch is installed, and entry watch list checking                      CSD015
111600200529      ** is being applied, perform compliance watch processing                                CSD015
111700200529                                                                                              CSD015
111800200529     C                   IF        CSD015 = 'Y' and W1EWLC = 'Y'                              CSD015
111900200529     C                   IF        CSC011 = 'N' or                                            CSD015
112000200529     C                             CSC011 = 'Y' and LIBR = S1MAIN                             CSD015
112100200529     C                   EXSR      SRCheck                                                    CSD015
112200200529     C                   IF        WNotBlank = 'Y'                                            CSD015
112300200529     C                   EVAL      WInsert = 'Y'                                              CSD015
112400200529     C                   EXSR      SrWatch                                                    CSD015
112500200529     C                   ENDIF                                                                CSD015
112600200529     C                   ENDIF                                                                CSD015
112700200529     C                   ENDIF                                                                CSD015
112800200529
112900200529      ** WRITE NEW TRADE
113000200529
113100200529     C                   WRITE     TRADSDF
113200200529                                                                                              CAP067
113300200529      ** Write Buy-Sell positions file if required                                            CAP067
113400200529                                                                                              CAP067
113500200529     C                   IF        BYESEL = 'Y'                                               CAP067
113600200529     C                   WRITE     BSPOSD0                                                    CAP067
113700200529     C                   ENDIF                                                                CAP067
113800200529
113900200529      ** UPDATE 'AFTER' STATUS
114000200529
114100200529     C                   MOVEL     TRADSF        Z#ASTS
114200200529
114300200529     C/COPY WNCPYSRC,SETRADDC11
114400200529     C                   ENDSR
114500200529     C****************************************************************
114600200529      /EJECT
114700200529     C****************************************************************
114800200529     C*                                                              *
114900200529     C* AMEND  - AMEND A TRADE                                       *
115000200529     C*                                                              *
115100200529     C****************************************************************
115200200529     C     AMEND         BEGSR
115300200529
115400200529      ** ACCESS TRADE
115500200529
115600200529     C     A_TDRF        CHAIN     TRADSDF                            99
115700200529
115800200529      ** DATABASE ERROR
115900200529
116000200529     C     *IN99         IFEQ      '1'
116100200529     C                   MOVEL     A_TDRF        DBKEY
116200200529     C                   MOVEL     'TRADSD'      DBFILE                         ************
116300200529     C                   MOVEL     '002'         DBASE                          * DBERR 002*
116400200529     C                   EXSR      SRERR                                        ************
116500200529     C                   END
116600200529
116700200529      ** UPDATE 'BEFORE' STATUS
116800200529
116900200529     C                   MOVEL     TRADSF        Z#BSTS
117000200529     C                   MOVEL     TRADSF        B_TRADS
117100200529     C                   MOVEL     RECI          PREVREC           1                          179084
117200200529
117300200529      ** SET TRADE FIELDS ON AMEND
117400200529
117500200529     C                   EXSR      SETAMD
117600200529
117700200529      ** If compliance watch is installed, and entry watch list checking                      CSD015
117800200529      ** is being applied, perform compliance watch processing                                CSD015
117900200529                                                                                              CSD015
118000200529     C                   IF        CSD015 = 'Y' and W1EWLC = 'Y'                              CSD015
118100200529     C                   IF        CSC011 = 'N' or                                            CSD015
118200200529     C                             CSC011 = 'Y' or LIBR = S1MAIN                              CSD015
118300200529                                                                                              CSD015
118400200529     C                   EXSR      SRCheck                                                    CSD015
118500200529     C                   EVAL      WFunction = 'TRADSD'                                       CSD015
118600200529     C                   EVAL      WIdentifier = TDRF                                         CSD015
118700200529     C                   EVAL      WBranch = TDBA                                             CSD015
118800200529                                                                                              CSD015
118900200529     C     KTradChk      CHAIN     SDCWHTL1                                                   CSD015
119000200529                                                                                              CSD015
119100200529     C                   IF        %FOUND(SDCWHTL1) and W3UNCF = 'Y'                          CSD015
119200200529     C                             and WNotBlank = 'Y' or WChanged = 'Y'                      CSD015
119300200529     C                   EVAL      WInsert = 'N'                                              CSD015
119400200529     C                   EXSR      SRWatch                                                    CSD015
119500200529     C                   ENDIF                                                                CSD015
119600200529                                                                                              CSD015
119700200529     C                   ENDIF                                                                CSD015
119800200529     C                   ENDIF                                                                CSD015
119900200529                                                                                              CSD015
120000200529      ** UPDATE RECORD
120100200529
120200200529     C                   UPDATE    TRADSDF
120300200529
120400200529      ** UPDATE 'AFTER' STATUS
120500200529
120600200529     C*****B_RECI        IFEQ      'L'                                               230335 BUG20458
120700200529     C*****B_RECI        OREQ      'P'                                               230335 BUG20458
120800200529     C                   MOVEL     TRADSF        Z#ASTS
120900200529     C**********         ENDIF                                                       230335 BUG20458
121000200529      *
121100200529     C                   ENDSR
121200200529     C****************************************************************
121300200529      /EJECT
121400200529     C****************************************************************
121500200529     C*                                                              *
121600200529     C* CHANGE - CHANGE A TRADE                                      *
121700200529     C*                                                              *
121800200529     C****************************************************************
121900200529     C     CHANGE        BEGSR
122000200529
122100200529      ** Access trade using link reference number                                           BUG12938
122200200529                                                                                            BUG12938
122300200529     C                   EVAL      Wbyesel = 'N'                                            BUG12938
122400200529     C                   IF        A_LKRF <> *BLANKS                                        BUG12938
122500200529     C     A_LKRF        CHAIN     TRADSDF                                                  BUG12938
122600200529     C                   IF        %FOUND(TRADS)                                            BUG12938
122700200529     C                   EVAL      Wbyesel = 'Y'                                            BUG12938
122800200529     C                   ENDIF                                                              BUG12938
122900200529     C                   ENDIF                                                              BUG12938
123000200529                                                                                            BUG12938
123100200529      ** ACCESS TRADE
123200200529
123300200529     C     A_TDRF        CHAIN     TRADSDF                            99
123400200529
123500200529      ** DATABASE ERROR
123600200529
123700200529     C     *IN99         IFEQ      '1'
123800200529     C                   MOVEL     A_TDRF        DBKEY
123900200529     C                   MOVEL     'TRADSD'      DBFILE                         ************
124000200529     C                   MOVEL     '003'         DBASE                          * DBERR 002*
124100200529     C                   EXSR      SRERR                                        ************
124200200529     C                   END
124300200529
124400200529      ** Setup BSPOSD details before update if trade is Buy-Sell                            BUG12938
124500200529                                                                                            BUG12938
124600200529     C                   IF        Wbyesel <> *BLANKS                                       BUG12938
124700200529     C                   EXSR      SHRECC                                                   BUG12938
124800200529     C                   ENDIF                                                              BUG12938
124900200529                                                                                            BUG12938
125000200529      ** UPDATE 'BEFORE' STATUS
125100200529
125200200529     C                   MOVEL     TRADSF        Z#BSTS
125300200529     C                   MOVEL     TRADSF        B_TRADS
125400200529     C                   MOVEL     RECI          PREVREC           1                          179084
125500200529
125600200529      ** SET TRADE FIELDS ON CHANGE
125700200529
125800200529     C                   EXSR      SETCHG
125900200529
126000200529      ** If compliance watch is installed, and entry watch list checking                      CSD015
126100200529      ** is being applied, perform compliance watch processing                                CSD015
126200200529                                                                                              CSD015
126300200529     C                   IF        CSD015 = 'Y' and W1EWLC = 'Y'                              CSD015
126400200529     C                   IF        CSC011 = 'N' or                                            CSD015
126500200529     C                             CSC011 = 'Y' and LIBR = S1MAIN                             CSD015
126600200529                                                                                              CSD015
126700200529     C                   EXSR      SRCheck                                                    CSD015
126800200529     C                   EVAL      WFunction = 'TRADSD'                                       CSD015
126900200529     C                   EVAL      WIdentifier = TDRF                                         CSD015
127000200529     C                   EVAL      WBranch = TDBA                                             CSD015
127100200529                                                                                              CSD015
127200200529     C     KTradChk      CHAIN     SDCWHTL1                                                   CSD015
127300200529                                                                                              CSD015
127400200529     C                   IF        %FOUND(SDCWHTL1) and W3UNCF = 'Y'                          CSD015
127500200529     C                             and WNotBlank = 'Y' or WChanged = 'Y'                      CSD015
127600200529     C                   EVAL      WInsert = 'N'                                              CSD015
127700200529     C                   EXSR      SRWatch                                                    CSD015
127800200529     C                   ENDIF                                                                CSD015
127900200529                                                                                              CSD015
128000200529     C                   ENDIF                                                                CSD015
128100200529     C                   ENDIF                                                                CSD015
128200200529                                                                                              CSD015
128300200529      ** UPDATE RECORD
128400200529
128500200529     C                   UPDATE    TRADSDF
128600200529
128700200529      ** UPDATE 'AFTER' STATUS
128800200529
128900200529     C                   MOVEL     TRADSF        Z#ASTS
129000200529      *
129100200529     C                   ENDSR
129200200529     C****************************************************************
129300200529      /EJECT
129400200529     C****************************************************************
129500200529     C*                                                              *
129600200529     C* DELETE - DELETE A TRADE                                      *
129700200529     C*                                                              *
129800200529     C****************************************************************
129900200529     C     DELETE        BEGSR
130000200529
130100200529      ** Get trade's TACI as it was at the start of the day
130200200529      ** (in case trade was changed earlier today)
130300200529
130400200529     C     A_TDRF        CHAIN     SOBTRSO                            99
130500200529     C     *IN99         IFEQ      '0'
130600200529     C                   MOVE      TACI          S_TACI            1
130700200529     C                   ELSE
130800200529     C                   BITOFF    '01234567'    S_TACI
130900200529     C                   END
131000200529
131100200529      ** ACCESS TRADE
131200200529
131300200529     C     A_TDRF        CHAIN     TRADSDF                            99
131400200529
131500200529      ** DATABASE ERROR
131600200529
131700200529     C     *IN99         IFEQ      '1'
131800200529     C                   MOVEL     A_TDRF        DBKEY
131900200529     C                   MOVEL     'TRADSD '     DBFILE                         ************
132000200529     C                   MOVEL     '004'         DBASE                          * DBERR 003*
132100200529     C                   EXSR      SRERR                                        ************
132200200529     C                   END
132300200529
132400200529      ** UPDATE 'BEFORE' STATUS
132500200529
132600200529     C                   MOVEL     TRADSF        Z#BSTS
132700200529     C                   MOVEL     TRADSF        B_TRADS
132800200529     C                   MOVEL     RECI          PREVREC           1                          179084
132900200529
133000200529      ** SET TRADE FIELDS ON DELETE
133100200529
133200200529     C                   EXSR      SETDEL
133300200529
133400200529      ** UPDATE RECORD
133500200529
133600200529     C                   UPDATE    TRADSDF
133700200529
133800200529      ** UPDATE 'AFTER' STATUS
133900200529
134000200529     C                   MOVEL     TRADSF        Z#ASTS
134100200529      *
134200200529     C                   ENDSR
134300200529     C****************************************************************
134400200529      /EJECT
134500200529     C*****************************************************************
134600200529     C*                                                               *
134700200529     C* AUTHOR - AUTHORIZE A TRADE                                    *
134800200529     C*                                                               *
134900200529     C*****************************************************************
135000200529     C     AUTHOR        BEGSR
135100200529
135200200529      ** ACCESS TRADE
135300200529
135400200529     C     A_TDRF        CHAIN     TRADSDF                            99
135500200529
135600200529      ** DATA BASE ERROR
135700200529
135800200529     C     *IN99         IFEQ      '1'
135900200529     C                   MOVEL     A_TDRF        DBKEY
136000200529     C                   MOVEL     'TRADSD  '    DBFILE                         ************
136100200529     C                   MOVEL     '005'         DBASE                          * DBERR 003*
136200200529     C                   EXSR      SRERR                                        ************
136300200529     C                   END
136400200529
136500200529      ** UPDATE 'BEFORE' STATUS
136600200529
136700200529     C                   MOVEL     TRADSF        Z#BSTS
136800200529     C                   MOVEL     TRADSF        B_TRADS
136900200529     C                   MOVEL     RECI          PREVREC           1                          179084
137000200529     C     B_RECI        IFNE      'R'                                                        258848
137100200529     C     B_LCD         ANDNE     BJRDNB                                                     258848
137200200529     C                   MOVEL     *BLANK        Z#BSTS                                       258848
137300200529     C                   ENDIF                                                                258848
137400200529
137500200529      ** Store original value of CHTP before changing to 'P'                                  CRE020
137600200529                                                                                              CRE020
137700200529     C                   IF        CRE020 = 'Y'                                               CRE020
137800200529     C                   EVAL      WOrgCHTP = CHTP                                            CRE020
137900200529     C                   ENDIF                                                                CRE020
138000200529                                                                                              CRE020
138100200529      ** SET TRADE FIELDS ON AUTHORIZE
138200200529
138300200529     C                   EXSR      SETAUT
138400200529
138500200529      ** UPDATE RECORD
138600200529
138700200529     C                   UPDATE    TRADSDF
138800200529
138900200529      ** UPDATE 'AFTER' STATUS
139000200529
139100200529     C     B_RECI        IFEQ      'L'                                                        258848
139200200529     C     B_RECI        OREQ      'P'                                                        258848
139300200529     C                   MOVEL     TRADSF        Z#ASTS
139400200529     C                   ENDIF                                                                258848
139500200529      *
139600200529     C                   ENDSR
139700200529     C*****************************************************************
139800200529      /EJECT
139900200529     C*****************************************************************
140000200529     C*                                                               *
140100200529     C* APPROV - APPROVE A TRADE                                      *
140200200529     C*                                                               *
140300200529     C*****************************************************************
140400200529     C     APPROV        BEGSR
140500200529
140600200529      ** ACCESS TRADE
140700200529
140800200529     C     A_TDRF        CHAIN     TRADSDF                            99
140900200529
141000200529      ** DATA BASE ERROR
141100200529
141200200529     C     *IN99         IFEQ      '1'
141300200529     C                   MOVEL     A_TDRF        DBKEY
141400200529     C                   MOVEL     'TRADSD  '    DBFILE                         ************
141500200529     C                   MOVEL     '006'         DBASE                          * DBERR 003*
141600200529     C                   EXSR      SRERR                                        ************
141700200529     C                   END
141800200529
141900200529      ** UPDATE 'BEFORE' STATUS
142000200529
142100200529     C                   MOVEL     TRADSF        Z#BSTS
142200200529     C                   MOVEL     TRADSF        B_TRADS
142300200529     C                   MOVEL     RECI          PREVREC           1                          179084
142400200529
142500200529      ** Store original value of CHTP before changing to 'P'                                  CRE020
142600200529                                                                                              CRE020
142700200529     C                   IF        CRE020 = 'Y'                                               CRE020
142800200529     C                   EVAL      WOrgCHTP = CHTP                                            CRE020
142900200529     C                   ENDIF                                                                CRE020
143000200529                                                                                              CRE020
143100200529      ** SET TRADE FIELDS ON APPROVAL
143200200529
143300200529     C                   EXSR      SETAPP
143400200529
143500200529      ** UPDATE RECORD
143600200529
143700200529     C                   UPDATE    TRADSDF
143800200529
143900200529      ** UPDATE 'AFTER' STATUS
144000200529
144100200529     C                   MOVEL     TRADSF        Z#ASTS
144200200529      *
144300200529     C                   ENDSR
144400200529     C*****************************************************************
144500200529      /EJECT
144600200529     C*****************************************************************
144700200529     C*                                                               *
144800200529     C* SETINS - SET TRADE FIELDS ON INSERT                           *
144900200529     C*                                                               *
145000200529     C*****************************************************************
145100200529     C     SETINS        BEGSR
145200200529     C/COPY WNCPYSRC,SETRADDC14
145300200529
145400200529      ** SET TRADE TO CONTENTS OF VALID TRADE RECORD
145500200529
145600200529     C                   MOVEL     SEVTRD        TRADSF
145700200529      *
145800200529      ** Record ID - if no authorization
145900200529      *
146000200529     C     BVAUTH        IFEQ      '00'
146100200529     C                   MOVE      'D'           RECI
146200200529     C                   END
146300200529      *
146400200529      ** Record ID - if authorization
146500200529      *
146600200529     C     BVAUTH        IFNE      '00'
146700200529      *
146800200529      *  Check user's entering threshold to see whether trade
146900200529      *  will need authorising
147000200529      *  First, convert countervalue to base currency
147100200529      *
147200200529     C                   EXSR      TRDVLBS
147300200529     C                   Z-ADD     ZAMTCO        CTVL_BASE        15 0
147400200529      *
147500200529      * Compare countervalue to entering limit
147600200529      *
147700200529     C     CTVL_BASE     IFGT      ENTL
147800200529     C     A_TINC        OREQ      'I'                                                        215727
147900200529     C     INCS          OREQ      'I'                                                        215727
148000200529     C                   MOVE      'L'           RECI
148100200529     C                   ELSE
148200200529     C                   MOVE      'D'           RECI
148300200529     C                   END
148400200529     C                   END
148500200529
148600200529      * Nominal currency and nominal decimal places
148700200529
148800200529     C                   MOVEL     NMCY          TNMC
148900200529     C                   Z-ADD     NMDP          TNMD
149000200529
149100200529      * interest adjustment
149200200529
149300200529     C     PROT          IFEQ      '6'
149400200529     C                   Z-ADD     *ZERO         TINA
149500200529     C                   Z-ADD     *ZERO         TINN                                         CAS006
149600200529     C                   END
149700200529
149800200529      * Related Trade Reference
149900200529
150000200529     C                   MOVEL     *BLANK        RTRF
150100200529      *
150200200529      *  If Bulk Agency Trade : set Agency Trade Indicator
150300200529      *
150400200529     C                   MOVEL     *BLANK        ATRD
150500200529     C     BLKR          IFNE      *BLANKS
150600200529     C     CustClass     IFEQ      'S'
150700200529     C     CustClass     OREQ      'D'
150800200529     C                   MOVE      'C'           ATRD
150900200529     C                   ELSE
151000200529     C                   MOVE      'M'           ATRD
151100200529     C                   END
151200200529     C                   END
151300200529      *
151400200529      *  Bulk Confirmations required
151500200529      *
151600200529     C     BLKR          IFNE      *BLANKS
151700200529     C                   MOVE      'Y'           BCON
151800200529     C                   ELSE
151900200529     C                   MOVE      ' '           BCON
152000200529     C                   END
152100200529
152200200529      * Time of input
152300200529     C                   TIME                    TIME
152400200529      *
152500200529      * Initialize accounting inds
152600200529      *            message inds
152700200529      *            confirmation required indicator
152800200529      *            and settlement data
152900200529      *
153000200529     C                   BITOFF    '01234567'    TACI
153100200529     C                   BITOFF    '01234567'    TMSI
153200200529     C                   MOVE      'Y'           TCFR
153300200529
153400200529     C                   Z-ADD     NOML          TOSN
153500200529     C                   Z-ADD     *ZEROS        TNSN
153600200529     C                   Z-ADD     *ZEROS        TNSP
153700200529
153800200529      * calculate trade settlement value
153900200529
154000200529     C                   EXSR      TRDSETV
154100200529     C                   Z-ADD     ZAMTCO        TOSV
154200200529
154300200529     C                   Z-ADD     *ZEROS        TVSN
154400200529     C                   Z-ADD     *ZEROS        TVSP
154500200529     C                   Z-ADD     *ZEROS        TDSN
154600200529     C                   Z-ADD     *ZEROS        TDSP
154700200529     C                   Z-ADD     *ZEROS        TDFS
154800200529
154900200529      * Settlement Sequence
155000200529
155100200529     C                   Z-ADD     *ZEROS        TSSQ
155200200529
155300200529      * Date Made Complete
155400200529
155500200529     C     TINC          IFEQ      'C'
155600200529     C                   Z-ADD     BJRDNB        TDMC
155700200529     C                   ELSE
155800200529     C                   Z-ADD     *ZEROS        TDMC
155900200529     C                   END
156000200529
156100200529      * Original Entry Date
156200200529     C                   Z-ADD     BJRDNB        TOED
156300200529
156400200529      * Pay/Receive Process Complete
156500200529     C                   MOVE      'N'           PRPC
156600200529
156700200529      * Last change date
156800200529     C                   Z-ADD     BJRDNB        LCD
156900200529
157000200529      * Last swift sequence
157100200529     C                   Z-ADD     *ZEROS        LSWS
157200200529                                                                                              CGL031
157300200529      ** Update customer income file (SDCSINPD) if INSERT.                                    CGL031
157400200529                                                                                              CGL031
157500200529     C                   IF        CGL031 = 'Y'                                               CGL031
157600200529     C                   MOVE      A_CHTP        Procflag                                     CGL031
157700200529     C                   EXSR      SRGenCustIn                                                CGL031
157800200529     C                   ENDIF                                                                CGL031
157900200529      *
158000200529      ** Timestamp                                                              CAP006
158100200529     C                   CALLB     'ZAGENTMSTM'                                 CAP006
158200200529     C                   PARM                    TimeStamp                      CAP006
158300200529                                                                                CAP006
158400200529     C                   EVAL      TMST  = TimeStamp                            CAP006
158500200529                                                                                CAP006
158600200529     C                   ENDSR
158700200529     C*****************************************************************
158800200529      /EJECT
158900200529      *****************************************************************                       CAP067
159000200529      *                                                               *                       CAP067
159100200529      * SHRECK - Setup BSPOSD field details                           *                       CAP067
159200200529      *                                                               *                       CAP067
159300200529      *****************************************************************                       CAP067
159400200529     C     SHRECK        BEGSR                                                                CAP067
159500200529                                                                                              CAP067
159600200529     C                   EVAL      BYESEL = 'N'                                               CAP067
159700200529                                                                                              CAP067
159800200529      ** Access related trade                                                                 CAP067
159900200529                                                                                              CAP067
160000200529     C     A_LKRF        CHAIN     TRADSDF                            99                      CAP067
160100200529                                                                                              CAP067
160200200529      ** If related trade found, setup Buy Sell position details for update later             CAP067
160300200529                                                                                              CAP067
160400200529     C                   IF        *IN99 = '0'                                                CAP067
160500200529                                                                                              CAP067
160600200529     C                   EVAL      BYESEL = 'Y'                                               CAP067
160700200529                                                                                              CAP067
160800200529     C                   IF        TDVD < A_TDVD                                              CAP067
160900200529     C                   EVAL      BSPRF = TDRF                                               CAP067
161000200529     C                   EVAL      BSVD1 = TDVD                                               CAP067
161100200529     C                   EVAL      BSVD2 = A_TDVD                                             CAP067
161200200529     C                   ELSE                                                                 CAP067
161300200529     C                   EVAL      BSPRF = A_TDRF                                             CAP067
161400200529     C                   EVAL      BSVD1 = A_TDVD                                             CAP067
161500200529     C                   EVAL      BSVD2 = TDVD                                               CAP067
161600200529     C                   ENDIF                                                                CAP067
161700200529                                                                                              CAP067
161800200529     C                   EVAL      BSRECI = 'D'                                               CAP067
161900200529     C                   EVAL      BSBCH = A_TDBA                                             CAP067
162000200529     C                   EVAL      BSBOK = A_TDBK                                             CAP067
162100200529     C                   EVAL      BSSEN = A_TDSS                                             CAP067
162200200529     C                   EVAL      BSTD1 = A_TDDT                                             CAP067
162300200529     C                   EVAL      BSTD2 = A_TDDT                                             CAP067
162400200529                                                                                              CAP067
162500200529     C                   Z-ADD     0             BSPL                                         CAP067
162600200529     C                   Z-ADD     0             BSOPL                                        CAP067
162700200529     C                   Z-ADD     0             BSAPL                                        CAP067
162800200529     C                   Z-ADD     0             BSLATD                                       CAP067
162900200529                                                                                              CAP067
163000200529     C                   ENDIF                                                                CAP067
163100200529                                                                                              CAP067
163200200529     C                   ENDSR                                                                CAP067
163300200529      *****************************************************************                       CAP067
163400200529      /EJECT                                                                                  CAP067
163500200529      *****************************************************************                     BUG12938
163600200529      *                                                               *                     BUG12938
163700200529      * SHRECC - Setup BSPOSD field details during change             *                     BUG12938
163800200529      *                                                               *                     BUG12938
163900200529      *****************************************************************                     BUG12938
164000200529     C     SHRECC        BEGSR                                                              BUG12938
164100200529                                                                                            BUG12938
164200200529      ** Get Buy-Sell details for trade reference/link reference                            BUG12938
164300200529                                                                                            BUG12938
164400200529     C     KLPOSR        CHAIN     BSPOSDL0                                                 BUG12938
164500200529     C                   IF        NOT %FOUND(BSPOSDL0)                                     BUG12938
164600200529     C     KLPOSL        CHAIN     BSPOSDL0                                                 BUG12938
164700200529     C                   IF        NOT %FOUND(BSPOSDL0)                                     BUG12938
164800200529     C                   LEAVESR                                                            BUG12938
164900200529     C                   ENDIF                                                              BUG12938
165000200529     C                   ENDIF                                                              BUG12938
165100200529                                                                                            BUG12938
165200200529      ** Setup details                                                                      BUG12938
165300200529                                                                                            BUG12938
165400200529     C                   EVAL      BSBCH = A_TDBA                                           BUG12938
165500200529     C                   EVAL      BSBOK = A_TDBK                                           BUG12938
165600200529     C                   EVAL      BSTD1 = A_TDDT                                           BUG12938
165700200529     C                   EVAL      BSTD2 = A_TDDT                                           BUG12938
165800200529     C                   UPDATE    BSPOSD0                                                  BUG12938
165900200529                                                                                            BUG12938
166000200529     C                   ENDSR                                                              BUG12938
166100200529      *****************************************************************                     BUG12938
166200200529      /EJECT                                                                                BUG12938
166300200529     C*****************************************************************
166400200529     C*                                                               *
166500200529     C* SETAMD - SET TRADE FIELDS ON AMEND                            *
166600200529     C*                                                               *
166700200529     C*****************************************************************
166800200529     C     SETAMD        BEGSR
166900200529
167000200529      ** Update Screen Origin Fields on Amend/Change
167100200529
167200200529     C                   EXSR      UPS_AM_CH
167300200529      *
167400200529      * Check trade date and value date accounting indicators
167500200529      *
167600200529     C                   TESTB     '1'           TACI                     97
167700200529     C                   TESTB     '0'           TACI                     99
167800200529      *
167900200529      * If settlement details have changed
168000200529      * ('after' values different from 'before' values)
168100200529      *
168200200529     C     A_SMTH        IFNE      B_SMTH
168300200529     C     TDTP          OREQ      'TP'
168400200529     C     A_PYFM        ANDNE     B_PYFM
168500200529     C     TDTP          OREQ      'TS'
168600200529     C     A_PAYT        ANDNE     B_PAYT
168700200529     C     A_TDMI        ORNE      B_TDMI
168800200529     C     A_TDER        ORNE      B_TDER
168900200529     C     *IN97         OREQ      '1'
169000200529     C     A_DELT        ANDNE     B_DELT
169100200529     C     *IN99         OREQ      '1'
169200200529     C     A_DELT        ANDNE     B_DELT
169300200529     C     *IN97         OREQ      '1'
169400200529     C     A_DELF        ANDNE     B_DELF
169500200529     C     *IN99         OREQ      '1'
169600200529     C     A_DELF        ANDNE     B_DELF
169700200529      *
169800200529      ** Record ID - if no authorization
169900200529      ** Reset Rec id to reverse original accounting
170000200529      *
170100200529     C     BVAUTH        IFEQ      '00'
170200200529     C                   MOVE      'A'           RECI
170300200529     C                   END
170400200529      *
170500200529      ** Record ID - if authorization
170600200529      ** Reset Rec Id as long as trade is not previously unauthorised
170700200529      *
170800200529     C     BVAUTH        IFNE      '00'
170900200529     C     RECI          IFNE      'L'
171000200529     C                   MOVE      'P'           RECI
171100200529     C                   END
171200200529     C                   END
171300200529      *
171400200529      * Reset accounting inds
171500200529      *       confirmation required indicator
171600200529      *       and settlement data
171700200529      *
171800200529     C                   BITOFF    '01234567'    TACI
171900200529     C**********         MOVE      'Y'           TCFR                                         245970
172000200529
172100200529     C                   Z-ADD     NOML          TOSN
172200200529     C                   Z-ADD     *ZEROS        TNSN
172300200529     C                   Z-ADD     *ZEROS        TNSP
172400200529
172500200529      * calculate trade settlement value
172600200529
172700200529     C                   EXSR      TRDSETV
172800200529     C                   Z-ADD     ZAMTCO        TOSV
172900200529      *
173000200529     C                   Z-ADD     *ZEROS        TVSN
173100200529     C                   Z-ADD     *ZEROS        TVSP
173200200529     C                   Z-ADD     *ZEROS        TDSN
173300200529     C                   Z-ADD     *ZEROS        TDSP
173400200529     C                   Z-ADD     *ZEROS        TDFS
173500200529
173600200529      * Settlement Sequence
173700200529
173800200529     C                   Z-ADD     *ZEROS        TSSQ
173900200529
174000200529      * Pay/Receive Process Complete
174100200529     C                   MOVE      'N'           PRPC
174200200529     C                   END
174300200529
174400200529     C                   MOVE      'Y'           TCFR                                         245970
174500200529      *                                                                                       245970
174600200529      * Date Made Complete
174700200529
174800200529     C     B_TINC        IFEQ      'I'
174900200529     C     TINC          ANDEQ     'C'
175000200529     C                   Z-ADD     BJRDNB        TDMC
175100200529     C                   END
175200200529
175300200529      * Last change date
175400200529     C                   Z-ADD     BJRDNB        LCD
175500200529
175600200529      * Type of last change
175700200529     C                   MOVEL     A_CHTP        CHTP
175800200529     C/COPY WNCPYSRC,SETRADDC01
175900200529      *                                                                         CAP013
176000200529      ** Front office transaction ID                                            CAP013
176100200529      *                                                                         CAP013
176200200529     C                   MOVEL     A_FRNT        FRNT                           CAP013
176300200529      *                                                                         CAP013
176400200529      ** Associated front office transaction ID                                 CAP013
176500200529      *                                                                         CAP013
176600200529     C                   MOVEL     A_AFRT        AFRT                           CAP013
176700200529                                                                                              CGL031
176800200529      ** Update customer income file (SDCSINPD) if AMEND.                                     CGL031
176900200529                                                                                              CGL031
177000200529     C                   IF        CGL031 = 'Y'                                               CGL031
177100200529     C                   MOVE      A_CHTP        ProcFlag                                     CGL031
177200200529     C                   EXSR      SRGenCustIn                                                CGL031
177300200529     C                   ENDIF                                                                CGL031
177400200529      *
177500200529      ** Timestamp                                                              CAP006
177600200529     C                   CALLB     'ZAGENTMSTM'                                 CAP006
177700200529     C                   PARM                    TimeStamp                      CAP006
177800200529                                                                                CAP006
177900200529     C                   EVAL      TMST = TimeStamp                             CAP006
178000200529                                                                                CAP006
178100200529     C                   ENDSR
178200200529     C*****************************************************************
178300200529      /EJECT
178400200529     C*****************************************************************
178500200529     C*                                                               *
178600200529     C* SETCHG - SET TRADE FIELDS ON CHANGE                           *
178700200529     C*                                                               *
178800200529     C*****************************************************************
178900200529     C     SETCHG        BEGSR
179000200529      *
179100200529      ** Record ID - if no authorization
179200200529      ** Reset Rec id to reverse original accounting
179300200529      *
179400200529     C     BVAUTH        IFEQ      '00'
179500200529     C                   MOVE      'A'           RECI
179600200529     C                   END
179700200529      *
179800200529      ** Record ID - if authorization
179900200529      ** Reset Rec Id as long as trade is not previously unauthorised
180000200529      *
180100200529     C     BVAUTH        IFNE      '00'
180200200529     C     RECI          IFNE      'L'
180300200529     C                   MOVE      'P'           RECI
180400200529     C                   END
180500200529     C                   END
180600200529
180700200529      ** Update Screen Origin Fields on Amend/Change
180800200529
180900200529     C                   EXSR      UPS_AM_CH
181000200529      *
181100200529      * Reset accounting inds
181200200529      *       confirmation required indicator
181300200529      *       and settlement data
181400200529      *
181500200529     C                   BITOFF    '01234567'    TACI
181600200529     C                   MOVE      'Y'           TCFR
181700200529
181800200529     C                   Z-ADD     NOML          TOSN
181900200529     C                   Z-ADD     *ZEROS        TNSN
182000200529     C                   Z-ADD     *ZEROS        TNSP
182100200529
182200200529      * calculate trade settlement value
182300200529
182400200529     C                   EXSR      TRDSETV
182500200529     C                   Z-ADD     ZAMTCO        TOSV
182600200529
182700200529     C                   Z-ADD     *ZEROS        TVSN
182800200529     C                   Z-ADD     *ZEROS        TVSP
182900200529     C                   Z-ADD     *ZEROS        TDSN
183000200529     C                   Z-ADD     *ZEROS        TDSP
183100200529     C                   Z-ADD     *ZEROS        TDFS
183200200529
183300200529      * Settlement Sequence
183400200529     C                   Z-ADD     *ZEROS        TSSQ
183500200529
183600200529      * Date Made Complete
183700200529
183800200529     C     B_TINC        IFEQ      'I'
183900200529     C     TINC          ANDEQ     'C'
184000200529     C                   Z-ADD     BJRDNB        TDMC
184100200529     C                   END
184200200529
184300200529      * Pay/Receive Process Complete
184400200529     C                   MOVE      'N'           PRPC
184500200529
184600200529      * Last change date
184700200529     C                   Z-ADD     BJRDNB        LCD
184800200529
184900200529      * Type of last change
185000200529     C                   MOVEL     A_CHTP        CHTP
185100200529      *                                                                         CAP013
185200200529      ** Front office transaction ID                                            CAP013
185300200529      *                                                                         CAP013
185400200529     C                   MOVEL     A_FRNT        FRNT                           CAP013
185500200529      *                                                                         CAP013
185600200529      ** Associated front office transaction ID                                 CAP013
185700200529      *                                                                         CAP013
185800200529     C                   MOVEL     A_AFRT        AFRT                           CAP013
185900200529
186000200529      ** Timestamp                                                              CAP006
186100200529     C                   CALLB     'ZAGENTMSTM'                                 CAP006
186200200529     C                   PARM                    TimeStamp                      CAP006
186300200529                                                                                CAP006
186400200529     C                   EVAL      TMST = TimeStamp                             CAP006
186500200529                                                                                       CGL031 236679
186600200529      ***Update*customer*income*file*(SDCSINPD)*if*CHANGE.******************           CGL031 236679
186700200529                                                                                       CGL031 236679
186800200529     C**********         IF        CGL031 = 'Y'                                        CGL031 236679
186900200529     C**********         MOVE      A_CHTP        ProcFlag                              CGL031 236679
187000200529     C**********         EXSR      SRGenCustIn                                         CGL031 236679
187100200529     C**********         ENDIF                                                         CGL031 236679
187200200529                                                                                CAP006
187300200529     C                   ENDSR
187400200529     C*****************************************************************
187500200529      /EJECT
187600200529     C*****************************************************************
187700200529     C*                                                               *
187800200529     C* SETDEL - SET TRADE FIELDS ON DELETE                           *
187900200529     C*                                                               *
188000200529     C*****************************************************************
188100200529     C     SETDEL        BEGSR
188200200529      *
188300200529      ** Record ID - if no authorization
188400200529      *
188500200529     C     BVAUTH        IFEQ      '00'
188600200529     C*************      MOVE      'C'           RECI                                         179084
188700200529     C**********         MOVE      '*'           RECI                                  179084 191691
188800200529     C                   MOVE      'C'           RECI                                         191691
188900200529     C                   END
189000200529      *
189100200529      ** Record ID - if authorization
189200200529      *
189300200529     C     BVAUTH        IFNE      '00'
189400200529      *
189500200529      *  If trade is not yet authorised, no authorisation is needed
189600200529      *
189700200529     C     RECI          IFEQ      'L'
189800200529     C************       MOVE      'C'           RECI                                         179084
189900200529     C**********         MOVE      '*'           RECI                                  179084 191691
190000200529     C                   MOVE      'C'           RECI                                         191691
190100200529     C                   ELSE
190200200529     C                   MOVE      'R'           RECI
190300200529     C                   END
190400200529     C                   END
190500200529      ***********                                                                      179084 191691
190600200529      ***If*trade is incomplete no authorisation is needed                             179084 191691
190700200529      ***********                                                                      179084 191691
190800200529     C*****TINC**        IFEQ      'I'                                                 179084 191691
190900200529     C***********        MOVE      '*'           RECI                                  179084 191691
191000200529     C***********        END                                                           179084 191691
191100200529     C     TINC          IFEQ      'I'                                                        203470
191200200529     C                   MOVE      'C'           RECI                                         203470
191300200529     C                   ENDIF                                                                203470
191400200529
191500200529      * Reset TACI to as it was at the start of day
191600200529
191700200529     C                   MOVE      S_TACI        TACI
191800200529
191900200529      * Confirmation required Ind
192000200529
192100200529     C                   TESTB     '0'           TMSI                     99
192200200529     C     *IN99         IFEQ      '0'
192300200529     C                   MOVE      'N'           TCFR
192400200529     C                   ELSE
192500200529     C                   MOVE      'Y'           TCFR
192600200529     C                   END
192700200529
192800200529      * Reset settlement data
192900200529
193000200529     C                   Z-ADD     NOML          TOSN
193100200529     C                   Z-ADD     *ZEROS        TNSN
193200200529     C                   Z-ADD     *ZEROS        TNSP
193300200529
193400200529      * calculate trade settlement value
193500200529
193600200529     C                   EXSR      TRDSETV
193700200529     C                   Z-ADD     ZAMTCO        TOSV
193800200529
193900200529     C                   Z-ADD     *ZEROS        TVSN
194000200529     C                   Z-ADD     *ZEROS        TVSP
194100200529     C                   Z-ADD     *ZEROS        TDSN
194200200529     C                   Z-ADD     *ZEROS        TDSP
194300200529     C                   Z-ADD     *ZEROS        TDFS
194400200529
194500200529      * Reset settlement sequence
194600200529
194700200529     C                   Z-ADD     *ZEROS        TSSQ
194800200529
194900200529      *  If a deletion before pay/receive processing
195000200529      *  PRPC is set to Y
195100200529
195200200529     C     PRPC          IFEQ      'Y'
195300200529     C                   MOVE      'N'           PRPC
195400200529     C                   ELSE
195500200529     C                   MOVE      'Y'           PRPC
195600200529     C                   END
195700200529
195800200529      * Last change date
195900200529     C                   Z-ADD     BJRDNB        LCD
196000200529
196100200529      * Type of last change
196200200529     C                   MOVEL     A_CHTP        CHTP
196300200529     C/COPY WNCPYSRC,SETRADDC02
196400200529      *                                                                         CAP013
196500200529      ** Front office transaction ID                                            CAP013
196600200529      *                                                                         CAP013
196700200529     C                   MOVEL     A_FRNT        FRNT                           CAP013
196800200529      *                                                                         CAP013
196900200529      ** Associated front office transaction ID                                 CAP013
197000200529      *                                                                         CAP013
197100200529     C                   MOVEL     A_AFRT        AFRT                           CAP013
197200200529      *
197300200529      ** Timestamp                                                              CAP006
197400200529     C                   CALLB     'ZAGENTMSTM'                                 CAP006
197500200529     C                   PARM                    TimeStamp                      CAP006
197600200529                                                                                CAP006
197700200529     C                   EVAL      TMST = TimeStamp                             CAP006
197800200529                                                                                CAP006
197900200529     C/COPY WNCPYSRC,SETRADDC13
198000200529                                                                                CAP051
198100200529      ** Automatic Authorization flag                                           CAP051
198200200529      *                                                                         CAP051
198300200529     C     CAP051        IFEQ      'Y'                                          CAP051
198400200529     C                   MOVEL     A_AUTH        AUTH                           CAP051
198500200529     C                   ELSE                                                   CAP051
198600200529     C                   MOVE      *BLANKS       AUTH                           CAP051
198700200529     C                   ENDIF                                                  CAP051
198800200529                                                                                              CGL031
198900200529      ** Delete from customer income file (SDCSINPD).                                         CGL031
199000200529                                                                                              CGL031
199100200529     C                   IF        CGL031 = 'Y'                                               CGL031
199200200529     C                   MOVE      A_CHTP        ProcFlag                                     CGL031
199300200529     C                   EVAL      XDDEUTX = DDEUTX                                           235112
199400200529     C                   Z-ADD     EUTX          XEUTX                                        235112
199500200529     C                   Z-ADD     EUTS          XEUTS                                        235112
199600200529     C                   EXSR      SRGenCustIn                                                CGL031
199700200529     C                   EVAL      DDEUTX = XDDEUTX                                           235112
199800200529     C                   Z-ADD     XEUTX         EUTX                                         235112
199900200529     C                   Z-ADD     XEUTS         EUTS                                         235112
200000200529     C                   ENDIF                                                                CGL031
200100200529      *
200200200529     C                   ENDSR
200300200529     C*****************************************************************
200400200529      /EJECT
200500200529     C*****************************************************************
200600200529     C*                                                               *
200700200529     C* SETAUT - SET TRADE FIELDS ON AUTHORIZE                        *
200800200529     C*                                                               *
200900200529     C*****************************************************************
201000200529     C     SETAUT        BEGSR
201100200529      *
201200200529      ** Set record ID according to previous record id
201300200529      *
201400200529      ** RECI=L : inserted not authorized
201500200529      *
201600200529     C     B_RECI        IFEQ      'L'
201700200529     C                   MOVE      'D'           RECI
201800200529     C                   END
201900200529      *
202000200529      ** RECI=P : changed not authorized
202100200529      *
202200200529     C     B_RECI        IFEQ      'P'
202300200529     C                   MOVE      'A'           RECI
202400200529     C                   END
202500200529      *
202600200529      ** RECI=R : deleted not authorized
202700200529      *
202800200529     C     B_RECI        IFEQ      'R'
202900200529     C                   MOVE      'C'           RECI
203000200529     C                   END
203100200529      *                                                                                       223022
203200200529      ** Pay/Receive Process Complete                                                         223022
203300200529      *                                                                                       223022
203400200529     C                   MOVE      'N'           PRPC                                         223022
203500200529
203600200529      * Last change date
203700200529     C                   Z-ADD     BJRDNB        LCD
203800200529
203900200529      * Type of last change
204000200529     C                   MOVEL     A_CHTP        CHTP
204100200529      *                                                                         CAP013
204200200529      ** Front office transaction ID                                            CAP013
204300200529      *                                                                         CAP013
204400200529     C                   MOVEL     A_FRNT        FRNT                           CAP013
204500200529      *                                                                         CAP013
204600200529      ** Associated front office transaction ID                                 CAP013
204700200529      *                                                                         CAP013
204800200529     C                   MOVEL     A_AFRT        AFRT                           CAP013
204900200529      *
205000200529      ** Timestamp                                                              CAP006
205100200529     C                   CALLB     'ZAGENTMSTM'                                 CAP006
205200200529     C                   PARM                    TimeStamp                      CAP006
205300200529                                                                                CAP006
205400200529     C                   EVAL      TMST = TimeStamp                             CAP006
205500200529                                                                                CAP006
205600200529     C                   ENDSR
205700200529     C*****************************************************************
205800200529      /EJECT
205900200529     C*****************************************************************
206000200529     C*                                                               *
206100200529     C* SETAPP - SET TRADE FIELDS ON APPROVAL                         *
206200200529     C*                                                               *
206300200529     C*****************************************************************
206400200529     C     SETAPP        BEGSR
206500200529      *                                                                                       223022
206600200529      ** Pay/Receive Process Complete                                                         223022
206700200529      *                                                                                       223022
206800200529     C                   MOVE      'N'           PRPC                                         223022
206900200529
207000200529      * Last change date
207100200529     C                   Z-ADD     BJRDNB        LCD
207200200529
207300200529      * Type of last change
207400200529     C                   MOVEL     A_CHTP        CHTP
207500200529      *                                                                         CAP013
207600200529      ** Front office transaction ID                                            CAP013
207700200529      *                                                                         CAP013
207800200529     C                   MOVEL     A_FRNT        FRNT                           CAP013
207900200529      *                                                                         CAP013
208000200529      ** Associated front office transaction ID                                 CAP013
208100200529      *                                                                         CAP013
208200200529     C                   MOVEL     A_AFRT        AFRT                           CAP013
208300200529
208400200529      ** Timestamp                                                              CAP006
208500200529     C                   CALLB     'ZAGENTMSTM'                                 CAP006
208600200529     C                   PARM                    TimeStamp                      CAP006
208700200529                                                                                CAP006
208800200529     C                   EVAL      TMST = TimeStamp                             CAP006
208900200529
209000200529     C                   ENDSR
209100200529     C*****************************************************************
209200200529      /EJECT
209300200529     C*****************************************************************
209400200529     C*                                                               *
209500200529     C* UPS_AM_CH - Update Screen Origin Fields on Amend/Change       *
209600200529     C*                                                               *
209700200529     C*****************************************************************
209800200529     C     UPS_AM_CH     BEGSR
209900200529
210000200529      ** Incomplete Indicator
210100200529      ** Security Shortname
210200200529     C                   MOVEL     A_TINC        TINC
210300200529     C                   MOVEL     A_TDSS        TDSS
210400200529
210500200529      ** Counterparty Customer Number
210600200529      ** Trade Type
210700200529      ** Nominal
210800200529      ** Price/Discount/Yield
210900200529      ** Value Date
211000200529     C                   MOVEL     A_TCNR        TCNR
211100200529     C                   MOVEL     A_TDTP        TDTP
211200200529     C                   MOVEL     A_NOML        NOML
211300200529     C                   MOVEL     A_TPDY        TPDY
211400200529     C                   MOVEL     A_TDVD        TDVD
211500200529
211600200529      ** Branch code
211700200529      ** Originating branch
211800200529     C                   MOVEL     A_TDBA        TDBA
211900200529     C                   MOVEL     A_ORBR        ORBR
212000200529
212100200529      ** Book
212200200529      ** Trade Date
212300200529      ** Trade Sub-type
212400200529     C                   MOVEL     A_TDBK        TDBK
212500200529     C                   MOVEL     A_TDDT        TDDT
212600200529     C                   MOVEL     A_TSUB        TSUB
212700200529
212800200529      ** Link Reference
212900200529      ** Market Indicator
213000200529      ** Narrative
213100200529      ** Trader I.D.
213200200529      ** AIBD/IPMA
213300200529      ** Market Centre
213400200529      ** Capacity
213500200529     C                   MOVEL     A_LKRF        LKRF
213600200529     C                   MOVEL     A_TDMI        TDMI
213700200529     C                   MOVEL     A_TDNR        TDNR
213800200529     C                   MOVEL     A_TDID        TDID
213900200529     C                   MOVEL     A_AIIP        AIIP
214000200529     C                   MOVEL     A_TMKC        TMKC
214100200529     C                   MOVEL     A_TCAP        TCAP
214200200529
214300200529      ** Accrued Indicator
214400200529      ** Days Adjustment
214500200529      ** Act/Diff indicator
214600200529      ** Interest Amount (Purchased)
214700200529      ** Interest Adjustment
214800200529      ** Coupon Rate
214900200529     C                   MOVEL     A_ACIN        ACIN
215000200529     C                   MOVEL     A_DADJ        DADJ
215100200529     C                   MOVEL     A_ADIN        ADIN
215200200529     C                   MOVEL     A_ITRA        ITRA
215300200529     C                   MOVEL     A_TINA        TINA
215400200529     C                   MOVEL     A_TDCR        TDCR
215500200529
215600200529      ** Price
215700200529      ** Ex Dividend
215800200529      ** Reallowance
215900200529     C                   MOVEL     A_PRIC        PRIC
216000200529     C                   MOVEL     A_EXDV        EXDV
216100200529     C                   MOVEL     A_RALL        RALL
216200200529
216300200529      ** Settlement Currency
216400200529     C                   MOVEL     A_SETC        SETC
216500200529
216600200529      ** Exchange Rate (Nominal to settle)
216700200529      ** Multiply/Divide Ind
216800200529      ** Base Currency Rate
216900200529     C                   MOVEL     A_TDER        TDER
217000200529     C                   MOVEL     A_TMDI        TMDI
217100200529     C                   MOVEL     A_TBCR        TBCR
217200200529
217300200529      ** Settlement Method
217400200529      ** Pay From
217500200529      ** Pay From Branch
217600200529      ** Pay To
217700200529      ** Pay To Branch
217800200529      ** For Account of (Pay to)
217900200529      ** Account Sequence Number
218000200529      ** Clearance Type
218100200529      ** Deliver to
218200200529      ** For Account of (Deliver to)
218300200529      ** Deliver From
218400200529      ** For Account of (Deliver From)
218500200529      ** Special Instructions
218600200529
218700200529     C                   MOVEL     A_SMTH        SMTH
218800200529     C                   MOVEL     A_PYFM        PYFM
218900200529     C                   MOVEL     A_PYFA        PYFA
219000200529     C                   MOVEL     A_PAYT        PAYT
219100200529     C                   MOVEL     A_PYTA        PYTA
219200200529     C                   MOVEL     A_TDFA        TDFA
219300200529     C                   MOVEL     A_ASNM        ASNM
219400200529     C                   MOVEL     A_CLTY        CLTY
219500200529     C                   MOVEL     A_DELT        DELT
219600200529     C                   MOVEL     A_DTFA        DTFA
219700200529     C                   MOVEL     A_DELF        DELF
219800200529     C                   MOVEL     A_DFFA        DFFA
219900200529     C                   MOVEL     A_TDSI        TDSI
220000200529
220100200529      ** Priority Code
220200200529      ** Pay Code
220300200529     C                   MOVEL     A_PRYC        PRYC
220400200529     C                   MOVEL     A_PCOD        PCOD
220500200529
220600200529      ** Broker Commission Code
220700200529      ** Broker Commission Amount
220800200529     C                   MOVEL     A_TBCC        TBCC
220900200529     C                   MOVEL     A_TBCA        TBCA
221000200529
221100200529      ** Customer Commission Code
221200200529      ** Customer Commission Amt
221300200529     C                   MOVEL     A_TCCC        TCCC
221400200529     C                   MOVEL     A_TCCA        TCCA
221500200529
221600200529      ** Charges Code 1
221700200529      ** Charges Amount 1
221800200529     C                   MOVEL     A_TCC1        TCC1
221900200529     C                   MOVEL     A_TCA1        TCA1
222000200529
222100200529      ** Charges Code 2
222200200529      ** Charges Amount 2
222300200529     C                   MOVEL     A_TCC2        TCC2
222400200529     C                   MOVEL     A_TCA2        TCA2
222500200529
222600200529      ** Charges Code 3
222700200529      ** Charges Amount 3
222800200529     C                   MOVEL     A_TCC3        TCC3
222900200529     C                   MOVEL     A_TCA3        TCA3
223000200529
223100200529      ** Charges Code 4
223200200529      ** Charges Amount 4
223300200529     C                   MOVEL     A_TCC4        TCC4
223400200529     C                   MOVEL     A_TCA4        TCA4
223500200529
223600200529      ** Charges Code 5
223700200529      ** Charges amount 5
223800200529     C                   MOVEL     A_TCC5        TCC5
223900200529     C                   MOVEL     A_TCA5        TCA5
224000200529
224100200529      ** Charges Code 6
224200200529      ** Charges Amount 6
224300200529     C                   MOVEL     A_TCC6        TCC6
224400200529     C                   MOVEL     A_TCA6        TCA6
224500200529
224600200529      ** Charges Code 7
224700200529      ** Charges amount 7
224800200529     C                   MOVEL     A_TCC7        TCC7
224900200529     C                   MOVEL     A_TCA7        TCA7
225000200529
225100200529      ** Tax amount
225200200529      ** Broker Commission Rebate
225300200529      ** Customer Commission Rebate
225400200529      ** Tax Rebate
225500200529     C                   MOVEL     A_TAXA        TAXA
225600200529     C                   MOVEL     A_BCMR        BCMR
225700200529     C                   MOVEL     A_CCMR        CCMR
225800200529     C                   MOVEL     A_TXRB        TXRB
225900200529
226000200529      ** Auto-settle Indicator
226100200529     C                   MOVEL     A_AUTS        AUTS
226200200529
226300200529      ** Consideration
226400200529      ** Countervalue
226500200529     C                   MOVEL     A_TCSR        TCSR
226600200529     C                   MOVEL     A_TCTR        TCTR
226700200529
226800200529      ** Profit Centre - non PCA
226900200529     C                   MOVEL     A_PRFC        PRFC
227000200529
227100200529      ** Current Factor
227200200529     C                   MOVEL     A_TCFC        TCFC
227300200529
227400200529      ** Portfolio reference
227500200529      ** Exchange Rate (Settle > Port
227600200529      ** Spot rate mult/div ind
227700200529     C                   MOVEL     A_PTFR        PTFR
227800200529     C                   MOVEL     A_SPXR        SPXR
227900200529     C                   MOVEL     A_SPMD        SPMD
228000200529
228100200529      ** Book Profit Centre
228200200529      ** Trans Profit Centre
228300200529      ** FX Margin Points
228400200529      ** FX Margin Rate
228500200529      ** Margin Amount
228600200529      ** In Currency in Field 72
228700200529     C                   MOVEL     A_BPRC        BPRC
228800200529     C                   MOVEL     A_TPRC        TPRC
228900200529     C                   MOVEL     A_FXMP        FXMP
229000200529     C                   MOVEL     A_FXMR        FXMR
229100200529     C                   MOVEL     A_MAMT        MAMT
229200200529     C                   MOVEL     A_ICCY        ICCY
229300200529                                                                                CAP051
229400200529      ** Automatic Authorization flag                                           CAP051
229500200529      *                                                                         CAP051
229600200529     C     CAP051        IFEQ      'Y'                                          CAP051
229700200529     C                   MOVEL     A_AUTH        AUTH                           CAP051
229800200529     C                   ELSE                                                   CAP051
229900200529     C                   MOVE      *BLANKS       AUTH                           CAP051
230000200529     C                   ENDIF                                                  CAP051
230100200529      *                                                                         CSE023
230200200529      ** If enhancement 'Treaty withholding tax' is installed,                  CSE023
230300200529      ** amend withholding tax field.                                           CSE023
230400200529      *                                                                         CSE023
230500200529     C                   IF        CSE023 = 'Y'                                 CSE023
230600200529     C                   Z-ADD     A_WHTX        WHTX                           CSE023
230700200529     C                   ELSE                                                   CSE023
230800200529     C                   Z-ADD     *ZEROS        WHTX                           CSE023
230900200529     C                   ENDIF                                                  CSE023
231000200529                                                                                              CAS006
231100200529      ** If CAS006 is on                                                                      CAS006
231200200529                                                                                              CAS006
231300200529     C                   IF        CAS006 = 'Y'                                               CAS006
231400200529     C                   EVAL      CRSK = A_CRSK                                              CAS006
231500200529     C                   EVAL      LQPR = A_LQPR                                              CAS006
231600200529     C                   EVAL      TINN = A_TINN                                              CAS006
231700200529     C                   EVAL      ITRN = A_ITRN                                              CAS006
231800200529     C                   EVAL      PRICN = A_PRICN                                            CAS006
231900200529     C                   ENDIF                                                                CAS006
232000200529
232100200529      * Order Number                                                                          CSE039
232200200529     C                   MOVE      A_ORDE        ORDE                                         CSE039
232300200529      *                                                                                       CSE039
232400200529      ** Fiscal Price                                                                         CGL031
232500200529                                                                                              CGL031
232600200529     C                   IF        CGL031 = 'Y'                                               CGL031
232700200529     C                   MOVEL     A_FSPR        FSPR                                         CGL031
232800200529     C                   MOVEL     A_FSPP        FSPP                                         236073
232900200529     C                   ELSE                                                                 CGL031
233000200529     C                   Z-ADD     *ZEROS        FSPR                                         CGL031
233100200529     C                   Z-ADD     *ZEROS        FSPP                                         236073
233200200529     C                   ENDIF                                                                CGL031
233300200529                                                                                              CGL031
233400200529     C                   ENDSR
233500200529     C*****************************************************************
233600200529      /EJECT
233700200529     C*****************************************************************
233800200529     C*                                                               *
233900200529     C* ONLNUP - ON-LINE UPDATES (MEMOS, PRONO, OLPOS, RSACMTPD)      *
234000200529     C*                                                               *
234100200529     C*****************************************************************
234200200529     C     ONLNUP        BEGSR
234300200529      *
234400200529     C                   CALL      'AOOUTRU0'
234500200529     C                   PARM      *BLANK        @RTCD
234600200529     C                   PARM                    Z#BSTS
234700200529     C                   PARM                    Z#ASTS
234800200529     C     @RTCD         IFEQ      '*ERROR*'
234900200529     C                   MOVEL     *BLANK        DBKEY
235000200529     C                   MOVEL     'AOOUTRU0'    DBFILE                         *************
235100200529     C                   MOVEL     '991'         DBASE                          * DBERR 991 *
235200200529     C                   EXSR      SRERR                                        *************
235300200529     C                   END
235400200529      *                                                                         CDE001
235500200529      ** Data export for CCRM - Limits                                          CDE001
235600200529      *                                                                         CDE001
235700200529     C                   IF        CDE001 = 'Y'                                 CDE001
235800200529     C                   MOVEL     *BLANK        T#TREF                         CDE001
235900200529     C                   MOVEL     A_TDRF        T#TREF                         CDE001
236000200529     C                   CALLB     'DEWRTTRIG'                                  CDE001
236100200529     C**********         PARM                    T#TREF           20                   CDE001 CGL029
236200200529     C                   PARM                    T#TREF                                       CGL029
236300200529     C                   PARM      'STRD'        T#TCAT            4            CDE001
236400200529     C                   PARM      *BLANKS       T#RSRV           10            CDE005
236500200529      *                                                                         CDE001
236600200529     C                   MOVEL     A_TDSS        W#TDSS                         CDE001
236700200529     C                   MOVEL     A_TDBK        W#TDBK                         CDE001
236800200529     C                   MOVEL     A_TDBA        W#TDBA                         CDE001
236900200529     C                   MOVEL     A_TDMI        W#TDMI                         CDE001
237000200529     C                   MOVEL     W#POSID       T#TREF                         CDE001
237100200529     C                   CALLB     'DEWRTTRIG'                                  CDE001
237200200529     C**********         PARM                    T#TREF           20                   CDE001 CGL029
237300200529     C                   PARM                    T#TREF                                       CGL029
237400200529     C                   PARM      'SBPS'        T#TCAT            4            CDE001
237500200529     C                   PARM      *BLANKS       T#RSRV           10            CDE005
237600200529     C                   ENDIF                                                  CDE001
237700200529      *
237800200529     C                   ENDSR
237900200529     C*****************************************************************
238000200529      /EJECT
238100200529      *****************************************************************
238200200529      *                                                               *
238300200529      *  WBKPOS - Subroutine to Update Book Positions.                *
238400200529      *                                                               *
238500200529      *****************************************************************
238600200529     C     WBKPOS        BEGSR
238700200529      *
238800200529     C                   Z-ADD     TDDT          TLPSD
238900200529     C                   Z-ADD     TDVD          VLPSD
239000200529      *
239100200529      *  If amendment and BKPOS key or countervalue fields not changed,
239200200529      *  do not amend BKPOS unless trade made complete.
239300200529      *
239400200529     C     A_CHTP        IFEQ      'A'
239500200529     C     B_TINC        ANDEQ     'C'
239600200529     C     A_CHTP        OREQ      'C'
239700200529     C     B_TINC        ANDEQ     'C'
239800200529      *
239900200529     C     TDSS          IFEQ      B_TDSS
240000200529     C     TDBA          ANDEQ     B_TDBA
240100200529     C     TDBK          ANDEQ     B_TDBK
240200200529     C     TDMI          ANDEQ     B_TDMI
240300200529     C     TDDT          ANDEQ     B_TDDT
240400200529     C     TDVD          ANDEQ     B_TDVD
240500200529     C     TCTR          ANDEQ     B_TCTR
240600200529     C                   GOTO      WBKEND
240700200529     C                   END
240800200529      *
240900200529     C                   END
241000200529     C*
241100200529     C*  Access BKPHD trade date position
241200200529     C*
241300200529     C                   MOVEL     TDSS          BHSC
241400200529     C                   MOVEL     TDBA          BHBA
241500200529     C                   MOVEL     TDBK          BHBK
241600200529     C                   MOVEL     TDMI          BHMK
241700200529     C                   MOVEL     'T'           BHTV
241800200529     C     KLBKPH        CHAIN     BKPHDDF                            44
241900200529     C*
242000200529      ***  Write new BKPHD Trade Date record if doesn't already exist.
242100200529     C*
242200200529     C     *IN44         IFEQ      '1'
242300200529     C                   MOVE      'D'           RECI
242400200529     C                   Z-ADD     TDDT          FPSD
242500200529     C                   Z-ADD     TDDT          LPSD
242600200529     C                   Z-ADD     TDDT          LPCD
242700200529     C                   Z-ADD     *ZEROS        LAVP
242800200529     C                   Z-ADD     *ZEROS        LATD
242900200529     C                   Z-ADD     *ZEROS        ARPC
243000200529     C                   Z-ADD     TDVD          ICLD
243100200529     C                   Z-ADD     *ZEROS        IACR
243200200529     C                   Z-ADD     *ZEROS        IACP
243300200529     C                   Z-ADD     *ZEROS        INDO
243400200529     C                   Z-ADD     *ZEROS        UPPT
243500200529     C                   Z-ADD     *ZEROS        DPAP
243600200529     C                   Z-ADD     *ZEROS        DPFP
243700200529     C                   Z-ADD     *ZEROS        BUDU
243800200529     C                   MOVE      SITP          INVT
243900200529     C                   MOVE      NMCY          NCRY
244000200529     C                   Z-ADD     *ZEROS        LPRC
244100200529     C                   Z-ADD     *ZEROS        BHDP
244200200529     C                   Z-ADD     *ZEROS        BHCP
244300200529     C                   Z-ADD     *ZEROS        BHPP
244400200529     C                   Z-ADD     NATN          TNLU
244500200529     C                   Z-ADD     *ZERO         LAVN                                         CAS006
244600200529     C                   Z-ADD     *ZERO         DPAN                                         CAS006
244700200529     C                   Z-ADD     *ZERO         BUDN                                         CAS006
244800200529     C                   Z-ADD     *ZERO         INDN                                         CAS006
244900200529     C                   Z-ADD     *ZERO         FSEFUP                                       CAS006
245000200529     C                   Z-ADD     *ZERO         FSECUP                                       CAS006
245100200529     C                   Z-ADD     *ZEROS        NAVP                                         CSE065
245200200529     C                   Z-ADD     *ZEROS        BKVAMT                                       CSE065
245300200529     C                   Z-ADD     *ZEROS        EQTAMT                                       CSE065
245400200529     C                   WRITE     BKPHDDF
245500200529     C                   ADD       1             BK_NOR
245600200529     C*
245700200529     C                   END
245800200529     C*
245900200529     C* Remember latest position date
246000200529     C*
246100200529     C                   Z-ADD     LPSD          TLPSD             5 0
246200200529     C/COPY WNCPYSRC,SETRADDC04
246300200529     C*
246400200529     C*
246500200529     C*  If value date LE run date :-
246600200529     C*  Access BKPHD value date position
246700200529     C*
246800200529     C     TDVD          IFLE      BJRDNB
246900200529     C*
247000200529     C                   MOVEL     TDSS          BHSC
247100200529     C                   MOVEL     TDBA          BHBA
247200200529     C                   MOVEL     TDBK          BHBK
247300200529     C                   MOVEL     TDMI          BHMK
247400200529     C                   MOVEL     'V'           BHTV
247500200529     C     KLBKPH        CHAIN     BKPHDDF                            44
247600200529     C*
247700200529      ***  Write new BKPHD Value Date record if doesn't already exist.
247800200529     C*
247900200529     C     *IN44         IFEQ      '1'
248000200529     C                   MOVE      'D'           RECI
248100200529     C                   Z-ADD     TDVD          FPSD
248200200529     C                   Z-ADD     TDVD          LPSD
248300200529     C                   Z-ADD     TDVD          LPCD
248400200529     C                   Z-ADD     *ZEROS        LAVP
248500200529     C                   Z-ADD     *ZEROS        LATD
248600200529     C                   Z-ADD     *ZEROS        ARPC
248700200529     C                   Z-ADD     TDVD          ICLD
248800200529     C                   Z-ADD     *ZEROS        IACR
248900200529     C                   Z-ADD     *ZEROS        IACP
249000200529     C                   Z-ADD     *ZEROS        INDO
249100200529     C                   Z-ADD     *ZEROS        UPPT
249200200529     C                   Z-ADD     *ZEROS        DPAP
249300200529     C                   Z-ADD     *ZEROS        DPFP
249400200529     C                   Z-ADD     *ZEROS        BUDU
249500200529     C                   MOVE      SITP          INVT
249600200529     C                   MOVE      NMCY          NCRY
249700200529     C                   Z-ADD     *ZEROS        LPRC
249800200529     C                   Z-ADD     *ZEROS        BHDP
249900200529     C                   Z-ADD     *ZEROS        BHCP
250000200529     C                   Z-ADD     *ZEROS        BHPP
250100200529     C                   Z-ADD     NATN          TNLU
250200200529     C                   Z-ADD     *ZEROS        NAVP                                         CSE065
250300200529     C                   Z-ADD     *ZEROS        BKVAMT                                       CSE065
250400200529     C                   Z-ADD     *ZEROS        EQTAMT                                       CSE065
250500200529     C                   WRITE     BKPHDDF
250600200529     C                   ADD       1             BK_NOR
250700200529     C*
250800200529     C                   END
250900200529     C*
251000200529     C* Remember latest position date
251100200529     C*
251200200529     C                   Z-ADD     LPSD          VLPSD             5 0
251300200529     C                   END
251400200529     C*
251500200529     C*  Access BKPOS trade date position
251600200529     C*
251700200529     C                   MOVEL     TDSS          BPSC
251800200529     C                   MOVEL     TDBA          BPBA
251900200529     C                   MOVEL     TDBK          BPBK
252000200529     C                   MOVEL     TDMI          BPMK
252100200529     C                   MOVEL     'T'           BPTV
252200200529     C                   Z-ADD     TLPSD         BPPD
252300200529     C*
252400200529     C                   Z-ADD     *ZEROS        SNPI
252500200529     C                   Z-ADD     *ZEROS        SANP
252600200529     C                   Z-ADD     *ZEROS        SNSI
252700200529     C                   Z-ADD     *ZEROS        SANS
252800200529     C*
252900200529     C     KLBKPS        CHAIN     BKPOSDF                            44
253000200529     C*
253100200529     C*  Update trade date positions :-
253200200529     C*
253300200529     C                   Z-ADD     NATN          TNLU
253400200529     C*
253500200529      ***  Write new BKPOS Trade Date record if doesn't already exist.
253600200529      *
253700200529     C     *IN44         IFEQ      '1'
253800200529     C                   ADD       1             BS_NOR
253900200529     C                   Z-ADD     *ZEROS        NPSN
254000200529     C                   Z-ADD     *ZEROS        APNC
254100200529     C                   Z-ADD     *ZEROS        ECNP
254200200529     C                   Z-ADD     *ZEROS        APPB
254300200529     C                   Z-ADD     *ZEROS        RPTP
254400200529     C                   Z-ADD     *ZEROS        PILP
254500200529     C                   Z-ADD     *ZEROS        ANMP
254600200529     C                   Z-ADD     *ZEROS        AAPR
254700200529     C*
254800200529     C                   MOVE      'D'           RECI
254900200529     C                   MOVEL     TDSS          BPSC
255000200529     C                   MOVEL     TDBA          BPBA
255100200529     C                   MOVEL     TDBK          BPBK
255200200529     C                   MOVEL     TDMI          BPMK
255300200529     C                   MOVEL     'T'           BPTV
255400200529     C                   Z-ADD     TDDT          BPPD
255500200529     C                   Z-ADD     *ZEROS        SANP
255600200529     C                   Z-ADD     *ZEROS        SNPI
255700200529     C                   Z-ADD     *ZEROS        SANS
255800200529     C                   Z-ADD     *ZEROS        SNSI
255900200529     C                   MOVE      *BLANK        ADJI
256000200529     C                   Z-ADD     NATN          TNLU
256100200529     C                   Z-ADD     *ZEROS        BKCOST                                       CSE065
256200200529     C*
256300200529     C*  Calculate trade date positions
256400200529     C*
256500200529     C                   MOVE      A_CHTP        TYP_OF_ACT        1
256600200529     C                   EXSR      CBKPOS
256700200529     C*
256800200529     C                   WRITE     BKPOSDF
256900200529     C*
257000200529      ***  Else update existing BKPOS Trade Date record.
257100200529      *
257200200529     C                   ELSE
257300200529      *
257400200529     C*  Calculate trade date positions
257500200529     C*
257600200529     C                   MOVE      A_CHTP        TYP_OF_ACT
257700200529     C                   EXSR      CBKPOS
257800200529     C*
257900200529     C                   UPDATE    BKPOSDF
258000200529     C*
258100200529     C                   END
258200200529     C*
258300200529     C*  If value date LE run date
258400200529     C*  Access BKPOS value date position
258500200529     C*
258600200529     C     TDVD          IFLE      BJRDNB
258700200529     C*
258800200529     C                   MOVEL     TDSS          BPSC
258900200529     C                   MOVEL     TDBA          BPBA
259000200529     C                   MOVEL     TDBK          BPBK
259100200529     C                   MOVEL     TDMI          BPMK
259200200529     C                   MOVEL     'V'           BPTV
259300200529     C                   Z-ADD     VLPSD         BPPD
259400200529     C*
259500200529     C                   Z-ADD     *ZEROS        SNPI
259600200529     C                   Z-ADD     *ZEROS        SANP
259700200529     C                   Z-ADD     *ZEROS        SNSI
259800200529     C                   Z-ADD     *ZEROS        SANS
259900200529     C*
260000200529     C     KLBKPS        CHAIN     BKPOSDF                            44
260100200529     C*
260200200529     C*  Update BKPOS value date positions :-
260300200529     C*
260400200529     C                   Z-ADD     NATN          TNLU
260500200529     C*
260600200529      ***  Write new BKPOS Value Date record if doesn't already exist.
260700200529      *
260800200529     C     *IN44         IFEQ      '1'
260900200529     C                   ADD       1             BS_NOR
261000200529     C                   Z-ADD     *ZEROS        NPSN
261100200529     C                   Z-ADD     *ZEROS        APNC
261200200529     C                   Z-ADD     *ZEROS        ECNP
261300200529     C                   Z-ADD     *ZEROS        APPB
261400200529     C                   Z-ADD     *ZEROS        RPTP
261500200529     C                   Z-ADD     *ZEROS        PILP
261600200529     C                   Z-ADD     *ZEROS        ANMP
261700200529     C                   Z-ADD     *ZEROS        AAPR
261800200529     C*
261900200529     C                   MOVE      'D'           RECI
262000200529     C                   MOVEL     TDSS          BPSC
262100200529     C                   MOVEL     TDBA          BPBA
262200200529     C                   MOVEL     TDBK          BPBK
262300200529     C                   MOVEL     TDMI          BPMK
262400200529     C                   MOVEL     'V'           BPTV
262500200529     C                   Z-ADD     TDVD          BPPD
262600200529     C                   Z-ADD     *ZEROS        SANP
262700200529     C                   Z-ADD     *ZEROS        SNPI
262800200529     C                   Z-ADD     *ZEROS        SANS
262900200529     C                   Z-ADD     *ZEROS        SNSI
263000200529     C                   MOVE      *BLANK        ADJI
263100200529     C                   Z-ADD     NATN          TNLU
263200200529     C                   Z-ADD     *ZERO         APPN                                         CAS006
263300200529     C                   Z-ADD     *ZERO         APNN                                         CAS006
263400200529     C                   Z-ADD     *ZERO         PILN                                         CAS006
263500200529     C                   Z-ADD     *ZEROS        BKCOST                                       CSE065
263600200529     C*
263700200529     C*  Calculate BKPOS value date positions
263800200529     C*
263900200529     C                   MOVE      A_CHTP        TYP_OF_ACT
264000200529     C                   EXSR      CBKPOS
264100200529     C*
264200200529     C                   WRITE     BKPOSDF
264300200529     C*
264400200529      ***  Else update existing BKPOS Value Date record.
264500200529      *
264600200529     C                   ELSE
264700200529     C*
264800200529     C*  Calculate BKPOS value date positions
264900200529     C*
265000200529     C                   MOVE      A_CHTP        TYP_OF_ACT
265100200529     C                   EXSR      CBKPOS
265200200529     C*
265300200529     C                   UPDATE    BKPOSDF
265400200529     C*
265500200529     C                   END
265600200529     C                   END
265700200529     C*
265800200529     C*  If amendment and BKPOS key or countervalue fields changed,
265900200529     C*  and trade was already complete      cancel original details
266000200529     C*
266100200529     C     A_CHTP        IFEQ      'A'
266200200529     C     B_TINC        ANDEQ     'C'
266300200529     C     A_CHTP        OREQ      'C'
266400200529     C     B_TINC        ANDEQ     'C'
266500200529     C*
266600200529     C*  Access BKPOS original trade date position
266700200529     C*
266800200529     C                   MOVEL     B_TDSS        BHSC
266900200529     C                   MOVEL     B_TDBA        BHBA
267000200529     C                   MOVEL     B_TDBK        BHBK
267100200529     C                   MOVEL     B_TDMI        BHMK
267200200529     C                   MOVEL     'T'           BHTV
267300200529     C     KLBKPH        CHAIN     BKPHDDF                            44
267400200529     C*
267500200529     C                   MOVEL     B_TDSS        BPSC
267600200529     C                   MOVEL     B_TDBA        BPBA
267700200529     C                   MOVEL     B_TDBK        BPBK
267800200529     C                   MOVEL     B_TDMI        BPMK
267900200529     C                   MOVEL     'T'           BPTV
268000200529     C                   Z-ADD     LPSD          BPPD
268100200529     C     KLBKPS        CHAIN     BKPOSDF                            44
268200200529     C*
268300200529     C*  Calculate original BKPOS trade date positions
268400200529     C*
268500200529     C                   Z-ADD     B_NOML        NOML
268600200529     C                   Z-ADD     B_PRIC        PRIC
268700200529     C                   Z-ADD     B_RALL        RALL
268800200529     C                   Z-ADD     B_TCA1        TCA1
268900200529     C                   Z-ADD     B_TCA2        TCA2
269000200529     C                   Z-ADD     B_TCA3        TCA3
269100200529     C                   Z-ADD     B_TCA4        TCA4
269200200529     C                   Z-ADD     B_TCA5        TCA5
269300200529     C                   Z-ADD     B_TCA6        TCA6
269400200529     C                   Z-ADD     B_TCA7        TCA7
269500200529     C                   Z-ADD     B_TBCA        TBCA
269600200529     C                   Z-ADD     B_TCCA        TCCA
269700200529     C                   Z-ADD     B_TDVD        TDVD
269800200529     C*
269900200529     C                   MOVE      'D'           TYP_OF_ACT
270000200529     C                   EXSR      CBKPOS
270100200529     C*
270200200529     C*  Update original BKPOS trade date positions
270300200529     C*
270400200529     C     *IN44         IFEQ      '0'
270500200529     C*
270600200529     C                   UPDATE    BKPOSDF
270700200529     C*
270800200529     C                   END
270900200529     C*
271000200529     C*  Access BKPOS original value date position
271100200529     C*                   - only if original value date LE run date
271200200529     C*
271300200529     C     B_TDVD        IFLE      BJRDNB
271400200529     C                   MOVEL     B_TDSS        BHSC
271500200529     C                   MOVEL     B_TDBA        BHBA
271600200529     C                   MOVEL     B_TDBK        BHBK
271700200529     C                   MOVEL     B_TDMI        BHMK
271800200529     C                   MOVEL     'V'           BHTV
271900200529     C     KLBKPH        CHAIN     BKPHDDF                            44
272000200529     C*
272100200529     C                   MOVEL     B_TDSS        BPSC
272200200529     C                   MOVEL     B_TDBA        BPBA
272300200529     C                   MOVEL     B_TDBK        BPBK
272400200529     C                   MOVEL     B_TDMI        BPMK
272500200529     C                   MOVEL     'V'           BPTV
272600200529     C                   Z-ADD     LPSD          BPPD
272700200529     C     KLBKPS        CHAIN     BKPOSDF                            44
272800200529     C*
272900200529     C*  Calculate BKPOS original value date positions
273000200529     C*
273100200529     C                   MOVE      'D'           TYP_OF_ACT
273200200529     C                   EXSR      CBKPOS
273300200529     C*
273400200529     C*  Update BKPOS original value date positions
273500200529     C*
273600200529     C     *IN44         IFEQ      '0'
273700200529     C*
273800200529     C                   UPDATE    BKPOSDF
273900200529     C*
274000200529     C                   END
274100200529     C                   END
274200200529     C*
274300200529     C*  Reset current trade details
274400200529     C*
274500200529     C                   If        Z#ASTS = *Blanks                                         BUG14514
274600200529     C                   Clear                   TRADSF                                     BUG14514
274700200529     C                   Else                                                               BUG14514
274800200529     C                   MOVEL     Z#ASTS        TRADSF
274900200529     C                   EndIf                                                              BUG14514
275000200529     C*
275100200529     C                   END
275200200529     C*
275300200529     C     WBKEND        ENDSR
275400200529      *****************************************************************
275500200529      /EJECT
275600200529      *****************************************************************
275700200529      *                                                               *
275800200529      *  CBKPOS - Subroutine to calculate the latest Book Positions.  *
275900200529      *                                                               *
276000200529      *****************************************************************
276100200529     C     CBKPOS        BEGSR
276200200529      *
276300200529      *  Calculate consideration
276400200529      *
276500200529     C                   Z-ADD     NOML          ZNOML
276600200529     C                   Z-ADD     PRIC          ZPRC
276700200529     C                   EXSR      ZCNSD
276800200529     C                   Z-ADD     ZCONS         W#CONS           15 0
276900200529     C     PROT          IFEQ      '8'
277000200529     C                   MULT      TCFC          W#CONS
277100200529     C                   END
277200200529      *
277300200529      *  Calculate reallowance
277400200529      *
277500200529     C                   Z-ADD     *ZEROS        W#RALL           15 0
277600200529     C     BVRBAP        IFEQ      'Y'
277700200529     C                   EXSR      CALEFRALL
277800200529     C                   Z-ADD     NOML          ZNOML
277900200529     C                   Z-ADD     EFF_RALL      ZPRC
278000200529     C                   EXSR      ZCNSD
278100200529     C                   Z-ADD     ZCONS         W#RALL
278200200529     C                   END
278300200529      *
278400200529      *  Calculate charges/commission
278500200529      *
278600200529     C                   Z-ADD     *ZEROS        W#CHRG           15 0
278700200529     C     BVCBAP        IFEQ      'Y'
278800200529     C     TCA1          ADD       TCA2          W#CHRG
278900200529     C                   ADD       TCA3          W#CHRG
279000200529     C                   ADD       TCA4          W#CHRG
279100200529     C                   ADD       TCA5          W#CHRG
279200200529     C                   ADD       TCA6          W#CHRG
279300200529     C                   ADD       TCA7          W#CHRG
279400200529     C                   ADD       TAXA          W#CHRG
279500200529     C                   END
279600200529      *
279700200529     C                   Z-ADD     *ZEROS        W#COMM           15 0
279800200529     C     BVCMBP        IFEQ      'Y'
279900200529     C     TBCA          ADD       TCCA          W#COMM
280000200529     C                   END
280100200529      *
280200200529      ***  Update Sum Nominals (I/C) and Sum A P Numerators
280300200529      *
280400200529      *   Insert/amendment(purchase)
280500200529      *
280600200529     C     TDTP          IFEQ      'TP'
280700200529     C*
280800200529     C     TYP_OF_ACT    IFNE      'D'
280900200529     C*
281000200529     C                   ADD       NOML          SNPI
281100200529     C*
281200200529     C                   ADD       W#CONS        SANP
281300200529     C                   ADD       W#RALL        SANP
281400200529     C*
281500200529     C     CustClass     IFEQ      'M'
281600200529     C                   ADD       W#CHRG        SANP
281700200529     C                   ADD       W#COMM        SANP
281800200529     C                   ELSE
281900200529     C                   SUB       W#CHRG        SANP
282000200529     C                   SUB       W#COMM        SANP
282100200529     C                   END
282200200529     C*
282300200529     C                   ELSE
282400200529     C*
282500200529     C*  Deletion(purchase)
282600200529     C*
282700200529     C                   SUB       NOML          SNPI
282800200529     C*
282900200529     C                   SUB       W#CONS        SANP
283000200529     C                   SUB       W#RALL        SANP
283100200529     C     CustClass     IFEQ      'M'
283200200529     C                   SUB       W#CHRG        SANP
283300200529     C                   SUB       W#COMM        SANP
283400200529     C                   ELSE
283500200529     C                   ADD       W#CHRG        SANP
283600200529     C                   ADD       W#COMM        SANP
283700200529     C                   END
283800200529     C*
283900200529     C                   END
284000200529     C*
284100200529     C                   ELSE
284200200529     C*
284300200529     C*   Insert/amend(sale)
284400200529     C*
284500200529     C     TYP_OF_ACT    IFNE      'D'
284600200529     C*
284700200529     C                   SUB       NOML          SNSI
284800200529     C*
284900200529     C                   SUB       W#CONS        SANS
285000200529     C                   SUB       W#RALL        SANS
285100200529     C     CustClass     IFEQ      'M'
285200200529     C                   SUB       W#CHRG        SANS
285300200529     C                   SUB       W#COMM        SANS
285400200529     C                   ELSE
285500200529     C                   ADD       W#CHRG        SANS
285600200529     C                   ADD       W#COMM        SANS
285700200529     C                   END
285800200529     C*
285900200529     C                   ELSE
286000200529     C*
286100200529     C*  Deletion(sale)
286200200529     C*
286300200529     C                   ADD       NOML          SNSI
286400200529     C                   ADD       W#CONS        SANS
286500200529     C                   ADD       W#RALL        SANS
286600200529     C*
286700200529     C     CustClass     IFEQ      'M'
286800200529     C                   ADD       W#CHRG        SANS
286900200529     C                   ADD       W#COMM        SANS
287000200529     C                   ELSE
287100200529     C                   SUB       W#CHRG        SANS
287200200529     C                   SUB       W#COMM        SANS
287300200529     C                   END
287400200529     C*
287500200529     C                   END
287600200529     C                   END
287700200529     C*
287800200529     C                   ENDSR
287900200529      *****************************************************************
288000200529      /EJECT
288100200529      *****************************************************************
288200200529      *                                                               *
288300200529      *  WCPOSN - Subroutine to Update Client Depot Positions.        *
288400200529      *                                                               *
288500200529      *****************************************************************
288600200529     C     WCPOSN        BEGSR
288700200529      *
288800200529      *  Action code I is insert new
288900200529      *  Action code D is cancel new
289000200529      *  Action codes A & C are same as insert new + cancel old
289100200529      *
289200200529      *  If not deletion :-
289300200529      *
289400200529     C     A_CHTP        IFNE      'D'
289500200529      *
289600200529      *  Access CPOSN client position
289700200529      *
289800200529     C                   MOVEL     TDBA          CSBA
289900200529     C                   MOVEL     TDSS          CSSC
290000200529     C                   MOVEL     TCNR          CSCN
290100200529     C     KLPOSN        CHAIN     CPOSNDF                            44
290200200529     C*
290300200529     C*  Update CPOSN client position
290400200529     C*
290500200529     C                   Z-ADD     NATN          TNLU
290600200529     C*
290700200529     C     *IN44         IFEQ      '1'
290800200529     C                   MOVE      'D'           RECI
290900200529     C                   Z-ADD     *ZEROS        CSNT
291000200529     C                   Z-ADD     *ZEROS        CSNV
291100200529     C                   Z-ADD     *ZEROS        CSNS
291200200529     C                   Z-ADD     *ZEROS        CSEX
291300200529     C                   Z-ADD     *ZEROS        CSPT
291400200529     C                   Z-ADD     *ZEROS        CSPV
291500200529     C                   Z-ADD     *ZEROS        CSCT
291600200529     C                   Z-ADD     *ZEROS        CSCV
291700200529     C     CGL031        IFEQ      'Y'                                                        CGL031
291800200529     C                   Z-ADD     *ZEROS        CSPI                                         CGL031
291900200529     C                   Z-ADD     *ZEROS        CSAT                                         CGL031
292000200529     C                   Z-ADD     *ZEROS        CSAV                                         CGL031
292100200529     C                   Z-ADD     *ZEROS        AVFP                                         236705
292200200529     C     TDTP          IFEQ      'TP'                                                       236705
292300200529     C                   Z-ADD     *ZEROS        APDT                                         236705
292400200529     c                   ELSE                                                                 236705
292500200529     C                   Z-ADD     TDVD          APDT                                         236705
292600200529     c                   ENDIF                                                                236705
292700200529     C                   ENDIF                                                                CGL031
292800200529     C     TDVD          IFLE      BJRDNB
292900200529     C                   Z-ADD     TDVD          CSDA
293000200529     C                   ELSE
293100200529     C                   Z-ADD     TDDT          CSDA
293200200529     C                   END
293300200529     C                   MOVE      'N'           CSBT
293400200529     C                   MOVE      'N'           CSBV
293500200529     C                   WRITE     CPOSNDF
293600200529     C                   ADD       1             CP_NOR
293700200529     C*
293800200529     C                   ELSE
293900200529     C*
294000200529     C     TDDT          IFLE      CSCT
294100200529     C                   MOVE      'Y'           CSBT
294200200529     C                   END
294300200529     C     TDVD          IFLE      CSCV
294400200529     C                   MOVE      'Y'           CSBV
294500200529     C                   END
294600200529      *****************************************************************                236705 234440
294700200529     C*****CGL031        IFEQ      'Y'                                                 236705 234440
294800200529     C**********         CALLB     'SEVAPDT'                                           236705 234440
294900200529     C**********         PARM      TDBA          WBrca                                 236705 234440
295000200529     C**********         PARM      TCNR          WCust                                 236705 234440
295100200529     C**********         PARM      TDSS          WSesn                                 236705 234440
295200200529     C**********         PARM      TDTP          WType                                 236705 234440
295300200529     C**********         PARM      NOML          WAmt                                  236705 234440
295400200529     C**********         PARM      TDVD          WDate                                 236705 234440
295500200529     C**********         PARM                    WrkAPDT                               236705 234440
295600200529     C*****TDTP*         IFEQ      'TP'                                                236705 234440
295700200529     C*****WrkAPDT       IFEQ      *ZEROS                                              236705 234440
295800200529     C**********         Z-ADD     WrkAPDT       APDT                                  236705 234440
295900200529     c**********         ENDIF                                                         236705 234440
296000200529     c**********         ELSE                                                          236705 234440
296100200529     C**********         Z-ADD     WrkAPDT       APDT                                  236705 234440
296200200529     c**********         ENDIF                                                         236705 234440
296300200529      *****************************************************************                236758 234440
296400200529     C**********         CALLB     'SEVCSPI'                                           236758 234440
296500200529     C**********         PARM      A_CHTP        WAction           1                   236758 234440
296600200529     C**********         PARM      TDBA          WBrca                                 236758 234440
296700200529     C**********         PARM      TCNR          WCust                                 236758 234440
296800200529     C**********         PARM      TDSS          WSesn                                 236758 234440
296900200529     C**********         PARM      TDTP          WType                                 236758 234440
297000200529     C**********         PARM      NOML          WAmt                                  236758 234440
297100200529     C**********         PARM      ITRA          WPInt            11 0                 236758 234440
297200200529     C**********         PARM                    WrkCSPI                               236758 234440
297300200529     C**********         Z-ADD     WrkCSPI       CSPI                                  236758 234440
297400200529     C**********         ENDIF                                                         236705 234440
297500200529     C*
297600200529     C                   UPDATE    CPOSNDF
297700200529     C                   END
297800200529     C*
297900200529     C                   END
298000200529     C*
298100200529     C* If trade changed/amended, only update file if key or countervalue
298200200529     C* changed, except if trade made complete
298300200529     C*
298400200529     C     A_CHTP        IFEQ      'C'
298500200529     C     B_TINC        ANDEQ     'C'
298600200529     C     A_CHTP        OREQ      'A'
298700200529     C     B_TINC        ANDEQ     'C'
298800200529     C*
298900200529     C* Purchase
299000200529     C*
299100200529     C     TDTP          IFEQ      'TP'
299200200529     C     TDSS          IFEQ      B_TDSS
299300200529     C     TDBA          ANDEQ     B_TDBA
299400200529     C     TCNR          ANDEQ     B_TCNR
299500200529     C     TDMI          ANDEQ     B_TDMI
299600200529     C     DELF          ANDEQ     B_DELF
299700200529     C     TCTR          ANDEQ     B_TCTR
299800200529     C     TDVD          ANDEQ     B_TDVD
299900200529     C     TDDT          ANDEQ     B_TDDT
300000200529     C     AUTS          ANDEQ     B_AUTS
300100200529     C                   GOTO      WCPCHG
300200200529     C                   END
300300200529     C*
300400200529     C                   ELSE
300500200529     C*
300600200529     C* Sale
300700200529     C*
300800200529     C     TDSS          IFEQ      B_TDSS
300900200529     C     TDBA          ANDEQ     B_TDBA
301000200529     C     TCNR          ANDEQ     B_TCNR
301100200529     C     TDMI          ANDEQ     B_TDMI
301200200529     C     DELT          ANDEQ     B_DELT
301300200529     C     TCTR          ANDEQ     B_TCTR
301400200529     C     TDVD          ANDEQ     B_TDVD
301500200529     C     TDDT          ANDEQ     B_TDDT
301600200529     C     AUTS          ANDEQ     B_AUTS
301700200529     C                   GOTO      WCPCHG
301800200529     C                   END
301900200529     C*
302000200529     C                   END
302100200529     C                   END
302200200529     C*
302300200529     C*  Access CDEPP client depot positions
302400200529     C*
302500200529     C                   MOVEL     TDBA          CDPA
302600200529     C                   MOVEL     TDSS          CDSN
302700200529     C                   MOVEL     TDMI          CDMK
302800200529     C                   MOVEL     TCNR          CDCN
302900200529     C     TDTP          IFEQ      'TP'
303000200529     C                   MOVEL     DELF          CDPT
303100200529     C                   ELSE
303200200529     C                   MOVEL     DELT          CDPT
303300200529     C                   END
303400200529     C     KLCDEP        CHAIN     CDEPPDF                            44
303500200529     C                   Z-ADD     NATN          TNLU
303600200529     C*
303700200529     C*  Update CDEPP client depot positions
303800200529     C*
303900200529     C     *IN44         IFEQ      '1'
304000200529     C     TDVD          IFLE      BJRDNB
304100200529     C                   Z-ADD     TDVD          DDTE
304200200529     C                   ELSE
304300200529     C                   Z-ADD     TDDT          DDTE
304400200529     C                   END
304500200529     C                   MOVE      'D'           RECI
304600200529     C                   Z-ADD     *ZEROS        CECN
304700200529     C                   Z-ADD     *ZEROS        CDNT
304800200529     C                   Z-ADD     *ZEROS        CDNV
304900200529     C                   Z-ADD     *ZEROS        CDNS
305000200529     C                   Z-ADD     *ZEROS        SNPT
305100200529     C                   Z-ADD     *ZEROS        SAPP
305200200529     C                   Z-ADD     *ZEROS        CDST
305300200529     C                   Z-ADD     *ZEROS        SAPS
305400200529     C                   Z-ADD     *ZEROS        CNPV
305500200529     C                   Z-ADD     *ZEROS        SAPV
305600200529     C                   Z-ADD     *ZEROS        CNSV
305700200529     C                   Z-ADD     *ZEROS        SPSV
305800200529     C                   Z-ADD     *ZEROS        CNSI                                    S01176
305900200529     C                   IF        CGL031 = 'Y'                                               CGL031
306000200529     C                   Z-ADD     *ZEROS        CPCH                                         CGL031
306100200529     C**********         Z-ADD     *ZEROS        AFPT                                  CGL031 233566
306200200529     C**********         Z-ADD     *ZEROS        AFPV                                  CGL031 233566
306300200529     C                   Z-ADD     *ZEROS        SAFP                                         233566
306400200529     C                   Z-ADD     *ZEROS        SAFS                                         233566
306500200529     C                   Z-ADD     *ZEROS        SAPD                                         233566
306600200529     c                   ENDIF                                                                CGL031
306700200529      *                                                                                       235453
306800200529      *   Set TYP_OF_ACT to Action Code.                                                      235453
306900200529     C                   MOVE      A_CHTP        TYP_OF_ACT                                   235453
307000200529     C                   EXSR      CCLPOS
307100200529     C                   WRITE     CDEPPDF
307200200529     C                   ADD       1             CD_NOR
307300200529     C*
307400200529     C                   ELSE
307500200529     C*
307600200529      *   Set TYP_OF_ACT to Action Code.                                                      235453
307700200529     C                   MOVE      A_CHTP        TYP_OF_ACT                                   235453
307800200529     C                   EXSR      CCLPOS
307900200529     C*
308000200529     C     A_CHTP        IFEQ      'D'
308100200529     C     AUTS          ANDEQ     'N'
308200200529     C     TDVD          ANDLE     BJRDNB
308300200529     C     TNSN          ADD       TNSP          NOM_SET
308400200529     C     TDTP          IFEQ      'TP'
308500200529     C                   ADD       NOM_SET       CNSI
308600200529     C                   ELSE
308700200529     C                   SUB       NOM_SET       CNSI
308800200529     C                   END
308900200529     C                   END
309000200529     C*
309100200529     C                   UPDATE    CDEPPDF
309200200529     C*
309300200529     C                   END
309400200529     C*
309500200529     C     WCPCHG        TAG                                                    *** WCPCHG ****
309600200529     C*
309700200529     C*  If amendment and CDEPP key or countervalue details changed,
309800200529     C*                                      cancel original details
309900200529     C*                - not if trade made complete
310000200529     C*
310100200529     C     A_CHTP        IFEQ      'A'
310200200529     C     B_TINC        ANDEQ     'C'
310300200529     C     A_CHTP        OREQ      'C'
310400200529     C     B_TINC        ANDEQ     'C'
310500200529     C*
310600200529     C*  For purchase type:
310700200529     C*
310800200529     C     TDTP          IFEQ      'TP'
310900200529     C     TDSS          IFNE      B_TDSS
311000200529     C     TDBA          ORNE      B_TDBA
311100200529     C     TCNR          ORNE      B_TCNR
311200200529     C     TDMI          ORNE      B_TDMI
311300200529     C     DELF          ORNE      B_DELF
311400200529     C     TCTR          ORNE      B_TCTR
311500200529     C     TDDT          ORNE      B_TDDT
311600200529     C     TDVD          ORNE      B_TDVD
311700200529     C     AUTS          ORNE      B_AUTS
311800200529     C     B_TNSN        ORNE      0
311900200529     C     B_TNSP        ORNE      0
312000200529     C*
312100200529     C*  Access CDEPP client depot positions
312200200529     C*
312300200529     C                   MOVEL     B_TDBA        CDPA
312400200529     C                   MOVEL     B_TDSS        CDSN
312500200529     C                   MOVEL     B_TDMI        CDMK
312600200529     C                   MOVEL     B_TCNR        CDCN
312700200529     C                   MOVEL     B_DELF        CDPT
312800200529     C     KLCDEP        CHAIN     CDEPPDF                            44
312900200529     C*
313000200529     C     TDSS          IFNE      B_TDSS
313100200529     C     TDBA          ORNE      B_TDBA
313200200529     C     TCNR          ORNE      B_TCNR
313300200529     C     TDMI          ORNE      B_TDMI
313400200529     C     DELT          ORNE      B_DELT
313500200529     C     TCTR          ORNE      B_TCTR
313600200529     C     TDDT          ORNE      B_TDDT
313700200529     C     TDVD          ORNE      B_TDVD
313800200529     C     AUTS          ORNE      B_AUTS
313900200529     C                   Z-ADD     B_NOML        NOML
314000200529     C                   Z-ADD     B_PRIC        PRIC
314100200529     C                   Z-ADD     B_RALL        RALL
314200200529     C                   Z-ADD     B_TCA1        TCA1
314300200529     C                   Z-ADD     B_TCA2        TCA2
314400200529     C                   Z-ADD     B_TCA3        TCA3
314500200529     C                   Z-ADD     B_TCA4        TCA4
314600200529     C                   Z-ADD     B_TCA5        TCA5
314700200529     C                   Z-ADD     B_TCA6        TCA6
314800200529     C                   Z-ADD     B_TCA7        TCA7
314900200529     C                   Z-ADD     B_TBCA        TBCA
315000200529     C                   Z-ADD     B_TCCA        TCCA
315100200529     C                   Z-ADD     B_TCFC        TCFC
315200200529     C                   MOVE      B_AUTS        AUTS
315300200529     C                   Z-ADD     B_TDVD        TDVD
315400200529     C*
315500200529     C                   MOVE      'D'           TYP_OF_ACT
315600200529     C                   EXSR      CCLPOS
315700200529     C*
315800200529     C                   END
315900200529     C*
316000200529     C     B_TNSN        IFNE      0
316100200529     C     B_TNSP        ORNE      0
316200200529     C     B_TNSN        ADD       B_TNSP        NOM_SET
316300200529     C                   ADD       NOM_SET       CNSI
316400200529     C                   END
316500200529     C*
316600200529     C*  Update CDEPP client depot positions
316700200529     C*
316800200529     C     *IN44         IFEQ      '0'
316900200529     C                   UPDATE    CDEPPDF
317000200529     C                   END
317100200529     C                   END
317200200529     C*
317300200529     C                   ELSE
317400200529     C*
317500200529     C*  For sale type:
317600200529     C*
317700200529     C     TDSS          IFNE      B_TDSS
317800200529     C     TDBA          ORNE      B_TDBA
317900200529     C     TCNR          ORNE      B_TCNR
318000200529     C     TDMI          ORNE      B_TDMI
318100200529     C     DELT          ORNE      B_DELT
318200200529     C     TCTR          ORNE      B_TCTR
318300200529     C     TDDT          ORNE      B_TDDT
318400200529     C     TDVD          ORNE      B_TDVD
318500200529     C     AUTS          ORNE      B_AUTS
318600200529     C     B_TNSN        ORNE      0
318700200529     C     B_TNSP        ORNE      0
318800200529     C*
318900200529     C*  Access CDEPP client depot positions
319000200529     C*
319100200529     C                   MOVEL     B_TDBA        CDPA
319200200529     C                   MOVEL     B_TDSS        CDSN
319300200529     C                   MOVEL     B_TDMI        CDMK
319400200529     C                   MOVEL     B_TCNR        CDCN
319500200529     C                   MOVEL     B_DELT        CDPT
319600200529     C     KLCDEP        CHAIN     CDEPPDF                            44
319700200529     C*
319800200529     C     TDSS          IFNE      B_TDSS
319900200529     C     TDBA          ORNE      B_TDBA
320000200529     C     TCNR          ORNE      B_TCNR
320100200529     C     TDMI          ORNE      B_TDMI
320200200529     C     DELF          ORNE      B_DELF
320300200529     C     TCTR          ORNE      B_TCTR
320400200529     C     TDDT          ORNE      B_TDDT
320500200529     C     TDVD          ORNE      B_TDVD
320600200529     C     AUTS          ORNE      B_AUTS
320700200529     C                   Z-ADD     B_NOML        NOML
320800200529     C                   Z-ADD     B_PRIC        PRIC
320900200529     C                   Z-ADD     B_RALL        RALL
321000200529     C                   Z-ADD     B_TCA1        TCA1
321100200529     C                   Z-ADD     B_TCA2        TCA2
321200200529     C                   Z-ADD     B_TCA3        TCA3
321300200529     C                   Z-ADD     B_TCA4        TCA4
321400200529     C                   Z-ADD     B_TCA5        TCA5
321500200529     C                   Z-ADD     B_TCA6        TCA6
321600200529     C                   Z-ADD     B_TCA7        TCA7
321700200529     C                   Z-ADD     B_TBCA        TBCA
321800200529     C                   Z-ADD     B_TCCA        TCCA
321900200529     C                   Z-ADD     B_TCFC        TCFC
322000200529     C                   MOVE      B_AUTS        AUTS
322100200529     C                   Z-ADD     B_TDVD        TDVD
322200200529     C                   MOVE      'D'           TYP_OF_ACT
322300200529     C*
322400200529     C                   EXSR      CCLPOS
322500200529     C*
322600200529     C                   END
322700200529     C*
322800200529     C     B_TNSN        IFNE      0
322900200529     C     B_TNSP        ORNE      0
323000200529     C     B_TNSN        ADD       B_TNSP        NOM_SET
323100200529     C                   SUB       NOM_SET       CNSI
323200200529     C                   END
323300200529     C*
323400200529     C*  Update CDEPP client depot positions
323500200529     C*
323600200529     C     *IN44         IFEQ      '0'
323700200529     C                   UPDATE    CDEPPDF
323800200529     C                   END
323900200529     C*
324000200529     C                   END
324100200529     C                   END
324200200529     C*
324300200529     C*  Reset current trade details
324400200529     C*
324500200529     C                   If        Z#ASTS = *Blanks                                         BUG14514
324600200529     C                   Clear                   TRADSF                                     BUG14514
324700200529     C                   Else                                                               BUG14514
324800200529     C                   MOVEL     Z#ASTS        TRADSF
324900200529     C                   EndIf                                                              BUG14514
325000200529      *****************************************************************                236758 234440
325100200529     C**********         ELSE                                                          236758 234440
325200200529      *****************************************************************                236758 234440
325300200529      ***Access*CPOSN*client*position**********************************                236758 234440
325400200529      *****************************************************************                236758 234440
325500200529     C*****CGL031        IFEQ      'Y'                                                 236758 234440
325600200529     C**********         MOVEL     TDBA          CSBA                                  236758 234440
325700200529     C**********         MOVEL     TDSS          CSSC                                  236758 234440
325800200529     C**********         MOVEL     TCNR          CSCN                                  236758 234440
325900200529     C*****KLPOSN        CHAIN     CPOSNDF                            44               236758 234440
326000200529     C**********                                                                       236758 234440
326100200529     C***Update*CPOSN*client*position**********************************                236758 234440
326200200529     C**********                                                                       236758 234440
326300200529     C**********         Z-ADD     NATN          TNLU                                  236758 234440
326400200529     C**********                                                                       236758 234440
326500200529     C******IN44         IFNE      '1'                                                 236758 234440
326600200529      **********                                                                       236758 234440
326700200529     C**********         CALLB     'SEVCSPI'                                           236758 234440
326800200529     C**********         PARM      A_CHTP        WAction           1                   236758 234440
326900200529     C**********         PARM      TDBA          WBrca                                 236758 234440
327000200529     C**********         PARM      TCNR          WCust                                 236758 234440
327100200529     C**********         PARM      TDSS          WSesn                                 236758 234440
327200200529     C**********         PARM      TDTP          WType                                 236758 234440
327300200529     C**********         PARM      NOML          WAmt                                  236758 234440
327400200529     C**********         PARM      ITRA          WPInt            11 0                 236758 234440
327500200529     C**********         PARM                    WrkCSPI                               236758 234440
327600200529     C**********         Z-ADD     WrkCSPI       CSPI                                  236758 234440
327700200529     C**********                                                                       236758 234440
327800200529     C**********         UPDATE    CPOSNDF                                             236758 234440
327900200529     C**********                                                                       236758 234440
328000200529     C**********         ENDIF                                                         236758 234440
328100200529     C**********         ENDIF                                                         236758 234440
328200200529     C*
328300200529     C                   END
328400200529                                                                                              234440
328500200529     C                   IF        CGL031 = 'Y'                                               234440
328600200529     C*                                                                                       235546
328700200529     C* check if value date has changed and ensure that earlier value date                    235546
328800200529     C* is used                                                                               235546
328900200529     C     A_CHTP        IFEQ      'A'                                                        235546
329000200529     C     A_CHTP        OREQ      'C'                                                        235546
329100200529     C     TDVD          IFLT      B_TDVD                                                     235546
329200200529     C                   Z-ADD     TDVD          PTDVD             5 0                        235546
329300200529     C                   ELSE                                                                 235546
329400200529     C                   Z-ADD     B_TDVD        PTDVD                                        235546
329500200529     C                   ENDIF                                                                235546
329600200529     C                   ELSE                                                                 235546
329700200529     C                   Z-ADD     TDVD          PTDVD                                        235546
329800200529     C                   ENDIF                                                                235546
329900200529     C*                                                                                       235546
330000200529     C* delete all records on ETCPOSND after the date/timestamp            i                  235546
330100200529     C*                                                                                       235546
330200200529     C                   CALL      'SE006670'                                                 235546
330300200529     C                   PARM      A_CHTP        Actn_Code                                    235546
330400200529     C                   PARM      'T'           Tr_Type                                      235546
330500200529     C                   PARM                    SEVTRD                                       235546
330600200529     C                   PARM                    SEVDPM                                       235546
330700200529     C                   PARM                    SECTYF                                       235546
330800200529     C                   PARM                    PTDVD                                        235546
330900200529     C*                                                                                       235546
331000200529     C* if value date on trade has not changed to be later, then process                      235546
331100200529     C* this trade now                                                                        235546
331200200529     C*                                                                                       235546
331300200529     C     A_CHTP        IFEQ      'I'                                                        235546
331400200529     C     A_CHTP        OREQ      'D'                                                        235546
331500200529     C     A_CHTP        OREQ      'A'                                                        235546
331600200529     C     TDVD          ANDLE     B_TDVD                                                     235546
331700200529     C     A_CHTP        OREQ      'C'                                                        235546
331800200529     C     TDVD          ANDLE     B_TDVD                                                     235546
331900200529     C                   Z-ADD     0             PTDVD                                        235546
332000200529     C                   CALL      'SEETCPUPD'                                                234440
332100200529     C                   PARM                    RetCodeIn                                    234440
332200200529     C                   PARM      A_CHTP        Actn_Code         1                          234440
332300200529     C                   PARM      'T'           Tr_Type           1                          234440
332400200529     C                   PARM                    SEVTRD                                       234440
332500200529     C                   PARM                    SEVDPM                                       234440
332600200529     C                   PARM                    SECTYF                                       234440
332700200529     C*                                                                                       235546
332800200529     C* Re-process all the other trades/depot movements after this date.                      235546
332900200529     C*                                                                                       235546
333000200529     C                   CALL      'SE006680'                                                 235546
333100200529     C                   PARM      'T'           Tr_Type                                      235546
333200200529     C                   PARM                    SECTYF                                       235546
333300200529     C                   PARM                    PROT                                         235546
333400200529     C                   PARM                    CustClass                                    235546
333500200529     C                   PARM                    NomCcyDec                                    235546
333600200529     C                   PARM                    CSE023                                       235546
333700200529     C                   PARM                    PTDVD                                        235546
333800200529     C                   PARM                    PTMST                                        235546
333900200529     C                   ELSE                                                                 235546
334000200529     C*                                                                                       235546
334100200529     C* If trade has changed to make value date later, then re-process                        235546
334200200529     C* trades/depot movements up to this date/time                                           235546
334300200529     C*                                                                                       235546
334400200529     C                   Z-ADD     TDVD          PTDVD                                        235546
334500200529     C                   EVAL      PTMST = TMST                                 CAP006        235546
334600200529     C                   CALL      'SE006680'                                                 235546
334700200529     C                   PARM      'T'           Tr_Type                                      235546
334800200529     C                   PARM                    SECTYF                                       235546
334900200529     C                   PARM                    PROT                                         235546
335000200529     C                   PARM                    CustClass                                    235546
335100200529     C                   PARM                    NomCcyDec                                    235546
335200200529     C                   PARM                    CSE023                                       235546
335300200529     C                   PARM                    PTDVD                                        235546
335400200529     C                   PARM                    PTMST                                        235546
335500200529     C*                                                                                       235546
335600200529     C* Now process changed trade                                                             235546
335700200529     C*                                                                                       235546
335800200529     C                   CALL      'SEETCPUPD'                                                235546
335900200529     C                   PARM                    RetCodeIn                                    235546
336000200529     C                   PARM      A_CHTP        Actn_Code         1                          235546
336100200529     C                   PARM      'T'           Tr_Type           1                          235546
336200200529     C                   PARM                    SEVTRD                                       235546
336300200529     C                   PARM                    SEVDPM                                       235546
336400200529     C                   PARM                    SECTYF                                       235546
336500200529     C*                                                                                       235546
336600200529     C* Now re-process all the other trades/depot movements after the date                    235546
336700200529     C* of this changed trade                                                                 235546
336800200529     C*                                                                                       235546
336900200529     C                   Z-ADD     0             PTDVD                                        235546
337000200529     C                   CALL      'SE006680'                                                 235546
337100200529     C                   PARM      'T'           Tr_Type                                      235546
337200200529     C                   PARM                    SECTYF                                       235546
337300200529     C                   PARM                    PROT                                         235546
337400200529     C                   PARM                    CustClass                                    235546
337500200529     C                   PARM                    NomCcyDec                                    235546
337600200529     C                   PARM                    CSE023                                       235546
337700200529     C                   PARM                    PTDVD                                        235546
337800200529     C                   PARM                    PTMST                                        235546
337900200529     C                   ENDIF                                                                235546
338000200529                                                                                              234440
338100200529     C                   ENDIF                                                                234440
338200200529     C*
338300200529     C     WCPEND        ENDSR
338400200529      *****************************************************************
338500200529      /EJECT
338600200529      *****************************************************************
338700200529      *                                                               *
338800200529      *  CCLPOS - Subroutine to calculate the latest Client Positions.*
338900200529      *                                                               *
339000200529      *****************************************************************
339100200529     C     CCLPOS        BEGSR
339200200529      *
339300200529      *  Calculate consideration
339400200529      *
339500200529     C                   Z-ADD     NOML          ZNOML
339600200529     C                   Z-ADD     PRIC          ZPRC
339700200529     C                   EXSR      ZCNSD
339800200529     C                   Z-ADD     ZCONS         W#CONS
339900200529     C     PROT          IFEQ      '8'
340000200529     C                   MULT      TCFC          W#CONS
340100200529     C                   END
340200200529      *
340300200529      *  Calculate reallowance
340400200529      *
340500200529     C                   Z-ADD     *ZEROS        W#RALL
340600200529     C     BVRCAP        IFEQ      'Y'
340700200529     C                   EXSR      CALEFRALL
340800200529     C                   Z-ADD     NOML          ZNOML
340900200529     C                   Z-ADD     EFF_RALL      ZPRC
341000200529     C                   EXSR      ZCNSD
341100200529     C                   Z-ADD     ZCONS         W#RALL
341200200529     C                   END
341300200529      *
341400200529      *  Calculate charges/commission
341500200529      *
341600200529     C                   Z-ADD     *ZEROS        W#CHRG
341700200529     C     BVCCAP        IFEQ      'Y'
341800200529     C     TCA1          ADD       TCA2          W#CHRG
341900200529     C                   ADD       TCA3          W#CHRG
342000200529     C                   ADD       TCA4          W#CHRG
342100200529     C                   ADD       TCA5          W#CHRG
342200200529     C                   ADD       TCA6          W#CHRG
342300200529     C                   ADD       TCA7          W#CHRG
342400200529     C                   END
342500200529      *
342600200529     C                   Z-ADD     *ZEROS        W#COMM
342700200529     C     BVCMCP        IFEQ      'Y'
342800200529     C     TBCA          ADD       TCCA          W#COMM
342900200529     C                   END
343000200529      *
343100200529      ***  Update Sum Nominals (I/C) / Sum A P Numerators on Date Basis
343200200529      *
343300200529      *   Trade date basis :-
343400200529      *
343500200529      *   Insert/amendment(purchase)
343600200529      *
343700200529     C     TDTP          IFEQ      'TP'
343800200529     C     TYP_OF_ACT    IFNE      'D'                                          I-TP-T
343900200529     C*
344000200529     C                   SUB       NOML          SNPT
344100200529     C*
344200200529     C                   ADD       W#CONS        SAPP
344300200529     C                   ADD       W#RALL        SAPP
344400200529     C                   SUB       W#CHRG        SAPP
344500200529     C                   SUB       W#COMM        SAPP
344600200529     C*
344700200529     C                   ELSE                                                   C-TP-T
344800200529     C*
344900200529     C*  Deletion(purchase)
345000200529     C*
345100200529     C                   ADD       NOML          SNPT
345200200529     C*
345300200529     C                   SUB       W#CONS        SAPP
345400200529     C                   SUB       W#RALL        SAPP
345500200529     C                   ADD       W#CHRG        SAPP
345600200529     C                   ADD       W#COMM        SAPP
345700200529     C*
345800200529     C                   END
345900200529     C*
346000200529     C                   ELSE
346100200529     C*
346200200529     C*   Insert/amend(sale)
346300200529     C*
346400200529     C     TYP_OF_ACT    IFNE      'D'                                          I-TS-T
346500200529     C*
346600200529     C                   ADD       NOML          CDST
346700200529     C*
346800200529     C                   ADD       W#CONS        SAPS
346900200529     C                   ADD       W#RALL        SAPS
347000200529     C                   ADD       W#CHRG        SAPS
347100200529     C                   ADD       W#COMM        SAPS
347200200529     C*
347300200529     C                   ELSE                                                   C-TS-T
347400200529     C*
347500200529     C*  Deletion(sale)
347600200529     C*
347700200529     C                   SUB       NOML          CDST
347800200529     C*
347900200529     C                   SUB       W#CONS        SAPS
348000200529     C                   SUB       W#RALL        SAPS
348100200529     C                   SUB       W#CHRG        SAPS
348200200529     C                   SUB       W#COMM        SAPS
348300200529     C*
348400200529     C                   END
348500200529     C                   END
348600200529     C*
348700200529     C*   Value date basis :-
348800200529     C*
348900200529     C*****TDVD          IFLE      BJRDNB                                                     196449
349000200529     C*****TDVD          IFLT      BJRDNB                                              196449 227015
349100200529     C     TDVD          IFLE      BJRDNB                                                     227015
349200200529     C*
349300200529     C*   Insert/amendment(purchase)
349400200529     C*
349500200529     C     TDTP          IFEQ      'TP'
349600200529     C     TYP_OF_ACT    IFNE      'D'                                          I-TP-V
349700200529     C*
349800200529     C                   SUB       NOML          CNPV
349900200529     C*
350000200529     C                   ADD       W#CONS        SAPV
350100200529     C                   ADD       W#RALL        SAPV
350200200529     C                   SUB       W#CHRG        SAPV
350300200529     C                   SUB       W#COMM        SAPV
350400200529     C*
350500200529     C                   ELSE                                                   C-TP-V
350600200529     C*
350700200529     C*  Deletion(purchase)
350800200529     C*
350900200529     C                   ADD       NOML          CNPV
351000200529     C*
351100200529     C                   SUB       W#CONS        SAPV
351200200529     C                   SUB       W#RALL        SAPV
351300200529     C                   ADD       W#CHRG        SAPV
351400200529     C                   ADD       W#COMM        SAPV
351500200529     C*
351600200529     C                   END
351700200529     C*
351800200529     C                   ELSE
351900200529     C*
352000200529     C*   Insert/amend(sale)
352100200529     C*
352200200529     C     TYP_OF_ACT    IFNE      'D'                                          I-TS-V
352300200529     C*
352400200529     C                   ADD       NOML          CNSV
352500200529     C*
352600200529     C                   ADD       W#CONS        SPSV
352700200529     C                   ADD       W#RALL        SPSV
352800200529     C                   ADD       W#CHRG        SPSV
352900200529     C                   ADD       W#COMM        SPSV
353000200529     C*
353100200529     C                   ELSE                                                   C-TS-V
353200200529     C*
353300200529     C*  Deletion(sale)
353400200529     C*
353500200529     C                   SUB       NOML          CNSV
353600200529     C*
353700200529     C                   SUB       W#CONS        SPSV
353800200529     C                   SUB       W#RALL        SPSV
353900200529     C                   SUB       W#CHRG        SPSV
354000200529     C                   SUB       W#COMM        SPSV
354100200529     C*
354200200529     C                   END
354300200529     C                   END
354400200529     C                   END
354500200529     C*
354600200529      ***  If Auto-Settlement and not Forward Valued, update Nominal
354700200529      ***  Settlted (I/C).
354800200529      *
354900200529     C     AUTS          IFEQ      'Y'
355000200529     C     TDVD          ANDLE     BJRDNB
355100200529     C*
355200200529     C     TYP_OF_ACT    IFNE      'D'
355300200529     C     TDTP          IFEQ      'TP'
355400200529     C                   SUB       NOML          CNSI
355500200529     C                   END
355600200529     C     TDTP          IFEQ      'TS'
355700200529     C                   ADD       NOML          CNSI
355800200529     C                   END
355900200529     C                   ELSE
356000200529     C     TDTP          IFEQ      'TP'
356100200529     C                   ADD       NOML          CNSI
356200200529     C                   END
356300200529     C     TDTP          IFEQ      'TS'
356400200529     C                   SUB       NOML          CNSI
356500200529     C                   END
356600200529     C                   END
356700200529     C                   END
356800200529     C*
356900200529     C                   ENDSR
357000200529      *****************************************************************
357100200529      /EJECT
357200200529      *****************************************************************
357300200529      *                                                               *
357400200529      *  WUDEPP - Subroutine to Update User Depot Positions.          *
357500200529      *                                                               *
357600200529      *****************************************************************
357700200529     C     WUDEPP        BEGSR
357800200529     C*
357900200529     C                   Z-ADD     *ZEROS        UDTP
358000200529     C                   Z-ADD     *ZEROS        UDPV
358100200529     C                   Z-ADD     *ZEROS        UDTS
358200200529     C                   Z-ADD     *ZEROS        UDSV
358300200529     C*
358400200529     C* If trade changed/amended, only update file if key or nominal
358500200529     C* changed, except if trade is complete.
358600200529     C*
358700200529     C     A_CHTP        IFEQ      'C'
358800200529     C     B_TINC        ANDEQ     'C'
358900200529     C     A_CHTP        OREQ      'A'
359000200529     C     B_TINC        ANDEQ     'C'
359100200529     C*
359200200529     C* Purchase
359300200529     C*
359400200529     C     TDTP          IFEQ      'TP'
359500200529     C     TDSS          IFEQ      B_TDSS
359600200529     C     TDBA          ANDEQ     B_TDBA
359700200529     C     TDBK          ANDEQ     B_TDBK
359800200529     C     TDMI          ANDEQ     B_TDMI
359900200529     C     DELT          ANDEQ     B_DELT
360000200529     C     NOML          ANDEQ     B_NOML
360100200529     C     TDVD          ANDEQ     B_TDVD
360200200529     C     TDDT          ANDEQ     B_TDDT
360300200529     C     AUTS          ANDEQ     B_AUTS
360400200529     C                   GOTO      WUPCHG
360500200529     C                   END
360600200529     C*
360700200529     C                   ELSE
360800200529     C*
360900200529     C* Sale
361000200529     C*
361100200529     C     TDSS          IFEQ      B_TDSS
361200200529     C     TDBA          ANDEQ     B_TDBA
361300200529     C     TDBK          ANDEQ     B_TDBK
361400200529     C     TDMI          ANDEQ     B_TDMI
361500200529     C     DELF          ANDEQ     B_DELF
361600200529     C     NOML          ANDEQ     B_NOML
361700200529     C     TDVD          ANDEQ     B_TDVD
361800200529     C     TDDT          ANDEQ     B_TDDT
361900200529     C     AUTS          ANDEQ     B_AUTS
362000200529     C                   GOTO      WUPCHG
362100200529     C                   END
362200200529     C*
362300200529     C                   END
362400200529     C                   END
362500200529     C*
362600200529     C*  FIRST DO INSERT/CANCEL WITH NEW DETAILS
362700200529     C*  Action code I is insert new
362800200529     C*  Action code D is Cancel new
362900200529     C*  Action codes A & C are same as Insert new + Cancel old
363000200529     C*
363100200529     C*  For purchase type:
363200200529     C*
363300200529     C     TDTP          IFEQ      'TP'
363400200529     C*
363500200529     C*  Access UDEPP User depot positions
363600200529     C*
363700200529     C                   MOVEL     TDBA          UDBA
363800200529     C                   MOVEL     TDSS          UDSN
363900200529     C                   MOVEL     TDMI          UDMK
364000200529     C                   MOVEL     TDBK          UDBK
364100200529     C                   MOVEL     DELT          UDPT
364200200529     C     KLUDEP        CHAIN     UDEPPDF                            44
364300200529     C*
364400200529     C** ZERO NOMINAL FIELDS IF CHAIN HAS FAILED
364500200529     C*
364600200529     C     *IN44         IFEQ      '1'
364700200529     C                   Z-ADD     0             UNSI
364800200529     C                   Z-ADD     0             UDTP
364900200529     C                   Z-ADD     0             UDPV
365000200529     C                   END
365100200529     C*
365200200529     C*  Update UDEPP User depot positions
365300200529     C*
365400200529     C                   Z-ADD     NATN          TNLU
365500200529     C*
365600200529     C*  Trade date basis :-
365700200529     C*
365800200529     C     A_CHTP        IFNE      'D'
365900200529     C                   ADD       NOML          UDTP                           I-TP-T-N
366000200529     C                   ELSE
366100200529     C                   SUB       NOML          UDTP                           C-TP-T-N
366200200529     C                   END
366300200529     C*
366400200529     C*  Value date basis :-
366500200529     C*
366600200529     C     TDVD          IFLE      BJRDNB
366700200529     C     A_CHTP        IFNE      'D'
366800200529     C                   ADD       NOML          UDPV
366900200529     C                   ELSE
367000200529     C                   SUB       NOML          UDPV
367100200529     C                   END
367200200529     C                   END
367300200529     C*
367400200529     C*   Update Nominal Settled, Input Cycle (UNSI)
367500200529     C*
367600200529     C     AUTS          IFEQ      'Y'
367700200529     C     TDVD          ANDLE     BJRDNB
367800200529     C*
367900200529     C     A_CHTP        IFNE      'D'
368000200529     C                   ADD       NOML          UNSI
368100200529     C                   ELSE
368200200529     C                   SUB       NOML          UNSI
368300200529     C                   END
368400200529     C*
368500200529     C                   END
368600200529     C*
368700200529     C     A_CHTP        IFEQ      'D'
368800200529     C     AUTS          ANDEQ     'N'
368900200529     C     TDVD          ANDLE     BJRDNB
369000200529     C     TNSN          ADD       TNSP          NOM_SET
369100200529     C                   SUB       NOM_SET       UNSI
369200200529     C                   END
369300200529     C*
369400200529     C     *IN44         IFEQ      '1'
369500200529     C                   MOVE      'D'           RECI
369600200529     C     TDVD          IFLE      BJRDNB
369700200529     C                   Z-ADD     TDVD          UDDT
369800200529     C                   Z-ADD     TDVD          DDTE
369900200529     C                   ELSE
370000200529     C                   Z-ADD     TDDT          UDDT
370100200529     C                   Z-ADD     TDDT          DDTE
370200200529     C                   END
370300200529     C                   Z-ADD     *ZEROS        UECN
370400200529     C                   Z-ADD     *ZEROS        UDNT
370500200529     C                   Z-ADD     *ZEROS        UDNV
370600200529     C                   Z-ADD     *ZEROS        UDNS
370700200529     C                   Z-ADD     *ZEROS        UDTS
370800200529     C                   Z-ADD     *ZEROS        UDSV
370900200529     C                   Z-ADD     *ZEROS        UNRT
371000200529     C                   Z-ADD     *ZEROS        UNRV
371100200529     C                   Z-ADD     *ZEROS        USNT
371200200529     C                   Z-ADD     *ZEROS        USNR
371300200529     C                   Z-ADD     *ZEROS        USNV
371400200529     C                   Z-ADD     *ZEROS        USRV
371500200529     C                   WRITE     UDEPPDF
371600200529     C                   ADD       1             UD_NOR
371700200529     C*
371800200529     C                   ELSE
371900200529     C*
372000200529     C                   UPDATE    UDEPPDF
372100200529     C                   END
372200200529     C*
372300200529     C                   ELSE
372400200529     C*
372500200529     C*  For sale type:
372600200529     C*
372700200529     C*  Access UDEPP User depot positions
372800200529     C*
372900200529     C                   MOVEL     TDBA          UDBA
373000200529     C                   MOVEL     TDSS          UDSN
373100200529     C                   MOVEL     TDMI          UDMK
373200200529     C                   MOVEL     TDBK          UDBK
373300200529     C                   MOVEL     DELF          UDPT
373400200529     C     KLUDEP        CHAIN     UDEPPDF                            44
373500200529     C*
373600200529     C** ZERO NOMINAL FIELDS IF CHAIN HAS FAILED
373700200529     C*
373800200529     C     *IN44         IFEQ      '1'
373900200529     C                   Z-ADD     0             UNSI
374000200529     C                   Z-ADD     0             UDTS
374100200529     C                   Z-ADD     0             UDSV
374200200529     C                   END
374300200529     C*
374400200529     C*  Update UDEPP User depot positions
374500200529     C*
374600200529     C                   Z-ADD     NATN          TNLU
374700200529     C*
374800200529     C*  Trade date basis :-
374900200529     C*
375000200529     C     A_CHTP        IFNE      'D'
375100200529     C                   SUB       NOML          UDTS                           I-TS-T-N
375200200529     C                   ELSE
375300200529     C                   ADD       NOML          UDTS                           C-TS-T-N
375400200529     C                   END
375500200529     C*
375600200529     C*  Value date basis :-
375700200529     C*
375800200529     C     TDVD          IFLE      BJRDNB
375900200529     C     A_CHTP        IFNE      'D'
376000200529     C                   SUB       NOML          UDSV
376100200529     C                   ELSE
376200200529     C                   ADD       NOML          UDSV
376300200529     C                   END
376400200529     C                   END
376500200529     C*
376600200529     C*   Update Nominal Settled, Input Cycle (UNSI)
376700200529     C*
376800200529     C     AUTS          IFEQ      'Y'
376900200529     C     TDVD          ANDLE     BJRDNB
377000200529     C*
377100200529     C     A_CHTP        IFNE      'D'
377200200529     C                   SUB       NOML          UNSI
377300200529     C                   ELSE
377400200529     C                   ADD       NOML          UNSI
377500200529     C                   END
377600200529     C*
377700200529     C                   END
377800200529     C*
377900200529     C     A_CHTP        IFEQ      'D'
378000200529     C     AUTS          ANDEQ     'N'
378100200529     C     TDVD          ANDLE     BJRDNB
378200200529     C     TNSN          ADD       TNSP          NOM_SET
378300200529     C                   ADD       NOM_SET       UNSI
378400200529     C                   END
378500200529     C*
378600200529     C     *IN44         IFEQ      '1'
378700200529     C                   MOVE      'D'           RECI
378800200529     C     TDVD          IFLE      BJRDNB
378900200529     C                   Z-ADD     TDVD          UDDT
379000200529     C                   Z-ADD     TDVD          DDTE
379100200529     C                   ELSE
379200200529     C                   Z-ADD     TDDT          UDDT
379300200529     C                   Z-ADD     TDDT          DDTE
379400200529     C                   END
379500200529     C                   Z-ADD     *ZEROS        UDNT
379600200529     C                   Z-ADD     *ZEROS        UDNV
379700200529     C                   Z-ADD     *ZEROS        UDNS
379800200529     C                   Z-ADD     *ZEROS        UECN
379900200529     C                   Z-ADD     *ZEROS        UDTP
380000200529     C                   Z-ADD     *ZEROS        UDPV
380100200529     C                   Z-ADD     *ZEROS        UNRT
380200200529     C                   Z-ADD     *ZEROS        UNRV
380300200529     C                   Z-ADD     *ZEROS        USNT
380400200529     C                   Z-ADD     *ZEROS        USNR
380500200529     C                   Z-ADD     *ZEROS        USNV
380600200529     C                   Z-ADD     *ZEROS        USRV
380700200529     C                   WRITE     UDEPPDF
380800200529     C                   ADD       1             UD_NOR
380900200529     C*
381000200529     C                   ELSE
381100200529     C*
381200200529     C                   UPDATE    UDEPPDF
381300200529     C                   END
381400200529     C                   END
381500200529     C*
381600200529     C     WUPCHG        TAG                                                    *** WUPCHG ****
381700200529     C*
381800200529     C*  If amendment and UDEPP key or nominal changed,
381900200529     C*  and trade was already settled       cancel original details
382000200529     C*
382100200529     C     A_CHTP        IFEQ      'A'
382200200529     C     B_TINC        ANDEQ     'C'
382300200529     C     A_CHTP        OREQ      'C'
382400200529     C     B_TINC        ANDEQ     'C'
382500200529     C*
382600200529     C*  For purchase type:
382700200529     C*
382800200529     C     TDTP          IFEQ      'TP'
382900200529     C     TDSS          IFNE      B_TDSS
383000200529     C     TDBA          ORNE      B_TDBA
383100200529     C     TDBK          ORNE      B_TDBK
383200200529     C     TDMI          ORNE      B_TDMI
383300200529     C     DELT          ORNE      B_DELT
383400200529     C     NOML          ORNE      B_NOML
383500200529     C     TDVD          ORNE      B_TDVD
383600200529     C     TDDT          ORNE      B_TDDT
383700200529     C     AUTS          ORNE      B_AUTS
383800200529     C     B_TNSN        ORNE      0
383900200529     C     B_TNSP        ORNE      0
384000200529     C*
384100200529     C*  Access UDEPP User depot positions
384200200529     C*
384300200529     C                   MOVEL     B_TDBA        UDBA
384400200529     C                   MOVEL     B_TDSS        UDSN
384500200529     C                   MOVEL     B_TDMI        UDMK
384600200529     C                   MOVEL     B_TDBK        UDBK
384700200529     C                   MOVEL     B_DELT        UDPT
384800200529     C     KLUDEP        CHAIN     UDEPPDF                            44
384900200529     C*
385000200529     C     TDSS          IFNE      B_TDSS
385100200529     C     TDBA          ORNE      B_TDBA
385200200529     C     TDBK          ORNE      B_TDBK
385300200529     C     TDMI          ORNE      B_TDMI
385400200529     C     DELT          ORNE      B_DELT
385500200529     C     NOML          ORNE      B_NOML
385600200529     C     TDVD          ORNE      B_TDVD
385700200529     C     TDDT          ORNE      B_TDDT
385800200529     C     AUTS          ORNE      B_AUTS
385900200529     C*
386000200529     C                   SUB       B_NOML        UDTP                           C-TP-T-O
386100200529     C     B_TDVD        IFLE      BJRDNB
386200200529     C                   SUB       B_NOML        UDPV
386300200529     C                   END
386400200529     C*
386500200529     C*   Update Nominal Settled, Input Cycle (UNSI)
386600200529     C*
386700200529     C     B_AUTS        IFEQ      'Y'
386800200529     C     B_TDVD        ANDLE     BJRDNB
386900200529     C                   SUB       B_NOML        UNSI
387000200529     C                   END
387100200529     C*
387200200529     C                   END
387300200529     C*
387400200529     C     B_TNSN        IFNE      0
387500200529     C     B_TNSP        ORNE      0
387600200529     C     B_TNSN        ADD       B_TNSP        NOM_SET          11 0
387700200529     C                   SUB       NOM_SET       UNSI
387800200529     C                   END
387900200529     C*
388000200529     C*  Update UDEPP User depot positions
388100200529     C*
388200200529     C     *IN44         IFEQ      '0'
388300200529     C*
388400200529     C                   UPDATE    UDEPPDF
388500200529     C*
388600200529     C                   END
388700200529     C                   END
388800200529     C*
388900200529     C                   ELSE
389000200529     C*  For sale type :
389100200529     C*
389200200529     C     TDSS          IFNE      B_TDSS
389300200529     C     TDBA          ORNE      B_TDBA
389400200529     C     TDBK          ORNE      B_TDBK
389500200529     C     TDMI          ORNE      B_TDMI
389600200529     C     DELF          ORNE      B_DELF
389700200529     C     NOML          ORNE      B_NOML
389800200529     C     TDVD          ORNE      B_TDVD
389900200529     C     TDDT          ORNE      B_TDDT
390000200529     C     AUTS          ORNE      B_AUTS
390100200529     C     B_TNSN        ORNE      0
390200200529     C     B_TNSP        ORNE      0
390300200529     C*
390400200529     C*  Access UDEPP User depot positions
390500200529     C*
390600200529     C                   MOVEL     B_TDBA        UDBA
390700200529     C                   MOVEL     B_TDSS        UDSN
390800200529     C                   MOVEL     B_TDMI        UDMK
390900200529     C                   MOVEL     B_TDBK        UDBK
391000200529     C                   MOVEL     B_DELF        UDPT
391100200529     C     KLUDEP        CHAIN     UDEPPDF                            44
391200200529     C*
391300200529     C     TDSS          IFNE      B_TDSS
391400200529     C     TDBA          ORNE      B_TDBA
391500200529     C     TDBK          ORNE      B_TDBK
391600200529     C     TDMI          ORNE      B_TDMI
391700200529     C     DELF          ORNE      B_DELF
391800200529     C     NOML          ORNE      B_NOML
391900200529     C     TDVD          ORNE      B_TDVD
392000200529     C     TDDT          ORNE      B_TDDT
392100200529     C     AUTS          ORNE      B_AUTS
392200200529     C*
392300200529     C                   ADD       B_NOML        UDTS                           C-TS-T-O
392400200529     C     B_TDVD        IFLE      BJRDNB
392500200529     C                   ADD       B_NOML        UDSV
392600200529     C                   END
392700200529     C*
392800200529     C*   Update Nominal Settled, Input Cycle (UNSI)
392900200529     C*
393000200529     C     B_AUTS        IFEQ      'Y'
393100200529     C     B_TDVD        ANDLE     BJRDNB
393200200529     C                   ADD       B_NOML        UNSI
393300200529     C                   END
393400200529     C*
393500200529     C                   END
393600200529     C*
393700200529     C     B_TNSN        IFNE      0
393800200529     C     B_TNSP        ORNE      0
393900200529     C     B_TNSN        ADD       B_TNSP        NOM_SET
394000200529     C                   ADD       NOM_SET       UNSI
394100200529     C                   END
394200200529     C*
394300200529     C*  Update UDEPP User depot positions
394400200529     C*
394500200529     C     *IN44         IFEQ      '0'
394600200529     C*
394700200529     C                   UPDATE    UDEPPDF
394800200529     C*
394900200529     C                   END
395000200529     C                   END
395100200529     C                   END
395200200529     C                   END
395300200529     C*
395400200529     C     WUPEND        ENDSR
395500200529      *****************************************************************
395600200529      /EJECT
395700200529      *****************************************************************
395800200529      *                                                               *
395900200529      *  WSETTL - Subroutine to Update Trade Settlement Details.      *
396000200529      *                                                               *
396100200529      *****************************************************************
396200200529     C     WSETTL        BEGSR
396300200529      *
396400200529      * Update all settlement records for the trade
396500200529      *
396600200529     C                   Z-ADD     *ZEROS        W#SCNT            5 0
396700200529
396800200529     C                   MOVE      B_TDBA        SBCA
396900200529     C                   MOVE      TDRF          STDR
397000200529
397100200529     C     KLSETT        SETLL     SETLEDF
397200200529     C     KLSETT        READE     SETLEDF                                44
397300200529      *
397400200529      ** Do while records found
397500200529      *
397600200529     C     *IN44         DOWEQ     '0'
397700200529      *
397800200529      ** Live settlements only
397900200529      *
398000200529     C     RECI          IFNE      'C'
398100200529     C     RECI          ANDNE     '*'
398200200529
398300200529      ** Distinguish between historic and input today
398400200529
398500200529     C     RECI          IFEQ      'H'
398600200529     C                   MOVE      'X'           CHTP
398700200529     C                   ELSE
398800200529     C                   MOVE      'D'           CHTP
398900200529     C                   END
399000200529
399100200529     C     RECI          IFEQ      'D'
399200200529     C                   MOVE      '*'           RECI
399300200529     C                   ELSE
399400200529     C                   MOVE      'C'           RECI
399500200529     C                   END
399600200529
399700200529     C                   Z-ADD     BJRDNB        LCD
399800200529     C                   ADD       1             W#SCNT
399900200529     C                   UPDATE    SETLEDF
400000200529     C                   END
400100200529
400200200529     C     KLSETT        READE     SETLEDF                                44
400300200529
400400200529     C                   END
400500200529      *
400600200529      *  Access SETTL audit record and update
400700200529      *
400800200529     C     1             CHAIN     SETLEAF                            99
400900200529     C     *IN99         IFEQ      '0'
401000200529     C                   ADD       W#SCNT        SDEL
401100200529     C                   UPDATE    SETLEAF
401200200529     C                   ELSE
401300200529     C                   MOVEL     'AUDIT'       DBKEY
401400200529     C                   MOVEL     'SETLE'       DBFILE
401500200529     C                   MOVEL     '800'         DBASE
401600200529     C                   EXSR      SRERR
401700200529     C                   END
401800200529     C*
401900200529     C                   ENDSR
402000200529      *****************************************************************
402100200529      /EJECT
402200200529      *****************************************************************
402300200529      *                                                               *
402400200529      *  WTRAUT - Subroutine to write a record to Trade authorisation file
402500200529      *                                                               *
402600200529      *****************************************************************
402700200529     C     WTRAUT        BEGSR
402800200529     C**
402900200529     C                   MOVE      'D'           TRAU_RECI
403000200529     C** Trade Ref.
403100200529     C                   MOVE      TDRF          TRDRF
403200200529     C**
403300200529     C** Last Action Type
403400200529     C     A_CHTP        IFEQ      'I'
403500200529     C                   MOVE      'IN'          TATYP
403600200529     C                   END
403700200529     C     A_CHTP        IFEQ      'A'
403800200529     C                   MOVE      'AM'          TATYP
403900200529     C                   END
404000200529     C     A_CHTP        IFEQ      'C'
404100200529     C                   MOVE      'CH'          TATYP
404200200529     C                   END
404300200529     C     A_CHTP        IFEQ      'D'
404400200529     C                   MOVE      'DL'          TATYP
404500200529     C                   END
404600200529     C     A_CHTP        IFEQ      'P'
404700200529     C                   MOVE      'AP'          TATYP
404800200529     C                   END
404900200529     C     A_CHTP        IFEQ      'Y'
405000200529      *                                                                         CAP051
405100200529     C     SAVAUTH       ORNE      '00'                                         CAP051
405200200529     C     CAP051        ANDEQ     'Y'                                          CAP051
405300200529     C     A_AUTH        ANDEQ     'Y'                                          CAP051
405400200529      *                                                                         CAP051
405500200529     C                   MOVE      'AU'          TATYP
405600200529     C                   END
405700200529     C** User
405800200529     C/COPY WNCPYSRC,SETRADDC15
405900200529     C                   MOVE      PSUser        TAUSR
406000200529     C/COPY WNCPYSRC,SETRADDC16
406100200529     C** Date
406200200529     C                   Z-ADD     BJRDNB        TADT
406300200529     C** Time
406400200529     C                   TIME                    TATM
406500200529     C**
406600200529     C* File TRAUTD should retain details of the trades previous RECI.                        179084
406700200529     C*                                                                                       179084
406800200529     C                   MOVE      PREVREC       TDRI                                         179084
406900200529     C*                                                                                       179084
407000200529     C                   WRITE     TRAUTDF
407100200529     C**
407200200529     C                   ENDSR
407300200529      *****************************************************************
407400200529      /EJECT
407500200529      *****************************************************************
407600200529      *
407700200529      * WPRFC  - Subroutine to update Profit Centre files
407800200529      *
407900200529      *****************************************************************
408000200529     C     WPRFC         BEGSR                                                  ** WPRFC  **
408100200529     C*
408200200529     C                   Z-ADD     0             PC_REC            1 0
408300200529     C*
408400200529     C*  find if new book position profit centre
408500200529     C*
408600200529     C                   MOVEL     TDBK          BOKC
408700200529     C                   MOVEL     TDBA          BRCA
408800200529     C                   MOVEL     TDSS          SESN
408900200529     C                   MOVEL     TDMI          MKTI
409000200529     C     KLSPCB        CHAIN     SEPCBD                             44
409100200529     C*
409200200529     C*  if not found write new record
409300200529     C*
409400200529     C     *IN44         IFEQ      '1'
409500200529     C                   MOVEL     'D'           RECI
409600200529     C                   MOVEL     TDBA          BRCA
409700200529     C                   MOVEL     TDSS          SESN
409800200529     C*
409900200529     C     BGN0ST        IFNE      'Y'
410000200529     C                   MOVEL     PRFC          PCBK
410100200529     C                   ELSE
410200200529     C                   MOVE      BPRC          PCBK
410300200529     C                   ENDIF
410400200529     C*
410500200529     C                   Z-ADD     BJRDNB        LCD
410600200529     C                   MOVEL     'I'           CHTP
410700200529     C                   Z-ADD     NATN          TNLU
410800200529     C                   WRITE     SEPCBDF
410900200529     C                   ADD       1             PC_REC
411000200529     C*
411100200529     C*  If found and trade/book position profit centre reconcilable = Y,
411200200529     C*  or profit centre accounting, and profit centre is different,
411300200529     C*  then DB error
411400200529     C*
411500200529     C                   ELSE
411600200529     C     BVTBRC        IFEQ      'Y'
411700200529     C     PRFC          ANDNE     PCBK
411800200529     C     BGN0ST        ANDNE     'Y'
411900200529     C     BPRC          ORNE      PCBK
412000200529     C     BGN0ST        ANDEQ     'Y'
412100200529     C                   MOVEL     SESN          DBKEY
412200200529     C                   MOVE      BOKC          DBKEY
412300200529     C                   MOVEL     'SEPCBD'      DBFILE
412400200529     C                   MOVEL     '801'         DBASE
412500200529     C                   EXSR      SRERR
412600200529     C                   END
412700200529     C                   END
412800200529     C*
412900200529     C*  find if new customer position profit centre, if portfolio
413000200529     C*    customer
413100200529     C*
413200200529     C     CustClass     IFEQ      'S'
413300200529     C     CustClass     OREQ      'D'
413400200529     C                   MOVEL     TCNR          CNUM
413500200529     C                   MOVEL     TDBA          BRCA
413600200529     C                   MOVEL     TDSS          SESN
413700200529     C     KLSPCC        CHAIN     SEPCCD                             44
413800200529     C     *IN44         IFEQ      '1'
413900200529     C                   MOVEL     'D'           RECI
414000200529     C                   MOVEL     TCNR          CNUM
414100200529     C                   MOVEL     TDBA          BRCA
414200200529     C                   MOVEL     TDSS          SESN
414300200529     C*
414400200529     C     BGN0ST        IFNE      'Y'
414500200529     C                   MOVEL     PRFC          PCCU
414600200529     C                   ELSE
414700200529     C                   MOVE      TPRC          PCCU
414800200529     C                   ENDIF
414900200529     C*
415000200529     C                   Z-ADD     BJRDNB        LCD
415100200529     C                   MOVEL     'I'           CHTP
415200200529     C                   Z-ADD     NATN          TNLU
415300200529     C*
415400200529     C** Determine value of portfolio reference
415500200529     C*
415600200529     C     BGN0ST        IFEQ      'Y'
415700200529     C     BGPFMG        ANDEQ     'Y'
415800200529     C     BGN0ST        OREQ      'Y'                                          CPB001
415900200529     C     BGN4ST        ANDEQ     'Y'                                          CPB001
416000200529     C*
416100200529     C                   MOVE      PTFR          SEPC_PTFR
416200200529     C*
416300200529     C                   ENDIF
416400200529     C*
416500200529     C                   WRITE     SEPCCDF
416600200529     C                   ADD       1             PC_REC
416700200529     C*
416800200529     C*  If found and trade/cust position profit centre reconcilable = Y,
416900200529     C*  or profit centre accounting, and profit centre is different,
417000200529     C*  then DB error
417100200529     C*
417200200529     C                   ELSE
417300200529     C*****BVTBRC        IFEQ      'N'                                          168532
417400200529     C*****PRFC          ANDNE     PCBK                                         168532
417500200529     C*****BVTBRC        IFEQ      'Y'                                              168532 AR1092084
417600200529     C*****BVTBRC        IFEQ      'N'                                            AR1092084 MD020922
417700200529     C*****PRFC*         ANDNE     PCCU                                              168532 MD020922
417800200529     C*****BGN0ST        ANDNE     'Y'                                                      MD020922
417900200529     C*****TPRC*         ORNE      PCCU                                                     MD020922
418000200529     C     TPRC          IFNE      PCCU                                                     MD020922
418100200529     C     BGN0ST        ANDEQ     'Y'
418200200529     C                   MOVEL     SESN          DBKEY
418300200529     C                   MOVE      CNUM          DBKEY
418400200529     C                   MOVEL     'SEPCCD'      DBFILE
418500200529     C                   MOVEL     '802'         DBASE
418600200529     C                   EXSR      SRERR
418700200529     C                   END
418800200529     C                   END
418900200529     C                   END
419000200529     C*
419100200529     C* keep count in audit file
419200200529     C*
419300200529     C     PC_REC        IFGT      0
419400200529     C     1             CHAIN     SEPCA                              44
419500200529     C     *IN44         IFEQ      '0'
419600200529     C                   ADD       PC_REC        SINS
419700200529     C                   ADD       PC_REC        NORE
419800200529     C                   UPDATE    SEPCAF
419900200529     C                   ELSE
420000200529     C                   MOVEL     'AUDIT'       DBKEY
420100200529     C                   MOVEL     'SEPCA'       DBFILE
420200200529     C                   MOVEL     '803'         DBASE
420300200529     C                   EXSR      SRERR
420400200529     C                   END
420500200529     C                   END
420600200529     C*
420700200529     C     WPREND        ENDSR
420800200529     C********************************************************************
420900200529      /EJECT
421000200529      *****************************************************************
421100200529      *                                                               *
421200200529      *  WAUDIT - Subroutine to Update Audit Files.                   *
421300200529      *                                                               *
421400200529      *****************************************************************
421500200529     C     WAUDIT        BEGSR
421600200529     C*
421700200529     C*  Update Trade audit record
421800200529     C*
421900200529     C     1             CHAIN     TRADSAF                            99
422000200529     C     *IN99         IFEQ      '0'
422100200529     C     A_CHTP        IFEQ      'I'
422200200529     C                   ADD       1             SINS
422300200529     C                   ADD       1             NORE
422400200529     C                   ELSE
422500200529     C     A_CHTP        IFEQ      'A'
422600200529     C                   ADD       1             SAMD
422700200529     C                   ELSE
422800200529     C     A_CHTP        IFEQ      'C'
422900200529     C                   ADD       1             TRDA
423000200529     C                   ELSE
423100200529     C     A_CHTP        IFEQ      'D'
423200200529     C                   ADD       1             SDEL
423300200529     C                   END
423400200529     C                   END
423500200529     C                   END
423600200529     C                   END
423700200529     C                   UPDATE    TRADSAF
423800200529     C                   ELSE
423900200529     C                   MOVEL     'AUDIT'       DBKEY
424000200529     C                   MOVEL     'TRADS'       DBFILE
424100200529     C                   MOVEL     '804'         DBASE
424200200529     C                   EXSR      SRERR
424300200529     C                   END
424400200529     C*
424500200529     C*  Update BKPHD audit record
424600200529     C*
424700200529     C     1             CHAIN     BKPHDAF                            99
424800200529     C     *IN99         IFNE      '1'
424900200529     C                   ADD       BK_NOR        NORE
425000200529     C                   UPDATE    BKPHDAF
425100200529     C                   Z-ADD     *ZEROS        BK_NOR            5 0
425200200529     C                   ELSE
425300200529     C                   MOVEL     'AUDIT'       DBKEY
425400200529     C                   MOVEL     'BKPHD'       DBFILE
425500200529     C                   MOVEL     '805'         DBASE
425600200529     C                   EXSR      SRERR
425700200529     C                   END
425800200529     C*
425900200529     C*  Update BKPOSA audit record
426000200529     C*
426100200529     C     1             CHAIN     BKPOSAF                            99
426200200529     C     *IN99         IFNE      '1'
426300200529     C                   ADD       BS_NOR        NORE
426400200529     C                   UPDATE    BKPOSAF
426500200529     C                   Z-ADD     *ZEROS        BS_NOR            5 0
426600200529     C                   ELSE
426700200529     C                   MOVEL     'AUDIT'       DBKEY
426800200529     C                   MOVEL     'BKPOS'       DBFILE
426900200529     C                   MOVEL     '806'         DBASE
427000200529     C                   EXSR      SRERR
427100200529     C                   END
427200200529     C*
427300200529     C*  Update CPOSNA audit record
427400200529     C*
427500200529     C*****1****         CHAIN     CPOSNAF                            99                      223870
427600200529     C     1             CHAIN     CPOSNAF                            9956                    223870
427700200529      *                                                                                       223870
427800200529     C                   Z-ADD     1             COUNT             1 0                        223870
427900200529     C     *IN56         DOWEQ     '1'                                                        223870
428000200529     C     COUNT         ANDLT     7                                                          223870
428100200529      *                                                                                       223870
428200200529     C                   MOVEA     CMDDLY(1)     DLYJOB           80                          223870
428300200529     C                   Z-ADD     80            CMDLEN                                       223870
428400200529     C                   CALL      'QCMDEXC'                              57                  223870
428500200529     C                   PARM                    DLYJOB                                       223870
428600200529     C                   PARM                    CMDLEN           15 5                        223870
428700200529      *                                                                                       223870
428800200529     C     *IN57         IFEQ      '1'                                                        223870
428900200529     C                   MOVEL     'QCMDEXC'     DBKEY                                        223870
429000200529     C                   MOVEL     '*CALL   '    DBFILE                                       223870
429100200529     C                   MOVEL     '501'         DBASE                                        223870
429200200529      *                                                                                       223870
429300200529     C                   EXSR      SRERR                                                      223870
429400200529     C                   ENDIF                                                                223870
429500200529      *                                                                                       223870
429600200529     C     1             CHAIN     CPOSNAF                            9956                    223870
429700200529     C                   ADD       1             COUNT                                        223870
429800200529      *                                                                                       223870
429900200529     C                   ENDDO                                                                223870
430000200529      *                                                                                       223870
430100200529     C     *IN99         IFNE      '1'
430200200529     C     *IN56         ANDNE     '1'                                                        223870
430300200529     C                   ADD       CP_NOR        NORE
430400200529     C                   UPDATE    CPOSNAF
430500200529     C                   Z-ADD     *ZEROS        CP_NOR            5 0
430600200529     C                   ELSE
430700200529     C                   MOVEL     'AUDIT'       DBKEY
430800200529     C                   MOVEL     'CPOSN'       DBFILE
430900200529     C                   MOVEL     '807'         DBASE
431000200529     C                   EXSR      SRERR
431100200529     C                   END
431200200529     C*
431300200529     C*  Update CDEPPA audit record
431400200529     C*
431500200529     C*****1****         CHAIN     CDEPPAF                            99                      223870
431600200529     C     1             CHAIN     CDEPPAF                            9958                    223870
431700200529      *                                                                                       223870
431800200529     C                   Z-ADD     1             COUNT                                        223870
431900200529     C     *IN58         DOWEQ     '1'                                                        223870
432000200529     C     COUNT         ANDLT     7                                                          223870
432100200529      *                                                                                       223870
432200200529     C                   MOVEA     CMDDLY(1)     DLYJOB                                       223870
432300200529     C                   Z-ADD     80            CMDLEN                                       223870
432400200529     C                   CALL      'QCMDEXC'                              59                  223870
432500200529     C                   PARM                    DLYJOB                                       223870
432600200529     C                   PARM                    CMDLEN                                       223870
432700200529      *                                                                                       223870
432800200529     C     *IN59         IFEQ      '1'                                                        223870
432900200529     C                   MOVEL     'QCMDEXC'     DBKEY                                        223870
433000200529     C                   MOVEL     '*CALL   '    DBFILE                                       223870
433100200529     C                   MOVEL     '502'         DBASE                                        223870
433200200529      *                                                                                       223870
433300200529     C                   EXSR      SRERR                                                      223870
433400200529     C                   ENDIF                                                                223870
433500200529      *                                                                                       223870
433600200529     C     1             CHAIN     CDEPPAF                            9958                    223870
433700200529     C                   ADD       1             COUNT                                        223870
433800200529      *                                                                                       223870
433900200529     C                   ENDDO                                                                223870
434000200529      *                                                                                       223870
434100200529     C     *IN99         IFNE      '1'
434200200529     C     *IN58         ANDNE     '1'                                                        223870
434300200529     C                   ADD       CD_NOR        NORE
434400200529     C                   UPDATE    CDEPPAF
434500200529     C                   Z-ADD     *ZEROS        CD_NOR            5 0
434600200529     C                   ELSE
434700200529     C                   MOVEL     'AUDIT'       DBKEY
434800200529     C                   MOVEL     'CDEPP'       DBFILE
434900200529     C                   MOVEL     '808'         DBASE
435000200529     C                   EXSR      SRERR
435100200529     C                   END
435200200529     C*
435300200529     C*  Update UDEPPA audit record
435400200529     C*
435500200529     C     1             CHAIN     UDEPPAF                            99
435600200529     C     *IN99         IFNE      '1'
435700200529     C                   ADD       UD_NOR        NORE
435800200529     C                   UPDATE    UDEPPAF
435900200529     C                   Z-ADD     *ZEROS        UD_NOR            5 0
436000200529     C                   ELSE
436100200529     C                   MOVEL     'AUDIT'       DBKEY
436200200529     C                   MOVEL     'UDEPP'       DBFILE
436300200529     C                   MOVEL     '809'         DBASE
436400200529     C                   EXSR      SRERR
436500200529     C                   END
436600200529     C*
436700200529     C     WAEND         ENDSR
436800200529      *****************************************************************
436900200529      /EJECT
437000200529      *****************************************************************                       CGL031
437100200529      ** SRGenCustIn - Write to Customer Income File                                          CGL031
437200200529      *****************************************************************                       CGL031
437300200529     C     SRGenCustIn   BEGSR                                                                CGL031
437400200529                                                                                              CGL031
437500200529     C                   CALLB     'SEVTRADTAX'                                               CGL031
437600200529                                                                                              CGL031
437700200529      ** INPUTS                                                                               CGL031
437800200529      ** Response mode                                                                        CGL031
437900200529                                                                                              CGL031
438000200529     C                   PARM                    RetCode                                      CGL031
438100200529                                                                                              CGL031
438200200529      ** Valid Trade Details                                                                  CGL031
438300200529                                                                                              CGL031
438400200529     C                   PARM                    SEVTRD                                       CGL031
438500200529                                                                                              CGL031
438600200529      ** Security Details                                                                     CGL031
438700200529                                                                                              CGL031
438800200529     C                   PARM                    SECTYF                                       CGL031
438900200529                                                                                              CGL031
439000200529      ** Process Flag                                                                         CGL031
439100200529                                                                                              CGL031
439200200529     C                   PARM                    ProcFlag                                     CGL031
439300200529                                                                                              CGL031
439400200529      ** OUTPUTS                                                                              CGL031
439500200529      ** EU Tax Screen Format                                                                 CGL031
439600200529      ** EU Tax in Nominal Currency File Format                                               CGL031
439700200529      ** EU Tax in Settlement Currency File Format                                            CGL031
439800200529                                                                                              CGL031
439900200529     C                   PARM                    DDEUTX                                       CGL031
440000200529     C                   PARM                    EUTX                                         CGL031
440100200529     C                   PARM                    EUTS                                         CGL031
440200200529                                                                                              CGL031
440300200529     C                   ENDSR                                                                CGL031
440400200529      ****************************************************************                        CGL031
440500200529      /EJECT                                                                                  CGL031
440600200529     C****************************************************************
440700200529     C*                                                              *
440800200529     C* UTRADSX1A - UPDATE TRADE EXTENSION 1 - 'A' RECORD            *
440900200529     C*                                                              *
441000200529     C****************************************************************
441100200529     C     UTRADSX1A     BEGSR
441200200529
441300200529     C/COPY WNCPYSRC,SETRADDC03
441400200529      ** ACCESS TRADE EXTENSION RECORD
441500200529
441600200529     C     CSW003        IFEQ      'Y'                                          154562
441700200529     C                   MOVEL     'A'           T1WHEN
441800200529     C                   ELSE                                                   154562
441900200529     C                   MOVEL     ' '           T1WHEN                         154562
442000200529     C                   END                                                    154562
442100200529     C     TRADSY1K      CHAIN     TRADSDD1                           99
442200200529
442300200529      ** DATABASE ERROR
442400200529      ** IF INSERT, BUT RECORD PRESENT ALREADY
442500200529      ** OR IF NOT INSERT, BUT NO RECORD FOUND
442600200529
442700200529     C     A_CHTP        IFEQ      'I'
442800200529     C     *IN99         ANDEQ     '0'
442900200529     C     A_CHTP        ORNE      'I'
443000200529     C     *IN99         ANDEQ     '1'
443100200529     C                   MOVEL     A_TDRF        DBKEY
443200200529     C                   MOVEL     'TRADSDX1'    DBFILE                         ************
443300200529     C                   MOVEL     '850'         DBASE                          * DBERR 002*
443400200529     C                   EXSR      SRERR                                        ************
443500200529     C                   END
443600200529      *                                                                                     BUG21255
443700200529      *** Save Last Swift Sequence                                                          BUG21255
443800200529      *                                                                                     BUG21255
443900200529     C     A_CHTP        IFNE      'I'                                                      BUG21255
444000200529     C                   Z-ADD     T1LSWS        SVLSWS            7 0                      BUG21255
444100200529     C                   ENDIF                                                              BUG21255
444200200529
444300200529      ** Update with details from valid trade extension record
444400200529
444500200529     C                   MOVEL     SEVTRDX1A     TRADSX1F
444600200529     C     CSE045        IFEQ      'Y'                                                        CSE045
444700200529     C     CSW003        IFEQ      'Y'                                                        CSE045
444800200529     C                   MOVEL     'A'           T1WHEN                                       CSE045
444900200529     C                   ELSE                                                                 CSE045
445000200529     C                   MOVEL     ' '           T1WHEN                                       CSE045
445100200529     C                   END                                                                  CSE045
445200200529     C                   ENDIF                                                                CSE045
445300200529      *
445400200529      *** Trade reference
445500200529      *
445600200529     C                   MOVEL     A_TDRF        T1TDRF
445700200529      *                                                                                     BUG21255
445800200529      *** Last Swift Sequence                                                               BUG21255
445900200529      *                                                                                     BUG21255
446000200529     C     A_CHTP        IFNE      'I'                                                      BUG21255
446100200529     C                   Z-ADD     SVLSWS        T1LSWS                                     BUG21255
446200200529     C                   ENDIF                                                              BUG21255
446300200529      *
446400200529      *** Set S.W.I.F.T. Confirmation generated to 'No'
446500200529      *** if trade confirmation not yet generated
446600200529      *
446700200529     C     TCFR          IFEQ      'N'
446800200529     C                   MOVEL     'N'           T1GMEC
446900200529     C                   ENDIF
447000200529      *
447100200529      *** Set Settlement Message Required Flag to 'Y'
447200200529      *
447300200529     C                   MOVEL     'Y'           T1SCMG
447400200529
447500200529                                                                                              CSC011
447600200529      ** If CSC011 is installed, supply a Front Office ID for the                             CSC011
447700200529      ** transaction even if it originated from SIN module.                                   CSC011
447800200529                                                                                              CSC011
447900200529     C                   IF        CSC011 = 'Y'                                               CSC011
448000200529     C                   IF        T1FRNT = *BLANKS                                           CSC011
448100200529     C                   EVAL      T1FRNT = 'MD' + T1TDRF                                     CSC011
448200200529     C                   ENDIF                                                                CSC011
448300200529     C                   ENDIF                                                                CSC011
448400200529                                                                                              CSC011
448500200529      ** UPDATE RECORD
448600200529
448700200529     C     *IN99         IFEQ      '1'
448800200529     C                   MOVE      'N'           T1CONG
448900200529     C                   MOVE      'N'           T1RCDG
449000200529     C                   WRITE     TRADSDD1
449100200529     C                   ELSE
449200200529     C                   UPDATE    TRADSDD1
449300200529     C                   END
449400200529      *                                                                                       CSE045
449500200529      ** Default Values for Extended Settlements if CSE045 is NOT installed                   CSE045
449600200529      *                                                                                       CSE045
449700200529     C**********         IF        CSE045 = 'N'                                        CSE045 238859
449800200529     C                   IF        CSE045 = 'N'                                               240736
449900200529                                                                                              210517
450000200529      ** Update Trade Extenstion 2 record                                                     210517
450100200529                                                                                              210517
450200200529     C**********         IF        PMode = 'UPC'                                      210517 243774A
450300200529     C                   IF        PMode = 'UPC' or                                          243774A
450400200529     C                             PMode = 'RPR'                                             243774A
450500200529                                                                                              238859
450600200529     C**********         IF        A_CHTP = 'I'                                        238859 240736
450700200529     C                   EVAL      PScreen = 'A'                                              210517
450800200529     C                   EXSR      InsertX2AB                                                 210517
450900200529     C**********         ENDIF                                                         238859 240736
451000200529                                                                                              238859
451100200529     C                   ENDIF                                                                210517
451200200529                                                                                              CSE045
451300200529     C**********         ELSE                                                          CSE045 238859
451400200529     C                   ELSE                                                                 240736
451500200529     C                   IF        PMode = 'UPC' or                                           CSE045
451600200529     C                             PMode = 'RPR'                                              CSE045
451700200529      * Retrieve flag from data area whether SE1806 already wrote a record in                 248683
451800200529      * TRADSDX2                                                                              248683
451900200529     C                   CALL      'SECDTARA'                                                 248683
452000200529     C                   PARM      'SETRADUPD'   PGMNAM           10                          248683
452100200529     C                   PARM      *BLANKS       WRTFLG            1                          248683
452200200529      * If Write Flag is not 'Y' then go through normal processing                            248683
452300200529     C                   IF        WRTFLG <> 'Y'                                              248683
452400200529                                                                                              238859
452500200529     C**********         IF        A_CHTP = 'A'                                        238859 240736
452600200529     C                   EXSR      UTRADSX2A                                                  CSE045
452700200529     C                   ELSE                                                                 248683
452800200529      * 99 Write Flag is 'Y' then Update Timestamp                                            248683
452900200529     C                   EVAL      T2WHEN = 'A'                                               248683
453000200529     C                   EXSR      SRUpdStp                                                   248683
453100200529     C                   ENDIF                                                                248683
453200200529     C                   ENDIF                                                                CSE045
453300200529     C                   ENDIF                                                                CSE045
453400200529
453500200529     C                   IF        (CSC011 = 'Y') AND (LIBR = S1SUPP)                         CSC011
453600200529     C                   MOVEL     TRADSX1F      CT2AFilFmt                                   CSC011
453700200529     C                   ENDIF                                                                CSC011
453800200529                                                                                              CSC011
453900200529     C/COPY WNCPYSRC,SETRADDC05
454000200529     C                   ENDSR
454100200529     C****************************************************************
454200200529      /EJECT                                                                                  210517
454300200529     C****************************************************************                        210517
454400200529      *                                                              *                        210517
454500200529      * InsertX2AB - Update Trade Extension 2 Records                *                        210517
454600200529      *                                                              *                        210517
454700200529      ****************************************************************                        210517
454800200529     C     InsertX2AB    BEGSR                                                                210517
454900200529                                                                                              210517
455000200529     C                   MOVE      'N'           DftDet                                      240736A
455100200529      *                                                                                      240736A
455200200529     C                   IF        SEVTRDX2A = *BLANKS                                        240736
455300200529                                                                                              240736
455400200529     C                   CALLB     'SETSWX2DFT'                                               210517
455500200529     C                   PARM                    PScreen                                      210517
455600200529     C                   PARM                    TDRF                                         210517
455700200529     C                   PARM                    TDTP                                         210517
455800200529     C                   PARM                    TCNR                                         210517
455900200529     C                   PARM                    TDSS                                         210517
456000200529     C                   PARM                    TDBA                                         210517
456100200529     C                   PARM                    DELF                                         210517
456200200529     C                   PARM                    DELT                                         210517
456300200529     C                   PARM                    TDBK                                         210517
456400200529     C                   PARM                    TNMC                                         210517
456500200529     C                   PARM                    TMKC                                         210517
456600200529                                                                                              210517
456700200529      ** OUTPUT PARAMETERS :                                                                  210517
456800200529      ** Screen A details                                                                     210517
456900200529                                                                                              210517
457000200529     C                   PARM                    A_TradX2                                     210517
457100200529                                                                                              210517
457200200529      ** Screen B details                                                                     210517
457300200529                                                                                              210517
457400200529     C                   PARM                    B_TradX2                                     210517
457500200529      *                                                                                      240736A
457600200529     C                   MOVE      'Y'           DftDet            1                         240736A
457700200529      *                                                                                      240736A
457800200529     C                   ENDIF                                                                240736
457900200529                                                                                              210517
458000200529      ** Access TRADSDX2 and check if record already exist                                    210517
458100200529                                                                                              210517
458200200529     C*****KeyTrdX2      CHAIN     TRADSDY2                           89               210517 243774
458300200529     C     CSW003        IFEQ      'Y'                                                        243774
458400200529     C                   MOVEL     PScreen       T2WHEN                                       243774
458500200529     C                   ELSE                                                                 243774
458600200529     C                   MOVEL     ' '           T2WHEN                                       243774
458700200529     C                   END                                                                  243774
458800200529     C     TRADSY2K      CHAIN     TRADSDY2                           89                      243774
458900200529      *                                                                                       243774
459000200529      ** DATABASE ERROR                                                                       243774
459100200529      ** IF NOT INSERT, BUT NO RECORD FOUND                                                   243774
459200200529      *                                                                                       243774
459300200529     C     A_CHTP        IFNE      'I'                                                        243774
459400200529     C     *IN89         ANDEQ     '1'                                                        243774
459500200529     C     A_TDRF        CAT       T2WHEN        DBKEY                                        243774
459600200529     C                   MOVEL     'TRADSDX2'    DBFILE                         ************  243774
459700200529     C                   MOVEL     '858'         DBASE                          * DBERR 858*  243774
459800200529     C                   EXSR      SRERR                                        ************  243774
459900200529     C                   ENDIF                                                                243774
460000200529                                                                                              210517
460100200529     C                   IF        *IN89 = *On                                                210517
460200200529                                                                                              210517
460300200529     C                   IF        DftDet = 'Y'                                              240736A
460400200529      *                                                                                      240736A
460500200529     C                   IF        PScreen = 'A'                                              210517
460600200529     C                   EVAL      TradX2Rec = A_TradX2                                       210517
460700200529     C                   EVAL      T2TDRF = TDRF                                              210517
460800200529     C                   ELSE                                                                 210517
460900200529     C                   EVAL      TradX2Rec = B_TradX2                                       210517
461000200529     C                   EVAL      T2TDRF = TDRF                                              210517
461100200529     C                   ENDIF                                                                210517
461200200529      *                                                                                      240736A
461300200529     C                   ELSE                                                                240736A
461400200529     C                   MOVEL     SEVTRDX2A     TradX2Rec                                   240736A
461500200529     C                   EVAL      T2TDRF = TDRF                                             240736A
461600200529     C                   EVAL      T2WHEN = PScreen                                          240736A
461700200529     C                   ENDIF                                                               240736A
461800200529                                                                                              243774
461900200529     C     CSW003        IFEQ      'N'                                                        243774
462000200529     C                   MOVEL     ' '           T2WHEN                                       243774
462100200529     C                   END                                                                  243774
462200200529                                                                                              210517
462300200529      ** Get the user define entry for Tradsdx2                                              BUG7975
462400200529                                                                                             BUG7975
462500200529     C                   EXSR      SRGetUserDefin                                            BUG7975
462600200529                                                                                             BUG7975
462700200529      *                                                                                     BUG12372
462800200529      ** Patterned after CSE045, moving of value to T2WHEN                                  BUG12372
462900200529      *                                                                                     BUG12372
463000200529     C                   If        PScreen = 'A'                                            BUG12372
463100200529     C                   If        CSW003 = 'Y'                                             BUG12372
463200200529     C                   Eval      T2WHEN = 'A'                                             BUG12372
463300200529     C                   Else                                                               BUG12372
463400200529     C                   Eval      T2WHEN = ' '                                             BUG12372
463500200529     C                   EndIf                                                              BUG12372
463600200529     C                   Else                                                               BUG12372
463700200529     C                   Eval      T2WHEN = 'B'                                             BUG12372
463800200529     C                   EndIf                                                              BUG12372
463900200529      *                                                                                     BUG12372
464000200529     C                   IF        TradX2Rec <> *Blanks                                       210517
464100200529     C                   EVAL      T2TMST = TimeStamp                                        BUG3947
464200200529     C                   WRITE     TRADSDD2                                                   210517
464300200529     C                   ENDIF                                                                210517
464400200529                                                                                              240736
464500200529     C*****              ELSE                                                          240736 CPK025
464600200529      *****                                                                            240736 CPK025
464700200529     C*****              MOVEL     SEVTRDX2A     TradX2Rec                             240736 CPK025
464800200529     C*****              UPDATE    TRADSDD2                                                   240736
464900200529                                                                                              210517
465000200529     C                   ELSE                                                                BUG7975
465100200529      ** Get the user define entry for Tradsdx2 for amend                                    BUG7975
465200200529      * Retrieve flag from data area whether SE1806 already wrote a record in                 248683
465300200529      * TRADSDX2                                                                              248683
465400200529     C                   CALL      'SECDTARA'                                                 248683
465500200529     C                   PARM      'SETRADUPD'   PGMNAM           10                          248683
465600200529     C                   PARM      *BLANKS       WRTFLG            1                          248683
465700200529      * If Write Flag is not 'Y' then go through normal processing                            248683
465800200529     C                   IF        WRTFLG <> 'Y'                                              248683
465900200529                                                                                             BUG7975
466000200529     C                   EXSR      UTRADSX2A                                                 BUG7975
466100200529     C                   ELSE                                                                 248683
466200200529      * If Write Flag is 'Y' then Update Timestamp                                            248683
466300200529     C                   EVAL      T2WHEN = 'A'                                               248683
466400200529     C                   EXSR      SRUpdStp                                                   248683
466500200529     C                   ENDIF                                                                248683
466600200529      *                                                                                       248683
466700200529                                                                                             BUG7975
466800200529     C                   IF        CustClass = 'S' or                                        BUG7975
466900200529     C                             CustClass = 'D'                                           BUG7975
467000200529     C                   IF        CSW003 = 'Y'                                              BUG7975
467100200529      * Retrieve flag from data area whether SE1806 already wrote a record in                 248683
467200200529      * TRADSDX2                                                                              248683
467300200529     C                   CALL      'SECDTARA'                                                 248683
467400200529     C                   PARM      'SETRADUPD'   PGMNAM           10                          248683
467500200529     C                   PARM      *BLANKS       WRTFLG            1                          248683
467600200529      * If Write Flag is not 'Y' then go through normal processing                            248683
467700200529     C                   IF        WRTFLG <> 'Y'                                              248683
467800200529     C                   EXSR      UTRADSX2B                                                 BUG7975
467900200529     C                   ELSE                                                                 248683
468000200529      * If Write Flag is 'Y' then Update Timestamp                                            248683
468100200529     C                   EVAL      T2WHEN = 'B'                                               248683
468200200529     C                   EXSR      SRUpdStp                                                   248683
468300200529     C                   ENDIF                                                                248683
468400200529     C                   ENDIF                                                               BUG7975
468500200529     C                   ENDIF                                                               BUG7975
468600200529                                                                                             BUG7975
468700200529     C                   ENDIF                                                                210517
468800200529                                                                                              210517
468900200529     C                   ENDSR                                                                210517
469000200529      ****************************************************************                       BUG7975
469100200529      /EJECT                                                                                 BUG7975
469200200529     C****************************************************************                       BUG7975
469300200529     C*                                                              *                       BUG7975
469400200529     C* SRGetUserDefin - Get the user define entry for Tradsdx2      *                       BUG7975
469500200529     C*                                                              *                       BUG7975
469600200529     C****************************************************************                       BUG7975
469700200529     C     SRGetUserDefinBEGSR                                                               BUG7975
469800200529                                                                                             BUG7975
469900200529     C                   IF        PScreen = 'A'                                             BUG7975
470000200529                                                                                             BUG7975
470100200529     C                   IF        AA_T2AFPN <> *Blanks                                      BUG7975
470200200529     C                   EVAL      T2AFPN = AA_T2AFPN                                        BUG7975
470300200529     C                   ENDIF                                                               BUG7975
470400200529                                                                                             BUG7975
470500200529     C                   IF        AA_T2AFPL <> *Blanks                                      BUG7975
470600200529     C                   EVAL      T2AFPL = AA_T2AFPL                                        BUG7975
470700200529     C                   ENDIF                                                               BUG7975
470800200529                                                                                             BUG7975
470900200529     C                   IF        AA_T2AWIN <> *Blanks                                      BUG7975
471000200529     C                   EVAL      T2AWIN = AA_T2AWIN                                        BUG7975
471100200529     C                   ENDIF                                                               BUG7975
471200200529                                                                                             BUG7975
471300200529     C                   IF        AA_T2AWIL <> *Blanks                                      BUG7975
471400200529     C                   EVAL      T2AWIL = AA_T2AWIL                                        BUG7975
471500200529     C                   ENDIF                                                               BUG7975
471600200529                                                                                             BUG7975
471700200529     C                   IF        AA_T2BOFN <> *Blanks                                      BUG7975
471800200529     C                   EVAL      T2BOFN = AA_T2BOFN                                        BUG7975
471900200529     C                   ENDIF                                                               BUG7975
472000200529                                                                                             BUG7975
472100200529     C                   IF        AA_T2BOF1 <> *Blanks                                      BUG7975
472200200529     C                   EVAL      T2BOF1 = AA_T2BOF1                                        BUG7975
472300200529     C                   ENDIF                                                               BUG7975
472400200529                                                                                             BUG7975
472500200529     C                   IF        AA_T2BOF2 <> *Blanks                                      BUG7975
472600200529     C                   EVAL      T2BOF2 = AA_T2BOF2                                        BUG7975
472700200529     C                   ENDIF                                                               BUG7975
472800200529                                                                                             BUG7975
472900200529     C                   IF        AA_T2SRL1 <> *Blanks                                      BUG7975
473000200529     C                   EVAL      T2SRL1 = AA_T2SRL1                                        BUG7975
473100200529     C                   ENDIF                                                               BUG7975
473200200529                                                                                             BUG7975
473300200529     C                   IF        AA_T2SRL2 <> *Blanks                                      BUG7975
473400200529     C                   EVAL      T2SRL2 = AA_T2SRL2                                        BUG7975
473500200529     C                   ENDIF                                                               BUG7975
473600200529                                                                                             BUG7975
473700200529     C                   IF        AA_T2SRL3 <> *Blanks                                      BUG7975
473800200529     C                   EVAL      T2SRL3 = AA_T2SRL3                                        BUG7975
473900200529     C                   ENDIF                                                               BUG7975
474000200529                                                                                             BUG7975
474100200529     C                   IF        AA_T2FIN1 <> *Blanks                                      BUG7975
474200200529     C                   EVAL      T2FIN1 = AA_T2FIN1                                        BUG7975
474300200529     C                   ENDIF                                                               BUG7975
474400200529                                                                                             BUG7975
474500200529     C                   IF        AA_T2FIN2 <> *Blanks                                      BUG7975
474600200529     C                   EVAL      T2FIN2 = AA_T2FIN2                                        BUG7975
474700200529     C                   ENDIF                                                               BUG7975
474800200529                                                                                             BUG7975
474900200529     C                   IF        AA_T2RED1 <> *Blanks                                      BUG7975
475000200529     C                   EVAL      T2RED1 = AA_T2RED1                                        BUG7975
475100200529     C                   ENDIF                                                               BUG7975
475200200529                                                                                             BUG7975
475300200529     C                   IF        AA_T2RED2 <> *Blanks                                      BUG7975
475400200529     C                   EVAL      T2RED2 = AA_T2RED2                                        BUG7975
475500200529     C                   ENDIF                                                               BUG7975
475600200529                                                                                             BUG7975
475700200529     C                   IF        AA_T2NAL1 <> *Blanks                                      BUG7975
475800200529     C                   EVAL      T2NAL1 = AA_T2NAL1                                        BUG7975
475900200529     C                   ENDIF                                                               BUG7975
476000200529                                                                                             BUG7975
476100200529     C                   IF        AA_T2NAL2 <> *Blanks                                      BUG7975
476200200529     C                   EVAL      T2NAL2 = AA_T2NAL2                                        BUG7975
476300200529     C                   ENDIF                                                               BUG7975
476400200529                                                                                             BUG7975
476500200529     C                   IF        AA_T2CCTN <> *Blanks                                      BUG7975
476600200529     C                   EVAL      T2CCTN = AA_T2CCTN                                        BUG7975
476700200529     C                   ENDIF                                                               BUG7975
476800200529                                                                                             BUG7975
476900200529     C                   IF        AA_T2BSSN <> *Blanks                                      BUG7975
477000200529     C                   EVAL      T2BSSN = AA_T2BSSN                                        BUG7975
477100200529     C                   ENDIF                                                               BUG7975
477200200529                                                                                             BUG7975
477300200529     C                   IF        AA_T2BSS1 <> *Blanks                                      BUG7975
477400200529     C                   EVAL      T2BSS1 = AA_T2BSS1                                        BUG7975
477500200529     C                   ENDIF                                                               BUG7975
477600200529                                                                                             BUG7975
477700200529     C                   IF        AA_T2BSS2 <> *Blanks                                      BUG7975
477800200529     C                   EVAL      T2BSS2 = AA_T2BSS2                                        BUG7975
477900200529     C                   ENDIF                                                               BUG7975
478000200529                                                                                             BUG7975
478100200529     C                   IF        AA_T2IMD1 <> *Blanks                                      BUG7975
478200200529     C                   EVAL      T2IMD1 = AA_T2IMD1                                        BUG7975
478300200529     C                   ENDIF                                                               BUG7975
478400200529                                                                                             BUG7975
478500200529     C                   IF        AA_T2IMD2 <> *Blanks                                      BUG7975
478600200529     C                   EVAL      T2IMD2 = AA_T2IMD2                                        BUG7975
478700200529     C                   ENDIF                                                               BUG7975
478800200529                                                                                             BUG7975
478900200529     C                   IF        AA_T2IMD3 <> *Blanks                                      BUG7975
479000200529     C                   EVAL      T2IMD3 = AA_T2IMD3                                        BUG7975
479100200529     C                   ENDIF                                                               BUG7975
479200200529                                                                                             BUG7975
479300200529     C                   IF        AA_T2IMD4 <> *Blanks                                      BUG7975
479400200529     C                   EVAL      T2IMD4 = AA_T2IMD4                                        BUG7975
479500200529     C                   ENDIF                                                               BUG7975
479600200529                                                                                             BUG7975
479700200529     C                   IF        AA_T2IMD5 <> *Blanks                                      BUG7975
479800200529     C                   EVAL      T2IMD5 = AA_T2IMD5                                        BUG7975
479900200529     C                   ENDIF                                                               BUG7975
480000200529                                                                                             BUG7975
480100200529     C                   IF        AA_T2IMD6 <> *Blanks                                      BUG7975
480200200529     C                   EVAL      T2IMD6 = AA_T2IMD6                                        BUG7975
480300200529     C                   ENDIF                                                               BUG7975
480400200529                                                                                             BUG7975
480500200529     C                   IF        AA_T2IMD7 <> *Blanks                                      BUG7975
480600200529     C                   EVAL      T2IMD7 = AA_T2IMD7                                        BUG7975
480700200529     C                   ENDIF                                                               BUG7975
480800200529                                                                                             BUG7975
480900200529     C                   IF        AA_T2IMD8 <> *Blanks                                      BUG7975
481000200529     C                   EVAL      T2IMD8 = AA_T2IMD8                                        BUG7975
481100200529     C                   ENDIF                                                               BUG7975
481200200529                                                                                             BUG7975
481300200529     C                   IF        AA_T2IMD9 <> *Blanks                                      BUG7975
481400200529     C                   EVAL      T2IMD9 = AA_T2IMD9                                        BUG7975
481500200529     C                   ENDIF                                                               BUG7975
481600200529                                                                                             BUG7975
481700200529     C                   IF        AA_T2IMS1 <> *Blanks                                      BUG7975
481800200529     C                   EVAL      T2IMS1 = AA_T2IMS1                                        BUG7975
481900200529     C                   ENDIF                                                               BUG7975
482000200529                                                                                             BUG7975
482100200529     C                   IF        AA_T2IMS2 <> *Blanks                                      BUG7975
482200200529     C                   EVAL      T2IMS2 = AA_T2IMS2                                        BUG7975
482300200529     C                   ENDIF                                                               BUG7975
482400200529                                                                                             BUG7975
482500200529     C                   IF        AA_T2IMS3 <> *Blanks                                      BUG7975
482600200529     C                   EVAL      T2IMS3 = AA_T2IMS3                                        BUG7975
482700200529     C                   ENDIF                                                               BUG7975
482800200529                                                                                             BUG7975
482900200529     C                   IF        AA_T2IMS4 <> *Blanks                                      BUG7975
483000200529     C                   EVAL      T2IMS4 = AA_T2IMS4                                        BUG7975
483100200529     C                   ENDIF                                                               BUG7975
483200200529                                                                                             BUG7975
483300200529     C                   IF        AA_T2IMS5 <> *Blanks                                      BUG7975
483400200529     C                   EVAL      T2IMS5 = AA_T2IMS5                                        BUG7975
483500200529     C                   ENDIF                                                               BUG7975
483600200529                                                                                             BUG7975
483700200529     C                   IF        AA_T2IMS6 <> *Blanks                                      BUG7975
483800200529     C                   EVAL      T2IMS6 = AA_T2IMS6                                        BUG7975
483900200529     C                   ENDIF                                                               BUG7975
484000200529                                                                                             BUG7975
484100200529     C                   IF        AA_T2IMS7 <> *Blanks                                      BUG7975
484200200529     C                   EVAL      T2IMS7 = AA_T2IMS7                                        BUG7975
484300200529     C                   ENDIF                                                               BUG7975
484400200529                                                                                             BUG7975
484500200529     C                   IF        AA_T2IMS8 <> *Blanks                                      BUG7975
484600200529     C                   EVAL      T2IMS8 = AA_T2IMS8                                        BUG7975
484700200529     C                   ENDIF                                                               BUG7975
484800200529                                                                                             BUG7975
484900200529     C                   IF        AA_T2IMS9 <> *Blanks                                      BUG7975
485000200529     C                   EVAL      T2IMS9 = AA_T2IMS9                                        BUG7975
485100200529     C                   ENDIF                                                               BUG7975
485200200529                                                                                             BUG7975
485300200529     C                   IF        AA_T2PSET <> *Blanks                                      BUG7975
485400200529     C                   EVAL      T2PSET = AA_T2PSET                                        BUG7975
485500200529     C                   ENDIF                                                               BUG7975
485600200529                                                                                             BUG7975
485700200529     C                   IF        AA_T2NAC1 <> *Blanks                                      BUG7975
485800200529     C                   EVAL      T2NAC1 = AA_T2NAC1                                        BUG7975
485900200529     C                   ENDIF                                                               BUG7975
486000200529                                                                                             BUG7975
486100200529     C                   IF        AA_T2NAC2 <> *Blanks                                      BUG7975
486200200529     C                   EVAL      T2NAC2 = AA_T2NAC2                                        BUG7975
486300200529     C                   ENDIF                                                               BUG7975
486400200529                                                                                             BUG7975
486500200529     C                   IF        AA_T2DSSN <> *Blanks                                      BUG7975
486600200529     C                   EVAL      T2DSSN = AA_T2DSSN                                        BUG7975
486700200529     C                   ENDIF                                                               BUG7975
486800200529                                                                                             BUG7975
486900200529     C                   IF        AA_T2DSS1 <> *Blanks                                      BUG7975
487000200529     C                   EVAL      T2DSS1 = AA_T2DSS1                                        BUG7975
487100200529     C                   ENDIF                                                               BUG7975
487200200529                                                                                             BUG7975
487300200529     C                   IF        AA_T2DSS2 <> *Blanks                                      BUG7975
487400200529     C                   EVAL      T2DSS2 = AA_T2DSS2                                        BUG7975
487500200529     C                   ENDIF                                                               BUG7975
487600200529                                                                                             BUG7975
487700200529     C                   IF        AA_T2DSS3 <> *Blanks                                      BUG7975
487800200529     C                   EVAL      T2DSS3 = AA_T2DSS3                                        BUG7975
487900200529     C                   ENDIF                                                               BUG7975
488000200529                                                                                             BUG7975
488100200529     C                   IF        AA_T2DSS4 <> *Blanks                                      BUG7975
488200200529     C                   EVAL      T2DSS4 = AA_T2DSS4                                        BUG7975
488300200529     C                   ENDIF                                                               BUG7975
488400200529                                                                                             BUG7975
488500200529     C                   IF        AA_T2RSSN <> *Blanks                                      BUG7975
488600200529     C                   EVAL      T2RSSN = AA_T2RSSN                                        BUG7975
488700200529     C                   ENDIF                                                               BUG7975
488800200529                                                                                             BUG7975
488900200529     C                   IF        AA_T2RSS1 <> *Blanks                                      BUG7975
489000200529     C                   EVAL      T2RSS1 = AA_T2RSS1                                        BUG7975
489100200529     C                   ENDIF                                                               BUG7975
489200200529                                                                                             BUG7975
489300200529     C                   IF        AA_T2RSS2 <> *Blanks                                      BUG7975
489400200529     C                   EVAL      T2RSS2 = AA_T2RSS2                                        BUG7975
489500200529     C                   ENDIF                                                               BUG7975
489600200529                                                                                             BUG7975
489700200529     C                   IF        AA_T2RSS3 <> *Blanks                                      BUG7975
489800200529     C                   EVAL      T2RSS3 = AA_T2RSS3                                        BUG7975
489900200529     C                   ENDIF                                                               BUG7975
490000200529                                                                                             BUG7975
490100200529     C                   IF        AA_T2RSS4 <> *Blanks                                      BUG7975
490200200529     C                   EVAL      T2RSS4 = AA_T2RSS4                                        BUG7975
490300200529     C                   ENDIF                                                               BUG7975
490400200529                                                                                             BUG7975
490500200529     C                   IF        AA_T2SKAN <> *Blanks                                      BUG7975
490600200529     C                   EVAL      T2SKAN = AA_T2SKAN                                        BUG7975
490700200529     C                   ENDIF                                                               BUG7975
490800200529                                                                                             BUG7975
490900200529     C                   IF        AA_T2SKAL <> *Blanks                                      BUG7975
491000200529     C                   EVAL      T2SKAL = AA_T2SKAL                                        BUG7975
491100200529     C                   ENDIF                                                               BUG7975
491200200529                                                                                             BUG7975
491300200529     C                   IF        AA_T2SA1N <> *Blanks                                      BUG7975
491400200529     C                   EVAL      T2SA1N = AA_T2SA1N                                        BUG7975
491500200529     C                   ENDIF                                                               BUG7975
491600200529                                                                                             BUG7975
491700200529     C                   IF        AA_T2SA1L <> *Blanks                                      BUG7975
491800200529     C                   EVAL      T2SA1L = AA_T2SA1L                                        BUG7975
491900200529     C                   ENDIF                                                               BUG7975
492000200529                                                                                              CSW210
492100200529     C                   IF        AA_T2DIDN <> *Blanks                                       CSW210
492200200529     C                   EVAL      T2DIDN = AA_T2DIDN                                         CSW210
492300200529     C                   ENDIF                                                                CSW210
492400200529                                                                                              CSW210
492500200529     C                   IF        AA_T2DLIN <> *Blanks                                       CSW210
492600200529     C                   EVAL      T2DLIN = AA_T2DLIN                                         CSW210
492700200529     C                   ENDIF                                                                CSW210
492800200529                                                                                              CSW210
492900200529     C                   IF        AA_T2DAD1 <> *Blanks                                       CSW210
493000200529     C                   EVAL      T2DAD1 = AA_T2DAD1                                         CSW210
493100200529     C                   ENDIF                                                                CSW210
493200200529                                                                                              CSW210
493300200529     C                   IF        AA_T2DAD2 <> *Blanks                                       CSW210
493400200529     C                   EVAL      T2DAD2 = AA_T2DAD2                                         CSW210
493500200529     C                   ENDIF                                                                CSW210
493600200529                                                                                              CSW210
493700200529     C                   IF        AA_T2DAD3 <> *Blanks                                       CSW210
493800200529     C                   EVAL      T2DAD3 = AA_T2DAD3                                         CSW210
493900200529     C                   ENDIF                                                                CSW210
494000200529                                                                                              CSW210
494100200529     C                   IF        AA_T2DAD4 <> *Blanks                                       CSW210
494200200529     C                   EVAL      T2DAD4 = AA_T2DAD4                                         CSW210
494300200529     C                   ENDIF                                                                CSW210
494400200529                                                                                              CSW210
494500200529     C                   IF        AA_T2QFIN <> *Blanks                                       CSW210
494600200529     C                   EVAL      T2QFIN = AA_T2QFIN                                         CSW210
494700200529     C                   ENDIF                                                                CSW210
494800200529                                                                                              CSW210
494900200529     C                   IF        AA_T2PCLR <> *Blanks                                       CSW210
495000200529     C                   EVAL      T2PCLR = AA_T2PCLR                                         CSW210
495100200529     C                   ENDIF                                                                CSW210
495200200529                                                                                             BUG7975
495300200529     C                   ELSE                                                                BUG7975
495400200529     C                   IF        AB_T2AFPN <> *Blanks                                      BUG7975
495500200529     C                   EVAL      T2AFPN = AB_T2AFPN                                        BUG7975
495600200529     C                   ENDIF                                                               BUG7975
495700200529                                                                                             BUG7975
495800200529     C                   IF        AB_T2AFPL <> *Blanks                                      BUG7975
495900200529     C                   EVAL      T2AFPL = AB_T2AFPL                                        BUG7975
496000200529     C                   ENDIF                                                               BUG7975
496100200529                                                                                             BUG7975
496200200529     C                   IF        AB_T2AWIN <> *Blanks                                      BUG7975
496300200529     C                   EVAL      T2AWIN = AB_T2AWIN                                        BUG7975
496400200529     C                   ENDIF                                                               BUG7975
496500200529                                                                                             BUG7975
496600200529     C                   IF        AB_T2AWIL <> *Blanks                                      BUG7975
496700200529     C                   EVAL      T2AWIL = AB_T2AWIL                                        BUG7975
496800200529     C                   ENDIF                                                               BUG7975
496900200529                                                                                             BUG7975
497000200529     C                   IF        AB_T2BOFN <> *Blanks                                      BUG7975
497100200529     C                   EVAL      T2BOFN = AB_T2BOFN                                        BUG7975
497200200529     C                   ENDIF                                                               BUG7975
497300200529                                                                                             BUG7975
497400200529     C                   IF        AB_T2BOF1 <> *Blanks                                      BUG7975
497500200529     C                   EVAL      T2BOF1 = AB_T2BOF1                                        BUG7975
497600200529     C                   ENDIF                                                               BUG7975
497700200529                                                                                             BUG7975
497800200529     C                   IF        AB_T2BOF2 <> *Blanks                                      BUG7975
497900200529     C                   EVAL      T2BOF2 = AB_T2BOF2                                        BUG7975
498000200529     C                   ENDIF                                                               BUG7975
498100200529                                                                                             BUG7975
498200200529     C                   IF        AB_T2SRL1 <> *Blanks                                      BUG7975
498300200529     C                   EVAL      T2SRL1 = AB_T2SRL1                                        BUG7975
498400200529     C                   ENDIF                                                               BUG7975
498500200529                                                                                             BUG7975
498600200529     C                   IF        AB_T2SRL2 <> *Blanks                                      BUG7975
498700200529     C                   EVAL      T2SRL2 = AB_T2SRL2                                        BUG7975
498800200529     C                   ENDIF                                                               BUG7975
498900200529                                                                                             BUG7975
499000200529     C                   IF        AB_T2SRL3 <> *Blanks                                      BUG7975
499100200529     C                   EVAL      T2SRL3 = AB_T2SRL3                                        BUG7975
499200200529     C                   ENDIF                                                               BUG7975
499300200529                                                                                             BUG7975
499400200529     C                   IF        AB_T2FIN1 <> *Blanks                                      BUG7975
499500200529     C                   EVAL      T2FIN1 = AB_T2FIN1                                        BUG7975
499600200529     C                   ENDIF                                                               BUG7975
499700200529                                                                                             BUG7975
499800200529     C                   IF        AB_T2FIN2 <> *Blanks                                      BUG7975
499900200529     C                   EVAL      T2FIN2 = AB_T2FIN2                                        BUG7975
500000200529     C                   ENDIF                                                               BUG7975
500100200529                                                                                             BUG7975
500200200529     C                   IF        AB_T2RED1 <> *Blanks                                      BUG7975
500300200529     C                   EVAL      T2RED1 = AB_T2RED1                                        BUG7975
500400200529     C                   ENDIF                                                               BUG7975
500500200529                                                                                             BUG7975
500600200529     C                   IF        AB_T2RED2 <> *Blanks                                      BUG7975
500700200529     C                   EVAL      T2RED2 = AB_T2RED2                                        BUG7975
500800200529     C                   ENDIF                                                               BUG7975
500900200529                                                                                             BUG7975
501000200529     C                   IF        AB_T2NAL1 <> *Blanks                                      BUG7975
501100200529     C                   EVAL      T2NAL1 = AB_T2NAL1                                        BUG7975
501200200529     C                   ENDIF                                                               BUG7975
501300200529                                                                                             BUG7975
501400200529     C                   IF        AB_T2NAL2 <> *Blanks                                      BUG7975
501500200529     C                   EVAL      T2NAL2 = AB_T2NAL2                                        BUG7975
501600200529     C                   ENDIF                                                               BUG7975
501700200529                                                                                             BUG7975
501800200529     C                   IF        AB_T2CCTN <> *Blanks                                      BUG7975
501900200529     C                   EVAL      T2CCTN = AB_T2CCTN                                        BUG7975
502000200529     C                   ENDIF                                                               BUG7975
502100200529                                                                                             BUG7975
502200200529     C                   IF        AB_T2BSSN <> *Blanks                                      BUG7975
502300200529     C                   EVAL      T2BSSN = AB_T2BSSN                                        BUG7975
502400200529     C                   ENDIF                                                               BUG7975
502500200529                                                                                             BUG7975
502600200529     C                   IF        AB_T2BSS1 <> *Blanks                                      BUG7975
502700200529     C                   EVAL      T2BSS1 = AB_T2BSS1                                        BUG7975
502800200529     C                   ENDIF                                                               BUG7975
502900200529                                                                                             BUG7975
503000200529     C                   IF        AB_T2BSS2 <> *Blanks                                      BUG7975
503100200529     C                   EVAL      T2BSS2 = AB_T2BSS2                                        BUG7975
503200200529     C                   ENDIF                                                               BUG7975
503300200529                                                                                             BUG7975
503400200529     C                   IF        AB_T2IMD1 <> *Blanks                                      BUG7975
503500200529     C                   EVAL      T2IMD1 = AB_T2IMD1                                        BUG7975
503600200529     C                   ENDIF                                                               BUG7975
503700200529                                                                                             BUG7975
503800200529     C                   IF        AB_T2IMD2 <> *Blanks                                      BUG7975
503900200529     C                   EVAL      T2IMD2 = AB_T2IMD2                                        BUG7975
504000200529     C                   ENDIF                                                               BUG7975
504100200529                                                                                             BUG7975
504200200529     C                   IF        AB_T2IMD3 <> *Blanks                                      BUG7975
504300200529     C                   EVAL      T2IMD3 = AB_T2IMD3                                        BUG7975
504400200529     C                   ENDIF                                                               BUG7975
504500200529                                                                                             BUG7975
504600200529     C                   IF        AB_T2IMD4 <> *Blanks                                      BUG7975
504700200529     C                   EVAL      T2IMD4 = AB_T2IMD4                                        BUG7975
504800200529     C                   ENDIF                                                               BUG7975
504900200529                                                                                             BUG7975
505000200529     C                   IF        AB_T2IMD5 <> *Blanks                                      BUG7975
505100200529     C                   EVAL      T2IMD5 = AB_T2IMD5                                        BUG7975
505200200529     C                   ENDIF                                                               BUG7975
505300200529                                                                                             BUG7975
505400200529     C                   IF        AB_T2IMD6 <> *Blanks                                      BUG7975
505500200529     C                   EVAL      T2IMD6 = AB_T2IMD6                                        BUG7975
505600200529     C                   ENDIF                                                               BUG7975
505700200529                                                                                             BUG7975
505800200529     C                   IF        AB_T2IMD7 <> *Blanks                                      BUG7975
505900200529     C                   EVAL      T2IMD7 = AB_T2IMD7                                        BUG7975
506000200529     C                   ENDIF                                                               BUG7975
506100200529                                                                                             BUG7975
506200200529     C                   IF        AB_T2IMD8 <> *Blanks                                      BUG7975
506300200529     C                   EVAL      T2IMD8 = AB_T2IMD8                                        BUG7975
506400200529     C                   ENDIF                                                               BUG7975
506500200529                                                                                             BUG7975
506600200529     C                   IF        AB_T2IMD9 <> *Blanks                                      BUG7975
506700200529     C                   EVAL      T2IMD9 = AB_T2IMD9                                        BUG7975
506800200529     C                   ENDIF                                                               BUG7975
506900200529                                                                                             BUG7975
507000200529     C                   IF        AB_T2IMS1 <> *Blanks                                      BUG7975
507100200529     C                   EVAL      T2IMS1 = AB_T2IMS1                                        BUG7975
507200200529     C                   ENDIF                                                               BUG7975
507300200529                                                                                             BUG7975
507400200529     C                   IF        AB_T2IMS2 <> *Blanks                                      BUG7975
507500200529     C                   EVAL      T2IMS2 = AB_T2IMS2                                        BUG7975
507600200529     C                   ENDIF                                                               BUG7975
507700200529                                                                                             BUG7975
507800200529     C                   IF        AB_T2IMS3 <> *Blanks                                      BUG7975
507900200529     C                   EVAL      T2IMS3 = AB_T2IMS3                                        BUG7975
508000200529     C                   ENDIF                                                               BUG7975
508100200529                                                                                             BUG7975
508200200529     C                   IF        AB_T2IMS4 <> *Blanks                                      BUG7975
508300200529     C                   EVAL      T2IMS4 = AB_T2IMS4                                        BUG7975
508400200529     C                   ENDIF                                                               BUG7975
508500200529                                                                                             BUG7975
508600200529     C                   IF        AB_T2IMS5 <> *Blanks                                      BUG7975
508700200529     C                   EVAL      T2IMS5 = AB_T2IMS5                                        BUG7975
508800200529     C                   ENDIF                                                               BUG7975
508900200529                                                                                             BUG7975
509000200529     C                   IF        AB_T2IMS6 <> *Blanks                                      BUG7975
509100200529     C                   EVAL      T2IMS6 = AB_T2IMS6                                        BUG7975
509200200529     C                   ENDIF                                                               BUG7975
509300200529                                                                                             BUG7975
509400200529     C                   IF        AB_T2IMS7 <> *Blanks                                      BUG7975
509500200529     C                   EVAL      T2IMS7 = AB_T2IMS7                                        BUG7975
509600200529     C                   ENDIF                                                               BUG7975
509700200529                                                                                             BUG7975
509800200529     C                   IF        AB_T2IMS8 <> *Blanks                                      BUG7975
509900200529     C                   EVAL      T2IMS8 = AB_T2IMS8                                        BUG7975
510000200529     C                   ENDIF                                                               BUG7975
510100200529                                                                                             BUG7975
510200200529     C                   IF        AB_T2IMS9 <> *Blanks                                      BUG7975
510300200529     C                   EVAL      T2IMS9 = AA_T2IMS9                                        BUG7975
510400200529     C                   ENDIF                                                               BUG7975
510500200529                                                                                             BUG7975
510600200529     C                   IF        AB_T2PSET <> *Blanks                                      BUG7975
510700200529     C                   EVAL      T2PSET = AB_T2PSET                                        BUG7975
510800200529     C                   ENDIF                                                               BUG7975
510900200529                                                                                             BUG7975
511000200529     C                   IF        AB_T2NAC1 <> *Blanks                                      BUG7975
511100200529     C                   EVAL      T2NAC1 = AB_T2NAC1                                        BUG7975
511200200529     C                   ENDIF                                                               BUG7975
511300200529                                                                                             BUG7975
511400200529     C                   IF        AB_T2NAC2 <> *Blanks                                      BUG7975
511500200529     C                   EVAL      T2NAC2 = AB_T2NAC2                                        BUG7975
511600200529     C                   ENDIF                                                               BUG7975
511700200529                                                                                             BUG7975
511800200529     C                   IF        AB_T2DSSN <> *Blanks                                      BUG7975
511900200529     C                   EVAL      T2DSSN = AB_T2DSSN                                        BUG7975
512000200529     C                   ENDIF                                                               BUG7975
512100200529                                                                                             BUG7975
512200200529     C                   IF        AB_T2DSS1 <> *Blanks                                      BUG7975
512300200529     C                   EVAL      T2DSS1 = AB_T2DSS1                                        BUG7975
512400200529     C                   ENDIF                                                               BUG7975
512500200529                                                                                             BUG7975
512600200529     C                   IF        AB_T2DSS2 <> *Blanks                                      BUG7975
512700200529     C                   EVAL      T2DSS2 = AB_T2DSS2                                        BUG7975
512800200529     C                   ENDIF                                                               BUG7975
512900200529                                                                                             BUG7975
513000200529     C                   IF        AB_T2DSS3 <> *Blanks                                      BUG7975
513100200529     C                   EVAL      T2DSS3 = AB_T2DSS3                                        BUG7975
513200200529     C                   ENDIF                                                               BUG7975
513300200529                                                                                             BUG7975
513400200529     C                   IF        AB_T2DSS4 <> *Blanks                                      BUG7975
513500200529     C                   EVAL      T2DSS4 = AB_T2DSS4                                        BUG7975
513600200529     C                   ENDIF                                                               BUG7975
513700200529                                                                                             BUG7975
513800200529     C                   IF        AB_T2RSSN <> *Blanks                                      BUG7975
513900200529     C                   EVAL      T2RSSN = AB_T2RSSN                                        BUG7975
514000200529     C                   ENDIF                                                               BUG7975
514100200529                                                                                             BUG7975
514200200529     C                   IF        AB_T2RSS1 <> *Blanks                                      BUG7975
514300200529     C                   EVAL      T2RSS1 = AB_T2RSS1                                        BUG7975
514400200529     C                   ENDIF                                                               BUG7975
514500200529                                                                                             BUG7975
514600200529     C                   IF        AB_T2RSS2 <> *Blanks                                      BUG7975
514700200529     C                   EVAL      T2RSS2 = AB_T2RSS2                                        BUG7975
514800200529     C                   ENDIF                                                               BUG7975
514900200529                                                                                             BUG7975
515000200529     C                   IF        AB_T2RSS3 <> *Blanks                                      BUG7975
515100200529     C                   EVAL      T2RSS3 = AB_T2RSS3                                        BUG7975
515200200529     C                   ENDIF                                                               BUG7975
515300200529                                                                                             BUG7975
515400200529     C                   IF        AB_T2RSS4 <> *Blanks                                      BUG7975
515500200529     C                   EVAL      T2RSS4 = AB_T2RSS4                                        BUG7975
515600200529     C                   ENDIF                                                               BUG7975
515700200529                                                                                             BUG7975
515800200529     C                   IF        AB_T2SKAN <> *Blanks                                      BUG7975
515900200529     C                   EVAL      T2SKAN = AB_T2SKAN                                        BUG7975
516000200529     C                   ENDIF                                                               BUG7975
516100200529                                                                                             BUG7975
516200200529     C                   IF        AB_T2SKAL <> *Blanks                                      BUG7975
516300200529     C                   EVAL      T2SKAL = AB_T2SKAL                                        BUG7975
516400200529     C                   ENDIF                                                               BUG7975
516500200529                                                                                             BUG7975
516600200529     C                   IF        AB_T2SA1N <> *Blanks                                      BUG7975
516700200529     C                   EVAL      T2SA1N = AB_T2SA1N                                        BUG7975
516800200529     C                   ENDIF                                                               BUG7975
516900200529                                                                                             BUG7975
517000200529     C                   IF        AB_T2SA1L <> *Blanks                                      BUG7975
517100200529     C                   EVAL      T2SA1L = AB_T2SA1L                                        BUG7975
517200200529     C                   ENDIF                                                               BUG7975
517300200529                                                                                              CSW210
517400200529     C                   IF        AB_T2DIDN <> *Blanks                                       CSW210
517500200529     C                   EVAL      T2DIDN = AB_T2DIDN                                         CSW210
517600200529     C                   ENDIF                                                                CSW210
517700200529                                                                                              CSW210
517800200529     C                   IF        AB_T2DLIN <> *Blanks                                       CSW210
517900200529     C                   EVAL      T2DLIN = AB_T2DLIN                                         CSW210
518000200529     C                   ENDIF                                                                CSW210
518100200529                                                                                              CSW210
518200200529     C                   IF        AB_T2DAD1 <> *Blanks                                       CSW210
518300200529     C                   EVAL      T2DAD1 = AB_T2DAD1                                         CSW210
518400200529     C                   ENDIF                                                                CSW210
518500200529                                                                                              CSW210
518600200529     C                   IF        AB_T2DAD2 <> *Blanks                                       CSW210
518700200529     C                   EVAL      T2DAD2 = AB_T2DAD2                                         CSW210
518800200529     C                   ENDIF                                                                CSW210
518900200529                                                                                              CSW210
519000200529     C                   IF        AB_T2DAD3 <> *Blanks                                       CSW210
519100200529     C                   EVAL      T2DAD3 = AB_T2DAD3                                         CSW210
519200200529     C                   ENDIF                                                                CSW210
519300200529                                                                                              CSW210
519400200529     C                   IF        AB_T2DAD4 <> *Blanks                                       CSW210
519500200529     C                   EVAL      T2DAD4 = AB_T2DAD4                                         CSW210
519600200529     C                   ENDIF                                                                CSW210
519700200529                                                                                              CSW210
519800200529     C                   IF        AB_T2QFIN <> *Blanks                                       CSW210
519900200529     C                   EVAL      T2QFIN = AB_T2QFIN                                         CSW210
520000200529     C                   ENDIF                                                                CSW210
520100200529                                                                                              CSW210
520200200529     C                   IF        AB_T2PCLR <> *Blanks                                       CSW210
520300200529     C                   EVAL      T2PCLR = AB_T2PCLR                                         CSW210
520400200529     C                   ENDIF                                                                CSW210
520500200529                                                                                             BUG7975
520600200529     C                   ENDIF                                                               BUG7975
520700200529                                                                                             BUG7975
520800200529     C                   ENDSR                                                               BUG7975
520900200529      ****************************************************************                        210517
521000200529      /EJECT
521100200529     C****************************************************************
521200200529     C*                                                              *
521300200529     C* UTRADSX1B - UPDATE TRADE EXTENSION 1 - 'B' RECORD            *
521400200529     C*                                                              *
521500200529     C****************************************************************
521600200529     C     UTRADSX1B     BEGSR
521700200529
521800200529      ** ACCESS TRADE EXTENSION RECORD
521900200529
522000200529     C                   MOVEL     'B'           T1WHEN
522100200529     C     TRADSY1K      CHAIN     TRADSDD1                           99
522200200529
522300200529      ** DATABASE ERROR
522400200529      ** IF INSERT, BUT RECORD PRESENT ALREADY
522500200529      ** OR IF NOT INSERT, BUT NO RECORD FOUND
522600200529
522700200529     C     A_CHTP        IFEQ      'I'
522800200529     C     *IN99         ANDEQ     '0'
522900200529     C     A_CHTP        ORNE      'I'
523000200529     C     *IN99         ANDEQ     '1'
523100200529     C                   MOVEL     A_TDRF        DBKEY
523200200529     C                   MOVEL     'TRADSDX1'    DBFILE                         ************
523300200529     C                   MOVEL     '851'         DBASE                          * DBERR 002*
523400200529     C                   EXSR      SRERR                                        ************
523500200529     C                   END
523600200529
523700200529      ** If depots are different
523800200529      ** Update with details from valid trade extension 'B' record
523900200529      ** Else, update with 'A' details
524000200529
524100200529     C     DELF          IFNE      DELT
524200200529     C                   MOVEL     SEVTRDX1B     TRADSX1F
524300200529     C                   IF        CSE045 = 'Y'                                               CSE045
524400200529     C                   MOVEL     'B'           T1WHEN                                       CSE045
524500200529     C                   ENDIF                                                                CSE045
524600200529     C                   MOVEL     'N'           T1GMEC                                     AR632291
524700200529     C                   ELSE
524800200529     C                   MOVEL     SEVTRDX1A     TRADSX1F
524900200529     C                   MOVEL     'B'           T1WHEN
525000200529     C                   MOVEL     'N'           T1GMES
525100200529     C                   MOVEL     'N'           T1GMEC
525200200529     C                   END
525300200529      *
525400200529      *** Trade reference
525500200529      *
525600200529     C                   MOVEL     A_TDRF        T1TDRF
525700200529      *
525800200529      *** Set S.W.I.F.T. Confirmation generated to 'No'
525900200529      *** if trade confirmation not yet generated
526000200529      *
526100200529     C     TCFR          IFEQ      'N'
526200200529     C                   MOVEL     'N'           T1GMEC
526300200529     C                   ENDIF
526400200529      *
526500200529      *** Set Settlement Message Required Flag to 'Y'
526600200529      *
526700200529     C                   MOVEL     'Y'           T1SCMG
526800200529
526900200529                                                                                              CSC011
527000200529      ** If CSC011 is installed, supply a Front Office ID for the                             CSC011
527100200529      ** transaction even if it originated from SIN module.                                   CSC011
527200200529                                                                                              CSC011
527300200529     C                   IF        CSC011 = 'Y'                                               CSC011
527400200529     C                   IF        T1FRNT = *BLANKS                                           CSC011
527500200529     C                   EVAL      T1FRNT = 'MD' + T1TDRF                                     CSC011
527600200529     C                   ENDIF                                                                CSC011
527700200529     C                   ENDIF                                                                CSC011
527800200529                                                                                              CSC011
527900200529      ** UPDATE RECORD
528000200529
528100200529     C     *IN99         IFEQ      '1'
528200200529     C                   MOVE      'N'           T1CONG
528300200529     C                   MOVE      'N'           T1RCDG
528400200529     C                   WRITE     TRADSDD1
528500200529     C                   ELSE
528600200529     C                   UPDATE    TRADSDD1
528700200529     C                   END
528800200529      *                                                                                       CSE045
528900200529      ** Default Values of Extended Settlements when CSE045 is NOT installed                  CSE045
529000200529      *                                                                                       CSE045
529100200529     C**********         IF        CSE045 = 'N'                                        CSE045 238859
529200200529     C                   IF        CSE045 = 'N'                                               240736
529300200529                                                                                              210517
529400200529      ** Update Trade Extenstion 2 record                                                     210517
529500200529                                                                                              210517
529600200529     C                   IF        PMode = 'UPC'                                              210517
529700200529     C                              or PMode = 'RPR'                                          248683
529800200529                                                                                              238859
529900200529     C**********         IF        A_CHTP = 'I'                                        238859 240736
530000200529     C                   EVAL      PScreen = 'B'                                              210517
530100200529     C                   EXSR      InsertX2AB                                                 210517
530200200529     C**********         ENDIF                                                         238859 240736
530300200529                                                                                              238859
530400200529     C                   ENDIF                                                                210517
530500200529                                                                                              CSE045
530600200529     C**********         ELSE                                                          CSE045 238859
530700200529     C                   ELSE                                                                 240736
530800200529     C                   IF        PMode = 'UPC' or                                           CSE045
530900200529     C                             PMode = 'RPR'                                              CSE045
531000200529      * Retrieve flag from data area whether SE1806 already wrote a record in                 248683
531100200529      * TRADSDX2                                                                              248683
531200200529     C                   CALL      'SECDTARA'                                                 248683
531300200529     C                   PARM      'SETRADUPD'   PGMNAM           10                          248683
531400200529     C                   PARM      *BLANKS       WRTFLG            1                          248683
531500200529      * If Write Flag is not 'Y' then go through normal processing                            248683
531600200529     C                   IF        WRTFLG <> 'Y'                                              248683
531700200529                                                                                              238859
531800200529     C**********         IF        A_CHTP = 'A'                                        238859 240736
531900200529     C                   EXSR      UTRADSX2B                                                  CSE045
532000200529     C                   ELSE                                                                 248683
532100200529      * If Write Flag is 'Y' then Update Timestamp                                            248683
532200200529     C                   EVAL      T2WHEN = 'B'                                               248683
532300200529     C                   EXSR      SRUpdStp                                                   248683
532400200529     C                   ENDIF                                                                248683
532500200529      *                                                                                       248683
532600200529
532700200529     C                   ENDIF                                                                CSE045
532800200529     C                   ENDIF                                                                CSE045
532900200529
533000200529     C                   IF        (CSC011 = 'Y') AND (LIBR = S1SUPP)                         CSC011
533100200529     C                   MOVEL     TRADSX1F      CT2BFilFmt                                   CSC011
533200200529     C                   ENDIF                                                                CSC011
533300200529                                                                                              CSC011
533400200529     C/COPY WNCPYSRC,SETRADDC06
533500200529     C                   ENDSR
533600200529      *****************************************************************                       CSE045
533700200529      /EJECT                                                                                  CSE045
533800200529     C****************************************************************                        CSE045
533900200529     C*                                                              *                        CSE045
534000200529     C* UTRADSX2A - UPDATE TRADE SWIFT EXTENDED SETTLEMENT           *                        CSE045
534100200529     C*                                                              *                        CSE045
534200200529     C****************************************************************                        CSE045
534300200529     C     UTRADSX2A     BEGSR                                                                CSE045
534400200529      *                                                                                       CSE045
534500200529      ** Access Trade Extension Record                                                        CSE045
534600200529      *                                                                                       CSE045
534700200529     C     CSW003        IFEQ      'Y'                                                        CSE045
534800200529     C                   MOVEL     'A'           T2WHEN                                       CSE045
534900200529     C                   ELSE                                                                 CSE045
535000200529     C                   MOVEL     ' '           T2WHEN                                       CSE045
535100200529     C                   END                                                                  CSE045
535200200529     C     TRADSY2K      CHAIN     TRADSDD2                           99                      CSE045
535300200529      *                                                                                       248683
535400200529     C     FLAG2XA       IFNE      'Y'                                                        248683
535500200529      *                                                                                       CSE045
535600200529      ** DATABASE ERROR                                                                       CSE045
535700200529      ** IF INSERT, BUT RECORD PRESENT ALREADY                                                CSE045
535800200529      ** OR IF NOT INSERT, BUT NO RECORD FOUND                                                CSE045
535900200529      *                                                                                       CSE045
536000200529     C     A_CHTP        IFEQ      'I'                                                        CSE045
536100200529     C     *IN99         ANDEQ     '0'                                                        CSE045
536200200529     C     A_CHTP        ORNE      'I'                                                        CSE045
536300200529     C     *IN99         ANDEQ     '1'                                                        CSE045
536400200529     C                   MOVEL     A_TDRF        DBKEY                                        CSE045
536500200529     C                   MOVEL     'TRADSDX2'    DBFILE                         ************  CSE045
536600200529     C                   MOVEL     '856'         DBASE                          * DBERR 856*  CSE045
536700200529     C                   EXSR      SRERR                                        ************  CSE045
536800200529     C                   ENDIF                                                                CSE045
536900200529     C                   ENDIF                                                                248683
537000200529      *                                                                                       CSE045
537100200529      ** Update with details from valid trade extension record                                CSE045
537200200529      *                                                                                       CSE045
537300200529     C                   MOVEL     SEVTRDX2A     TradX2Rec                                    CSE045
537400200529                                                                                              CSE045
537500200529     C     CSW003        IFEQ      'Y'                                                        CSE045
537600200529     C                   MOVEL     'A'           T2WHEN                                       CSE045
537700200529     C                   ELSE                                                                 CSE045
537800200529     C                   MOVEL     ' '           T2WHEN                                       CSE045
537900200529     C                   END                                                                  CSE045
538000200529      *                                                                                       CSE045
538100200529      ** Trade reference                                                                      CSE045
538200200529      *                                                                                       CSE045
538300200529     C                   MOVEL     A_TDRF        T2TDRF                                       CSE045
538400200529      *                                                                                       CSE045
538500200529      ** Update Record                                                                        CSE045
538600200529      *                                                                                       CSE045
538700200529     C                   EVAL      T2TMST = TimeStamp                                        BUG3947
538800200529     C     *IN99         IFEQ      '1'                                                        CSE045
538900200529     C                   WRITE     TRADSDD2                                                   CSE045
539000200529     C                   EVAL      FLAG2XA = 'Y'                                              248683
539100200529     C                   ELSE                                                                 CSE045
539200200529     C                   UPDATE    TRADSDD2                                                   CSE045
539300200529     C                   ENDIF                                                                CSE045
539400200529                                                                                              CSE045
539500200529     C                   ENDSR                                                                CSE045
539600200529     C****************************************************************                        CSE045
539700200529      /EJECT                                                                                  CSE045
539800200529     C****************************************************************                        CSE045
539900200529     C*                                                              *                        CSE045
540000200529     C* UTRADSX2B - UPDATE TRADE SWIFT EXTENDED SETTLEMENTS          *                        CSE045
540100200529     C*                                                              *                        CSE045
540200200529     C****************************************************************                        CSE045
540300200529     C     UTRADSX2B     BEGSR                                                                CSE045
540400200529      *                                                                                       CSE045
540500200529      ** Access Trade Extension Record                                                        CSE045
540600200529      *                                                                                       CSE045
540700200529     C                   MOVEL     'B'           T2WHEN                                       CSE045
540800200529     C     TRADSY2K      CHAIN     TRADSDD2                           99                      CSE045
540900200529     C     FLAG2XB       IFNE      'Y'                                                        248683
541000200529      *                                                                                       CSE045
541100200529      ** DATABASE ERROR                                                                       CSE045
541200200529      ** IF INSERT, BUT RECORD PRESENT ALREADY                                                CSE045
541300200529      ** OR IF NOT INSERT, BUT NO RECORD FOUND                                                CSE045
541400200529      *                                                                                       CSE045
541500200529     C     A_CHTP        IFEQ      'I'                                                        CSE045
541600200529     C     *IN99         ANDEQ     '0'                                                        CSE045
541700200529     C     A_CHTP        ORNE      'I'                                                        CSE045
541800200529     C     *IN99         ANDEQ     '1'                                                        CSE045
541900200529     C                   MOVEL     A_TDRF        DBKEY                                        CSE045
542000200529     C**********         MOVEL     'TRADSDX1'    DBFILE                         *******CSE045 248683
542100200529     C                   MOVEL     'TRADSDX2'    DBFILE                         ************  248683
542200200529     C                   MOVEL     '857'         DBASE                          * DBERR 857*  CSE045
542300200529     C                   EXSR      SRERR                                        ************  CSE045
542400200529     C                   ENDIF                                                                CSE045
542500200529     C                   ENDIF                                                                248683
542600200529      *                                                                                       CSE045
542700200529      ** If depots are different                                                              CSE045
542800200529      ** Update with details from valid trade extension 'B' record                            CSE045
542900200529      ** Else, update with 'A' details                                                        CSE045
543000200529      *                                                                                       CSE045
543100200529     C     DELF          IFNE      DELT                                                       CSE045
543200200529     C                   MOVEL     SEVTRDX2B     TradX2Rec                                    CSE045
543300200529     C                   ELSE                                                                 CSE045
543400200529     C                   MOVEL     SEVTRDX2A     TradX2Rec                                    CSE045
543500200529     C                   ENDIF                                                                CSE045
543600200529      *                                                                                       CSE045
543700200529      ** Trade reference                                                                      CSE045
543800200529      *                                                                                       CSE045
543900200529     C                   MOVEL     A_TDRF        T2TDRF                                       CSE045
544000200529     C                   MOVEL     'B'           T2WHEN                                       CSE045
544100200529      *                                                                                       CSE045
544200200529      ** Update Record                                                                        CSE045
544300200529      *                                                                                       CSE045
544400200529     C                   EVAL      T2TMST = TimeStamp                                        BUG3947
544500200529     C     *IN99         IFEQ      '1'                                                        CSE045
544600200529     C                   WRITE     TRADSDD2                                                   CSE045
544700200529     C                   EVAL      FLAG2XB = 'Y'                                              248683
544800200529     C                   ELSE                                                                 CSE045
544900200529     C                   UPDATE    TRADSDD2                                                   CSE045
545000200529     C                   ENDIF                                                                CSE045
545100200529                                                                                              CSE045
545200200529     C                   ENDSR                                                                CSE045
545300200529     C****************************************************************
545400200529     C/COPY WNCPYSRC,SETRADDC07
545500200529      ****************************************************************                        CSE039
545600200529      /EJECT                                                                                  CSE039
545700200529      ****************************************************************                        CSE039
545800200529      *                                                              *                        CSE039
545900200529      * SrMovement - Update Movement Status File                     *                        CSE039
546000200529      *                                                              *                        CSE039
546100200529      ****************************************************************                        CSE039
546200200529     C     SrMovement    BEGSR                                                                CSE039
546300200529      *                                                                                       CSE039
546400200529      ** Key list to access Movement Status file                                              CSE039
546500200529     C     KeyMove       KLIST                                                                CSE039
546600200529     C                   KFLD                    KTRRF             6                          CSE039
546700200529     C                   KFLD                    KTRTY             1                          CSE039
546800200529     C                   KFLD                    KNTDT             5 0                        CSE039
546900200529      *                                                                                       CSE039
547000200529      ** Transaction Reference                                                                CSE039
547100200529     C                   EVAL      TMTRRF = TDRF                                              CSE039
547200200529     C                   EVAL      KTRRF = TDRF                                               CSE039
547300200529      *                                                                                       CSE039
547400200529      ** Transaction Type                                                                     CSE039
547500200529     C                   EVAL      TMTRTY = 'T'                                               CSE039
547600200529     C                   EVAL      KTRTY = 'T'                                                CSE039
547700200529      *                                                                                       CSE039
547800200529      ** Notification Date                                                                    CSE039
547900200529     C                   Z-ADD     BJRDNB        TMNTDT                                       CSE039
548000200529     C                   Z-Add     BJRDNB        KNTDT                                        CSE039
548100200529      *                                                                                       CSE039
548200200529      ** Sequence Number                                                                      CSE039
548300200529     C     KeyMove       Chain     SEMVTSL0                           80                      CSE039
548400200529     C                   If        *IN80 = '1'                                                CSE039
548500200529     C                   Z-Add     1             TMSQNR                                       CSE039
548600200529     C                   Else                                                                 CSE039
548700200529     C     MV_TMSQNR     Add       1             TMSQNR                                       CSE039
548800200529     C                   EndIf                                                                CSE039
548900200529      *                                                                                       CSE039
549000200529      ** SWIFT Status Code                                                                    CSE039
549100200529     C                   Select                                                               CSE039
549200200529     C                   When      A_CHTP = 'I'                                               CSE039
549300200529     C                   Movel     'INS'         TMSWSC                                       CSE039
549400200529     C                   When      A_CHTP = 'A'                                               CSE039
549500200529     C                   Movel     'AMD'         TMSWSC                                       CSE039
549600200529     C                   When      A_CHTP = 'C'                                               CSE039
549700200529     C                   Movel     'CHG'         TMSWSC                                       CSE039
549800200529     C                   When      A_CHTP = 'D'                                               CSE039
549900200529     C                   Movel     'DEL'         TMSWSC                                       CSE039
550000200529     C                   When      A_CHTP = 'P'                                               CSE039
550100200529     C                   Movel     'APP'         TMSWSC                                       CSE039
550200200529     C                   When      A_CHTP = 'Y'                                               CSE039
550300200529     C                   Movel     'AUT'         TMSWSC                                       CSE039
550400200529     C                   EndSl                                                                CSE039
550500200529      *                                                                                       CSE039
550600200529      ** SWIFT Reason Code                                                                    CSE039
550700200529     C                   EVAL      TMSWRC = *BLANKS                                           CSE039
550800200529      *                                                                                       CSE039
550900200529      ** Narrative                                                                            CSE039
551000200529     C                   EVAL      TMNARR = *BLANKS                                           CSE039
551100200529      *                                                                                       CSE039
551200200529      ** Input Origin                                                                         CSE039
551300200529     C                   EVAL      TMINOR = 'Midas'                                           CSE039
551400200529      *                                                                                       CSE039
551500200529      ** Transaction Booking Branch                                                           CSE039
551600200529     C                   EVAL      TMTRBB = TDBA                                              CSE039
551700200529      *                                                                                       CSE039
551800200529      ** Settlement Confirmation Required                                                     CSE039
551900200529     C                   EVAL      TMSCRQ = *BLANKS                                           CSE039
552000200529      *                                                                                       CSE039
552100200529      ** Settlement Message Generated                                                         CSE039
552200200529     C                   Eval      TMSTMG = *BLANKS                                           CSE039
552300200529      *                                                                                       CSE039
552400200529      ** Settlement Sequence Number                                                           CSE039
552500200529     C                   Z-Add     *Zeros        TMSSQN                                       CSE039
552600200529      *                                                                                       CSE039
552700200529      ** Front Office Id                                                                      CSE039
552800200529     C                   Eval      TMFRNT = A_FRNT                                            CSE039
552900200529      ** Associated Front Office Id                                                           CSE039
553000200529     C                   Eval      TMAFRT = A_AFRT                                            CSE039
553100200529      ** Repair Location                                                                      CSE039
553200200529     C                   Eval      TMREPA = A_REPA                                            CSE039
553300200529      *                                                                                       CSE039
553400200529      ** Time Stamp                                                                           CSE039
553500200529     C                   Eval      TMTMST = A_TMST                                            CSE039
553600200529      *                                                                                       CSE039
553700200529      ** Last Change Type                                                                     CSE039
553800200529     C                   Eval      TMLCTP = 'I'                                               CSE039
553900200529      ** Last Change Date                                                                     CSE039
554000200529     C                   Z-ADD     BJRDNB        TMLCDT                                       CSE039
554100200529      ** User                                                                                 CSE039
554200200529     C                   EVAL      TMLCUS = PsUser                                            CSE039
554300200529      *                                                                                       CSE039
554400200529      ** From Interface:                                                                      CSE039
554500200529      *   Notification Method                                                                 CSE039
554600200529      *   Message Key                                                                         CSE039
554700200529     C     A_FRNT        CHAIN     TRADSDY3                           80                      CSE039
554800200529     C     *IN80         IFEQ      *OFF                                                       CSE039
554900200529     C                   EVAL      TMNTMT = T3NTMT                                            CSE039
555000200529     C                   EVAL      TMMSGK = T3MSGK                                            CSE039
555100200529     C                   ELSE                                                                 CSE039
555200200529     C                   EVAL      TMNTMT = *BLANKS                                           CSE039
555300200529     C                   EVAL      TMMSGK = *BLANKS                                           CSE039
555400200529     C                   ENDIF                                                                CSE039
555500200529      *                                                                                       CSE039
555600200529      *                                                                                       CSE039
555700200529      ** Output a record to the Trade Movement Status File                                    CSE039
555800200529      *                                                                                       CSE039
555900200529      *                 *********************                                                 CSE039
556000200529     C                   Write     SEMVTSD06                            99                    CSE039
556100200529      *                 *********************                                                 CSE039
556200200529      *                                                                                       CSE039
556300200529     C                   ENDSR                                                                CSE039
556400200529      *                                                                                       CSE039
556500200529      /EJECT
556600200529     C****************************************************************
556700200529     C*                                                              *
556800200529     C* CALEFRALL - Calculate Effective Reallowance                  *
556900200529     C*                                                              *
557000200529     C****************************************************************
557100200529     C     CALEFRALL     BEGSR
557200200529      *
557300200529     C                   Z-ADD     RALL          EFF_RALL         15 8
557400200529      *
557500200529      *   . if Discount
557600200529      *
557700200529     C     STBS          IFEQ      'D'
557800200529     C     RALL          ANDNE     0
557900200529     C                   Z-ADD     TDVD          ZSDATE
558000200529     C                   Z-ADD     MATY          ZEDATE
558100200529     C                   EXSR      ZDAYS
558200200529     C     RALL          MULT      ZDDAYS        ADJ_RALL         15 8
558300200529     C                   EXSR      ZDYYR
558400200529
558500200529     C     ZINTDD        IFNE      0
558600200529
558700200529     C                   DIV(H)    ZINTDD        ADJ_RALL
558800200529
558900200529     C     ADJ_RALL      IFGE      0
559000200529     C     1             SUB       ADJ_RALL      EFF_RALL
559100200529     C                   ELSE
559200200529     C                   Z-SUB     ADJ_RALL      ADJ_RALL         15 8
559300200529     C     1             SUB       ADJ_RALL      EFF_RALL
559400200529     C                   Z-SUB     EFF_RALL      EFF_RALL
559500200529     C                   END
559600200529     C*
559700200529     C                   ELSE
559800200529     C                   Z-ADD     *ZEROS        EFF_RALL
559900200529     C                   END
560000200529     C                   END
560100200529
560200200529     C                   ENDSR
560300200529     C****************************************************************
560400200529      /EJECT
560500200529     C****************************************************************
560600200529     C*                                                              *
560700200529     C* GETCSSED - GET CUSTOMER & SECURITY DETAILS                   *
560800200529     C*                                                              *
560900200529     C****************************************************************
561000200529     C     GETCSSED      BEGSR
561100200529      *
561200200529      ** ACCESS COUNTERPARTY DETAILS
561300200529      *
561400200529     C*****A_TCNR        IFNE      *ZEROS                                              208195 CSD027
561500200529     C     A_TCNR        IFNE      *BLANKS                                                    CSD027
561600200529     C                   MOVEL     A_TCNR        @SCKY
561700200529     C                   CALL      'AOSECSR0'
561800200529     C                   PARM                    @RTCD             7
561900200529     C                   PARM      '*KEY   '     @OPTN             7
562000200529     C                   PARM                    @SCKY             6
562100200529     C     SDSECS        PARM      SDSECS        DSSDY
562200200529      *
562300200529      ** DATABASE ERROR
562400200529      *
562500200529     C     @RTCD         IFNE      *BLANK
562600200529     C                   MOVEL     A_TCNR        DBKEY
562700200529     C                   MOVEL     'SDSECSPD'    DBFILE                         ************
562800200529     C                   MOVEL     '852'         DBASE                          * DBERR 008*
562900200529     C                   EXSR      SRERR                                        ************
563000200529     C                   END
563100200529     C                   ENDIF                                                                208195
563200200529
563300200529     C                   MOVEL     BFCLAS        CustClass         1
563400200529      *
563500200529      ** ACCESS SECURITY
563600200529      *
563700200529     C     A_TDSS        CHAIN     SECTYDF                            99
563800200529      *
563900200529      ** DATABASE ERROR
564000200529      *
564100200529     C     *IN99         IFEQ      '1'
564200200529     C                   MOVEL     A_TDSS        DBKEY
564300200529     C                   MOVEL     'SECTY   '    DBFILE                         ************
564400200529     C                   MOVEL     '853'         DBASE                          * DBERR 008*
564500200529     C                   EXSR      SRERR                                        ************
564600200529     C                   END
564700200529      *
564800200529      ** GET NOMINAL CURRENCY DECIMAL PLACES
564900200529      *
565000200529     C                   MOVE      NMCY          @AJCD
565100200529     C                   EXSR      AOCURR
565200200529     C                   MOVE      A6NBDP        NomCcyDec         1 0
565300200529      *
565400200529      ** ACCESS INVESTMENT TYPE
565500200529      *
565600200529     C     KLINVT        CHAIN     INVTPDF                            99
565700200529      *
565800200529      ** DATABASE ERROR
565900200529      *
566000200529     C     *IN99         IFEQ      '1'
566100200529     C                   MOVEL     NMCY          DBKEY
566200200529     C                   MOVE      SITP          DBKEY
566300200529     C                   MOVEL     'INVTP   '    DBFILE                         ************
566400200529     C                   MOVEL     '854'         DBASE                          * DBERR 008*
566500200529     C                   EXSR      SRERR                                        ************
566600200529     C                   END
566700200529     C                   ENDSR
566800200529     C****************************************************************
566900200529      /EJECT
567000200529     C****************************************************************
567100200529     C*                                                              *
567200200529     C* TRDVLBS - CALCULATE TRADE VALUE IN BASE CURRENCY             *
567300200529     C*                                                              *
567400200529     C****************************************************************
567500200529     C     TRDVLBS       BEGSR
567600200529      *
567700200529      * Convert countervalue in nominal currency to base currency
567800200529      *
567900200529     C                   CALLB     'ZCONV'
568000200529     C                   PARM      TCTR          ZAMTCI
568100200529     C                   PARM      TBCR          ZEXCH
568200200529     C                   PARM      BseCcyMDI     ZMD
568300200529     C                   PARM      NMCY          ZCCYI
568400200529     C                   PARM      BJCYCD        ZCCYO
568500200529     C                   PARM      NomCcyDec     ZCDPI
568600200529     C                   PARM      BseCcyDec     ZCDPO
568700200529     C                   PARM      *ZERO         ZAMTCO
568800200529
568900200529     C                   ENDSR
569000200529     C****************************************************************
569100200529      /EJECT
569200200529     C****************************************************************
569300200529     C*                                                              *
569400200529     C* TRDSETV - CALCULATE TRADE SETTLEMENT VALUE                   *
569500200529     C*                                                              *
569600200529     C****************************************************************
569700200529     C     TRDSETV       BEGSR
569800200529      *
569900200529      * Convert countervalue in nominal currency to settlement currency
570000200529      * (get settlement currency dec. places first)
570100200529      *
570200200529     C                   MOVE      SETC          @AJCD
570300200529     C                   EXSR      AOCURR
570400200529
570500200529     C                   CALLB     'ZCONV'
570600200529     C                   PARM      TCTR          ZAMTCI           15 0
570700200529     C                   PARM      TDER          ZEXCH            13 8
570800200529     C                   PARM      TMDI          ZMD               1
570900200529     C                   PARM      NMCY          ZCCYI             3
571000200529     C                   PARM      SETC          ZCCYO             3
571100200529     C                   PARM      NomCcyDec     ZCDPI             1 0
571200200529     C                   PARM      A6NBDP        ZCDPO             1 0
571300200529     C                   PARM      *ZERO         ZAMTCO           15 0
571400200529
571500200529     C                   ENDSR
571600200529     C****************************************************************
571700200529      /EJECT
571800200529     C****************************************************************
571900200529     C*                                                              *
572000200529     C* AOCURR - ACCESS CURRENCY DETAILS                             *
572100200529     C*                                                              *
572200200529     C****************************************************************
572300200529     C     AOCURR        BEGSR
572400200529      *
572500200529      ** Access currency details using currency.
572600200529      *
572700200529     C                   CALLB     'AOCURRR0'
572800200529     C                   PARM      '*MSG   '     @RTCD             7
572900200529     C                   PARM      '*KEY   '     @OPTN             7
573000200529     C                   PARM                    @AJCD             3
573100200529     C     SDCURR        PARM      SDCURR        DSSDY
573200200529      *
573300200529      ** DATABASE ERROR
573400200529      *
573500200529     C     @RTCD         IFNE      *BLANK
573600200529     C                   MOVEL     @AJCD         DBKEY
573700200529     C                   MOVEL     'SDCURRPD'    DBFILE                         ************
573800200529     C                   MOVEL     '855'         DBASE                          * DBERR 008*
573900200529     C                   EXSR      SRERR                                        ************
574000200529     C                   END
574100200529     C                   ENDSR
574200200529     C****************************************************************
574300200529      /EJECT
574400200529     C****************************************************************
574500200529     C*                                                              *
574600200529     C* ZCNSD - CONSIDERATION CALCULATION                            *
574700200529     C*                                                              *
574800200529     C****************************************************************
574900200529     C     ZCNSD         BEGSR
575000200529     C                   CALLB     'ZCNSD'
575100200529     C                   PARM                    ZNOML            15 0
575200200529     C                   PARM                    ZPRC             16 9
575300200529     C                   PARM                    SPBS
575400200529     C                   PARM                    NMDP
575500200529     C                   PARM      NomCcyDec     ZCDP              1 0
575600200529     C                   PARM                    ZCONS            15 0
575700200529     C                   ENDSR
575800200529     C****************************************************************
575900200529      /EJECT
576000200529     C****************************************************************
576100200529     C*                                                              *
576200200529     C* ZDAYS - CALCULATE NUMBER OF DAYS                             *
576300200529     C*                                                              *
576400200529     C****************************************************************
576500200529     C     ZDAYS         BEGSR
576600200529     C                   CALLB     'ZDAYS'
576700200529     C                   PARM                    ZSDATE            5 0
576800200529     C                   PARM                    ZEDATE            5 0
576900200529     C                   PARM                    DYBS
577000200529     C                   PARM                    ITLD
577100200529     C                   PARM                    LCPN
577200200529     C                   PARM                    IADJ
577300200529     C                   PARM                    CPNR                           149162
577400200529     C                   PARM                    MATY                           149162
577500200529     C                   PARM      MATY          NCD                            149162
577600200529     C                   PARM                    DADJN
577700200529     C                   PARM                    ZIDNAT            2 0          149162
577800200529     C                   PARM                    ZACLT             1            149162
577900200529     C                   PARM                    ACLD              1            149162
578000200529     C                   PARM                    BJDFIN
578100200529     C                   PARM      *ZERO         ZDDAYS            5 0
578200200529     C                   PARM                    ZODNAT            2 0          149162
578300200529     C                   ENDSR
578400200529     C****************************************************************
578500200529      /EJECT
578600200529     C****************************************************************
578700200529     C*                                                              *
578800200529     C* ZDDYR - CALCULATE DAYS IN THE YEAR                           *
578900200529     C*                                                              *
579000200529     C****************************************************************
579100200529     C     ZDYYR         BEGSR
579200200529     C                   CALLB     'ZDYYR'
579300200529     C                   PARM                    DYBS
579400200529     C                   PARM                    DVBS
579500200529     C                   PARM                    ISSD
579600200529     C                   PARM                    ITLD
579700200529     C                   PARM                    LCPN
579800200529     C                   PARM                    FCPN
579900200529     C                   PARM                    MATY
580000200529     C                   PARM                    IADJ
580100200529     C                   PARM                    CDArr
580200200529     C                   PARM                    CRArr
580300200529     C                   PARM                    CPNR                           149162
580400200529     C                   PARM                    DADJN             1
580500200529     C                   PARM      MATY          NCD               5 0
580600200529     C                   PARM      TDVD          ECD               5 0
580700200529     C                   PARM                    BJDFIN
580800200529     C                   PARM                    HCY1                                         CSE071
580900200529     C                   PARM                    HCY2                                         CSE071
581000200529     C                   PARM                    HCY3                                         CSE071
581100200529     C                   PARM                    HCY4                                         CSE071
581200200529     C                   PARM                    HCY5                                         CSE071
581300200529     C                   PARM                    HCY6                                         CSE071
581400200529     C                   PARM                    HCY7                                         CSE071
581500200529     C                   PARM                    HCY8                                         CSE071
581600200529     C                   PARM                    HCY9                                         CSE071
581700200529     C                   PARM                    ZINTDD            5 0
581800200529     C                   PARM                    LCDD5             5 0
581900200529     C                   ENDSR
582000200529     C****************************************************************
582100200529      /EJECT                                                                                  CSD015
582200200529      ****************************************************************                        CSD015
582300200529      * SrWatch - Perform Midas Watch List processing.               *                        CSD015
582400200529      ****************************************************************                        CSD015
582500200529                                                                                              CSD015
582600200529     C     SrWatch       BEGSR                                                                CSD015
582700200529                                                                                              CSD015
582800200529      ** Initialize First Parameter Data Structure to blanks                                  CSD015
582900200529                                                                                              CSD015
583000200529     C                   EVAL      SEFirstParm = *Blanks                                      CSD015
583100200529                                                                                              CSD015
583200200529     C                   EVAL      W4ITEM = 'SETRAD'                                          CSD015
583300200529     C                   EVAL      W4IDEN = TDRF                                              CSD015
583400200529     C                   EVAL      W4BRCH = TDBA                                              CSD015
583500200529     C                   EVAL      W4SYSM = LIBR                                              CSD015
583600200529     C                   EVAL      W4FUNT = 'TRADSD'                                          CSD015
583700200529     C                   MOVEL     TCNR          W4CNUM                                       CSD015
583800200529     C                   EVAL      W4DEN1 = TDSS                                              CSD015
583900200529     C                   EVAL      W4DEN2 = *BLANKS                                           CSD015
584000200529     C                   EVAL      W4AMT2 = *Zeros                                            CSD015
584100200529                                                                                              CSD015
584200200529      ** Access customer details file for Counter Party (Midas Report                         CSD015
584300200529      ** Name + Customer Report Town)                                                         CSD015
584400200529      ** Determine Country party type                                                         CSD015
584500200529                                                                                              CSD015
584600200529     C                   EVAL      PKey = *Blanks                                             CSD015
584700200529     C                   MOVE      TCNR          PKey                                         CSD015
584800200529                                                                                              CSD015
584900200529     C                   CALLB     'AOCUSTR0'                                                 CSD015
585000200529     C                   PARM      *BLANKS       PRtcd                                        CSD015
585100200529     C                   PARM      '*KEY'        POptn                                        CSD015
585200200529     C                   PARM                    PKey                                         CSD015
585300200529     C                   PARM      *BLANKS       PKySts                                       CSD015
585400200529     C     SDCUST        PARM      SDCUST        DSSDY                                        CSD015
585500200529     C                   EVAL      W4CUST = BBCRNM + BBCRTN                                   CSD015
585600200529                                                                                              CSD015
585700200529      ** If Concord Interface Development (CCF001) is installed                               CSD015
585800200529                                                                                              CSD015
585900200529     C                   IF        CCF001 = 'Y'                                               CSD015
586000200529     C                   IF        BBCRPC = 'Y'                                               CSD015
586100200529     C                   EVAL      W4CTYP = 'C'                                               CSD015
586200200529     C                   ELSE                                                                 CSD015
586300200529     C                   EVAL      W4CTYP = 'I'                                               CSD015
586400200529     C                   ENDIF                                                                CSD015
586500200529                                                                                              CSD015
586600200529     C                   ELSE                                                                 CSD015
586700200529                                                                                              CSD015
586800200529     C                   IF        BBLICD <> *BLANKS                                          CSD015
586900200529     C                             AND BBLICD <> W1IND1                                       CSD015
587000200529     C                             AND BBLICD <> W1IND2                                       CSD015
587100200529     C                             AND BBLICD <> W1IND3                                       CSD015
587200200529     C                             AND BBLICD <> W1IND4                                       CSD015
587300200529     C                             AND BBLICD <> W1IND5                                       CSD015
587400200529     C                   EVAL      W4CTYP = 'C'                                               CSD015
587500200529     C                   ELSE                                                                 CSD015
587600200529     C                   EVAL      W4CTYP = 'I'                                               CSD015
587700200529     C                   ENDIF                                                                CSD015
587800200529     C                   ENDIF                                                                CSD015
587900200529                                                                                              CSD015
588000200529     C                   MOVEL     TDDT          PDATE                                        CSD015
588100200529     C                   CALL      'ZACVTDATE'                                                CSD015
588200200529     C                   PARM                    PRtCd                                        CSD015
588300200529     C                   PARM                    PDATE                                        CSD015
588400200529     C                   PARM                    ConvertedDate                                CSD015
588500200529     C                   PARM                    PDummy10                                     CSD015
588600200529     C                   EVAL      W4DDAT = ConvertedDate                                     CSD015
588700200529                                                                                              CSD015
588800200529     C                   MOVEL     TDVD          PDATE                                        CSD015
588900200529     C                   CALL      'ZACVTDATE'                                                CSD015
589000200529     C                   PARM                    PRtCd                                        CSD015
589100200529     C                   PARM                    PDATE                                        CSD015
589200200529     C                   PARM                    ConvertedDate                                CSD015
589300200529     C                   PARM                    PDummy10                                     CSD015
589400200529     C                   EVAL      W4VDAT = ConvertedDate                                     CSD015
589500200529                                                                                              CSD015
589600200529     C                   CALL      'ZACVTDATE'                                                CSD015
589700200529     C                   PARM                    PRtCd                                        CSD015
589800200529     C                   PARM      *BLANKS       PDATE                                        CSD015
589900200529     C                   PARM                    ConvertedDate                                CSD015
590000200529     C                   PARM                    PDummy10                                     CSD015
590100200529     C                   EVAL      W4MDAT = ConvertedDate                                     CSD015
590200200529                                                                                              CSD015
590300200529     C                   CALL      'ZACVTAMT'                                                 CSD015
590400200529     C                   PARM                    PRtCd                                        CSD015
590500200529     C                   PARM                    TNMC                                         CSD015
590600200529     C                   PARM                    NOML                                         CSD015
590700200529     C                   PARM                    ConvertedAmt                                 CSD015
590800200529     C                   PARM                    PDummy16                                     CSD015
590900200529                                                                                              CSD015
591000200529     C                   EVAL      W4AMT1 = ConvertedAmt                                      CSD015
591100200529                                                                                              CSD015
591200200529      ** Set-up second parameter for Compliance Engine                                        CSD015
591300200529                                                                                              CSD015
591400200529     C                   EVAL      SESecondParm = *BLANKS                                     CSD015
591500200529                                                                                              CSD015
591600200529     C                   IF        PYFM <> *BLANKS                                            CSD015
591700200529     C                   IF        W3UNCF = 'Y' or WInsert = 'Y' or                           CSD015
591800200529     C                             WAmend1 = 'Y'                                              CSD015
591900200529     C                   EVAL      PINP1 = PYFM                                               CSD015
592000200529     C                   EVAL      PCCY = SETC                                                CSD015
592100200529     C                   EXSR      SRFormat                                                   CSD015
592200200529     C                   CAT       OPTAG(1):0    SeSecondParm                                 CSD015
592300200529     C                   CAT       POUT:0        SeSecondParm                                 CSD015
592400200529     C                   CAT       CLTAG(1):0    SeSecondParm                                 CSD015
592500200529     C                   ENDIF                                                                CSD015
592600200529     C                   ENDIF                                                                CSD015
592700200529                                                                                              CSD015
592800200529     C                   IF        PAYT <> *BLANKS                                            CSD015
592900200529     C                   IF        W3UNCF = 'Y' or WInsert = 'Y' or                           CSD015
593000200529     C                             WAmend2 = 'Y'                                              CSD015
593100200529     C                   EVAL      PINP1 = PAYT                                               CSD015
593200200529     C                   EVAL      PCCY = SETC                                                CSD015
593300200529     C                   EXSR      SRFormat                                                   CSD015
593400200529     C                   CAT       OPTAG(2):0    SeSecondParm                                 CSD015
593500200529     C                   CAT       POUT:0        SeSecondParm                                 CSD015
593600200529     C                   CAT       CLTAG(2):0    SeSecondParm                                 CSD015
593700200529     C                   ENDIF                                                                CSD015
593800200529     C                   ENDIF                                                                CSD015
593900200529                                                                                              CSD015
594000200529     C                   IF        TDFA <> *BLANKS                                            CSD015
594100200529     C                   IF        W3UNCF = 'Y' or WInsert = 'Y' or                           CSD015
594200200529     C                             WAmend3 = 'Y'                                              CSD015
594300200529     C                   EVAL      PINP1 = TDFA                                               CSD015
594400200529     C                   EXSR      SRFormat                                                   CSD015
594500200529     C                   CAT       OPTAG(3):0    SeSecondParm                                 CSD015
594600200529     C                   CAT       POUT:0        SeSecondParm                                 CSD015
594700200529     C                   CAT       CLTAG(3):0    SeSecondParm                                 CSD015
594800200529     C                   ENDIF                                                                CSD015
594900200529     C                   ENDIF                                                                CSD015
595000200529                                                                                              CSD015
595100200529     C**********         IF        DELT <> *Zeros                                      CSD015 CSD027
595200200529     C                   IF        DELT <> *Blanks                                            CSD027
595300200529     C                   IF        W3UNCF = 'Y' or WInsert = 'Y' or                           CSD015
595400200529     C                             WAmend4 = 'Y'                                              CSD015
595500200529     C                   MOVEL     DELT          PINP1                                        CSD015
595600200529     C                   EXSR      SRFormat                                                   CSD015
595700200529     C                   CAT       OPTAG(4):0    SeSecondParm                                 CSD015
595800200529     C                   CAT       POUT:0        SeSecondParm                                 CSD015
595900200529     C                   CAT       CLTAG(4):0    SeSecondParm                                 CSD015
596000200529     C                   ENDIF                                                                CSD015
596100200529     C                   ENDIF                                                                CSD015
596200200529                                                                                              CSD015
596300200529     C                   IF        DTFA <> *BLANKS                                            CSD015
596400200529     C                   IF        W3UNCF = 'Y' or WInsert = 'Y' or                           CSD015
596500200529     C                             WAmend5 = 'Y'                                              CSD015
596600200529     C                   EVAL      PINP1 = DTFA                                               CSD015
596700200529     C                   EXSR      SRFormat                                                   CSD015
596800200529     C                   EXSR      SRFormat                                                   CSD015
596900200529     C                   CAT       OPTAG(5):0    SeSecondParm                                 CSD015
597000200529     C                   CAT       POUT:0        SeSecondParm                                 CSD015
597100200529     C                   CAT       CLTAG(5):0    SeSecondParm                                 CSD015
597200200529     C                   ENDIF                                                                CSD015
597300200529     C                   ENDIF                                                                CSD015
597400200529                                                                                              CSD015
597500200529     C**********         IF        DELF <> *Zeros                                      CSD015 CSD027
597600200529     C                   IF        DELF <> *Blanks                                            CSD027
597700200529     C                   IF        W3UNCF = 'Y' or WInsert = 'Y' or                           CSD015
597800200529     C                             WAmend6 = 'Y'                                              CSD015
597900200529     C                   MOVEL     DELT          PINP1                                        CSD015
598000200529     C                   EXSR      SRFormat                                                   CSD015
598100200529     C                   CAT       OPTAG(6):0    SeSecondParm                                 CSD015
598200200529     C                   CAT       POUT:0        SeSecondParm                                 CSD015
598300200529     C                   CAT       CLTAG(6):0    SeSecondParm                                 CSD015
598400200529     C                   ENDIF                                                                CSD015
598500200529     C                   ENDIF                                                                CSD015
598600200529                                                                                              CSD015
598700200529     C                   IF        DFFA <> *BLANKS                                            CSD015
598800200529     C                   IF        W3UNCF = 'Y' or WInsert = 'Y' or                           CSD015
598900200529     C                             WAmend7 = 'Y'                                              CSD015
599000200529     C                   EVAL      PINP1 = DFFA                                               CSD015
599100200529     C                   EXSR      SRFormat                                                   CSD015
599200200529     C                   CAT       OPTAG(7):0    SeSecondParm                                 CSD015
599300200529     C                   CAT       POUT:0        SeSecondParm                                 CSD015
599400200529     C                   CAT       CLTAG(7):0    SeSecondParm                                 CSD015
599500200529     C                   ENDIF                                                                CSD015
599600200529     C                   ENDIF                                                                CSD015
599700200529                                                                                              CSD015
599800200529     C                   IF        W3UNCF = 'Y' and WInsert = 'N'                             CSD015
599900200529     C                   EVAL      WTradeRef = TDRF                                           CSD015
600000200529     C                   EVAL      WToFromInd = *Blanks                                       CSD015
600100200529                                                                                              CSD015
600200200529     C     WTradeRef     CHAIN     TRADSDY2                                                   CSD015
600300200529                                                                                              CSD015
600400200529     C                   IF        %FOUND(TRADSDY2)                                           CSD015
600500200529     C                   EXSR      SRExtDetails                                               CSD015
600600200529     C                   ENDIF                                                                CSD015
600700200529     C                   ENDIF                                                                CSD015
600800200529                                                                                              CSD015
600900200529     C                   IF        PMCWL <> *Blanks                                           CSD015
601000200529     C                   CAT       PMCWL:0       SeSecondParm                                 CSD015
601100200529     C                   ENDIF                                                                CSD015
601200200529                                                                                              CSD015
601300200529      ** Send transaction details to Compliance Watch                                         CSD015
601400200529                                                                                              CSD015
601500200529     C                   CALL      'SDCWLCHK'                                                 CSD015
601600200529     C                   PARM                    SEFirstParm                                  CSD015
601700200529     C                   PARM                    SESecondParm                                 CSD015
601800200529                                                                                              CSD015
601900200529     C                   ENDSR                                                                CSD015
602000200529                                                                                              CSD015
602100200529      *****************************************************************                       CSD015
602200200529      /EJECT                                                                                  CSD015
602300200529      *****************************************************************                       CSD015
602400200529      *  SRFormat - Converts watch list field to Customer Name and    *                       CSD015
602500200529      *             Address                                           *                       CSD015
602600200529      *                                                               *                       CSD015
602700200529      *  Called by : SRWatch                                          *                       CSD015
602800200529      *  Calls     :                                                  *                       CSD015
602900200529      *****************************************************************                       CSD015
603000200529                                                                                              CSD015
603100200529     C     SRFormat      BEGSR                                                                CSD015
603200200529                                                                                              CSD015
603300200529     C                   CALL      'SDCWLFMT'                                                 CSD015
603400200529     C                   PARM                    PRtcd                                        CSD015
603500200529     C                   PARM                    PINP1                                        CSD015
603600200529     C                   PARM                    PINP2                                        CSD015
603700200529     C                   PARM                    PINP3                                        CSD015
603800200529     C                   PARM                    PINP4                                        CSD015
603900200529     C                   PARM                    PINP5                                        CSD015
604000200529     C                   PARM                    PINP6                                        CSD015
604100200529     C                   PARM                    PCCY                                         CSD015
604200200529     C                   PARM                    POUT                                         CSD015
604300200529     C                   PARM                    PCUST                                        CSD015
604400200529                                                                                              CSD015
604500200529      ** Initialize to blanks the input parameters.                                           CSD015
604600200529                                                                                              CSD015
604700200529     C                   EVAL      PINP1 = *Blanks                                            CSD015
604800200529     C                   EVAL      PINP2 = *Blanks                                            CSD015
604900200529     C                   EVAL      PINP3 = *Blanks                                            CSD015
605000200529     C                   EVAL      PINP4 = *Blanks                                            CSD015
605100200529     C                   EVAL      PINP5 = *Blanks                                            CSD015
605200200529     C                   EVAL      PINP6 = *Blanks                                            CSD015
605300200529                                                                                              CSD015
605400200529     C                   ENDSR                                                                CSD015
605500200529                                                                                              CSD015
605600200529      ****************************************************************                        CSD015
605700200529      /EJECT                                                                                  CSD015
605800200529      *****************************************************************                       CSD015
605900200529      *  SRCheck - Checks if Watch list has changed or not blanks     *                       CSD015
606000200529      *                                                               *                       CSD015
606100200529      *  Called by : INSERT, AMEND, CHANGE                            *                       CSD015
606200200529      *  Calls     :                                                  *                       CSD015
606300200529      *****************************************************************                       CSD015
606400200529                                                                                              CSD015
606500200529     C     SRCheck       BEGSR                                                                CSD015
606600200529                                                                                              CSD015
606700200529      ** Check if any of the fields is not blank                                              CSD015
606800200529                                                                                              CSD015
606900200529     C                   EVAL      WNotBlank = 'N'                                            CSD015
607000200529     C                   IF        (PYFM <> *Blanks or PAYT <> *Blanks or                     CSD015
607100200529     C**********                   TDFA <> *Blanks or DELT <> *Zeros or                CSD015 CSD027
607200200529     C**********                   DTFA <> *Blanks or DELF <> *Zeros or                CSD015 CSD027
607300200529     C                             TDFA <> *Blanks or DELT <> *Blanks or                      CSD027
607400200529     C                             DTFA <> *Blanks or DELF <> *Blanks or                      CSD027
607500200529     C                             DFFA <> *Blanks)                                           CSD015
607600200529     C                   EVAL      WNotBlank = 'Y'                                            CSD015
607700200529     C                   ENDIF                                                                CSD015
607800200529                                                                                              CSD015
607900200529     C                   IF        PMCWL <> *Blanks                                           CSD015
608000200529     C                   EVAL      WNotBlank = 'Y'                                            CSD015
608100200529     C                   ENDIF                                                                CSD015
608200200529                                                                                              CSD015
608300200529      ** Check if any of the fields have changed                                              CSD015
608400200529                                                                                              CSD015
608500200529     C                   EVAL      WChanged = 'N'                                             CSD015
608600200529     C                   EVAL      WAmend1 = 'N'                                              CSD015
608700200529     C                   EVAL      WAmend2 = 'N'                                              CSD015
608800200529     C                   EVAL      WAmend3 = 'N'                                              CSD015
608900200529     C                   EVAL      WAmend4 = 'N'                                              CSD015
609000200529     C                   EVAL      WAmend5 = 'N'                                              CSD015
609100200529     C                   EVAL      WAmend6 = 'N'                                              CSD015
609200200529     C                   EVAL      WAmend7 = 'N'                                              CSD015
609300200529                                                                                              CSD015
609400200529     C                   IF        (PYFM <> CHPYFM and PYFM <> *Blanks)                       CSD015
609500200529     C                   EVAL      WChanged = 'Y'                                             CSD015
609600200529     C                   EVAL      WAmend1 = 'Y'                                              CSD015
609700200529     C                   ENDIF                                                                CSD015
609800200529                                                                                              CSD015
609900200529     C                   IF        (PAYT <> CHPAYT and PAYT <> *Blanks)                       CSD015
610000200529     C                   EVAL      WChanged = 'Y'                                             CSD015
610100200529     C                   EVAL      WAmend2 = 'Y'                                              CSD015
610200200529     C                   ENDIF                                                                CSD015
610300200529                                                                                              CSD015
610400200529     C                   IF        (TDFA <> CHTDFA and TDFA <> *Blanks)                       CSD015
610500200529     C                   EVAL      WChanged = 'Y'                                             CSD015
610600200529     C                   EVAL      WAmend3 = 'Y'                                              CSD015
610700200529     C                   ENDIF                                                                CSD015
610800200529                                                                                              CSD015
610900200529     C**********         IF        (DELT <> CHDELT and DELT <> *Zeros)                 CSD015 CSD027
611000200529     C                   IF        (DELT <> CHDELT and DELT <> *Blanks)                       CSD027
611100200529     C                   EVAL      WChanged = 'Y'                                             CSD015
611200200529     C                   EVAL      WAmend4 = 'Y'                                              CSD015
611300200529     C                   ENDIF                                                                CSD015
611400200529                                                                                              CSD015
611500200529     C                   IF        (DTFA <> CHDTFA and DTFA <> *Blanks)                       CSD015
611600200529     C                   EVAL      WChanged = 'Y'                                             CSD015
611700200529     C                   EVAL      WAmend5 = 'Y'                                              CSD015
611800200529     C                   ENDIF                                                                CSD015
611900200529                                                                                              CSD015
612000200529     C**********         IF        (DELF <> CHDELF and DELF <> *Zeros)                 CSD015 CSD027
612100200529     C                   IF        (DELF <> CHDELF and DELF <> *Blanks)                       CSD027
612200200529     C                   EVAL      WChanged = 'Y'                                             CSD015
612300200529     C                   EVAL      WAmend6 = 'Y'                                              CSD015
612400200529     C                   ENDIF                                                                CSD015
612500200529                                                                                              CSD015
612600200529     C                   IF        (DFFA <> CHDFFA and DFFA <> *Blanks)                       CSD015
612700200529     C                   EVAL      WChanged = 'Y'                                             CSD015
612800200529     C                   EVAL      WAmend7 = 'Y'                                              CSD015
612900200529     C                   ENDIF                                                                CSD015
613000200529                                                                                              CSD015
613100200529     C                   IF        PMCWL <> *Blanks                                           CSD015
613200200529     C                   EVAL      WChanged  = 'Y'                                            CSD015
613300200529     C                   ENDIF                                                                CSD015
613400200529                                                                                              CSD015
613500200529     C                   ENDSR                                                                CSD015
613600200529                                                                                              CSD015
613700200529                                                                                              CSD015
613800200529      *****************************************************************                       CSD015
613900200529      /EJECT                                                                                  CSD015
614000200529      *****************************************************************                       CSD015
614100200529      *  SRExtDetails - Format Extension Details Fields               *                       CSD015
614200200529      *                                                               *                       CSD015
614300200529      *  Called by : SRWatch                                          *                       CSD015
614400200529      *  Calls     :                                                  *                       CSD015
614500200529      *****************************************************************                       CSD015
614600200529                                                                                              CSD015
614700200529     C     SRExtDetails  BEGSR                                                                CSD015
614800200529                                                                                              CSD015
614900200529     C                   EVAL      PMCWL = *Blanks                                            CSD015
615000200529                                                                                              CSD015
615100200529     C                   IF        T2AP1N <> *Blanks                                          CSD015
615200200529     C                   EVAL      PINP1 = T2AP1N                                             CSD015
615300200529     C                   EXSR      SRFormat                                                   CSD015
615400200529     C                   CAT       OPTAG(8):0    PMCWL                                        CSD015
615500200529     C                   CAT       POUT:0        PMCWL                                        CSD015
615600200529     C                   CAT       CLTAG(8):0    PMCWL                                        CSD015
615700200529     C                   ENDIF                                                                CSD015
615800200529                                                                                              CSD015
615900200529     C                   IF        T2AFPN <> *Blanks                                          CSD015
616000200529     C                   EVAL      PINP1 = T2AFPN                                             CSD015
616100200529     C                   EXSR      SRFormat                                                   CSD015
616200200529     C                   CAT       OPTAG(9):0    PMCWL                                        CSD015
616300200529     C                   CAT       POUT:0        PMCWL                                        CSD015
616400200529     C                   CAT       CLTAG(9):0    PMCWL                                        CSD015
616500200529     C                   ENDIF                                                                CSD015
616600200529                                                                                              CSD015
616700200529     C                   IF        T2AWIN <> *Blanks                                          CSD015
616800200529     C                   EVAL      PINP1 = T2AWIN                                             CSD015
616900200529     C                   EXSR      SRFormat                                                   CSD015
617000200529     C                   CAT       OPTAG(10):0   PMCWL                                        CSD015
617100200529     C                   CAT       POUT:0        PMCWL                                        CSD015
617200200529     C                   CAT       CLTAG(10):0   PMCWL                                        CSD015
617300200529     C                   ENDIF                                                                CSD015
617400200529                                                                                              CSD015
617500200529     C                   IF        T2BOFN <> *Blanks                                          CSD015
617600200529     C                   EVAL      PINP1 = T2BOFN                                             CSD015
617700200529     C                   EXSR      SRFormat                                                   CSD015
617800200529     C                   CAT       OPTAG(11):0   PMCWL                                        CSD015
617900200529     C                   CAT       POUT:0        PMCWL                                        CSD015
618000200529     C                   CAT       CLTAG(11):0   PMCWL                                        CSD015
618100200529     C                   ENDIF                                                                CSD015
618200200529                                                                                              CSD015
618300200529     C                   IF        T2IPYN <> *Blanks                                          CSD015
618400200529     C                   EVAL      PINP1 = T2IPYN                                             CSD015
618500200529     C                   EXSR      SRFormat                                                   CSD015
618600200529     C                   CAT       OPTAG(12):0   PMCWL                                        CSD015
618700200529     C                   CAT       POUT:0        PMCWL                                        CSD015
618800200529     C                   CAT       CLTAG(12):0   PMCWL                                        CSD015
618900200529     C                   ENDIF                                                                CSD015
619000200529                                                                                              CSD015
619100200529     C                   IF        T2CTYN <> *Blanks                                          CSD015
619200200529     C                   EVAL      PINP1 = T2CTYN                                             CSD015
619300200529     C                   EXSR      SRFormat                                                   CSD015
619400200529     C                   CAT       OPTAG(13):0   PMCWL                                        CSD015
619500200529     C                   CAT       POUT:0        PMCWL                                        CSD015
619600200529     C                   CAT       CLTAG(13):0   PMCWL                                        CSD015
619700200529     C                   ENDIF                                                                CSD015
619800200529                                                                                              CSD015
619900200529     C                   IF        T2SA1N <> *Blanks                                          CSD015
620000200529     C                   EVAL      PINP1 = T2SA1N                                             CSD015
620100200529     C                   EXSR      SRFormat                                                   CSD015
620200200529     C                   CAT       OPTAG(14):0   PMCWL                                        CSD015
620300200529     C                   CAT       POUT:0        PMCWL                                        CSD015
620400200529     C                   CAT       CLTAG(14):0   PMCWL                                        CSD015
620500200529     C                   ENDIF                                                                CSD015
620600200529                                                                                              CSD015
620700200529     C                   IF        T2SKAN <> *Blanks                                          CSD015
620800200529     C                   EVAL      PINP1 = T2SKAN                                             CSD015
620900200529     C                   EXSR      SRFormat                                                   CSD015
621000200529     C                   CAT       OPTAG(15):0   PMCWL                                        CSD015
621100200529     C                   CAT       POUT:0        PMCWL                                        CSD015
621200200529     C                   CAT       CLTAG(15):0   PMCWL                                        CSD015
621300200529     C                   ENDIF                                                                CSD015
621400200529                                                                                              CSD015
621500200529     C                   IF        T2DCTL <> *Blanks                                          CSD015
621600200529     C                   EVAL      PINP1 = T2DCTL                                             CSD015
621700200529     C                   EXSR      SRFormat                                                   CSD015
621800200529     C                   CAT       OPTAG(16):0   PMCWL                                        CSD015
621900200529     C                   CAT       POUT:0        PMCWL                                        CSD015
622000200529     C                   CAT       CLTAG(16):0   PMCWL                                        CSD015
622100200529     C                   ENDIF                                                                CSD015
622200200529                                                                                              CSD015
622300200529     C                   IF        T2RSSN <> *Blanks                                          CSD015
622400200529     C                   EVAL      PINP1 = T2RSSN                                             CSD015
622500200529     C                   EXSR      SRFormat                                                   CSD015
622600200529     C                   CAT       OPTAG(17):0   PMCWL                                        CSD015
622700200529     C                   CAT       POUT:0        PMCWL                                        CSD015
622800200529     C                   CAT       CLTAG(17):0   PMCWL                                        CSD015
622900200529     C                   ENDIF                                                                CSD015
623000200529                                                                                              CSD015
623100200529     C                   IF        T2DSSN <> *Blanks                                          CSD015
623200200529     C                   EVAL      PINP1 = T2DSSN                                             CSD015
623300200529     C                   EXSR      SRFormat                                                   CSD015
623400200529     C                   CAT       OPTAG(18):0   PMCWL                                        CSD015
623500200529     C                   CAT       POUT:0        PMCWL                                        CSD015
623600200529     C                   CAT       CLTAG(18):0   PMCWL                                        CSD015
623700200529     C                   ENDIF                                                                CSD015
623800200529                                                                                              CSD015
623900200529     C                   IF        T2BSSN <> *Blanks                                          CSD015
624000200529     C                   EVAL      PINP1 = T2BSSN                                             CSD015
624100200529     C                   EXSR      SRFormat                                                   CSD015
624200200529     C                   CAT       OPTAG(19):0   PMCWL                                        CSD015
624300200529     C                   CAT       POUT:0        PMCWL                                        CSD015
624400200529     C                   CAT       CLTAG(19):0   PMCWL                                        CSD015
624500200529     C                   ENDIF                                                                CSD015
624600200529                                                                                              CSD015
624700200529     C                   IF        T2INVE <> *Blanks                                          CSD015
624800200529     C                   EVAL      PINP1 = T2INVE                                             CSD015
624900200529     C                   EXSR      SRFormat                                                   CSD015
625000200529     C                   CAT       OPTAG(20):0   PMCWL                                        CSD015
625100200529     C                   CAT       POUT:0        PMCWL                                        CSD015
625200200529     C                   CAT       CLTAG(20):0   PMCWL                                        CSD015
625300200529     C                   ENDIF                                                                CSD015
625400200529                                                                                              CSD015
625500200529      **  Settlement Party Intermediary 1-9                                                   CSD015
625600200529                                                                                              CSD015
625700200529     C                   EVAL      TEMPDS = *Blanks                                           CSD015
625800200529                                                                                              CSD015
625900200529     C                   IF        T2IMD1 <> *Blanks                                          CSD015
626000200529     C                   EVAL      PINP1 = T2IMD1                                             CSD015
626100200529     C                   EXSR      SRFormat                                                   CSD015
626200200529     C                   CAT       POUT:0        TEMPDS                                       CSD015
626300200529     C                   ENDIF                                                                CSD015
626400200529                                                                                              CSD015
626500200529     C                   IF        T2IMD2 <> *Blanks                                          CSD015
626600200529     C                   EVAL      PINP1 = T2IMD2                                             CSD015
626700200529     C                   EXSR      SRFormat                                                   CSD015
626800200529     C                   CAT       POUT:0        TEMPDS                                       CSD015
626900200529     C                   ENDIF                                                                CSD015
627000200529                                                                                              CSD015
627100200529     C                   IF        T2IMD3 <> *Blanks                                          CSD015
627200200529     C                   EVAL      PINP1 = T2IMD3                                             CSD015
627300200529     C                   EXSR      SRFormat                                                   CSD015
627400200529     C                   CAT       POUT:0        TEMPDS                                       CSD015
627500200529     C                   ENDIF                                                                CSD015
627600200529                                                                                              CSD015
627700200529     C                   IF        T2IMD4 <> *Blanks                                          CSD015
627800200529     C                   EVAL      PINP1 = T2IMD4                                             CSD015
627900200529     C                   EXSR      SRFormat                                                   CSD015
628000200529     C                   CAT       POUT:0        TEMPDS                                       CSD015
628100200529     C                   ENDIF                                                                CSD015
628200200529                                                                                              CSD015
628300200529     C                   IF        T2IMD5 <> *Blanks                                          CSD015
628400200529     C                   EVAL      PINP1 = T2IMD5                                             CSD015
628500200529     C                   EXSR      SRFormat                                                   CSD015
628600200529     C                   CAT       POUT:0        TEMPDS                                       CSD015
628700200529     C                   ENDIF                                                                CSD015
628800200529                                                                                              CSD015
628900200529     C                   IF        T2IMD6 <> *Blanks                                          CSD015
629000200529     C                   EVAL      PINP1 = T2IMD6                                             CSD015
629100200529     C                   EXSR      SRFormat                                                   CSD015
629200200529     C                   CAT       POUT:0        TEMPDS                                       CSD015
629300200529     C                   ENDIF                                                                CSD015
629400200529                                                                                              CSD015
629500200529     C                   IF        T2IMD7 <> *Blanks                                          CSD015
629600200529     C                   EVAL      PINP1 = T2IMD7                                             CSD015
629700200529     C                   EXSR      SRFormat                                                   CSD015
629800200529     C                   CAT       POUT:0        TEMPDS                                       CSD015
629900200529     C                   ENDIF                                                                CSD015
630000200529                                                                                              CSD015
630100200529     C                   IF        T2IMD8 <> *Blanks                                          CSD015
630200200529     C                   EVAL      PINP1 = T2IMD8                                             CSD015
630300200529     C                   EXSR      SRFormat                                                   CSD015
630400200529     C                   CAT       POUT:0        TEMPDS                                       CSD015
630500200529     C                   ENDIF                                                                CSD015
630600200529                                                                                              CSD015
630700200529     C                   IF        T2IMD9 <> *Blanks                                          CSD015
630800200529     C                   EVAL      PINP1 = T2IMD9                                             CSD015
630900200529     C                   EXSR      SRFormat                                                   CSD015
631000200529     C                   CAT       POUT:0        TEMPDS                                       CSD015
631100200529     C                   ENDIF                                                                CSD015
631200200529                                                                                              CSD015
631300200529     C                   IF        TEMPDS <> *Blanks                                          CSD015
631400200529     C                   CAT       OPTAG(21):0   PMCWL                                        CSD015
631500200529     C                   CAT       TEMPDS:0      PMCWL                                        CSD015
631600200529     C                   CAT       CLTAG(21):0   PMCWL                                        CSD015
631700200529     C                   ENDIF                                                                CSD015
631800200529                                                                                              CSD015
631900200529      **  Safekeeping Account Intermediary 1-9                                                CSD015
632000200529                                                                                              CSD015
632100200529     C                   EVAL      TEMPDS = *Blanks                                           CSD015
632200200529                                                                                              CSD015
632300200529     C                   IF        T2IMS1 <> *Blanks                                          CSD015
632400200529     C                   EVAL      PINP1 = T2IMS1                                             CSD015
632500200529     C                   EXSR      SRFormat                                                   CSD015
632600200529     C                   CAT       POUT:0        TEMPDS                                       CSD015
632700200529     C                   ENDIF                                                                CSD015
632800200529                                                                                              CSD015
632900200529     C                   IF        T2IMS2 <> *Blanks                                          CSD015
633000200529     C                   EVAL      PINP1 = T2IMS2                                             CSD015
633100200529     C                   EXSR      SRFormat                                                   CSD015
633200200529     C                   CAT       POUT:0        TEMPDS                                       CSD015
633300200529     C                   ENDIF                                                                CSD015
633400200529                                                                                              CSD015
633500200529     C                   IF        T2IMS3 <> *Blanks                                          CSD015
633600200529     C                   EVAL      PINP1 = T2IMS3                                             CSD015
633700200529     C                   EXSR      SRFormat                                                   CSD015
633800200529     C                   CAT       POUT:0        TEMPDS                                       CSD015
633900200529     C                   ENDIF                                                                CSD015
634000200529                                                                                              CSD015
634100200529     C                   IF        T2IMS4 <> *Blanks                                          CSD015
634200200529     C                   EVAL      PINP1 = T2IMS4                                             CSD015
634300200529     C                   EXSR      SRFormat                                                   CSD015
634400200529     C                   CAT       POUT:0        TEMPDS                                       CSD015
634500200529     C                   ENDIF                                                                CSD015
634600200529                                                                                              CSD015
634700200529     C                   IF        T2IMS5 <> *Blanks                                          CSD015
634800200529     C                   EVAL      PINP1 = T2IMS5                                             CSD015
634900200529     C                   EXSR      SRFormat                                                   CSD015
635000200529     C                   CAT       POUT:0        TEMPDS                                       CSD015
635100200529     C                   ENDIF                                                                CSD015
635200200529                                                                                              CSD015
635300200529     C                   IF        T2IMS6 <> *Blanks                                          CSD015
635400200529     C                   EVAL      PINP1 = T2IMS6                                             CSD015
635500200529     C                   EXSR      SRFormat                                                   CSD015
635600200529     C                   CAT       POUT:0        TEMPDS                                       CSD015
635700200529     C                   ENDIF                                                                CSD015
635800200529                                                                                              CSD015
635900200529     C                   IF        T2IMS7 <> *Blanks                                          CSD015
636000200529     C                   EVAL      PINP1 = T2IMS7                                             CSD015
636100200529     C                   EXSR      SRFormat                                                   CSD015
636200200529     C                   CAT       POUT:0        TEMPDS                                       CSD015
636300200529     C                   ENDIF                                                                CSD015
636400200529                                                                                              CSD015
636500200529     C                   IF        T2IMS8 <> *Blanks                                          CSD015
636600200529     C                   EVAL      PINP1 = T2IMS8                                             CSD015
636700200529     C                   EXSR      SRFormat                                                   CSD015
636800200529     C                   CAT       POUT:0        TEMPDS                                       CSD015
636900200529     C                   ENDIF                                                                CSD015
637000200529                                                                                              CSD015
637100200529     C                   IF        T2IMS9 <> *Blanks                                          CSD015
637200200529     C                   EVAL      PINP1 = T2IMS9                                             CSD015
637300200529     C                   EXSR      SRFormat                                                   CSD015
637400200529     C                   CAT       POUT:0        TEMPDS                                       CSD015
637500200529     C                   ENDIF                                                                CSD015
637600200529                                                                                              CSD015
637700200529     C                   IF        TEMPDS <> *Blanks                                          CSD015
637800200529     C                   CAT       OPTAG(22):0   PMCWL                                        CSD015
637900200529     C                   CAT       TEMPDS:0      PMCWL                                        CSD015
638000200529     C                   CAT       CLTAG(22):0   PMCWL                                        CSD015
638100200529     C                   ENDIF                                                                CSD015
638200200529                                                                                              CSD015
638300200529     C                   IF        T2DIDN <> *Blanks                                          CSW210
638400200529     C                   EVAL      PINP1 = T2DIDN                                             CSW210
638500200529     C                   EXSR      SRFormat                                                   CSW210
638600200529     C                   CAT       OPTAG(23):0   PMCWL                                        CSW210
638700200529     C                   CAT       POUT:0        PMCWL                                        CSW210
638800200529     C                   CAT       CLTAG(23):0   PMCWL                                        CSW210
638900200529     C                   ENDIF                                                                CSW210
639000200529                                                                                              CSW210
639100200529     C                   IF        T2QFIN <> *Blanks                                          CSW210
639200200529     C                   EVAL      PINP1 = T2QFIN                                             CSW210
639300200529     C                   EXSR      SRFormat                                                   CSW210
639400200529     C                   CAT       OPTAG(24):0   PMCWL                                        CSW210
639500200529     C                   CAT       POUT:0        PMCWL                                        CSW210
639600200529     C                   CAT       CLTAG(24):0   PMCWL                                        CSW210
639700200529     C                   ENDIF                                                                CSW210
639800200529                                                                                              CSW210
639900200529     C                   ENDSR                                                                CSD015
640000200529                                                                                              CSD015
640100200529      *****************************************************************                       CRE020
640200200529      /EJECT                                                                                  CRE020
640300200529      *****************************************************************                       CRE020
640400200529      *                                                               *                       CRE020
640500200529      *  SRIdxTrn - Handles the advice index of the current           *                       CRE020
640600200529      *             transaction.                                      *                       CRE020
640700200529      *                                                               *                       CRE020
640800200529      *****************************************************************                       CRE020
640900200529     C     SRIdxTrn      BEGSR                                                                CRE020
641000200529                                                                                              CRE020
641100200529     C                   EVAL      KRefNo = TDRF                                              CRE020
641200200529                                                                                              CRE020
641300200529      ** Only process authorised transactions                                                 CRE020
641400200529                                                                                              CRE020
641500200529     C                   IF        RECI = 'L' or                                              CRE020
641600200529     C                             RECI = 'P' or                                              CRE020
641700200529     C                             RECI = 'R'                                                 CRE020
641800200529                                                                                              CRE020
641900200529      ** If not authorised, set authorise indicator to 'N' if record exist                    CRE020
642000200529                                                                                              CRE020
642100200529     C                   OPEN      READVCL1                                                   CRE020
642200200529     C     KADVC         CHAIN     READVCL1                                                   CRE020
642300200529     C                   IF        %FOUND                                                     CRE020
642400200529     C                   EVAL      RAUTHI = 'N'                                               CRE020
642500200529     C                   UPDATE    READVCD0                                                   CRE020
642600200529     C                   ENDIF                                                                CRE020
642700200529     C                   CLOSE     READVCL1                                                   CRE020
642800200529     C                   LEAVESR                                                              CRE020
642900200529     C                   ENDIF                                                                CRE020
643000200529                                                                                              CRE020
643100200529      ** For amend, process changes only if their is change insettlements                     CRE020
643200200529                                                                                              CRE020
643300200529     C                   IF        A_CHTP = 'C' or                                            CRE020
643400200529     C                             A_CHTP = 'A'                                               CRE020
643500200529                                                                                              CRE020
643600200529     C     A_SMTH        IFNE      B_SMTH                                                     CRE020
643700200529     C     TDTP          OREQ      'TP'                                                       CRE020
643800200529     C     A_PYFM        ANDNE     B_PYFM                                                     CRE020
643900200529     C     TDTP          OREQ      'TS'                                                       CRE020
644000200529     C     A_PAYT        ANDNE     B_PAYT                                                     CRE020
644100200529     C     A_TDMI        ORNE      B_TDMI                                                     CRE020
644200200529     C     A_TDER        ORNE      B_TDER                                                     CRE020
644300200529     C     *IN97         OREQ      '1'                                                        CRE020
644400200529     C     A_DELT        ANDNE     B_DELT                                                     CRE020
644500200529     C     *IN99         OREQ      '1'                                                        CRE020
644600200529     C     A_DELT        ANDNE     B_DELT                                                     CRE020
644700200529     C     *IN97         OREQ      '1'                                                        CRE020
644800200529     C     A_DELF        ANDNE     B_DELF                                                     CRE020
644900200529     C     *IN99         OREQ      '1'                                                        CRE020
645000200529     C     A_DELF        ANDNE     B_DELF                                                     CRE020
645100200529     C     A_NOML        ORNE      B_NOML                                                     CRE020
645200200529     C     A_TDVD        ORNE      B_TDVD                                                     CRE020
645300200529     C                   ELSE                                                                 CRE020
645400200529     C                   LEAVESR                                                              CRE020
645500200529     C                   ENDIF                                                                CRE020
645600200529     C                   ENDIF                                                                CRE020
645700200529                                                                                              CRE020
645800200529      ** If all conditions met, continue processing                                           CRE020
645900200529                                                                                              CRE020
646000200529     C                   OPEN      READVCL1                                                   CRE020
646100200529     C     KADVC         CHAIN     READVCL1                                                   CRE020
646200200529                                                                                              CRE020
646300200529     C                   IF        NOT %FOUND                                                 CRE020
646400200529     C                   EXSR      SRChgTyp                                                   CRE020
646500200529     C                   EVAL      RREFNO = TDRF                                              CRE020
646600200529     C                   EVAL      RPRGMN = 'SETRADUPD'                                       CRE020
646700200529     C                   EVAL      RSEQNO = *BLANKS                                           CRE020
646800200529     C                   EVAL      RTRTYP = TDTP                                              CRE020
646900200529     C                   EVAL      RAUTHI = 'Y'                                               CRE020
647000200529                                                                                              CRE020
647100200529      ** If action is delete and record not existing, set record as not to process            CRE020
647200200529                                                                                              CRE020
647300200529     C                   IF        A_CHTP = 'D'                                               CRE020
647400200529     C                   EVAL      RSAPIN = 'Y'                                               CRE020
647500200529     C                   ELSE                                                                 CRE020
647600200529     C                   EVAL      RSAPIN = 'N'                                               CRE020
647700200529     C                   ENDIF                                                                CRE020
647800200529                                                                                              CRE020
647900200529     C                   EVAL      RENARR = *Blanks                                           CRE020
648000200529     C                   WRITE     READVCD0                                                   CRE020
648100200529     C                   ELSE                                                                 CRE020
648200200529                                                                                              CRE020
648300200529     C                   IF        RCHTYP = 'I' and                                           CRE020
648400200529     C                             RSAPIN = 'N'                                               CRE020
648500200529                                                                                              CRE020
648600200529     C                   IF        A_CHTP = 'D' or                                            CRE020
648700200529     C                             (A_CHTP = 'Y' and                                          CRE020
648800200529     C                              WOrgCHTP = 'D')                                           CRE020
648900200529     C                   EVAL      RCHTYP = 'D'                                               CRE020
649000200529     C                   EVAL      RAUTHI = 'Y'                                               CRE020
649100200529     C                   EVAL      RSAPIN = 'Y'                                               CRE020
649200200529     C                   UPDATE    READVCD0                                                   CRE020
649300200529     C                   CLOSE     READVCL1                                                   CRE020
649400200529     C                   LEAVESR                                                              CRE020
649500200529     C                   ELSE                                                                 CRE020
649600200529     C                   IF        A_CHTP = 'A' or                                            CRE020
649700200529     C                             A_CHTP = 'C' or                                            CRE020
649800200529     C                             (A_CHTP = 'Y' and                                          CRE020
649900200529     C                              WOrgCHTP = 'A') or                                        CRE020
650000200529     C                             (A_CHTP = 'Y' and                                          CRE020
650100200529     C                              WOrgCHTP = 'C')                                           CRE020
650200200529     C                   EVAL      RCHTYP = 'I'                                               CRE020
650300200529     C                   ELSE                                                                 CRE020
650400200529     C                   EXSR      SRChgTyp                                                   CRE020
650500200529     C                   ENDIF                                                                CRE020
650600200529     C                   ENDIF                                                                CRE020
650700200529                                                                                              CRE020
650800200529     C                   ELSE                                                                 CRE020
650900200529     C                   EXSR      SRChgTyp                                                   CRE020
651000200529     C                   ENDIF                                                                CRE020
651100200529                                                                                              CRE020
651200200529     C                   EVAL      RAUTHI = 'Y'                                               CRE020
651300200529     C                   EVAL      RSAPIN = 'N'                                               CRE020
651400200529     C                   UPDATE    READVCD0                                                   CRE020
651500200529     C                   ENDIF                                                                CRE020
651600200529                                                                                              CRE020
651700200529     C                   CLOSE     READVCL1                                                   CRE020
651800200529     C                   ENDSR                                                                CRE020
651900200529      ****************************************************************                        CRE020
652000200529      /EJECT                                                                                  CRE020
652100200529      *****************************************************************                       CRE020
652200200529      *                                                               *                       CRE020
652300200529      *  SRChgTyp - Detemine Change Type                              *                       CRE020
652400200529      *                                                               *                       CRE020
652500200529      *****************************************************************                       CRE020
652600200529     C     SRChgTyp      BEGSR                                                                CRE020
652700200529                                                                                              CRE020
652800200529      ** Change Type (RCHTYP) should be 'A', 'D' or 'I'                                       CRE020
652900200529                                                                                              CRE020
653000200529     C                   SELECT                                                               CRE020
653100200529     C                   WHEN      CHTP = 'C'                                                 CRE020
653200200529     C                   EVAL      RCHTYP = 'A'                                               CRE020
653300200529     C                   WHEN      CHTP = 'P' or                                              CRE020
653400200529     C                             CHTP = 'Y'                                                 CRE020
653500200529     C                   EVAL      RCHTYP = WOrgCHTP                                          CRE020
653600200529     C                   OTHER                                                                CRE020
653700200529     C                   EVAL      RCHTYP = CHTP                                              CRE020
653800200529     C                   ENDSL                                                                CRE020
653900200529                                                                                              CRE020
654000200529     C                   ENDSR                                                                CRE020
654100200529      ****************************************************************                        CRE020
654200200529      ****************************************************************                        CSD015
654300200529      *****************************************************************                       248683
654400200529      *                                                               *                       248683
654500200529      *  SRUpdStp - Update TimeStamp                                  *                       248683
654600200529      *                                                               *                       248683
654700200529      *****************************************************************                       248683
654800200529     C     SRUpdStp      BEGSR                                                                248683
654900200529      ** Search for records and update Time Stamp                                             248683
655000200529     C     TRADSY2K      CHAIN     TRADSDY2                                                   248683
655100200529      ** Update TimeStamp                                                                     248683
655200200529     C                   EVAL      T2TMST = TimeStamp                                         248683
655300200529      *                                                                                       248683
655400200529      ** Update Record                                                                        248683
655500200529      *                                                                                       248683
655600200529     C                   IF        %found(TRADSDY2)                                           248683
655700200529     C                   UPDATE    TRADSDD2                                                   248683
655800200529     C                   ENDIF                                                                248683
655900200529     C                   ENDSR                                                                248683
656000200529      ****************************************************************                        248683
656100200529      /EJECT
656200200529      *****************************************************************
656300200529      *                                                               *
656400200529      * *INZSR - Program Initialisation routine                       *
656500200529      *                                                               *
656600200529      * Called by: Main processing                                    *
656700200529      *                                                               *
656800200529      * Calls: None                                                   *
656900200529      *                                                               *
657000200529      *****************************************************************
657100200529     C     *INZSR        BEGSR
657200200529      *
657300200529      **  PROGRAM PARAMETERS
657400200529      *
657500200529     C     *ENTRY        PLIST
657600200529     C                   PARM                    @@RTCD            7
657700200529     C                   PARM                    SEVTRD
657800200529     C                   PARM                    SEVTRDX1A
657900200529     C                   PARM                    SEVTRDX1B
658000200529     C                   PARM                    S01401            1
658100200529     C                   PARM                    CSW003            1            154562
658200200529     C                   PARM                    CAP051            1            CAP051
658300200529     C                   PARM                    CAS006                                       CAS006
658400200529     C                   PARM                    CGL031                                       CGL031
658500200529     C                   PARM                    PMODE                                        210517
658600200529     C                   PARM                    PMCWL                                        CSD015
658700200529     C                   PARM                    SEVTRDX2A                                    CSE045
658800200529     C                   PARM                    SEVTRDX2B                                    CSE045
658900200529      *
659000200529      ** ACCESS BANK DETAILS
659100200529      *
659200200529     C                   CALLB     'AOBANKR0'
659300200529     C                   PARM      '*MSG    '    @RTCD             7
659400200529     C                   PARM      '*FIRST  '    @OPTN             7
659500200529     C     SDBANK        PARM      SDBANK        DSFDY
659600200529      *
659700200529      * DATABASE ERROR
659800200529      *
659900200529     C     @RTCD         IFNE      *BLANK
660000200529     C                   MOVEL     @OPTN         DBKEY
660100200529     C                   MOVEL     'SDBANKPD'    DBFILE                         *************
660200200529     C                   MOVEL     '900'         DBASE                          * DBERR 900 *
660300200529     C                   EXSR      SRERR                                        *************
660400200529     C                   END
660500200529      *
660600200529      ** GET BASE CURRENCY DECIMAL PLACES
660700200529      *
660800200529     C                   MOVE      BJCYCD        @AJCD
660900200529     C                   EXSR      AOCURR
661000200529     C                   MOVE      A6NBDP        BseCcyDec         1 0
661100200529     C                   MOVE      A6MDIN        BseCcyMDI         1
661200200529      *
661300200529      ** ACCESS GENERAL LEDGER DETAILS
661400200529      *
661500200529     C**********         CALLB     'AOGELRR0'                                                 CGL029
661600200529     C                   CALLB     'AOGELRR1'                                                 CGL029
661700200529     C                   PARM      '*MSG    '    @RTCD
661800200529     C                   PARM      '*FIRST  '    @OPTN
661900200529     C*****SDGELR        PARM      SDGELR        DSFDY                                        CGL029
662000200529     C     SDGELR        PARM      SDGELR        DSSDY                                        CGL029
662100200529      *
662200200529      * DATABASE ERROR
662300200529      *
662400200529     C     @RTCD         IFNE      *BLANK
662500200529     C                   MOVEL     @OPTN         DBKEY
662600200529     C                   MOVEL     'SDGELRPD'    DBFILE
662700200529     C                   MOVEL     '901'         DBASE
662800200529     C                   EXSR      SRERR
662900200529     C                   END
663000200529      *
663100200529      ** ACCESS MIDAS MODULE DETAILS
663200200529      *
663300200529     C                   CALLB     'AOMMODR0'
663400200529     C                   PARM      '*MSG    '    @RTCD
663500200529     C                   PARM      '*FIRST  '    @OPTN
663600200529     C     SDMMOD        PARM      SDMMOD        DSFDY
663700200529      *
663800200529      * DATABASE ERROR
663900200529      *
664000200529     C     @RTCD         IFNE      *BLANK
664100200529     C                   MOVEL     @OPTN         DBKEY
664200200529     C                   MOVEL     'SDMMODPD'    DBFILE
664300200529     C                   MOVEL     '902'         DBASE
664400200529     C                   EXSR      SRERR
664500200529     C                   END
664600200529      *
664700200529      ** ACCESS SECURITIES TRADING DETAILS
664800200529      *
664900200529     C                   CALLB     'AOSTRDR0'
665000200529     C                   PARM      '*MSG    '    @RTCD             7
665100200529     C                   PARM      '*FIRST  '    @OPTN             7
665200200529     C     SDSTRD        PARM      SDSTRD        DSSDY
665300200529      *
665400200529      * DATABASE ERROR
665500200529      *
665600200529     C     @RTCD         IFNE      *BLANK
665700200529     C                   MOVEL     @OPTN         DBKEY
665800200529     C                   MOVEL     'SDSTRDPD'    DBFILE                         *************
665900200529     C                   MOVEL     '903'         DBASE                          * DBERR 900 *
666000200529     C                   EXSR      SRERR                                        *************
666100200529     C                   END
666200200529      *                                                                         CAP051
666300200529     C                   MOVE      BVAUTH        SAVAUTH           2            CAP051
666400200529      *
666500200529      ** ACCESS PORTFOLIO MANAGEMENT DETAILS
666600200529      *
666700200529     C     BGPFMG        IFEQ      'Y'
666800200529     C                   CALLB     'AOPORTR0'
666900200529     C                   PARM      '*MSG    '    @RTCD             7
667000200529     C                   PARM      '*FIRST  '    @OPTN             7
667100200529     C     SDPORT        PARM      SDPORT        DSSDY
667200200529      *
667300200529      * DATABASE ERROR
667400200529      *
667500200529     C     @RTCD         IFNE      *BLANK
667600200529     C                   MOVEL     @OPTN         DBKEY
667700200529     C                   MOVEL     'SDPORTPD'    DBFILE                         *************
667800200529     C                   MOVEL     '904'         DBASE                          * DBERR 900 *
667900200529     C                   EXSR      SRERR                                        *************
668000200529     C                   END
668100200529     C                   END
668200200529     C/COPY WNCPYSRC,SETRADDC12
668300200529      **********                                                                      CAP084 BUG7029
668400200529     C******DTAARA       DEFINE                  ZMUSER                               CAP084 BUG7029
668500200529     C**********         IN        ZMUSER                                             CAP084 BUG7029
668600200529     C**********         EVAL      PSUser = PUSRID                                    CAP084 BUG7029
668700200529      **********                                                                      CAP084 BUG7029
668800200529      **********                                                                             BUG8260
668900200529      *****************************************************************                      BUG8260
669000200529      **GET*USER*DETAILS***********************************************                      BUG8260
669100200529      *****************************************************************                      BUG8260
669200200529     C*****PSUser        CHAIN     MUSER                              99                     BUG8260
669300200529      **********                                                                             BUG8260
669400200529      **DATABASE*ERROR*************************************************                      BUG8260
669500200529      **********                                                                             BUG8260
669600200529     C******IN99         IFEQ      '1'                                                       BUG8260
669700200529     C*****MUSR_RECI     ORNE      'D'                                                       BUG8260
669800200529     C**********         MOVEL     PSUser        DBKEY                                       BUG8260
669900200529     C**********         MOVEL     'MUSER'       DBFILE                                      BUG8260
670000200529     C**********         MOVEL     '905'         DBASE                                       BUG8260
670100200529     C**********         EXSR      SRERR                                                     BUG8260
670200200529     C**********         END                                                                 BUG8260
670300200529      *                                                                         CDE001
670400200529      ** Determine if Data Export for CCRM Limits is active                     CDE001
670500200529     C                   CALL      'AOSARDR0'                                   CDE001
670600200529     C                   PARM      *BLANKS       @RTCD                          CDE001
670700200529     C                   PARM      '*VERIFY'     @OPTN                          CDE001
670800200529     C                   PARM      'CDE001'      @SARD             6            CDE001
670900200529      *                                                                         CDE001
671000200529     C     @RTCD         IFEQ      *BLANK                                       CDE001
671100200529     C                   MOVEL     'Y'           CDE001            1            CDE001
671200200529     C                   ENDIF                                                  CDE001
671300200529      *                                                                         CSE023
671400200529      ** Check if enhancement 'Treaty withholding tax' is on.                   CSE023
671500200529      *                                                                         CSE023
671600200529     C                   CALLB     'AOSARDR0'                                   CSE023
671700200529     C                   PARM      *BLANKS       @RTCD                          CSE023
671800200529     C                   PARM      '*VERIFY'     @OPTN                          CSE023
671900200529     C                   PARM      'CSE023'      @SARD                          CSE023
672000200529      *                                                                         CSE023
672100200529      ** Check for Database error                                               CSE023
672200200529      *                                                                         CSE023
672300200529     C     @RTCD         IFNE      *BLANKS                                      CSE023
672400200529     C     @RTCD         ANDNE     '*NRF   '                                    CSE023
672500200529     C                   MOVEL     'CSE023'      DBKEY                          CSE023
672600200529     C                   MOVEL     'SCSARDPD'    DBFILE                         CSE023
672700200529     C                   MOVEL     '906'         DBASE                          CSE023
672800200529     C                   EXSR      SRERR                                        CSE023
672900200529     C                   ENDIF                                                  CSE023
673000200529      *                                                                         CSE023
673100200529     C     @RTCD         IFEQ      *BLANK                                       CSE023
673200200529     C                   MOVE      'Y'           CSE023            1            CSE023
673300200529     C                   ELSE                                                   CSE023
673400200529     C                   MOVE      'N'           CSE023                         CSE023
673500200529     C                   ENDIF                                                  CSE023
673600200529      *                                                                                       CSE039
673700200529      ** Check if enhancement CSE039 is on.                                                   CSE039
673800200529     C                   CALLB     'AOSARDR0'                                                 CSE039
673900200529     C                   PARM      *BLANKS       @RTCD                                        CSE039
674000200529     C                   PARM      '*VERIFY'     @OPTN                                        CSE039
674100200529     C                   PARM      'CSE039'      @SARD                                        CSE039
674200200529      *                                                                                       CSE039
674300200529      ** Check for Database error                                                             CSE039
674400200529      *                                                                                       CSE039
674500200529     C     @RTCD         IFNE      *BLANKS                                                    CSE039
674600200529     C     @RTCD         ANDNE     '*NRF   '                                                  CSE039
674700200529     C                   MOVEL     'CSE039'      DBKEY                                        CSE039
674800200529     C                   MOVEL     'SCSARDPD'    DBFILE                                       CSE039
674900200529     C                   MOVEL     '906'         DBASE                                        CSE039
675000200529     C                   EXSR      SRERR                                                      CSE039
675100200529     C                   ENDIF                                                                CSE039
675200200529      *                                                                                       CSE039
675300200529     C     @RTCD         IFEQ      *BLANK                                                     CSE039
675400200529     C                   MOVE      'Y'           CSE039            1                          CSE039
675500200529     C                   ELSE                                                                 CSE039
675600200529     C                   MOVE      'N'           CSE039                                       CSE039
675700200529     C                   ENDIF                                                                CSE039
675800200529                                                                                              CSC011
675900200529      ** Check if CSC011 is installed                                                         CSC011
676000200529                                                                                              CSC011
676100200529     C                   CALLB     'AOSARDR0'                                                 CSC011
676200200529     C                   PARM      *BLANKS       PRTCD                                        CSC011
676300200529     C                   PARM      '*VERIFY'     POPTN                                        CSC011
676400200529     C                   PARM      'CSC011'      PSARD                                        CSC011
676500200529     C     SCSARD        PARM      SCSARD        DSFDY                                        CSC011
676600200529                                                                                              CSC011
676700200529     C                   IF        PRTCD = *BLANKS                                            CSC011
676800200529     C                   EVAL      CSC011 = 'Y'                                               CSC011
676900200529     C                   IN        SC24X7                                                     CSC011
677000200529     C**********         IN        SDSTAT                                              CSC011 CSD015
677100200529                                                                                              CSC011
677200200529     C                   ELSE                                                                 CSC011
677300200529     C                   EVAL      CSC011 = 'N'                                               CSC011
677400200529     C                   IF        PRTCD <> '*NRF'                                            CSC011
677500200529     C                   EVAL      DBKEY = 'CSC011'                                           CSC011
677600200529     C                   EVAL      DBFILE = 'SCSARDPD'                                        CSC011
677700200529     C                   EVAL      DBASE = 907                                                CSC011
677800200529     C                   EXSR      SRERR                                                      CSC011
677900200529     C                   ENDIF                                                                CSC011
678000200529                                                                                              CSC011
678100200529     C                   ENDIF                                                                CSC011
678200200529                                                                                              CSC011
678300200529      ** Check if enhancement 'API Extended Settlements' is on.                               CSE045
678400200529      *                                                                                       CSE045
678500200529     C                   CALLB     'AOSARDR0'                                                 CSE045
678600200529     C                   PARM      *BLANKS       @RTCD                                        CSE045
678700200529     C                   PARM      '*VERIFY'     @OPTN                                        CSE045
678800200529     C                   PARM      'CSE045'      @SARD                                        CSE045
678900200529      *                                                                                       CSE045
679000200529      ** Check for Database error                                                             CSE045
679100200529      *                                                                                       CSE045
679200200529     C     @RTCD         IFNE      *BLANKS                                                    CSE045
679300200529     C     @RTCD         ANDNE     '*NRF   '                                                  CSE045
679400200529     C                   MOVEL     'CSE045'      DBKEY                                        CSE045
679500200529     C                   MOVEL     'SCSARDPD'    DBFILE                                       CSE045
679600200529     C                   MOVEL     '912'         DBASE                                        CSE045
679700200529     C                   EXSR      SRERR                                                      CSE045
679800200529     C                   ENDIF                                                                CSE045
679900200529      *                                                                                       CSE045
680000200529     C     @RTCD         IFEQ      *BLANK                                                     CSE045
680100200529     C                   MOVE      'Y'           CSE045            1                          CSE045
680200200529     C                   ELSE                                                                 CSE045
680300200529     C                   MOVE      'N'           CSE045                                       CSE045
680400200529     C                   ENDIF                                                                CSE045
680500200529      *                                                                                       CSE045
680600200529     C                   IN        SDSTAT                                                     CSD015
680700200529                                                                                              CSD015
680800200529      ** Check if Compliance Watch Enhancement (CSD015) is on.                                CSD015
680900200529                                                                                              CSD015
681000200529     C                   EVAL      CSD015 = 'N'                                               CSD015
681100200529                                                                                              CSD015
681200200529     C                   CALLB     'AOSARDR0'                                                 CSD015
681300200529     C                   PARM      *Blank        PRtCd                                        CSD015
681400200529     C                   PARM      '*VERIFY'     POptn                                        CSD015
681500200529     C                   PARM      'CSD015'      PSard                                        CSD015
681600200529     C     SCSARD        PARM      SCSARD        DSFDY                                        CSD015
681700200529                                                                                              CSD015
681800200529     C                   IF        (PRtCd <> *Blank) and                                      CSD015
681900200529     C                             (PRtCd <> '*NRF   ')                                       CSD015
682000200529     C                   EVAL      DBKey = 'CSD015'                                           CSD015
682100200529     C                   EVAL      DBFile = 'SCSARDPD'                                        CSD015
682200200529     C                   EVAL      DBase = 908                                                CSD015
682300200529     C                   EXSR      SrErr                                                      CSD015
682400200529     C                   ENDIF                                                                CSD015
682500200529                                                                                              CSD015
682600200529     C                   IF        PRtCd = *Blank                                             CSD015
682700200529     C                   EVAL      CSD015 = 'Y'                                               CSD015
682800200529     C                   ENDIF                                                                CSD015
682900200529                                                                                              CSD015
683000200529      ** Check if CCF001 is installed                                                         CSD015
683100200529                                                                                              CSD015
683200200529     C                   EVAL      CCF001 = 'N'                                               CSD015
683300200529                                                                                              CSD015
683400200529     C                   CALLB     'AOSARDR0'                                                 CSD015
683500200529     C                   PARM      *Blanks       PRtCd                                        CSD015
683600200529     C                   PARM      '*VERIFY'     POptn                                        CSD015
683700200529     C                   PARM      'CCF001'      PSard                                        CSD015
683800200529     C     SCSARD        PARM      SCSARD        DSFDY                                        CSD015
683900200529                                                                                              CSD015
684000200529      ** Database error                                                                       CSD015
684100200529                                                                                              CSD015
684200200529     C                   IF        (PRtCd <> *BLANKS) and                                     CSD015
684300200529     C                             (PRtCd <> '*NRF   ')                                       CSD015
684400200529     C                   EVAL      DBKEY = 'CCF001'                                           CSD015
684500200529     C                   EVAL      DBFILE = 'SCSARDPD'                                        CSD015
684600200529     C                   EVAL      DBase = 909                                                CSD015
684700200529     C                   EXSR      SrErr                                                      CSD015
684800200529     C                   ENDIF                                                                CSD015
684900200529                                                                                              CSD015
685000200529     C                   IF        PRtCd = *BLANKS                                            CSD015
685100200529     C                   EVAL      CCF001 = 'Y'                                               CSD015
685200200529     C                   ENDIF                                                                CSD015
685300200529                                                                                              CSD015
685400200529      ** Call access program AOCWCDR0 for Private Customer                                    CSD015
685500200529      ** Industry Code                                                                        CSD015
685600200529                                                                                              CSD015
685700200529     C                   IF        CSD015 = 'Y'                                               CSD015
685800200529     C                   CALL      'AOCWCDR0'                                                 CSD015
685900200529     C                   PARM      *Blanks       PRtCd                                        CSD015
686000200529     C                   PARM      '*FIRST '     POptn                                        CSD015
686100200529     C     SDCWCD        PARM      SDCWCD        DSFDY                                        CSD015
686200200529                                                                                              CSD015
686300200529      ** If no record is found on SDCWCDPD                                                    CSD015
686400200529                                                                                              CSD015
686500200529     C                   IF        PRtCd <> *BLANKS                                           CSD015
686600200529     C                   EVAL      DBKEY = '*FIRST'                                           CSD015
686700200529     C                   EVAL      DBFILE = 'SDCWCDPD'                                        CSD015
686800200529     C                   EVAL      DBase = 910                                                CSD015
686900200529     C                   EXSR      SrErr                                                      CSD015
687000200529     C                   ENDIF                                                                CSD015
687100200529                                                                                              CSD015
687200200529      ** Check if function code is being monitored by the compliance watch                    CSD015
687300200529                                                                                              CSD015
687400200529     C                   CALLB     'AOWLCCR0'                                                 CSD015
687500200529     C                   PARM      *Blanks       PRtCd                                        CSD015
687600200529     C                   PARM      '*KEY   '     POptn                                        CSD015
687700200529     C                   PARM      'SECTTRAD'    PFunc                                        CSD015
687800200529     C     SDWLCC        PARM      SDWLCC        DSFDY                                        CSD015
687900200529                                                                                              CSD015
688000200529      ** If return code not blank, then issue database errror                                 CSD015
688100200529                                                                                              CSD015
688200200529     C                   IF        PRtCd <> *Blank and                                        CSD015
688300200529     C                             (PRtCd <> '*NRF   ')                                       CSD015
688400200529     C                   EVAL      DBKey = 'SECTTRAD'                                         CSD015
688500200529     C                   EVAL      DBFile = 'SDWLCCPD'                                        CSD015
688600200529     C                   EVAL      DBase = 911                                                CSD015
688700200529     C                   EXSR      SrErr                                                      CSD015
688800200529     C                   ENDIF                                                                CSD015
688900200529     C                   ENDIF                                                                CSD015
689000200529                                                                                              CSD015
689100200529      ** Check if CRE020 is enabled.                                                          CRE020
689200200529                                                                                              CRE020
689300200529     C                   CALLB     'AOSARDR0'                                                 CRE020
689400200529     C                   PARM      *BLANKS       PRtCd                                        CRE020
689500200529     C                   PARM      '*VERIFY'     POptn                                        CRE020
689600200529     C                   PARM      'CRE020'      PSARD                                        CRE020
689700200529     C     SCSARD        PARM      SCSARD        DSFDY                                        CRE020
689800200529                                                                                              CRE020
689900200529     C                   EVAL      CRE020 = 'N'                                               CRE020
690000200529                                                                                              CRE020
690100200529     C                   IF        PRtCd = *BLANKS                                            CRE020
690200200529     C                   EVAL      CRE020 = 'Y'                                               CRE020
690300200529     C                   ELSE                                                                 CRE020
690400200529                                                                                              CRE020
690500200529     C                   IF        PRtCd <> '*NRF'                                            CRE020
690600200529     C     *LOCK         IN        LDA                                                        CRE020
690700200529     C                   EVAL      DBFile = 'SCSARDPD'                                        CRE020
690800200529     C                   EVAL      DBKey = 'CRE020'                                           CRE020
690900200529     C                   EVAL      DBase = 912                                                CRE020
691000200529     C                   OUT       LDA                                                        CRE020
691100200529     C                   EXSR      SRErr                                                      CRE020
691200200529     C                   ENDIF                                                                CRE020
691300200529                                                                                              CRE020
691400200529     C                   ENDIF                                                                CRE020
691500200529                                                                                              CRE020
691600200529      ** Check if a System Value exists for this maintenance.                                 CRE020
691700200529                                                                                              CRE020
691800200529     C                   IF        CRE020 = 'Y'                                               CRE020
691900200529                                                                                              CRE020
692000200529     C                   CALLB     'AOSVALR0'                                                 CRE020
692100200529     C                   PARM      *BLANKS       PRtCd                                        CRE020
692200200529     C                   PARM                    PSysVal01                                    CRE020
692300200529     C                   PARM                    PCurSet01                                    CRE020
692400200529     C                   PARM                    PSysVal02                                    CRE020
692500200529     C                   PARM                    PCurSet02                                    CRE020
692600200529     C                   PARM                    PSysVal03                                    CRE020
692700200529     C                   PARM                    PCurSet03                                    CRE020
692800200529     C                   PARM                    PSysVal04                                    CRE020
692900200529     C                   PARM                    PCurSet04                                    CRE020
693000200529     C                   PARM                    PSysVal05                                    CRE020
693100200529     C                   PARM                    PCurSet05                                    CRE020
693200200529     C                   PARM                    PSysVal06                                    CRE020
693300200529     C                   PARM                    PCurSet06                                    CRE020
693400200529     C                   PARM                    PSysVal07                                    CRE020
693500200529     C                   PARM                    PCurSet07                                    CRE020
693600200529     C                   PARM                    PSysVal08                                    CRE020
693700200529     C                   PARM                    PCurSet08                                    CRE020
693800200529     C                   PARM                    PSysVal09                                    CRE020
693900200529     C                   PARM                    PCurSet09                                    CRE020
694000200529     C                   PARM                    PSysVal10                                    CRE020
694100200529     C                   PARM                    PCurSet10                                    CRE020
694200200529                                                                                              CRE020
694300200529     C                   EVAL      WSysVal01 = 'N'                                            CRE020
694400200529                                                                                              CRE020
694500200529     C                   IF        PRtCd = *BLANKS                                            CRE020
694600200529     C                   MOVEL     PCurSet01     WSysVal01                                    CRE020
694700200529     C                   ELSE                                                                 CRE020
694800200529                                                                                              CRE020
694900200529     C                   IF        PRtCd <> '*NRF'                                            CRE020
695000200529     C     *LOCK         IN        LDA                                                        CRE020
695100200529     C                   EVAL      DBFile = 'SDSVALPD'                                        CRE020
695200200529     C                   EVAL      DBase = 913                                                CRE020
695300200529     C                   EVAL      DBKey = PSysVal01                                          CRE020
695400200529     C                   OUT       LDA                                                        CRE020
695500200529     C                   EXSR      SRErr                                                      CRE020
695600200529     C                   ENDIF                                                                CRE020
695700200529                                                                                              CRE020
695800200529     C                   ENDIF                                                                CRE020
695900200529                                                                                              CRE020
696000200529     C                   ENDIF                                                                CRE020
696100200529                                                                                              CSD083
696200200529      ** Check if Watch List Element (CSD083) is on                                           CSD083
696300200529                                                                                              CSD083
696400200529     C                   CALLB     'AOSARDR0'                                                 CSD083
696500200529     C                   PARM      *BLANKS       PRtCd                                        CSD083
696600200529     C                   PARM      '*VERIFY'     POptn                                        CSD083
696700200529     C                   PARM      'CSD083'      PSARD                                        CSD083
696800200529     C     SCSARD        PARM      SCSARD        DSFDY                                        CSD083
696900200529                                                                                              CSD083
697000200529     C                   IF        PRtCd <> *BLANKS AND                                       CSD083
697100200529     C                             PRtCd <> '*NRF'                                            CSD083
697200200529     C     *LOCK         IN        LDA                                                        CSD083
697300200529     C                   EVAL      DBFile = 'SCSARDPD'                                        CSD083
697400200529     C                   EVAL      DBKey = 'CSD083'                                           CSD083
697500200529     C                   EVAL      DBase = 914                                                CSD083
697600200529     C                   OUT       LDA                                                        CSD083
697700200529     C                   EXSR      SRErr                                                      CSD083
697800200529     C                   ENDIF                                                                CSD083
697900200529                                                                                              CSD083
698000200529     C                   IF        PRtCd = *BLANKS                                            CSD083
698100200529     C                   EVAL      CSD015 = 'N'                                               CSD083
698200200529     C                   ENDIF                                                                CSD083
698300200529                                                                                              CSD083
698400200529     C/COPY WNCPYSRC,SETRADDC08
698500200529     C*
698600200529     C* Define key list for file INVTP
698700200529     C*
698800200529     C     KLINVT        KLIST
698900200529     C                   KFLD                    NMCY
699000200529     C                   KFLD                    SITP
699100200529     C*
699200200529     C* Define key list for file BKPHD
699300200529     C*
699400200529     C     KLBKPH        KLIST
699500200529     C                   KFLD                    BHSC
699600200529     C                   KFLD                    BHBA
699700200529     C                   KFLD                    BHBK
699800200529     C                   KFLD                    BHMK
699900200529     C                   KFLD                    BHTV
700000200529     C*
700100200529     C* Define key list for file BKPOS
700200200529     C*
700300200529     C     KLBKPS        KLIST
700400200529     C                   KFLD                    BPSC
700500200529     C                   KFLD                    BPBA
700600200529     C                   KFLD                    BPBK
700700200529     C                   KFLD                    BPMK
700800200529     C                   KFLD                    BPTV
700900200529     C                   KFLD                    BPPD
701000200529     C*
701100200529     C* Define key list for file CPOSN
701200200529     C*
701300200529     C     KLPOSN        KLIST
701400200529     C                   KFLD                    CSBA
701500200529     C                   KFLD                    CSSC
701600200529     C                   KFLD                    CSCN
701700200529     C*
701800200529     C* Define key list for file CDEPP
701900200529     C*
702000200529     C     KLCDEP        KLIST
702100200529     C                   KFLD                    CDPA
702200200529     C                   KFLD                    CDCN
702300200529     C                   KFLD                    CDSN
702400200529     C                   KFLD                    CDPT
702500200529     C                   KFLD                    CDMK
702600200529     C*
702700200529     C* Define key list for file UDEPP
702800200529     C*
702900200529     C     KLUDEP        KLIST
703000200529     C                   KFLD                    UDBA
703100200529     C                   KFLD                    UDSN
703200200529     C                   KFLD                    UDPT
703300200529     C                   KFLD                    UDBK
703400200529     C                   KFLD                    UDMK
703500200529     C*
703600200529     C* Define key list for file SETLE
703700200529     C*
703800200529     C     KLSETT        KLIST
703900200529     C                   KFLD                    SBCA
704000200529     C                   KFLD                    STDR
704100200529     C*
704200200529     C* Define key list for file SEPCBD
704300200529     C*
704400200529     C     KLSPCB        KLIST
704500200529     C                   KFLD                    BOKC
704600200529     C                   KFLD                    BRCA
704700200529     C                   KFLD                    SESN
704800200529     C                   KFLD                    MKTI
704900200529     C*
705000200529     C* Define key list for file SEPCCD
705100200529     C*
705200200529     C     KLSPCC        KLIST
705300200529     C                   KFLD                    CNUM
705400200529     C                   KFLD                    BRCA
705500200529     C                   KFLD                    SESN
705600200529     C*
705700200529     C* Define key list for file TRADSDY1
705800200529     C*
705900200529     C     TRADSY1K      KLIST
706000200529     C                   KFLD                    A_TDRF
706100200529     C                   KFLD                    T1WHEN
706200200529                                                                                              210517
706300200529      ** Define Key list for TRADSDX2 file                                                    210517
706400200529                                                                                              210517
706500200529     C     KeyTrdX2      KLIST                                                                210517
706600200529     C                   KFLD                    TDRF                                         210517
706700200529     C                   KFLD                    PScreen                                      210517
706800200529      *                                                                                       CSE045
706900200529      ** Define key list for file TRADSDY2                                                    CSE045
707000200529      *                                                                                       CSE045
707100200529     C     TRADSY2K      KLIST                                                                CSE045
707200200529     C                   KFLD                    A_TDRF                                       CSE045
707300200529     C                   KFLD                    T2WHEN                                       CSE045
707400200529     C*
707500200529      ** Parameters in chaining SDCWHTPD                                                      CSD015
707600200529                                                                                              CSD015
707700200529     C     KTradChk      KLIST                                                                CSD015
707800200529     C                   KFLD                    WFunction                                    CSD015
707900200529     C                   KFLD                    WIdentifier                                  CSD015
708000200529     C                   KFLD                    WBranch                                      CSD015
708100200529                                                                                              CSD015
708200200529     C     KExtDetl      KLIST                                                                CSD015
708300200529     C                   KFLD                    WTradeRef                                    CSD015
708400200529     C                   KFLD                    WToFromInd                                   CSD015
708500200529                                                                                              CSD015
708600200529      ** Midas RE Settled Transaction Index File Key List                                     CRE020
708700200529                                                                                              CRE020
708800200529     C     KADVC         KLIST                                                                CRE020
708900200529     C                   KFLD                    KRefNo                                       CRE020
709000200529     C                   KFLD                    KPrgMn                                       CRE020
709100200529                                                                                              CRE020
709200200529      ** Define key list for file BSPOSD (Reference:TDRF)                                   BUG12938
709300200529                                                                                            BUG12938
709400200529     C     KLPOSR        KLIST                                                              BUG12938
709500200529     C                   KFLD                    TDBA                                       BUG12938
709600200529     C                   KFLD                    TDBK                                       BUG12938
709700200529     C                   KFLD                    TDRF                                       BUG12938
709800200529      *                                                                                     BUG12938
709900200529      ** Define key list for file BSPOSD (Link:LKRF)                                        BUG12938
710000200529                                                                                            BUG12938
710100200529     C     KLPOSL        KLIST                                                              BUG12938
710200200529     C                   KFLD                    TDBA                                       BUG12938
710300200529     C                   KFLD                    TDBK                                       BUG12938
710400200529     C                   KFLD                    LKRF                                       BUG12938
710500200529      *                                                                                     BUG12938
710600200529***********************************************************************                236705 234440
710700200529     C******LIKE         DEFINE    TDBA          WBrca                                 236705 234440
710800200529     C******LIKE         DEFINE    TDSS          WSesn                                 236705 234440
710900200529     C******LIKE         DEFINE    TDTP          WType                                 236705 234440
711000200529     C******LIKE         DEFINE    NOML          WAmt                                  236705 234440
711100200529     C******LIKE         DEFINE    TDVD          WDate                                 236705 234440
711200200529     C******LIKE         DEFINE    TDVD          WrkAPDT                               236705 234440
711300200529     C******LIKE         DEFINE    ITRA          WrkCSPI                               236758 234440
711400200529     C     *LIKE         DEFINE    TMST          PTMST                                        235546
711500200529     C                   Z-ADD     *ZERO         NATN              5 0
711600200529     C*
711700200529     C                   ENDSR
711800200529     C****************************************************************
711900200529      /EJECT
712000200529     C****************************************************************
712100200529     C*                                                              *
712200200529     C* SRERR - EXCEPTION ERRORS                                     *
712300200529     C*                                                              *
712400200529     C****************************************************************
712500200529     C     SRERR         BEGSR
712600200529     C*
712700200529     C                   MOVEL     '*ERROR '     @@RTCD
712800200529     C                   MOVEL     'SETRADUPD'   DBPGM            10
712900200529     C                   MOVE      '1'           *INU7
713000200529     C                   MOVE      '1'           *INU8
713100200529     C                   MOVE      '1'           *INLR
713200200529     C                   DUMP
713300200529     C*
713400200529     C**  TERMINATE THE PROGRAM
713500200529     C*
713600200529     C                   RETURN
713700200529     C*
713800200529     C                   ENDSR
713900200529     C****************************************************************
714000200529      /EJECT
714100200529      *********************************************************************
714200200529      ** FIELD LOG
714300200529      *********************************************************************
714400200529      **                                      SET IN     SET IN
714500200529      **                                    VALIDATION    THIS    AMENDABLE
714600200529      **                                     FUNCTION   FUNCTION
714700200529      *********************************************************************
714800200529      ** Record Id                    RECI                YES       YES
714900200529      ** Trade Reference              TDRF     YES
715000200529      ** Incomplete Indicator      TR TINC     YES                  YES
715100200529      ** Security Shortname        TR TDSS     YES                  YES
715200200529      ** Counterparty Customer Number TCNR     YES                  YES
715300200529      ** Trade Type                TR TDTP     YES                  YES
715400200529      ** Nominal                      NOML     YES                  YES
715500200529      ** Nominal Currency             TNMC     YES
715600200529      ** Nominal decimal places       TNMD     YES
715700200529      ** Price/Discount/Yield         TPDY     YES                  YES
715800200529      ** Value Date                   TDVD     YES                  YES
715900200529      ** Branch code                  TDBA     YES                  YES
716000200529      ** Originating branch           ORBR     YES                  YES
716100200529      ** Book                      TR TDBK     YES                  YES
716200200529      ** Trade Date                TR TDDT     YES                  YES
716300200529      ** Trade Sub-type            TR TSUB     YES                  YES
716400200529      ** Link Reference               LKRF     YES                  YES
716500200529      ** Market Indicator             TDMI     YES                  YES
716600200529      ** Narrative                 TR TDNR     YES                  YES
716700200529      ** Trader I.D.               TR TDID     YES                  YES
716800200529      ** AIBD/IPMA                    AIIP     YES                  YES
716900200529      ** Market Centre                TMKC     YES                  YES
717000200529      ** Capacity                     TCAP     YES                  YES
717100200529      ** Accrued Indicator         TR ACIN     YES                  YES
717200200529      ** Days Adjustment              DADJ     YES                  YES
717300200529      ** Act/Diff indicator           ADIN     YES                  YES
717400200529      ** Interest Amount (Purchased)  ITRA     YES                  YES
717500200529      ** Interest Adjustment          TINA     YES                  YES
717600200529      ** Coupon Rate               TR TDCR     YES                  YES
717700200529      ** Price                     TR PRIC     YES                  YES
717800200529      ** Ex Dividend                  EXDV     YES                  YES
717900200529      ** Reallowance               TR RALL     YES                  YES
718000200529      ** Settlement Currency       TR SETC     YES                  YES
718100200529      ** Exchange Rate (Nominal to Ex TDER     YES                  YES
718200200529      ** Multiply/Divide Ind       TR TMDI     YES                  YES
718300200529      ** Base Currency Rate        TR TBCR     YES                  YES
718400200529      ** Settlement Method         TR SMTH     YES                  YES
718500200529      ** Pay From                     PYFM     YES                  YES
718600200529      ** Pay From Branch              PYFA     YES                  YES
718700200529      ** Pay To                    TR PAYT     YES                  YES
718800200529      ** Pay To Branch                PYTA     YES                  YES
718900200529      ** For Account of (Pay to)      TDFA     YES                  YES
719000200529      ** Account Sequence Number      ASNM     YES                  YES
719100200529      ** Clearance Type               CLTY     YES                  YES
719200200529      ** Deliver to                TR DELT     YES                  YES
719300200529      ** For Account of (Deliver to)  DTFA     YES                  YES
719400200529      ** Deliver From              TR DELF     YES                  YES
719500200529      ** 'For Account of-Deliver From DFFA     YES                  YES
719600200529      ** Special Instructions      TR TDSI     YES                  YES
719700200529      ** Priority Code             TR PRYC     YES                  YES
719800200529      ** Pay Code                  TR PCOD     YES                  YES
719900200529      ** Broker Commission Code       TBCC     YES                  YES
720000200529      ** Broker Commission Amount  TR TBCA     YES                  YES
720100200529      ** Customer Commission Code     TCCC     YES                  YES
720200200529      ** Customer Commission Amt   TR TCCA     YES                  YES
720300200529      ** Charges Code 1               TCC1     YES                  YES
720400200529      ** Charges Amount 1             TCA1     YES                  YES
720500200529      ** Charges Code 2               TCC2     YES                  YES
720600200529      ** Charges Amount 2             TCA2     YES                  YES
720700200529      ** Charges Code 3               TCC3     YES                  YES
720800200529      ** Charges Amount 3             TCA3     YES                  YES
720900200529      ** Charges Code 4               TCC4     YES                  YES
721000200529      ** Charges Amount 4             TCA4     YES                  YES
721100200529      ** Charges Code 5               TCC5     YES                  YES
721200200529      ** Charges amount 5             TCA5     YES                  YES
721300200529      ** Charges Code 6               TCC6     YES                  YES
721400200529      ** Charges Amount 6             TCA6     YES                  YES
721500200529      ** Charges Code 7               TCC7     YES                  YES
721600200529      ** Charges amount 7             TCA7     YES                  YES
721700200529      ** Tax amount                   TAXA     YES                  YES
721800200529      ** Broker Commission Rebate     BCMR     YES                  YES
721900200529      ** Customer Commission Rebate   CCMR     YES                  YES
722000200529      ** Tax Rebate                   TXRB     YES                  YES
722100200529      ** Bulk Reference               BLKR     YES
722200200529      ** Related Trade Reference      RTRF                YES
722300200529      ** Agency Trade Identifier      ATRD                YES
722400200529      ** Bulk Confirmation Required   BCON                YES
722500200529      ** Time of input                TIME                YES
722600200529      ** Auto-settle Indicator        AUTS     YES                  YES
722700200529      ** Accounting Indicator         TACI                YES       YES
722800200529      ** Message Indicator            TMSI                YES       YES
722900200529      ** Confirmation Required        TCFR                YES       YES
723000200529      ** Outstanding Nominal          TOSN                YES       YES
723100200529      ** Nominal Settled - not posted TNSN                YES       YES
723200200529      ** Nominal Settled - posted     TNSP                YES       YES
723300200529      ** Outstanding Value            TOSV                YES       YES
723400200529      ** Value Settled - not posted   TVSN                YES       YES
723500200529      ** Value Settled - posted       TVSP                YES       YES
723600200529      ** Discrepancy not posted       TDSN                YES       YES
723700200529      ** Discrepancy posted           TDSP                YES       YES
723800200529      ** Date Fully Settled           TDFS                YES       YES
723900200529      ** Settlement Sequence          TSSQ                YES       YES
724000200529      ** Consideration                TCSR     YES                  YES
724100200529      ** Countervalue                 TCTR     YES                  YES
724200200529      ** Date Made Complete           TDMC                YES
724300200529      ** Original Entry Date          TOED                YES
724400200529      ** Profit Centre - non PCA      PRFC     YES                  YES
724500200529      ** Pay/Receive Process Complete PRPC                YES       YES
724600200529      ** Last change date             LCD                 YES
724700200529      ** Type of last change          CHTP     YES                  YES
724800200529      ** Transact.no of last update   TNLU------------------------------
724900200529      ** Last swift sequence          LSWS                YES
725000200529      ** Current Factor               TCFC     YES                  YES
725100200529      ** Portfolio reference          PTFR     YES                  YES
725200200529      ** Exchange Rate (Settle > Port SPXR     YES                  YES
725300200529      ** Spot rate mult/div ind       SPMD     YES                  YES
725400200529      ** Book Profit Centre           BPRC     YES                  YES
725500200529      ** Trans Profit Centre          TPRC     YES                  YES
725600200529      ** FX Margin Points             FXMP     YES                  YES
725700200529      ** FX Margin Rate               FXMR     YES                  YES
725800200529      ** Margin Amount                MAMT     YES                  YES
725900200529      ** In Ccy in field 72           ICCY     YES                  YES
726000200529      ** Corporate Action Flag        COAF
726100200529      ** Withholding tax              WHTX     YES                              CSE023
726200200529**  CPY@
726300200529(c) Finastra International Limited 2001
726400200529** OPTAG - OPEN TAGS for XML                                                                  CSD015
726500200529<Pay From>                                                                                    CSD015
726600200529<Pay To>                                                                                      CSD015
726700200529<For Account of - Pay To>                                                                     CSD015
726800200529<Deliver To>                                                                                  CSD015
726900200529<For Account of - Deliver To>                                                                 CSD015
727000200529<Deliver From>                                                                                CSD015
727100200529<For Account of - Deliver From>                                                               CSD015
727200200529<MT510 A/C for Payment>                                                                       CSD015
727300200529<Account for Payment>                                                                         CSD015
727400200529<A/C with Institution>                                                                        CSD015
727500200529<Beneficiary>                                                                                 CSD015
727600200529<Instructing Party>                                                                           CSD015
727700200529<Counterparty>                                                                                CSD015
727800200529<MT510 Safekeeping A/C>                                                                       CSD015
727900200529<Safekeeping Account>                                                                         CSD015
728000200529<Deliverer Instructing Party>                                                                 CSD015
728100200529<Receivers of Securties>                                                                      CSD015
728200200529<Deliverers of Securities>                                                                    CSD015
728300200529<Beneficiary of Securities>                                                                   CSD015
728400200529<Investor>                                                                                    CSD015
728500200529<Settlement Party Intermediary>                                                               CSD015
728600200529<Safekeeping A/C Intermediary>                                                                CSD015
728700200529<Debtor>                                                                                      CSW210
728800200529<Qualified Foreign Intermediary>                                                              CSW210
728900200529** CLTAG - CLOSE TAGS for XML                                                                 CSD015
729000200529</Pay From>                                                                                   CSD015
729100200529</Pay To>                                                                                     CSD015
729200200529</For Account of - Pay To>                                                                    CSD015
729300200529</Deliver To>                                                                                 CSD015
729400200529</For Account of - Deliver To>                                                                CSD015
729500200529</Deliver From>                                                                               CSD015
729600200529</For Account of - Deliver From>                                                              CSD015
729700200529</MT510 A/C for Payment>                                                                      CSD015
729800200529</Account for Payment>                                                                        CSD015
729900200529</A/C with Institution>                                                                       CSD015
730000200529</Beneficiary>                                                                                CSD015
730100200529</Instructing Party>                                                                          CSD015
730200200529</Counterparty>                                                                               CSD015
730300200529</MT510 Safekeeping A/C>                                                                      CSD015
730400200529</Safekeeping Account>                                                                        CSD015
730500200529</Deliverer Instructing Party>                                                                CSD015
730600200529</Receivers of Securities>                                                                    CSD015
730700200529</Deliverers of Securities>                                                                   CSD015
730800200529</Beneficiary of Securities>                                                                  CSD015
730900200529</Investor>                                                                                   CSD015
731000200529</Settlement Party Intermediary>                                                              CSD015
731100200529</Safekeeping A/C Intermediary>                                                               CSD015
731200200529</Debtor>                                                                                     CSW210
731300200529</Qualified Foreign Intermediary>                                                             CSW210
731400200529**  CTDATA CMDDLY                                                                             223870
731500200529DLYJOB     DLY(10)                                                                            223870
