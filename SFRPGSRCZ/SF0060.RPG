     H        1
      *****************************************************************
/*STD *  RPGBASE                                                      *
/*EXI *  TEXT('Midas SF Password change')
     F*****************************************************************
     F*  Midas  SECURITY PROFILE FACILITY
0005 F*                                                               *
     F*  SF0060 - MIDAS USER PASSWORD CHANGE                          *
0007 F*                                                               *
     F*  Function: This program changes the users password. It is only*
     F*            run if the Universal Password Change Facility is on*
     F*                                                               *
     F*  Where Used: Input Cycle                                      *
     F*                                                               *
     F*  Called By: MIPGM                                             *
     F*                                                               *
     F*  Calls: SFC0060                                               *
     F*                                                               *
      *  (c) Finastra International Limited 2001                      *
     F*                                                               *
      *  Last Amend No. MD046248           Date 27Oct17               *
      * Bank Fusion Midas 1.4 Base -----------------------------------*
      * Midas Plus 1.4 Base 04 ---------------------------------------*
      *  Prev Amend No. CRE026             Date 24May06               *
      * Midas Plus 1.3 ----------- Base ------------------------------*
      *                 239898             Date 29May06               *
      *                 TDA035             Date 02Apr04               *
      * Midas Release 4 --------------- Base -------------------------*
      * Midas DBA 3.00 ---------------- Base -------------------------*
      *                 117981             Date 26Sep97               *
      *                 101091             Date 01Apr96               *  *
     F*                 CAAA01             DATE 08MAR95               *  *
     F*                 085650             DATE 24APR95               *
     F*                 083547             DATE 20FEB95               *
     F*                 S01486             DATE 09JUN94               *
     F*                 061921             DATE 24NOV93               *
     F*                 S01269             DATE 24JUN91               *
     F*                                                               *
     F*****************************************************************
     F*                                                               *
      *  MD046248 - Finastra Rebranding                               *
      *  CRE026 - Consumer Banking (Recompile)                        *
      *  239898 - Applied core fix BUG11032.                          *
      *  BUG11032 - Reporting About Users (Recompile)                 *
      *  TDA035 - RTS Signon changes for MidasPlus. (Recompile)       *
     F*  117981 - Unable to update 'Number of Sign On After Password  *
     F*           Change' field SOCNT because of fix 061921. Remove   *
     F*           fix and relocate the CHAIN to MUSERDD to before     *
     F*           updating  to minimize the change of Universal       *
     F*           password program updating the same MUSER record as  *
     F*           this program.                                       *
     F*  101091 - Number of sign-on is always zero. Apply GEMS        *
     F*           078309.                                             *
     F*  CAAA01 - GUI/400 development:                                *
     F*           - Recompiled over changed MUSERDD.                  *
     F*  085650 - Do not allow sign-on if unable to allocate MUSER    *
     F*           record. User details is being updated by another.   *
     F*  083547 - RECOMPILED OVER MUSERDD                             *
     F*  S01486 - RECOMPILED DUE TO CHANGED MUSER FOR PRIVATE BANKING *
     F*  061921 - Universal password change option does not work.     *
     F*           Applied fix Masoud from BSMCLIB.                    *
     F*  S01269 - RECOMPILE OVER CHANGED LF/MUSER                     *
     F*                                                               *
     F*****************************************************************
     F*  C R E A T I O N     P A R A M E T E R S                      *
     F*                                                               *
     F*                                                               *
     F*****************************************************************
     F*                 ************************
     F*                  Function of Indicators
     F*                 ************************
     F*
     F* ID F  C  H  L
     F*
     F*      10         Record not found on MUSER
     F*
     FMUSER   UF  E           K        DISK
     F*
     E*
     E                    CPY@    1   1 80
     IPSDS       SDS
     I**
     I**     Program status data structure.
     I**
     I                                      244 246 WSID
     I                                      245 246 WSID2
     I                                      244 253 SWSID
     I                                      254 263 USRID
     I*
     ILDA         DS                            256
     I**
     I**     Local data area.
     I**
     I                                      134 138 DBFILE
     I                                      139 167 DBKEY
     I                                      168 175 DBPGM
     I                                      176 1770DBASE
0276 I*
     I* DATA STRUCTURES FOR USE WITH ACCESS OBJECTS
     I*
     ISDBANK    E DSSDBANKPD
     I*
     I*
     IDSFDY     E DSDSFDY
     I* FIRST DS FOR ACCESS PROGRAMS, SHORT DATA STRUCTURE
     C                     MOVEACPY@      BIS@   80
     C*
     C***********USRID     CHAINMUSERDDF             10                   085650
     C***********USRID     CHAINMUSERDDF             1020          085650 117981
     C*                                                                   085650
     C************IN20     IFEQ '1'                                085650 117981
     C************         SETON                     LRU8          085650 117981
     C************         RETRN                                   085650 117981
     C************         ENDIF                                   085650 117981
     C*                                                                   085650
     C**N10******RECI      COMP 'D'                  1010                 117981
     C************IN10     IFEQ '0'                                       117981
     C*
     C                     CALL 'AOBANKR0'
     C                     PARM '*MSG    '@RTCD   7
     C                     PARM '*FIRST  '@OPTN   7
     C           SDBANK    PARM SDBANK    DSFDY
     C*
     C           @RTCD     IFNE *BLANK
     C                     MOVE 'SDBANKPD'DBFILE
     C                     MOVE 'SF0060  'DBPGM
     C                     Z-ADD01        DBASE            ** DBERR 01 **
     C                     DUMP
     C                     RETRN
     C                     END
     C*
     C*     END IF PASSWORD CHANGE
     C*      FACILITY NOT USED
     C*
     C           BJPCFU    IFNE 'Y'
     C                     RETRN
     C                     END
     C*                                                                   117981
     C           USRID     CHAINMUSERDDF             1020                 117981
     C*                                                                   117981
     C           *IN20     IFEQ '1'                                       117981
     C                     SETON                     LRU8                 117981
     C                     RETRN                                          117981
     C                     ELSE                                           117981
     C           *IN10     IFEQ '0'                                       117981
     C           RECI      ANDEQ'D'                                       117981
     C**
     C** INCREMENT SIGN - ON COUNT BY 1
     C**
     C***********          ADD  1         SOCNT                           061921
     C***********SOCNT     ADD  1         SOCNTX  40               061921 117981
     C                     ADD  1         SOCNT                           101091
     C***********SOCNT     IFGE BJPCFQ                                    061921
     C***********SOCNTX    IFGE BJPCFQ                             061921 117981
     C           SOCNT     IFGE BJPCFQ                                    117981
     C*
     C                     CALL 'SFC0060'
     C**
     C** RESET SIGN ON COUNT TO 0
     C**
     C                     Z-ADD0         SOCNT
     C                     MOVE BJRDNB    LPWD
     C                     TIME           TIME1   60
     C                     MOVE TIME1     LPWT
     C                     END
     C                     UPDATMUSERDDF
     C*
     C                     END
     C*                                                                   117981
     C                     END                                            117981
     C                     SETON                     LR
     C*
** CPY@   **      OBJECT COPYRIGHT
(c) Finastra International Limited 2001
