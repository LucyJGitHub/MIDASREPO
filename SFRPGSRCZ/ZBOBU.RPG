     H        1
      *****************************************************************
/*STD *  RPGBASE                                                      *
/*EXI *  TEXT('Midas SF Validate originating branch/user')
      *****************************************************************
      *                                                               *
      *  Midas  SECURITY PROFILE FACILITY
      *                                                               *
      *   ZBOBU  - TO VALIDATE THAT THE USER IS AUTHORISED TO         *
      *            AN ORIGINATING BRANCH                              *
      *                                                               *
      *  Function: This program checks that the user is authorised    *
      *            to an Originating Branch. It's called in batch     *
      *            mode only.                                         *
      *            A parameter is passed back to the calling program  *
      *            to indicate validity :                             *
      *            0 - all valid                                      *
      *            1 - no valid originating branches found for user   *
      *            2 - user is not authorised to this originating     *
      *                branch                                         *
      *                                                               *
      *  Where Used: Input Cycle, multibranch environment             *
      *                                                               *
      *  Called By: Any program requiring this validation             *
      *                                                               *
      *  Calls: None                                                  *
      *                                                               *
      *  (c) Misys International Banking Systems Ltd. 2001            *
      *                                                               *
      *  Any changes made to this program may also need to be         *
      *  incorporated in ZVOBU.                                       *
      *                                                               *
      * Bank Fusion Midas 1.4 Base -----------------------------------*
      * Midas Plus 1.4 Base 04 ---------------------------------------*
      * Midas Plus 1.4 Base ------------------------------------------*
      * Midas Plus 1.3 ----------- Base ------------------------------*
      * Midas Release 4.01.02 ----------------------------------------*
      *  Last Amend No. 197434             Date 09Oct01               *
      * Midas Release 4 --------------- Base -------------------------*
      * Midas DBA 3.00 ---------------- Base -------------------------*
      *  Prev Amend No. CLE004 *CREATE     Date 27May97               *
      *                                                               *
      *---------------------------------------------------------------*
      *                                                               *
      *  197434 - Array index error on SF0021. Increase maximum       *
      *           number of branches from 100 to 900.                 *
      *  CLE004 - Syndications & Authorisations                       *
      *                                                               *
      ********************************************************************
      *                                                               *
     FMBROS   IF  E           K        DISK
      *****************************************************************
      *
      * ID F  C  H  L     FUNCTION OF INDICATORS
      *
      *       01       OPEN FILE
      *       99       NO VALID ORIGINATING BRANCHES FOUND
      *
      *****************************************************************
      *       INPUTS TO THIS PROGRAMME
      *
      *       BRANCH CODE 3A  FROM THE CALLING PROGRAMME
      *       USER ID    10A  FROM THE CALLING PROGRAM                 ER
      *
      *****************************************************************
      *       OUTPUT FROM THIS PROGRAMME
      *
      *       ERROR CODE : 0 = NO ERROR
      *                    1 = NO VALID ORIGINATING BRANCHES FOUND FOR USER
      *                    2 = THIS BRANCH CODE NOT VALID FOR USER
      *
      *****************************************************************
     E**********          ZOB       100  3               STORAGE ARRAY                        197434
     E                    ZOB       900  3               STORAGE ARRAY                        197434
      **
     C           *ENTRY    PLIST
     C                     PARM           ZOBRX   3        BRANCH CODE 3A
     C                     PARM           USRID  10        USER ID
     C                     PARM           ERR     10       ERROR CODE 1S
      *
     C                     Z-ADD0         ERR
     C                     SETOF                       99
      *
      *****************************************************************
      **  IF FIRST ROUND MOVE ZOBU INFO INTO ARRAY
      *
     C           *IN01     IFEQ '0'                        B01
      **
     C                     SETON                     01    1SR ROUND IND
      *
     C                     EXSR ZSPFO
      *
     C                     END
      *****************************************************************
      *
      * IF NO ENTRIES ON ZOBU SET ERROR CONDITION TO 1
      *
     C           W         IFEQ 0
     C                     Z-ADD1         ERR
      *
      * AT LEAST ONE ENTRY IS ON ZOBU
      *
     C                     ELSE
      *
      * INPUTED BRANCH NOT ON ZOBU
      *
     C           ZOBRX     LOKUPZOB                      99
      *
     C           *IN99     IFEQ '0'
     C                     Z-ADD2         ERR
     C                     END
      *
     C                     END
      *
     C                     RETRN
      *****************************************************************
      **  P/ZSPFO STD SR TO MAKE SPF USER/ORIG.BRS AVAILABLE TO PGM
      **    INPUT FROM FILE MBROS- ZOB1 & 2,UP TO 100 BRANCHES,TOP DOWN
      **                           ZINO,INDEX OF LOWEST ENTRY FOR ARRAY
      **    OUTPUT - ZOB  ARRAY, TOP DOWN
      **             W, EQ ZIN
      *****************************************************************
     C           ZSPFO     BEGSR                           **  ZSPFO **
      **
     C           USRID     CHAINMBROSDDF             21
     C  N21      RECI      COMP 'D'                  2121
     C**N21***** VBRA      COMP *BLANK                   21                                   197434
     C  N21      VBRX      COMP *BLANK                   21                                   197434
      **
     C           *IN21     IFEQ '1'
     C                     MOVE '000'     NOBR
     C**********           MOVE *BLANK    VBRA                                                197434
     C                     MOVE *BLANK    VBRX                                                197434
     C                     END
      **
     C**********           MOVEAVBRA      ZOB,1                                               197434
     C                     MOVEAVBRX      ZOB,1                                               197434
     C                     MOVE NOBR      W       30
     C                     ENDSR
      ********************************************************************
