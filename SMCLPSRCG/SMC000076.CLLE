/*********************************************************************/
/*STD    CLPBASEBND                                                  */
/*EXI    TEXT('Midas SM Update global System Values')                */
/*********************************************************************/
/*                                                                   */
/*       Midas - Implementation module                               */
/*                                                                   */
/*       SMC000076 - Update global System Values                     */
/*                                                                   */
/*       (c) Finastra International Limited 2010                     */
/*                                                                   */
/*       Last Amend No. MD056103           Date 19Jun20              */
/*       Prev Amend No. MD054605           Date 17Oct19              */
/*                      MD046248           Date 27Oct17              */
/*                      BUG28074           Date 26Aug10              */
/*                      BUG28037           Date 17Aug10              */
/*                      BUG27957  *CREATE  Date 30Jul10              */
/*                                                                   */
/*-------------------------------------------------------------------*/
/*                                                                   */
/*       MD056103 - Make sure correct table is updated               */
/*       MD054605 - Deliverable Data Split for SDSVALPD              */
/*       MD046248 - Finastra Rebranding                              */
/*       BUG28074 - Correct placement of override.                   */
/*       BUG28037 - Handle IASP.                                     */
/*       B27957 - Standardise update of System Values.               */
/*                                                                   */
/*********************************************************************/
             PGM        PARM(&GPSBSID)

             DCL        VAR(&GPSBSID) TYPE(*CHAR) LEN(2)
             DCL        VAR(&SYSVAL) TYPE(*CHAR) LEN(20)
             DCL        VAR(&GVLIB) TYPE(*CHAR) LEN(10)
             DCL        VAR(&GMLIB) TYPE(*CHAR) LEN(10)                                 /*MD056103*/
             DCL        VAR(&SYSVALVAL) TYPE(*CHAR) LEN(200)
             DCL        VAR(&SYSVALVAL1) TYPE(*CHAR) LEN(200)                           /*BUG28037*/
             DCL        VAR(&SYSVALVAL2) TYPE(*CHAR) LEN(200)                           /*BUG28037*/
             DCL        VAR(&SYSVALVAL3) TYPE(*CHAR) LEN(200)                           /*BUG28037*/
             DCL        VAR(&SYSVAL1) TYPE(*CHAR) LEN(20)                               /*BUG28037*/
             DCL        VAR(&SYSVAL2) TYPE(*CHAR) LEN(20)                               /*BUG28037*/
             DCL        VAR(&SYSVAL3) TYPE(*CHAR) LEN(20)                               /*BUG28037*/
             DCL        VAR(&RTNCODE) TYPE(*CHAR) LEN(7)                                /*BUG28037*/
             DCL        VAR(&SQLSTM) TYPE(*CHAR) LEN(80)                                /*MD056103*/

             COPYRIGHT TEXT('(c) Finastra International Limited +
                          2010')

             MONMSG     MSGID(CPF0000 RPG0000 MCH0000) EXEC(GOTO +
                          CMDLBL(ERROR))

             CHGVAR     VAR(&GVLIB) VALUE(&GPSBSID *TCAT 'GVLIB')
             CHGVAR     VAR(&GMLIB) VALUE(&GPSBSID *TCAT 'GMLIB')                       /*MD056103*/
                                                                                        /*MD056103*/
/* Set up file for SQL statements. */                                                   /*MD056103*/
             DLTF       FILE(QTEMP/RUNSQLSTM)                                           /*MD056103*/
             MONMSG     MSGID(CPF0000)                                                  /*MD056103*/
             DLTF       FILE(QTEMP/RUNSQL)                                              /*MD056103*/
             MONMSG     MSGID(CPF0000)                                                  /*MD056103*/
             CRTSRCPF   FILE(QTEMP/RUNSQLSTM) RCDLEN(112) +
                          MBR(RUNSQLSTM) TEXT('Temporary source +
                          file for UTC000001')                                          /*MD056103*/
             RNMOBJ     OBJ(QTEMP/RUNSQLSTM) OBJTYPE(*FILE) +
                          NEWOBJ(RUNSQL)                                                /*MD056103*/

/* Retrieve IASP System Values. */                                                      /*BUG28074*/
             CHGVAR     VAR(&SYSVAL1) VALUE('IASPinstallation')                         /*BUG28074*/
             CHGVAR     VAR(&SYSVAL2) VALUE('IASPdatabase')                             /*BUG28074*/
             CHGVAR     VAR(&SYSVAL3) VALUE('IASPgroup')                                /*BUG28074*/
             CALL       PGM(GPAOSVALR0) PARM(&RTNCODE &SYSVAL1 +
                          &SYSVALVAL1 &SYSVAL2 &SYSVALVAL2 &SYSVAL3 +
                          &SYSVALVAL3 ' ' ' ' ' ' ' ' ' ' ' ' ' ' ' +
                          ' ' ' ' ' ' ' ' ' ' ' ' ')                                    /*BUG28074*/
             IF         COND(&RTNCODE *NE '       ') THEN(DO)                           /*BUG28074*/
                GOTO       CMDLBL(ERROR)                                                /*BUG28074*/
             ENDDO                                                                      /*BUG28074*/

/**********  OVRDBF     FILE(GPSVALL0) TOFILE(&GVLIB/GPSVALL0) */                       /*MD054605*/

/* Set up System Value GlobalJavaPathStem. */
             CHGVAR     VAR(&SYSVAL) VALUE('GlobalJavaPathStem')
             CHGVAR     VAR(&SYSVALVAL) +
                          VALUE('/QOpenSys/Misys/MidasPlus/' *TCAT +
                          &GPSBSID)
/**********  CALL       PGM(GP009510) PARM(&SYSVAL &SYSVALVAL ' ') */                   /*MD056103*/
             CHGVAR     VAR(&SQLSTM) VALUE('UPDATE ' *BCAT &GMLIB +
                        *TCAT '/GPSVLXTD set ')                                         /*MD056103*/
             CALL       PGM(UTWRTSQL) PARM(&SQLSTM '*CLEAR')                            /*MD056103*/
             CHGVAR     VAR(&SQLSTM) VALUE('GIVAL =' *TCAT '''' *TCAT &SYSVALVAL +
                        *TCAT '''' +
                        *BCAT ' where GISVAL =''GlobalJavaPathStem''' *TCAT ';')        /*MD056103*/
             CALL       PGM(UTWRTSQL) PARM(&SQLSTM '*WRITE')                            /*MD056103*/
                                                                                        /*MD056103*/

/* Update global layer prefix. */
             CHGVAR     VAR(&SYSVAL) VALUE(' ')
             CHGVAR     VAR(&SYSVALVAL) VALUE(' ')
             CHGVAR     VAR(&SYSVAL) VALUE('BrgMidasGlobalPrefix')
             CHGVAR     VAR(&SYSVALVAL) VALUE(&GPSBSID)
/**********  CALL       PGM(GP009510) PARM(&SYSVAL &SYSVALVAL ' ') */                   /*MD056103*/
             CHGVAR     VAR(&SQLSTM) VALUE('UPDATE ' *BCAT &GMLIB +
                        *TCAT '/GPSVLXTD set GIVAL =' *TCAT '''' *TCAT &SYSVALVAL +
                        *TCAT '''' +
                        *BCAT ' where GISVAL =''BrgMidasGlobalPrefix''' *TCAT ';')      /*MD056103*/
             CALL       PGM(UTWRTSQL) PARM(&SQLSTM '*WRITE')                            /*MD056103*/

             CHGVAR     VAR(&SYSVAL) VALUE(' ')
             CHGVAR     VAR(&SYSVAL) VALUE('GlobalSystemPrefix')
/**********  CALL       PGM(GP009510) PARM(&SYSVAL &SYSVALVAL ' ') */                   /*MD056103*/
             CHGVAR     VAR(&SQLSTM) VALUE(' ')                                         /*MD056103*/
             CHGVAR     VAR(&SQLSTM) VALUE('UPDATE ' *BCAT &GMLIB +
                        *TCAT '/GPSVLXTD set GIVAL =' *TCAT '''' *TCAT &SYSVALVAL +
                        *TCAT '''' +
                        *BCAT ' where GISVAL =''GlobalSystemPrefix''' *TCAT ';')        /*MD056103*/
             CALL       PGM(UTWRTSQL) PARM(&SQLSTM '*WRITE')                            /*MD056103*/

/* Update IASP values. */                                                               /*BUG28037*/
/**********  CHGVAR     VAR(&SYSVAL1) VALUE('IASPinstallation')         */ /*BUG28037*/ /*BUG28074*/
/**********  CHGVAR     VAR(&SYSVAL2) VALUE('IASPdatabase')             */ /*BUG28037*/ /*BUG28074*/
/**********  CHGVAR     VAR(&SYSVAL3) VALUE('IASPgroup')                */ /*BUG28037*/ /*BUG28074*/
/**********  CALL       PGM(GPAOSVALR0) PARM(&RTNCODE &SYSVAL1 +                     */ /*BUG28074*/
/**********               &SYSVALVAL1 &SYSVAL2 &SYSVALVAL2 &SYSVAL3 +                */ /*BUG28074*/
/**********               &SYSVALVAL3 ' ' ' ' ' ' ' ' ' ' ' ' ' ' ' +                */ /*BUG28074*/
/**********               ' ' ' ' ' ' ' ' ' ' ' ' ')                    */ /*BUG28037*/ /*BUG28074*/
/**********  IF         COND(&RTNCODE *NE '       ') THEN(DO)           */ /*BUG28037*/ /*BUG28074*/
/**********     GOTO       CMDLBL(ERROR)                                */ /*BUG28037*/ /*BUG28074*/
/**********  ENDDO                                                      */ /*BUG28037*/ /*BUG28074*/
/**********  CALL       PGM(GP009510) PARM(&SYSVAL1 &SYSVALVAL1 ' ') */        /*BUG28037*MD056103*/
             CHGVAR     VAR(&SQLSTM) VALUE(' ')                                         /*MD056103*/
             CHGVAR     VAR(&SQLSTM) VALUE('UPDATE ' *BCAT &GMLIB +
                        *TCAT '/GPSVLXTD set GIVAL =' *TCAT '''' *TCAT &SYSVALVAL1 +
                        *TCAT ''''  *BCAT ' where GISVAL =' +
                        *TCAT '''' *TCAT &SYSVAL1 *TCAT '''' *TCAT ';')                 /*MD056103*/
             CALL       PGM(UTWRTSQL) PARM(&SQLSTM '*WRITE')                            /*MD056103*/
/**********  CALL       PGM(GP009510) PARM(&SYSVAL2 &SYSVALVAL2 ' ') */       /*BUG28037**MD056103*/
             CHGVAR     VAR(&SQLSTM) VALUE(' ')                                         /*MD056103*/
             CHGVAR     VAR(&SQLSTM) VALUE('UPDATE ' *BCAT &GMLIB +
                        *TCAT '/GPSVLXTD set GIVAL =' *TCAT '''' *TCAT &SYSVALVAL2 +
                        *TCAT ''''  *BCAT ' where GISVAL =' +
                        *TCAT '''' *TCAT &SYSVAL2 *TCAT '''' *TCAT ';')                 /*MD056103*/
             CALL       PGM(UTWRTSQL) PARM(&SQLSTM '*WRITE')                            /*MD056103*/
/**********  CALL       PGM(GP009510) PARM(&SYSVAL3 &SYSVALVAL3 ' ') */       /*BUG28037**MD056103*/
             CHGVAR     VAR(&SQLSTM) VALUE(' ')                                         /*MD056103*/
             CHGVAR     VAR(&SQLSTM) VALUE('UPDATE ' *BCAT &GMLIB +
                        *TCAT '/GPSVLXTD set GIVAL =' *TCAT '''' *TCAT &SYSVALVAL3 +
                        *TCAT ''''  *BCAT ' where GISVAL =' +
                        *TCAT '''' *TCAT &SYSVAL3 *TCAT '''' *TCAT ';')                 /*MD056103*/
             CALL       PGM(UTWRTSQL) PARM(&SQLSTM '*WRITE')                            /*MD056103*/

             RUNSQLSTM  SRCFILE(RUNSQL) SRCMBR(RUNSQLSTM) COMMIT(*NONE)                 /*MD056103*/
             DLTSPLF    FILE(RUNSQLSTM) SPLNBR(*LAST)                                   /*MD056103*/
                                                                                        /*MD056103*/
/**********  DLTOVR     FILE(GPSVALL0) */                                               /*MD054605*/

             GOTO       CMDLBL(ENDPGM)

ERROR:
             CHGJOB     SWS(XXXXXX11)
ENDPGM:
             ENDPGM
