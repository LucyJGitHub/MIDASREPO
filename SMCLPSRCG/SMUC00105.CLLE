/*********************************************************************/
/*STD    CLPBASEBND                                                  */
/*EXI    TEXT('Midas SM Transfer and correct records of files')      */
/*********************************************************************/
/*                                                                   */
/*       Midas - Implementation module                               */
/*                                                                   */
/*       SMUC00105 - Transfer files to have correct data and correct */
/*                   records of files in alphanumeric                */
/*                                                                   */
/*       (c) Finastra International Limited 2020                     */
/*                                                                   */
/*       Last Amend No. MD059758           Date 18Apr22              */
/*       Prev Amend No. CSD103    *CREATE  Date 10Aug20              */
/*                                                                   */
/*********************************************************************/
/*                                                                   */
/*       MD059758 - SMU01051 error handling issue                    */
/*       CSD103 - LIBOR Deregulation - Common Layer/Standing Data    */
/*                                                                   */
/*********************************************************************/
             PGM        PARM(&LAYER)

             COPYRIGHT  TEXT('(c) Finastra International Limited 2020')

             DCL        VAR(&LAYER)    TYPE(*CHAR) LEN(7)

/*System prefixes declaration*/
             DCL        VAR(&GPREFIX) TYPE(*CHAR) LEN(2)
             DCL        VAR(&ZPREFIX) TYPE(*CHAR) LEN(2)

/*for AOSVALR0 params declaration*/
             DCL        VAR(&SVAL) TYPE(*CHAR) LEN(200)
             DCL        VAR(&ZVAL) TYPE(*CHAR) LEN(200)
             DCL        VAR(&AORTN) TYPE(*CHAR) LEN(7)

             DCL        VAR(&MESSAGE) TYPE(*CHAR) LEN(50)                               /*MD059758*/
             DCL        VAR(&ERRPGM) TYPE(*CHAR) LEN(10)                                /*MD059758*/
                                                                                        /*MD059758*/
/* Global monitor message. */
             MONMSG     MSGID(CPF0000 MCH0000 RPG0000) EXEC(GOTO CMDLBL(ABNOR))


             IF         COND(&LAYER *EQ 'Global') THEN(DO)
/*Get Global system prefix*/
                CALL       PGM(GPAOSVALR0) PARM(&AORTN 'BrgMidasGlobalPrefix' +
                             &SVAL ' ' ' ' ' ' ' ' ' ' ' ' ' ' ' ' ' ' ' ' ' ' ' ' +
                             ' ' ' ' ' ' ' ' ' ' ' ')
/*Get global prefix*/
             CHGVAR     VAR(&GPREFIX) VALUE(%SST(&SVAL 1 2))
             ENDDO


             IF         COND(&LAYER *EQ 'Zonal ') THEN(DO)
/*Get Zone system prefix*/
             CALL       PGM(AOSVALR0) PARM(&AORTN 'BrgMidasSystemPrefix' &ZVAL ' ' +
                          ' ' ' ' ' ' ' ' ' ' ' ' ' ' ' ' ' ' ' ' ' ' ' ' ' ' ' ' +
                          ' ' ' ' ' ')
/*Get Zone prefix*/
             CHGVAR     VAR(&ZPREFIX) VALUE(%SST(&ZVAL 1 2))
             ENDDO


/* Call SMU01050 to fix corrupted data */

             CALL       PGM(SMU01050) PARM(&LAYER &ZPREFIX &GPREFIX)

/* Call SMU01051 to correct data */

             CALL       PGM(SMU01051) PARM(&LAYER)

             IF         COND(%SWITCH(XXXXXX11)) THEN(GOTO +
                          CMDLBL(ABNOR))                                                /*MD059758*/
                                                                                        /*MD059758*/
             SNDPGMMSG  MSG('SMUC00105 completed normally.') +
                          TOMSGQ(MOPERQ MRUNQ)                                          /*MD059758*/
                                                                                        /*MD059758*/
             GOTO       CMDLBL(END)

 ABNOR:
                                                                                        /*MD059758*/
             CHGVAR     VAR(&ERRPGM) VALUE('SMUC00105')                                 /*MD059758*/
             RTVMSG     MSGID(UPM0001) MSGF(UTMSGF) +
                          MSGDTA(&ERRPGM) MSG(&MESSAGE)                                 /*MD059758*/
             MONMSG     MSGID(CPF0000)                                                  /*MD059758*/
             CHGDTAARA  DTAARA(MIDASMSG (101 50)) VALUE(&MESSAGE)                       /*MD059758*/
             MONMSG     MSGID(CPF0000)                                                  /*MD059758*/
             CHGDTAARA  DTAARA(MIDASMSG (201 50)) VALUE('Check +
                          joblog for details')                                          /*MD059758*/
             MONMSG     MSGID(CPF0000)                                                  /*MD059758*/
             CALL       PGM(SCC0010) PARM(&ERRPGM 'JOBLOG' 'Y')                         /*MD059758*/
             MONMSG     MSGID(CPF0000 MCH0000)                                          /*MD059758*/
                                                                                        /*MD059758*/
             SNDPGMMSG  MSG('Error occurred in SMUC00105 program') +
                          TOMSGQ(MOPERQ MRUNQ)                                          /*MD059758*/
                                                                                        /*MD059758*/
             CHGJOB     SWS(XXXXXX11)

 END:
             ENDPGM



