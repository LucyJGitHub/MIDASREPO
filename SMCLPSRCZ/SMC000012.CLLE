/*********************************************************************/
/*STD    CLPBASEBND                                                  */
/*EXI    TEXT('Midas SM Determine Start posn of Selected Fields')    */
/*********************************************************************/
/*                                                                   */
/*       Midas - Implementation module                               */
/*                                                                   */
/*       SMC000012 - Determine Start position of selected fields     */
/*                                                                   */
/*       (c) Finastra International Limited 2004                     */
/*                                                                   */
/*       Last Amend No. MD046248           Date 27Oct17              */
/*       Prev Amend No. CUP003             Date 16Sep10              */
/* Bank Fusion Midas 1.4 Base ---------------------------------------*/
/* Midas Plus 1.4 Base 04 -------------------------------------------*/
/* Midas Plus 1.4 Base ----------------------------------------------*/
/* Midas Plus 1.3 ---------------- Base -----------------------------*/
/*                      CSM008             Date 23Feb06              */
/*                      CSM007             Date 27Oct05              */
/*                      CGL029  *CREATE    Date 13Feb04              */
/*                                                                   */
/*********************************************************************/
/*                                                                   */
/*       MD046248 - Finastra Rebranding                              */
/*       CUP003 - Keep copies in QTEMP to improve re-runnability.    */
/*       CSM008 - Error handling simplified.                         */
/*       CSM007 - Add error reporting to Conversion Process          */
/*       CGL029 - Increase Account Code field to 10 digits           */
/*                                                                   */
/*********************************************************************/
/**********  PGM        PARM(&PTFUPG)                                                  */ /*CUP003*/
             PGM                                                                          /*CUP003*/
 
/**********  DCL        VAR(&PTFUPG) TYPE(*CHAR) LEN(10)                               */ /*CUP003*/
 
             DCL        VAR(&GENPGM)    TYPE(*CHAR) LEN(10)  VALUE('SMC000012')
             DCL        VAR(&REPORTMSG) TYPE(*CHAR) LEN(100)
 
             DCLF       FILE(SMACFNPD)
 
             COPYRIGHT TEXT('(c) Finastra International Limited +
                          2006')
 
/* Global monitor message */
             MONMSG     MSGID(CPF0000 MCH0000 RPG0000) EXEC(GOTO +
                          CMDLBL(ABNOR))
 
/**********  DLTF       FILE(&PTFUPG/SMFLDNEW)                                         */ /*CUP003*/
             DLTF       FILE(QTEMP/SMFLDNEW)                                              /*CUP003*/
             MONMSG     MSGID(CPF0000)
             DLTF       FILE(QTEMP/SMC000012F)                                            /*CUP003*/
             MONMSG     MSGID(CPF0000)                                                    /*CUP003*/
             CRTDUPOBJ  OBJ(UPFFDSTPD) FROMLIB(*LIBL) OBJTYPE(*FILE) +
                          TOLIB(QTEMP) NEWOBJ(SMFLDNEW)                                   /*CUP003*/
 
/* Produce DSPFFD for each file to be converted. */
 READNEXT:
             RCVF
             MONMSG     MSGID(CPF0864) EXEC(GOTO CMDLBL(EXTRACT))
 
/**********  DSPFFD     FILE(&FILE) OUTPUT(*OUTFILE) +                                 */ /*CUP003*/
/**********               OUTFILE(&PTFUPG/SMFLDNEW) OUTMBR(*FIRST *ADD)                */ /*CUP003*/
             DSPFFD     FILE(&FILE) OUTPUT(*OUTFILE) +
                          OUTFILE(QTEMP/SMC000012F)                                       /*CUP003*/
             MONMSG     MSGID(CPF3012) EXEC(DO)
                CHGVAR     VAR(&REPORTMSG) VALUE(&FILE *BCAT 'not found +
                             in system; the file is ignored')
                CALL       PGM(UP008010) PARM(*WRITE &GENPGM &REPORTMSG)
                GOTO       CMDLBL(READNEXT)                                               /*CUP003*/
             ENDDO
             CPYF       FROMFILE(QTEMP/SMC000012F) +
                          TOFILE(QTEMP/SMFLDNEW) MBROPT(*ADD) +
                          FMTOPT(*MAP *DROP)                                              /*CUP003*/
 
             GOTO       CMDLBL(READNEXT)
 
/* Update the starting position of selected fields. */
 EXTRACT:
/**********  OPNQRYF    FILE((SMACFFPD) (&PTFUPG/SMFLDNEW)) +                          */ /*CUP003*/
/**********               FORMAT(SMACFXPD) KEYFLD((AXFILE) +                           */ /*CUP003*/
/**********               (AXFLDN)) UNIQUEKEY(*ALL) JFLD((FILE +                       */ /*CUP003*/
/**********               WHFILE) (FIELD WHFLDI)) MAPFLD((AXFILE +                     */ /*CUP003*/
/**********               FILE) (AXSHRD SHRD) (AXFLDN FIELD) +                         */ /*CUP003*/
/**********               (AXLENG LENGTH) (AXTEXT TEXT) (AXNDIG +                      */ /*CUP003*/
/**********               WHFLDD) (AXSPNW WHFOBO))                                     */ /*CUP003*/
             OPNQRYF    FILE((SMACFFPD) (QTEMP/SMFLDNEW)) +
                          FORMAT(SMACFXPD) KEYFLD((AXFILE) +
                          (AXFLDN)) UNIQUEKEY(*ALL) JFLD((FILE +
                          WHFILE) (FIELD WHFLDI)) MAPFLD((AXFILE +
                          FILE) (AXSHRD SHRD) (AXFLDN FIELD) +
                          (AXLENG LENGTH) (AXTEXT TEXT) (AXNDIG +
                          WHFLDD) (AXSPNW WHFOBO))                                        /*CUP003*/
 
             CPYFRMQRYF FROMOPNID(SMACFFPD) TOFILE(SMACFXPD) +
                          MBROPT(*REPLACE)
             CLOF       OPNID(SMACFFPD)
 
             GOTO       CMDLBL(END)
 
ABNOR:
             CHGJOB     SWS(XXXXXX11)
END:
             ENDPGM
