     H        1
      *****************************************************************
/*STD *  RPGBASE                                                      *
/*EXI *  TEXT('Midas TM Fwd book - daily details (was DL3130)')       *
     F*****************************************************************
     F*                                                               *
     F*  Midas Treasury Management Module                             *
     F*                                                               *   S01166
     F*  TM3130 - FX Forward Book - Daily Deals                       *   S01117
     F*           (Formerly DL3130)                                   *   S01117
     F*                                                               *
     F*  Function: This enquiry shows foreign exchange deals for      *
     F*  (I/C)     any day forward including today.                   *
     F*                                                               *
     F*  Called by: TMC0311 - TM Enquiry control                      *
     F*        via: DL3100  - Treasury management controller          *
     F*                                                               *
     F*  Calls    : ZA0250  - Clear program message queue.            *
     F*           : ZA0240  - Display program message queue.          *
     F*           : ZA0270  - Convert date to Midas day number.       *
     F*                                                               *
     F*  Linked enquiries: TM3110 - FX Monthly summary                *
     F*                    TM3120 - FX Daily summary                  *
     F*                    DL0170 - FX Deal details                   *
     F*                                                               *
      *  (c) Misys International Banking Systems Ltd. 2001            *
     F*                                                               *
      *  Last Amend No. CDL099             Date 06Oct17               *
      *  Prev Amend No. CDL094             Date 11Jun14               *
      * Bank Fusion Midas 1.4 Base -----------------------------------*
      * Midas Plus 1.4 Base 04 ---------------------------------------*
      * Midas Plus 1.4 Base ------------------------------------------*
      * Midas Plus 1.3 ----------- Base ------------------------------*
      *                 CSD031             Date 10Apr06               *
      *                 CDL049             Date 11May06               *
      *                 CSD027             Date 09Dec05               *
      *                 CDL038             Date 10May05               *
      *                 CSW037A            Date 02May05               *
      *                 CSD025             Date 11Jan05               *
      *                 CSW037             Date 15Dec04               *
      *                 CSW036             Date 15Dec04               *
      *                 CLE025             Date 20Oct03               *
      *                 TDA035             Date 02Apr04               *
      *                 CGL029             Date 01Sep03               *
      *                 CDL010             Date 02Aug02               *
      * Midas Release 4 --------------- Base -------------------------*
      * Midas DBA 3.00 Patch D ---------------------------------------*
      * Midas DBA 3.01 -----------------------------------------------*
      *                 167048             Date 24Sep99               *
      * Midas DBA 3.00 ---------------- Base -------------------------*
     F*                 S01408             DATE 02AUG96               *
     F*                 092368             DATE 27JUN96               *
     F*                 081473             DATE 20APR95               *
     F*                 S01453             DATE 14DEC93               *
     F*                 E42669             DATE 01FEB93               *
     F*                 E49802             DATE 26JAN93               *
     F*                 S01319             DATE 14AUG91               *
     F*                 S01280             DATE 13FEB91               *
     F*                 S01194             DATE 08NOV90               *
     F*                 S01117             DATE 08NOV90               *
     F*                 E21656             DATE 25APR90               *   E21656
     F*                 E20774             DATE 15MAR90               *   E21656
     F*                 S01199             DATE 28FEB90               *   E21656
     F*                 E19797             DATE 16/10/89              *
     F*                 E17654             DATE 03/04/89              *
     F*                 S01145             DATE 22/06/88              *
     F*                 S01166             DATE 19/05/88              *   S01166
     F*                 E13307             DATE 21/05/88              *   S01166
     F*                 E12848             DATE 05/05/88              *   S01166
     F*                 E12677             DATE 28/04/88              *   S01166
     F*                 E12931             DATE 22/04/88              *   S01166
     F*                 S01136             DATE 09/12/87              *   S01166
     F*                                                               *
     F*---------------------------------------------------------------*
     F*                                                               *
      *  CDL099 - Split Value Date (Recompile)                        *
      *  CDL094 - Enhance  Receive Settlement Instructions            *
      *           (Recompiled)                                        *
      *  CSD031 - Enhanced Centralised Static Data (Recompile)        *
      *  CDL049 - Addition of a Reference Rate field (recompile)      *
      *  CSD027 - Conversion Of Customer Number to Alpha              *
      *  CDL038 - Extended Deal Sub Type (Recompile)                  *
      *  CSW037A- Additional Field extended to 40 chars (recompile)   *
      *  CSD025 - Customer De-Activation                              *
      *  CSW037 - Additional Field Data on MT300/MT320                *
      *  CSW036 - Dual SWIFT BIC held on Client Details               *
      *  CLE025 - Credit Lines (Recompile)                            *
      *  TDA035 - RTS Signon changes for MidasPlus. (Recompile)       *
      *  CGL029 - Increase Account Code to 10 digits                  *
     F*  CDL010 - Prevent last user that actioned the trade from      *
     F*           authorising it.Recompile due to changes in FXDEALPP.*
     F*  167048 - Year 2000 problem. Check if @CC less than           *
     F*           20 before adding 1 in subroutine @B                 *
     F*  S01408 - Core Hook Added TM3130CP11                          *
     F*         - Core Hook Added TM3130CP10                          *
     F*         - Core Hook Added TM3130CCP9                          *
     F*         - Core Hook Added TM3130CCP8                          *
     F*         - Core Hook Added TM3130CCP7                          *
     F*         - Core Hook Added TM3130CCP6                          *
     F*         - Core Hook Added TM3130CCP5                          *
     F*         - Core Hook Added TM3130CCP4                          *
     F*         - Core Hook Added TM3130CCP3                          *
     F*         - Core Hook Added TM3130CCP2                          *
     F*         - Core Hook Added TM3130CCP1                          *
     F*  092368 - Format of date passed as parameter different from   *
     F*           format processed by program.                        *
      *  081473 - The call to AoCustR0 was passing the code of
      *           '*DBERR' which meant that AOCUSTR0 dumped & gave a
      *           database error when the customer was not found - but
      *           a cust of 0 is possible on a deal. So call AoCustR0
      *           with a parm of *Blanks not *DBERR.
     F*  S01453 - MARGIN AND FX POSITIONS/POINTS AND BASE CURRENCY    *
     F*           POSITIONS/POINTS ADDED TO FX INPUT (RECOMPILED)     *
     F*  E42669 - Selection parameter defaulting does not function    *
     F*  (SDC096) as described in Instruction Manual. Should          *
     F*           default CCY to Base CCY for Dealing, and date       *
     F*           to Spot Date for the CCY.                           *
     F*  E49802 - Do not show options on value date if option         *
     F*           value date indicator is N.                          *
     F*  S01319 - Remove redundant processing                         *
     F*  S01280   General Treasury Management fixes during project:   *
     F*         - Subfile being incorrectly cleared from screen       *
     F*           if rollup/down and no more records                  *
     F*         - REPLACE PUTOVR IN DDS & UPDATE TIME                 *
     F*         - SHOULD REJECT DATES PRIOR TO TODAY                  *
     F*         - IF SELECTION MADE IN SUBFILE NEXT PROGRAM DOWN      *
     F*           IN STACK NOT BEING CALLED                           *
     F*         - IF NO RECORDS EXIST FOR PROMPTS ENTERED,            *
     F*           EXISTING SUBFILE SHOULD BE CLEARED AND DETAILS      *
     F*           IN HEADER CHANGED TO MATCH PROMPTS                  *
     F*                                                               *
     F*  S01194 - NEW STANDING DATA PROCESSING                        *   S01194
     F*                                                               *
     F*  S01117 - NEW COPYRIGHT STATEMENT                             *   S01117
     F*           DEALING PROGRAMS USED ONLY IN TREASURY MGMT.        *   S01117
     F*           MODULE NOW PREFIXED WITH 'TM'                       *   S01117
     F*                                                               *
     F*  E21656 - ALLOW ENQUIRIES ON HOLIDAYS                         *   E21656
     F*                                                               *   E21656
     F*  E20774 - REPLACE QCAEXEC WITH QCMDEXC                        *   E20774
     F*                                                               *
     F*  S01199  - HELP SYSTEM.                                       *   S01199
     F*                                                               *
     F*  E19797 - Amend program so that the far date deal number      *
     F*           is shown when the far date is requested.            *
     F*                                                               *
     F*  E17654 - Customers keyed by number now.                      *
     F*                                                               *
     F*  SAR S01145  AMEND TO SHOW ARBITRAGE DEALS                    *
     F*              (22/6/88 - USE DRS S/NAME NOT MIDAS S/NAME)      *
     F*                                                               *
     F*  S01166 -  DISPLAY OUTPUT ON AS400 SCREEN INSTEAD OF PC       *   S01166
     F*                 VIA DATA AREA                                 *   S01166
     F*                                                               *   S01166
     F*  E13307 - Correct 'Refresh' processing for enquiries          *   S01166
     F*           which have request date equal to run date           *   S01166
     F*           and for which there exist live options for          *   S01166
     F*           request currency.                                   *   S01166
     F*                                                               *   S01166
     F*  E12848 - When an attempt is made to 'Page Forward'           *
     F*           a daily deals enquiry for which the request         *
     F*           date is equal to the run date and for which         *
     F*           there exist live options for the request            *
     F*           currency, DL3130 crashes with an 'OCUR              *
     F*           Outside of Range' error.                            *
     F*           (All other roll-up errors also tackled.)            *
     F*                                                               *
     F*  E12677 - ON SOME PAGES ONLY BOTTOM HALF OF THE PAGE          *
     F*           DISPLAYED                                           *
     F*                                                               *
     F*  E12931 - NEED TO UPDATE CURRENT PROMPTS FILE WITH VALID      *
     F*           DATA IF ENQUIRY TYPE IS BLANK                       *
     F*                                                               *
     F*  S01136 - RELEASE CURRENT PROMPTS FILE CA38CPLL               *
     F*                                                               *
     F*****************************************************************
     F* ID F  C  H  L    FUNCTION OF INDICATORS
     F*       61         CHAIN AND DB ERROR INDICATOR
     F*       U6         PROGRAM ERROR - *PSSR EXECUTED
     F*       U7         DATA BASE ERROR
     F*       U8         DATA BASE ERROR
     F*
     F*  C R E A T I O N     P A R A M E T E R S                      *
     F*                                                               *
     F*                                                               *
     F*****************************************************************
     F***FDICDRLLIF**E***        K        DISK         KINFSR INFSR  U C  S01194
     F**********  TABTB11F                          KIGNORE               S01194
     F**********  TABTB20F                          KIGNORE               S01194
     F*FXSSTSLLIF**E*******************DISK*********KINFSR*INFSR******UC**S01319
     F***FDCCYTLLIF**E***        K        DISK         KINFSR INFSR  U C  S01194
     F*X38CPLLUF  E                    DISK         KINFSR INFSR      UC
     F***CA38CPLLUF  E                 DISK         KINFSR INFSR      UC  S01166
     FFDMNTHLLIF  E                    DISK         KINFSR INFSR      UC
     FFXFWDTLLIF  E           K        DISK         KINFSR INFSR      UC
     FFXOPTALLIF  E           K        DISK         KINFSR INFSR      UC
     F*XDLVALLIF  E***********K********DISK*********KINFSR INFSR      UC  S01145
     FCADLVALLIF  E           K        DISK         KINFSR INFSR      UC  S01145
     F            FXDEALL0                          KRENAMEFXDLVOL0
     F            FXDEALL1                          KRENAMEFXDLVOL1
     F                                              KINFDS INIDS          E19797
     F*XFDLALLIF  E***********K********DISK*********KINFSR INFSR      UC  S01145
     FCAFDLALLIF  E           K        DISK         KINFSR INFSR      UC  S01145
     F            FXDEALL0                          KRENAMEFXFDDLL0
     F            FXDEALL1                          KRENAMEFXFDDLL1
     F***CLINT***IF**E**         K        DISK  KINFSR INFSR  U C  S01145 S01194
     F**                                                                  S01166
     F*FDUSSILLIF**E*********K********DISK*********KINFSR*INFSRUC**S01166 S01319
     FMUSER   IF  E           K        DISK         KINFSR INFSR      UC  S01319
     F**                                                                  S01166
     F***DL3130DDCF**E***                 WORKSTN             U C  S01166 S01117
     F**********                              RRN   KSFILE DL3130S1S01166 S01117
     F**********                                    KNUM        1  S01166 S01117
     FTM3130DDCF  E                    WORKSTN                        UC  S01117
     F                                        RRN   KSFILE TM3130S1       S01117
     F                                              KNUM        1         S01117
     F*                                                                   S01166
     F*DTABJLLIF  E***********K********DISK*********KINFSR INFSR      UC  E21656
      /EJECT                                                              S01166
     E*
     E**  ARRAY FOR S/R ZA0860
     E                    @K         16  1
     E*
     E**  ARRAY FOR SR. ZA0710 - CUMULATIVE DAYS IN YEAR FOR 4 YEAR PERIOD
     E                    @YD     4   4  5 0A
     E*
     E**  ARRAY FOR SR. ZA0710 - CUMULATIVE DAYS IN YEAR PER MONTH
     E                    @MD    13  13  5 0A
     E*
     E*
     E**  ARRAY TO LOAD DATA AREA MASK
     E                    @AR        15 52                                S01166
     E*
     E**  ARRAY TO HOLD MONTH NAMES - TO CONVERT FROM MMM TO MM FORMAT
     E                    @MN        12  3
     E*
     E**  ARRAY TO HOLD OUTPUT AMOUNT
     E*                                                                   S01166
     E                    @OVR    1   1 36                                S01166
     E****Array*to*set*up*parameter*for*call*to*QCAEXEC             S01166E20774
     E**  Array to set up parameter for call to QCMDEXC                   E20774
     E*                                                                   S01166
     E**  USED BY SR. ZA0830 - CURRENCY RECORDS*******************  S01166E21656
     E******************* @CY ****** 50  3************************  S01166E21656
     E*                                                                   S01166
     E*****************************************************************   S01166
     E                    CPY@    1   1 80                                S01117
     E* Copyright array                                                   S01117
      /EJECT                                                              S01166
     I*                                                                   S01166
     IFXDEALL0    01
     IFXDEALL1    02
     I**  RENAME FIELDS IN CADLVALL                                       S01145
     IFXDEALL3    01
     I              FHCCY1                          @CCY1                 S01145
     I              FHCCY2                          @CCY2                 S01145
     I              FHDAM1                          @DAM1                 S01145
     I              FHDAM2                          @DAM2                 S01145
     I              FHDCSN                          @DCSN                 S01145
     I              FHDCNO                          @DCNO                 E17654
     I              FHDN38                          @DN38                 S01145
     I              FHTYPE                          @DTYP                 S01145
     I**  RENAME FIELDS IN CADLVALL                                       S01145
     IFXDEALL4    02
     I              FHCCY1                          @CCY1                 S01145
     I              FHCCY2                          @CCY2                 S01145
     I              FHDAM1                          @DAM1                 S01145
     I              FHDAM2                          @DAM2                 S01145
     I              FHDCSN                          @DCSN                 S01145
     I              FHDCNO                          @DCNO                 E17654
     I              FHDN38                          @DN38                 S01145
     I              FHTYPE                          @DTYP                 S01145
     I**  RENAME FIELDS IN CADLVALL                                       S01145
     IABDLVAL0    01                                                      S01145
     I              JPDFCY                          @CCY1                 S01145
     I              JPDSCY                          @CCY2                 S01145
     I              JPFD38                          @DN38                 S01145
     I              JPMDTY                          @DTYP                 S01145
     I              JPDCNO                          @DCNO                 E17654
     I**  RENAME FIELDS IN CADLVALL                                       S01145
     IABDLVAL1    02                                                      S01145
     I              JPDFCY                          @CCY1                 S01145
     I              JPDSCY                          @CCY2                 S01145
     I              JPFD38                          @DN38                 S01145
     I              JPMDTY                          @DTYP                 S01145
     I              JPDCNO                          @DCNO                 E17654
     I**  RENAME FIELDS IN CADLVALL                                       S01145
     IABDLVAL2    01                                                      S01145
     I              JPDFCY                          @CCY1                 S01145
     I              JPDSCY                          @CCY2                 S01145
     I              JPFD38                          @DN38                 S01145
     I              JPSD38                          @SDEL                 E19797
     I              JPMDTY                          @DTYP                 S01145
     I              JPDCNO                          @DCNO                 E17654
     I**  RENAME FIELDS IN CADLVALL                                       S01145
     IABDLVAL3    02                                                      S01145
     I              JPDFCY                          @CCY1                 S01145
     I              JPDSCY                          @CCY2                 S01145
     I              JPFD38                          @DN38                 S01145
     I              JPSD38                          @SDEL                 E19797
     I              JPMDTY                          @DTYP                 S01145
     I              JPDCNO                          @DCNO                 E17654
     IFXDLVOL0    01
     I              FHCCY1                          @CCY1                 S01145
     I              FHCCY2                          @CCY2                 S01145
     I              FHDAM1                          @DAM1                 S01145
     I              FHDAM2                          @DAM2                 S01145
     I              FHDCSN                          @DCSN                 S01145
     I              FHDCNO                          @DCNO                 E17654
     I              FHDN38                          @DN38                 S01145
     I              FHTYPE                          @DTYP                 S01145
     I**  RENAME FIELDS IN CADLVALL                                       S01145
     IFXDLVOL1    02
     I              FHCCY1                          @CCY1                 S01145
     I              FHCCY2                          @CCY2                 S01145
     I              FHDAM1                          @DAM1                 S01145
     I              FHDAM2                          @DAM2                 S01145
     I              FHDCSN                          @DCSN                 S01145
     I              FHDCNO                          @DCNO                 E17654
     I              FHDN38                          @DN38                 S01145
     I              FHTYPE                          @DTYP                 S01145
     IFXFDDLL0    01
     I              FHCCY1                          @CCY1                 S01145
     I              FHCCY2                          @CCY2                 S01145
     I              FHDAM1                          @DAM1                 S01145
     I              FHDAM2                          @DAM2                 S01145
     I              FHDCSN                          @DCSN                 S01145
     I              FHDCNO                          @DCNO                 E17654
     I              FHDN38                          @DN38                 S01145
     I              FHTYPE                          @DTYP                 S01145
     I**  RENAME FIELDS IN CAFDLALL                                       S01145
     IFXFDDLL1    02
     I              FHCCY1                          @CCY1                 S01145
     I              FHCCY2                          @CCY2                 S01145
     I              FHDAM1                          @DAM1                 S01145
     I              FHDAM2                          @DAM2                 S01145
     I              FHDCSN                          @DCSN                 S01145
     I              FHDCNO                          @DCNO                 E17654
     I              FHDN38                          @DN38                 S01145
     I              FHTYPE                          @DTYP                 S01145
     I**  RENAME FIELDS IN CAFDLALL                                       S01145
     IABFDDLL0    01                                                      S01145
     I              JPDFCY                          @CCY1                 S01145
     I              JPDSCY                          @CCY2                 S01145
     I              JPFD38                          @DN38                 S01145
     I              JPMDTY                          @DTYP                 S01145
     I              JPDCNO                          @DCNO                 E17654
1    I**  RENAME FIELDS IN CAFDLALL                                       S01145
     IABFDDLL1    02                                                      S01145
     I              JPDFCY                          @CCY1                 S01145
     I              JPDSCY                          @CCY2                 S01145
     I              JPFD38                          @DN38                 S01145
     I              JPMDTY                          @DTYP                 S01145
     I              JPDCNO                          @DCNO                 E17654
     I**  RENAME FIELDS IN CAFDLALL                                       S01145
     IABFDDLL2    01                                                      S01145
     I              JPDFCY                          @CCY1                 S01145
     I              JPDSCY                          @CCY2                 S01145
     I              JPFD38                          @DN38                 S01145
     I              JPMDTY                          @DTYP                 S01145
     I              JPDCNO                          @DCNO                 E17654
     I**  RENAME FIELDS IN CAFDLALL                                       S01145
     IABFDDLL3    02                                                      S01145
     I              JPDFCY                          @CCY1                 S01145
     I              JPDSCY                          @CCY2                 S01145
     I              JPFD38                          @DN38                 S01145
     I              JPMDTY                          @DTYP                 S01145
     I              JPDCNO                          @DCNO                 E17654
     I*
     I**  RENAME FIELDS ON FDMNTHLL AS ARRAY
     IFDMNTHP0
     I              MNNM1                           @MN,1
     I              MNNM2                           @MN,2
     I              MNNM3                           @MN,3
     I              MNNM4                           @MN,4
     I              MNNM5                           @MN,5
     I              MNNM6                           @MN,6
     I              MNNM7                           @MN,7
     I              MNNM8                           @MN,8
     I              MNNM9                           @MN,9
     I              MNNM10                          @MN,10
     I              MNNM11                          @MN,11
     I              MNNM12                          @MN,12
     I*                                                                   S01166
     I************DS                                                S01166E21656
     I*** USED BY SR. ZA0830 - ARRAY DATA STRUCTURE *************** S01166E21656
     I*************************************** 1 150 @CY             S01166E21656
     I*************************************** 1  75 @@CY1           S01166E21656
     I************************************** 76 150 @@CY2           S01166E21656
     I*                                                                   S01166
     I***AMENQ1      DS                            728                    S01166
     I***                                     1   8 @FWDBK                S01166
     I***                                    10  16 @HYPH                 S01166
     I***                                    18  22 @DEALS                S01166
     I***                                    30  36 @DATE                 S01166
     I***                                    40  42 @CURR                 S01166
     I***                                    45  51 @000S                 S01166
     I***                                    97 101 @START                S01166
     I***                                   105 312 @LIN1                 S01166
     I***                                   313 520 @LIN5                 S01166
     I***                                   521 676 @LIN9                 S01166
     I***                                   682 686 @DAILY                S01166
     I***                                   688 692 @TOTAL                S01166
     I***                                   694 706 DDTOT                 S01166
     I***                                   708 710 @CURR1                S01166
     I**  DATA AREA MASK - AMENQ1AA
     I*
     I@WORK       DS                         15  65                       S01166
     I                                        1   60@DEAL
     I                                        8  17 @CUST
     I                                       20  30 @AMT1
     I                                       32  34 @CUR1
     I                                       36  38 @CUR2
     I                                       40  50 @AMT2
     I                                       51  650@DAMT
     I**  OCURS D/S TO HOLD 11 LINES OF DATA AREA MASK
     I*
     I***         DS                                                      S01166
     I***                                     1  80 FAEPT1                S01166
     I***                                     2   4 @CCY                  S01166
     I***                                     6  12 @CDATE                S01166
     I***                                     6   7 @DD                   S01166
     I***                                     8  10 @MMM                  S01166
     I***                                    11  120@YY                   S01166
     I***                                    11  12 @YYC                  S01166
     I*** DATA STRUCTURE TO SET UP FILE KEY FROM CURRENT PROMPT.          S01166
     I*                                                                   S01166
     I            DS                                                      S01166
     I                                        1   60@SRDAT                S01166
     I                                        1   20@SRDD                 S01166
     I                                        3   40@SRMM                 S01166
     I                                        5   60@SRYY                 S01166
     I**  DATA STRUCTURE FOR DATE DDMMYY, INPUT TO ZA0270                 S01166
     I*
     I            DS                              8
     I                                        1   80@FDATE
     I                                        1   40FHVDYY
     I                                        5   60FHVDMM
     I                                        7   80FHVDDD
     I**  DATA STRUCTURE FOR DATE DDMMYY, OPTION TO DATE                  S01166
     I*                                                                   S01166
     I            DS                              8                       S01166
     I                                        1   80@ODATE                S01166
     I                                        1   40FHDOEY                S01166
     I                                        5   60FHDOEM                S01166
     I                                        7   80FHDOED                S01166
     I**  FILE DATE FORMAT DATA STRUCTURE
     I*
     I            DS                              8
     I                                        1   80@RDATE
     I                                        1   40@RCCYY
     I                                        5   60@MM
     I                                        7   80@KDD
     I**  REQUEST DATE FORMAT DATA STRUCTURE
     I*
     I            DS                             14
     I                                        1  140@PARM
     I                                        1   60@KDEAL
     I                                        7  140@PDATE
     I                                        7  14 @PDATA
     I**  ROLL REFRESH KEY INPUT PARAMETER DATA STRUCTURE
     I*
     I            DS                             24
     I                                        1  24 FARKB1
     I                                        1   60@BOT1
     I                                        7  140@BOT2
     I                                    P  15  220@BOT3
     I**  BOTTOM SCREEN FILE UPDATE
     I*
     I            DS                             24
     I                                        1  24 FARKT1
     I                                        1   60@TOP1
     I                                        7  140@TOP2
     I                                    P  15  220@TOP3
     I**  TOP SCREEN FILE UPDATE
     I*
     I**  DATA STRUCTURE FOR SR. ZA0710 - FIELD IS @@Z71Y
     I            DS
     I                                        1   40@@Z71Y
     I                                        1   10@@SSY1
     I                                        2   20@@SSY2
     I                                        3   30@@SSY3
     I                                        4   40@@SSY4
     I**  DATA STRUCTURE FOR SR. ZA0710 - FIELD IS @@VDT
     I            DS
     I                                        1   80@@VDT
     I                                        1   40@@YR
     I                                        5   60@@Z71M
     I                                        7   80@@Z71D
     I*
     I** DATA STRUCTURE TO HOLD INFORMATION ON DATABASE ERROR.
     I           UDS                            256
     I                                      134 141 DBFILE
     I                                      142 170 DBKEY
     I                                      171 180 DBPGM
     I                                      181 183 DBASE
     I*
     I** PROGRAM STATUS D/S TO HOLD FILE NAME FOR FILE ERROR.
     IPSDS       SDS
     I**  Program status data structure.                                  S01166
     I**  Field containing file in use.                                   S01166
     I                                      201 208 @FILE
     I**  Field containing workstaion  ID.                                S01166
     I                                      244 253 @JOB                  S01166
     I**  Field containing user ID.                                       S01166
     I                                      254 263 @USER                 S01166
     I*                                                                   S01166
     I@PRMPT      DS                            256                       S01166
     I                                        1   3 DDCCY                 S01166
     I                                        4  10 DDDMY                 S01166
     I                                        4   5 @DD                   S01166
     I                                        6   8 @MMM                  S01166
     I                                        9  100@YY                   S01166
     I                                        9  10 @YYC                  S01166
     I                                       11  16 @TOPDL                S01166
     I**  PROMPTS D/S                                                     S01166
     I*                                                                   S01166
     I@OVRID      DS                             36                       S01166
     I                                       32  350@WAIT                 S01166
     I*   Data structure for file CADLVALL.                               E19797
     IINIDS       DS                                                      E19797
     I                                     *RECORD  RECIMT                E19797
     I*   Data structure for command in array @OVR                        S01166
     I*                                                                   S01166
     I*
     ISDCURR    E DSSDCURRPD                                              S01194
     I* External DS for Currency Details                                  S01194
     ISDBANK    E DSSDBANKPD                                              S01194
     I* External DS for Bank Details                                      S01194
     ISDCUST    E DSSDCUSTPD                                              S01194
     I* External DS for Customer Details                                  S01194
     ISDTRMA    E DSSDTRMAPD                                              S01319
     I** EXTERNAL DS FOR DEALING DETAILS                                  S01319
     ISDDEAL    E DSSDDEALPD                                              E42669
     I*                                                                   E42669
     I** External DS for Dealing Details                                  E42669
     I*                                                                   E42669
     IDSSDY     E DSDSSDY                                                 S01194
     I* DS used by Access Objects (long records)                          S01194
     IDSFDY     E DSDSFDY                                                 S01194
     I* DS used by Access Objects (short records)                         S01194
     C                     MOVEACPY@      BIS@   80                       S01117
     C/EJECT
     C*
     C**  Initial processing.
     C***        @TOTAL    CASNE'TOTAL'   #A                              S01166
     C***                  END                                            S01166
     C*                                                                   S01166
     C                     EXSR #A                                        S01166
     C*
     C**  Main processing -                                               S01166
     C**     do while not cmd/3 and not cmd/12 and no selection           S01166
     C           *IN11     DOWEQ'0'                                       S01166
     C           *IN12     ANDEQ'0'                                       S01166
     C           *IN13     ANDEQ'0'                                       S01166
     C           *INLR     CASEQ'0'       #B
     C                     END
     C                     END                                            S01166
     C*
     C**  Termination processing
     C                     EXSR #C
     C*
     C           ENDPGM    TAG                             **ENDPGM**
     C/EJECT
     C*****************************************************************
     C*                                                               *
     C*  Index to subroutines - Order of listing due to frequency of  *
     C*                         usage.                                *
     C*                                                               *
     C*   1. ZA0860 - Convert short amount to display format.         *
     C*   2. #ZB    - Edit & move fields to Data Structure            *
     C*   3. #BC    - Write a record to the enquiry subfile           *   S01166
     C****4. ZA0830 - Determines whether day is holiday****************   E21656
     C*   5. #B     - Main processing.                                *   S01166
     C****6.*#ZA****-*Send*Data*to*P.C.********************************   S01166
     C****7.*#ZC****-*End*Processing.**********************************   S01166
     C*   8. #C     - Termination processing.                         *   S01145
     C****9**#BBAA****Read Forward FXFDLALL****************************   S01145
     C***10**#BBBA****Read Backward FXFDLALL***************************   S01145
     C***11**#BA******FXDLVALL Processing******************************   S01145
     C***12**#BB******FXFDLALL Processing******************************   S01145
     C***13**#BAA*****Forward processing of FXDLVALL*******************   S01145
     C***14**#BAB*****Backwards processing of FXDLVALL*****************   S01145
     C***15**#BBA*****Forward processing of FXFDLALL*******************   S01145
     C***16**#BBB*****Backwards processing of FXFDLALL*****************   S01145
     C*      #BAAA  - Read Forward CAFDLALL.                          *   E49802
     C*      #BABA  - Read Backward CAFDLALL.                         *   E49802
     C*   9. #BBAA  - Read Forward CAFDLALL.                          *   S01145
     C*  10. #BBBA  - Read Backward CAFDLALL.                         *   S01145
     C*  11. #BA    - CADLVALL Processing.                            *   S01145
     C*  12. #BB    - CAFDLALL Processing.                            *   S01145
     C*  13. #BAA   - Forward processing of CADLVALL                  *   S01145
     C*  14. #BAB   - Backwards processing of CADLVALL                *   S01145
     C*  15. #BBA   - Forward processing of CAFDLALL.                 *   S01145
     C*  16. #BBB   - Backwards processing of CAFDLALL.               *   S01145
     C*  17. #BBC   - FXOPTALL processing.                            *   S01166
     C*  18. #BBCA  - FX00PTLL read forward.                          *   S01166
     C*  19. #BBCB  - FX00PTLL read backward.                         *   S01166
     C*  20. #A     - Initial processing.                             *   S01166
     C***21**ZA0150***Accesses*ICD*file**************************  S01166 S01194
     C*  22. ZA0710 - Convert Midas day no. to YYYYMMDD format.       *   S01166
     C*  23. #ZD    - Database Error Handling sub - routine.          *   S01166
     C*  24. INFSR  - File error handling sub - routine.              *   S01166
     C*  25. *PSSR  - Program error handling sub - routine.           *   S01166
     C*                                                               *
     C****************************************************************
     C/EJECT
     C****************************************************************
     C*                                                              *
     C*                                                              *
     C*     MIDAS/DRS - FX DEALER MODULE                             *
     C*                                                              *
     C*     ZA0860 -  CONVERT SHORT AMOUNT TO DISPLAY FORMAT - 38    *
     C*                                                              *
     C*     CALLS:                                                   *
     C*                                                              *
     C*     INPUT:   @@NUM  15N    (NUMERIC INPUT AMOUNT)            *
     C*                                                              *
     C*     OUTPUT:  @@ALPH16A     (ALPHA OUTPUT AMOUNT)             *
     C*                                                              *
     C*     USES:    @K     15A  - ARRAY TO HOLD INPUT AMOUNT        *
     C*              @@I     1N  - INDEX TO @A                       *
     C*              @@WORK 15A  - ALPHA INPUT AMOUNT                *
     C*                                                              *
     C*     AMEND NO. 000001                  DATE   14/07/86        *
     C*       Amendment to correct output if its value is zero.      *
     C*                                                              *
     C****************************************************************
     C*
     C           ZA0860    BEGSR
     C*
     C                     Z-ADD@@NUM     @@NUM  150
     C*
     C**  IF THE NUMBER IS ZERO, PLACE A SINGLE ZERO IN THE LAST PLACE
     C**  OF THE ARRAY, AND SET THE SIGN TO BLANK.  THEN BY-PASS
     C**  FURTHER SUBROUTINE PROCESSING.
     C           @@NUM     IFEQ 0                          B1
     C                     MOVEA*BLANK    @K               *1
     C                     MOVE '0'       @K,15            *1
     C                     GOTO ZA0868                     *1
     C                     END                             E1
     C*
     C** SET UP SIGN OF OUTPUT AMOUNT
     C           @@NUM     IFLT 0                          B1
     C                     MOVE '-'       @K,16            *1
     C                     Z-SUB@@NUM     @@NUM            *1
     C                     ELSE                            X1
     C                     MOVE '+'       @K,16            *1
     C                     END                             E1
     C*
     C**  SET UP INPUT AMOUNT ARRAY
     C                     MOVE @@NUM     @@WORK 15
     C                     MOVEA@@WORK    @K
     C*
     C**  BLANK OUT EACH ELEMENT OF @K FROM LEFT TO RIGHT
     C**  UNTIL FIRST NON-ZERO ELEMENT OR 15TH ELEMENT
     C                     MOVE '0'       *IN90
     C                     Z-ADD1         @@I     20
     C           *IN90     DOUEQ'1'                        B1
     C           @@I       OREQ 15                         *1
     C*                                                    *1
     C** IF ARRAY ELEMENT ZERO, SET TO BLANKS              *1
     C           @K,@@I    IFEQ '0'                        B*2
     C                     MOVE *BLANK    @K,@@I           **2
     C                     ELSE                            X*2
     C                     MOVE '1'       *IN90            **2
     C                     END                             E*2
     C                     ADD  1         @@I              *1
     C                     END                             E1
     C*
     C** TAG ZA0868
     C           ZA0868    TAG                             **ZA0868**
     C*
     C** SET UP OUTPUT AMOUNT
     C                     MOVEA@K        @@ALPH 16
     C*                                                                   S01166
     C           ZA0869    ENDSR                           **ZA0869**
     C*
     C/EJECT
     C****************************************************************
     C*                                                              *
     C*    #ZB EDIT FIELDS AND MOVE TO WORK DATA STRUCTURE           *
     C*        CALLED BY  :                                          *
     C*        CALLS      :                                          *
     C*                                                              *
     C*        WORK FIELDS: @@NUM  - NUMERIC INPUT TO ZA0860         *
     C*                   : @ALPHA - ALPHA OUTPUT FROM ZA0860        *
     C*                                                              *
     C****************************************************************
     C*
     C           #ZB       BEGSR
     C*
     C**  MOVE DEAL NUMBER & CUSTOMER SHORTNAME TO DISPLAY
     C*********************MOVE FHDN38    @DEAL                           S01145
     C*********************MOVE FHDCSN    @DEAL                           S01145
     C                     MOVE @DN38     @DEAL                           S01145
     C**  CHECK RECORD FORMAT FOR CADLVALL, MOVE CORRECT DEAL NUMBER.     E19797
     C           RECIMT    IFEQ 'ABDLVAL2'                                E19797
     C           RECIMT    OREQ 'ABDLVAL3'                                E19797
     C                     MOVE @SDEL     @DEAL                           E19797
     C                     END                                            E19797
     C****IF*ARBITRAGE*DEAL*TYPE*ACCESS*CLINT*FOR*CUST*SHORTNAME** S01145 S01194
     C*          @DTYP     IFEQ 'PS'                       B1             E17654
     C*          JPDCNO    CHAINCLINT                63    *1             E17654
     C********** @DCNO     CHAINCLINT                63    *1             E17654
     C**********                                           *1      S01145 S01194
     C****IF*DATA*BASE*ERROR***                            *1      S01145 S01194
     C********** *IN63     IFEQ '1'                        ********S01145 S01194
     C**********           MOVEL'CLINT'   DBFILE           *       S01145 S01194
     C*********            MOVE CSNM      DBKEY     * DBERROR 006 *S01145 S01194
     C**********           MOVE DRSN      DBKEY            *       S01145 S01194
     C**********           MOVEL'006'     DBASE            *       S01145 S01194
     C**********           EXSR #ZD                        *       S01145 S01194
     C**********           GOTO #ZB9                       *       S01145 S01194
     C**********           END                             ********S01145 S01194
      *                                                                   S01194
      * Set up Customer no. as 10A parameter                              S01194
     C                     MOVE *BLANKS   @CUKEY                          S01194
     C                     MOVEL@DCNO     @CUKEY                          S01194
      *                                                                   S01194
      * Call Access Object to get Customer Shortname                      S01194
     C                     CALL 'AOCUSTR0'                                S01194
     C**************       PARM '*DBERR ' @RTCD   7                 S01194081473
      *                                                                   081473
      * Do not cause a daatbase error if Customer not found               081473
     C                     PARM *BLANKS   @RTCD   7                       081473
     C                     PARM '*KEY   ' @OPTN   7                       S01194
     C                     PARM           @CUKEY 10                       S01194
     C                     PARM *BLANKS   @KYST   7                       S01194
     C           SDCUST    PARM SDCUST    DSSDY                           S01194
     C*                                                    *1             S01145
     C*********            MOVE CSNM      @CUST            *1             S01145
     C**********           MOVE DRSN      @CUST            *1      S01145 S01194
      *                                                                   081473
      * If customer not found then clear the Customer details             081473
     C           @RTCD     IFEQ '*NRF   '                  Not Found      081473
     C                     CLEARSDCUST                                    081473
     C                     MOVEL'*None'   BBCSSN                          081473
     C                     ENDIF                                          081473
      *                                                                   081473
     C                     MOVELBBCSSN    @CUST            *1             S01194
     C*                    ELSE                            X1             E17654
     C*                    MOVE @DCSN     @CUST            *1             E17654
     C*                    END                             E1             E17654
     C*
     C*
     C**  DETERMINE WHICH CURRENCY IS ENQUIRY CCY AND SET UP FIELDS
     C**  ACCORDINGLY.
     C*
     C***********FHCCY1    IFEQ DDCCY                      B1             S01145
     C*********************MOVE FHCCY1    @CUR1            *1             S01145
     C*********************MOVE FHCCY2    @CUR2            *1             S01145
     C*********************ELSE                            X1             S01145
     C*********************MOVE FHCCY1    @CUR2            *1             S01145
     C*********************MOVE FHCCY2    @CUR1            *1             S01145
     C*********************END                             E1             S01145
     C           @CCY1     IFEQ DDCCY                      B1             S01145
     C                     MOVE @CCY1     @CUR1            *1             S01145
     C                     MOVE @CCY2     @CUR2            *1             S01145
     C                     ELSE                            X1             S01145
     C                     MOVE @CCY1     @CUR2            *1             S01145
     C                     MOVE @CCY2     @CUR1            *1             S01145
     C                     END                             E1             S01145
     C*
     C***SET*UP*KEY*TO*OBTAIN*FORMAT*TABTG10F**20******CCY1**             S01194
     C**********           MOVEL'20'      @KEY2                           S01194
     C**********           MOVEL@CUR2     @ENDKY                          S01194
     C**********           MOVE '1'       @ENDKY                          S01194
     C**********           MOVE @ENDKY    @KEY2                           S01194
     C**********                                                          S01194
     C***CHAIN*TO*FILE*FDCCYTLL*TO*OBTAIN*NON*ENQUIRY*DECIMAL*PLACES**    S01194
     C********** @KEY2     CHAINFDCCYTLL             61                   S01194
     C**********                                                          S01194
     C***DEAL*WITH*DATA*BASE*ERROR***                                     S01194
     C********** *IN61     IFEQ '1'                        B1             S01194
     C********** RECI      ORNE 'D'                        *1             S01194
     C**********           MOVEL'FDCCYTLL'DBFILE           *1***********  S01194
     C**********           MOVEL'005'     DBASE            *1 DBERR 005*  S01194
     C**********           MOVEL@KEY2     DBKEY            *1***********  S01194
     C**********           EXSR #ZD                        *1             S01194
     C**********           GOTO #ZB9                       *1             S01194
     C**********           END                             E1             S01194
      *                                                                   S01194
      * Get Enquiry Currency details via Access Object                    S01194
     C                     CALL 'AOCURRR0'                                S01194
     C                     PARM '*DBERR ' @RTCD   7                       S01194
     C                     PARM '*KEY   ' @OPTN   7                       S01194
     C                     PARM           @CUR2   3                       S01194
     C           SDCURR    PARM SDCURR    DSSDY                           S01194
     C*
     C** SET UP FIELD FOR ENQUIRY CCY DEC.PLACES.
     C**********           Z-ADDCDP       @CDP2   10                      S01194
     C                     Z-ADDA6NBDP    @CDP2   10                      S01194
     C*
     C**  IF IT IS AN ARBITRAGE DEAL TYPE DETERMINE WHETHER THE           S01145
     C**  REQUESTED DATE IS EQUAL TO THE ARBITRAGE NEAR OR FAR DATE AND   S01145
     C**  USE THE CORRESPONDING NEAR OR FAR DATE AMOUNT TO SET UP         S01145
     C**  @DAM1 & @DAM2                                                   S01145
     C**  THIS IS NOT NECCESSARY IF IT IS A FX DEAL TYPE AS THERE WILL    S01145
     C**  ONLY BE ONE AMOUNT TYPE                                         S01145
     C*
     C           @DTYP     IFEQ 'PS'                       B*1            SO1145
     C           JPNDYY    IFEQ @RCCYY                     B**2           S01145
     C           JPNDMM    ANDEQ@MM                        ***2           S01145
     C           JPNDDD    ANDEQ@KDD                       ***2           S01145
     C                     Z-ADDJPNDA1    @DAM1            ***2           S01145
     C                     Z-ADDJPNDA2    @DAM2            ***2           S01145
     C                     ELSE                            X**2           S01145
     C                     Z-ADDJPFDA1    @DAM1            ***2           S01145
     C                     Z-ADDJPFDA2    @DAM2            ***2           S01145
     C                     END                             E*2            S01145
     C                     END                             E*1            S01145
     C*
     C**  FIND THE REAL VALUE OF THE AMOUNTS, TAKING INTO ACCOUNT THAT
     C**  THE FIELDS WILL BE IN 000'S, AND THE NUMBER OF DECIMAL PLACES
     C**  FOR THE CURRENCY.
     C***********FHCCY1    IFEQ DDCCY                      B1             S01145
     C           @CCY1     IFEQ DDCCY                      B1             S01145
     C*
     C*********************Z-ADDFHDAM1    @DAMT  150       *1   S1132     S01145
     C                     Z-ADD@DAM1     @DAMT            *1             S01145
     C                     Z-ADD*ZERO     @H      10       *1
     C           @H        DOWNE@CDP1                      B*2
     C                     ADD  1         @H               **2
     C*********************DIV  10        FHDAM1           **2            S01145
     C                     DIV  10        @DAM1            **2            S01145
     C                     END                             E*2
     C*
     C*********************DIV  1000      FHDAM1    H      *1             S01145
     C                     DIV  1000      @DAM1     H      *1             S01145
     C*
     C*********************Z-ADDFHDAM1    @@NUM            *1             S01145
     C                     Z-ADD@DAM1     @@NUM            *1             S01145
     C                     EXSR ZA0860                     *1
     C                     MOVE @@ALPH    @AMT1            *1
     C*
     C                     Z-ADD*ZERO     @H               *1
     C           @H        DOWNE@CDP2                      B*2
     C                     ADD  1         @H               **2
     C*********************DIV  10        FHDAM2           **2            S01145
     C                     DIV  10        @DAM2            **2            S01145
     C                     END                             E*2
     C*
     C*********************DIV  1000      FHDAM2    H      *1             S01145
     C                     DIV  1000      @DAM2     H      *1             S01145
     C*
     C*********************Z-ADDFHDAM2    @@NUM            *1             SO1145
     C                     Z-ADD@DAM2     @@NUM            *1             S01145
     C                     EXSR ZA0860                     *1
     C                     MOVE @@ALPH    @AMT2            *1
     C*
     C**  OTHERWISE...
     C                     ELSE                            X1
     C*
     C*********************Z-ADDFHDAM2    @DAMT            *1             S01145
     C                     Z-ADD@DAM2     @DAMT            *1             S01145
     C                     Z-ADD*ZERO     @H               *1
     C           @H        DOWNE@CDP2                      B*2
     C                     ADD  1         @H               **2
     C*********************DIV  10        FHDAM1           **2            S01145
     C                     DIV  10        @DAM1            **2            S01145
     C                     END                             E*2
     C*
     C*********************DIV  1000      FHDAM1    H      *1             S01145
     C                     DIV  1000      @DAM1     H      *1             S01145
     C*
     C*********************Z-ADDFHDAM1    @@NUM            *1             S01145
     C                     Z-ADD@DAM1     @@NUM            *1             S01145
     C                     EXSR ZA0860                     *1
     C                     MOVE @@ALPH    @AMT2            *1
     C*
     C                     Z-ADD*ZERO     @H               *1
     C           @H        DOWNE@CDP1                      B*2
     C                     ADD  1         @H               **2
     C*********************DIV  10        FHDAM2           **2            S01145
     C                     DIV  10        @DAM2            **2            S01145
     C                     END                             E*2
     C*
     C*********************DIV  1000      FHDAM2    H      *1             S01145
     C                     DIV  1000      @DAM2     H      *1             S01145
     C*
     C*********************Z-ADDFHDAM2    @@NUM            *1             S01145
     C                     Z-ADD@DAM2     @@NUM            *1             S01145
     C                     EXSR ZA0860                     *1
     C                     MOVE @@ALPH    @AMT1            *1
     C*
     C                     END                             E1
     C           #ZB9      ENDSR                           ****#ZB9****
     C/EJECT                                                              S01166
     C****************************************************************    S01166
     C*                                                              *    S01166
     C*    #BC  WRITES TO ENQUIRY SUBFILE                            *    S01166
     C*        CALLED BY  : #BAA #BAB #BBA #BBB #BBCA #BBCB          *    S01166
     C*        CALLS      :                                          *    S01166
     C*                                                              *    S01166
     C****************************************************************    S01166
     C*                                                                   S01166
     C           #BC       BEGSR                                          S01166
     C*                                                                   S01166
     C* clear subfile                                                     S01166
     C           @SFLCL    IFEQ 'N'                                       S01166
     C                     SETOF                     3536                 S01166
     C**********           WRITEDL3130C1                           S01166 S01117
     C                     WRITETM3130C1                                  S01117
     C                     MOVE 'Y'       @SFLCL                          S01166
     C                     END                                            S01166
     C*                                                                   S01166
     C                     MOVE @DEAL     DDDEAL                          S01166
     C                     MOVE @CUST     DDCUST                          S01166
     C                     MOVE @AMT1     DDAMT1                          S01166
     C                     MOVE @CUR1     DDCUR1                          S01166
     C                     MOVE @CUR2     DDCUR2                          S01166
     C                     MOVE @AMT2     DDAMT2                          S01166
     C*                                                                   S01166
     C                     Z-ADD@A        RRN     20                      S01166
     C*                                                                   S01166
     C**********           WRITEDL3130S1                           S01166 S01117
     C                     WRITETM3130S1                                  S01117
     C*                                                                   S01166
     C           RRN       IFEQ 1                                         S01166
     C                     MOVEL@DEAL     @TOPDL                          S01166
     C                     END                                            S01166
     C*                                                                   S01166
      * Set subfile written flag                                          S01280
     C                     MOVE 'Y'       @SFILE  1                       S01280
     C                     ENDSR                                          S01166
     C/EJECT
     C****************************************************************
     C*                                                              *
     C*     #B CARRIES OUT THE MAIN PROCESSING.                      *
     C*        CALLED BY  : MAIN PROGRAM.                            *
     C*        CALLS      :                                          *
     C*                                                              *
     C*        WORK FIELDS: @RCCYY- YEAR FOR REQUESTED DATE          *
     C*                   : @KDD  - DAY FOR KEY FIELD                *
     C*                   : @RRK  - ROLL REFRESH KEY FILED           *    S01166
     C*                   : DDTOT - EDITED NET MOVEMENT OF CURRENCY  *    S01166
     C*                   : @YYC  - YEAR IN *CHAR FIELD              *
     C*                                                              *
     C****************************************************************
     C*
     C           #B        BEGSR
     C*                                                                   S01166
     C* set subfile clear flag                                            S01166
     C                     MOVE 'N'       @SFLCL  1                       S01166
     C*                                                                   S01166
     C* if there is data to refresh/roll etc allow cmd keys               S01166
     C           DDCURR    IFNE *BLANKS                    B1             S01166
     C                     SETON                     27    *1             S01166
     C                     END                             E1             S01166
     C*                                                                   S01166
     C           @FIRST    IFEQ 'Y'                        B1             S01166
     C                     MOVE 'N'       @FIRST           *1             S01166
     C                     ELSE                            X1             S01166
     C*                                                                   S01280
     C** Set up time for display                                          S01280
     C                     TIME           DDTIME                          S01280
     C* write heading text                                                S01166
     C**********           WRITEDL3130F0                   *1      S01166 S01117
     C                     WRITETM3130F0                   *1             S01117
     C*                                                                   S01166
     C                     SETON                     3536  *1             S01166
     C*                                                                   S01166
     C* write msg subfile if errors                                       S01166
     C           *IN69     IFEQ '1'                        B*2            S01166
     C                     SETON                     46    **2            S01166
     C**********           WRITEDL3130C0                   **2     S01166 S01117
     C                     WRITETM3130C0                   **2            S01117
     C                     ELSE                            X*2            S01166
     C**********           WRITEDL3130F1                   **2     S01166 S01117
     C                     WRITETM3130F1                   **2            S01117
     C                     END                             E*2            S01166
     C*                                                                   S01166
     C**setof*subfile*display*if*no*records***                     S01166 S01280
     C********** DDCURR    IFEQ *BLANKS                    B*2     S01166 S01280
     C********** *IN69     OREQ '1'                        B*2     S01166 S01280
     C**********           SETOF                     35    **2     S01166 S01280
     C**********           END                             E*2     S01166 S01280
     C* write totals then subfile control                                 S01166
      * Don't display totals if no records to display, do display         S01280
      * if error in validation of prompts (unless first time through)     S01280
      * If rollup/rolldown and no more records, display totals as         S01280
      * this implies there is already a subfile on screen                 S01280
     C********** *IN69     IFEQ '0'                        B*2     S01166 S01280
     C           *IN69     IFEQ '1'                        B*2            S01280
     C           *IN65     ANDEQ'0'                        B*2            S01280
     C           *IN66     ANDEQ'0'                        B*2            S01280
     C           @ENQ      ANDNE'U'                        B*2            S01280
     C           @ENQ      ANDNE'D'                        B*2            S01280
     C           DDCURR    OREQ *BLANKS                                   S01280
     C                     SETOF                     35                   S01280
      * Inhibit roll/refresh/previous keys                                S01280
     C                     SETOF                     27                   S01280
     C                     END                                            S01280
     C**********           WRITEDL3130F2                   **2     S01166 S01117
     C                     WRITETM3130F2                   **2            S01117
     C                     SETON                     35                   S01280
     C**********           END                             E*2            S01166
     C*                                                                   S01166
     C* setof subfile display if no records                               S01280
      * If already a subfile on screen, don't set off *IN35 - this        S01280
      * is needed to enable cleared subfile to be displayed               S01280
     C           DDCURR    IFEQ *BLANKS                    B*2            S01280
     C           *IN69     OREQ '1'                        B*2            S01280
     C           @SFILE    ANDNE'Y'                                       S01280
     C                     SETOF                     35    **2            S01280
     C                     END                             E*2            S01280
      *                                                                   S01280
     C**********           WRITEDL3130C1                   *1      S01166 S01117
     C                     WRITETM3130C1                   *1             S01117
     C*                                                                   S01166
     C                     SETOF                     0512  *1             S01166
     C                     SETOF                     2526  *1             S01166
     C*                                                                   S01166
     C**********           READ DL3130DD               0589*1read  S01166 S01117
     C                     READ TM3130DD               0589*1read scrn    S01117
     C*                                                                   S01166
     C* set up 'enq'                                                      S01166
     C                     MOVE *BLANK    @ENQ    1        **2            S01166
     C*                                                                   S01166
     C           *IN05     IFEQ '1'                        B*2            S01166
     C                     MOVE 'R'       @ENQ             **2            S01166
     C                     END                             E*2            S01166
     C*                                                                   S01166
     C           *IN25     IFEQ '1'                        B*2            S01166
     C                     MOVE 'U'       @ENQ             **2            S01166
     C                     END                             E*2            S01166
     C*                                                                   S01166
     C           *IN26     IFEQ '1'                        B*2            S01166
     C                     MOVE 'D'       @ENQ             **2            S01166
     C                     END                             E*2            S01166
     C*                                                                   S01166
     C* help                                                              S01166
     C**         *IN10     DOWEQ'1'                        B*2     S01166 S01199
     C**                   SETOF                     10    **2     S01166 S01199
     C**                   CALL 'SDMENU'                   **2     S01166 S01199
     C**********           READ DL3130DD               0589**2     S01166 S01280
     C**                   END                             E*2     S01166 S01199
     C*                                                                   S01166
     C* exit                                                              S01166
     C           *IN11     IFEQ '1'                        B*2            S01166
     C                     MOVE 'Q'       @T               **2            S01166
     C                     GOTO #B9                        **2            S01166
     C                     END                             E*2            S01166
     C*                                                                   S01166
     C* summary                                                           S01166
     C           *IN12     IFEQ '1'                        B*2            S01166
     C                     MOVE 'U'       @T               **2            S01166
     C                     GOTO #B9                        **2            S01166
     C                     END                             E*2            S01166
     C*                                                                   S01166
     C* selection if there is data and cmd key not pressed                S01166
      *                                                                   S01280
      * also check subfile being displayed before attempting to           S01280
      * read it to avoid a crash                                          S01280
     C           @ENQ      IFEQ *BLANK                     B*2            S01166
     C           DDCURR    ANDNE*BLANKS                    B*2            S01166
     C           *IN35     ANDEQ'1'                        B*2            S01280
     C*                                                                   S01166
     C           *IN89     DOWEQ'0'                        B**3           S01166
     C*                                                                   S01166
     C**********           READCDL3130S1                 89***3    S01166 S01117
     C                     READCTM3130S1                 89***3           S01117
     C           SSSLCT    IFNE *BLANK                     B***4          S01166
     C                     MOVE DDDEAL    @TOPDL           ****4          S01166
     C                     MOVE 'D'       @T               ****4          S01166
     C                     MOVE '1'       *IN13            ****4          S01166
     C                     GOTO #B9                        ****4          S01166
     C                     END                             E***4          S01166
     C                     END                             E**3           S01166
     C                     END                             E*2            S01166
     C*                                                                   S01166
     C* roll or refresh                                                   S01166
     C           @ENQ      IFEQ 'R'                        B*2            S01166
     C           @ENQ      OREQ 'U'                        B*2            S01166
     C           @ENQ      OREQ 'D'                        B*2            S01166
     C                     MOVE DDCURR    DDCCY            **2            S01166
     C                     MOVE DDDATE    DDDMY            **2            S01166
     C                     END                             E*2            S01166
     C*                                                                   S01166
     C                     END                             E1             S01166
     C*                                                                   S01166
     C* clear msg subfile                                                 S01166
     C                     CALL 'ZA0250'                                  S01166
     C                     SETOF                     656669               S01166
     C*                                                                   E42669
     C** If ccy is blanks, default to base ccy for dealing                E42669
     C*                                                                   E42669
     C           DDCCY     IFEQ *BLANKS                    B1             E42669
     C                     MOVELBNCYDL    DDCCY            *1             E42669
     C                     END                             E1             E42669
     C*                                                                   E42669
     C*                                                                   S01166
     C* validate ccy if get this far                                      S01166
      * (via Access Object)                                               S01194
     C**********           MOVEL'20'      @KEY2  12                S01166 S01194
     C**********           MOVELDDCCY     @ENDKY  4                S01166 S01194
     C**********           MOVE '1'       @ENDKY                   S01166 S01194
     C**********           MOVE @ENDKY    @KEY2                    S01166 S01194
     C**********                                                   S01166 S01194
     C********** @KEY2     CHAINFDCCYTLL             65            S01166 S01194
      *                                                                   S01194
     C                     CALL 'AOCURRR0'                                S01194
     C                     PARM *BLANKS   @RTCD   7                       S01194
     C                     PARM '*KEY   ' @OPTN   7                       S01194
     C                     PARM           DDCCY   3                       S01194
     C           SDCURR    PARM SDCURR    DSSDY                           S01194
     C*                                                                   S01166
     C**  If record found                                                 S01166
     C** SET UP FIELD FOR ENQUIRY CCY DEC.PLACES.                         S01166
     C********** *IN65     IFNE '1'                        B1      S01166 S01194
     C           @RTCD     IFEQ *BLANKS                    B1             S01194
     C********** RECI      ANDEQ'D'                        B1      S01166 S01194
     C**********           Z-ADDCDP       @CDP1   10       *1      S01166 S01194
     C                     Z-ADDA6NBDP    @CDP1   10       *1             S01194
     C                     ELSE                            X1             S01166
     C**********           SETON                     69    *1      S01166 S01194
     C                     SETON                     6965  *1             S01194
     C                     MOVEL'RTM0002' @MSGID           *1             S01166
     C                     CALL 'ZA0240'                   *1             S01166
     C                     PARM           @MSGID           *1             S01166
     C                     END                             E1             S01166
     C*                                                                   E42669
     C**If blanks and valid ccy entered default to spot date for the ccy  E42669
     C*                                                                   E42669
     C           DDDMY     IFEQ *BLANKS                    B1             E42669
     C           *IN65     ANDEQ'0'                        B1             E42669
     C                     MOVE A6FXSD    @RDATE           *1             E42669
     C                     MOVE @KDD      @DD              *1             E42669
     C                     MOVE @RCCYY    @YY              *1             E42669
     C                     MOVE @MN,@MM   @MMM             *1             E42669
     C                     END                             E1             E42669
     C*                                                                   S01166
     C* validate date                                                     S01166
     C*  lookup mnth                                                      S01166
     C                     Z-ADD1         @M      20                      S01166
     C           @MMM      LOKUP@MN,@M                   89               S01166
     C*                                                                   S01166
     C*  check day and year numeric                                       S01166
     C           *IN89     IFEQ '1'                        B1             S01166
     C                     TESTN          @DD        89    *1             S01166
     C                     END                             E1             S01166
     C*                                                                   S01166
     C           *IN89     IFEQ '1'                        B1             S01166
     C                     TESTN          @YYC       89    *1             S01166
     C                     END                             E1             S01166
     C*                                                                   S01166
     C* if still ok convert to midas date                                 S01166
     C           *IN89     IFEQ '1'                        B1             S01166
     C                     MOVE @DD       @SRDD            *1             S01166
     C                     Z-ADD@M        @SRMM            *1             S01166
     C                     MOVE @YYC      @SRYY            *1             S01166
     C                     MOVE @SRDAT    DDMMYY  60                      S01166
     C                     MOVE 'D'       @DATF   1        *1             S01166
     C*                                                                   S01166
     C                     CALL 'ZA0270'                   *1             S01166
     C                     PARM           DDMMYY           *1             S01166
     C                     PARM           @DATF            *1             S01166
     C           @RTCDE    PARM           @RTCDE  1        *1             S01166
     C           @@MNO     PARM           @@MNO   50       *1             S01166
     C*                                                                   S01166
     C           @RTCDE    IFEQ '1'                        B*2            S01166
     C                     MOVEL'RTM0003' @MSGID 10        **2            S01166
     C                     CALL 'ZA0240'                   **2            S01166
     C                     PARM           @MSGID           **2            S01166
     C                     MOVE '1'       *IN69            **2            S01166
     C                     MOVE '1'       *IN66            **2            S01166
     C*                                                                   S01166
     C******************** ELSE                            X*2      S01166E21656
     C********************                                          S01166E21656
     C**if ccy was found see if date is holiday                     S01166E21656
     C*********  *IN65     IFEQ '0'                        B**3     S01166E21656
     C******************** MOVE DDCCY     @@CCY                     S01166E21656
     C******************** EXSR ZA0830                              S01166E21656
     C********************                                          S01166E21656
     C*********  @@HIND    IFEQ 'H'                        B***4    S01166E21656
     C******************** MOVEL'RTM0007' @MSGID           ****4    S01166E21656
     C******************** CALL 'ZA0240'                   ****4    S01166E21656
     C******************** PARM           @MSGID           ****4    S01166E21656
     C******************** MOVE '1'       *IN69            ****4    S01166E21656
     C******************** MOVE '1'       *IN66            ****4    S01166E21656
     C******************** END                             E***4    S01166E21656
     C******************** END                             E**3     S01166E21656
     C                     END                             E*2            S01166
     C*                                                                   S01166
     C                     ELSE                            X1             S01166
     C                     MOVEL'RTM0003' @MSGID           *1             S01166
     C                     CALL 'ZA0240'                   *1             S01166
     C                     PARM           @MSGID           *1             S01166
     C                     MOVE '1'       *IN69            *1             S01166
     C                     MOVE '1'       *IN66            *1             S01166
     C                     END                             E1             S01166
     C*                                                                   S01166
      ** If requested date is less than run date, then error              S01280
     C           @@MNO     IFLT BJRDNB                     B1             S01280
     C                     MOVEL'RTM0005' @MSGID                          S01280
     C                     CALL 'ZA0240'                                  S01280
     C                     PARM           @MSGID                          S01280
     C                     MOVE '1'       *IN69                           S01280
     C                     MOVE '1'       *IN66                           S01280
     C                     END                             E1             S01280
      *                                                                   S01280
     C           *IN69     IFEQ '1'                                       S01166
     C                     GOTO #B9                                       S01166
     C                     END                                            S01166
     C*                                                                   S01166
     C********If this enquiry was requested for a non-existant currency   S01166
     C******** a screen containing only input currency name               S01166
     C******** should be sent to the PC.                                  S01166
     C********                                                            S01166
     C******** DEAL WITH DATA BASE ERROR                                  S01166
     C********** *IN61     IFEQ '1'                        B1             S01166
     C********** RECI      ORNE 'D'                        *1             S01166
     C************         MOVEL'FDCCYTLL'DBFILE           *1***********  S01166
     C************         MOVEL'004'     DBASE            *1DB ERR 004*  S01166
     C************         MOVEL@KEY2     DBKEY            *1***********  S01166
     C************         EXSR #ZD                        *1             S01166
     C************         GOTO #B9                        *1             S01166
     C************         END                             E1             S01166
     C************                                                        S01166
     C************ IF TERMINATION CODE = T, TERMINATE PROGRAM.            S01166
     C***        @T        IFEQ 'T'                        B1             S01166
     C***                  MOVE '1'       *INLR            *1             S01166
     C***                  GOTO #B9                        *1             S01166
     C***                  END                             E1             S01166
     C***                                                                 S01166
     C*** ACCESS DATA AREA                                                S01166
     C***        *LOCK     IN   AMENQ1                                    S01166
     C***                  MOVE *BLANKS   AMENQ1                          S01166
     C*******************  MOVEL*BLANK    @START                          S01166
     C***                                                                 S01166
     C*   INITIALISE ARRAY USED TO SET UP OUTPUT DETAILS.                 S01166
     C                     MOVEA*BLANKS   @AR
     C*
     C*** ACCESS CURRENT PROMPTS FILE                                     S01166
     C***        1         CHAINFX38CPLL             61                  SS01166
     C***        1         CHAINCA38CPLL             61                  SS01166
     C***                                                                 S01166
     C*** DEAL WITH DATA BASE ERROR                                       S01166
     C***        *IN61     IFEQ '1'                        B1             S01166
     C***                  MOVE 'FX38CPLL'DBFILE           *1***********S1S01166
     C***                  MOVE 'CA38CPLL'DBFILE           *1***********S1S01166
     C***                  MOVE '002'     DBASE            *1DB ERR 002*  S01166
     C***                  EXSR #ZD                        *1***********  S01166
     C***                  GOTO #B9                        *1             S01166
     C***                  END                             E1             S01166
     C***                                                                 S01166
     C*** LOAD NARRATIVE INTO DATA AREA MASK                              S01166
     C***                  MOVEL'FWD BOOK'@FWDBK                          S01166
     C***                  MOVEL'- DAILY' @HYPH                           S01166
     C***                  MOVEL'DEALS'   @DEALS                          S01166
     C***                  MOVEL'(000''S)'@000S                           S01166
     C***                  MOVEL'DAILY'   @DAILY                          S01166
     C***                  MOVEL'TOTAL'   @TOTAL                          S01166
     C***                                                                 S01166
     C*** IF CURRENT PROMPT YEAR IS BLANK USE SYSTEM YEAR                 S01166
     C***        @YYC      IFEQ *BLANKS                    B1             S01166
     C***                  MOVE @@Z71Y    @YY              *1             S01166
     C***                  END                             E1             S01166
     C***                                                                 S01166
     C*** SET UP DATE FOR SCREEN.                                         S01166
     C***                  MOVE DDDMY     DDDATE                          S01166
     C*                                                                   S01166
     C***IF CURRENT YEAR IS LESS THAN 72 ADD 1 TO CURRENT CENTURY         S01166
     C           @YY       IFLT 72                         B1             S01166
     C           @CC       ANDLT20                         B1             167048
     C                     ADD  1         @CC              *1             S01166
     C                     END                             E1             S01166
     C*                                                                   S01166
     C                     MOVE @YY       @CCYY   40                      S01166
     C                     MOVEL@CC       @CCYY                           S01166
     C                     Z-ADD@CCYY     @RCCYY                          S01166
     C*                                                                   S01166
     C*** CONVERT MONTH FROM MMM TO MM FORMAT                             S01166
     C***                  Z-ADD1         @X                              S01166
     C***        @MMM      LOKUP@MN,@X                   61               S01166
     C***        @MMM      LOKUP@MN,@X                   62               S01166
     C                     Z-ADD@M        @MM                             S01166
     C                     MOVEL@DD       @KDD                            S01166
     C*                                                                   S01166
     C*   ROLL REFRESH KEY FIELD TO KEY                                   S01166
     C***                  MOVEL@RRK      @PARM                           S01166
     C*
     C*** If no record for currency was found on currencies file          S01166
     C*** exit routine after passing data to PC                           S01166
     C***        *IN61     IFEQ '1'                        B1             S01166
     C***        RECI      ORNE 'D'                        *1             S01166
     C***                  MOVEL'END  '   @START           *1             S01166
     C***                                                                 S01136
     C***RELEASE CURRENT PROMPTS                                          S01136
     C***                  EXCPT@RLS01                     *1             S01136
     C***                  EXSR #ZA                        *1             S01166
     C***                  GOTO #B9                        *1             S01166
     C***                  END                             E1             S01166
     C*
     C**  ACCESS FORWARD BOOK FILE
     C           @KEY      CHAINFXFWDTLL             61
     C*
     C**  FIND REAL VALUE FOR DAILY NET MOVEMENT OF CURRENCY
     C                     Z-ADD*ZERO     @A
     C*
     C********** @A        DOWNECDP                        B1             S01194
     C           @A        DOWNEA6NBDP                     B1             S01194
     C                     ADD  1         @A               *1
     C                     DIV  10        FPDYNM           *1
     C                     END                             E1
     C*
     C                     DIV  1000      FPDYNM    H
     C*
     C**  EDIT DAILY NET MOVEMENT OF CURRENCY
     C                     Z-ADDFPDYNM    @@NUM
     C                     EXSR ZA0860
     C                     MOVE @@ALPH    DDTOT                           S01166
     C*                                                                   S01166
     C* initialise start/end and subfile end                              S01166
     C                     SETOF                     30                   S01166
     C*                                                                   S01166
     C****IF OPTIONS ON VALUE IND. = N PROCESS FXDLVALL                   S01145
     C*   IF OPTIONS ON VALUE IND. = N PROCESS CADLVALL                   S01145
     C*****      FWOVDI    CASEQ'N'       #BA                             S01319
     C           EROVDI    CASEQ'N'       #BA                             S01319
     C                     CAS            #BB
     C                     END
     C*
      * Always set up header fields even if no records found              S01280
     C********** *IN69     IFEQ '0'                        B1      S01166 S01280
     C                     MOVE DDCCY     DDCURR           *1             S01166
     C                     MOVE DDCCY     DDCUR            *1             S01166
     C                     MOVE DDDMY     DDDATE           *1             S01166
     C                     MOVE @START    DDSTAR           *1             S01166
     C**********           END                             E1      S01166 S01280
      *                                                                   S01280
      * If no records found clear subfile                                 S01280
      * unless rollup or rolldown selected                                S01280
     C           *IN69     IFEQ '1'                                       S01280
     C           @ENQ      ANDNE'U'                                       S01280
     C           @ENQ      ANDNE'D'                                       S01280
     C                     SETOF                     3536                 S01280
     C                     WRITETM3130C1                                  S01280
     C                     MOVEL'  END'   @START                          S01280
     C                     END                                            S01280
     C*                                                                   S01166
     C           #B9       ENDSR                           ****#B9****    S01166
     C*
     C/EJECT                                                              S01166
     C********************************************************************S01166
     C**                                                                  S01166
     C**ZA0830 - THIS SUBROUTINE FINDS OUT WHETHER A PARTICULAR DAY       S01166
     C**         IS A HOLIDAY IN A PARTICULAR CURRENCY                    S01166
     C**                                                                  S01166
     C**CALLED BY :                                                       S01166
     C**                                                                  S01166
     C**CALLS :                                                           S01166
     C**                                                                  S01166
     C* INPUT  : @@MNO  MIDAS DAY NUMBER 5N                               S01166
     C*          @@CCY CURRENCY CODE 3A                                   S01166
     C*                                                                   S01166
     C* OUTPUT : @@HIND HOLIDAY/WORKING DAY INDICATOR 1A                  S01166
     C*                                                                   S01166
     C* USES :   @@MNO  MIDAS DAY NUMBER                                  S01166
     C*          @@CCY  CURRENCY CODE                                     S01166
     C*          @@ONCE FIRST TIME THROUGH INDICATOR                      S01166
     C*          @@CY1  FIRST HALF OF CURRENCY ARRAY                      S01166
     C*          @@CY2  SECOND HALF OF CURRENCY ARRAY                     S01166
     C*          @@MNO6 MIDAS NUMBER WITH TRAILING BLANK                  S01166
     C*          @@HIND HOLIDAY/WORKING DAY INDICATOR                     S01166
     C*          @@INEX INCLUDE/EXCLUDE INDICATOR                         S01166
     C*                                                                   S01166
     C*          INDICATORS                                               S01166
     C*          80 RECORD NOT FOUND                                      S01166
     C*          81 CURRENCY NOT FOUND ON RECORD                          S01166
     C*                                                                   S01166
     C********************************************************************S01166
     C********** ZA0830    BEGSR                                    S01166E21656
     C**********                                                    S01166E21656
     C***OPEN CURRENCY/HOLIDAY FILE IF FIRST TIME THROUGH           S01166E21656
     C********** @@ONCE    IFNE 'Y'                        B1       S01166E21656
     C******************** OPEN FDTABJLL                   *1       S01166E21656
     C******************** MOVE 'Y'       @@ONCE  1        *1       S01166E21656
     C******************** END                             E1       S01166E21656
     C********************                                          S01166E21656
     C***BLANK OUT ARRAY                                            S01166E21656
     C******************** MOVE *BLANKS   @@CY1                     S01166E21656
     C******************** MOVE *BLANKS   @@CY2                     S01166E21656
     C********************                                          S01166E21656
     C***ACCESS TABLE ON FIRST KEY                                  S01166E21656
     C******************** MOVEL@@MNO     @@MNO6  6                 S01166E21656
     C******************** MOVE @@MNO6    @@0830 12                 S01166E21656
     C******************** MOVEL'22    '  @@0830                    S01166E21656
     C******************** MOVE '1'       @@0830                    S01166E21656
     C********** @@0830    CHAINTABLETJF             80             S01166E21656
     C********************                                          S01166E21656
     C***IF RECORD NOT FOUND OR DELETED                             S01166E21656
     C********** *IN80     IFEQ '1'                        B1       S01166E21656
     C********** RECI      OREQ '*'                        *1       S01166E21656
     C******************** MOVE 'W'       @@HIND           *1       S01166E21656
     C******************** GOTO ZA0839                     *1       S01166E21656
     C******************** END                             E1       S01166E21656
     C********************                                          S01166E21656
     C** MOVE FIRST 25 CURRENCIES TO ARRAY                          S01166E21656
     C******************** MOVE HCCY      @@CY1                     S01166E21656
     C********************                                          S01166E21656
     C** ACCESS TABLE ON SECOND KEY                                 S01166E21656
     C******************** MOVE '2'       @@0830                    S01166E21656
     C********** @@0830    CHAINTABLETJF             80             S01166E21656
     C********************                                          S01166E21656
     C** IF SECOND RECORD FOUND AND NOT DELETED                     S01166E21656
     C********** *IN80     IFEQ '0'                        B1       S01166E21656
     C********** RECI      ANDNE'*'                        *1       S01166E21656
     C******************** MOVE HCCY      @@CY2            *1       S01166E21656
     C******************** END                             E1       S01166E21656
     C********************                                          S01166E21656
     C** SEARCH ARRAY FOR INPUT CURRENCY                            S01166E21656
     C********** @@CCY     LOKUP@CY                      81         S01166E21656
     C**********                                                    S01166E21656
     C** IF INPUT CURRENCY IS IN ARRAY                              S01166E21656
     C********** *IN81     IFEQ '1'                        B1       S01166E21656
     C**********                                                    S01166E21656
     C** IF INCLUDE/EXCLUDE INDICATOR EQ 'E'                        S01166E21656
     C********** INEX      IFEQ 'E'                        B*2      S01166E21656
     C******************** MOVE 'W'       @@HIND  1        **2      S01166E21656
     C******************** ELSE                            X*2      S01166E21656
     C******************** MOVE 'H'       @@HIND           **2      S01166E21656
     C******************** END                             E*2      S01166E21656
     C******************** END                             E1       S01166E21656
     C********************                                          S01166E21656
     C** IF INPUT CURRENCY IS NOT IN ARRAY                          S01166E21656
     C********** *IN81     IFEQ '0'                        B1       S01166E21656
     C**********                                                    S01166E21656
     C** IF INCLUDE/EXCLUDE INDICATOR EQ 'I'                        S01166E21656
     C********** INEX      IFEQ 'I'                        B*2      S01166E21656
     C******************** MOVE 'W'       @@HIND           **2      S01166E21656
     C******************** ELSE                            X*2      S01166E21656
     C******************** MOVE 'H'       @@HIND           **2      S01166E21656
     C******************** END                             E*2      S01166E21656
     C******************** END                             E1       S01166E21656
     C********** ZA0839    ENDSR                                    S01166E21656
     C/EJECT
     C****************************************************************    S01166
     C***                                                            *    S01166
     C***  #ZA SEND DATA TO PC                                       *    S01166
     C***      CALLED BY  : #BA #BB #ZC                              *    S01166
     C***      CALLS      :                                          *    S01166
     C***                                                            *    S01166
     C***      WORK FIELDS:                                          *    S01166
     C***                                                            *    S01166
     C****************************************************************    S01166
     C***                                                                 S01166
     C***        #ZA       BEGSR                                          S01166
     C***                                                                 S01166
     C*** WRITE OUT DATA AREA                                             S01166
     C***                  OUT  AMENQ1                                    S01166
     C***                                                                 S01166
     C*** SEND DATA TO CONTROL MODULE                                     S01166
     C***                  CALL 'CM0020'                                  S01166
     C***                  PARM *BLANK    @T      1                       S01166
     C***                  PARM 'ER'      @EMID   2                       S01166
     C***                  PARM '1'       @SWER   1                       S01166
     C***                  PARM @ENQ      @ENQU   1                       S01166
     C***                  PARM @ENQN     @ENQN   3                       S01166
     C***                  PARM *BLANK    @PARM5  1                       S01166
     C***                                                                 S01166
     C***        #ZA9      ENDSR                           ****#ZA9****   S01166
     C***                                                                 S01166
     C/EJECT
     C****************************************************************    S01166
     C***                                                            *    S01166
     C***  #ZC END PROCESSING                                        *    S01166
     C***      CALLED BY  : #BA #BB                                  *    S01166
     C***      CALLS      :                                          *    S01166
     C***                                                            *    S01166
     C***      WORK FIELDS: @ENQN - ENQUIRY NUMBER                   *    S01166
     C***                 : @START- START/END FOR DISPLAY            *    S01166
     C***                 : @LIN  - LINES OF DATA AREA MASK          *    S01166
     C***                                                            *    S01166
     C****************************************************************    S01166
     C***                                                                 S01166
     C***        #ZC       BEGSR                                          S01166
     C***                                                                 S01166
     C*** IF ENQ TYPE = LAST PAGE MOVE 'END' TO START/END                 S01166
     C***        @ENQ      IFEQ 'L'                        B1             S01166
     C***                  MOVEL'  END'   @START           *1             S01166
     C***                  END                             E1             S01166
     C***                                                                 S01166
     C*** MOVE DISPLAY ARRAY TO DATA AREA MASK                            S01166
     C***                  MOVEA@AR,1     @LIN1                           S01166
     C***                  MOVEA@AR,5     @LIN5                           S01166
     C***                  MOVEA@AR,9     @LIN9                           S01166
     C***                                                                 S01166
     C*** UPDATE CURRENT PROMPTS FILE                                     S01166
     C***                  UPDATFX38CPP0                                  S01166
     C***        @FLAG     IFEQ 'Y'                        B1             E12931
     C***                  Z-ADD0         @TOP1                           E12193
     C***                  Z-ADD@FDATE    @TOP2                           E12931
     C***                  Z-ADD0         @TOP3                           E12931
     C***                  Z-ADD0         @BOT1                           E12931
     C***                  Z-ADD@FDATE    @BOT2                           E12931
     C***                  Z-ADD0         @BOT3                           E12931
     C***                  END                             E1             E12931
     C***                  UPDATCA38CPP0                                 SS01166
     C***                                                                 S01166
     C*** UPDATE ENQUIRY NUMBER AND SEND DATA TO PC                       S01166
     C***                  MOVE '006'     @ENQN                           S01166
     C***                  EXSR #ZA                                       S01166
     C***                                                                 S01166
     C***        #ZC9      ENDSR                           ****#ZC9****   S01166
     C***                                                                 S01166
     C/EJECT
     C****************************************************************
     C*                                                              *
     C*     #C CARRIES OUT THE TERMINATION PROCESSING.               *
     C*        CALLED BY  : MAIN PROGRAM                             *
     C*        CALLS      :                                          *
     C*                                                              *
     C*        WORK FIELDS:                                          *
     C*                                                              *
     C****************************************************************
     C           #C        BEGSR
     C*
     C           *INU7     IFEQ '1'                        B1
     C                     MOVE 'E'       @T               *1
     C                     MOVE '1'       *INLR            *1
     C                     END                             E1
     C*
     C***        @T        IFEQ 'T'                        B1             S01166
     C                     MOVE '1'       *INLR            *1
     C***                  END                             E1             S01166
     C*
     C                     RETRN
     C*
     C           #C9       ENDSR                           ***#C9***
     C/EJECT                                                              E49802
     C*****************************************************************   E49802
     C*                                                               *   E49802
     C*    #BAAA read Forward CADLVALL  for Option Deals.             *   E49802
     C*        Called By  : #                                         *   E49802
     C*        Calls                                                  *   E49802
     C*                                                               *   E49802
     C*        Work Fields:                                           *   E49802
     C*                                                               *   E49802
     C*****************************************************************   E49802
     C*                                                                   E49802
     C           #BAAA     BEGSR                                          E49802
     C*                                                                   E49802
     C*                                                                   E49802
     C           @KEY      READECADLVALL                 61               E49802
     C           FHDTYP    DOWEQ'O'                        B1             E49802
     C           @ODATE    ANDNE@RDATE                     B1             E49802
     C           *IN61     ANDEQ'0'                        *1             E49802
     C           @KEY      READECADLVALL                 61*1             E49802
     C                     END                             E1             E49802
     C*                                                                   E49802
     C           #BAAA9    ENDSR                           ***#BAAA9***   E49802
     C/EJECT                                                              E49802
     C*****************************************************************   E49802
     C*                                                               *   E49802
     C*    #BABA read Backward CADLVALL for Option Deals.             *   E49802
     C*        Called By  :                                           *   E49802
     C*        Calls      :                                           *   E49802
     C*                                                               *   E49802
     C*        Work Fields: @RDATE - requested date                   *   E49802
     C*                                                               *   E49802
     C*****************************************************************   E49802
     C*                                                                   E49802
     C           #BABA     BEGSR                                          E49802
     C*                                                                   E49802
     C                     READPCADLVALL                 61               E49802
     C*                                                                   E49802
     C*                                                                   E49802
     C           FHDTYP    DOWEQ'O'                        B1             E49802
     C           @ODATE    ANDNE@RDATE                     B1             E49802
     C           *IN61     ANDEQ'0'                        *1             E49802
     C                     READPCADLVALL                 61*1             E49802
     C                     END                             E1             E49802
     C*                                                                   E49802
     C           #BABA9    ENDSR                           ***#BABA9***   E49802
     C/EJECT
     C****************************************************************
     C*                                                              *
     C*****#BBAA READ FORWARD FXFDLALL                               *    S01145
     C*    #BBAA READ FORWARD CAFDLALL                               *    S01145
     C*        CALLED BY  : #BAA                                     *
     C*        CALLS      :                                          *
     C*                                                              *
     C*        WORK FIELDS: @RDATE - REQUESTED DATE                  *
     C*                   : @@VDT  - RUN DATE                        *
     C*                   : @START - START/END FOR DISPLAY           *    S01166
     C*                                                              *
     C****************************************************************
     C*
     C           #BBAA     BEGSR
     C*
     C**  UNLESS REQUESTED DATE IS > MIDAS DATE IGNORE OPTION DEALS
     C***********@KEY      READEFXFDLALL                 61               S01145
     C           @KEY      READECAFDLALL                 61               S01145
     C           @RDATE    IFLE @@VDT                      B1
     C           FHDTYP    DOWEQ'O'                        B*2
     C           *IN61     ANDEQ'0'                        **2
     C***********@KEY      READEFXFDLALL                 61**2            S01145
     C           @KEY      READECAFDLALL                 61**2            S01145
     C                     END                             E*2
     C*
     C                     END                             E1
     C*
     C           *IN61     IFEQ '1'                        B1
     C                     MOVEL'  END'   @START  5        *1             S01166
     C                     SETON                     30    *1             S01166
     C                     END                             E1
     C*
     C           #BBAA9    ENDSR                           ***#BBAA9***
     C/EJECT
     C****************************************************************
     C*                                                              *
     C*****#BBBA READ BACKWARD FXFDLALL                              *    S01145
     C*    #BBBA READ BACKWARD CAFDLALL                              *    S01145
     C*        CALLED BY  : #BBB                                     *
     C*        CALLS      :                                          *
     C*                                                              *
     C*        WORK FIELDS: @RDATE - REQUESTED DATE                  *
     C*                   : @FDATE - FILE DATE                       *
     C*                   : DDCCY  - CURRENCY                        *    S01166
     C*                                                              *
     C****************************************************************
     C*
     C           #BBBA     BEGSR
     C*
     C**  READ FORWARD BOOK FILE AND CHECK FOR END OF GROUP
     C                     MOVE '0'       *IN01
     C                     MOVE '0'       *IN02
     C*********************READPFXFDLALL                 61               S01145
     C                     READPCAFDLALL                 61               S01145
     C*
     C**  TEST FOR END OF GROUP. *IN61 = START OF FILE, @FDATE = FILE
     C**  DATE, @RDATE = REQUESTED DATE,DDCCY = CURRENCY. *IN01 IS ON     S01166
     C**  IF A RECORD HAS BEEN READ FROM FORMAT 1 OR 3 *IN02 IS ON IF
     C**  A RECORD HAS BEEN READ FROM FORMAT 2 OR 4 (SEE INPUT SPECS).
     C**  IF A RECORD IS READ FROM FORMAT 1 OR 3 TEST 1ST CURRENCY.
     C**  IF A RECORD IS READ FROM FORMAT 2 OR 4 TEST 2ND CURRENCY.
     C           *IN61     IFEQ '1'                        B1
     C           @FDATE    ORNE @RDATE                     *1
     C           *IN01     OREQ '1'                        *1
     C***********DDCCY     ANDNEFHCCY1                     *1             S01145
     C           DDCCY     ANDNE@CCY1                      *1             S01145
     C           *IN02     OREQ '1'                        *1
     C***********DDCCY     ANDNEFHCCY2                     *1             S01145
     C           DDCCY     ANDNE@CCY2                      *1             S01145
     C                     MOVEL'START'   @START           *1             S01166
     C                     END                             E1
     C*
     C** IF REQUEST DATE IS LESS THAN OR = TODAY IGNORE OPTION DEALS
     C           @RDATE    IFLE @@VDT                      B1
     C*
     C           FHDTYP    DOWEQ'O'                        B*2
     C           *IN61     ANDEQ'0'                        **2
     C                     MOVE '0'       *IN01            **2
     C                     MOVE '0'       *IN02            **2
     C*********************READPFXFDLALL                 61**2            S01145
     C                     READPCAFDLALL                 61**2            S01145
     C*
     C**  TEST FOR END OF GROUP. *IN61 = START OF FILE, @FDATE = FILE
     C**  DATE, @RDATE = REQUESTED DATE,DDCCY = CURRENCY. *IN01 IS ON     S01166
     C**  IF A RECORD HAS BEEN READ FROM FORMAT 1 OR 3 *IN02 IS ON IF
     C**  A RECORD HAS BEEN READ FROM FORMAT 2 OR 4 (SEE INPUT SPECS).
     C**  IF A RECORD IS READ FROM FORMAT 1 OR 3 TEST 1ST CURRENCY.
     C**  IF A RECORD IS READ FROM FORMAT 2 OR 4 TEST 2ND CURRENCY.
     C           *IN61     IFEQ '1'                        B**3
     C           @FDATE    ORNE @RDATE                     ***3
     C           *IN01     OREQ '1'                        ***3
     C***********DDCCY     ANDNEFHCCY1                     ***3           S01145
     C           DDCCY     ANDNE@CCY1                      ***3           S01145
     C           *IN02     OREQ '1'                        ***3
     C***********DDCCY     ANDNEFHCCY2                     ***3           S01145
     C           DDCCY     ANDNE@CCY2                      ***3           S01145
     C                     MOVEL'START'   @START           ***3           S01166
     C                     END                             E**3
     C*
     C                     END                             E*2
     C*
     C                     END                             E1
     C*
     C           #BBBA9    ENDSR                           ***#BBBA9***
     C/EJECT
     C****************************************************************
     C*                                                              *
     C*****#BA  CARRIES OUT FXDLVALL PROCESSING  .********************    S01145
     C*    #BA  CARRIES OUT CADLVALL PROCESSING  .                   *    S01145
     C*        CALLED BY  : #B                                       *
     C*        CALLS      :                                          *
     C*                                                              *
     C*        WORK FIELDS: @WDEAL- FIRST DEAL NO. FOR GROUP         *
     C*                   : @ENQ  - ENQUIRY TYPE                     *
     C*                                                              *
     C****************************************************************
     C*
     C           #BA       BEGSR
     C*
     C****USE CURRENCY - SETLL ON FXDLVALL - READ FILE AND STORE DATE.    S01145
     C***********@KEY      SETLLFXDLVALL                                  S01145
     C*********************READ FXDLVALL                 61               S01145
     C**  USE CURRENCY - SETLL ON CADLVALL - READ FILE AND STORE DATE.    S01145
     C           @KEY      SETLLCADLVALL                                  S01145
     C                     READ CADLVALL                 61               S01145
     C*
     C*                                                                   S01408
     C/COPY WNCPYSRC,TM3130CCP1                                           S01408
     C*                                                                   S01408
     C           *IN61     IFEQ '1'                        B1             S01166
     C                     MOVEL'RTM0008' @MSGID           *1             S01166
     C                     CALL 'ZA0240'                   *1             S01166
     C                     PARM           @MSGID           *1             S01166
     C                     MOVE '1'       *IN69            *1             S01166
     C                     MOVE '1'       *IN66            *1             S01166
     C                     GOTO #BA9                       *1             S01166
     C                     END                             E1             S01166
     C*                                                                   S01408
     C/COPY WNCPYSRC,TM3130CCP2                                           S01408
     C*                                                                   S01408
     C*                                                                   S01166
     C*********************MOVE FHDN38    @WDEAL                          S01145
     C                     MOVE @DN38     @WDEAL                          S01145
     C*
     C**  NEW ENQUIRY OR FIRST PAGE PROCESSING
     C           @ENQ      IFEQ *BLANK                                    S01166
     C           @ENQ      OREQ 'F'                                       S01166
     C***********@KEY      SETLLFXDLVALL                   *1             S01145
     C           @KEY      SETLLCADLVALL                   *1             S01145
     C                     END                             E1
     C*
     C**  ENQUIRY TYPE ROLL UP
     C           @ENQ      IFEQ 'U'                                       S01166
     C                     Z-ADD@BOT3     @AMT             *1             S01166
     C                     Z-ADD@BOT1     @KDEAL           *1             S01166
     C***********@KEY1     SETGTFXDLVALL                   *1             S01145
     C           @KEY1     SETGTCADLVALL                   *1             S01145
     C                     END                             E1
     C*
     C**  ENQUIRY TYPE REFRESH
     C           @ENQ      IFEQ 'R'                        B1             S01166
     C                     Z-ADD@TOP3     @AMT             *1             S01166
     C                     Z-ADD@TOP1     @KDEAL           *1             S01166
     C***********@KEY1     SETLLFXDLVALL                   *1             S01145
     C           @KEY1     SETLLCADLVALL                   *1             S01145
     C                     END                             E1
     C*
     C*** ENQUIRY TYPE LAST PAGE                                          S01166
     C***        @ENQ      IFEQ 'L'                        B1             S01166
     C***        @KEY      SETGTFXDLVALL                   *1             S01166
     C***                  END                             E1             S01166
     C*                                                                   S01166
     C**  ENQUIRY TYPE ROLL DOWN
     C           @ENQ      IFEQ 'D'                        B1             S01166
     C                     Z-ADD@TOP3     @AMT             *1             S01166
     C                     Z-ADD@TOP1     @KDEAL           *1             S01166
     C***********@KEY1     SETLLFXDLVALL                   *1             S01145
     C           @KEY1     SETLLCADLVALL                   *1             S01145
     C                     END                             E1
     C*
     C**  IF  ENQUIRY TYPE D/L PERFORM ROLL DOWN ELSE PERFORM ROLL UP
     C           @ENQ      CASEQ'D'       #BAB                            S01166
     C***        @ENQ      CASEQ'L'       #BAB                            S01166
     C                     CAS            #BAA
     C                     END
     C*
     C           #BA9      ENDSR                           ****#BA9***
     C*
     C/EJECT
     C****************************************************************
     C*                                                              *
     C*****#BB  CARRIES OUT FXFDLALL PROCESSING  .                   *    S01145
     C*    #BB  CARRIES OUT CAFDLALL PROCESSING  .                   *    S01145
     C*        CALLED BY  : #B                                       *
     C*        CALLS      :                                          *
     C*                                                              *
     C*        WORK FIELDS: @ENQ  - ENQUIRY TYPE                     *
     C*                   : @ENQN - ENQUIRY NUMBER                   *
     C*                   : @OOREC- RECORDS READ FROM OLD OPT FILE   *
     C*                   : @PDATE- INPUT PARAMETER DATE             *
     C*                   : @RDATE- REQUESTED DATE                   *
     C*                   : @TOPT - Top enquiry = option indicator   *    E13307
     C*                   : @BOPT - Bottom enq = option indicator    *    E12848
     C*                                                              *
     C****************************************************************
     C*
     C           #BB       BEGSR
     C*
     C****USE CURRENCY/DATE - SETLL ON FXFDLALL - READ FILE               S01145
     C***********@KEY      SETLLFXFDLALL                                  S01145
     C**  USE CURRENCY/DATE - SETLL ON CAFDLALL - READ FILE               S01145
     C           @KEY      SETLLCAFDLALL                                  S01145
     C*
     C****READ FXFDLALL                                                   S01145
     C**  READ CAFDLALL                                                   S01145
     C                     EXSR #BBAA
     C*
     C**  NOT FOUND SEND NO RECORDS ENQUIRY NO. TO PC - UNLESS NEW
     C**  ENQUIRY THEN SEND HEADINGS AND NORMAL COMPLETION NO. TO PC
     C           *IN61     IFEQ '1'                        B1
     C***                  MOVE 'Y'       @FLAG   1        *1             E12931
     C           @ENQ      IFEQ *BLANK                     B*2            S01166
     C           @ENQ      OREQ 'R'                        B*2            S01166
     C***                  MOVEL'  END'   @START                          S01166
     C***                  MOVEL*BLANK    DDTOT                           S01166
     C***                  EXSR #ZC                                       S01166
     C***                  ELSE                                           S01166
     C***                  MOVE '999'     @ENQN                           S01166
     C***                                                                 S01136
     C***** RELEASE CURRENT PROMPTS                                       S01136
     C***                  EXCPT@RLS01                                    S01136
     C***                  EXSR #ZA                                       S01166
     C***                  END                                            S01166
     C*                                                                   S01408
     C/COPY WNCPYSRC,TM3130CCP3                                           S01408
     C*                                                                   S01408
     C                     MOVEL'RTM0008' @MSGID           **2            S01166
     C                     END                             E*2            S01166
     C                     CALL 'ZA0240'                   *1             S01166
     C                     PARM           @MSGID           *1             S01166
     C                     MOVE '1'       *IN69            *1             S01166
     C                     GOTO #BB9                       *1             S01166
     C                     END                             E1             S01166
     C*                                                                   S01408
     C/COPY WNCPYSRC,TM3130CCP4                                           S01408
     C*                                                                   S01408
     C*                                                                   S01166
     C*
     C****STORE FXFDLALL DEAL NUMBER                                      S01145
     C*   STORE CAFDLALL DEAL NUMBER                                      S01145
     C*********************MOVE FHDN38    @WDEAL                          S01145
     C                     MOVE @DN38     @WDEAL                          S01145
     C*                                                                   E12677
     C**  GET DEAL NUMBER FOR LAST DEAL                                   E12677
     C*                                                                   E12677
     C**  USE CURRENCY/DATE - SETLL ON FXFDLALL - READ FILE               E12677
     C***********@KEY      SETGTFXFDLALL                                  S01145
     C           @KEY      SETGTCAFDLALL                                  S01145
     C*                                                                   E12677
     C**  READ PREVIOUS RECORD ON FXFDLALL                                E12677
     C                     EXSR #BBBA                                     E12677
     C*                                                                   E12677
     C** IF RECORD FOUND MOVE END DEAL NUMBER                             E12677
     C           *IN61     IFEQ '0'                        B1             E12677
     C*                                                                   E12677
     C**  STORE FXFDLALL DEAL NUMBER                                      E12677
     C*********************MOVE FHDN38    @EDEAL           *1             S01145
     C                     MOVE @DN38     @EDEAL           *1             S01145
     C                     END                             E1             E12677
     C*
     C                     MOVEL' NO'     @OORE1  3
     C                     MOVE ' NO'     @OOREC  3
     C                     Z-ADD*ZERO     @X      20
     C                     Z-ADD16        @Y      20                      S01166
     C*
     C**  CLEAR ARRAY & SET @A TO ZERO
     C                     MOVE *BLANK    @AR
     C                     Z-ADD*ZERO     @A      20
     C*
     C*** IF ALPHA DATE INPUT PARAMETER IS BLANK ZERO NUMERIC PARAMETER   S01166
     C           @PDATA    IFEQ *BLANK                     B1             S01166
     C***        @ENQ      OREQ 'F'                        *1             S01166
     C           @ENQ      OREQ *BLANK                     *1             S01166
     C                     Z-ADD*ZERO     @PDATE           *1             S01166
     C                     END                             E1             S01166
     C*
     C*** IF REQUEST DATE = MIDAS DATE & ROLL REFRESH DATE LESS THAN      S01166
     C*** REQUEST DATE & NOT LAST PAGE OR ROLL DOWN                       S01166
     C           @RDATE    IFEQ @@VDT                      B1             S01166
     C           @PDATE    ANDLT@RDATE                     *1             S01166
     C***        @ENQ      ANDNE'L'                        *1             S01166
     C           @ENQ      ANDNE'D'                        *1             S01166
     C                     EXSR #BBC                       *1             S01166
     C***                                                                 S01166
     C*** RESET REQUEST DATE TO TODAY                                     S01166
     C                     MOVEL@@VDT     @RDATE           *1             S01166
     C                     END                             E1             S01166
     C*
     C**  IF DATA AREA IS FULL END S/R
     C           @X        IFEQ 15                         B1             S01166
     C           @Y        OREQ 1                          *1
     C***                  EXSR #ZC                        *1             S01166
     C                     GOTO #BB9                       *1
     C                     END                             E1
     C*
     C*** FIRST PAGE OR NEW ENQUIRY PROCESSING                            S01166
     C           @ENQ      IFEQ *BLANK                     B1             S01166
     C***        @ENQ      OREQ 'F'                        *1             S01166
     C                     MOVE *BLANK    @TOPT            *1             E13307
     C                     MOVE *BLANK    @BOPT            *1             E13307
     C***********@KEY      SETLLFXFDLALL                   *1             S01145
     C           @KEY      SETLLCAFDLALL                   *1             S01145
     C                     END                             E1             S01166
     C*
     C**  ENQUIRY TYPE ROLL UP
     C           @ENQ      IFEQ 'U'                        B1             S01166
     C                     MOVE *BLANK    @TOPT            *1             E13307
     C*                                                                   E12677
     C** CHECK IF ROLL UP PERFORMED ON LAST PAGE                          E12677
     C           @EDEAL    IFEQ @BOT1                      B*2            E12677
     C                     MOVEL'RTM0001' @MSGID           **2            S01166
     C                     CALL 'ZA0240'                   **2            S01166
     C                     PARM           @MSGID           **2            S01166
     C                     MOVE '1'       *IN69            **2            S01166
     C                     GOTO #BB9                       **2            S01166
     C***                  Z-ADD@TOP1     @KDEAL                          E12677
     C***                  Z-ADD@TOP3     @AMT                            E12677
     C***********@KEY1     SETLLFXFDLALL                   *1       E12677S01145
     C           @KEY1     SETLLCAFDLALL                   *1             S01145
     C                     ELSE                            X*2            E12677
     C           @BOPT     IFEQ 'Y'                        B**3           E12848
     C                     MOVE *BLANK    @BOPT            ***3           E12848
     C***********@KEY1     SETLLFXFDLALL                   *1       E12848S01145
     C           @KEY1     SETLLCAFDLALL                   *1             S01145
     C                     ELSE                            X**3           E12848
     C                     Z-ADD@BOT1     @KDEAL           ***3           E12848
     C                     Z-ADD@BOT3     @AMT             ***3           S01166
     C***********@KEY1     SETGTFXFDLALL                   *1             S01145
     C           @KEY1     SETGTCAFDLALL                   *1             S01145
     C                     END                             E**3           E12848
     C                     END                             E*2            E12677
     C                     END                             E1             S01166
     C*
     C**  ENQUIRY TYPE REFRESH
     C           @ENQ      IFEQ 'R'                        B1             S01166
     C                     MOVE *BLANK    @BOPT            *1             E13307
     C           @TOPT     IFEQ 'Y'                        B*2            E13307
     C                     MOVE *BLANK    @TOPT            **2            E13307
     C***********@KEY      SETLLFXFDLALL                   *1       E13307S01145
     C           @KEY      SETLLCAFDLALL                   *1             S01145
     C                     ELSE                            X*2            E13307
     C                     Z-ADD@TOP1     @KDEAL           **2            E12848
     C                     Z-ADD@TOP3     @AMT             **2            S01166
     C***********@KEY      SETLLFXFDLALL                   *1             S01145
     C           @KEY      SETLLCAFDLALL                   *1             S01145
     C                     END                             E*2            E13307
     C                     END                             E1             S01166
     C*
     C*** ENQUIRY TYPE LAST PAGE                                          S01166
     C***        @ENQ      IFEQ 'L'                        B1             S01166
     C                     MOVE *BLANK    @TOPT            *1             E13307
     C                     MOVE *BLANK    @BOPT            *1             E13307
     C***        @KEY      SETGTFXFDLALL                   *1             S01166
     C***                  END                             E1             S01166
     C*
     C**  ENQUIRY TYPE ROLL DOWN
     C           @ENQ      IFEQ 'D'                        B1             S01166
     C                     MOVE *BLANK    @TOPT            *1             E13307
     C                     MOVE *BLANK    @BOPT            *1             E13307
     C*                                                                   E12677
     C** CHECK IF ROLL DOWN PERFORMED ON FIRST PAGE                       E12677
     C           @WDEAL    IFEQ @TOP1                      B*2            E12677
     C                     MOVEL'RTM0001' @MSGID           **2            S01166
     C                     CALL 'ZA0240'                   **2            S01166
     C                     PARM           @MSGID           **2            S01166
     C                     MOVE '1'       *IN69            **2            S01166
     C                     GOTO #BB9                       **2            S01166
     C***                  Z-ADD@BOT1     @KDEAL                          E12677
     C***                  Z-ADD@BOT3     @AMT                            E12677
     C                     ELSE                            X*2            E12677
     C                     Z-ADD@TOP1     @KDEAL           **2            E12848
     C                     Z-ADD@TOP3     @AMT             **2            S01166
     C                     END                             E*2            E12677
     C***********@KEY1     SETLLFXFDLALL                   *1             S01145
     C           @KEY1     SETLLCAFDLALL                   *1             S01145
     C                     END                             E1
     C*
     C**  IF  ENQUIRY TYPE D/L PERFORM ROLL DOWN ELSE PERFORM ROLL UP
     C           @ENQ      CASEQ'D'       #BBB                            S01166
     C***        @ENQ      CASEQ'L'       #BBB                            S01166
     C                     CAS            #BBA
     C                     END
     C*
     C           #BB9      ENDSR                           ****#BB9***
     C*
     C/EJECT
     C****************************************************************
     C*                                                              *
     C*****#BAA FXDLVALL READ FORWARD.                               *    S01145
     C*    #BAA CADLVALL READ FORWARD.                               *    S01145
     C*        CALLED BY  : #BA                                      *
     C*        CALLS      :                                          *
     C*                                                              *
     C*        WORK FIELDS: @ENQN - ENQUIRY NUMBER                   *
     C*                   : @ENQ  - ENQUIRY TYPE                     *
     C*                   : @START- START/END FOR DISPLAY            *    S01166
     C*                   : @WORK - 1 LINE FOR DISPLAY               *
     C*                                                              *
     C****************************************************************
     C*                                                                   S01166
     C           #BAA      BEGSR
     C*
     C**  READ FORWARD BOOK FILE
     C***********@KEY      READEFXDLVALL                 61               S01145
     C***********@KEY      READECADLVALL                 61         S01145E49802
     C*                                                                   E49802
     C                     EXSR #BAAA                                     E49802
     C*
     C**  NOT FOUND SEND NO RECORDS ENQUIRY NO. TO PC - UNLESS NEW
     C**  ENQUIRY THEN SEND HEADINGS AND NORMAL COMPLETION NO. TO PC
     C                     MOVE *BLANKS   @START                          S01166
     C           *IN61     IFEQ '1'                        B1
     C           @ENQ      IFEQ *BLANK                     B*2            S01166
     C           @ENQ      OREQ 'R'                        B*2            S01166
     C                     MOVEL'  END'   @START           **2            S01166
     C***                  MOVEL*BLANK    DDTOT                           S01166
     C***                  EXSR #ZC                                       S01166
     C***                  ELSE                                           S01166
     C***                  MOVE '999'     @ENQN                           S01166
     C***                                                                 S01136
     C***RELEASE CURRENT PROMPTS                                          S01136
     C***                  EXCPT@RLS01                                    S01136
     C***                  EXSR #ZA                                       S01166
     C*                                                                   S01408
     C/COPY WNCPYSRC,TM3130CCP5                                           S01408
     C*                                                                   S01408
     C                     MOVEL'RTM0008' @MSGID           **2            S01166
     C                     ELSE                            X*2            S01166
     C                     MOVEL'RTM0001' @MSGID           **2            S01166
     C                     END                             E*2            S01166
     C*                                                                   S01166
     C                     CALL 'ZA0240'                   *1             S01166
     C                     PARM           @MSGID           *1             S01166
     C                     MOVE '1'       *IN69            *1             S01166
     C                     GOTO #BAA9                      *1             S01166
     C                     END                             E1             S01166
     C*                                                                   S01408
     C/COPY WNCPYSRC,TM3130CCP6                                           S01408
     C*                                                                   S01408
     C*                                                                   S01166
     C*
     C**  CHECK FOR START OF GROUP (DATE = STORED DATE)
     C***********FHDN38    IFEQ @WDEAL                     B1             S01145
     C           @DN38     IFEQ @WDEAL                     B1             S01145
     C                     MOVE 'START'   @START           *1             S01166
     C                     END                             E1
     C*
     C**  FILL DATA STRUCTURE UNTIL FULL OR END OF GROUP ON FILE
     C                     Z-ADD*ZERO     @X      20
     C*
     C           @X        DOWNE15                         B1             S01166
     C           *IN61     ANDNE'1'                        *1
     C*
     C                     ADD  1         @X               *1
     C           @X        OCUR @WORK                      *1
     C*
     C**  EDIT DISPLAY FIELDS
     C                     EXSR #ZB                        *1
     C           *INU7     CABEQ'1'       #BAA9                           S01145
     C*
     C**  READ NEXT RECORD
     C***********@KEY      READEFXDLVALL                 61*1             S01145
     C***********@KEY      READECADLVALL                 61*1       S01145E49802
     C*                                                                   E49802
     C                     EXSR #BAAA                                     E49802
     C*
     C**  IF END OF GROUP REACHED MOVE 'END' TO DISPLAY
     C           *IN61     IFEQ '1'                        B*2
     C                     MOVE '  END'   @START           **2            S01166
     C                     SETON                     30    **2            S01166
     C                     END                             E*2
     C*
     C                     END                             E1
     C*
     C**  CLEAR ARRAY & SET @A TO ZERO
     C                     MOVE *BLANK    @AR
     C                     Z-ADD*ZERO     @A      20
     C*
     C**  DO UNTIL ALL LINES MOVED FROM DATA AREA TO DISPLAY ARRAY
     C           @X        DOUEQ@A                         B1
     C                     ADD  1         @A               *1
     C           @A        OCUR @WORK                      *1
     C*
     C**  FIRST TIME UPDATE RR KEY FIELD WITH TOP OF SCREEN DEAL NO.
     C           @A        IFEQ 1                          B*2
     C                     MOVEL@DEAL     @TOP1            **2
     C                     Z-ADD@DAMT     @TOP3            **2
     C                     END                             E*2
     C*
     C***                  MOVEL@WORK     @AR,@A           *1             S01166
     C                     EXSR #BC                        *1             S01166
     C                     END                             E1
     C*
     C**  LAST TIME UPDATE RR KEY FIELD WITH BOTTOM OF SCREEN DEAL NO.
     C                     MOVEL@DEAL     @BOT1                           S01166
     C                     Z-ADD@DAMT     @BOT3                           S01166
     C*
     C**  PERFORM END PROCESSING
     C***                  EXSR #ZC                                       S01166
     C*
     C           #BAA9     ENDSR                           ****#BAA9***
     C/EJECT
     C****************************************************************
     C*                                                              *
     C*****#BAB FXDLVALL READ BACKWARD                               *    S01145
     C*    #BAB CADLVALL READ BACKWARD                               *    S01145
     C*        CALLED BY  : #BA                                      *
     C*        CALLS      :                                          *
     C*                                                              *
     C*        WORK FIELDS: @ENQN - ENQUIRY NUMBER                   *
     C*                   : @ENQ  - ENQUIRY TYPE                     *
     C*                   : @START- START/END FOR DISPLAY            *    S01166
     C*                   : @WORK - 1 LINE FOR DISPLAY               *
     C*                                                              *
     C****************************************************************
     C*
     C           #BAB      BEGSR
     C*
     C**  READ FORWARD BOOK FILE
     C                     MOVE '0'       *IN01
     C                     MOVE '0'       *IN02
     C*********************READPFXDLVALL                 61               S01145
     C***********          READPCADLVALL                 61         S01145E49802
     C*                                                                   E49802
     C                     EXSR #BABA                                     E49802
     C*
     C**  TEST FOR END OF GROUP. *IN61 = START OF FILE, @FDATE = FILE
     C**  DATE, @RDATE = REQUESTED DATE,DDCCY = CURRENCY. *IN01 IS ON     S01166
     C**  IF A RECORD HAS BEEN READ FROM FORMAT 1 OR 3 *IN02 IS ON IF
     C**  A RECORD HAS BEEN READ FROM FORMAT 2 OR 4 (SEE INPUT SPECS).
     C**  IF A RECORD IS READ FROM FORMAT 1 OR 3 TEST 1ST CURRENCY.
     C**  IF A RECORD IS READ FROM FORMAT 2 OR 4 TEST 2ND CURRENCY.
     C                     MOVE *BLANKS   @START                          S01166
     C           *IN61     IFEQ '1'                        B1
     C           @FDATE    ORNE @RDATE                     *1
     C           *IN01     OREQ '1'                        *1
     C***********DDCCY     ANDNEFHCCY1                     *1             S01145
     C           DDCCY     ANDNE@CCY1                      *1             S01145
     C           *IN02     OREQ '1'                        *1
     C***********DDCCY     ANDNEFHCCY2                     *1             S01145
     C           DDCCY     ANDNE@CCY2                      *1             S01145
     C                     MOVEL'START'   @START           *1             S01166
     C                     END                             E1
     C*
     C**  NOT FOUND SEND NO RECORDS ENQUIRY NO. TO PC - UNLESS NEW
     C**  ENQUIRY THEN SEND HEADINGS AND NORMAL COMPLETION NO. TO PC
     C           @START    IFEQ 'START'                    B1             S01166
     C           @ENQ      IFEQ *BLANK                                    S01166
     C***                  MOVEL*BLANK    DDTOT            **2            S01166
     C***                  EXSR #ZC                        **2            S01166
     C***                  ELSE                            X*2            S01166
     C***                  MOVE '999'     @ENQN            **2            S01166
     C***                                                                 S01136
     C***RELEASE CURRENT PROMPTS                                          S01136
     C***                  EXCPT@RLS01                     *1             S01136
     C***                  EXSR #ZA                        **2            S01166
     C***                  END                             E*2            S01166
     C***                                                                 S01166
     C                     MOVEL*BLANK    @START           *1             S01166
     C*                                                                   S01166
     C*                                                                   S01408
     C/COPY WNCPYSRC,TM3130CCP7                                           S01408
     C*                                                                   S01408
     C                     MOVEL'RTM0008' @MSGID           **2            S01166
     C                     ELSE                            E*2            S01166
     C                     MOVEL'RTM0001' @MSGID           **2            S01166
     C                     END                             E*2            S01166
     C*                                                                   S01166
     C                     CALL 'ZA0240'                   *1             S01166
     C                     PARM           @MSGID           *1             S01166
     C                     MOVE '1'       *IN69            *1             S01166
     C                     GOTO #BAB9                      *1             S01166
     C                     END                             E1             S01166
     C*                                                                   S01408
     C/COPY WNCPYSRC,TM3130CCP8                                           S01408
     C*                                                                   S01408
     C***                                                                 S01166
     C**  CHECK FOR END OF GROUP (DATE = STORED DATE)
     C***********FHDN38    IFEQ @WDEAL                     B1             S01145
     C           @DN38     IFEQ @WDEAL                     B1             S01145
     C                     MOVE '  END'   @START           *1             S01166
     C                     SETON                     30    *1             S01166
     C                     END                             E1
     C*
     C**  FILL DATA STRUCTURE UNTIL FULL OR END OF GROUP ON FILE
     C                     Z-ADD16        @Y      20                      S01166
     C*
     C           @Y        DOWGT1                          B1
     C           @START    ANDNE'START'                    *1             S01166
     C*
     C                     SUB  1         @Y               *1
     C           @Y        OCUR @WORK                      *1
     C*
     C**  EDIT DISPLAY FIELDS
     C                     EXSR #ZB                        *1
     C           *INU7     CABEQ'1'       #BAB9                           S01145
     C*********************MOVELFHDN38    @TOP1            *1             S01145
     C                     MOVEL@DN38     @TOP1            *1             S01145
     C                     Z-ADD@DAMT     @TOP3            *1
     C*
     C**  READ NEXT PREVIOUS RECORD
     C                     MOVE '0'       *IN01            *1
     C                     MOVE '0'       *IN02            *1
     C*********************READPFXDLVALL                 61*1             S01145
     C***********          READPCADLVALL                 61*1       S01145E49802
     C*                                                                   E49802
     C                     EXSR #BABA                                     E49802
     C*
     C**  TEST FOR END OF GROUP. *IN61 = START OF FILE, @FDATE = FILE
     C**  DATE, @RDATE = REQUESTED DATE,DDCCY = CURRENCY. *IN01 IS ON     S01166
     C**  IF A RECORD HAS BEEN READ FROM FORMAT 1 OR 3 *IN02 IS ON IF
     C**  A RECORD HAS BEEN READ FROM FORMAT 2 OR 4 (SEE INPUT SPECS).
     C**  IF A RECORD IS READ FROM FORMAT 1 OR 3 TEST 1ST CURRENCY.
     C**  IF A RECORD IS READ FROM FORMAT 2 OR 4 TEST 2ND CURRENCY.
     C*                                                                   S01166
     C**  SETUP CHECK DATE FOR READ BACWARDS (OPTION DEALS)               S01166
     C*                                                                   S01166
     C           FHDTYP    IFEQ 'O'                        B*2            S01166
     C           @ODATE    IFEQ @RDATE                     B**3           S01166
     C                     MOVE @ODATE    @CDATE  80       ***3           S01166
     C                     ELSE                            X**3           S01166
     C                     MOVE @FDATE    @CDATE           ***3           S01166
     C                     END                             E**3           S01166
     C                     ELSE                            X*2            S01166
     C                     MOVE @FDATE    @CDATE           **2            S01166
     C                     END                             E*2            S01166
     C*                                                                   S01166
     C           *IN61     IFEQ '1'                        B*2
     C****       @FDATE    ORNE @RDATE                     **2            S01166
     C           @CDATE    ORNE @RDATE                     **2            S01166
     C           *IN01     OREQ '1'                        **2
     C***********DDCCY     ANDNEFHCCY1                     **2            S01145
     C           DDCCY     ANDNE@CCY1                      **2            S01145
     C           *IN02     OREQ '1'                        **2
     C***********DDCCY     ANDNEFHCCY2                     **2            S01145
     C           DDCCY     ANDNE@CCY2                      **2            S01145
     C                     MOVEL'START'   @START           **2            S01166
     C                     END                             E*2
     C*
     C                     END                             E1
     C*
     C**  CLEAR ARRAY & SET @A TO ZERO
     C                     MOVE *BLANK    @AR
     C                     Z-ADD16        @A                              S01166
     C*
     C**  DO UNTIL ALL LINES MOVED FROM DATA AREA TO DISPLAY ARRAY
     C           @Y        DOUEQ@A                         B1
     C                     SUB  1         @A               *1
     C           @A        OCUR @WORK                      *1
     C*
     C**  FIRST TIME UPDATE RR KEY FIELD WITH BOTTOM OF SCREEN DEAL NO.
     C           @A        IFEQ 15                         B*2            S01166
     C                     MOVEL@DEAL     @BOT1            **2
     C                     Z-ADD@DAMT     @BOT3            **2
     C                     END                             E*2
     C*
     C***                  MOVEL@WORK     @AR,@A           *1             S01166
     C                     EXSR #BC                        *1             S01166
     C                     END                             E1
     C*
     C**  LAST TIME UPDATE RR KEY FIELD WITH TOP OF SCREEN DEAL NO.
     C                     MOVEL@DEAL     @TOP1                           S01166
     C                     Z-ADD@DAMT     @TOP3                           S01166
     C*
     C**  PERFORM END PROCESSING
     C***                  EXSR #ZC                                       S01166
     C*
     C           #BAB9     ENDSR                           ****#BAB9***
     C*
     C/EJECT
     C****************************************************************
     C*                                                              *
     C*****#BBA FXFDLALL READ FORWARD PROCESSING                     *    S01145
     C*    #BBA CAFDLALL READ FORWARD PROCESSING                     *    S01145
     C*        CALLED BY  : #BB                                      *
     C*        CALLS      :                                          *
     C*                                                              *
     C*        WORK FIELDS: @START- START/END FOR DISPLAY            *    S01166
     C*                   : @WORK - 1 DETAIL LINE FOR DISPLAY        *
     C*                   : @TOP1 - DEAL NUMBER AT TOP OF DISPALY    *
     C*                   : @BOT1 - DEAL NUMBER AT BOTTOM OF DISPLAY *
     C*                                                              *
     C****************************************************************
     C*
     C           #BBA      BEGSR
     C*
     C**  READ NEXT RECORD
     C                     EXSR #BBAA
     C           @OOREC    IFEQ ' NO'                      B1
     C           *IN61     ANDEQ'1'                        *1
     C           @ENQ      IFEQ *BLANK                     B*2            S01166
     C           @ENQ      OREQ 'R'                        **2            S01166
     C***                  MOVEL*BLANK    DDTOT                           S01166
     C***                  EXSR #ZC                                       S01166
     C***                  MOVE '999'     @ENQN                           S01166
     C***                                                                 S01136
     C***RELEASE CURRENT PROMPTS                                          S01136
     C***                  EXCPT@RLS01                                    S01136
     C***                  EXSR #ZA                                       S01166
     C*                                                                   S01408
     C/COPY WNCPYSRC,TM3130CCP9                                           S01408
     C*                                                                   S01408
     C                     MOVEL'RTM0008' @MSGID           **2            S01166
     C                     ELSE                            X*2            S01166
     C                     MOVEL'RTM0001' @MSGID           **2            S01166
     C                     END                             E*2            S01166
     C*                                                                   S01166
     C                     CALL 'ZA0240'                   *1             S01166
     C                     PARM           @MSGID           *1             S01166
     C                     MOVE '1'       *IN69            *1             S01166
     C                     MOVEL'  END'   @START                          S01166
     C***                  ELSE                                           S01166
     C***                  END                                            S01166
     C                     GOTO #BBA9                      *1             S01166
     C                     END                             E1
     C*                                                                   S01408
     C/COPY WNCPYSRC,TM3130CP10                                           S01408
     C*                                                                   S01408
     C*
     C**  CHECK FOR START OF GROUP (DEAL = STORED DEAL)
     C                     MOVE *BLANKS   @START                          S01166
     C           @OOREC    IFEQ ' NO'                      B1
     C           @OORE1    ANDEQ' NO'                      *1
     C***********FHDN38    ANDEQ@WDEAL                     B1             S01145
     C           @DN38     ANDEQ@WDEAL                     B1             S01145
     C                     MOVE 'START'   @START           *1             S01166
     C                     END                             E1
     C*
     C**  FILL DATA STRUCTURE UNTIL FULL OR END OF GROUP ON FILE
     C           @X        DOWNE15                         B1             S01166
     C           *IN61     ANDNE'1'                        *1
     C*
     C                     ADD  1         @X               *1
     C           @X        OCUR @WORK                      *1
     C*
     C**  EDIT DISPLAY FIELDS
     C                     EXSR #ZB                        *1
     C           *INU7     CABEQ'1'       #BBA9                           S01145
     C*
     C**  READ NEXT RECORD
     C                     EXSR #BBAA                      *1
     C*
     C                     END                             E1
     C*
     C**  DO UNTIL ALL LINES MOVED FROM DATA AREA TO DISPLAY ARRAY
     C           @X        IFNE @A                         B1             E12848
     C           @X        DOUEQ@A                         B1
     C                     ADD  1         @A               *1
     C           @A        OCUR @WORK                      *1
     C*
     C**  FIRST TIME UPDATE RR KEY FIELD WITH TOP OF SCREEN DEAL NO.
     C           @A        IFEQ 1                          B*2
     C                     MOVEL@DEAL     @TOP1            **2
     C                     MOVEL@RDATE    @TOP2            **2            E12848
     C                     Z-ADD@DAMT     @TOP3            **2
     C                     END                             E*2
     C*
     C***                  MOVEL@WORK     @AR,@A           *1             S01166
     C                     EXSR #BC                        *1             S01166
     C                     END                             E1
     C                     END                             E1             E12848
     C*
     C**  LAST TIME UPDATE RR KEY FIELD WITH BOTTOM OF SCREEN DEAL NO.
     C                     MOVEL@DEAL     @BOT1                           S01166
     C                     MOVEL@RDATE    @BOT2                           E12848
     C                     Z-ADD@DAMT     @BOT3                           S01166
     C*
     C**  PERFORM END PROCESSING
     C***                  EXSR #ZC                                       S01166
     C*
     C           #BBA9     ENDSR                           ****#BBA9***
     C/EJECT
     C****************************************************************
     C*                                                              *
     C*****#BBB FXFDLALL READ BACKWARD PROCESSING                    *    S01145
     C*    #BBB CAFDLALL READ BACKWARD PROCESSING                    *    S01145
     C*        CALLED BY  : #BB                                      *
     C*        CALLS      :                                          *
     C*                                                              *
     C*        WORK FIELDS: @START- START/END FOR DISPLAY            *    S01166
     C*                   : @ENQN - ENQUIRY NUMBER                   *
     C*                   : @KDEAL- DEAL NUMBER KEY TO FXFWDTLL      *
     C*                                                              *
     C****************************************************************
     C*
     C           #BBB      BEGSR
     C*
     C                     MOVEL*BLANK    @START                          S01166
     C*
     C**  READ FORWARD BOOK FILE
     C                     EXSR #BBBA
     C*
     C**  NOT FOUND CHECK FOR OLD OPTIONS IF REQUEST DATE = MIDAS DATE
     C           @START    IFEQ 'START'                    B1             S01166
     C           @@VDT     CASEQ@RDATE    #BBC             B*2            S01166
     C                     END                             E*2            S01166
     C*
     C           @OOREC    IFEQ 'YES'                      B*2            S01166
     C***                  EXSR #ZC                        **2            S01166
     C***                  ELSE                            X*2            S01166
     C***                  MOVE '999'     @ENQN            **2            S01166
     C***                                                                 S01136
     C***RELEASE CURRENT PROMPTS                                          S01136
     C***                  EXCPT@RLS01                                    S01136
     C***                  EXSR #ZA                                       S01166
     C                     MOVEL'RTM0001' @MSGID           **2            S01166
     C                     CALL 'ZA0240'                   **2            S01166
     C                     PARM           @MSGID           **2            S01166
     C                     MOVE '1'       *IN69            **2            S01166
     C                     GOTO #BBB9                      **2            S01166
     C                     END                             E*2            S01166
     C*                                                                   S01166
     C                     END                             E1
     C*
     C**  FILL DATA STRUCTURE UNTIL FULL OR END OF GROUP ON FILE
     C           @Y        DOWGT1                          B1
     C           @START    ANDNE'START'                    *1             S01166
     C*
     C                     SUB  1         @Y               *1
     C           @Y        OCUR @WORK                      *1
     C*
     C**  EDIT DISPLAY FIELDS
     C                     EXSR #ZB                        *1
     C           *INU7     CABEQ'1'       #BBB9                           S01145
     C*********************MOVELFHDN38    @TOP1            *1             S01145
     C                     MOVEL@DN38     @TOP1            *1             S01145
     C                     Z-ADD@DAMT     @TOP3            *1
     C*
     C**  READ NEXT PREVIOUS RECORD
     C                     EXSR #BBBA                      *1
     C*
     C** AS THE FILE FXFDLALL IS KEYED ON CCY,YY,MM,DD.AMT & DEAL NUMBER  E12677
     C** HENCE CHECK ON THIS CONDITION IS NOT RIGHT                       E12677
     C***********FHDN38    IFGE @TOP1                      B*2            E12677
     C***********          MOVEL'START'   @START           **2            E12677
     C***********          END                             E*2            E12677
     C                     END                             E1             S01166
     C*                                                                   E12677
     C** IF FIRST PAGE NOT FULL READ FILE FXFDLALL FROM START             E12677
     C           @Y        IFNE 1                          B1             E12677
     C                     MOVE '0'       *IN61            *1             E12677
     C***********@KEY      SETLLFXFDLALL                   *1             S01145
     C           @KEY      SETLLCAFDLALL                   *1             S01145
     C                     EXSR #BBA                       *1             E12677
     C                     GOTO #BBB9                      *1             E12677
     C                     END                             E1             E12677
     C*
     C**  DO UNTIL ALL LINES MOVED FROM DATA AREA TO DISPLAY ARRAY
     C                     Z-ADD16        @A                              S01166
     C           @Y        DOWNE@A                         B1
     C                     SUB  1         @A               *1
     C           @A        OCUR @WORK                      *1
     C*
     C**  FIRST TIME UPDATE RR KEY FIELD WITH BOTTOM OF SCREEN DEAL NO.
     C           @A        IFEQ 15                         B*2            S01166
     C                     MOVEL@DEAL     @BOT1            **2
     C                     Z-ADD@DAMT     @BOT3            **2
     C                     END                             E*2
     C*
     C***                  MOVEL@WORK     @AR,@A           *1             S01166
     C                     EXSR #BC                        *1             S01166
     C                     END                             E1
     C*
     C**  LAST TIME UPDATE RR KEY FIELD WITH TOP OF SCREEN DEAL NO.
     C                     MOVEL@DEAL     @TOP1                           S01166
     C                     Z-ADD@DAMT     @TOP3            *1             S01166
     C*
     C**  IF DATA AREA NOT FULL & REQUEST DATE = TODAY PROCESS FXOPTALL
     C           @Y        IFGT 1                          B1
     C           @OOREC    ANDEQ' NO'                      *1
     C           @@VDT     ANDEQ@RDATE                     *1
     C           @ENQ      IFEQ 'D'                        B*2            S01166
     C                     Z-ADD@DEAL     @KDEAL           **2
     C                     Z-ADD@DAMT     @AMT             **2            S01166
     C                     END                             E*2
     C                     EXSR #BBC                       *1
     C                     END                             E1
     C*
     C**  CHECK OLD OPTIONS IF REQUEST = RUN DATE & @START = START        S01166
     C           @START    IFEQ 'START'                    B1             S01166
     C           @@VDT     ANDEQ@RDATE                     *1
     C           DDCCY     SETLLFXOPTALL                 61*1             S01166
     C           *IN61     IFEQ '1'                        B*2
     C                     MOVEL*BLANK    @START           **2            S01166
     C                     END                             E*2
     C                     END                             E1
     C*
     C**  PERFORM END PROCESSING
     C***                  EXSR #ZC                                       S01166
     C*
     C           #BBB9     ENDSR                           ****#BBB9***
     C*
     C/EJECT
     C****************************************************************
     C*                                                              *
     C*    #BBC CARRIES OUT FXOPTALL PROCESSING  .                   *
     C*        CALLED BY  : #BB                                      *
     C*        CALLS      :                                          *
     C*                                                              *
     C*        WORK FIELDS: @RDATE- REQUESTED DATE                   *
     C*                   : @PDATE- INPUT PARAMETER DATE             *
     C*                   : @FDATE- FILE DATE                        *
     C*                   : @WDATE- FIRST RECORD FILE DATE           *
     C*                   :DDCCY  - CURRENCY                         *    S01166
     C*                                                              *
     C****************************************************************
     C*
     C           #BBC      BEGSR
     C*
     C**  MOVE ROLL REFRESH DATE TO KEY FOR ROLL UP/DOWN & REFRESH
     C           @ENQ      IFEQ 'U'                        B1             S01166
     C           @ENQ      OREQ 'D'                        *1             S01166
     C           @ENQ      OREQ 'R'                        *1             S01166
     C           @PDATE    CABEQ*ZERO     #BBC9            *1
     C                     MOVEL@PDATE    @RDATE           *1
     C                     END                             E1
     C*
     C**  USE CURRENCY - SETLL ON FXOPTALL - READ FILE & STORE DATE
     C           DDCCY     SETLLFXOPTALL                                  S01166
     C           DDCCY     READEFXOPTALL                 61               S01166
     C*
     C**  NO RECORD FOUND END S/R
     C           *IN61     CABEQ'1'       #BBC9
     C*
     C                     MOVE @FDATE    @WDATE
     C                     MOVEL'YES'     @OORE1
     C*
     C**  FIRST PAGE OR NEW ENQUIRY PROCESSING
     C           @ENQ      IFEQ *BLANK                     B1             S01166
     C***        @ENQ      OREQ 'F'                        *1             S01166
     C           DDCCY     SETLLFXOPTALL                   *1             S01166
     C                     END                             E1
     C*
     C**  ENQUIRY TYPE ROLL UP
     C           @ENQ      IFEQ 'U'                        B1             S01166
     C                     Z-ADD@BOT1     @KDEAL           *1             E12848
     C                     Z-ADD@BOT3     @AMT             *1             S01166
     C           @KEY1     SETGTFXOPTALL                   *1
     C                     END                             E1
     C*
     C**  ENQUIRY TYPE REFRESH
     C           @ENQ      IFEQ 'R'                        B1             S01166
     C                     Z-ADD@TOP1     @KDEAL           *1             E12848
     C                     Z-ADD@TOP3     @AMT             *1             S01166
     C           @KEY1     SETLLFXOPTALL                   *1
     C                     END                             E1
     C*
     C*** ENQUIRY TYPE LAST PAGE                                          S01166
     C***        @ENQ      IFEQ 'L'                        B1             S01166
     C***        @KEY      SETLLFXOPTALL                   *1             S01166
     C***                  END                             E1             S01166
     C***                                                                 S01166
     C**  ENQUIRY TYPE ROLL DOWN
     C           @ENQ      IFEQ 'D'                        B1             S01166
     C                     Z-ADD@TOP1     @KDEAL           *1             E12848
     C                     Z-ADD@TOP3     @AMT             *1             S01166
     C           @KEY1     SETLLFXOPTALL                   *1
     C                     END                             E1
     C*
     C**  IF  ENQUIRY TYPE D/L PERFORM ROLL DOWN ELSE PERFORM ROLL UP
     C           @ENQ      CASEQ'D'       #BBCB                           S01166
     C***        @ENQ      CASEQ'L'       #BBCB                           S01166
     C                     CAS            #BBCA
     C                     END
     C           #BBC9     ENDSR                           ***#BBC9***
     C*
     C/EJECT
     C****************************************************************
     C*                                                              *
     C*    #BBCA FXOPTALL READ FORWARD.                              *
     C*        CALLED BY  : #BBC                                     *
     C*        CALLS      :                                          *
     C*                                                              *
     C*        WORK FIELDS: @OOREC- RECORDS READ FROM OLD OPTIONS    *
     C*                   : @TOP1 - DEAL NUMBER AT TOP OF SCREEN     *
     C*                   : @TOP2 - DATE NUMBER AT TOP OF SCREEN     *
     C*                   : @BOT1 - DEAL NUMBER AT BOTTOM OF SCREEN  *
     C*                   : @BOT2 - DATE NUMBER AT BOTTOM OF SCREEN  *
     C*                   : @FDATE- FILE DATE                        *
     C*                   : @@VDT - NEXT WORKING DAY                 *
     C*                   : @START- START/END FOR DISPLAY            *    S01166
     C*                   : @TOPT - Top enquiry = option indicator   *    E13307
     C*                   : @BOPT - Bottom enq = option indicator    *    E12848
     C*                                                              *
     C****************************************************************
     C*
     C           #BBCA     BEGSR
     C*
     C**  READ FORWARD BOOK FILE - END S/R IF NO RECORD OR FILE DATE =
     C**  MIDAS RUN DATE
     C           DDCCY     READEFXOPTALL                 61               S01166
     C           *IN61     CABEQ'1'       #BBCA9
     C           @FDATE    CABEQ@@VDT     #BBCA9
     C*
     C****FIRST*TIME*UPDATE RR KEY FIELD WITH TOP OF SCREEN DEAL NO.      E12848
     C******************** MOVELFHDN38    @TOP1                           E12848
     C******************** Z-ADD@DAMT     @TOP3                           E12848
     C******************** MOVEL@FDATE    @TOP2                           E12848
     C******************** MOVE 'YES'     @OOREC                          E12848
     C*
     C**  CHECK FOR START OF GROUP (DATE = STORED DATE)
     C                     MOVE *BLANKS   @START                          S01166
     C           @FDATE    IFEQ @WDATE                     B1
     C                     MOVE 'START'   @START           *1             S01166
     C                     END                             E1
     C*
     C**  FILL DATA STRUCTURE UNTIL FULL OR END OF GROUP ON FILE
     C*
     C           @X        DOWNE15                         B1             S01166
     C           *IN61     ANDNE'1'                        *1
     C*
     C                     ADD  1         @X               *1
     C           @X        OCUR @WORK                      *1
     C*                                                                   S01166
     C**  Move file date of top deal to current prompt                    E13307
     C           @X        IFEQ 1                          B*2            E13307
     C                     MOVEL@FDATE    @TOP2            **2            E13307
     C                     END                             E*2            E13307
     C*
     C**  EDIT DISPLAY FIELDS & MOVE FILE DATE TO CURRENT PROMT
     C                     EXSR #ZB                        *1
     C           *INU7     CABEQ'1'       #BBCA9                          S01145
     C                     Z-ADD@FDATE    @BOT2            *1
     C*
     C**
     C           DDCCY     READEFXOPTALL                 61*1             S01166
     C*
     C**  IF END OF GROUP REACHED MOVE 'END' TO DISPLAY
     C           *IN61     IFEQ '1'                        B*2
     C                     MOVE '  END'   @START           **2            S01166
     C                     SETON                     30    **2            S01166
     C                     END                             E*2
     C*
     C**  IF FILE DATE NOW EQUALS TODAY - NO MORE OLD OPTIONS REQUIRED
     C           @FDATE    IFEQ @@VDT                      B*2
     C                     MOVE '1'       *IN61            **2
     C                     END                             E*2
     C*
     C                     END                             E1
     C*
     C**  DO UNTIL ALL LINES MOVED FROM DATA AREA TO DISPLAY ARRAY
     C           @X        DOUEQ@A                         B1
     C                     ADD  1         @A               *1
     C           @A        OCUR @WORK                      *1
     C*
     C**  FIRST TIME UPDATE RR KEY FIELD WITH TOP OF SCREEN DEAL NO.      E12848
     C           @A        IFEQ 1                          B*2            E12848
     C**********           MOVELFHDN38    @TOP1            **2     E12848 E13307
     C                     MOVEL@DEAL     @TOP1            **2            E13307
     C                     Z-ADD@DAMT     @TOP3            **2            E12848
     C**********           MOVEL@FDATE    @TOP2            **2            E12848
     C                     MOVE 'YES'     @OOREC           **2     E12848 E13307
     C                     MOVE 'Y'       @TOPT   1        **2            E13307
     C                     END                             E*2            E12848
     C*
     C***                  MOVEL@WORK     @AR,@A           *1             S01166
     C                     EXSR #BC                        *1             S01166
     C                     END                             E1
     C*
     C**  LAST TIME UPDATE RR KEY FIELD WITH BOTTOM OF SCREEN DEAL NO.
     C                     MOVEL@DEAL     @BOT1                           S01166
     C                     Z-ADD@DAMT     @BOT3                           S01166
     C*                                                                   S01166
     C           @A        IFEQ 15                                        E12848
     C                     MOVE 'Y'       @BOPT   1                       E12848
     C                     END                                            E12848
     C*
     C           #BBCA9    ENDSR                           ***#BBCA9***
     C/EJECT
     C****************************************************************
     C*                                                              *
     C*    #BBCB FXOPTALL READ BACKWARDS PROCESSING.                  *
     C*        CALLED BY  : #BBC                                     *
     C*        CALLS      :                                          *
     C*                                                              *
     C*        WORK FIELDS: @OOREC- RECORDS READ FROM OLD OPTIONS    *
     C*                   : @TOP1 - DEAL NUMBER AT TOP OF SCREEN     *
     C*                   : @TOP2 - DATE NUMBER AT TOP OF SCREEN     *
     C*                   : @BOT1 - DEAL NUMBER AT BOTTOM OF SCREEN  *
     C*                   : @BOT2 - DATE NUMBER AT BOTTOM OF SCREEN  *
     C*                   : @FDATE- FILE DATE                        *
     C*                   : @START- START/END FOR DISPLAY            *    S01166
     C*                                                              *
     C****************************************************************
     C*
     C           #BBCB     BEGSR
     C*
     C                     MOVEL*BLANK    @START                          S01166
     C*
     C**  READ OLD OPTIONS FILE
     C                     MOVE '0'       *IN01
     C                     MOVE '0'       *IN02
     C                     READPFXOPTALL                 61
     C*
     C**  TEST FOR END OF GROUP. *IN61 = START OF FILE, @FDATE = FILE
     C**  DATE, @RDATE = REQUESTED DATE,DDCCY = CURRENCY. *IN01 IS ON     S01166
     C**  IF A RECORD HAS BEEN READ FROM FORMAT 1 OR 3 *IN02 IS ON IF
     C**  A RECORD HAS BEEN READ FROM FORMAT 2 OR 4 (SEE INPUT SPECS).
     C**  IF A RECORD IS READ FROM FORMAT 1 OR 3 TEST 1ST CURRENCY.
     C**  IF A RECORD IS READ FROM FORMAT 2 OR 4 TEST 2ND CURRENCY.
     C           *IN61     IFEQ '1'                        B1
     C           *IN01     OREQ '1'                        *1
     C           DDCCY     ANDNEFHCCY1                     *1             S01166
     C           *IN02     OREQ '1'                        *1
     C           DDCCY     ANDNEFHCCY2                     *1             S01166
     C           @FDATE    ORGE @@VDT                      *1
     C                     MOVEL'START'   @START           *1             S01166
     C                     END                             E1
     C*
     C**  NOT FOUND END S/R
     C           @START    CABEQ'START'   #BBCB9                          S01166
     C*
     C                     MOVEL'YES'     @OOREC
     C                     Z-ADD@FDATE    @BOT2
     C*
     C**  FILL DATA STRUCTURE UNTIL FULL OR END OF GROUP ON FILE
     C           @Y        DOWGT1                          B1
     C           @START    ANDNE'START'                    *1             S01166
     C*
     C                     SUB  1         @Y               *1
     C           @Y        OCUR @WORK                      *1
     C*
     C**  EDIT DISPLAY FIELDS & MOVE FILE DATE TO CURRENT PROMPT FILE
     C                     EXSR #ZB                        *1
     C           *INU7     CABEQ'1'       #BBCB9                          S01145
     C                     MOVEL@FDATE    @TOP2            *1
     C*
     C**  READ NEXT PREVIOUS RECORD
     C                     MOVE '0'       *IN01
     C                     MOVE '0'       *IN02
     C                     READPFXOPTALL                 61
     C*
     C**  TEST FOR END OF GROUP. *IN61 = START OF FILE, @FDATE = FILE
     C**  DATE, @RDATE = REQUESTED DATE,DDCCY = CURRENCY. *IN01 IS ON     S01166
     C**  IF A RECORD HAS BEEN READ FROM FORMAT 1 OR 3 *IN02 IS ON IF
     C**  A RECORD HAS BEEN READ FROM FORMAT 2 OR 4 (SEE INPUT SPECS).
     C**  IF A RECORD IS READ FROM FORMAT 1 OR 3 TEST 1ST CURRENCY.
     C**  IF A RECORD IS READ FROM FORMAT 2 OR 4 TEST 2ND CURRENCY.
     C           *IN61     IFEQ '1'                        B1
     C           *IN01     OREQ '1'                        *1
     C           DDCCY     ANDNEFHCCY1                     *1             S01166
     C           *IN02     OREQ '1'                        *1
     C           DDCCY     ANDNEFHCCY2                     *1             S01166
     C                     MOVEL'START'   @START           *1             S01166
     C                     END                             E1
     C*
     C                     END                             E1
     C*
     C**  DO UNTIL ALL LINES MOVED FROM DATA AREA TO DISPLAY ARRAY
     C                     Z-ADD16        @A                              S01166
     C           @Y        DOUEQ@A                         B1
     C                     SUB  1         @A               *1
     C           @A        OCUR @WORK                      *1
     C*
     C**  FIRST TIME UPDATE RR KEY FIELD WITH BOTTOM OF SCREEN DEAL NO.
     C           @A        IFEQ 15                         B*2            S01166
     C                     MOVEL@DEAL     @BOT1            **2
     C                     Z-ADD@DAMT     @BOT3            **2
     C                     END                             E*2
     C*
     C***                  MOVEL@WORK     @AR,@A           *1             S01166
     C                     EXSR #BC                        *1             S01166
     C                     END                             E1
     C*
     C**  LAST TIME UPDATE RR KEY FIELD WITH TOP OF SCREEN DEAL NO.
     C                     MOVEL@DEAL     @TOP1                           S01166
     C                     Z-ADD@DAMT     @TOP3                           S01166
     C*
     C           #BBCB9    ENDSR                           ***#BBCB9***
     C*
     C/EJECT
     C****************************************************************
     C*                                                              *
     C*     #A CARRIES OUT INITIALISATION PROCESSING.                *
     C*        CALLED BY  : MAIN PROGRAM                             *
     C*        CALLS      :                                          *
     C*                                                              *
     C*        WORK FIELDS: @T       - TERMINATION INPUT PARAMETER   *
     C*                   : @ENQ     - ENQUIRY TYPE INPUT PARAMETER  *
     C*                                                              *
     C****************************************************************
     C           #A        BEGSR
     C*
     C**  RECEIVE INPUT PARAMETERS
     C           *ENTRY    PLIST
     C                     PARM           @T      1
     C                     PARM           @PRMPT                          S01166
     C***                  PARM           @ENQ    1                       S01166
     C***                  PARM           @RRK   24                       S01166
     C*
     C**  MOVE PROGRAM NAME INTO STATUS DATA STRUCTURE FIELD.
     C**********           MOVEL'DL3130'  DBPGM                    S01166 S01117
     C                     MOVEL'TM3130'  DBPGM                           S01117
     C*
     C**  Set on Message Subfile end indicator.                           S01166
     C                     SETON                     40                   S01166
     C*                                                                   S01166
     C**  Initialise screen msg queue.                                    S01166
     C                     MOVEL'*'       DDPGMQ                          S01166
     C*                                                                   S01166
     C**  Move workstation ID to screen field.                            S01166
     C                     MOVEL@JOB      DDWSID                          S01166
     C*                                                                   S01166
     C*** DEFINE DATA AREA FOR PROGRAM                                    S01166
     C***        *NAMVAR   DEFN AMENQ1AA  AMENQ1                          S01166
     C*
     C**  KEY LIST
     C           @KEY      KLIST
     C                     KFLD           DDCCY                           S01166
     C                     KFLD           @CCYY
     C                     KFLD           @MM
     C                     KFLD           @KDD
     C*
     C*
     C**  KEY LIST
     C           @KEY1     KLIST
     C                     KFLD           DDCCY                           S01166
     C                     KFLD           @CCYY
     C                     KFLD           @MM
     C                     KFLD           @KDD
     C                     KFLD           @AMT
     C                     KFLD           @KDEAL
     C*
     C           *LIKE     DEFN @FDATE    @WDATE
     C           *LIKE     DEFN DDCCY     @@CCY                           S01166
     C************LIKE     DEFN FHDAM1    @AMT                            S01145
     C           *LIKE     DEFN @DAM1     @AMT                            S01145
     C*
     C************LIKE     DEFN FHDN38    @WDEAL                          S01145
     C           *LIKE     DEFN @DN38     @WDEAL                          S01145
     C           *LIKE     DEFN FHDN38    @EDEAL                          E12677
     C********** *LIKE     DEFN RUND      @@DAYN                          S01194
     C           *LIKE     DEFN BJRDNB    @@DAYN                          S01194
     C*
     C**  OPEN FILES
     C*                                                                   S01166
     C*********************OPEN*FDUSSILL****************************S01166S01319
     C                     OPEN MUSER                                     S01319
     C**************************************************************S01166S01319
     C*********************MOVEL@USER*****@USER3**3*****************S01166S01319
     C**************************************************************S01166S01319
     C***********@USER3****CHAINFDUSSIP0*************61*************S01166S01319
     C**************************************************************S01166S01319
     C**db*err*if*user*not*found************************************S01166S01319
     C************IN61*****IFEQ*'1'************************B1*******S01166S01319
     C*********************MOVE*'929'*****DBASE*************1*******S01166S01319
     C*********************MOVE*'FDUSSILL'DBFILE************1*******S01166S01319
     C*********************MOVEL@USER3****DBKEY*************1**ERRORS01166S01319
     C*********************MOVE*'1'********INU7*************1***929*S01166S01319
     C*********************MOVE*'1'********INU8*************1*******S01166S01319
     C*********************GOTO*#A9*************************1*******S01166S01319
     C*********************END*****************************E1*******S01166S01319
     C           @USER     CHAINMUSER                61                   S01319
     C*                                                                   S01319
     C           *IN61     IFEQ '1'                        B*2            S01319
     C*                                                                   S01319
     C                     MOVEL'MUSER'   DBFILE           ***************S01319
     C                     MOVE '929'     DBASE            *             *S01319
     C                     MOVEL@USER     DBKEY            * DBERROR 929 *S01319
     C                     MOVE '1'       *INU7                           S01319
     C                     MOVE '1'       *INU8            ************** S01319
     C*                                                                   S01408
     C/COPY WNCPYSRC,TM3130CP11                                           S01408
     C*                                                                   S01408
     C                     GOTO #A9                                       S01319
     C*                                                                   S01319
     C                     END                             E*2            S01319
     C*                                                                   S01166
     C* do file overide before open                                       S01166
     C***********USREF*****IFEQ*'Y'************************B2*******S01166S01319
     C           AURF      IFEQ 'Y'                        B*2            S01319
     C                     MOVEL@OVR,1    @OVRID           *2             S01166
     C*********************Z-ADDUSRFPD****@WAIT*************2*******S01166S01319
     C                     Z-ADDREFP      @WAIT            **2            S01319
     C                     Z-ADD36        QCALEN 155       *2             S01166
     C*********************CALL 'QCAEXEC'                  *2       S01166E20774
     C                     CALL 'QCMDEXC'                  *2             E20774
     C                     PARM           @OVRID           *2             S01166
     C                     PARM           QCALEN           *2             S01166
     C                     END                             E2             S01166
     C*                                                                   S01166
     C**********           OPEN DL3130DD                           S01166 S01117
     C                     OPEN TM3130DD                                  S01117
     C*                                                                   S01166
     C**********           OPEN FDICDRLL                                  S01194
     C*                    OPEN FX38CPLL
     C***                  OPEN CA38CPLL                                  S01166
     C**********           OPEN FDCCYTLL                                  S01194
     C                     OPEN FDMNTHLL
     C                     OPEN FXFWDTLL
     C*********************OPEN*FXSSTSLL**********************************S01319
     C                     OPEN FXOPTALL
     C*********************OPEN FXDLVALL                                  S01145
     C*********************OPEN FXFDLALL                                  S01145
     C                     OPEN CADLVALL                                  S01145
     C                     OPEN CAFDLALL                                  S01145
     C**********           OPEN CLINT                              S01145 S01194
     C*
     C**  ACCESS MONTH SHORTNAMES FILE
     C           1         CHAINFDMNTHLL             61
     C*
     C**  DEAL WITH DATA BASE ERROR
     C           *IN61     IFEQ '1'                        B1
     C           MNDLTF    OREQ '*'                        *1
     C                     MOVE 'FDMNTHLL'DBFILE           *1**********
     C                     MOVE '001'     DBASE            *1DB ERR 001
     C                     EXSR #ZD                        *1**********
     C                     GOTO #A9                        *1
     C                     END                             E1
     C*
     C****ACCESS*FXSSTSLL*FOR*OPTIONS*BY*VALUE*DATE*INDICATOR*************S01319
     C***********1*********CHAINFXSSTSLL*************61*******************S01319
     C********************************************************************S01319
     C****DEAL*WITH*DATA*BASE*ERROR***************************************S01319
     C************IN61*****IFEQ*'1'************************B1*************S01319
     C*********************MOVE*'FXSSTSLL'DBFILE************1*************S01319
     C*********************MOVE*'003'*****DBASE*************1DB*ERR*003***S01319
     C*********************EXSR*#ZD*************************1*************S01319
     C*********************GOTO*#A9*************************1*************S01319
     C*********************END*****************************E1*************S01319
     C*                                                                   E42669
     C** Access Deal details via access program                           E42669
     C*  (database error handling done in access program)                 E42669
     C**********           CALL 'AODEALR0'                                             E42669 CGL029
     C                     CALL 'AODEALR1'                                                    CGL029
     C                     PARM '*DBERR ' @RTCD   7                       E42669
     C                     PARM '*FIRST ' @OPTN   7                       E42669
     C********** SDDEAL    PARM SDDEAL    DSFDY                                        E42669 CGL029
     C           SDDEAL    PARM SDDEAL    DSSDY                                               CGL029
     C                     MOVE BNDCSP    @DSEP   1                       E42669
     C*                                                                   S01319
     C** Access Deal details via access program                           S01319
      *  (database error handling done in access program)                 S01319
     C                     CALL 'AOTRMAR0'                                S01319
     C                     PARM '*DBERR ' @RTCD   7                       S01319
     C                     PARM '*FIRST ' @OPTN   7                       S01319
     C           SDTRMA    PARM SDTRMA    DSFDY                           S01319
     C*
     C***CALL*S/R*TO*ACCESS*ICD*FILE***                                   S01194
     C**********           EXSR ZA0150                                    S01194
     C**********                                                          S01194
     C****CHECK*FOR*DATABASE*ERROR***                                     S01194
     C********** *IN80     IFEQ '1'                        B1             S01194
     C**********           EXSR #ZD                        *1             S01194
     C**********           GOTO #A9                        *1             S01194
     C**********           END                             E1             S01194
      *                                                                   S01194
      * Get Bank's details from SDBANKPD via Access Object                S01194
      * (Note that *DBERR is used as standard return code although        S01194
      * this will not normally produce a DB error due to access           S01194
      * object having already been called in SD1600)                      S01194
     C                     CALL 'AOBANKR0'                                S01194
     C                     PARM '*DBERR ' @RTCD   7                       S01194
     C                     PARM '*FIRST ' @OPTN   7                       S01194
     C           SDBANK    PARM SDBANK    DSFDY                           S01194
      *                                                                   092368
      * Re-arrange date format if BFDFIN setup is 'M' to fit in           092368
      * DDDMY definition in I specs                                       092368
      *                                                                   092368
     C           BJDFIN    IFEQ 'M'                                       092368
     C                     MOVELDDDMY     @MDTMP  5                       092368
     C                     MOVELDDDMY     @MTMP   3                       092368
     C                     MOVE @MDTMP    @DTMP   2                       092368
     C                     MOVE @MTMP     @MDTP2  5                       092368
     C                     MOVEL@DTMP     @MDTP2                          092368
     C                     MOVEL@MDTP2    DDDMY                           092368
     C                     END                                            092368
     C*
     C**  FIND CURRENT CENTURY
     C**********           Z-ADDRUND      @@DAYN                          S01194
     C                     Z-ADDBJRDNB    @@DAYN                          S01194
     C                     EXSR ZA0710
     C                     MOVEL@@SSY1    @CC     20
     C                     MOVE @@SSY2    @CC
     C                     MOVEL@CC       @CCYY
     C*
     C**  SET DEFAULT VALUE FOR @AMT
     C                     Z-ADD*HIVAL    @AMT
     C*                                                                   S01166
     C* if there is data to refresh/roll etc allow cmd keys               S01166
     C           DDCURR    IFNE *BLANKS                    B1             S01166
     C                     SETON                     27    *1             S01166
     C                     END                             E1             S01166
     C*                                                                   S01280
     C** Set up time for display                                          S01280
     C                     TIME           DDTIME                          S01280
     C*                                                                   S01166
     C* write heading text                                                S01166
     C**********           WRITEDL3130F0                           S01166 S01117
     C                     WRITETM3130F0                                  S01117
     C**********           WRITEDL3130F1                           S01166 S01117
     C                     WRITETM3130F1                                  S01117
     C*                                                                   S01166
     C                     SETON                     36                   S01166
     C                     SETOF                     35                   S01166
     C*                                                                   S01166
     C*  IF PARAMETERS BLANK,WRITE THE PROMPT SCREEN BY SETTING           S01166
     C*  ON THE SUBFILE DISPLAY CONTROL INDICATOR                         S01166
     C           DDCCY     IFEQ *BLANKS                                   S01166
     C**********           EXFMTDL3130C1                           S01166 S01117
     C                     EXFMTTM3130C1                                  S01117
     C                     END                                            S01166
     C*                                                                   S01166
     C**         *IN10     DOWEQ'1'                        B1   helpS01166S01199
     C**                   SETOF                     10    *1       S01166S01199
     C**                   CALL 'SDMENU'                   *1       S01166S01199
     C**********           READ DL3130DD               0589*1      S01166 S01117
     C                     READ TM3130DD               0589*1             S01117
     C**                   END                             E1       S01166S01199
     C*                                                                   S01166
     C* exit                                                              S01166
     C           *IN11     IFEQ '1'                        B1             S01166
     C                     MOVE 'Q'       @T               *1             S01166
     C                     END                             E1             S01166
     C*                                                                   S01166
     C                     MOVE 'Y'       @FIRST  1                       S01166
     C*                                                                   S01166
     C           #A9       ENDSR                           ***#A9***
     C/EJECT
     C*****************************************************************   S01194
     C**********                                                      *   S01194
     C***SUBROUTINE ZA0150 - THIS SUBROUTINE CHAINS TO FILE LF        *   S01194
     C***FDICDRLL TO GET THE INSTALLATION CONTROL DETAILS RECORD 1    *   S01194
     C***(HELD*ON PF/TABTB10)                                         *   S01194
     C***INDICATOR 80 IS SET ON IF THE CHAIN FAILS OR THE RECORD IS   *   S01194
     C***FLAGGED FOR DELETION.                                        *   S01194
     C***IF*INDICATOR 80 IS SET ON DETAILS OF THE ATTEMPTED ACCESS    *   S01194
     C***ARE*PLACED IN THE LDA.                                       *   S01194
     C**********                                                      *   S01194
     C***FIELDS*USED : SS0150 - KEY USED TO ACCESS FDICDRLL           *   S01194
     C**********                                                      *   S01194
     C*****************************************************************   S01194
     C**********                                                          S01194
     C********** ZA0150    BEGSR                                          S01194
     C**********                                                          S01194
     C***Set*up*key to obtain format TABTB10F '01        10'              S01194
     C**********           MOVEL'01'      SS0150 12                       S01194
     C**********           MOVE '10'      SS0150                          S01194
     C**********                                                          S01194
     C***CHAIN*TO FILE FDICDRLL                                           S01194
     C********** SS0150    CHAINFDICDRLL             80                   S01194
     C********** RECI      IFNE 'D'                        B1             S01194
     C**********           MOVE '1'       *IN80            *1             S01194
     C**********           END                             E1             S01194
     C**********                                                          S01194
     C***DEAL*WITH DATA BASE ERROR                                        S01194
     C********** *IN80     IFEQ '1'                        ***************S01194
     C**********           MOVEL'FDICDRLL'DBFILE           *             *S01194
     C**********           MOVEL'900'     DBASE            * DBERROR 900 *S01194
     C**********           MOVELSS0150    DBKEY            *             *S01194
     C**********           END                             ***************S01194
     C**********                                                          S01194
     C********** ZA0159    ENDSR                                          S01194
     C/EJECT
     C*****************************************************************
      *                                                               *
      *       TITLE:CALCULATE MIDAS DAY NO. TO DRS (YYYYMMDD) FORMAT. *
      *                                                               *
      *       SUBROUTINE ZA0710 EXPECTS FIELD '@@DAYN' TO BE          *
      *       PASSED TO IT IN 5,0 FORMAT.IF THE ABOVE FIELD IS LESS   *
      *       THAN 1 IT RETURNS 1 IN FIELD '@@RTN'.THE MAIN PROGRAM   *
      *       SHOULD CHECK FOR THIS CONDITION AND DO THE NECESSARY.   *
      *       IF '@@RTN' IS NOT EQUAL TO 1 IT RETURNS THE FIELD       *
      *       '@@VDT'  IN 'YYYYMMDD' FORMAT.                          *
      *                                                               *
      * NOTE: FIELD TO BE DEFINED BY EXTERNAL ROUTINE IS
      *                                                               *
      *       1) @@DAYN   LENGTH 5,0.                                 *
      *                                                               *
      *       FIELDS USED AND ALREADY DEFINED IN THE ROUTINE ARE:     *
      *                                                               *
      *       1) @@VDT    LENGTH 8,0 DEFINED BY A DS.                 *
      *       2) @@RTN    LENGTH 1,0.                                 *
      *       3) @@I      LENGTH 2,0 USED TO ACCESS ARRAY @YD         *
      *       4) @@J      LENGTH 2,0 USED TO ACCESS ARRAY @MD         *
      *       5) @@Z71Y   LENGTH 4,0 DEFINED BY A DS.                 *
      *       6) @@RDAY   LENGTH 5,0.                                 *
      *       7) @@LEAP   LENGTH 1,0.
      *                                                               *
      *       INDICATORS USED ARE:                                    *
      *                                                               *
      *       1) 80       CHECK FOR LOW AND EQUAL ON ARRAY @YD        *
      *       2) 81       CHECK FOR LOW ON ARRAY @MD.                 *
      *                                                               *
      * INPUT FIELD:       @@DAYN                                     *
      *                                                               *
      * OUTPUT FIELD:      @@VDT                                      *
      *                                                               *
      * WORK FIELDS:       @@RTN                                      *
      *                    @@Z71Y                                     *
      *                    @@RDAY                                     *
      *                    @@LEAP                                     *
      *                    @@I                                        *
      *                    @@J                                        *
      *                                                               *
      * ARRAYS USED:       @YD COMPILE TIME ARRAY.
      *                    @MD COMPILE TIME ARRAY.
      *
      *****************************************************************
     C*
     C           ZA0710    BEGSR
     C*
     C                     SETOF                     8081
     C                     Z-ADD0         @@RTN   10
     C                     Z-ADD0         @@VDT
     C                     Z-ADD1         @@I     20
     C                     Z-ADD1         @@J     20
     C                     Z-ADD1         @@LEAP  10
     C*
     C           @@DAYN    IFLT 1
     C                     Z-ADD1         @@RTN
     C                     GOTO ZA0719
     C                     END
     C*
     C* DIVISION TO DETERMINE WETHER LEAP YEAR.
     C*
     C           @@DAYN    DIV  1461      @@Z71Y
     C                     MVR            @@RDAY  50
     C*
     C* CALCULATING YEAR.
     C*
     C           @@Z71Y    MULT 4         @@Z71Y
     C                     ADD  1972      @@Z71Y
     C*
     C* CHECKING IF YEAR IS GREATER THAN OR EQUAL TO 2100
     C*
     C           @@Z71Y    IFGE 2100
     C                     ADD  @@SSY2    @@RDAY
     C                     END
     C*
     C* LOKUP ARRAY @YD TO SEE HOW MANY YEARS OF A FOUR YEAR CYCLE
     C* HAVE PASSED.
     C*
     C           @@RDAY    LOKUP@YD,@@I                8080
     C*
     C* IF YEAR IS A LEAP YEAR SSLEAP IS SET TO ZERO.
     C*
     C           *IN80     IFEQ '0'
     C                     Z-ADD0         @@LEAP
     C                     END
     C*
     C* ADD INDEX TO YEAR TO GIVE CORRECT YEAR AND ADJUST '@@RDAY'.
     C*
     C           @@LEAP    IFEQ 1
     C           @@RDAY    SUB  @YD,@@I   @@RDAY
     C                     ADD  @@I       @@Z71Y
     C                     END
     C*
     C* PROCESSING FOR A LEAP YEAR.
     C*
     C           @@LEAP    IFEQ 0
     C*
     C* IF '@@RDAY' = 60 DATE MUST BE 29TH OF FEBRUARY.
     C*
     C           @@RDAY    IFEQ 60
     C                     Z-ADD29        @@Z71D
     C                     Z-ADD2         @@Z71M
     C                     GOTO ZA0711
     C                     END
     C*
     C* IF '@@RDAY' > 60 DATE IS AFTER 29TH OF FEBRUARY,CONVERSION CAN
     C* PROCEED AS USUAL AFTER SUBTRACTING THE EXTRA DAY FOR THE LEAP
     C* YEAR. NOTE : '@@RDAY' < 60 CONVERSION PROCEEDS AS USUAL.
     C*
     C           @@RDAY    IFGT 60
     C           @@RDAY    SUB  1         @@RDAY
     C                     END
     C*
     C                     END
     C*
     C* IF DAY '@@DAYN' IS EXACTLY DIVISIBLE BY 1461 (NUMBER OF DAYS
     C* IN 4 YEARS) THEN DATE MUST BE LAST DAY OF PREVIOUS FOUR YEAR
     C* GROUP.
     C*
     C           @@RDAY    IFEQ 0
     C                     Z-ADD31        @@Z71D
     C                     Z-ADD12        @@Z71M
     C                     SUB  1         @@Z71Y
     C                     GOTO ZA0711
     C                     END
     C*
     C* LOOK UP ARRAY ARRAY @MD TO DETERMINE WHICH MONTH '@@RDAY'
     C* OCCURS IN
     C*
     C           @@RDAY    LOKUP@MD,@@J                81
     C                     Z-ADD@@J       @@Z71M
     C           @@RDAY    SUB  @MD,@@J   @@Z71D
     C*
     C* DS @@VDT  IS RETURNED IN YYYYMMDD FORMAT
     C*
     C           ZA0711    TAG
     C*
     C                     MOVE @@Z71Y    @@YR
     C*
     C           ZA0719    ENDSR
     C*
     C/EJECT
     C*****************************************************
     C*                                                   *
     C*   EXCEPTION ERROR SUBROUTINE                      *
     C*                                                   *
     C*   SUBROUTINE CALLED: EXECUTES WHENEVER            *
     C*   A DATABASE FILE ERROR OCCURS                    *
     C*                                                   *
     C*   SUBROUTINE CALLS : NO OTHER SUBROUTINES         *
     C*                                                   *
     C*****************************************************
     C           #ZD       BEGSR
     C*
     C                     MOVE '1'       *INU7
     C                     MOVE '1'       *INU8
     C                     MOVE 'E'       @T
     C**********           MOVEL'DL3130'  DBPGM                    S01166 S01117
     C                     MOVEL'TM3130'  DBPGM                           S01117
     C*
     C                     DUMP
     C*
     C**  TERMINATE THE PROGRAM
     C                     MOVE '1'       *INLR
     C                     RETRN
     C*
     C                     ENDSR                           ****#ZD*****
     C/EJECT
     C*****************************************************
     C*                                                   *
     C*   EXCEPTION ERROR SUBROUTINE                      *
     C*                                                   *
     C*   SUBROUTINE CALLED: EXECUTES WHENEVER            *
     C*   A PROGRAM ERROR OCCURS                          *
     C*                                                   *
     C*   SUBROUTINE CALLS : NO OTHER SUBROUTINES         *
     C*                                                   *
     C*****************************************************
     C           *PSSR     BEGSR
     C*
     C**  SET @ERR1 TO 'Y' TO PREVENT LOOPING IF FURTHER ERRORS
     C           @ERR1     IFNE 'Y'                        B1
     C                     MOVE 'Y'       @ERR1   1        *1
     C                     MOVE '1'       *INU6            *1
     C                     MOVE 'E'       @T               *1
     C*
     C**  SET UP FIELDS IN LOCAL DATA AREA
     C**********           MOVEL'DL3130'  DBPGM            *1      S01166 S01117
     C                     MOVEL'TM3130'  DBPGM            *1             S01117
     C                     MOVE '991'     DBASE            *1
     C*
     C                     DUMP                            *1
     C                     END                             E1
     C*
     C**  TERMINATE THE PROGRAM
     C                     MOVE '1'       *INLR
     C                     RETRN
     C*
     C                     ENDSR                           ****PSSR****
     C/EJECT
     C*****************************************************
     C*                                                   *
     C*   EXCEPTION ERROR SUBROUTINE                      *
     C*                                                   *
     C*   SUBROUTINE CALLED: EXECUTES WHENEVER            *
     C*   A FILE ERROR OCCURS                             *
     C*                                                   *
     C*   SUBROUTINE CALLS : NO OTHER SUBROUTINES         *
     C*                                                   *
     C*****************************************************
     C           INFSR     BEGSR
     C*
     C                     MOVE '1'       *INU7
     C                     MOVE '1'       *INU8
     C                     MOVE 'E'       @T
     C*
     C**  SET UP FIELDS IN LOCAL DATA AREA
     C**********           MOVEL'DL3130'  DBPGM                    S01166 S01117
     C                     MOVEL'TM3130'  DBPGM                           S01117
     C                     MOVE '992'     DBASE
     C                     MOVE @FILE     DBFILE
     C*
     C                     DUMP
     C*
     C**  TERMINATE THE PROGRAM
     C                     MOVE '1'       *INLR
     C                     RETRN
     C*
     C                     ENDSR                           ***INFSR***
     C/EJECT
** @YD  USED BY SR. ZA0710 - YEARS, IN DAYS, CUMULATIVE IN 4 YEAR SPAN
00366007310109601461
** @MD  USED BY SR. ZA0710 - MONTHS IN DAYS CUMULATIVE THROUGH YEAR
00000000310005900090001200015100181002120024300273003040033400365
** @OVR  CL COMMAND FOR CALL TO QCMDEXC                             S01166E20774
OVRDSPF FILE(TM3130DD) WAITRCD(9999)                               S01166 S01117
** CPY@ - COPYRIGHT STATEMENT                                             S01117
(c) Misys International Banking Systems Ltd. 2001
