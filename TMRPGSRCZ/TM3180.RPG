     H        1
      *****************************************************************
/*STD *  RPGBASE                                                      *
/*EXI *  TEXT('Midas MM Book - Monthly Summary (was DL3180)')
     F*****************************************************************
     F*                                                               *
     F*  Midas - Treasury Management Module
     F*                                                               *
     F*  TM3180 - MONEY MARKET MONTHLY SUMMARY                        *   S01166
     F*           (FORMERLY DL3180)                                   *
     F*                                                               *
     F*     Function: This enquiry shows cash flow movements in half  *
     F*     (I/C)     monthly and monthly periods.                    *
     F*                                                               *
     F*     Called by: TMC0311 - TM Enquiry control                   *
     F*           via: DL3100  - Treasury management controller       *
     F*                                                               *
     F*     Calls    : ZA0250  - Clear program message queue.         *
     F*              : ZA0240  - Display program message queue.       *
     F*              : ZA0270  - Convert date to Midas day number.    *
     F*                                                               *
     F*     Linked enquiries: TM3190 - MM Daily summary               *
     F*                       TM3200 - MM Daily deals                 *
     F*                       DL0170 - MM Deal details                *
     F*                                                               *
      *  (c) Misys International Banking Systems Ltd. 2001            *
     F*                                                               *
      * Bank Fusion Midas 1.4 Base -----------------------------------*
      * Midas Plus 1.4 Base 04 ---------------------------------------*
      * Midas Plus 1.4 Base ------------------------------------------*
      * Midas Plus 1.3 ----------- Base ------------------------------*
      *  Last Amend No. CSD031             Date 10Apr06               *
      *  Prev Amend No. TDA035             Date 02Apr04               *
      * Midas Release 4 --------------- Base -------------------------*
      * Midas DBA 3.00 ---------------- Base -------------------------*
      *                 E26595             Date 06Sep91               *
      *                 S01319             Date 14Aug91               *
     F*                 S01280             DATE 04NOV90
     F*                 S01117             DATE 25OCT90               *
     F*                 S01194             DATE 25OCT90               *
     F*                 E20774             DATE 15MAR90               *
     F*                 S01199             DATE 28FEB90               *
     F*                 S01166             DATE 27/06/88              *   S01166
     F*       AMEND NO. S01149                  22/02/88              *   S01166
     F*                                                               *   S01166
     F*****************************************************************
     F*                                                               *
      *  CSD031 - Enhanced Centralised Static Data (Recompile)        *
      *  TDA035 - RTS Signon changes for MidasPlus. (Recompile)       *
     F*  E26595 - S01280 uses @OPT in position 17 to 19 in @PRAM in   *
     F*           DL3100 which is already used by the FRA/IRS enquiry *
     F*           programs. Change to position 50 onwards in @STRNG.  *
     F*  S01319  -  Remove redundant processing
     F*  S01280 - Include FRA,IRS,FUTURES and CUSTOMER LENDING        *
     F*                - ENSURE PARMS PASSED/RECEIVED WHEN PROGRAMS   *
     F*                  ARE LINKED ARE CORRECT/STANDARDISED.         *
     F*         - IF CURRENCY SELECTED HAS NO RECORDS TO DISPLAY      *
     F*           THE SUBFILE IS CLEARED BUT HEADER CURRENCY AND DEAL *
     F*           TYPES STILL DISPLAYED AS FOR PREVIOUS SELECTION     *
     F*                                                               *
     F*  S01117 - NEW COPYRIGHT STATEMENT                             *   S01117
     F*           DEALING PROGRAMS USED ONLY IN TREASURY MGMT.        *   S01117
     F*           MODULE NOW PREFIXED WITH 'TM'                       *   S01117
     F*                                                               *
     F*  S01194 - NEW STANDING DATA PROCESSING                        *   S01194
     F*                                                               *
     F*  E20774 - REPLACE QCAEXEC WITH QCMDEXC                        *   E20774
     F*                                                               *
     F*  S01199 -  HELP SYSTEM.                                    *
     F*                                                               *   S01166
     F*  S01166 - Amendments for Treasury Management enquiries.       *   S01166
     F*                                                               *
     F*  S01149 - To allow split between L/D and N/A deal types.      *
     F*                                                               *
     F*****************************************************************
     F*                                                               *
     F*  C R E A T I O N     P A R A M E T E R S                      *
     F*                                                               *
     F*                                                               *
     F*****************************************************************
     F/EJECT
     F****************************************************************    S01166
     F*                                                                   S01166
     F* ID F  C  H  L    FUNCTION OF INDICATORS                           S01166
     F*       01         EXIT PROGRAM                                     S01166
     F*       05         REFRESH SCREEN                                   S01166
     F*       10         HELP KEY HAS BEEN PRESSED                        S01166
     F*       15         PROTECT SELECT FIELD                             S01166
     F*       25         ROLLUP REQUESTED                                 S01166
     F*       26         ROLLDOWN REQUESTED                               S01166
     F*       27         INHIBIT ROLL KEYS                                S01166
     F*                                                                   S01166
     F*       30         ACTIVATE SUBFILE END                             S01166
     F*       35         ACTIVATE SUBFILE DISPLAY                         S01166
     F*       36         ACTIVATE SUBFILE DISPLAY CONTROL                 S01166
     F*                                                                   S01166
     F*       40         ACTIVATE MESSAGE SUBFILE END                     S01166
     F*       41         LENDING INSTALLED                                S01280
     F*       42         FRA/IRS INSTALLED                                S01280
     F*       43         FUTURES INSTALLED                                S01280
     F*       46         ACTIVATE MESSAGE SUBFILE DISPLAY CONTROL         S01166
     F*                                                                   S01166
     F*       60         ERROR ON CURRENCY SELECTED                       S01166
     F*       61         ERROR ON DATE SELECTED                           S01166
     F*       61         ERROR ON DEAL TYPE SELECTED                      S01166
     F*       69         GENERAL ERROR ON VALIDATION OF PROMPT SCREEN     S01166
     F*                                                                   S01166
     F*                                                                   S01166
     F*       72         SUCCESSFULL LOKUP OF @MTH                        S01166
     F*       76         READ/CHAIN FAIL                                  S01166
     F*                                                                   S01166
     F********80*********READ/CHAIN FAIL ON CURRENCY FILE          S01166 S01194
     F*                                                                   S01166
     F*       U6         PROGRAM ERROR                                    S01166
     F*       U7         DATA BASE OR EXCEPTION ERROR                     S01166
     F*       U8         DATA BASE OR EXCEPTION ERROR                     S01166
     F*                                                                   S01166
     F*****************************************************************   S01166
     F/EJECT
     F****FDICDRLLIF**E***        K        DISK         KINFSR INFSR  UC  S01194
     F************TABTB11F                          KIGNORE               S01194
     F************TABTB20F                          KIGNORE               S01194
     FFDMNTHLLIF  E                    DISK         KINFSR INFSR      UC
     F***********CA38CPLLUF  E         DISK         KINFSR INFSR      UC  S01166
     F****FDCCYTLLIF  E           K        DISK         KINFSR INFSR  UC  S01194
     FMMFWDHLLIF  E           K        DISK         KINFSR INFSR      UC
     FMMFWDHL1IF  E           K        DISK         KINFSR INFSR      UC  S01149
     F            MMFWDHP0                          KRENAMEMMFWDHP1       S01149
     F*FDUSSILLIF**E**********K********DISK*********KINFSR*INFSRUC**S01166S01319
     FMUSER   IF  E           K        DISK         KINFSR INFSR      UC  S01319
     FDLMMTOLLIF  E                    DISK         KINFSR INFSR      UC  S01280
     F****DL3180DDCF**E**                  WORKSTN             UC  S01166 S01117
     F**********                              RRN   KSFILE DL3180S1S01166 S01117
     F**********                                    KNUM        1  S01166 S01117
     FTM3180DDCF  E                    WORKSTN                        UC  S01117
     F                                        RRN   KSFILE TM3180S1       S01117
     F                                              KNUM        1         S01117
      /EJECT
     E*
     E**  NARRATIVE ARRAY
     E********************@NARR***1***3*35                                S01149
     E*                   @NARR   1   2 35                                S01149
     E*
     E**  ARRAY OF POWERS OF TEN                                          S01166
     E                    @PW     1   9 10 0                              S01166
     E*                                                                   S01166
     E**  MONTH SHORTNAME ARRAY
     E                    @MTH       12  3
     E*
     E**  ARRAY OF MMFWDHLL INFORMATION FOR EACH MONTH
     E***                 @AM         3156                                S01166
     E*
     E**  ARRAY OF DATE YEARS IN NUMERIC FORMAT
     E**                  @YY         3  2 0                              S01166
     E                    @YY         4  2 0                              S01166
     E*
     E**  ARRAY OF DATE CENTURIES
     E**                  @CC         3  2 0                              S01166
     E                    @CC         4  2 0                              S01166
     E*
     E**  ARRAY OF DATE MONTHS
     E**                  @MM         3  2 0                              S01166
     E                    @MM         4  2 0                              S01166
     E*
     E**  WORK ARRAY OF EDITED HALF-MTH 'IN' AMOUNTS
     E                    @WI         2 15
     E*
     E**  WORK ARRAY OF EDITED HALF-MTH 'OUT' AMOUNTS
     E                    @WO         2 15
     E*
     E**  WORK ARRAY OF EDITED HALF-MTH 'NET' AMOUNTS
     E                    @WN         2 16
     E*
     E**  WORK ARRAY OF EDITED HALF-MTH 'INTEREST DUE' AMOUNTS
     E                    @WD         2 16
     E*
     E**  WORK ARRAY OF NUMERIC HALF-MTH 'IN' AMOUNTS
     E                    @TI         2 15 0
     E*
     E**  WORK ARRAY OF NUMERIC HALF-MTH 'OUT' AMOUNTS
     E                    @TO         2 15 0
     E*
     E**  WORK ARRAY OF NUMERIC HALF-MTH 'NET' AMOUNTS
     E                    @TN         2 15 0
     E*
     E**  WORK ARRAY OF NUMERIC HALF-MTH 'INTEREST DUE' AMOUNTS
     E                    @TD         2 15 0
     E*
     E**  ARRAY OF ALPHA DATES OUTPUT TO AMENQ1AA
     E*                   @DT         3  5                                S01166
     E                    @DT         4  5                                S01166
     E*
     E**  ARRAY FOR DISPLAY AMOUNT (SIGNED)(S.R. MM1016)
     E                    @A         13  1
     E*
     E**  ARRAY FOR AMOUNT INPUT    (S.R. MM1015)
     E                    @D         15  1
     E*
     E**  ARRAY FOR DISPLAY AMOUNT  (S.R. MM1015)
     E                    @J         12  1
     E*                                                                   S01166
     E**  ARRAY TO HOLD OUTPUT AMOUNT FOR ZA0860                          S01166
     E                    @OVR    1   1 36                                S01166
      **  Array to hold loan types (for display).                         S01280
     E                    @C          6  4                                S01280
     E*                                                                   S01166
     E****ARRAY*TO*SET*UP*PARAMETER*FOR*CALL*TO*QCAEXEC             S01166E20774
     E**  ARRAY TO SET UP PARAMETER FOR CALL TO QCMDEXC                   E20774
     E*                                                                   S01166
     E                    @DD    12  12  2 0                              S01166
     E*                                                                   S01166
     E                    CPY@    1   1 80                                S01117
     E* Copyright array                                                   S01117
      /EJECT
     I*
     I** DATA STRUCTURE FOR DATA AREA AMENQ1AA
     I***AMENQ      DS                           728                      S01166
     I***                                     1  35 @NARR1                S01166
     I***                                    40  42 @ACCY                 S01166
     I***                                    45  51 @THOU                 S01166
     I***                                    53  55 @HLDNA                S01166
     I***************************************45**79*@NARR2                S01149
     I***                                    99 103 @STEND                S01166
     I**************************************122*156*@NARR3                S01149
     I***                                   122 156 @NARR2                S01149
     I***                                   157 624 @AM                   S01166
     I*
     I**  DATA STRUCTURE WHICH HOLDS MMFWDHLL INFORMATION FOR
     I**  EACH CALCULATED DATE.
     I@DETLS      DS                            156
     I                                        1   5 @DTH
     I                                        6   7 @ONE
     I                                       10  19 @I1
     I                                       21  30 @O1
     I                                       32  42 @N1
     I                                       44  52 @ID1
     I                                       58  59 @TWO
     I                                       62  71 @I2
     I                                       73  82 @O2
     I                                       84  94 @N2
     I                                       96 104 @ID2
     I                                      107 111 @DTM
     I                                      114 123 @IT
     I                                      125 134 @OT
     I                                      136 146 @NT
     I                                      148 156 @IDT
     I*
     I**  DATA STRUCTURE TO CONCATENATE DATE ON MMFWDHLL RECORD
     I@RDAT       DS
     I                                        1   40HTFBYY
     I                                        5   60HTFBMM
     I*
     I**  DATA STRUCTURE TO CONCATENATE GENERATED DATE
     I@GDAT       DS
     I                                        1   20@GDAT1
     I                                        3   40@GDAT2
     I                                        5   60@GDAT3
     I*                                                                   S01149
     I****D/S*to*remove*'/'*from*input*deal*type.*Eg*'N/A'*to*'NA' S01149 S01280
     I***@DSLDN******DS                              3             S01149 S01280
     I**********                              1   3 @DLDNA         S01149 S01280
     I**********                              1   1 @LNCH          S01149 S01280
     I**********                              3   3 @DACH          S01149 S01280
     I*
     I**  DATA STRUCTURE TO SUBDIVIDE FIELD FAEPT1 ON CA38CPLL
     I*****FAEPT1      DS                                                 S01166
     I***                                     2   4 @FCCY                 S01166
     I***                                     8  10 @FMTH                 S01166
     I***                                    11  12 @FYR                  S01166
     I***                                    60  62 @LDNA                 S01166
     I***                                                                 S01166
     I**  DATA STRUCTURE TO SUBDIVIDE ROLL/REFRESH INPUT PARAMETER
     I@RRFSH      DS                              4                       S01166
     I                                        1   2 @RRMTH                S01166
     I                                        3   4 @RRYR                 S01166
     I*
     I**  MONTH SHORTNAME DATA STRUCTURE
     I@MONTH    E DSFDMNTHPP
     I                                       24  59 @MTH
     I*
     I****DATA*STRUCTURE*FOR*FDCCYTLL*KEY****                             S01194
     I***@CCYKY*     DS                                                   S01194
     I**********                              9  12 @CCYK1                S01194
     I**********                                                          S01194
     I***DATA*STRUCTURE*TO*FORMAT*THE*RUN*DATE*FROM*TABTB10***      AMEND S01194
     I***RUNA***     DS                                                   S01194
     I**********                              3   7 @RIDAT                S01194
     I*
     I***DATA*STRUCTURE*TO*FORMAT*THE*DATE*ON*THE*TOP*RECORD***     AMEND S01194
     I***FARKT1*     DS                                                   S01194
     I**********                              1   5 @TDAT                 S01194
     I*
     I**  DATA STRUCTURE TO CONVERT @@IAMT DECIMAL FIELD TO ALPHA FIELD
     I@@AMDS      DS                             15
     I                                        1  150@@IAMT
     I*                                                                   S01166
     I*                                                                   S01166
     I@STRNG      DS                            256                       S01166
     I*                                                                   S01166
     I** DATA STRUCTURE FOR INPUT PARAMETERS (SUBDIVIDE DATE)             S01166
     I*                                                                   S01166
     I                                        1   3 @STCCY                S01166
     I                                        4   5 @STDAY                S01166
     I                                        6   8 @STMTH                S01166
     I                                        9  10 @STYR                 S01166
     I                                       11  160@STDNO                S01166
     I**********                             17  19 @STINC                S01280
     I***************                        20  20 @LKNA           S01280E26595
     I***************                        21  21 @LKLD           S01280E26595
     I***************                        22  22 @LKLEN          S01280E26595
     I***************                        23  23 @LKFRA          S01280E26595
     I***************                        24  24 @LKIRS          S01280E26595
     I***************                        25  25 @LKFUT          S01280E26595
     I***************                        26  26 @LKALL          S01280E26595
     I                                       53  53 @LKNA                 E26595
     I                                       54  54 @LKLD                 E26595
     I                                       55  55 @LKLEN                E26595
     I                                       56  56 @LKFRA                E26595
     I                                       57  57 @LKIRS                E26595
     I                                       58  58 @LKFUT                E26595
     I                                       59  59 @LKALL                E26595
     I                                       20 256 @STREM                S01166
     I*                                                                   S01166
     I*                                                                   S01166
     I***@PRMCP******DS                             19             S01166 S01280
     I@PRMCP      DS                             16                       S01280
     I*                                                                   S01166
     I** DATA STRUCTURE FOR PROMPT FIELDS FOR CONTROL PROGRAM             S01166
     I*                                                                   S01166
     I                                        1   3 @CPCCY                S01166
     I                                        4   5 @CPDAY                S01166
     I                                        6  10 @CPDAT                S01166
     I                                       11  16 @CPDNO                S01166
     I**********                             17  19 @CPINC         S01166 S01280
     I*                                                                   S01166
     I@SRDAT      DS                                                      S01166
     I*                                                                   S01166
     I*   DATA STRUCTURE FOR PROMPT DATE                                  S01166
     I                                        1   3 @SRMTH                S01166
     I                                        4   5 @SRYR                 S01166
     I*                                                                   S01166
     I*                                                                   S01166
     I*                                                                   S01166
     I@OVRID      DS                             36                       S01166
     I*                                                                   S01166
     I*   DATA STRUCTURE FOR COMMAND IN ARRAY @OVR                        S01166
     I                                       32  350@WAIT                 S01166
     I*                                                                   S01280
     I@LTONT      DS                             23                       S01280
     I**  Data structure for DLMMTOLL title(1).                           S01280
     I                                        1  13 @LTON                 S01280
     I                                       14  15 @BLNK                 S01280
     I                                       16  170@SEC                  S01280
     I                                       18  18 @DASH1                S01280
     I                                       19  200@MIN                  S01280
     I                                       21  21 @DASH2                S01280
     I                                       22  230@HOUR                 S01280
     I@TOIP       DS                             23                       S01280
     I**  Data structure for DLMMTOLL title(2).                           S01280
     I                                        1  13 @TKON                 S01280
     I                                       14  15 @PR                   S01280
     I                                       16  23 @OGR                  S01280
     I            DS                                                      S01280
     I**  Data structure for DLMMTOLL time.                               S01280
     I                                        1   20@@SEC                 S01280
     I                                        3   40@@MIN                 S01280
     I                                        5   60@@HOUR                S01280
     I                                        1   60TOTLTO                S01280
     I*
     I**  PROGRAM STATUS DATA STRUCTURE
     IPSDS       SDS
     I                                      201 208 @FILE
     I                                      244 253 @JOB
     I                                      254 263 @USER
     I*
     I**  LOCAL DATA AREA FOR DATA BASE ERROR
     I           UDS
     I                                      134 141 DBFILE
     I                                      142 170 DBKEY
     I                                      171 180 DBPGM
     I                                      181 183 DBASE
     ISDCURR    E DSSDCURRPD                                              S01194
     I* External DS for Currency Details                                  S01194
     ISDBANK    E DSSDBANKPD                                              S01194
     I* External DS for Bank Details                                      S01194
     ISDMMOD    E DSSDMMODPD                                              S01194
     I* External DS for Module Details                                    S01194
     IDSSDY     E DSDSSDY                                                 S01194
     I* DS used by Access Objects (long records)                          S01194
     IDSFDY     E DSDSFDY                                                 S01194
     I* DS used by Access Objects (short records)                         S01194
      /EJECT
     C                     MOVEACPY@      BIS@   80                       S01117
     C*****************************************************************
     C*                                                               *
     C* CONTROL PROCESSING - THIS ROUTINE CONTROLS THE WHOLE PROGRAM  *
     C*                                                               *
     C* CALLED BY :                                                   *
     C*                                                               *
     C* CALLS :      #A                                               *
     C*              #B                                               *
     C*              #C                                               *
     C*                                                               *
     C* USES :                                                        *
     C*                                                               *
     C*****************************************************************
     C*
     C**  INITIAL PROCESSING
     C                     EXSR #A
     C*
     C**  MAIN PROCESSING
     C                     EXSR #B
     C*
     C**  FINAL PROCESSING
     C                     EXSR #C
     C*
     C           ENDPGM    TAG
     C*
     C*****************************************************************
      /EJECT
     C*****************************************************************
     C* SUBROUTINES USED                                              *
     C* ----------------                                              *
     C*                                                               *
     C*  1 #B     -   MAIN PROCESSING                                 *
     C*  2 MM1015 -   CONVERT AMOUNT TO DISPLAY -38 (12A)             *
     C*  3 MM1016 -   CONVERT AMOUNT TO DISPLAY -38 (13A)             *
     C*  4 #ZA    -   CALCULATE NEXT 2 MONTHS DATES                   *
     C*  5 #ZB    -   CALCULATE PREVIOUS 2 MONTHS DATES               *
     C*  6 #ZC    -   RESET ERROR INDICATORS AND CLEAR MSG QUEUE      *   S01166
     C*  7 #BA    -   CURRENT PROMPT / REFRESH PROCESSING             *
     C*  8 #BB    -   FIRST PAGE PROCESSING                           *
     C*  9 #BC    -   LAST PAGE PROCESSING                            *
     C* 10 #BD    -   ROLL UP PROCESSING                              *
     C* 11 #BE    -   ROLL DOWN PROCESSING                            *
     C* 12 #BF    -   FIELD SET UP PROCESS                            *
     C* 13 #BFA   -   HALF-MONTH PROCESS                              *
     C* 14 #BFB   -   TOTAL MONTH PROCESS                             *
     C* 15 #A     -   INITIAL PROCESSING                              *
     C* 16 #C     -   FINAL PROCESSING                                *
     C**17*ZA0150*****READ*FDICDRLL************************************   S01194
     C* 18 ZA0280 -   READ FDMNTHLL                                   *
     C* 19 *PSSR  -   PROGRAM EXCEPTION/ERROR SUBROUTINE              *
     C* 20 INFSR  -   FILE EXCEPTION/ERROR ROUTINE                    *
     C*                                                               *
     C*****************************************************************
      /EJECT
     C*****************************************************************
     C*                                                               *
     C*  #B - THIS ROUTINE CONTROLS THE MAIN PROCESSING OF THE        *
     C*       PROGRAM.                                                *
     C*                                                               *
     C*  CALLED BY : CONTROL PROCESSING                               *
     C*                                                               *
     C*  CALLS :     #BA                                              *
     C*              #BB                                              *
     C*              #BC                                              *
     C*              #BD                                              *
     C*              #BE                                              *
     C*              #BF                                              *
     C*                                                               *
     C*  USES :      @FCCY  - CURRENCY FROM CA38CPLL RECORD           *
     C***************@CCYKY***KEY*TO*ACCESS*FDCCYTLL*******************   S01194
     C*              @CCYK1 - PART OF @CCYKY ABOVE                    *
     C*              @NARR  - FIXED NARRATIVES ARRAY                  *
     C*              @NARR1 - 1ST FIXED NARRATIVE                     *
     C*              @NARR2 - 2ND FIXED NARRATIVE                     *
     C*              @ENQ   - ENQUIRY UPDATED INPUT PARAMETER         *
     C*              @NODAT - NO DATES GENERATED FLAG                 *
     C*                                                               *
     C*****************************************************************
     C*
     C           #B        BEGSR
     C*
     C**  IF LAST RECORD INDICATOR IS SET, NO FURTHER PROCESSING
     C**  IN THIS ROUTINE
     C           *INLR     CABEQ'1'       #B9
     C*                                                                   S01166
     C* CONTINUE PROCESSING UNTIL CMD 03 IS PRESSED                       S01166
     C*                                                                   S01166
     C           *IN01     DOWNE'1'                        B1             S01166
     C*                                                                   S01166
     C**  SET OFF THE SELECTION-PROCESSED INDICATOR                       S01166
     C*                                                                   S01166
     C                     MOVE 'N'       @@SLCT  1        *1             S01166
     C*                                                                   S01166
     C*   CLEAR THE MESSAGE QUEUE OF ANY OLD MESSAGES AND RESET           S01166
     C*   ANY ERROR INDICATORS                                            S01166
     C                     EXSR #ZC                        *1             S01166
     C*                                                                   S01166
     C**  READ CA38CPLL - IF NO RECORD FOUND, THIS IS A DATA BASE
     C**  ERROR
     C*          1         SETLLCA38CPLL                                  S01166
     C*                    READ CA38CPLL                 76               S01166
     C*          *IN76     IFEQ '1'                        B1             S01166
     C*                    MOVEL'001'     DBASE            *1             S01166
     C*                    MOVEL'CA38CPLL'DBFILE           ***************S01166
     C*                    MOVE '1'       *INU7            * DB ERROR 001*S01166
     C*                    MOVE '1'       *INU8            ***************S01166
     C*                    MOVE '1'       *INLR            *1             S01166
     C*                    GOTO #B9                        *1             S01166
     C*                    END                             E1             S01166
     C*                                                                   S01166
     C****MOVE*DEAL-TYPE*PROMPT*FROM*SCREEN***                     S01166 S01280
     C**********           MOVE @SRINC    @LDNA                    S01166 S01280
     C*                                                                   S01166
     C**  IF DEAL TYPE OPTION IS BLANKS THEN DEFAULT TO ALL               S01149
     C********** @LDNA     IFEQ *BLANKS                            S01149 S01280
     C**********           MOVE 'ALL'     @LDNA   3                S01166 S01280
     C**********           END                                     S01149 S01280
     C**********                                                          S01280
     C****REMOVE*SLASH*FROM*INPUT*DEAL*TYPE***                     S01149 S01280
     C**********           MOVE @LDNA     @DLDNA  3                S01149 S01280
     C**********           MOVEL@LNCH     @LDNA2  2                S01149 S01280
     C**********           MOVE @DACH     @LDNA2                   S01149 S01280
      *                                                                   S01280
      **  Move screen fields to workfields.                               S01280
     C                     MOVE DDALL     @DALL                           S01280
     C                     MOVE DDNA      @DNA                            S01280
     C                     MOVE DDLD      @DLD                            S01280
     C                     MOVE DDLEN     @DLEN                           S01280
     C                     MOVE DDFRA     @DFRA                           S01280
     C                     MOVE DDIRS     @DIRS                           S01280
     C                     MOVE DDFUT     @DFUT                           S01280
      ** If linked enquiry the selection is passed in through parameter   S01280
      ** @PRMPT.Set up deal types selected for linked enquiry.            S01280
     C           @LKNA     IFNE *BLANK                                    S01280
     C           @LKLD     ANDNE*BLANK                                    S01280
     C           @LKLEN    ANDNE*BLANK                                    S01280
     C           @LKFRA    ANDNE*BLANK                                    S01280
     C           @LKIRS    ANDNE*BLANK                                    S01280
     C           @LKFUT    ANDNE*BLANK                                    S01280
     C           @LKALL    ORNE *BLANK                                    S01280
     C                     MOVE 'Y'       DDALL                           S01280
     C                     MOVE 'Y'       @DALL                           S01280
     C                     MOVE *BLANK    @LKALL                          S01280
     C                     ELSE                                           S01280
      *                                                                   S01280
     C           @LKNA     IFNE *BLANK                                    S01280
     C                     MOVE 'Y'       DDNA                            S01280
     C                     MOVE 'Y'       @DNA                            S01280
     C                     MOVE *BLANK    @LKNA                           S01280
     C                     END                                            S01280
      *                                                                   S01280
     C           @LKLD     IFNE *BLANK                                    S01280
     C                     MOVE 'Y'       DDLD                            S01280
     C                     MOVE 'Y'       @DLD                            S01280
     C                     MOVE *BLANK    @LKLD                           S01280
     C                     END                                            S01280
      *                                                                   S01280
     C           @LKLEN    IFNE *BLANK                                    S01280
     C                     MOVE 'Y'       DDLEN                           S01280
     C                     MOVE 'Y'       @DLEN                           S01280
     C                     MOVE *BLANK    @LKLEN                          S01280
     C                     END                                            S01280
      *                                                                   S01280
     C           @LKFRA    IFNE *BLANK                                    S01280
     C                     MOVE 'Y'       DDFRA                           S01280
     C                     MOVE 'Y'       @DFRA                           S01280
     C                     MOVE *BLANK    @LKFRA                          S01280
     C                     END                                            S01280
      *                                                                   S01280
     C           @LKIRS    IFNE *BLANK                                    S01280
     C                     MOVE 'Y'       DDIRS                           S01280
     C                     MOVE 'Y'       @DIRS                           S01280
     C                     MOVE *BLANK    @LKIRS                          S01280
     C                     END                                            S01280
      *                                                                   S01280
     C           @LKFUT    IFNE *BLANK                                    S01280
     C                     MOVE 'Y'       DDFUT                           S01280
     C                     MOVE 'Y'       @DFUT                           S01280
     C                     MOVE *BLANK    @LKFUT                          S01280
     C                     END                                            S01280
     C                     END                                            S01280
      *                                                                   S01280
      * If 'ALL' selected or all input fields are blank select 'ALL'.     S01280
      * or if 'ALL' is blank and all other select fields are selected     S01280
      * - this will save processing as MMFWDHLL will be processed.        S01280
     C********** @DALL     IFNE *BLANKS                            S01280 S01280
     C********** @DALL     OREQ *BLANK                             S01280 S01280
     C           @DALL     IFEQ *BLANK                                    S01280
     C           @DNA      ANDEQ*BLANK                                    S01280
     C           @DLD      ANDEQ*BLANK                                    S01280
     C           @DLEN     ANDEQ*BLANK                                    S01280
     C           @DFRA     ANDEQ*BLANK                                    S01280
     C           @DIRS     ANDEQ*BLANK                                    S01280
     C           @DFUT     ANDEQ*BLANK                                    S01280
     C           @DALL     ORNE *BLANK                                    S01280
     C********** @DALL     OREQ *BLANK                             S01280 S01280
     C********** @DNA      ANDNE*BLANK                             S01280 S01280
     C********** @DLD      ANDNE*BLANK                             S01280 S01280
     C********** @DLEN     ANDNE*BLANK                             S01280 S01280
     C********** @DFRA     ANDNE*BLANK                             S01280 S01280
     C********** @DIRS     ANDNE*BLANK                             S01280 S01280
     C********** @DFUT     ANDNE*BLANK                             S01280 S01280
     C                     MOVE 'ALL'     @LDNA   3                       S01280
     C                     MOVE 'Y'       @DLD                            S01280
     C                     MOVE 'Y'       @DNA                            S01280
      * If LENDING installed.                                             S01280
     C           BGCSLN    IFEQ 'Y'                                       S01280
     C                     MOVE 'Y'       @DLEN                           S01280
     C                     END                                            S01280
      * If FRA/IRS installed.                                             S01280
     C           BGFIIN    IFEQ 'Y'                                       S01280
     C                     MOVE 'Y'       @DFRA                           S01280
     C                     MOVE 'Y'       @DIRS                           S01280
     C                     END                                            S01280
      * If FUTURES installed.                                             S01280
     C           BGFUOP    IFEQ 'Y'                                       S01280
     C                     MOVE 'Y'       @DFUT                           S01280
     C                     END                                            S01280
      *                                                                   S01280
     C                     ELSE                                           S01280
     C                     MOVE *BLANKS   @LDNA                           S01280
     C                     END                                            S01280
      *                                                                   S01280
      **  Set up '* TAKE ON IN PROGRESS *' or 'LAST TAKE ON xx:xx:xx      S01280
      *                                                                   S01280
     C           1         SETLLDLMMTOLL                                  S01280
     C                     READ DLMMTOLL                 79               S01280
      *                                                                   S01280
     C           TOTOIP    IFEQ 'Y'                                       S01280
     C                     MOVEL'* TAKE ' @TKON                           S01280
     C                     MOVE 'ON IN '  @TKON                           S01280
     C                     MOVE 'PR'      @PR                             S01280
     C                     MOVEL'OGRESS ' @OGR                            S01280
     C                     MOVE '*'       @OGR                            S01280
     C                     MOVE @TOIP     @DSTS                           S01280
     C                     ELSE                                           S01280
     C                     MOVEL' LAST T' @LTON                           S01280
     C                     MOVE 'AKE ON'  @LTON                           S01280
     C                     MOVE *BLANKS   @BLNK                           S01280
     C                     MOVE @@SEC     @SEC                            S01280
     C                     MOVE ':'       @DASH1                          S01280
     C                     MOVE @@MIN     @MIN                            S01280
     C                     MOVE ':'       @DASH2                          S01280
     C                     MOVE @@HOUR    @HOUR                           S01280
     C                     MOVE @LTONT    @DSTS                           S01280
     C                     END                                            S01280
     C*                                                                   S01280
     C*
     C** SET UP L/D, N/A OR ALL HEADING                                   S01149
     C*****                MOVE @LDNA     @HLDNA  3                       S01166
     C*                                                                   S01166
     C**  READ THE CURRENCIES FILE USING POSITIONS 2-4 OF FAEPT1 FROM
     C**  THE CA38CPLL RECORD JUST ACCESSED
     C*                    MOVEL'20'      @CCYKY                          S01166
     C*                    MOVE '1'       @CCYK1                          S01166
     C*                    MOVEL@FCCY     @CCYK1                          S01166
     C*          @CCYKY    CHAINFDCCYTLL             80                   S01166
     C*
     C**  IF A DATA BASE ERROR HAS OCCURRED, SET U7, U8
     C**  AND LR. NO FURTHER PROCESSING IN THIS ROUTINE.
     C*          *IN80     IFEQ '1'                        B1             S01166
     C*                    MOVEL'FDCCYTLL'DBFILE           *1             S01166
     C*                    MOVEL@CCYKY    DBKEY            *1             S01166
     C*                    MOVEL'002'     DBASE            *1             S01166
     C*                    MOVE '1'       *INU7            ***************S01166
     C*                    MOVE '1'       *INU8            * DB ERROR 002*S01166
     C*                    MOVE '1'       *INLR            ***************S01166
     C*                    GOTO #B9                        *1             S01166
     C*                    END                             E1             S01166
     C*
      * The following processing is now performed in screen validation    S01194
      * routine #BAA to avoid wrongly producing a database error if an    S01194
      * invalid currency is entered                                       S01194
     C****ACCESS*THE*CURRENCIES*FILE*TO*GET*CDP****                S01166 S01194
     C**********           MOVEL'20'      @CCYKY                   S01166 S01194
     C**********           MOVE '1'       @CCYK1                   S01166 S01194
     C**********           MOVEL@SRCCY    @CCYK1                   S01166 S01194
     C********** @CCYKY    CHAINFDCCYTLL             80            S01166 S01194
     C**********                                                   S01166 S01194
     C****SET*UP*SCALE*FACTOR*BY*WHICH*NUMERIC*AMOUNTS*ARE*TO*BE*DIS01166 S01194
     C********** CDP       ADD  3         @S      10       *1      S01166 S01194
     C**********           Z-ADD@PW,@S    @SCALE 100       *1      S01166 S01194
     C*                                                                   S01166
     C*                                                                   S01166
     C*   IF REFRESH REQUESTED USE TOP RECORD AND PROCESS AS FOR ENTER    S01166
     C*                                                                   S01166
     C           *IN05     IFEQ '1'                        B*2            S01166
     C                     MOVE @TOPRD    @RRFSH           **2            S01166
     C                     EXSR #BA                        **2            S01166
     C*                                                                   S01166
     C*   IF NOT REFRESH,IT MUST EITHER BE 'ENTER',ROLLUP OR              S01166
     C*   ROLLDOWN. IN THIS CASE SELECTION TAKES PRIORITY.IE,IF           S01166
     C*   A SELECTION HAS BEEN MADE,ROLLUP/ROLLDOWN BEHAVE AS 'ENTER'     S01166
     C*   AND THE SELECTION IS PROCESSED OVER AND ABOVE ANY PROMPTS       S01166
     C*   THAT MIGHT HAVE BEEN ENTERED                                    S01166
     C*                                                                   S01166
     C                     ELSE                            X*2            S01166
     C*                                                                   S01166
     C*   IF NO SUBFILE WRITTEN YET,IE STILL ON PROMPT SCREEN             S01166
     C*   THEN CANNOT READ SUBFILE                                        S01166
     C           *IN27     IFNE '1'                        B**3           S01166
     C*                                                                   S01166
     C*   DO UNTIL EITHER A SELECTION IS FOUND ON THE SUBFILE OR          S01166
     C*   THE END OF THE SUBFILE IS REACHED                               S01166
     C           @@SLCT    DOUEQ'Y'                        B***4          S01166
     C           *IN70     OREQ '1'                        X***4          S01166
     C*                                                                   S01166
     C*   READ THE SUBFILE FOR THE FIRST CHANGED RECORD                   S01166
     C*                                                                   S01166
     C**********           READCDL3180S1                 70***4    S01166 S01117
     C                     READCTM3180S1                 70***4           S01117
     C*                                                                   S01166
     C*   IF RECORD FOUND AND SELECT FIELD NOT BLANK RETURN TO            S01166
     C*   CONTROLLING PROGRAM WITH PARAMETERS SET UP AS DATA OF           S01166
     C*   RECORD SELECTED FROM SUBFILE                                    S01166
     C                     MOVE DDDAT     @HALF   2                       S01166
     C           @HALF     IFEQ '-1'                       B***5          S01166
     C                     MOVE '01'      @CPDAY           ****5          S01166
     C                     ELSE                            X***5          S01166
     C                     MOVE '15'      @CPDAY           ****5          S01166
     C                     END                             E***5          S01166
     C           *IN70     IFNE '1'                        B***5          S01166
     C           SSSLCT    ANDNE' '                        X***5          S01166
     C                     MOVE 'D'       @TERM            ****5          S01166
     C                     MOVE @SCCY     @CPCCY           ****5          S01166
     C                     MOVE DDDAT2    @CPDAT           ****5          S01166
      * move deal types selected to parameter so that when returns from   S01280
      * detailed enquiry reverts to correct selected deals displayed.     S01280
     C                     MOVE @DNA      @LKNA            ****5          S01280
     C                     MOVE @DLD      @LKLD            ****5          S01280
     C                     MOVE @DLEN     @LKLEN           ****5          S01280
     C                     MOVE @DFRA     @LKFRA           ****5          S01280
     C                     MOVE @DIRS     @LKIRS           ****5          S01280
     C                     MOVE @DFUT     @LKFUT           ****5          S01280
     C                     MOVE @DALL     @LKALL           ****5          S01280
     C**********           MOVE @SDTYP    @CPINC           ****5   S01166 S01280
     C                     MOVEL@PRMCP    @STRNG           ****5          S01166
     C*                                                                   S01166
     C*   SET THE SELECT FIELD FOR THE RECORD JUST PROCESSED TO           S01166
     C*   BLANK AND UPDATE THE SUBFILE.                                   S01166
     C*   SET ON THE SELECTION PROCESSED INDICATOR FOR WHEN THIS          S01166
     C*   PROGRAM IS RECALLED                                             S01166
     C*                                                                   S01166
     C                     MOVE ' '       SSSLCT           ****5          S01166
     C**********           UPDATDL3180S1                   ****5   S01166 S01117
     C                     UPDATTM3180S1                   ****5          S01117
     C                     MOVE 'Y'       @@SLCT           ****5          S01166
     C                     RETRN                           ****5          S01166
     C*                                                                   S01166
     C*   SET OFF ROLLUP/ROLLDOWN INDICATORS SO THAT IF PROGRAM IS        S01166
     C*   RECALLED A ROLL WILL NOT BE PROCESSED                           S01166
     C*                                                                   S01166
     C                     MOVE '0'       *IN25            ****5          S01166
     C                     MOVE '0'       *IN26            ****5          S01166
     C*                                                                   S01166
     C                     END                             E****5         S01166
     C                     END                             E***4          S01166
     C                     END                             E**3           S01166
     C*                                                                   S01166
     C*   IF NO SELECTION HAS BEEN FOUND IN THE SUBFILE THEN PROCESS      S01166
     C*   AN 'ENTER',ROLLUP OR ROLLDOWN.                                  S01166
     C*                                                                   S01166
     C*   'ENTER' PROCESSING                                              S01166
     C*                                                                   S01166
     C           *IN25     IFNE '1'                        B**3           S01166
     C           *IN26     ANDNE'1'                        X**3           S01166
     C           *IN05     ANDNE'1'                        B**3           S01166
     C                     EXSR #BA                        ***3           S01166
     C                     END                             E**3           S01166
     C*                                                                   S01166
     C*   IF ROLLUP HAS BEEN PRESSED                                      S01166
     C*                                                                   S01166
     C           *IN25     IFEQ '1'                        B**3           S01166
     C                     MOVE @BOTRD    @RRFSH           ***3           S01166
     C                     EXSR #BD                        ***3           S01166
     C                     END                             E**3           S01166
     C*                                                                   S01166
     C*   IF ROLLDOWN HAS BEEN PRESSED                                    S01166
     C*                                                                   S01166
     C           *IN26     IFEQ '1'                        B**3           S01166
     C                     MOVE @TOPRD    @RRFSH           ***3           S01166
     C                     EXSR #BE                        ***3           S01166
     C                     END                             E**3           S01166
     C**  SET UP FIXED NARRATIVE FIELDS
     C*                    MOVE @NARR,1   @NARR1                          S01166
     C*                    MOVE @NARR,2   @NARR2                          S01166
     C*********************MOVE*@NARR,3***@NARR3                          S01149
     C*
     C**  SET UP CURRENCY NARRATIVE
     C*                    MOVE @FCCY     @ACCY                           S01166
     C*
     C**  GENERATE 3 DATES ACCORDING TO VALUE OF ENQUIRY UPDATED
     C**  INPUT PARAMETER.
     C*          @ENQ      IFEQ ' '                        B1             S01166
     C*          @ENQ      OREQ 'R'                        *1             S01166
     C*                    EXSR #BA                        *1             S01166
     C*                    END                             E1             S01166
     C*
     C*          @ENQ      CASEQ'F'       #BB              B1             S01166
     C*          @ENQ      CASEQ'L'       #BC              *1             S01166
     C*          @ENQ      CASEQ'U'       #BD              *1             S01166
     C*          @ENQ      CASEQ'D'       #BE              *1             S01166
     C*                    END                             E1             S01166
     C*
     C**  IF DATES HAVE BEEN GENERATED, AND THE 'NO-RECORDS-IN-
     C**  PERIOD-FLAG' IS NOT SET, SET UP FIELDS IN @AMENQ.
     C*          @NODAT    IFEQ 'N'                        B1             S01166
     C*                    EXSR #BF                        *1             S01166
     C*                    END                             E1             S01166
     C*
     C                     END                             E*2            S01166
     C*                                                                   S01166
     C*   IF THE ROLL/REFRESH KEYS ARE STILL INHIBITED THEN               S01166
     C*   SET OFF THE INDICATOR AND WRITE HEADER                          S01166
     C*                                                                   S01166
      * (only enable rollup/rolldown if subfile has been written)         S01280
     C           @SFILE    IFEQ 'Y'                        B2             S01280
     C                     MOVE '0'       *IN27            *1             S01166
     C                     END                             E2             S01280
      *                                                                   S01280
     C**********           WRITEDL3180F0               63  *1      S01166 S01117
     C                     WRITETM3180F0               63  *1             S01117
     C*                                                                   S01166
     C*   WRITE THE MESSAGE SUBFILE - IF THERE IS AN ERROR TO             S01166
     C*   DISPLAY OTHERWISE IT WILL REMOVE ANY PREVIOUS ERROR             S01166
     C*   MESSAGES ON THE SCREEN                                          S01166
     C*                                                                   S01166
     C                     MOVE '1'       *IN46            *1             S01166
     C**********           WRITEDL3180C0               63  *1      S01166 S01117
     C                     WRITETM3180C0               63  *1             S01117
     C*                                                                   S01166
     C*   WRITE THE COMMAND KEYS TEXT IF NO ERROR                         S01166
     C*                                                                   S01166
     C           @@ERMS    IFEQ 'N'                        B*2            S01166
     C**********           WRITEDL3180F1               63  **2     S01166 S01117
     C                     WRITETM3180F1               63  **2            S01117
     C                     END                             E*2            S01166
     C*                                                                   S01166
     C*    IF ERROR  LEAVE PREVIOUS SUBFILE ON SCREEN                     S01166
     C*    IF STILL ON PROMPT SCREEN (IE TOP RIGHT HAND CURRENCY          S01166
     C*    FIELD IS BLANK) JUST WRITE SUBFILE CONTROL                     S01166
     C*                                                                   S01166
     C*****      @SCCY     IFEQ *BLANKS                    B*2     S01166 S01280
     C           @SFILE    IFNE 'Y'                        **2            S01280
     C           @RRFSH    ANDEQ*BLANKS                    **2            S01166
     C                     MOVE '0'       *IN35            **2            S01166
     C                     MOVE '1'       *IN27            **2            S01166
     C                     ELSE                            X*2            S01166
     C                     MOVE '1'       *IN35            **2            S01166
     C                     END                             E*2            S01166
     C*                                                                   S01166
     C*    SET UP PROMPT FIELD FOR COMPARISON                             S01166
     C                     MOVEL@SRCCY    @COMP1  8        *1             S01166
     C                     MOVE @SRDAT    @COMP1           *1             S01166
     C*                                                                   S01166
     C*                                                                   S01166
     C*    WRITE THE SUBFILE CONTROL                                      S01166
     C*                                                                   S01166
     C                     MOVE '1'       *IN36            *1             S01166
     C**********           WRITEDL3180C1               63  *1      S01166 S01117
     C                     WRITETM3180C1               63  *1             S01117
     C*                                                                   S01166
     C*   READ THE ENQUIRY SUBFILE CONTROL FOR ROLLS/REFRESH/PROMPTS      S01166
     C*                                                                   S01166
     C**                   READ DL3180C1                 73*1             S01166
     C**********           READ DL3180DD               0573*1      S01166 S01117
     C                     READ TM3180DD               0573*1             S01117
     C*                                                                   S01166
     C*    SET UP PROMPT FIELD FOR COMPARISON                             S01166
     C                     MOVEL@SRCCY    @COMP2  8        *1             S01166
     C                     MOVE @SRDAT    @COMP2           *1             S01166
     C*                                                                   S01166
     C*    SET UP THE CONDITIONS AND SETON @1ERR SO THAT IF FIRST         S01166
     C*    FIELDS ENTERED IN ERROR AND REFRESH REQUESTED,THE PROMPTS      S01166
     C*    WILL BE REDISPLAYED WITH NO PROCESSING UNTIL NEW PROMPTS       S01166
     C*    ENTERED                                                        S01166
     C*                                                                   S01166
     C                     MOVE 'N'       @1ERR   1         *1            S01166
     C           @SCCY     IFEQ *BLANKS                     B*2           S01166
     C           @RRFSH    ANDEQ*BLANKS                     **2           S01166
     C           @COMP1    ANDEQ@COMP2                      **2           S01166
     C                     MOVE 'Y'       @1ERR             **2           S01166
     C                     END                              E*2           S01166
     C*                                                                   S01166
     C*   PROCESS HELP WHILE IT IS REQUESTED AND RE-READ THE SCREEN       S01166
     C*                                                                   S01166
     C**         *IN10     DOWEQ'1'                         B*2    S01166 S01199
     C**                   CALL 'SDMENU'                    **2    S01166 S01199
     C**                   MOVE '0'       *IN10             **2    S01166 S01199
     C**                   READ DL3180DD               0573 **2    S01166 S01199
     C**                   END                              E*2    S01166 S01199
     C*                                                                   S01166
     C                     END                              E1            S01166
     C*                                                                   S01166
     C           #B9       ENDSR
     C*
     C*****************************************************************
     C/EJECT                                                              S01166
     C*****************************************************************   S01166
     C*                                                               *   S01166
     C* #ZC      - RESET ERROR INDICATORS AND CLEAR MESSAGE QUEUE     *   S01166
     C*                                                               *   S01166
     C*                                                               *   S01166
     C* CALLS    - ZA0250  -  CLEAR PROGRAM SUBFILE MESSAGE QUEUE     *   S01166
     C*                                                               *   S01166
     C* CALLED BY  #B      -  MAIN PROCESSING                         *   S01166
     C*                                                               *   S01166
     C* FLDS USED  @@ERMS  - ERROR-MESSAGE-TO-DISPLAY INDICATOR       *   S01166
     C*                                                               *   S01166
     C*****************************************************************   S01166
     C*                                                                   S01166
     C           #ZC       BEGSR                                          S01166
     C*                                                                   S01166
     C** RESET ALL FIELD ERROR INDICATORS.                                S01166
     C*                                                                   S01166
     C                     MOVE '0'       *IN60                           S01166
     C                     MOVE '0'       *IN61                           S01166
     C                     MOVE '0'       *IN62                           S01166
     C*                                                                   S01166
     C** RESET THE GENERAL-ERROR-IN-VALIDATION INDICATOR                  S01166
     C*                                                                   S01166
     C                     MOVE '0'       *IN69                           S01166
     C*                                                                   S01166
     C** RESET THE ERROR RETURN CODE FROM ZA0270                          S01166
     C*                                                                   S01166
     C                     MOVE ' '       @RTCDE                          S01166
     C*                                                                   S01166
     C** RESET THE ERROR-MESSAGE-TO-DISPLAY INDICATOR                     S01166
     C*                                                                   S01166
     C                     MOVE 'N'       @@ERMS  1                       S01166
     C*                                                                   S01166
     C** CLEAR SCREEN MESSAGE QUEUE.                                      S01166
     C*                                                                   S01166
     C                     CALL 'ZA0250'                                  S01166
     C*                                                                   S01166
     C           #ZC9      ENDSR                                          S01166
     C*****************************************************************   S01166
      /EJECT
     C****************************************************************
     C*                                                              *
     C*     MM1015 -  CONVERT AMOUNT TO DISPLAY -38                  *
     C*     This routine converts a 15N amount with up to 3 implied  *
     C*     decimal places into a 12A field with thousands integer   *
     C*     half adjusted & leading zeroes suppressed.               *
     C*                                                              *
     C*       CALLS: NONE                                            *
     C*                                                              *
     C*       INPUT: @@IAMT 15,0  INPUT AMOUNT                       *
     C*              @@CCY  3A    INPUT CURRENCY                     *
     C*                                                              *
     C*      OUTPUT: @@AMNT 12A   AMOUNT TO DISPLAY                  *
     C*                                                              *
     C*        USES: @@CCY2       STORED CURRENCY                    *
     C*              @@CDP        CURRENCY DECIMAL PLACES            *
     C*              @@I          INDEX TO ARRAY OF AMOUNT           *
     C*              @@C          INDEX TO ARRAY OF DISPLAY AMOUNT   *
     C*              @D           ARRAY OF AMOUNT                    *
     C*              @J           ARRAY OF DISPLAY AMOUNT            *
     C*                                                              *
     C*                                                              *
     C****************************************************************
     C*
     C           MM1015    BEGSR
     C*
     C**  INITIALISE ARRAY.
     C                     MOVEA*BLANKS   @D
     C                     MOVEA*BLANKS   @J
     C*
     C**  Compare input currency this time with last time value
     C           @@CCY     IFNE @@CCY2                     B1
     C*
     C**  Access currencies file
      **  (Via access object)                                             S01194
     C****Load*key***                                                     S01194
     C**********           MOVEL'20'      @@KEY  12        *1             S01194
     C**********           MOVE '1'       @@ENDK  4        *1             S01194
     C**********           MOVEL@@CCY     @@ENDK           *1             S01194
     C**********           MOVE @@ENDK    @@KEY            *1             S01194
     C**********                                                          S01194
     C********** @@KEY     CHAINFDCCYTLL             80    *1             S01194
     C**********                                                          S01194
     C********** *IN80     IFEQ '1'                        B*2            S01194
     C**********           MOVE '931'     DBASE            ***************S01194
     C**********           MOVEL'FDCCYTLL'DBFILE           *             *S01194
     C**********           MOVE @@KEY     DBKEY            * DBERROR 931 *S01194
     C**********           MOVE '1'       *INU7            *             *S01194
     C**********           MOVE '1'       *INU8            ***************S01194
     C**********           GOTO M10159                     **2            S01194
     C**********           END                             E*2            S01194
      *                                                                   S01194
     C                     CALL 'AOCURRR0'                                S01194
     C                     PARM '*DBERR ' @RTCD   7                       S01194
     C                     PARM '*KEY   ' @OPTN   7                       S01194
     C                     PARM           @@CCY   3                       S01194
     C           SDCURR    PARM SDCURR    DSSDY                           S01194
     C*
     C                     MOVE @@CCY     @@CCY2  3        *1
     C*
     C** Store number of decimal places for the currency
     C**********           MOVE CDP       @@CDP   10       *1             S01194
     C                     MOVE A6NBDP    @@CDP   10       *1             S01194
     C*
     C                     END                             E1
     C*
     C** Ensure input amount is +ve.
     C           @@IAMT    IFLT 0                          B1
     C                     Z-SUB@@IAMT    @@IAMT           *1
     C                     END                             E1
     C*
     C** Round up figures to the nearest thousand.
     C** & store initial array index value
     C           @@CDP     IFEQ 0                          B1
     C                     ADD  500       @@IAMT 150       *1
     C                     Z-ADD12        @@I              *1
     C                     END                             E1
     C*
     C           @@CDP     IFEQ 1                          B1
     C                     ADD  5000      @@IAMT           *1
     C                     Z-ADD11        @@I              *1
     C                     END                             E1
     C*
     C           @@CDP     IFEQ 2                          B1
     C                     ADD  50000     @@IAMT           *1
     C                     Z-ADD10        @@I              *1
     C                     END                             E1
     C*
     C           @@CDP     IFEQ 3                          B1
     C                     ADD  500000    @@IAMT           *1
     C                     Z-ADD9         @@I              *1
     C                     END                             E1
     C*
     C**  Place input amount into a 15 x 1 byte array
     C                     MOVEA@@AMDS    @D
     C*
     C**  Load output amount into a 12 x 1 byte array
     C                     Z-ADD12        @@C
     C           @@I       DOWGT0                          B1
     C                     MOVE @D,@@I    @J,@@C           *1
     C                     SUB  1         @@C     20       *1
     C                     SUB  1         @@I     20       *1
     C                     END                             E1
     C*
     C** Test successive elements of output amount setting zeroes to
     C** blanks until the first element or a 'non zero' is reached.
     C                     Z-ADD1         @@C
     C*
     C           @J,@@C    DOUNE'0'                        B1
     C           @J,@@C    ANDNE*BLANK                     *1
     C           @@C       OREQ 12                         *1
     C                     MOVE *BLANK    @J,@@C           *1
     C                     ADD  1         @@C              *1
     C                     END                             E1
     C*
     C** MOVE @J TO DISPLAY FIELD
     C                     MOVEA@J        @@AMNT 12
     C*
     C           M10159    ENDSR                           **M10159**
     C*
     C****************************************************************
      /EJECT
     C*****************************************************************
     C*                                                               *
     C*     MM1016 -  CONVERT AMOUNT TO DISPLAY -38                   *
     C*     This routine converts a 15N amount with up to 3 implied  *
     C*     decimal places into a 13A field with thousands integer   *
     C*     half adjusted , leading zeroes suppressed & signed(+ or  *
     C*     -).                                                      *
     C*                                                               *
     C*       CALLS: NONE                                            *
     C*                                                              *
     C*       INPUT: @@IAMT 15,0  INPUT AMOUNT                       *
     C*              @@CCY  3A    INPUT CURRENCY                     *
     C*                                                              *
     C*      OUTPUT: @@AMOU 13A   SIGNED AMOUNT TO DISPLAY           *
     C*                                                              *
     C*        USES: @@AMNT       AMOUNT TO DISPLAY                  *
     C*              @@SIGN       SIGN OF AMOUNT                     *
     C*              @A           ARRAY OF DISPLAY AMOUNT (SIGNED)   *
     C*                                                              *
     C*                                                              *
     C****************************************************************
     C*
     C           MM1016    BEGSR
     C*
     C** Initialise fields
     C                     MOVEA*BLANKS   @A
     C                     MOVE *BLANKS   @@AMOU 13
     C                     MOVE *BLANK    @@SIGN
     C*
     C** Find sign of input field
     C           @@IAMT    IFGT *ZERO                      B1
     C                     MOVE '+'       @@SIGN  1        *1
     C                     ELSE                            X1
     C           @@IAMT    IFLT *ZERO                      B*2
     C                     MOVE '-'       @@SIGN           **2
     C                     MULT -1        @@IAMT           **2
     C                     END                             E*2
     C                     END                             E1
     C*
     C**  Execute MM1015 to convert the input amount to display format.
     C                     EXSR MM1015
     C*
     C** If a database error was discovered by MM1015 exit routine.
     C           *INU7     IFEQ '1'                        B1
     C                     GOTO M10169                     *1
     C                     END                             E1
     C*
     C** Place output amount into array @A
     C                     MOVEL@@AMNT    @@AMOU
     C                     MOVEA@@AMOU    @A
     C*
     C** Place sign into array & move to output field.
     C                     MOVE @@SIGN    @A,13
     C                     MOVEA@A        @@AMOU
     C*
     C           M10169    ENDSR                           **M10169**
     C*
     C****************************************************************
      /EJECT
     C*****************************************************************
     C*                                                               *
     C*  #ZA - THIS ROUTINE CALCULATES THE DATE COMPONENTS OF THE     *
     C*        NEXT TWO CONSECUTIVE MONTHS, GIVEN THAT THE DATE       *
     C*        COMPONENTS OF THE FIRST MONTH HAVE ALREADY BEEN        *
     C*        CALCULATED.                                            *
     C*                                                               *
     C*  CALLED BY : #BA                                              *
     C*              #BB                                              *
     C*              #BD                                              *
     C*                                                               *
     C*  CALLS :                                                      *
     C*                                                               *
     C*  USES:       @YY    - ARRAY OF DATE YEARS                     *
     C*              @CC    - ARRAY OF DATE CENTURIES                 *
     C*              @MM    - ARRAY OF DATE MONTH NUMBERS             *
     C*                                                               *
     C*****************************************************************
     C*
     C           #ZA       BEGSR
     C*
     C**  CALCULATE THE DATE COMPONENTS FOR THE SECOND CONSECUTIVE
     C**  MONTH
     C           @MM,1     ADD  1         @MM,2
     C                     Z-ADD@YY,1     @YY,2
     C                     Z-ADD@CC,1     @CC,2
     C           @MM,2     IFGT 12                         B1
     C                     Z-ADD01        @MM,2            *1
     C           @YY,1     IFEQ 99                         B*2
     C                     Z-ADD0         @YY,2            **2
     C                     Z-ADD20        @CC,2            **2
     C                     ELSE                            X*2
     C           @YY,2     ADD  1         @YY,2            **2
     C                     END                             E*2
     C                     END                             E1
     C*
     C**  CALCULATE THE DATE COMPONENTS FOR THE THIRD CONSECUTIVE
     C**  MONTH
     C           @MM,2     ADD  1         @MM,3
     C                     Z-ADD@YY,2     @YY,3
     C                     Z-ADD@CC,2     @CC,3
     C           @MM,3     IFGT 12                         B1
     C                     Z-ADD01        @MM,3            *1
     C           @YY,2     IFEQ 99                         B*2
     C                     Z-ADD0         @YY,3            **2
     C                     Z-ADD20        @CC,3            **2
     C                     ELSE                            X*2
     C           @YY,2     ADD  1         @YY,3            **2
     C                     END                             E*2
     C                     END                             E1
     C*
     C**  CALCULATE THE DATE COMPONENTS FOR THE FOURTH CONSECUTIVE        S01166
     C**  MONTH                                                           S01166
     C           @MM,3     ADD  1         @MM,4                           S01166
     C                     Z-ADD@YY,3     @YY,4                           S01166
     C                     Z-ADD@CC,3     @CC,4                           S01166
     C           @MM,4     IFGT 12                         B1             S01166
     C                     Z-ADD01        @MM,4            *1             S01166
     C           @YY,3     IFEQ 99                         B*2            S01166
     C                     Z-ADD0         @YY,4            **2            S01166
     C                     Z-ADD20        @CC,4            **2            S01166
     C                     ELSE                            X*2            S01166
     C           @YY,3     ADD  1         @YY,4            **2            S01166
     C                     END                             E*2            S01166
     C                     END                             E1             S01166
     C*                                                                   S01166
     C           #ZA9      ENDSR
     C*
     C*****************************************************************
      /EJECT
     C*****************************************************************
     C*                                                               *
     C*  #ZB - THIS ROUTINE CALCULATES THE DATE COMPONENTS OF THE     *
     C*        PREVIOUS TWO CONSECUTIVE MONTHS, GIVEN THAT THE DATE   *
     C*        COMPONENTS OF THE THIRD MONTH HAVE ALREADY BEEN        *
     C*        CALCULATED.                                            *
     C*                                                               *
     C*  CALLED BY : #BC                                              *
     C*              #BE                                              *
     C*                                                               *
     C*  CALLS :                                                      *
     C*                                                               *
     C*  USES:       @YY    - ARRAY OF DATE YEARS                     *
     C*              @CC    - ARRAY OF DATE CENTURIES                 *
     C*              @MM    - ARRAY OF DATE MONTH NUMBERS             *
     C*                                                               *
     C*****************************************************************
     C*
     C           #ZB       BEGSR
     C*                                                                   S01166
     C**  CALCULATE THE DATE COMPONENTS FOR THE THIRD CONSECUTIVE         S01166
     C**  MONTH                                                           S01166
     C           @MM,4     SUB  1         @MM,3                           S01166
     C                     Z-ADD@YY,4     @YY,3                           S01166
     C                     Z-ADD@CC,4     @CC,3                           S01166
     C           @MM,3     IFLT 01                         B1             S01166
     C                     Z-ADD12        @MM,3            *1             S01166
     C           @YY,4     IFEQ 00                         B*2            S01166
     C                     Z-ADD99        @YY,3            **2            S01166
     C                     Z-ADD19        @CC,3            **2            S01166
     C                     ELSE                            X*2            S01166
     C           @YY,4     SUB  1         @YY,3            **2            S01166
     C                     END                             E*2            S01166
     C                     END                             E1             S01166
     C*                                                                   S01166
     C*
     C**  CALCULATE THE DATE COMPONENTS FOR THE SECOND CONSECUTIVE
     C**  MONTH
     C           @MM,3     SUB  1         @MM,2
     C                     Z-ADD@YY,3     @YY,2
     C                     Z-ADD@CC,3     @CC,2
     C           @MM,2     IFLT 01                         B1
     C                     Z-ADD12        @MM,2            *1
     C           @YY,3     IFEQ 00                         B*2
     C                     Z-ADD99        @YY,2            **2
     C                     Z-ADD19        @CC,2            **2
     C                     ELSE                            X*2
     C           @YY,3     SUB  1         @YY,2            **2
     C                     END                             E*2
     C                     END                             E1
     C*
     C**  CALCULATE THE DATE COMPONENTS FOR THE FIRST CONSECUTIVE
     C**  MONTH
     C*
     C           @MM,2     SUB  1         @MM,1
     C                     Z-ADD@YY,2     @YY,1
     C                     Z-ADD@CC,2     @CC,1
     C           @MM,1     IFLT 01                         B1
     C                     Z-ADD12        @MM,1            *1
     C           @YY,2     IFEQ 00                         B*2
     C                     Z-ADD99        @YY,1            **2
     C                     Z-ADD19        @CC,1            **2
     C                     ELSE                            X*2
     C           @YY,2     SUB  1         @YY,1            **2
     C                     END                             E*2
     C                     END                             E1
     C           #ZB9      ENDSR
     C*
     C*****************************************************************
      /EJECT
     C*****************************************************************
     C*                                                               *
     C*  #BA - THIS ROUTINE CONTROLS THE GENERATION OF DATES FOR      *
     C*        THE FOLLOWING ENQUIRY UPDATED INPUT PARAMETERS VALUES: *
     C*                                                               *
     C*            ' ' - CURRENT PROMPT                               *
     C*            'R' - REFRESH                                      *
     C*                                                               *
     C*  CALLED BY : #B                                               *
     C*                                                               *
     C*  CALLS :     #ZA                                              *
     C*                                                               *
     C*  USES :      @ENQ   - ENQUIRY UPDATED INPUT PARAMETER         *
     C*              @FYR   - YEAR FROM CA38CPLL RECORD               *
     C*              @RRFSH - ROLL/REFRESH INPUT PARAMETER            *
     C*              @RRYR  - YEAR FROM ROLL/REFRESH PARAMETER        *
     C*              @YY    - ARRAY OF DATE NUMERIC FMT. DATE YEARS   *
     C*              @CC    - ARRAY OF DATE CENTURIES                 *
     C*              @MM    - ARRAY OF DATE MONTH NUMBERS             *
     C*              @FMTH  - MONTH FROM CA38CPLL RECORD              *
     C*              @MTH   - MONTH SHORTNAME ARRAY                   *
     C*              @M     - MONTH NUMBER CORRESPONDING TO @MTH      *
     C*              @HTKEY - COMPOSITE KEY FOR MMFWDHLL              *
     C*              @HTKY1 - KEY FOR MMFWDHL1                        *   S01149
     C*              @HTCCY - KEY FIELD OF MMFWDHLL                   *
     C*              @HTFWY - KEY FIELD OF MMFWDHLL                   *
     C*              @HTFWM - KEY FIELD OF MMFWDHLL                   *
     C*              @HTFBH - KEY FIELD OF MMFWDHLL                   *
     C*              @FCCY  - CURRENCY FROM CA38CPLL RECORD           *
     C*              @STEND - 'START'/'END' NARRATIVE                 *
     C*              @NODAT - NO DATES GENERATED FLAG                 *
     C*              @RDAT  - CONCATENATED DATE ON MMFWDHLL RECORD    *
     C*              @GDAT  - CONCATENATED FORM OF GENERATED DATE     *
     C*              @GDAT1 - @GDAT CENTURY                           *
     C*              @GDAT2 - @GDAT YEAR                              *
     C*              @GDAT3 - @GDAT MONTH                             *
     C*                                                               *
     C*****************************************************************
     C*
     C           #BA       BEGSR
     C*                                                                   S01166
     C*   VALIDATE THE PROMPTS ENTERED                                    S01166
     C*                                                                   S01166
     C           *IN05     IFEQ '0'                        B1             S01166
     C                     EXSR #BAA                       *1             S01166
     C                     ELSE                            X1             S01166
     C           @RRFSH    IFEQ *BLANKS                    B*2            S01166
     C           @SCCY     ORNE @SRCCY                     **2            S01166
     C           @1ERR     OREQ 'Y'                        **2            S01166
     C                     MOVE '1'       *IN30            **2            S01166
     C                     GOTO #BA9                       **2            S01166
     C                     END                             E*2            S01166
     C                     END                             E1             S01166
     C*                                                                   S01166
     C*   IF THERE WAS AN ERROR SET THE SUBFILE END INDICATOR ON          S01166
     C*   (ALSO IF THERE IS AN ERROR LEFT ON THE FIRST PROMPTS SCREEN)    S01166
     C           *IN69     IFEQ '1'                        B1             S01166
     C                     MOVE '1'       *IN30            *1             S01166
     C                     GOTO #BA9                       *1             S01166
     C                     END                             E1             S01166
     C*                                                                   S01166
     C*   ELSE CLEAR THE SUBFILE AND WRITE ENQUIRY SUBFILE CONTROL        S01166
     C*   FORMAT                                                          S01166
     C                     MOVE '0'       *IN35                           S01166
     C                     MOVE '0'       *IN36                           S01166
     C**********           WRITEDL3180C1               63          S01166 S01117
     C                     WRITETM3180C1               63                 S01117
     C                     MOVE '0'       *IN36                           S01166
     C*                                                                   S01166
     C*                                                                   S01166
     C*
     C**  IF THE ENQUIRY UPDATED PARAMETER IS ' ', SET UP THE FIRST
     C**  DATE YEAR IN NUMERIC FORMAT, USING POSNS. 9-10 OF FAEPT1
     C**  UNLESS THIS IS BLANK, IN WHICH CASE USE THE LAST 2 CHARS OF
     C**  THE ALPHA RUN DATE FROM TABTB10
     C*          @ENQ      IFEQ ' '                        B1             S01166
     C*          @FYR      IFEQ ' '                        B*2            S01166
     C*                    MOVE RUNA      @YY,1            **2            S01166
     C*                    MOVE RUNA      @YY,1            **2            S01166
     C*                    ELSE                            X*2            S01166
     C*                    MOVE @FYR      @YY,1            **2            S01166
     C*                    END                             E*2            S01166
     C                     MOVE @SRYR     @YY,1            *1             S01166
     C*                    END                             E1             S01166
     C*
     C**  IF THE ENQUIRY UPDATED PARAMETER IS 'R', SET UP THE FIRST
     C**  DATE YEAR IN NUMERIC FORMAT, USING POSNS. 4-5 OF THE
     C**  ROLL/REFRESH INPUT PARAMETER.
     C*          @ENQ      IFEQ 'R'                        B1             S01166
     C           *IN05     IFEQ '1'                        B1             S01166
     C                     MOVE @RRYR     @YY,1            *1             S01166
     C                     END                             E1
     C*
     C**  SET UP FIRST DATE CENTURY
     C           @YY,1     IFGE 72                         B1
     C                     Z-ADD19        @CC,1            *1
     C                     ELSE                            X1
     C                     Z-ADD20        @CC,1            *1
     C                     END                             E1
     C*
     C**  IF THE ENQUIRY UPDATED PARAMETER IS ' ', SET UP THE FIRST
     C**  DATE MONTH NUMBER AS THE MONTH NUMBER OF THE MONTH SHORTNAME
     C**  IN POSNS. 6-8 OF FAEPT1.
     C*          @ENQ      IFEQ ' '                        B1             S01166
     C*                    Z-ADD1         @M      20       *1             S01166
     C*          @FMTH     LOKUP@MTH,@M                  60*1             S01166
     C*                    Z-ADD@M        @MM,1            *1             S01166
     C*                    END                             E1             S01166
     C*
     C**  IF THE ENQUIRY UPDATED PARAMETER IS 'R', SET UP THE FIRST
     C**  DATE MONTH NUMBER AS THE MONTH NUMBER OF THE MONTH SHORTNAME
     C**  IN POSNS. 1-3 OF THE ROLL/REFRESH PARAMETER.
     C*          @ENQ      IFEQ 'R'                        B1             S01166
     C*                    Z-ADD1         @M               *1             S01166
     C*          @RRMTH    LOKUP@MTH,@M                  60*1             S01166
     C*                    Z-ADD@M        @MM,1            *1             S01166
     C           *IN05     IFEQ '1'                        B1             S01166
     C                     MOVE @RRMTH    @MM,1            *1             S01166
     C                     ELSE                            X1             S01166
     C*                                                                   S01166
     C**  SET UP THE FIRST DATE MONTH NUMBER AS THE MONTH NUMBER OF       S01166
     C**  THE MONTH SHORTNAME                                             S01166
     C                     Z-ADD1         @M      20       *1             S01166
     C           @SRMTH    LOKUP@MTH,@M                  72*1             S01166
     C                     Z-ADD@M        @MM,1            *1             S01166
     C                     END                             E1
     C*
     C**  THE NUMERIC COMPONENTS OF THE FIRST DATE ARE NOW SET UP. NOW
     C**  CHECK IF THERE ARE ANY RECORDS ON MMFWDHLL FOR THIS CURRENCY,
     C**  BEYOND AND INCLUDING THE FIRST DATE JUST CALCULATED.
     C**                   MOVE @FCCY     @HTCCY                          S01166
     C                     MOVE @SRCCY    @HTCCY                          S01166
     C                     MOVEL@CC,1     @HTFWY
     C                     MOVE @YY,1     @HTFWY
     C                     MOVE @MM,1     @HTFWM
     C                     Z-ADD01        @HTFBH
     C***********@HTKEY****SETLLMMFWDHLL                                  S01149
     C*********************READ*MMFWDHLL                 76               S01149
      *   Set up @PRO if eq N no records to process for file(s)           S01280
      *   selected.                                                       S01280
     C                     MOVE 'N'       @PRO    1                       S01280
     C*
     C           @LDNA     IFEQ 'ALL'                      B1             S01149
     C           @HTKEY    SETLLMMFWDHLL                   *1             S01149
     C                     READ MMFWDHLL                 76*1             S01149
      *   If rec found set up @PRO.                                       S01280
     C           *IN76     IFEQ '0'                                       S01280
     C                     MOVE 'Y'       @PRO                            S01280
     C                     END                                            S01280
      *                                                                   S01280
     C                     ELSE                            X1             S01149
      *   If NA selected.                                                 S01280
     C           @DNA      IFNE *BLANK                     B*2            S01280
     C                     MOVE 'NA'      @LDNA2                          S01280
     C           @HTKY1    SETLLMMFWDHL1                   *2             S01280
     C                     READ MMFWDHL1                 76*2             S01280
      *   If rec found.                                                   S01280
     C           *IN76     IFEQ '0'                        B**3           S01280
     C                     MOVE 'Y'       @PRO                            S01280
      *   No record found.Deselect deal type to prevent future            S01280
      *   processing of this file.                                        S01280
     C                     ELSE                            X**3           S01280
     C                     MOVE *BLANK    @DNA                            S01280
     C                     END                             E**3           S01280
      *   Reset key.                                                      S01280
     C                     MOVE @SRCCY    @HTCCY                          S01280
     C                     MOVEL@CC,1     @HTFWY                          S01280
     C                     MOVE @YY,1     @HTFWY                          S01280
     C                     MOVE @MM,1     @HTFWM                          S01280
     C                     Z-ADD01        @HTFBH                          S01280
     C                     END                             E*2            S01280
      *   If LD selected.                                                 S01280
     C           @DLD      IFNE *BLANK                     B*2            S01280
     C                     MOVE 'LD'      @LDNA2                          S01280
     C           @HTKY1    SETLLMMFWDHL1                                  S01280
     C                     READ MMFWDHL1                 76               S01280
      *   If rec found.                                                   S01280
     C           *IN76     IFEQ '0'                        B**3           S01280
     C                     MOVE 'Y'       @PRO                            S01280
      *   No record found.Deselect deal type to prevent future            S01280
      *   processing of this file.                                        S01280
     C                     ELSE                            X**3           S01280
     C                     MOVE *BLANK    @DLD                            S01280
     C                     END                             E**3           S01280
      *   Reset key.                                                      S01280
     C                     MOVE @SRCCY    @HTCCY                          S01280
     C                     MOVEL@CC,1     @HTFWY                          S01280
     C                     MOVE @YY,1     @HTFWY                          S01280
     C                     MOVE @MM,1     @HTFWM                          S01280
     C                     Z-ADD01        @HTFBH                          S01280
     C                     END                             E*2            S01280
      *   If LENDING selected.                                            S01280
     C           @DLEN     IFNE *BLANK                     B*2            S01280
     C                     MOVE 'LE'      @LDNA2                          S01280
     C           @HTKY1    SETLLMMFWDHL1                                  S01280
     C                     READ MMFWDHL1                 76               S01280
      *   If rec found.                                                   S01280
     C           *IN76     IFEQ '0'                        B**3           S01280
     C                     MOVE 'Y'       @PRO                            S01280
      *   No record found.Deselect deal type to prevent future            S01280
      *   processing of this file.                                        S01280
     C                     ELSE                            X**3           S01280
     C                     MOVE *BLANK    @DLEN                           S01280
     C                     END                             E**3           S01280
      *   Reset key.                                                      S01280
     C                     MOVE @SRCCY    @HTCCY                          S01280
     C                     MOVEL@CC,1     @HTFWY                          S01280
     C                     MOVE @YY,1     @HTFWY                          S01280
     C                     MOVE @MM,1     @HTFWM                          S01280
     C                     Z-ADD01        @HTFBH                          S01280
     C                     END                             E*2            S01280
      *   If FRA selected.                                                S01280
     C           @DFRA     IFNE *BLANK                     B*2            S01280
     C                     MOVE 'FR'      @LDNA2                          S01280
     C           @HTKY1    SETLLMMFWDHL1                                  S01280
     C                     READ MMFWDHL1                 76               S01280
      *   If rec found.                                                   S01280
     C           *IN76     IFEQ '0'                        B**3           S01280
     C                     MOVE 'Y'       @PRO                            S01280
      *   No record found.Deselect deal type to prevent future            S01280
      *   processing of this file.                                        S01280
     C                     ELSE                            X**3           S01280
     C                     MOVE *BLANK    @DFRA                           S01280
     C                     END                             E**3           S01280
      *   Reset key.                                                      S01280
     C                     MOVE @SRCCY    @HTCCY                          S01280
     C                     MOVEL@CC,1     @HTFWY                          S01280
     C                     MOVE @YY,1     @HTFWY                          S01280
     C                     MOVE @MM,1     @HTFWM                          S01280
     C                     Z-ADD01        @HTFBH                          S01280
     C                     END                             E*2            S01280
      *   If IRS selected.                                                S01280
     C           @DIRS     IFNE *BLANK                     B*2            S01280
     C                     MOVE 'IR'      @LDNA2                          S01280
     C           @HTKY1    SETLLMMFWDHL1                                  S01280
     C                     READ MMFWDHL1                 76               S01280
      *   If rec found.                                                   S01280
     C           *IN76     IFEQ '0'                        B**3           S01280
     C                     MOVE 'Y'       @PRO                            S01280
      *   No record found.Deselect deal type to prevent future            S01280
      *   processing of this file.                                        S01280
     C                     ELSE                                           S01280
     C                     MOVE *BLANK    @DIRS                           S01280
     C                     END                             E**3           S01280
      *   Reset key.                                                      S01280
     C                     MOVE @SRCCY    @HTCCY                          S01280
     C                     MOVEL@CC,1     @HTFWY                          S01280
     C                     MOVE @YY,1     @HTFWY                          S01280
     C                     MOVE @MM,1     @HTFWM                          S01280
     C                     Z-ADD01        @HTFBH                          S01280
     C                     END                             E*2            S01280
      *   If FUTURES selected.                                            S01280
     C           @DFUT     IFNE *BLANK                     B*2            S01280
     C                     MOVE 'FU'      @LDNA2                          S01280
     C           @HTKY1    SETLLMMFWDHL1                                  S01280
     C                     READ MMFWDHL1                 76               S01280
      *   If rec found.                                                   S01280
     C           *IN76     IFEQ '0'                        B**3           S01280
     C                     MOVE 'Y'       @PRO                            S01280
      *   No record found.Deselect deal type to prevent future            S01280
      *   processing of this file.                                        S01280
     C                     ELSE                                           S01280
     C                     MOVE *BLANK    @DFUT                           S01280
     C                     END                             E**3           S01280
      *   Reset key.                                                      S01280
     C                     MOVE @SRCCY    @HTCCY                          S01280
     C                     MOVEL@CC,1     @HTFWY                          S01280
     C                     MOVE @YY,1     @HTFWY                          S01280
     C                     MOVE @MM,1     @HTFWM                          S01280
     C                     Z-ADD01        @HTFBH                          S01280
     C                     END                             E*2            S01280
      *                                                                   S01280
     C                     END                             E1             S01149
     C*
     C**  IF THERE ARE NO FURTHER RECORDS ON MMFWDHLL FOR THIS CURRENCY,
     C**  SET NO DATES GENERATED FLAG AND EXIT FROM THIS ROUTINE          S01166
     C********** *IN76     IFEQ '1'                        B1      S01166 S01280
     C           @PRO      IFEQ 'N'                        B1             S01280
     C**         HTCCY     ORNE @FCCY                      *1             S01166
     C********** HTCCY     ORNE @SRCCY                     *1      S01166 S01280
     C********** @LDNA     ORNE 'ALL'                      *1      S01166 S01280
     C********** @LDNA2    ANDNEHTLDNA                     *1      S01166 S01280
     C*                    MOVE 'L'       @ENQ             *1             S01166
     C                     MOVE 'END  '   @STEND           *1             S01166
     C*                                                                   S01166
     C*   SET SUBFILE END INDICATOR ON                                    S01166
     C           *IN05     IFEQ '0'                        B*2            S01166
     C                     MOVEL'RTM0006' @MSGID           **2            S01166
     C                     CALL 'ZA0240'                   **2            S01166
     C                     PARM           @MSGID           **2            S01166
     C                     MOVE '1'       *IN30            **2            S01166
     C                     MOVE 'Y'       @@ERMS           **2            S01166
     C                     MOVE *BLANKS   @STEND           **2            S01280
      *                                                                   S01280
      * Ensure that header currency and deal types are changed            S01280
      * in case of new selections                                         S01280
     C                     MOVEL@SRCCY    @SCCY                           S01280
     C                     MOVEL@LDNA     @SDTYP                          S01280
     C                     GOTO #BA9                       **2            S01166
     C                     ELSE                            X*2            S01166
     C                     MOVE *BLANKS   @STEND           **2            S01166
     C                     END                             E*2            S01166
     C                     END                             E1             S01166
     C*
     C**  NOW CALCULATE THE NUMERIC COMPONENTS OF THE DATES FOR THE
     C**  NEXT THREE CONSECUTIVE MONTHS.                                  S01166
     C                     EXSR #ZA
     C*
     C**  IF NO RECORD EXISTS FOR THIS CURRENCY ON MMFWDHLL PRIOR TO THE
     C**  FIRST CALCULATED DATE, THEN THIS IS THE START OF THE DATA FOR
     C**  THIS CURRENCY.
      *   Set up @PRO if eq N no records to process for file(s)           S01280
      *   selected.                                                       S01280
     C                     MOVE 'N'       @PRO    1                       S01280
     C***********@HTKEY****SETLLMMFWDHLL                                  S01149
     C*********************READPMMFWDHLL                 76               S01149
     C*
     C           @LDNA     IFEQ 'ALL'                      B1             S01149
     C           @HTKEY    SETLLMMFWDHLL                   *1             S01149
     C                     READPMMFWDHLL                 76*1             S01149
      *   If rec found.                                                   S01280
     C           *IN76     IFEQ '0'                        B**3           S01280
     C                     MOVE 'Y'       @PRO                            S01280
     C                     END                             E**3           S01280
      *                                                                   S01280
     C                     ELSE                            X1             S01149
     C********** @HTKY1    SETLLMMFWDHL1                   *1      S01149 S01280
     C**********           READPMMFWDHL1                 76*1      S01149 S01280
     C**********           END                             E1      S01149 S01280
     C*
      *   If NA selected.                                                 S01280
     C           @DNA      IFNE *BLANK                     B*2            S01280
     C                     MOVE 'NA'      @LDNA2                          S01280
     C           @HTKY1    SETLLMMFWDHL1                                  S01280
     C                     READPMMFWDHL1                 76               S01280
      *   If rec found.                                                   S01280
     C           *IN76     IFEQ '0'                        B**3           S01280
     C           HTLDNA    ANDEQ'NA'                                      S01280
     C                     MOVE 'Y'       @PRO                            S01280
     C                     END                             E**3           S01280
      *   Reset key.                                                      S01280
     C                     MOVE @SRCCY    @HTCCY                          S01280
     C                     MOVEL@CC,1     @HTFWY                          S01280
     C                     MOVE @YY,1     @HTFWY                          S01280
     C                     MOVE @MM,1     @HTFWM                          S01280
     C                     Z-ADD01        @HTFBH                          S01280
     C                     END                             E*2            S01280
      *   If LD selected.                                                 S01280
     C           @DLD      IFNE *BLANK                     B*2            S01280
     C                     MOVE 'LD'      @LDNA2                          S01280
     C           @HTKY1    SETLLMMFWDHL1                                  S01280
     C                     READPMMFWDHL1                 76               S01280
      *   If rec found.                                                   S01280
     C           *IN76     IFEQ '0'                        B**3           S01280
     C           HTLDNA    ANDEQ'LD'                                      S01280
     C                     MOVE 'Y'       @PRO                            S01280
     C                     END                             E**3           S01280
      *   Reset key.                                                      S01280
     C                     MOVE @SRCCY    @HTCCY                          S01280
     C                     MOVEL@CC,1     @HTFWY                          S01280
     C                     MOVE @YY,1     @HTFWY                          S01280
     C                     MOVE @MM,1     @HTFWM                          S01280
     C                     Z-ADD01        @HTFBH                          S01280
     C                     END                             E*2            S01280
      *   If LENDING selected.                                            S01280
     C           @DLEN     IFNE *BLANK                     B*2            S01280
     C                     MOVE 'LE'      @LDNA2                          S01280
     C           @HTKY1    SETLLMMFWDHL1                                  S01280
     C                     READPMMFWDHL1                 76               S01280
      *   If rec found.                                                   S01280
     C           *IN76     IFEQ '0'                        B**3           S01280
     C           HTLDNA    ANDEQ'LE'                                      S01280
     C                     MOVE 'Y'       @PRO                            S01280
     C                     END                             E**3           S01280
      *   Reset key.                                                      S01280
     C                     MOVE @SRCCY    @HTCCY                          S01280
     C                     MOVEL@CC,1     @HTFWY                          S01280
     C                     MOVE @YY,1     @HTFWY                          S01280
     C                     MOVE @MM,1     @HTFWM                          S01280
     C                     Z-ADD01        @HTFBH                          S01280
     C                     END                             E*2            S01280
      *   If FRA selected.                                                S01280
     C           @DFRA     IFNE *BLANK                     B*2            S01280
     C                     MOVE 'FR'      @LDNA2                          S01280
     C           @HTKY1    SETLLMMFWDHL1                                  S01280
     C                     READPMMFWDHL1                 76               S01280
      *   If rec found.                                                   S01280
     C           *IN76     IFEQ '0'                        B**3           S01280
     C           HTLDNA    ANDEQ'FR'                                      S01280
     C                     MOVE 'Y'       @PRO                            S01280
     C                     END                             E**3           S01280
      *   Reset key.                                                      S01280
     C                     MOVE @SRCCY    @HTCCY                          S01280
     C                     MOVEL@CC,1     @HTFWY                          S01280
     C                     MOVE @YY,1     @HTFWY                          S01280
     C                     MOVE @MM,1     @HTFWM                          S01280
     C                     Z-ADD01        @HTFBH                          S01280
     C                     END                             E*2            S01280
      *   If IRS selected.                                                S01280
     C           @DIRS     IFNE *BLANK                     B*2            S01280
     C                     MOVE 'IR'      @LDNA2                          S01280
     C           @HTKY1    SETLLMMFWDHL1                                  S01280
     C                     READPMMFWDHL1                 76               S01280
      *   If rec found.                                                   S01280
     C           *IN76     IFEQ '0'                        B**3           S01280
     C           HTLDNA    ANDEQ'IR'                                      S01280
     C                     MOVE 'Y'       @PRO                            S01280
     C                     END                             E**3           S01280
      *   Reset key.                                                      S01280
     C                     MOVE @SRCCY    @HTCCY                          S01280
     C                     MOVEL@CC,1     @HTFWY                          S01280
     C                     MOVE @YY,1     @HTFWY                          S01280
     C                     MOVE @MM,1     @HTFWM                          S01280
     C                     Z-ADD01        @HTFBH                          S01280
     C                     END                             E*2            S01280
      *   If FUTURES selected.                                            S01280
     C           @DFUT     IFNE *BLANK                     B*2            S01280
     C                     MOVE 'FU'      @LDNA2                          S01280
     C           @HTKY1    SETLLMMFWDHL1                                  S01280
     C                     READPMMFWDHL1                 76               S01280
      *   If rec found.                                                   S01280
     C           *IN76     IFEQ '0'                        B**3           S01280
     C           HTLDNA    ANDEQ'FU'                                      S01280
     C                     MOVE 'Y'       @PRO                            S01280
     C                     END                             E**3           S01280
      *   Reset key.                                                      S01280
     C                     MOVE @SRCCY    @HTCCY                          S01280
     C                     MOVEL@CC,1     @HTFWY                          S01280
     C                     MOVE @YY,1     @HTFWY                          S01280
     C                     MOVE @MM,1     @HTFWM                          S01280
     C                     Z-ADD01        @HTFBH                          S01280
     C                     END                             E*2            S01280
      *                                                                   S01280
     C                     END                             E1             S01280
      *                                                                   S01280
     C           @PRO      IFEQ 'N'                        B1             S01280
     C********** *IN76     IFEQ '1'                        B1      S01166 S01280
     C*          HTCCY     ORNE @FCCY                      *1             S01166
     C           HTCCY     ORNE @SRCCY                     *1             S01166
     C********** @LDNA     ORNE 'ALL'                      *1      S01149 S01280
     C********** @LDNA2    ANDNEHTLDNA                     *1      S01149 S01280
     C                     MOVE 'START'   @STEND           *1
     C                     ELSE                            X1             S01166
     C                     MOVE *BLANKS   @STEND           *1             S01166
     C                     END                             E1
     C*
     C**  IF THERE ARE NO MORE RECORDS ON MMFWDHLL FOR THIS              AMEND
     C**  CURRENCY BEYOND THE SECOND CALCULATED DATE, SET                AMEND
     C**  'START'/'END' NARRATIVE TO 'END'                               AMEND
     C                     MOVEL@CC,4     @HTFWY                          S01166
     C                     MOVE @YY,4     @HTFWY                          S01166
     C                     MOVE @MM,4     @HTFWM                          S01166
     C                     Z-ADD02        @HTFBH                          S01166
      *   Set up @PRO if eq N no records to process for file(s)           S01280
      *   selected.                                                       S01280
     C                     MOVE 'N'       @PRO    1                       S01280
      *                                                                   S01280
     C***********@HTKEY****SETLLMMFWDHLL                                  S01149
     C*********************READ*MMFWDHLL                 76               S01149
     C*
     C           @LDNA     IFEQ 'ALL'                      B1             S01149
     C           @HTKEY    SETLLMMFWDHLL                   *1             S01149
     C                     READ MMFWDHLL                 76*1             S01149
      *   If rec found set up @PRO.                                       S01280
     C           *IN76     IFEQ '0'                                       S01280
     C                     MOVE 'Y'       @PRO                            S01280
     C                     END                                            S01280
      *                                                                   S01280
     C                     ELSE                            X1             S01149
     C********** @HTKY1    SETLLMMFWDHL1                   *1      S01149 S01280
     C**********           READ MMFWDHL1                 76*1      S01149 S01280
     C**********           END                             E1      S01149 S01280
     C*
      *   If NA selected.                                                 S01280
     C           @DNA      IFNE *BLANK                     B*2            S01280
     C                     MOVE 'NA'      @LDNA2                          S01280
     C           @HTKY1    SETLLMMFWDHL1                                  S01280
     C                     READ MMFWDHL1                 76               S01280
      *   If rec found.                                                   S01280
     C           *IN76     IFEQ '0'                        B**3           S01280
     C                     MOVE 'Y'       @PRO                            S01280
     C                     END                             E**3           S01280
      *   Reset key.                                                      S01280
     C                     MOVE @SRCCY    @HTCCY                          S01280
     C                     MOVEL@CC,4     @HTFWY                          S01280
     C                     MOVE @YY,4     @HTFWY                          S01280
     C                     MOVE @MM,4     @HTFWM                          S01280
     C                     Z-ADD02        @HTFBH                          S01280
     C                     END                             E*2            S01280
      *   If LD selected.                                                 S01280
     C           @DLD      IFNE *BLANK                     B*2            S01280
     C                     MOVE 'LD'      @LDNA2                          S01280
     C           @HTKY1    SETLLMMFWDHL1                                  S01280
     C                     READ MMFWDHL1                 76               S01280
      *   If rec found.                                                   S01280
     C           *IN76     IFEQ '0'                        B**3           S01280
     C                     MOVE 'Y'       @PRO                            S01280
     C                     END                             E**3           S01280
      *   Reset key.                                                      S01280
     C                     MOVE @SRCCY    @HTCCY                          S01280
     C                     MOVEL@CC,4     @HTFWY                          S01280
     C                     MOVE @YY,4     @HTFWY                          S01280
     C                     MOVE @MM,4     @HTFWM                          S01280
     C                     Z-ADD02        @HTFBH                          S01280
     C                     END                             E*2            S01280
      *   If LENDING selected.                                            S01280
     C           @DLEN     IFNE *BLANK                     B*2            S01280
     C                     MOVE 'LE'      @LDNA2                          S01280
     C           @HTKY1    SETLLMMFWDHL1                                  S01280
     C                     READ MMFWDHL1                 76               S01280
      *   If rec found.                                                   S01280
     C           *IN76     IFEQ '0'                        B**3           S01280
     C                     MOVE 'Y'       @PRO                            S01280
     C                     END                             E**3           S01280
      *   Reset key.                                                      S01280
     C                     MOVE @SRCCY    @HTCCY                          S01280
     C                     MOVEL@CC,4     @HTFWY                          S01280
     C                     MOVE @YY,4     @HTFWY                          S01280
     C                     MOVE @MM,4     @HTFWM                          S01280
     C                     Z-ADD02        @HTFBH                          S01280
     C                     END                             E*2            S01280
      *   If FRA selected.                                                S01280
     C           @DFRA     IFNE *BLANK                     B*2            S01280
     C                     MOVE 'FR'      @LDNA2                          S01280
     C           @HTKY1    SETLLMMFWDHL1                                  S01280
     C                     READ MMFWDHL1                 76               S01280
      *   If rec found.                                                   S01280
     C           *IN76     IFEQ '0'                        B**3           S01280
     C                     MOVE 'Y'       @PRO                            S01280
     C                     END                             E**3           S01280
      *   Reset key.                                                      S01280
     C                     MOVE @SRCCY    @HTCCY                          S01280
     C                     MOVEL@CC,4     @HTFWY                          S01280
     C                     MOVE @YY,4     @HTFWY                          S01280
     C                     MOVE @MM,4     @HTFWM                          S01280
     C                     Z-ADD02        @HTFBH                          S01280
     C                     END                             E*2            S01280
      *   If IRS selected.                                                S01280
     C           @DIRS     IFNE *BLANK                     B*2            S01280
     C                     MOVE 'IR'      @LDNA2                          S01280
     C           @HTKY1    SETLLMMFWDHL1                                  S01280
     C                     READ MMFWDHL1                 76               S01280
      *   If rec found.                                                   S01280
     C           *IN76     IFEQ '0'                        B**3           S01280
     C                     MOVE 'Y'       @PRO                            S01280
     C                     END                             E**3           S01280
      *   Reset key.                                                      S01280
     C                     MOVE @SRCCY    @HTCCY                          S01280
     C                     MOVEL@CC,4     @HTFWY                          S01280
     C                     MOVE @YY,4     @HTFWY                          S01280
     C                     MOVE @MM,4     @HTFWM                          S01280
     C                     Z-ADD02        @HTFBH                          S01280
     C                     END                             E*2            S01280
      *   If FUTURES selected.                                            S01280
     C           @DFUT     IFNE *BLANK                     B*2            S01280
     C                     MOVE 'FU'      @LDNA2                          S01280
     C           @HTKY1    SETLLMMFWDHL1                                  S01280
     C                     READ MMFWDHL1                 76               S01280
      *   If rec found.                                                   S01280
     C           *IN76     IFEQ '0'                        B**3           S01280
     C                     MOVE 'Y'       @PRO                            S01280
     C                     END                             E**3           S01280
      *   Reset key.                                                      S01280
     C                     MOVE @SRCCY    @HTCCY                          S01280
     C                     MOVEL@CC,4     @HTFWY                          S01280
     C                     MOVE @YY,4     @HTFWY                          S01280
     C                     MOVE @MM,4     @HTFWM                          S01280
     C                     Z-ADD02        @HTFBH                          S01280
     C                     END                             E*2            S01280
      *                                                                   S01280
     C                     END                             E1             S01149
      *
     C           @STEND    IFNE 'START'                    B1             S01166
     C********** *IN76     IFEQ '1'                        B*2     S01166 S01280
     C           @PRO      IFEQ 'N'                        B*2            S01280
     C*          HTCCY     ORNE @FCCY                      **2            S01166
     C********** HTCCY     ORNE @SRCCY                     **2     S01166 S01280
     C********** @LDNA     ORNE 'ALL'                      **2     S01166 S01280
     C********** @LDNA2    ANDNEHTLDNA                     **2     S01166 S01280
     C                     MOVE 'END  '   @STEND           **2            S01166
     C                     ELSE                            X*2            S01166
     C                     MOVE *BLANKS   @STEND           **2            S01166
     C                     END                             E*2            S01166
     C                     END                             E1             S01166
     C*                                                                   S01166
     C*                                                                   S01166
     C**  IF THERE ARE NO RECORDS ON MMFWMHLL FOR THIS CURRENCY IN        S01166
     C**  THE PERIOD DEFINED BY THE GENERATED DATES AND THE 'START/       S01166
     C**  END' NARRATIVE IS 'START', ENSURE THAT NO DATE NARRATIVES       S01166
     C**  ARE SENT TO AMENQ1AA AS THESE WOULD BE OUT OF THE RANGE OF      S01166
     C**  THE MMFWMHLL RECORD DATES FOR THIS CURRENCY.                    S01166
     C           @STEND    IFEQ 'START'                    B1             S01166
     C           @STEND    OREQ *BLANKS                    *1             S01166
     C**  SET UP CONCATENATED FORM OF 4TH GENERATED DATE   *1             S01166
     C**  IN THE DATA STRUCTURE @GDAT                      *1             S01166
     C                     MOVE @CC,4     @GDAT1           *1             S01166
     C                     MOVE @YY,4     @GDAT2           *1             S01166
     C                     MOVE @MM,4     @GDAT3           *1             S01166
     C**  FIND THE FIRST MMFWDHLL DATE (CONCATENATED IN    *1             S01166
     C**  THE DATA STRUCTURE @RDAT )                       *1             S01166
     C                     MOVE @SRCCY    @HTCCY           *1             S01166
     C                     MOVEL@CC,1     @HTFWY           *1             S01166
     C                     MOVE @YY,1     @HTFWY           *1             S01166
     C                     MOVE @MM,1     @HTFWM           *1             S01166
     C                     Z-ADD01        @HTFBH           *1             S01166
     C           @LDNA     IFEQ 'ALL'                      B*2            S01166
     C           @HTKEY    SETLLMMFWDHLL                   **2            S01166
     C                     READ MMFWDHLL                 76**2            S01166
     C**********           ELSE                            X*2     S01166 S01280
     C********** @HTKY1    SETLLMMFWDHL1                   **2     S01166 S01280
     C**********           READ MMFWDHL1                 76**2     S01166 S01280
     C**********           END                             E*2     S01166 S01280
      *                                                                   S01280
     C                     ELSE                                           S01280
     C                     MOVE @GDAT     @RDAT2  60                      S01280
     C                     Z-ADD*ZEROS    @RDAT1                          S01280
      *   If NA selected.                                                 S01280
     C           @DNA      IFNE *BLANK                     B**3           S01280
     C                     MOVE 'NA'      @LDNA2                          S01280
     C           @HTKY1    SETLLMMFWDHL1                                  S01149
     C                     READ MMFWDHL1                 76               S01149
      *   If rec found.                                                   S01280
     C           *IN76     IFEQ '0'                                       S01280
      *   Set up date for NA record found.                                S01280
     C                     MOVELHTFBYY    @DATNA  60                      S01280
     C                     MOVE HTFBMM    @DATNA                          S01280
      *   If this date is earlier than @GDAT move it to @RDAT1 then @RDAT S01280
      *   so that processing continues and is not stopped by RTM0006.     S01280
     C           @DATNA    IFLE @RDAT2                                    S01280
     C                     MOVE @DATNA    @RDAT1  60                      S01280
     C                     END                                            S01280
     C                     END                                            S01280
      *   Reset key.                                                      S01280
     C                     MOVE @SRCCY    @HTCCY                          S01280
     C                     MOVEL@CC,1     @HTFWY                          S01280
     C                     MOVE @YY,1     @HTFWY                          S01280
     C                     MOVE @MM,1     @HTFWM                          S01280
     C                     Z-ADD01        @HTFBH                          S01280
     C                     END                             E**3           S01149
      *   If LD selected.                                                 S01280
     C           @DLD      IFNE *BLANK                     B**3           S01280
     C                     MOVE 'LD'      @LDNA2                          S01280
     C           @HTKY1    SETLLMMFWDHL1                                  S01149
     C                     READ MMFWDHL1                 76               S01149
      *   If rec found.                                                   S01280
     C           *IN76     IFEQ '0'                                       S01280
      *   Set up date for LD record found.                                S01280
     C                     MOVELHTFBYY    @DATLD  60                      S01280
     C                     MOVE HTFBMM    @DATLD                          S01280
      *   If this date is earlier than @GDAT move it to @RDAT1 then @RDAT S01280
      *   so that processing continues and is not stopped by RTM0006.     S01280
     C           @DATLD    IFLE @RDAT2                                    S01280
     C                     MOVE @DATLD    @RDAT1                          S01280
     C                     END                                            S01280
     C                     END                                            S01280
      *   Reset key.                                                      S01280
     C                     MOVE @SRCCY    @HTCCY                          S01280
     C                     MOVEL@CC,1     @HTFWY                          S01280
     C                     MOVE @YY,1     @HTFWY                          S01280
     C                     MOVE @MM,1     @HTFWM                          S01280
     C                     Z-ADD01        @HTFBH                          S01280
     C                     END                             E**3           S01149
      *   If LENDING selected.                                            S01280
     C           @DLEN     IFNE *BLANK                     B**3           S01280
     C                     MOVE 'LE'      @LDNA2                          S01280
     C           @HTKY1    SETLLMMFWDHL1                                  S01149
     C                     READ MMFWDHL1                 76               S01149
      *   If rec found.                                                   S01280
     C           *IN76     IFEQ '0'                                       S01280
      *   Set up date for LENDING record found.                           S01280
     C                     MOVELHTFBYY    @DATLE  60                      S01280
     C                     MOVE HTFBMM    @DATLE                          S01280
      *   If this date is earlier than @GDAT move it to @RDAT1 then @RDAT S01280
      *   so that processing continues and is not stopped by RTM0006.     S01280
     C           @DATLE    IFLE @RDAT2                                    S01280
     C                     MOVE @DATLE    @RDAT1                          S01280
     C                     END                                            S01280
     C                     END                                            S01280
      *   Reset key.                                                      S01280
     C                     MOVE @SRCCY    @HTCCY                          S01280
     C                     MOVEL@CC,1     @HTFWY                          S01280
     C                     MOVE @YY,1     @HTFWY                          S01280
     C                     MOVE @MM,1     @HTFWM                          S01280
     C                     Z-ADD01        @HTFBH                          S01280
     C                     END                             E**3           S01149
      *   If FRA selected.                                                S01280
     C           @DFRA     IFNE *BLANK                     B**3           S01280
     C                     MOVE 'FR'      @LDNA2                          S01280
     C           @HTKY1    SETLLMMFWDHL1                                  S01149
     C                     READ MMFWDHL1                 76               S01149
      *   If rec found.                                                   S01280
     C           *IN76     IFEQ '0'                                       S01280
      *   Set up date for FRA record found.                               S01280
     C                     MOVELHTFBYY    @DATFR  60                      S01280
     C                     MOVE HTFBMM    @DATFR                          S01280
      *   If this date is earlier than @GDAT move it to @RDAT1 then @RDAT S01280
      *   so that processing continues and is not stopped by RTM0006.     S01280
     C           @DATFR    IFLE @RDAT2                                    S01280
     C                     MOVE @DATFR    @RDAT1                          S01280
     C                     END                                            S01280
     C                     END                                            S01280
      *   Reset key.                                                      S01280
     C                     MOVE @SRCCY    @HTCCY                          S01280
     C                     MOVEL@CC,1     @HTFWY                          S01280
     C                     MOVE @YY,1     @HTFWY                          S01280
     C                     MOVE @MM,1     @HTFWM                          S01280
     C                     Z-ADD01        @HTFBH                          S01280
     C                     END                             E**3           S01149
      *   If IRS selected.                                                S01280
     C           @DIRS     IFNE *BLANK                     B**3           S01280
     C                     MOVE 'IR'      @LDNA2                          S01280
     C           @HTKY1    SETLLMMFWDHL1                                  S01149
     C                     READ MMFWDHL1                 76               S01149
      *   If rec found.                                                   S01280
     C           *IN76     IFEQ '0'                                       S01280
      *   Set up date for IRS record found.                               S01280
     C                     MOVELHTFBYY    @DATIR  60                      S01280
     C                     MOVE HTFBMM    @DATIR                          S01280
      *   If this date is earlier than @GDAT move it to @RDAT1 then @RDAT S01280
      *   so that processing continues and is not stopped by RTM0006.     S01280
     C           @DATIR    IFLE @RDAT2                                    S01280
     C                     MOVE @DATIR    @RDAT1                          S01280
     C                     END                                            S01280
     C                     END                                            S01280
      *   Reset key.                                                      S01280
     C                     MOVE @SRCCY    @HTCCY                          S01280
     C                     MOVEL@CC,1     @HTFWY                          S01280
     C                     MOVE @YY,1     @HTFWY                          S01280
     C                     MOVE @MM,1     @HTFWM                          S01280
     C                     Z-ADD01        @HTFBH                          S01280
     C                     END                             E**3           S01149
      *   If FUTURES selected.                                            S01280
     C           @DFUT     IFNE *BLANK                     B**3           S01280
     C                     MOVE 'FU'      @LDNA2                          S01280
     C           @HTKY1    SETLLMMFWDHL1                                  S01149
     C                     READ MMFWDHL1                 76               S01149
      *   If rec found.                                                   S01280
     C           *IN76     IFEQ '0'                                       S01280
      *   Set up date for FUTURE record found.                            S01280
     C                     MOVELHTFBYY    @DATFU  60                      S01280
     C                     MOVE HTFBMM    @DATFU                          S01280
      *   If this date is earlier than @GDAT move it to @RDAT1 then @RDAT S01280
      *   so that processing continues and is not stopped by RTM0006.     S01280
     C           @DATFU    IFLE @RDAT2                                    S01280
     C                     MOVE @DATFU    @RDAT1                          S01280
     C                     END                                            S01280
     C                     END                                            S01280
      *   Reset key.                                                      S01280
     C                     MOVE @SRCCY    @HTCCY                          S01280
     C                     MOVEL@CC,1     @HTFWY                          S01280
     C                     MOVE @YY,1     @HTFWY                          S01280
     C                     MOVE @MM,1     @HTFWM                          S01280
     C                     Z-ADD01        @HTFBH                          S01280
     C                     END                             E**3           S01149
      *                                                                   S01280
     C                     MOVE @RDAT1    @RDAT                           S01280
      *                                                                   S01280
     C                     END                             E*2            S01280
     C*                                                    **             S01166
     C**  IF THE 1ST MMFWDHLL DATE IS BEYOND THE  4TH      *1             S01166
     C**  GENERATED DATE, THEN SET THE 'NO-RECORDS-IN-     *1             S01166
     C**  PERIOD-FLAG'                                     *1             S01166
     C           @RDAT     IFGT @GDAT                      B*2            S01166
     C           @LDNA     ANDEQ'ALL'                      **2            S01280
     C           *IN05     ANDEQ'0'                        **2            S01166
      *   or if individual types selected and none of these had records   S01280
      *   whose date was before the 4 months in question.(@RDAT= zeros)   S01280
     C           @LDNA     ORNE 'ALL'                      **2            S01280
     C           @RDAT     ANDEQ*ZEROS                     **2            S01280
     C           *IN05     ANDEQ'0'                        **2            S01280
     C*   SET SUBFILE END INDICATOR ON                                    S01166
     C                     MOVEL'RTM0006' @MSGID           **2            S01166
     C                     CALL 'ZA0240'                   **2            S01166
     C                     PARM           @MSGID           **2            S01166
     C                     MOVE '1'       *IN30            **2            S01166
     C                     MOVE 'Y'       @@ERMS           **2            S01166
     C                     MOVE *BLANKS   @STEND           **2            S01280
      *                                                                   S01280
      * Ensure that header currency and deal types are changed            S01280
      * in case of new selections                                         S01280
     C                     MOVEL@SRCCY    @SCCY                           S01280
     C                     MOVEL@LDNA     @SDTYP                          S01280
     C                     GOTO #BA9                       **2            S01166
     C                     END                             E*2            S01166
     C                     END                             E1             S01166
     C*                                                                   S01166
     C*    STORE THE FIRST AND LAST RECORDS IN CASE THERE                 S01166
     C*    NO MORE                                                        S01166
     C                     MOVE @YY,1     @TOPRD  4                       S01166
     C                     MOVEL@MM,1     @TOPRD                          S01166
     C                     MOVE @YY,4     @BOTRD  4                       S01166
     C                     MOVEL@MM,4     @BOTRD                          S01166
     C*                                                                   S01166
     C*                                                                   S01166
     C*   DO THE CALCULATIONS AND WRITE THE SUBFILE                       S01166
     C*                                                                   S01166
     C                     EXSR #BF                                       S01166
     C**  IF THERE ARE NO MORE RECORDS ON MMFWDHLL FOR THIS              AMEND
     C**  CURRENCY BEYOND THE THIRD CALCULATED DATE, SET                 AMEND
     C**  'START'/'END' NARRATIVE TO 'END'                               AMEND
     C*                    MOVEL@CC,3     @HTFWY                          S01166
     C*                    MOVE @YY,3     @HTFWY                          S01166
     C*                    MOVE @MM,3     @HTFWM                          S01166
     C*                    MOVE *LOVAL    @HTFBH                          S01166
     C***********@HTKEY****SETLLMMFWDHLL                                  S01149
     C*********************READ*MMFWDHLL                 76               S01149
     C*
     C*          @LDNA     IFEQ 'ALL'                      B1             S01166
     C*          @HTKEY    SETLLMMFWDHLL                   *1             S01166
     C*                    READ MMFWDHLL                 76*1             S01166
     C*                    ELSE                            X1             S01166
     C*          @HTKY1    SETLLMMFWDHL1                   *1             S01166
     C*                    READ MMFWDHL1                 76*1             S01166
     C*                    END                             E1             S01166
     C*                                                                   S01166
     C*          *IN76     IFEQ '1'                        B1             S01166
     C*          HTCCY     ORNE @FCCY                      *1             S01166
     C*          HTCCY     ORNE @SRCCY                     *1             S01166
     C*          @LDNA     ORNE 'ALL'                      *1             S01166
     C*          @LDNA2    ANDNEHTLDNA                     *1             S01166
     C*                    MOVE 'END  '   @STEND           *1             S01166
     C*                    Z-ADD0         @MM,3            *1             S01166
     C*                    END                             E1             S01166
     C*
     C**  CHECK FOR RECORDS BEYOND 3RD. IE IS 3RD THE END                 S01166
     C*                    MOVE *HIVAL    @HTFBH                          S01166
     C***********@HTKEY****SETGTMMFWDHLL                                  S01149
     C*********************READ*MMFWDHLL                 76               S01149
     C*
     C*          @LDNA     IFEQ 'ALL'                      B1             S01166
     C*          @HTKEY    SETGTMMFWDHLL                   *1             S01166
     C*                    READ MMFWDHLL                 76*1             S01166
     C*                    ELSE                            X1             S01166
     C*          @HTKY1    SETGTMMFWDHL1                   *1             S01166
     C*                    READ MMFWDHL1                 76*1             S01166
     C*                    END                             E1             S01166
     C*
     C*          *IN76     IFEQ '1'                        B1             S01166
     C*          HTCCY     ORNE @FCCY                      *1             S01166
     C*          HTCCY     ORNE @SRCCY                     *1             S01166
     C*          @LDNA     ORNE 'ALL'                      *1             S01166
     C*          @LDNA2    ANDNEHTLDNA                     *1             S01166
     C*                    MOVE 'END  '   @STEND           *1             S01166
     C*                    END                             E1             S01166
     C*
     C* Set on subfile written flag used in #B                            S01280
     C                     MOVEL'Y'       @SFILE  1                       S01280
     C*                                                                   S01280
     C           #BA9      ENDSR
     C*
     C*****************************************************************
      /EJECT
     C*****************************************************************   S01166
     C*                                                               *   S01166
     C*  #BAA- THIS ROUTINE CONTROLS THE VALIDATION OF THE PROMPTS    *   S01166
     C*                                                               *   S01166
     C*                                                               *   S01166
     C*****************************************************************   S01166
     C*                                                                   S01166
     C           #BAA      BEGSR                                          S01166
     C*                                                                   S01166
     C*                                                                   S01166
     C*   VALIDATE THE CURRENCY USING CURRENCY PROMPT                     S01166
     C**********           MOVEL'20'      @CCYKY                   S01166 S01194
     C**********           MOVE '1'       @CCYK1                   S01166 S01194
     C**********           MOVEL@SRCCY    @CCYK1                   S01166 S01194
     C********** @CCYKY    CHAINFDCCYTLL             80            S01166 S01194
      *                                                                   S01194
      * Call Access Object for currency details                           S01194
     C                     CALL 'AOCURRR0'                                S01194
     C                     PARM *BLANKS   @RTCD   7                       S01194
     C                     PARM '*KEY   ' @OPTN   7                       S01194
     C                     PARM           @SRCCY  3                       S01194
     C           SDCURR    PARM SDCURR    DSSDY                           S01194
     C*                                                                   S01166
     C*   IF ERROR HAS OCCURRED                                           S01166
     C********** *IN80     IFEQ '1'                        B1      S01166 S01194
     C           @RTCD     IFNE *BLANKS                    B1             S01194
     C*                                                                   S01166
     C*   DISPLAY MESSAGE,SET ON ERROR ON VALIDATION INDICATOR,REVERSE    S01166
     C*   IMAGE THE FIELD AND POSITION THE CURSOR TO SHOW ERROR           S01166
     C*                                                                   S01166
     C                     MOVEL'RTM0002' @MSGID 10        *1             S01166
     C                     CALL 'ZA0240'                   *1             S01166
     C                     PARM           @MSGID           *1             S01166
     C*                                                                   S01166
     C                     MOVE '1'       *IN69            *1             S01166
     C                     MOVE '1'       *IN60            *1             S01166
     C                     MOVE 'Y'       @@ERMS           *1             S01166
      *                                                                   S01194
      * else if currency valid, set up scaling factor using CDP           S01194
      * by which numeric amounts are to be divided                        S01194
      * (this was previously done in routine #B)                          S01194
     C                     ELSE                                           S01194
     C           A6NBDP    ADD  3         @S      10       *1             S01194
     C                     Z-ADD@PW,@S    @SCALE 100       *1             S01194
      *                                                                   S01194
     C                     END                             E1             S01166
     C*                                                                   S01166
     C*   VALIDATE MONTH                                                  S01166
     C           @SRMTH    LOKUP@MTH                     71               S01166
     C*                                                                   S01166
     C*   VALIDATE YEAR - IT MUST BE NUMERIC                              S01166
     C                     TESTN          @SRYR      7373                 S01166
     C*                                                                   S01166
     C*   IF ERROR HAS OCCURRED                                           S01166
     C           *IN71     IFEQ '0'                        B1             S01166
     C           *IN73     OREQ '0'                        *1             S01166
     C*                                                                   S01166
     C*   DISPLAY MESSAGE,SET ON ERROR ON VALIDATION INDICATOR,REVERSE    S01166
     C*   IMAGE THE FIELD AND POSITION THE CURSOR TO SHOW ERROR           S01166
     C*                                                                   S01166
     C                     MOVEL'RTM0003' @MSGID 10        *1             S01166
     C                     CALL 'ZA0240'                   *1             S01166
     C                     PARM           @MSGID           *1             S01166
     C*                                                                   S01166
     C                     MOVE '1'       *IN69            *1             S01166
     C                     MOVE '1'       *IN61            *1             S01166
     C                     MOVE 'Y'       @@ERMS           *1             S01166
     C                     END                             E1             S01166
     C*                                                                   S01166
     C*   DATE MUST NOT BE BEFORE TODAY'S DATE,SO COMPARE DATE            S01166
     C*   ENTERED WITH THE RUN DATE.                                      S01166
     C*   PUT DATE INTO DDMMYY FORMAT TO CALL ZA0270                      S01166
     C*                                                                   S01166
     C           @@ERMS    IFEQ 'N'                        B1             S01166
     C                     Z-ADD1         @M               *1             S01166
     C           @SRMTH    LOKUP@MTH,@M                  71*1             S01166
     C                     Z-ADD@M        @SRMM   20       *1             S01166
     C*   SET THE DAY TO THE LAST DAY OF THE MONTH                        S01166
     C*                                                                   S01166
     C                     Z-ADD@DD,@M    @SRDY   20       *1             S01166
     C                     MOVE @SRYR     @SRYY   20       *1             S01166
     C                     EXSR #BAB                       *1             S01166
     C*   IF DATE IS BEFORE TODAY'S DATE                                  S01166
     C********** @DAYNO    IFLT RUND                       B*2     S01166 S01194
     C           @DAYNO    IFLT BJRDNB                     B*2            S01194
     C           @RTCDE    OREQ '1'                        **2            S01166
     C*                                                                   S01166
     C*   DISPLAY MESSAGE,SET ON ERROR ON VALIDATION INDICATOR,REVERSE    S01166
     C*   IMAGE THE FIELD AND POSITION THE CURSOR TO SHOW ERROR           S01166
     C*                                                                   S01166
     C                     MOVEL'RTM0005' @MSGID           **2            S01166
     C                     CALL 'ZA0240'                   **2            S01166
     C                     PARM           @MSGID           **2            S01166
     C*                                                                   S01166
     C                     MOVE '1'       *IN69            **2            S01166
     C                     MOVE '1'       *IN61            **2            S01166
     C                     MOVE 'Y'       @@ERMS           **2            S01166
     C                     END                             E*2            S01166
     C*                                                                   S01166
     C                     END                             E1             S01166
      *                                                                   S01280
      *  Set up loan types for display.                                   S01280
      *                                                                   S01280
     C                     MOVE *BLANKS   @C                              S01280
     C                     Z-ADD1         @N      10                      S01280
      *                                                                   S01280
      ** If 'ALL' selected and all modules installed.                     S01280
     C           @DALL     IFNE *BLANK                                    S01280
     C           BGCSLN    ANDEQ'Y'                                       S01280
     C           BGFUOP    ANDEQ'Y'                                       S01280
     C           BGFIIN    ANDEQ'Y'                                       S01280
     C                     MOVEA'N/A L/D '@C,1                            S01280
     C                     MOVEA'LEN FRA '@C,3                            S01280
     C                     MOVEA'IRS FUT '@C,5                            S01280
     C                     ELSE                                           S01280
      *                                                                   S01280
     C           @DNA      IFNE *BLANK                                    S01280
     C                     MOVE 'N/A '    @C,@N                           S01280
     C                     ADD  1         @N                              S01280
     C                     END                                            S01280
      *                                                                   S01280
     C           @DLD      IFNE *BLANK                                    S01280
     C                     MOVE 'L/D '    @C,@N                           S01280
     C                     ADD  1         @N                              S01280
     C                     END                                            S01280
      *                                                                   S01280
     C           @DLEN     IFNE *BLANK                                    S01280
     C                     MOVE 'LEN '    @C,@N                           S01280
     C                     ADD  1         @N                              S01280
     C                     END                                            S01280
      *                                                                   S01280
     C           @DFRA     IFNE *BLANK                                    S01280
     C                     MOVE 'FRA '    @C,@N                           S01280
     C                     ADD  1         @N                              S01280
     C                     END                                            S01280
      *                                                                   S01280
     C           @DIRS     IFNE *BLANK                                    S01280
     C                     MOVE 'IRS '    @C,@N                           S01280
     C                     ADD  1         @N                              S01280
     C                     END                                            S01280
      *                                                                   S01280
     C           @DFUT     IFNE *BLANK                                    S01280
     C                     MOVE 'FUT '    @C,@N                           S01280
     C                     ADD  1         @N                              S01280
     C                     END                                            S01280
     C                     END                                            S01280
      *                                                                   S01280
     C                     MOVEA@C,1      @SDTYP                          S01280
      *                                                                   S01280
      ** If 'all' selected blank out all other prompts.                   S01280
     C           @DALL     IFNE *BLANK                                    S01280
     C                     MOVE *BLANK    DDLD                            S01280
     C                     MOVE *BLANK    DDNA                            S01280
     C                     MOVE *BLANK    DDLEN                           S01280
     C                     MOVE *BLANK    DDFRA                           S01280
     C                     MOVE *BLANK    DDIRS                           S01280
     C                     MOVE *BLANK    DDFUT                           S01280
     C                     END                                            S01280
     C*                                                                   S01166
     C****VALIDATE*INCLUDED*DEAL*TYPE***                           S01166 S01280
     C********** @LDNA     IFNE 'ALL'                      B1      S01166 S01280
     C********** @LDNA     ANDNE'L/D'                      *1      S01166 S01280
     C********** @LDNA     ANDNE'N/A'                      *1      S01166 S01280
     C**********                                                   S01166 S01280
     C****DISPLAY*MESSAGE,SET*ON*ERROR*ON*VALIDATION*INDICATOR,REV S01166 S01280
     C****IMAGE*THE*FIELD*AND*POSITION*THE*CURSOR*TO*SHOW*ERROR*** S01166 S01280
     C**********                                                   S01166 S01280
     C**********           MOVEL'MMM0582' @MSGID           *1      S01166 S01280
     C**********           CALL 'ZA0240'                   *1      S01166 S01280
     C**********           PARM           @MSGID           *1      S01166 S01280
     C**********                                                   S01166 S01280
     C**********           MOVE '1'       *IN69            *1      S01166 S01280
     C**********           MOVE '1'       *IN62            *1      S01166 S01280
     C**********           MOVE 'Y'       @@ERMS           *1      S01166 S01280
     C**********           END                             E1      S01166 S01280
     C*                                                                   S01166
     C           #BAA9     ENDSR                                          S01166
     C*****************************************************************   S01166
     C/EJECT                                                              S01166
     C*****************************************************************   S01166
     C*                                                               *   S01166
     C*  #BAB- THIS ROUTINE CONVERTS THE DATE TO A MIDAS DAY NUMBER   *   S01166
     C*        FOR THE PURPOSE OF COMPARISON                          *   S01166
     C*                                                               *   S01166
     C*  CALLED BY : #BAA                                             *   S01166
     C*                                                               *   S01166
     C*  CALLS :     ZA0270                                           *   S01166
     C*                                                               *   S01166
     C*****************************************************************   S01166
     C*                                                                   S01166
     C           #BAB      BEGSR                                          S01166
     C*                                                                   S01166
     C*                                                                   S01166
     C           @SRMM     IFEQ 2                          B1             S01166
     C*                                                                   S01166
     C*   IF MONTH IS FEBRUARY,TEST FOR LEAP YEAR                         S01166
     C                     ADD  28        @SRYY            *1             S01166
     C           @SRYY     DIV  4         @@YY    20       *1             S01166
     C                     MVR            @REM    10       *1             S01166
     C           @REM      IFEQ 0                          B*2            S01166
     C                     Z-ADD29        @SRDY            **2            S01166
     C                     END                             E*2            S01166
     C                     END                             E1             S01166
     C*                                                                   S01166
     C                     MOVE 'D'       @DATF   1                       S01166
     C*   MOVE DATE FIELDS INTO 1 FIELD                                   S01166
     C*                                                                   S01166
     C                     MOVEL@SRDY     @WORK   40                      S01166
     C                     MOVE @SRMM     @WORK                           S01166
     C                     MOVEL@WORK     @SRUND  60                      S01166
     C                     MOVE @SRYY     @SRUND                          S01166
     C*                                                                   S01166
     C*   CONVERT TO MIDAS DAY NO.                                        S01166
     C                     CALL 'ZA0270'                                  S01166
     C                     PARM           @SRUND                          S01166
     C                     PARM           @DATF                           S01166
     C           @RTCDE    PARM           @RTCDE  1                       S01166
     C           @DAYNO    PARM           @DAYNO  50                      S01166
     C*                                                                   S01166
     C           #BAB9     ENDSR                                          S01166
     ******************************************************************   S01166
     C/EJECT                                                              S01166
     C*****************************************************************
     C*                                                               *
     C*  #BB - THIS ROUTINE CONTROLS THE GENERATION OF DATES FOR      *
     C*        THE FOLLOWING ENQUIRY UPDATED INPUT PARAMETER VALUES:  *
     C*                                                               *
     C*            'F' - FIRST PAGE                                   *
     C*                                                               *
     C*  CALLED BY : #B                                               *
     C*                                                               *
     C*  CALLS :     #ZA                                              *
     C*                                                               *
     C*  USES:       @YY    - ARRAY OF DATE YEARS                     *
     C*              @CC    - ARRAY OF DATE CENTURIES                 *
     C*              @MM    - ARRAY OF DATE MONTH NUMBERS             *
     C*              @HTKEY - COMPOSITE KEY FOR MMFWDHLL              *
     C*              @HTKY1 - KEY FOR MMFWDHL1                        *   S01149
     C*              @HTCCY - KEY FIELD OF MMFWDHLL                   *
     C*              @HTFWY - KEY FIELD OF MMFWDHLL                   *
     C*              @HTFWM - KEY FIELD OF MMFWDHLL                   *
     C*              @HTFBH - KEY FIELD OF MMFWDHLL                   *
     C*              @FCCY  - CURRENCY FROM CA38CPLL RECORD           *
     C*              @NODAT - 'NO DATES GENERATED' FLAG               *
     C*              @STEND - 'START'/'END' NARRATIVE                 *
     C*                                                               *
     C*****************************************************************
     C*
     C*          #BB       BEGSR                                          S01166
     C*
     C**  IF THERE ARE NO RECORDS FOR THIS CURRENCY  ON MMFWDHLL, SET
     C**  'NO DATES GENERATED' FLAG AND EXIT THIS ROUTINE
     C*                    MOVE @FCCY     @HTCCY                          S01166
     C*                    MOVE *LOVAL    @HTFWY                          S01166
     C*                    MOVE *LOVAL    @HTFWM                          S01166
     C*                    MOVE *LOVAL    @HTFBH                          S01166
     C***********@HTKEY****SETLLMMFWDHLL                                  S01166
     C*********************READ*MMFWDHLL                 76               S01166
     C*                                                                   S01166
     C*          @LDNA     IFEQ 'ALL'                      B1             S01166
     C*          @HTKEY    SETLLMMFWDHLL                   *1             S01166
     C*                    READ MMFWDHLL                 76*1             S01166
     C*                    ELSE                            X1             S01166
     C*          @HTKY1    SETLLMMFWDHL1                   *1             S01166
     C*                    READ MMFWDHL1                 76*1             S01166
     C*                   END                             E1              S01166
     C**                                                                  S01166
     C*          *IN76     IFEQ '1'                        B1             S01166
     C*          HTCCY     ORNE @FCCY                      *1             S01166
     C*          @LDNA     ORNE 'ALL'                      *1             S01166
     C*          @LDNA2    ANDNEHTLDNA                     *1             S01166
     C*                    MOVE 'Y'       @NODAT           *1             S01166
     C*                    MOVE 'END  '   @STEND           *1             S01166
     C*                    GOTO #BB9                       *1             S01166
     C*                    END                             E1             S01166
     C*
     C**  SET 'START'/'END' NARRATIVE TO 'START'
     C*                    MOVE 'START'   @STEND                          S01166
     C*
     C**  SET UP FIRST DATE COMPONENTS FROM MMFWDHLL RECORD JUST READ.
     C*                    MOVELHTFBYY    @CC,1                           S01166
     C*                    MOVE HTFBYY    @YY,1                           S01166
     C*                    MOVE HTFBMM    @MM,1                           S01166
     C*
     C**  NOW CALCULATE THE NEXT TWO CONSECUTIVE DATE COMPONENTS
     C*                    EXSR #ZA                                       S01166
     C*
     C**  IF NO RECORD EXISTS FOR THIS CURRENCY ON
     C**  MMFWDHLL AFTER THE LAST CALCULATED DATE, THEN
     C**  THIS IS THE END OF THE DATA FOR THIS CURRENCY.
     C*                    MOVEL@CC,3     @HTFWY                          S01166
     C*                    MOVE @YY,3     @HTFWY                          S01166
     C*                    MOVE @MM,3     @HTFWM                          S01166
     C*                    Z-ADD02        @HTFBH                          S01166
     C***********@HTKEY****SETGTMMFWDHLL                                  S01149
     C*********************READ*MMFWDHLL                 76               S01149
     C*
     C*          @LDNA     IFEQ 'ALL'                      B1             S01166
     C*          @HTKEY    SETGTMMFWDHLL                   *1             S01166
     C*                    READ MMFWDHLL                 76*1             S01166
     C*                    ELSE                            X1             S01166
     C*          @HTKY1    SETGTMMFWDHL1                   *1             S01166
     C*                    READ MMFWDHL1                 76*1             S01166
     C*                    END                             E1             S01166
     C*
     C*          *IN76     IFEQ '1'                        B1             S01166
     C*          HTCCY     ORNE @FCCY                      *1             S01166
     C*          @LDNA     ORNE 'ALL'                      *1             S01166
     C*          @LDNA2    ANDNEHTLDNA                     *1             S01166
     C*                    MOVE 'END  '   @STEND           *1             S01166
     C*                    END                             E1             S01166
     C*
     C*          #BB9      ENDSR                                          S01166
     C*
     C*****************************************************************
      /EJECT
     C*****************************************************************
     C*                                                               *
     C*  #BC - THIS ROUTINE CONTROLS THE GENERATION OF DATES FOR      *
     C*        THE FOLLOWING ENQUIRY UPDATED INPUT PARAMETER VALUES:  *
     C*                                                               *
     C*            'L' - LAST PAGE                                    *
     C*                                                               *
     C*  CALLED BY : #B                                               *
     C*                                                               *
     C*  CALLS :     #ZB                                              *
     C*                                                               *
     C*  USES:       @YY    - ARRAY OF DATE YEARS                     *
     C*              @CC    - ARRAY OF DATE CENTURIES                 *
     C*              @MM    - ARRAY OF DATE MONTH NUMBERS             *
     C*              @HTKEY - COMPOSITE KEY FOR MMFWDHLL              *
     C*              @HTKY1 - KEY FOR MMFWDHL1                        *   S01149
     C*              @HTCCY - KEY FIELD OF MMFWDHLL                   *
     C*              @HTFWY - KEY FIELD OF MMFWDHLL                   *
     C*              @HTFWM - KEY FIELD OF MMFWDHLL                   *
     C*              @HTFBH - KEY FIELD OF MMFWDHLL                   *
     C*              @FCCY  - CURRENCY FROM CA38CPLL RECORD           *
     C*              @NODAT - 'NO DATES GENERATED' FLAG               *
     C*              @STEND - 'START'/'END' NARRATIVE                 *
     C*                                                               *
     C*****************************************************************
     C*
     C*          #BC       BEGSR                                          S01166
     C*
     C**  IF THERE ARE NO RECORDS FOR THIS CURRENCY  ON MMFWDHLL, SET
     C**  'NO DATES GENERATED' FLAG AND EXIT THIS ROUTINE
     C*                    MOVE @FCCY     @HTCCY                          S01166
     C*                    MOVE *HIVAL    @HTFWY                          S01166
     C*                    MOVE *HIVAL    @HTFWM                          S01166
     C*                    MOVE *HIVAL    @HTFBH                          S01166
     C***********@HTKEY****SETGTMMFWDHLL                                  S01149
     C*********************READPMMFWDHLL                 76               S01149
     C*
     C*          @LDNA     IFEQ 'ALL'                      B1             S01166
     C*          @HTKEY    SETGTMMFWDHLL                   *1             S01166
     C*                    READPMMFWDHLL                 76*1             S01166
     C*                    ELSE                            X1             S01166
     C*          @HTKY1    SETGTMMFWDHL1                   *1             S01166
     C*                    READPMMFWDHL1                 76*1             S01166
     C*                    END                             E1             S01166
     C*
     C*          *IN76     IFEQ '1'                        B1             S01166
     C*          HTCCY     ORNE @FCCY                      *1             S01166
     C*          @LDNA     ORNE 'ALL'                      *1             S01166
     C*          @LDNA2    ANDNEHTLDNA                     *1             S01166
     C*                    MOVE 'Y'       @NODAT           *1             S01166
     C*                    MOVE 'END  '   @STEND           *1             S01166
     C*                    GOTO #BC9                       *1             S01166
     C*                    END                             E1             S01166
     C*
     C**  SET 'START'/'END' NARRATIVE TO 'END'
     C*                    MOVE 'END  '   @STEND                          S01166
     C*
     C**  SET UP THIRD DATE COMPONENTS FROM MMFWDHLL RECORD JUST READ.
     C*                    MOVELHTFBYY    @CC,3                           S01166
     C*                    MOVE HTFBYY    @YY,3                           S01166
     C*                    MOVE HTFBMM    @MM,3                           S01166
     C*
     C**  NOW CALCULATE THE PREVIOUS TWO CONSECUTIVE DATE COMPONENTS
     C*                    EXSR #ZB                                       S01166
     C*
     C*          #BC9      ENDSR                                          S01166
     C*
     C*****************************************************************
      /EJECT
     C*****************************************************************
     C*                                                               *
     C*  #BD - THIS ROUTINE CONTROLS THE GENERATION OF DATES FOR      *
     C*        THE FOLLOWING ENQUIRY UPDATED INPUT PARAMETER VALUES:  *
     C*                                                               *
     C*            'U' - ROLL UP                                      *
     C*                                                               *
     C*  CALLED BY : #B                                               *
     C*                                                               *
     C*  CALLS :     #ZA                                              *
     C*                                                               *
     C*  USES:       @YY    - ARRAY OF DATE YEARS                     *
     C*              @CC    - ARRAY OF DATE CENTURIES                 *
     C*              @MM    - ARRAY OF DATE MONTH NUMBERS             *
     C*              @RRYR  - YEAR FROM ROLL/REFRESH INPUT PARM.      *
     C*              @RRMTH - MONTH FROM ROLL/REFRESH INPUT PARM.     *
     C*              @MTH   - MONTH SHORTNAME ARRAY                   *
     C*              @M     - MONTH NUMBER CORRESPONDING TO @MTH      *
     C*              @HTKEY - COMPOSITE KEY FOR MMFWDHLL              *
     C*              @HTKY1 - KEY FOR MMFWDHL1                        *   S01149
     C*              @HTCCY - KEY FIELD OF MMFWDHLL                   *
     C*              @HTFWY - KEY FIELD OF MMFWDHLL                   *
     C*              @HTFWM - KEY FIELD OF MMFWDHLL                   *
     C*              @HTFBH - KEY FIELD OF MMFWDHLL                   *
     C*              @FCCY  - CURRENCY FROM CA38CPLL RECORD           *
     C*              @STEND - 'START'/'END' NARRATIVE                 *
     C*              @NODAT - 'NO DATES GENERATED' FLAG               *
     C*                                                               *
     C*****************************************************************
     C*
     C           #BD       BEGSR
     C*
     C*   NO PROCESSING IF THE ROLL/REFRESH PARAMETER IS BLANK            S01166
     C*                                                                   S01166
     C           @RRFSH    IFEQ *BLANKS                    B1             S01166
     C                     MOVE '1'       *IN30            *1             S01166
     C                     ELSE                            X1             S01166
     C*                                                                   S01166
     C**  SET UP FIRST DATE YEAR FROM ROLL/REFRESH INPUT PARAMETER
     C                     MOVE @RRYR     @YY,1
     C*
     C**  CALCULATE FIRST DATE CENTURY
     C           @YY,1     IFGE 72                         B1
     C                     Z-ADD19        @CC,1            *1
     C                     ELSE                            X1
     C                     Z-ADD20        @CC,1            *1
     C                     END                             E1
     C*
     C**  SET UP FIRST DATE MONTH FROM ROLL/REFRESH INPUT PARM.
     C*                    Z-ADD1         @M                              S01166
     C*          @RRMTH    LOKUP@MTH,@M                  60               S01166
     C*                    Z-ADD@M        @MM,1                           S01166
     C                     MOVE @RRMTH    @MM,1                           S01166
     C*
     C**  IF NO RECORDS ON MMFWDHLL FOR THIS CURRENCY BEYOND DATE
     C**  JUST CALCULATED, SET 'NO DATES GENERATED' FLAG AND EXIT
     C**  FROM THIS ROUTINE
     C*                    MOVE @FCCY     @HTCCY                          S01166
     C                     MOVE @SRCCY    @HTCCY                          S01166
     C                     MOVEL@CC,1     @HTFWY
     C                     MOVE @YY,1     @HTFWY
     C                     MOVE @MM,1     @HTFWM
     C                     MOVE *HIVAL    @HTFBH
     C***********@HTKEY****SETGTMMFWDHLL                                  S01149
     C*********************READ*MMFWDHLL                 76               S01149
     C*
     C                     MOVE 'N'       @PRO                            S01280
      *                                                                   S01280
     C           @LDNA     IFEQ 'ALL'                      B1             S01149
     C           @HTKEY    SETGTMMFWDHLL                   *1             S01149
     C                     READ MMFWDHLL                 76*1             S01149
      *   If record found.                                                S01280
     C           *IN76     IFEQ '0'                                       S01280
     C           HTCCY     ANDEQ@SRCCY                                    S01280
     C                     MOVE 'Y'       @PRO                            S01280
     C                     END                                            S01280
      *                                                                   S01280
     C                     ELSE                            X1             S01149
     C********** @HTKY1    SETGTMMFWDHL1                   *1      S01149 S01280
     C**********           READ MMFWDHL1                 76*1      S01149 S01280
     C**********           END                             E1      S01149 S01280
      *                                                                   S01280
      **  If NA still selected (if selected as multiple select and        S01280
      **  there were no records on a prior screen this would have         S01280
      **  already have been deselected.                                   S01280
     C           @DNA      IFNE *BLANK                     B*2            S01280
     C                     MOVE 'NA'      @LDNA2                          S01280
      *                                                                   S01280
     C           @HTKY1    SETGTMMFWDHL1                                  S01280
     C                     READ MMFWDHL1                 76               S01280
      *   If record found,check ccy +type have not changed.               S01280
     C           *IN76     IFEQ '0'                        B**3           S01280
     C           HTCCY     ANDEQ@SRCCY                                    S01280
     C           HTLDNA    ANDEQ'NA'                                      S01280
     C                     MOVE 'Y'       @PRO                            S01280
     C                     ELSE                            X**3           S01280
      *   Deselect this selection.                                        S01280
     C                     MOVE *BLANK    @DNA                            S01280
     C                     END                             E**3           S01280
      *   Reset key for next file.                                        S01280
     C                     MOVE @SRCCY    @HTCCY                          S01280
     C                     MOVEL@CC,1     @HTFWY                          S01280
     C                     MOVE @YY,1     @HTFWY                          S01280
     C                     MOVE @MM,1     @HTFWM                          S01280
     C                     MOVE *HIVAL    @HTFBH                          S01280
     C                     END                             E*2            S01280
      *   If LD selected.                                                 S01280
     C           @DLD      IFNE *BLANK                     B*2            S01280
     C                     MOVE 'LD'      @LDNA2                          S01280
      *                                                                   S01280
     C           @HTKY1    SETGTMMFWDHL1                                  S01280
     C                     READ MMFWDHL1                 76               S01280
      *   If record found,check ccy +type have not changed.               S01280
     C           *IN76     IFEQ '0'                        B**3           S01280
     C           HTCCY     ANDEQ@SRCCY                                    S01280
     C           HTLDNA    ANDEQ'LD'                                      S01280
     C                     MOVE 'Y'       @PRO                            S01280
     C                     ELSE                            X**3           S01280
      *   Deselect this selection.                                        S01280
     C                     MOVE *BLANK    @DLD                            S01280
     C                     END                             E**3           S01280
      *   Reset key for next file.                                        S01280
     C                     MOVE @SRCCY    @HTCCY                          S01280
     C                     MOVEL@CC,1     @HTFWY                          S01280
     C                     MOVE @YY,1     @HTFWY                          S01280
     C                     MOVE @MM,1     @HTFWM                          S01280
     C                     MOVE *HIVAL    @HTFBH                          S01280
     C                     END                             E*2            S01280
      *   If LENDING selected.                                            S01280
     C           @DLEN     IFNE *BLANK                     B*2            S01280
     C                     MOVE 'LE'      @LDNA2                          S01280
      *                                                                   S01280
     C           @HTKY1    SETGTMMFWDHL1                                  S01280
     C                     READ MMFWDHL1                 76               S01280
      *   If record found,check ccy +type have not changed.               S01280
     C           *IN76     IFEQ '0'                        B**3           S01280
     C           HTCCY     ANDEQ@SRCCY                                    S01280
     C           HTLDNA    ANDEQ'LE'                                      S01280
     C                     MOVE 'Y'       @PRO                            S01280
     C                     ELSE                            X**3           S01280
      *   Deselect this selection.                                        S01280
     C                     MOVE *BLANK    @DLEN                           S01280
     C                     END                             E**3           S01280
      *   Reset key for next file.                                        S01280
     C                     MOVE @SRCCY    @HTCCY                          S01280
     C                     MOVEL@CC,1     @HTFWY                          S01280
     C                     MOVE @YY,1     @HTFWY                          S01280
     C                     MOVE @MM,1     @HTFWM                          S01280
     C                     MOVE *HIVAL    @HTFBH                          S01280
     C                     END                             E*2            S01280
      *   If FRA selected.                                                S01280
     C           @DFRA     IFNE *BLANK                     B*2            S01280
     C                     MOVE 'FR'      @LDNA2                          S01280
      *                                                                   S01280
     C           @HTKY1    SETGTMMFWDHL1                                  S01280
     C                     READ MMFWDHL1                 76               S01280
      *   If record found,check ccy +type have not changed.               S01280
     C           *IN76     IFEQ '0'                        B**3           S01280
     C           HTCCY     ANDEQ@SRCCY                                    S01280
     C           HTLDNA    ANDEQ'FR'                                      S01280
     C                     MOVE 'Y'       @PRO                            S01280
     C                     ELSE                            X**3           S01280
      *   Deselect this selection.                                        S01280
     C                     MOVE *BLANK    @DFRA                           S01280
     C                     END                             E**3           S01280
      *   Reset key for next file.                                        S01280
     C                     MOVE @SRCCY    @HTCCY                          S01280
     C                     MOVEL@CC,1     @HTFWY                          S01280
     C                     MOVE @YY,1     @HTFWY                          S01280
     C                     MOVE @MM,1     @HTFWM                          S01280
     C                     MOVE *HIVAL    @HTFBH                          S01280
     C                     END                             E*2            S01280
      *   If IRS selected.                                                S01280
     C           @DIRS     IFNE *BLANK                     B*2            S01280
     C                     MOVE 'IR'      @LDNA2                          S01280
      *                                                                   S01280
     C           @HTKY1    SETGTMMFWDHL1                                  S01280
     C                     READ MMFWDHL1                 76               S01280
      *   If record found,check ccy +type have not changed.               S01280
     C           *IN76     IFEQ '0'                        B**3           S01280
     C           HTCCY     ANDEQ@SRCCY                                    S01280
     C           HTLDNA    ANDEQ'IR'                                      S01280
     C                     MOVE 'Y'       @PRO                            S01280
     C                     ELSE                            X**3           S01280
      *   Deselect this selection.                                        S01280
     C                     MOVE *BLANK    @DIRS                           S01280
     C                     END                             E**3           S01280
      *   Reset key for next file.                                        S01280
     C                     MOVE @SRCCY    @HTCCY                          S01280
     C                     MOVEL@CC,1     @HTFWY                          S01280
     C                     MOVE @YY,1     @HTFWY                          S01280
     C                     MOVE @MM,1     @HTFWM                          S01280
     C                     MOVE *HIVAL    @HTFBH                          S01280
     C                     END                             E*2            S01280
      *   If FUTURES selected.                                            S01280
     C           @DFUT     IFNE *BLANK                     B*2            S01280
     C                     MOVE 'FU'      @LDNA2                          S01280
      *                                                                   S01280
     C           @HTKY1    SETGTMMFWDHL1                                  S01280
     C                     READ MMFWDHL1                 76               S01280
      *   If record found,check ccy +type have not changed.               S01280
     C           *IN76     IFEQ '0'                        B**3           S01280
     C           HTCCY     ANDEQ@SRCCY                                    S01280
     C           HTLDNA    ANDEQ'FU'                                      S01280
     C                     MOVE 'Y'       @PRO                            S01280
     C                     ELSE                            X**3           S01280
      *   Deselect this selection.                                        S01280
     C                     MOVE *BLANK    @DFUT                           S01280
     C                     END                             E**3           S01280
      *   Reset key for next file.                                        S01280
     C                     MOVE @SRCCY    @HTCCY                          S01280
     C                     MOVEL@CC,1     @HTFWY                          S01280
     C                     MOVE @YY,1     @HTFWY                          S01280
     C                     MOVE @MM,1     @HTFWM                          S01280
     C                     MOVE *HIVAL    @HTFBH                          S01280
     C                     END                             E*2            S01280
      *                                                                   S01280
     C                     END                             E1             S01280
     C*
     C********** *IN76     IFEQ '1'                        B1             S01280
     C           @PRO      IFEQ 'N'                        B1             S01280
     C*          HTCCY     ORNE @FCCY                      *1             S01166
     C********** HTCCY     ORNE @SRCCY                     *1      S01166 S01280
     C********** @LDNA     ORNE 'ALL'                      *1      S01149 S01280
     C********** @LDNA2    ANDNEHTLDNA                     *1      S01149 S01280
     C*                    MOVE 'Y'       @NODAT           *1             S01166
     C*                                                                   S01166
     C*   SET SUBFILE END INDICATOR ON                                    S01166
     C                     MOVEL'RTM0001' @MSGID           **2            S01166
     C                     CALL 'ZA0240'                   **2            S01166
     C                     PARM           @MSGID           **2            S01166
     C                     MOVE '1'       *IN30            **2            S01166
     C                     MOVE 'Y'       @@ERMS           **2            S01166
     C                     MOVE 'END  '   @STEND           **2            S01280
     C                     GOTO #BD9                       *1
     C                     END                             E1
     C*                                                                   S01166
     C*   IF NOT END OF FILE THEN CLEAR THE SUBFILE,SET OFF THE           S01166
     C*   SUBFILE END INDICATOR                                           S01166
     C*                                                                   S01166
     C                     MOVE '0'       *IN35                           S01166
     C                     MOVE '0'       *IN36                           S01166
     C**********           WRITEDL3180C1               63          S01166 S01194
     C                     WRITETM3180C1               63                 S01194
     C                     MOVE '0'       *IN30                           S01166
     C*                                                                   S01166
     C*
     C**  MODIFY FIRST CALCULATED DATE TO NEXT MONTH DATE
     C                     ADD  1         @MM,1
     C           @MM,1     IFGT 12                         B1
     C                     Z-ADD01        @MM,1            *1
     C           @YY,1     IFEQ 99                         B*2
     C                     Z-ADD0         @YY,1            **2
     C                     Z-ADD20        @CC,1            **2
     C                     ELSE                            X*2
     C                     ADD  1         @YY,1            **2
     C                     END                             E*2
     C                     END                             E1
     C*
     C**  CALCULATE DATES FOR NEXT 2 CONSECUTIVE MONTHS
     C**  CALCULATE DATES FOR NEXT 3 CONSECUTIVE MONTHS                   S01166
     C                     EXSR #ZA
     C*
     C**  IF THERE ARE NO MORE RECORDS ON MMFWDHLL FOR THIS              AMEND
     C**  CURRENCY BEYOND THE SECOND CALCULATED DATE, SET                AMEND
     C**  'START'/'END' NARRATIVE TO 'END'                               AMEND
     C*                    MOVEL@CC,2     @HTFWY                          S01166
     C*                    MOVE @YY,2     @HTFWY                          S01166
     C*                    MOVE @MM,2     @HTFWM                          S01166
     C*                    MOVE *LOVAL    @HTFBH                          S01166
     C***********@HTKEY****SETLLMMFWDHLL                                  S01149
     C*********************READ*MMFWDHLL                 76               S01149
     C*
     C*          @LDNA     IFEQ 'ALL'                      B1             S01166
     C*          @HTKEY    SETLLMMFWDHLL                   *1             S01166
     C*                    READ MMFWDHLL                 76*1             S01166
     C*                    ELSE                            X1             S01166
     C*          @HTKY1    SETLLMMFWDHL1                   *1             S01166
     C*                    READ MMFWDHL1                 76*1             S01166
     C*                    END                             E1             S01166
     C*                                                                   S01166
     C*          *IN76     IFEQ '1'                        B1             S01166
     C*          HTCCY     ORNE @FCCY                      *1             S01166
     C*          HTCCY     ORNE @SRCCY                     *1             S01166
     C*          @LDNA     ORNE 'ALL'                      *1             S01166
     C*          @LDNA2    ANDNEHTLDNA                     *1             S01166
     C*                    MOVE 'END  '   @STEND           *1             S01166
     C*                    Z-ADD0         @MM,2            *1             S01166
     C*                    END                             E1             S01166
     C*
     C**  IF THERE ARE NO MORE RECORDS ON MMFWDHLL FOR THIS
     C**  CURRENCY BEYOND THE THIRD CALCULATED DATE, SET
     C**  'START'/'END' NARRATIVE TO 'END'
     C*                    MOVEL@CC,3     @HTFWY                          S01166
     C*                    MOVE @YY,3     @HTFWY                          S01166
     C*                    MOVE @MM,3     @HTFWM                          S01166
     C*                    MOVE *LOVAL    @HTFBH                          S01166
     C***********@HTKEY****SETLLMMFWDHLL                                  S01149
     C*********************READ*MMFWDHLL                 76               S01149
     C*
     C*          @LDNA     IFEQ 'ALL'                      B1             S01166
     C*          @HTKEY    SETLLMMFWDHLL                   *1             S01166
     C*                    READ MMFWDHLL                 76*1             S01166
     C*                    ELSE                            X1             S01166
     C*          @HTKY1    SETLLMMFWDHL1                   *1             S01166
     C*                    READ MMFWDHL1                 76*1             S01166
     C*                    END                             E1             S01166
     C*
     C*          *IN76     IFEQ '1'                        B1             S01166
     C*          HTCCY     ORNE @FCCY                      *1             S01166
     C*          HTCCY     ORNE @SRCCY                     *1             S01166
     C*          @LDNA     ORNE 'ALL'                      *1             S01166
     C*          @LDNA2    ANDNEHTLDNA                     *1             S01166
     C*                    MOVE 'END  '   @STEND           *1             S01166
     C*                    Z-ADD0         @MM,3            *1             S01166
     C*                    GOTO #BD9                       *1             S01166
     C*                    END                             E1             S01166
     C*
     C** CHECK IF THIS RECORD (3RD) IS THE END                            S01166
     C*                    MOVE *HIVAL    @HTFBH                          S01166
     C***********@HTKEY****SETGTMMFWDHLL                                  S01149
     C*********************READ*MMFWDHLL                 76               S01149
     C*
     C*          @LDNA     IFEQ 'ALL'                      B1             S01166
     C*          @HTKEY    SETGTMMFWDHLL                   *1             S01166
     C*                    READ MMFWDHLL                 76*1             S01166
     C*                    ELSE                            X1             S01166
     C*          @HTKY1    SETGTMMFWDHL1                   *1             S01166
     C*                    READ MMFWDHL1                 76*1             S01166
     C*                    END                             E1             S01166
     C*                                                                   S01166
     C*          *IN76     IFEQ '1'                        B1             S01166
     C*          HTCCY     ORNE @FCCY                      *1             S01166
     C*          HTCCY     ORNE @SRCCY                     *1             S01166
     C*          @LDNA     ORNE 'ALL'                      *1             S01166
     C*          @LDNA2    ANDNEHTLDNA                     *1             S01166
     C*                    MOVE 'END  '   @STEND           *1             S01166
     C*                    END                             E1             S01166
     C*                                                                   S01166
     C**  IF THERE ARE NO MORE RECORDS ON MMFWDHLL FOR THIS               S01166
     C**  CURRENCY BEYOND THE THIRD CALCULATED DATE, SET                  S01166
     C**  'START'/'END' NARRATIVE TO 'END'                                S01166
     C                     MOVEL@CC,4     @HTFWY                          S01166
     C                     MOVE @YY,4     @HTFWY                          S01166
     C                     MOVE @MM,4     @HTFWM                          S01166
     C                     MOVE *LOVAL    @HTFBH                          S01166
     C***********@HTKEY****SETLLMMFWDHLL                                  S01149
     C*********************READ*MMFWDHLL                 76               S01149
      *                                                                   S01280
     C                     MOVE 'N'       @PRO                            S01280
     C*                                                                   S01166
     C           @LDNA     IFEQ 'ALL'                      B1             S01166
     C           @HTKEY    SETLLMMFWDHLL                   *1             S01166
     C                     READ MMFWDHLL                 76*1             S01166
      *   If record found.                                                S01280
     C           *IN76     IFEQ '0'                                       S01280
     C           HTCCY     ANDEQ@SRCCY                                    S01280
     C                     MOVE 'Y'       @PRO                            S01280
     C                     END                                            S01280
      *                                                                   S01280
     C                     ELSE                            X1             S01166
     C********** @HTKY1    SETLLMMFWDHL1                   *1      S01166 S01280
     C**********           READ MMFWDHL1                 76*1      S01166 S01280
     C**********           END                             E1      S01166 S01280
      *                                                                   S01280
      **  If NA selected                                                  S01280
     C           @DNA      IFNE *BLANK                     B*2            S01280
     C                     MOVE 'NA'      @LDNA2                          S01280
      *                                                                   S01280
     C           @HTKY1    SETLLMMFWDHL1                                  S01280
     C                     READ MMFWDHL1                 76               S01280
      *   If record found,check ccy +type have not changed.               S01280
     C           *IN76     IFEQ '0'                        B**3           S01280
     C           HTCCY     ANDEQ@SRCCY                                    S01280
     C           HTLDNA    ANDEQ'NA'                                      S01280
     C                     MOVE 'Y'       @PRO                            S01280
     C                     END                             E**3           S01280
      *   Reset key for next file.                                        S01280
     C                     MOVE @SRCCY    @HTCCY                          S01280
     C                     MOVEL@CC,4     @HTFWY                          S01280
     C                     MOVE @YY,4     @HTFWY                          S01280
     C                     MOVE @MM,4     @HTFWM                          S01280
     C                     MOVE *LOVAL    @HTFBH                          S01280
     C                     END                             E*2            S01280
      *   If LD selected.                                                 S01280
     C           @DLD      IFNE *BLANK                     B*2            S01280
     C                     MOVE 'LD'      @LDNA2                          S01280
      *                                                                   S01280
     C           @HTKY1    SETLLMMFWDHL1                                  S01280
     C                     READ MMFWDHL1                 76               S01280
      *   If record found,check ccy +type have not changed.               S01280
     C           *IN76     IFEQ '0'                        B**3           S01280
     C           HTCCY     ANDEQ@SRCCY                                    S01280
     C           HTLDNA    ANDEQ'LD'                                      S01280
     C                     MOVE 'Y'       @PRO                            S01280
     C                     END                             E**3           S01280
      *   Reset key for next file.                                        S01280
     C                     MOVE @SRCCY    @HTCCY                          S01280
     C                     MOVEL@CC,4     @HTFWY                          S01280
     C                     MOVE @YY,4     @HTFWY                          S01280
     C                     MOVE @MM,4     @HTFWM                          S01280
     C                     MOVE *LOVAL    @HTFBH                          S01280
     C                     END                             E*2            S01280
      *   If LENDING selected.                                            S01280
     C           @DLEN     IFNE *BLANK                     B*2            S01280
     C                     MOVE 'LE'      @LDNA2                          S01280
      *                                                                   S01280
     C           @HTKY1    SETLLMMFWDHL1                                  S01280
     C                     READ MMFWDHL1                 76               S01280
      *   If record found,check ccy +type have not changed.               S01280
     C           *IN76     IFEQ '0'                        B**3           S01280
     C           HTCCY     ANDEQ@SRCCY                                    S01280
     C           HTLDNA    ANDEQ'LE'                                      S01280
     C                     MOVE 'Y'       @PRO                            S01280
     C                     END                             E**3           S01280
      *   Reset key for next file.                                        S01280
     C                     MOVE @SRCCY    @HTCCY                          S01280
     C                     MOVEL@CC,4     @HTFWY                          S01280
     C                     MOVE @YY,4     @HTFWY                          S01280
     C                     MOVE @MM,4     @HTFWM                          S01280
     C                     MOVE *LOVAL    @HTFBH                          S01280
     C                     END                             E*2            S01280
      *   If FRA selected.                                                S01280
     C           @DFRA     IFNE *BLANK                     B*2            S01280
     C                     MOVE 'FR'      @LDNA2                          S01280
      *                                                                   S01280
     C           @HTKY1    SETLLMMFWDHL1                                  S01280
     C                     READ MMFWDHL1                 76               S01280
      *   If record found,check ccy +type have not changed.               S01280
     C           *IN76     IFEQ '0'                        B**3           S01280
     C           HTCCY     ANDEQ@SRCCY                                    S01280
     C           HTLDNA    ANDEQ'FR'                                      S01280
     C                     MOVE 'Y'       @PRO                            S01280
     C                     END                             E**3           S01280
      *   Reset key for next file.                                        S01280
     C                     MOVE @SRCCY    @HTCCY                          S01280
     C                     MOVEL@CC,4     @HTFWY                          S01280
     C                     MOVE @YY,4     @HTFWY                          S01280
     C                     MOVE @MM,4     @HTFWM                          S01280
     C                     MOVE *LOVAL    @HTFBH                          S01280
     C                     END                             E*2            S01280
      *   If IRS selected.                                                S01280
     C           @DIRS     IFNE *BLANK                     B*2            S01280
     C                     MOVE 'IR'      @LDNA2                          S01280
      *                                                                   S01280
     C           @HTKY1    SETLLMMFWDHL1                                  S01280
     C                     READ MMFWDHL1                 76               S01280
      *   If record found,check ccy +type have not changed.               S01280
     C           *IN76     IFEQ '0'                        B**3           S01280
     C           HTCCY     ANDEQ@SRCCY                                    S01280
     C           HTLDNA    ANDEQ'IR'                                      S01280
     C                     MOVE 'Y'       @PRO                            S01280
     C                     END                             E**3           S01280
      *   Reset key for next file.                                        S01280
     C                     MOVE @SRCCY    @HTCCY                          S01280
     C                     MOVEL@CC,4     @HTFWY                          S01280
     C                     MOVE @YY,4     @HTFWY                          S01280
     C                     MOVE @MM,4     @HTFWM                          S01280
     C                     MOVE *LOVAL    @HTFBH                          S01280
     C                     END                             E*2            S01280
      *   If FUTURES selected.                                            S01280
     C           @DFUT     IFNE *BLANK                     B*2            S01280
     C                     MOVE 'FU'      @LDNA2                          S01280
      *                                                                   S01280
     C           @HTKY1    SETLLMMFWDHL1                                  S01280
     C                     READ MMFWDHL1                 76               S01280
      *   If record found,check ccy +type have not changed.               S01280
     C           *IN76     IFEQ '0'                        B**3           S01280
     C           HTCCY     ANDEQ@SRCCY                                    S01280
     C           HTLDNA    ANDEQ'FU'                                      S01280
     C                     MOVE 'Y'       @PRO                            S01280
     C                     END                             E**3           S01280
      *   Reset key for next file.                                        S01280
     C                     MOVE @SRCCY    @HTCCY                          S01280
     C                     MOVEL@CC,4     @HTFWY                          S01280
     C                     MOVE @YY,4     @HTFWY                          S01280
     C                     MOVE @MM,4     @HTFWM                          S01280
     C                     MOVE *LOVAL    @HTFBH                          S01280
     C                     END                             E*2            S01280
      *                                                                   S01280
     C                     END                             E1             S01280
      *                                                                   S01280
     C********** *IN76     IFEQ '1'                        B1      S01166 S01280
     C           @PRO      IFEQ 'N'                        B1             S01280
     C********** HTCCY     ORNE @SRCCY                     *1      S01166 S01280
     C********** @LDNA     ORNE 'ALL'                      *1      S01166 S01280
     C********** @LDNA2    ANDNEHTLDNA                     *1      S01166 S01280
     C                     MOVE 'END  '   @STEND           *1             S01166
     C                     ELSE                            X1             S01166
     C                     MOVE *BLANKS   @STEND           *1             S01166
     C                     END                             E1             S01166
     C*                                                                   S01166
     C*    STORE THE FIRST AND LAST RECORDS IN CASE THERE                 S01166
     C*    NO MORE                                                        S01166
     C                     MOVE @YY,1     @TOPRD                          S01166
     C                     MOVEL@MM,1     @TOPRD                          S01166
     C                     MOVE @YY,4     @BOTRD                          S01166
     C                     MOVEL@MM,4     @BOTRD                          S01166
     C*                                                                   S01166
     C*   DO CALCULATIONS AND THEN WRITE THE RECORD TO THE SUBFILE        S01166
     C                     EXSR #BF                                       S01166
     C*                                                                   S01166
     C                     END                             E1             S01166
     C*                                                                   S01166
     C           #BD9      ENDSR
     C*
     C*****************************************************************
      /EJECT
     C*****************************************************************
     C*                                                               *
     C*  #BE - THIS ROUTINE CONTROLS THE GENERATION OF DATES FOR      *
     C*        THE FOLLOWING ENQUIRY UPDATED INPUT PARAMETER VALUES:  *
     C*                                                               *
     C*            'D' - ROLL DOWN                                    *
     C*                                                               *
     C*  CALLED BY : #B                                               *
     C*                                                               *
     C*  CALLS :     #ZB                                              *
     C*                                                               *
     C*  USES:       @TDAT  - ROLL KET TOP DATE                       *
     C*              @RIDAT - RUN DATE FROM TABTB10                   *
     C*              @YY    - ARRAY OF DATE YEARS                     *
     C*              @CC    - ARRAY OF DATE CENTURIES                 *
     C*              @MM    - ARRAY OF DATE MONTH NUMBERS             *
     C*              @RRYR  - YEAR FROM ROLL/REFRESH INPUT PARM.      *
     C*              @RRMTH - MONTH FROM ROLL/REFRESH INPUT PARM.     *
     C*              @HTKEY - COMPOSITE KEY FOR MMFWDHLL              *
     C*              @HTKY1 - KEY FOR MMFWDHL1                        *   S01149
     C*              @HTCCY - KEY FIELD OF MMFWDHLL                   *
     C*              @HTFWY - KEY FIELD OF MMFWDHLL                   *
     C*              @HTFWM - KEY FIELD OF MMFWDHLL                   *
     C*              @HTFBH - KEY FIELD OF MMFWDHLL                   *
     C*              @FCCY  - CURRENCY FROM CA38CPLL RECORD           *
     C*              @STEND - 'START'/'END' NARRATIVE                 *
     C*              @NODAT - 'NO DATES GENERATED' FLAG               *
     C*                                                               *
     C*****************************************************************
     C*
     C           #BE       BEGSR
     C*                                                                   S01166
     C*   NO PROCESSING IF THE ROLL/REFRESH PARAMETER IS BLANK            S01166
     C*                                                                   S01166
     C           @RRFSH    IFEQ *BLANKS                    B1             S01166
     C                     MOVE '1'       *IN30            *1             S01166
     C                     ELSE                            X1             S01166
     C*
     C** CHECK THE TOP DATE ON THE SCREEN WITH THE RUN DATE.              AMEND
     C*          @TDAT     IFEQ @RIDAT                     B1             S01166
     C*                    MOVE 'Y'       @NODAT           *1             S01166
     C*                    GOTO #BE9                       *1             S01166
     C*                    END                             E1             S01166
     C*
     C**  SET UP THIRD DATE YEAR FROM ROLL/REFRESH INPUT PARAMETER
     C*                    MOVE @RRYR     @YY,3                           S01166
     C*
     C**  SET UP FOURTH DATE YEAR FROM ROLL/REFRESH INPUT PARAMETER       S01166
     C                     MOVE @RRYR     @YY,4                           S01166
     C*                                                                   S01166
     C**  CALCULATE THIRD DATE CENTURY
     C*          @YY,3     IFGE 72                         B1             S01166
     C*                    Z-ADD19        @CC,3            *1             S01166
     C*                    ELSE                            X1             S01166
     C*                    Z-ADD20        @CC,3            *1             S01166
     C*                    END                             E1             S01166
     C**  CALCULATE FOURTH DATE CENTURY                                   S01166
     C           @YY,4     IFGE 72                         B1             S01166
     C                     Z-ADD19        @CC,4            *1             S01166
     C                     ELSE                            X1             S01166
     C                     Z-ADD20        @CC,4            *1             S01166
     C                     END                             E1             S01166
     C*                                                                   S01166
     C*
     C**  SET UP THIRD DATE MONTH FROM ROLL/REFRESH INPUT PARM.
     C*                    Z-ADD1         @M                              S01166
     C*          @RRMTH    LOKUP@MTH,@M                  60               S01166
     C*                    Z-ADD@M        @MM,3                           S01166
     C*
     C**  IF NO RECORDS ON MMFWDHLL FOR THIS CURRENCY BEFORE DATE
     C**  JUST CALCULATED, SET 'NO DATES GENERATED' FLAG AND EXIT
     C**  FROM THIS ROUTINE
     C*                    MOVE @FCCY     @HTCCY                          S01166
     C*                    MOVEL@CC,3     @HTFWY                          S01166
     C*                    MOVE @YY,3     @HTFWY                          S01166
     C*                    MOVE @MM,3     @HTFWM                          S01166
     C***********@HTKEY****SETLLMMFWDHLL                                  S01149
     C*          @HTKEY    SETGTMMFWDHLL                                   AMEND
     C*********************READPMMFWDHLL                 76               S01149
     C*
     C*          @LDNA     IFEQ 'ALL'                      B1             S01166
     C*          @HTKEY    SETLLMMFWDHLL                   *1             S01166
     C*                    READPMMFWDHLL                 76*1             S01166
     C*                    ELSE                            X1             S01166
     C*          @HTKY1    SETLLMMFWDHL1                   *1             S01166
     C*                    READPMMFWDHL1                 76*1             S01166
     C*                    END                             E1             S01166
     C*                                                                   S01166
     C*          *IN76     IFEQ '1'                        B1             S01166
     C*          HTCCY     ORNE @FCCY                      *1             S01166
     C*          @LDNA     ORNE 'ALL'                      *1             S01166
     C*          @LDNA2    ANDNEHTLDNA                     *1             S01166
     C*                    MOVE 'Y'       @NODAT           *1             S01166
     C*                    GOTO #BE9                       *1             S01166
     C*                    END                             E1             S01166
     C*
     C**  MODIFY THIRD CALCULATED DATE TO PREVIOUS MONTH DATE
     C*                    SUB  1         @MM,3                           S01166
     C*          @MM,3     IFLT 01                         B1             S01166
     C*                    Z-ADD12        @MM,3            *1             S01166
     C*          @YY,3     IFEQ 00                         B*2            S01166
     C*                    Z-ADD99        @YY,3            **2            S01166
     C*                    Z-ADD19        @CC,3            **2            S01166
     C*                    ELSE                            X*2            S01166
     C*                    SUB  1         @YY,3            **2            S01166
     C*                    END                             E*2            S01166
     C*                    END                             E1             S01166
     C*                                                                   S01166
     C**  SET UP FOURTH DATE MONTH FROM ROLL/REFRESH INPUT PARM.          S01166
     C***                  Z-ADD1         @M                              S01166
     C***        @RRMTH    LOKUP@MTH,@M                  60               S01166
     C***                  Z-ADD@M        @MM,4                           S01166
     C                     MOVE @RRMTH    @MM,4                           S01166
     C*   SET UP PREVIOUS MONTH                                           S01166
     C*                                                                   S01166
     C           @MM,4     SUB  1         @MM,3                           S01166
     C           @MM,3     IFGE 01                         B*2            S01166
     C                     Z-ADD@YY,4     @YY,3            **2            S01166
     C                     ELSE                            X*2            S01166
     C                     Z-ADD12        @MM,3            **2            S01166
     C           @YY,4     IFEQ 00                         B**3           S01166
     C                     Z-ADD99        @YY,3            ***3           S01166
     C                     Z-ADD19        @CC,3            ***3           S01166
     C                     ELSE                            X**3           S01166
     C           @YY,4     SUB  1         @YY,3            ***3           S01166
     C                     END                             E**3           S01166
     C                     END                             E*2            S01166
     C*                                                                   S01166
     C*   CALCULATE THE MIDAS DAY NO FOR THE PREVIOUS DATE                S01166
     C*                                                                   S01166
     C                     MOVE @MM,3     @SRMM                           S01166
     C                     MOVE @MM,3     @M                              S01166
     C                     Z-ADD@DD,@M    @SRDY                           S01166
     C                     Z-ADD@YY,3     @SRYY                           S01166
     C                     EXSR #BAB                                      S01166
     C*                                                                   S01166
     C**  IF NO RECORDS ON MMFWMHLL FOR THIS CURRENCY BEFORE DATE         S01166
     C**  JUST CALCULATED, SET 'NO DATES GENERATED' FLAG AND EXIT         S01166
     C**  FROM THIS ROUTINE                                               S01166
     C                     MOVE @SRCCY    @HTCCY                          S01166
     C                     MOVEL@CC,4     @HTFWY                          S01166
     C                     MOVE @YY,4     @HTFWY                          S01166
     C                     MOVE @MM,4     @HTFWM                          S01166
      *   Set up @PRO if eq N no records to process for file(s)           S01280
      *   selected.                                                       S01280
     C                     MOVE 'N'       @PRO    1                       S01280
     C           @LDNA     IFEQ 'ALL'                      B*2            S01166
     C           @HTKEY    SETLLMMFWDHLL                   **2            S01166
     C                     READPMMFWDHLL                 76**2            S01166
      *   If rec found.                                                   S01280
     C           *IN76     IFEQ '0'                        B**3           S01280
     C                     MOVE 'Y'       @PRO                            S01280
     C                     END                             E**3           S01280
      *                                                                   S01280
     C                     ELSE                            X*2            S01166
     C********** @HTKY1    SETLLMMFWDHL1                   **2     S01166 S01280
     C**********           READPMMFWDHL1                 76**2     S01166 S01280
     C**********           END                             E*2     S01166 S01280
      *   If NA selected.                                                 S01280
     C           @DNA      IFNE *BLANK                     B*2            S01280
     C                     MOVE 'NA'      @LDNA2                          S01280
     C           @HTKY1    SETLLMMFWDHL1                                  S01280
     C                     READPMMFWDHL1                 76               S01280
      *   If rec found.                                                   S01280
     C           *IN76     IFEQ '0'                        B**3           S01280
     C           HTLDNA    ANDEQ'NA'                                      S01280
     C                     MOVE 'Y'       @PRO                            S01280
     C                     END                             E**3           S01280
      *   Reset key.                                                      S01280
     C                     MOVE @SRCCY    @HTCCY                          S01280
     C                     MOVEL@CC,4     @HTFWY                          S01280
     C                     MOVE @YY,4     @HTFWY                          S01280
     C                     MOVE @MM,4     @HTFWM                          S01280
     C                     END                             E*2            S01280
      *   If LD selected.                                                 S01280
     C           @DLD      IFNE *BLANK                     B*2            S01280
     C                     MOVE 'LD'      @LDNA2                          S01280
     C           @HTKY1    SETLLMMFWDHL1                                  S01280
     C                     READPMMFWDHL1                 76               S01280
      *   If rec found.                                                   S01280
     C           *IN76     IFEQ '0'                        B**3           S01280
     C           HTLDNA    ANDEQ'LD'                                      S01280
     C                     MOVE 'Y'       @PRO                            S01280
     C                     END                             E**3           S01280
      *   Reset key.                                                      S01280
     C                     MOVE @SRCCY    @HTCCY                          S01280
     C                     MOVEL@CC,4     @HTFWY                          S01280
     C                     MOVE @YY,4     @HTFWY                          S01280
     C                     MOVE @MM,4     @HTFWM                          S01280
     C                     END                             E*2            S01280
      *   If LENDING selected.                                            S01280
     C           @DLEN     IFNE *BLANK                     B*2            S01280
     C                     MOVE 'LE'      @LDNA2                          S01280
     C           @HTKY1    SETLLMMFWDHL1                                  S01280
     C                     READPMMFWDHL1                 76               S01280
      *   If rec found.                                                   S01280
     C           *IN76     IFEQ '0'                        B**3           S01280
     C           HTLDNA    ANDEQ'LE'                                      S01280
     C                     MOVE 'Y'       @PRO                            S01280
     C                     END                             E**3           S01280
      *   Reset key.                                                      S01280
     C                     MOVE @SRCCY    @HTCCY                          S01280
     C                     MOVEL@CC,4     @HTFWY                          S01280
     C                     MOVE @YY,4     @HTFWY                          S01280
     C                     MOVE @MM,4     @HTFWM                          S01280
     C                     END                             E*2            S01280
      *   If FRA selected.                                                S01280
     C           @DFRA     IFNE *BLANK                     B*2            S01280
     C                     MOVE 'FR'      @LDNA2                          S01280
     C           @HTKY1    SETLLMMFWDHL1                                  S01280
     C                     READPMMFWDHL1                 76               S01280
      *   If rec found.                                                   S01280
     C           *IN76     IFEQ '0'                        B**3           S01280
     C           HTLDNA    ANDEQ'FR'                                      S01280
     C                     MOVE 'Y'       @PRO                            S01280
     C                     END                             E**3           S01280
      *   Reset key.                                                      S01280
     C                     MOVE @SRCCY    @HTCCY                          S01280
     C                     MOVEL@CC,4     @HTFWY                          S01280
     C                     MOVE @YY,4     @HTFWY                          S01280
     C                     MOVE @MM,4     @HTFWM                          S01280
     C                     END                             E*2            S01280
      *   If IRS selected.                                                S01280
     C           @DIRS     IFNE *BLANK                     B*2            S01280
     C                     MOVE 'IR'      @LDNA2                          S01280
     C           @HTKY1    SETLLMMFWDHL1                                  S01280
     C                     READPMMFWDHL1                 76               S01280
      *   If rec found.                                                   S01280
     C           *IN76     IFEQ '0'                        B**3           S01280
     C           HTLDNA    ANDEQ'IR'                                      S01280
     C                     MOVE 'Y'       @PRO                            S01280
     C                     END                             E**3           S01280
      *   Reset key.                                                      S01280
     C                     MOVE @SRCCY    @HTCCY                          S01280
     C                     MOVEL@CC,4     @HTFWY                          S01280
     C                     MOVE @YY,4     @HTFWY                          S01280
     C                     MOVE @MM,4     @HTFWM                          S01280
     C                     END                             E*2            S01280
      *   If FUTURES selected.                                            S01280
     C           @DFUT     IFNE *BLANK                     B*2            S01280
     C                     MOVE 'FU'      @LDNA2                          S01280
     C           @HTKY1    SETLLMMFWDHL1                                  S01280
     C                     READPMMFWDHL1                 76               S01280
      *   If rec found.                                                   S01280
     C           *IN76     IFEQ '0'                        B**3           S01280
     C           HTLDNA    ANDEQ'FU'                                      S01280
     C                     MOVE 'Y'       @PRO                            S01280
     C                     END                             E**3           S01280
      *   Reset key.                                                      S01280
     C                     MOVE @SRCCY    @HTCCY                          S01280
     C                     MOVEL@CC,4     @HTFWY                          S01280
     C                     MOVE @YY,4     @HTFWY                          S01280
     C                     MOVE @MM,4     @HTFWM                          S01280
     C                     END                             E*2            S01280
      *                                                                   S01280
     C                     END                             E1             S01280
      *                                                                   S01280
     C           @PRO      IFEQ 'N'                                       S01280
     C********** *IN76     IFEQ '1'                        B*2     S01166 S01280
     C********** @DAYNO    ORLT RUND                       **2     S01166 S01194
     C           @DAYNO    ORLT BJRDNB                     **2            S01194
     C           HTCCY     ORNE @SRCCY                     **2            S01166
     C***                  MOVE 'Y'       @NODAT           **2            S01166
     C*                                                                   S01166
     C*   SET SUBFILE END INDICATOR ON                                    S01166
     C                     MOVEL'RTM0001' @MSGID           **2            S01166
     C                     CALL 'ZA0240'                   **2            S01166
     C                     PARM           @MSGID           **2            S01166
     C                     MOVE '1'       *IN30            **2            S01166
     C                     MOVE 'Y'       @@ERMS           **2            S01166
     C                     MOVE 'START'   @STEND           **2            S01280
     C                     GOTO #BE9                       **2            S01166
     C                     END                             E*2            S01166
     C*                                                                   S01166
     C*   IF NOT END OF FILE THEN CLEAR THE SUBFILE,SET OFF THE           S01166
     C*   SUBFILE END INDICATOR                                           S01166
     C*                                                                   S01166
     C                     MOVE '0'       *IN35                           S01166
     C                     MOVE '0'       *IN36                           S01166
     C**********           WRITEDL3180C1               63          S01166 S01117
     C                     WRITETM3180C1               63                 S01117
     C                     MOVE '0'       *IN30                           S01166
     C*                                                                   S01166
     C**  MODIFY FOURTH CALCULATED DATE TO PREVIOUS MONTH DATE            S01166
     C*                                                                   S01166
     C                     Z-ADD@MM,3     @MM,4                           S01166
     C                     Z-ADD@YY,3     @YY,4                           S01166
     C*                                                                   S01166
     C*
     C**  CALCULATE DATES FOR PREVIOUS 3 CONSECUTIVE MONTHS               S01166
     C                     EXSR #ZB                                       S01166
     C*
     C**  IF THERE ARE NO MORE RECORDS ON MMFWDHLL FOR THIS               AMEND
     C**  CURRENCY BEFORE THE SECOND CALCULATED DATE, SET                 AMEND
     C**  'START'/'END' NARRATIVE TO 'START'                              AMEND
     C***                  MOVEL@CC,2     @HTFWY                          S01166
     C**                   MOVE @YY,2     @HTFWY                          S01166
     C**                   MOVE @MM,2     @HTFWM                          S01166
     C**                   MOVE *LOVAL    @HTFBH                          S01166
     C***********@HTKEY****SETLLMMFWDHLL                                  S01149
     C*********************READPMMFWDHLL                 76               S01149
     C*
     C**         @LDNA     IFEQ 'ALL'                      B1             S01166
     C**         @HTKEY    SETLLMMFWDHLL                   *1             S01166
     C**                   READPMMFWDHLL                 76*1             S01166
     C**                   ELSE                            X1             S01166
     C**         @HTKY1    SETLLMMFWDHL1                   *1             S01166
     C**                   READPMMFWDHL1                 76*1             S01166
     C**                   END                             E1             S01166
     C**                                                                  S01166
     C**         *IN76     IFEQ '1'                        B1             S01166
     C**         HTCCY     ORNE @FCCY                      *1             S01166
     C**         HTCCY     ORNE @SRCCY                     *1             S01166
     C**         @LDNA     ORNE 'ALL'                      *1             S01166
     C**         @LDNA2    ANDNEHTLDNA                     *1             S01166
     C**                   MOVE 'START'   @STEND           *1             S01166
     C**                   Z-ADD0         @MM,2            *1             S01166
     C**                   END                             E1             S01166
     C**                                                                  S01166
     C**  IF THERE ARE NO MORE RECORDS ON MMFWDHLL FOR THIS
     C**  CURRENCY BEFORE THE FIRST CALCULATED DATE, SET
     C**  'START'/'END' NARRATIVE TO 'START'
     C                     MOVEL@CC,1     @HTFWY
     C                     MOVE @YY,1     @HTFWY
     C                     MOVE @MM,1     @HTFWM
     C                     MOVE *LOVAL    @HTFBH
     C***********@HTKEY****SETLLMMFWDHLL                                  S01149
     C*********************READPMMFWDHLL                 76               S01149
      *   Set up @PRO if eq N no records to process for file(s)           S01280
      *   selected.                                                       S01280
     C                     MOVE 'N'       @PRO                            S01280
     C*
     C           @LDNA     IFEQ 'ALL'                      B1             S01149
     C           @HTKEY    SETLLMMFWDHLL                   *1             S01149
     C                     READPMMFWDHLL                 76*1             S01149
      *   If rec found.                                                   S01280
     C           *IN76     IFEQ '0'                        B**3           S01280
     C                     MOVE 'Y'       @PRO                            S01280
     C                     END                             E**3           S01280
      *                                                                   S01280
     C                     ELSE                            X1             S01149
     C********** @HTKY1    SETLLMMFWDHL1                   *1      S01149 S01280
     C**********           READPMMFWDHL1                 76*1      S01149 S01280
     C**********           END                             E1      S01149 S01280
     C*
      *   If NA selected.                                                 S01280
     C           @DNA      IFNE *BLANK                     B*2            S01280
     C                     MOVE 'NA'      @LDNA2                          S01280
     C           @HTKY1    SETLLMMFWDHL1                                  S01280
     C                     READPMMFWDHL1                 76               S01280
      *   If rec found.                                                   S01280
     C           *IN76     IFEQ '0'                        B**3           S01280
     C           HTLDNA    ANDEQ'NA'                                      S01280
     C                     MOVE 'Y'       @PRO                            S01280
     C                     END                             E**3           S01280
      *   Reset key.                                                      S01280
     C                     MOVE @SRCCY    @HTCCY                          S01280
     C                     MOVEL@CC,1     @HTFWY                          S01280
     C                     MOVE @YY,1     @HTFWY                          S01280
     C                     MOVE @MM,1     @HTFWM                          S01280
     C                     MOVE *LOVAL    @HTFBH                          S01280
     C                     END                             E*2            S01280
      *   If LD selected.                                                 S01280
     C           @DLD      IFNE *BLANK                     B*2            S01280
     C                     MOVE 'LD'      @LDNA2                          S01280
     C           @HTKY1    SETLLMMFWDHL1                                  S01280
     C                     READPMMFWDHL1                 76               S01280
      *   If rec found.                                                   S01280
     C           *IN76     IFEQ '0'                        B**3           S01280
     C           HTLDNA    ANDEQ'LD'                                      S01280
     C                     MOVE 'Y'       @PRO                            S01280
     C                     END                             E**3           S01280
      *   Reset key.                                                      S01280
     C                     MOVE @SRCCY    @HTCCY                          S01280
     C                     MOVEL@CC,1     @HTFWY                          S01280
     C                     MOVE @YY,1     @HTFWY                          S01280
     C                     MOVE @MM,1     @HTFWM                          S01280
     C                     MOVE *LOVAL    @HTFBH                          S01280
     C                     END                             E*2            S01280
      *   If LENDING selected.                                            S01280
     C           @DLEN     IFNE *BLANK                     B*2            S01280
     C                     MOVE 'LE'      @LDNA2                          S01280
     C           @HTKY1    SETLLMMFWDHL1                                  S01280
     C                     READPMMFWDHL1                 76               S01280
      *   If rec found.                                                   S01280
     C           *IN76     IFEQ '0'                        B**3           S01280
     C           HTLDNA    ANDEQ'LE'                                      S01280
     C                     MOVE 'Y'       @PRO                            S01280
     C                     END                             E**3           S01280
      *   Reset key.                                                      S01280
     C                     MOVE @SRCCY    @HTCCY                          S01280
     C                     MOVEL@CC,1     @HTFWY                          S01280
     C                     MOVE @YY,1     @HTFWY                          S01280
     C                     MOVE @MM,1     @HTFWM                          S01280
     C                     MOVE *LOVAL    @HTFBH                          S01280
     C                     END                             E*2            S01280
      *   If FRA selected.                                                S01280
     C           @DFRA     IFNE *BLANK                     B*2            S01280
     C                     MOVE 'FR'      @LDNA2                          S01280
     C           @HTKY1    SETLLMMFWDHL1                                  S01280
     C                     READPMMFWDHL1                 76               S01280
      *   If rec found.                                                   S01280
     C           *IN76     IFEQ '0'                        B**3           S01280
     C           HTLDNA    ANDEQ'FR'                                      S01280
     C                     MOVE 'Y'       @PRO                            S01280
     C                     END                             E**3           S01280
      *   Reset key.                                                      S01280
     C                     MOVE @SRCCY    @HTCCY                          S01280
     C                     MOVEL@CC,1     @HTFWY                          S01280
     C                     MOVE @YY,1     @HTFWY                          S01280
     C                     MOVE @MM,1     @HTFWM                          S01280
     C                     MOVE *LOVAL    @HTFBH                          S01280
     C                     END                             E*2            S01280
      *   If IRS selected.                                                S01280
     C           @DIRS     IFNE *BLANK                     B*2            S01280
     C                     MOVE 'IR'      @LDNA2                          S01280
     C           @HTKY1    SETLLMMFWDHL1                                  S01280
     C                     READPMMFWDHL1                 76               S01280
      *   If rec found.                                                   S01280
     C           *IN76     IFEQ '0'                        B**3           S01280
     C           HTLDNA    ANDEQ'IR'                                      S01280
     C                     MOVE 'Y'       @PRO                            S01280
     C                     END                             E**3           S01280
      *   Reset key.                                                      S01280
     C                     MOVE @SRCCY    @HTCCY                          S01280
     C                     MOVEL@CC,1     @HTFWY                          S01280
     C                     MOVE @YY,1     @HTFWY                          S01280
     C                     MOVE @MM,1     @HTFWM                          S01280
     C                     MOVE *LOVAL    @HTFBH                          S01280
     C                     END                             E*2            S01280
      *   If FUTURES selected.                                            S01280
     C           @DFUT     IFNE *BLANK                     B*2            S01280
     C                     MOVE 'FU'      @LDNA2                          S01280
     C           @HTKY1    SETLLMMFWDHL1                                  S01280
     C                     READPMMFWDHL1                 76               S01280
      *   If rec found.                                                   S01280
     C           *IN76     IFEQ '0'                        B**3           S01280
     C           HTLDNA    ANDEQ'FU'                                      S01280
     C                     MOVE 'Y'       @PRO                            S01280
     C                     END                             E**3           S01280
      *   Reset key.                                                      S01280
     C                     MOVE @SRCCY    @HTCCY                          S01280
     C                     MOVEL@CC,1     @HTFWY                          S01280
     C                     MOVE @YY,1     @HTFWY                          S01280
     C                     MOVE @MM,1     @HTFWM                          S01280
     C                     MOVE *LOVAL    @HTFBH                          S01280
     C                     END                             E*2            S01280
      *                                                                   S01280
     C                     END                             E1             S01280
      *                                                                   S01280
     C********** *IN76     IFEQ '1'                        B1             S01280
     C           @PRO      IFEQ 'N'                        B1             S01280
     C*          HTCCY     ORNE @FCCY                      *1             S01166
     C           HTCCY     ORNE @SRCCY                     *1             S01166
     C********** @LDNA     ORNE 'ALL'                      *1      S01149 S01280
     C********** @LDNA2    ANDNEHTLDNA                     *1      S01149 S01280
     C                     MOVE 'START'   @STEND           *1
     C***                  Z-ADD0         @MM,1            *1             S01166
     C                     ELSE                            X1             S01166
     C                     MOVE *BLANKS   @STEND           *1             S01166
     C                     END                             E1
     C*
     C**  IF NO RECORD EXISTS FOR THIS CURRENCY ON
     C**  MMFWDHLL AFTER THE LAST CALCULATED DATE, THEN
     C**  THIS IS THE END OF THE DATA FOR THIS CURRENCY.
     C*                    MOVEL@CC,3     @HTFWY                          S01166
     C*                    MOVE @YY,3     @HTFWY                          S01166
     C*                    MOVE @MM,3     @HTFWM                          S01166
     C                     MOVEL@CC,4     @HTFWY                          S01166
     C                     MOVE @YY,4     @HTFWY                          S01166
     C                     MOVE @MM,4     @HTFWM                          S01166
     C                     Z-ADD02        @HTFBH                          S01166
     C***********@HTKEY****SETGTMMFWDHLL                                  S01149
     C*********************READ*MMFWDHLL                 76               S01149
     C*
     C                     MOVE 'N'       @PRO                            S01280
      *                                                                   S01280
     C           @LDNA     IFEQ 'ALL'                      B1             S01149
     C           @HTKEY    SETGTMMFWDHLL                   *1             S01149
     C                     READ MMFWDHLL                 76*1             S01149
      *   If record found.                                                S01280
     C           *IN76     IFEQ '0'                                       S01280
     C           HTCCY     ANDEQ@SRCCY                                    S01280
     C                     MOVE 'Y'       @PRO                            S01280
     C                     END                                            S01280
      *                                                                   S01280
     C                     ELSE                            X1             S01149
     C********** @HTKY1    SETGTMMFWDHL1                   *1      S01149 S01280
     C**********           READ MMFWDHL1                 76*1      S01149 S01280
     C**********           END                             E1      S01149 S01280
     C*                                                                   S01280
      **  If NA selected.                                                 S01280
     C           @DNA      IFNE *BLANK                     B*2            S01280
     C                     MOVE 'NA'      @LDNA2                          S01280
      *                                                                   S01280
     C           @HTKY1    SETGTMMFWDHL1                                  S01280
     C                     READ MMFWDHL1                 76               S01280
      *   If record found,check ccy +type have not changed.               S01280
     C           *IN76     IFEQ '0'                        B**3           S01280
     C           HTCCY     ANDEQ@SRCCY                                    S01280
     C           HTLDNA    ANDEQ'NA'                                      S01280
     C                     MOVE 'Y'       @PRO                            S01280
     C                     END                             E**3           S01280
      *   Reset key for next file.                                        S01280
     C                     MOVE @SRCCY    @HTCCY                          S01280
     C                     MOVEL@CC,4     @HTFWY                          S01280
     C                     MOVE @YY,4     @HTFWY                          S01280
     C                     MOVE @MM,4     @HTFWM                          S01280
     C                     Z-ADD02        @HTFBH                          S01280
     C                     END                             E*2            S01280
      *   If LD selected.                                                 S01280
     C           @DLD      IFNE *BLANK                     B*2            S01280
     C                     MOVE 'LD'      @LDNA2                          S01280
      *                                                                   S01280
     C           @HTKY1    SETGTMMFWDHL1                                  S01280
     C                     READ MMFWDHL1                 76               S01280
      *   If record found,check ccy +type have not changed.               S01280
     C           *IN76     IFEQ '0'                        B**3           S01280
     C           HTCCY     ANDEQ@SRCCY                                    S01280
     C           HTLDNA    ANDEQ'LD'                                      S01280
     C                     MOVE 'Y'       @PRO                            S01280
     C                     END                             E**3           S01280
      *   Reset key for next file.                                        S01280
     C                     MOVE @SRCCY    @HTCCY                          S01280
     C                     MOVEL@CC,4     @HTFWY                          S01280
     C                     MOVE @YY,4     @HTFWY                          S01280
     C                     MOVE @MM,4     @HTFWM                          S01280
     C                     Z-ADD02        @HTFBH                          S01280
     C                     END                             E*2            S01280
      *   If LENDING selected.                                            S01280
     C           @DLEN     IFNE *BLANK                     B*2            S01280
     C                     MOVE 'LE'      @LDNA2                          S01280
      *                                                                   S01280
     C           @HTKY1    SETGTMMFWDHL1                                  S01280
     C                     READ MMFWDHL1                 76               S01280
      *   If record found,check ccy +type have not changed.               S01280
     C           *IN76     IFEQ '0'                        B**3           S01280
     C           HTCCY     ANDEQ@SRCCY                                    S01280
     C           HTLDNA    ANDEQ'LE'                                      S01280
     C                     MOVE 'Y'       @PRO                            S01280
     C                     END                             E**3           S01280
      *   Reset key for next file.                                        S01280
     C                     MOVE @SRCCY    @HTCCY                          S01280
     C                     MOVEL@CC,4     @HTFWY                          S01280
     C                     MOVE @YY,4     @HTFWY                          S01280
     C                     MOVE @MM,4     @HTFWM                          S01280
     C                     Z-ADD02        @HTFBH                          S01280
     C                     END                             E*2            S01280
      *   If FRA selected.                                                S01280
     C           @DFRA     IFNE *BLANK                     B*2            S01280
     C                     MOVE 'FR'      @LDNA2                          S01280
      *                                                                   S01280
     C           @HTKY1    SETGTMMFWDHL1                                  S01280
     C                     READ MMFWDHL1                 76               S01280
      *   If record found,check ccy +type have not changed.               S01280
     C           *IN76     IFEQ '0'                        B**3           S01280
     C           HTCCY     ANDEQ@SRCCY                                    S01280
     C           HTLDNA    ANDEQ'FR'                                      S01280
     C                     MOVE 'Y'       @PRO                            S01280
     C                     END                             E**3           S01280
      *   Reset key for next file.                                        S01280
     C                     MOVE @SRCCY    @HTCCY                          S01280
     C                     MOVEL@CC,4     @HTFWY                          S01280
     C                     MOVE @YY,4     @HTFWY                          S01280
     C                     MOVE @MM,4     @HTFWM                          S01280
     C                     Z-ADD02        @HTFBH                          S01280
     C                     END                             E*2            S01280
      *   If IRS selected.                                                S01280
     C           @DIRS     IFNE *BLANK                     B*2            S01280
     C                     MOVE 'IR'      @LDNA2                          S01280
      *                                                                   S01280
     C           @HTKY1    SETGTMMFWDHL1                                  S01280
     C                     READ MMFWDHL1                 76               S01280
      *   If record found,check ccy +type have not changed.               S01280
     C           *IN76     IFEQ '0'                        B**3           S01280
     C           HTCCY     ANDEQ@SRCCY                                    S01280
     C           HTLDNA    ANDEQ'IR'                                      S01280
     C                     MOVE 'Y'       @PRO                            S01280
     C                     END                             E**3           S01280
      *   Reset key for next file.                                        S01280
     C                     MOVE @SRCCY    @HTCCY                          S01280
     C                     MOVEL@CC,4     @HTFWY                          S01280
     C                     MOVE @YY,4     @HTFWY                          S01280
     C                     MOVE @MM,4     @HTFWM                          S01280
     C                     Z-ADD02        @HTFBH                          S01280
     C                     END                             E*2            S01280
      *   If FUTURES selected.                                            S01280
     C           @DFUT     IFNE *BLANK                     B*2            S01280
     C                     MOVE 'FU'      @LDNA2                          S01280
      *                                                                   S01280
     C           @HTKY1    SETGTMMFWDHL1                                  S01280
     C                     READ MMFWDHL1                 76               S01280
      *   If record found,check ccy +type have not changed.               S01280
     C           *IN76     IFEQ '0'                        B**3           S01280
     C           HTCCY     ANDEQ@SRCCY                                    S01280
     C           HTLDNA    ANDEQ'FU'                                      S01280
     C                     MOVE 'Y'       @PRO                            S01280
     C                     END                             E**3           S01280
      *   Reset key for next file.                                        S01280
     C                     MOVE @SRCCY    @HTCCY                          S01280
     C                     MOVEL@CC,4     @HTFWY                          S01280
     C                     MOVE @YY,4     @HTFWY                          S01280
     C                     MOVE @MM,4     @HTFWM                          S01280
     C                     Z-ADD02        @HTFBH                          S01280
     C                     END                             E*2            S01280
      *                                                                   S01280
     C                     END                             E1             S01280
      *                                                                   S01280
     C*
     C********** *IN76     IFEQ '1'                        B1             S01280
     C           @PRO      IFEQ 'N'                        B1             S01280
     C*          HTCCY     ORNE @FCCY                      *1             S01166
     C********** HTCCY     ORNE @SRCCY                     *1      S01166 S01280
     C********** @LDNA     ORNE 'ALL'                      *1      S01149 S01280
     C********** @LDNA2    ANDNEHTLDNA                     *1      S01149 S01280
     C                     MOVE 'END  '   @STEND           *1
     C                     END                             E1
     C*
     C*                                                                   S01166
     C*    STORE THE FIRST AND LAST RECORDS IN CASE THERE                 S01166
     C*    NO MORE                                                        S01166
     C                     MOVE @YY,1     @TOPRD                          S01166
     C                     MOVEL@MM,1     @TOPRD                          S01166
     C                     MOVE @YY,4     @BOTRD                          S01166
     C                     MOVEL@MM,4     @BOTRD                          S01166
     C*                                                                   S01166
     C*   DO CALCULATIONS AND THEN WRITE THE RECORD TO THE SUBFILE        S01166
     C                     EXSR #BF                                       S01166
     C*                                                                   S01166
     C                     END                                            S01166
     C*                                                                   S01166
     C           #BE9      ENDSR
     C*
     C*****************************************************************
      /EJECT
     C*****************************************************************
     C*                                                               *
     C*  #BF - THIS ROUTINE SETS UP FIELDS DERIVED FROM MMFWDHLL      *
     C*        IN THE DATA STRUCTURE @AMENQ AS FOLLOWS:               *
     C*                                                               *
     C*        FOR EACH CALCULATED DATE, 1ST AND 2ND HALF-MTH         *
     C*        DETAILS ARE ACCESSED FROM THEIR CORRESPONDING          *
     C*        MMFWDHLL RECORDS AND EDITED AS NECESSARY.              *
     C*                                                               *
     C*        TOTAL AMOUNTS ARE CALCULATED AND EDITED FOR EACH       *
     C*        DATE.                                                  *
     C*                                                               *
     C*        ALL EDITED AMOUNTS SO OBTAINED ARE PLACED IN THEIR     *
     C*        CORRESPONDING POSITIONS OF THE DATA STRUCTURE @DETLS,  *
     C*        WHICH IS THEN MOVED INTO THE RELEVANT POSITION FOR     *
     C*        THIS DATE IN THE DATA STRUCTURE @AMENQ USING THE       *
     C*        ARRAY @AM.                                             *
     C*                                                               *
     C*  CALLED BY : #B                                               *
     C*                                                               *
     C*  CALLS :     #BFA                                             *
     C*              #BFB                                             *
     C*                                                               *
     C*  USES:       @I     - DATE INDEX                              *
     C*              @FCCY  - CURRENCY FROM CA38CPLL RECORD           *
     C*              @CC    - ARRAY OF DATE CENTURIES                 *
     C*              @YY    - ARRAY OF DATE YEARS                     *
     C*              @MM    - ARRAY OF DATE MONTH NUMBERS             *
     C*              @HTCCY - KEY FIELD OF MMFWDHLL                   *
     C*              @HTFWY - KEY FIELD OF MMFWDHLL                   *
     C*              @HTFWM - KEY FIELD OF MMFWDHLL                   *
     C*              @HTFBH - KEY FIELD OF MMFWDHLL                   *
     C*              @H     - HALF-MONTH INDEX                        *
     C*              @WI    - WORK ARRAY OF EDITED HALF-MTH 'IN'      *
     C*                       AMOUNTS                                 *
     C*              @WO    - WORK ARRAY OF EDITED HALF-MTH 'OUT'     *
     C*                       AMOUNTS                                 *
     C*              @WN    - WORK ARRAY OF EDITED HALF-MTH 'NET'     *
     C*                       AMOUNTS                                 *
     C*              @WD    - WORK ARRAY OF EDITED HALF-MTH 'INTEREST *
     C*                       DUE' AMOUNTS                            *
     C*              @I1    - 1ST HALF-MTH 'IN' AMOUNT OUTPUT TO      *
     C*                       AMENQ1AA FOR THIS DATE                  *
     C*              @O1    - 1ST HALF-MTH 'OUT' AMOUNT OUTPUT TO     *
     C*                       AMENQ1AA FOR THIS DATE                  *
     C*              @N1    - 1ST HALF-MTH 'NET MOVEMENTS' AMOUNT     *
     C*                       OUTPUT TO AMENQ1AA FOR THIS DATE        *
     C*              @ID1   - 1ST HALF-MTH 'NET INTEREST' AMOUNT      *
     C*                       OUTPUT TO AMENQ1AA FOR THIS DATE        *
     C*              @I2    - 2ND HALF-MTH 'IN' AMOUNT OUTPUT TO      *
     C*                       AMENQ1AA FOR THIS DATE                  *
     C*              @O2    - 2ND HALF-MTH 'OUT' AMOUNT OUTPUT TO     *
     C*                       AMENQIAA FOR THIS DATE                  *
     C*              @N2    - 2ND HALF-MTH 'NET MOVEMENTS' AMOUNT     *
     C*                       OUTPUT TO AMENQ1AA FOR THIS DATE        *
     C*              @ID2   - 2ND HALF-MTH 'NET INTEREST' AMOUNT      *
     C*                       OUTPUT TO AMENQ1AA FOR THIS DATE        *
     C*              @ONE   - 1ST   HALF-MONTH FIXED NARRATIVE '-1'   *
     C*              @TWO   - 2ND   HALF-MONTH FIXED NARRATIVE '-2'   *
     C*              @DTH   - HALF-MTH ALPHA DATE OUTPUT TO           *
     C*                       AMENQ1AA FOR THIS DATE                  *
     C*              @DTM   - MONTHLY  ALPHA DATE OUTPUT TO           *
     C*                       AMENQ1AA FOR THIS DATE                  *
     C*              @DT    - ARRAY OF ALPHA DATES OUTPUT TO          *
     C*                       AMENQ1AA                                *
     C*              @MTH   - MONTH SHORTNAME ARRAY                   *
     C*              @M     - MONTH NUMBER CORRESPONDING TO @MTH      *
     C*              @DETLS - DATA STRUCTURE WHICH HOLDS MMFWDHLL     *
     C*                       INFORMATION FOR EACH CALCULATED DATE    *
     C*              @AM    - ARRAY OF MMFWDHLL DATA FOR EACH         *
     C*                       CALCULATED DATE                         *
     C*                                                               *
     C*****************************************************************
     C*
     C           #BF       BEGSR
     C*
     C                     Z-ADD0         RRN     20                      S01166
     C*                                                                   S01166
     C**  SET UP THE FIELDS FOR EACH OF THE MONTH DATES AS GENERATED
     C**  IN PREVIOUSLY CALLED SUBROUTINES.
     C*                    DO   3         @I      10       B1             S01166
     C                     DO   4         @I      10       B1             S01166
     C*                                                    *1
     C**   SET UP PARTIAL MMFWDHLL KEY FOR THIS MONTH      *1
     C*                    MOVE @FCCY     @HTCCY           *1             S01166
     C                     MOVE @SRCCY    @HTCCY           *1             S01166
     C                     MOVEL@CC,@I    @HTFWY           *1
     C                     MOVE @YY,@I    @HTFWY           *1
     C                     MOVE @MM,@I    @HTFWM           *1
     C*                                                    *1
     C*                                                    *1             S01166
     C**  SET UP THE ALPHA MONTH NARRATIVE FOR THIS DATE   *1             S01166
     C                     Z-ADD@MM,@I    @M               *1             S01166
     C                     MOVEL@MTH,@M   @DTH             *1             S01166
     C                     MOVE @YY,@I    @DTH             *1             S01166
     C                     MOVE @DTH      @DTM             *1             S01166
     C                     MOVE @DTH      @DT,@I           *1             S01166
     C*                                                    *1             S01166
     C**  ACCESS AND EDIT INFORMATION (IF ANY) FOR THE     *1
     C**  FIRST HALF-MONTH.                                *1
     C                     Z-ADD01        @HTFBH           *1
     C                     Z-ADD1         @H      10       *1
     C                     EXSR #BFA                       *1
     C*                                                    *1
     C**  MOVE FIRST HALF-MONTH AMOUNTS INTO THEIR         *1
     C**  CORRESPONDING @DETLS POSITIONS.                  *1
     C                     MOVE @WI,@H    @I1              *1
     C                     MOVE @WO,@H    @O1              *1
     C                     MOVE @WN,@H    @N1              *1
     C                     MOVE @WD,@H    @ID1             *1
     C*                                                    *1
     C**  ACCESS AND EDIT INFORMATION (IF ANY) FOR THE     *1
     C**  SECOND HALF-MONTH.                               *1
     C                     Z-ADD02        @HTFBH           *1
     C                     Z-ADD2         @H               *1
     C                     EXSR #BFA                       *1
     C*                                                    *1
     C**  MOVE SECOND HALF-MONTH AMOUNTS INTO THEIR        *1
     C**  CORRESPONDING @DETLS POSITIONS.                  *1
     C                     MOVE @WI,@H    @I2              *1
     C                     MOVE @WO,@H    @O2              *1
     C                     MOVE @WN,@H    @N2              *1
     C                     MOVE @WD,@H    @ID2             *1
     C*                                                    *1
     C**  SET UP FIXED NARRATIVES                          *1
     C           @MM,@I    IFEQ 0                          B*2            AMEND
     C                     MOVE '  '      @ONE             **2            AMEND
     C                     MOVE '  '      @TWO             **2            AMEND
     C                     ELSE                            X*2            AMEND
     C                     MOVE '-1'      @ONE             **2
     C                     MOVE '-2'      @TWO             **2
     C                     END                             E*2
     C*                                                    *1
     C**  SET UP THE TOTAL AMOUNTS FOR THIS MONTH          *1
     C                     EXSR #BFB                       *1
     C*                                                    *1
     C**  SET UP THE ALPHA MONTH NARRATIVE FOR THIS DATE   *1
     C*          @MM,@I    IFNE 0                          B*2            S01166
     C*                    Z-ADD@MM,@I    @M               **2            S01166
     C*                    MOVEL@MTH,@M   @DTH             **2            S01166
     C*                    MOVE @YY,@I    @DTH             **2            S01166
     C*                    MOVE @DTH      @DTM             **2            S01166
     C*                    MOVE @DTH      @DT,@I           **2            S01166
     C*                    ELSE                            X*2            S01166
     C*                    MOVE *BLANKS   @DTH             **2            S01166
     C*                    MOVE *BLANKS   @DTM             **2            S01166
     C*                    END                             E*2            S01166
     C*                                                    *1
     C**   SET UP DETAILS ARRAY ELEMENT FOR THIS DATE      *1
     C*                    MOVE @DETLS    @AM,@I           *1             S01166
     C*   SET UP DETAILS AND WRITE TO THE SUBFILE          *1             S01166
     C                     ADD  1         RRN              *1             S01166
     C                     MOVEL@DTH      DDDAT            *1             S01166
     C                     MOVEL@DTH      DDDAT2           *1             S01166
     C                     MOVE @ONE      DDDAT            *1             S01166
     C                     MOVE @I1       DDIN             *1             S01166
     C                     MOVE @O1       DDOUT            *1             S01166
     C                     MOVE @N1       DDNET            *1             S01166
     C                     MOVE @ID1      DDINT            *1             S01166
     C**********           WRITEDL3180S1                 63*1      S01166 S01117
     C                     WRITETM3180S1                 63*1             S01117
     C                     ADD  1         RRN              *1             S01166
     C                     MOVE *BLANKS   DDDAT            *1             S01166
     C                     MOVE @TWO      DDDAT            *1             S01166
     C                     MOVEL@DTH      DDDAT2           *1             S01166
     C                     MOVE @I2       DDIN             *1             S01166
     C                     MOVE @O2       DDOUT            *1             S01166
     C                     MOVE @N2       DDNET            *1             S01166
     C                     MOVE @ID2      DDINT            *1             S01166
     C**********           WRITEDL3180S1                 63*1      S01166 S01117
     C                     WRITETM3180S1                 63*1             S01117
     C                     ADD  1         RRN              *1             S01166
     C                     MOVE '1'       *IN15            *1             S01166
     C                     MOVE @DTM      DDDAT            *1             S01166
     C                     MOVEL@DTH      DDDAT2           *1             S01166
     C                     MOVE @IT       DDIN             *1             S01166
     C                     MOVE @OT       DDOUT            *1             S01166
     C                     MOVE @NT       DDNET            *1             S01166
     C                     MOVE @IDT      DDINT            *1             S01166
     C**********           WRITEDL3180S1                 63*1      S01166 S01117
     C                     WRITETM3180S1                 63*1             S01117
     C                     ADD  1         RRN              *1             S01166
     C                     MOVE '1'       *IN15            *1             S01166
     C                     MOVE *BLANKS   DDDAT            *1             S01166
     C                     MOVE *BLANKS   DDDAT2           *1             S01166
     C                     MOVE *BLANKS   DDIN             *1             S01166
     C                     MOVE *BLANKS   DDOUT            *1             S01166
     C                     MOVE *BLANKS   DDNET            *1             S01166
     C                     MOVE *BLANKS   DDINT            *1             S01166
     C**********           WRITEDL3180S1                 63*1      S01166 S01117
     C                     WRITETM3180S1                 63*1             S01117
     C                     MOVE '0'       *IN15            *1             S01166
     C*                                                                   S01166
     C*    SET UP CURRENCY AND DEAL TYPE TO DISPLAY ON SCREEN             S01166
     C                     MOVE @SRCCY    @SCCY            *1             S01166
     C**********           MOVE @LDNA     @SDTYP           *1      S01166 S01280
     C*                                                                   S01166
     C*                                                                   S01166
     C                     END                             E1
     C*
     C           #BF9      ENDSR
     C*
     C*****************************************************************
      /EJECT
     C*****************************************************************
     C*                                                               *
     C*  #BFA - THIS ROUTINE READS AN MMFWDHLL RECORD FOR A SPECIFIC  *
     C*         CURRENCY, DATE AND HALF-MONTH FOR THAT DATE.          *
     C*         ALL AMOUNTS READ ARE EDITED AND PLACED INTO THEIR     *
     C*         RESPECTIVE HALF-MONTHLY WORK ARRAY.                   *
     C*         ALL AMOUNTS READ ARE SAVED IN HALF-MONTH NUMERIC      *
     C*         WORK ARRAYS FOR LATER USE IN MONTHLY TOTAL CALCS.     *
     C*                                                               *
     C*  CALLED BY : #BF                                              *
     C*                                                               *
     C*  CALLS :     MM1015                                           *
     C*              MM1016                                           *
     C*                                                               *
     C*  USES :      @HTKEY - COMPOSITE KEY FOR MMFWDHLL              *
     C*              @H     - HALF-MONTH INDEX                        *
     C*              @WI    - WORK ARRAY OF EDITED HALF-MTH 'IN'      *
     C*                       AMOUNTS                                 *
     C*              @WO    - WORK ARRAY OF EDITED HALF-MTH 'OUT'     *
     C*                       AMOUNTS                                 *
     C*              @WN    - WORK ARRAY OF EDITED HALF-MTH 'NET'     *
     C*                       AMOUNTS                                 *
     C*              @WD    - WORK ARRAY OF EDITED HALF-MTH 'INTEREST *
     C*                       DUE' AMOUNTS                            *
     C*              @TI    - WORK ARRAY OF NUMERIC HALF-MTH 'IN'     *
     C*                       AMOUNTS                                 *
     C*              @TO    - WORK ARRAY OF NUMERIC HALF-MTH 'OUT'    *
     C*                       AMOUNTS                                 *
     C*              @TN    - WORK ARRAY OF NUMERIC HALF-MTH 'NET'    *
     C*                       AMOUNTS                                 *
     C*              @TD    - WORK ARRAY OF NUMERIC HALF-MTH 'INTEREST*
     C*                       DUE' AMOUNTS                            *
     C*              @@IAMT - INPUT TO MM1015/MM1016                  *
     C*              @@CCY  - INPUT TO MM1015/MM1016                  *
     C*              @@AMNT - OUTPUT FROM MM1015                      *
     C*              @@AMOU - OUTPUT FROM MM1016                      *
     C*              @LDNA  - DEAL TYPE                               *   S01149
     C*              @SHMCI - STORE OF HALF MONTH CASH IN             *   S01149
     C*              @SHMCO - STORE OF HALF MONTH CASH OUT            *   S01149
     C*              @SHMNM - STORE OF HALF MONTH NET MOVEMENT        *   S01149
     C*              @SHNIM - STORE OF HALF MONTH NET INTEREST        *   S01149
     C*              @HTKY1 - KEY FOR MMFWDHL1                        *   S01149
     C*                                                               *
     C*****************************************************************
     C*
     C           #BFA      BEGSR
     C*
     C**  READ SPECIFIC MMFWDHLL RECORD FOR CURRENCY, DATE AND HALF-MTH.
     C***********@HTKEY****CHAINMMFWDHLL*************76                   S01149
      *                                                                   S01280
      **  Set up flag @RECF for multiple select(not ALL).If record        S01280
      **  found on prior deal type chain then not found on lower chain    S01280
      **  do not want *IN76 = '1' processing as would blank out screen.   S01280
     C                     MOVE 'N'       @RECF   1                       S01280
     C*
     C**  Retrieve record for single or all deal types                    S01149
     C           @LDNA     IFNE 'ALL'                      *1             S01149
     C*
     C********** @HTKY1    CHAINMMFWDHL1             76    *1      S01149 S01280
     C*
     C                     Z-ADD*ZEROS    @SHMCI                          S01280
     C                     Z-ADD*ZEROS    @SHMCO                          S01280
     C                     Z-ADD*ZEROS    @SHMNM                          S01280
     C                     Z-ADD*ZEROS    @SHNIM                          S01280
      *   If NA.                                                          S01280
     C           @DNA      IFNE *BLANK                     B*2            S01280
     C                     MOVE 'NA'      @LDNA2  2                       S01280
     C           @HTKY1    SETLLMMFWDHL1                                  S01280
     C           @HTKY1    CHAINMMFWDHL1             76                   S01280
      *                                                                   S01280
     C           *IN76     IFEQ '0'                        B**3           S01280
     C                     ADD  HTHMCI    @SHMCI           ***3           S01280
     C                     ADD  HTHMCO    @SHMCO           ***3           S01280
     C                     ADD  HTHMNM    @SHMNM           ***3           S01280
     C                     ADD  HTHNIM    @SHNIM           ***3           S01280
     C                     MOVE 'Y'       @RECF            ***3           S01280
     C                     END                             E**3           S01280
     C                     END                             E*2            S01280
      *   If LD.                                                          S01280
     C           @DLD      IFNE *BLANK                     B*2            S01280
     C                     MOVE 'LD'      @LDNA2                          S01280
     C           @HTKY1    SETLLMMFWDHL1                                  S01280
     C           @HTKY1    CHAINMMFWDHL1             76                   S01280
      *                                                                   S01280
     C           *IN76     IFEQ '0'                        B**3           S01280
     C                     ADD  HTHMCI    @SHMCI           ***3           S01280
     C                     ADD  HTHMCO    @SHMCO           ***3           S01280
     C                     ADD  HTHMNM    @SHMNM           ***3           S01280
     C                     ADD  HTHNIM    @SHNIM           ***3           S01280
     C                     MOVE 'Y'       @RECF            ***3           S01280
     C                     END                             E**3           S01280
     C                     END                             E*2            S01280
      *   If LENDING.                                                     S01280
     C           @DLEN     IFNE *BLANK                     B*2            S01280
     C                     MOVE 'LE'      @LDNA2                          S01280
     C           @HTKY1    SETLLMMFWDHL1                                  S01280
     C           @HTKY1    CHAINMMFWDHL1             76                   S01280
      *                                                                   S01280
     C           *IN76     IFEQ '0'                        B**3           S01280
     C                     ADD  HTHMCI    @SHMCI           ***3           S01280
     C                     ADD  HTHMCO    @SHMCO           ***3           S01280
     C                     ADD  HTHMNM    @SHMNM           ***3           S01280
     C                     ADD  HTHNIM    @SHNIM           ***3           S01280
     C                     MOVE 'Y'       @RECF            ***3           S01280
     C                     END                             E**3           S01280
     C                     END                             E*2            S01280
      *   If FRA.                                                         S01280
     C           @DFRA     IFNE *BLANK                     B*2            S01280
     C                     MOVE 'FR'      @LDNA2                          S01280
     C           @HTKY1    SETLLMMFWDHL1                                  S01280
     C           @HTKY1    CHAINMMFWDHL1             76                   S01280
      *                                                                   S01280
     C           *IN76     IFEQ '0'                        B**3           S01280
     C                     ADD  HTHMCI    @SHMCI           ***3           S01280
     C                     ADD  HTHMCO    @SHMCO           ***3           S01280
     C                     ADD  HTHMNM    @SHMNM           ***3           S01280
     C                     ADD  HTHNIM    @SHNIM           ***3           S01280
     C                     MOVE 'Y'       @RECF            ***3           S01280
     C                     END                             E**3           S01280
     C                     END                             E*2            S01280
      *   If IRS.                                                         S01280
     C           @DIRS     IFNE *BLANK                     B*2            S01280
     C                     MOVE 'IR'      @LDNA2                          S01280
     C           @HTKY1    SETLLMMFWDHL1                                  S01280
     C           @HTKY1    CHAINMMFWDHL1             76                   S01280
      *                                                                   S01280
     C           *IN76     IFEQ '0'                        B**3           S01280
     C                     ADD  HTHMCI    @SHMCI           ***3           S01280
     C                     ADD  HTHMCO    @SHMCO           ***3           S01280
     C                     ADD  HTHMNM    @SHMNM           ***3           S01280
     C                     ADD  HTHNIM    @SHNIM           ***3           S01280
     C                     MOVE 'Y'       @RECF            ***3           S01280
     C                     END                             E**3           S01280
     C                     END                             E*2            S01280
      *   If FUTURES.                                                     S01280
     C           @DFUT     IFNE *BLANK                     B*2            S01280
     C                     MOVE 'FU'      @LDNA2                          S01280
     C           @HTKY1    SETLLMMFWDHL1                                  S01280
     C           @HTKY1    CHAINMMFWDHL1             76                   S01280
      *                                                                   S01280
     C           *IN76     IFEQ '0'                        B**3           S01280
     C                     ADD  HTHMCI    @SHMCI           ***3           S01280
     C                     ADD  HTHMCO    @SHMCO           ***3           S01280
     C                     ADD  HTHMNM    @SHMNM           ***3           S01280
     C                     ADD  HTHNIM    @SHNIM           ***3           S01280
     C                     MOVE 'Y'       @RECF            ***3           S01280
     C                     END                             E**3           S01280
     C                     END                             E*2            S01280
      *                                                                   S01280
     C                     Z-ADD@SHMCI    HTHMCI           **2            S01280
     C                     Z-ADD@SHMCO    HTHMCO           **2            S01280
     C                     Z-ADD@SHMNM    HTHMNM           **2            S01280
     C                     Z-ADD@SHNIM    HTHNIM           **2            S01280
     C*
     C                     ELSE                            X1             S01149
     C                     Z-ADD*ZEROS    @SHMCI           *1             S01149
     C                     Z-ADD*ZEROS    @SHMCO           *1             S01149
     C                     Z-ADD*ZEROS    @SHMNM           *1             S01149
     C                     Z-ADD*ZEROS    @SHNIM           *1             S01149
     C           @HTKEY    SETLLMMFWDHLL                   *1             S01149
     C           @HTKEY    READEMMFWDHLL                 76*1             S01149
     C           *IN76     IFEQ '0'                        B*2            S01149
     C           *IN77     DOUEQ'1'                        B**3           S01149
     C                     ADD  HTHMCI    @SHMCI           ***3           S01149
     C                     ADD  HTHMCO    @SHMCO           ***3           S01149
     C                     ADD  HTHMNM    @SHMNM           ***3           S01149
     C                     ADD  HTHNIM    @SHNIM           ***3           S01149
     C           @HTKEY    READEMMFWDHLL                 77***3           S01149
     C                     END                             E**3           S01149
     C                     Z-ADD@SHMCI    HTHMCI           **2            S01149
     C                     Z-ADD@SHMCO    HTHMCO           **2            S01149
     C                     Z-ADD@SHMNM    HTHMNM           **2            S01149
     C                     Z-ADD@SHNIM    HTHNIM           **2            S01149
     C                     END                             E*2            S01149
     C                     END                             E1             S01149
     C*
     C           *IN76     IFEQ '1'                        B1
     C           @RECF     ANDEQ'N'                                       S01280
     C*
     C**  IF RECORD NOT FOUND, BLANK OUT ALL EDITED HALF-MONTHLY AMOUNT
     C**  FIELDS AND ZEROIZE HALF-MONTHLY TOTAL WORK FIELDS.
     C                     MOVE *BLANKS   @WI,@H           *1
     C                     MOVE *BLANKS   @WO,@H           *1
     C                     MOVE *BLANKS   @WN,@H           *1
     C                     MOVE *BLANKS   @WD,@H           *1
     C                     Z-ADD0         @TI,@H           *1
     C                     Z-ADD0         @TO,@H           *1
     C                     Z-ADD0         @TN,@H           *1
     C                     Z-ADD0         @TD,@H           *1
     C                     ELSE                            X1
     C*
     C**  SET UP CURRENCY FOR WHICH TO EDIT.
     C                     MOVE HTCCY     @@CCY   3        *1
     C*
     C**  SAVE THE HALF-MONTH 'IN' AMOUNT FOR LATER USE IN MONTHLY
     C**  TOTALS CALCULATION.
     C                     Z-ADDHTHMCI    @TI,@H           *1
     C*
     C**  EDIT THE HALF-MONTH 'IN' AMOUNT VIA STANDARD SUBROUTINE MM1015.
     C                     Z-ADDHTHMCI    @@IAMT           *1
     C                     EXSR MM1015                     *1
     C                     MOVE @@AMNT    @WI,@H           *1
     C*
     C**  SAVE THE HALF-MONTH 'OUT' AMOUNT FOR LATER USE IN MONTHLY
     C**  TOTALS CALCULATION.
     C                     Z-ADDHTHMCO    @TO,@H           *1
     C*
     C**  EDIT THE HALF-MONTH 'OUT' AMOUNT VIA STANDARD SUBROUTINE MM1015.
     C                     Z-ADDHTHMCO    @@IAMT           *1
     C                     EXSR MM1015                     *1
     C                     MOVE @@AMNT    @WO,@H           *1
     C*
     C**  SAVE THE HALF-MONTH 'NET MOVEMENTS' AMOUNT FOR LATER USE IN
     C**  MONTHLY TOTALS CALCULATION.
     C                     Z-ADDHTHMNM    @TN,@H           *1
     C*
     C**  EDIT THE HALF-MONTH 'NET MOVEMENTS' AMOUNT VIA STANDARD
     C**  SUBROUTINE MM1016.
     C                     Z-ADDHTHMNM    @@IAMT           *1
     C                     EXSR MM1016                     *1
     C                     MOVE @@AMOU    @WN,@H           *1
     C*
     C**  SAVE THE HALF-MONTH 'NET INTEREST' AMOUNT FOR LATER USE IN
     C**  MONTHLY TOTALS CALCULATION.
     C                     Z-ADDHTHNIM    @TD,@H           *1
     C*
     C**  EDIT THE HALF-MONTH 'NET INTEREST' AMOUNT VIA STANDARD
     C**  SUBROUTINE MM1016.
     C                     Z-ADDHTHNIM    @@IAMT           *1
     C                     EXSR MM1016                     *1
     C                     MOVE @@AMOU    @WD,@H           *1
     C*
     C                     END                             E1
     C*
     C           #BFA9     ENDSR
     C*
     C****************************************************************
      /EJECT
     C*****************************************************************
     C*                                                               *
     C*  #BFB - THIS ROUTINE CALCULATES, EDITS AND PLACES IN @DETLS   *
     C*         THE TOTAL 'IN', 'OUT' AND 'NET' AMOUNTS FOR A GIVEN   *
     C*         DATE.                                                 *
     C*                                                               *
     C*  CALLED BY : #BF                                              *
     C*                                                               *
     C*  CALLS :     MM1015                                           *
     C*              MM1016                                           *
     C*                                                               *
     C*  USES :      @WI    - WORK ARRAY OF EDITED HALF-MTH 'IN'      *
     C*                       AMOUNTS                                 *
     C*              @WO    - WORK ARRAY OF EDITED HALF-MTH 'OUT'     *
     C*                       AMOUNTS                                 *
     C*              @WN    - WORK ARRAY OF EDITED HALF-MTH 'NET'     *
     C*                       AMOUNTS                                 *
     C*              @WD    - WORK ARRAY OF EDITED HALF-MTH 'INTEREST *
     C*                       DUE' AMOUNTS                            *
     C*              @TI    - WORK ARRAY OF NUMERIC HALF-MTH 'IN'     *
     C*                       AMOUNTS                                 *
     C*              @TO    - WORK ARRAY OF NUMERIC HALF-MTH 'OUT'    *
     C*                       AMOUNTS                                 *
     C*              @TN    - WORK ARRAY OF NUMERIC HALF-MTH 'NET'    *
     C*                       AMOUNTS                                 *
     C*              @TD    - WORK ARRAY OF NUMERIC HALF-MTH 'INTEREST*
     C*                       DUE' AMOUNTS                            *
     C*              @IT    - TOTAL 'IN' AMOUNT OUTPUT TO AMENQ1AA    *
     C*                       FOR THIS DATE                           *
     C*              @OT    - TOTAL 'OUT' AMOUNT OUTPUT TO AMENQ1AA   *
     C*                       FOR THIS DATE                           *
     C*              @NT    - TOTAL 'NET MOVEMENTS' AMOUNT OUTPUT TO  *
     C*                       AMENQ1AA FOR THIS DATE                  *
     C*              @IDT   - TOTAL 'NET INTEREST' AMOUNT OUTPUT TO   *
     C*                       AMENQ1AA FOR THIS DATE                  *
     C*              @@IAMT - INPUT TO MM1015/MM1016                  *
     C*              @@CCY  - INPUT TO MM1015/MM1016                  *
     C*              @@AMNT - OUTPUT FROM MM1015                      *
     C*              @@AMOU - OUTPUT FROM MM1016                      *
     C*                                                               *
     C*****************************************************************
     C*
     C           #BFB      BEGSR
     C*
     C**  MONTHLY TOTAL PROCESSING FOR HALF-MONTHLY 'IN' AMOUNTS.
     C           @WI,1     IFEQ *BLANKS                    B1
     C           @WI,2     ANDEQ*BLANKS                    *1
     C*
     C**  IF BOTH EDITED 'IN' HALF-MTH AMOUNTS ARE BLANK,
     C**  NO 'IN' TOTAL PROCESSING FOR THIS DATE.
     C                     MOVE *BLANKS   @IT              *1
     C                     ELSE                            X1
     C*
     C**  CALCULATE, EDIT AND SET UP IN @DETLS THE TOTAL
     C**  'IN' AMOUNT FOR THIS DATE.
     C           @TI,1     ADD  @TI,2     @@IAMT           *1
     C                     EXSR MM1015                     *1
     C                     MOVE @@AMNT    @IT              *1
     C                     END                             E1
     C*
     C**  MONTHLY TOTAL PROCESSING FOR HALF-MONTHLY 'OUT' AMOUNTS.
     C           @WO,1     IFEQ *BLANKS                    B1
     C           @WO,2     ANDEQ*BLANKS                    *1
     C*
     C**  IF BOTH EDITED 'OUT' HALF-MTH AMOUNTS ARE BLANK,
     C**  NO 'OUT' TOTAL PROCESSING FOR THIS DATE.
     C                     MOVE *BLANKS   @OT              *1
     C                     ELSE                            X1
     C*
     C**  CALCULATE, EDIT AND SET UP IN @DETLS THE TOTAL
     C**  'OUT' AMOUNT FOR THIS DATE.
     C           @TO,1     ADD  @TO,2     @@IAMT           *1
     C                     EXSR MM1015                     *1
     C                     MOVE @@AMNT    @OT              *1
     C                     END                             E1
     C*
     C**  MONTHLY TOTAL PROCESSING FOR HALF-MONTHLY 'NET MOVEMENTS'
     C**  AMOUNTS.
     C           @WN,1     IFEQ *BLANKS                    B1
     C           @WN,2     ANDEQ*BLANKS                    *1
     C*
     C**  IF BOTH EDITED 'NET MOVEMENTS' HALF-MTH AMOUNTS ARE BLANK,
     C**  NO 'NET MOVEMENTS' TOTAL PROCESSING FOR THIS DATE.
     C                     MOVE *BLANKS   @NT              *1
     C                     ELSE                            X1
     C*
     C**  CALCULATE, EDIT AND SET UP IN @DETLS THE TOTAL
     C**  'NET MOVEMENTS' AMOUNT FOR THIS DATE.
     C           @TN,1     ADD  @TN,2     @@IAMT           *1
     C                     EXSR MM1016                     *1
     C                     MOVE @@AMOU    @NT              *1
     C                     END                             E1
     C*
     C**  MONTHLY TOTAL PROCESSING FOR HALF-MONTHLY 'NET INTEREST'
     C**  AMOUNTS.
     C           @WD,1     IFEQ *BLANKS                    B1
     C           @WD,2     ANDEQ*BLANKS                    *1
     C*
     C**  IF BOTH EDITED 'NET INTEREST' HALF-MTH AMOUNTS ARE BLANK,
     C**  NO 'NET INTEREST' TOTAL PROCESSING FOR THIS DATE.
     C                     MOVE *BLANKS   @IDT             *1
     C                     ELSE                            X1
     C*
     C**  CALCULATE, EDIT AND SET UP IN @DETLS THE TOTAL
     C**  'NET INTEREST' AMOUNT FOR THIS DATE.
     C           @TD,1     ADD  @TD,2     @@IAMT           *1
     C                     EXSR MM1016                     *1
     C                     MOVE @@AMOU    @IDT             *1
     C                     END                             E1
     C*
     C           #BFB9     ENDSR
     C*
     C****************************************************************
      /EJECT
     C*****************************************************************
     C*                                                               *
     C*  #A - THIS ROUTINE PERFORMS INITIAL PROCESSING                *
     C*                                                               *
     C*  CALLED BY : CONTROL PROCESSING                               *   S01166
     C*                                                               *
     C***CALLS*******ZA0150*****                                      *   S01194
     C*  CALLS :                                                      *   S01194
     C*              ZA0280                                           *
     C*                                                               *
     C*                                                               *
     C*  USES :      @TERM  - TERMINATION INPUT PARAMETER             *
     C*              @ENQ   - ENQUIRY UPDATED INPUT PARAMETER         *
     C*              @RRFSH - ROLL/REFRESH INPUT PARAMETER            *
     C*              @HTKEY - COMPOSITE KEY FOR MMFWDHLL (no d. type) *   S01149
     C*              @HTCCY - KEY FIELD OF MMFWDHLL                   *
     C*              @HTFWY - KEY FIELD OF MMFWDHLL                   *
     C*              @HTFWM - KEY FIELD OF MMFWDHLL                   *
     C*              @HTFBH - KEY FIELD OF MMFWDHLL                   *
     C*              @FCYC  - FIRST TIME PROGRAM CALLED IN CURRENT    *
     C*                       INVOCATION                              *
     C*              @AMENQ - SCREEN ENQUIRY DATA AREA                *
     C*              @NODAT - NO DATES GENERATED FLAG                 *
     C*              @LDNA  - DEAL TYPE                               *   S01149
     C*              @SHMCI - STORE OF HALF MONTH CASH IN             *   S01149
     C*              @SHMCO - STORE OF HALF MONTH CASH OUT            *   S01149
     C*              @SHMNM - STORE OF HALF MONTH NET MOVEMENT        *   S01149
     C*              @SHNIM - STORE OF HALF MONTH NET INTEREST        *   S01149
     C*              @HTKY1 - KEY FOR MMFWDHL1                        *   S01149
     C*                                                               *
     C*****************************************************************
     C*
     C           #A        BEGSR
     C*
     C* INITIALISE SCREEN MESSAGE QUEUE                                   S01166
     C                     MOVEL'*'       DDPGMQ                          S01166
     C*                                                                   S01166
     C**  RECEIVE THE INPUT PARAMETERS
     C           *ENTRY    PLIST
     C***                  PARM           @TERM   1                       S01166
     C***                  PARM           @ENQ    1                       S01166
     C***                  PARM           @RRFSH                          S01166
     C                     PARM           @TERM   1                       S01166
     C                     PARM           @STRNG                          S01166
     C*
     C**  DEFINE MMFWDHLL PARTIAL KEY FOR ALL DEAL TYPES                  S01149
     C           @HTKEY    KLIST
     C                     KFLD           @HTCCY  3
     C                     KFLD           @HTFWY  40
     C                     KFLD           @HTFWM  20
     C                     KFLD           @HTFBH  20
     C*
     C**  DEFINE MMFWDHLL KEY FOR L/D OR N/A DEAL TYPES                   S01149
     C           @HTKY1    KLIST                                          S01149
     C                     KFLD           @HTCCY                          S01149
     C                     KFLD           @LDNA2                          S01149
     C                     KFLD           @HTFWY                          S01149
     C                     KFLD           @HTFWM                          S01149
     C                     KFLD           @HTFBH                          S01149
     C*
     C**  DEFINE VARIABLES TO STORE FWD BOOK HALF MTH DETAILS             S01149
     C           *LIKE     DEFN HTHMCI    @SHMCI                          S01149
     C           *LIKE     DEFN HTHMCO    @SHMCO                          S01149
     C           *LIKE     DEFN HTHMNM    @SHMNM                          S01149
     C           *LIKE     DEFN HTHNIM    @SHNIM                          S01149
      *   Define input workfields                                         S01280
     C           *LIKE     DEFN DDALL     @DALL                           S01280
     C           *LIKE     DEFN DDNA      @DNA                            S01280
     C           *LIKE     DEFN DDLD      @DLD                            S01280
     C           *LIKE     DEFN DDLEN     @DLEN                           S01280
     C           *LIKE     DEFN DDFRA     @DFRA                           S01280
     C           *LIKE     DEFN DDIRS     @DIRS                           S01280
     C           *LIKE     DEFN DDFUT     @DFUT                           S01280
     C*
     C**  IF TERMINATION PARAMETER IS 'T', SET LR. NO FURTHER
     C**  PROCESSING IN THIS ROUTINE.
     C           @TERM     IFEQ 'T'                        B1
     C                     MOVE '1'       *INLR            *1
     C                     GOTO #A9                        *1
     C                     END                             E1
     C*
     C**  CHECK IF THIS IS THE FIRST TIME THIS PROGRAM HAS BEEN
     C**  CALLED IN THE CURRENT INVOCATION AND PERFORM THE APPROPRIATE
     C**  PROCESSING.
     C           @FCYC     IFNE 'Y'                        B1
     C*                                                    *1
     C**  SET UP PROGRAM NAME IN *LDA IN CASE OF DATA BASE *1
     C**  ERROR                                            *1
     C*                    MOVEL'MM0043'  DBPGM            *1             S01166
     C**********           MOVEL'DL3180'  DBPGM            *1      S01166 S01117
     C                     MOVEL'TM3180'  DBPGM            *1             S01117
     C*                                                    *1
     C** OPEN ALL FILES UNDER USER CONTROL                 *1
     C*                    OPEN CA38CPLL                   *1             S01166
     C                     OPEN FDMNTHLL                   *1
     C                     OPEN MMFWDHLL                   *1
     C                     OPEN MMFWDHL1                   *1             S01149
     C**********           OPEN FDCCYTLL                   *1             S01194
     C**********           OPEN FDICDRLL                   *1             S01194
     C*********************OPEN*FDUSSILL********************1*******S01166S01319
     C                     OPEN MUSER                                     S01319
     C                     OPEN DLMMTOLL                   *1             S01280
     C*                                                    *1
     C******************************************************1*******S01166S01319
     C*********************MOVEL@USER*****@USER3**3*********1*******S01166S01319
     C******************************************************1*******S01166S01319
     C***********@USER3****CHAINFDUSSILL*************71*****1*******S01166S01319
     C******************************************************1*******S01166S01319
     C**DATABASE*ERROR*IF*USER*NOT*FOUND:*******************1*******S01166S01319
     C************IN71*****IFEQ*'1'************************B*2******S01166S01319
     C*********************MOVE*'901'*****DBASE**************2******S01166S01319
     C*********************MOVE*'FDUSSILL'DBFILE*************2******S01166S01319
     C*********************MOVEL@USER3****DBKEY**************2*ERRORS01166S01319
     C*********************MOVE*'1'********INU7**************2**901*S01166S01319
     C*********************MOVE*'1'********INU8**************2******S01166S01319
     C*********************GOTO*#A9**************************2******S01166S01319
     C*********************END*****************************E*2******S01166S01319
     C*                                                                   S01166
     C           @USER     CHAINMUSER                71                   S01319
     C*                                                                   S01319
     C           *IN71     IFEQ '1'                        B*2            S01319
     C*                                                                   S01319
     C                     MOVEL'MUSER'   DBFILE           ***************S01319
     C                     MOVE '901'     DBASE            *             *S01319
     C                     MOVEL@USER     DBKEY            * DBERROR 901 *S01319
     C                     MOVE '1'       *INU7                           S01319
     C                     MOVE '1'       *INU8            ************** S01319
     C                     GOTO #A9                                       S01319
     C*                                                                   S01319
     C                     END                             E*2            S01319
     C* DO DISPLAY FILE OVERRIDE BEFORE OPEN                              S01166
     C***********USREF*****IFEQ*'Y'                        B*2      S01166S01319
     C           AURF      IFEQ 'Y'                        B*2            S01319
     C                     MOVEL@OVR,1    @OVRID           **2            S01166
     C*********************Z-ADDUSRFPD****@WAIT**************2******S01166S01319
     C                     Z-ADDREFP      @WAIT            **2            S01319
     C                     Z-ADD36        QCALEN 155       **2            S01166
     C*********************CALL 'QCAEXEC'                  **2      S01166E20774
     C                     CALL 'QCMDEXC'                  **2            E20774
     C                     PARM           @OVRID           **2            S01166
     C                     PARM           QCALEN           **2            S01166
     C                     END                             E*2            S01166
     C*                                                                   S01166
     C**********           OPEN DL3180DD                           S01166 S01117
     C                     OPEN TM3180DD                                  S01117
     C*                                                                   S01166
     C****READ*THE*I.C.D.*FILE******                       *1             S01194
     C**********           EXSR ZA0150                     *1             S01194
     C**********                                           *1             S01194
     C****IF*A*DATA*BASE*ERROR*HAS*OCCURRED**SET*U7**U8*****1             S01194
     C****AND*LR**NO*FURTHER*PROCESSING*IN*THIS*ROUTINE*****1             S01194
     C********** *IN80     IFEQ '1'                        B*2            S01194
     C**********           MOVE '1'       *INU7            **2            S01194
     C**********           MOVE '1'       *INU8            **2            S01194
     C**********           MOVE '1'       *INLR            **2            S01194
     C**********           GOTO #A9                        **2            S01194
     C**********           END                             E*2            S01194
      *                                                                   S01194
      * Get Bank's details from SDBANKPD via Access Object                S01194
      * (Note that *DBERR is used as standard return code although        S01194
      * this will not normally produce a DB error due to access           S01194
      * object having already been called in SD1600)                      S01194
     C                     CALL 'AOBANKR0'                                S01194
     C                     PARM '*DBERR ' @RTCD   7                       S01194
     C                     PARM '*FIRST ' @OPTN   7                       S01194
     C           SDBANK    PARM SDBANK    DSFDY                           S01194
      *                                                                   S01194
      * Get Module details via Access Object                              S01194
     C                     CALL 'AOMMODR0'                                S01194
     C                     PARM '*DBERR ' @RTCD   7                       S01194
     C                     PARM '*FIRST ' @OPTN   7                       S01194
     C           SDMMOD    PARM SDMMOD    DSFDY                           S01194
     C*                                                    *1
     C**  READ THE MONTH SHORTNAMES FILE                   *1
     C                     EXSR ZA0280                     *1
     C*                                                    *1
     C**  IF A DATA BASE ERROR HAS OCCURRED, SET U7, U8    *1
     C**  AND LR. NO FURTHER PROCESSING IN THIS ROUTINE.   *1
     C           *IN80     IFEQ '1'                        B*2
     C                     MOVE '1'       *INU7            **2
     C                     MOVE '1'       *INU8            **2
     C                     MOVE '1'       *INLR            **2
     C                     GOTO #A9                        **2
     C                     END                             E*2
     C*                                                                   S01280
      * Check if Lending, Futures and FRA/IRS modules are on and          S01280
      * if so set indicators to allow selection                           S01280
     C*                                                                   S01280
      * Lending                                                           S01280
     C           BGCSLN    IFEQ 'Y'                                       S01280
     C                     MOVE '1'       *IN41                           S01280
     C                     END                                            S01280
     C*                                                                   S01280
     C* Futures                                                           S01280
     C           BGFUOP    IFEQ 'Y'                                       S01280
     C                     MOVE '1'       *IN43                           S01280
     C                     END                                            S01280
     C*                                                                   S01280
     C* FRA/IRS                                                           S01280
     C           BGFIIN    IFEQ 'Y'                                       S01280
     C                     MOVE '1'       *IN42                           S01280
     C                     END                                            S01280
     C*                                                    *1
     C**  SET FLAG THAT FIRST INVOCATION PROCESSING HAS    *1
     C**  BEEN SUCCESSFULLY COMPLETED                      *1
     C                     MOVE 'Y'       @FCYC   1        *1
     C                     END                             E1
     C*
     C*   SETOF ALL INDICATORS                                            S01166
     C                     MOVE '0'       *IN,01                          S01166
      *                                                                   S01280
      **  Set up '* TAKE ON IN PROGRESS *' or 'LAST TAKE ON xx:xx:xx      S01280
      *                                                                   S01280
     C           1         SETLLDLMMTOLL                                  S01280
     C                     READ DLMMTOLL                 79               S01280
      *                                                                   S01280
     C           TOTOIP    IFEQ 'Y'                                       S01280
     C                     MOVEL'* TAKE ' @TKON                           S01280
     C                     MOVE 'ON IN '  @TKON                           S01280
     C                     MOVE 'PR'      @PR                             S01280
     C                     MOVEL'OGRESS ' @OGR                            S01280
     C                     MOVE '*'       @OGR                            S01280
     C                     MOVE @TOIP     @DSTS                           S01280
     C                     ELSE                                           S01280
     C                     MOVEL' LAST T' @LTON                           S01280
     C                     MOVE 'AKE ON'  @LTON                           S01280
     C                     MOVE *BLANKS   @BLNK                           S01280
     C                     MOVE @@SEC     @SEC                            S01280
     C                     MOVE ':'       @DASH1                          S01280
     C                     MOVE @@MIN     @MIN                            S01280
     C                     MOVE ':'       @DASH2                          S01280
     C                     MOVE @@HOUR    @HOUR                           S01280
     C                     MOVE @LTONT    @DSTS                           S01280
     C                     END                                            S01280
     C*                                                                   S01166
     C*                                                                   S01166
     C*   INHIBIT ROLL KEYS AND SET ON END OF MESSAGE AND ENQUIRY         S01166
     C*   SUBFILE INDICATORS                                              S01166
     C                     MOVE '1'       *IN27                           S01166
     C                     MOVE '1'       *IN40                           S01166
     C                     MOVE '1'       *IN30                           S01166
      *                                                                   S01280
      *   Clear screen select prompts in case returning from DL3190       S01280
      *   and prompts have been changed.                                  S01280
     C                     MOVE *BLANK    DDALL                           S01280
     C                     MOVE *BLANK    DDNA                            S01280
     C                     MOVE *BLANK    DDLD                            S01280
     C                     MOVE *BLANK    DDLEN                           S01280
     C                     MOVE *BLANK    DDFRA                           S01280
     C                     MOVE *BLANK    DDIRS                           S01280
     C                     MOVE *BLANK    DDFUT                           S01280
     C*                                                                   S01166
     C*   RETRIEVE WORKSTATION ID AND WRITE OUT THE SCREEN HEADER         S01166
     C*   AND COMMAND KEY TEXT                                            S01166
     C                     MOVEL@JOB      @WSID                           S01166
     C**********           WRITEDL3180F0               63          S01166 S01117
     C                     WRITETM3180F0               63                 S01117
     C**********           WRITEDL3180F1               63          S01166 S01117
     C                     WRITETM3180F1               63                 S01117
     C*                                                                   S01166
     C*   CLEAR THE SUBFILE BY SETTING OFF THE SUBFILE DISPLAY            S01166
     C*   AND SUBFILE CONTROL INDICATORS, THEN WRITE ENQUIRY              S01166
     C*   SUBFILE CONTROL FORMAT                                          S01166
     C*                                                                   S01166
     C                     MOVE '0'       *IN35                           S01166
     C                     MOVE '0'       *IN36                           S01166
     C**********           WRITEDL3180C1               63          S01166 S01117
     C                     WRITETM3180C1               63                 S01117
     C*                                                                   S01166
     C*  SET UP PROMPTS                                                   S01166
     C                     MOVE @STCCY    @SRCCY                          S01166
     C                     MOVE @STMTH    @SRMTH                          S01166
     C                     MOVE @STYR     @SRYR                           S01166
     C                     MOVE @SRCCY    @SCCY                           S01166
     C*                                                                   S01166
     C*  IF PARAMETERS BLANK,WRITE THE PROMPT SCREEN BY SETTING           S01166
     C*  ON THE SUBFILE DISPLAY CONTROL INDICATOR                         S01166
     C           @STRNG    IFEQ *BLANKS                                   S01166
     C                     MOVE '1'       *IN36                           S01166
     C**********           EXFMTDL3180C1               63          S01166 S01117
     C                     EXFMTTM3180C1               63                 S01117
     C                     ELSE                                           S01166
     C                     MOVE @STDNO    @CPDNO                          S01166
     C**********           MOVE *BLANKS   @STRNG                   S01166 S01280
     C                     END                                            S01166
     C*                                                                   S01166
     C** PROCESS HELP WHILE IT IS REQUESTED AND RE-READ THE SCREEN        S01166
     C*                                                                   S01166
     C**         *IN10     DOWEQ'1'                        B1      S01166 S01199
     C**                   CALL 'SDMENU'                   *1      S01166 S01199
     C**                   MOVE '0'       *IN10            *1      S01166 S01199
     C**                   READ DL3180C1               0573*1      S01166 S01199
     C**                   END                             E1      S01166 S01199
     C**  DEFINE, READ AND INITIALIZE THE DATA AREA AMENQ1AA
     C*          *NAMVAR   DEFN AMENQ1AA  @AMENQ                          S01166
     C*          *LOCK     IN   @AMENQ                                    S01166
     C*                    MOVE *BLANKS   @AMENQ                          S01166
     C*                                                                   S01149
     C**  SET UP "(000'S)" HEADING                                        S01149
     C*                    MOVE '(000''s)'@THOU                           S01166
     C*
     C**  INITIALIZE 'NO DATES GENERATED FLAG' AND 'NO-RECORDS-IN-
     C**  PERIOD-FLAG'
     C*                    MOVE 'N'       @NODAT  1                       S01166
     C*
     C           #A9       ENDSR
     C*
     C*****************************************************************
      /EJECT
     C*****************************************************************
     C*                                                               *
     C*  #C - THIS ROUTINE PERFORMS FINAL PROCESSING                  *
     C*                                                               *
     C*  CALLED BY :  CONTROL PROCESSING                              *
     C*                                                               *
     C*  CALLS :      CM0020                                          *
     C*                                                               *
     C*  USES :       @AMENQ    -  SCREEN ENQUIRY DATA AREA           *
     C*               @NODAT    -  NO DATES GENERATED FLAG            *
     C*               @ENQ      -  ENQUIRY UPDATED INPUT PARAMETER    *
     C*               @TERM     -  CM0020 PARAMETER                   *
     C*               @EMID     -  CM0020 PARAMETER                   *
     C*               @SWER     -  CM0020 PARAMETER                   *
     C*               @PARM3    -  CM0020 PARAMETER                   *
     C*               @PARM4    -  CM0020 PARAMETER                   *
     C*               @PARM5    -  CM0020 PARAMETER                   *
     C*               @YY       -  ARRAY OF DATE YEARS                *
     C*               @MM       -  ARRAY OF DATE MONTHS               *
     C*               @MTH      -  MONTH SHORTNAME ARRAY              *
     C*               @M        -  MONTH NUMBER CORRESPONDING TO      *
     C*                            @MTH                               *
     C*               @DT       -  ARRAY OF ALPHA DATES OUTPUT TO     *
     C*                            AMENQ1AA                           *
     C*                                                               *
     C*                                                               *
     C*****************************************************************
     C*
     C           #C        BEGSR
     C*
     C**  IF LAST RECORD INDICATOR SET, NO FURTHER PROCESSING
     C*          *INLR     CABEQ'1'       #C8                             S01166
     C           *INLR     CABEQ'1'       #C9                             S01166
     C           *IN01     IFEQ '1'                        B1             S01166
     C                     MOVE 'Q'       @TERM            *1             S01166
     C                     MOVE '1'       *INLR            *1             S01166
     C                     END                             E1             S01166
     C*
     C**  PROCESSING FOR WHEN NO-DATES-GENERATED-FLAG SET
     C**         @NODAT    IFEQ 'Y'                        B1             S01166
     C*
     C**  IF ENQUIRY-UPDATED INPUT PARM IS ONE OF '','R',
     C**  'F' OR 'L' THE PROCESSING IS AS FOLLOWS:
     C**         @ENQ      IFEQ *BLANK                     B*2            S01166
     C**         @ENQ      OREQ 'R'                        **2            S01166
     C**         @ENQ      OREQ 'F'                        **2            S01166
     C**         @ENQ      OREQ 'L'                        **2            S01166
     C**                                                                  S01166
     C**  UPDATE FARKT1 AND FARKB1 ON CA38CPLL TO
     C**  BLANKS.
     C**                   MOVE *BLANKS   FARKT1           **2            S01166
     C**                   MOVE *BLANKS   FARKB1           **2            S01166
     C**                   EXCPT@UPD01                     **2            S01166
     C**                                                                  S01166
     C**  UPDATE AMENQ1AA (SHOULD ONLY CONTAIN HEADER                     S01166
     C**  NARRATIVES)                                                     S01166
     C**                   OUT  @AMENQ                     **2            S01166
     C**                                                                  S01166
     C**  CALL PC FORMAT/TRANSMISSION PROGRAM                             S01166
     C**                   CALL 'CM0020'                   **2            S01166
     C**                   PARM *BLANK    @TERM   1        **2            S01166
     C**                   PARM 'ER'      @EMID   2        **2            S01166
     C**                   PARM '1'       @SWER   1        **2            S01166
     C**                   PARM @ENQ      @PARM2  1        **2            S01166
     C**                   PARM '100'     @PARM3  3        **2            S01166
     C**                   PARM *BLANK    @PARM4  1        **2            S01166
     C**         @TERM     CABEQ'E'       #C8                             S01166
     C**                   END                             E*2            S01166
     C**                                                                  S01166
     C**  IF ENQUIRY-UPDATED INPUT PARM IS ONE OF 'U' OR                  S01166
     C**  'D' THE PROCESSING IS AS FOLLOWS:                               S01166
     C**         @ENQ      IFEQ 'U'                        B*2            S01166
     C**         @ENQ      OREQ 'D'                        **2            S01166
     C**                                                                  S01166
     C**  RELEASE THE CA38CPLL RECORD                                     S01166
     C**                   EXCPT@RLS01                     **2            S01166
     C**                                                                  S01166
     C**  UNLOCK AMENQ1AA                                                 S01166
     C**                   UNLCK@AMENQ                     **2            S01166
     C**                                                                  S01166
     C**  CALL PC FORMAT/TRANSMISSION PROGRAM                             S01166
     C**                   CALL 'CM0020'                   **2            S01166
     C**                   PARM *BLANK    @TERM   1        **2            S01166
     C**                   PARM 'ER'      @EMID            **2            S01166
     C**                   PARM '1'       @SWER            **2            S01166
     C**                   PARM @ENQ      @PARM2           **2            S01166
     C**                   PARM '999'     @PARM3           **2            S01166
     C**                   PARM *BLANK    @PARM4           **2            S01166
     C**         @TERM     CABEQ'E'       #C8                             S01166
     C**                   END                             E*2            S01166
     C**                                                                  S01166
     C**                   GOTO #C8                        *1             S01166
     C**                   END                             E1             S01166
     C**                                                                  S01166
     C**  PROCESSING FOR NORMAL UPDATE OF AMENQ1AA
     C**                                                                  S01166
     C**  UPDATE CA38CPLL                                                 S01166
     C**                   MOVEL@DT,1     FARKT1                          S01166
     C**                   MOVEL@DT,3     FARKB1                          S01166
     C**                   EXCPT@UPD01                                    S01166
     C**                                                                  S01166
     C**  UPDATE AMENQ1AA                                                 S01166
     C**                   OUT  @AMENQ                                    S01166
     C**                                                                  S01166
     C**  CALL PC FORMAT/TRANSMISSION PROGRAM                             S01166
     C**                   CALL 'CM0020'                                  S01166
     C**                   PARM *BLANK    @TERM   1                       S01166
     C**                   PARM 'ER'      @EMID                           S01166
     C**                   PARM '1'       @SWER                           S01166
     C**                   PARM @ENQ      @PARM2                          S01166
     C**                   PARM '100'     @PARM3                          S01166
     C**                   PARM *BLANK    @PARM4                          S01166
     C**                                                                  S01166
     C**         #C8       TAG                              ** #C8 **     S01166
     C           *INU7     IFEQ '1'
     C                     MOVE 'E'       @TERM
     C                     END
     C*
     C**  RETURN TO CALLING PROGRAM
     C                     RETRN
     C*
     C           #C9       ENDSR
     C*
     C*****************************************************************
      /EJECT
     C*****************************************************************   S01194
     C**********                                                      *   S01194
     C********SUBROUTINE ZA0150 - THIS SUBROUTINE CHAINS TO FILE LF/  *   S01194
     C********FDICDRLL TO GET THE INSTALLATION CONTROL DETAILS RECORD *   S01194
     C********1*(HELD ON PF/TABTB10)                                  *   S01194
     C********INDICATOR 80 IS SET ON IF THE CHAIN FAILS OR THE RECORD *   S01194
     C********IS FLAGGED FOR DELETION.                                *   S01194
     C********IF INDICATOR 80 IS SET ON DETAILS OF THE ATTEMPTED      *   S01194
     C********ACCESS ARE PLACED IN THE LDA.                           *   S01194
     C**********                                                      *   S01194
     C********FIELDS USED : SS0150 - KEY USED TO ACCESS FDICDRLL      *   S01194
     C**********                                                      *   S01194
     C*****************************************************************   S01194
     C**********                                                          S01194
     C********** ZA0150    BEGSR                                          S01194
     C**********                                                          S01194
     C***SET*UP*KEY TO OBTAIN FORMAT TABTB10F '01        10'              S01194
     C**********           MOVEL'01'      SS0150 12                       S01194
     C**********           MOVE '10'      SS0150                          S01194
     C**********                                                          S01194
     C***CHAIN*TO FILE FDICDRLL                                           S01194
     C********** SS0150    CHAINFDICDRLL             80                   S01194
     C********** RECI      IFNE 'D'                        B1             S01194
     C**********           MOVE '1'       *IN80            *1             S01194
     C**********           END                             E1             S01194
     C**********                                                          S01194
     C***DEAL*WITH DATA BASE ERROR                                        S01194
     C********** *IN80     IFEQ '1'                        ***************S01194
     C**********           MOVEL'FDICDRLL'DBFILE           *             *S01194
     C**********           MOVEL'900'     DBASE            * DBERROR 900 *S01194
     C**********           MOVELSS0150    DBKEY            *             *S01194
     C**********           END                             ***************S01194
     C**********                                                          S01194
     C********** ZA0159    ENDSR                                          S01194
     C*****************************************************************   S01194
      /EJECT
     C*****************************************************************
     C*                                                               *
     C*       SUBROUTINE ZA0280 - THIS SUBROUTINE READS THE ONLY      *
     C*       RECORD ON LF/FDMNTHLL TO GET MONTH NAMES AND SHORTNAMES.*
     C*       INDICATOR 80 IS SET ON IF THE RECORD IS NOT PRESENT OR  *
     C*       IS FLAGGED FOR DELETION.                                *
     C*       IF INDICATOR IS SET ON INFORMATION ABOUT THE NATURE     *
     C*       OF THE ATTEMPTED FILE ACCESS WILL BE PLACED IN THE LDA. *
     C*                                                               *
     C*       FIELDS USED : SS0280 - KEY USED TO ACCESS FDMNTHLL      *
     C*                                                               *
     C*****************************************************************
     C*
     C           ZA0280    BEGSR
     C*
     C**  READ FIRST RECORD ON FILE LF/FDINSTPP
     C                     Z-ADD1         SS0280  10
     C           SS0280    CHAINFDMNTHLL             80
     C*
     C**  CHECK LOGICAL DELETE FLAG BLANK
     C           MNDLTF    IFNE ' '                        B1
     C                     MOVE '1'       *IN80            *1
     C                     END                             E1
     C*
     C** DEAL WITH DATA BASE ERROR
     C           *IN80     IFEQ '1'                        ***************
     C                     MOVEL'FDMNTHLL'DBFILE           *             *
     C                     MOVE *BLANKS   DBKEY            * DBERROR 906 *
     C                     MOVEL'906'     DBASE            *             *
     C                     END                             ***************
     C*
     C           ZA0289    ENDSR
     C*****************************************************************
      /EJECT
     C*****************************************************************
     C*                                                               *
     C* *PSSR - PROGRAM ERROR SUBROUTINE                              *
     C*                                                               *
     C* CALLED BY:   EXECUTES WHENEVER PROGRAM ERROR OCCURS           *
     C*                                                               *
     C* CALLS:                                                        *
     C*                                                               *
     C* USES :  @ERR1  - FLAG TO PREVENT LOOPING IF FURTHER ERRORS    *
     C*                                                               *
     C*****************************************************************
     C*
     C           *PSSR     BEGSR
     C*
     C** SET @ERR1 TO 'Y' TO PREVENT LOOPING IF FURTHER ERRORS
     C           @ERR1     IFNE 'Y'                        B1
     C                     MOVE 'Y'       @ERR1   1        *1
     C                     MOVE '1'       *INU6            *1
     C                     MOVE 'E'       @TERM
     C*                                                    *1
     C** SET UP FIELDS IN LOCAL DATA AREA                  *1
     C                     MOVE '991'     DBASE            *1
     C*                                                    *1
     C** DUMP THE PROGRAM                                  *1
     C                     DUMP                            *1
     C                     END                             E1
     C*
     C** TERMINATE THE PROGRAM
     C                     MOVE '1'       *INLR
     C                     RETRN
     C*
     C                     ENDSR
     C*
     C*****************************************************************
      /EJECT
     C*****************************************************************
     C*                                                               *
     C* INFSR - FILE EXCEPTION/ERROR SUBROUTINE                       *
     C*                                                               *
     C* CALLED BY:   EXECUTES WHENEVER FILE EXCEPTION/ERROR OCCURS    *
     C*                                                               *
     C* CALLS:                                                        *
     C*                                                               *
     C* USES :  @ERR2  - FLAG TO PREVENT LOOPING IF FURTHER ERRORS    *
     C*         @FILE  - FILENAME FOR WHICH EXCEPTION/ERROR           *
     C*                  OCCURRED (POSNS 201-208 OF PSDS)             *
     C*                                                               *
     C*****************************************************************
     C*
     C           INFSR     BEGSR
     C*
     C** SET @ERR2 TO 'Y' TO PREVENT LOOPING IF FURTHER ERRORS
     C           @ERR2     IFNE 'Y'                        B1
     C                     MOVE 'Y'       @ERR2   1        *1
     C                     MOVE '1'       *INU7            *1
     C                     MOVE '1'       *INU8            *1
     C                     MOVE 'E'       @TERM
     C*                                                    *1
     C** SET UP FIELDS IN LOCAL DATA AREA                  *1
     C                     MOVEL@FILE     DBFILE           *1
     C                     MOVE '992'     DBASE            *1
     C*                                                    *1
     C** DUMP THE PROGRAM                                  *1
     C                     DUMP                            *1
     C                     END                             E1
     C*
     C** TERMINATE THE PROGRAM
     C                     MOVE '1'       *INLR
     C                     RETRN
     C*
     C                     ENDSR
     C*
     C*****************************************************************
      /EJECT
**  @PWR - ARRAY OF POWERS OF 10                                          S01166
0000000010                                                                S01166
0000000100                                                                S01166
0000001000                                                                S01166
0000010000                                                                S01166
0000100000                                                                S01166
0001000000                                                                S01166
0010000000                                                                S01166
0100000000                                                                S01166
1000000000                                                                S01166
** @OVR  CL COMMAND FOR CALL TO QCMDEXC                             S01166E20774
OVRDSPF FILE(TM3180DD) WAITRCD(    )                                      S01166
** @DD - DAYS IN A MONTH                                                  S01166
312831303130313130313031                                                  S01166
** CPY@ - COPYRIGHT STATEMENT                                             S01117
(c) Misys International Banking Systems Ltd. 2001
