     H        1
      *****************************************************************
/*STD *  RPGBASE                                                      *
/*EXI *  TEXT('Midas TM Money market - daily deals')                  *
     F*****************************************************************
     F*                                                               *
     F*                                                               *
     F*  Midas - Treasury Management Module
     F*                                                               *
     F*  TM3200 - MONEY MARKET  - DAILY DEALS                         *
     F*           (FORMERLY DL3200)                                   *
     F*                                                               *
     F*  Function: This enquiry shows deals which have principal      *
     F*  (I/C)     movements on any day forward including today.      *
     F*                                                               *
     F*  Called by: TMC0311 - TM Enquiry control                      *
     F*        via: DL3100  - Treasury management controller          *
     F*                                                               *
     F*  Calls    : ZA0250  - Clear program message queue.            *
     F*           : ZA0240  - Display program message queue.          *
     F*           : ZA0270  - Convert date to Midas day number.       *
     F*                                                               *
     F*  Linked enquiries: TM3180 - MM Monthly summary                *
     F*                    TM3190 - MM Daily summary                  *
     F*                    DL0170 - MM Deal details                   *
     F*                                                               *
      *  (c) Finastra International Limited 2001                      *
     F*                                                               *
      *  Last Amend No. MD058285           Date 22Jun21               *
      *  Prev Amend No. MD046248           Date 27Oct17               *
      *                 CGL165             Date 15Feb17               *
      *                 CDL096             Date 22Sep14               *
      *                 CDL094             Date 11Jun14               *
      *                 CLE134             Date 01Aug12               *
      *                 CLE148             Date 23Jul12               *
      * Bank Fusion Midas 1.4 Base -----------------------------------*
      * Midas Plus 1.4 Base 04 ---------------------------------------*
      * Midas Plus 1.4 Base ------------------------------------------*
      * Midas Plus 1.3 ----------- Base ------------------------------*
      *                 CSD031             Date 10Apr06               *
      *                 CDL049             Date 11May06               *
      *                 CSD027             Date 09Dec05               *
      *                 CLE042             Date 06Sep05               *
      *                 CDL038             Date 10May05               *
      *                 CSW037A            Date 02May05               *
      *                 CDL028             Date 07Feb05               *
      *                 CSD025             Date 11Jan05               *
      *                 CSW037             Date 15Dec04               *
      *                 CSW036             Date 15Dec04               *
      *                 CLE025             Date 20Oct03               *
      *                 CDL020             Date 03Feb04               *
      *                 CDL019             Date 03Feb04               *
      *                 CDL018             Date 03Feb04               *
      *                 CDL017             Date 03Feb04               *
      *                 CDL016             Date 03Feb04               *
      *                 TDA035             Date 02Apr04               *
      *                 CGL029             Date 01Sep03               *
      *                 222727             Date 05Nov03               *
      *                 CDL010             Date 02Aug02               *
      * Midas Release 4 --------------- Base -------------------------*
      * Midas DBA 3.05 -----------------------------------------------*
      *                 CLE011             Date 07Nov00               *
      * Midas DBA 3.00 ---------------- Base -------------------------*
      *                 093466             Date 31Oct95               *
      *                 048215             Date 20Sep93               *
     F*                 S01378             DATE 30APR92               *
     F*                 S01393             DATE 22SEP92               *
     F*                 E26595             DATE 06SEP91               *
     F*                 S01319             DATE 14AUG91               *
     F*                 E21020             DATE 06AUG90               *   E21656
     F*                 S01280             DATE 13NOV90               *   S01280
     F*                 S01117             DATE 01NOV90               *
     F*                 S01194             DATE 01NOV90               *
     F*                 E21656             DATE 26APR90               *   E21656
     F*                 E20774             DATE 15MAR90               *   E21656
     F*                 S01199             DATE 27FEB90               *   E21656
     F*                 E20208             DATE 10NOV89               *   S01199
     F*                 E19989             DATE 10NOV89               *   S01199
     F*                 E20004             DATE 10NOV89               *
     F*                 E20178             DATE 10NOV89               *
     F*                 E17654             DATE 05/04/89              *
     F*                 E90090             DATE 17/01/89              *
     F*                 S01166             DATE 08/06/88              *
     F*                 S01149             DATE 22/01/88              *
     F*                 S01145             DATE 15/12/87              *
     F*                                                               *
     F*                                                               *
     F*****************************************************************
     F*                                                               *
      *  MD058285 - Change base rate code to alphanumeric (Recompile) *
      *  MD046248 - Finastra Rebranding                               *
      *  CGL165 - Dual Withholding Tax (Recompile)                    *
      *  CDL096 - Business Day Conventions on MM Deals                *
      *           (Recompile)                                         *
      *  CDL094 - Enhance  Receive Settlement Instructions            *
      *           (Recompiled)                                        *
      *  CLE134 - Past Due Call Loan Processing (Recompile)           *
      *  CLE148 - Alpha Loan Reference                                *
      *  CSD031 - Enhanced Centralised Static Data (Recompile)        *
      *  CDL049 - Addition of a Reference Rate field (recompile)      *
      *  CSD027 - Conversion Of Customer Number to Alpha              *
      *  CLE042 - Extended Loan Sub Type (Recompile)                  *
      *  CDL038 - Extended Deal Sub Type (Recompile)                  *
      *  CSW037A- Additional Field extended to 40 chars (recompile)   *
      *  CDL028 - Automatic Rate Interpolations (Recompile)           *
      *  CSD025 - Customer De-Activation                              *
      *  CSW037 - Additional Field Data on MT300/MT320                *
      *  CSW036 - Dual SWIFT BIC held on Client Details               *
      *  CLE025 - Credit Lines (Recompile)                            *
      *  CDL020 - Apply Base Rate at Value Date (Recompile)           *
      *  CDL019 - Allow Base Rate Changes on Fixed Deposits/Loans     *
      *           (Recompile)                                         *
      *  CDL018 - Multiple Settlement Accounts on Loans/Deposits      *
      *           (Recompile)                                         *
      *  CDL017 - Penalty Fee & Early Maturity of Fixed Term Loan/Dep *
      *           (Recompile)                                         *
      *  CDL016 - Automatic rollover of Fixed Term Loans/Deposits     *
      *           (Recompile)                                         *
      *  TDA035 - RTS Signon changes for MidasPlus. (Recompile)       *
      *  CGL029 - Increase Account Code to 10 digits                  *
      *  222727 - Release 5.0 errors  (Recompile)                     *
      *  CDL010 - Prevent last user that actioned the trade from      *
      *           authorising it.Recompile due to changes in MMDELDPP,*
      *           MMDENBPP and MMDENSPP.                              *
      *  CLE011 - Rate Fixing Days for Lending Rollover Processing    *
      *           Recompile                                           *
     F*  093466 - When enquiring on deal details, pressing F12 key    *
     F*           twice caused error message CPF4737 to be displayed  *
     F*           due to successive writes of same record format.     *
     F*  048215 - CMD 12 on Daily deals enquiry causes TM3100         *
     F*           to loop.                                            *
     F*  S01378 - Facilitates the partial sale of a parcel            *
     F*           of negotiable instruments which have been           *
     F*           previously input to the system as a single          *
     F*           transaction. When NAB is entered the parcel         *
     F*           size defines the number of parcels it may be        *
     F*           split into for selling. On the NAS the parcel       *
     F*           size defines the number of parcels being sold       *
     F*           by the transaction. (was MOF53). Must ensure        *
     F*           remaining amount of NA at maturity excludes         *
     F*           the sold portions.                                  *
     F*  S01393 - Recompiled for SRM                                  *
     F*  E26595 - S01280 uses @OPT in position 17 to 19 in @PRAM      *
     F*           in DL3100 which is already used by the FRA/IRS      *
     F*           enquiry programs. Change to position 50 onwards     *
     F*           in @PRMPT.                                          *
     F*                                                               *
     F*  S01319 - Remove redundant processing                         *
     F*                                                               *
     F*  S01280 - Include FRA,IRS,FUTURES and CUSTOMER LENDING        *
     F*                                                               *
     F*  E21020 - THE AMOUNTS ON THE ARBITRAGE DEALS ARE              *
     F*           SHOWN THE WRONG WAY ROUND. I.E +VE INSTEAD -VE.     *
     F*                                                               *
     F*  S01117 - NEW COPYRIGHT STATEMENT                             *   S01117
     F*           DEALING PROGRAMS USED ONLY IN TREASURY MGMT.        *   S01117
     F*           MODULE NOW PREFIXED WITH 'TM'                       *   S01117
     F*                                                               *
     F*  S01194 - NEW STANDING DATA PROCESSING                        *   S01194
     F*                                                               *
     F*  E21656 - ALLOW ENQUIRIES ON HOLIDAYS                         *   E21656
     F*                                                               *   E21656
     F*  E20774 - REPLACE QCAEXEC WITH QCMDEXC                        *   E20774
     F*                                                               *
     F*  S01199 - HELP SYSTEM                                         *   S01199
     F*                                                               *   S01199
     F*  E20208 - TO SEND 'NO RECORDS' MESSAGE TO SCREEN              *
     F*                                                               *
     F*  E19989 - HKTYPE SHOULD BE RENAME OF DRS DEALTYPE             *
     F*                                                               *
     F*  E20004 - TO PRINT SECOND LEG DETAILS FOR SECOND  LEG         *
     F*                                                               *
     F*  E20178 - TO PRINT SECOND LEG PRINCIPAL FOR SECOND LEG        *   E20178
     F*                                                               *   E20178
     F*  E17654 - GET SHORTNAMES FROM CLINT                           *
     F*                                                               *
     F*  E90090 - WHEN F3 IS TAKEN TO EXIT PROGRAM WITH NO DETAILS    *
     F*           ENTERED IN PROMPTS FIELD IT HAS NO EFFECT           *
     F*                                                               *
     F*  LAST AMEND NO. S01166    DATE   08/06/88                     *
     F*  Changed from MM0090                                          *
     F*                                                               *
     F*  LAST AMEND NO. S01149    DATE   22/01/88                     *   S01149
     F*  Allow for N/A's to be read and for output to                 *   S01149
     F*  display N/A's, L/D's or both if requested                    *   S01149
     F*                                                               *
     F*  LAST AMEND NO. S01145    DATE   15/12/87                     *   S01145
     F*  Displays Arbitrage deals                                     *   S01145
     F*                                                               *
     F/EJECT
     F*****************************************************************
     F*
     F* ID F  C  H  L    FUNCTION OF INDICATORS
     F*
     F******* 01         RECORD IDENTIFIER  -  KEYED ON FIRST CCY  S01145 SO1166
     F*       01         EXIT PROGRAM                                     S01280
     F*       02         F/12 SUMMARY                                     S01280
     F*       03         SELECTION INDICATOR                              S01280
     F*       05         REFRESH                                          S01280
     F*       11         RECORD IDENTIFIER  -  KEYED ON FIRST CCY         SO1166
     F*       25         ROLLUP                                           S01280
     F*       26         ROLLDOWN                                         S01280
     F*       27         INHIBIT ROLL/REFRESH/SELECT KEYS                 S01280
     F*       30         ACTIVATE SUBFILE END                             S01280
     F*       35         ACTIVATE SUBFILE DISPLAY                         S01280
     F*       36         ACTIVATE SUBFILE DISPLAY CONTROL                 S01280
     F*       41         LENDING INSTALLED                                S01280
     F*       42         FRA/IRS INSTALLED                                S01280
     F*       43         FUTURES INSTALLED                                S01280
     F*       60         SUCCESSFUL LOKUP OF @MT
     F*       61         RECORDS HAVE BEEN PROCESSED FOR THIS ENQUIRE
     F*       65         CURRENCY FOUND ON FDCCYTLL                       S01280
     F*       66         INVALID DATE                                     S01280
     F*       70         NO MORE RECORDS ON ROLL-UP OR ROLL-DOWN.
     F*       76         READ/CHAIN FAIL
     F*       77         NEGATIVE RATE
     F*       78         NO RECORD ON 1ST READ FOR 'ALL' REQUEST          S01149
     F*       83         LENDING RECORD ON MMFWDDLL                       S01280
     F*       84         FRA RECORD ON MMFWDDLL                           S01280
     F*       85         IRS RECORD ON MMFWDDLL                           S01280
     F*       86         FUTURES RECORD ON MMFWDDLL                       S01280
     F*       89         DATE NUMERIC              -                      S01280
     F*
     F*       U6         PROGRAM ERROR
     F*       U7         DATA BASE OR EXCEPTION ERROR
     F*       U8         DATA BASE OR EXCEPTION ERROR
     F*
     F*****************************************************************
     F/EJECT
     F***FDICDRLLIF**E*          K        DISK         KINFSR INFSR   UC  S01194
     F**********  TABTB11F                          KIGNORE               S01194
     F**********  TABTB20F                          KIGNORE               S01194
     FFDMNTHLLIF  E                    DISK         KINFSR INFSR      UC
     F*FDINSTLLIF**E*******************DISK*********KINFSR*INFSR******UC**S01319
     F***FDCCYTLLIF**E*          K        DISK         KINFSR INFSR   UC  S01194
     F**38CPLLUF  E                    DISK         KINFSR INFSR      UC  S01166
     FMMFWDDLLIF  E           K        DISK         KINFSR INFSR      UC
     F*MMDVMALLIF E           K        DISK         KINFSR INFSR      UC  S01145
     FCADVMALLIF  E           K        DISK         KINFSR INFSR      UC  S01145
     F                                              KINFDS INFDB          S01280
     FDLCLONLLIF  E           K        DISK         KINFSR INFSR      UC  S01280
     FDLDLFRLLIF  E           K        DISK         KINFSR INFSR      UC  S01280
     F                                              KINFDS INFDU          S01280
     FDLDLIRLLIF  E           K        DISK         KINFSR INFSR      UC  S01280
     F                                              KINFDS INFDA          S01280
     FDLFUTSLLIF  E           K        DISK         KINFSR INFSR      UC  S01280
     FDLMMTOLLIF  E                    DISK         KINFSR INFSR      UC  S01280
     F***CLINT   IF  E           K        DISK  KINFSR INFSR   UC  S01145 S01194
     F***DL3200DDCF**E*                   WORKSTN              UC  SO1166 S01117
     F**********                              RRN   KSFILE DL3200S1SO1166 S01117
     F**********                                    KNUM        1  SO1166 S01117
     FTM3200DDCF  E                    WORKSTN                        UC  S01117
     F                                        RRN   KSFILE TM3200S1       S01117
     F                                              KNUM        1         S01117
     F*FDUSSILLIF**E*********K********DISK*********KINFSR*INFSRUC***S01166S01319
     FMUSER   IF  E           K        DISK         KINFSR INFSR      UC  S01319
     F*DTABJLLIF  E***********K********DISK*********KINFSR INFSR      UC  E21656
      /EJECT
      *
      **  Array of MMDVMALL information.
     E                    @AM        11 52
      *
      **  Array for display amount (SIGNED)(S.R. MM1016)
     E                    @A         13  1  A
      *
      **  Array to hold output rate.
     E*******             @B          8  1                                SO1166
     E                    @B         12  1                                SO1166
      *
      **  Array for amount input.   (S.R. MM1015)
     E                    @D         15  1
      *
      **  Array for display amount. (S.R. MM1015)
     E                    @J         12  1
      *
      **  Month shortnames. (S.R. ZA0720)
     E                    @MT        12  3
      **  Array to hold loan types (for display).                         S01280
     E                    @C          6  4                                S01280
      *
      ****Array*to*set*up*parameter*for*call*to*QCAEXEC             SO1166E20774
      **  Array to set up parameter for call to QCMDEXC                   E20774
     E                    @OVR    1   1 36                                SO1166
     E*                                                                   S01280
     E                    @YD     4   4  5 0A                             S01280
     E**  Array for SR. ZA0710 - Cumulative days in year for 4 year periodS01280
     E*                                                                   S01280
     E                    @MD    13  13  5 0A                             S01280
     E**  Array for SR. ZA0710 - Cumulative days in year per month.       S01280
     E*                                                                   S01280
     E*                                                                   SO1166
     E**  USED BY SR. ZA0830 - CURRENCY RECORDS                           SO1166
     E******************* @CY        50  3                         S01166 E21656
      *                                                                   SO1166
     E                    CPY@    1   1 80                                S01117
     E* Copyright array                                                   S01117
      /EJECT
     I*                                                                   S01280
     IMMDEVMP0                                                            S01280
     I              HKMTYP                          MIDTYP                S01280
     I*                                                                   S01280
     IMMDEVMP1                                                            S01280
     I              HKMTYP                          MIDTYP                S01280
     I**DEALP0    01                                               S01149 SO1166
     IABDEALP0    11                                                      SO1166
     I** Input specs for Arbitrage formats rename some fields to  **      S01145
     I** match the fx format names to allow for identical         **      S01145
     I** processing                                               **      S01145
     I*                                                                   S01145
     I              JPFD38                          HKDN38                S01145
     I              JPNDYY                          HKVDYY                S01145
     I              JPNDMM                          HKVDMM                S01145
     I              JPNDDD                          HKVDDD                S01145
     I              JPFDYY                          HKMDYY                S01145
     I              JPFDMM                          HKMDMM                S01145
     I              JPFDDD                          HKMDDD                S01145
     I              JPMDTY                          HKTYPE                S01145
     I              JPDFCY                          HKCCY                 S01145
     I**DEALP1*******                                                     E20178
     IABDEALP1    12                                                      E20178
     I              JPFD38                          HKDN38                S01145
     I              JPNDYY                          HKVDYY                S01145
     I              JPNDMM                          HKVDMM                S01145
     I              JPNDDD                          HKVDDD                S01145
     I              JPFDYY                          HKMDYY                S01145
     I              JPFDMM                          HKMDMM                S01145
     I              JPFDDD                          HKMDDD                S01145
     I              JPMDTY                          HKTYPE                S01145
     I              JPDSCY                          HKCCY                 S01145
     I**DEALP2    01                                                      SO1166
     I**DEALP2****11                                            SO1166    E20178
     IABDEALP2    13                                                      E20178
     I**************JPFD38                          HKDN38      S01145    E20004
     I              JPSD38                          HKDN38                E20004
     I              JPNDYY                          HKVDYY                S01145
     I              JPNDMM                          HKVDMM                S01145
     I              JPNDDD                          HKVDDD                S01145
     I              JPFDYY                          HKMDYY                S01145
     I              JPFDMM                          HKMDMM                S01145
     I              JPFDDD                          HKMDDD                S01145
     I**************JPMDTY                          KTYPE       S01145    E20004
     I              JPMDTY                          HKTYPE                E20004
     I              JPDFCY                          HKCCY                 S01145
     I**DEALP3******                                                      E20178
     IABDEALP3    14                                                      E20178
     I**************JPFD38                          HKDN38      S01145    E20004
     I              JPSD38                          HKDN38                E20004
     I              JPNDYY                          HKVDYY                S01145
     I              JPNDMM                          HKVDMM                S01145
     I              JPNDDD                          HKVDDD                S01145
     I              JPFDYY                          HKMDYY                S01145
     I              JPFDMM                          HKMDMM                S01145
     I              JPFDDD                          HKMDDD                S01145
     I              JPMDTY                          HKTYPE                S01145
     I              JPDSCY                          HKCCY                 S01145
     I**DENSP0    01                                               S01149 SO1166
     I**DENSP0****11                                            S01166    E20178
     IMMDENSP0                                                            E20178
     I** Input specs for N/A formats rename some fields to        **      S01149
     I** match the fx format names to allow for identical         **      S01149
     I** processing                                               **      S01149
     I*                                                                   S01149
     I              HMDN38                          HKDN38                S01149
     I              HMVDYY                          HKVDYY                S01149
     I              HMVDMM                          HKVDMM                S01149
     I              HMVDDD                          HKVDDD                S01149
     I              HMMDYY                          HKMDYY                S01149
     I              HMMDMM                          HKMDMM                S01149
     I              HMMDDD                          HKMDDD                S01149
     I**************HMMTYP                          HKTYPE      S01149    E19989
     I              HMTYPE                          HKTYPE                E19989
     I              HMCCY                           HKCCY                 S01149
     I              HMAMNP                          HKAMNP                S01149
     I              HMINTR                          HKINTR                S01149
     I              HMRBSI                          HKRBSI                S01149
     I              HMCSNM                          HKCSNM                S01149
     I              HMCNUM                          HKCNUM                E17654
     I              HMMTYP                          MIDTYP                S01280
     I**DENBP0    01                                               S01149 SO1166
     I**DENBP0    11                                            SO1166    E20178
     IMMDENBP0                                                            E20178
     I              HLDN38                          HKDN38                S01149
     I              HLVDYY                          HKVDYY                S01149
     I              HLVDMM                          HKVDMM                S01149
     I              HLVDDD                          HKVDDD                S01149
     I              HLMDYY                          HKMDYY                S01149
     I              HLMDMM                          HKMDMM                S01149
     I              HLMDDD                          HKMDDD                S01149
     I**************HLMTYP                          HKTYPE      S01149    E19989
     I              HLTYPE                          HKTYPE                E19989
     I              HLCCY                           HKCCY                 S01149
     I              HLAMNP                          HKAMNP                S01149
     I              HLINTR                          HKINTR                S01149
     I              HLRBSI                          HKRBSI                S01149
     I              HLCSNM                          HKCSNM                S01149
     I              HLCNUM                          HKCNUM                E17654
     I              HLMTYP                          MIDTYP                S01280
     I**DENBP1    01                                               S01149 SO1166
     I**DENBP1    11                                            S01166    E20178
     IMMDENBP1                                                            E20178
     I              HLDN38                          HKDN38                S01149
     I              HLVDYY                          HKVDYY                S01149
     I              HLVDMM                          HKVDMM                S01149
     I              HLVDDD                          HKVDDD                S01149
     I              HLMDYY                          HKMDYY                S01149
     I              HLMDMM                          HKMDMM                S01149
     I              HLMDDD                          HKMDDD                S01149
     I**************HLMTYP                          HKTYPE      S01149    E19989
     I              HLTYPE                          HKTYPE                E19989
     I              HLCCY                           HKCCY                 S01149
     I              HLAMNP                          HKAMNP                S01149
     I              HLINTR                          HKINTR                S01149
     I              HLRBSI                          HKRBSI                S01149
     I              HLCSNM                          HKCSNM                S01149
     I              HLCNUM                          HKCNUM                E17654
     I              HLMTYP                          MIDTYP                S01280
      *
     IDLCLONF0                                                            S01280
     I              CCY                             HKCCY                 S01280
     I**********    LNRF                            HKDN38                             S01280 CLE148
     I              LNRF                            HKLNRF                                    CLE148
     I              CNUM                            LENUM                 S01280
      *                                                                   S01280
     IDLCLONF1                                                            S01280
     I              CCY                             HKCCY                 S01280
     I**********    LNRF                            HKDN38                             S01280 CLE148
     I              LNRF                            HKLNRF                                    CLE148
     I              CNUM                            LENUM                 S01280
      *                                                                   S01280
     IDLDLFRF1                                                            S01280
     I              DLNO                            HKDN38                S01280
     I              CNUM                            FINUM                 S01280
     I              DTYP                            HKTYPE                S01280
     I              UCUCY                           HKCCY                 S01280
      *                                                                   S01280
     IDLDLFRF2                                                            S01280
     I              DLNO                            HKDN38                S01280
     I              CNUM                            FINUM                 S01280
     I              DTYP                            HKTYPE                S01280
     I              UCUCY                           HKCCY                 S01280
      *                                                                   S01280
     IDLDLIRF1                                                            S01280
     I              DLNO                            HKDN38                S01280
     I              CNUM                            FINUM                 S01280
     I              DTYP                            HKTYPE                S01280
     I              UCUCY                           HKCCY                 S01280
      *                                                                   S01280
     IDLDLIRF2                                                            S01280
     I              DLNO                            HKDN38                S01280
     I              CNUM                            FINUM                 S01280
     I              DTYP                            HKTYPE                S01280
     I              TCUCY                           HKCCY                 S01280
      *                                                                   S01280
     IDLFUTSP1                                                            S01280
     I              TNBR                            HKDN38                S01280
     I              ISCY                            HKCCY                 S01280
      *                                                                   S01280
     IDLFUTSP2                                                            S01280
     I              TNBR                            HKDN38                S01280
     I              ISCY                            HKCCY                 S01280
      *                                                                   S01280
     IFDMNTHP0                                                            SO1166
     I              MNNM1                           @MT,1                 SO1166
     I              MNNM2                           @MT,2                 SO1166
     I              MNNM3                           @MT,3                 SO1166
     I              MNNM4                           @MT,4                 SO1166
     I              MNNM5                           @MT,5                 SO1166
     I              MNNM6                           @MT,6                 SO1166
     I              MNNM7                           @MT,7                 SO1166
     I              MNNM8                           @MT,8                 SO1166
     I              MNNM9                           @MT,9                 SO1166
     I              MNNM10                          @MT,10                SO1166
     I              MNNM11                          @MT,11                SO1166
     I              MNNM12                          @MT,12                SO1166
     I*                                                                   SO1166
      ** Data structure for data area AMENQ1AA.
     I@AMENQ      DS                            728
     I                                       30  36 @DATE
     I                                       40  42 @FCCY
     I**********                             53  55 @DTYP          S01149 S01280
     I                                       53  76 @DTYP                 S01280
     I                                       99 103 @STEND
     I                                      105 676 @AM
     I                                      718 728 @NET
      *
      ****Data*structure*which*holds*MMDVMALL*information.**
      **  Data structure which holds CADVMALL information.                S01145
     I*DETLS      DS                             52                       SO1166
     I*******                                 2   70HKDN38
     I*******                                 1   60HKDN38                SO1166
     I*******                                 9  18 HKCSNM                SO1166
     I*******                                20  26 @MVDAT                SO1166
     I*******                                28  36 @INTRT                SO1166
     I*******                                38  39 HKTYPE                SO1166
     I*******                                38  39 @HKTYP         S01149 SO1166
     I*******                                40  40 HKRBSI                SO1166
     I*******                                42  52 @PRAMT                SO1166
      *
     I@DETLS      DS                             55                       SO1166
     I                                        1   60HKDN38                SO1166
     I                                        1   6 HKLNRF                                    CLE148
     I                                        9  18 HKCSNM                SO1166
     I                                       20  26 @MVDAT                SO1166
     I                                       28  39 @INTRT                SO1166
     I                                       41  42 HKTYPE                SO1166
     I                                       41  42 @HKTYP                SO1166
     I                                       43  43 HKRBSI                SO1166
     I                                       45  55 @PRAMT                SO1166
      *
      **  Data structure to concatenate dates.
     I            DS
      **  Value date.
     I                                        1   80@VDATE
     I                                        1   40HKVDYY
     I                                        5   60HKVDMM
     I                                        7   80HKVDDD
      **  Maturity date.
     I                                        9  160@MDATE
     I                                        9  120HKMDYY
     I                                       13  140HKMDMM
     I                                       15  160HKMDDD
      **  Requested date. (Converted from FAEPT1)
     I                                       17  240@RDATE
     I                                       17  200@HKCY
     I                                       21  220@HKMM
     I                                       23  240@HKDD
      *
      **  Data structure to subdivide input parameter @RRFSH.
     I*RRFSH      DS
     I@RRFSH      DS                             24
     I                                        1   40@HKCY1
     I                                        5   60@HKMM1
     I                                        7   80@HKDD1
     I                                        9  140@HKDNO
     I                                    P  15  220@HKAMN
      *                                                                   S01280
      **  Data structure to contain full key for DLCLONLL.                S01280
     I@SRFSH      DS                             22                       S01280
     I                                    P   1   30@LMDAT                S01280
     I                                    P   4   60@LVDAT                S01280
     I                                    P   7  130@LAMT                 S01280
     I**********                             14  190@LELNO                             S01280 CLE148
     I                                       14  19 @LELNO                                    CLE148
     I                                       20  22 @LECCY                S01280
      *                                                                   S01280
      **  Data structure to contain full key for DLDLFRLL.                S01280
     I@TRFSH      DS                             19                       S01280
     I                                    P   1   30@FVDAT                S01280
     I                                    P   4  100@FAMT                 S01280
     I                                       11  160@FDLNO                S01280
     I                                       17  19 @FRCCY                S01280
      **  Data structure to contain full key for DLDLIRLL.                S01280
     I@VRFSH      DS                             19                       S01280
     I                                    P   1   30@IVDAT                S01280
     I                                    P   4  100@IAMT                 S01280
     I                                       11  160@IRDNO                S01280
     I                                       17  19 @IRCCY                S01280
      *                                                                   S01280
      **  Data structure to contain full key for DLFUTSLL.                S01280
     I@URFSH      DS                             12                       S01280
     I                                    P   1   30@FDAT                 S01280
     I                                        4   90@FUDNO                S01280
     I                                       10  12 @FUCCY                S01280
      *
      **  Data structure to subdivide field FAEPT1 on CA38CPLL.
     IFAEPT1      DS
     I                                        2   4 @HKCCY
     I                                        6  12 @FDATE
     I                                        6   7 @FDD
     I                                        8  10 @FMTH
     I                                       11  12 @FYR
     I                                       60  62 @RTYP                 S01149
      *
      **  Data structure to convert @@IAMT decimal field to alpha field
     I@@AMDS      DS                             15
     I                                        1  150@@IAMT
      *
      ** Data structure to convert decimal rate to character.
     I            DS
     I                                        1  138@@RIN
     I                                        1  13 @A
      *
      **  Month shortname data structure.                                 SO1166
     I*MONTH    E DSFDMNTHPP                                              SO1166
     I*                                      24  59 @MT                   SO1166
      *
      **  Date input in YYYYMMDD format. (Used by SR. ZA0720).
     I            DS
     I                                        1   80@@DTIN
     I                                        1   40@@YYYY
     I                                        5   60@@MTH
     I                                        7   80@@DAY
     I*
     I**********  DS                                               SO1166 S01280
     I*                                                                   SO1166
     I**  USED BY SR. ZA0830 - ARRAY DATA STRUCTURE                       SO1166
     I****************                        1 150 @CY            S01166 E21656
     I****************                        1  75 @@CY1          S01166 E21656
     I****************                       76 150 @@CY2          S01166 E21656
      *
      **  Program status data structure.
     IPSDS       SDS
     I                                      201 208 @FILE
     I                                      244 253 @JOB
     I                                      254 263 @USER
      *
     I@PRMPT      DS                            256                       SO1166
     I                                        1   3 DDCCY                 SO1166
     I                                        4  10 DDDMY                 SO1166
     I                                        4   5 @DD                   SO1166
     I                                        6   8 @MMM                  SO1166
     I                                        9  100@YY                   SO1166
     I                                        9  10 @YYC                  SO1166
     I                                       11  16 @TOPDL                SO1166
     I***************                        17  19 DDTYP           SO1166E26595
     I***************                        20  20 @LKNA           S01280E26595
     I***************                        21  21 @LKLD           S01280E26595
     I***************                        22  22 @LKLEN          S01280E26595
     I***************                        23  23 @LKFRA          S01280E26595
     I***************                        24  24 @LKIRS          S01280E26595
     I***************                        25  25 @LKFUT          S01280E26595
     I***************                        26  26 @LKALL          S01280E26595
     I                                       50  52 DDTYP                 E26595
     I                                       53  53 @LKNA                 E26595
     I                                       54  54 @LKLD                 E26595
     I                                       55  55 @LKLEN                E26595
     I                                       56  56 @LKFRA                E26595
     I                                       57  57 @LKIRS                E26595
     I                                       58  58 @LKFUT                E26595
     I                                       59  59 @LKALL                E26595
      *                                                                   SO1166
      ** Data structure for command in array @OVR                         SO1166
     I@OVRID      DS                             36                       SO1166
     I                                       32  350@WAIT                 SO1166
      *                                                                   SO1166
      ** Data structure to set up file key from current prompt            SO1166
     I            DS                                                      SO1166
     I                                        1   60@SRDAT                SO1166
     I                                        1   20@SRDD                 SO1166
     I                                        3   40@SRMM                 SO1166
     I                                        5   60@SRYY                 SO1166
     I            DS                                                      S01280
     I**  Data structure for SR. ZA0710 - field is @@Z71Y                 S01280
     I                                        1   40@@Z71Y                S01280
     I                                        1   10@@SSY1                S01280
     I                                        2   20@@SSY2                S01280
     I                                        3   30@@SSY3                S01280
     I                                        4   40@@SSY4                S01280
     I            DS                                                      S01280
     I**  Data structure for SR. ZA0710 - field is @@VDT                  S01280
     I                                        1   80@@VDT                 S01280
     I                                        1   40@@YR                  S01280
     I                                        5   60@@Z71M                S01280
     I                                        7   80@@Z71D                S01280
     I@LTONT      DS                             23                       S01280
     I**  Data structure for DLMMTOLL title(1).                           S01280
     I                                        1  13 @LTON                 S01280
     I                                       14  15 @BLNK                 S01280
     I                                       16  170@SEC                  S01280
     I                                       18  18 @DASH1                S01280
     I                                       19  200@MIN                  S01280
     I                                       21  21 @DASH2                S01280
     I                                       22  230@HOUR                 S01280
     I@TOIP       DS                             23                       S01280
     I**  Data structure for DLMMTOLL title(2).                           S01280
     I                                        1  13 @TKON                 S01280
     I                                       14  15 @PR                   S01280
     I                                       16  23 @OGR                  S01280
     I            DS                                                      S01280
     I**  Data structure for DLMMTOLL time.                               S01280
     I                                        1   20@@SEC                 S01280
     I                                        3   40@@MIN                 S01280
     I                                        5   60@@HOUR                S01280
     I                                        1   60TOTLTO                S01280
     I*                                                                   S01280
     IINFDU       DS                                                      S01280
     I**  Data structure for record format for DLDLFRLL.                  S01280
     I                                     *RECORD  FILRC1                S01280
     I*                                                                   S01280
     IINFDA       DS                                                      S01280
     I**  Data structure for record format for DLDLIRLL.                  S01280
     I                                     *RECORD  FILRC2                S01280
     I*                                                                   S01280
     IINFDB       DS                                                      S01280
     I**  Data structure for record formats for CADVMALL in order to      S01280
     I**  change DRS deal types to midas deal types.                      S01280
     I                                     *RECORD  CADFMT                S01280
      *                                                                   SO1166
      **  Local data area for database error.
     I           UDS
     I                                      134 141 DBFILE
     I                                      142 170 DBKEY
     I                                      171 180 DBPGM
     I                                      181 183 DBASE
     ISDCURR    E DSSDCURRPD                                              S01194
     I* External DS for Currency Details                                  S01194
     ISDBANK    E DSSDBANKPD                                              S01194
     I* External DS for Bank Details                                      S01194
     ISDMMOD    E DSSDMMODPD                                              S01194
     I* External DS for Module Details                                    S01194
     ISDCUST    E DSSDCUSTPD                                              S01194
     I* External DS for Customer Details                                  S01194
     ISDDEAL    E DSSDDEALPD                                              S01319
     I** EXTERNAL DS FOR DEALING DETAILS                                  S01319
     IDSSDY     E DSDSSDY                                                 S01194
     I* DS used by Access Objects (long records)                          S01194
     IDSFDY     E DSDSFDY                                                 S01194
     I* DS used by Access Objects (short records)                         S01194
     C                     MOVEACPY@      BIS@   80                       S01117
      /EJECT
      *****************************************************************
      *                                                               *
      * CONTROL PROCESSING - THIS ROUTINE CONTROLS THE WHOLE PROGRAM  *
      *                                                               *
      * CALLED BY :                                                   *
      *                                                               *
      * CALLS :      #A                                               *
      *              #B                                               *
      *              #C                                               *
      *                                                               *
      * USES :                                                        *
      *                                                               *
      *****************************************************************
      *
      **  Initial processing.
     C                     EXSR #A
      *
      **  Main processing.
     C           *INLR     DOWEQ'0'                                       SO1166
     C           *INU7     ANDEQ'0'                                       SO1166
      **  Do while not cmd/3 and not cmd/12 and no selection              SO1166
     C           *IN01     DOWEQ'0'                                       SO1166
     C           *IN02     ANDEQ'0'                                       SO1166
     C           *IN03     ANDEQ'0'                                       SO1166
     C                     EXSR #B
     C                     END                                            SO1166
     C                     END                                            SO1166
      *
      **  Final processing.
     C                     EXSR #C
      *
     C           ENDPGM    TAG                             ** ENDPGM **
      *
      *****************************************************************
      /EJECT
      *****************************************************************
      * SUBROUTINES USED                                              *
      * ----------------                                              *
      *                                                               *
      *  1 #B     -   MAIN PROCESSING                                 *
      *  2 ZA0720 -   CONVERT DATE YYYYMMDD TO DDMMMYY/MMMDDYY        *
      *  3 MM1015 -   CONVERT AMOUNT TO DISPLAY -38 (12A)             *
      *  4 MM1016 -   CONVERT AMOUNT TO DISPLAY -38 (13A)             *
      *  5 #ZA    -   CONVERT SHORT RATE TO DISPLAY (MODIFIED ZA0880) *
      *  6 #BA    -   CURRENT PROMPT PROCESSING                       *
      *  7 #BB    -   REFRESH PROCESSING                              *
      *  8 #BC    -   FIRST PAGE PROCESSING                           *
      *  9 #BD    -   LAST PAGE PROCESSING                            *
      * 10 #BE    -   ROLL UP PROCESSING                              *
      * 11 #BF    -   ROLL DOWN PROCESSING                            *
      * 12 #BG    -   READ FILE BACKWARDS                             *
      * 13 #BH    -   READ FILE FORWARDS                              *
      * 14 #A     -   INITIAL PROCESSING                              *
      * 15 #C     -   FINAL PROCESSING                                *
      **16*ZA0150*****READ*FDICDRLL************************************   S01194
      * 17 ZA0280 -   READ FDMNTHLL                                   *
      * 18 *PSSR  -   PROGRAM EXCEPTION/ERROR SUBROUTINE              *
      * 19 INFSR  -   FILE EXCEPTION/ERROR ROUTINE                    *
      * 24 #BHC   -   PROCESS LENDING                                 *   S01280
      * 25 #BHD   -   PROCESS FRA/IRS                                 *   S01280
      * 26 #BHE   -   PROCESS FUTURES                                 *   S01280
      * 27 #ZC    -   RESET ERROR INDICATORS AND CLEAR MESSAGE QUEUES *   S01280
      * 28 #ZE    -   WRITES TO ENQUIRY SUBFILE                       *   S01280
      * 13 #BGA   -   PROCESS N/A DEALS (BACKWARDS)                   *   S01149
      * 14 #BGB   -   SET UP DETAIL LINES TO BE DISPLAYED (BACKWARDS) *   S01149
      * 15 #BH    -   READ FILE FORWARDS                              *   S01149
      * 16 #BHA   -   PROCESS N/A DEALS (FORWARDS)                    *   S01149
      * 17 #BHB   -   SET UP DETAIL LINES TO BE DISPLAYED (FORWARDS)  *   S01149
      * 18 #A     -   INITIAL PROCESSING                              *   S01149
      * 19 #C     -   FINAL PROCESSING                                *   S01149
      **20*ZA0150*****READ*FDICDRLL******************************* S01149 S01194
      * 21 ZA0280 -   READ FDMNTHLL                                   *   S01149
      * 22 *PSSR  -   PROGRAM EXCEPTION/ERROR SUBROUTINE              *   S01149
      * 23 INFSR  -   FILE EXCEPTION/ERROR ROUTINE                    *   S01149
      *                                                               *
      * EXTERNAL ROUTINE                                              *
      * 20 CM0020 -   CONTROL MODULE PC FORMAT/TRANSMISSION PROGRAM   *
      *                                                               *
      *****************************************************************
      /EJECT
      *****************************************************************
      *                                                               *
      *  #B - THIS ROUTINE CONTROLS THE MAIN PROCESSING OF THE        *
      *       PROGRAM.                                                *
      *                                                               *
      *  CALLED BY : CONTROL PROCESSING                               *
      *                                                               *
      *  CALLS :     MM1016                                           *
      *              #BA                                              *
      *              #BC                                              *
      *              #BD                                              *
      *              #BE                                              *
      *              #BF                                              *
      *              #BB                                              *
      *              #BG                                              *
      *              #BH                                              *
      *                                                               *
      *  USES :    @ENQ   - ENQUIRY UPDATED INPUT PARAMETER           *
      *            @FYR   - YEAR FROM FAEPT1 (2N)                     *
      *            @RDATE - REQUESTED DATE FROM FAEPT1 YYYYMMDD       *
      *            @HKCY  - YEAR FROM FAEPT1 (4N)                     *
      *            @HKTYP - REQUESTED DEAL TYPE                       *   S01149
      *            @M     - MONTH INDEX                               *
      *            @FMTH  - MONTH FROM FAEPT1 (3A)                    *
      *            @MT    - ARRAY OF MONTH SHORTNAMES                 *
      *            @HKMM  - MONTH FROM FAEPT1 (2N)                    *
      *            @FDD   - DAY FROM FAEPT1 (2A)                      *
      *            @HKDD  - DAY FROM FAEPT1 (2N)                      *
      *            @HKCCY - CURRENCY FROM FAEPT1                      *
      *            @FCCY  - CURRENCY TO BE DISPLAYED                  *
      *            @@IAMT - INPUT AMOUNT TO S.R. MM1016               *
      *            @@CCY  - INPUT CURRENCY TO S.R. MM1016             *
      *            @@AMOU - OUTPUT AMOUNT FROM S.R. MM1016            *
      *            @NET   - NET MOVEMENT TO BE DISPLAYED              *
      *            @HKKY4 - PARTIAL KEY FOR FILE CADVMALL             *
      *            @HKKY5 - PARTIAL KEY FOR FILE MMFWDDLL             *   S01149
      *            @HKKY8 - FULL KEY FOR FILE CADVMALL                *
      *            @HKCY1 - YEAR FROM ROLL/REFRESH KEY FIELD          *
      *            @HKMM1 - MONTH FROM ROLL/REFRESH KEY FIELD         *
      *            @HKDD1 - DAY FROM ROLL/REFRESH KEY FIELD           *
      *            @HKDNO - DEALER NUMBER FROM ROLL/REFRESH KEY FIELD *
      *            @PREVE - PREVIOUS ENQUIRY TYPE                     *
      *                                                               *
      *****************************************************************
      *
     C           #B        BEGSR
      *
      **  If last record indicator is set, or database error occurred,
      **  no further processing in this routine.
     C           *INLR     CABEQ'1'       #B9
     C           *INU7     CABEQ'1'       #B9
      *
     C**  SET OFF THE SELECTION-PROCESSED INDICATOR                       S01166
     C*                                                                   S01166
     C                     MOVE 'N'       @@SLCT  1        *1             S01166
     C*                                                                   S01166
     C*   CLEAR THE MESSAGE QUEUE OF ANY OLD MESSAGES AND RESET           S01166
     C*   ANY ERROR INDICATORS                                            S01166
     C                     EXSR #ZC                        *1             S01166
     C*                                                                   S01166
      **  If the enquiry updated parameter is ' ', and year (from         SO1166
      **  FAEPT1) is blank, use the last 2 chars of the alpha run         SO1166
      ****date*from*TABTB10****                                    SO1166 S01194
      **  date from SDBANKPD                                              S01194
     C*******    @ENQ      IFEQ ' '                        B1             SO1166
     C*******    @FYR      ANDEQ' '                        X1             SO1166
     C*******              MOVE RUNA      @FYR             *1             SO1166
     C*******              END                             E1             SO1166
      *
      ** Move prompt fields                                               SO1166
     C                     MOVE DDDMY     @FDATE                          SO1166
     C**********           MOVE DDTYP     @RTYP                    SO1166 S01280
     C                     MOVE DDALL     @DALL                           S01280
     C                     MOVE DDNA      @DNA                            S01280
     C                     MOVE DDLD      @DLD                            S01280
     C                     MOVE DDLEN     @DLEN                           S01280
     C                     MOVE DDFRA     @DFRA                           S01280
     C                     MOVE DDIRS     @DIRS                           S01280
     C                     MOVE DDFUT     @DFUT                           S01280
      * Don't set up ccy key here as it may not yet be known              S01194
     C**********           MOVE DDCCY     @HKCCY                   SO1166 S01194
      *                                                                   S01280
      * If 'ALL' selected move Y to each deal type                        S01280
     C           @DALL     IFNE *BLANKS                                   S01280
     C                     MOVE 'Y'       @DNA                            S01280
     C                     MOVE 'Y'       @DLD                            S01280
      * If LENDING installed.                                             S01280
     C           BGCSLN    IFEQ 'Y'                                       S01280
     C                     MOVE 'Y'       @DLEN                           S01280
     C                     END                                            S01280
      * If FRA/IRS installed.                                             S01280
     C           BGFIIN    IFEQ 'Y'                                       S01280
     C                     MOVE 'Y'       @DFRA                           S01280
     C                     MOVE 'Y'       @DIRS                           S01280
     C                     END                                            S01280
      * If FUTURES installed.                                             S01280
     C           BGFUOP    IFEQ 'Y'                                       S01280
     C                     MOVE 'Y'       @DFUT                           S01280
     C                     END                                            S01280
     C                     END                                            S01280
      *                                                                   S01280
      **  Set up '* TAKE ON IN PROGRESS *' or 'LAST TAKE ON xx:xx:xx      S01280
      *                                                                   S01280
     C           1         SETLLDLMMTOLL                                  S01280
     C                     READ DLMMTOLL                 79               S01280
      *                                                                   S01280
     C           TOTOIP    IFEQ 'Y'                                       S01280
     C                     MOVEL'* TAKE ' @TKON                           S01280
     C                     MOVE 'ON IN '  @TKON                           S01280
     C                     MOVE 'PR'      @PR                             S01280
     C                     MOVEL'OGRESS ' @OGR                            S01280
     C                     MOVE '*'       @OGR                            S01280
     C                     MOVE @TOIP     DDSTS                           S01280
     C                     ELSE                                           S01280
     C                     MOVEL' LAST T' @LTON                           S01280
     C                     MOVE 'AKE ON'  @LTON                           S01280
     C                     MOVE *BLANKS   @BLNK                           S01280
     C                     MOVE @@SEC     @SEC                            S01280
     C                     MOVE ':'       @DASH1                          S01280
     C                     MOVE @@MIN     @MIN                            S01280
     C                     MOVE ':'       @DASH2                          S01280
     C                     MOVE @@HOUR    @HOUR                           S01280
     C                     MOVE @LTONT    DDSTS                           S01280
     C                     END                                            S01280
      *                                                                   SO1166
     C           @ENQ      IFEQ ' '                        B1
      **  This is the first processing for this enquire so setoff *in61
     C                     MOVE '0'       *IN61
     C                     END                             E1
      *
      ** Validate currency                                                SO1166
      ** (via access object)                                              S01194
     C**********           MOVEL'20'      @KEY2  12                S01166 S01194
     C**********           MOVE '1'       @ENDKY  4                S01166 S01194
     C**********           MOVELDDCCY     @ENDKY                   S01166 S01194
     C**********           MOVE @ENDKY    @KEY2                    S01166 S01194
     C********** @KEY2     CHAINFDCCYTLL             65            S01166 S01194
      *                                                                   S01194
     C                     CALL 'AOCURRR0'                                S01194
     C                     PARM *BLANKS   @RTCD   7                       S01194
     C                     PARM '*KEY   ' @OPTN   7                       S01194
     C                     PARM           DDCCY   3                       S01194
     C           SDCURR    PARM SDCURR    DSSDY                           S01194
     C*                                                                   S01166
      ** If currency found set up field for dec places                    SO1166
     C********** *IN65     IFNE '1'                                SO1166 S01194
     C           @RTCD     IFEQ *BLANKS                                   S01194
     C**********           Z-ADDCDP       @CDP1   10               SO1166 S01194
     C                     Z-ADDA6NBDP    @CDP1   10                      S01194
      * Set up currency key                                               S01194
     C                     MOVE DDCCY     @HKCCY                          S01194
     C                     ELSE                                           SO1166
     C                     SETON                     69                   SO1166
     C                     MOVE '1'       *IN65                           S01194
     C                     MOVEL'RTM0002' @MSGID                          SO1166
     C                     CALL 'ZA0240'                                  SO1166
     C                     PARM           @MSGID                          SO1166
     C                     END                                            SO1166
      *                                                                   SO1166
      ** Validate Date                                                    SO1166
      ** Lookup Month                                                     SO1166
     C                     Z-ADD1         @M      20                      SO1166
     C           @MMM      LOKUP@MT,@M                   89               SO1166
      *                                                                   SO1166
      ** Check day and year numeric                                       SO1166
     C           *IN89     IFEQ '1'                                       SO1166
     C                     TESTN          @DD        89                   SO1166
     C                     END                                            SO1166
      *                                                                   SO1166
     C           *IN89     IFEQ '1'                                       SO1166
     C                     TESTN          @YYC       89                   SO1166
     C                     END                                            SO1166
      *                                                                   SO1166
      ** If still ok convert to MIDAS date                                SO1166
     C           *IN89     IFEQ '1'                                       SO1166
     C                     MOVE @DD       @SRDD                           SO1166
     C                     Z-ADD@M        @SRMM                           SO1166
     C                     MOVE @YYC      @SRYY                           SO1166
     C                     MOVE @SRDAT    DDMMYY  60                      SO1166
     C                     MOVE 'D'       @DATF   1                       SO1166
      *                                                                   SO1166
     C                     CALL 'ZA0270'                                  SO1166
     C                     PARM           DDMMYY                          SO1166
     C                     PARM           @DATF                           SO1166
     C           @RTCDE    PARM           @RTCDE  1                       SO1166
     C           @@MNO     PARM           @@MNO   50                      SO1166
      *                                                                   SO1166
     C           @RTCDE    IFEQ '1'                                       SO1166
     C                     MOVEL'RTM0003' @MSGID 10                       SO1166
     C                     CALL 'ZA0240'                                  SO1166
     C                     PARM           @MSGID                          SO1166
     C                     MOVE '1'       *IN69                           SO1166
     C                     MOVE '1'       *IN66                           SO1166
      *                                                                   SO1166
     C**********           ELSE                                    S01166 E21656
      **********                                                   S01166 E21656
      ** If currency is found see if date is holiday                      SO1166
     C********** *IN65     IFEQ '0'                                S01166 E21656
     C**********           MOVE DDCCY     @@CCY                    S01166 E21656
     C**********           EXSR ZA0830                             S01166 E21656
      **********                                                   S01166 E21656
     C********** @@HIND    IFEQ 'H'                                S01166 E21656
     C**********           MOVEL'RTM0007' @MSGID                   S01166 E21656
     C**********           CALL 'ZA0240'                           S01166 E21656
     C**********           PARM           @MSGID                   S01166 E21656
     C**********           MOVE '1'       *IN69                    S01166 E21656
     C**********           MOVE '1'       *IN66                    S01166 E21656
     C**********           END                                     S01166 E21656
     C**********           END                                     S01166 E21656
     C                     END                                            SO1166
      *                                                                   SO1166
     C                     ELSE                                           SO1166
      *                                                                   SO1166
     C                     MOVEL'RTM0003' @MSGID                          SO1166
     C                     CALL 'ZA0240'                                  SO1166
     C                     PARM           @MSGID                          SO1166
     C                     MOVE '1'       *IN69                           SO1166
     C                     MOVE '1'       *IN66                           SO1166
     C                     END                                            SO1166
      *                                                                   S01280
      ** If requested date is less than run date, then error              S01280
     C           @@MNO     IFLT BJRDNB                                    S01280
     C                     MOVEL'RTM0005' @MSGID                          S01280
     C                     CALL 'ZA0240'                                  S01280
     C                     PARM           @MSGID                          S01280
     C                     MOVE '1'       *IN69                           S01280
     C                     MOVE '1'       *IN66                           S01280
     C                     END                                            S01280
      *                                                                   SO1166
      ** Validate deal type                                               SO1166
     C********** DDTYP     IFNE *BLANK                             SO1166 S01280
     C********** DDTYP     ANDNE'ALL'                              SO1166 S01280
     C********** DDTYP     ANDNE'N/A'                              SO1166 S01280
     C********** DDTYP     ANDNE'L/D'                              SO1166 S01280
      *                                                                   S01280
      ** If linked enquiry the selection is passed in through parameter   S01280
      ** @PRMPT.Set up deal types selected for linked enquiry.            S01280
     C           @LKNA     IFNE *BLANK                                    S01280
     C           @LKLD     ANDNE*BLANK                                    S01280
     C           @LKLEN    ANDNE*BLANK                                    S01280
     C           @LKFRA    ANDNE*BLANK                                    S01280
     C           @LKIRS    ANDNE*BLANK                                    S01280
     C           @LKFUT    ANDNE*BLANK                                    S01280
     C           @LKALL    ORNE *BLANK                                    S01280
     C                     MOVE 'Y'       DDALL                           S01280
     C                     MOVE 'Y'       @DALL                           S01280
     C                     MOVE *BLANK    @LKALL                          S01280
     C                     ELSE                                           S01280
      *                                                                   S01280
     C           @LKNA     IFNE *BLANK                                    S01280
     C                     MOVE 'Y'       DDNA                            S01280
     C                     MOVE 'Y'       @DNA                            S01280
     C                     MOVE *BLANK    @LKNA                           S01280
     C                     END                                            S01280
      *                                                                   S01280
     C           @LKLD     IFNE *BLANK                                    S01280
     C                     MOVE 'Y'       DDLD                            S01280
     C                     MOVE 'Y'       @DLD                            S01280
     C                     MOVE *BLANK    @LKLD                           S01280
     C                     END                                            S01280
      *                                                                   S01280
     C           @LKLEN    IFNE *BLANK                                    S01280
     C                     MOVE 'Y'       DDLEN                           S01280
     C                     MOVE 'Y'       @DLEN                           S01280
     C                     MOVE *BLANK    @LKLEN                          S01280
     C                     END                                            S01280
      *                                                                   S01280
     C           @LKFRA    IFNE *BLANK                                    S01280
     C                     MOVE 'Y'       DDFRA                           S01280
     C                     MOVE 'Y'       @DFRA                           S01280
     C                     MOVE *BLANK    @LKFRA                          S01280
     C                     END                                            S01280
      *                                                                   S01280
     C           @LKIRS    IFNE *BLANK                                    S01280
     C                     MOVE 'Y'       DDIRS                           S01280
     C                     MOVE 'Y'       @DIRS                           S01280
     C                     MOVE *BLANK    @LKIRS                          S01280
     C                     END                                            S01280
      *                                                                   S01280
     C           @LKFUT    IFNE *BLANK                                    S01280
     C                     MOVE 'Y'       DDFUT                           S01280
     C                     MOVE 'Y'       @DFUT                           S01280
     C                     MOVE *BLANK    @LKFUT                          S01280
     C                     END                                            S01280
     C                     END                                            S01280
      *                                                                   S01280
      *                                                                   S01280
      *  If no deal types selected - select all (subject to module        S01280
      *  installed.                                                       S01280
     C           @DALL     IFEQ *BLANK                                    S01280
     C           @DNA      ANDEQ*BLANK                                    S01280
     C           @DLD      ANDEQ*BLANK                                    S01280
     C           @DLEN     ANDEQ*BLANK                                    S01280
     C           @DFRA     ANDEQ*BLANK                                    S01280
     C           @DIRS     ANDEQ*BLANK                                    S01280
     C           @DFUT     ANDEQ*BLANK                                    S01280
     C           @DALL     ORNE *BLANK                                    S01280
     C                     MOVE 'Y'       @DNA                            S01280
     C                     MOVE 'Y'       @DLD                            S01280
      *                                                                   S01280
     C           BGCSLN    IFEQ 'Y'                                       S01280
     C                     MOVE 'Y'       @DLEN                           S01280
     C                     END                                            S01280
      *                                                                   S01280
     C           BGFIIN    IFEQ 'Y'                                       S01280
     C                     MOVE 'Y'       @DFRA                           S01280
     C                     MOVE 'Y'       @DIRS                           S01280
     C                     END                                            S01280
      *                                                                   S01280
     C           BGFUOP    IFEQ 'Y'                                       S01280
     C                     MOVE 'Y'       @DFUT                           S01280
     C                     END                                            S01280
     C**********           MOVEL'MMM0582' @MSGID                   SO1166 S01280
     C**********           CALL 'ZA0240'                           SO1166 S01280
     C**********           PARM           @MSGID                   SO1166 S01280
     C**********           MOVE '1'       *IN69                    SO1166 S01280
     C**********           MOVE '1'       *IN67                    SO1166 S01280
     C                     END                                            SO1166
      *                                                                   S01280
      ** If 'all' selected blank out all other prompts.                   S01280
     C           @DALL     IFNE *BLANK                                    S01280
     C                     MOVE *BLANK    DDLD                            S01280
     C                     MOVE *BLANK    DDNA                            S01280
     C                     MOVE *BLANK    DDLEN                           S01280
     C                     MOVE *BLANK    DDFRA                           S01280
     C                     MOVE *BLANK    DDIRS                           S01280
     C                     MOVE *BLANK    DDFUT                           S01280
     C                     END                                            S01280
      *                                                                   SO1166
      ** If validation errors found in prompts bypass processing          SO1166
     C           *IN69     IFEQ '1'                                       SO1166
     C                     GOTO #B8                                       SO1166
     C                     END                                            SO1166
      *                                                                   S01280
      * If either L/D or N/A selected.                                    S01280
     C           @DNA      IFNE *BLANK                                    S01280
     C           @DLD      ORNE *BLANK                                    S01280
     C                     MOVE 'Y'       @LDNA   1                       S01280
     C                     END                                            S01280
      *                                                                   S01280
      *  Set up loan types for display.                                   S01280
      *                                                                   S01280
     C                     MOVE *BLANKS   @C                              S01280
     C                     Z-ADD1         @N      10                      S01280
      *                                                                   S01280
      ** If 'ALL' selected and all modules installed.                     S01280
     C           @DALL     IFNE *BLANK                                    S01280
     C           BGCSLN    ANDEQ'Y'                                       S01280
     C           BGFUOP    ANDEQ'Y'                                       S01280
     C           BGFIIN    ANDEQ'Y'                                       S01280
     C                     MOVEA'N/A L/D '@C,1                            S01280
     C                     MOVEA'LEN FRA '@C,3                            S01280
     C                     MOVEA'IRS FUT '@C,5                            S01280
     C                     ELSE                                           S01280
      *                                                                   S01280
     C           @DNA      IFNE *BLANK                                    S01280
     C                     MOVE 'N/A '    @C,@N                           S01280
     C                     ADD  1         @N                              S01280
     C                     END                                            S01280
      *                                                                   S01280
     C           @DLD      IFNE *BLANK                                    S01280
     C                     MOVE 'L/D '    @C,@N                           S01280
     C                     ADD  1         @N                              S01280
     C                     END                                            S01280
      *                                                                   S01280
     C           @DLEN     IFNE *BLANK                                    S01280
     C                     MOVE 'LEN '    @C,@N                           S01280
     C                     ADD  1         @N                              S01280
     C                     END                                            S01280
      *                                                                   S01280
     C           @DFRA     IFNE *BLANK                                    S01280
     C                     MOVE 'FRA '    @C,@N                           S01280
     C                     ADD  1         @N                              S01280
     C                     END                                            S01280
      *                                                                   S01280
     C           @DIRS     IFNE *BLANK                                    S01280
     C                     MOVE 'IRS '    @C,@N                           S01280
     C                     ADD  1         @N                              S01280
     C                     END                                            S01280
      *                                                                   S01280
     C           @DFUT     IFNE *BLANK                                    S01280
     C                     MOVE 'FUT '    @C,@N                           S01280
     C                     ADD  1         @N                              S01280
     C                     END                                            S01280
     C                     END                                            S01280
      *                                                                   S01280
     C                     MOVEA@C,1      @DTYP                           S01280
      *                                                                   S01280
      *                                                                   SO1166
      **  Set up century.
     C                     Z-ADD*ZEROS    @RDATE
     C                     MOVE @FYR      @HKCY
     C           @HKCY     IFGE 72                         B1
     C                     ADD  1900      @HKCY            *1
     C                     ELSE                            X1
     C                     ADD  2000      @HKCY            *1
     C                     END                             E1
      *
      **  Convert month from 3 alpha to 2 numeric.
     C                     Z-ADD1         @M      20
     C           @FMTH     LOKUP@MT,@M                   60
     C                     Z-ADD@M        @HKMM
      *
     C                     MOVE @FDD      @HKDD
      *
      **  Set currency to be displayed.
     C******               MOVE @HKCCY    @FCCY                           S01166
     C                     MOVE DDCCY     @FCCY                           S01166
      *                                                                   S01280
      * With introduction of further deal types retain @RTYP 'all'        S01280
      * where N/A and L/D selected - to save on code changes.             S01280
     C           @DNA      IFNE *BLANK                                    S01280
     C           @DLD      ANDNE*BLANK                                    S01280
     C                     MOVE 'ALL'     @RTYP                           S01280
     C                     END                                            S01280
      *
      **  Set deal type request to be displayed.                          S01149
     C********** @RTYP     IFEQ '   '                      B1      S01149 S01280
     C**********           MOVE 'ALL'     @RTYP            *1      S01149 S01280
     C**********           END                             E1      S01149 S01280
     C**********           MOVE @RTYP     @DTYP                    S01149 S01280
      **********                                                          S01280
      ****If*both*N/A*and*L/D*have*been*requestedread*file*MMFWDDLLS01149 S01280
      ****twice*to*add*set*net*movement*amounts*to*be*displayed.***S01149 S01280
      **  Chain to MMFWDDLL for all deal types selected and add to net    S01280
      **  movements amount to be displayed.                               S01280
      *
     C                     MOVE *BLANKS   @NET
     C********** @RTYP     IFEQ 'ALL'                      B1      S01149 S01280
     C                     MOVE *ZEROS    @@IAMT           *1             S01149
     C           @DLD      IFNE *BLANK                     B1             S01280
     C                     MOVE 'LD'      @HKTYP           *1             S01149
     C           @HKKY5    CHAINMMFWDDLL             78    *1             S01149
     C           *IN78     IFNE '1'                        B2             S01149
     C                     Z-ADDHSDNMT    @@IAMT           *2             S01149
     C                     ADD  HSMAIN    @@IAMT           **2            S01280
     C                     SUB  HSMAOT    @@IAMT           **2            S01280
     C                     END                             E2             S01149
     C                     END                             E1             S01280
     C           @DNA      IFNE *BLANK                     B1             S01280
     C                     MOVE 'NA'      @HKTYP           *1             S01149
     C           @HKKY5    CHAINMMFWDDLL             76    *1             S01149
     C           *IN76     IFNE '1'                        B2             S01149
     C                     ADD  HSDNMT    @@IAMT           *2             S01149
     C                     ADD  HSMAIN    @@IAMT           **2            S01280
     C                     SUB  HSMAOT    @@IAMT           **2            S01280
     C                     END                             E2             S01149
     C                     END                             E1             S01280
      **  Set up key depending on the requested deal type.                S01280
      *                                                                   S01280
     C           @DLEN     IFNE *BLANK                     B1             S01280
     C                     MOVE 'LE'      @HKTYP           *1             S01280
      *                                                                   S01280
      **  Set net movement to be displayed LEN.                           S01280
     C           @HKKY5    CHAINMMFWDDLL             83    *1             S01280
     C           *IN83     IFNE '1'                        B*2            S01280
     C                     ADD  HSDNMT    @@IAMT           **2            S01280
     C                     ADD  HSMAIN    @@IAMT           **2            S01280
     C                     SUB  HSMAOT    @@IAMT           **2            S01280
     C                     END                             E*2            S01280
     C                     END                             E1             S01280
      *                                                                   S01280
     C           @DFRA     IFNE *BLANK                     B1             S01280
     C                     MOVE 'FR'      @HKTYP           *1             S01280
      *                                                                   S01280
      **  Set net movement to be displayed FRA.                           S01280
     C           @HKKY5    CHAINMMFWDDLL             84    *1             S01280
     C           *IN84     IFNE '1'                        B*2            S01280
     C                     ADD  HSDNMT    @@IAMT           **2            S01280
     C                     ADD  HSMAIN    @@IAMT           **2            S01280
     C                     SUB  HSMAOT    @@IAMT           **2            S01280
     C                     END                             E*2            S01280
     C                     END                             E1             S01280
      *                                                                   S01280
      *                                                                   S01280
      **  Set net movement to be displayed IRS.                           S01280
     C           @DIRS     IFNE *BLANK                     B1             S01280
     C                     MOVE 'IR'      @HKTYP           *1             S01280
     C           @HKKY5    CHAINMMFWDDLL             85    *1             S01280
     C           *IN85     IFNE '1'                        B*2            S01280
     C                     ADD  HSDNMT    @@IAMT           **2            S01280
     C                     ADD  HSMAIN    @@IAMT           **2            S01280
     C                     SUB  HSMAOT    @@IAMT           **2            S01280
     C                     END                             E*2            S01280
     C                     END                             E1             S01280
      *                                                                   S01280
      **  Set net movement to be displayed FUT.                           S01280
     C           @DFUT     IFNE *BLANKS                    B1             S01280
     C                     MOVE 'FU'      @HKTYP           *1             S01280
     C           @HKKY5    CHAINMMFWDDLL             86    *1             S01280
     C           *IN86     IFNE '1'                        B*2            S01280
     C                     ADD  HSDNMT    @@IAMT           **2            S01280
     C                     ADD  HSMAIN    @@IAMT           **2            S01280
     C                     SUB  HSMAOT    @@IAMT           **2            S01280
     C                     END                             E*2            S01280
     C                     END                             E1             S01280
      *                                                                   S01280
     C           *IN76     IFEQ '1'                        B2             S01149
     C           *IN78     ANDEQ'1'                                       S01149
     C           *IN83     ANDEQ'1'                                       S01280
     C           *IN84     ANDEQ'1'                                       S01280
     C           *IN85     ANDEQ'1'                                       S01280
     C           *IN86     ANDEQ'1'                                       S01280
     C                     MOVE 0         @NET             *2             S01149
     C                     ELSE                            X2             S01149
     C                     MOVE @HKCCY    @@CCY            *2             S01149
     C                     EXSR MM1016                     *2             S01149
     C                     MOVE @@AMOU    @NET             *2             S01149
     C                     END                             E2             S01149
     C                     MOVE *BLANKS   @HKTYP           *1             S01149
     C**********           ELSE                            X1      S01149 S01280
      **********                                                          S01280
      ****Move*LD or NA to key depending on requested deal type    S01149 S01280
     C********** @RTYP     IFEQ 'N/A'                      B2      S01149 S01280
     C**********           MOVE 'NA'      @HKTYP           *2      S01149 S01280
     C**********           ELSE                            X2      S01149 S01280
     C**********           MOVE 'LD'      @HKTYP           *2      S01149 S01280
     C**********           END                             E2      S01149 S01280
      **********                                                          S01280
      ****Set*net movement to be displayed (L/D or N/A only).      S01149 S01280
     C********** @HKKY4    CHAINMMFWDDLL             76            S01149 S01280
     C********** @HKKY5    CHAINMMFWDDLL             76    *1      S01149 S01280
     C********** *IN76     IFEQ '0'                        B2             S01280
     C**********           MOVE HSDNMT    @@IAMT           *2             S01280
     C**********           MOVE @HKCCY    @@CCY            *2             S01280
     C**********           EXSR MM1016                     *2             S01280
     C**********           MOVE @@AMOU    @NET             *2             S01280
     C**********           ELSE                            X2             S01280
     C**********           MOVE 0         @NET             *2             S01280
     C**********           END                             E2             S01280
     C**********           END                             E1      S01149 S01280
      *
      **  Ensure that date is in correct format.
     C********** DATF      IFEQ 'M'                        B1             S01194
     C           BJDFIN    IFEQ 'M'                        B1             S01194
     C                     MOVEL@FMTH     @DATE            *1
     C                     MOVEL@FDD      @DT47   4        *1
     C                     MOVE @FYR      @DT47            *1
     C                     MOVE @DT47     @DATE            *1
     C                     ELSE                            X1
     C                     MOVE @FDATE    @DATE            *1
     C                     END                             E1
     C*                                                                   SO1166
      **  Initialise roll past EOF/BOF indicator.
     C                     MOVE '0'       *IN70
      *
      **  IF A RECORD TYPE IS SELECTED AND NO RECORDS EXIST DESELECT      S01280
      **  FILE TO PREVENT PGM FROM TRYING TO READ THIS FILE.              S01280
      **                                                                  S01280
      *   Set up @PRO if eq N no records to process for file(s)           S01280
      *   selected.                                                       S01280
     C                     MOVE 'N'       @PRO    1                       S01280
      *                                                                   S01280
     C****See*if*any*records*exist*for*enquiry***                  SO1166 S01280
     C**  See if any records exist for L/D                                S01280
     C********** @HKKY4    SETLLCADVMALL                 72        SO1166 S01280
     C*                                                                   SO1166
     C           @DLD      IFNE *BLANK                     B1             S01280
     C           @HKKY4    SETLLMMDEVMP0                 72               S01280
     C           *IN72     IFEQ '1'                        B*2            S01280
     C                     MOVE 'Y'       @PRO                            S01280
     C                     END                             E*2            S01280
      *                                                                   S01280
     C           @PRO      IFNE 'Y'                        B*2            S01280
     C           @HKKY4    SETLLMMDEVMP1                 72               S01280
     C           *IN72     IFEQ '1'                        B**3           S01280
     C                     MOVE 'Y'       @PRO                            S01280
     C                     END                             E**3           S01280
     C                     END                             E*2            S01280
      *                                                                   S01280
     C           @PRO      IFNE 'Y'                        B*2            S01280
     C           @HKKY4    SETLLABDEALP0                 72               S01280
     C           *IN72     IFEQ '1'                        B**3           S01280
     C                     MOVE 'Y'       @PRO                            S01280
     C                     END                             E**3           S01280
     C                     END                             E*2            S01280
      *                                                                   S01280
     C           @PRO      IFNE 'Y'                        B*2            S01280
     C           @HKKY4    SETLLABDEALP1                 72B**3           S01280
     C           *IN72     IFEQ '1'                                       S01280
     C                     MOVE 'Y'       @PRO                            S01280
     C                     END                             E**3           S01280
     C                     END                             E*2            S01280
      *                                                                   S01280
     C           @PRO      IFNE 'Y'                        B*2            S01280
     C           @HKKY4    SETLLABDEALP2                 72               S01280
     C           *IN72     IFEQ '1'                        B**3           S01280
     C                     MOVE 'Y'       @PRO                            S01280
     C                     END                             E**3           S01280
     C                     END                             E*3            S01280
      *                                                                   S01280
     C           @PRO      IFNE 'Y'                        B*2            S01280
     C           @HKKY4    SETLLABDEALP3                 72               S01280
     C           *IN72     IFEQ '1'                        B**3           S01280
     C                     MOVE 'Y'       @PRO                            S01280
     C                     END                             E**3           S01280
     C                     END                             E**2           S01280
      *                                                                   S01280
     C                     END                             E1             S01280
     C**  See if any records exist for N/A                                S01280
     C           @DNA      IFNE *BLANKS                    B1             S01280
     C           @HKKY4    SETLLMMDENSP0                 72               S01280
     C           *IN72     IFEQ '1'                        B*2            S01280
     C                     MOVE 'Y'       @PRO                            S01280
     C                     END                             E*2            S01280
      *                                                                   S01280
     C           @PRO      IFNE 'Y'                        B*2            S01280
     C           @HKKY4    SETLLMMDENBP0                 72B**3           S01280
     C           *IN72     IFEQ '1'                                       S01280
     C                     MOVE 'Y'       @PRO                            S01280
     C                     END                             E**3           S01280
     C                     END                             E*2            S01280
      *                                                                   S01280
     C           @PRO      IFNE 'Y'                        B*2            S01280
     C           @HKKY4    SETLLMMDENBP1                 72B**3           S01280
     C           *IN72     IFEQ '1'                                       S01280
     C                     MOVE 'Y'       @PRO                            S01280
     C                     END                             E**3           S01280
     C                     END                             E*2            S01280
      *                                                                   S01280
     C                     END                             E1             S01280
      *   If record found reset record pointer.                           S01280
     C           @PRO      IFEQ 'Y'                                       S01280
     C           @HKKY4    SETLLCADVMALL                 72               S01280
     C                     END                                            S01280
      *                                                                   S01280
     C**  See if any records exist for LENDING.If module installed.       S01280
     C*                                                                   S01280
     C           @DLEN     IFNE *BLANK                                    S01280
     C           *IN41     ANDEQ'1'                                       S01280
     C                     Z-ADD@@MNO     @HKCYY                          S01280
     C           @DLKY1    SETLLDLCLONLL                 72               S01280
      *                                                                   S01280
     C           *IN72     IFEQ '0'                                       S01280
     C                     MOVE *BLANK    @DLEN                           S01280
     C                     ELSE                                           S01280
     C                     MOVE 'Y'       @PRO                            S01280
     C                     END                                            S01280
     C                     END                             E1             S01280
      *                                                                   S01280
     C**  See if any records exist for FRA.If module installed.           S01280
     C*                                                                   S01280
     C           @DFRA     IFNE *BLANKS                                   S01280
     C           *IN42     ANDEQ'1'                                       S01280
     C                     Z-ADD@@MNO     @HKCYY                          S01280
     C           @DLKY2    SETLLDLDLFRLL                 72               S01280
      *                                                                   S01280
     C           *IN72     IFEQ '0'                                       S01280
     C                     MOVE *BLANK    @DFRA                           S01280
     C                     ELSE                                           S01280
     C                     MOVE 'Y'       @PRO                            S01280
     C                     END                                            S01280
     C                     END                                            S01280
      *                                                                   S01280
     C**  See if any records exist for IRS.If module installed.           S01280
     C*                                                                   S01280
     C           @DIRS     IFNE *BLANKS                                   S01280
     C           *IN42     ANDEQ'1'                                       S01280
     C                     Z-ADD@@MNO     @HKCYY                          S01280
     C           @DLKY7    SETLLDLDLIRLL                 72               S01280
      *                                                                   S01280
     C           *IN72     IFEQ '0'                                       S01280
     C                     MOVE *BLANK    @DIRS                           S01280
     C                     ELSE                                           S01280
     C                     MOVE 'Y'       @PRO                            S01280
     C                     END                                            S01280
     C                     END                                            S01280
      *                                                                   S01280
     C**  See if any records exist for FUTURES.If module installed.       S01280
     C*                                                                   S01280
     C           @DFUT     IFNE *BLANK                                    S01280
     C           *IN43     ANDEQ'1'                                       S01280
     C                     Z-ADD@@MNO     @HKCYY                          S01280
     C           @DLKY3    SETLLDLFUTSLL                 72               S01280
      *                                                                   S01280
     C           *IN72     IFEQ '0'                                       S01280
     C                     MOVE *BLANK    @DFUT                           S01280
     C                     ELSE                                           S01280
     C                     MOVE 'Y'       @PRO                            S01280
     C                     END                                            S01280
     C                     END                                            S01280
      *                                                                   S01280
     C****If*no*records*then*write*message*to*screen***            SO1166 S01280
     C********** *IN72     IFEQ '0'                                SO1166 S01280
     C********** @RTYP     ORNE 'ALL'                              E20208 S01280
     C********** *IN76     ANDEQ'1'                                E20208 S01280
     C           @PRO      IFEQ 'N'                                       S01280
     C                     MOVEL'RTM0008' @MSGID                          SO1166
     C                     CALL 'ZA0240'                                  SO1166
     C                     PARM           @MSGID                          SO1166
     C                     MOVE '1'       *IN70                           SO1166
      *                                                                   S01280
      * Set clear subfile indicators and write subfile control format     S01280
     C                     SETOF                     3536                 S01280
     C                     WRITETM3200C1                                  S01280
      *                                                                   S01280
      * Change header fields to match prompts                             S01280
     C                     MOVE 'END  '   DDSTEN                          S01280
     C                     MOVEL@DTYP     DDTYPE                          S01280
     C                     MOVEL@DATE     DDDATE                          S01280
     C                     MOVEL@FCCY     DDCURR                          S01280
      *                                                                   S01280
      * Blank out 'Net' figure                                            S01280
     C                     MOVE *BLANKS   DDNET                           S01280
     C                     END                                            SO1166
      *
      **  If there were no records for first enquire full key will not
      **  have been loaded so treat as first enquiry
     C           *IN61     IFNE '1'                        B1
     C                     MOVE *BLANK    @ENQ             *1
     C                     END                             E1
      *
      **  Position file pointer according to value of enquiry updated
      **  input parameter.
     C           @ENQ      IFEQ 'R'                        B1
     C                     EXSR #BB                        *1
     C                     END                             E1
      *
     C           @ENQ      CASEQ' '       #BA              B1
     C******     @ENQ      CASEQ'F'       #BC              *1             S01166
     C******     @ENQ      CASEQ'L'       #BD              *1             S01166
     C           @ENQ      CASEQ'U'       #BE              *1
     C           @ENQ      CASEQ'D'       #BF              *1
     C                     END                             E1
      *
      **  If records to be accessed, set up fields in @AMENQ.
     C           *IN70     IFEQ '0'                        B1
      *
     C******     @ENQ      IFEQ 'L'                        B*2            S01166
     C******     @ENQ      OREQ 'D'                                       S01166
     C           @ENQ      IFEQ 'D'                        B*2            S01166
      *
      **  Read backwards.
     C                     EXSR #BG                        **2
      *
     C                     ELSE                            X*2
      *
      **  Read forwards.
     C                     EXSR #BH                        **2
     C                     END                             E*2
      *
     C** Move work fields to output                                       S01166
     C                     MOVE @NET      DDNET                           S01166
     C                     MOVE @STEND    DDSTEN                          S01166
     C                     MOVE @DTYP     DDTYPE                          S01166
     C                     MOVE @FCCY     DDCURR                          S01166
     C                     MOVE @NET      DDNET                           S01166
     C                     MOVE @DATE     DDDATE                          S01166
     C*                                                                   S01166
     C                     ELSE                                           S01166
     C** Trying to page up/down beyond first/last record                  S01166
     C           @ENQ      IFEQ 'D'                                       S01166
     C           *IN05     ANDNE'1'                                       S01280
     C           @ENQ      OREQ 'U'                                       S01166
     C           *IN05     ANDNE'1'                                       S01280
     C                     MOVEL'RTM0001' @MSGID 10                       SO1166
     C                     CALL 'ZA0240'                                  SO1166
     C                     PARM           @MSGID                          SO1166
     C                     END                                            S01166
     C*                                                                   S01166
     C                     END                             E1
      *
     C           #B8       TAG                                            S01166
     C*                                                                   S01166
     C* set subfile clear flag                                            S01166
     C                     MOVE 'N'       @SFLCL  1                       SO1166
     C*
      **  Store enquiry code for reference
     C                     MOVE @ENQ      @PREVE  1
      *
     C* if there is data to refresh/roll etc allow cmd keys               S01166
     C           DDCURR    IFNE *BLANKS                    B1             S01166
     C                     SETON                     27    *1             S01166
     C                     END                             E1             S01166
      *                                                                   S01280
      * Update on-screen time                                             S01280
     C                     TIME           DDTIME                          S01280
     C*                                                                   S01166
     C* write heading text                                                SO1166
     C**********           WRITEDL3200F0               51          SO1166 S01117
     C                     MOVE '0'       *IN36                           093466
     C                     WRITETM3200F0               51                 S01117
     C*                                                                   S01166
     C                     SETON                     3536                 SO1166
     C*                                                                   S01166
     C* write msg subfile                                                 SO1166
     C                     MOVE '1'       *IN46                           SO1166
     C**********           WRITEDL3200C0                           SO1166 S01117
     C                     MOVE '0'       *IN36                           093466
     C                     WRITETM3200C0                                  S01117
     C**********           WRITEDL3200F1                           SO1166 S01117
     C                     MOVE '0'       *IN36                           093466
     C                     WRITETM3200F1                                  S01117
     C*                                                                   SO1166
     C* setof subfile display if no records                               S01166
     C           DDCURR    IFEQ *BLANKS                    B*2
     C           *IN69     OREQ '1'                        B*2
     C                     SETOF                     35    **2            S01166
     C                     END                             E*2
     C*                                                                   SO1166
     C* write totals then subfile control                                 S01166
     C           *IN69     IFEQ '0'                        B*2
     C**********           WRITEDL3200F2                   **2     S01166 S01117
     C                     WRITETM3200F2                   **2            S01117
     C                     END                             E*2
     C*
     C* Only write subfile if records found                               S01166
      * If already a subfile on screen, don't set off *IN35 - this        S01280
      * is needed to enable cleared subfile to be displayed               S01280
     C********** *IN72     IFEQ '0'                                S01166 S01280
     C           @PRO      IFEQ 'N'                                       S01280
     C           @SFILE    ANDNE'Y'                                       S01280
     C           @RTYP     ORNE 'ALL'                                     S01280
     C           *IN76     ANDEQ'1'                                       S01280
     C           @SFILE    ANDNE'Y'                                       S01280
     C                     SETOF                     35    **2            S01166
     C                     END                                            S01166
     C*                                                                   S01166
     C                     MOVE '1'       *IN36                           093466
     C**********           WRITEDL3200C1                   *1      S01166 S01117
     C                     WRITETM3200C1                   *1             S01117
     C*                                                                   S01166
     C*********************SETOF                     0512  *1   S01166    E20178
     C*********************SETOF                     2526  *1   S01166    E20178
     C                     SETOF                     252605*1             E20178
     C*                                                                   S01166
     C**********           READ DL3200DD        0589*1read scrn    S01166 S01117
     C                     READ TM3200DD               0589*1read scrn    S01117
      *                                                                   SO1166
      ** Set up prompts                                                   SO1166
     C                     MOVE ' '       @ENQ    1                       SO1166
      *                                                                   SO1166
     C           *IN05     IFEQ '1'                                       SO1166
     C                     MOVE 'R'       @ENQ                            SO1166
     C                     END                                            SO1166
      *                                                                   SO1166
     C           *IN25     IFEQ '1'                                       SO1166
     C                     MOVE 'U'       @ENQ                            SO1166
     C                     END                                            SO1166
      *                                                                   SO1166
     C           *IN26     IFEQ '1'                                       SO1166
     C                     MOVE 'D'       @ENQ                            SO1166
     C                     END                                            SO1166
     C*                                                                   S01166
     C* help                                                              S01166
     C**         *IN10     DOWEQ'1'                        B*2     S01166 S01199
     C**                   SETOF                     10    **2     S01166 S01199
     C**                   CALL 'SDMENU'                   **2     S01166 S01199
     C**                   READ DL3200DD               0589**2     S01166 S01199
     C**                   END                             E*2     S01166 S01199
     C*                                                                   S01166
     C* exit                                                              S01166
     C           *IN01     IFEQ '1'                        B*2            S01166
     C                     MOVE 'Q'       @TERM            **2            S01166
     C                     MOVE '1'       *INLR            **2            S01166
     C                     GOTO #B9                        **2            S01166
     C                     END                             E*2            S01166
     C*                                                                   S01166
     C* summary                                                           S01166
     C           *IN02     IFEQ '1'                        B*2            S01166
     C                     MOVE 'U'       @TERM            **2            S01166
     C                     MOVE '1'       *INLR            **2            S01166
     C                     MOVE DDALL     @LKALL           **2            S01280
     C                     MOVE DDNA      @LKNA            **2            S01280
     C                     MOVE DDLD      @LKLD            **2            S01280
     C                     MOVE DDLEN     @LKLEN           **2            S01280
     C                     MOVE DDFRA     @LKFRA           **2            S01280
     C                     MOVE DDIRS     @LKIRS           **2            S01280
     C                     MOVE DDFUT     @LKFUT           **2            S01280
     C                     MOVE *BLANKS   DDTYP            **2            S01280
     C                     GOTO #B9                        **2            S01166
     C                     END                             E*2            S01166
     C*                                                                   S01166
     C* selection if there is data and cmd key not pressed                S01166
     C           @ENQ      IFEQ *BLANK                     B*2            S01166
     C           DDCURR    ANDNE*BLANKS                    B*2            S01166
     C********** *IN72     ANDEQ'1'                        B*2     S01166 S01280
     C           @PRO      ANDNE*BLANK                     B*2            S01280
     C           @SFILE    ANDEQ'Y'                        B*2            S01280
     C*                                                                   S01166
     C           *IN89     DOWEQ'0'                        B*3            S01166
     C**********           READCDL3200S1                 89**2     S01166 S01117
     C                     READCTM3200S1                 89**2            S01117
     C           DDSLCT    IFNE *BLANK                                    S01166
      * move deal types selected to parameter so that when returns from   S01280
      * detailed enquiry reverts to correct selected deals displayed.     S01280
     C                     MOVE DDALL     @LKALL                          S01280
     C                     MOVE DDNA      @LKNA                           S01280
     C                     MOVE DDLD      @LKLD                           S01280
     C                     MOVE DDLEN     @LKLEN                          S01280
     C                     MOVE DDFRA     @LKFRA                          S01280
     C                     MOVE DDIRS     @LKIRS                          S01280
     C                     MOVE DDFUT     @LKFUT                          S01280
      *                                                                   S01280
     C                     MOVE DDDEAL    @TOPDL           **3            S01166
     C                     MOVE DDHID     DDTYP            **3            S01280
     C                     MOVE 'D'       @TERM            **3            S01166
     C                     MOVE '1'       *IN03            **3            S01166
     C                     MOVE '1'       *INLR            **2            S01166
     C                     GOTO #B9                        **3            S01166
     C                     END                             E*3            S01166
     C                     END                             E*2            S01166
     C                     END                             E*2            S01166
     C*                                                                   S01166
     C* roll or refresh                                                   S01166
     C           @ENQ      IFEQ 'R'                        B*2            S01166
     C           @ENQ      OREQ 'U'                        B*2            S01166
     C           @ENQ      OREQ 'D'                        B*2            S01166
      * reset screen selection criteria.                                  S01280
     C                     MOVE DDCURR    DDCCY            **2            S01166
     C           BJDFIN    IFEQ 'D'                        B**3           S01280
     C                     MOVE DDDATE    DDDMY            **3            S01166
     C                     ELSE                            X**3           S01280
     C                     MOVE @FDATE    DDDMY            ***3           S01280
     C                     END                             E**3           S01280
      *                                                                   S01280
     C**********           MOVE DDTYPE    DDTYP            **2     S01166 S01280
     C                     END                             E*2            S01166
     C*                                                                   S01166
     C* clear msg subfile                                                 S01166
     C                     CALL 'ZA0250'                                  S01166
     C                     SETOF                     656667
     C                     SETOF                     69
     C                     SETOF                     7276                 SO1166
     C*                                                                   SO1166
     C           #B9       ENDSR                           ** #B9 **
      *
      *****************************************************************
      /EJECT
     C*****************************************************************   S01166
     C*                                                               *   S01166
     C* #ZC      - RESET ERROR INDICATORS AND CLEAR MESSAGE QUEUE     *   S01166
     C*                                                               *   S01166
     C*                                                               *   S01166
     C* CALLS    - ZA0250  -  CLEAR PROGRAM SUBFILE MESSAGE QUEUE     *   S01166
     C*                                                               *   S01166
     C* CALLED BY  #B      -  MAIN PROCESSING                         *   S01166
     C*                                                               *   S01166
     C* FLDS USED  @@ERMS  - ERROR-MESSAGE-TO-DISPLAY INDICATOR       *   S01166
     C*                                                               *   S01166
     C*****************************************************************   S01166
     C*                                                                   S01166
     C           #ZC       BEGSR                                          S01166
     C*                                                                   S01166
     C** RESET ALL FIELD ERROR INDICATORS.                                S01166
     C*                                                                   S01166
     C                     MOVE '0'       *IN60                           S01166
     C*******              MOVE '0'       *IN61                           S01166
     C*                                                                   S01166
     C** RESET THE GENERAL-ERROR-IN-VALIDATION INDICATOR                  S01166
     C*                                                                   S01166
     C                     MOVE '0'       *IN69                           S01166
     C*                                                                   S01166
     C** RESET THE ERROR RETURN CODE FROM ZA0270                          S01166
     C*                                                                   S01166
     C                     MOVE ' '       @RTCDE                          S01166
      *                                                                   S01280
      ** RESET SCREEN INPUT INDICATORS.                                   S01280
     C                     MOVE *BLANKS   @DALL                           S01280
     C                     MOVE *BLANKS   @DNA                            S01280
     C                     MOVE *BLANKS   @DLD                            S01280
     C                     MOVE *BLANKS   @DLEN                           S01280
     C                     MOVE *BLANKS   @DFRA                           S01280
     C                     MOVE *BLANKS   @DIRS                           S01280
     C                     MOVE *BLANKS   @DFUT                           S01280
     C                     MOVE *BLANKS   @HKCCY                          S01280
     C                     MOVE *BLANKS   @LDNA                           S01280
     C                     MOVE *BLANKS   @RTYP                           S01280
     C                     MOVE 'N'       @KEYSU                          S01280
     C                     MOVE 'N'       @KEYSD                          S01280
      *                                                                   S01280
      * Reset file roll indicators                                        S01280
     C                     MOVE 'N'       @CADY   1                       S01280
     C                     MOVE 'N'       @LENY   1                       S01280
     C                     MOVE 'N'       @FRAY   1                       S01280
     C                     MOVE 'N'       @IRSY   1                       S01280
     C                     MOVE 'N'       @FUTY   1                       S01280
      *                                                                   S01280
      * Reset file record format indicators.                              S01280
     C                     SETOF                     111213               S01280
     C                     SETOF                     14                   S01280
     C*                                                                   S01166
     C** RESET THE ERROR-MESSAGE-TO-DISPLAY INDICATOR                     S01166
     C*                                                                   S01166
     C                     MOVE 'N'       @@ERMS  1                       S01166
     C*                                                                   S01166
     C** CLEAR SCREEN MESSAGE QUEUE.                                      S01166
     C*                                                                   S01166
     C                     CALL 'ZA0250'                                  S01166
     C*                                                                   S01166
     C           #ZC9      ENDSR                                          S01166
     C*****************************************************************   S01166
     C/EJECT                                                              S01166
     C********************************************************************
     C*
     C* ZA0720 - Converts YYYYMMDD to DDMMMYY or MMMDDYY depending
     C***********on*instalation*control*date*format*(TABTB10)********     S01194
     C*          on instalation control date format (SDBANKPD)            S01194
     C*
     C* CALLED BY :
     C*
     C* CALLS :
     C*
     C* INPUT  : @@DTIN DATE INPUT (YYYYMMDD)  - IN DATA STRUCTURE
     C*
     C* OUTPUT : @@DATE DATE OUTPUT 7 DIGIT FORMAT EITHER
     C*          DDMMMYY OR MMMDDYY
     C*
     C* USES :   @@MTH  MONTH NUMBER
     C*          @@MNM  MONTH SHORTNAME
     C*          @@DAY  DAY NUMBER
     C*          @@YYYY YEAR (4 CHARACTER)
     C*          @MT    RUN TIME ARRAY FOR MONTH SHORTNAMES
     C*          @@DAY5 DAY NUMBER WITH THREE LEADING BLANKS
     C*          @@MTH5 MONTH SHORTNAME WITH TWO LEADING BLANKS
     C*          @@DATE OUTPUT DATE FIELD
     C*
     C*     LAST AMEND NO. ME1257              DATE 02/04/87
     C*     When date input is zero set output date to blanks
     C*
     C********************************************************************
     C           ZA0720    BEGSR
     C*
     C           @@DTIN    IFNE 0                          B1
     C*
     C**  Convert to MMMDDYY
     C********** DATF      IFEQ 'M'                        B*2            S01194
     C           BJDFIN    IFEQ 'M'                        B*2            S01194
     C                     MOVE @@DAY     @@DAY5  5        **2
     C                     MOVE @@YYYY    @@DATE  7        **2
     C                     MOVEL@@DAY5    @@DATE           **2
     C                     MOVEL@MT,@@MTH @@DATE           **2
     C                     ELSE                            X*2
     C*
     C**  Convert to DDMMMYY
     C                     MOVE @MT,@@MTH @@MTH5  5        **2
     C                     MOVE @@YYYY    @@DATE  7        **2
     C                     MOVEL@@MTH5    @@DATE           **2
     C                     MOVEL@@DAY     @@DATE           **2
     C                     END                             E*2
     C*
     C**  Set output date to blanks & exit if input date is zero.
     C                     ELSE                            X1
     C                     MOVE *BLANKS   @@DATE           *1
     C                     END                             E1
     C*
     C           ZA0729    ENDSR                              *** ZA0720 T
      *
      *****************************************************************
      /EJECT
      *****************************************************************
      *                                                               *
      *     MM1015 -  CONVERT AMOUNT TO DISPLAY -38                   *
      *     This routine converts a 15N amount with up to 3 implied   *
      *     decimal places into a 12A field with thousands integer    *
      *     half adjusted & leading zeroes suppressed.                *
      *                                                               *
      *       CALLS: NONE                                             *
      *                                                               *
      *       INPUT: @@IAMT 15,0  INPUT AMOUNT                        *
      *              @@CCY  3A    INPUT CURRENCY                      *
      *                                                               *
      *      OUTPUT: @@AMOT 12A   AMOUNT TO DISPLAY                   *
      *                                                               *
      *        USES: @@CCY2       STORED CURRENCY                     *
      *              @@CDP        CURRENCY DECIMAL PLACES             *
      *              @@I          INDEX TO ARRAY OF AMOUNT            *
      *              @@C          INDEX TO ARRAY OF DISPLAY AMOUNT    *
      *              @D           ARRAY OF AMOUNT                     *
      *              @J           ARRAY OF DISPLAY AMOUNT             *
      *                                                               *
      *                                                               *
      *****************************************************************
      *
     C           MM1015    BEGSR
      *
      **  Initialise array.
     C                     MOVEA*BLANKS   @D
     C                     MOVEA*BLANKS   @J
      *
      **  Compare input currency this time with last time value
     C           @@CCY     IFNE @@CCY2                     B1
      *
      **  Access currencies file
      **  (via Access Object)                                             S01194
      ****Load*key******                                                  S01194
     C**********           MOVEL'20'      @@KEY  12        *1             S01194
     C**********           MOVE '1'       @@ENDK  4        *1             S01194
     C**********           MOVEL@@CCY     @@ENDK           *1             S01194
     C**********           MOVE @@ENDK    @@KEY            *1             S01194
      **********                                                          S01194
     C********** @@KEY     CHAINFDCCYTLL             80    *1             S01194
      **********                                                          S01194
     C********** *IN80     IFEQ '1'                        B*2            S01194
     C**********           MOVE '931'     DBASE            ***************S01194
     C**********           MOVEL'FDCCYTLL'DBFILE           *             *S01194
     C**********           MOVEL@@KEY     DBKEY            * DBERROR 931 *S01194
     C**********           MOVE '1'       *INU7            *             *S01194
     C**********           MOVE '1'       *INU8            ***************S01194
     C**********           GOTO M10159                     **2            S01194
     C**********           END                             E*2            S01194
      *                                                                   S01194
     C                     CALL 'AOCURRR0'                                S01194
     C                     PARM '*DBERR ' @RTCD   7                       S01194
     C                     PARM '*KEY   ' @OPTN   7                       S01194
     C                     PARM           @@CCY   3                       S01194
     C           SDCURR    PARM SDCURR    DSSDY                           S01194
      *                                                                   S01194
     C                     MOVE @@CCY     @@CCY2  3        *1
      *
      ** Store number of decimal places for the currency
     C**********           MOVE CDP       @@CDP   10       *1             S01194
     C                     MOVE A6NBDP    @@CDP   10       *1             S01194
      *
     C                     END                             E1
      *
      ** Ensure input amount is +ve.
     C           @@IAMT    IFLT 0                          B1
     C                     Z-SUB@@IAMT    @@IAMT           *1
     C                     END                             E1
      *
      ** Round up figures to the nearest thousand.
      ** & store initial array index value
     C           @@CDP     IFEQ 0                          B1
     C                     ADD  500       @@IAMT 150       *1
     C                     Z-ADD12        @@I              *1
     C                     END                             E1
      *
     C           @@CDP     IFEQ 1                          B1
     C                     ADD  5000      @@IAMT           *1
     C                     Z-ADD11        @@I              *1
     C                     END                             E1
      *
     C           @@CDP     IFEQ 2                          B1
     C                     ADD  50000     @@IAMT           *1
     C                     Z-ADD10        @@I              *1
     C                     END                             E1
      *
     C           @@CDP     IFEQ 3                          B1
     C                     ADD  500000    @@IAMT           *1
     C                     Z-ADD9         @@I              *1
     C                     END                             E1
      *
      **  Place input amount into a 15 x 1 byte array
     C                     MOVEA@@AMDS    @D
      *
      **  Load output amount into a 12 x 1 byte array
     C                     Z-ADD12        @@C
     C           @@I       DOWGT0                          B1
     C                     MOVE @D,@@I    @J,@@C           *1
     C                     SUB  1         @@C     20       *1
     C                     SUB  1         @@I     20       *1
     C                     END                             E1
      *
      ** Test successive elements of output amount setting zeroes to
      ** blanks until the first element or a 'non zero' is reached.
     C                     Z-ADD1         @@C
      *
     C           @J,@@C    DOUNE'0'                        B1
     C           @J,@@C    ANDNE*BLANK                     *1
     C           @@C       OREQ 12                         *1
     C                     MOVE *BLANK    @J,@@C           *1
     C                     ADD  1         @@C              *1
     C                     END                             E1
      *
      ** Move @J to display field.
     C                     MOVEA@J        @@AMOT 12
      *
     C           M10159    ENDSR                           ** M10159 **
      *
      *****************************************************************
      /EJECT
      *****************************************************************
      *                                                               *
      *     MM1016 -  CONVERT AMOUNT TO DISPLAY -38                   *
      *     This routine converts a 15N amount with up to 3 implied   *
      *     decimal places into a 13A field with thousands integer    *
      *     half adjusted , leading zeroes suppressed & signed(+ or   *
      *     -).                                                       *
      *                                                               *
      *       CALLS: NONE                                             *
      *                                                               *
      *       INPUT: @@IAMT 15,0  INPUT AMOUNT                        *
      *              @@CCY  3A    INPUT CURRENCY                      *
      *                                                               *
      *      OUTPUT: @@AMOU 13A   SIGNED AMOUNT TO DISPLAY            *
      *                                                               *
      *        USES: @@AMOT       AMOUNT TO DISPLAY                   *
      *              @@SIGN       SIGN OF AMOUNT                      *
      *              @A           ARRAY OF DISPLAY AMOUNT (SIGNED)    *
      *                                                               *
      *                                                               *
      *****************************************************************
      *
     C           MM1016    BEGSR
      *
      ** Initialise fields
     C                     MOVEA*BLANKS   @A
     C                     MOVE *BLANKS   @@AMOU 13
     C                     MOVE *BLANK    @@SIGN
      *
      ** Find sign of input field
     C           @@IAMT    IFGT *ZERO                      B1
     C                     MOVE '+'       @@SIGN  1        *1
     C                     ELSE                            X1
     C           @@IAMT    IFLT *ZERO                      B*2
     C                     MOVE '-'       @@SIGN           **2
     C                     MULT -1        @@IAMT           **2
     C                     END                             E*2
     C                     END                             E1
      *
      **  Execute MM1015 to convert the input amount to display format.
     C                     EXSR MM1015
      *
      ** If a database error was discovered by MM1015 exit routine.
     C           *INU7     IFEQ '1'                        B1
     C                     GOTO M10169                     *1
     C                     END                             E1
      *
      ** Place output amount into array @A
     C                     MOVEL@@AMOT    @@AMOU
     C                     MOVEA@@AMOU    @A
      *
      ** Place sign into array & move to output field.
     C                     MOVE @@SIGN    @A,13
     C                     MOVEA@A        @@AMOU
      *
     C           M10169    ENDSR                           ** M10169 **
      *
      *****************************************************************
      /EJECT
      *****************************************************************
      *                                                               *
      *  SUBROUTINE #ZA    - CONVERT SHORT RATE TO DISPLAY            *
      *                         *** MODIFIED ZA0880 ***               *
      *                      THIS SUBROUTINE RECEIVES A 13/8 INPUT    *
      *                      RATE @@RIN & OUTPUTS A 8A RATE WITH      *
      *                      DECIMAL SEPERATOR @B                     *
      *                                                               *
      *  CALLED BY   :                                                *
      *                                                               *
      *  INPUT       : @A     - INPUT RATE ARRAY  (13A)               *
      *  OUTPUT      : @B     - OUTPUT RATE ARRAY (8A)                *
      *                                                               *
      *  WORK FIELDS : @@1    - ARRAY INDEX FOR @@C1 (2,0)            *
      *              : @@B    - ARRAY INDEX FOR @@C2 (1,0)            *
      *                                                               *
      *   INDICATORS :  77    - INPUT RATE IS NEGATIVE                *
      *                 82    - LOOKUP ARRAY                          *
      *                                                               *
      *****************************************************************
      *
     C           #ZA       BEGSR
      *
      **  Initialise output array.
     C                     MOVE *BLANKS   @B
      *
      **  If input rate is negative, set indicator 77.
     C                     MOVE '0'       *IN77
     C           @@RIN     IFLT 0                          B1
     C                     MOVE '1'       *IN77            *1
     C                     Z-SUB@@RIN     @@RIN            *1
     C                     END                             E1
      *
      **  If input rate is zero, output blanks.
     C           @@RIN     IFEQ 0                          B1
     C                     GOTO #ZA9                       *1
     C                     END                             E1
      *
      **  Truncate trailing zeros and replace with blanks. If rate is
      **  an integer a single zero after the decimal place should be
      **  displayed.
     C                     Z-ADD13        @@1
     C           @@1       DOWGE7                          B1
     C           @A,@@1    ANDEQ'0'                        X1
     C                     MOVE *BLANK    @A,@@1           *1
     C                     SUB  1         @@1              *1
     C                     END                             E1
      *
      **  LOKUP for first non-zero element.
     C                     Z-ADD1         @@1     20
     C           *ZERO     LOKUP@A,@@1               82
      *
      **  If non-zero element found after position 5, reset index to 5.
     C           @@1       IFGT 5                          B1
     C                     Z-ADD5         @@1              *1
     C                     END                             E1
      *
      **  Reset index to output rate array.
     C                     Z-ADD*ZERO     @@B     10
      *
      **  Load 8 position output array.
     C           @@B       DOUEQ8                          B1
      *
      **  Increment index and move input element to output rate array.
     C                     ADD  1         @@B              *1
     C                     MOVE @A,@@1    @B,@@B           *1
      *
      **  If index to input rate array = 5, move decimal seperator to
      **  array.
     C           @@1       IFEQ 5                          B*2
     C                     ADD  1         @@B              **2
     C*********************MOVE*IDDCSP****@B,@@B*************2************S01319
     C                     MOVE BNDCSP    @B,@@B           **2            S01319
     C                     END                             E*2
      *
      **  If input rate is negative, and decimal place is blank, move
      **  sign to output array.
     C           *IN77     IFEQ '1'                        B*2
     C           @@1       ANDGT5                          **2
     C           @A,@@1    ANDEQ*BLANK                     **2
     C                     MOVE '-'       @B,@@B           **2
     C                     MOVE '0'       *IN77
     C                     END                             E*2
      *
     C                     ADD  1         @@1              *1
      *
     C                     END                             E1
      *
     C           #ZA9      ENDSR                           ** #ZA9 **
      *****************************************************************
      /EJECT
      *****************************************************************
      *                                                               *
      *  #BA - THIS ROUTINE CONTROLS THE FILE POSITIONING FOR         *
      *        THE FOLLOWING ENQUIRY UPDATED INPUT PARAMETERS VALUES: *
      *                                                               *
      *            ' ' - CURRENT PROMPT                               *
      *                                                               *
      *  CALLED BY : #B                                               *
      *                                                               *
      *  CALLS :                                                      *
      *                                                               *
      *  USES :      @HKKY4 - PARTIAL KEY FOR CADVMALL                *
      *              @STEND - START/END NARRATIVE                     *
      *                                                               *
      *****************************************************************
      *
     C           #BA       BEGSR
      *
      **  Position file before the first record for currency/date
      *   and type                                                        S01149
      *
     C******     @HKKY4    SETLLMMDVMALL                                  S01145
     C           @HKKY4    SETLLCADVMALL                                  S01145
      *
      **  Set start/end narrative.
     C                     MOVE 'START'   @STEND
      *
     C           #BA9      ENDSR                           ** #BA9 **
      *
      *****************************************************************
      /EJECT
      *****************************************************************
      *                                                               *
      *  #BB - THIS ROUTINE CONTROLS THE FILE POSITIONING FOR         *
      *        THE FOLLOWING ENQUIRY UPDATED INPUT PARAMETERS VALUES: *
      *                                                               *
      *            'R' - REFRESH                                      *
      *                                                               *
      *  CALLED BY : #B                                               *
      *                                                               *
      *  CALLS :                                                      *
      *                                                               *
      *  USES :    @ENQ   - ENQUIRY UPDATED INPUT PARAMETER           *
      *            @HKKY4 - PARTIAL KEY FOR CADVMALL                  *
      *            @HKKY8 - FULL KEY FOR CADVMALL                     *
      *            @HKCCY - CURRENCY FROM FAEPT1                      *
      *            @VDATE - VALUE DATE YYYYMMDD                       *
      *            @RDATE - REQUESTED DATE FROM FAEPT1 YYYYMMDD       *
      *            @MDATE - MATURITY DATE YYYYMMDD                    *
      *            @STEND - START/END NARRATIVE                       *
      *            @PREVE - PREVIOUS ENQUIRY TYPE                     *
      *                                                               *
      *****************************************************************
      *
     C           #BB       BEGSR
      *
      **  Check if there are any more records for this currency/date
      **  date/type.                                                      S01149
     C*
     C******     @HKKY8    SETGTMMDVMALL                                  S01145
     C******     @HKKY4    READEMMDVMALL                 76               S01145
     C           @HKKY8    SETGTCADVMALL                                  S01145
     C           @HKKY4    READECADVMALL                 76               S01145
      *
      *******There are no further records on MMDEVMLL for this currency,
      ******* date, display last page.
     C*******    *IN76     IFEQ '1'
     C*******              MOVE 'L'       @ENQ
     C*******              GOTO #BB9
     C*******              END
      *
      **  If there are no further records on CADVMALL for this currency,
      **  & last enquiry was for roll down or last page then repeat
      **  last page processing so that records displayed at bottom of
      **  screen do not shift to top.
     C           *IN76     IFEQ '1'                        B1
     C*
     C           @PREVE    IFEQ 'L'                        B*2
     C           @PREVE    OREQ 'D'                        **2
     C                     MOVE @PREVE    @ENQ             **2
     C                     GOTO #BB9                       **2
     C                     END                             E*2
     C                     END                             E1
      *
      **  Check if at start of currency/date/type.                        S01149
     C******     @HKKY8    SETGTMMDVMALL                                  S01145
     C******               READPMMDVMALL                 76               S01145
     C           @HKKY8    SETGTCADVMALL                                  S01145
     C                     READPCADVMALL                 76               S01145
     C           *IN76     IFEQ '0'                        B1
      *
      **  Determine whether currency/date has changed.
     C           HKCCY     IFNE @HKCCY                     B2
     C                     MOVE '1'       *IN76            *2
      *
     C                     ELSE                            X2
      *
     C           @VDATE    IFNE @RDATE                     B*3
     C           @MDATE    ANDNE@RDATE                     **3
     C                     MOVE '1'       *IN76            **3
     C                     END                             E*3
      *
     C                     END                             E2
      *
     C                     END                             E1
      *
      **  If no previous records for currency/date/type, set start        S01149
      **  end narrative.                                                  S01149
     C           *IN76     IFEQ '1'                        B1
     C                     MOVE 'START'   @STEND           *1
     C                     END                             E1
      *
      **  Position file before record for currency/date/type/roll-        S01149
      **  refresh key field.                                              S01149
     C           @PREVE    IFNE 'D'                                       SO1166
     C                     MOVE FARKT1    @RRFSH                          SO1166
     C                     END                                            SO1166
     C*******    @HKKY8    SETLLMMDVMALL                                  S01145
     C           @HKKY8    SETLLCADVMALL                                  S01145
      *
     C           #BB9      ENDSR                           ** #BB9 **
      *
      *****************************************************************
      /EJECT
      *****************************************************************
      *                                                               *
      *  #BC - THIS ROUTINE CONTROLS THE FILE POSITIONING FOR         *
      *        THE FOLLOWING ENQUIRY UPDATED INPUT PARAMETER VALUES:  *
      *                                                               *
      *            'F' - FIRST PAGE                                   *
      *                                                               *
      *  CALLED BY : #B                                               *
      *                                                               *
      *  CALLS :                                                      *
      *                                                               *
      *  USES:       @HKKY4 - PARTIAL KEY FOR MMDVMALL                *
      *              @STEND - START/END NARRATIVE                     *
      *                                                               *
      *****************************************************************
      *******                                                             S01166
     C*******    #BC       BEGSR                                          S01166
      *******                                                             S01166
      **  Set start/end narrative.                                        S01166
     C******               MOVE 'START'   @STEND                          S01166
      ******                                                              S01166
      **  Position file before the first record for currency/date/type.   S01149
     C******     @HKKY4    SETLLMMDVMALL                           S01145 S01166
     C******     @HKKY4    SETLLCADVMALL                           S01145 S01166
      ******                                                              S01166
     C******     #BC9      ENDSR                           ** #BC9 **     S01166
      ******                                                              S01166
      *****************************************************************
      /EJECT
      *****************************************************************
      *                                                               *
      *  #BD - THIS ROUTINE CONTROLS THE GENERATION OF DATES FOR      *
      *        THE FOLLOWING ENQUIRY UPDATED INPUT PARAMETER VALUES:  *
      *                                                               *
      *            'L' - LAST PAGE                                    *
      *                                                               *
      *  CALLED BY : #B                                               *
      *                                                               *
      *  CALLS :                                                      *
      *                                                               *
      *  USES:       @HKKY4 - PARTIAL KEY FOR MMDVMALL                *
      *              @STEND - START/END NARRATIVE                     *
      *                                                               *
      *****************************************************************
      ******                                                              S01166
     C******     #BD       BEGSR                                          S01166
      ******                                                              S01166
      **  Set start/end narrative.                                        S01166
     C******               MOVE 'END  '   @STEND                          S01166
      ******                                                              S01166
      **  Position file after the last record for currency/date/type.     S01149
     C******     @HKKY4    SETGTMMDVMALL                           S01145 S01166
     C******     @HKKY4    SETGTCADVMALL                           S01145 S01166
      ******                                                              S01166
     C******     #BD9      ENDSR                           ** #BD9 **     S01166
      ******                                                              S01166
      *****************************************************************
      /EJECT
      *****************************************************************
      *                                                               *
      *  #BE - THIS ROUTINE CONTROLS THE GENERATION OF DATES FOR      *
      *        THE FOLLOWING ENQUIRY UPDATED INPUT PARAMETER VALUES:  *
      *                                                               *
      *            'U' - ROLL UP                                      *
      *                                                               *
      *  CALLED BY : #B                                               *
      *                                                               *
      *  CALLS :                                                      *
      *                                                               *
      *  USES:     @HKKY4 - PARTIAL KEY FOR MMDVMALL                  *
      *            @HKKY8 - FULL KEY FOR MMDVMALL                     *
      *            @HKCCY - CURRENCY FROM FAEPT1                      *
      *            @VDATE - VALUE DATE YYYYMMDD                       *
      *            @RDATE - REQUESTED DATE FROM FAEPT1 YYYYMMDD       *
      *            @MDATE - MATURITY DATE YYYYMMDD                    *
      *            @STEND - START/END NARRATIVE                       *
      *                                                               *
      *****************************************************************
      *
     C           #BE       BEGSR
      *
     C**  If the previous operation was roll down in order to position    SO1166
     C**   file on bottom record we have to set key to value of           SO1166
     C**  first record read in previous operation                         SO1166
     C           @BLINE    IFEQ 'CAD'                                     S01280
     C           @PREVE    IFEQ 'D'                                       SO1166
     C                     MOVE FARKB1    @RRFSH                          SO1166
     C                     END                                            SO1166
     C*                                                                   SO1166
      **  Check if at start of currency/date/type                         S01149
     C******     @HKKY8    SETGTMMDVMALL                                  S01145
     C******               READPMMDVMALL                 76               S01145
     C           @HKKY8    SETGTCADVMALL                                  S01145
     C                     READPCADVMALL                 76               S01145
     C           *IN76     IFEQ '0'                        B1
      *
      **  Determine whether currency/date/type has changed.               S01149
     C           HKCCY     IFNE @HKCCY                     B*2
     C                     MOVE '1'       *IN76            **2
      *
     C                     ELSE                            X*2
      *
     C           @VDATE    IFNE @RDATE                     B**3
     C           @MDATE    ANDNE@RDATE                     ***3
     C                     MOVE '1'       *IN76            ***3
     C                     END                             E**3
      *
     C                     END                             E*2
      *
     C                     END                             E1
      *
      **  If no previous records for currency/date/type, set start/       S01149
      **  end narrative.                                                  S01149
     C           *IN76     IFEQ '1'                        B1
     C                     MOVE 'START'   @STEND           *1
     C                     END                             E1
      *
      **  Check if there are any more records for this currency/date/     S01149
      **  type.                                                           S01149
     C******     @HKKY8    SETGTMMDVMALL                                  S01145
     C******     @HKKY4    READEMMDVMALL                 70               S01145
     C           @HKKY8    SETGTCADVMALL                                  S01145
     C           @HKKY4    READECADVMALL                 70               S01145
      *
      **  Position file after record for currency/date/type/              S01149
      **  roll-refresh key field.                                         S01149
     C******     @HKKY8    SETGTMMDVMALL                                  S01145
     C           @HKKY8    SETGTCADVMALL                                  S01145
      *
     C**  If 70 has been set we are at end so move 'END' message          SO1166
      *   If not end move blanks to @STEND + leave #BH to find if         S01280
      *   end.                                                            S01280
     C           *IN70     IFEQ '1'                        B1             SO1166
      *                                                                   S01280
      **  It may be the case that the last record on screen is the last   S01280
      **  record for this file.However other deal types might have been   S01280
      **  selected.If others selected set up full key.                    S01280
     C           @DFUT     IFNE *BLANK                                    S01280
     C                     MOVE 'FUT'     @BLINE                          S01280
     C                     MOVE @HKCCY    @FUCCY                          S01280
     C                     MOVE @HKCYY    @FDAT                           S01280
     C                     MOVE *LOVAL    @FUDNO                          S01280
      *   If key setup,do not want @preve = d,move xxxxb1 xxxfsh          S01280
     C                     MOVE 'Y'       @KEYSU  1                       S01280
     C                     ELSE                                           S01280
     C                     MOVE 'END  '   @STEND           *1             S01280
     C                     END                             E1             S01280
      *                                                                   S01280
     C           @DIRS     IFNE *BLANK                                    S01280
     C                     MOVE 'IRS'     @BLINE                          S01280
     C                     MOVE @HKCCY    @IRCCY                          S01280
     C                     MOVE @HKCYY    @IVDAT                          S01280
     C                     MOVE *LOVAL    @IAMT                           S01280
     C                     MOVE *LOVAL    @IRDNO                          S01280
     C                     MOVE 'Y'       @KEYSU                          S01280
     C                     ELSE                                           S01280
     C                     MOVE 'END  '   @STEND                          S01280
     C                     END                                            S01280
      *                                                                   S01280
     C           @DFRA     IFNE *BLANK                                    S01280
     C                     MOVE 'FRA'     @BLINE                          S01280
     C                     MOVE @HKCCY    @FRCCY                          S01280
     C                     MOVE @HKCYY    @FVDAT                          S01280
     C                     MOVE *LOVAL    @FAMT                           S01280
     C                     MOVE *LOVAL    @FDLNO                          S01280
     C                     MOVE 'Y'       @KEYSU                          S01280
     C                     ELSE                                           S01280
     C                     MOVE 'END  '   @STEND                          S01280
     C                     END                                            S01280
      *                                                                   S01280
     C           @DLEN     IFNE *BLANK                                    S01280
     C                     MOVE 'LEN'     @BLINE                          S01280
     C                     MOVE @HKCCY    @LECCY                          S01280
     C                     MOVE @HKCYY    @LMDAT                          S01280
     C                     MOVE *LOVAL    @LVDAT                          S01280
     C                     MOVE *LOVAL    @LAMT                           S01280
     C                     MOVE *LOVAL    @LELNO                          S01280
     C                     MOVE 'Y'       @KEYSU                          S01280
     C                     ELSE                                           S01280
     C                     MOVE 'END  '   @STEND                          S01280
     C                     END                                            S01280
      *                                                                   S01280
     C                     ELSE                            *1             S01280
     C                     MOVE 'Y'       @CADY   1        *1             S01280
     C                     MOVE *BLANKS   @STEND           *1             S01280
     C                     END                             E1             S01280
     C                     END                                            S01280
      *                                                                   S01280
      *   If last record was LENDING.                                     S01280
     C           @BLINE    IFEQ 'LEN'                                     S01280
      *                                                                   S01280
     C           @PREVE    IFEQ 'D'                                       S01280
     C           @KEYSU    ANDNE'Y'                                       S01280
     C                     MOVE SARKB1    @SRFSH                          S01280
     C                     END                                            S01280
      *                                                                   S01280
     C           @DLKY4    SETGTDLCLONLL                                  S01280
     C           @DLKY1    READEDLCLONLL                 70               S01280
      *                                                                   S01280
     C           @DLKY4    SETGTDLCLONLL                                  S01280
      *                                                                   S01280
     C**  If 70 has been set we are at end so move 'END' message          S01280
      *   else set Y to @LENY to prevent SETLL on DLCLONLL in #BH.        S01280
      *   If not end move blanks to @STEND + leave #BH to find if         S01280
      *   end.                                                            S01280
     C           *IN70     IFEQ '1'                        B1             S01280
      *                                                                   S01280
      **  It may be the case that the last record on screen is the last   S01280
      **  record for this file.However other deal types might have been   S01280
      **  selected.If others selected set up full key.                    S01280
     C           @DFUT     IFNE *BLANK                                    S01280
     C                     MOVE 'FUT'     @BLINE                          S01280
     C                     MOVE @HKCCY    @FUCCY                          S01280
     C                     MOVE @HKCYY    @FDAT                           S01280
     C                     MOVE *LOVAL    @FUDNO                          S01280
     C                     MOVE 'Y'       @KEYSU                          S01280
     C                     ELSE                                           S01280
     C                     MOVE 'END  '   @STEND                          S01280
     C                     END                                            S01280
      *                                                                   S01280
     C           @DIRS     IFNE *BLANK                                    S01280
     C                     MOVE 'IRS'     @BLINE                          S01280
     C                     MOVE @HKCCY    @IRCCY                          S01280
     C                     MOVE @HKCYY    @IVDAT                          S01280
     C                     MOVE *LOVAL    @IAMT                           S01280
     C                     MOVE *LOVAL    @IRDNO                          S01280
     C                     MOVE 'Y'       @KEYSU                          S01280
     C                     ELSE                                           S01280
     C                     MOVE 'END  '   @STEND                          S01280
     C                     END                                            S01280
      *                                                                   S01280
     C           @DFRA     IFNE *BLANK                                    S01280
     C                     MOVE 'FRA'     @BLINE                          S01280
     C                     MOVE @HKCCY    @FRCCY                          S01280
     C                     MOVE @HKCYY    @FVDAT                          S01280
     C                     MOVE *LOVAL    @FAMT                           S01280
     C                     MOVE *LOVAL    @FDLNO                          S01280
     C                     MOVE 'Y'       @KEYSU                          S01280
     C                     ELSE                                           S01280
     C                     MOVE 'END  '   @STEND                          S01280
     C                     END                                            S01280
      *                                                                   S01280
     C                     ELSE                                           S01280
     C                     MOVE *BLANKS   @STEND                          S01280
     C                     MOVE 'Y'       @LENY                           S01280
     C                     END                                            S01280
     C                     END                                            S01280
      *                                                                   S01280
      *   If last record was FRA.                                         S01280
     C           @BLINE    IFEQ 'FRA'                                     S01280
      *                                                                   S01280
     C           @PREVE    IFEQ 'D'                                       S01280
     C           @KEYSU    ANDNE'Y'                                       S01280
     C                     MOVE TARKB1    @TRFSH                          S01280
     C                     END                                            S01280
      *                                                                   S01280
     C           @DLKY5    SETGTDLDLFRLL                                  S01280
     C           @DLKY2    READEDLDLFRLL                 70               S01280
      *                                                                   S01280
     C           @DLKY5    SETGTDLDLFRLL                                  S01280
     C**  If 70 has been set we are at end so move 'END' message          S01280
      *   else set Y to @FRAY to prevent SETLL on DLDLFRLL in #BH.        S01280
      *   If not end move blanks to @STEND + leave #BH to find if         S01280
      *   end.                                                            S01280
     C           *IN70     IFEQ '1'                        B1             S01280
      *                                                                   S01280
      **  It may be the case that the last record on screen is the last   S01280
      **  record for this file.However other deal types might have been   S01280
      **  selected.If others selected set up full key.                    S01280
     C           @DFUT     IFNE *BLANK                                    S01280
     C                     MOVE 'FUT'     @BLINE                          S01280
     C                     MOVE @HKCCY    @FUCCY                          S01280
     C                     MOVE @HKCYY    @FDAT                           S01280
     C                     MOVE *LOVAL    @FUDNO                          S01280
     C                     MOVE 'Y'       @KEYSU                          S01280
     C                     ELSE                                           S01280
     C                     MOVE 'END  '   @STEND                          S01280
     C                     END                                            S01280
      *                                                                   S01280
     C           @DIRS     IFNE *BLANK                                    S01280
     C                     MOVE 'IRS'     @BLINE                          S01280
     C                     MOVE @HKCCY    @IRCCY                          S01280
     C                     MOVE @HKCYY    @IVDAT                          S01280
     C                     MOVE *LOVAL    @IAMT                           S01280
     C                     MOVE *LOVAL    @IRDNO                          S01280
     C                     MOVE 'Y'       @KEYSU                          S01280
     C                     ELSE                                           S01280
     C                     MOVE 'END  '   @STEND                          S01280
     C                     END                                            S01280
      *                                                                   S01280
     C                     ELSE                            *1             S01280
     C                     MOVE *BLANKS   @STEND           *1             S01280
     C                     MOVE 'Y'       @FRAY            *1             S01280
     C                     END                             E1             S01280
     C                     END                                            S01280
      *                                                                   S01280
      *   If last record was IRS.                                         S01280
     C           @BLINE    IFEQ 'IRS'                                     S01280
      *                                                                   S01280
     C           @PREVE    IFEQ 'D'                                       S01280
     C           @KEYSU    ANDNE'Y'                                       S01280
     C                     MOVE VARKB1    @VRFSH                          S01280
     C                     END                                            S01280
      *                                                                   S01280
     C           @DLKY8    SETGTDLDLIRLL                                  S01280
     C           @DLKY7    READEDLDLIRLL                 70               S01280
      *                                                                   S01280
     C           @DLKY8    SETGTDLDLIRLL                                  S01280
     C**  If 70 has been set we are at end so move 'END' message          S01280
      *   else set Y to @IRSY to prevent SETLL on DLDLIRLL in #BH.        S01280
      *   If not end move blanks to @STEND + leave #BH to find if         S01280
      *   end.                                                            S01280
     C           *IN70     IFEQ '1'                        B1             S01280
      *                                                                   S01280
      **  It may be the case that the last record on screen is the last   S01280
      **  record for this file.However FUTURES might have been selected   S01280
      **  if so set up full key.                                          S01280
     C           @DFUT     IFNE *BLANK                                    S01280
     C                     MOVE 'FUT'     @BLINE                          S01280
     C                     MOVE @HKCCY    @FUCCY                          S01280
     C                     MOVE @HKCYY    @FDAT                           S01280
     C                     MOVE *LOVAL    @FUDNO                          S01280
     C                     MOVE 'Y'       @KEYSU                          S01280
     C                     ELSE                                           S01280
     C                     MOVE 'END  '   @STEND                          S01280
     C                     END                                            S01280
      *                                                                   S01280
     C                     ELSE                            *1             S01280
     C                     MOVE 'Y'       @IRSY            *1             S01280
     C                     MOVE *BLANKS   @STEND           *1             S01280
     C                     END                             E1             S01280
     C                     END                                            S01280
      *                                                                   S01280
      *   If last record was FUTURES.                                     S01280
     C           @BLINE    IFEQ 'FUT'                      B1             S01280
      *                                                                   S01280
     C           @PREVE    IFEQ 'D'                        B*2            S01280
     C           @KEYSU    ANDNE'Y'                                       S01280
     C                     MOVE UARKB1    @URFSH                          S01280
     C                     END                             E*2            S01280
      *                                                                   S01280
     C           @DLKY6    SETGTDLFUTSLL                                  S01280
     C           @DLKY3    READEDLFUTSLL                 70               S01280
      *                                                                   S01280
     C           @DLKY6    SETGTDLFUTSLL                                  S01280
      *                                                                   S01280
     C**  If 70 has been set we are at end so move 'END' message          S01280
      *   If not end move blanks to @STEND + leave #BH to find if         S01280
      *   end.                                                            S01280
     C           *IN70     IFEQ '1'                        B1             S01280
     C                     MOVE 'END  '   @STEND           *1             S01280
     C                     ELSE                            *1             S01280
     C                     MOVE *BLANKS   @STEND           *1             S01280
     C                     MOVE 'Y'       @FUTY            *1             S01280
     C                     END                             E1             S01280
     C                     END                             E1             S01280
      *                                                                   S01280
      *                                                                   SO1166
     C           #BE9      ENDSR                           ** #BE9 **
      *
      *****************************************************************
      /EJECT
      *****************************************************************
      *                                                               *
      *  #BF - THIS ROUTINE CONTROLS THE GENERATION OF DATES FOR      *
      *        THE FOLLOWING ENQUIRY UPDATED INPUT PARAMETER VALUES:  *
      *                                                               *
      *            'D' - ROLL DOWN                                    *
      *                                                               *
      *  CALLED BY : #B                                               *
      *                                                               *
      *  CALLS :                                                      *
      *                                                               *
      *  USES:       @HKKY8 - FULL KEY FOR MMDVMALL                   *
      *              @HKKY4 - PARTIAL KEY FOR MMDVMALL                *
      *              @STEND - START/END NARRATIVE                     *
      *                                                               *
      *****************************************************************
      *
     C           #BF       BEGSR
      *                                                                   S01280
      *   If top record was FUT.                                          S01280
     C           @RLWDN    IFEQ 'FUT'                      B1             S01280
     C           @DFUT     ORNE *BLANKS                                   S01280
     C           @RLWDN    ANDEQ*BLANKS                                   S01280
     C           @PREVE    IFNE 'D'                        B*2            S01280
     C                     MOVE UARKT1    @URFSH                          S01280
     C                     END                             E*2            S01280
      *                                                                   S01280
      *   Check if there are any previous records for this currency       S01280
      *   date/type.                                                      S01280
     C           @DLKY6    SETLLDLFUTSLL                                  S01280
     C                     READPDLFUTSLL                 70               S01280
      *                                                                   S01280
      **  Determine whether currency/date/type has changed.               S01280
     C           HKCCY     IFNE @HKCCY                     B*2            S01280
     C                     MOVE '1'       *IN70                           S01280
      *                                                                   S01280
     C                     ELSE                            X*2            S01280
      *                                                                   S01280
     C           SETL      IFNE @@MNO                      B**3           S01280
     C                     MOVE '1'       *IN70                           S01280
     C                     END                             E**3           S01280
      *                                                                   S01280
     C                     END                             E*2            S01280
      *                                                                   S01280
      **  If 70 is on move 'START' to @STEND else move blanks and leave   S01280
      **  #BG to determine START.                                         S01280
     C           *IN70     IFEQ '1'                        B*2            S01280
      *                                                                   S01280
      **  It may be the case that the firstrecord on screen is the frst   S01280
      **  record for this file.However other deal types might have been   S01280
      **  selected.If others selected set up full key.                    S01280
     C           @LDNA     IFNE *BLANK                     B**3           S01280
     C                     MOVE 'CAD'     @RLWDN                          S01280
     C                     MOVE *HIVAL    @HKCY1                          S01280
     C                     MOVE *HIVAL    @HKMM1                          S01280
     C                     MOVE *HIVAL    @HKDD1                          S01280
     C                     MOVE *HIVAL    @HKAMN                          S01280
     C                     MOVE *HIVAL    @HKDNO                          S01280
      *  If key set up here do not want @preve processing on sel file.    S01280
     C                     MOVE 'Y'       @KEYSD  1                       S01280
     C                     ELSE                            X**3           S01280
     C                     MOVE 'START'   @STEND                          S01280
     C                     END                             E**3           S01280
      *                                                                   S01280
     C           @DLEN     IFNE *BLANK                     B**3           S01280
     C                     MOVE 'LEN'     @RLWDN                          S01280
     C                     MOVE *HIVAL    @LVDAT                          S01280
     C                     MOVE *HIVAL    @LAMT                           S01280
     C                     MOVE *HIVAL    @LELNO                          S01280
     C                     MOVE 'Y'       @KEYSD                          S01280
     C                     ELSE                            X**3           S01280
     C                     MOVE 'START'   @STEND                          S01280
     C                     END                             E**3           S01280
      *                                                                   S01280
     C           @DFRA     IFNE *BLANK                     B**3           S01280
     C                     MOVE 'FRA'     @RLWDN                          S01280
     C                     MOVE *HIVAL    @FAMT                           S01280
     C                     MOVE *HIVAL    @FDLNO                          S01280
     C                     MOVE 'Y'       @KEYSD                          S01280
     C                     ELSE                            X**3           S01280
     C                     MOVE 'START'   @STEND                          S01280
     C                     END                             E**3           S01280
      *                                                                   S01280
     C           @DIRS     IFNE *BLANK                     B**3           S01280
     C                     MOVE 'IRS'     @RLWDN                          S01280
     C                     MOVE *HIVAL    @IAMT                           S01280
     C                     MOVE *HIVAL    @IRDNO                          S01280
     C                     MOVE 'Y'       @KEYSD                          S01280
     C                     ELSE                            X**3           S01280
     C                     MOVE 'START'   @STEND                          S01280
     C                     END                             E**3           S01280
      *                                                                   S01280
     C                     ELSE                            X*2            S01280
      *                                                                   S01280
     C           @DLKY6    SETLLDLFUTSLL                                  S01280
     C                     MOVE 'Y'       @FUTY                           S01280
     C                     MOVE *BLANKS   @STEND                          S01280
     C                     END                             E*2            S01280
     C                     END                             E1             S01280
      *                                                                   S01280
      *   If top record was IRS.                                          S01280
     C           @RLWDN    IFEQ 'IRS'                                     S01280
     C           @DIRS     ORNE *BLANKS                                   S01280
     C           @RLWDN    ANDEQ*BLANKS                                   S01280
     C           @PREVE    IFNE 'D'                                       S01280
     C           @KEYSD    ANDNE'Y'                                       S01280
     C                     MOVE VARKT1    @VRFSH                          S01280
     C                     END                                            S01280
      *   Check if there are any previous records for this currency       S01280
      *   date/type.                                                      S01280
     C           @DLKY8    SETLLDLDLIRLL                                  S01280
     C                     READPDLDLIRLL                 70               S01280
     C           *IN70     IFEQ '0'                                       S01280
      *                                                                   S01280
      **  Determine whether currency/date/type has changed.               S01280
     C           HKCCY     IFNE @HKCCY                                    S01280
     C                     MOVE '1'       *IN70                           S01280
      *                                                                   S01280
     C                     ELSE                                           S01280
      *                                                                   S01280
     C           MDAT      IFNE @@MNO                                     S01280
     C                     MOVE '1'       *IN70                           S01280
     C                     END                                            S01280
      *                                                                   S01280
     C                     END                                            S01280
      *                                                                   S01280
     C                     END                                            S01280
      *                                                                   S01280
     C           @DLKY8    SETLLDLDLIRLL                                  S01280
      **  If 70 is on move 'START' to @STEND else move blanks and leave   S01280
      **  #BG to determine START.                                         S01280
     C           *IN70     IFEQ '1'                                       S01280
      *                                                                   S01280
      **  It may be the case that the firstrecord on screen is the frst   S01280
      **  record for this file.However other deal types might have been   S01280
      **  selected.If others selected set up full key.                    S01280
     C           @LDNA     IFNE *BLANK                                    S01280
     C                     MOVE 'CAD'     @RLWDN                          S01280
     C                     MOVE *HIVAL    @HKCY1                          S01280
     C                     MOVE *HIVAL    @HKMM1                          S01280
     C                     MOVE *HIVAL    @HKDD1                          S01280
     C                     MOVE *HIVAL    @HKAMN                          S01280
     C                     MOVE *HIVAL    @HKDNO                          S01280
     C                     MOVE 'Y'       @KEYSD                          S01280
     C                     ELSE                                           S01280
     C                     MOVE 'START'   @STEND                          S01280
     C                     END                                            S01280
      *                                                                   S01280
     C           @DLEN     IFNE *BLANK                                    S01280
     C                     MOVE 'LEN'     @RLWDN                          S01280
     C                     MOVE *HIVAL    @LVDAT                          S01280
     C                     MOVE *HIVAL    @LAMT                           S01280
     C                     MOVE *HIVAL    @LELNO                          S01280
     C                     MOVE 'Y'       @KEYSD                          S01280
     C                     ELSE                                           S01280
     C                     MOVE 'START'   @STEND                          S01280
     C                     END                                            S01280
      *                                                                   S01280
     C           @DFRA     IFNE *BLANK                                    S01280
     C                     MOVE 'FRA'     @RLWDN                          S01280
     C                     MOVE *HIVAL    @FAMT                           S01280
     C                     MOVE *HIVAL    @FDLNO                          S01280
     C                     MOVE 'Y'       @KEYSD                          S01280
     C                     ELSE                                           S01280
     C                     MOVE 'START'   @STEND                          S01280
     C                     END                                            S01280
      *                                                                   S01280
     C                     ELSE                                           S01280
     C                     MOVE 'Y'       @IRSY                           S01280
     C                     MOVE *BLANKS   @STEND                          S01280
     C                     END                                            S01280
     C                     END                                            S01280
      *                                                                   S01280
      *   If top record was FRA.                                          S01280
     C           @RLWDN    IFEQ 'FRA'                                     S01280
     C           @DFRA     ORNE *BLANKS                                   S01280
     C           @RLWDN    ANDEQ*BLANKS                                   S01280
     C           @PREVE    IFNE 'D'                                       S01280
     C           @KEYSD    ANDNE'Y'                                       S01280
     C                     MOVE TARKT1    @TRFSH                          S01280
     C                     END                                            S01280
      *   Check if there are any previous records for this currency       S01280
      *   date/type.                                                      S01280
     C           @DLKY5    SETLLDLDLFRLL                                  S01280
     C                     READPDLDLFRLL                 70               S01280
     C           *IN70     IFEQ '0'                                       S01280
      *                                                                   S01280
      **  Determine whether currency/date/type has changed.               S01280
     C           HKCCY     IFNE @HKCCY                                    S01280
     C                     MOVE '1'       *IN70                           S01280
      *                                                                   S01280
     C                     ELSE                                           S01280
      *                                                                   S01280
     C           VDAT      IFNE @@MNO                                     S01280
     C           MDAT      ANDNE@@MNO                                     S01280
     C                     MOVE '1'       *IN70                           S01280
     C                     END                                            S01280
      *                                                                   S01280
     C                     END                                            S01280
      *                                                                   S01280
     C                     END                                            S01280
      *                                                                   S01280
     C           @DLKY5    SETLLDLDLFRLL                                  S01280
      *                                                                   S01280
      **  If 70 is on move 'START' to @STEND else move blanks and leave   S01280
      **  #BG to determine START.                                         S01280
     C           *IN70     IFEQ '1'                                       S01280
      *                                                                   S01280
      **  It may be the case that the firstrecord on screen is the frst   S01280
      **  record for this file.However other deal types might have been   S01280
      **  selected.If others selected set up full key.                    S01280
     C           @LDNA     IFNE *BLANK                                    S01280
     C                     MOVE 'CAD'     @RLWDN                          S01280
     C                     MOVE *HIVAL    @HKCY1                          S01280
     C                     MOVE *HIVAL    @HKMM1                          S01280
     C                     MOVE *HIVAL    @HKDD1                          S01280
     C                     MOVE *HIVAL    @HKAMN                          S01280
     C                     MOVE *HIVAL    @HKDNO                          S01280
     C                     MOVE 'Y'       @KEYSD                          S01280
     C                     ELSE                                           S01280
     C                     MOVE 'START'   @STEND                          S01280
     C                     END                                            S01280
      *                                                                   S01280
     C           @DLEN     IFNE *BLANK                                    S01280
     C                     MOVE 'LEN'     @RLWDN                          S01280
     C                     MOVE *HIVAL    @LVDAT                          S01280
     C                     MOVE *HIVAL    @LAMT                           S01280
     C                     MOVE *HIVAL    @LELNO                          S01280
     C                     MOVE 'Y'       @KEYSD                          S01280
     C                     ELSE                                           S01280
     C                     MOVE 'START'   @STEND                          S01280
     C                     END                                            S01280
      *                                                                   S01280
     C                     ELSE                                           S01280
     C                     MOVE 'Y'       @FRAY                           S01280
     C                     MOVE *BLANKS   @STEND                          S01280
     C                     END                                            S01280
     C                     END                                            S01280
      *                                                                   S01280
      *   If top record was LENDING.                                      S01280
     C           @RLWDN    IFEQ 'LEN'                                     S01280
     C           @DLEN     ORNE *BLANKS                                   S01280
     C           @RLWDN    ANDEQ*BLANKS                                   S01280
     C           @PREVE    IFNE 'D'                                       S01280
     C           @KEYSD    ANDNE'Y'                                       S01280
     C                     MOVE SARKT1    @SRFSH                          S01280
     C                     END                                            S01280
      *   Check if there are any previous records for this currency       S01280
      *   date/type.                                                      S01280
     C           @DLKY4    SETLLDLCLONLL                                  S01280
     C                     READPDLCLONLL                 70               S01280
     C           *IN70     IFEQ '0'                                       S01280
      *                                                                   S01280
      **  Determine whether currency/date/type has changed.               S01280
     C           HKCCY     IFNE @HKCCY                                    S01280
     C                     MOVE '1'       *IN70                           S01280
      *                                                                   S01280
     C                     ELSE                                           S01280
      *                                                                   S01280
     C           VDAT      IFNE @@MNO                                     S01280
     C           MDAT      ANDNE@@MNO                                     S01280
     C                     MOVE '1'       *IN70                           S01280
     C                     END                                            S01280
      *                                                                   S01280
     C                     END                                            S01280
      *                                                                   S01280
     C                     END                                            S01280
      *                                                                   S01280
     C           @DLKY4    SETLLDLCLONLL                                  S01280
      *                                                                   S01280
      **  If 70 is on move 'START' to @STEND else move blanks and leave   S01280
      **  #BG to determine START.                                         S01280
     C           *IN70     IFEQ '1'                                       S01280
      *                                                                   S01280
      **  It may be the case that the firstrecord on screen is the frst   S01280
      **  record for this file.However other deal types might have been   S01280
      **  selected.If others selected set up full key.                    S01280
     C           @LDNA     IFNE *BLANK                                    S01280
     C                     MOVE 'CAD'     @RLWDN                          S01280
     C                     MOVE *HIVAL    @HKCY1                          S01280
     C                     MOVE *HIVAL    @HKMM1                          S01280
     C                     MOVE *HIVAL    @HKDD1                          S01280
     C                     MOVE *HIVAL    @HKAMN                          S01280
     C                     MOVE *HIVAL    @HKDNO                          S01280
     C                     MOVE 'Y'       @KEYSD                          S01280
     C                     ELSE                                           S01280
     C                     MOVE 'START'   @STEND                          S01280
     C                     END                                            S01280
      *                                                                   S01280
     C                     ELSE                                           S01280
     C                     MOVE 'Y'       @LENY                           S01280
     C                     MOVE *BLANKS   @STEND                          S01280
     C                     END                                            S01280
     C                     END                                            S01280
      *
     C**  If previous operation was not roll down in order to position    SO1166
     C**   file on top record we have to set key to value of              SO1166
     C**  first record read in previous operation                         SO1166
     C           @RLWDN    IFEQ 'CAD'                                     S01280
     C           @LDNA     ORNE *BLANKS                                   S01280
     C           @RLWDN    ANDEQ*BLANKS                                   S01280
     C           @PREVE    IFNE 'D'                                       SO1166
     C           @KEYSD    ANDNE'Y'                                       S01280
     C                     MOVE FARKT1    @RRFSH                          SO1166
     C                     END                                            SO1166
     C*                                                                   SO1166
      **  Check if start point of roll down is last record for
      **  currency/date/type.                                             S01149
     C******     @HKKY8    SETLLMMDVMALL                                  S01145
     C******     @HKKY4    READEMMDVMALL                 76               S01145
     C           @HKKY8    SETLLCADVMALL                                  S01145
     C           @HKKY4    READECADVMALL                 76               S01145
      *
      **  Set start/end narrative.
     C           *IN76     IFEQ '1'                        B1
     C                     MOVE 'END  '   @STEND           *1
     C                     END                             E1
      *
      **  Check if there are any previous records for this
      **  currency/date/type.                                             S01149
     C******     @HKKY8    SETLLMMDVMALL                                  S01145
     C******               READPMMDVMALL                 70               S01145
     C           @HKKY8    SETLLCADVMALL                                  S01145
     C                     READPCADVMALL                 70               S01145
     C           *IN70     IFEQ '0'                        B1
      *
      **  Determine whether currency/date/type has changed.               S01149
     C           HKCCY     IFNE @HKCCY                     B*2
     C                     MOVE '1'       *IN70            **2
      *
     C                     ELSE                            X*2
      *
     C           @VDATE    IFNE @RDATE                     B**3
     C           @MDATE    ANDNE@RDATE                     ***3
     C                     MOVE '1'       *IN70            ***3
     C                     END                             E**3
      *
      **  Where either L/D or N/A selected check that the type just       S01280
      **  selected is correct for the deal type selected.                 S01280
     C           @DNA      IFNE *BLANKS                                   S01280
     C           @DLD      ANDEQ*BLANKS                                   S01280
      *   N/A and deal type is not for N/A.                               S01280
     C           HKTYPE    IFNE 'C1'                                      S01280
     C           HKTYPE    ANDNE'C2'                                      S01280
     C           HKTYPE    ANDNE'BO'                                      S01280
     C           HKTYPE    ANDNE'BI'                                      S01280
     C           HKTYPE    ANDNE'TB'                                      S01280
     C           HKTYPE    ANDNE'BA'                                      S01280
     C           HKTYPE    ANDNE'TA'                                      S01280
     C                     MOVE '1'       *IN70                           S01280
     C                     END                                            S01280
     C                     END                                            S01280
      *                                                                   S01280
     C           @DLD      IFNE *BLANKS                                   S01280
     C           @DNA      ANDEQ*BLANKS                                   S01280
      *   L/D and deal type is not for L/D.                               S01280
     C           HKTYPE    IFEQ 'C1'                                      S01280
     C           HKTYPE    OREQ 'C2'                                      S01280
     C           HKTYPE    OREQ 'BO'                                      S01280
     C           HKTYPE    OREQ 'BI'                                      S01280
     C           HKTYPE    OREQ 'TB'                                      S01280
     C           HKTYPE    OREQ 'BA'                                      S01280
     C           HKTYPE    OREQ 'TA'                                      S01280
     C                     MOVE '1'       *IN70                           S01280
     C                     END                                            S01280
     C                     END                                            S01280
      *                                                                   S01280
      **  If both LD/NA selected ensure that if at beginning cannot       S01280
      **  select a prior record LD or NA with valid VDAT or MDAT from     S01280
      **  a previous format which would result in 'random' rolling        S01280
      **  down before the start.                                          S01280
     C           @RTYP     IFEQ 'ALL'                                     S01280
     C           @STEND    ANDEQ'START'                                   S01280
     C                     MOVE '1'       *IN70                           S01280
     C                     END                                            S01280
      *                                                                   S01280
     C                     END                             E*2
      *
     C                     END                             E1
      *
      **  Position file before record for currency/date/type/roll-        S01149
      **  refresh key field.                                              S01149
     C*                                                                   SO1166
     C******     @HKKY8    SETLLMMDVMALL                                  S01145
     C           @HKKY8    SETLLCADVMALL                                  S01145
      *
     C**  If 70 has been set we are at top so move 'START' message        SO1166
      **  else move blanks and leave #BG to determine if start.           S01280
     C           *IN70     IFEQ '1'                        B1             SO1166
     C                     MOVE 'START'   @STEND           *1             SO1166
     C                     ELSE                            *1             S01280
     C                     MOVE 'Y'       @CADY            *1             S01280
     C                     MOVE *BLANKS   @STEND           *1             S01280
     C                     END                             E1             SO1166
      *                                                                   SO1166
     C                     END                                            S01280
     C           #BF9      ENDSR                           ** #BF9 **
      *
      *****************************************************************
      /EJECT
      *****************************************************************
      *                                                               *
      *  #BG - THIS ROUTINE SETS UP FIELDS DERIVED FROM MMDVMALL      *
      *        IN THE DATA STRUCTURE @AMENQ AS FOLLOWS:               *
      *                                                               *
      ******** A MAXIMUM OF 11 RECORDS ARE EXTRACTED FOR SPECIFIED    *   SO1166
      *        A MAXIMUM OF 16 RECORDS ARE EXTRACTED FOR SPECIFIED    *   SO1166
      *        CURRENCY/DATE/TYPE FROM CADVMALL BY READING BACKWARDS. *   S01149
      *                                                               *
      *        AMOUNTS, RATES AND DATES ARE EDITED FOR DISPLAY.       *
      *                                                               *
      *        ALL EDITED FIELDS SO OBTAINED ARE PLACED IN THEIR      *
      *        CORRESPONDING POSITIONS OF THE DATA STRUCTURE @DETLS,  *
      *        WHICH IS THEN MOVED INTO THE RELEVANT POSITION FOR     *
      *        THIS RECORD IN THE DATA STRUCTURE @AMENQ USING THE     *
      *        ARRAY @AM.                                             *
      *                                                               *
      *  CALLED BY : #B                                               *
      *                                                               *
      *  CALLS :     MM1016                                           *
      *              ZA0720                                           *
      *              #ZA                                              *
      *                                                               *
      *  USES:     @I     - COUNTER                                   *
      *            @HKCCY - CURRENCY FROM FAEPT1                      *
      *            @VDATE - VALUE DATE YYYYMMDD                       *
      *            @RDATE - REQUESTED DATE FROM FAEPT1 YYYYMMDD       *
      *            @MDATE - MATURITY DATE YYYYMMDD                    *
      *            @STEND - START/END NARRATIVE                       *
      *            @@DTIN - INPUT DATE TO ZA0720 YYYYMMDD             *
      *            @@DATE - OUTPUT DATE FROM ZA0720 DDMMMYY/MMMDDYY   *
      *            @MVDAT - EDITED 'OTHER' DATE DDMMMYY/MMMDDYY       *
      *            @@RIN  - INPUT RATE TO #ZA                         *
      *            @B     - OUTPUT RATE FROM #ZA                      *
      *            @INTRT - EDITED RATE                               *
      *            @@IAMT - INPUT AMOUNT TO MM1016                    *
      *            @@CCY  - INPUT CURRENCY TO MM1016                  *
      *            @@AMOU - OUTPUT AMOUNT FROM MM1016                 *
      *            @PRAMT - EDITED AMOUNT                             *
      *            @X     - INDEX                                     *
      *            @DETLS - DATA STRUCTURE WHICH HOLDS MMDVMALL       *
      *                     INFORMATION FOR EACH RECORD               *
      *            @AM    - ARRAY OF MMDVMALL DATA FOR EACH RECORD    *
      *            @RRFSH - ROLL/REFRESH KEY FIELD                    *
      *                                                               *
      *****************************************************************
      *
     C           #BG       BEGSR
      *
     C                     Z-ADD1         @I      20                      S01149
     C                     Z-ADD0         @PREV                           S01145
      *   Once only flags to SETGT on file if pointer not repositioned    S01280
      *   in #BF(only top of screen record repositioned).                 S01280
     C                     MOVE 'N'       @BKIR   1                       S01280
     C                     MOVE 'N'       @BKFR   1                       S01280
     C                     MOVE 'N'       @BKLE   1                       S01280
     C                     MOVE 'N'       @BKCAD  1                       S01280
      *                                                                   S01280
      *   If Roll down selected and record found set @@FILE according     S01280
      *   to the record selected.                                         S01280
     C           @CADY     IFEQ 'Y'                                       S01280
     C                     MOVE 'CAD'     @@FILE                          S01280
     C                     END                                            S01280
      *                                                                   S01280
     C           @LENY     IFEQ 'Y'                                       S01280
     C                     MOVE 'LEN'     @@FILE                          S01280
     C                     END                                            S01280
      *                                                                   S01280
     C           @FRAY     IFEQ 'Y'                                       S01280
     C                     MOVE 'FRA'     @@FILE                          S01280
     C                     END                                            S01280
      *                                                                   S01280
     C           @IRSY     IFEQ 'Y'                                       S01280
     C                     MOVE 'IRS'     @@FILE                          S01280
     C                     END                                            S01280
      *                                                                   S01280
     C           @FUTY     IFEQ 'Y'                                       S01280
     C                     MOVE 'FUT'     @@FILE  3                       S01280
     C                     END                                            S01280
      **  Read the previous 11 records on CADVMALL for currency/date/     S01149
      **  type.                                                           S01149
     C******               DO   12        @I      20       B1             S01149
     C*******    @I        DOUEQ12                         B1      S01149 SO1166
     C********** @I        DOUEQ16                         B1      SO1166 S01280
     C           @I        DOUEQ15                         B1             S01280
     C******               READPMMDVMALL                 76*1             S01145
      *                                                                   S01280
      **  If next file to process is FUTURES,and has been selected and    S01280
      **  has not finished processing process DLFUTSLL.                   S01280
     C           @@FILE    IFEQ 'FUT'                      B1             S01280
      *                                                                   S01280
     C                     READPDLFUTSLL                 76               S01280
     C                     MOVE *BLANKS   HKTYPE           stop hktypeprocS01280
      *                                                                   S01280
      **  Determine whether currency/date/type has changed.               S01280
     C           HKCCY     IFNE @HKCCY                     B*2            S01280
     C                     MOVE '1'       *IN76            **2            S01280
      *                                                                   S01280
     C                     ELSE                            X*2            S01280
      *                                                                   S01280
     C           SETL      IFNE @@MNO                      B**3           S01280
     C                     MOVE '1'       *IN76            ***            S01280
     C                     END                             E**3           S01280
      *                                                                   S01280
     C                     END                             E*2            S01280
      *                                                                   S01280
      * If file finished processing and nothing else selected end.        S01280
     C           *IN76     IFEQ '1'                        B*2            S01280
     C           @DIRS     ANDEQ*BLANK                                    S01280
     C           @DFRA     ANDEQ*BLANK                                    S01280
     C           @DLEN     ANDEQ*BLANK                                    S01280
     C           @LDNA     ANDEQ*BLANK                                    S01280
     C                     MOVE 'START'   @STEND                          S01280
     C                     GOTO #BG9                                      S01280
     C                     END                             E*2            S01280
      *                                                                   S01280
      * If this file has finished processing set @@FILE to the next       S01280
      * file to be processed.                                             S01280
     C           *IN76     IFEQ '1'                        B*2            S01280
      *                                                                   S01280
     C           @LDNA     IFNE *BLANK                     B*3            S01280
     C                     MOVE 'CAD'     @@FILE                          S01280
     C                     END                             E*3            S01280
      *                                                                   S01280
     C           @DLEN     IFNE *BLANK                     B*3            S01280
     C                     MOVE 'LEN'     @@FILE                          S01280
     C                     END                             E*3            S01280
      *                                                                   S01280
     C           @DFRA     IFNE *BLANK                     B*3            S01280
     C                     MOVE 'FRA'     @@FILE                          S01280
     C                     END                             E*3            S01280
      *                                                                   S01280
     C           @DIRS     IFNE *BLANK                     B*3            S01280
     C                     MOVE 'IRS'     @@FILE                          S01280
     C                     END                             E*3            S01280
      *                                                                   S01280
     C                     END                             E*2            S01280
     C                     END                             E1             S01280
      *                                                                   S01280
      **  If next file to process is IRS,process DLDLIRLL.                S01280
     C           @@FILE    IFEQ 'IRS'                      B1             S01280
      *                                                                   S01280
      **  If the file pointer has not been reset for this file in #BF     S01280
      **  (was not top line on prior screen) reset file pointer.          S01280
     C           @IRSY     IFNE 'Y'                        B*2            S01280
     C           @BKIR     ANDEQ'N'                                       S01280
     C                     MOVE *HIVAL    @IAMT                           S01280
     C                     MOVE *HIVAL    @IRDNO                          S01280
     C           @DLKY8    SETGTDLDLIRLL                                  S01280
     C                     MOVE 'Y'       @BKIR                           S01280
     C                     END                             E*2            S01280
      *                                                                   S01280
      *                                                                   S01280
     C                     READPDLDLIRLL                 76               S01280
      *                                                                   S01280
     C           *IN76     IFEQ '0'                        B*2            S01280
      *                                                                   S01280
      **  Determine whether currency/date/type has changed.               S01280
     C           HKCCY     IFNE @HKCCY                     B**3           S01280
     C                     MOVE '1'       *IN76            ***3           S01280
      *                                                                   S01280
     C                     ELSE                            X**3           S01280
      *                                                                   S01280
     C           FILRC2    IFEQ 'DLDLIRF1'                 B***4          S01280
     C           MDAT      ANDNE@@MNO                      ****4          S01280
     C           FILRC2    OREQ 'DLDLIRF2'                 ****4          S01280
     C           MDAT      ANDNE@@MNO                      ****4          S01280
     C                     MOVE '1'       *IN76            ****4          S01280
     C                     END                             E***4          S01280
      *                                                                   S01280
     C                     END                             E**3           S01280
      *                                                                   S01280
     C                     END                             E*2            S01280
      *                                                                   S01280
      * If file finished processing and nothing else selected end.        S01280
     C           *IN76     IFEQ '1'                        B*2            S01280
     C           @DFRA     ANDEQ*BLANK                                    S01280
     C           @DLEN     ANDEQ*BLANK                                    S01280
     C           @LDNA     ANDEQ*BLANK                                    S01280
     C                     MOVE 'START'   @STEND                          S01280
     C                     GOTO #BG9                                      S01280
     C                     END                             E*2            S01280
      * If this file has finished processing set @@FILE to next selected  S01280
      * file.                                                             S01280
     C           *IN76     IFEQ '1'                        B*2            S01280
      *                                                                   S01280
     C           @LDNA     IFNE *BLANK                     B**3           S01280
     C                     MOVE 'CAD'     @@FILE                          S01280
     C                     END                             E**3           S01280
      *                                                                   S01280
     C           @DLEN     IFNE *BLANK                     B**3           S01280
     C                     MOVE 'LEN'     @@FILE                          S01280
     C                     END                             E**3           S01280
      *                                                                   S01280
     C           @DFRA     IFNE *BLANK                     B**3           S01280
     C                     MOVE 'FRA'     @@FILE                          S01280
     C                     END                             E**3           S01280
      *                                                                   S01280
     C                     END                             E*2            S01149
     C                     END                             E1             S01280
      *                                                                   S01280
      **  If next file to process is FRA, process DLDLFRLL.               S01280
     C           @@FILE    IFEQ 'FRA'                      B1             S01280
      *                                                                   S01280
      **  If the file pointer has not been reset for this file in #BF     S01280
      **  (was not top line on prior screen) reset file pointer.          S01280
     C           @FRAY     IFNE 'Y'                        B*2            S01280
     C           @BKFR     ANDEQ'N'                                       S01280
     C                     MOVE *HIVAL    @FAMT                           S01280
     C                     MOVE *HIVAL    @FDLNO                          S01280
     C           @DLKY5    SETGTDLDLFRLL                                  S01280
     C                     MOVE 'Y'       @BKFR                           S01280
     C                     END                             E*2            S01280
      *                                                                   S01280
     C                     READPDLDLFRLL                 76               S01280
      *                                                                   S01280
     C           *IN76     IFEQ '0'                        B*2            S01280
      *                                                                   S01280
      **  Determine whether currency/date/type has changed.               S01280
     C           HKCCY     IFNE @HKCCY                     B**3           S01280
     C                     MOVE '1'       *IN76            ***3           S01280
      *                                                                   S01280
     C                     ELSE                            X**3           S01280
      *                                                                   S01280
     C           FILRC1    IFEQ 'DLDLFRF1'                 B***4          S01280
     C           VDAT      ANDNE@@MNO                      ****4          S01280
     C           FILRC1    OREQ 'DLDLFRF2'                 ****4          S01280
     C           MDAT      ANDNE@@MNO                      ****4          S01280
     C                     MOVE '1'       *IN76            ****4          S01280
     C                     END                             E***4          S01280
      *                                                                   S01280
     C                     END                             E**3           S01280
      *                                                                   S01280
     C                     END                             E*2            S01280
      *                                                                   S01280
      * If file finished processing and nothing else selected end.        S01280
     C           *IN76     IFEQ '1'                        B*2            S01280
     C           @DLEN     ANDEQ*BLANK                                    S01280
     C           @LDNA     ANDEQ*BLANK                                    S01280
     C                     MOVE 'START'   @STEND                          S01280
     C                     GOTO #BG9                                      S01280
     C                     END                             E*2            S01280
      * If this file has finished processing set up next file selected to S01280
      * @@FILE.                                                           S01280
     C           *IN76     IFEQ '1'                        B*2            S01280
      *                                                                   S01280
     C           @LDNA     IFNE *BLANK                     B**3           S01280
     C                     MOVE 'CAD'     @@FILE                          S01280
     C                     END                             E**3           S01280
      *                                                                   S01280
     C           @DLEN     IFNE *BLANK                     B**3           S01280
     C                     MOVE 'LEN'     @@FILE                          S01280
     C                     END                             E**3           S01280
      *                                                                   S01280
     C                     END                             E*2            S01280
     C                     END                             E1             S01280
      *                                                                   S01280
      **  If next file to process is LENDING, process DLCLONLL.           S01280
     C           @@FILE    IFEQ 'LEN'                      B1             S01280
      *                                                                   S01280
      **  If the file pointer has not been reset for this file in #BF     S01280
      **  (was not top line on prior screen) reset file pointer.          S01280
     C           @LENY     IFNE 'Y'                        B*2            S01280
     C           @BKLE     ANDEQ'N'                                       S01280
     C                     MOVE *HIVAL    @LAMT                           S01280
     C                     MOVE *HIVAL    @LELNO                          S01280
     C                     MOVE *HIVAL    @LVDAT                          S01280
     C           @DLKY4    SETGTDLCLONLL                                  S01280
     C                     MOVE 'Y'       @BKLE                           S01280
     C                     END                             E*2            S01280
      *                                                                   S01280
     C                     READPDLCLONLL                 76               S01280
     C                     MOVE *BLANKS   HKTYPE           stop hktypeprocS01280
      *                                                                   S01280
     C           *IN76     IFEQ '0'                        B*2            S01280
      *                                                                   S01280
      **  Determine whether currency/date/type has changed.               S01280
     C           HKCCY     IFNE @HKCCY                     B**3           S01280
     C                     MOVE '1'       *IN76            ***3           S01280
      *                                                                   S01280
     C                     ELSE                            X**3           S01280
      *                                                                   S01280
     C           VDAT      IFNE @@MNO                      B***4          S01280
     C           MDAT      ANDNE@@MNO                      B***4          S01280
     C                     MOVE '1'       *IN76            ****4          S01280
     C                     END                             E***4          S01280
      *                                                                   S01280
     C                     END                             E**3           S01280
      *                                                                   S01280
     C                     END                             E*2            S01280
      *                                                                   S01280
      * If file finished processing and nothing else selected end.        S01280
     C           *IN76     IFEQ '1'                        B*2            S01280
     C           @LDNA     ANDEQ*BLANK                                    S01280
     C                     MOVE 'START'   @STEND                          S01280
     C                     GOTO #BG9                                      S01280
     C                     END                             E*2            S01280
      * If this file has finished processing set next file selected to    S01280
      * @@FILE.                                                           S01280
     C           *IN76     IFEQ '1'                        B*2            S01280
      *                                                                   S01280
     C           @LDNA     IFNE *BLANK                     B**3           S01280
     C                     MOVE 'CAD'     @@FILE                          S01280
     C                     END                             E**3           S01280
      *                                                                   S01280
     C                     END                             E*2            S01149
     C                     END                             E1             S01280
      *                                                                   S01280
      **  If next file to process is L/D-N/A,process CADVMALL.            S01280
     C           @@FILE    IFEQ 'CAD'                      B1             S01280
      *                                                                   S01280
      **  If the file pointer has not been reset for this file in #BF     S01280
      **  (was not top line on prior screen) reset file pointer.          S01280
     C           @CADY     IFNE 'Y'                        B*2            S01280
     C           @BKCAD    ANDEQ'N'                                       S01280
     C                     MOVE *HIVAL    @HKCY1                          S01280
     C                     MOVE *HIVAL    @HKMM1                          S01280
     C                     MOVE *HIVAL    @HKDD1                          S01280
     C                     MOVE *HIVAL    @HKAMN                          S01280
     C                     MOVE *HIVAL    @HKDNO                          S01280
     C           @HKKY8    SETGTCADVMALL                                  S01280
     C                     MOVE 'Y'       @BKCAD                          S01280
     C                     END                             E*2            S01280
     C                     READPCADVMALL                 76*1             S01145
      *
      **  IF END OF FILE, END PROCESS                                     S01149
     C********** *IN76     IFEQ '1'                        B*2     S01149 S01280
      **********                                                   S01149 S01280
     C********** @STEND    IFNE 'END  '                    B**3    S01149 S01280
     C**********           MOVE 'START'   @STEND           ***3    S01149 S01280
     C**********           END                             E**3    S01149 S01280
      **********                                                   S01149 S01280
     C**********           GOTO #BG9                       **2     S01149 S01280
     C**********           END                             E*2     S01149 S01280
      *
      **  If deal no has not changed read again to avoid listing
      **  the same deal twice
     C           HKDN38    IFEQ @PREV                      B*2            S01145
     C           HKTYPE    ANDEQ@PRTY                      X*2            S01145
     C                     READPCADVMALL                 76**2            S01145
     C                     END                             E*2            S01145
     C*
     C           *IN76     IFEQ '0'                        B*2
      *
      **  Determine whether currency/date/type has changed.               S01149
     C           HKCCY     IFNE @HKCCY                     B**3
     C                     MOVE '1'       *IN76            ***3
      *
     C                     ELSE                            X**3
      *
     C           @VDATE    IFNE @RDATE                     B***4
     C           @MDATE    ANDNE@RDATE                     ****4
     C                     MOVE '1'       *IN76            ****4
     C                     END                             E***4
      *
     C                     END                             E**3
      *
     C                     END                             E*2
      *  Set up subfile hidden field - used for deal selection.(L/Ds+N/As)S01280
     C           *IN76     IFEQ '0'                                       S01280
     C                     MOVE *BLANKS   DDDTYP                          S01280
     C                     MOVELHKTYPE    DDDTYP                          S01280
     C                     MOVE *BLANKS   DDHID                           S01280
     C                     END                                            S01280
      *
      **  If no more records for currency/date/type, end process.         S01149
     C           *IN76     IFEQ '1'                        B*2
      *
     C           @STEND    IFNE 'END  '                    B**3
     C                     MOVE 'START'   @STEND           ***3
     C                     END                             E**3
      *
     C                     GOTO #BG9                       **2
     C                     END                             E*2
     C                     END                             E1             S01280
      *
      **  Twelfth read to check start of file only.
     C*******    @I        CABEQ12        #BG9             *1             SO1166
     C********** @I        CABEQ16        #BG9             *1      SO1166 S01280
     C           @I        CABEQ15        #BG9             *1             S01280
      *
      **  Store deal number and type                                      S01145
     C                     MOVE HKDN38    @PREV   60                      S01145
     C                     MOVE HKTYPE    @PRTY   2                       S01145
     C*
     C**  Check for a negotiable asset deal type which may  be **         S01149
     C**  bought or sold                                       **         S01149
     C**                                                                  S01149
     C           HKTYPE    IFEQ 'C1'                       B2             S01149
     C           HKTYPE    OREQ 'C2'                                      S01149
     C           HKTYPE    OREQ 'BO'                                      S01149
     C           HKTYPE    OREQ 'BI'                                      S01149
     C           HKTYPE    OREQ 'TB'                                      S01149
     C           HKTYPE    OREQ 'BA'                                      S01149
     C           HKTYPE    OREQ 'TA'                                      S01149
      *                                                                   S01149
     C**  If a negotiable asset deal type which may be bought  **         S01149
     C**  or sold - check that the requested deal type is      **         S01149
     C**  also for N/A type deal - if so, exercise sub-routine **         S01149
     C**  for special N/A deal processing.                     **         S01149
     C**                                                                  S01149
     C           @RTYP     IFEQ 'ALL'                      B3             S01149
     C           @RTYP     OREQ 'N/A'                                     S01149
     C           @DNA      ORNE *BLANKS                                   S01280
     C*                                                                   S01149
     C                     EXSR #BGA                       *3             S01149
     C                     END                             E3             S01149
      *                                                                   S01149
     C                     ELSE                            X*2            S01149
      *                                                                   S01280
     C           @@FILE    CASEQ'FUT'     #BHE                            S01280
     C           @@FILE    CASEQ'IRS'     #BHD                            S01280
     C           @@FILE    CASEQ'FRA'     #BHD                            S01280
     C           @@FILE    CASEQ'LEN'     #BHC                            S01280
     C                     END                                            S01280
     C**                                                                  S01149
     C**  If not a negotiable asset deal type - check that     **         S01149
     C**  the requested deal type is also for L/D type deal    **         S01149
     C**  - if so, continue with L/D deal processing           **         S01149
     C**                                                                  S01149
     C           @RTYP     IFEQ 'ALL'                      B3             S01149
     C********** @RTYP     OREQ 'L/D'                              S01149 S01280
     C           @DLD      ORNE *BLANKS                                   S01280
     C           @@FILE    OREQ 'FUT'                                     S01280
     C           @@FILE    OREQ 'IRS'                                     S01280
     C           @@FILE    OREQ 'FRA'                                     S01280
     C           @@FILE    OREQ 'LEN'                                     S01280
      *
     C                     MOVE *BLANKS   @CUKEY 10                       S01194
      *
     C**  If an arbitrage deal has been read move arbitrage    **         S01145
     C**  values for requested currency into HK (money market) **         S01145
     C**  fields. Note IN11 is set on if an AB record is keyed **         S01145
     C**  on first currency.                                   **         S01145
     C*
     C           HKTYPE    IFEQ 'PS'                       B*4            S01145
     C*******    *IN01     IFEQ '1'                        B**5    S01145 SO1166
     C********** *IN11     IFEQ '1'                        B**5    SO1166 S01280
     C********** *IN13     OREQ '1'                                E20178 S01280
     C**********           MOVE JPNDA1    HKAMNP           ***5    S01145 S01280
     C**********           MOVE JPIRT1    HKINTR           ***5    S01145 S01280
     C**********           ELSE                            X**5    S01145 S01280
     C**********           MOVE JPNDA2    HKAMNP           ***5    S01145 S01280
     C**********           MOVE JPIRT2    HKINTR           ***5    S01145 S01280
     C**********           END                             E**5    S01145 S01280
      *                                                                   S01280
      **  If arbitrage move blanks to buy/sell indicator.                 S01280
     C                     MOVE *BLANK    DDBOS                           S01280
      *                                                                   S01280
      *   Set up flag for ABDEALP2 record format.                         S01280
     C                     MOVE 'N'       @ABDP2                          S01280
      *   Set up flag for ABDEALP3 record format.                         S01280
     C                     MOVE 'N'       @ABDP3                          S01280
      *                                                                   S01280
      **  If ABDEALP0                                                     S01280
     C           *IN11     IFEQ '1'                                       S01280
     C                     MOVE JPNDA1    HKAMNP                          S01280
     C                     MOVE JPIRT1    HKINTR                          S01280
     C                     END                                            S01280
      *                                                                   S01280
      **  If ABDEALP1                                                     S01280
     C           *IN12     IFEQ '1'                                       S01280
     C                     MOVE JPNDA2    HKAMNP                          S01280
     C                     MOVE JPIRT2    HKINTR                          S01280
     C                     END                                            S01280
      *                                                                   S01280
      **  If ABDEALP2                                                     S01280
     C           *IN13     IFEQ '1'                                       S01280
     C                     MOVE 'Y'       @ABDP2                          S01280
     C                     MOVE JPFDA1    HKAMNP                          S01280
     C                     MOVE JPIRT1    HKINTR                          S01280
     C                     END                                            S01280
      *                                                                   S01280
      **  If ABDEALP3                                                     S01280
     C           *IN14     IFEQ '1'                                       S01280
     C                     MOVE 'Y'       @ABDP3                          S01280
     C                     MOVE JPFDA2    HKAMNP                          S01280
     C                     MOVE JPIRT2    HKINTR                          S01280
     C                     END                                            S01280
      *                                                                   S01280
     C*
     C**  If amount +ve move PL to DEAL TYPE else move 'PD'               S01145
     C*
     C           HKAMNP    IFGT 0                          B**5           S01145
     C                     MOVE 'PL'      HKTYPE           ***5           S01145
     C                     ELSE                            X**5           S01145
     C                     MOVE 'PD'      HKTYPE           ***5           S01145
     C                     END                             E**5
     C*
     C           *IN13     IFEQ '1'                                       S01280
     C           *IN14     OREQ '1'                                       S01280
     C                     Z-SUBHKAMNP    HKAMNP                          E20178
     C                     END                                            S01280
     C                     SETOF                     1112                 E20178
     C                     SETOF                     1314                 E20178
     C*
     C****If*AB*deal*read*customer*name*from*LF/CLINT************  S01145 S01194
     C**********                                                          S01194
     C**********           MOVE 'A'       @RCDT   1        **4     S01145 S01194
     C********** @CUSKY    KLIST                           **4     S01145 S01194
     C**********           KFLD           JPDCNO           **4     S01145 S01194
     C**********           KFLD           @RCDT            **4     S01145 S01194
     C********** @CUSKY    CHAINCLINT                80    **4     S01145 S01194
     C**********                                                          S01194
      ***DEAL*WITH*DATA*BASE*ERROR**                               S01145 S01194
     C********** *IN80     IFEQ '1'                 B**5 **********S01145 S01194
     C**********           MOVEL'CLINT'   DBFILE    ***5 *ERROR   *S01145 S01194
     C**********           MOVELJPDCNO    DBKEY     ***5 *    003 *S01145 S01194
     C**********           MOVE @RCDT     DBKEY     ***5          *S01145 S01194
     C**********           MOVEL'003'     DBASE     ***5 *        *S01145 S01194
     C**********           MOVE '1'       *INU7     ***5 *        *S01145 S01194
     C**********           MOVE '1'       *INU8     ***5 *        *S01145 S01194
     C**********           GOTO #BG9                ***5 *        *S01145 S01194
     C**********           END                      E**5 **********S01145 S01194
     C**********           MOVE CSNM      HKCSNM           **4     S01145 S01194
      *                                                                   S01194
      * If AB Deal set up key to SDCUSTPD using AB Deals file             S01194
      * customer number                                                   S01194
     C                     MOVELJPDCNO    @CUKEY                          S01194
      *                                                                   S01194
     C                     ELSE                                           E17654
      *                                                                   S01280
      * else use customer no. from relevant file according to value       S01280
      * in @@FILE                                                         S01280
      *                                                                   S01280
     C           @@FILE    IFEQ 'CAD'                                     S01280
     C                     MOVELHKCNUM    @CUKEY                          S01194
     C                     END                                            S01280
      *                                                                   S01280
     C           @@FILE    IFEQ 'LEN'                                     S01280
     C                     MOVELLENUM     @CUKEY                          S01280
     C                     END                                            S01280
      *                                                                   S01280
     C           @@FILE    IFEQ 'FRA'                                     S01280
     C           @@FILE    OREQ 'IRS'                                     S01280
     C                     MOVELFINUM     @CUKEY                          S01280
     C                     END                                            S01280
      *                                                                   S01280
     C           @@FILE    IFEQ 'FUT'                                     S01280
     C                     MOVELCUSC      @CUKEY                          S01280
     C                     END                                            S01280
      *                                                                   S01194
     C********** HKCNUM    CHAINCLINT                80            E17654 S01194
     C**********           MOVE CSNM      HKCSNM                   E17654 S01194
     C**********                                                   E17654 S01194
      ***DEAL*WITH*DATA*BASE*ERROR******                           E17654 S01194
     C********** *IN80     IFEQ '1'                 B**5 **********E17654 S01194
     C**********           MOVEL'CLINT'   DBFILE    ***5 *ERROR   *E17654 S01194
     C**********           MOVELHKCNUM    DBKEY     ***5 *    003 *E17654 S01194
     C**********           MOVEL'050'     DBASE     ***5 *        *E17654 S01194
     C**********           MOVE '1'       *INU7     ***5 *        *E17654 S01194
     C**********           MOVE '1'       *INU8     ***5 *        *E17654 S01194
     C**********           GOTO #BG9                ***5 *        *E17654 S01194
     C**********           END                      E**5 **********E17654 S01194
     C                     END                             E*4
      *                                                                   S01194
      * Get customer shortname from SDCUSTPD using key just set up,       S01194
      * via call to Access Object                                         S01194
     C                     CALL 'AOCUSTR0'                                S01194
     C                     PARM '*DBERR ' @RTCD   7                       S01194
     C                     PARM '*KEY   ' @OPTN   7                       S01194
     C                     PARM           @CUKEY 10                       S01194
     C                     PARM *BLANKS   @KYST   7                       S01194
     C           SDCUST    PARM SDCUST    DSSDY                           S01194
      *                                                                   S01194
     C                     MOVELBBCSSN    HKCSNM                          S01194
     C**********           Z-ADDJPDCNO    @@CNM                                        S01280 CSD027
     C                     MOVE JPDCNO    @@CNM                                               CSD027
      *
      **  Convert value date from YYYYMMDD to DDMMMYY/MMMDDYY.
     C                     Z-ADD@VDATE    @@DTIN           *3
     C                     EXSR ZA0720                     *3
      *
      **  Determine which date to be displayed.
     C           @@DATE    IFNE @DATE                      B*4
     C                     MOVE @@DATE    @MVDAT           **4
      *
      **  Edit amount.
      *                                                                   E21020
      * FOR ARBITRAGE DEALS THE AMOUNTS SHOULD BE REVERSED.               E21020
     C           HKTYPE    IFEQ 'PS'                       B***5          E21020
     C           HKTYPE    OREQ 'PL'                       B***5          E21020
     C           HKTYPE    OREQ 'PD'                       B***5          E21020
     C                     Z-ADDHKAMNP    @@IAMT           ****5          E21020
     C                     ELSE                            X***5          E21020
     C                     Z-SUBHKAMNP    @@IAMT           **5
     C                     END                             E***5          E21020
     C                     MOVE HKCCY     @@CCY   3        **4
     C                     EXSR MM1016                     **4
     C                     MOVE @@AMOU    @PRAMT           **4
      *
     C                     ELSE                            X*4
      *
      **  Convert maturity date from YYYYMMDD to DDMMMYY/MMMDDYY.
     C                     Z-ADD@MDATE    @@DTIN           **4
     C                     EXSR ZA0720                     **4
     C                     MOVE @@DATE    @MVDAT           **4
      *
      **  Edit amount.
      **  Reverse sign on amount since amount on file will be moving
      **  in opposite direction at maturity to that at value date
      *                                                                   E21020
      * FOR ARBITRAGE DEALS THE AMOUNTS SHOULD BE REVERSED.               E21020
     C           HKTYPE    IFEQ 'PS'                       B***5          E21020
     C           HKTYPE    OREQ 'PL'                       B***5          E21020
     C           HKTYPE    OREQ 'PD'                       B***5          E21020
     C                     Z-SUBHKAMNP    @@IAMT           ****5          E21020
     C                     ELSE                            X***5          E21020
     C                     Z-ADDHKAMNP    @@IAMT           **5
     C                     END                             E***5          E21020
     C                     MOVE HKCCY     @@CCY            **4
     C                     EXSR MM1016                     **4
     C                     MOVE @@AMOU    @PRAMT           **4
     C                     END                             E*4
      *
      **  Edit deal interest rate.
     C                     MOVE *BLANKS   @INTRT           *3
     C                     Z-ADDHKINTR    @@RIN            *3
     C                     EXSR #ZA                        *3
     C                     MOVEA@B        @INTRT           *3
      *
      ** If rate is negative and no room in @B for sign, set sign on
      ** rate to display.
     C           *IN77     IFEQ '1'                        B*4
     C                     MOVE '-'       @INTRT           **4
     C                     END                             E*4
      **  If deal no = first deal no. on first screen.                    S01280
     C           HKDN38    IFEQ @FRDNO                                    S01280
     C                     MOVE 'START'   @STEND                          S01280
     C                     END                                            S01280
      ****
      ****Edit amount.
     C****                 Z-ADDHKAMNP    @@IAMT           *3
     C****                 MOVE HKCCY     @@CCY   3        *3
     C****                 EXSR MM1016                     *3
     C****                 MOVE @@AMOU    @PRAMT           *3
      *
      *  For L/D set up buy/sell indicator to be displayed.               S01280
      *  for non arbitrage L/D deal types.(MMDEVMP0 & MMDEVMP1)           S01280
     C           @@FILE    IFEQ 'CAD'                                     S01280
     C           HKTYPE    ANDNE'PS'                                      S01280
     C           HKTYPE    ANDNE'PL'                                      S01280
     C           HKTYPE    ANDNE'PD'                                      S01280
     C                     MOVE HKRBSI    DDBOS                           S01280
     C                     END                                            S01280
      **   Set up display line.
     C*******    12        SUB  @I        @X      20                      SO1166
     C*******              MOVE @DETLS    @AM,@X           *3             SO1166
     C********** 16        SUB  @I        @X      20               SO1166 S01280
     C           15        SUB  @I        @X      20                      S01280
     C                     EXSR #ZE                        *3             SO1166
      *                                                                   S01280
      *    For arbitrage deals the displayed amount is opposite to that onS01280
      *    file.Subsequently for storage purposes reverse the sign.       S01280
     C           @ABDP2    IFEQ 'Y'                                       S01280
     C           @ABDP3    OREQ 'Y'                                       S01280
     C                     Z-SUBHKAMNP    HKAMNP                          S01280
     C                     MOVE 'N'       @ABDP3                          S01280
     C                     END                                            S01280
      *                                                                   S01280
      *    For arbitrage format ABDEALP2 JPSD38(HKDN38) is displayed      S01280
      *    however key is JPFD38,so move JPFD38 to HKDN38 for storage.    S01280
     C           @ABDP2    IFEQ 'Y'                                       S01280
     C                     MOVE JPFD38    HKDN38                          S01280
     C                     MOVE 'N'       @ABDP2                          S01280
     C                     END                                            S01280
      *
      **   If first read i.e. last line on screen, set up CA38CPLL field. S01280
      **   futures.                                                       S01280
     C           @I        IFEQ 1                          B*4            S01280
     C           @@FILE    ANDEQ'FUT'                      **4            S01280
     C                     Z-ADDHKDN38    @FUDNO           **4            S01280
     C                     MOVE HKCCY     @FUCCY           **4            S01280
     C                     MOVE @URFSH    UARKB1 12        **4            S01280
     C                     MOVE 'FUT'     @BLINE           **4            S01280
     C                     END                             E*4            S01280
      *                                                                   S01280
      **   If first read i.e. last line on screen, set up CA38CPLL field. S01280
      **   IRS.                                                           S01280
     C           @I        IFEQ 1                          B*4            S01280
     C           @@FILE    ANDEQ'IRS'                      **4            S01280
     C                     Z-ADDHKDN38    @IRDNO           **4            S01280
     C                     MOVE HKCCY     @IRCCY           **4            S01280
     C                     MOVE @VRFSH    VARKB1 19        **4            S01280
     C                     MOVE 'IRS'     @BLINE           **4            S01280
     C                     END                             E*4            S01280
      *                                                                   S01280
      **   If first read i.e. last line on screen, set up CA38CPLL field. S01280
      **   FRA.                                                           S01280
     C           @I        IFEQ 1                          B*4            S01280
     C           @@FILE    ANDEQ'FRA'                      **4            S01280
     C                     Z-ADDHKDN38    @FDLNO           **4            S01280
     C                     MOVE HKCCY     @FRCCY           **4            S01280
     C                     MOVE @TRFSH    TARKB1 19        **4            S01280
     C                     MOVE 'FRA'     @BLINE           **4            S01280
     C                     END                             E*4            S01280
      *                                                                   S01280
      **   If first read i.e. last line on screen, set up CA38CPLL field. S01280
      **   LENDING.                                                       S01280
     C           @I        IFEQ 1                          B*4            S01280
     C           @@FILE    ANDEQ'LEN'                      **4            S01280
     C**********           Z-ADDHKDN38    @LELNO           **4                         S01280 CLE148
     C                     MOVE HKLNRF    @LELNO                                              CLE148
     C                     MOVE HKCCY     @LECCY           **4            S01280
     C                     MOVE @SRFSH    SARKB1 22        **4            S01280
     C                     MOVE 'LEN'     @BLINE           **4            S01280
     C                     END                             E*4            S01280
      *                                                                   S01280
      **   If first read i.e. last line on screen, set up CA38CPLL field. S01166
      **   L/Ds and N/As.                                                 S01280
     C           @I        IFEQ 1                          B*4            S01166
     C           @@FILE    ANDEQ'CAD'                      **4            S01280
     C                     MOVEL@@DTIN    @RRFSH           **4            S01166
     C                     MOVE HKDN38    @HKDNO           **4            S01166
     C                     Z-ADDHKAMNP    @HKAMN           **4            S01166
     C                     MOVE @RRFSH    FARKB1 24        **4            S01166
     C                     MOVE 'CAD'     @BLINE           **4            S01280
     C                     END                             E*4            S01166
      *
      **   Could be top line of screen: Set up CA38CPLL field.            S01166
     C**********           MOVEL@@DTIN    @RRFSH           *3      S01166 S01280
     C**********           MOVE HKDN38    @HKDNO           *3      S01166 S01280
     C**********           Z-ADDHKAMNP    @HKAMN           *3      S01166 S01280
     C*******              MOVE @RRFSH    FARKT1           *3             S01166
      **   If first line, set up CA38CPLL field.(L/Ds + N/As)             S01280
     C           @I        IFEQ 14                         B*4            S01280
     C           @@FILE    ANDEQ'CAD'                      **4            S01280
     C                     MOVEL@@DTIN    @RRFSH           **4            S01280
     C                     MOVE HKDN38    @HKDNO           **4            S01280
     C                     Z-ADDHKAMNP    @HKAMN           **4            S01280
     C                     MOVE @RRFSH    FARKT1 24        **4            S01280
     C                     MOVE 'CAD'     @RLWDN           **4            S01280
     C                     END                             E*4            S01280
      **   If first line, set up CA38CPLL field.(LENDING)                 S01280
     C           @I        IFEQ 14                         B*4            S01280
     C           @@FILE    ANDEQ'LEN'                      **4            S01280
     C**********           Z-ADDHKDN38    @LELNO           **4                         S01280 CLE148
     C                     MOVE HKLNRF    @LELNO                                              CLE148
     C                     MOVE HKCCY     @LECCY           **4            S01280
     C                     MOVE @SRFSH    SARKT1 22        **4            S01280
     C                     MOVE 'LEN'     @RLWDN           **4            S01280
     C                     END                             E*4            S01280
      **   If first line, set up CA38CPLL field.(FRA)                     S01280
     C           @I        IFEQ 14                         B*4            S01280
     C           @@FILE    ANDEQ'FRA'                      **4            S01280
     C                     Z-ADDHKDN38    @FDLNO           **4            S01280
     C                     MOVE HKCCY     @FRCCY           **4            S01280
     C                     MOVE @TRFSH    TARKT1 19        **4            S01280
     C                     MOVE 'FRA'     @RLWDN           **4            S01280
     C                     END                             E*4            S01280
      **   If first line, set up CA38CPLL field.(IRS)                     S01280
     C           @I        IFEQ 14                         B*4            S01280
     C           @@FILE    ANDEQ'IRS'                      **4            S01280
     C                     Z-ADDHKDN38    @IRDNO           **4            S01280
     C                     MOVE HKCCY     @IRCCY           **4            S01280
     C                     MOVE @VRFSH    VARKT1 19        **4            S01280
     C                     MOVE 'IRS'     @RLWDN           **4            S01280
     C                     END                             E*4            S01280
      **   If first line, set up CA38CPLL field.(FUTURES)                 S01280
     C           @I        IFEQ 14                         B*4            S01280
     C           @@FILE    ANDEQ'FUT'                      **4            S01280
     C                     Z-ADDHKDN38    @FUDNO           **4            S01280
     C                     MOVE HKCCY     @FUCCY           **4            S01280
     C                     MOVE @URFSH    UARKT1 12        **4            S01280
     C                     MOVE 'FUT'     @RLWDN           **4            S01280
     C                     END                             E*4            S01280
      *
      **   Set on indicator to show that records have been processed
     C                     MOVE '1'       *IN61            *3
      *
      **   Add 1 to accumulator counting lines written to the screen      S01149
     C                     ADD  1         @I               *3             S01149
      *
     C                     END                             E3
     C                     END                             E2             S01149
     C                     END                             E1             S01149
      *
     C           #BG9      ENDSR                           ** #BG9 **
      *
      *****************************************************************
      /EJECT
      *****************************************************************   S01149
      *                                                               *   S01149
      *  #BGA- THIS ROUTINE SETS UP FIELDS DERIVED FROM CADVMALL      *   S01149
      *        WHICH ARE FOR NEGOTIABLE ASSET DEALS (BOUGHT OR        *   S01149
      *        SOLD).                                                 *   S01149
      *                                                               *   S01149
      *        FACE VALUE AMOUNT AND DATES ARE EDITED FOR DISPLAY     *   S01149
      *                                                               *   S01149
      *                                                               *   S01149
      *  CALLED BY : #BG                                              *   S01149
      *                                                               *   S01149
      *  CALLS :     MM1016                                           *   S01149
      *              ZA0720                                           *   S01149
      *              #BGB                                             *   S01149
      *                                                               *   S01149
      *  USES:       @VDATE - VALUE DATE YYYYMMDD                     *   S01149
      *              @@DTIN - INPUT DATE TO ZA0720 YYYYMMDD           *   S01149
      *              @@DATE - OUTPUT DATE FROM ZA0720 DDMMMYY/MMMDDYY *   S01149
      *              @MVDAT - EDITED 'OTHER' DATE DDMMMYY/MMMDDYY     *   S01149
      *              @MDATE - MATURITY DATE YYYYMMDD                  *   S01149
      *                                                               *   S01149
      *****************************************************************   S01149
      *                                                                   S01149
      *                                                                   S01149
     C           #BGA      BEGSR                                          S01149
     C*                                                                   S01149
     C********** @RTYP     IFEQ 'N/A'                      B**1    S01149 S01280
     C           @DNA      IFNE *BLANKS                    ***1           S01280
     C                     MOVE 'NA'      @HKTYP           ***1           S01149
     C                     END                             E**1           S01149
     C*                                                                   S01149
     C*   N/A Bought                                                      S01149
     C*                                                                   S01149
     C           HKRBSI    IFEQ 'B'                        B**1           S01149
     C*                                                                   S01149
     C**  Requested Date = Value Date.                                    S01149
     C**  Other date = maturity date.                                     S01149
     C           @VDATE    IFEQ @RDATE                     B**2           S01149
     C                     Z-ADD@MDATE    @@DTIN           ***2           S01149
     C                     EXSR ZA0720                     ***2           S01149
     C                     MOVE @@DATE    @MVDAT           ***2           S01149
     C*                                                                   S01149
     C**  Use Purchaser/Seller name and                                   S01149
     C**  purchase price for value date.                                  S01280
     C****face*value.******                                         S01149S01280
     C**********           Z-ADDHLFVAL    @@IAMT           ***2    S01149 S01280
     C                     Z-ADDHKAMNP    @@IAMT           ***2           S01280
     C                     EXSR #BGB                       ***2           S01149
     C                     ELSE                            X**2           S01149
     C*                                                                   S01149
     C**  Requested Date = Maturity Date.                                 S01149
     C**  Other date = value date.                                        S01149
     C           @MDATE    IFEQ @RDATE                     B**3           S01149
     C                     Z-ADD@VDATE    @@DTIN           ***3           S01149
     C                     EXSR ZA0720                     ***3           S01149
     C                     MOVE @@DATE    @MVDAT           ***3           S01149
     C*                                                                   S01149
     C**  Use Issuer/Acceptor name.                                       S01149
     C                     MOVE HLISUR    HKCSNM           ***3           S01149
     C*                                                                   S01149
     C****Use*face*value.*************                              S01149S01378
     C**  If trade is not parcelled use face value.                       S01378
     C                     Z-ADDHLFVAL    @@IAMT           ***3           S01149
      *                                                                   S01378
      **  If the trade is parcelled, there may be some unsold portion     S01378
      **  of the trade remaining at maturity date. So must obtain         S01378
      **  this amount if parcelled trade and requested date is maturity   S01378
      **  Note that during CoB (ie DL0280/MM0101) as sales reach their    S01378
      **  value dates HLFVAL, HLPSZE are reduced to reflect the sales,    S01378
      **  but in TM3200 we must include these forward valued sales.       S01378
     C           HLPCLI    IFEQ 'P'                        B***4          S01378
     C           HLNSLD    ANDNE*ZERO                      B***4          S01378
      *                                                                   S01378
      **  Adjust face value by subtracting face value equivalent of       S01378
      **  portions sold today (face value divided by parcel size to get   S01378
      **  face value per parcel, then multiply result by no. parcels      S01378
      **  sold today) from face value.                                    S01378
     C           HLFVAL    DIV  HLPSZE    @@IAMT    H      ****4          S01378
     C           @@IAMT    MULT HLNSLD    @@IAMT           ****4          S01378
     C           HLFVAL    SUB  @@IAMT    @@IAMT           ****4          S01378
     C                     END                             E***4          S01378
      *                                                                   S01378
     C                     EXSR #BGB                       ***3           S01149
     C                     END                             E**3           S01149
     C                     END                             E**2           S01149
     C                     ELSE                            X**1           S01149
     C*                                                                   S01149
     C*   N/A Sold                                                        S01149
     C*                                                                   S01149
     C           HKRBSI    IFEQ 'S'                        B**2           S01149
     C*                                                                   S01149
     C**  Requested Date = Value Date (Maturity Date not possible).       S01149
     C**  Use maturity date.                                              S01280
     C****Use*value*date.**                                         S01149S01280
     C*********************Z-ADD@VDATE    @@DTIN           ***2     S01149S01280
     C                     Z-ADD@MDATE    @@DTIN           ***2           S01280
     C                     EXSR ZA0720                     ***2           S01149
     C                     MOVE @@DATE    @MVDAT           ***2           S01149
     C*                                                                   S01149
     C****Use*face*value.**                                         S01149S01280
     C*********************Z-ADDHMFVAL    @@IAMT           ***2     S01149S01280
     C**  Use sale price.                                                 S01280
     C                     Z-ADDHKAMNP    @@IAMT           ***2           S01280
     C                     EXSR #BGB                       ***2           S01149
     C                     END                             E**2           S01149
     C*                                                                   S01149
     C                     END                             E1             S01149
      *                                                                   S01149
     C           #BGA9     ENDSR                           ** #BGA9**     S01149
      *
      *****************************************************************
      /EJECT
      *****************************************************************   S01149
      *                                                               *   S01149
      *  #BGB- THIS ROUTINE SETS UP DETAIL LINES                      *   S01149
      *                                                               *   S01149
      *        AMOUNTS, RATES AND DATES ARE EDITED FOR DISPLAY.       *   S01149
      *                                                               *   S01149
      *        ALL EDITED FIELDS SO OBTAINED ARE PLACED IN THEIR      *   S01149
      *        CORRESPONDING POSITIONS OF THE DATA STRUCTURE @DETLS,  *   S01149
      *        WHICH IS THEN MOVED INTO THE RELEVANT POSITION FOR     *   S01149
      *        THIS RECORD IN THE DATA STRUCTURE @AMENQ USING THE     *   S01149
      *        ARRAY @AM.                                             *   S01149
      *                                                               *   S01149
      *  CALLED BY : #BG                                              *   S01149
      *                                                               *   S01149
      *  CALLS :     MM1016                                           *   S01149
      *              ZA0720                                           *   S01149
      *              #ZA                                              *   S01149
      *                                                               *   S01149
      *  USES:     @I     - COUNTER                                   *   S01149
      *            @@DTIN - INPUT DATE TO ZA0720 YYYYMMDD             *   S01149
      *            @@RIN  - INPUT RATE TO #ZA                         *   S01149
      *            @B     - OUTPUT RATE FROM #ZA                      *   S01149
      *            @INTRT - EDITED RATE                               *   S01149
      *            @@IAMT - INPUT AMOUNT TO MM1016                    *   S01149
      *            @@CCY  - INPUT CURRENCY TO MM1016                  *   S01149
      *            @@AMOU - OUTPUT AMOUNT FROM MM1016                 *   S01149
      *            @PRAMT - EDITED AMOUNT                             *   S01149
      *            @DETLS - DATA STRUCTURE WHICH HOLDS CADVMALL       *   S01149
      *                     INFORMATION FOR EACH RECORD               *   S01149
      *            @AM    - ARRAY OF CADVMALL DATA FOR EACH RECORD    *   S01149
      *            @RRFSH - ROLL/REFRESH KEY FIELD                    *   S01149
      *****************************************************************   S01149
      *                                                                   S01149
     C           #BGB      BEGSR                                          S01149
      *                                                                   S01149
      **  Edit amount.                                                    S01149
     C                     MOVE HKCCY     @@CCY   3                       S01149
     C                     EXSR MM1016                                    S01149
     C                     MOVE @@AMOU    @PRAMT                          S01149
      *                                                                   S01149
      **  Edit deal interest rate.                                        S01149
     C                     MOVE *BLANKS   @INTRT                          S01149
     C                     Z-ADDHKINTR    @@RIN                           S01149
     C                     EXSR #ZA                                       S01149
     C                     MOVEA@B        @INTRT                          S01149
      *   Set up buy/sell indicator.                                      S01280
     C                     MOVE HKRBSI    DDBOS                           S01280
      *                                                                   S01149
      ** If rate is negative and no room in @B for sign, set sign on      S01149
      ** rate to display.                                                 S01149
     C           *IN77     IFEQ '1'                        B*1            S01149
     C                     MOVE '-'       @INTRT           **1            S01149
     C                     END                             E*1            S01149
      **  If deal no = first deal no. on first screen.                    S01280
     C           HKDN38    IFEQ @FRDNO                                    S01280
     C                     MOVE 'START'   @STEND                          S01280
     C                     END                                            S01280
      *                                                                   S01149
      **   Set up display line.                                           S01149
     C*******    12        SUB  @I        @X      20               S01149 SO1166
     C*******              MOVE @DETLS    @AM,@X           *3      S01149 SO1166
     C********** 16        SUB  @I        @X      20               SO1166 S01280
     C           15        SUB  @I        @X      20                      S01280
     C                     EXSR #ZE                        *3             SO1166
      *                                                                   S01149
      **   If first read i.e. last line on screen, set up CA38CPLL field. S01149
     C           @I        IFEQ 1                          B*1     S01149 S01166
     C**********           MOVEL@@DTIN    @RRFSH           *S01149 S01166 S01280
     C                     MOVEL@MDATE    @RRFSH           **1            S01280
     C                     MOVE HKDN38    @HKDNO           **1     S01149 S01166
     C                     Z-ADDHKAMNP    @HKAMN           **1     S01149 S01166
     C                     MOVE @RRFSH    FARKB1           **1     S01149 S01166
     C                     MOVE 'CAD'     @BLINE           **1            S01280
     C                     END                             E*1     S01149 S01166
      *                                                                   S01149
      **   Could be top line of screen: Set up CA38CPLL field.     S01149 S01166
     C**********           MOVEL@@DTIN    @RRFSH            SS1149 S01166 S01280
     C                     MOVEL@MDATE    @RRFSH                          S01280
     C                     MOVE HKDN38    @HKDNO                   S01149 S01166
     C                     Z-ADDHKAMNP    @HKAMN                   S01149 S01166
     C*******              MOVE @RRFSH    FARKT1                   S01149 S01166
     C                     MOVE @RRFSH    FARKT1                          S01280
     C                     MOVE 'CAD'     @RLWDN                          S01280
      *                                                                   S01149
      **   Set on indicator to show that records have been processed      S01149
     C                     MOVE '1'       *IN61                           S01149
      **   Add 1 to accumulator counting lines written to the screen      S01149
     C                     ADD  1         @I                              S01149
      *                                                                   S01149
      *                                                                   S01149
      *                                                                   S01149
     C           #BGB9     ENDSR                           ** #BGB9**     S01149
      *
      *****************************************************************
      /EJECT
      *****************************************************************
      *                                                               *
      *  #BH - THIS ROUTINE SETS UP FIELDS DERIVED FROM MMDVMALL      *
      *        IN THE DATA STRUCTURE @AMENQ AS FOLLOWS:               *
      *                                                               *
      ******** A MAXIMUM OF 11 RECORDS ARE EXTRACTED FOR SPECIFIED    *   so1166
      *        A MAXIMUM OF 16 RECORDS ARE EXTRACTED FOR SPECIFIED    *   so1166
      *        CURRENCY/DATE/TYPE FROM CADVMALL BY READING FORWARDS.  *   S01149
      *                                                               *
      *        AMOUNTS, RATES AND DATES ARE EDITED FOR DISPLAY.       *
      *                                                               *
      *        ALL EDITED FIELDS SO OBTAINED ARE PLACED IN THEIR      *
      *        CORRESPONDING POSITIONS OF THE DATA STRUCTURE @DETLS,  *
      *        WHICH IS THEN MOVED INTO THE RELEVANT POSITION FOR     *
      *        THIS RECORD IN THE DATA STRUCTURE @AMENQ USING THE     *
      *        ARRAY @AM.                                             *
      *                                                               *
      *  CALLED BY : #B                                               *
      *                                                               *
      *  CALLS :     MM1016                                           *
      *              ZA0720                                           *
      *              #BGA                                             *   S01149
      *              #ZA                                              *
      *                                                               *
      *  USES:       @I     - COUNTER                                 *
      *              @HKKY4 - PARTIAL KEY FOR CADVMALL                *   S01149
      ******         @HKKY4 - PARTIAL KEY FOR MMDVMALL                *   S01149
      *              @STEND - START/END NARRATIVE                     *
      *              @VDATE - VALUE DATE YYYYMMDD                     *
      *              @@DTIN - INPUT DATE TO ZA0720 YYYYMMDD           *
      *              @@DATE - OUTPUT DATE FROM ZA0720 DDMMMYY/MMMDDYY *
      *              @MVDAT - EDITED 'OTHER' DATE DDMMMYY/MMMDDYY     *
      *              @MDATE - MATURITY DATE YYYYMMDD                  *
      *              @@RIN  - INPUT RATE TO #ZA                       *
      *              @B     - OUTPUT RATE FROM #ZA                    *
      *              @INTRT - EDITED RATE                             *
      *              @@IAMT - INPUT AMOUNT TO MM1016                  *
      *              @@CCY  - INPUT CURRENCY TO MM1016                *
      *              @@AMOU - OUTPUT AMOUNT FROM MM1016               *
      *              @PRAMT - EDITED AMOUNT                           *
      *              @DETLS - DATA STRUCTURE WHICH HOLDS MMDVMALL     *
      *                       INFORMATION FOR EACH RECORD             *
      *              @AM    - ARRAY OF MMDVMALL DATA FOR EACH RECORD  *
      *              @RRFSH - ROLL/REFRESH KEY FIELD                  *
      *                                                               *
      *****************************************************************
      *
     C           #BH       BEGSR
      *
      *   Initialise workfields.                                          S01280
     C                     Z-ADD1         @I      20                      S01149
     C                     Z-ADD0         @PREV                           S01149
     C                     MOVE 'N'       @LENF   1                       S01280
     C                     MOVE 'N'       @FRAF   1                       S01280
     C                     MOVE 'N'       @FRAF1  1                       S01280
     C                     MOVE 'N'       @IRSF   1                       S01280
     C                     MOVE 'N'       @IRSF1  1                       S01280
     C                     MOVE 'N'       @FUTF   1                       S01280
      *                                                                   S01280
     C                     MOVE *BLANKS   @@FILE  3                       S01280
      *                                                                   S01280
      *   If Roll up selected and record found set @@FILE according to    S01280
      *   the record selected.                                            S01280
     C           @CADY     IFEQ 'Y'                                       S01280
     C                     MOVE 'CAD'     @@FILE                          S01280
     C                     END                                            S01280
      *                                                                   S01280
     C           @LENY     IFEQ 'Y'                                       S01280
     C                     MOVE 'LEN'     @@FILE                          S01280
     C                     END                                            S01280
      *                                                                   S01280
     C           @FRAY     IFEQ 'Y'                                       S01280
     C                     MOVE 'FRA'     @@FILE                          S01280
     C                     END                                            S01280
      *                                                                   S01280
     C           @IRSY     IFEQ 'Y'                                       S01280
     C                     MOVE 'IRS'     @@FILE                          S01280
     C                     END                                            S01280
      *                                                                   S01280
     C           @FUTY     IFEQ 'Y'                                       S01280
     C                     MOVE 'FUT'     @@FILE                          S01280
     C                     END                                            S01280
      *                                                                   S01280
      *
      **  Read the next 11 records on CADVMALL for currency/date/type.    S01149
     C******               DO   12        @I      20       B1             S01149
     C*******    @I        DOUEQ12                         B1      S01149 SO1166
     C********** @I        DOUEQ16                         B1      SO1166 S01280
     C           @I        DOUEQ15                         B1             S01280
     C*******    @HKKY4    READEMMDVMALL                 76*1             S01145
     C           @LDNA     IFEQ 'Y'                                       S01280
     C           @@FILE    ANDEQ'CAD'                                     S01280
     C           @@FILE    OREQ *BLANKS                                   S01280
     C           @LDNA     ANDEQ'Y'                                       S01280
     C                     MOVE 'CAD'     @@FILE                          S01280
     C           @HKKY4    READECADVMALL                 76*1             S01145
     C                     END                                            S01280
      *  Set up subfile hidden field - used for deal selection + Move     S01280
      *  L/D N/A deal type to screen.                                     S01280
     C           *IN76     IFEQ '0'                                       S01280
     C                     MOVE *BLANKS   DDDTYP                          S01280
     C                     MOVELHKTYPE    DDDTYP                          S01280
     C                     MOVE *BLANKS   DDHID                           S01280
     C                     END                                            S01280
      *                                                                   S01280
      * If file finished processing and nothing else selected end.        S01280
     C           *IN76     IFEQ '1'                                       S01280
     C           @DLEN     ANDEQ*BLANK                                    S01280
     C           @DFRA     ANDEQ*BLANK                                    S01280
     C           @DIRS     ANDEQ*BLANK                                    S01280
     C           @DFUT     ANDEQ*BLANK                                    S01280
      * If only one screen to display display 'START'                     S01280
     C           @STEND    IFEQ 'START'                                   S01280
     C                     MOVE 'START'   @STEND                          S01280
     C                     ELSE                                           S01280
     C                     MOVE 'END  '   @STEND                          S01280
     C                     END                                            S01280
     C                     GOTO #BH9                                      S01280
     C                     END                                            S01280
      *
      ****IF*END*OF*FILE,*END*PROCESS***                           S01149 S01280
      **  IF END OF THIS FILE CONTINUE PROCESSING IF OTHER FILES SELECTD  S01280
      *                                                                   S01149
     C           *IN76     IFEQ '1'                        B*2            S01149
     C           @@FILE    ANDEQ'CAD'                                     S01280
     C           @@FILE    OREQ *BLANKS                                   S01280
     C           @DLEN     ANDNE*BLANK                                    S01280
     C                     MOVE 'LEN'     @@FILE                          S01280
     C**********           MOVE 'END  '   @STEND           **2     S01149 S01280
     C**********           GOTO #BH9                       **2     S01149 S01280
     C                     END                             E*2            S01149
      *                                                                   S01280
      **  If next file to process is lending,and has been selected and    S01280
      **  has not finished processing process DLCLONLL.                   S01280
     C           @DLEN     IFNE *BLANK                                    S01280
     C           @@FILE    ANDEQ'LEN'                                     S01280
     C           @@FILE    OREQ *BLANKS                                   S01280
     C           @DLEN     ANDNE*BLANK                                    S01280
      *                                                                   S01280
      * SETLL first time through only where no further records to process S01280
      * on roll up.                                                       S01280
     C           @LENF     IFEQ 'N'                                       S01280
     C           @LENY     ANDNE'Y'                                       S01280
     C                     Z-ADD@@MNO     @HKCYY                          S01280
     C           @DLKY1    SETLLDLCLONLL                                  S01280
     C                     END                                            S01280
      *                                                                   S01280
     C           @DLKY1    READEDLCLONLL                 76               S01280
     C                     MOVE *BLANKS   HKTYPE           stop hktypeprocS01280
     C                     MOVE 'Y'       @LENF                           S01280
     C                     END                                            S01280
      *                                                                   S01280
      * If file finished processing and nothing else selected end.        S01280
     C           *IN76     IFEQ '1'                                       S01280
     C           @DFRA     ANDEQ*BLANK                                    S01280
     C           @DIRS     ANDEQ*BLANK                                    S01280
     C           @DFUT     ANDEQ*BLANK                                    S01280
      * If only one screen to display display 'START'                     S01280
     C           @STEND    IFEQ 'START'                                   S01280
     C                     MOVE 'START'   @STEND                          S01280
     C                     ELSE                                           S01280
     C                     MOVE 'END  '   @STEND                          S01280
     C                     END                                            S01280
     C                     GOTO #BH9                                      S01280
     C                     END                                            S01280
      *                                                                   S01280
     C           *IN76     IFEQ '1'                                       S01149
     C           @@FILE    ANDEQ'LEN'                                     S01280
     C           @@FILE    OREQ *BLANKS                                   S01280
     C           @DFRA     ANDNE*BLANKS                                   S01280
     C                     MOVE 'FRA'     @@FILE                          S01280
     C                     END                                            S01149
      *                                                                   S01280
      **  If next file to process is FRA and has been selected and        S01280
      **  has not finished processing process DLDLFRLL.                   S01280
     C           @DFRA     IFNE *BLANK                                    S01280
     C           @@FILE    ANDEQ'FRA'                                     S01280
     C           @@FILE    OREQ *BLANKS                                   S01280
     C           @DFRA     ANDNE*BLANK                                    S01280
      *                                                                   S01280
      * SETLL first time through only.                                    S01280
     C           @FRAF     IFEQ 'N'                                       S01280
     C           @FRAY     ANDNE'Y'                                       S01280
     C                     Z-ADD@@MNO     @HKCYY                          S01280
     C           @DLKY2    SETLLDLDLFRLL                                  S01280
     C                     END                                            S01280
      *                                                                   S01280
     C           @DLKY2    READEDLDLFRLL                 76               S01280
     C                     MOVE 'Y'       @FRAF                           S01280
     C                     END                                            S01280
      *                                                                   S01280
      * If file finished processing and nothing else selected end.        S01280
     C           *IN76     IFEQ '1'                                       S01280
     C           @DIRS     ANDEQ*BLANK                                    S01280
     C           @DFUT     ANDEQ*BLANK                                    S01280
      * If only one screen to display display 'START'                     S01280
     C           @STEND    IFEQ 'START'                                   S01280
     C                     MOVE 'START'   @STEND                          S01280
     C                     ELSE                                           S01280
     C                     MOVE 'END  '   @STEND                          S01280
     C                     END                                            S01280
     C                     GOTO #BH9                                      S01280
     C                     END                                            S01280
      *                                                                   S01280
     C           *IN76     IFEQ '1'                                       S01149
     C           @@FILE    ANDEQ'FRA'                                     S01280
     C           @@FILE    OREQ *BLANKS                                   S01280
     C           @DIRS     ANDNE*BLANK                                    S01280
     C                     MOVE 'IRS'     @@FILE                          S01280
     C                     END                                            S01149
      *                                                                   S01280
      **  If next file to process is IRS and has been selected and        S01280
      **  has not finished processing process DLDLIRLL.                   S01280
     C           @DIRS     IFNE *BLANK                                    S01280
     C           @@FILE    ANDEQ'IRS'                                     S01280
     C           @@FILE    OREQ *BLANKS                                   S01280
     C           @DIRS     ANDNE*BLANK                                    S01280
      *                                                                   S01280
      * SETLL first time through only.                                    S01280
     C           @IRSF     IFEQ 'N'                                       S01280
     C           @IRSY     ANDNE'Y'                                       S01280
     C                     Z-ADD@@MNO     @HKCYY                          S01280
     C           @DLKY7    SETLLDLDLIRLL                                  S01280
     C                     END                                            S01280
      *                                                                   S01280
     C           @DLKY7    READEDLDLIRLL                 76               S01280
     C                     MOVE 'Y'       @IRSF                           S01280
      *                                                                   S01280
     C                     END                                            S01280
      *                                                                   S01280
      * If file finished processing and nothing else selected end.        S01280
     C           *IN76     IFEQ '1'                                       S01280
     C           @DFUT     ANDEQ*BLANK                                    S01280
      * If only one screen to display display 'START'                     S01280
     C           @STEND    IFEQ 'START'                                   S01280
     C                     MOVE 'START'   @STEND                          S01280
     C                     ELSE                                           S01280
     C                     MOVE 'END  '   @STEND                          S01280
     C                     END                                            S01280
     C                     GOTO #BH9                                      S01280
     C                     END                                            S01280
      *                                                                   S01280
     C           *IN76     IFEQ '1'                                       S01149
     C           @@FILE    ANDEQ'IRS'                                     S01280
     C           @@FILE    OREQ *BLANKS                                   S01280
     C           @DFUT     ANDNE*BLANK                                    S01280
     C                     MOVE 'FUT'     @@FILE                          S01280
     C                     END                                            S01149
      *                                                                   S01280
      **  If next file to process is FUTURES,and has been selected and    S01280
      **  has not finished processing process DLFUTSLL.                   S01280
     C           @DFUT     IFNE *BLANK                     B1             S01280
     C           @@FILE    ANDEQ'FUT'                                     S01280
     C           @@FILE    OREQ *BLANKS                                   S01280
     C           @DFUT     ANDNE*BLANKS                                   S01280
      *                                                                   S01280
      * SETLL first time through only.                                    S01280
     C           @FUTF     IFEQ 'N'                        B*2            S01280
     C           @FUTY     ANDNE'Y'                                       S01280
     C                     Z-ADD@@MNO     @HKCYY                          S01280
     C           @DLKY3    SETLLDLFUTSLL                                  S01280
     C                     END                             E*2            S01280
      *                                                                   S01280
     C           @DLKY3    READEDLFUTSLL                 76               S01280
      *                                                                   S01280
      * If deal no. same as last deal no.= same deal different format     S01280
      * therefore read deal again.                                        S01280
     C           HKDN38    IFEQ @PREV                                     S01280
     C           @DLKY3    READEDLFUTSLL                 76               S01280
     C                     END                                            S01280
      *                                                                   S01280
     C                     MOVE *BLANKS   HKTYPE           stop hktypeprocS01280
     C                     MOVE 'Y'       @FUTF                           S01280
     C                     END                             E1             S01280
      *                                                                   S01280
      * If file finished processing and nothing else selected end.        S01280
     C           *IN76     IFEQ '1'                                       S01280
     C           @@FILE    ANDEQ'FUT'                                     S01280
      * If only one screen to display display 'START'                     S01280
     C           @STEND    IFEQ 'START'                                   S01280
     C                     MOVE 'START'   @STEND                          S01280
     C                     ELSE                                           S01280
     C                     MOVE 'END  '   @STEND                          S01280
     C                     END                                            S01280
     C                     GOTO #BH9                                      S01280
     C                     END                                            S01280
      *
      **  If deal no has not changed read again to avoid listing
      **  the same deal twice
     C           HKDN38    IFEQ @PREV                      B*2            S01145
     C           HKTYPE    ANDEQ@PRTY                      X*2            S01145
     C           @@FILE    ANDNE'FUT'                      **2            S01280
     C                     READPCADVMALL                 76**2            S01145
     C                     END                             E*2            S01145
      *
      **  If no more records for currency/date/type, end process.         S01149
      *
     C********** *IN76     IFEQ '1'                        B*2            S01280
     C**********           MOVE 'END  '   @STEND           **2            S01280
     C**********           GOTO #BH9                       **2            S01280
     C**********           END                             E*2            S01280
      *
      **  Twelfth read to check end of file only.
     C*******    @I        CABEQ12        #BH9             *1             SO1166
     C********** @I        CABEQ16        #BH9             *1      SO1166 S01280
     C           @I        CABEQ15        #BH9             *1             S01280
      *
      **  Store deal number and type                                      S01145
     C                     MOVE HKDN38    @PREV                           S01145
     C                     MOVE HKTYPE    @PRTY                           S01145
     C*                                                                   S01149
     C**  Check for a negotiable asset deal type which may  be **         S01149
     C**  bought or sold                                       **         S01149
     C**                                                                  S01149
     C           HKTYPE    IFEQ 'C1'                       B2             S01149
     C           HKTYPE    OREQ 'C2'                                      S01149
     C           HKTYPE    OREQ 'BO'                                      S01149
     C           HKTYPE    OREQ 'BI'                                      S01149
     C           HKTYPE    OREQ 'TB'                                      S01149
     C           HKTYPE    OREQ 'BA'                                      S01149
     C           HKTYPE    OREQ 'TA'                                      S01149
      *                                                                   S01149
     C**  If a negotiable asset deal type which may be bought  **         S01149
     C**  or sold - check that the requested deal type is      **         S01149
     C**  also for N/A type deal - if so, exercise sub-routine **         S01149
     C**  for special N/A deal processing.                     **         S01149
     C**                                                                  S01149
     C           @RTYP     IFEQ 'ALL'                      B3             S01149
     C********** @RTYP     OREQ 'N/A'                              S01149 S01280
     C           @DNA      ORNE *BLANKS                                   S01280
     C*                                                                   S01149
      *   Store top record so in #BG knows when @STEND s/be START(N/As)   S01280
     C           *IN61     IFEQ '0'                                       S01280
     C                     Z-ADD0         @FRDNO                          S01280
     C                     MOVE HKDN38    @FRDNO  60                      S01280
     C                     END                                            S01280
      *                                                                   S01280
     C                     EXSR #BHA                       *3             S01149
     C                     END                             E3             S01149
      *                                                                   S01149
     C                     ELSE                            X*2            S01149
      *                                                                   S01280
     C           @@FILE    CASEQ'LEN'     #BHC                            S01280
     C           @@FILE    CASEQ'FRA'     #BHD                            S01280
     C           @@FILE    CASEQ'IRS'     #BHD                            S01280
     C           @@FILE    CASEQ'FUT'     #BHE                            S01280
     C                     END                                            S01280
      *                                                                   s01149
     C**  If not a negotiable asset deal type - check that     **         S01149
     C**  the requested deal type is also for L/D type deal    **         S01149
     C**  - if so, continue with L/D deal processing           **         S01149
      *                                                                   s01149
     C           @RTYP     IFEQ 'ALL'                      B3             S01149
     C********** @RTYP     OREQ 'L/D'                              S01149 S01280
     C           @DLD      ORNE *BLANKS                                   S01280
     C           @@FILE    OREQ 'LEN'                                     S01280
     C           @@FILE    OREQ 'FRA'                                     S01280
     C           @@FILE    OREQ 'IRS'                                     S01280
     C           @@FILE    OREQ 'FUT'                                     S01280
      *   Store top record so in #BG knows when @STEND s/be START         S01280
     C           *IN61     IFEQ '0'                                       S01280
     C                     Z-ADD0         @FRDNO                          S01280
     C                     MOVE HKDN38    @FRDNO  60                      S01280
     C                     END                                            S01280
      *
     C**  If an arbitrage deal has been read move arbitrage    **         S01145
     C**  values for requested currency into HK (money market) **         S01145
     C**  fields. Note IN11 is set on if an AB record is keyed **         S01145
     C**  on first currency.                                   **         S01145
     C*
     C           HKTYPE    IFEQ 'PS'                       B*4            S01145
     C*******    *IN01     IFEQ '1'                        B**5    S01145 SO1166
     C********** *IN11     IFEQ '1'                        B**5    SO1166 S01280
     C********** *IN13     OREQ '1'                                E20178 S01280
     C**********           MOVE JPNDA1    HKAMNP           ***5    S01145 S01280
     C**********           MOVE JPIRT1    HKINTR           ***5    S01145 S01280
     C**********           ELSE                            X**5    S01145 S01280
     C**********           MOVE JPNDA2    HKAMNP           ***5    S01145 S01280
     C**********           MOVE JPIRT2    HKINTR           ***5    S01145 S01280
     C**********           END                             E**5    S01145 S01280
      *                                                                   S01280
      **  If arbitrage move blanks to buy/sell indicator.                 S01280
     C                     MOVE *BLANK    DDBOS                           S01280
      *                                                                   S01280
      *   Set up flag for ABDEALP2 record format.                         S01280
     C                     MOVE 'N'       @ABDP2  1                       S01280
      *   Set up flag for ABDEALP3 record format.                         S01280
     C                     MOVE 'N'       @ABDP3  1                       S01280
      **  If ABDEALP0                                                     S01280
     C           *IN11     IFEQ '1'                                       S01280
     C                     MOVE JPNDA1    HKAMNP                          S01280
     C                     MOVE JPIRT1    HKINTR                          S01280
     C                     END                                            S01280
      *                                                                   S01280
      **  If ABDEALP1                                                     S01280
     C           *IN12     IFEQ '1'                                       S01280
     C                     MOVE JPNDA2    HKAMNP                          S01280
     C                     MOVE JPIRT2    HKINTR                          S01280
     C                     END                                            S01280
      *                                                                   S01280
      **  If ABDEALP2                                                     S01280
     C           *IN13     IFEQ '1'                                       S01280
     C                     MOVE 'Y'       @ABDP2  1                       S01280
     C                     MOVE JPFDA1    HKAMNP                          S01280
     C                     MOVE JPIRT1    HKINTR                          S01280
     C                     END                                            S01280
      *                                                                   S01280
      **  If ABDEALP3                                                     S01280
     C           *IN14     IFEQ '1'                                       S01280
     C                     MOVE 'Y'       @ABDP3                          S01280
     C                     MOVE JPFDA2    HKAMNP                          S01280
     C                     MOVE JPIRT2    HKINTR                          S01280
     C                     END                                            S01280
      *                                                                   S01280
     C*
     C**  If amount +ve move PL to DEAL TYPE else move 'PD'               S01145
     C*
     C           HKAMNP    IFGT 0                          B**5           S01145
     C                     MOVE 'PL'      HKTYPE           ***5           S01145
     C                     ELSE                            X**5           S01145
     C                     MOVE 'PD'      HKTYPE           ***5           S01145
     C                     END                             E**5
     C*                                                                   E20178
     C           *IN13     IFEQ '1'                                       S01280
     C           *IN14     OREQ '1'                                       S01280
     C                     Z-SUBHKAMNP    HKAMNP                          E20178
     C                     END                                            S01280
     C                     SETOF                     1112                 E20178
     C                     SETOF                     1314                 E20178
     C*
     C****If*AB*deal*read*customer*name*from*LF/CLINT************  S01145 S01194
     C**********                                                          S01194
     C**********           MOVE 'A'       @RCDT   1        **4     S01145 S01194
     C********** @CUSKY    CHAINCLINT                80    **4     S01145 S01194
     C**********                                                          S01194
      ***DEAL*WITH*DATA*BASE*ERROR***                              S01145 S01194
     C********** *IN80     IFEQ '1'                 B**5 **********S01145 S01194
     C**********           MOVEL'CLINT'   DBFILE    ***5 *        *S01145 S01194
     C**********           MOVELJPDCNO    DBKEY     *             *S01145 S01194
     C**********           MOVE @RCDT     DBKEY     * DBERROR 004 *S01145 S01194
     C**********           MOVEL'004'     DBASE     *             *S01145 S01194
     C**********           MOVE '1'       *INU7     ***5 *        *S01145 S01194
     C**********           MOVE '1'       *INU8     ***5 *        *S01145 S01194
     C**********           GOTO #BH9                ***5 *        *S01145 S01194
     C**********           END                      E**5 *                S01194
      *                                                                   S01194
      * Set up key for SDCUSTPD using customer no. from AB deals file     S01194
     C                     MOVE *BLANKS   @CUKEY                          S01194
     C                     MOVELJPDCNO    @CUKEY                          S01194
      * Get customer shortname via Access Object                          S01194
     C                     CALL 'AOCUSTR0'                                S01194
     C                     PARM '*DBERR ' @RTCD   7                       S01194
     C                     PARM '*KEY   ' @OPTN   7                       S01194
     C                     PARM           @CUKEY 10                       S01194
     C                     PARM *BLANKS   @KYST   7                       S01194
     C           SDCUST    PARM SDCUST    DSSDY                           S01194
      *                                                         *
     C**********           MOVE CSNM      HKCSNM           **4  *  S01145 S01194
     C                     MOVELBBCSSN    HKCSNM           **4  *         S01194
     C**********           Z-ADDJPDCNO    @@CNM            **4                         S01280 CSD027
     C                     MOVE JPDCNO    @@CNM            **4                                CSD027
     C                     END                             E**4 **********S01145
      *                                                         *
      **  Convert value date from YYYYMMDD to DDMMMYY/MMMDDYY.
     C                     Z-ADD@VDATE    @@DTIN           *3
     C                     EXSR ZA0720                     *3
      *
      **  Determine which date to be displayed.
     C           @@DATE    IFNE @DATE                      B*4
     C                     MOVE @@DATE    @MVDAT           **4
      *
      **  Edit amount.
      * FOR ARBITRAGE DEALS THE AMOUNTS SHOULD BE REVERSED.               E21020
     C           HKTYPE    IFEQ 'PS'                       B***5          E21020
     C           HKTYPE    OREQ 'PL'                       B***5          E21020
     C           HKTYPE    OREQ 'PD'                       B***5          E21020
     C                     Z-ADDHKAMNP    @@IAMT           ****5          E21020
     C                     ELSE                            X***5          E21020
     C                     Z-SUBHKAMNP    @@IAMT           **5
     C                     END                             E***5          E21020
     C                     MOVE HKCCY     @@CCY   3        **4
     C                     EXSR MM1016                     **4
     C                     MOVE @@AMOU    @PRAMT           **4
      *
     C                     ELSE                            X*4
      *
      **  Convert maturity date from YYYYMMDD to DDMMMYY/MMMDDYY.
     C                     Z-ADD@MDATE    @@DTIN           **4
     C                     EXSR ZA0720                     **4
     C                     MOVE @@DATE    @MVDAT           **4
      *
      **  Edit amount.
      **  Reverse sign on amount since amount on file will be moving
      **  in opposite direction at maturity to that at value date
      * FOR ARBITRAGE DEALS THE AMOUNTS SHOULD BE REVERSED.               E21020
     C           HKTYPE    IFEQ 'PS'                       B***5          E21020
     C           HKTYPE    OREQ 'PL'                       B***5          E21020
     C           HKTYPE    OREQ 'PD'                       B***5          E21020
     C                     Z-SUBHKAMNP    @@IAMT           ****5          E21020
     C                     ELSE                            X***5          E21020
     C                     Z-ADDHKAMNP    @@IAMT           **5
     C                     END                             E***5          E21020
     C                     MOVE HKCCY     @@CCY            **4
     C                     EXSR MM1016                     **4
     C                     MOVE @@AMOU    @PRAMT           **4
     C                     END                             E*4
      *
      **  Edit deal interest rate.
     C                     MOVE *BLANKS   @INTRT           *3
     C                     Z-ADDHKINTR    @@RIN            *3
     C                     EXSR #ZA                        *3
     C                     MOVEA@B        @INTRT           *3
      *
      ** If rate is negative and no room in @B for sign, set sign on
      ** rate to display.
     C           *IN77     IFEQ '1'                        B*4
     C                     MOVE '-'       @INTRT           **4
     C                     END                             E*4
      *  For L/D set up buy/sell indicator to be displayed.               S01280
      *  for non arbitrage L/D deal types.(MMDEVMP0 & MMDEVMP1)           S01280
     C           @@FILE    IFEQ 'CAD'                                     S01280
     C           HKTYPE    ANDNE'PS'                                      S01280
     C           HKTYPE    ANDNE'PD'                                      S01280
     C           HKTYPE    ANDNE'PL'                                      S01280
     C                     MOVE HKRBSI    DDBOS                           S01280
     C                     END                                            S01280
      ****
      ****Edit amount.
     C****                 Z-ADDHKAMNP    @@IAMT           *3
     C****                 MOVE HKCCY     @@CCY   3        *3
     C****                 EXSR MM1016                     *3
     C****                 MOVE @@AMOU    @PRAMT           *3
      *
      **   Set up display line.
     C*******              MOVE @DETLS    @AM,@I           *3             SO1166
     C                     Z-ADD@I        @X               *3             SO1166
     C                     EXSR #ZE                        *3             SO1166
      *                                                                   S01280
      *    For arbitrage deals the displayed amount is opposite to that onS01280
      *    file.Subsequently for storage purposes reverse the sign.       S01280
     C           @ABDP2    IFEQ 'Y'                                       S01280
     C           @ABDP3    OREQ 'Y'                                       S01280
     C                     Z-SUBHKAMNP    HKAMNP                          S01280
     C                     MOVE 'N'       @ABDP3                          S01280
     C                     END                                            S01280
      *                                                                   S01280
      *    For arbitrage format ABDEALP2 JPSD38(HKDN38) is displayed      S01280
      *    however key is JPFD38,so move JPFD38 to HKDN38 for storage.    S01280
     C           @ABDP2    IFEQ 'Y'                                       S01280
     C                     MOVE JPFD38    HKDN38                          S01280
     C                     MOVE 'N'       @ABDP2                          S01280
     C                     END                                            S01280
      *                                                                   S01280
      *
      *****If*first*line,*set*up*CA38CPLL*field***                 S01166 S01280
      **   If first line, set up CA38CPLL field.(L/Ds + N/As)             S01280
     C           @I        IFEQ 1                          B*4            S01166
     C           @@FILE    ANDEQ'CAD'                      **4            S01280
     C                     MOVEL@@DTIN    @RRFSH           **4            S01166
     C*******              MOVE HKDN38    @RRFSH           **4      ME1211S01166
     C                     MOVE HKDN38    @HKDNO           **4      ME1211S01166
     C                     Z-ADDHKAMNP    @HKAMN           **4            S01166
     C                     MOVE @RRFSH    FARKT1 24        **4            S01166
     C                     MOVE 'CAD'     @RLWDN  3        **4            S01280
     C                     END                             E*4            S01166
      **   If first line, set up CA38CPLL field.(LENDING)                 S01280
     C           @I        IFEQ 1                          B*4            S01280
     C           @@FILE    ANDEQ'LEN'                      **4            S01280
     C**********           Z-ADDHKDN38    @LELNO           **4                         S01280 CLE148
     C                     MOVE HKLNRF    @LELNO                                              CLE148
     C                     MOVE HKCCY     @LECCY           **4            S01280
     C                     MOVE @SRFSH    SARKT1 22        **4            S01280
     C                     MOVE 'LEN'     @RLWDN           **4            S01280
     C                     END                             E*4            S01280
      **   If first line, set up CA38CPLL field.(FRA)                     S01280
     C           @I        IFEQ 1                          B*4            S01280
     C           @@FILE    ANDEQ'FRA'                      **4            S01280
     C                     Z-ADDHKDN38    @FDLNO           **4            S01280
     C                     MOVE HKCCY     @FRCCY           **4            S01280
     C                     MOVE @TRFSH    TARKT1 19        **4            S01280
     C                     MOVE 'FRA'     @RLWDN           **4            S01280
     C                     END                             E*4            S01280
      **   If first line, set up CA38CPLL field.(IRS)                     S01280
     C           @I        IFEQ 1                          B*4            S01280
     C           @@FILE    ANDEQ'IRS'                      **4            S01280
     C                     Z-ADDHKDN38    @IRDNO           **4            S01280
     C                     MOVE HKCCY     @IRCCY           **4            S01280
     C                     MOVE @VRFSH    VARKT1 19        **4            S01280
     C                     MOVE 'IRS'     @RLWDN           **4            S01280
     C                     END                             E*4            S01280
      **   If first line, set up CA38CPLL field.(FUTURES)                 S01280
     C           @I        IFEQ 1                          B*4            S01280
     C           @@FILE    ANDEQ'FUT'                      **4            S01280
     C                     Z-ADDHKDN38    @FUDNO           **4            S01280
     C                     MOVE HKCCY     @FUCCY           **4            S01280
     C                     MOVE @URFSH    UARKT1 12        **4            S01280
     C                     MOVE 'FUT'     @RLWDN           **4            S01280
     C                     END                             E*4            S01280
      *
      **   Could be last line on screen: Set up CA38CPLL field.           S01166
     C           @@FILE    IFEQ 'CAD'                                     S01280
     C                     MOVEL@@DTIN    @RRFSH           *3             S01166
     C*******              MOVE HKDN38    @RRFSH           *3      ME1211 S01166
     C                     MOVE HKDN38    @HKDNO           *3      ME1211 S01166
     C                     Z-ADDHKAMNP    @HKAMN           *3             S01166
     C*******              MOVE @RRFSH    FARKB1           *3             S01166
     C                     MOVE @RRFSH    FARKB1           *3             S01280
     C                     MOVE 'CAD'     @BLINE  3                       S01280
     C                     END                                            S01280
      *                                                                   S01280
      **   Could be last line on screen: Set up LENDING field.            S01280
     C           @@FILE    IFEQ 'LEN'                                     S01280
     C                     MOVE @SRFSH    SARKB1                          S01280
     C                     MOVE 'LEN'     @BLINE  3                       S01280
     C                     END                                            S01280
      *                                                                   S01280
      **   Could be last line on screen: Set up FRA field.                S01280
     C           @@FILE    IFEQ 'FRA'                                     S01280
     C                     MOVE @TRFSH    TARKB1                          S01280
     C                     MOVE 'FRA'     @BLINE  3                       S01280
     C                     END                                            S01280
      *                                                                   S01280
      **   Could be last line on screen: Set up IRS field.                S01280
     C           @@FILE    IFEQ 'IRS'                                     S01280
     C                     MOVE 'IRS'     @BLINE  3                       S01280
     C                     MOVE @VRFSH    VARKB1                          S01280
     C                     END                                            S01280
      *                                                                   S01280
      **   Could be last line on screen: Set up FUT field.                S01280
     C           @@FILE    IFEQ 'FUT'                                     S01280
     C                     MOVE 'FUT'     @BLINE  3                       S01280
     C                     MOVE @URFSH    UARKB1                          S01280
     C                     END                                            S01280
      *
      **   Set on indicator to show that records have been processed
     C                     MOVE '1'       *IN61            *3
      *
      **   Add 1 to accumulator counting lines written to the screen      S01149
     C                     ADD  1         @I               *3             S01149
      *
     C                     END                             E3
     C                     END                             E2             S01149
     C                     END                             E1             S01149
      *
     C           #BH9      ENDSR                           ** #BH9 **
      *
      *****************************************************************
      /EJECT
      *****************************************************************   S01149
      *                                                               *   S01149
      *  #BHA- THIS ROUTINE SETS UP FIELDS DERIVED FROM CADVMALL      *   S01149
      *        WHICH ARE FOR NEGOTIABLE ASSET DEALS (BOUGHT OR        *   S01149
      *        SOLD).                                                 *   S01149
      *                                                               *   S01149
      *        FACE VALUE AMOUNT AND DATES ARE EDITED FOR DISPLAY     *   S01149
      *                                                               *   S01149
      *                                                               *   S01149
      *  CALLED BY : #BH                                              *   S01149
      *                                                               *   S01149
      *  CALLS :     MM1016                                           *   S01149
      *              ZA0720                                           *   S01149
      *              #BHB                                             *   S01149
      *                                                               *   S01149
      *  USES:       @VDATE - VALUE DATE YYYYMMDD                     *   S01149
      *              @@DTIN - INPUT DATE TO ZA0720 YYYYMMDD           *   S01149
      *              @@DATE - OUTPUT DATE FROM ZA0720 DDMMMYY/MMMDDYY *   S01149
      *              @MVDAT - EDITED 'OTHER' DATE DDMMMYY/MMMDDYY     *   S01149
      *              @MDATE - MATURITY DATE YYYYMMDD                  *   S01149
      *                                                               *   S01149
      *****************************************************************   S01149
      *                                                                   S01149
      *                                                                   S01149
     C           #BHA      BEGSR                                          S01149
     C*                                                                   S01149
     C********** @RTYP     IFEQ 'N/A'                      B**1    S01149 S01280
     C           @DNA      IFNE *BLANKS                    ***1           S01280
     C                     MOVE 'NA'      @HKTYP           ***1           S01149
     C                     END                             E**1           S01149
     C*                                                                   S01149
     C*   N/A Bought                                                      S01149
     C*                                                                   S01149
     C           HKRBSI    IFEQ 'B'                        B**1           S01149
     C*                                                                   S01149
     C**  Requested Date = Value Date.                                    S01149
     C**  Other date = maturity date.                                     S01149
     C           @VDATE    IFEQ @RDATE                     B**2           S01149
     C                     Z-ADD@MDATE    @@DTIN           ***2           S01149
     C                     EXSR ZA0720                     ***2           S01149
     C                     MOVE @@DATE    @MVDAT           ***2           S01149
     C*                                                                   S01149
     C**  Use Purchaser/Seller name and                                   S01149
     C**  purchase price for value date.                                  S01280
     C****face*value.******                                         S01149S01280
     C**********           Z-ADDHLFVAL    @@IAMT           ***2    S01149 S01280
     C                     Z-ADDHKAMNP    @@IAMT           ***2           S01280
     C                     EXSR #BHB                       ***2           S01149
     C                     ELSE                            X**2           S01149
     C*                                                                   S01149
     C**  Requested Date = Maturity Date.                                 S01149
     C**  Other date = value date.                                        S01149
     C           @MDATE    IFEQ @RDATE                     B**3           S01149
     C                     Z-ADD@VDATE    @@DTIN           ***3           S01149
     C                     EXSR ZA0720                     ***3           S01149
     C                     MOVE @@DATE    @MVDAT           ***3           S01149
     C*                                                                   S01149
     C**  Use Issuer/Acceptor name.                                       S01149
     C                     MOVE HLISUR    HKCSNM           ***3           S01149
     C*                                                                   S01149
     C****Use*face*value.**********                                 S01149S01378
     C**  If trade is not parcelled use face value.                       S01378
     C                     Z-ADDHLFVAL    @@IAMT           ***3           S01149
      *                                                                   S01378
      **  If the trade is parcelled, there may be some unsold portion     S01378
      **  of the trade remaining at maturity date. So must obtain         S01378
      **  this amount if parcelled trade and requested date is maturity   S01378
      **  Note that during CoB (ie DL0280/MM0101) as sales reach their    S01378
      **  value dates HLFVAL, HLPSZE are reduced to reflect the sales,    S01378
      **  but in TM3200 we must include these forward valued sales.       S01378
     C           HLPCLI    IFEQ 'P'                        B***4          S01378
     C           HLNSLD    ANDNE*ZERO                      B***4          S01378
      *                                                                   S01378
      **  Adjust face value by subtracting face value equivalent of       S01378
      **  portions sold today (face value divided by parcel size to get   S01378
      **  face value per parcel, then multiply result by no. parcels      S01378
      **  sold today) from face value.                                    S01378
     C           HLFVAL    DIV  HLPSZE    @@IAMT    H      ****4          S01378
     C           @@IAMT    MULT HLNSLD    @@IAMT           ****4          S01378
     C           HLFVAL    SUB  @@IAMT    @@IAMT           ****4          S01378
     C                     END                             E***4          S01378
      *                                                                   S01378
     C                     EXSR #BHB                       ***3           S01149
     C                     END                             E**3           S01149
     C                     END                             E**2           S01149
     C                     ELSE                            X**1           S01149
     C*                                                                   S01149
     C*   N/A Sold                                                        S01149
     C*                                                                   S01149
     C           HKRBSI    IFEQ 'S'                        B**2           S01149
     C*                                                                   S01149
     C**  Requested Date = Value Date (Maturity Date not possible).       S01149
     C**  Use maturity date.                                              S01280
     C****Use*value*date.**                                         S01149S01280
     C*********************Z-ADD@VDATE    @@DTIN           ***2     S01149S01280
     C                     Z-ADD@MDATE    @@DTIN           ***2           S01280
     C                     EXSR ZA0720                     ***2           S01149
     C                     MOVE @@DATE    @MVDAT           ***2           S01149
     C*                                                                   S01149
     C****Use*face*value.**                                         S01149S01280
     C*********************Z-ADDHMFVAL    @@IAMT           ***2     S01149S01280
     C**  Use sale price.                                                 S01280
     C                     Z-ADDHKAMNP    @@IAMT           ***2           S01280
     C                     EXSR #BHB                       ***2           S01149
     C                     END                             E**2           S01149
     C*                                                                   S01149
     C                     END                             E1             S01149
      *                                                                   S01149
     C           #BHA9     ENDSR                           ** #BHA9**     S01149
      *
      *****************************************************************
      /EJECT                                                              S01280
      *****************************************************************   S01280
      *                                                               *   S01280
      *  #BHC- PROCESS LENDING.                                       *   S01280
      *  CALLED BY : #BH                                              *   S01280
      *                                                               *   S01280
      *  CALLS :     ZA0710 - CONVERT MIDAS DAY NO. TO YYYYMMDD.      *   S01280
      *                                                               *   S01280
      *  USES:       @@DAYN - (5,0) INPUT FOR ZA0710                  *   S01280
      *              @@VDT  - (8, ) OUTPUT FROM ZA0710                *   S01280
      *                                                               *   S01280
      *****************************************************************   S01280
      *                                                                   S01280
     C           #BHC      BEGSR                                          S01280
      *  To save processing chain only if customer number has changed.    S01280
     C           LENUM     IFNE @@CNM                                     S01280
      *                                                                   S01280
     C                     MOVE *BLANKS   @CUKEY                          S01280
     C                     MOVELLENUM     @CUKEY                          S01280
      *                                                                   S01280
      * Get customer shortname from SDCUSTPD using key just set up,       S01280
      * via call to Access Object                                         S01280
     C                     CALL 'AOCUSTR0'                                S01280
     C                     PARM '*DBERR ' @RTCD   7                       S01280
     C                     PARM '*KEY   ' @OPTN   7                       S01280
     C                     PARM           @CUKEY 10                       S01280
     C                     PARM *BLANKS   @KYST   7                       S01280
     C           SDCUST    PARM SDCUST    DSSDY                           S01280
     C                     END                                            S01280
      *                                                                   S01280
     C                     MOVELBBCSSN    HKCSNM                          S01280
     C**********           Z-ADDLENUM     @@CNM   60                                   S01280 CSD027
     C                     MOVE LENUM     @@CNM   6                                           CSD027
      *                                                                   S01280
      * Reformat maturity date and value date.                            S01280
     C                     MOVEA*IN,80    @WIN    1                       S01280
     C                     Z-ADDMDAT      @@DAYN  50                      S01280
     C                     EXSR ZA0710                                    S01280
     C                     MOVE @@VDT     @MDATE                          S01280
     C                     MOVEA@WIN      *IN,80                          S01280
      *                                                                   S01280
     C                     MOVEA*IN,80    @WIN                            S01280
     C                     Z-ADDVDAT      @@DAYN                          S01280
     C                     EXSR ZA0710                                    S01280
     C                     MOVE @@VDT     @VDATE                          S01280
     C                     MOVEA@WIN      *IN,80                          S01280
      *  For deal types 62,63,64,65 the sign on the amount should be      S01280
      *  -ve when requested date is vdat & +ve when mdat requested        S01280
      *  (opposite for deal types 66,67).Set up the sign so that the      S01280
      *  standard processing in #BH,#BG sets sign correctly.              S01280
     C           PTYP      IFEQ 62                                        S01280
     C           PTYP      OREQ 63                                        S01280
     C           PTYP      OREQ 64                                        S01280
     C           PTYP      OREQ 65                                        S01280
     C                     Z-SUBCPAM      HKAMNP                          S01280
     C                     ELSE                                           S01280
     C                     Z-ADDCPAM      HKAMNP                          S01280
     C                     END                                            S01280
      *  Set up new fields into the renamed fields(they are workfields    S01280
      *  and should have been named #...)                                 S01280
     C                     MOVE *BLANKS   DDDTYP                          S01280
     C                     MOVELLTYP      DDDTYP                          S01280
     C                     MOVE LTYP      HKTYPE                          S01280
     C                     Z-ADDINTR      HKINTR                          S01280
      *  Set up buy/sell indicator.                                       S01280
     C                     MOVE *BLANK    DDBOS                           S01280
      *                                                                   S01280
     C           PTYP      IFEQ 66                                        S01280
     C           PTYP      OREQ 67                                        S01280
     C                     MOVE 'S'       DDBOS                           S01280
     C                     END                                            S01280
      *                                                                   S01280
     C           PTYP      IFEQ 64                                        S01280
     C           PTYP      OREQ 65                                        S01280
     C                     MOVE 'B'       DDBOS                           S01280
     C                     END                                            S01280
      *  Set up fields for full key.                                      S01280
     C**********           Z-ADDHKDN38    @LELNO                                       S01280 CLE148
     C                     MOVE HKLNRF    @LELNO                                              CLE148
     C                     Z-ADD@@MNO     @LMDAT                          S01280
     C                     MOVE HKCCY     @LECCY                          S01280
      *  Set up subfile hidden field - used for deal selection.           S01280
     C                     MOVE 'LEN'     DDHID                           S01280
      *  Move the VDAT or the MDAT not = requested date to @LVDAT.        S01280
     C           @@MNO     IFEQ VDAT                                      S01280
     C                     Z-ADDMDAT      @LVDAT                          S01280
     C                     ELSE                                           S01280
     C                     Z-ADDVDAT      @LVDAT                          S01280
     C                     END                                            S01280
     C                     Z-ADDCPAM      @LAMT                           S01280
      *                                                                   S01280
     C           #BHC9     ENDSR                           ** #BHC9**     S01280
      *                                                                   S01280
      *****************************************************************   S01280
      /EJECT                                                              S01280
      *****************************************************************   S01149
      *                                                               *   S01280
      *  #BHD - FRA/IRS PROCESSING                                    *   S01280
      *  CALLED BY : #BH                                              *   S01280
      *                                                               *   S01280
      *  CALLS :     ZA0710 - CONVERT MIDAS DAY NO. TO YYYYMMDD.      *   S01280
      *                                                               *   S01280
      *  USES:       @@DAYN - (5,0) INPUT FOR ZA0710                  *   S01280
      *              @@VDT  - (8, ) OUTPUT FROM ZA0710                *   S01280
      *                                                               *   S01280
      *****************************************************************   S01280
      *                                                                   S01280
     C           #BHD      BEGSR                                          S01280
      *                                                                   S01280
      *  To save processing chain only if customer number has changed.    S01280
     C           FINUM     IFNE @@CNM                                     S01280
     C                     MOVE *BLANKS   @CUKEY                          S01280
     C                     MOVELFINUM     @CUKEY                          S01280
      *                                                                   S01280
      * Get customer shortname from SDCUSTPD using key just set up,       S01280
      * via call to Access Object                                         S01280
     C                     CALL 'AOCUSTR0'                                S01280
     C                     PARM '*DBERR ' @RTCD   7                       S01280
     C                     PARM '*KEY   ' @OPTN   7                       S01280
     C                     PARM           @CUKEY 10                       S01280
     C                     PARM *BLANKS   @KYST   7                       S01280
     C           SDCUST    PARM SDCUST    DSSDY                           S01280
      *                                                                   S01280
     C                     END                                            S01280
      *                                                                   S01280
     C                     MOVELBBCSSN    HKCSNM                          S01280
     C**********           Z-ADDFINUM     @@CNM                                        S01280 CSD027
     C                     MOVE FINUM     @@CNM                                               CSD027
      *                                                                   S01280
      * Set up value date and maturity date.                              S01280
     C                     MOVEA*IN,80    @WIN    1                       S01280
     C                     Z-ADDMDAT      @@DAYN  50                      S01280
     C                     EXSR ZA0710                                    S01280
     C                     MOVE @@VDT     @MDATE                          S01280
     C                     MOVEA@WIN      *IN,80                          S01280
      *                                                                   S01280
     C                     MOVEA*IN,80    @WIN                            S01280
     C                     Z-ADDVDAT      @@DAYN                          S01280
     C                     EXSR ZA0710                                    S01280
     C                     MOVE @@VDT     @VDATE                          S01280
     C                     MOVEA@WIN      *IN,80                          S01280
      *  Set up new fields into the renamed fields(they are workfields    S01280
      *  and should have been named #...)                                 S01280
     C                     MOVE *BLANKS   DDDTYP                          S01280
     C                     MOVELHKTYPE    DDDTYP                          S01280
      *  Set up rate + amount for FRA's.                                  S01280
     C           HKTYPE    IFEQ 'FR'                                      S01280
      *                                                                   S01280
     C           BYSL      IFEQ 'B'                                       S01280
     C                     Z-ADDUEINR     HKINTR                          S01280
     C                     Z-ADDUPAMT     HKAMNP                          S01280
     C                     ELSE                                           S01280
     C                     Z-ADDTEINR     HKINTR                          S01280
     C                     Z-SUBUPAMT     HKAMNP                          S01280
     C                     END                                            S01280
      *                                                                   S01280
     C                     END                                            S01280
      *  For FRA's set up buy/sell indicator for display.                 S01280
     C           HKTYPE    IFEQ 'FR'                                      S01280
     C                     MOVE BYSL      DDBOS                           S01280
     C                     ELSE                                           S01280
     C                     MOVE *BLANK    DDBOS                           S01280
     C                     END                                            S01280
      *  Set up subfile hidden field - used for deal selection.           S01280
     C                     MOVE *BLANKS   DDHID                           S01280
      *  Set up fields for full key.                                      S01280
     C           FILRC1    IFEQ 'DLDLFRF1'                                S01280
     C                     Z-ADDVDAT      @FVDAT                          S01280
     C                     Z-ADDUPAMT     @FAMT                           S01280
     C                     Z-ADDHKDN38    @FDLNO                          S01280
     C                     MOVE HKCCY     @FRCCY                          S01280
     C                     END                                            S01280
     C           FILRC1    IFEQ 'DLDLFRF2'                                S01280
     C                     Z-ADDMDAT      @FVDAT                          S01280
     C                     Z-ADDUPAMT     @FAMT                           S01280
     C                     Z-ADDHKDN38    @FDLNO                          S01280
     C                     MOVE HKCCY     @FRCCY                          S01280
     C                     END                                            S01280
     C           FILRC2    IFEQ 'DLDLIRF1'                                S01280
     C                     Z-ADDMDAT      @IVDAT                          S01280
     C                     Z-ADDUPAMT     @IAMT                           S01280
     C                     Z-ADDHKDN38    @IRDNO                          S01280
     C                     MOVE HKCCY     @IRCCY                          S01280
     C                     Z-ADDUEINR     HKINTR                          S01280
     C                     Z-ADDUPAMT     HKAMNP                          S01280
     C                     END                                            S01280
     C           FILRC2    IFEQ 'DLDLIRF2'                                S01280
     C                     Z-ADDMDAT      @IVDAT                          S01280
     C                     Z-ADDTPAMT     @IAMT                           S01280
     C                     Z-ADDHKDN38    @IRDNO                          S01280
     C                     MOVE HKCCY     @IRCCY                          S01280
     C                     Z-ADDTEINR     HKINTR                          S01280
     C                     Z-SUBTPAMT     HKAMNP                          S01280
     C                     END                                            S01280
      *                                                                   S01280
     C           #BHD9     ENDSR                           ** #BHD9**     S01280
      *                                                                   S01280
      *****************************************************************   S01280
      /EJECT                                                              S01280
      *****************************************************************   S01280
      *                                                               *   S01280
      *  #BHE - FUTURES PROCESSING                                    *   S01280
      *  CALLED BY : #BH                                              *   S01280
      *                                                               *   S01280
      *  CALLS :     ZA0710 - CONVERT MIDAS DAY NO. TO YYYYMMDD.      *   S01280
      *                                                               *   S01280
      *  USES:       @@DAYN - (5,0) INPUT FOR ZA0710                  *   S01280
      *              @@VDT  - (8, ) OUTPUT FROM ZA0710                *   S01280
      *                                                               *   S01280
      *****************************************************************   S01280
      *                                                                   S01280
     C           #BHE      BEGSR                                          S01280
      *                                                                   S01280
      *  To save processing chain only if customer number has changed.    S01280
     C           CUSC      IFNE @@CNM                                     S01280
      *                                                                   S01280
     C                     MOVE *BLANKS   @CUKEY                          S01280
     C                     MOVELCUSC      @CUKEY                          S01280
      *                                                                   S01280
      * Get customer shortname from SDCUSTPD using key just set up,       S01280
      * via call to Access Object                                         S01280
     C                     CALL 'AOCUSTR0'                                S01280
     C                     PARM '*DBERR ' @RTCD   7                       S01280
     C                     PARM '*KEY   ' @OPTN   7                       S01280
     C                     PARM           @CUKEY 10                       S01280
     C                     PARM *BLANKS   @KYST   7                       S01280
     C           SDCUST    PARM SDCUST    DSSDY                           S01280
      *                                                                   S01280
     C                     END                                            S01280
      *                                                                   S01280
     C                     MOVELBBCSSN    HKCSNM                          S01280
     C**********           Z-ADDCUSC      @@CNM                                        S01280 CSD027
     C                     MOVE CUSC      @@CNM                                               CSD027
      *                                                                   S01280
      * Set up value date and settlement date.                            S01280
      * NOTE:The settlement date is shown as the other date, it is not    S01280
      * possible to pick up this deal using this date.                    S01280
     C                     MOVEA*IN,80    @WIN    1                       S01280
     C                     Z-ADDFARD      @@DAYN                          S01280
     C                     EXSR ZA0710                                    S01280
     C                     MOVE @@VDT     @MDATE                          S01280
     C                     MOVEA@WIN      *IN,80                          S01280
      *                                                                   S01280
     C                     MOVEA*IN,80    @WIN                            S01280
     C                     Z-ADDSETL      @@DAYN                          S01280
     C                     EXSR ZA0710                                    S01280
     C                     MOVE @@VDT     @VDATE                          S01280
     C                     MOVEA@WIN      *IN,80                          S01280
      *  Set up buy/sell field.                                           S01280
     C           TRTY      IFEQ 'P'                                       S01280
     C                     MOVE 'B'       DDBOS                           S01280
     C                     ELSE                                           S01280
     C                     MOVE 'S'       DDBOS                           S01280
     C                     END                                            S01280
      *                                                                   S01280
      *  Set upsign for the amount.                                       S01280
     C           TRTY      IFEQ 'P'                                       S01280
      *                                                                   S01280
     C                     Z-SUBULPR      HKAMNP                          S01280
      *                                                                   S01280
     C                     ELSE                                           S01280
      *                                                                   S01280
     C                     Z-ADDULPR      HKAMNP                          S01280
      *                                                                   S01280
     C                     END                                            S01280
      *  Set up new fields into the renamed fields(they are workfields    S01280
      *  and should have been named #...)                                 S01280
     C                     MOVE *BLANKS   DDDTYP                          S01280
     C                     MOVELISTT      DDDTYP                          S01280
     C                     Z-ADDRATE      HKINTR                          S01280
      *  Set up subfile hidden field - used for deal selection.           S01280
     C                     MOVE 'FUT'     DDHID                           S01280
      *  Set up fields for full key.                                      S01280
     C                     Z-ADDSETL      @FDAT                           S01280
     C                     Z-ADDHKDN38    @FUDNO                          S01280
     C                     MOVE HKCCY     @FUCCY                          S01280
      *                                                                   S01280
     C           #BHE9     ENDSR                           ** #BHE9**     S01280
      *                                                                   S01280
      *****************************************************************   S01280
      /EJECT
      *****************************************************************   S01149
      *                                                               *   S01149
      *  #BHB- THIS ROUTINE SETS UP DETAIL LINES                      *   S01149
      *                                                               *   S01149
      *        AMOUNTS, RATES AND DATES ARE EDITED FOR DISPLAY.       *   S01149
      *                                                               *   S01149
      *        ALL EDITED FIELDS SO OBTAINED ARE PLACED IN THEIR      *   S01149
      *        CORRESPONDING POSITIONS OF THE DATA STRUCTURE @DETLS,  *   S01149
      *        WHICH IS THEN MOVED INTO THE RELEVANT POSITION FOR     *   S01149
      *        THIS RECORD IN THE DATA STRUCTURE @AMENQ USING THE     *   S01149
      *        ARRAY @AM.                                             *   S01149
      *                                                               *   S01149
      *  CALLED BY : #BH                                              *   S01149
      *                                                               *   S01149
      *  CALLS :     MM1016                                           *   S01149
      *              ZA0720                                           *   S01149
      *              #ZA                                              *   S01149
      *                                                               *   S01149
      *  USES:     @I     - COUNTER                                   *   S01149
      *            @@DTIN - INPUT DATE TO ZA0720 YYYYMMDD             *   S01149
      *            @@RIN  - INPUT RATE TO #ZA                         *   S01149
      *            @B     - OUTPUT RATE FROM #ZA                      *   S01149
      *            @INTRT - EDITED RATE                               *   S01149
      *            @@IAMT - INPUT AMOUNT TO MM1016                    *   S01149
      *            @@CCY  - INPUT CURRENCY TO MM1016                  *   S01149
      *            @@AMOU - OUTPUT AMOUNT FROM MM1016                 *   S01149
      *            @PRAMT - EDITED AMOUNT                             *   S01149
      *            @DETLS - DATA STRUCTURE WHICH HOLDS CADVMALL       *   S01149
      *                     INFORMATION FOR EACH RECORD               *   S01149
      *            @AM    - ARRAY OF CADVMALL DATA FOR EACH RECORD    *   S01149
      *            @RRFSH - ROLL/REFRESH KEY FIELD                    *   S01149
      *****************************************************************   S01149
      *                                                                   S01149
     C           #BHB      BEGSR                                          S01149
      *                                                                   S01149
      **  Edit amount.                                                    S01149
     C                     MOVE HKCCY     @@CCY   3                       S01149
     C                     EXSR MM1016                                    S01149
     C                     MOVE @@AMOU    @PRAMT                          S01149
      *                                                                   S01149
      **  Edit deal interest rate.                                        S01149
     C                     MOVE *BLANKS   @INTRT                          S01149
     C                     Z-ADDHKINTR    @@RIN                           S01149
     C                     EXSR #ZA                                       S01149
     C                     MOVEA@B        @INTRT                          S01149
      *   Set up buy/sell indicator.                                      S01280
     C                     MOVE HKRBSI    DDBOS                           S01280
      *                                                                   S01149
      ** If rate is negative and no room in @B for sign, set sign on      S01149
      ** rate to display.                                                 S01149
     C           *IN77     IFEQ '1'                        B*1            S01149
     C                     MOVE '-'       @INTRT           **1            S01149
     C                     END                             E*1            S01149
      *                                                                   S01149
      **   Set up display line.                                           S01149
     C*******              MOVE @DETLS    @AM,@I           *3             SO1166
     C                     Z-ADD@I        @X               *3             SO1166
     C                     EXSR #ZE                        *3             SO1166
      *                                                                   S01149
      **   If first line, set up CA38CPLL field.                   S01149 S01166
     C           @I        IFEQ 1                          B*1     S01149 S01166
     C**********           MOVEL@@DTIN    @RRFSH            S01149 S01166 S01280
     C                     MOVEL@MDATE    @RRFSH           **1            S01280
     C                     MOVE HKDN38    @HKDNO           **1     S01149 S01166
     C                     Z-ADDHKAMNP    @HKAMN           **1     S01149 S01166
     C*******              MOVE @RRFSH    FARKB1           **1     S01149 S01166
     C                     MOVE @RRFSH    FARKT1                   S01149 S01166
     C                     MOVE 'CAD'     @RLWDN           **1            S01280
     C                     END                             E*1     S01149 S01166
      *                                                                   S01149
      **   Could be last line of screen: Set up CA38CPLL field.    S01149 S01166
     C                     MOVEL@@DTIN    @RRFSH                   S01149 S01166
     C                     MOVE HKDN38    @HKDNO                   S01149 S01166
     C                     Z-ADDHKAMNP    @HKAMN                   S01149 S01166
     C*******              MOVE @RRFSH    FARKT1                   S01149 S01166
     C                     MOVE @RRFSH    FARKB1                          S01280
     C                     MOVE 'CAD'     @BLINE  3                       S01280
      *                                                                   S01149
      **   Set on indicator to show that records have been processed      S01149
     C                     MOVE '1'       *IN61                           S01149
      **   Add 1 to accumulator counting lines written to the screen      S01149
     C                     ADD  1         @I                              S01149
      *                                                                   S01149
      *                                                                   S01149
      *                                                                   S01149
     C           #BHB9     ENDSR                           ** #BHB9**     S01149
      *
      *****************************************************************
      /EJECT
     C****************************************************************
     C*                                                              *
     C*    #ZE  WRITES TO ENQUIRY SUBFILE                            *
     C*        CALLED BY  : #BG  #BGB #BH  #BHB                      *
     C*        CALLS      :                                          *
     C*                                                              *
     C****************************************************************
     C*
     C           #ZE       BEGSR
     C*
     C* clear subfile
     C           @SFLCL    IFEQ 'N'
     C                     SETOF                     3536
     C**********           WRITEDL3200C1                                  S01117
     C                     WRITETM3200C1                                  S01117
     C                     MOVE 'Y'       @SFLCL
     C                     END
      *                                                                   S01280
      * For the following deal types change from DRS deal type to midas   S01280
      * deal type.                                                        S01280
     C           CADFMT    IFEQ 'MMDEVMP0'                                S01280
     C           CADFMT    OREQ 'MMDEVMP1'                                S01280
     C           CADFMT    OREQ 'MMDENSP0'                                S01280
     C           CADFMT    OREQ 'MMDENBP0'                                S01280
     C           CADFMT    OREQ 'MMDENBP1'                                S01280
     C                     MOVE *BLANKS   DDDTYP                          S01280
     C                     MOVELMIDTYP    DDDTYP                          S01280
     C                     END                                            S01280
     C*
     C           @@FILE    IFEQ 'LEN'                                                         CLE148
     C                     MOVE HKLNRF    DDDEAL                                              CLE148
     C                     ELSE                                                               CLE148
     C                     MOVE HKDN38    DDDEAL
     C                     ENDIF                                                              CLE148
      *
     C                     MOVE HKCSNM    DDCUST
     C                     MOVE @MVDAT    DDDAT
     C                     MOVE @INTRT    DDRATE
     C                     MOVE @PRAMT    DDAMNT
     C*
     C                     Z-ADD@X        RRN     20
     C*
     C**********           WRITEDL3200S1                                  S01117
     C                     WRITETM3200S1                                  S01117
     C*
     C           RRN       IFEQ 1
      *
     C           @@FILE    IFEQ 'LEN'                                                         CLE148
     C                     MOVELHKLNRF    @TOPDL                                              CLE148
     C                     ELSE                                                               CLE148
     C                     MOVELHKDN38    @TOPDL
     C                     ENDIF                                                              CLE148
      *
     C                     END
     C*
      * Set subfile written flag                                          S01280
     C                     MOVE 'Y'       @SFILE  1                       S01280
     C                     ENDSR
     C/EJECT
      *****************************************************************
      *                                                               *
      *  #A - THIS ROUTINE PERFORMS INITIAL PROCESSING                *
      *                                                               *
      *  CALLED BY : CONTROL PROCESSING                               *
      *                                                               *
      ***CALLS*******ZA0150********************************************   S01194
      *  CALLS :                                                      *   S01194
      *              ZA0280                                           *
      *                                                               *
      *                                                               *
      *  USES :    @TERM  - TERMINATION INPUT PARAMETER               *
      *            @ENQ   - ENQUIRY UPDATED INPUT PARAMETER           *
      *            @RRFSH - ROLL/REFRESH INPUT PARAMETER              *
      *            @FCYC  - FIRST TIME PROGRAM CALLED IN CURRENT      *
      *                     INVOCATION                                *
      *            @AMENQ - SCREEN ENQUIRY DATA AREA                  *
      *                                                               *
      *****************************************************************
      *
     C           #A        BEGSR
      * Define fields                                                     S01280
     C           *LIKE     DEFN DDALL     @DALL                           S01280
     C           *LIKE     DEFN DDNA      @DNA                            S01280
     C           *LIKE     DEFN DDLD      @DLD                            S01280
     C           *LIKE     DEFN DDLEN     @DLEN                           S01280
     C           *LIKE     DEFN DDFRA     @DFRA                           S01280
     C           *LIKE     DEFN DDIRS     @DIRS                           S01280
     C           *LIKE     DEFN DDFUT     @DFUT                           S01280
      *
      **  Receive input parameters.
     C           *ENTRY    PLIST
     C                     PARM           @TERM   1
     C*******              PARM           @ENQ    1                       SO1166
     C*******              PARM           @RRFSH                          SO1166
     C                     PARM           @PRMPT                          SO1166
      *
      **  If termination parameter is 'T', set LR. No further             SO1166
      **  processing in this routine.                                     SO1166
     C*******    @TERM     IFEQ 'T'                        B1             SO1166
     C*******              MOVE '1'       *INLR            *1             SO1166
     C*******              GOTO #A9                        *1             SO1166
     C*******              END                             E1             SO1166
      *
      *   Set off all indicators                                          SO1166
     C                     MOVE '0'       *IN,01                          SO1166
      *                                                                   SO1166
      *   Set on message subfile indicator                                SO1166
     C                     MOVE '1'       *IN40                           SO1166
      *                                                                   SO1166
      **  Initialise screen message queue                                 SO1166
     C                     MOVEL'*'       DDPGMQ                          SO1166
      *                                                                   SO1166
      **  Move workstation id to screen field                             SO1166
     C                     MOVEL@JOB      DDWSID                          SO1166
      *                                                                   SO1166
      *
      **  Check if this is the first time this program has been
      **  called in the current invocation and perform the appropriate
      **  processing.
     C           @FCYC     IFNE 'Y'                        B1
      *
      **  Set up program name in *LDA in case of data base error.
     C******               MOVEL'MM0090'  DBPGM            *1             S01166
     C**********           MOVEL'DL3200'  DBPGM            *1      S01166 S01117
     C                     MOVEL'TM3200'  DBPGM            *1             S01117
      *
      ** Open all files under user control.
     C**********           OPEN FDICDRLL                   *1             S01194
     C                     OPEN FDMNTHLL                   *1
     C******               OPEN CA38CPLL                   *1             S01166
     C                     OPEN MMFWDDLL                   *1
     C*******              OPEN MMDVMALL                   *1             S01145
     C                     OPEN CADVMALL                   *1             S01145
     C*********************OPEN*FDINSTLL********************1*************S01319
     C**********           OPEN FDCCYTLL                   *1             S01194
     C**********           OPEN CLINT                      *1      S01145 S01194
     C                     OPEN DLMMTOLL                   *1             S01280
      *
     C****Open*FDUSSILL*if*first*time*through***********************S01166S01319
      **  Open MUSER if first time through                                S01319
     C           @FD1ST    IFEQ *BLANK                                    SO1166
     C                     MOVE 'N'       @FD1ST  1                       SO1166
     C*********************OPEN*FDUSSILL****************************S01166S01319
     C                     OPEN MUSER                                     S01319
     C                     END                                            SO1166
      *                                                                   SO1166
     C*********************MOVEL@USER*****@USER3**3*****************SO1166S01319
     C**************************************************************SO1166S01319
     C***********@USER3****CHAINFDUSSIP0*************71*************SO1166S01319
     C**************************************************************SO1166S01319
     C****DB*error*if*user*not*found********************************SO1166S01319
     C************IN71*****IFEQ*'1'*********************************SO1166S01319
     C*********************MOVE*'901'*****DBASE**************2******S01166S01319
     C*********************MOVE*'FDUSSILL'DBFILE*************2******S01166S01319
     C*********************MOVEL@USER3****DBKEY**************2*ERRORS01166S01319
     C*********************MOVE*'1'********INU7**************2**901*S01166S01319
     C*********************MOVE*'1'********INU8**************2******S01166S01319
     C*********************GOTO*#A9**************************2******S01166S01319
     C*********************END*****************************E*2******S01166S01319
     C           @USER     CHAINMUSER                71                   S01319
     C*                                                                   S01319
     C           *IN71     IFEQ '1'                        B*2            S01319
     C*                                                                   S01319
     C                     MOVEL'MUSER'   DBFILE           ***************S01319
     C                     MOVE '901'     DBASE            *             *S01319
     C                     MOVEL@USER     DBKEY            * DBERROR 901 *S01319
     C                     MOVE '1'       *INU7                           S01319
     C                     MOVE '1'       *INU8            ************** S01319
     C                     GOTO #A9                                       S01319
     C*                                                                   S01319
     C                     END                             E*2            S01319
     C*                                                                   S01166
     C* DO DISPLAY FILE OVERRIDE BEFORE OPEN                              S01166
     C***********USREF*****IFEQ*'Y'************************B*2******S01166S01319
     C           AURF      IFEQ 'Y'                        B*2            S01319
     C                     MOVEL@OVR,1    @OVRID           **2            S01166
     C*********************Z-ADDUSRFPD****@WAIT**************2******S01166S01319
     C                     Z-ADDREFP      @WAIT            **2            S01319
     C                     Z-ADD36        QCALEN 155       **2            S01166
     C*********************CALL 'QCAEXEC'                  **2      S01166E20774
     C                     CALL 'QCMDEXC'                  **2            E20774
     C                     PARM           @OVRID           **2            S01166
     C                     PARM           QCALEN           **2            S01166
     C                     END                             E*2            S01166
     C*                                                                   S01166
     C**********           OPEN DL3200DD                   *1      SO1166 S01117
     C                     OPEN TM3200DD                   *1             S01117
     C*                                                                   S01166
      ****Read*the*installation*control*data*file****                     S01194
     C**********           EXSR ZA0150                     *1             S01194
      *                                                                   S01194
      * Get Bank's details from SDBANKPD via Access Object                S01194
      * (Note that *DBERR is used as standard return code although        S01194
      * this will not normally produce a DB error due to access           S01194
      * object having already been called in SD1600)                      S01194
     C                     CALL 'AOBANKR0'                                S01194
     C                     PARM '*DBERR ' @RTCD   7                       S01194
     C                     PARM '*FIRST ' @OPTN   7                       S01194
     C           SDBANK    PARM SDBANK    DSFDY                           S01194
      *                                                                   S01194
      * Get Module details via Access Object                              S01194
     C                     CALL 'AOMMODR0'                                S01194
     C                     PARM '*DBERR ' @RTCD   7                       S01194
     C                     PARM '*FIRST ' @OPTN   7                       S01194
     C           SDMMOD    PARM SDMMOD    DSFDY                           S01194
      *                                                                   S01194
      * Check for Futures, Lending and FRA/IRS present                    S01194
      *                                                                   S01194
     C* Lending                                                           S01194
     C           BGCSLN    IFEQ 'Y'                                       S01194
     C                     MOVE '1'       *IN41                           S01194
     C                     END                                            S01194
     C* Futures                                                           S01194
     C           BGFUOP    IFEQ 'Y'                                       S01194
     C                     MOVE '1'       *IN43                           S01194
     C                     END                                            S01194
     C* FRA/IRS                                                           S01194
     C           BGFIIN    IFEQ 'Y'                                       S01194
     C                     MOVE '1'       *IN42                           S01194
     C                     END                                            S01194
      *                                                                   S01194
      ****If*a*data*base*error*has*occured**set*U7*&*U8***                S01194
      ****No*further*processing*required***                               S01194
     C********** *IN80     IFEQ '1'                        B*2            S01194
     C**********           MOVE '1'       *INU7            **2            S01194
     C**********           MOVE '1'       *INU8            **2            S01194
     C**********           GOTO #A9                        **2            S01194
     C**********           END                             E*2            S01194
      *
      **  Read the month shortnames file.
     C                     EXSR ZA0280                     *1
      *
      **  If a data base error has occured, set U7 & U8.
      **  No further processing required.
     C           *IN80     IFEQ '1'                        B*2
     C                     MOVE '1'       *INU7            **2
     C                     MOVE '1'       *INU8            **2
     C                     GOTO #A9                        **2
     C                     END                             E*2
      *
      **  Read the installation control data file.
     C***********1*********CHAINFDINSTLL*************76*****1*************S01319
     C********************************************************************S01319
     C****If*no*record*found.*********************************************S01319
     C************IN76*****IFEQ*'1'************************B*2************S01319
     C*********************MOVEL'001'*****DBASE***************************S01319
     C*********************MOVEL'FDINSTLL'DBFILE**************************S01319
     C*********************MOVEL'1'*******DBKEY**************DBERROR*001**S01319
     C*********************MOVE*'1'********INU7***************************S01319
     C*********************MOVE*'1'********INU8***************************S01319
     C*********************GOTO*#A9**************************2************S01319
     C*********************END*****************************E*2************S01319
     C** Access Deal details via access program                           S01319
      *  (database error handling done in access program)                 S01319
     C**********           CALL 'AODEALR0'                                             S01319 CGL029
     C                     CALL 'AODEALR1'                                                    CGL029
     C                     PARM '*DBERR ' @RTCD   7                       S01319
     C                     PARM '*FIRST ' @OPTN   7                       S01319
     C********** SDDEAL    PARM SDDEAL    DSFDY                                        S01319 CGL029
     C           SDDEAL    PARM SDDEAL    DSSDY                                               CGL029
      *
      **  Set flag that first invocation processing has been
      **  successfully completed.
     C                     MOVE 'Y'       @FCYC   1        *1
     C                     END                             E1
      *
      **  Read CA38CPLL.                                                  S01166
     C******     1         CHAINCA38CPLL             76                   S01166
      ******                                                              S01166
      **  If no record found.                                             S01166
     C******     *IN76     IFEQ '1'                        B1             S01166
     C******               MOVEL'002'     DBASE            ***************S01166
     C******               MOVEL'CA38CPLL'DBFILE           *             *S01166
     C******               MOVEL'1'       DBKEY            * DBERROR 002 *S01166
     C******               MOVE '1'       *INU7            *             *S01166
     C******               MOVE '1'       *INU8            ***************S01166
     C******               GOTO #A9                        *1             S01166
     C******               END                             E1             S01166
      *
      **  Define, read and initialise data area AMENQ1AA.
     C*******    *NAMVAR   DEFN AMENQ1AA  @AMENQ                          SO1166
     C*******    *LOCK     IN   @AMENQ                                    SO1166
     C                     MOVE *BLANKS   @AMENQ
      *
      *******  Define MMDVMALL partial key.                               S01149
     C******     @HKKY4    KLIST                                          S01149
     C******               KFLD           @HKCCY  3                       S01149
     C******               KFLD           @HKCY   40                      S01149
     C******               KFLD           @HKMM   20                      S01149
     C******               KFLD           @HKDD   20                      S01149
      *
      ******  Define MMDVMALL full key.                                   S01149
     C******     @HKKY8    KLIST                                          S01149
     C******               KFLD           @HKCCY  3                       S01149
     C******               KFLD           @HKCY   40                      S01149
     C******               KFLD           @HKMM   20                      S01149
     C******               KFLD           @HKDD   20                      S01149
     C******               KFLD           @HKCY1  40                      S01149
     C******               KFLD           @HKMM1  20                      S01149
     C******               KFLD           @HKDD1  20                      S01149
     C******               KFLD           @HKAMN                          S01149
     C******               KFLD           @HKDNO  60                      S01149
      *
      **  Define CADVMALL partial key.
     C           @HKKY4    KLIST
     C                     KFLD           @HKCCY  3
     C                     KFLD           @HKCY   40
     C                     KFLD           @HKMM   20
     C                     KFLD           @HKDD   20
      *                                                                   S01280
      **  Set up '* TAKE ON IN PROGRESS *' or 'LAST TAKE ON xx:xx:xx      S01280
      *                                                                   S01280
     C           1         SETLLDLMMTOLL                                  S01280
     C                     READ DLMMTOLL                 79               S01280
      *                                                                   S01280
     C           TOTOIP    IFEQ 'Y'                                       S01280
     C                     MOVEL'* TAKE ' @TKON                           S01280
     C                     MOVE 'ON IN '  @TKON                           S01280
     C                     MOVE 'PR'      @PR                             S01280
     C                     MOVEL'OGRESS ' @OGR                            S01280
     C                     MOVE '*'       @OGR                            S01280
     C                     MOVE @TOIP     DDSTS                           S01280
     C                     ELSE                                           S01280
     C                     MOVEL' LAST T' @LTON                           S01280
     C                     MOVE 'AKE ON'  @LTON                           S01280
     C                     MOVE *BLANKS   @BLNK                           S01280
     C                     MOVE @@SEC     @SEC                            S01280
     C                     MOVE ':'       @DASH1                          S01280
     C                     MOVE @@MIN     @MIN                            S01280
     C                     MOVE ':'       @DASH2                          S01280
     C                     MOVE @@HOUR    @HOUR                           S01280
     C                     MOVE @LTONT    DDSTS                           S01280
     C                     END                                            S01280
      *                                                                   S01280
      **  Only open if FUTURES installed.                                 S01280
     C           *IN43     IFEQ '1'                                       S01280
     C                     OPEN DLFUTSLL                                  S01280
     C                     END                                            S01280
      **  Only open if FRA/IRS installed.                                 S01280
     C           *IN42     IFEQ '1'                                       S01280
     C                     OPEN DLDLFRLL                                  S01280
     C                     OPEN DLDLIRLL                                  S01280
     C                     END                                            S01280
      **  Only open if LENDING installed.                                 S01280
     C           *IN41     IFEQ '1'                                       S01280
     C                     OPEN DLCLONLL                                  S01280
     C                     END                                            S01280
      *                                                                   S01280
      **  Define DLCLONLL partial key.                                    S01280
     C           @DLKY1    KLIST                                          S01280
     C                     KFLD           @HKCCY  3                       S01280
     C                     KFLD           @HKCYY  50                      S01280
      *                                                                   S01280
      **  Define DLDLFRLL partial key.                                    S01280
     C           @DLKY2    KLIST                                          S01280
     C                     KFLD           @HKCCY  3                       S01280
     C                     KFLD           @HKCYY  50                      S01280
      *                                                                   S01280
      **  Define DLFUTSLL partial key.                                    S01280
     C           @DLKY3    KLIST                                          S01280
     C                     KFLD           @HKCCY  3                       S01280
     C                     KFLD           @HKCYY  50                      S01280
      *
      **  Define MMFWDDLL partial key.                                    S01149
     C           @HKKY5    KLIST                                          S01149
     C                     KFLD           @HKCCY  3                       S01149
     C                     KFLD           @HKCY   40                      S01149
     C                     KFLD           @HKMM   20                      S01149
     C                     KFLD           @HKDD   20                      S01149
     C                     KFLD           @HKTYP  2                       S01149
      *
      **  Define CADVMALL full key.
     C           @HKKY8    KLIST
     C                     KFLD           @HKCCY  3
     C                     KFLD           @HKCY   40
     C                     KFLD           @HKMM   20
     C                     KFLD           @HKDD   20
     C                     KFLD           @HKCY1  40
     C                     KFLD           @HKMM1  20
     C                     KFLD           @HKDD1  20
     C                     KFLD           @HKAMN
     C                     KFLD           @HKDNO  60
      *                                                                   S01280
      **  Define @DLKY4 full key for DLCLONLL.                            S01280
     C           @DLKY4    KLIST                                          S01280
     C                     KFLD           @LECCY  3                       S01280
     C                     KFLD           @LMDAT  50                      S01280
     C                     KFLD           @LVDAT  50                      S01280
     C                     KFLD           @LAMT  130                      S01280
     C**********           KFLD           @LELNO  60                                   S01280 CLE148
     C                     KFLD           @LELNO  6                                           CLE148
      *                                                                   S01280
      **  Define @DLKY5 full key for DLDLFRLL.                            S01280
     C           @DLKY5    KLIST                                          S01280
     C                     KFLD           @FRCCY  3                       S01280
     C                     KFLD           @FVDAT  50                      S01280
     C                     KFLD           @FAMT  130                      S01280
     C                     KFLD           @FDLNO  60                      S01280
      *                                                                   S01280
      **  Define @DLKY6 full key for DLFUTSLL.                            S01280
     C           @DLKY6    KLIST                                          S01280
     C                     KFLD           @FUCCY  3                       S01280
     C                     KFLD           @FDAT   50                      S01280
     C                     KFLD           @FUDNO  60                      S01280
      *                                                                   S01280
      **  Define DLDLIRLL partial key.                                    S01280
     C           @DLKY7    KLIST                                          S01280
     C                     KFLD           @HKCCY  3                       S01280
     C                     KFLD           @HKCYY  50                      S01280
      *                                                                   S01280
      **  Define @DLKY8 full key for DLDLIRLL.                            S01280
     C           @DLKY8    KLIST                                          S01280
     C                     KFLD           @IRCCY  3                       S01280
     C                     KFLD           @IVDAT  50                      S01280
     C                     KFLD           @IAMT  130                      S01280
     C                     KFLD           @IRDNO  60                      S01280
      *
     C* set subfile clear flag                                            S01166
     C                     MOVE 'N'       @SFLCL  1                       SO1166
      *                                                                   S01280
      * Update on-screen time                                             S01280
     C                     TIME           DDTIME                          S01280
     C*
     C*   INHIBIT ROLL KEYS AND SET ON END OF MESSAGE AND ENQUIRY         S01166
     C*   SUBFILE INDICATORS                                              S01166
     C                     MOVE '1'       *IN27                           S01166
     C                     MOVE '1'       *IN40                           S01166
     C                     MOVE '1'       *IN30                           S01166
     C*                                                                   S01166
      **  Write screen header and command key text
     C**********           WRITEDL3200F0               63          S01166 S01117
     C                     WRITETM3200F0               63                 S01117
     C**********           WRITEDL3200F1               63          S01166 S01117
     C                     WRITETM3200F1               63                 S01117
     C*                                                                   S01166
     C                     MOVE '0'       *IN35                           S01166
     C                     MOVE '1'       *IN36                           S01166
     C*                                                                   S01166
     C*  IF PARAMETERS BLANK,WRITE THE PROMPT SCREEN BY SETTING           S01166
     C*  ON THE SUBFILE DISPLAY CONTROL INDICATOR                         S01166
     C           @PRMPT    IFEQ *BLANKS                                   S01166
     C**********           EXFMTDL3200C1               63          S01166 S01117
     C                     EXFMTTM3200C1               63                 S01117
     C                     END                                            S01166
     C*                                                                   S01166
     C** PROCESS HELP WHILE IT IS REQUESTED AND RE-READ THE SCREEN        S01166
     C*                                                                   S01166
     C**         *IN10     DOWEQ'1'                        B1      S01166 S01199
     C**                   CALL 'SDMENU'                   *1      S01166 S01199
     C**                   MOVE '0'       *IN10            *1      S01166 S01199
     C**                   READ DL3200DD               0589*1      S01166 S01199
     C**                   END                             E1      S01166 S01199
      *
      ** EXIT
     C           *IN01     IFEQ '1'
     C                     MOVE '1'       *INLR
     C                     MOVE 'Q'       @TERM                           E90090
     C                     END                             E1             S01166
     C*                                                                   048215
     C           *IN02     IFEQ '1'                                       048215
     C                     MOVE 'U'       @TERM                           048215
     C                     MOVE '1'       *INLR                           048215
     C                     END                                            048215
      *
     C           #A9       ENDSR                           ** #A9 **
      *
      *****************************************************************
      /EJECT
      *****************************************************************
      *                                                               *
      *  #C - THIS ROUTINE PERFORMS FINAL PROCESSING                  *
      *                                                               *
      *  CALLED BY :  CONTROL PROCESSING                              *
      *                                                               *
      *  CALLS :      CM0020                                          *
      *                                                               *
      *  USES :       @AMENQ    -  SCREEN ENQUIRY DATA AREA           *
      *               @ENQ      -  ENQUIRY UPDATED INPUT PARAMETER    *
      *               @TERM     -  CM0020 PARAMETER                   *
      *               @EMID     -  CM0020 PARAMETER                   *
      *               @SWER     -  CM0020 PARAMETER                   *
      *               @PARM2    -  CM0020 PARAMETER                   *
      *               @PARM3    -  CM0020 PARAMETER                   *
      *               @PARM4    -  CM0020 PARAMETER                   *
      *                                                               *
      *****************************************************************
      *
     C           #C        BEGSR
      *
      **  If last record indicator set, no further processing.            SO1166
     C*******    *INLR     CABEQ'1'       #C9                             SO1166
     C*                                                                   SO1166
     C**  If CMD3 pressed or error occured return to calling prog         SO1166
     C           @TERM     IFEQ 'Q'                                       SO1166
     C           @TERM     OREQ 'E'                                       SO1166
     C                     GOTO #C8                                       SO1166
     C                     END                                            SO1166
      *
      **  If U7 set, close program.
     C           *INU7     IFEQ '1'                        B1
     C                     MOVE 'E'       @TERM            *1
     C                     MOVE '1'       *INLR            *1
     C                     GOTO #C8                        *1
     C                     END                             E1
      *
      **  If enquiry-updated input parameter is either 'U' or 'D'
      **  and no records to be displayed.
     C           @ENQ      IFEQ 'U'                        B1
     C           *IN70     ANDEQ'1'                        X1
     C           @ENQ      OREQ 'D'                        X1
     C           *IN70     ANDEQ'1'                        X1
      *
      **  Release the CA38CPLL record.                                    S01166
     C******               EXCPT@RLS01                     *1             S01166
      *
      **  Unlock AMENQ1AA.                                                SO1166
     C*******              UNLCK@AMENQ                     *1             SO1166
      *
      **  Call PC format/transmission program.                            SO1166
     C*******              CALL 'CM0020'                   *1             SO1166
     C*******              PARM *BLANK    @TERM   1        *1             SO1166
     C*******              PARM 'ER'      @EMID   2        *1             SO1166
     C*******              PARM '1'       @SWER   1        *1             SO1166
     C*******              PARM @ENQ      @PARM2  1        *1             SO1166
     C*******              PARM '999'     @PARM3  3        *1             SO1166
     C*******              PARM *BLANK    @PARM4  1        *1             SO1166
      *
     C                     GOTO #C8                        *1
     C                     END                             E1
      *
      **  PROCESSING FOR NORMAL UPDATE OF AMENQ1AA.
      *
      **  Update CA38CPLL.                                                S01166
     C******               EXCPT@UPD01                                    S01166
      *
      **  Update AMENQ1AA.                                                SO1166
     C*******              OUT  @AMENQ                                    SO1166
      *
      **  Call PC format/transmission program.                            SO1166
     C*******              CALL 'CM0020'                                  SO1166
     C*******              PARM *BLANK    @TERM   1                       SO1166
     C*******              PARM 'ER'      @EMID                           SO1166
     C*******              PARM '1'       @SWER                           SO1166
     C*******              PARM @ENQ      @PARM2                          SO1166
     C*******              PARM '102'     @PARM3                          SO1166
     C*******              PARM *BLANK    @PARM4                          SO1166
      *
     C           #C8       TAG                              ** #C8 **
      *
      **  Return to calling program.
     C                     RETRN
      *
     C           #C9       ENDSR                            ** #C9 **
      *
      *****************************************************************
      /EJECT
      *****************************************************************   S01194
      **********                                                      *   S01194
      ********SUBROUTINE ZA0150 - THIS SUBROUTINE CHAINS TO FILE LF/  *   S01194
      ********FDICDRLL TO GET THE INSTALLATION CONTROL DETAILS RECORD *   S01194
      ********1*(HELD ON PF/TABTB10)                                  *   S01194
      ********INDICATOR 80 IS SET ON IF THE CHAIN FAILS OR THE RECORD *   S01194
      ********IS FLAGGED FOR DELETION.                                *   S01194
      ********IF INDICATOR 80 IS SET ON DETAILS OF THE ATTEMPTED      *   S01194
      ********ACCESS ARE PLACED IN THE LDA.                           *   S01194
      **********                                                      *   S01194
      ********FIELDS USED : SS0150 - KEY USED TO ACCESS FDICDRLL      *   S01194
      **********                                                      *   S01194
      *****************************************************************   S01194
      **********                                                          S01194
     C********** ZA0150    BEGSR                                          S01194
      **********                                                          S01194
      ***SET*UP*KEY TO OBTAIN FORMAT TABTB10F '01        10'              S01194
     C**********           MOVEL'01'      SS0150 12                       S01194
     C**********           MOVE '10'      SS0150                          S01194
      **********                                                          S01194
      ***CHAIN*TO FILE FDICDRLL                                           S01194
     C********** SS0150    CHAINFDICDRLL             80                   S01194
     C********** RECI      IFNE 'D'                        B1             S01194
     C**********           MOVE '1'       *IN80            *1             S01194
     C**********           END                             E1             S01194
      **********                                                          S01194
      ***DEAL*WITH DATA BASE ERROR                                        S01194
     C********** *IN80     IFEQ '1'                        ***************S01194
     C**********           MOVEL'FDICDRLL'DBFILE           *             *S01194
     C**********           MOVEL'900'     DBASE            * DBERROR 900 *S01194
     C**********           MOVELSS0150    DBKEY            *             *S01194
     C**********           END                             ***************S01194
      **********                                                          S01194
     C********** ZA0159    ENDSR                           ** ZA0159 **   S01194
      *****************************************************************   S01194
      /EJECT
      *****************************************************************
      *                                                               *
      *       SUBROUTINE ZA0280 - THIS SUBROUTINE READS THE ONLY      *
      *       RECORD ON LF/FDMNTHLL TO GET MONTH NAMES AND SHORTNAMES.*
      *       INDICATOR 80 IS SET ON IF THE RECORD IS NOT PRESENT OR  *
      *       IS FLAGGED FOR DELETION.                                *
      *       IF INDICATOR IS SET ON INFORMATION ABOUT THE NATURE     *
      *       OF THE ATTEMPTED FILE ACCESS WILL BE PLACED IN THE LDA. *
      *                                                               *
      *       FIELDS USED : SS0280 - KEY USED TO ACCESS FDMNTHLL      *
      *                                                               *
      *****************************************************************
      *
     C           ZA0280    BEGSR
      *
      **  READ FIRST RECORD ON FILE LF/FDINSTPP
     C                     Z-ADD1         SS0280  10
     C           SS0280    CHAINFDMNTHLL             80
      *
      **  CHECK LOGICAL DELETE FLAG BLANK
     C           MNDLTF    IFNE ' '                        B1
     C                     MOVE '1'       *IN80            *1
     C                     END                             E1
      *
      ** DEAL WITH DATA BASE ERROR
     C           *IN80     IFEQ '1'                        ***************
     C                     MOVEL'FDMNTHLL'DBFILE           *             *
     C                     MOVE *BLANKS   DBKEY            * DBERROR 906 *
     C                     MOVEL'906'     DBASE            *             *
     C                     END                             ***************
      *
     C           ZA0289    ENDSR                           ** ZA0289 **
      *****************************************************************
      /EJECT
     C***********************************************************************
     C*                                                                     *
     C* ZA0830 - THIS SUBROUTINE FINDS OUT WHETHER A PARTICULAR DAY         *
     C*          IS A HOLIDAY IN A PARTICULAR CURRENCY                      *
     C*
     C* CALLED BY :                                                         *
     C*                                                                     *
     C* CALLS :                                                             *
     C*                                                                     *
     C* INPUT  : @@MNO  MIDAS DAY NUMBER 5N                                 *
     C*          @@CCY  CURRENCY CODE 3A                                    *
     C*                                                                     *
     C* OUTPUT : @@HIND HOLIDAY/WORKING DAY INDICATOR 1A                    *
     C*
     C* USES :   @@MNO  MIDAS DAY NUMBER                                    *
     C*          @@CCY  CURRENCY CODE                                       *
     C*          @@ONCE FIRST TIME THROUGH INDICATOR                        *
     C*          @@CY1  FIRST HALF OF CURRENCY ARRAY                        *
     C*          @@CY2  SECOND HALF OF CURRENCY ARRAY                       *
     C*          @@MNO6 MIDAS NUMBER WITH TRAILING BLANK                    *
     C*          @@HIND HOLIDAY/WORKING DAY INDICATOR                       *
     C*          @@INEX INCLUDE/EXCLUDE INDICATOR                           *
     C*                                                                     *
     C*          INDICATORS                                                 *
     C*          80 RECORD NOT FOUND                                        *
     C*          81 CURRENCY NOT FOUND ON RECORD                            *
     C*                                                                     *
     C***********************************************************************
     C********** ZA0830    BEGSR                                   S01166 E21656
     C**********                                                   S01166 E21656
     C** OPEN CURRENCY/HOLIDAY FILE IF FIRST TIME THROUGH          S01166 E21656
     C********** @@ONCE    IFNE 'Y'                        B1      S01166 E21656
     C**********           OPEN FDTABJLL                   *1      S01166 E21656
     C**********           MOVE 'Y'       @@ONCE  1        *1      S01166 E21656
     C**********           END                             E1      S01166 E21656
     C**********                                                   S01166 E21656
     C** BLANK OUT ARRAY                                           S01166 E21656
     C**********           MOVE *BLANKS   @@CY1                    S01166 E21656
     C**********           MOVE *BLANKS   @@CY2                    S01166 E21656
     C**********                                                   S01166 E21656
     C** ACCESS TABLE ON FIRST KEY                                 S01166 E21656
     C**********           MOVEL@@MNO     @@MNO6  6                S01166 E21656
     C**********           MOVE @@MNO6    @@0830 12                S01166 E21656
     C**********           MOVEL'22    '  @@0830                   S01166 E21656
     C**********           MOVE '1'       @@0830                   S01166 E21656
     C********** @@0830    CHAINTABLETJF             80            S01166 E21656
     C**********                                                   S01166 E21656
     C** IF RECORD NOT FOUND OR DELETED                            S01166 E21656
     C********** *IN80     IFEQ '1'                        B1      S01166 E21656
     C********** RECI      OREQ '*'                        *1      S01166 E21656
     C**********           MOVE 'W'       @@HIND           *1      S01166 E21656
     C**********           GOTO ZA0839                     *1      S01166 E21656
     C**********           END                             E1      S01166 E21656
     C**********                                                   S01166 E21656
     C** MOVE FIRST 25 CURRENCIES TO ARRAY                         S01166 E21656
     C**********           MOVE HCCY      @@CY1                    S01166 E21656
     C**********                                                   S01166 E21656
     C** ACCESS TABLE ON SECOND KEY                                S01166 E21656
     C**********           MOVE '2'       @@0830                   S01166 E21656
     C********** @@0830    CHAINTABLETJF             80            S01166 E21656
     C**********                                                   S01166 E21656
     C** IF SECOND RECORD FOUND AND NOT DELETED                    S01166 E21656
     C********** *IN80     IFEQ '0'                        B1      S01166 E21656
     C********** RECI      ANDNE'*'                        *1      S01166 E21656
     C**********           MOVE HCCY      @@CY2            *1      S01166 E21656
     C**********           END                             E1      S01166 E21656
     C**********                                                   S01166 E21656
     C** SEARCH ARRAY FOR INPUT CURRENCY                           S01166 E21656
     C********** @@CCY     LOKUP@CY                      81        S01166 E21656
     C**********                                                   S01166 E21656
     C** IF INPUT CURRENCY IS IN ARRAY                             S01166 E21656
     C********** *IN81     IFEQ '1'                        B1      S01166 E21656
     C**********                                                   S01166 E21656
     C** IF INCLUDE/EXCLUDE INDICATOR EQ 'E'                       S01166 E21656
     C********** INEX      IFEQ 'E'                        B*2     S01166 E21656
     C**********           MOVE 'W'       @@HIND  1        **2     S01166 E21656
     C**********           ELSE                            X*2     S01166 E21656
     C**********           MOVE 'H'       @@HIND           **2     S01166 E21656
     C**********           END                             E*2     S01166 E21656
     C**********           END                             E1      S01166 E21656
     C**********                                                   S01166 E21656
     C** IF INPUT CURRENCY IS NOT IN ARRAY                         S01166 E21656
     C********** *IN81     IFEQ '0'                        B1      S01166 E21656
     C**********                                                   S01166 E21656
     C** IF INCLUDE/EXCLUDE INDICATOR EQ 'I'                       S01166 E21656
     C********** INEX      IFEQ 'I'                        B*2     S01166 E21656
     C**********           MOVE 'W'       @@HIND           **2     S01166 E21656
     C**********           ELSE                            X*2     S01166 E21656
     C**********           MOVE 'H'       @@HIND           **2     S01166 E21656
     C**********           END                             E*2     S01166 E21656
     C**********           END                             E1      S01166 E21656
     C********** ZA0839    ENDSR                                   S01166 E21656
      /EJECT                                                              S01280
     C*****************************************************************   S01280
     C*                                                               *   S01280
     C*       TITLE:CALCULATE MIDAS DAY NO. TO DRS (YYYYMMDD) FORMAT. *   S01280
     C*                                                               *   S01280
     C*       SUBROUTINE                                                  S01280
     C*       PASSED TO IT IN 5,0 FORMAT.IF THE ABOVE FIELD IS LESS   *   S01280
     C*       THAN 1 IT RETURNS 1 IN FIELD '@@RTN'.THE MAIN PROGRAM   *   S01280
     C*       SHOULD CHECK FOR THIS CONDITION AND DO THE NECESSARY.   *   S01280
     C*       IF '@@RTN' IS NOT EQUAL TO 1 IT RETURNS THE FIELD       *   S01280
     C*       '@@VDT'  IN 'YYYYMMDD' FORMAT.                          *   S01280
     C*                                                               *   S01280
     C* NOTE: FIELD TO BE DEFINED BY EXTERNAL ROUTINE IS                  S01280
     C*                                                               *   S01280
     C*       1) @@DAYN   LENGTH 5,0.                                 *   S01280
     C*                                                               *   S01280
     C*       FIELDS USED AND ALREADY DEFINED IN THE ROUTINE ARE:     *   S01280
     C*                                                               *   S01280
     C*       1) @@VDT    LENGTH 8,0 DEFINED BY A DS.                 *   S01280
     C*       2) @@RTN    LENGTH 1,0.                                 *   S01280
     C*       3) @@I      LENGTH 2,0 USED TO ACCESS ARRAY @YD         *   S01280
     C*       4) @@J      LENGTH 2,0 USED TO ACCESS ARRAY @MD         *   S01280
     C*       5) @@Z71Y   LENGTH 4,0 DEFINED BY A DS.                 *   S01280
     C*       6) @@RDAY   LENGTH 5,0.                                 *   S01280
     C*       7) @@LEAP   LENGTH 1,0.                                     S01280
     C*                                                               *   S01280
     C*       INDICATORS USED ARE:                                    *   S01280
     C*                                                               *   S01280
     C*       1) 80       CHECK FOR LOW AND EQUAL ON ARRAY @YD        *   S01280
     C*       2) 81       CHECK FOR LOW ON ARRAY @MD.                 *   S01280
     C*                                                               *   S01280
     C* INPUT FIELD:       @@DAYN                                     *   S01280
     C*                                                               *   S01280
     C* OUTPUT FIELD:      @@VDT                                      *   S01280
     C*                                                               *   S01280
     C* WORK FIELDS:       @@RTN                                      *   S01280
     C*                    @@Z71Y                                     *   S01280
     C*                    @@RDAY                                     *   S01280
     C*                    @@LEAP                                     *   S01280
     C*                    @@I                                        *   S01280
     C*                    @@J                                        *   S01280
     C*                                                               *   S01280
     C* ARRAYS USED:       @YD COMPILE TIME ARRAY.                        S01280
     C*                    @MD COMPILE TIME ARRAY.                        S01280
     C*                                                                   S01280
     C*****************************************************************   S01280
     C*                                                                   S01280
     C           ZA0710    BEGSR                                          S01280
     C*                                                                   S01280
     C                     SETOF                     8081                 S01280
     C                     Z-ADD0         @@RTN   10                      S01280
     C                     Z-ADD0         @@VDT                           S01280
     C                     Z-ADD1         @@I     20                      S01280
     C                     Z-ADD1         @@J     20                      S01280
     C                     Z-ADD1         @@LEAP  10                      S01280
     C*                                                                   S01280
     C           @@DAYN    CABEQ0         ZA0719                          S01280
     C*                                                                   S01280
     C           @@DAYN    IFLT 1                                         S01280
     C                     Z-ADD1         @@RTN                           S01280
     C                     GOTO ZA0719                                    S01280
     C                     END                                            S01280
     C*                                                                   S01280
     C* DIVISION TO DETERMINE WETHER LEAP YEAR.                           S01280
     C*                                                                   S01280
     C           @@DAYN    DIV  1461      @@Z71Y                          S01280
     C                     MVR            @@RDAY  50                      S01280
     C*                                                                   S01280
     C* CALCULATING YEAR.                                                 S01280
     C*                                                                   S01280
     C           @@Z71Y    MULT 4         @@Z71Y                          S01280
     C                     ADD  1972      @@Z71Y                          S01280
     C*                                                                   S01280
     C* CHECKING IF YEAR IS GREATER THAN OR EQUAL TO 2100                 S01280
     C*                                                                   S01280
     C           @@Z71Y    IFGE 2100                                      S01280
     C                     ADD  @@SSY2    @@RDAY                          S01280
     C                     END                                            S01280
     C*                                                                   S01280
     C* LOKUP ARRAY @YD TO SEE HOW MANY YEARS OF A FOUR YEAR CYCLE        S01280
     C* HAVE PASSED.                                                      S01280
     C*                                                                   S01280
     C           @@RDAY    LOKUP@YD,@@I                8080               S01280
     C*                                                                   S01280
     C* IF YEAR IS A LEAP YEAR SSLEAP IS SET TO ZERO.                     S01280
     C*                                                                   S01280
     C           *IN80     IFEQ '0'                                       S01280
     C                     Z-ADD0         @@LEAP                          S01280
     C                     END                                            S01280
     C*                                                                   S01280
     C* ADD INDEX TO YEAR TO GIVE CORRECT YEAR AND ADJUST '@@RDAY'.       S01280
     C*                                                                   S01280
     C           @@LEAP    IFEQ 1                                         S01280
     C           @@RDAY    SUB  @YD,@@I   @@RDAY                          S01280
     C                     ADD  @@I       @@Z71Y                          S01280
     C                     END                                            S01280
     C*                                                                   S01280
     C* PROCESSING FOR A LEAP YEAR.                                       S01280
     C*                                                                   S01280
     C           @@LEAP    IFEQ 0                                         S01280
     C*                                                                   S01280
     C* IF '@@RDAY' = 60 DATE MUST BE 29TH OF FEBRUARY.                   S01280
     C*                                                                   S01280
     C           @@RDAY    IFEQ 60                                        S01280
     C                     Z-ADD29        @@Z71D                          S01280
     C                     Z-ADD2         @@Z71M                          S01280
     C                     GOTO ZA0711                                    S01280
     C                     END                                            S01280
     C*                                                                   S01280
     C* IF '@@RDAY' > 60 DATE IS AFTER 29TH OF FEBRUARY,CONVERSION CAN    S01280
     C* PROCEED AS USUAL AFTER SUBTRACTING THE EXTRA DAY FOR THE LEAP     S01280
     C* YEAR. NOTE : '@@RDAY' < 60 CONVERSION PROCEEDS AS USUAL.          S01280
     C*                                                                   S01280
     C           @@RDAY    IFGT 60                                        S01280
     C           @@RDAY    SUB  1         @@RDAY                          S01280
     C                     END                                            S01280
     C*                                                                   S01280
     C                     END                                            S01280
     C*                                                                   S01280
     C* IF DAY '@@DAYN' IS EXACTLY DIVISIBLE BY 1461 (NUMBER OF DAYS      S01280
     C* IN 4 YEARS) THEN DATE MUST BE LAST DAY OF PREVIOUS FOUR YEAR      S01280
     C* GROUP.                                                            S01280
     C*                                                                   S01280
     C           @@RDAY    IFEQ 0                                         S01280
     C                     Z-ADD31        @@Z71D                          S01280
     C                     Z-ADD12        @@Z71M                          S01280
     C                     SUB  1         @@Z71Y                          S01280
     C                     GOTO ZA0711                                    S01280
     C                     END                                            S01280
     C*                                                                   S01280
     C* LOOK UP ARRAY ARRAY @MD TO DETERMINE WHICH MONTH '@@RDAY'         S01280
     C* OCCURS IN                                                         S01280
     C*                                                                   S01280
     C           @@RDAY    LOKUP@MD,@@J                81                 S01280
     C                     Z-ADD@@J       @@Z71M                          S01280
     C           @@RDAY    SUB  @MD,@@J   @@Z71D                          S01280
     C*                                                                   S01280
     C* DS @@VDT  IS RETURNED IN YYYYMMDD FORMAT                          S01280
     C*                                                                   S01280
     C           ZA0711    TAG                                            S01280
     C*                                                                   S01280
     C                     MOVE @@Z71Y    @@YR                            S01280
     C*                                                                   S01280
     C           ZA0719    ENDSR                                          S01280
      /EJECT                                                              S01166
      *****************************************************************
      *                                                               *
      * *PSSR - PROGRAM ERROR SUBROUTINE                              *
      *                                                               *
      * CALLED BY:   EXECUTES WHENEVER PROGRAM ERROR OCCURS           *
      *                                                               *
      * CALLS:                                                        *
      *                                                               *
      * USES :  @ERR1  - FLAG TO PREVENT LOOPING IF FURTHER ERRORS    *
      *         @TERM  - TERMINATION PARAMETER                        *
      *                                                               *
      *****************************************************************
      *
     C           *PSSR     BEGSR
      *
      ** SET @ERR1 TO 'Y' TO PREVENT LOOPING IF FURTHER ERRORS
     C           @ERR1     IFNE 'Y'                        B1
     C                     MOVE 'Y'       @ERR1   1        *1
     C                     MOVE '1'       *INU6            *1
      *                                                    *1
      ** SET UP FIELDS IN LOCAL DATA AREA                  *1
     C******               MOVEL'MM0090'  DBPGM            *1             S01166
     C**********           MOVEL'DL3200'  DBPGM            *1      S01166 S01117
     C                     MOVEL'TM3200'  DBPGM            *1             S01117
     C                     MOVE '991'     DBASE            *1
      *                                                    *1
      ** DUMP THE PROGRAM                                  *1
     C                     DUMP                            *1
     C                     MOVE 'E'       @TERM
     C                     END                             E1
      *
      ** TERMINATE THE PROGRAM
     C                     MOVE '1'       *INLR
     C                     RETRN
      *
     C                     ENDSR
      *
      *****************************************************************
      /EJECT
      *****************************************************************
      *                                                               *
      * INFSR - FILE EXCEPTION/ERROR SUBROUTINE                       *
      *                                                               *
      * CALLED BY:   EXECUTES WHENEVER FILE EXCEPTION/ERROR OCCURS    *
      *                                                               *
      * CALLS:                                                        *
      *                                                               *
      * USES :  @ERR2  - FLAG TO PREVENT LOOPING IF FURTHER ERRORS    *
      *         @TERM  - TERMINATION PARAMETER                        *
      *         @FILE  - FILENAME FOR WHICH EXCEPTION/ERROR           *
      *                  OCCURRED (POSNS 201-208 OF PSDS)             *
      *                                                               *
      *****************************************************************
      *
     C           INFSR     BEGSR
      *
      ** SET @ERR2 TO 'Y' TO PREVENT LOOPING IF FURTHER ERRORS
     C           @ERR2     IFNE 'Y'                        B1
     C                     MOVE 'Y'       @ERR2   1        *1
     C                     MOVE '1'       *INU7            *1
     C                     MOVE '1'       *INU8            *1
      *                                                    *1
      ** SET UP FIELDS IN LOCAL DATA AREA                  *1
     C                     MOVEL@FILE     DBFILE           *1
     C                     MOVE '992'     DBASE            *1
      *                                                    *1
      ** DUMP THE PROGRAM                                  *1
     C                     DUMP                            *1
     C                     MOVE 'E'       @TERM
     C                     END                             E1
      *
      ** TERMINATE THE PROGRAM
     C                     MOVE '1'       *INLR
     C                     RETRN
      *
     C                     ENDSR
      *
      *****************************************************************
      *S01280 ADDED ARRAYS @YD AND @MD - FOR USE IN ZA0710
      /EJECT
** @OVR  CL COMMAND FOR CALL TO QCMDEXC                             S01166E20774
OVRDSPF FILE(TM3200DD) WAITRCD(9999)                                      S01117
** @YD  USED BY SR. ZA0710 - YEARS, IN DAYS, CUMULATIVE IN 4 YEAR SPAN
00366007310109601461
** @MD  USED BY SR. ZA0710 - MONTHS IN DAYS CUMULATIVE THROUGH YEAR
00000000310005900090001200015100181002120024300273003040033400365
** CPY@ - COPYRIGHT STATEMENT                                             S01117
(c) Finastra International Limited 2001
