/*********************************************************************/
/*STD    CLPBASEBND                                                  */
/*EXI    TEXT('Midas UP Global password migration')                  */
/*********************************************************************/
/*                                                                   */
/*       Midas - Bridge                                              */
/*                                                                   */
/*       UPC000708 - Migration of global password                    */
/*                                                                   */
/*       (c) Finastra International Limited 2021                     */
/*                                                                   */
/*       Last Amend No. MD059682           Date 07Mar22              */
/*       Prev Amend No. MD054346 *CREATE   Date 18Jul21              */
/*                                                                   */
/*********************************************************************/
/*                                                                   */
/*       MD059682 - use GPUPASPD to avoid Undefined record type      */
/*       MD054346 - Switchable Features Password Encryption          */
/*                                                                   */
/*********************************************************************/
             PGM        PARM(&DDSNWF &OLDFILE &NEWLIB &OLDLIB &ERROR)

             DCL        VAR(&DDSNWF) TYPE(*CHAR) LEN(10)
             DCL        VAR(&NEWLIB) TYPE(*CHAR) LEN(10)
             DCL        VAR(&OLDLIB) TYPE(*CHAR) LEN(10)
             DCL        VAR(&OLDFILE) TYPE(*CHAR) LEN(10)
             DCL        VAR(&NBRCURRCD) TYPE(*DEC) LEN(10 0)
             DCL        VAR(&ERROR) TYPE(*CHAR) LEN(10)

/* Parameters passed to UP008010. */
             DCL        VAR(&GENPGM)   TYPE(*CHAR) LEN(10)  VALUE('UPC000708')
             DCL        VAR(&ERRORMSG) TYPE(*CHAR) LEN(100)

             COPYRIGHT TEXT('(c) Finastra International Limited +
                          2021')

             MONMSG     MSGID(CPF0000 MCH0000 RPG0000) EXEC(GOTO +
                          CMDLBL(ABNOR))

/* Migrate file first */
             CALL       PGM(UP000710) PARM(&DDSNWF &OLDFILE &NEWLIB &OLDLIB &ERROR)
             IF         COND(&ERROR *NE '          ') THEN(GOTO ABNOR)

/* Migrate password in validation list*/
/**********  DLTF       FILE(QTEMP/GPPASSPD) */                                         /*MD059682*/
/**********  MONMSG     MSGID(CPF0000) */                                               /*MD059682*/
/**********  CPYF       FROMFILE(&OLDLIB/GPPASSPD) +
                          TOFILE(QTEMP/GPPASSPD) CRTFILE(*YES) */                       /*MD059682*/
             CPYF       FROMFILE(&OLDLIB/GPPASSPD) +
                          TOFILE(GPUPASPD) MBROPT(*REPLACE)                             /*MD059682*/

             CALL       PGM(UP000708) PARM(&NEWLIB &ERROR)
             IF         COND(&ERROR *NE '          ') THEN(GOTO ABNOR)

             GOTO       CMDLBL(END)

ABNOR:
             CHGJOB     SWS(XXXXXX11)
             DMPCLPGM

END:
             ENDPGM
