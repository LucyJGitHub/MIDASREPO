/*********************************************************************/
/*STD    CLPBASEBND                                                  */
/*EXI    TEXT('Midas UP OTR main server program')                    */
/*********************************************************************/
/*                                                                   */
/*       Midas - Bridge                                              */
/*                                                                   */
/*       UPC7001 - OTR main server program                           */
/*                                                                   */
/*       Function: This program runs the server job OTBRSERVER. It   */
/*                 submits all the components and updates their      */
/*                 status.                                           */
/*                                                                   */
/*       (c) Finastra International Limited 2022                     */
/*                                                                   */
/*       Last Amend No. CUP045   *CREATE   Date 01Jun22              */
/*                                                                   */
/*********************************************************************/
/*                                                                   */
/*       CUP045 - One Touch Bridge - refresh                         */
/*                                                                   */
/*********************************************************************/
             PGM       PARM(&LAYER &PRFX &BRGBRGLIB)

             DCL        VAR(&LAYER) TYPE(*CHAR) LEN(7)
             DCL        VAR(&PRFX) TYPE(*CHAR) LEN(2)
             DCL        VAR(&BRGBRGLIB) TYPE(*CHAR) LEN(10)
             DCL        VAR(&ERRPGM) TYPE(*CHAR) LEN(10)
             DCL        VAR(&RETURN) TYPE(*CHAR) LEN(10)
             DCL        VAR(&DTQN) TYPE(*CHAR) LEN(10)
             DCL        VAR(&MSGLEN) TYPE(*DEC) LEN(5 0) VALUE(50)
             DCL        VAR(&MSGDATA) TYPE(*CHAR) LEN(50)
             DCL        VAR(&RCVWAIT) TYPE(*DEC) LEN(5 0) VALUE(-1)
             DCL        VAR(&STIME) TYPE(*CHAR) LEN(6)
             DCL        VAR(&FLDVAL) TYPE(*CHAR) LEN(100)
             DCL        VAR(&ERROR) TYPE(*CHAR) LEN(10)
             DCL        VAR(&RERUN) TYPE(*CHAR) LEN(4) VALUE('*NO')

             COPYRIGHT TEXT('(c) Finastra International Limited +
                          2022')

/* Global monitor message */
             MONMSG     MSGID(CPF0000 MCH0000 RPG0000) EXEC(GOTO +
                          CMDLBL(ERROR))

             CHGVAR     VAR(&ERRPGM) VALUE('UPC7001')

/* Create DTAQ for the server */
             CHGVAR     VAR(&DTQN) VALUE('UP_OTBRSVR')
             DLTDTAQ    DTAQ(&BRGBRGLIB/&DTQN)
             MONMSG     MSGID(CPF2105)
             CRTDTAQ    DTAQ(&BRGBRGLIB/&DTQN) MAXLEN(50) TEXT('UP +
                           Server DTAQ for OTB refresh')
             RMVLIBLE   LIB(&BRGBRGLIB)
             MONMSG     MSGID(CPF2104)
             ADDLIBLE   LIB(&BRGBRGLIB)

/********* Compoment 1 *********/
 COMPONENT1:

/* update start time */
             RTVSYSVAL  SYSVAL(QTIME) RTNVAR(&STIME)
             CHGVAR     VAR(&FLDVAL) VALUE(&STIME)
             CALL UP7001 ('*UPDATE   ' ' '   'DSTRG1' &FLDVAL &ERROR)
             IF         COND(&ERROR *NE '          ') THEN(GOTO ERROR)

/* submit component */
             SBMJOB     CMD(CALL PGM(UPC7011) PARM(&LAYER &PRFX +
                          &BRGBRGLIB &RETURN )) JOB(OTR_SVALVC) +
                          JOBQ(&BRGBRGLIB/SMJOBQNM)

/* wait for the component to be completed */
             CALL       PGM(QRCVDTAQ) PARM(&DTQN '*LIBL' &MSGLEN +
                          &MSGDATA &RCVWAIT)

/* If component ran ok, update status and end time */
             IF         COND(&MSGDATA *EQ 'COMPLETE') THEN(DO)
/* Update Script Work File job Status with 'Complete' */
             RTVSYSVAL  SYSVAL(QTIME) RTNVAR(&STIME)
             CHGVAR     VAR(&FLDVAL) VALUE(&STIME)
             CALL UP7001 ('*UPDATE   ' ' '   'DENDG1' &FLDVAL &ERROR)
             IF         COND(&ERROR *NE '          ') THEN(GOTO ERROR)
             CHGVAR     VAR(&FLDVAL) VALUE('C')
             CALL UP7001 ('*UPDATE   ' ' '   'DCMPG1' &FLDVAL &ERROR)
             IF         COND(&ERROR *NE '          ') THEN(GOTO ERROR)
             CHGVAR     VAR(&FLDVAL) VALUE('+')
             CALL UP7001 ('*UPDATE   ' ' '   'DNOCMC' &FLDVAL &ERROR)
             IF         COND(&ERROR *NE '          ') THEN(GOTO ERROR)
             GOTO       CMDLBL(COMPONEN11)
             ENDDO

/* If component did not run ok, update status and end time */
             IF         COND(&MSGDATA *NE 'COMPLETE') THEN(DO)
/* Update Script Work File job Status with 'FAIL' */
             RTVSYSVAL  SYSVAL(QTIME) RTNVAR(&STIME)
             CHGVAR     VAR(&FLDVAL) VALUE(&STIME)
             CALL UP7001 ('*UPDATE   ' ' '   'DENDG1' &FLDVAL &ERROR)
             IF         COND(&ERROR *NE '          ') THEN(GOTO ERROR)
             CHGVAR     VAR(&FLDVAL) VALUE('F')
             CALL UP7001 ('*UPDATE   ' ' '   'DCMPG1' &FLDVAL &ERROR)
             IF         COND(&ERROR *NE '          ') THEN(GOTO ERROR)
             ENDDO

/* and wait for the component to be restarted */
             CALL       PGM(QRCVDTAQ) PARM(&DTQN '*LIBL' &MSGLEN +
                          &MSGDATA &RCVWAIT)

             IF         COND(&MSGDATA *EQ 'CONTINUE') THEN(DO)
             CHGVAR     VAR(&FLDVAL) VALUE('           ')
             CALL UP7001 ('*UPDATE   ' ' '   'DENDG1' &FLDVAL &ERROR)
             IF         COND(&ERROR *NE '          ') THEN(GOTO ERROR)
             CHGVAR     VAR(&FLDVAL) VALUE(' ')
             CALL UP7001 ('*UPDATE   ' ' '   'DCMPG1' &FLDVAL &ERROR)
             IF         COND(&ERROR *NE '          ') THEN(GOTO ERROR)

             GOTO       CMDLBL(COMPONENT1)
             ENDDO
             ELSE CMD(DO)
             GOTO       CMDLBL(ERROR)
             ENDDO

/********* Compoment 11 *********/
 COMPONEN11:

/* update start time */
             RTVSYSVAL  SYSVAL(QTIME) RTNVAR(&STIME)
             CHGVAR     VAR(&FLDVAL) VALUE(&STIME)
             CALL UP7001 ('*UPDATE   ' ' '   'DSTRG11' &FLDVAL &ERROR)
             IF         COND(&ERROR *NE '          ') THEN(GOTO ERROR)

/* submit component */
             SBMJOB     CMD(CALL PGM(UPC70111) PARM(&LAYER &PRFX +
                          &BRGBRGLIB &RETURN )) JOB(OTR_DDSSAV) +
                          JOBQ(&BRGBRGLIB/SMJOBQNM)

/* wait for the component to be completed */
             CALL       PGM(QRCVDTAQ) PARM(&DTQN '*LIBL' &MSGLEN +
                          &MSGDATA &RCVWAIT)

/* If component ran ok, update status and end time */
             IF         COND(&MSGDATA *EQ 'COMPLETE') THEN(DO)
/* Update Script Work File job Status with 'Complete' */
             RTVSYSVAL  SYSVAL(QTIME) RTNVAR(&STIME)
             CHGVAR     VAR(&FLDVAL) VALUE(&STIME)
             CALL UP7001 ('*UPDATE   ' ' '   'DENDG11' &FLDVAL &ERROR)
             IF         COND(&ERROR *NE '          ') THEN(GOTO ERROR)
             CHGVAR     VAR(&FLDVAL) VALUE('C')
             CALL UP7001 ('*UPDATE   ' ' '   'DCMPG11' &FLDVAL &ERROR)
             IF         COND(&ERROR *NE '          ') THEN(GOTO ERROR)
             CHGVAR     VAR(&FLDVAL) VALUE('+')
             CALL UP7001 ('*UPDATE   ' ' '   'DNOCMC' &FLDVAL &ERROR)
             IF         COND(&ERROR *NE '          ') THEN(GOTO ERROR)
             GOTO       CMDLBL(COMPONENT2)
             ENDDO

/* If component did not run ok, update status and end time */
             IF         COND(&MSGDATA *NE 'COMPLETE') THEN(DO)
/* Update Script Work File job Status with 'FAIL' */
             RTVSYSVAL  SYSVAL(QTIME) RTNVAR(&STIME)
             CHGVAR     VAR(&FLDVAL) VALUE(&STIME)
             CALL UP7001 ('*UPDATE   ' ' '   'DENDG11' &FLDVAL &ERROR)
             IF         COND(&ERROR *NE '          ') THEN(GOTO ERROR)
             CHGVAR     VAR(&FLDVAL) VALUE('F')
             CALL UP7001 ('*UPDATE   ' ' '   'DCMPG11' &FLDVAL &ERROR)
             IF         COND(&ERROR *NE '          ') THEN(GOTO ERROR)
             ENDDO

/* and wait for the component to be restarted */
             CALL       PGM(QRCVDTAQ) PARM(&DTQN '*LIBL' &MSGLEN +
                          &MSGDATA &RCVWAIT)

             IF         COND(&MSGDATA *EQ 'CONTINUE') THEN(DO)
             CHGVAR     VAR(&FLDVAL) VALUE('           ')
             CALL UP7001 ('*UPDATE   ' ' '   'DENDG11' &FLDVAL &ERROR)
             IF         COND(&ERROR *NE '          ') THEN(GOTO ERROR)
             CHGVAR     VAR(&FLDVAL) VALUE(' ')
             CALL UP7001 ('*UPDATE   ' ' '   'DCMPG11' &FLDVAL &ERROR)
             IF         COND(&ERROR *NE '          ') THEN(GOTO ERROR)

             GOTO       CMDLBL(COMPONEN11)
             ENDDO
             ELSE CMD(DO)
             GOTO       CMDLBL(ERROR)
             ENDDO

/********* Compoment 2 *********/
 COMPONENT2:

/* update start time */
             RTVSYSVAL  SYSVAL(QTIME) RTNVAR(&STIME)
             CHGVAR     VAR(&FLDVAL) VALUE(&STIME)
             CALL UP7001 ('*UPDATE   ' ' '   'DSTRG2' &FLDVAL &ERROR)
             IF         COND(&ERROR *NE '          ') THEN(GOTO ERROR)

/* submit component */
             SBMJOB     CMD(CALL PGM(UPC7012) PARM(&LAYER &PRFX +
                          &BRGBRGLIB &RETURN )) JOB(OTR_INIT) +
                          JOBQ(&BRGBRGLIB/SMJOBQNM)

/* wait for the component to be completed */
             CALL       PGM(QRCVDTAQ) PARM(&DTQN '*LIBL' &MSGLEN +
                          &MSGDATA &RCVWAIT)

/* If component ran ok, update status and end time */
             IF         COND(&MSGDATA *EQ 'COMPLETE') THEN(DO)
/* Update Script Work File job Status with 'Complete' */
             RTVSYSVAL  SYSVAL(QTIME) RTNVAR(&STIME)
             CHGVAR     VAR(&FLDVAL) VALUE(&STIME)
             CALL UP7001 ('*UPDATE   ' ' '   'DENDG2' &FLDVAL &ERROR)
             IF         COND(&ERROR *NE '          ') THEN(GOTO ERROR)
             CHGVAR     VAR(&FLDVAL) VALUE('C')
             CALL UP7001 ('*UPDATE   ' ' '   'DCMPG2' &FLDVAL &ERROR)
             IF         COND(&ERROR *NE '          ') THEN(GOTO ERROR)
             CHGVAR     VAR(&FLDVAL) VALUE('+')
             CALL UP7001 ('*UPDATE   ' ' '   'DNOCMC' &FLDVAL &ERROR)
             IF         COND(&ERROR *NE '          ') THEN(GOTO ERROR)
             GOTO       CMDLBL(COMPONENT3)
             ENDDO

/* If component did not run ok, update status and end time */
             IF         COND(&MSGDATA *NE 'COMPLETE') THEN(DO)
/* Update Script Work File job Status with 'FAIL' */
             RTVSYSVAL  SYSVAL(QTIME) RTNVAR(&STIME)
             CHGVAR     VAR(&FLDVAL) VALUE(&STIME)
             CALL UP7001 ('*UPDATE   ' ' '   'DENDG2' &FLDVAL &ERROR)
             IF         COND(&ERROR *NE '          ') THEN(GOTO ERROR)
             CHGVAR     VAR(&FLDVAL) VALUE('F')
             CALL UP7001 ('*UPDATE   ' ' '   'DCMPG2' &FLDVAL &ERROR)
             IF         COND(&ERROR *NE '          ') THEN(GOTO ERROR)
             ENDDO

/* and wait for the component to be restarted */
             CALL       PGM(QRCVDTAQ) PARM(&DTQN '*LIBL' &MSGLEN +
                          &MSGDATA &RCVWAIT)

             IF         COND(&MSGDATA *EQ 'CONTINUE') THEN(DO)
             CHGVAR     VAR(&FLDVAL) VALUE('           ')
             CALL UP7001 ('*UPDATE   ' ' '   'DENDG2' &FLDVAL &ERROR)
             IF         COND(&ERROR *NE '          ') THEN(GOTO ERROR)
             CHGVAR     VAR(&FLDVAL) VALUE(' ')
             CALL UP7001 ('*UPDATE   ' ' '   'DCMPG2' &FLDVAL &ERROR)
             IF         COND(&ERROR *NE '          ') THEN(GOTO ERROR)

             GOTO       CMDLBL(COMPONENT2)
             ENDDO
             ELSE CMD(DO)
             GOTO       CMDLBL(ERROR)
             ENDDO

/********* Compoment 3 *********/
 COMPONENT3:

/* update start time */
             RTVSYSVAL  SYSVAL(QTIME) RTNVAR(&STIME)
             CHGVAR     VAR(&FLDVAL) VALUE(&STIME)
             CALL UP7001 ('*UPDATE   ' ' '   'DSTRG3' &FLDVAL &ERROR)
             IF         COND(&ERROR *NE '          ') THEN(GOTO ERROR)

/* submit component */
             SBMJOB     CMD(CALL PGM(UPC7013) PARM(&LAYER &PRFX +
                          &BRGBRGLIB &RETURN )) JOB(OTR_UPGMB) +
                          JOBQ(&BRGBRGLIB/SMJOBQNM)

/* wait for the component to be completed */
             CALL       PGM(QRCVDTAQ) PARM(&DTQN '*LIBL' &MSGLEN +
                          &MSGDATA &RCVWAIT)

/* If component ran ok, update status and end time */
             IF         COND(&MSGDATA *EQ 'COMPLETE') THEN(DO)
/* Update Script Work File job Status with 'Complete' */
             RTVSYSVAL  SYSVAL(QTIME) RTNVAR(&STIME)
             CHGVAR     VAR(&FLDVAL) VALUE(&STIME)
             CALL UP7001 ('*UPDATE   ' ' '   'DENDG3' &FLDVAL &ERROR)
             IF         COND(&ERROR *NE '          ') THEN(GOTO ERROR)
             CHGVAR     VAR(&FLDVAL) VALUE('C')
             CALL UP7001 ('*UPDATE   ' ' '   'DCMPG3' &FLDVAL &ERROR)
             IF         COND(&ERROR *NE '          ') THEN(GOTO ERROR)
             CHGVAR     VAR(&FLDVAL) VALUE('+')
             CALL UP7001 ('*UPDATE   ' ' '   'DNOCMC' &FLDVAL &ERROR)
             IF         COND(&ERROR *NE '          ') THEN(GOTO ERROR)
             GOTO       CMDLBL(COMPONENT4)
             ENDDO

/* If component did not run ok, update status and end time */
             IF         COND(&MSGDATA *NE 'COMPLETE') THEN(DO)
/* Update Script Work File job Status with 'FAIL' */
             RTVSYSVAL  SYSVAL(QTIME) RTNVAR(&STIME)
             CHGVAR     VAR(&FLDVAL) VALUE(&STIME)
             CALL UP7001 ('*UPDATE   ' ' '   'DENDG3' &FLDVAL &ERROR)
             IF         COND(&ERROR *NE '          ') THEN(GOTO ERROR)
             CHGVAR     VAR(&FLDVAL) VALUE('F')
             CALL UP7001 ('*UPDATE   ' ' '   'DCMPG3' &FLDVAL &ERROR)
             IF         COND(&ERROR *NE '          ') THEN(GOTO ERROR)
             ENDDO

/* and wait for the component to be restarted */
             CALL       PGM(QRCVDTAQ) PARM(&DTQN '*LIBL' &MSGLEN +
                          &MSGDATA &RCVWAIT)

             IF         COND(&MSGDATA *EQ 'CONTINUE') THEN(DO)
             CHGVAR     VAR(&FLDVAL) VALUE('           ')
             CALL UP7001 ('*UPDATE   ' ' '   'DENDG3' &FLDVAL &ERROR)
             IF         COND(&ERROR *NE '          ') THEN(GOTO ERROR)
             CHGVAR     VAR(&FLDVAL) VALUE(' ')
             CALL UP7001 ('*UPDATE   ' ' '   'DCMPG3' &FLDVAL &ERROR)
             IF         COND(&ERROR *NE '          ') THEN(GOTO ERROR)

             GOTO       CMDLBL(COMPONENT3)
             ENDDO
             ELSE CMD(DO)
             GOTO       CMDLBL(ERROR)
             ENDDO

/********* Compoment 4 *********/
 COMPONENT4:

/* update start time */
             RTVSYSVAL  SYSVAL(QTIME) RTNVAR(&STIME)
             CHGVAR     VAR(&FLDVAL) VALUE(&STIME)
             CALL UP7001 ('*UPDATE   ' ' '   'DSTRG4' &FLDVAL &ERROR)
             IF         COND(&ERROR *NE '          ') THEN(GOTO ERROR)

/* submit component */
             SBMJOB     CMD(CALL PGM(UPC7014) PARM(&LAYER &PRFX  +
                          &BRGBRGLIB &RERUN &RETURN )) JOB(OTR_RFRSH) +
                          JOBQ(&BRGBRGLIB/SMJOBQNM)

/* wait for the component to be completed */
             CALL       PGM(QRCVDTAQ) PARM(&DTQN '*LIBL' &MSGLEN +
                          &MSGDATA &RCVWAIT)

/* If component ran ok, update status and end time */
             IF         COND(&MSGDATA *EQ 'COMPLETE') THEN(DO)
/* Update Script Work File job Status with 'Complete' */
             RTVSYSVAL  SYSVAL(QTIME) RTNVAR(&STIME)
             CHGVAR     VAR(&FLDVAL) VALUE(&STIME)
             CALL UP7001 ('*UPDATE   ' ' '   'DENDG4' &FLDVAL &ERROR)
             IF         COND(&ERROR *NE '          ') THEN(GOTO ERROR)
             CHGVAR     VAR(&FLDVAL) VALUE('C')
             CALL UP7001 ('*UPDATE   ' ' '   'DCMPG4' &FLDVAL &ERROR)
             IF         COND(&ERROR *NE '          ') THEN(GOTO ERROR)
             CHGVAR     VAR(&FLDVAL) VALUE('+')
             CALL UP7001 ('*UPDATE   ' ' '   'DNOCMC' &FLDVAL &ERROR)
             IF         COND(&ERROR *NE '          ') THEN(GOTO ERROR)
             GOTO       CMDLBL(COMPONENT5)
             ENDDO

/* If component did not run ok, update status and end time */
             IF         COND(&MSGDATA *NE 'COMPLETE') THEN(DO)
/* Update Script Work File job Status with 'FAIL' */
             RTVSYSVAL  SYSVAL(QTIME) RTNVAR(&STIME)
             CHGVAR     VAR(&FLDVAL) VALUE(&STIME)
             CALL UP7001 ('*UPDATE   ' ' '   'DENDG4' &FLDVAL &ERROR)
             IF         COND(&ERROR *NE '          ') THEN(GOTO ERROR)
             CHGVAR     VAR(&FLDVAL) VALUE('F')
             CALL UP7001 ('*UPDATE   ' ' '   'DCMPG4' &FLDVAL &ERROR)
             IF         COND(&ERROR *NE '          ') THEN(GOTO ERROR)
             ENDDO

/* and wait for the component to be restarted */
             CALL       PGM(QRCVDTAQ) PARM(&DTQN '*LIBL' &MSGLEN +
                          &MSGDATA &RCVWAIT)

             IF         COND(&MSGDATA *EQ 'CONTINUE') THEN(DO)
             CHGVAR     VAR(&FLDVAL) VALUE('           ')
             CALL UP7001 ('*UPDATE   ' ' '   'DENDG4' &FLDVAL &ERROR)
             IF         COND(&ERROR *NE '          ') THEN(GOTO ERROR)
             CHGVAR     VAR(&FLDVAL) VALUE(' ')
             CALL UP7001 ('*UPDATE   ' ' '   'DCMPG4' &FLDVAL &ERROR)
             IF         COND(&ERROR *NE '          ') THEN(GOTO ERROR)

/* and set the &RERUN to '*YES' */
             CHGVAR     VAR(&RERUN) VALUE('*YES')
             GOTO       CMDLBL(COMPONENT4)
             ENDDO
             ELSE CMD(DO)
             GOTO       CMDLBL(ERROR)
             ENDDO

/********* Compoment 5 *********/
 COMPONENT5:

/* update start time */
             RTVSYSVAL  SYSVAL(QTIME) RTNVAR(&STIME)
             CHGVAR     VAR(&FLDVAL) VALUE(&STIME)
             CALL UP7001 ('*UPDATE   ' ' '   'DSTRG5' &FLDVAL &ERROR)
             IF         COND(&ERROR *NE '          ') THEN(GOTO ERROR)

/* submit component */
             SBMJOB     CMD(CALL PGM(UPC7015) PARM(&LAYER &PRFX +
                          &BRGBRGLIB &RETURN )) JOB(OTR_DDSRST) +
                          JOBQ(&BRGBRGLIB/SMJOBQNM)

/* wait for the component to be completed */
             CALL       PGM(QRCVDTAQ) PARM(&DTQN '*LIBL' &MSGLEN +
                          &MSGDATA &RCVWAIT)

/* If component ran ok, update status and end time */
             IF         COND(&MSGDATA *EQ 'COMPLETE') THEN(DO)
/* Update Script Work File job Status with 'Complete' */
             RTVSYSVAL  SYSVAL(QTIME) RTNVAR(&STIME)
             CHGVAR     VAR(&FLDVAL) VALUE(&STIME)
             CALL UP7001 ('*UPDATE   ' ' '   'DENDG5' &FLDVAL &ERROR)
             IF         COND(&ERROR *NE '          ') THEN(GOTO ERROR)
             CHGVAR     VAR(&FLDVAL) VALUE('C')
             CALL UP7001 ('*UPDATE   ' ' '   'DCMPG5' &FLDVAL &ERROR)
             IF         COND(&ERROR *NE '          ') THEN(GOTO ERROR)
             CHGVAR     VAR(&FLDVAL) VALUE('+')
             CALL UP7001 ('*UPDATE   ' ' '   'DNOCMC' &FLDVAL &ERROR)
             IF         COND(&ERROR *NE '          ') THEN(GOTO ERROR)
             GOTO       CMDLBL(COMPONENT6)
             ENDDO

/* If component did not run ok, update status and end time */
             IF         COND(&MSGDATA *NE 'COMPLETE') THEN(DO)
/* Update Script Work File job Status with 'FAIL' or 'CONFLICT'*/
             RTVSYSVAL  SYSVAL(QTIME) RTNVAR(&STIME)
             CHGVAR     VAR(&FLDVAL) VALUE(&STIME)
             CALL UP7001 ('*UPDATE   ' ' '   'DENDG5' &FLDVAL &ERROR)
             IF         COND(&ERROR *NE '          ') THEN(GOTO ERROR)
             IF         COND(&MSGDATA *EQ 'CONFLICT') THEN(DO)
             CHGVAR     VAR(&FLDVAL) VALUE('W')
             ENDDO
             ELSE       CMD(DO)
             CHGVAR     VAR(&FLDVAL) VALUE('F')
             ENDDO
             CALL UP7001 ('*UPDATE   ' ' '   'DCMPG5' &FLDVAL &ERROR)
             IF         COND(&ERROR *NE '          ') THEN(GOTO ERROR)
             ENDDO

/* and wait for the component to be restarted */
             CALL       PGM(QRCVDTAQ) PARM(&DTQN '*LIBL' &MSGLEN +
                          &MSGDATA &RCVWAIT)

             IF         COND(&MSGDATA *EQ 'CONTINUE') THEN(DO)
             CHGVAR     VAR(&FLDVAL) VALUE('           ')
             CALL UP7001 ('*UPDATE   ' ' '   'DENDG5' &FLDVAL &ERROR)
             IF         COND(&ERROR *NE '          ') THEN(GOTO ERROR)
             CHGVAR     VAR(&FLDVAL) VALUE(' ')
             CALL UP7001 ('*UPDATE   ' ' '   'DCMPG5' &FLDVAL &ERROR)
             IF         COND(&ERROR *NE '          ') THEN(GOTO ERROR)

             GOTO       CMDLBL(COMPONENT5)
             ENDDO
             ELSE CMD(DO)
/* if IGNORE, then process with next component */
             IF         COND(&MSGDATA *EQ 'IGNORE') THEN(DO)
             CHGVAR     VAR(&FLDVAL) VALUE('C')
             CALL UP7001 ('*UPDATE   ' ' '   'DCMPG5' &FLDVAL &ERROR)
             IF         COND(&ERROR *NE '          ') THEN(GOTO ERROR)
             CHGVAR     VAR(&FLDVAL) VALUE('+')
             CALL UP7001 ('*UPDATE   ' ' '   'DNOCMC' &FLDVAL &ERROR)
             IF         COND(&ERROR *NE '          ') THEN(GOTO ERROR)
             GOTO       CMDLBL(COMPONENT6)
             ENDDO
             ELSE CMD(DO)
             GOTO       CMDLBL(ERROR)
             ENDDO
             ENDDO

/********* Compoment 6 *********/
 COMPONENT6:

/* update start time */
             RTVSYSVAL  SYSVAL(QTIME) RTNVAR(&STIME)
             CHGVAR     VAR(&FLDVAL) VALUE(&STIME)
             CALL UP7001 ('*UPDATE   ' ' '   'DSTRG6' &FLDVAL &ERROR)
             IF         COND(&ERROR *NE '          ') THEN(GOTO ERROR)

/* submit component */
             SBMJOB     CMD(CALL PGM(UPC7016) PARM(&LAYER &PRFX +
                          &BRGBRGLIB &RETURN )) JOB(OTR_UPGMA) +
                          JOBQ(&BRGBRGLIB/SMJOBQNM)

/* wait for the component to be completed */
             CALL       PGM(QRCVDTAQ) PARM(&DTQN '*LIBL' &MSGLEN +
                          &MSGDATA &RCVWAIT)

/* If component ran ok, update status and end time */
             IF         COND(&MSGDATA *EQ 'COMPLETE') THEN(DO)
/* Update Script Work File job Status with 'Complete' */
             RTVSYSVAL  SYSVAL(QTIME) RTNVAR(&STIME)
             CHGVAR     VAR(&FLDVAL) VALUE(&STIME)
             CALL UP7001 ('*UPDATE   ' ' '   'DENDG6' &FLDVAL &ERROR)
             IF         COND(&ERROR *NE '          ') THEN(GOTO ERROR)
             CHGVAR     VAR(&FLDVAL) VALUE('C')
             CALL UP7001 ('*UPDATE   ' ' '   'DCMPG6' &FLDVAL &ERROR)
             IF         COND(&ERROR *NE '          ') THEN(GOTO ERROR)
             CHGVAR     VAR(&FLDVAL) VALUE('+')
             CALL UP7001 ('*UPDATE   ' ' '   'DNOCMC' &FLDVAL &ERROR)
             IF         COND(&ERROR *NE '          ') THEN(GOTO ERROR)
             GOTO       CMDLBL(COMPONENT7)
             ENDDO

/* If component did not run ok, update status and end time */
             IF         COND(&MSGDATA *NE 'COMPLETE') THEN(DO)
/* Update Script Work File job Status with 'FAIL' */
             RTVSYSVAL  SYSVAL(QTIME) RTNVAR(&STIME)
             CHGVAR     VAR(&FLDVAL) VALUE(&STIME)
             CALL UP7001 ('*UPDATE   ' ' '   'DENDG6' &FLDVAL &ERROR)
             IF         COND(&ERROR *NE '          ') THEN(GOTO ERROR)
             CHGVAR     VAR(&FLDVAL) VALUE('F')
             CALL UP7001 ('*UPDATE   ' ' '   'DCMPG6' &FLDVAL &ERROR)
             IF         COND(&ERROR *NE '          ') THEN(GOTO ERROR)
             ENDDO

/* and wait for the component to be restarted */
             CALL       PGM(QRCVDTAQ) PARM(&DTQN '*LIBL' &MSGLEN +
                          &MSGDATA &RCVWAIT)

             IF         COND(&MSGDATA *EQ 'CONTINUE') THEN(DO)
             CHGVAR     VAR(&FLDVAL) VALUE('           ')
             CALL UP7001 ('*UPDATE   ' ' '   'DENDG6' &FLDVAL &ERROR)
             IF         COND(&ERROR *NE '          ') THEN(GOTO ERROR)
             CHGVAR     VAR(&FLDVAL) VALUE(' ')
             CALL UP7001 ('*UPDATE   ' ' '   'DCMPG6' &FLDVAL &ERROR)
             IF         COND(&ERROR *NE '          ') THEN(GOTO ERROR)

             GOTO       CMDLBL(COMPONENT6)
             ENDDO
             ELSE CMD(DO)
             GOTO       CMDLBL(ERROR)
             ENDDO

/********* Compoment 7 *********/
 COMPONENT7:

/* update start time */
             RTVSYSVAL  SYSVAL(QTIME) RTNVAR(&STIME)
             CHGVAR     VAR(&FLDVAL) VALUE(&STIME)
             CALL UP7001 ('*UPDATE   ' ' '   'DSTRG7' &FLDVAL &ERROR)
             IF         COND(&ERROR *NE '          ') THEN(GOTO ERROR)

/* submit component */
             SBMJOB     CMD(CALL PGM(UPC7017) PARM(&LAYER &PRFX +
                          &BRGBRGLIB &RETURN )) JOB(OTR_RBDGZ) +
                          JOBQ(&BRGBRGLIB/SMJOBQNM)

/* wait for the component to be completed */
             CALL       PGM(QRCVDTAQ) PARM(&DTQN '*LIBL' &MSGLEN +
                          &MSGDATA &RCVWAIT)

/* If component ran ok, update status and end time */
             IF         COND(&MSGDATA *EQ 'COMPLETE') THEN(DO)
/* Update Script Work File job Status with 'Complete' */
             RTVSYSVAL  SYSVAL(QTIME) RTNVAR(&STIME)
             CHGVAR     VAR(&FLDVAL) VALUE(&STIME)
             CALL UP7001 ('*UPDATE   ' ' '   'DENDG7' &FLDVAL &ERROR)
             IF         COND(&ERROR *NE '          ') THEN(GOTO ERROR)
             CHGVAR     VAR(&FLDVAL) VALUE('C')
             CALL UP7001 ('*UPDATE   ' ' '   'DCMPG7' &FLDVAL &ERROR)
             IF         COND(&ERROR *NE '          ') THEN(GOTO ERROR)
             CHGVAR     VAR(&FLDVAL) VALUE('+')
             CALL UP7001 ('*UPDATE   ' ' '   'DNOCMC' &FLDVAL &ERROR)
             IF         COND(&ERROR *NE '          ') THEN(GOTO ERROR)
             GOTO       CMDLBL(COMPONENT8)
             ENDDO

/* If component did not run ok, update status and end time */
             IF         COND(&MSGDATA *NE 'COMPLETE') THEN(DO)
/* Update Script Work File job Status with 'FAIL' */
             RTVSYSVAL  SYSVAL(QTIME) RTNVAR(&STIME)
             CHGVAR     VAR(&FLDVAL) VALUE(&STIME)
             CALL UP7001 ('*UPDATE   ' ' '   'DENDG7' &FLDVAL &ERROR)
             IF         COND(&ERROR *NE '          ') THEN(GOTO ERROR)
             CHGVAR     VAR(&FLDVAL) VALUE('F')
             CALL UP7001 ('*UPDATE   ' ' '   'DCMPG7' &FLDVAL &ERROR)
             IF         COND(&ERROR *NE '          ') THEN(GOTO ERROR)
             ENDDO

/* and wait for the component to be restarted */
             CALL       PGM(QRCVDTAQ) PARM(&DTQN '*LIBL' &MSGLEN +
                          &MSGDATA &RCVWAIT)

             IF         COND(&MSGDATA *EQ 'CONTINUE') THEN(DO)
             CHGVAR     VAR(&FLDVAL) VALUE('           ')
             CALL UP7001 ('*UPDATE   ' ' '   'DENDG7' &FLDVAL &ERROR)
             IF         COND(&ERROR *NE '          ') THEN(GOTO ERROR)
             CHGVAR     VAR(&FLDVAL) VALUE(' ')
             CALL UP7001 ('*UPDATE   ' ' '   'DCMPG7' &FLDVAL &ERROR)
             IF         COND(&ERROR *NE '          ') THEN(GOTO ERROR)

             GOTO       CMDLBL(COMPONENT7)
             ENDDO
             ELSE CMD(DO)
             GOTO       CMDLBL(ERROR)
             ENDDO

/********* Compoment 8 *********/
 COMPONENT8:

/* update start time */
             RTVSYSVAL  SYSVAL(QTIME) RTNVAR(&STIME)
             CHGVAR     VAR(&FLDVAL) VALUE(&STIME)
             CALL UP7001 ('*UPDATE   ' ' '   'DSTRG8' &FLDVAL &ERROR)
             IF         COND(&ERROR *NE '          ') THEN(GOTO ERROR)

/* submit component */
             SBMJOB     CMD(CALL PGM(UPC7018) PARM(&LAYER &PRFX  +
                          &BRGBRGLIB &RETURN )) JOB(OTR_POST) +
                          JOBQ(&BRGBRGLIB/SMJOBQNM)

/* wait for the component to be completed */
             CALL       PGM(QRCVDTAQ) PARM(&DTQN '*LIBL' &MSGLEN +
                          &MSGDATA &RCVWAIT)

/* If component ran ok, update status and end time */
             IF         COND(&MSGDATA *EQ 'COMPLETE') THEN(DO)
/* Update Script Work File job Status with 'Complete' */
             RTVSYSVAL  SYSVAL(QTIME) RTNVAR(&STIME)
             CHGVAR     VAR(&FLDVAL) VALUE(&STIME)
             CALL UP7001 ('*UPDATE   ' ' '   'DENDG8' &FLDVAL &ERROR)
             IF         COND(&ERROR *NE '          ') THEN(GOTO ERROR)
             CHGVAR     VAR(&FLDVAL) VALUE('C')
             CALL UP7001 ('*UPDATE   ' ' '   'DCMPG8' &FLDVAL &ERROR)
             IF         COND(&ERROR *NE '          ') THEN(GOTO ERROR)
             CHGVAR     VAR(&FLDVAL) VALUE('+')
             CALL UP7001 ('*UPDATE   ' ' '   'DNOCMC' &FLDVAL &ERROR)
             IF         COND(&ERROR *NE '          ') THEN(GOTO ERROR)
             GOTO       CMDLBL(NEXT)
             ENDDO

/* If component did not run ok, update status and end time */
             IF         COND(&MSGDATA *NE 'COMPLETE') THEN(DO)
/* Update Script Work File job Status with 'FAIL' */
             RTVSYSVAL  SYSVAL(QTIME) RTNVAR(&STIME)
             CHGVAR     VAR(&FLDVAL) VALUE(&STIME)
             CALL UP7001 ('*UPDATE   ' ' '   'DENDG8' &FLDVAL &ERROR)
             IF         COND(&ERROR *NE '          ') THEN(GOTO ERROR)
             CHGVAR     VAR(&FLDVAL) VALUE('F')
             CALL UP7001 ('*UPDATE   ' ' '   'DCMPG8' &FLDVAL &ERROR)
             IF         COND(&ERROR *NE '          ') THEN(GOTO ERROR)
             ENDDO

/* and wait for the component to be restarted */
             CALL       PGM(QRCVDTAQ) PARM(&DTQN '*LIBL' &MSGLEN +
                          &MSGDATA &RCVWAIT)

             IF         COND(&MSGDATA *EQ 'CONTINUE') THEN(DO)
             CHGVAR     VAR(&FLDVAL) VALUE('           ')
             CALL UP7001 ('*UPDATE   ' ' '   'DENDG8' &FLDVAL &ERROR)
             IF         COND(&ERROR *NE '          ') THEN(GOTO ERROR)
             CHGVAR     VAR(&FLDVAL) VALUE(' ')
             CALL UP7001 ('*UPDATE   ' ' '   'DCMPG8' &FLDVAL &ERROR)
             IF         COND(&ERROR *NE '          ') THEN(GOTO ERROR)

             GOTO       CMDLBL(COMPONENT8)
             ENDDO
             ELSE CMD(DO)
             GOTO       CMDLBL(ERROR)
             ENDDO



 NEXT:
/* Update end time */
             RTVSYSVAL  SYSVAL(QTIME) RTNVAR(&STIME)
             CHGVAR     VAR(&FLDVAL) VALUE(&STIME)
             CALL UP7001 ('*UPDATE   ' ' '   'DENDED' &FLDVAL &ERROR)

/* Delete now the DTAQ */
             DLTDTAQ    DTAQ(&BRGBRGLIB/&DTQN)
             MONMSG     MSGID(CPF0000)


             GOTO       CMDLBL(END)

/* Abnormal termination */

 ERROR:      CHGJOB     SWS(XXXXXX11)
             DMPCLPGM
             DLTDTAQ    DTAQ(&BRGBRGLIB/&DTQN)
             MONMSG     MSGID(CPF2105)

             SNDPGMMSG  MSGID(CPF9898) MSGF(QCPFMSG) MSGDTA('Program UPC7001 ended +
                          ERRORmally - see job log') TOMSGQ(MOPERQ)
             MONMSG     MSGID(CPF0000 MCH0000)

/* End program */

 END:        ENDPGM

