/*********************************************************************/
/*STD    CLPBASEBND                                                  */
/*EXI    TEXT('Midas UP ADBU Generic CLLE pgm')                      */
/*********************************************************************/
/*                                                                   */
/*       Midas - Upgrade Module                                      */
/*                                                                   */
/*       UPCGENER - ADBU Generic CLLE pgm                            */
/*                                                                   */
/*       (c) Finastra International Limited 2020                     */
/*                                                                   */
/*       Last Amend No. MD050666 *CREATE   Date 17Mar20              */
/*                                                                   */
/*********************************************************************/
/*                                                                   */
/*       MD050666 - Adaptive Database Upgrade.                       */
/*                                                                   */
/*********************************************************************/
             PGM        PARM(&PRFX &CMD &ERROR)

             DCL        VAR(&PRFX) TYPE(*CHAR) LEN(2)
             DCL        VAR(&CMD) TYPE(*CHAR) LEN(100)
             DCL        VAR(&CMDLEN) TYPE(*DEC) LEN(15 5) VALUE(100)
             DCL        VAR(&ERROR) TYPE(*CHAR) LEN(10)
             DCL        VAR(&MSGID) TYPE(*CHAR) LEN(7)
             DCL        VAR(&DFTRPY)  TYPE(*CHAR) LEN(1)

             COPYRIGHT TEXT('(c) Finastra International Limited +
                          2020')

/* Global Monitor Message */

             MONMSG     MSGID(CPF0000 MCH0000 RPG0000) EXEC(GOTO CMDLBL(ABNOR))


             CALL       PGM(QCMDEXC) PARM(&CMD &CMDLEN)

/** File has no member to be cleared??? */
                MONMSG     MSGID(CPF3133) EXEC(DO)
                      GOTO       CMDLBL(END)
                ENDDO

/** If the SAVF already exists then CLRSAVF */
                MONMSG     MSGID(CPF7302) EXEC(DO)
                   RCVMSG     MSGTYPE(*DIAG) MSGID(&MSGID)
                   IF         COND(&MSGID *EQ 'CPF5813') THEN(DO)
                      CHGVAR     VAR(&CMD) VALUE('CLR' *TCAT +
                                   %SUBSTRING(&CMD 4 34))
                      CALL       PGM(QCMDEXC) PARM(&CMD &CMDLEN)
                      GOTO       CMDLBL(END)
                   ENDDO
                ENDDO

/** If the SAVF already contain file */
                MONMSG     MSGID(CPA4067) EXEC(DO)
             CHGVAR     VAR(&DFTRPY) VALUE('C')
 /*          SNDRPY MSGKEY(&MSGKEY) MSGQ(&MSGQLIB/&MSGQ) RPY(&DFTRPY) */
                ENDDO

/** If file not found when DLTF */
                MONMSG     MSGID(CPF2105) EXEC(DO)
                   IF         COND(%SUBSTRING(&CMD 1 4) *NE 'DLTF') +
                                THEN(GOTO ABNOR)
                ENDDO

/** If file already existing while being moved */
 /*             MONMSG     MSGID(CPF3201) EXEC(DO) */
 /*             ENDDO */

             GOTO       CMDLBL(END)

/* Abnormal termination */

 ABNOR:      CHGJOB     SWS(XXXXXX11)

             CHGVAR     VAR(&ERROR) VALUE('*Error')
             DMPCLPGM


             SNDPGMMSG  MSGID(CPF9898) MSGF(QCPFMSG) MSGDTA('Program UPCGENER ended +
                          abnormally - see job log') TOMSGQ(MOPERQ)
             MONMSG     MSGID(CPF0000 MCH0000)

/* End program */

 END:        ENDPGM
