     H        1
      *****************************************************************
/*STD *  RPGBASE                                                      *
/*EXI *  TEXT('Midas UT Produce FINDHOOK report header')
      *****************************************************************
      *                                                               *
      *  Midas - UT Module                                            *
      *                                                               *
      *  UT0062 - Produce FINDHOOK report header                      *
      *                                                               *
      *  Called By: UTC0060                                           *
      *                                                               *
      *  (c) Misys International Banking Systems Ltd. 2001            *
      *                                                               *
      * Bank Fusion Midas 1.4 Base -----------------------------------*
      * Midas Plus 1.4 Base 04 ---------------------------------------*
      * Midas Plus 1.4 Base ------------------------------------------*
      * Midas Plus 1.3 ----------- Base ------------------------------*
      *  Last Amend No. CSC017             Date 17Feb03               *
      * Midas Release 4 --------------- Base -------------------------*
      * Midas DBA 3.00 ---------------- Base -------------------------*
      *  Prev Amend No. Xnnnnn             Date ddmmmyy               *
      *                                                               *
      *---------------------------------------------------------------*
      *                                                               *
      *  CSC017 - Change to 250 library list.                         *
      *                                                               *
      *****************************************************************
      *
      * Use of indicators
      * 40 - Error in file handling
      **51*-*Control*for*library*list*loop                                                    CSC017
      * 61 - Hooks only requested
      * 62 - List report only requested
      * 63 - Place report only requested
      *    - If 62 and 63 on then both reports requested
      * 65 - No libraries in library list                                                     CSC017
      * 69-70 - No library to print                                                           CSC017
      *****************************************************************
     FUT0060P1O   E                    PRINTER
      /EJECT
      * Array for holding library list                                                        CSC017
     E                    LIBL      250 10                                                    CSC017
      * Array containing Copyright statement
     E                    CPY@    1   1 80
      /SPACE 3
     IDDTA        DS                          1  80                                           CSC017
     I                                    B  73  760NOMSG                                     CSC017
     IDTAQ        DS                                                                          CSC017
     I                                        1  10 DTAQQ                                     CSC017
     I                                       11  20 DTAQL                                     CSC017
      ** Set up copyright parameter
     C                     MOVEACPY@      CPY2@  80
      * Parameters passed to program
     C           *ENTRY    PLIST
     C                     PARM           RPTTYP  6        *PLACE, *LIST, *BOTH
     C                     PARM           HDRTXT 55        Header text
     C***********          PARM           LIBL1 253        Library list                       CSC017
     C***********          PARM           LIBL2  22        Library list                       CSC017
     C                     PARM           CPYTYP  6        Hooks or all /COPY
     C                     PARM           NOL     20       No. of lines
     C                     PARM           ERR     1        Error return
      *
     C           RPTTYP    IFEQ '*LIST'                    B01
     C                     SETON                     62
     C                     ELSE                            X01
     C           RPTTYP    IFEQ '*PLACE'                   B02
     C                     SETON                     63
     C                     ELSE                            X02
     C                     SETON                     6263
     C                     ENDIF                           E02
     C                     ENDIF                           E01
      *
     C           CPYTYP    IFEQ '*HOOKS'                   B01
     C                     SETON                     61
     C                     ENDIF                           E01
      *
      * Execute subroutine to produce first page library list
      * Retrieve information about library list data queue                                    CSC017
     C                     MOVEL'FHLL'    DTAQQ                                               CSC017
     C                     MOVEL'QTEMP'   DTAQL                                               CSC017
     C                     MOVE *BLANKS   DTA    80                                           CSC017
     C                     CALL 'UT0073'                                                      CSC017
     C                     PARM           DTAQ                                                CSC017
     C                     PARM           DTA                                                 CSC017
      * If there was only one message on the data queue then the library list was empty       CSC017
     C                     MOVELDTA       DDTA                                                CSC017
     C           NOMSG     IFEQ 1                                                             CSC017
     C***********LIBL1     IFEQ *BLANK                     B01                                CSC017
     C                     SETON                     65
     C                     WRITEHEADH
     C                     WRITEHEADH1
     C                     WRITEDTLH1
     C                     SETOF                     65
     C                     ELSE                            X01
     C                     EXSR LIBLS1
     C                     ENDIF                           E01
      *
     C                     RETRN
      *****************************************************************
     C           LIBLS1    BEGSR
      *
     C                     WRITEHEADH                  40
     C                     WRITEHEADH1                 40
      * If error end program
     C           *IN40     IFEQ *ON                        B01
     C                     MOVE '1'       ERR
     C                     SETON                     LR
     C                     RETRN
     C                     ENDIF                           E01
      *
     C***********          SETOF                     51                                       CSC017
     C                     Z-ADD10        LEN     50                                          CSC017
     C                     Z-ADD0         WAIT    50                                          CSC017
      * Fill array from data queue (ignore first message)                                     CSC017
     C                     CALL 'QRCVDTAQ'                                                    CSC017
     C                     PARM           DTAQQ                                               CSC017
     C                     PARM           DTAQL                                               CSC017
     C                     PARM           LEN                                                 CSC017
     C                     PARM           MSG    10                                           CSC017
     C                     PARM           WAIT                                                CSC017
      * Subtract one from number of messages before beginning loop                            CSC017
     C           NOMSG     SUB  1         NOMSG                                               CSC017
     C                     Z-ADD1         X       30
     C***********          Z-ADD1         LIBSQ   20                                          CSC017
      *
     C                     DO   NOMSG                                                         CSC017
     C                     CALL 'QRCVDTAQ'                                                    CSC017
     C                     PARM           DTAQQ                                               CSC017
     C                     PARM           DTAQL                                               CSC017
     C                     PARM           LEN                                                 CSC017
     C                     PARM           MSG                                                 CSC017
     C                     PARM           WAIT                                                CSC017
     C                     MOVELMSG       LIBL,X                                              CSC017
     C                     ADD  1         X                                                   CSC017
     C                     ENDDO                                                              CSC017
      *
      * Execute subroutine to write first page of report                                      CSC017
     C                     EXSR FIRSTP                                                        CSC017
      *
     C************IN51     DOUEQ*ON                        D01                                CSC017
     C***********10        SUBSTLIBL1:X   LIBNM  10                                           CSC017
     C***********LIBNM     IFEQ *BLANK                     B01                                CSC017
     C***********          SETON                     51                                       CSC017
     C***********          ENDIF                           E01                                CSC017
     C************IN51     IFNE *ON                        B01                                CSC017
     C***********          WRITEDTLH1                                                         CSC017
      **If*error*end*program*                                                                 CSC017
     C************IN40     IFEQ *ON                        B02                                CSC017
     C***********          MOVE '1'       ERR                                                 CSC017
     C***********          SETON                     LR                                       CSC017
     C***********          RETRN                                                              CSC017
     C***********          ENDIF                           E02                                CSC017
      *
     C***********          ADD  11        X                                                   CSC017
     C***********          ADD  1         LIBSQ                                               CSC017
     C***********LIBSQ     IFGT 23                         B02                                CSC017
     C***********          EXSR LIBLS2                                                        CSC017
     C***********          ENDIF                           E02                                CSC017
     C***********          ENDIF                           E01                                CSC017
     C***********          ENDDO                           ED01                               CSC017
     C                     ENDSR
      *****************************************************************
     C           FIRSTP    BEGSR                                                              CSC017
      *                                                                                       CSC017
      * Inititalise counts for printing and array indices                                     CSC017
     C                     Z-ADD1         A       30                                          CSC017
     C                     Z-ADD51        B       30                                          CSC017
     C                     Z-ADD101       C       30                                          CSC017
     C                     Z-ADD151       D       30                                          CSC017
     C                     Z-ADD201       E       30                                          CSC017
     C                     Z-ADD1         X                                                   CSC017
      * Inititalise sequence for report                                                       CSC017
     C                     Z-ADD1         LIBSQ1                                              CSC017
     C                     Z-ADD51        LIBSQ2                                              CSC017
     C                     Z-ADD101       LIBSQ3                                              CSC017
     C                     Z-ADD151       LIBSQ4                                              CSC017
     C                     Z-ADD201       LIBSQ5                                              CSC017
      *                                                                                       CSC017
     C           X         DOUGT50                                                            CSC017
     C                     MOVEALIBL,A    LIBNM1                                              CSC017
     C           LIBNM1    IFEQ *BLANKS                                                       CSC017
     C                     SETON                     66                                       CSC017
     C                     ENDIF                                                              CSC017
     C                     MOVEALIBL,B    LIBNM2                                              CSC017
     C           LIBNM2    IFEQ *BLANKS                                                       CSC017
     C                     SETON                     67                                       CSC017
     C                     ENDIF                                                              CSC017
     C                     MOVEALIBL,C    LIBNM3                                              CSC017
     C           LIBNM3    IFEQ *BLANKS                                                       CSC017
     C                     SETON                     68                                       CSC017
     C                     ENDIF                                                              CSC017
     C                     MOVEALIBL,D    LIBNM4                                              CSC017
     C           LIBNM4    IFEQ *BLANKS                                                       CSC017
     C                     SETON                     69                                       CSC017
     C                     ENDIF                                                              CSC017
     C                     MOVEALIBL,E    LIBNM5                                              CSC017
     C           LIBNM4    IFEQ *BLANKS                                                       CSC017
     C                     SETON                     70                                       CSC017
     C                     ENDIF                                                              CSC017
     C                     MOVEALIBL,E    LIBNM5                                              CSC017
      *                                                                                       CSC017
      * Write record and increment indices and fields                                         CSC017
     C                     WRITEDTLH1                  40                                     CSC017
      * If error end program                                                                  CSC017
     C           *IN40     IFEQ *ON                                                           CSC017
     C                     MOVE '1'       ERR                                                 CSC017
     C                     SETON                     LR                                       CSC017
     C                     RETRN                                                              CSC017
     C                     ENDIF                                                              CSC017
      *                                                                                       CSC017
     C                     ADD  1         X                                                   CSC017
     C                     ADD  1         A                                                   CSC017
     C                     ADD  1         B                                                   CSC017
     C                     ADD  1         C                                                   CSC017
     C                     ADD  1         D                                                   CSC017
     C                     ADD  1         E                                                   CSC017
     C                     ADD  1         LIBSQ1                                              CSC017
     C                     ADD  1         LIBSQ2                                              CSC017
     C                     ADD  1         LIBSQ3                                              CSC017
     C                     ADD  1         LIBSQ4                                              CSC017
     C                     ADD  1         LIBSQ5                                              CSC017
      *                                                                                       CSC017
     C                     ENDDO                                                              CSC017
      *                                                                                       CSC017
     C                     ENDSR                                                              CSC017
      *****************************************************************
     C***********LIBLS2    BEGSR                                                              CSC017
      ***********                                                                             CSC017
     C***********          Z-ADD1         X                                                   CSC017
      ***********                                                                             CSC017
     C************IN51     DOUEQ*ON                        D01                                CSC017
     C***********10        SUBSTLIBL2:X   LIBNM  10                                           CSC017
     C***********LIBNM     IFEQ *BLANK                     B01                                CSC017
     C***********          SETON                     51                                       CSC017
     C***********          ENDIF                           E01                                CSC017
     C************IN51     IFNE *ON                        B01                                CSC017
     C***********          WRITEDTLH1                                                         CSC017
      **If*error*end*program*                                                                 CSC017
     C************IN40     IFEQ *ON                        B02                                CSC017
     C***********          MOVE '1'       ERR                                                 CSC017
     C***********          SETON                     LR                                       CSC017
     C***********          RETRN                                                              CSC017
     C***********          ENDIF                           E02                                CSC017
      ***********                                                                             CSC017
     C***********          ADD  11        X                                                   CSC017
     C***********          ADD  1         LIBSQ                                               CSC017
     C***********LIBSQ     IFGT 25                         B02                                CSC017
     C***********          SETON                     51                                       CSC017
     C***********          ENDIF                           E02                                CSC017
     C***********          ENDIF                           E01                                CSC017
     C***********          ENDDO                           ED01                               CSC017
     C***********          ENDSR                                                              CSC017
      *****************************************************************
**  CPY@
(c) Misys International Banking Systems Ltd. 2001
