      *****************************************************************
      *                                                               *
      *  Last Amend No. MD031937           Date 13Jan15               *
      *  Prev Amend No. AR856737           Date 13Sep11               *
      *                 EEE058   *Create   Date 11Feb2003             *
      *                                                               *
      *****************************************************************
      *                                                               *
      *  MD031937 - Upgrade STP enhancements to BF Midas 2.1          *
      *  AR856737 - Upgrade STP enhancements to Midas Plus level      *
      *  EEE058 - Incoming STP                                        *
      *                                                               *
      *****************************************************************
      *                                                                                 EEE058
      *  Test to see if FTPEXTP0 needs to be written to                                 EEE058
      *                                                                                 EEE058
     C           EEE058    IFEQ *BLANKS                                                 EEE058
      *                                                                                 EEE058
      *  Test for Mt910 processing active                                               EEE058
      *                                                                                 EEE058
     C                     CALL 'AOSARDR0'                                              EEE058
     C                     PARM *BLANKS   P@RTCD                                        EEE058
     C                     PARM '*VERIFY' P@OPTN                                        EEE058
     C                     PARM 'EEE058'  @SARD                                         EEE058
     C           SCSARD    PARM *BLANKS   DSFDY                                         EEE058
      *                                                                                 EEE058
      *  EEE058 processing active                                                       EEE058
      *                                                                                 EEE058
     C           P@RTCD    IFEQ *BLANKS                                                 EEE058
     C                     MOVEL'EEE058'  EEE058  6                                     EEE058
     C                     OPEN FTPEXTP0                                                EEE058
     C                     ENDIF                                                        EEE058
     C                     ENDIF                                                        EEE058
      *                                                                                 EEE058
      *  If EEE058 get extension data                                                   EEE058
      *                                                                                 EEE058
     C           EEE058    IFEQ 'EEE058'                                                EEE058
      * get data                                                                        EEE058
     C                     CALL 'FTP960'                                                EEE058
     C                     PARM *BLANKS   P9RTN                                         EEE058
     C                     PARM           P9PEXT                                        EEE058
      * set commission amount if fixed commission                                       EEE058
     C           PXCOMA    IFNE 0                                                       EEE058
      *                                                                                 EEE058
      * Set amount correctly                                                            EEE058
      *                                                                                 EEE058
      *                                                                                 EEE058
      **  Get settlement currency details                                               EEE058
      *                                                                                 EEE058
     C                     CALL 'AOCURRR0'                                              EEE058
     C                     PARM *BLANKS   P@RTCD                                        EEE058
     C                     PARM '*KEY    'P@OPTN                                        EEE058
     C                     PARM BJCYCD    WCURR                                         EEE058
     C           SDCURR    PARM SDCURR    DSSDY                                         EEE058
      *                                                                                 EEE058
     C                     SELEC                                                        EEE058
     C           A6NBDP    WHEQ 0                                                       EEE058
     C                     Z-ADDPXCOMA    U#FAMT                                        EEE058
     C           A6NBDP    WHEQ 1                                                       EEE058
     C           PXCOMA    MULT 10        U#FAMT                                        EEE058
     C           A6NBDP    WHEQ 2                                                       EEE058
     C           PXCOMA    MULT 100       U#FAMT                                        EEE058
     C           A6NBDP    WHEQ 3                                                       EEE058
     C           PXCOMA    MULT 1000      U#FAMT                                        EEE058
     C                     ENDSL                                                        EEE058
      *                                                                                 EEE058
      * Check if amount needs to be converted                                           EEE058
      *                                                                                 EEE058
     C           BJCYCD    IFNE V#CCCY                                                  EEE058
      *                                                                                 EEE058
     C                     CLEARD#DTA                                                   EEE058
     C                     Z-ADDU#FAMT    D#FAMT                                        EEE058
     C                     MOVELBJCYCD    D#FCCY                                        EEE058
     C                     MOVELV#CCCY    D#TCCY                                        EEE058
      *                                                                                 EEE058
     C                     CALL 'AOCCYCV0'             9090                             EEE058
     C                     PARM *BLANKS   O#RTN   7                                     EEE058
     C                     PARM '*F*T*SPT'U#ACT   8                                     EEE058
     C           D#DTA     PARM D#DTA     O#DTA 256                                     EEE058
      *                                                                                 EEE058
     C                     ELSE                                                         EEE058
     C                     Z-ADDU#FAMT    D#TAMT                                        EEE058
     C                     ENDIF                                                        EEE058
      *                                                                                 EEE058
      * Format for screen                                                               EEE058
      *                                                                                 EEE058
      *                                                                                 EEE058
      **  Get settlement currency details                                               EEE058
      *                                                                                 EEE058
     C                     CALL 'AOCURRR0'                                              EEE058
     C                     PARM *BLANKS   P@RTCD                                        EEE058
     C                     PARM '*KEY    'P@OPTN                                        EEE058
     C                     PARM V#CCCY    WCURR                                         EEE058
     C           SDCURR    PARM SDCURR    DSSDY                                         EEE058
      *                                                                                 EEE058
     C                     MOVEL*BLANKS   S7TRCD                                        EEE058
     C                     MOVEL*BLANKS   ZFIELD                                        EEE058
     C                     MOVE D#TAMT    ZFIELD                                        EEE058
     C                     Z-ADDA6NBDP    ZADEC                                         EEE058
     C                     EXSR ZEDIT                                                   EEE058
     C                     MOVE ZFIELD    S0TRCD                                        EEE058
      *                                                                                 EEE058
     C                     ENDIF                                                        EEE058
      *                                                                                 EEE058
     C                     ENDIF                                                        EEE058
      *****************************************************************                 EEE058
      * End of FT0300MK04                                             *                 EEE058
      *****************************************************************                 EEE058
