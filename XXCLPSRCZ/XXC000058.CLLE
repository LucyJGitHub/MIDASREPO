/*********************************************************************/
/*S*D****CLPBASE******************************************************/             /*LUC109*/
/*O*R****OVRDBF*GLCM058WK*QAFDPHY*************************************/             /*LUC109*/
/*STD    CLPBASEBND                                                  */             /*LUC109*/
/*OVR    OVRDBF XXC0058WK QAFDPHY                                    */             /*LUC109*/
/*********************************************************************/
/*                                                                   */
/*       Midas - Standing Data                                       */
/*                                                                   */
/********GLCM058*-*Midas*GL*Extract*File*Purge************************/             /*LUC109*/
/*       XXC000058 - Midas HOR GL Extract File Purge                 */             /*LUC109*/
/*                                                                   */
/********(C)*Copyright Midas-Kapiti International 1999               */             /*LUC109*/
/*       (c) Finastra International Limited 2016                     */             /*LUC109*/
/*                                                                   */
/*       Last Amend No. LUC109            Date 14Sep16               */
/*       Prev Amend No. CM00000000        Date 22Apr15               */
/*                      MUI011            Date 12Jul04               */
/*                      MUI009            Date 01Mar04               */
/*                      MMI043 *Create         04Feb99               */
/*                                                                   */
/*********************************************************************/
/*                                                                   */
/*       LUC109 - HO Reporting (Upgrade to FBM 2.1)                  */
/*       CM0000000 - New HOR File FEMID for account codes            */
/*       MUI011 - ALMS - Addition of FEINT, FEPRI and FETAS extracts */
/*       MUI009 - R4.1 Upgrade: reduce retention period.             */
/*       MMI043 - Customer Details Extract                           */
/*                                                                   */
/*********************************************************************/
             PGM
/**/
/* Declare Variables                                                 */
/**/
/************DCL VAR(&BISCPY) TYPE(*CHAR) LEN(64) VALUE('(C) +
                    (C) Finastra International Limited 1999')        */             /*LUC109*/
             DCL VAR(&BISCPY) TYPE(*CHAR) LEN(64) VALUE('(C) +
                    (C) Copyright Misys Ltd. 2016')                                 /*LUC109*/
             DCL        VAR(&LDA) TYPE(*CHAR) LEN(256)
             DCL        VAR(&MMDD) TYPE(*CHAR) LEN(4)
             DCL        VAR(&FILEMTH) TYPE(*DEC) LEN(2)
             DCL        VAR(&THISMTH) TYPE(*DEC) LEN(2)
             DCL        VAR(&LASTMTH) TYPE(*DEC) LEN(2)
             DCL        VAR(&PREVMTH) TYPE(*DEC) LEN(2)
             DCL        VAR(&INTFLIB) TYPE(*CHAR) LEN(9) VALUE('  +
                          INTFLIB')
             DCL        VAR(&SYSID) TYPE(*CHAR) LEN(2)
/************DCLF*******FILE(QTEMP/GLCM058WK)                        */             /*LUC109*/
             DCLF       FILE(QTEMP/XXC0058WK)                                       /*LUC109*/
             MONMSG     MSGID(CPF0000 MCH0000 RPG0000) EXEC(GOTO +
                          CMDLBL(END))
             CHGJOB     SWS(00000000)

/**/
/*   Retrieve Environment and set up library names               */
/**/
             RTVDTAARA  DTAARA(SDSTAT (6 2)) RTNVAR(&SYSID)
             CHGVAR     VAR(%SUBSTRING(&INTFLIB 1 2)) VALUE(&SYSID)


/**/
/* Create Work File of all Extract Files                             */
/**/

/************DSPFD      FILE(&INTFLIB/CCD*) TYPE(*ATR) +
                          OUTPUT(*OUTFILE) FILEATR(*PF) +
                          OUTFILE(QTEMP/GLCM058WK)                   */             /*LUC109*/
             DSPFD      FILE(&INTFLIB/CCD*) TYPE(*ATR) +
                          OUTPUT(*OUTFILE) FILEATR(*PF) +
                          OUTFILE(QTEMP/XXC0058WK)                                  /*LUC109*/

/************DSPFD      FILE(&INTFLIB/RAT*) TYPE(*ATR) +
                          OUTPUT(*OUTFILE) FILEATR(*PF) +
                          OUTFILE(QTEMP/GLCM058WK) OUTMBR(*FIRST +
                          *ADD)                                      */             /*LUC109*/
             DSPFD      FILE(&INTFLIB/RAT*) TYPE(*ATR) +
                          OUTPUT(*OUTFILE) FILEATR(*PF) +
                          OUTFILE(QTEMP/XXC0058WK) OUTMBR(*FIRST +
                          *ADD)                                                     /*LUC109*/

/************DSPFD      FILE(&INTFLIB/POL*) TYPE(*ATR) +
                          OUTPUT(*OUTFILE) FILEATR(*PF) +
                          OUTFILE(QTEMP/GLCM058WK) OUTMBR(*FIRST +
                          *ADD)                                      */             /*LUC109*/
             DSPFD      FILE(&INTFLIB/POL*) TYPE(*ATR) +
                          OUTPUT(*OUTFILE) FILEATR(*PF) +
                          OUTFILE(QTEMP/XXC0058WK) OUTMBR(*FIRST +
                          *ADD)                                                     /*LUC109*/

/************DSPFD      FILE(&INTFLIB/CRF*) TYPE(*ATR) +
                          OUTPUT(*OUTFILE) FILEATR(*PF) +
                          OUTFILE(QTEMP/GLCM058WK) OUTMBR(*FIRST +
                          *ADD)                                      */             /*LUC109*/
             DSPFD      FILE(&INTFLIB/CRF*) TYPE(*ATR) +
                          OUTPUT(*OUTFILE) FILEATR(*PF) +
                          OUTFILE(QTEMP/XXC0058WK) OUTMBR(*FIRST +
                          *ADD)                                                     /*LUC109*/

/************DSPFD      FILE(&INTFLIB/PTF*) TYPE(*ATR) +
                          OUTPUT(*OUTFILE) FILEATR(*PF) +
                          OUTFILE(QTEMP/GLCM058WK) OUTMBR(*FIRST +
                          *ADD)                                      */             /*LUC109*/
             DSPFD      FILE(&INTFLIB/PTF*) TYPE(*ATR) +
                          OUTPUT(*OUTFILE) FILEATR(*PF) +
                          OUTFILE(QTEMP/XXC0058WK) OUTMBR(*FIRST +
                          *ADD)                                                     /*LUC109*/

/************DSPFD      FILE(&INTFLIB/IMC*) TYPE(*ATR) +
                          OUTPUT(*OUTFILE) FILEATR(*PF) +
                          OUTFILE(QTEMP/GLCM058WK) OUTMBR(*FIRST +
                          *ADD)                                      */             /*LUC109*/
             DSPFD      FILE(&INTFLIB/IMC*) TYPE(*ATR) +
                          OUTPUT(*OUTFILE) FILEATR(*PF) +
                          OUTFILE(QTEMP/XXC0058WK) OUTMBR(*FIRST +
                          *ADD)                                                     /*LUC109*/

/************DSPFD      FILE(&INTFLIB/GIB*) TYPE(*ATR) +
                          OUTPUT(*OUTFILE) FILEATR(*PF) +
                          OUTFILE(QTEMP/GLCM058WK) OUTMBR(*FIRST +
                          *ADD)                                      */             /*LUC109*/
             DSPFD      FILE(&INTFLIB/GIB*) TYPE(*ATR) +
                          OUTPUT(*OUTFILE) FILEATR(*PF) +
                          OUTFILE(QTEMP/XXC0058WK) OUTMBR(*FIRST +
                          *ADD)                                                     /*LUC109*/

/************DSPFD      FILE(&INTFLIB/LIM*) TYPE(*ATR) +
                          OUTPUT(*OUTFILE) FILEATR(*PF) +
                          OUTFILE(QTEMP/GLCM058WK) OUTMBR(*FIRST +
                          *ADD)                                      */             /*LUC109*/
             DSPFD      FILE(&INTFLIB/LIM*) TYPE(*ATR) +
                          OUTPUT(*OUTFILE) FILEATR(*PF) +
                          OUTFILE(QTEMP/XXC0058WK) OUTMBR(*FIRST +
                          *ADD)                                                     /*LUC109*/

/************DSPFD      FILE(&INTFLIB/SIT*) TYPE(*ATR) +
                          OUTPUT(*OUTFILE) FILEATR(*PF) +
                          OUTFILE(QTEMP/GLCM058WK) OUTMBR(*FIRST +
                          *ADD)                                      */             /*LUC109*/
             DSPFD      FILE(&INTFLIB/SIT*) TYPE(*ATR) +
                          OUTPUT(*OUTFILE) FILEATR(*PF) +
                          OUTFILE(QTEMP/XXC0058WK) OUTMBR(*FIRST +
                          *ADD)                                                     /*LUC109*/

/************DSPFD      FILE(&INTFLIB/CRL*) TYPE(*ATR) +
                          OUTPUT(*OUTFILE) FILEATR(*PF) +
                          OUTFILE(QTEMP/GLCM058WK) OUTMBR(*FIRST +
                          *ADD)                                      */             /*LUC109*/
             DSPFD      FILE(&INTFLIB/CRL*) TYPE(*ATR) +
                          OUTPUT(*OUTFILE) FILEATR(*PF) +
                          OUTFILE(QTEMP/XXC0058WK) OUTMBR(*FIRST +
                          *ADD)                                                     /*LUC109*/

/************DSPFD      FILE(&INTFLIB/SEC*) TYPE(*ATR) +
                          OUTPUT(*OUTFILE) FILEATR(*PF) +
                          OUTFILE(QTEMP/GLCM058WK) OUTMBR(*FIRST +
                          *ADD)                                      */             /*LUC109*/
             DSPFD      FILE(&INTFLIB/SEC*) TYPE(*ATR) +
                          OUTPUT(*OUTFILE) FILEATR(*PF) +
                          OUTFILE(QTEMP/XXC0058WK) OUTMBR(*FIRST +
                          *ADD)                                                     /*LUC109*/

/************DSPFD      FILE(&INTFLIB/ANA*) TYPE(*ATR) +
                          OUTPUT(*OUTFILE) FILEATR(*PF) +
                          OUTFILE(QTEMP/GLCM058WK) OUTMBR(*FIRST +
                          *ADD)                                      */             /*LUC109*/
             DSPFD      FILE(&INTFLIB/ANA*) TYPE(*ATR) +
                          OUTPUT(*OUTFILE) FILEATR(*PF) +
                          OUTFILE(QTEMP/XXC0058WK) OUTMBR(*FIRST +
                          *ADD)                                                     /*LUC109*/

/************DSPFD      FILE(&INTFLIB/DER*) TYPE(*ATR) +
                          OUTPUT(*OUTFILE) FILEATR(*PF) +
                          OUTFILE(QTEMP/GLCM058WK) OUTMBR(*FIRST +
                          *ADD)                                      */             /*LUC109*/
             DSPFD      FILE(&INTFLIB/DER*) TYPE(*ATR) +
                          OUTPUT(*OUTFILE) FILEATR(*PF) +
                          OUTFILE(QTEMP/XXC0058WK) OUTMBR(*FIRST +
                          *ADD)                                                     /*LUC109*/

/************DSPFD      FILE(&INTFLIB/INT*) TYPE(*ATR) +
                          OUTPUT(*OUTFILE) FILEATR(*PF) +
                          OUTFILE(QTEMP/GLCM058WK) OUTMBR(*FIRST +
                          *ADD)                                   */  /*MUI011*/    /*LUC109*/
             DSPFD      FILE(&INTFLIB/INT*) TYPE(*ATR) +
                          OUTPUT(*OUTFILE) FILEATR(*PF) +
                          OUTFILE(QTEMP/XXC0058WK) OUTMBR(*FIRST +
                          *ADD)                                                     /*LUC109*/

/************DSPFD      FILE(&INTFLIB/PRI*) TYPE(*ATR) +
                          OUTPUT(*OUTFILE) FILEATR(*PF) +
                          OUTFILE(QTEMP/GLCM058WK) OUTMBR(*FIRST +
                          *ADD)                                   */  /*MUI011*/    /*LUC109*/
             DSPFD      FILE(&INTFLIB/PRI*) TYPE(*ATR) +
                          OUTPUT(*OUTFILE) FILEATR(*PF) +
                          OUTFILE(QTEMP/XXC0058WK) OUTMBR(*FIRST +
                          *ADD)                                                     /*LUC109*/

/************DSPFD      FILE(&INTFLIB/TAS*) TYPE(*ATR) +
                          OUTPUT(*OUTFILE) FILEATR(*PF) +
                          OUTFILE(QTEMP/GLCM058WK) OUTMBR(*FIRST +
                          *ADD)                                   */  /*MUI011*/    /*LUC109*/
             DSPFD      FILE(&INTFLIB/TAS*) TYPE(*ATR) +
                          OUTPUT(*OUTFILE) FILEATR(*PF) +
                          OUTFILE(QTEMP/XXC0058WK) OUTMBR(*FIRST +
                          *ADD)                                                     /*LUC109*/

/************DSPFD      FILE(&INTFLIB/MID*) TYPE(*ATR) +
                          OUTPUT(*OUTFILE) FILEATR(*PF) +
                          OUTFILE(QTEMP/GLC0058WK) OUTMBR(*FIRST +
                          *ADD)                                   */  /*MUI011*/    /*LUC109*/
             DSPFD      FILE(&INTFLIB/MID*) TYPE(*ATR) +
                          OUTPUT(*OUTFILE) FILEATR(*PF) +
                          OUTFILE(QTEMP/XXC0058WK) OUTMBR(*FIRST +
                          *ADD)                                                     /*LUC109*/
/**/
/* Determine which months to keep (Keep this month & the last 2 mths)*/
/**/
/************CALL*******PGM(GLCM049)*PARM(&MMDD)*********************/              /*LUC109*/
             CALL       PGM(XXC000049) PARM(&MMDD)                                  /*LUC109*/

             CHGVAR     VAR(&THISMTH) VALUE(%SST(&MMDD 1 2))

             CHGVAR     VAR(&LASTMTH) VALUE(&THISMTH - 1)
             IF         COND(&LASTMTH *EQ 0) THEN(CHGVAR +
                          VAR(&LASTMTH) VALUE(12))

             CHGVAR     VAR(&PREVMTH) VALUE(&LASTMTH - 1)
             IF         COND(&PREVMTH *EQ 0) THEN(CHGVAR +
                          VAR(&PREVMTH) VALUE(12))

/**/
/* Read Work File and Delete Extract Files                           */
/**/
 READ:
             RCVF
             MONMSG     MSGID(CPF0000) EXEC(GOTO CMDLBL(END))

             CHGVAR     VAR(&FILEMTH) VALUE(%SST(&PHFILE 4 2))
             MONMSG     MSGID(CPF0000) EXEC(GOTO CMDLBL(READ))

/*********** IF         COND((&FILEMTH *LT 01) *OR +                  /*MUI009*/
/***********            (&FILEMTH *GT 12) *OR +                       /*MUI009*/
/***********            (&FILEMTH *EQ &THISMTH) *OR +                 /*MUI009*/
/***********            (&FILEMTH *EQ &LASTMTH) *OR +                 /*MUI009*/
/***********            (&FILEMTH *EQ &PREVMTH)) +                    /*MUI009*/
/***********            THEN(GOTO CMDLBL(READ))                       /*MUI009*/

             IF         COND((&FILEMTH *LT 01) *OR +
                        (&FILEMTH *GT 12) *OR +
                        (&FILEMTH *EQ &THISMTH) *OR +
                        (&FILEMTH *EQ &LASTMTH)) +
                        THEN(GOTO CMDLBL(READ))                       /*MUI009*/

             DLTF       FILE(&INTFLIB/&PHFILE)
             MONMSG     MSGID(CPF0000)

             GOTO       CMDLBL(READ)

END:

/**/
/******CHGVAR*&BISCPY*'(C)*Copyright*MKI*Limited*1999'****************/             /*LUC109*/
       CHGVAR &BISCPY '(C) Finastra International Limited 2016'                     /*LUC109*/
             ENDPGM
