000100210908/*********************************************************************/
000101210908/*STD    CLPBASEMOD                                                  */
000102210908/*EXI    TEXT('Midas XX TAB001 upload to XXACHOMTD')                 */
000103210908/*********************************************************************/
000104210908/*                                                                   */
000105210908/*       Midas - General Ledger Module                               */
000106210908/*                                                                   */
000107210908/*       XXC005004 - Midas XX TAB001 upload to XXACHOMTD             */
000108210908/*                                                                   */
000109210908/*       (c) Finastra International Limited 2021                     */
000110210908/*                                                                   */
000111210908/*       Last Amend No. DRI005  *CREATE    Date 13Apr21              */
000112210908/*                                                                   */
000113210908/*********************************************************************/
000114210908/*                                                                   */
000115210908/*       DRI005 - HO and EDW Extracts                                */
000116210908/*                                                                   */
000117210908/*********************************************************************/
000118210908             PGM
000119210908
000120210908             DCL        VAR(&CPYFLD) TYPE(*CHAR) LEN(64) VALUE('(c) Finastra International +
000121210908                          Limited 2021')
000122210908             DCL        VAR(&LDA) TYPE(*CHAR) LEN(256)
000123210908             DCL        VAR(&MEM) TYPE(*CHAR) LEN(50)
000124210908             DCL        VAR(&PRTCD) TYPE(*CHAR) LEN(7)
000125210908             DCL        VAR(&POPTN) TYPE(*CHAR) LEN(7)
000126210908             DCL        VAR(&PSARD) TYPE(*CHAR) LEN(6)
000127210908             DCL        VAR(&SCSARD) TYPE(*CHAR) LEN(200)
000128210908             DCL        VAR(&DRI005) TYPE(*CHAR) LEN(1)
000129210908             DCL        VAR(&DPLIB) TYPE(*CHAR) LEN(8)
000130210908
000131210908             DCL        VAR(&PRE) TYPE(*CHAR) LEN(2)
000132210908             DCL        VAR(&SDSTAT) TYPE(*CHAR) LEN(256)
000133210908
000134210908/**/
000135210908/*    Global monitor message                                         */
000136210908/**/
000137210908             MONMSG     MSGID(CPF0000 MCH0000 RPG0000) EXEC(GOTO CMDLBL(ABNOR))
000139210908
000140210908             SNDPGMMSG  MSG('XXC005004 - Midas XX TAB001 upload to XXACHOMTD') TOMSGQ(MRUNQ)
000142210908
000143210908/**/
000144210908             CHGJOB     SWS(00000000)
000145210908/**/
000146210908
000147210908/* Retrieve Zone prefix                                                            */
000148210908             RTVDTAARA  DTAARA(SDSTAT *ALL) RTNVAR(&SDSTAT)
000149210908
000150210908             CHGVAR     VAR(&PRE) VALUE(%SST(&SDSTAT 6 2))
000151210908             CHGVAR     VAR(&DPLIB) VALUE(&PRE *TCAT 'DPLIB')
000152210908/**/
000153210908/* Check if DRI005 is ON */
000154210908/**/
000155210908             CHGVAR     VAR(&PRTCD) VALUE('       ')
000156210908             CHGVAR     VAR(&POPTN) VALUE('*VERIFY')
000157210908             CHGVAR     VAR(&PSARD) VALUE('DRI005')
000158210908             CHGVAR     VAR(&DRI005) VALUE('N')
000159210908
000160210908             CALL       PGM(AOSARDR0) PARM(&PRTCD &POPTN &PSARD &SCSARD)
000161210908
000162210908             IF         COND(&PRTCD *EQ '       ') THEN(DO)
000163210908                CHGVAR     VAR(&DRI005) VALUE('Y')
000164210908             ENDDO
000165210908
000166210908/* Process only if DRI005 is ON */
000167210908
000168210908             IF         COND(&DRI005 *EQ 'Y') THEN(DO)
000169210908
000170210908/*    Upload TAB001TD details to XXACHOMTD */
000171210908                CPYF       FROMFILE(TAB001) TOFILE(&DPLIB/TAB001TD) MBROPT(*REPLACE) +
000172210908                             FMTOPT(*NOCHK)
000173210908                MONMSG     MSGID(CPF2817) CMPDTA(CPF2869) EXEC(CLRPFM FILE(&DPLIB/TAB001TD))
000175210908
000176210908                CALL       PGM(XX005007)
000177210908
000178210908/**/
000179210908/*    Database error processing                                      */
000180210908/**/
000181210908                IF         COND(%SWITCH(XXXXXX11)) THEN(DO)
000182210908                   RTVDTAARA  DTAARA(LDA) RTNVAR(&LDA)
000183210908                   CHGVAR     VAR(&MEM) VALUE(%SST(&LDA 134 50))
000184210908                   SNDPGMMSG  MSGID(MEM0001) MSGF(MIDAS) MSGDTA(&MEM) TOMSGQ(MOPERQ MRUNQ)
000186210908                ENDDO
000187210908
000188210908             ENDDO
000189210908
000190210908
000191210908             GOTO       CMDLBL(ENDPGM)
000192210908
000193210908 ABNOR:
000194210908             CHGJOB     SWS(XXXXXX11)
000195210908
000196210908/* Abnormal termination */
000197210908
000198210908             SNDPGMMSG  MSGID(CPF9898) MSGF(QCPFMSG) MSGDTA('Program XXC005004 ended +
000199210908                          abnormally - see job log') TOMSGQ(MOPERQ)
000200210908             MONMSG     MSGID(CPF0000 MCH0000)
000201210908
000202210908 ENDPGM:
000203210908             CHGVAR     VAR(&CPYFLD) VALUE('(c) Finastra International Limited 2021')
000205210908             ENDPGM
