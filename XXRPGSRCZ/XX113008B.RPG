     H        1
      *****************************************************************
/*STD *  RPGBASE                                                      *
/*EXI *  TEXT('Midas GL GCMS i/f - intra-day proj. mvmts. gen.EX2')   *
      *****************************************************************
      *                                                               *
      *  Midas - Midas-GCMS Interface                                 *
      *                                                               *
      ***GLJ008B*-*Intra-day Proj. Mvmts Generation (extract 2)       *                   JMI113
      *  XX113008B - Intra-day proj mvmt generation (extract 2)       *                   JMI113
      *                                                               *
      *  Function:  Extract 2, to extract record which                *
      *             To process the real time posting file for all     *
      *             active GCMS accounts and generate a MT942         *
      *             message for each active account.                  *
      *                                                               *
      ***(c)*Misys*International*Banking*Systems*Ltd.*2005*************                   JMI113
      *  (c) Finastra International Limited 2018                      *                   JMI113
      *                                                               *
      *  Last Amend No. JMI113             Date 22May18               *
      *  Prev Amend No. JMI019             Date 23Feb07               *
      *                 JMI019(C01)*CREATE Date 21Jun05               *
      *                                                               *
      *****************************************************************
      *                                                               *
      *  JMI113 - Midas GCMS Interface. Upgrade to FBM 2.1            *
      *  JMI019 - Upgrade as is except for the following              *
      *           K#ACDE to 10,0 and adjust DS KACCT1                 *
      *           K@ACDE to 10,0 and adjust DS K@ACCT                 *
      *           KLIST K#ACCT change K#ACDE from 4,0 to 10,0         *
      *  JMI019 (C01) - Midas-GCMS Interface Change Control 01        *
      *                 Non-accumulation of MT942                     *
      *                                                               *
      *****************************************************************
     F*********GLGCM2V1IF  E           K        DISK                                      JMI113
     FXXGCM2V1IF  E           K        DISK                                               JMI113
     F                                              KINFSR *PSSR                          JMI113
     F*********GLGCAMV2UF  E           K        DISK                                      JMI113
     FXXGCAMV2UF  E           K        DISK
      /EJECT
      *****************************************************************
      *                                                               *
      *   Indicator Usage                                             *
      *   ---------------                                             *
      *                                                               *
      ****22********No Record Found/Last record on GLGCACL0           *                   JMI113
      *   22        No Record Found/Last record on XXGCACL0           *                   JMI113
      *   25        Acc not found on today's posting file RSACMTL1    *
      *                                                               *
      *   U7 & U8   Database error                                    *
      *   nn        X                                                 *
      *                                                               *
      *****************************************************************
     E                    CPY@    1   1 80
      *
     I*********GLGCM2PO                                                                   JMI113
     IXXGCM2PO                                                                            JMI113
      ** Rename fields to avoid overriding of value
      *
     I              CUSN                            CUSN2
     I              CCYD                            CCYD2
     I              ACDE                            ACDE2
     I              ASNC                            ASNC2
     I              BRCA                            BRCA2
     I              PTDT                            PTDT2
     I              VUDT                            VUDT2
     I              TRYP                            TRYP2
     I              NRTC                            NRTC2
     I              NRTD                            NRTD2
     I              TNMR                            TNMR2
     I              CQNR                            CQNR2
     I              MVAM                            MVAM2
     I              DORC                            DORC2
     I              FUND                            FUND2
     I              TBID                            TBID2
     I              APBI                            APBI2
     I              PASS                            PASS2
      ** Array containing Copyright statement
      *
     ILDA       E DSLDA                         256
      *
      ** LDA for database error reporting
      *
     IRUNDAT    E DSRUNDAT
      *
      ** Data Area giving Installation Control Details
      *
     IPSDS       SDS
     I                                      244 253 @JOB
     I                                      254 263 @USER
     I                                      264 269 @NUM
      *
     I            DS
     I                                        1  79 KACCT1                                    JMI019
     I**********                              1  73 KACCT1                                    JMI019
     I                                        1   3 K#BRCA
     I*********                               4   90K#CUSN                                    JMI113
     I                                        4   9 K#CUSN                                    JMI113
     I                                       10  12 K#CCYD
     I                                       13  220K#ACDE                                    JMI019
     I                                       23  240K#ASNC                                    JMI019
     I                                       25  290K#VUDT                                    JMI019
     I                                       30  420K#MVAM                                    JMI019
     I                                       43  430K#DORC                                    JMI019
     I                                       44  49 K#TNMR                                    JMI019
     I                                       50  79 K#NRTD                                    JMI019
      *
     I**********                             13  160K#ACDE                                    JMI019
     I**********                             17  180K#ASNC                                    JMI019
     I**********                             19  230K#VUDT                                    JMI019
     I**********                             24  360K#MVAM                                    JMI019
     I**********                             37  370K#DORC                                    JMI019
     I**********                             38  43 K#TNMR                                    JMI019
     I**********                             44  73 K#NRTD                                    JMI019
      *
     I            DS
     I                                        1  79 K@ACCT                                    JMI019
     I**********                              1  73 K@ACCT                                    JMI019
     I                                        1   3 K@BRCA
     I**********                              4   90K@CUSN                                    JMI113
     I                                        4   9 K@CUSN                                    JMI113
     I                                       10  12 K@CCYD
     I                                       13  22 K@ACDE                                    JMI019
     I                                       23  240K@ASNC                                    JMI019
     I                                       25  290K@VUDT                                    JMI019
     I                                       30  420K@MVAM                                    JMI019
     I                                       43  430K@DORC                                    JMI019
     I                                       44  49 K@TNMR                                    JMI019
     I                                       50  79 K@NRTD                                    JMI019
      *
     I**********                             13  16 K@ACDE                                    JMI019
     I**********                             17  180K@ASNC                                    JMI019
     I**********                             19  230K@VUDT                                    JMI019
     I**********                             24  360K@MVAM                                    JMI019
     I**********                             37  370K@DORC                                    JMI019
     I**********                             38  43 K@TNMR                                    JMI019
     I**********                             44  73 K@NRTD                                    JMI019
      *
      ** Program Status Data Structure - gives Job name, user and
      ** number
      *
     I              'XX113008B'           C         PGMNAM                                    JMI113
      *
      /EJECT
      *
      *****************************************************************
      *                                                               *
      *   Index to subroutines                                        *
      *   --------------------                                        *
      *                                                               *
      *   INIT      Initial process                                   *
      *   MAIN      Main detail process                               *
      *   CREATE    Create ISO MT942                                  *
      *   *PSSR     Process errors                                    *
      *                                                               *
      *****************************************************************
      *
      /EJECT
      *
      *================================================================
      *  P R O G R A M    S T A R T                                   *
      *================================================================
      *
      ** Receive Parameter List
      *
      ** Execute initial process
      *
     C                     EXSR INIT
      *
      ** Execute main detail process
      *
     C                     EXSR MAIN
      *
      ** Terminate RPG program
     C                     SETON                     LR
      /EJECT
      *
      *****************************************************************
      * Subroutine  :  INIT                                           *
      * Function    :  Perform initial processing                     *
      *                                                               *
      * Called by   :  Main process                                   *
      * Calls       :  AOBANKR0                                       *
      *****************************************************************
      *
     C           INIT      BEGSR
      *
      ** Initialise object copyright statement
      *
     C                     MOVEACPY@      MKI@   80
      *
      ** Initialise LDA
      *
     C           *NAMVAR   DEFN           LDA
     C           *LOCK     IN   LDA
     C                     MOVE *BLANKS   DBASE
     C                     MOVE *BLANKS   DBKEY
     C                     MOVE *BLANKS   DBFILE
     C**********           MOVEL'GLJ008B' DBPGM                                           JMI113
     C                     MOVELPGMNAM    DBPGM                                           JMI113
     C                     OUT  LDA
      *
     C           K#ACCT    KLIST
     C                     KFLD           K#BRCA  3
     C*********            KFLD           K#CUSN  60                                      JMI113
     C                     KFLD           K#CUSN  6                                       JMI113
     C                     KFLD           K#CCYD  3
     C                     KFLD           K#ACDE 100                                          JMI109
     C**********           KFLD           K#ACDE  40                                          JMI109
     C                     KFLD           K#ASNC  20
     C                     KFLD           K#VUDT  50
     C                     KFLD           K#MVAM 130
     C                     KFLD           K#DORC  10
     C                     KFLD           K#TNMR  6
     C                     KFLD           K#NRTD 30
      *
     C                     ENDSR                           INIT
      /EJECT
      *
      *****************************************************************
      * Subroutine  :  MAIN                                           *
      * Function    :  Perform main detail processing                 *
      *                                                               *
      * Called by   :  Main process                                   *
      * Calls       :  CREATE                                         *
      *****************************************************************
      *
     C           MAIN      BEGSR
      *
     C*********  *LOVAL    SETLLGLGCM2V1                                                  JMI113
     C*********            READ GLGCM2V1                 22                               JMI113
     C           *LOVAL    SETLLXXGCM2V1                                                  JMI113
     C                     READ XXGCM2V1                 22                               JMI113
      *
      ** Do while not EOF
      *
     C           *IN22     DOWEQ'0'
      *
     C                     MOVE BRCA2     K#BRCA
     C                     MOVE CUSN2     K#CUSN
     C                     MOVE CCYD2     K#CCYD
     C                     MOVE ACDE2     K#ACDE
     C                     MOVE ASNC2     K#ASNC
     C                     MOVE VUDT2     K#VUDT
     C                     MOVE MVAM2     K#MVAM
     C                     MOVE DORC2     K#DORC
     C                     MOVE TNMR2     K#TNMR
     C                     MOVE NRTD2     K#NRTD
      *
     C                     EXSR SRDELE
      *
     C**********           READ GLGCM2V1                 22                               JMI113
     C                     READ XXGCM2V1                 22                               JMI113
      *
     C                     ENDDO
      *
     C                     ENDSR
      /EJECT
      *
      *****************************************************************
      * Subroutine  :  SRDELE                                         *
      **Function****:**Delete records from GLGCAMV2                   *                   JMI113
      * Function    :  Delete records from XXGCAMV2                   *                   JMI113
      *                                                               *
      * Called by   :  MAIN                                           *
      *****************************************************************
      *
     C           SRDELE    BEGSR
      *
      ** Delete posting if found
      *
     C*********  K#ACCT    CHAINGLGCAMV2             25                                   JMI113
     C           K#ACCT    CHAINXXGCAMV2             25                                   JMI113
      *
     C           *IN25     IFEQ *OFF
     C*********            DELETGLGCAMV2                                                  JMI113
     C                     DELETXXGCAMV2                                                  JMI113
     C                     ENDIF
      *
     C                     ENDSR
      /EJECT
      *
      *****************************************************************
      * Subroutine  :  *PSSR                                          *
      * Function    :  Called autmatically if a program error occurs  *
      *                or directly in case of database errors.        *
      *                This program DUMPs the program just once.      *
      *                                                               *
      * Called by   :  Automatically                                  *
      *                INIT                                           *
      *                                                               *
      * Calls       :  -                                              *
      *****************************************************************
      *
     C           *PSSR     BEGSR
      *
      ** Check to see if *PSSR has been already called
      *
     C           WRUN      IFEQ *BLANK
     C                     MOVE 'Y'       WRUN    1
      *
      ** DUMP and write database error report
      *
     C                     SETON                     U7U8LR
     C                     DUMP
      *
     C                     ENDIF
      *
      ** If *PSSR already run, end program.
      *
     C                     RETRN
      *
     C                     ENDSR                           *PSSR
      *
      ********************************************************************
** CPY@
(c) Finastra International Limited 2018
