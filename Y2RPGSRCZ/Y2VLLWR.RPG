     H            Y
      *****************************************************************
/*STD *  RPGBASE                                                      *
/*EXI *  TEXT('Y2 R2.1.1 Values list name search')
     H/TITLE YAPPOBJ Values list name search   Select record
     Z* CRTRPGPGM
     H* Generated by SYNON/2 Version 6.0 on 19/06/86 at 12:05:58
     H* Select record Version:  0.1
     H* System        : SYNON/2 SHIPPED ROUTINE
     H* User name     : Y2PW
     H* Date          : 19/06/86
      *  (c) Misys International Banking Systems Ltd. 2001            *
     H*================================================================
     H********************************************************************
     H*                                                                  *
      * Bank Fusion Midas 1.4 Base -----------------------------------*
      * Midas Plus 1.4 Base 04 ---------------------------------------*
      * Midas Plus 1.4 Base ------------------------------------------*
      * Midas Plus 1.3 ----------- Base ------------------------------*
      * Midas Release 4 --------------- Base -------------------------*
      * Midas DBA 3.00 ---------------- Base -------------------------*
     H*     LAST AMEND NO.: 056643            DATE: 04OCT93              *
     H*     PREV AMEND NO.: XXXXXX            DATE: DDMMMYY              *
     H********************************************************************
     H*     056643 - THIS IS A COPY OF THE SYNON PROGRAM Y2VLLSR
     H*              CREATED AND DELIVERED TO BE USED FOR
     H*              '?' PROCESSING.
     H*================================================================
     M* Maintenance   :
     M* 18/11/86 PW  Map Blank <-> *BLANK to/from DISPLAY.
     M* 20.05.87 JPL - Revise MSGID usage (USR0008 -> Y2U0008)
     M* 29.05.87 JPL - Revise error reporting if file open fails
     M* 01.07.88 NJSK- Change to use y2snmgc
     M* 21.07.88 PV  - Yes but Y2SNMGC has extra parm of ZAMSGF!!
     M* 14.02.89 NCM - Allow Select value = 1 for SAA
     M* 15.02.89 NCM - Allow overrides to user display files
     M* 20.02.89 NCM - Load entire SFL to overcome DSPF SFLPAG problems
     M* 10.09.90 SOA Recompile over recompiled dspf for R2.0 of OS/400
     M* 09.01.92 ACT - If help displayed, return msgid from Y1USRMSG
      *================================================================
     H* SYNOPSIS :
     H*  - Displays the records from a specified values list.
     H*  - Loads the SFL from the DBF.
     H*  - A record may be selected from
     H*    those displayed in the SFL: data for the record
     H*    will be returned to the calling program
      /EJECT
     F*  C R E A T I O N     P A R A M E T E R S                      *
     F*                                                               *
     F*                                                               *
     F*****************************************************************
     FY2VLLSR#CF  E                    WORKSTN      KINFDS INFDS#     UC
     F                                        ##RR  KSFILE #SFLRCD
      * Values list name search   Select record
      *
     FY2VLLSL0IF  E           K        DISK         KINFDS INFDS1     UC
      * Values list               Retrieval index
      *
      /EJECT
     E                    @OV    20  20  2
     E                    @OD    20  20  2
      * Override to correct values list file.
      /EJECT
     IPGMDS     ESDSY2PGDSP
      * Program data structure.
     IINFDS#    E DSY2I#DSP
      * Display file information data structure.
     IINFDS1    E DSY2I1DSP
      * File information data structure.
      /EJECT
      * Parameter declarations.
     IP1PARM      DS
      * FLD: Values list               Retrieval index
      * List number
     I                                    P   1   40P1LSNO
      * External value.
     I                                        5  24 P1EXVL
     I                                        6  24 W0EXVL
      /EJECT
      *****************************************************************
     C           *ENTRY    PLIST                           Entry parameter
     C                     PARM           P0RTN   7        Return code
     C           P1LSNO    PARM           WP0001  70       List number
     C           P1EXVL    PARM P1EXVL    WP0002 20        External value
      *****************************************************************
     C                     MOVE *BLANK    P0RTN            Return code
      * Initialise
     C                     EXSR ZZINIT
      * Initialise & load subfile
     C                     EXSR BAIZSF
      *................................................................
      * Conduct screen conversation:
     C                     DO   *HIVAL
      * Display screen.
     C                     EXSR CAEXFM
      *   Process response:
      * CK01: Cancel & exit program.
     C   01                CAS            ZXEXPG
      *   HELP: Display help text.
     C   25                CAS            ZHHPKY
      *   HOME Reload subfile.
     C   30                CAS            BAIZSF
      *   Changed start position
     C           #2STVL    CASNEW0STVL    BAIZSF
      *   Process screen input.
     C                     CAS            DAPR##
     C                     END
      *
     C                     END
      *****************************************************************
      /EJECT
     CSR         BAIZSF    BEGSR
      *================================================================
      * Initialise & Load subfile.
      *================================================================
      * Clear subfile.
     C                     SETON                     80
     C                     WRITE#SFLCTL
     C                     SETOF                     8081
      *................................................................
      * Position DBF file to list details.
     C           KRST      KLIST
     C                     KFLD           Y2LSNO           List number
     C                     Z-ADDP1LSNO    Y2LSNO           List number
     C           KRST      SETLL@Y2LSDA
     C           KRST      READE@Y2LSDA                7182*82=EOF
      * Load LST details into #SFLCTL.
     C  N82                EXSR MAFL#2
      * Position to user start
     C           KPOS      KLIST
     C                     KFLD           Y2LSNO           List number
     C                     KFLD           Y2EXVL           EXT value
     C  N82      #2STVL    IFNE *BLANK
     C                     MOVEL#2STVL    Y2EXVL
     C           KPOS      SETLL@Y2EXIN
     C                     END
      * Save start position
     C                     MOVE #2STVL    W0STVL
     C  N82      KRST      READE@Y2EXIN                7182*82=EOF
      * Load SFL.
     C                     EXSR BBLDSF
      *================================================================
     CSR         BAEXIT    ENDSR
      /EJECT
     CSR         BBLDSF    BEGSR
      *================================================================
      * Load subfile.
      *================================================================
      * Setof record error indicators.
     C                     MOVE *ALL'0'   WKINDS  1
     C                     MOVEAWKINDS    *IN,31
      * Reset highest record in SFL.
     C                     Z-ADD0         ##RR    50
      *................................................................
      * Load SFL until full
     C  N82      1         DO   *HIVAL    W0LNNO  50       DO
      * Load SFL fields.
     C                     EXSR MBFL#1
      * Output to subfile.
     C                     ADD  1         ##RR       81    *
     C                     WRITE#SFLRCD
     C           W0LNNO    IFEQ 1
     C                     Z-ADD1         ##SFRC
     C                     END
     C           KRST      READE@Y2EXIN                  82*82=EOF
     C  N82                END                             OD 1 - *HIVAL
      *................................................................
      * If no DBF records found, display error message.
     C   82      ##RR      IFEQ *ZERO                      IF
     C                     MOVE 'Y2U0008' ZAMSID           Message id.
     C                     EXSR ZASNMS                     Send message
     C                     END                             FI ##RR = *ZERO
      *
      *================================================================
     CSR         BBEXIT    ENDSR
      /EJECT
     CSR         CAEXFM    BEGSR
      *================================================================
      * Display screen.
      *================================================================
     C           *IN25     DOUEQ'0'
     C                     WRITE#MSGCTL                     MESSAGES
     C                     WRITE#CMDKEYS                    MESSAGES
     C                     EXFMT#SFLCTL                     SFL CTL
      * Display help text.
     C   25                EXSR ZHHPKY                      HELP TEXT
     C                     END
      * Clear messages from program message queue.
     C                     CALL 'Y2CLMSC'
     C                     PARM ##PGM     ZAPGM  10
     C                     PARM '*SAME'   ZAPGRL  5
      * Reset first message only flag.
     C                     MOVE 'Y'       ZAFSMS  1      99*
     C                     SETOF                       8883*
      * Save change SFLRCDNBR if ROLL keys used.
     C           @#SFRC    IFGT *ZERO
     C                     Z-ADD@#SFRC    ##SFRC
     C                     END
      *================================================================
     CSR         CAEXIT    ENDSR
      /EJECT
     CSR         DAPR##    BEGSR
      *================================================================
      * Process subfile records.
      *================================================================
     C   81                DO   *HIVAL
     C                     READC#SFLRCD                  72*
      * If SFL record changed, process it:
     C  N72                DO
     C                     EXSR DCSFRC
     C                     MOVE *BLANK    #1SEL
     C                     UPDAT#SFLRCD
     C                     END
     C  N72                END
     CSR         DAEXIT    ENDSR
      /EJECT
     CSR         DCSFRC    BEGSR
      *================================================================
      * Process subfile record.
      *================================================================
      * Setof error indicators and SFLNXTCHG.
     C                     MOVEAWKINDS    *IN,31
     C                     SETOF                     84    *
      * Check selection option
     C           #1SEL     IFEQ 'X'
     C           #1SEL     OREQ '1'
     C           #1EXVL    IFEQ '*BLANK'
     C                     MOVE *BLANK    P1EXVL           External value
     C                     ELSE
     C                     MOVE #1EXVL    P1EXVL           External value
     C                     END
     C                     RETRN
     C                     END
      *================================================================
     CSR         DCEXIT    ENDSR
      /EJECT
     CSR         MAFL#2    BEGSR
      *================================================================
      * Initialise subfile control.
      *================================================================
     C                     MOVE Y2EXVL    #2EXVL           External value
     C                     MOVE Y2CNTX    #2CNTX           Condition text
     C                     Z-ADDP1LSNO    #2LSNO           List number
      *================================================================
     CSR         MAEXIT    ENDSR
      /EJECT
     CSR         MBFL#1    BEGSR
      *================================================================
      * Move @Y2EXIN    fields to #SFLRCD.
      *================================================================
     C                     MOVE *BLANK    #1SEL
     C           Y2EXVL    IFEQ *BLANK
     C                     MOVE *BLANK    #1EXVL           External value
     C                     MOVEL'*BLANK'  #1EXVL
     C                     ELSE
     C                     MOVELY2EXVL    #1EXVL           External value
     C                     END
     C                     MOVELY2CNTX    #1CNTX           Condition text
      *================================================================
     CSR         MBEXIT    ENDSR
      /EJECT
     CSR         ZASNMS    BEGSR
      *================================================================
      * Send message to program's message queue.
      *================================================================
      * Send first message only.
     C           ZAFSMS    IFEQ 'Y'
     C           ZAPGM     IFEQ *BLANK
     C                     MOVE ##PGM     ZAPGM
     C                     END
     C                     MOVE 'N'       ZAFSMS  1
     C                     CALL 'Y2SNMGC'
     C                     PARM           ZAPGM  10        Program queue
     C                     PARM           ZAPGRL  5        Rel queue
     C                     PARM           ZAMSID  7        Message Id.
     C                     PARM           ZAMSGF 10        Message file
     C                     PARM           ZAMSDA132        Message data.
     C                     PARM           ZAMSTP  7        Message type.
     C                     END
      *================================================================
     CSR         ZAEXIT    ENDSR
      /EJECT
     CSR         ZHHPKY    BEGSR
      *================================================================
      * Display HELP text.
      *================================================================
     C                     CALL 'YDDSHPR'
     C                     PARM           ##PGM            Program name
     C                     PARM *BLANK    YYHPFL 10        *DFT text file.
     C                     PARM *BLANK    YYHPLB 10        Help text lib.
     C           ZAMSID    PARM           WWRTVM  7        Retun MSGID.
      * Send return message.
      * ACT - Change message file
     C                     MOVEL'Y1USRMSG'ZAMSGF           MSGF for help
     C                     EXSR ZASNMS
      * ACT - Reset message file for error messages
     C                     MOVEL'Y2USRMSG'ZAMSGF           MSGF for errors
      *================================================================
     CSR         ZHEXIT    ENDSR
      /EJECT
     CSR         ZXEXPG    BEGSR
      *================================================================
      * Exit program by request
      *================================================================
      * Send message '*No value selected'
     C                     MOVE 'Y2U0016' ZAMSID           Message id.
     C                     MOVE '*PRV '   ZAPGRL           Pgmq rel.
     C                     EXSR ZASNMS                     Send message
     C                     MOVE 'Y2U0016' P0RTN            No value selected
     C                     MOVE *BLANK    P1EXVL           No value
     C                     RETRN                           Exit
      *================================================================
     CSR         ZXEXIT    ENDSR
      /EJECT
     CSR         ZZINIT    BEGSR
      *================================================================
      * Initialisation.
      *================================================================
      * First time processing.
     C           ZZ1ST     IFEQ *BLANK
     C                     MOVE 'N'       ZZ1ST   1
      * *DTAARA = *COMPANY NAME
     C           *NAMVAR   DEFN YYCOTXA   ##CMP
     C                     IN   *NAMVAR
      * Open file xxVLLSL0 where xx is 1st 2 char of program name.
     C                     MOVEL##PGM     @OV,9
      * OVRDBF to correct file name.
     C                     CALL 'QCAEXEC'
     C                     PARM           @OV
     C                     PARM 40        WKOVLN 155
     C                     OPEN Y2VLLSL0               90
     C           *IN90     IFEQ '1'
     C                     MOVEL@1MSID    P0RTN            Exception msgid
     C                     RETRN
     C                     END
      * Open file xxVLLSR# where xx is 1st 2 char of program name.
     C                     MOVEL##PGM     @OD,10
      * OVRDSPF to correct file name.
     C                     CALL 'QCAEXEC'
     C                     PARM           @OD
     C                     PARM 40        WKOVLN 155
     C                     OPEN Y2VLLSR#               90
     C           *IN90     IFEQ '1'
     C                     MOVEL@1MSID    P0RTN            Exception msgid
     C                     RETRN
     C                     END
     C                     END
      *................................................................
     C                     Z-ADD1         ##SFRC           SFLRCDNBR
      *................................................................
     C                     MOVE *BLANK    W0STVL 20        PRV START
     C                     MOVELW0EXVL    #2STVL           PRV START
      *................................................................
     C                     MOVEL'Y2USRMSG'ZAMSGF 10        MSGF for errors
      *================================================================
     CSR         ZZEXIT    ENDSR
** @OV4 5 6 7 8 9
OVRDBF Y2VLLSL0 ??VLLSL0 SECURE(*YES)
** @OD4 5 6 7 8 9 10
OVRDSPF Y2VLLSR#  ??VLLSR# SECURE(*YES)
