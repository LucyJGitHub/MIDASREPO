      *****************************************************************
/*STD *  RPGBASE                                                      *
/*EXI *  TEXT('Midas ZA Day to date conversion.')
     F****************************************************************
     F*                                                              *
     F*  Midas - Common processing
     F*                                                              *
     F*     ZA0140 - DAY NUMBER TO DATE CONVERSION                   *
     F*                                                              *
      *  (c) Finastra International Limited 2001                      *
     F*                                                              *
      *  Last Amend No. MD046248           Date 27Oct17               *
      * Bank Fusion Midas 1.4 Base -----------------------------------*
      * Midas Plus 1.4 Base 04 ---------------------------------------*
      * Midas Plus 1.4 Base ------------------------------------------*
      * Midas Plus 1.3 ----------- Base ------------------------------*
      * Midas Release 4 --------------- Base -------------------------*
      * Midas DBA 3.00 ---------------- Base -------------------------*
      *  Prev Amend No. E35442             Date 03Feb92               *
      *                 S01319             Date 30Jan92               *
     F*                                                              *
     F*--------------------------------------------------------------*
     F*                                                              *
      *  MD046248 - Finastra Rebranding                               *
     F*     E35442 - Should not have been made redundant;            *
     F*              reinstated.                                     *
     F*                                                              *
     F*     S01319 - Made redundant by project Harry                 *
     F*                                                              *
     F****************************************************************
     F*  C R E A T I O N     P A R A M E T E R S                      *
     F*                                                               *
     F*                                                               *
     F*****************************************************************
     F*
     F**  NO FILES USED IN THIS SUBROUTINE
     F*
     F*
     F**  FUNCTION OF INDICATORS SUMMARY
     F*
     F**      60         ENTRY LESS THAN OR EQUAL TO 'SSRDAY'
     F**                 FOUND IN ARRAY 'SSY'
     F**      61         ENTRY SMALLER THAN 'SSRDAY' IN ARRAY 'SSM'
     F*****************************************************************
     E*****************************************************************
     E*
     E                    CPY@    1   1 80                                S01194
     E*
     E**  ARRAY HOLDING SHORTENED MONTH NAMES
     E*
     E                    SSY     4   4  5 0A
     E*
     E**  ARRAY HOLDING CUMULATIVE NUMBER OF DAYS IN MONTH BY YEAR
     E*
     E                    SSM    12  12  5 0A
     E*
     E**  ARRAY HOLDING SHORTNAMES OF EACH MONTH
     E*
     E                    SSA    12  12  3
     E*****************************************************************
     I*****************************************************************
     I*
     I*
     IPSDS       SDS
     I                                      244 253 JOBNAM
     I                                      254 263 JOBUSR
     I*****************************************************************
     C*****************************************************************
     C**VERSION**
     C**CONVERT DAY NUMBER TO DATE
     C                     MOVE '01.00.00'WWVERS  8
     C                     MOVE 'ZA0140'  WWPGM  10
     C*
     C**  RECEIVING/RETURNING PARAMETERS FROM/TO CALLING PROGRAM
     C*
     C           *ENTRY    PLIST
     C                     PARM           SSDAYN  50
     C                     PARM           SSDFMT  1
     C                     PARM           SSDATE  60
     C                     PARM           SSDATA  7
     C                     PARM           SSRTN   1
     C                     PARM           SSDAT8  80
     C*
     C**  SUBROUTINE PERFORMS INITIAL PROCESSING AND DATE VALIDATION
     C*
     C                     EXSR SRA
     C*
     C**  SUBROUTINE PERFORMS MAIN PROCESSING
     C*
     C           SSRTN     IFEQ '0'
     C                     EXSR SRB
     C                     END
     C*
     C**  PROGRAM TERMINATION
     C*
     C                     SETON                     LR
     C*****************************************************************
     C/EJECT
     C*****************************************************************
     C           SRA       BEGSR
     C*****************************************************
     C*                                                   *
     C*   SUBROUTINE TO PERFORM FIRST CYCLE PROCESSING    *
     C*                                                   *
     C*   SUBROUTINE CALLED FROM MAIN PROGRAM             *
     C*   USES NO OTHER PROGRAM DEFINED SUBROUTINES       *
     C*                                                   *
     C*         INITIALISED WORKFIELDS :-                 *
     C*               I      - INDEX TO ARRAY SSY         *
     C*               J      - INDEX TO ARRAY SSM         *
     C*               SSLEAP - FLAG INDICATING LEAP YEAR  *
     C*                                                   *
     C*****************************************************
     C*
     C                     MOVEACPY@      BIS@   80                       S01194
     C*
     C**  INDICATORS USED SET OFF
     C*
     C                     SETOF                     6061
     C*
     C**  INITIAISING FIELDS TO BE RETURNED TO CALLING PROGRAM
     C*
     C                     MOVE *ZEROS    SSDATE  60
     C                     MOVE *BLANKS   SSDATA  7
     C                     MOVE *ZEROS    SSDAT8
     C                     MOVE '0'       SSRTN   1
     C*
     C**  INITIALISATION OF WORKFIELDS USED IN PROGRAM
     C*
     C                     Z-ADD1         I       20
     C                     Z-ADD1         J       20
     C                     Z-ADD1         SSLEAP  10
     C*
     C**  VALIDATION OF DAY NUMBER - INVALID IF NOT IN RANGE 1 - 99999
     C**  CHECK THAT NOT LESS THAN '1'
     C*
     C           SSDAYN    IFLT 1
     C                     MOVE '1'       SSRTN
     C                     END
     C*
     C**  CHECK THAT NOT GREATER THAN '99999'
     C*
     C           SSDAYN    IFGT 99999
     C                     MOVE '1'       SSRTN
     C                     END
     C*
     C**  CHECK THAT DATE FORMAT IS 'M' OR 'D'
     C*
     C           SSDFMT    IFNE 'M'
     C                     MOVE '1'       SSRTN
     C                     END
     C           SSDFMT    IFEQ 'D'
     C                     MOVE '0'       SSRTN
     C                     END
     C           SRA9      ENDSR
     C*****************************************************************
     C/EJECT
     C*****************************************************************
     C           SRB       BEGSR
     C*****************************************************
     C*                                                   *
     C*   SUBROUTINE TO PERFORM MAIN PROCESSING           *
     C*                                                   *
     C*   SUBROUTINE CALLED FROM MAIN PROGRAM             *
     C*   USES NO OTHER PROGRAM DEFINED SUBROUTINES       *
     C*                                                   *
     C*         ARRAY INDICES USED :-                     *
     C*               I      - INDEX TO ARRAY SSY         *
     C*               J      - INDEX TO ARRAY SSM         *
     C*                                                   *
     C*         FIELDS USED IN SETTING UP OUTPUT PARAS.:- *
     C*               SSDTE  - SETTING UP OF 'SSDATE'     *
     C*               SSDTA  - SETTING UP OF 'SSDATA'     *
     C*                                                   *
     C*****************************************************
     C*
     C**  DIVISION TO DETERMINE WHETHER LEAP YEAR
     C*
     C           SSDAYN    DIV  1461      SSYEAR  40
     C                     MVR            SSRDAY  50
     C*
     C**  CALCULATING YEAR
     C*
     C           SSYEAR    MULT 4         SSYEAR
     C                     ADD  1972      SSYEAR
     C*
     C**  LOOK UP ARRAY TO DETERMINE HOW MANY YEARS OF 4 YEAR CYCLE
     C**  HAVE PASSED.
     C*
     C           SSRDAY    LOKUPSSY,I                  6060
     C*
     C**  IF YEAR IS LEAP YEAR 'SSLEAP' SET TO '0'
     C*
     C           *IN60     IFEQ '0'
     C                     Z-ADD0         SSLEAP
     C                     END
     C*
     C**  ADD INDEX TO YEAR TO GIVE CORRECT YEAR AND ADJUST 'SSRDAY'
     C*
     C           SSLEAP    IFEQ 1
     C           SSRDAY    SUB  SSY,I     SSRDAY
     C           I         ADD  SSYEAR    SSYEAR
     C                     END
     C*
     C**  PROCESSING FOR LEAP YEAR
     C*
     C           SSLEAP    IFEQ 0
     C*
     C**  IF 'SSRDAY' = 60 DATE MUST BE 29TH FEBRUARY
     C*
     C           SSRDAY    IFEQ 60
     C                     Z-ADD29        SSDAY   20
     C                     Z-ADD2         SSMNTH  20
     C                     MOVE SSA,2     SSMNA   3
     C                     GOTO SRB1
     C                     END
     C*
     C**  IF 'SSRDAY' > 60 DATE AFTER 29TH FEBRUARY. CONVERSION CAN
     C**  PROCEDE AS USUAL AFTER SUBTRACTING THE EXTRA DAY FOR THE LEAP
     C**  YEAR.   NOTE - 'SSRDAY' < 60 CONVERSION PROCEDES AS USUAL
     C*
     C           SSRDAY    IFGT 60
     C           SSRDAY    SUB  1         SSRDAY
     C                     END
     C                     END
     C*
     C**  IF DAY 'SSDAYN' EXACTLY DIVISIBLE BY 1461 (NUMBER OF DAYS IN
     C**  4 YEARS) DATE MUST BE LAST DAY OF PREVIOUS FOUR YEAR GROUP
     C*
     C           SSRDAY    IFEQ 0
     C                     Z-ADD31        SSDAY
     C                     Z-ADD12        SSMNTH
     C                     MOVE SSA,12    SSMNA   3
     C                     SUB  1         SSYEAR
     C                     GOTO SRB1
     C                     END
     C*
     C**  LOOK UP ARRAY SSM TO DETERMINE WHICH MONTH 'SSRDAY' OCCURS IN
     C*
     C           SSRDAY    LOKUPSSM,J                  61
     C                     Z-ADDJ         SSMNTH
     C           SSRDAY    SUB  SSM,J     SSDAY
     C*
     C**  SETTING UP ALPHAMERIC MONTH NAME
     C*
     C                     MOVE SSA,SSMNTHSSMNA
     C*
     C**  SETTING UP VARIABLES TO BE RETURNED TO CALLING PROGRAM
     C*
     C           SRB1      TAG                             *** SRB1 ***
     C*
     C**  SETTING UP 7 BYTE ALPHAMERIC FIELD 'SSDATA' CONTAINING MONTH
     C**  SHORTNAME
     C*
     C                     MOVELSSDAY     SSDTA   5
     C                     MOVE SSMNA     SSDTA
     C*
     C                     MOVE SSYEAR    SSDATA
     C                     MOVELSSDTA     SSDATA
     C*
     C**  SETTING UP 6 DIGIT DATE 'SSDATE'. MONTH HELD IN NUMERIC FORM.
     C*
     C           SSDFMT    IFEQ 'M'
     C*
     C**  IF 'SSDFMT' = 'M', FIELD 'SSDATE' HAS MMDDYY FORMAT.
     C*
     C                     MOVE SSDAY     SSDTE   40
     C                     MOVELSSMNTH    SSDTE
     C                     ELSE
     C*
     C**  IF 'SSDFMT' NOT 'M', FIELD 'SSDATE' HAS FORMAT DDMMYY
     C*
     C                     MOVELSSDAY     SSDTE
     C                     MOVE SSMNTH    SSDTE
     C                     END
     C*
     C**  COMPLETING SET UP OF 'SSDATE'
     C*
     C                     MOVE SSYEAR    SSDATE
     C                     MOVELSSDTE     SSDATE
     C*
     C**  SET UP DATE IN EIGHT DIGIT FORMAT (YYYYMMDD)
     C*
     C                     MOVE SSDAY     SSDTE
     C                     MOVELSSMNTH    SSDTE
     C                     MOVE SSDTE     SSDAT8
     C                     MOVELSSYEAR    SSDAT8
     C*
     C           SRB9      ENDSR
     C*****************************************************************
     C/EJECT
     C*****************************************************************
     C           *PSSR     BEGSR
     C*****************************************************
     C*                                                   *
     C*   EXCEPTION ERROR SUBROUTINE                      *
     C*                                                   *
     C*   SUBROUTINE CALLED WHENEVER PROGRAM ERROR OCCURS *
     C*   CAUSES DUMP TO BE MADE                          *
     C*                                                   *
     C*   ROUTINE USES NO OTHER PROGRAM DEFINED ROUTINES  *
     C*                                                   *
     C*****************************************************
     C                     DUMP
     C                     ENDSR
**  COPYRIGHT STATEMENT
(c) Finastra International Limited 2001
**  CUMULATIVE NUMBER OF YEARS IN FOUR YEAR PERIOD
00366007310109601461
**  CUMULATIVE NUMBER OF DAYS IN YEAR BY MONTH
00000000310005900090001200015100181002120024300273003040033400365
**  MONTH SHORTNAMES
JANFEBMARAPRMAYJUNJULAUGSEPOCTNOVDEC
